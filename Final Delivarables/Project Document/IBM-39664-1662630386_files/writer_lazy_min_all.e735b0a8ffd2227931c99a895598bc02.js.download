function RestoreDocumentProperVersion(){}function EventHandler(){}function Body(){var e=new Element;return{getStart:function(){return 0},getEnd:function(){return 0},setStart:e.setStart,setEnd:e.setEnd,type:NODE_TYPE.BODY,attr:e.attr,find:e.find,nextSibling:e.nextSibling,previousSibling:e.previousSibling,parentNode:e.parentNode,firstChild:e.firstChild,lastChild:e.lastChild,select:e.select,getFormat:function(){return this.attr},insert:function(){},children:e.children,remove:function(){}}}function Section(e,t,i,n,o,r,a,s,l,d){var c=new Element;return{getStart:c.getStart,getEnd:c.getEnd,setStart:c.setStart,setEnd:c.setEnd,secId:i,type:NODE_TYPE.SECTION,subType:e,attr:c.attr,nextSibling:c.nextSibling,previousSibling:c.previousSibling,parentNode:c.parentNode,firstChild:function(){var e=editor.doc.findNextIndexOf(UNICODE.PARA+"|"+UNICODE.TABLE,this.getStart());if(editor.doc.getCharAt(e)==UNICODE.PARA){var i=editor.doc.createElement(NODE_TYPE.PARAGRAPH,{});i.setStart(e);var n=editor.doc.findNextIndexOf(CONT_REGEXP.PARAEND,i.getStart()+1);return n<0&&(n=e+t.length),i.setEnd(n),i}var o=editor.doc.createElement(NODE_TYPE.TABLE,{});o.setStart(e);var r=TableUtil.getTableEnd(this.getStart()+1);return o.setEnd(r),o},lastChild:c.lastChild,select:c.select,content:t?t:"",insert:function(e){var i=editor.doc.getDocumentLength(),u={st:this.subType,sid:this.secId,parentId:n,cType:o,type:this.type,userName:r,time:a,userId:s,color:l,activity:d};if(e){var p;for(p in e)u[p]=e[p]}var g=c.getStyleOp(u),f=c.getStyleOp({type:"paragraph"}),E=c.getStyleOp({type:"text"});t=UNICODE.SPACE+t;var T=Utils.randomString(),m=[{r:i},g.as_start,{is:UNICODE.SECTION_START},g.as_end,E.as_start,{is:t},E.as_end,{as:{start:{type:"cursor",uuid:editor.uuid},id:T}},{r:0},{as:{end:["type","uuid"],id:T}},f.as_start,{is:UNICODE.PARA},f.as_end];c.isInserted=!0,this.setStart(i),this.setEnd(i+2+t.length),Op.processMsg(m),Op.cursorProcessed()},children:c.children,remove:function(){var e=editor.doc.getContent(this.getStart(),this.getEnd()),t=[{r:this.getStart()},{ds:e}];if("endnote"==this.subType||"footnote"==this.subType){var i=editor.doc.getSelection().getTargetRange().start;if(this.getStart()<=i&&i<this.getEnd()){var n=DocTreeViewManager.getDTSectionViewByID(this.secId),o=1,r=n.getNextNoteView()||n.getPreviousNoteView();o=null==r?n.getRangeIndex()-1:r.getIndex()<n.getIndex()?r.getIndex()+1-3:r.getIndex()+1-3-e.length,Op.processMsg(Op.getCursor(o,o)),Op.cursorProcessed()}}Op.processMsg(t)},resolve:function(){this.attr({resolve:1})},reOpen:function(){this.attr({resolve:0})}}}function Paragraph(e){var t=new Element;return{getStart:t.getStart,setStart:t.setStart,getEnd:t.getEnd,setEnd:t.setEnd,type:NODE_TYPE.PARAGRAPH,dtNode:e?e:null,text:t.text,attr:t.attr,nextSibling:t.nextSibling,previousSibling:function(){if(this.dtNode){var e,t,i=null;if(e=this.dtNode.prev){if(t=e.type,"para"==t)t=NODE_TYPE.PARAGRAPH,i=editor.doc.createElement(NODE_TYPE.PARAGRAPH,e);else if("table"==t){var n={};n.dtNode=e,i=editor.doc.createElement(NODE_TYPE.TABLE,n)}else i="toc"==t?editor.doc.createElement(NODE_TYPE.TOC,e):editor.doc.createElement(t);return i.setStart(e.getIndex()),i.setEnd(e.getEndIndex()+1),i}}},parentNode:function(){if(this.dtNode){var e,t,i=null,n={};if(e=this.dtNode.parent)return t=e.type,"section"==t?i=editor.doc.createElement(NODE_TYPE.BODY):"cell"==t?(n.dtNode=e,i=editor.doc.createElement(NODE_TYPE.CELL,e)):i="toc"==t?editor.doc.createElement(t,e):editor.doc.createElement(t),i.setStart(e.getIndex()),i.setEnd(e.getEndIndex()+1),i}},firstChild:function(){var e,t=this.getStart(),i=editor.doc.getCharAt(t),n=editor.doc.getRawFormatAt(t);if(n&&n.type==NODE_TYPE.IMAGE)e=editor.doc.createElement(NODE_TYPE.IMAGE,n);else{if(n&&n.type==NODE_TYPE.BOOKMARK&&i==UNICODE.RANGE_START){var o=DocUtil.getRangeEnd(t),r=editor.doc.createElement(NODE_TYPE.BOOKMARK,n);return r.setStart(t),r.setEnd(o+1),r}e=editor.doc.createElement(NODE_TYPE.TEXT,n)}return e.setStart(t),e.setEnd(t+1),e},lastChild:function(){var e=this.getEnd()-1;e-=1;var t,i=(editor.doc.getCharAt(e),editor.doc.getRawFormatAt(e));return t=i&&i.type==NODE_TYPE.IMAGE?editor.doc.createElement(NODE_TYPE.IMAGE,i):editor.doc.createElement(NODE_TYPE.TEXT,i),t.setStart(e),t.setEnd(e+1),t},select:t.select,insert:function(){var e=this.getStart(),t=[{r:e},{is:"\n"}];this.setEnd(e+1);var i=Utils.randomString();if(arguments[0]){var n=arguments[0];n.type||(n.type=this.type);var o=ZWJSONUtils.getKeys(n);t=[{r:e},{as:{start:n,id:i}},{is:"\n"},{as:{end:o,id:i}}]}else{var n=DocUtil.getParaStyle(e),o=ZWJSONUtils.getKeys(n);t=[{r:e},{as:{start:n,id:i}},{is:"\n"},{as:{end:o,id:i}}]}Op.processMsg(t)},children:t.children,remove:function(){var t=editor.doc.getSelection();t.removeAllRanges().showCaret(editor.doc.createRange(e.getIndex(),e.getEndIndex()+1)),t.deleteSelectedContents()}}}function Iframe(){var e=new Element;return{getStart:e.getStart,setStart:e.setStart,getEnd:e.getEnd,setEnd:e.setEnd,type:NODE_TYPE.WIDGET,text:e.text,attr:e.attr,nextSibling:e.nextSibling,select:e.select,children:e.children,insert:function(){var t,i,n,o,r,a,s,l,d=[];if(o=this.getStart()?this.getStart():editor.doc.getSelection().getStart(),i=editor.doc.getParents(NODE_TYPE.PARAGRAPH,o),i&&(t=i.getEnd()-1),n=editor.doc.getRawFormatAt(t),n[ATTR_PARAGRAPH.PS_TS]&&(n[ATTR_PARAGRAPH.PS_TS]=editor.doc.getSelection().textFormat,n[ATTR_PARAGRAPH.PS_TS].hasOwnProperty(TCConstants.TC)&&(n[ATTR_PARAGRAPH.PS_TS]=DocUtil.copyStyle(n[ATTR_PARAGRAPH.PS_TS]),delete n[ATTR_PARAGRAPH.PS_TS][TCConstants.TC])),r=ZWJSONUtils.getKeys(n),a=DocUtil.copyStyle(n),arguments[0]){s=arguments[0],s.type=this.type,l=ZWJSONUtils.getKeys(s);var c=Utils.randomString(),u=Utils.randomString(),p=Utils.randomString();d.push({r:o},{as:{start:a,id:u}},{is:UNICODE.PARA},{as:{end:r,id:u}},{as:{start:s,id:c}},{is:UNICODE.IFRAME},{as:{end:l,id:c}},{as:{start:a,id:p}},{is:UNICODE.PARA},{as:{end:r,id:p}})}Op.processMsg(d),e.isInserted(!1),this.setStart(o+2),this.setEnd(o+3)},remove:function(){var e=[{r:this.getStart()},{ds:UNICODE.IFRAME}];Op.processMsg(e)}}}function Element(){var e=-1,t=-1,i={};this.getStart=function(){return e},this.getEnd=function(){return t},this.setStart=function(t){e=t},this.setEnd=function(e){t=e},this.isInserted=function(){return e!=-1},this.remove=function(){editor.doc.getSelection().deleteContents(this.getStart(),this.getEnd())},this.firstChild=function(){var e=editor.doc.findNextIndexOf(UNICODE.PARA+"|"+UNICODE.TABLE,this.getStart());if(editor.doc.getCharAt(e)==UNICODE.PARA){var t=editor.doc.createElement(NODE_TYPE.PARAGRAPH,{});t.setStart(e);var i=editor.doc.findNextIndexOf(CONT_REGEXP.PARAEND,e+1);return t.setEnd(i),t}var n=editor.doc.createElement(NODE_TYPE.TABLE,{});n.setStart(e);var o=TableUtil.getTableEnd(this.getStart()+1);return n.setEnd(o),n},this.lastChild=function(){},this.children=function(){},this.insertBefore=function(){},this.insertAfter=function(){},this.appendChild=function(){},this.previousSibling=function(){editor.doc.previousSibling(this)},this.find=function(e){return new Iterator(this.getStart(),this.getEnd(),e)},this.select=function(){var e,t=editor.doc.getSelection(),i=this.getStart(),n=this.getEnd();!isV8Engine&&EventHandler.isOnlyCtrlKeyPressed?(t.isCtrlSelection=!0,t.reArrangeRanges(i,n)):(e=editor.doc.createRange(i,n),t.removeAllRanges().addRange(e))},this.text=function(e){if(this.type==NODE_TYPE.PARAGRAPH){var t=editor.doc.findNextIndexOf(CONT_REGEXP.PARAEND,this.getStart())+1;t<0&&(t=editor.doc.getSectionEnd(this.getStart()));var i=editor.doc.getContent(this.getStart(),t);return e||(i=i.replace(REGEX.docUnicodes,"")),i}},this.nextSibling=function(){var e=editor.doc.findNextIndexOf(UNICODE.PARA+"|"+UNICODE.TABLE+"|"+UNICODE.TOCSTART,this.getStart()+1),t=editor.doc.getSectionEnd(this.getStart());if(e<0||e>t)return null;if(editor.doc.getCharAt(e)==UNICODE.PARA){var i=editor.doc.createElement(NODE_TYPE.PARAGRAPH,{});i.setStart(e);var n=editor.doc.findNextIndexOf(CONT_REGEXP.PARAEND,e+1);return i.setEnd(n),i}if(editor.doc.getCharAt(e)==UNICODE.TOCSTART){var o=editor.doc.createElement(NODE_TYPE.TOC);o.setStart(e);var r=editor.doc.findNextIndexOf(UNICODE.TOCEND,e+1);return o.setEnd(r),o}var a=editor.doc.createElement(NODE_TYPE.TABLE,{});a.setStart(e);var s=TableUtil.getTableEnd(this.getStart()+1);return a.setEnd(s),a},this.getStyleOp=function(e){var t=Utils.randomString();return{as_start:{as:{start:e,id:t}},as_end:{as:{end:ZWJSONUtils.getKeys(e),id:t}}}},this.apply=null,this.attr=function(){if(0==arguments.length){if(this.type==NODE_TYPE.PARAGRAPH)var e=DocUtil.copyStyle(editor.doc.getRawFormatAt(this.getEnd()-1));else var e=DocUtil.copyStyle(editor.doc.getRawFormatAt(this.getStart()));for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);return e}var n=arguments[0],o={},r=[];if("string"==typeof n){if(this.type==NODE_TYPE.BODY)var e=editor.doc.getBodyFormat();else if(this.type==NODE_TYPE.PARAGRAPH)var e=DocUtil.getParaFormat(this.getEnd()-1);else var e=editor.doc.getRawFormatAt(this.getStart());return"*"==n?DocUtil.copyStyle(e):("object"==typeof e&&(e=DocUtil.copyStyle(e)),e?e[n]:null)}if("object"!=typeof n)throw ZWImg.ERROR_MSG_1;for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t],o[t]=n[t]);this.type&&(o.type=this.type);var a=ZWJSONUtils.getKeys(o),s=Utils.randomString();if(this.type!=NODE_TYPE.TEXT)r=this.type==NODE_TYPE.BODY?[{r:this.getStart()},{as:{start:o,id:s}},{r:0},{as:{end:a,id:s}}]:this.type==NODE_TYPE.PARAGRAPH?[{r:this.getEnd()-1},{as:{start:o,id:s}},{r:1},{as:{end:a,id:s}}]:[{r:this.getStart()},{as:{start:o,id:s}},{r:1},{as:{end:a,id:s}}];else{var l=this.getStart(),d=this.getEnd(),r=[];r.push({r:l}),r.push({as:{start:o,id:s}}),r.push({r:d-l}),r.push({as:{end:a,id:s}})}Op.processMsg(r)},this.css=this.attr}function Text(e){var t=new Element;return{setStart:t.setStart,setEnd:t.setEnd,getStart:t.getStart,getEnd:t.getEnd,type:NODE_TYPE.TEXT,attr:t.attr,nodeValue:e?e:"",nextSibling:t.nextSibling,previousSibling:t.previousSibling,parentNode:t.parentNode,firstChild:t.firstChild,lastChild:t.lastChild,select:t.select,insert:function(){ZWJSONUtils.isEmptyObject(editor.doc.paintFormat)||(editor.doc.paintFormat={},editor.jeditorPane.find("div.zw-page").css("cursor",""));var e=this.getStart(),t=e+this.nodeValue.length,i=[{r:e},{is:this.nodeValue}],n=Utils.randomString();if(arguments[0]){var o=arguments[0];o.type||(o.type=this.type);var r=ZWJSONUtils.getKeys(o);i=[{r:e},{as:{start:o,id:n}},{is:this.nodeValue},{as:{end:r,id:n}}]}this.setStart(e),this.setEnd(t),Op.processMsg(i)},remove:t.remove,children:t.children}}function BR(e,t){var i=new Element;return{getStart:i.getStart,setStart:i.setStart,getEnd:i.getEnd,setEnd:i.setEnd,type:NODE_TYPE.BR,nodeValue:e&&e.c?e.c:UNICODE.BR,attr:i.attr,nextSibling:i.nextSibling,previousSibling:i.previousSibling,parentNode:i.parentNode,firstChild:i.firstChild,lastChild:i.lastChild,select:function(){},insert:function(){var e=this.getStart(),t={};t[ATTR_COMMON.TYPE]=this.type;var i=Utils.randomString(),n=ZWJSONUtils.getKeys(t),o=[{r:e},{as:{start:t,id:i}},{is:this.nodeValue},{as:{end:n,id:i}}],r=e+this.nodeValue.length;this.setEnd(r),Op.processMsg(o)},children:i.children,remove:function(){}}}function HR(e,t){var i=new Element;return{getStart:i.getStart,setStart:i.setStart,getEnd:i.getEnd,setEnd:i.setEnd,type:NODE_TYPE.HR,nodeValue:e&&e.c?e.c:"",attr:i.attr,nextSibling:i.nextSibling,previousSibling:i.previousSibling,parentNode:i.parentNode,firstChild:i.firstChild,lastChild:i.lastChild,select:function(){var e=this.getStart(),t={idx:e},i=DocTreeManager.getTreeNodeAtIndex(e).id,n=editor.doc.getRawFormatAt(e),o=n&&"pgbrk"==n.cls,r=n&&"colbrk"==n.cls;!n||r||o||PubSub.publish("Hr/Selected",i,t)},insert:function(){var e=this.getStart(),t={type:this.type},n=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e),o=e;n&&(o=n.getEnd()-1);var r={type:NODE_TYPE.PARAGRAPH};editor.doc.getCharAt(o)==UNICODE.PARA&&(r=DocUtil.copyStyle(editor.doc.getRawFormatAt(o))),r[ATTR_PARAGRAPH.PS_TS]&&(r[ATTR_PARAGRAPH.PS_TS]=editor.doc.getSelection().textFormat,r[ATTR_PARAGRAPH.PS_TS].hasOwnProperty(TCConstants.TC)&&(r[ATTR_PARAGRAPH.PS_TS]=DocUtil.copyStyle(r[ATTR_PARAGRAPH.PS_TS]),delete r[ATTR_PARAGRAPH.PS_TS][TCConstants.TC]));var a=ZWJSONUtils.getKeys(r),s=Utils.randomString(),l=Utils.randomString(),d=[{r:e},{as:{start:r,id:l}},{is:"\n"},{as:{end:a,id:l}},{as:{start:t,id:s}},{is:this.nodeValue},{as:{end:["type"],id:s}}];if(arguments&&arguments.length>0){s=Utils.randomString(),l=Utils.randomString(),t=arguments[0],t.type=this.type,this.isPageBreak&&(t[ATTR_TEXT.CLS]="pgbrk",t[ATTR_TEXT.BID]="pgbrk"),this.isColumnBreak&&(t[ATTR_COMMON.CLS]="colbrk",t[ATTR_TEXT.BID]="colbrk");var c=ZWJSONUtils.getKeys(t);d=[{r:e},{as:{start:r,id:l}},{is:"\n"},{as:{end:a,id:l}},{as:{start:t,id:s}},{is:this.nodeValue},{as:{end:c,id:s}}]}var u=e+this.nodeValue.length;Op.processMsg(d),this.setEnd(u),i.isInserted(!0)},children:i.children,remove:function(){}}}function ZWImg(){var e=new Element;return{getStart:e.getStart,getEnd:e.getEnd,setStart:e.setStart,setEnd:e.setEnd,type:NODE_TYPE.IMAGE,attr:e.attr,nextSibling:e.nextSibling,previousSibling:e.previousSibling,parentNode:e.parentNode,firstChild:e.firstChild,lastChild:e.lastChild,select:function(){var e=this.getStart(),t=this.attr().id,i={idx:e},n=editor.doc.getRawFormatAt(e),o=n.hasOwnProperty(ATTR_FILLABLEFIELD.FF_INFO);o?FillableFieldsPanel.showFillableFieldPopup(e,t):n.shapeData?PubSub.publish("Shape/Selected",t,i):PubSub.publish("Image/Selected",t,i)},insert:function(t,i){var n,o=this.getStart()?this.getStart():editor.doc.getSelection().getStart(),r=[{r:o},{is:UNICODE.IMAGE}],a=Utils.randomString();if(arguments.length>0){n=arguments[0],n.type=this.type,n[ATTR_IMAGE.I_ID]?void 0:n[ATTR_IMAGE.I_ID]=Utils.getRandomNumber();var s=ZWJSONUtils.getKeys(n);if(i){var l=Utils.randomString();r=[{r:o},{as:{start:{type:"cursor",uuid:editor.uuid,selectObject:!0},id:l}},{as:{start:n,id:a}},{is:UNICODE.IMAGE},{as:{end:s,id:a}},{as:{end:["type","uuid","selectObject"],id:l}}]}else r=[{r:o},{as:{start:n,id:a}},{is:UNICODE.IMAGE},{as:{end:s,id:a}}]}Op.processMsg(r),e.isInserted(!1),this.setStart(o),this.setEnd(o+1)},children:e.children,remove:function(){var e=[{r:this.getStart()},{ds:UNICODE.IMAGE}];Op.processMsg(e)}}}function ZW_CHART(){var e=new Element;return{getStart:e.getStart,getEnd:e.getEnd,setStart:e.setStart,setEnd:e.setEnd,type:NODE_TYPE.CHART,renderType:NODE_TYPE.IMAGE,attr:e.attr,nextSibling:e.nextSibling,previousSibling:e.previousSibling,parentNode:e.parentNode,firstChild:e.firstChild,lastChild:e.lastChild,select:function(){var e=this.getStart();this.attr().id,editor.doc.getRawFormatAt(e).hasOwnProperty(ATTR_FILLABLEFIELD.FF_INFO)},insert:function(t,i){var n,o=this.getStart()?this.getStart():editor.doc.getSelection().getStart(),r=[{r:o},{is:UNICODE.IMAGE}],a=Utils.randomString();if(arguments.length>0){n=arguments[0],n.type=this.type;var s=ZWJSONUtils.getKeys(n);if(i){var l=Utils.randomString();r=[{r:o},{as:{start:{type:"cursor",uuid:editor.uuid,selectObject:!0},id:l}},{as:{start:n,id:a}},{is:UNICODE.IMAGE},{as:{end:s,id:a}},{as:{end:["type","uuid","selectObject"],id:l}}]}else r=[{r:o},{as:{start:n,id:a}},{is:UNICODE.IMAGE},{as:{end:s,id:a}}]}Op.processMsg(r),e.isInserted(!1),this.setStart(o),this.setEnd(o+1)},children:e.children,remove:function(){var e=[{r:this.getStart()},{ds:UNICODE.IMAGE}];Op.processMsg(e)}}}function Iterator(e,t,i){this.type=i,this.endIdx=t,this.startIdx=e,this.setType=function(e){this.type=e},this.getType=function(){return this.type},this.setEnd=function(e){this.endIdx=e},this.setStart=function(e){this.startIdx=e},this.hasNext=function(){return this.startIdx<this.endIdx},this.getNextItem=function(){for(var e=this.getType(),t=null,i=this.startIdx;!t&&i<=this.endIdx;){var n=new RegExp(UNICODE.TABLE+"|"+UNICODE.TABLEEND+"|"+UNICODE.ROW+"|"+UNICODE.CELL+"|"+UNICODE.PARA+"|"+UNICODE.SECTION_START,"g"),o=editor.doc.getCharAt(i);switch(!0){case e==NODE_TYPE.TEXT&&!n.test(o):var r=editor.doc.findNextIndexOf(CONT_REGEXP.PARAEND,i);r<0&&(r=editor.doc.getDocumentLength());var o=editor.doc.getContent(i,r);t=editor.doc.createElement(NODE_TYPE.TEXT,o),t.setStart(i),t.setEnd(r-1);break;case e==NODE_TYPE.PARAGRAPH&&o==UNICODE.PARA:t=editor.doc.createElement(NODE_TYPE.PARAGRAPH,o),t.setStart(i);var a=editor.doc.findNextIndexOf(UNICODE.TABLE+"|"+UNICODE.PARA+"|"+UNICODE.CELL+"|"+UNICODE.ROW+"|"+UNICODE.TABLEEND+"|"+UNICODE.SECTION_START,i+1);a<0&&(a=editor.doc.getDocumentLength()),t.setEnd(a);break;case e.indexOf(NODE_TYPE.CELL)&&o==UNICODE.CELL:t=editor.doc.createElement(NODE_TYPE.CELL),t.setStart(i);var s=editor.doc.findNextIndexOf(UNICODE.CELL+"|"+UNICODE.ROW+"|"+UNICODE.TABLEEND,i+1);t.setEnd(s);break;case e==NODE_TYPE.SECTION&&o==UNICODE.SECTION_START:var l=editor.doc.getRawFormatAt(i),d=l.st,c=l.sid,u=editor.doc.findNextIndexOf(CONT_REGEXP.SECTIONEND,i+1);u<0&&(u=editor.doc.getDocumentLength());var p=editor.doc.getContent(i,u);switch(d){case NODE_TYPE.BOOKMARK:nodeName=NODE_TYPE.BOOKMARK;break;case NODE_TYPE.FOOTNOTE:nodeName=NODE_TYPE.FOOTNOTE;break;case NODE_TYPE.ENDNOTE:nodeName=NODE_TYPE.ENDNOTE;break;case NODE_TYPE.COMMENT:nodeName=NODE_TYPE.COMMENT;break;case NODE_TYPE.HEADER_PRIMARY:nodeName=NODE_TYPE.HEADER_PRIMARY;break;case NODE_TYPE.FOOTER_PRIMARY:nodeName=NODE_TYPE.FOOTER_PRIMARY}t=editor.doc.createElement(nodeName,c),t.setStart(i),t.setEnd(u),t.setContent(p),i=u-1}i++}return t?this.setStart(t.getEnd()+1):this.setStart(this.endIdx+1),t}}function LinkItem(e,t,i,n,o){var r=new Element;return{getStart:r.getStart,setStart:r.setStart,getEnd:r.getEnd,setEnd:r.setEnd,type:NODE_TYPE.LINK,attr:r.attr,nextSibling:r.nextSibling,previousSibling:r.previousSibling,parentNode:r.parentNode,firstChild:r.firstChild,lastChild:r.lastChild,select:r.select,insert:function(e,t){sel=editor.doc.getSelection();var i=this.getStart()||sel.getStart();i=0==i?1:i;var n=this.getEnd()||sel.getEnd();editor.doc.getSelection().isCollapsed()||editor.doc.getCharAt(n-1)!=UNICODE.PARA||(n-=1);var o=Utils.randomString();linkstyle=arguments[0],linkstyle.id=o;var r={},a={char:UNICODE.RANGE_START,style:linkstyle};r[ATTR_COMMON.ID]=o,r[ATTR_COMMON.TYPE]=NODE_TYPE.LINK;var s={char:UNICODE.RANGE_END,style:r};r={},r[ATTR_COMMON.CLS]="link",r[ATTR_LINK.LINK_URL]=linkstyle[ATTR_LINK.LINK_URL],r[ATTR_LINK.LINK_TYPE]=linkstyle[ATTR_LINK.LINK_TYPE],r[ATTR_LINK.LINK_TARGET]=linkstyle[ATTR_LINK.LINK_TARGET],r[ATTR_LINK.LINK_TOOLTIP]=linkstyle[ATTR_LINK.LINK_TOOLTIP],r[ATTR_COMMON.TYPE]=NODE_TYPE.TEXT;var l=editor.doc.getRawFormatAt(i);if((!l||l&&"none"===l.td)&&(r.td=""),arguments[0].text){var d=[];for(var c in r)d.push(c);var u=editor.doc.createElement(NODE_TYPE.TEXT,arguments[0].text),p=DocUtil.mergeObjs([editor.doc.getSelection().getTextFormat(),r]);return delete p[ATTR_TEXT.TS_FGC],u.css=p,editor.doc.getSelection().surroundAndInsert(a,s,u),void delete arguments[0].text}var g=editor.doc.createElement(NODE_TYPE.TEXT);g.setStart(i),g.setEnd(n),r[ATTR_TEXT.TS_FGC]="",g.attr(r),sel.surroundTextWith(a,s,t,!0)},children:r.children,remove:function(){var e=this.getStart(),t=this.getEnd(),i=editor.doc.createElement(NODE_TYPE.TEXT);i.setStart(e+1),i.setEnd(t-1);var n={};n[ATTR_COMMON.CLS]="unlink",n[ATTR_TEXT.TS_FGC]="",n[ATTR_TEXT.TS_TD]="",n[ATTR_LINK.LINK_TYPE]="",i.attr(n);var o=editor.doc.getContent(e,e+1),r=editor.doc.getContent(t-1,t);msg=[{r:e},{ds:o},{r:t-e-2},{ds:r}],Op.processMsg(msg)}}}function List(){}function Table(e,t,i,n,o){var r=new Element,a=function(e){var t={};return t[ATTR_COMMON.TYPE]=NODE_TYPE.CELL,t},s=function(e){e&&e[ATTR_PARAGRAPH.PS_HD]&&parseInt(e[ATTR_PARAGRAPH.PS_HD])>=0&&(e[ATTR_PARAGRAPH.PS_TS]={},delete e[ATTR_PARAGRAPH.PS_HD]),e.ls_data||(delete e[ATTR_PARAGRAPH.PS_ML],delete e[ATTR_PARAGRAPH.PS_MR],delete e[ATTR_PARAGRAPH.PS_TI]),delete e[ATTR_PARAGRAPH.PS_CODE]};return{getStart:r.getStart,setStart:r.setStart,getEnd:r.getEnd,setEnd:r.setEnd,type:NODE_TYPE.TABLE,dtNode:o?o:null,attr:r.attr,rows:e?e:2,cols:t?t:2,tableVals:n?n:void 0,cursorRowPos:void 0,cursorColPos:void 0,props:i?i:void 0,setCursor:function(e,t){this.cursorRowPos=e,this.cursorColPos=t},nextSibling:function(){var e,t,i={},n=null;if(this.dtNode&&(e=this.dtNode.next))return t=e.type,"para"==t?n=editor.doc.createElement(NODE_TYPE.PARAGRAPH,e):"table"==t?(i.dtNode=e,n=editor.doc.createElement(NODE_TYPE.TABLE,i)):n="toc"==t?editor.doc.createElement(NODE_TYPE.TOC,e):editor.doc.createElement(t),n.setStart(e.getIndex()),n.setEnd(e.getEndIndex()+1),n},previousSibling:function(){var e,t,i={},n=null;if(this.dtNode&&(e=this.dtNode.prev))return t=e.type,"para"==t?n=editor.doc.createElement(NODE_TYPE.PARAGRAPH,e):"table"==t?(i.dtNode=e,n=editor.doc.createElement(NODE_TYPE.TABLE,i)):n="toc"==t?editor.doc.createElement(NODE_TYPE.TOC,e):editor.doc.createElement(t),n.setStart(e.getIndex()),n.setEnd(e.getEndIndex()+1),n},parentNode:function(){var e,t,i=null;if(this.dtNode&&(e=this.dtNode.parent))return t=e.type,i="section"==t?editor.doc.createElement(NODE_TYPE.BODY):"cell"==t?editor.doc.createElement(NODE_TYPE.CELL,e):"toc"==t?editor.doc.createElement(NODE_TYPE.TOC,e):editor.doc.createElement(t),i.setStart(e.getIndex()),i.setEnd(e.getEndIndex()+1),i},children:function(){var e,t,i,n,o=[],r={};if(this.dtNode)for(children=this.dtNode.children,i=0,n=children.length;i<n;i++)t=children[i],r.dtNode=t,e=editor.doc.createElement(NODE_TYPE.ROW,r),e.setStart(t.getIndex()),e.setEnd(t.getEndIndex()+1),o.push(e);return o},firstChild:function(){var e,t,i={};if(this.dtNode)return t=this.dtNode.children[0],i.dtNode=t,e=editor.doc.createElement(NODE_TYPE.ROW,i),e.setStart(t.getIndex()),e.setEnd(t.getEndIndex()+1),e},lastChild:function(){var e,t,i={};if(this.dtNode)return t=this.dtNode.children[this.dtNode.children.length-1],i.dtNode=t,e=editor.doc.createElement(NODE_TYPE.ROW,i),e.setStart(t.getIndex()),e.setEnd(t.getEndIndex()+1),e},nodeCountBefore:function(e){for(var t=e.getStart()-1,i=0,n=0;editor.doc.getCharAt(t)!=UNICODE.TABLE;)n=TableUtil.getRowStart(t),t=n-1,i++;return i},insertBefore:function(e,t,i,n,o,r){var a=editor.doc.createElement(NODE_TYPE.ROW);a.setStart(e.getStart()),a.insert(t,i,n,o,r)},appendChild:function(e,t,i,n,o){var r=editor.doc.createElement(NODE_TYPE.ROW);r.setStart(this.getEnd()-1),r.insert(e,t,i,n,o)},insert:function(e){var t,i,n=UNICODE.TABLE,o=this.getStart(),l=[],d=editor.doc.getParents(NODE_TYPE.PARAGRAPH,o);d&&(paraIdx=d.getEnd()-1);var c={type:NODE_TYPE.PARAGRAPH};editor.doc.getCharAt(paraIdx)==UNICODE.PARA&&(c=DocUtil.copyStyle(editor.doc.getRawFormatAt(paraIdx))),c.hasOwnProperty(TCConstants.TC)&&delete c[TCConstants.TC],c[ATTR_PARAGRAPH.PS_TS]&&(c[ATTR_PARAGRAPH.PS_TS]=editor.doc.getSelection().textFormat,c[ATTR_PARAGRAPH.PS_TS].hasOwnProperty(TCConstants.TC)&&(c[ATTR_PARAGRAPH.PS_TS]=DocUtil.copyStyle(c[ATTR_PARAGRAPH.PS_TS]),delete c[ATTR_PARAGRAPH.PS_TS][TCConstants.TC]));var u=ZWJSONUtils.getKeys(c),p=editor.doc.getSelection().getParents(NODE_TYPE.CELL),g=editor.doc.getSelection().getParents(NODE_TYPE.SECTION).subType;if(p){var f=DocTreeManager.getTreeNodeAtIndex(p.getStart()),E=DocLayoutManager.getWidthFromNode(f),T=p.attr(),m=T.pl?T.pl:Conversions.defaultCellLeftRightPadding;m=parseFloat(Conversions.toPixels(m).toFixed());var h=T.pr?T.pr:Conversions.defaultCellLeftRightPadding;h=parseFloat(Conversions.toPixels(h).toFixed()),E=E-m-h,t=E/this.cols<20?20+UNITS.PIXELS:E/this.cols+UNITS.PIXELS,i=Conversions.toGlobalValue(parseInt(t)*this.cols+UNITS.PIXELS),t=Conversions.toGlobalValue(t)}else if("textbox"==g){var I=DocTreeManager.getTreeNodeAtIndex(o).parent,_=I.getRangeIndex(),A=editor.doc.getRawFormatAt(_),S=A[ATTR_CELL.TDS_PL]?parseFloat(A[ATTR_CELL.TDS_PL].convertor().pixels):0,R=A[ATTR_CELL.TDS_PR]?parseFloat(A[ATTR_CELL.TDS_PR].convertor().pixels):0,O=A[ATTR_IMAGE.I_WID]-S-R,b=O/Conversions.globalUnitInPx;t=(b/this.cols).toFixed(3)+Conversions.globalUnit,i=b.toFixed(3)+Conversions.globalUnit}else{var b=DocLayoutManager.getColumnWidthAtIdx(o)/Conversions.globalUnitInPx;t=(b/this.cols).toFixed(3)+Conversions.globalUnit,i=b.toFixed(3)+Conversions.globalUnit}EditorView.isWebView()&&(t=(parseFloat(t)/parseFloat(i)*100).toFixed(2)+UNITS.PERCENTAGE,i="100%");for(var v,D,L=[],N=0;N<this.cols;N++)v=e&&e.cols&&e.cols[N],D=v?v:{},D.wt||(D.wt=t),L.push(D);var P=UNICODE.TABLE,C=DocUtil.copyStyle(c),y=Utils.randomString(),F=Utils.randomString(),M={};if(M[ATTR_TABLE.TBLS_THEME]={},M[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT]={tblPr:{cell:{borders:{"border-top":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-left":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-bottom":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-right":{type:"solid",width:"1px",color:"rgb(0,0,0)"}}}}},M[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEMENAME]="theme1",M.type=this.type,M[ATTR_TABLE.TBLS_VER]="4.0",c[ATTR_PARAGRAPH.PS_DIR]==PARA_DIR.RTL&&(M[ATTR_TABLE.TBLS_DIR]=PARA_DIR.RTL),M[ATTR_TABLE.TBLS_WID]=i,M[ATTR_TABLE.TBLS_COLS]=L,M.name=TableCollectionInstance.getNewTableName(),e)for(var w in e)"cols"!=w&&(M[w]=e[w]);Utils.addId(M,"tb-",4);var U=ZWJSONUtils.getKeys(M);l.push({r:o},{as:{start:C,id:y}},{is:UNICODE.PARA},{as:{end:u,id:y}},{as:{start:M,id:F}},{is:P},{as:{end:U,id:F}}),C=DocUtil.copyStyle(c),C[ATTR_PARAGRAPH.PS_DIR]=c[ATTR_PARAGRAPH.PS_DIR]?c[ATTR_PARAGRAPH.PS_DIR]:PARA_DIR.LTR,s(C),u=ZWJSONUtils.getKeys(C);for(var x=0;x<this.rows;x++){var B={},H=Utils.randomString();if(B[ATTR_ROW.TRS_HT]="auto",B[ATTR_COMMON.TYPE]=NODE_TYPE.ROW,this.tableVals&&this.tableVals[x]){var J=this.tableVals[x].rowFormat;for(var w in J)B[w]=J[w]}Utils.addId(B,"rw-",4),n+=UNICODE.ROW,P=UNICODE.ROW;var G=ZWJSONUtils.getKeys(B);l.push({as:{start:B,id:H}},{is:P},{as:{end:G,id:H}});var k=C,W=void 0;this.tableVals&&this.tableVals[x]&&(W=this.tableVals[x].cellValuesOpsArr);for(var Y=(ZWJSONUtils.getKeys(k),0);Y<this.cols;Y++){var z=a(t),Z=Utils.randomString();Utils.addId(z,"cl-",4);var V=this.tableVals&&this.tableVals[x]&&this.tableVals[x].cellFormat&&this.tableVals[x].cellFormat[Y];if(V)for(var w in V)z[w]=V[w];var j=ZWJSONUtils.getKeys(z);if(n+=UNICODE.CELL+UNICODE.PARA,P=UNICODE.CELL,l.push({as:{start:z,id:Z}},{is:P},{as:{end:j,id:Z}}),void 0!=this.cursorRowPos&&void 0!=this.cursorColPos&&this.cursorRowPos==x&&this.cursorColPos==Y){var X=Utils.randomString(),K={as:{start:{type:"cursor",uuid:editor.uuid},id:X}},q={as:{end:["type","uuid"],id:X}};l.push(K),l.push({r:0}),l.push(q)}if(W&&W[Y])for(var Q=W[Y],$=W[Y].length,ee=0;ee<$;ee++){var te=Q[ee];if(l.push(te),"is"==ZWJSONUtils.getKeys(te)[0]){var ie=te.is;n+=ie}}var ne=DocUtil.copyStyle(k);P=UNICODE.PARA;var y=Utils.randomString();l.push({as:{start:ne,id:y}},{is:P},{as:{end:ZWJSONUtils.getKeys(ne),id:y}})}}var oe=r.getStyleOp({type:"tableend"});l.push(oe.as_start,{is:UNICODE.TABLEEND},oe.as_end),n+=UNICODE.TABLEEND+UNICODE.PARA,this.text=n,Op.processMsg(l),this.setEnd(this.getStart()+this.text.length)},remove:r.remove,select:r.select}}function Row(e,t,i){var n=new Element;return{getStart:n.getStart,setStart:n.setStart,getEnd:n.getEnd,setEnd:n.setEnd,type:NODE_TYPE.ROW,dtNode:i?i:null,cols:e?e:2,action:t,attr:n.attr,nextSibling:function(){if(this.dtNode){var e,t=null,i={};if(e=this.dtNode.next)return i.dtNode=e,t=editor.doc.createElement(NODE_TYPE.ROW,i),t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1),t}},firstChild:function(){var e,t=null;if(this.dtNode&&(e=this.dtNode.children[0]))return t=editor.doc.createElement(NODE_TYPE.CELL,e),t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1),t},lastChild:function(){var e,t=null;if(this.dtNode&&(e=this.dtNode.children[this.dtNode.children.length-1]))return t=editor.doc.createElement(NODE_TYPE.CELL,e),t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1),t},previousSibling:function(){if(this.dtNode){var e,t=null,i={};if(e=this.dtNode.prev)return i.dtNode=e,t=editor.doc.createElement(NODE_TYPE.ROW,i),t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1),t}},insertAfter:function(e,t,i,n){var o=t.getEnd();e.setStart(o),e.insert(i,n)},insertBefore:function(e,t,i,n){e.setStart(t.getStart()),e.insert(i,n)},appendChild:function(e,t){e.setStart(this.getEnd()),e.insert(t)},insert:function(e,t,i,n,o){for(var r=[{r:this.getStart()}],a=!1,s=0;s<o;s++){Utils.addId(e,"rw-",4);var l,d=Utils.randomString(),c=t.length,u=[{as:{start:e,id:d}},{is:UNICODE.ROW},{as:{end:ZWJSONUtils.getKeys(e),id:d}}];for(l=0;l<c;l++){var p=Utils.randomString(),g=Utils.randomString(),f=t[l];Utils.addId(f,"cl-",4),u.push({as:{start:f,id:p}}),u.push({is:UNICODE.CELL}),u.push({as:{end:ZWJSONUtils.getKeys(f),id:p}});var E=DocUtil.copyStyle(i[l]);!a&&n&&(a=!0,u=u.concat(Op.getCursor()),Op.cursorProcessed()),u.push({as:{start:E,id:g}}),u.push({is:UNICODE.PARA}),u.push({as:{end:ZWJSONUtils.getKeys(E),id:g}})}r=r.concat(u)}Op.processMsg(r)},nodeCountBefore:function(e){for(var t=e.getStart()-1,i=0;editor.doc.getCharAt(t)!=UNICODE.ROW;){var n=TableUtil.getCellStart(t);t=n-1,i++}return i},parentNode:function(){var e=editor.doc.getParents(NODE_TYPE.TABLE,this.getStart());return e},children:function(){var e,t,i,n,o=[];if(this.dtNode)for(e=this.dtNode.children,i=0,n=e.length;i<n;i++)t=e[i],elem=editor.doc.createElement(NODE_TYPE.CELL,t),elem.setStart(t.getIndex()),elem.setEnd(t.getEndIndex()+1),o.push(elem);return o},remove:n.remove}}function Cell(e){var t=new Element;return{getStart:t.getStart,setStart:t.setStart,getEnd:t.getEnd,setEnd:t.setEnd,type:NODE_TYPE.CELL,dtNode:e?e:null,attr:t.attr,nextSibling:function(){var e,t=null;return this.dtNode&&(e=this.dtNode.next,e&&(t=editor.doc.createElement(NODE_TYPE.CELL,e),t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1))),t},firstChild:function(){var e,t,i=null,n={};if(this.dtNode&&(e=this.dtNode.children[0]))return t=e.type,"para"==t?i=editor.doc.createElement(NODE_TYPE.PARAGRAPH,e):"table"==t?(n.dtNode=e,i=editor.doc.createElement(NODE_TYPE.TABLE,n)):i="toc"==t?editor.doc.createElement(NODE_TYPE.TOC,e):editor.doc.createElement(t),i.setStart(e.getIndex()),i.setEnd(e.getEndIndex()+1),i},lastChild:function(){var e,t,i=null,n={};if(this.dtNode&&(e=this.dtNode.children[this.dtNode.children.length-1]))return t=e.type,"para"==t?i=editor.doc.createElement(NODE_TYPE.PARAGRAPH,e):"table"==t?(n.dtNode=e,i=editor.doc.createElement(NODE_TYPE.TABLE,n)):i="toc"==t?editor.doc.createElement(NODE_TYPE.TOC,e):editor.doc.createElement(t),i.setStart(e.getIndex()),i.setEnd(e.getEndIndex()+1),i},previousSibling:function(){var e,t=null;return this.dtNode&&(e=this.dtNode.prev,e&&(t=editor.doc.createElement(NODE_TYPE.CELL,e),t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1))),t},insert:function(e,t){var i,n=this.getStart(),o=UNICODE.CELL;t=t||DocUtil.copyStyle(editor.doc.getRawFormatAt(n-1));var r=ZWJSONUtils.getKeys(t),a={};a[ATTR_COMMON.TYPE]=NODE_TYPE.CELL,t&&t[ATTR_PARAGRAPH.PS_HD]&&parseInt(t[ATTR_PARAGRAPH.PS_HD])>=0&&(t[ATTR_PARAGRAPH.PS_TS]={},delete t[ATTR_PARAGRAPH.PS_HD]),arguments[0]&&(a=arguments[0]),Utils.addId(a,"cl-",4);var s=ZWJSONUtils.getKeys(a),l=Utils.randomString(),d=Utils.randomString();i=[{r:n},{as:{start:a,id:l}},{is:o},{as:{end:s,id:l}},{as:{start:t,id:d}},{is:UNICODE.PARA},{as:{end:r,id:d}}];var c=editor.doc.getTrackChangeDetails();c.setProcessingTC(!1),Op.processMsg(i),c.setProcessingTC(!0)},children:function(){var e,t,i,n,o,r,a=[],s={};if(this.dtNode)for(n=this.dtNode.children,e=0,t=n.length;e<t;e++)i=n[e],r=i.type,s={},"para"==r?(r=NODE_TYPE.PARAGRAPH,o=editor.doc.createElement(r,i)):"table"==r?(s.dtNode=i,o=editor.doc.createElement(r,s)):o="toc"==r?editor.doc.createElement(NODE_TYPE.TOC,i):editor.doc.createElement(r,i),o.setStart(i.getIndex()),o.setEnd(i.getEndIndex()+1),a.push(o);return a},parentNode:function(){var e,t=null,i={};if(this.dtNode)return e=this.dtNode.parent,i.dtNode=e,t=editor.doc.createElement(NODE_TYPE.ROW,i),t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1),t},select:t.select,remove:t.remove,getInnerTableIndexes:function(){for(var e=[],t=editor.doc.findNextIndexOf(UNICODE.TABLE,this.getStart());t!=-1&&t<this.getEnd();)e.push(t),t=editor.doc.findNextIndexOf(UNICODE.TABLE,t+1);return e;}}}function bookmarkElement(e,t,i){var n=new Element;return t||(t=Utils.randomString()),{getStart:n.getStart,getEnd:n.getEnd,setStart:n.setStart,setEnd:n.setEnd,type:e,id:t,name:i,attr:n.attr,nextSibling:n.nextSibling,previousSibling:n.previousSibling,parentNode:n.parentNode,firstChild:n.firstChild,lastChild:n.lastChild,select:n.select,insert:function(){var e=editor.doc.createElement(NODE_TYPE.TEXT),t=editor.doc.getSelection(),n=t.getTargetRange(),o=n.start,r=n.end;t.isCollapsed()||editor.doc.getCharAt(r-1)!=UNICODE.PARA||(r-=1),e.setStart(o),e.setEnd(r);var a={};a[ATTR_COMMON.TYPE]="text",e.attr(a),a={},a[ATTR_COMMON.TYPE]=NODE_TYPE.BOOKMARK,a[ATTR_COMMON.ID]=this.id,a[ATTR_COMMON.NAME]=i,t.surroundTextWith({char:UNICODE.RANGE_START,style:a},{char:UNICODE.RANGE_END,style:a},void 0,!0)},children:n.children,remove:function(){var e,t=this.getStart(),i=this.getEnd(),n=editor.doc.getContent(t,t+1),o=editor.doc.getContent(i-1,i);e=[{r:t},{ds:n},{r:i-t-2},{ds:o}],Op.processMsg(e)}}}function autofieldElement(e,t){var i=new Element;return t||(t=Utils.randomString()),{getStart:i.getStart,getEnd:i.getEnd,setStart:i.setStart,setEnd:i.setEnd,type:e,id:t,name:name,attr:i.attr,nextSibling:i.nextSibling,previousSibling:i.previousSibling,parentNode:i.parentNode,firstChild:i.firstChild,lastChild:i.lastChild,select:i.select,children:i.children,updateAllFileds:function(e,t){var i,n,o=0;for(i=this.getAllFields(e)||[],o=0,n=i.length;o<n;o++){if("autoformula"==e)t=DocUtil.copyStyle(editor.doc.getRawFormatAt(i[o].getStart()));else if("autodate"==e){var r=DocUtil.copyStyle(editor.doc.getRawFormatAt(i[o].getStart()));r.val=t?t.val:(new Date).getTime(),r[ATTR_AUTOFIELD.ISAUTO]=0,i[o].attr(r);continue}i[o].attr(t)}},getAllFields:function(e){for(var t,i=[],n=1,o=editor.doc.getDocumentLength(),r=DocUtil.getAllFieldsRanges(e,n,o),a=r.length,s=0;s<a;s++)t=editor.doc.createElement(NODE_TYPE.AUTOFIELD,{}),t.setStart(r[s].start),t.setEnd(r[s].end),i.push(t);return i}}}function FloatElement(e,t,i,n,o,r,a,s,l){var d=new Element;return t||(t=Utils.randomId(e)),{getStart:d.getStart,getEnd:d.getEnd,setStart:d.setStart,setEnd:d.setEnd,type:e,sectionId:t,section:null,setContent:function(t){this.section=editor.doc.createSection(e,t,this.sectionId,i,n,o,r,a,s,l)},attr:d.attr,nextSibling:d.nextSibling,previousSibling:d.previousSibling,parentNode:d.parentNode,firstChild:function(){var e=editor.doc.findNextIndexOf(UNICODE.PARA+"|"+UNICODE.TABLE,this.section.getStart());if(editor.doc.getCharAt(e)==UNICODE.PARA){var t=editor.doc.createElement(NODE_TYPE.PARAGRAPH,{});t.setStart(e);var i=editor.doc.findNextIndexOf(UNICODE.PARA+"|"+UNICODE.TABLE+"|"+UNICODE.SECTION_START,t.getStart()+1);return i<0&&(i=editor.doc.getSectionEnd(e)),t.setEnd(i),t}var n=editor.doc.createElement(NODE_TYPE.TABLE,{});n.setStart(e);var o=TableUtil.getTableEnd(this.section.getStart());return n.setEnd(o),n},lastChild:d.lastChild,select:d.select,insert:function(t){if(e==NODE_TYPE.FOOTNOTE||e==NODE_TYPE.ENDNOTE){var i=editor.doc.createElement(NODE_TYPE.TEXT,"#"),n=editor.doc.getSelection().getStart(),o=DocUtil.getTextStyle(n),r=o[ATTR_TEXT.TS_SIZE];r||(r=editor.doc.getFontSize(0));var a={};a[ATTR_COMMON.TYPE]="text",a[ATTR_COMMON.CLS]=e,a[ATTR_TEXT.TS_SIZE]=r,a[ATTR_COMMON.ID]=this.sectionId,i.css=a;var s={char:UNICODE.RANGE_START,style:{type:e,id:this.sectionId}},l={char:UNICODE.RANGE_END,style:{type:e,id:this.sectionId}};editor.doc.getSelection().surroundAndInsert(s,l,i)}else{var c=editor.doc.getSelection().getStart(),u=editor.doc.getSelection().getEnd(),p={sid:this.sectionId};d.isInserted=!0,this.setStart(c),this.setEnd(u),this.attr(p)}this.section.insert(t)},modify:function(e){if(this.type==NODE_TYPE.FOOTNOTE||this.type==NODE_TYPE.ENDNOTE){var t=this.getStart(),i=this.getEnd(),n=this.section.getStart()-i,o=editor.doc.getContent(t+1,i-1).length,r=d.getStyleOp({type:e}),a=d.getStyleOp({type:e}),s=d.getStyleOp({cls:e,type:"text"}),l=d.getStyleOp({st:e,type:"section"});msg=[{r:t},r.as_start,{r:1},r.as_end,s.as_start,{r:o},s.as_end,a.as_start,{r:1},a.as_end,{r:n},l.as_start,{r:1},l.as_end],Op.processMsg(msg)}},children:d.children,remove:function(){var e;this.section.secId;this.section.remove();var t=this.getStart(),i=this.getEnd();if("endnote"==this.type||"footnote"==this.type){var n=editor.doc.createElement(NODE_TYPE.TEXT);n.setStart(this.getStart()+1),n.setEnd(this.getEnd()-1),n.remove(),editor.doc.getTrackChangeDetails().setProcessingContentDeletion(!0)}var o=editor.doc.getContent(t,t+1),r=editor.doc.getContent(i-1,i);e=[{r:t},{ds:o},{r:i-t-2},{ds:r}],Op.processMsg(e),"endnote"!=this.type&&"footnote"!=this.type||editor.doc.getTrackChangeDetails().setProcessingContentDeletion(!1)}}}function placeholderElement(e,t){var i=new Element;return t||(t=Utils.randomString()),{getStart:i.getStart,getEnd:i.getEnd,setStart:i.setStart,setEnd:i.setEnd,type:e,id:t,name:name,attr:i.attr,nextSibling:i.nextSibling,previousSibling:i.previousSibling,parentNode:i.parentNode,firstChild:i.firstChild,lastChild:i.lastChild,select:i.select,children:i.children}}function Toc(e){var t=new Element;return{getStart:t.getStart,getEnd:t.getEnd,setStart:t.setStart,setEnd:t.setEnd,type:NODE_TYPE.TOC,dtNode:e?e:null,attr:t.attr,remove:t.remove,select:t.select,insert:function(){},firstChild:function(){var e,t,i=null;return this.dtNode&&(e=this.dtNode.children[0],e&&(t=e.type,"para"==t))?(i=editor.doc.createElement(NODE_TYPE.PARAGRAPH,e),i.setStart(e.getIndex()),i.setEnd(e.getEndIndex()+1),i):null},lastChild:function(){var e,t,i=null;return this.dtNode&&(e=this.dtNode.children[this.dtNode.children.length-1],e&&(t=e.type,"para"==t))?(i=editor.doc.createElement(NODE_TYPE.PARAGRAPH,e),i.setStart(e.getIndex()),i.setEnd(e.getEndIndex()+1),i):null},nextSibling:function(){var e=null;return this.dtNode&&(next=this.dtNode.next,next&&"para"==next.type)?(e=editor.doc.createElement(NODE_TYPE.PARAGRAPH,next),e.setStart(next.getIndex()),e.setEnd(next.getEndIndex()+1),e):null},previousSibling:function(){var e,t=null;return this.dtNode&&(e=this.dtNode.prev,e&&"para"==e.type&&(t=editor.doc.createElement(NODE_TYPE.PARAGRAPH,e),t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1))),t},parentNode:function(){if(this.dtNode){var e,t,i=null;if(e=this.dtNode.parent)return t=e.type,"section"==t?i=editor.doc.createElement(NODE_TYPE.BODY):"cell"==t&&(i=editor.doc.createElement(NODE_TYPE.CELL,e)),i&&(i.setStart(e.getIndex()),i.setEnd(e.getEndIndex()+1)),i}return null},children:function(){var e,t,i,n,o,r,a=[];if(this.dtNode)for(n=this.dtNode.children,e=0,t=n.length;e<t;e++)i=n[e],r=i.type,"para"==r&&(r=NODE_TYPE.PARAGRAPH,o=editor.doc.createElement(r,i),o.setStart(i.getIndex()),o.setEnd(i.getEndIndex()+1),a.push(o));return a}}}function Op(){}function loadDocument(e){var t={};t.content=e,t.info=editor.doc.docInfo,editor.loadDocument(t)}function applyOps(e){var t,i,n=eval,o=console;for(var r in e)o.log("OP:::",t=n(e[r].op)),i=DocOpBuilder.build(t),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),i.applyTo(),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}function Replace(){}function Indentation(){}function WebUtil(){}function Scale(e){this.id=e.id||"scale"+(Math.random().toString(36).substr(2)+Date.now()),this.unit=e.unit||RULER_UNITS.INCH,this.type=e.type||SCALE_TYPE.REGULAR,this.orientation=e.orientation||ORIENTATION.HORIZONTAL,this.unitProps=e.unitProps||UNIT_PROPS,this.width=e.width||"100%",this.height=e.height||"100%",this.zoomFactor=e.zoomFactor||1,this.maxWidth=e.maxWidth,this.maxHeight=e.maxHeight,this.viewProps=e.viewProps||{},this.view=new ScaleView(this)}function ScaleView(e){this.scale=e,this.scaleContainer=document.createElement("div"),this.scaleContainer.id=this.scale.id,this.updateWidth(),this.updateHeight(),this.styleTag=document.createElement("style"),this.styleTag.type="text/css",this.contructScale(),this.scale.viewProps.parent&&this.attach()}function RulerCustomObject(e){this.id=e.id||"",this.width=e.width||"100%",this.height=e.height||"100%",this.classStr=e.classStr||"",this.createContent(),e.parent&&this.attachTo(e.parent)}function RulerElement(e){this.id=e.id||"element"+(Math.random().toString(36).substr(2)+Date.now()),this.ruler=e.rulerInstance,this.orientation=e.orientation||ORIENTATION.HORIZONTAL,this.priority=e.priority||1,this.align=e.align||RULER_ALIGN.FRONT,this.zoomFactor=e.zoomFactor||1,this.shouldHandleEvent=e.shouldHandleEvent||!1,this.eventProps=e.eventProps||{},this.isDraggable=e.isDraggable||!1,this.hideOutOfDragRect=e.hideOutOfDragRect||!1,this.dragRect=e.dragRect||{},this.actualValue=e.actualValue,this.resizableOption=e.resizableOption||RESIZABLE_TYPE.NONE,this.resizeMarginRatio=e.resizeMarginRatio||0,this.updateOnMouseMove=e.updateOnMouseMove||!1,this.title=e.title||"",this.computationFactor=e.computationFactor||PROCESSING_TYPE.REGULAR,this.setWidth(e.width),this.setHeight(e.height);var t=this.orientation===ORIENTATION.HORIZONTAL?this.width:this.height;this.setMinSize(e.minSize||t),this.setMaxSize(e.maxSize||t),this.setOffset(e.offset),this.viewProps=e.viewProps||{},this.view=new RulerElementView(this)}function TableResizeElement(e){RulerElement.call(this,e),this.view.getWidth=function(){return this.element.widthInPx},this.view.getHeight=function(){return this.element.heightInPx},this.view.getOffset=function(){var e=this.element.offset.top,t=this.element.offset.left,i=RulerUtil.getDeltaRelativeToAlignment(this.element.sizeInPx,this.element.align);return this.element.orientation==ORIENTATION.HORIZONTAL?(t*=this.element.zoomFactor,t-=i.start):(e*=this.element.zoomFactor,e-=i.start),{left:t,top:e}}}function TabPointElement(e){RulerElement.call(this,e),this.view.getWidth=function(){return this.element.widthInPx},this.view.getHeight=function(){return this.element.heightInPx},this.view.getOffset=function(){var e=this.element.offset.top,t=this.element.offset.left,i=RulerUtil.getDeltaRelativeToAlignment(this.element.sizeInPx,this.element.align);return this.element.orientation==ORIENTATION.HORIZONTAL?(t*=this.element.zoomFactor,t-=i.start):(e*=this.element.zoomFactor,e-=i.start),{left:t,top:e}}}function IndentElement(e){RulerElement.call(this,e),this.view.getWidth=function(){return this.element.widthInPx},this.view.getHeight=function(){return this.element.heightInPx},this.view.getOffset=function(){var e=this.element.offset.top,t=this.element.offset.left,i=RulerUtil.getDeltaRelativeToAlignment(this.element.sizeInPx,this.element.align);return this.element.orientation==ORIENTATION.HORIZONTAL?(t*=this.element.zoomFactor,t-=i.start):(e*=this.element.zoomFactor,e-=i.start),{left:t,top:e}}}function RulerElementView(e){this.element=e,this.elementNode=document.createElement("div"),this.elementNode.style.position="absolute",this.elementNode.id=this.element.id}function RulerEvtHandler(e){this.ruler=e,this.eventNode=document.createElement("div"),this.lineNode=document.createElement("div"),this.eventNode.className="ui-event-div unselectable ",this.lineNode.className="ui-line-div",this.ruler.container.appendChild(this.eventNode),this.ruler.container.appendChild(this.lineNode),this.ruler.viewProps.context&&this.eventNode.setAttribute("data-context",this.ruler.viewProps.context),this.mouseDownHandler=this.mouseDownHandler.bind(this),this.mouseUpHandler=this.mouseUpHandler.bind(this),this.mouseMoveHandler=this.mouseMoveHandler.bind(this),this.mouseOutHandler=this.mouseOutHandler.bind(this),this.bindEvents()}function Ruler(e){this.id=e.id||"ruler"+(Math.random().toString(36).substr(2)+Date.now()),this.unit=e.unit||RULER_UNITS.INCH,this.direction=e.direction||DIRECTION.LEFT_TO_RIGHT,this.orientation=e.orientation||ORIENTATION.HORIZONTAL,this.setWidth(e.width),this.setHeight(e.height),this.setZoomFactor(e.zoomFactor),this.viewProps=e.viewProps||{},this.view=new RulerView(this),this.updateRect(),this.setInteractable(e.isInteractable),this.elements={}}function RulerView(e){this.ruler=e,this.ruler.container=document.createElement("div"),this.ruler.container.id=this.ruler.id,this.ruler.container.className=this.ruler.viewProps.classStr||"",this.updateWidth(),this.updateHeight(),this.ruler.viewProps.parent&&this.attach()}function ZWRuler(e){Ruler.call(this,e),this.setRoundingFactor(),this.layoutProps={},this.computedMargins={},this.computedColProps={columnArea:[],columnSpace:[]},this.affectedElements={},this.setRulerLayoutProps(e.layoutProps),this.createScales()}function BookmarkDialog(){var e=this;Utils.WriterCallbacks.register("onmenuhide",function(){return!e.isGetLinkDialogueOpened}),PubSub.subscribe("Document/ComponentInitialized",function(){var e=ZWJSONUtils.getKeys(editor.bookmarks),t=J("#view-lpnl-hideshowbookmark");e.length||t.ztoggleswitch().enable();var i=UIUtils.isShowBookmark();J("#view-lpnl-hideshowbookmark").ztoggleswitch(i?"switchOn":"switchOff"),e.length||t.ztoggleswitch().disable()})}function CollabPanelHandler(){}function DocRoll(){}function Imagelibrary(){this.newattr={},this.isImageList=!1}function InsertSpl(){}function ReplaceDialog(){}function Settings(){}function ShowInfo(){}function ParagraphPanel(){}function GoToDialogue(){}function carousel(){}function InsertShape(){}function ShapePaste(){}extend(editor,{unBindEvents:function(){Mousetrap.reset(document.getElementById("editorpane")),editor.jeditorPane.off();var e=editor.jeditorPane[0];e.onkeydown=e.onkeyup=e.onkeypress=e.onpaste=null,e.ownerDocument.removeEventListener("compositionstart",EventHandler.handleCompositionStart,!0),e.ownerDocument.removeEventListener("compositionupdate",EventHandler.handleCompositionUpdate,!1),e.ownerDocument.removeEventListener("compositionend",EventHandler.handleCompositionEnd,!1),e.ownerDocument.removeEventListener("textInput",EventHandler.handleTextInput,!1)},bindEvents:function(){UIUtils.initDocumentMenu(),editor.jeditorPane.on("mousedown",".ui-edit-icon-btn",function(e){J(this).css("display","none");var t=editor.doc.getRawFormatAt(editor.doc.getSelection().getStart()),i=t.hasOwnProperty(ATTR_WIDGET.SHEET_INFO)?SheetOperation.getSheetURL(t[ATTR_WIDGET.SHEET_INFO].rid):t[ATTR_WIDGET.SRC];return Utils.safeWindowOpen(i),e.stopPropagation(),!1}),editor.jeditorPane.on("dblclick","div.ui-page-collapse-div ,span.js-collpse-span",function(e){DocLayoutManager.toggleFixedView();var t=W(this).parents(".zw-page")[0],i=DomViewManager.getViewData(t).docViewId,n=DocLayoutManager.getPageWithId(i);return UIUtils.setEditorPaneWrapperHeight(!0),UIUtils.gotoPage(n.getAbsolutePageNumber(),!0),e.preventDefault(),!1}),editor.jeditorPane.on("click",".autodocname , .autoauthor , .autodocversion ",function(e){if(!J(e.target).closestParent(".unselectableSection")[0]&&editor.getRole().permissions.can("document.edit")&&!Macros.isRemote()){var t=this,i=J("#updatefieldmenu"),n=editor.doc.getRawFormatAt(editor.doc.getSelection().getStart());n&&n.type==NODE_TYPE.AUTOFIELD&&i[0]&&UIUtils.showDocumentFieldUpdateMenu(t)}});var e,t=!1;editor.jeditorPane.on("touchstart touchend touchmove mousedown mouseup mousemove",function(i){CurUtil.setFloatingCursor(!1);var n=i.type;if("touchstart"!=n&&"touchend"!=n&&"touchmove"!=n)return EventHandler.shouldDrawHandlers(!1),editor.mouseEventHandler(i.originalEvent);if(CurUtil.setFloatingCursor(!0),EventHandler.shouldDrawHandlers(!0),editor.mouseEventHandler(i.originalEvent),"touchstart"===i.type){var o=i.timeStamp,r=J(this).data("lastTouch")||o,a=o-r;if(J(this).data("lastTouch",o),e=i.type,t=!0,a&&a>600)return}else if("touchmove"===i.type){if(e=i.type,t=!1,i.originalEvent.target.classList.contains("handler-callout"))return void i.preventDefault()}else"touchend"===i.type&&(t&&i.preventDefault(),t=!1,e=i.type)}),editor.browserInfo.isWebkit&&(document.onmouseup=function(e){if(3!=e.which&&!EventHandler.isMenuOpened&&!EventHandler.isDialogOpened&&editor.getRole().permissions.can("document.edit")&&!EventHandler.mouseUpDone){var t=0,i=Utils.getCorrectedCoord(e),n=editor.doc.getSelection(),o=n.getLastRange();if(editor.imgDrag)return!1;if(0!=J(e.target).parents("div.shape_box").length)t=o.start,EventHandler.mouseUpDone=!0,o.setEnd(t);else{EventHandler.mouseDown=!1;var r=Math.abs(i.x-EventHandler.mouseDown_coord.x),a=Math.abs(i.y-EventHandler.mouseDown_coord.y);r<a&&(EventHandler.mouseDown_coord.y>i.y?(t=editor.doc.getSectionStart(o.start)+1,o.setStart(t),o.setEnd(EventHandler.mouseDown_coord.idx)):(t=n.getParents(NODE_TYPE.SECTION).getEnd()-1,n.setLastModifiedPosition("end"),o.setEnd(t)))}EventHandler.mouseUpDone=!0,n.removeAllRanges().addRange(o),EditorUtil.focusMultiByteSpan()}}),window.onblur=function(e){2==e.eventPhase&&CurUtil.stopBlinking()},J(document.body).on("click",function(e){var t=e.target;t&&J(t).parents("#editorpane,#toolbarContainer,div.ui-zcolorpalette-shaded-container,.ui-zcolorpalette-colors-container")[0]||CurUtil.stopBlinking()});var i=editor.jeditorPane[0];i.onkeydown=i.onkeyup=editor.keyEventHandler,i.oncopy=CopyEventHandler.onCopy,i.oncut=CopyEventHandler.onCut,i.onpaste=PasteEventHandler.handlePasteEvent,editor.getRole().permissions.can("document.edit")&&(i.onkeypress=editor.keyEventHandler,i.ondragenter=i.ondragleave=i.ondragstart=i.ondrop=i.ondragover=editor.mouseEventHandler,i.ownerDocument.addEventListener("compositionstart",EventHandler.handleCompositionStart,!0),i.ownerDocument.addEventListener("compositionupdate",EventHandler.handleCompositionUpdate,!1),i.ownerDocument.addEventListener("compositionend",EventHandler.handleCompositionEnd,!1),i.ownerDocument.addEventListener("textInput",EventHandler.handleTextInput,!1)),KeyBoardShortCuts.init()},keyEventHandler:function(e){var t=e,i=t.target,n=(J(i),!1),o=t.type,r=t.charCode,a=t.keyCode,s=t.shiftKey,l=t.ctrlKey,d=t.metaKey,c=t.altKey,u=t.key||t.keyIdentifier,p=t.repeat||!1,g=a>=48&&a<=57,f=a>=37&&a<=40;EventHandler.isOnlyCtrlKeyPressed=!1,this.currentCommand=COMMAND.ANY;var E=editor.doc.getSelection();if("keydown"==o){var T=Macros.handleBeforeKeydown(t);if(0==T)return DomUtil.stopEvent(t),!1;if(EventHandler.isOnlyCtrlKeyPressed=!c&&!s&&(editor.browserInfo.is_mac?!l&&d&&"Meta"==u:l&&"Control"==u),editor.keyPressTriggered=!1,PubSub.publish("Document/BeforeKeyDown",a),EventHandler.isNonCharKey=16==a||17==a||18==a||91==a||93==a||27==a||20==a||45==a||112<=a&&a<=130,a!=KEYS.TAB&&a!=KEYS.ENTER&&WordComplete.removeSuggestion(),editor.getRole().permissions.can("document.edit")&&TransLiteration_EventHandler.isTransliterationEnabled()){if(EventHandler.multiByteTyping&&f)return J("#transliterationOptions").zmenu("getElement").focus(),!1;if(a==KEYS.DELETE||a==KEYS.SPACE||a==KEYS.ENTER||a==KEYS.TAB||g||d||c||l){if(EventHandler.multiByteTyping){var m=TransLiteration_EventHandler.getCompositionEndEvent(t);return m.data=m.detail.data,EventHandler.handleCompositionEnd(m),editor.jMbSpan_editableSpan.innerHTML="&nbsp;",n=!0,!1}}else if(TransLiteration_EventHandler.isAllowedKeyCode(a)){if(!d){if(EventHandler.multiByteTyping){var h=TransLiteration_EventHandler.getCompositionUpdateEvent(t);if(h.data&&h.detail.data)EventHandler.handleCompositionUpdate(h);else{var m=h;m.data=m.detail.data,EventHandler.handleCompositionEnd(m),editor.jMbSpan_editableSpan.innerHTML="&nbsp;"}return n=!0,!1}if(a!=KEYS.BACKSPACE&&a!=KEYS.TAB){E.isCollapsed()||(editor.doc.execCmd("delete","nextchar"),UIUtils.playSound("normalKey"));var I=TransLiteration_EventHandler.getCompositionStartEvent(t);return EventHandler.handleCompositionStart(I),n=!0,!1}}}else if(a==KEYS.SHIFT||a==KEYS.CAPS)return n=!0,!1}if(229==a){document.activeElement;return EventHandler.multiByteTyping?(EventHandler.multiByteTyping=!0,!0):(CurUtil.stopBlinking(),E.isCollapsed()||(editor.doc.execCmd("delete","nextchar"),UIUtils.playSound("normalKey")),!0)}editor.isCompositionEnd=!1,n=EventHandler.handleKeyDown(t),editor.doc.isHighLighterOn&&(editor.doc.isHighLighterOn=!1,editor.jeditorPane.children(".zw-page").css("cursor",""),J("#fmt-lpnl-bgcolor").removeClass("ui-highlight-active")),t.shiftKey&&p||PubSub.publish("Editor/KeyDown",t)}else if("keypress"==o){if(EventHandler.multiByteTyping)return!0;if(!(d||!editor.browserInfo.isWebkit&&l||a==KEYS.ENTER||0==r||l&&s)){var _=String.fromCharCode(a);if(editor.browserInfo.isGecko&&(_=String.fromCharCode(r)),parseInt(w_usersettings[ATTR_BODY.DS_AUTOSMARTQUOTES])){var A=" \t\r[({ "+[UNICODE.IMAGE,UNICODE.IFRAME].join(""),S=new RegExp("["+A+"]","g");if(34===a||34===r){var R=RegExp(CONT_REGEXP.PARASTART),O=editor.doc.getCharAt(E.getStart()-1);_=S.test(O)||R.test(O)?"“":"”"}else if(39===a||39===r){var R=RegExp(CONT_REGEXP.PARASTART),O=editor.doc.getCharAt(E.getStart()-1);_=S.test(O)||R.test(O)?"‘":"’"}}if(!EditorUtil.isTypingAllowedOnKeypress())return DomUtil.stopEvent(t),!1;editor.addChar(_,t),32===a?UIUtils.playSound("spaceKey"):13!==a&&UIUtils.playSound("normalKey"),32==a||32==r?Utils.afterSpaceOperations(_):editor.doc.collabUsers.length>0||!parseInt(w_usersettings[ATTR_BODY.DS_AUTOCOMPLETE])||WordComplete.lookupWord(),PubSub.publish("Selection/updateClientLeft"),editor.keyPressTriggered=!0,n=!0}}else if("keyup"==o){if(EventHandler.multiByteTyping)return!0;(editor.browserInfo.is_mac||editor.browserInfo.is_windows&&editor.keyPressTriggered||editor.browserInfo.is_windows&&!editor.keyPressTriggered&&(!l||!c))&&(n=!0)}if(n)return DomUtil.stopEvent(t),!1},addChar:function(e,t){EditorUtil.addChar(e,t)},rebindEvents:function(e){editor.unBindEvents(),editor.setPermission(e||editorProps.permissionsInfo.permissions),editor.bindEvents()}}),ZWCollaboration.resetMutationResendCount=function(){ZWCollaboration.mutationResendCount=0;var e=editor.doc.docInfo;ZWCollaboration.MUTATION_SEND_VERSION=e.VERSION,ZWCollaboration.MUTATION_SEND_REVISION=e.REVISION,ZWCollaboration.LASTREQUEST_TIMESTAMP=(new Date).getTime()},PubSub.subscribe("MessageQueue/AckReceived",ZWCollaboration.resetMutationResendCount),ZWCollaboration.getWMSSessionId=function(){return encodeURIComponent(WebMessanger.getSid())},ZWCollaboration.getWMSRawSessionId=function(){return WebMessanger.getRawSid()?encodeURIComponent(WebMessanger.getRawSid()):void 0},ZWCollaboration.addToQueue=function(e){if(ZWOfflineLogger.log("Add to Queue invoked"),ZWCollaboration.msgQueue.isAckPending()&&!editor.isOffline()){var t=(new Date).getTime();t-ZWCollaboration.LASTREQUEST_TIMESTAMP>ZWCollaboration.SERVER_SLOW_RESPONSE_TIMEOUT+6e4&&(ZWLogger.log("Slow Response"),ZWOfflineLogger.log("slow response"),PubSub.publish("Document/Warning",WARNING_MSG.SERVER_BUSY),ZWCollaboration.LASTREQUEST_TIMESTAMP=t)}return e?void ZWCollaboration.msgQueue.add(e):void ZWLogger.log("Empty Edits")},ZWCollaboration.resendMutation=function(){if(ZWCollaboration.msgQueue.isAckPending()){if(!ZWOffline.isOfflineOperationsAllowed()){if(ZWCollaboration.mutationResendCount>=ZWCollaboration.MUTATIONRESEND_MAXCOUNT)return ZWOfflineLogger.log("ACK103 - resend mutation invoked more than 3 times"),ZWCollaboration.mutationResendCount=0,void PubSub.publish("Document/Error",{title:"TITLE_SERVER_BUSY",errorNo:ZWCollaboration.RESENDMUTATION_LOOP_ERROR,errorMsg:"MSG_SERVER_BUSY"});ZWCollaboration.mutationResendCount++}ZWOfflineLogger.log("ResendMutation invoked"),ZWCollaboration.sendMessage(ZWCollaboration.handleSendMutationSuccess,ZWCollaboration.handleSendMutationError)}},ZWCollaboration.sendCursorMutation=function(){ZWCollaboration.msgQueue.isAckPending()||editor.isOffline()||ZWCollaboration.sendMessage()},ZWCollaboration.sendPendingMutation=function(){return ZWCollaboration.msgQueue.isAckPending()||editor.isOffline()?ZWCollaboration.RESULT_ACK_PENDING:ZWCollaboration.stopUpdates?ZWCollaboration.RESULT_SEND_STOPPED:(ZWOfflineLogger.log("sendpendingmutation invoked"),ZWCollaboration.msgQueue.shift(),PubSub.publish("Document/MsgQueue/Shifted"),ZWCollaboration.msgQueue.isAckPending()?ZWCollaboration.sendMessage(ZWCollaboration.handleSendMutationSuccess,ZWCollaboration.handleSendMutationError):(ZWOfflineLogger.log("No op to send"),ZWCollaboration.RESULT_NOTHING_TO_SEND))},ZWCollaboration.sendMessage=function(e,t){ZWOfflineLogger.log("sendMessage invoked");var i={},n=editor.doc.docInfo,o=!1;if(ZWCollaboration.msgQueue.isAckPending()){ZWOfflineLogger.log("Ackpending edit sent"),isV8Engine||PubSub.publish("Document/SaveStatus",isV8Engine?"":J.i18n("common","SAVING"));var r=ZWCollaboration.msgQueue.getAckPendingEdit();ZWLogger.log("DOC OP IDS  :::::: "+r.op.docOpIds),i.ops=r.op.toString(),i.mc=r.mc,i.sid=r.sid;var a=r.op.toProtoString();o=i.ops.length>75e3,ZWLogger.log("sendMutation |  OP STR :: "+a);var s=Op.getLastOperationSequence();s&&s.length&&(i.lastoperations=s)}else{var l=editor.getCursorOp();l&&(i.mc=l),i.sid=editor.uuid}var d="update",c=editor.getRole().permissions;c.can("document.edit")||(c.can("review.comment.add")?d="commentop":c.can("document.fill")&&(d="fillop"));var u=ZWNetworkUtils.getUrl(d);i.version=n.VERSION,i.revision=n.REVISION,n.VERSION_ID&&(i.versionid=n.VERSION_ID),i.reqId=ZWCollaboration.reqId++,i.tstamp=(new Date).getTime(),Macros.includeParamsForStats(i),1===n.VERSION&&0===n.REVISION&&(Macros.isRemote()&&"commentop"===d||(i.docsFolderId=docsFolderId)),Macros.updatePartnerSaveStatus(!1),ZWCollaboration.MUTATION_SEND_VERSION=n.VERSION,ZWCollaboration.MUTATION_SEND_REVISION=n.REVISION,ZWCollaboration.LASTREQUEST_TIMESTAMP=(new Date).getTime();var p={type:"POST",dataType:"json",global:!1,timeout:ZWCollaboration.SERVER_SLOW_RESPONSE_TIMEOUT,url:u,error:t,success:e,setCsrfParam:!0,data:i};if(isV8Engine)p.isBulkOp=o;else if(("update"==d||"fillupdate"==d)&&o){var g=new FormData,f=new Blob([i.ops],{type:"text/plain"});delete i.ops;for(var E in i)g.append(E,i[E]);g.append("opsfile",f),p.isMultiPartReq=!0,p.data=g,p.enctype="multipart/form-data;",p.contentType=!1,p.processData=!1}return ZWNetworkUtils.sendAjax(p),ZWCollaboration.RESULT_SUCCESS},ZWCollaboration.handleSendMutationError=function(e,t,i){ZWOfflineLogger.log("Mutation send Error"),ZWLogger.log("handleSendMutationError"+e.status+","+t),PubSub.publish("Document/Mutation/SendError",e)},ZWCollaboration.handleSendMutationSuccess=function(e){if(ZWOfflineLogger.log("Mutation send success"),!e)return void ZWCollaboration.checkForResend();var t=e.UPDATE;switch(ZWLogger.log("MutationSuccessResponse:"+JSON.stringify(e)),PubSub.publish("Document/Mutation/SendSuccess",t,e),t){case"SUCCESS":DocInfo.setProperty({newDoc:!1}),ZWCollaboration.syncSent||(MsgHandler.processAcknowledgement(e),Lock.updateLockStatus());break;case"SAMEVERSIONREVISION":return void ZWCollaboration.checkForResend();case"FAILED":return void ZWCollaboration.handleUpdateFailure(ZWCollaboration.SERVER_EXCEPTION);case"OPUPDATEFAILED_INLOCKSTATE":return void PubSub.publish("Collaboration/LockReceived");case"RESEND":return void ZWCollaboration.resendMutation();case"CHECKEDOUT":return void PubSub.publish("Document/SaveStatus",!1,void 0);case"SAVE_FAILURE":return void ZWCollaboration.handleUpdateFailure(ZWCollaboration.SERVER_EXCEPTION);case"REDIS_VERSION_MISMATCH":return void ZWCollaboration.handleUpdateFailure(ZWCollaboration.REDIS_EXCEPTION);case"REMOTE_TRASH":return void PubSub.publish("Document/RemoteTrashed");case"RESOURCE_TRASHED":return void PubSub.publish("Document/Trashed",editor.doc.docInfo.CREATOR_ZUID);case"READ_ONLY_USER":return void PubSub.publish("Document/unauthorizededit");case"PERMISSIONDENIED_FOR_LOCK":return void PubSub.publish("Collaboration/LockNotAllowed");case"INVALID_VERSIONID":return void UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD_RELOAD"),J.i18n("common","ALERT"),"info",editor.reloadDocumentContent,!0);case"PERMISSIONDENIED_FOR_UNLOCK":return void PubSub.publish("Collaboration/UnlockNotAllowed");default:var i=ZWCollaboration.UNHANDLED_MUTATION_RESPONSE;ZWLogger.sendErrorDetails(i+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+i+" DOC len ="+editor.doc.getDocumentLength()+" Cur St ="+editor.doc.getSelection().getStart()+" Cur end="+editor.doc.getSelection().getEnd()+" MsgQueue = "+ZWCollaboration.msgQueue.toString()+" buildLabel::: "+buildLabel+"\nError Log End \n<ZWERROR>UNHANDLED MUTATION RESPONSE :::"+JSON.stringify(t))}},ZWCollaboration.handleUpdateFailure=function(e){if(isV8Engine||editor.rebindEvents(COLLAB_PERMISSION),PubSub.publish("Document/SaveStatus",!1,J.i18n("writer.common.SAVE_FAILURE")),ZWOffline.isOfflineOperationsAllowed()){ZWOfflineLogger.log("SaveFailure occured.");var t=ZWCollaboration.msgQueue.getPendingEditsCount();if(t>1){var i={errorCode:e};OfflineImpl.handleSaveAsNew(i,!0)}else OfflineImpl.handleSaveFailure().always(function(){PubSub.publish("Document/Error",{title:"OOPS",errorNo:e,errorMsg:"MSG_EDIT_ERROR"})})}else PubSub.publish("Document/Error",{title:"OOPS",errorNo:e,errorMsg:"MSG_EDIT_ERROR"})},ZWCollaboration.handleRenameSaveSuccess=function(e){DocInfo.setProperty({newDoc:!1})},ZWCollaboration.checkForResend=function(){if(!ZWCollaboration.msgQueue.isAckPending())return void(ZWCollaboration.msgQueue.isOpQueued()&&ZWCollaboration.sendPendingMutation());if(ZWOfflineLogger.log("checkForResend invoked"),!ZWOffline.isOfflineOperationsAllowed()){if(!(ZWCollaboration.checkForResendCount<ZWCollaboration.SERVERCHECK_MAXCOUNT))return UIUtils.UnfreezeEditor(),ZWCollaboration.checkForResendCount=0,void PubSub.publish("Document/Error",{title:"TITLE_SERVER_BUSY",errorNo:ZWCollaboration.CHECKFORRESEND_LOOP_ERROR,errorMsg:"MSG_SERVER_BUSY"});ZWCollaboration.checkForResendCount++}ZWLogger.log("CheckForResend"+ZWCollaboration.MUTATION_SEND_VERSION+"."+ZWCollaboration.MUTATION_SEND_REVISION);var e={};e.sid=editor.uuid,e.version=ZWCollaboration.MUTATION_SEND_VERSION,e.revision=ZWCollaboration.MUTATION_SEND_REVISION,e.tstamp=(new Date).getTime(),Macros.includeParamsForStats(e);var t=ZWNetworkUtils.getUrl("resendVerify"),i=function(e,t,i){isV8Engine||UIUtils.UnfreezeEditor();var n=e.getResponseHeader("Content-Type"),o=e.responseJSON||{};if(200==e.status&&n.toLowerCase().indexOf("text/html")>=0)PubSub.publish("User/SignedOut");else if("RELOAD"==o.RESPONSE)PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.RESENDVERIFY_RELOAD_EXCEPTION,errorMsg:"MSG_EDIT_ERROR"});else{if("REMOTE_TRASH"!=o.RESPONSE)return void PubSub.publish("System/NetworkFailure");PubSub.publish("Document/RemoteTrashed")}},n=function(e){if(e){if(isV8Engine||UIUtils.UnfreezeEditor(),ZWCollaboration.stopUpdates=!1,ZWCollaboration.checkForResendCount=0,"RESEND"==e.RESPONSE)return void ZWCollaboration.resendMutation();if("NORESEND"===e.RESPONSE)return void ZWCollaboration.checkServerVersion();"RELOAD"==e.RESPONSE?PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.RESENDVERIFY_RELOAD_EXCEPTION,errorMsg:"MSG_EDIT_ERROR"}):"REMOTE_TRASH"==e.RESPONSE&&PubSub.publish("Document/RemoteTrashed")}else setTimeout(ZWCollaboration.checkForResend,ZWCollaboration.SYNC_TIMER)},o={};o.data=e,o.type="POST",o.dataType="json",o.global=!1,o.url=t,o.setCsrfParam=!0,o.timeout=ZWCollaboration.SERVER_SLOW_RESPONSE_TIMEOUT,o.error=i,o.success=n,ZWNetworkUtils.sendAjax(o)},ZWCollaboration.applyCollaboratorsMutation=function(e,t,i,n,o,r,a){if(e){var s=DocOpBuilder.clone(e),l=ZWCollaboration.msgQueue.xformQueue(e),d=e.redactContent;if(o){var c,u,p=l.getCursorPos()[0];if(c=p.start>0?p.start:p.end,u=p.end?p.end:p.start,editor.doc.getTrackChangeDetails().isNoMarkupON()&&!isV8Engine){var g=TcNoMarkupHandler.processServerToClientCursorOp(c,u);c=g.start,u=g.end}else if(HiddenRangesHandler.hasHiddenRangeOps()&&!isV8Engine){var g=HiddenRangesHandler.processServerToClientCursorOp(c,u);c=g.start,u=g.end}var f=DocLayoutManager.getLineAtIndex(c),E=DocLayoutManager.getLineAtIndex(u);if(!(isV8Engine||f&&E))return editor.doc.setDomCursorIdx(i,"start",c),void editor.doc.setDomCursorIdx(i,"end",u);if(a=a||0,!editor.doc.domCursor[i]&&!isV8Engine)return void ZWLogger.log("@applyCollaboratorsMutation: There is no domCursor for\n"+i);var T=editor.doc.getSelection(i)||editor.doc.createSelection(i);0==a&&T.removeAllRanges(),T.showCaret(editor.doc.createRange(c,u,i)),PubSub.publish("Cursor/showCollbUserName",i),PubSub.publish("Collaboration/UserCursor",{sid:i,start:c,end:u})}else{l.zuid=n||"collabop",editor.currentCommand=COMMAND.ANY,editor.doc.snapShotManager&&editor.doc.snapShotManager.flushTypedCharOps(),editor.doc.getTrackChangeDetails().isNoMarkupON()&&!isV8Engine?l=TcNoMarkupHandler.processServerToClientOp(l):HiddenRangesHandler.hasHiddenRangeOps()&&!isV8Engine&&(l=HiddenRangesHandler.processServerToClientOp(l)),editor.doc.snapShotManager&&editor.doc.snapShotManager.transformCollaboratorsOp(l),ZWCollaboration.transformAndApplyOthersCursor(l,i);try{l.redactContent=d,editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),l.applyTo({operation:"collabop",cursor:DocUtil.copyStyle(editor.doc.domCursor),sid:i}),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}catch(e){ZWCollaboration.msgQueue=new MsgQueue(editor),PubSub.publish("MessageQueue/EditsTransformed"),ZWLogger.log("serverOp: "+l.toProtoString()),ZWLogger.log("Exception: "+(e.stack||e));var m=e.message;throw m===ZWCollaboration.SET_CURSOR_ERROR||m===ZWCollaboration.SET_COLLAB_CURSOR_ERROR?editor.lastError=e:editor.lastError=new Error(ZWCollaboration.COLLAB_OP_APPLYTO_ERROR),editor.lastError}var h="";r&&(h=" by "+r),PubSub.publish("Document/SaveStatus",!0,void 0,n),ZWCollaboration.updateVersion(t.VERSION,t.REVISION,t.DOCS_VERSION,t.VERSION_ID),PubSub.publish("CollaboratorMutation/Added",s,t.VERSION,t.REVISION,t.VERSION_ID)}}},ZWCollaboration.getRangesInRegionOfUser=function(e){var t=[],i=editor.doc.getSelection(e);if(!i)return t;var n=i.getLastRange();if(!n)return t;var o,r,a,s=DocTreeManager.getTreeNodeAtIndex(n.start),l=DocTreeManager.getTreeNodeAtIndex(n.end),d=s.getIndex(),c=l.getEndIndex(),u=editor.doc.getAllSelections();for(o in u)if((i=u[o])&&i.SID!==e&&"NamedRange"!==i.SID)for(r=0,a=i.length;r<a;r++)n=i.getRangeAt(r),(n.isIntersectWithRange(editor.doc.createRange(d,c))||n.isTableSelected()||"inspara"===editor.doc.lastAction.cmd&&n.start<=d)&&(n.SID=o,t.push(n));return t},ZWCollaboration.transformAndApplyOthersCursor=function(e,t){var i,n,o,r,a,s,l,d,c,u,p,g,f,E=[];for(i in editor.doc.domCursor)if(n=t===i||!editor.doc.domCursor.hasOwnProperty(i),!n&&editor.doc.domCursor[i].start&&(o=editor.doc.getSelection(i))&&o.length){for(r=editor.doc.domCursor[i].zuid,a=0,s=o.length||0;a<s;a++)l=o.getRangeAt(a).createOp(r),E[a]=DocOpBuilder.build(l);for(d=E[0],a=1,s=E.length;a<s;a++)d=DocOpBuilder.compose(d,E[a]);for(g=DocOpBuilder.xform(d,e),d=g.first,f=d.getCursorPos(),a=0,s=f.length;a<s;a++)(p=o.getRangeAt(a))&&(c=f[a].start>0?f[a].start:f[a].end,u=f[a].end?f[a].end:f[a].start,p.setFocus(!1).setStart(c).setEnd(u));isV8Engine||(editor.doc.setDomCursorIdx(i,"start",c),editor.doc.setDomCursorIdx(i,"end",u))}},ZWCollaboration.updateCollabUsersRanges=function(e,t){for(var i,n=0,o=e.length;n<o;n++)if(e[n]&&(i=e[n].SID)&&i!=editor.uuid&&(editor.doc.domCursor[i]||{}).start)try{if(!editor.doc.domCursor[i])return void ZWLogger.log("@updateCollabUsersRanges: There is no domCursor for\n"+i);for(var r,a=editor.doc.getSelection(i)||editor.doc.createSelection(i),s=a.toArray(),l=0,d=s.length;l<d;l++)0==l&&a.removeAllRanges(),r=s[l].cloneRange(i),a.showCaret(r);i===t&&PubSub.publish("Cursor/showCollbUserName",t)}catch(e){break}},ZWCollaboration.checkServerVersion=function(){if(!ZWCollaboration.stopUpdates){var e=ZWNetworkUtils.getUrl("sync"),t=editor.doc.docInfo,i=editorProps.deployment.zohowriter,n={sid:editor.uuid,version:t.VERSION,revision:t.REVISION,versionid:t.VERSION_ID,tstamp:(new Date).getTime()};if(Macros.includeParamsForStats(n),!ZWCollaboration.syncSent){ZWOfflineLogger.log("checkServerVersion invoked"),ZWLogger.log("sync called:"+JSON.stringify(n));var o=function(e,t,n){var o=e.getResponseHeader("Content-Type"),r=e.responseJSON||{};if(200==e.status&&o.toLowerCase().indexOf("text/html")>=0)PubSub.publish("User/SignedOut");else{if(r&&"FAILED"==r.UPDATE){var a=r.REASON;return"REVERTED_REVISION"===a?void UIUtils.showMessagePopup(J.i18n("common","REVERT_RELOAD"),i,"info",editor.reloadDocumentContent,!0):"NEW_VERSION_UPLOAD_STATE"===a?void PubSub.publish("Document/Warning",WARNING_MSG.NEW_VERSION_UPLOADED):"REMOTE_TRASH"==a?void PubSub.publish("Document/RemoteTrashed"):"OPS_NOT_PRESENT"==a?void UIUtils.showMessagePopup(J.i18n("error","CONTENT_REPAIR_ERROR"),J.i18n("error","CONTENT_REPAIR_ERROR_TITLE_MSG"),"info",editor.reloadDocumentContent,!0):"CLIENT_VERSIONDIFF_EXCEEDS"==a?void UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"warning",editor.reloadDocumentContent,!0):("RESOURCE_TRASHED"==a?PubSub.publish("Document/Trashed",editor.doc.docInfo.CREATOR_ZUID):"CLIENT_VERSIONDIFF_EXCEEDS"==a&&UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"warning",editor.reloadDocumentContent,!0),void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_RESP_ERROR,errorMsg:"MSG_EDIT_ERROR"}))}if("CLIENT_VERSIONDIFF_EXCEEDS"!=r.UPDATE)return void PubSub.publish("System/NetworkFailure");UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"warning",editor.reloadDocumentContent,!0)}},r=function(e){if(ZWCollaboration.syncSent=!1,!ZWOffline.isOfflineOperationsAllowed()){if(!e)return void(ZWCollaboration.checkServerVersionCount<ZWCollaboration.SERVERCHECK_MAXCOUNT?(ZWCollaboration.checkServerVersionCount++,setTimeout(ZWCollaboration.checkServerVersion,ZWCollaboration.SYNC_TIMER)):(ZWCollaboration.checkServerVersionCount=0,PubSub.publish("Document/Error",{title:"TITLE_SERVER_BUSY",errorNo:ZWCollaboration.CHECKSERVERVERSION_LOOP_ERROR,errorMsg:"MSG_SERVER_BUSY"})));ZWCollaboration.checkServerVersionCount=0}if("SYNCUP"==e.UPDATE){var t=e.VERSION,n=e.REVISION,o=e.CHANGES,r={version:parseFloat(t),revision:parseInt(n)},a=editor.doc.docInfo,s={version:parseFloat(a.VERSION),revision:parseInt(a.REVISION)};ZWLogger.log("sync success:"+JSON.stringify(r)+", current:"+JSON.stringify(s));var l=DocUtil.getVersionNumberDiff(r,s);if(l<0)return void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_VDIFF_INVALID,errorMsg:"MSG_EDIT_ERROR"});if(l>=1){if(0==o.length)return void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_DELTA_EMPTY,errorMsg:"MSG_EDIT_ERROR"});if(o.length!=l)return ZWLogger.log("Changes length:"+o.length+",versionDiff:"+l),void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_DELTA_INVALIDCOUNT,errorMsg:"MSG_EDIT_ERROR"});ZWCollaboration.handleSyncOpsResponse(e)}PubSub.publish("Document/Sync",e),e.MAX_REVISION&&(MAX_REVISION=e.MAX_REVISION)}else{if("FAILED"==e.UPDATE){var d=e.REASON;return"REVERTED_REVISION"===d?void UIUtils.showMessagePopup(J.i18n("common","REVERT_RELOAD"),i,"info",editor.reloadDocumentContent,!0):"NEW_VERSION_UPLOAD_STATE"===d?void PubSub.publish("Document/Warning",WARNING_MSG.NEW_VERSION_UPLOADED):"REMOTE_TRASH"==d?void PubSub.publish("Document/RemoteTrashed"):"OPS_NOT_PRESENT"==d?void UIUtils.showMessagePopup(J.i18n("error","CONTENT_REPAIR_ERROR"),J.i18n("error","CONTENT_REPAIR_ERROR_TITLE_MSG"),"info",editor.reloadDocumentContent,!0):("CLIENT_VERSIONDIFF_EXCEEDS"==d?UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"warning",editor.reloadDocumentContent,!0):"RESOURCE_TRASHED"==d&&PubSub.publish("Document/Trashed",editor.doc.docInfo.CREATOR_ZUID),void PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SYNCOP_RESP_ERROR,errorMsg:"MSG_EDIT_ERROR"}))}"CLIENT_VERSIONDIFF_EXCEEDS"==e.UPDATE&&UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"warning",editor.reloadDocumentContent,!0)}},a={};a.type="POST",a.global=!1,a.url=e,a.async=!0,a.setCsrfParam=!0,a.data=n,a.dataType="json",a.error=o,a.success=r,ZWNetworkUtils.sendAjax(a),ZWCollaboration.syncSent=!0}}},ZWCollaboration.handleSyncOpsResponse=function(e){ZWOfflineLogger.log("handleSyncOpsResponse invoked");var t,i,n,o="",r=!1,a=(editor.doc.docInfo,e.CHANGES),s=a.length,n=e.DOCS_VERSION;versionId=e.VERSION_ID;try{for(var l=0;l<s;l++){var d=a[l],c=d.sid;if(t=d.VERSION,i=d.REVISION,c==editor.uuid)r=!0,ZWCollaboration.applyCollaboratorsMutation(o,{VERSION:t,REVISION:i,DOCS_VERSION:n,VERSION_ID:versionId}),o||ZWCollaboration.updateVersion(t,i,n,versionId),o="",PubSub.publish("Document/SaveStatus",!0,void 0,editor.zuid),ZWLogger.log("handleSyncOpsResponse","ack received"),ZWCollaboration.msgQueue.ackReceived();else{var u=DocOpBuilder.build(d.op);u.isLock||u.isRedact||u.isInsideRedact?(1==u.isRedact?u.redactContent=d.redact_content:0==u.isRedact&&(u.redactContent=d.unredact_content),ZWCollaboration.applyCollaboratorsMutation(o,{VERSION:e.VERSION,REVISION:e.REVISION,DOCS_VERSION:n,VERSION_ID:versionId}),o="",ZWCollaboration.applyCollaboratorsMutation(u,{VERSION:e.VERSION,REVISION:e.REVISION,DOCS_VERSION:n,VERSION_ID:versionId})):o=o?DocOpBuilder.compose(o,u):u}}r?(o&&ZWCollaboration.applyCollaboratorsMutation(o,{VERSION:t,REVISION:i,DOCS_VERSION:n,VERSION_ID:versionId}),ZWCollaboration.sendPendingMutation()):o&&ZWCollaboration.applyCollaboratorsMutation(o,{VERSION:t,REVISION:i,DOCS_VERSION:n,VERSION_ID:versionId}),ZWCollaboration.updateVersion(e.VERSION,e.REVISION,e.DOCS_VERSION,e.VERSION_ID)}catch(e){try{ZWLogger.log(" SYNC OP RES ERROR OP :: "+u.toProtoString()+" : COMPOSED OP : "+o.toProtoString())}catch(e){}throw"Error in xform lock"==e&&PubSub.publish("Collaboration/LockReceived"),e.message===ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR?editor.lastError=e:editor.lastError=new Error(ZWCollaboration.COLLAB_OP_APPLYTO_ERROR),ZWLogger.log("SYNC OP RES ERROR VERSION : "+t+" : "+i),ZWLogger.sendErrorDetails("SYNC RESPOSE ERROR<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No =EXPORT DOC DOC len ="+editor.doc.getDocumentLength()+" MsgQueue = "+ZWCollaboration.msgQueue.toProtoString()+" FULL DOC OP IDS :: "+ZWCollaboration.docOpIds+" buildLabel::: "+buildLabel+"\n Error Log End \n"),editor.lastError}},ZWCollaboration.isExistingUserSession=function(e){for(var t=!1,i=editor.doc.collabUsers,n=0,o=i.length;n<o;n++)if(i[n].uuid==e){t=!0;break}return t},ZWCollaboration.removeCollabUserUUID=function(e){e!=editor.uuid&&ZWCollaboration.isExistingUserSession(e)&&(ZWArrayUtils.removeObjArray(e,editor.doc.collabUsers),editor.doc.removeSelection(e),DomUtil.removeCursorNode(e,"start"),DomUtil.removeCursorNode(e,"end"),delete editor.doc.domCursor[e])},ZWCollaboration.addCollaborator=function(e,t){if(e&&t)try{var i=editor.doc.getUserData()[e]||{},n=[],o=[];i.uuids&&(n=i.uuids.split(",")),t.uuids&&(o=t.uuids.split(",")),editor.doc.updateUserData(e,t);for(var r=0,a=n.length;r<a;r++)o.contains(n[r])||ZWCollaboration.removeCollabUserUUID(n[r]);if(o.length>0){for(var r=0,a=o.length;r<a;r++)o[r]==editor.uuid||ZWCollaboration.isExistingUserSession(o[r])||(editor.doc.collabUsers.push({zuid:e,uuid:o[r],dname:t.fname,status:"active"}),editor.doc.createDomCursor(o[r],e));CollabPanelHandler.addCollaborator(e,t)}}catch(e){}},ZWCollaboration.removeCollaborator=function(e){if(e)try{var t=editor.doc.getUserData()[e];if(!t)return;var i=[];t.uuids&&(i=t.uuids.split(",")),t.uuids="",editor.doc.updateUserData(e,t);for(var n=0,o=i.length;n<o;n++)ZWCollaboration.removeCollabUserUUID(i[n]);CollabPanelHandler.removeCollaborator(e,t.fname)}catch(e){}},extend(_editorDoc,{setDomCursor:function(e,t,i,n,o,r){t=t?t:"start",e=e?e:editor.uuid,o=o?o:editor.zuid,this.domCursor[e][t].node=i,this.domCursor[e][t].idx=n,this.domCursor[e][t].cursor||r||J(CurUtil.createCursor(t,e,o)),this.domCursor[e].zuid=o,this.domCursor[e].bgColor||(this.domCursor[e].bgColor=editor.doc.getUserData()[o].color)},getDomCursorNode:function(e,t,i){i=i?i:"start",e=e?e:editor.uuid,this.domCursor[e]||editor.doc.createDomCursor(e,t);var n;if(this.domCursor[e]&&this.domCursor[e][i]&&(n=this.domCursor[e][i].cursor),n||isV8Engine||(n=editor.jeditorPane.children("div#z-cursor-"+i+"-"+e),n[0]))return n},setDomCursorNode:function(e,t,i){t=t?t:"start",e=e?e:editor.uuid;var n=this.domCursor[e];n||this.createDomCursor(),this.domCursor[e][t].cursor=i},getDomCursorIdx:function(e,t){return t=t?t:"start",e=e?e:editor.uuid,this.domCursor[e][t].idx},setDomCursorIdx:function(e,t,i){t=t?t:"start",e=e?e:editor.uuid,this.domCursor[e][t].idx=i},getCursorPortionNode:function(e,t){return t=t?t:"start",e=e?e:editor.uuid,this.domCursor[e][t].node},setCursorPortionNode:function(e,t,i){t=t?t:"start",e=e?e:editor.uuid,this.domCursor[e][t].node=i},createElement:function(e,t){return ElementBuilder.createElement(e,t)},execCmd:function(e,t){"object"==typeof e&&(t=e[1],e=e[0]);var i=this.getSelection(),n=0;if(!(i.isListItemSelection&&U.contains(DISABLED_OPERATIONS_ONLIST,e)||(ZWLogger.addToStatistics(e),"FontSize"===e&&isNaN(t)||i.canEditLockRange()&&(e.indexOf("ins")!=-1||e.indexOf("auto")!=-1||"delete"==e)))){if(PubSub.publish("DocOperation/BeforeExecCmd",e,t),"undefined"!=typeof EditorUtil&&EditorUtil.flushContents(),editor.lastOperation=e,editor.currentCommand=COMMAND.ANY,editor.doc.snapShotManager.flushTypedCharOps(),DocUtil.formatGenerator.isTextCommand(e)&&"SmallCaps"!==e||DocUtil.formatGenerator.isParaCommand(e)||DocUtil.formatGenerator.isNodeStyleCommand(e)?editor.doc.updateLastAction(e,t):editor.doc.clearLastAction(),DocUtil.formatGenerator.isTextCommand(e)&&"SmallCaps"!==e){if(t="BackColor"!==e||t?t:Doc.curBackGrdColor,t="ForeColor"!==e||t?t:Doc.curForeGrdColor,this.getSelection().isCollapsed()){i.updateCursorFormat(e,t);var o=i.getParents(NODE_TYPE.PARAGRAPH);if(o.getEnd()-o.getStart()==1){var r={};r[ATTR_PARAGRAPH.PS_TS]=i.getTextFormat(),o.attr(r)}else"FontSize"===e&&setTimeout(function(){EditorUtil.focusMultiByteSpan()},10)}else switch(e){default:var r=DocUtil.formatGenerator.getTextFormat(i.getComputedTextFormat(),e,t);i.applyFormat(r)}"BackColor"==e&&(editor.doc.isHighLighterOn||!i.isCollapsed()?(editor.doc.isHighLighterOn=!1,isV8Engine||(editor.jeditorPane.find("div.zw-page").css("cursor",""),J("#fmt-lpnl-bgcolor").removeClass("ui-highlight-active"))):(isV8Engine||(J("#fmt-lpnl-bgcolor").addClass("ui-highlight-active"),editor.jeditorPane.find("div.zw-page").css("cursor","pointer")),editor.doc.isHighLighterOn=!0,editor.doc.highLightTextColor=t))}else if(DocUtil.formatGenerator.isParaCommand(e)){t="ParaBackColor"!==e||t?t:Doc.curParaBackGrdColor;var r=DocUtil.formatGenerator.getParaFormat(e,t);if("direction"==e&&r.dir===PARA_DIR.RTL){ZWLogger.addToStatistics("DIRECTION_");editor.doc.getSelection().getTargetRange(),editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION;r[ATTR_PARAGRAPH.PS_AL]=0}"SetLineSpacing"==e&&(r[ATTR_PARAGRAPH.PS_LINE_RULE]="auto");for(var a=ZWJSONUtils.getKeys(r),s=i.getNodesInSelection(NODE_TYPE.PARAGRAPH)||[],l=0;l<s.length;l++){var o=s[l],d=a[0];o.attr(d)!=r[d]&&o.attr(r)}}else if("undo"==e){editor.currentCommand=COMMAND.UNDO;var c=editor.doc.snapShotManager.getPrevious();c&&(void 0==c.isListItemSelection&&(c.isListItemSelection=!1),Op.isListItemSelection=i.isListItemSelection=c.isListItemSelection,Op.isCtrlSelection=c.isCtrlSelection,Op.processMsg(c.ops),Op.cursorProcessed())}else if("redo"==e){editor.currentCommand=COMMAND.REDO;var u=editor.doc.snapShotManager.getNext();u&&(void 0==u.isListItemSelection&&(u.isListItemSelection=!1),Op.isListItemSelection=i.isListItemSelection=u.isListItemSelection,Op.isCtrlSelection=u.isCtrlSelection,Op.processMsg(u.ops),Op.cursorProcessed())}else"RepeatHeader"==e||"RemoveRepeatHeader"==e?(editor.getDocument().execCmd(e).sync(),n=1):Command.exec(e,t);e==COMMAND.PASTE&&e==COMMAND.RE_PASTE||!n&&Op.sendMsg();var p=i.getStart();if(p&&editor.doc.getCharAt(p)==UNICODE.BR&&editor.doc.getCharAt(p-1)==UNICODE.PARA){EventHandler.mouseDown_coord.isLineEnd=!0;var g=editor.doc.getCursorPortionNode(editor.uuid,"start").node;EventHandler.mouseDown_coord.portion=J(g).parents("div.zw-paragraph").find("span.zw-portion,span.EOP")[0],i.select()}if(PubSub.publish("DocOperation/AfterExecCmd",e,t),i.isCollapsed()&&!/tableResize|updateRowHeight|updateColumnWidth|updateLastColumnWidth|applyShapeFormat/.test(editor.lastOperation)){var f=editor.doc.getDomCursorNode(editor.uuid,"start");f&&DomUtil.scrollElementIntoView(f[0])}isV8Engine&&PubSub.publish("ZWRange/ScrollIntoView"),"copy"==e||"cut"==e||"applyShapeFormat"==editor.lastOperation||"undefined"==typeof EventHandler||EventHandler.isDialogFocused||"object"==typeof t&&t.hasOwnProperty("sheetInfo")||EditorUtil.focusMultiByteSpan()}},clearLastAction:function(){this.lastAction.cmd=this.lastAction.cmdValue=void 0},updateLastAction:function(e,t){var i;return"applyStyle"!==e||t[0]&&t[0][0]&&"paragraph"===t[0][0].type?("InsertChar"===e&&(this.lastAction&&"repeatAction"===this.lastAction.action?i=this.lastAction.cmdValue:(i=this.lastAction&&"InsertChar"===this.lastAction.cmd?this.lastAction.cmdValue:"",i+=t),t=i),this.clearLastAction(),this.lastAction.cmd=e,void(this.lastAction.cmdValue=t)):void this.clearLastAction()},applyLastAction:function(){if(!editor.getRole().permissions.can("document.edit"))return!1;var e=editor.doc.lastAction.cmd;if(editor.doc.lastAction.action="repeatAction",PubSub.publish("DocOperation/applyLastAction",e),"InsertChar"===e){var t=editor.doc.createElement(NODE_TYPE.TEXT,editor.doc.lastAction.cmdValue);return Command.exec("InsertChar",{cmd:"insert",element:t}),!1}if("delrow"===e||"delcolumn"===e||"insrowafter"===e||"insrowbefore"===e||"inscolafter"===e||"inscolbefore"===e||"splitcells"===e||"deltable"===e||"setTableTheme"===e)return editor.doc.getSelection().getParents(NODE_TYPE.TABLE)&&editor.doc.execCmd(e,editor.doc.lastAction.cmdValue),!1;if("Unlink"===e)return editor.doc.execCmd("Unlink"),!1;if("applyStyle"===e){var i=[];return editor.doc.getSelection().isCollapsed()?i.push(editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH)):i=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH),editor.doc.execCmd(e,[i,editor.doc.lastAction.cmdValue[1]]),!1}return"insbr"===e?(Command.exec("InsertChar",{cmd:"insbr"}),!1):"inspara"===e?(EventHandler.insertPara(),!1):"CreateLink"!==e&&"insimg"!==e&&"endnote"!==e&&(e?(editor.doc.execCmd(editor.doc.lastAction.cmd,editor.doc.lastAction.cmdValue),!1):void 0)}}),TableSort=function(){"use strict";function e(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function t(e,t,i,n){try{var o=-1,r=e[1],a=t[1];DocLocaleHandler.getLanguage();if(i==TABLE_SORT_TYPE.STRING&&r==a)return 0;if(!(i!=TABLE_SORT_TYPE.NUMBER&&i!=TABLE_SORT_TYPE.DATE||isNaN(r)||isNaN(a)||r!=a))return 0;if(n){if((i==TABLE_SORT_TYPE.STRING||i==TABLE_SORT_TYPE.NUMBER)&&a>r)o=1;else if(i==TABLE_SORT_TYPE.DATE){var s=!1,l=!1;!isNaN(r)&&r||(s=!0),!isNaN(a)&&a||(l=!0),s&&l||l&&!s?o=-1:s&&!l?o=1:r<a&&(o=1)}}else if((i==TABLE_SORT_TYPE.STRING||i==TABLE_SORT_TYPE.NUMBER)&&a<r)o=1;else if(i==TABLE_SORT_TYPE.DATE){var s=!1,l=!1;!isNaN(r)&&r||(s=!0),!isNaN(a)&&a||(l=!0),s&&l||!l&&s?o=-1:!s&&l?o=1:r>a&&(o=1)}return o}catch(e){return-1}}function i(i,n,o,r){for(var a,s=i.length,l=0;l<s;l++)for(var a=l,d=null,c=l+1;c<s;c++){if(d=t(i[a],i[c],n,o),0==d&&!ZWJSONUtils.isEmptyObject(r))for(var u=ZWJSONUtils.getKeys(r).length,p=0;p<u;p++){var g=r[p];if(d=t([g.rows[a][0],g.rows[a][1].text],[g.rows[c][0],g.rows[c][1].text],g.type,g.descend),0!=d)break}if(i[a][0]>i[c][0]&&(d=1),1==d&&(e(i,l,c),!ZWJSONUtils.isEmptyObject(r)))for(var u=ZWJSONUtils.getKeys(r).length,p=0;p<u;p++)e(r[p].rows,l,c)}}function n(e,t){function i(e,t){var i=e[2].parentNode(),n=(i.children(),i.parentNode()),o=n.children(),r=o[t],a=[{r:i.getStart()},{ds:editor.doc.getContent(i.getStart(),i.getEnd())}],s=DocOpBuilder.build(a),l=SnapShotManager.getReverseOp(s);return l.shift(),l.unshift({r:r.getStart()}),s.applyOp(DocOpBuilder.build(l)),s}for(var n=i(e[0],t),o=1;o<e.length;o++)n.applyOp(i(e[o],t+o));return n}var o=function(e,t,o){function r(e,t,i,n){var o=editor.doc.getContent(e.getStart(),e.getEnd());return o=o.trimEnd(),o=o.replaceAll("",""),o=o.replaceAll(UNICODE.RANGE_START,""),o=o.replaceAll(UNICODE.RANGE_END,""),o=o.replace(/ */,""),a(o,t,i,n)}var s,l=editor.doc.getSelection(),d=editor.doc.getParents(NODE_TYPE.TABLE,l.getStart()),c=editor.doc.getParents(NODE_TYPE.ROW,l.getStart()),u=c.children()[e[0].colIndex-1],p=d.children(),g=[],f=c.nodeCountBefore(u),E={};t=t||1,o=o||p.length+1,t--,o--;var T=e.splice(1);if(T&&T.length)for(var m=0;m<T.length;m++)E[m]={},E[m].rows=[],E[m].type=T[m].type,E[m].descend=T[m].descend,T[m].type==TABLE_SORT_TYPE.DATE&&(E[m].date_info=T[m].date_info);for(var h=DocLocaleHandler.getLanguage(),I=0;I<p.length;I++)if(!(I<t||I>o)){if(s=p[I].children(),T&&T.length)for(var m=0;m<T.length;m++){var _={};_.col=s[T[m].colIndex-1],_.text=r(_.col,T[m].type,h,T[m].date_info),E[m].rows.push([I,_])}g.push([I,r(s[f],e[0].type,h,e[0].date_info),s[f]])}i(g,e[0].type,e[0].descend,E);for(var A=n(g,t),S=Utils.randomString(),R={as:{start:{type:"cursor",uuid:editor.uuid},id:S}},O={as:{end:["type","uuid"],id:S}},b=A.toJson(),v=0,D=b.length;v<D;v++){var L=b[v];if(L.is&&L.is===UNICODE.CELL){b.splice(v+2,0,R),b.push(O);break}}Op.processMsg(b),Op.cursorProcessed(),Op.sendMsg()},r=function(e){var t,i=1,n=[],e=e.replaceAll("","");e=e.replaceAll("",""),e=e.replaceAll("","");for(var o=DocUtil.getCellEnd(i,e);o!=-1;)n.push(e.substring(i,o-1)),i=o+1,o=DocUtil.getCellEnd(i,e);return t=e.substring(i),t=t.trimEnd(),n.push(t),n},a=function(e,t,i,n){switch(parseInt(t)){case TABLE_SORT_TYPE.STRING:e=e.toLowerCase();break;case TABLE_SORT_TYPE.NUMBER:try{e=Numeral.getNumber(e,i)}catch(t){e=parseFloat(e)}break;case TABLE_SORT_TYPE.DATE:e=new ZWDateTime(e,n.dateFormat,n.lang,n.timeZone,n.isCustom)._originalUTC}return e},s=function(e,t){var n=t[0],o=n.colIndex,s=t.splice(1),l={},d=[],c=DocLocaleHandler.getLanguage();if(s&&s.length)for(var u=0;u<s.length;u++)l[u]={},l[u].rows=[],l[u].type=s[u].type,l[u].descend=s[u].descend,s[u].type==TABLE_SORT_TYPE.DATE&&(l[u].date_info=s[u].date_info);for(var p=0,g=e.length;p<g;p++){var f=e[p],E=f.content,T=r(E);if(s&&s.length)for(var u=0;u<s.length;u++){var m={};m.text=a(T[s[u].colIndex-1],l[u].type,c,l[u].date_info),l[u].rows.push([p,m])}d.push([p,a(T[o-1],n.type,c,n.date_info),f.ops])}i(d,n.type,n.descend,l);for(var h=[],p=0,g=d.length;p<g;p++)h.push(d[p][2]);return h};return{sortCurrentColumn:o,sortRLTable:s,contentSort:i,getReplacedContent:a}}(),WordComplete=function(){var e,t,i={},n="",o=!1,r=function(){var e=editor.doc.getSelection().getWord();return e.getEnd()==editor.doc.getSelection().getStart()?editor.doc.getContent(e.getStart(),e.getEnd()):null},a=function(){var t=editor.doc.getSelection(),i=t.getLastRange(),r=i&&i.getStartPortionData(),a=r&&r.node;e=J(document.createElement("span")).css({color:"grey",border:"1px dashed black","font-size":"inherit"}).text(n),DomUtil.placeNode(a.firstChild,r.cursorPos,e[0]),o=!0,t.removeAllRanges().showCaret(editor.doc.createRange(i.start))},s=function(){n="",o=!1},l=function(){t=J("#editorpane")},d=function(){i={}},c=function(e){var t,n,o,r,a,s;for(e=e.toLowerCase(),t=e.split(""),o=i,a=0,s=t.length;a<s;a++)n=t[a],r=o[n],null==r&&(o[n]={}),a==s-1&&(o[n].end=1),o=o[n]},u=function(){s();var e=r();if(e=e?e.replace(REGEX.docUnicodes,""):e,e&&!(e.length<3)){var t,o,l,d;for(d=i,t=0;t<e.length;t++){if(o=e[t],l=d[o],!l)return;d=l}try{for(var t=0,c=Object.keys(d);t<c.length;)"end"!==c[t]?(o=c[t],n+=o,d=d[o],t=0,c=Object.keys(d)):t++;n&&a(n)}catch(e){}}},p=function(){editor.addChar(n),s()},g=function(){e&&J(e).remove(),s()},f=function(){return o};return{init:l,clearDict:d,addWord:c,lookupWord:u,insertSuggestion:p,removeSuggestion:g,isSuggestionShown:f,dict:function(){return i}}}(),DocumentMap=function(){var e,t={},i={},n={},o=function(){},r=!1,a=!1,s=null,l=!0;card_collection=null,card_outlineview=null,state="dirty",userData=editor.doc&&editor.doc.getUserData()[editor.zuid],isPinned=!(!userData||!userData.pinNavigationPane)&&userData.pinNavigationPane;var d=function(e){e.section.getSectionType()==SECTION_TYPES.CONTENT&&G(e,"addOrUpdate")},c=function(){isPinned=!isPinned,PubSub.publish("DocumentMap/PinStateUpdate",isPinned)},u=function(){return isPinned},p=function(e){e?(Z("documentmapzdialog").draggable("destroy").css({left:"inherit"}),Z("documentmapzdialog")[0].classList.add("ui-doc-nav-parentdiv-pinned"),J("#docnav_smart_pin").removeClass("ui-icon-pin-gray-sm").addClass("ui-icon-unpin-gray-sm")):(Z("documentmapzdialog").draggable({containment:"#ui-editor-outer-div",scroll:!1,handle:".ui-doc-nav-heading"}),Z("documentmapzdialog")[0].classList.remove("ui-doc-nav-parentdiv-pinned"),J("#docnav_smart_pin").removeClass("ui-icon-unpin-gray-sm").addClass("ui-icon-pin-gray-sm"))},g=function(){p(isPinned),r&&!editorProps.isPublishToFill&&"ANYONEWITHLINK"!==editor.type&&Q("pinNavigationPane","pin_navigation_pane",isPinned),PubSub.publish("Document/Resize")};PubSub.subscribe("DocumentMap/PinStateUpdate",g);var f=function(e){e.section.getSectionType()==SECTION_TYPES.CONTENT&&(G(e,"modify"),J("#fillableFieldMap").is(":visible")&&k())},E=function(){var e=editor.doc.getElement("bookmark"),t=document.getElementById("bookmarkMap");J(t).html("");for(var i=e.length,n=0;n<i;n++)if(e[n].id.indexOf("toc_")==-1){var o=J('<div class="ui-doc-nav-item ui-doc-nav-h2"><span class="doc-nav-marker doc-nav-marker-parent-nosublevel" style="display:inline-block;width:17px;cursor:pointer;"></span><span class="doc-nav-map-txt doc-nav-map-txt-bookmark"></span></div>');o.find(".doc-nav-map-txt").text(e[n].name),t.appendChild(o[0]),T(e[n].id,o)}},T=function(e,t){t.find("span.doc-nav-map-txt-bookmark").click(function(){J("span.doc-nav-map-txt").removeClass("doc-nav-map-txt-selected"),J(this).addClass("doc-nav-map-txt-selected"),Utils.moveToBookmark(e)})},m=function(e){e.section.getSectionType()==SECTION_TYPES.CONTENT&&G(e,"remove")},h=function(e){var t=card_collection.scenes.getItemById(e);if(t){for(var i=DocTreeManager.getTreeNodeById(t.id),n=i.format,o=parseInt(n[ATTR_PARAGRAPH.PS_HD])?parseInt(n[ATTR_PARAGRAPH.PS_HD]):0,r=t;r.next;){var a=r.next,s=DocTreeManager.getTreeNodeById(a.id),l=s&&s.format;if(!s)break;if(l[ATTR_PARAGRAPH.PS_HD]?parseInt(l[ATTR_PARAGRAPH.PS_HD])<=o:0<=o)break;r=a}return{start:t,last:r}}},I=function(e){if(e){for(var t=DocTreeManager.getTreeNodeById(e),i=t.format,n=parseInt(i[ATTR_PARAGRAPH.PS_HD])?parseInt(i[ATTR_PARAGRAPH.PS_HD]):0,o=t;o.next;){var r=o.next,a=r&&r.format;if(!r)return;var s=a[ATTR_PARAGRAPH.PS_HD]||0;if(0!=s&&s<=n)break;o=r}return{start:t,last:o}}},_=function(e,t){for(var n=e.level,o=i[i[e.id].next];o&&o.level>n;)t?J(o.el).show():J(o.el).hide(),o=i[i[o.id].next]},A=function(e){if(!e)return!1;var t=!1,n=e.level,o=i[i[e.id].next];return o&&o.level>n&&(t=!0),t},S={};S.init=function(){if(re()||(ZWComponentUtil.init("documentmapzdialog"),J(".ui-widget-overlay").hide(),N(),Z("documentmapzdialog").draggable({containment:"#ui-editor-outer-div",scroll:!1,handle:".ui-doc-nav-heading"}).show(),p(isPinned)),s=document.getElementById("headingMap"),i.head){for(var e,t,n=i.head,o=J(s);n;)e=i[n],t=e.prev&&i[n],o.append(e.el),b(e,e.el),n=e.next,O(e.el);state="clean"}};var R=function(e){var t=e.getIndex(),i=editor.doc.getSelection(),n=editor.doc.createRange(t);i.removeAllRanges().addRange(n),DomUtil.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0],0,!0),CurUtil.blinkCursor(),EditorUtil.focusMultiByteSpan()},O=function(e){var t=e.find("span.doc-nav-map-txt").text().replace(REGEX.docUnicodes,"");0==t.length||"[Empty Heading]"==t?(e.find("span.doc-nav-marker").removeClass("doc-nav-marker-parent-nosublevel ui-icon"),e.find("span.doc-nav-marker").removeClass("ui-icon-heading-active").html('<span class="uiicon-empty-space" style="width:7px!important;height:2px !important">&#8203;</span>'),e.find("span.doc-nav-map-txt").text(J.i18n("writer.documentmap.EMPTY_HEADING")).addClass("doc-nav-empty-heading")):e.find("span.doc-nav-map-txt").removeClass("doc-nav-empty-heading")},b=function(e,t){var i=J(t);i.find("span.doc-nav-map-txt").click(function(){if(J("span.doc-nav-map-txt").removeClass("doc-nav-map-txt-selected"),J(this).addClass("doc-nav-map-txt-selected"),re()){var t=DocLayoutManager.getViews(e.getNode());if(t){var i=DomViewManager.getDOMElem(t[0]);DomUtil.scrollElementIntoView(i,!0,!0)}}else R(e.getNode())}),i.find("span.doc-nav-marker").unbind().click(function(){var t=this.className||"",i=!0;t.indexOf("doc-nav-marker-parent-nosublevel")==-1&&(J(this).hasClass("ui-icon-heading-inactive")?J(this).removeClass("ui-icon-heading-inactive").addClass("ui-icon-heading-active"):(J(this).removeClass("ui-icon-heading-active").addClass("ui-icon-heading-inactive"),i=!1)),_(e,i)})},v=function(){t={},i={},card_collection&&card_collection.refresh(),card_outlineview&&card_outlineview.refresh(),state="dirty",s=document.getElementById("headingMap"),J(s).html("");var e=J("#fieldMap");e.html("")},D=function(){t={},i={},card_collection&&card_collection.flushAllSceneData(),card_outlineview&&card_outlineview.destroy(),card_collection=null,card_outlineview=null,state="dirty",s=document.getElementById("headingMap"),J(s).html("");var e=J("#fieldMap");e.html("")},L=function(e){FillableFieldsHandler.resetFieldsInfo(),FillableFieldsHandler.listAllFillableFields(),FillableFieldsHandler.updateFieldsList(e)},N=function(){if(re())return void oe();var e=editorProps.isPublishToFill?J("#branding-publishfill").css("height").split("px")[0]:J("#topband-wrapper").height();Z("documentmapzdialog").css({top:e+"px"})},P=function(){r||Q("showNavigationPane","navigation_pane",!1),D(),PubSub.unsubscribe("Document/Resize",N),Z("documentmapzdialog").hide(),PubSub.publish("Document/Resize")},A=function(e){return e.start!=e.last},C=function(e,t){var i=e.start,n=e.start,o=e.last;if(n.id!=o.id)for(;i;){var r=document.getElementById("headingMap"),a=J(r).find("#"+i.id);if(t){var s=a.find("span.doc-nav-marker");s.hasClass("doc-nav-marker-parent-nosublevel")||s.removeClass("ui-icon-heading-inactive").addClass("ui-icon-heading-active"),n!=i&&a.show()}else{var s=a.find("span.doc-nav-marker");s.hasClass("doc-nav-marker-parent-nosublevel")||s.removeClass("ui-icon-heading-active").addClass("ui-icon-heading-inactive"),n!=i&&a.hide()}if(i.id==o.id)break;i=i.next}},y=function(e){var t=J(e);t.find("span.doc-nav-map-txt").click(function(e){var t=document.getElementById("headingMap"),i=DocTreeManager.getTreeNodeById(e.id),n=J(t).find("#"+e.id).find("span.doc-nav-map-txt");if(J("span.doc-nav-map-txt").removeClass("doc-nav-map-txt-selected"),n.addClass("doc-nav-map-txt-selected"),re()){var o=DocLayoutManager.getViews(i);if(o){var r=DomViewManager.getDOMElem(o[0]);DomUtil.scrollElementIntoView(r,!0,!0)}}else R(i)}.bind(null,e)),t.find("span.doc-nav-marker").unbind().click(function(e){var t=document.getElementById("headingMap"),i=(DocTreeManager.getTreeNodeById(e.id),J(t).find("#"+e.id).find("span.doc-nav-marker")),n=i[0].className||"",o=!0;n.indexOf("doc-nav-marker-parent-nosublevel")==-1&&(i.hasClass("ui-icon-heading-inactive")?i.removeClass("ui-icon-heading-inactive").addClass("ui-icon-heading-active"):(i.removeClass("ui-icon-heading-active").addClass("ui-icon-heading-inactive"),o=!1));var r=h(e.id);C(r,o)}.bind(null,e))},F=function(e){var t=document.createElement("div"),i=document.createElement("div"),n=document.createElement("span"),o=document.createElement("span"),r=document.createElement("span"),a=h(e.id),s=A(a),l=e.getContent().replaceAll(REGEX.docUnicodes,"");l=l.replace(UNICODE.PARA,""),t.classList.add("ui-doc-nav-item","clearfix"),n.classList.add("doc-nav-marker"),o.classList.add("doc-nav-map-txt","ui-ellipsis"),o.innerText=l,r.classList.add("zbutton__icon","ui-fr","ui-no-margin-right","ui-icon-hmoreoptions3-sm","ui-doc-nav-more-opt"),r.setAttribute("data-menu-id","doc-nav-more-opt"),i.classList.add("ui-doc-nav-item-innercont","clearfix","ui-pos-rel"),i.appendChild(n),i.appendChild(o),i.appendChild(r),t.appendChild(i);var d=e.format.hd?parseInt(e.format.hd):0;return J(t).css({"margin-left":5*(d-1)+"px","padding-bottom":"5px"}).attr({"data-nav-hd":d.toString()}),t.classList.add("ui-doc-nav-h"+d),s?(n.classList.add("ui-icon"),n.classList.add("ui-icon-heading-active")):n.classList.add("doc-nav-marker-parent-nosublevel"),O(J(t)),w(e.id),y(t),t},M=function(e,t){if(e&&t){var i=J(e).find(".doc-nav-marker")[0],n=J(e).find(".doc-nav-map-txt")[0],o=t.getContent().replaceAll(REGEX.docUnicodes,"");o=o.replace(UNICODE.PARA,"");var r=h(t.id),a=A(r),s=t.format.hd?parseInt(t.format.hd):0;J(e).removeClass("ui-doc-nav-h1 ui-doc-nav-h2 ui-doc-nav-h3 ui-doc-nav-h4 ui-doc-nav-h5 ui-doc-nav-h6"),e.classList.add("ui-doc-nav-h"+s),e&&(a?(i.classList.contains("ui-icon")?null:i.classList.add("ui-icon"),i.classList.contains("ui-icon-heading-active")?null:i.classList.add("ui-icon-heading-active"),i.classList.contains("doc-nav-marker-parent-nosublevel")?i.classList.remove("doc-nav-marker-parent-nosublevel"):null):(i.classList.remove("ui-icon"),i.classList.remove("ui-icon-heading-inactive"),i.classList.remove("ui-icon-heading-active"),i.classList.contains("doc-nav-marker-parent-nosublevel")?null:i.classList.add("doc-nav-marker-parent-nosublevel")),n.innerText=o,J(e).css({"margin-left":5*(s-1)+"px","padding-bottom":"5px"}).attr({"data-nav-hd":s.toString()})),O(J(e)),w(t.id)}},w=function(e){var t=document.getElementById("headingMap"),i=t.querySelector("#"+e),n=i&&i.previousElementSibling,o=J(n).find(".doc-nav-marker")[0];if(n){var r=h(n.id);if(!r)return;A(r)?(o.classList.contains("ui-icon")?null:o.classList.add("ui-icon"),o.classList.contains("ui-icon-heading-active")?null:o.classList.add("ui-icon-heading-active"),o.classList.contains("doc-nav-marker-parent-nosublevel")?o.classList.remove("doc-nav-marker-parent-nosublevel"):null):(o.classList.remove("ui-icon"),o.classList.remove("ui-icon-heading-inactive"),o.classList.remove("ui-icon-heading-active"),o.classList.contains("doc-nav-marker-parent-nosublevel")?null:o.classList.add("doc-nav-marker-parent-nosublevel"))}},U=function(){var e,t,i;r=!0;try{!J("#topband-hamburger").isDisabled()&&LayoutManager.isRichEditActive()&&LayoutManager.toggleRichEdit()}catch(e){}if("dirty"==state){if(D(),re()){var n=DocLayoutManager.getPageWidthAtIdx(1);editor.editorPaneContainer[0].offsetWidth-n<300&&Z("publish-docnav-cont").addClass("ui-publish-docnav-cont-shadow");var o,a=DocTreeManager.getNodesBetweenIndex(NODE_TYPE.PARA,1,editor.doc.getSectionEnd(1));for(e=0,t=a.length;e<t;e++){o=a[e];var s=DocLayoutManager.getViews(o);o&&s&&s.length&&0!==s[0].getNodeLinesLength()&&d(o)}}else for(i=editor.doc.getNodesInSelection(NODE_TYPE.PARAGRAPH,1,editor.doc.getSectionEnd(1)),e=0,t=i.length;e<t;e++){var s=DocLayoutManager.getViews(i[e].dtNode);i[e].dtNode&&s&&s.length&&0!==s[0].getNodeLinesLength()&&d(i[e].dtNode)}if(!card_collection){for(var l=DocTreeManager.getAllSectionsByType(SECTION_TYPES.CONTENT),a=[],c=0;c<l.length;c++){var u=DocTreeManager.doc.getAllChildren(l[c],NODE_TYPE.PARA);a=a.concat(u)}var p={},g=function(e){if(e&&e.parent&&(e.parent.type==NODE_TYPE.TOC||e.parent.type==NODE_TYPE.CELL))return!1;var t=e.format,i=t[ATTR_PARAGRAPH.PS_HD]?parseInt(t[ATTR_PARAGRAPH.PS_HD]):0;return i>0&&i<=6},f=document.getElementById("headingMap");p.isSplitter=g,p.needEventForNonSplitterElems=!1,p.getView=DocTreeManager.getTreeNodeById,p.getGroupById=h,p.getContentGroup=I,isDragDropAllowed=!re()&&editor.getRole().permissions.can("document.edit");var E={isDragDropAllowed:isDragDropAllowed,getView:F,updateView:M};card_collection=new CardCollections(a,p),card_outlineview=new CardOutlineView(card_collection,f,E),card_collection.init(),card_outlineview.init()}}j(),S.init(),ZWLogger.addToStatistics("DocumentMap")},x=function(e){var t=e;do t=t.prev;while(t&&!H(t));return t},B=function(e){var t=e;do t=t.next;while(t&&!H(t));return t},H=function(e){var t=e.getIndex(),i=e.getEndIndex(),n=editor.doc.getContent(t,i),o=new RegExp(UNICODE.RANGE_START+"#|"+UNICODE.RANGE_START+UNICODE.MERGEFIELD_START,"gi"),r=o.exec(n);return!!r},G=function(e,t){if(e.parent!=e.section&&"cell"==e.parent.type){if("addOrUpdate"==t){var i=e.parent,o=i.parent;if(i.next||o.next)return}e=e.parent.parent.parent}var r=e.id,a=J("#fieldMap");if(n[r]&&J(n[r].el).remove(),H(e)&&"remove"!=t){for(var s=e.getIndex(),l=e.getEndIndex(),d=x(e),c=B(e),u=W(s-1),p=0,g=J("<div>");u<l&&u!=-1;){var f=editor.doc.getRawFormatAt(u),E="",T=f.type,m=f.ftype;if(T.indexOf("auto")!=-1)"autodate"==m?f.datefmt?E=f.datefmt:f.date_info&&(E="custom"==f.date_info.output.format?f.date_info.output.custom_format:f.date_info.output.format):E="autoformula"==m?f.formula:"autopno"==m?J.i18n("common","PAGE_NUMBER"):"autopcnt"==m?J.i18n("common","PAGE_COUNT"):f.val+"";else if(f.mminfo){var h=f.mminfo,I=h[MAILMERGE.GROUP_NAME],_=h[MAILMERGE.FIELD_NAME];E=I?I+"."+_:_,E=h[MAILMERGE.SHORTEN_NAME]?h[MAILMERGE.SHORTEN_NAME]:E,E=UNICODE.MERGEFIELD_START+E+UNICODE.MERGEFIELD_END}var A=J('<div class="ui-doc-nav-item doc-nav-field-map-txt ui-ellipsis" id='+p+"></div>"),S=typeof E;"string"===S?A.text(E.replace(/^\s+|\s+$/g,"")):(ZWLogger.log("Field Text Type : "+S+" format type : "+m),ZWLogger.sendErrorDetails(ZWCollaboration.AUTO_DATE_FORMAT+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+ZWCollaboration.AUTO_DATE_FORMAT+" DOC len =\nError Log End \n<ZWERROR>",null,ZWCollaboration.AUTO_DATE_FORMAT)),Y(A,e,m),g.append(A),p++,u=W(u)}if(g.children().length){n[r]={},extend(n[r],{id:r,node:e,prev:d&&d.id||null,next:c&&c.id||null,el:g});var R=!1,O=!1;d?n[d.id]&&(n[d.id].next=r,R=!0):n.head=r,c&&n[c.id]&&(n[c.id].prev=r,O=!0),c&&O?J(n[c.id].el).before(g):d&&R?J(n[d.id].el).after(g):a&&a.append(g)}}},k=function(){FillableFieldsHandler.resetFieldsInfo(),FillableFieldsHandler.listAllFillableFields(),FillableFieldsHandler.updateFieldNavigation()},W=function(e){var t=editor.doc.getContent(),i=editor.doc.getFormats(),n=new RegExp(UNICODE.RANGE_START+"#|"+UNICODE.RANGE_START+UNICODE.MERGEFIELD_START,"gi");n.lastIndex=e+1;for(var o=n.exec(t),r=-1;o;){r=o.index;var a=i[r];if(a.mminfo||a.type.indexOf("auto")!=-1)return r;o=n.exec(t)}return o?r:-1},Y=function(e,t,i){e.click(function(){for(var e=parseInt(this.id),i=t.getIndex(),n=W(i-1),o=0;o<e;)o++,n=W(n+1);var r=editor.doc.getRawFormatAt(n);if(!r.wrapType){var a=editor.doc.getContent();n=a.indexOf(UNICODE.RANGE_END,n)+1,z(n)}V(n)})},z=function(t){var i=J(editor.doc.getPortionData(t).node).prev();clearTimeout(e),o(),o=function(){i.removeClass("nav-field"),o=function(){}},e=setTimeout(o,3e3),DomUtil.scrollElementIntoView(i[0],500,!0),i.addClass("nav-field")},V=function(e){var t=editor.doc.getSelection(),i=editor.doc.createRange(e);t.removeAllRanges().addRange(i),CurUtil.blinkCursor(),EditorUtil.focusMultiByteSpan()},j=function(){l&&(l=!1,PubSub.subscribe("Document/Resize",N),PubSub.subscribe("Para/Create",d),PubSub.subscribe("Para/Update",d),PubSub.subscribe("FillableFieldInserted",L),PubSub.subscribe("Para/Modify",f),PubSub.subscribe("Para/Remove",m),PubSub.subscribe("documentMap/refresh",U),J("#doc-nav-close").click(function(){r=!1,DocumentMap.closePane(),Z("documentmapzdialog").hide(),Z("documentmapzdialog").removeClass("ui-doc-nav-fillfields-cont")}),J("#documentPaneCombo").bind("zselectboxchange",function(e,t){X(t.value)})),Utils.WriterCallbacks.register("onmenuhide",function(){return!J("#doc-nav-more-opt").is(":hidden")})},X=function(e){J("#doc-nav-fieldcount-cont").remove(),"bookmark"==e?(E(),J(".js-doc-navigation-parent,#nav-heading-field").hide(),J("#bookmarkMap,#nav-heading-doc").show()):"heading"==e?(J(".js-doc-navigation-parent,#nav-heading-field").hide(),J("#headingMap,#nav-heading-doc").show()):"field"==e?(J(".js-doc-navigation-parent,#nav-heading-field").hide(),J("#fieldMap,#nav-heading-doc").show()):"fillablefield"==e?(J(".js-doc-navigation-parent,#nav-heading-doc").hide(),J("#fillableFieldMap,#nav-heading-field").show(),J(".ui-doc-nav-sbox").find(".zselectbox__selected").append('<span id="doc-nav-fieldcount-cont" class="ui-doc-nav-fieldcount-cont ui-fr ui-right-margin-medium"><span id="doc-nav-field-num">0</span><span id="doc-nav-of" class="ui-doc-nav-sbox-count">'+J.i18n("writer.common.OF")+'</span><span id="doc-nav-field-count">0</span><span id="doc-nav-field-lbl" class="ui-doc-nav-sbox-count ui-txt-lowercase">'+J.i18n("writer.common.FIELDS")+"</span>"),FillableFieldsHandler.listAllFillableFields(),FillableFieldsHandler.updateFieldNavigation(),J("#fillableFieldMap").show()):(J(".js-doc-navigation-parent,#nav-heading-doc").hide(),J("#fillableFieldMap,#nav-heading-field").show(),J(".ui-doc-nav-sbox").find(".zselectbox__selected").append('<span id="doc-nav-fieldcount-cont" class="ui-doc-nav-fieldcount-cont ui-fr ui-right-margin-medium"><span id="doc-nav-field-num">0</span><span id="doc-nav-of" class="ui-doc-nav-sbox-count">'+J.i18n("writer.common.OF")+'</span><span id="doc-nav-field-count">0</span><span id="doc-nav-field-lbl" class="ui-doc-nav-sbox-count ui-txt-lowercase">'+J.i18n("writer.common.FIELDS")+"</span>"),FillableFieldsHandler.updateFieldNavigation())},K=function(){if(r)DocumentMap.closePane(),r=!1;else{var e=editor.doc&&editor.doc.getUserData()[editor.zuid];e&&e.showNavigationPane&&(r=!0,DocumentMap.openPane())}},q=function(){r||editorProps.isPublishToFill||"ANYONEWITHLINK"===editor.type||Q("showNavigationPane","navigation_pane",!0),DocumentMap.refreshMap()},Q=function(e,t,i){var n=(editor.doc.docInfo,{}),o={};o[t]=i,n.operations=JSON.stringify(o),J.ajax({type:"POST",url:ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/settings"),data:n,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(i){if("SUCCESS"==i.RESPONSE){var o=editor.doc&&editor.doc.getUserData();o[editor.zuid][e]=JSON.parse(n.operations)[t],editor.doc.setUserData(o)}},error:function(e){}})},$=!1,ee=!1,te=function(){if(re()){ee||(U(),ee=!0);var e,t,i=document.getElementById("publish-docnav-scale"),n=Z("publish-docnav-panel"),o=card_collection?Object.keys(card_collection.scenes.items):[],r=o.length,a=editor.editorPaneContainerHt/26,s=Math.min(r,a),l=document.createDocumentFragment(),d=document.createElement("div");d.className="ui-docnav-pointer";for(var c=0;c<s;c++){e=d.cloneNode(),t="ui-docnav-pointer-sm";var u=DocTreeManager.getTreeNodeById(o[c]);u.format&&1==u.format[ATTR_PARAGRAPH.PS_HD]&&(t="ui-docnav-pointer-md"),DomUtil.addClassForElement(e,t),l.appendChild(e)}i.appendChild(l),J(i).hover(function(){$=!0,Z("publish-nav-close").hide(),n.addClass("ui-publish-docnav-panel-show")}),Z("publish-docnav-cont").mouseleave(function(){$&&(n.removeClass("ui-publish-docnav-panel-show"),$=!1)}),setTimeout(function(){oe()},1e3)}},ie=function(){Z("publish-docnav-panel").removeClass("ui-publish-docnav-panel-show"),a=!1},ne=function(){return a?void ie():(a=!0,ee||(U(),ee=!0),$=!1,Z("publish-nav-close").show(),Z("publish-docnav-panel").addClass("ui-publish-docnav-panel-show"),void oe())},oe=function(){Z("headingMap")[0].style.height="";var e=Z("headingMap").height(),t=Z("publish-docnav-cont").height();e>t&&(Z("headingMap")[0].style.height=t-23+"px")},re=function(){return s||(s=document.getElementById("headingMap")),"PUBLIC"==editor.doc.getRole()&&!editorProps.isPublishToFill&&s},ae=function(){var e=document.getElementById("headingMap");J(e).find("input").remove()},se=function(e){if(e){for(var t=DocTreeManager.getTreeNodeById(e),i=t.format,n=parseInt(i[ATTR_PARAGRAPH.PS_HD])?parseInt(i[ATTR_PARAGRAPH.PS_HD]):0,o=t;o.next;){var r=o.next,a=r&&r.format;if(!r)return;var s=a[ATTR_PARAGRAPH.PS_HD]||0;if(0!=s&&s<=n)break;o=r}return o}},le=function(e,t){var i=editor.getDocument(),n=DocTreeManager.getTreeNodeById(e),o=n.format,r=parseInt(o?o[ATTR_PARAGRAPH.PS_HD]||0:0);if(r>0&&r<=6){var a=i.createNode("paragraph",t);a.style.headingType=r;var s=ZWUtils.getZWNode.call(editor.getDocument(),n);s.insertBefore(a),i.sync()}ae()},de=function(e,t){var i=editor.getDocument(),n=DocTreeManager.getTreeNodeById(e),o=se(e),r=n.format,a=parseInt(r?r[ATTR_PARAGRAPH.PS_HD]||0:0);if(a>0&&a<=6){var s=i.createNode("paragraph",t);s.style.headingType=a;var l=ZWUtils.getZWNode.call(editor.getDocument(),o);l.insertAfter(s),i.sync()}ae()},ce=function(e,t){var i=editor.getDocument(),n=DocTreeManager.getTreeNodeById(e),o=se(e),r=n.format,a=parseInt(r?r[ATTR_PARAGRAPH.PS_HD]||0:0);if(a>0&&a<6){var s=i.createNode("paragraph",t);s.style.headingType=a+1;var l=ZWUtils.getZWNode.call(editor.getDocument(),o);l.insertAfter(s),i.sync(),he(n)}ae()},ue=function(e,t){J(e).on("keypress",function(e){if(e.keyCode==KEYS.ENTER){var i=this.value;""==i?t.handleRevokeInputElem():t.handleAddHeading(i)}else e.keyCode===KEYS.ESC&&t.handleRevokeInputElem()}),J(e).focusout(function(){var e=this.value;""==e?t.handleRevokeInputElem():t.handleAddHeading(e)})},pe=function(e){var t=document.createElement("input");t.classList.add("ztextbox","ui-doc-nav-input"),t.setAttribute("placeholder","Type your heading");var i=5*(e-1)+10+"px";return J(t).css({width:"calc(100% - "+i+" )","margin-left":i}),t.classList.add("ui-doc-nav-h"+e),t},ge=function(e){var t=parseInt(e.getAttribute("data-nav-hd")),i=pe(t),n={handleAddHeading:le.bind(null,e.id),handleRevokeInputElem:ae};ue(i,n),J(e).prepend(i),J(i).focus()},fe=function(e){Ie(e);var t=parseInt(e.getAttribute("data-nav-hd")),i=pe(t),n={handleAddHeading:de.bind(null,e.id),handleRevokeInputElem:ae};ue(i,n),J(e).append(i),J(i).focus()},Ee=function(e){Ie(e);var t=parseInt(e.getAttribute("data-nav-hd")),i=pe(t),n={handleAddHeading:ce.bind(null,e.id),handleRevokeInputElem:ae};ue(i,n),J(e).append(i),J(i).focus()},Te=function(e){var t=parseInt(e.getAttribute("data-nav-hd")),i=DocTreeManager.getTreeNodeById(e.id),n=ZWUtils.getZWNode.call(editor.getDocument(),i),o=editor.getDocument();t>1&&(n.style.headingType=t-1,o.sync())},me=function(e){var t=parseInt(e.getAttribute("data-nav-hd")),i=DocTreeManager.getTreeNodeById(e.id),n=ZWUtils.getZWNode.call(editor.getDocument(),i),o=editor.getDocument();t<6&&(n.style.headingType=t+1,o.sync())},he=function(e){var t=h(e.id);C(t,!0)},Ie=function(e){var t=h(e.id);C(t,!1)},_e=function(e){var t=DocTreeManager.getTreeNodeById(e.id),i=ZWUtils.getZWNode.call(editor.getDocument(),t),n=editor.getDocument();i.remove(),n.sync()},Ae=function(e,t){var i=["newHeadingBefore","newHeadingAfter","newSubHeading","promoteHeading","demoteHeading","expandHeadings","collapseHeadings","deleteHeading"],n=t.forElement[0],o=t.menuitem[0].id;i.indexOf(o)!=-1&&DocumentMap[o](J(n).parents("[data-nav-hd]")[0])},Se=function(e,t){var i=t.forElement[0],n=J(i).parents("[data-nav-hd]")[0],o=parseInt(n.getAttribute("data-nav-hd")),r=J(n).find("span.doc-nav-marker");J("#doc-nav-more-opt").zmenu("setMenuItemsAttribute",["#newHeadingBefore","#newHeadingAfter","#newSubHeading","#promoteHeading","#demoteHeading","#expandHeadings","#collapseHeadings","#deleteHeading"],"disabled",!1);var a=[];6==o?a.push("#demoteHeading","#newSubHeading"):1==o&&a.push("#promoteHeading"),r.hasClass("doc-nav-marker-parent-nosublevel")?a.push("#expandHeadings","#collapseHeadings"):(r.hasClass("ui-icon-heading-inactive")&&a.push("#collapseHeadings"),r.hasClass("ui-icon-heading-active")&&a.push("#expandHeadings")),J("#doc-nav-more-opt").zmenu("setMenuItemsAttribute",a,"disabled",!0)};return PubSub.subscribe("Document/LoadingComplete",te),PubSub.subscribe("Document/BeforeLoad",function(){isV8Engine||"undefined"==typeof DocumentMap||DocumentMap.reInit()}),{init:j,closePane:P,refreshMap:U,clearParas:D,state:state,setState:function(e){state=e},reInit:v,headingParas:i,togglePublishPageMenu:ne,closePublishPane:ie,openPane:q,togglePane:K,documentPaneComboChange:X,getParaGroupById:h,newHeadingBefore:ge,newHeadingAfter:fe,newSubHeading:Ee,promoteHeading:Te,demoteHeading:me,expandHeadings:he,collapseHeadings:Ie,deleteHeading:_e,clickEvent:Ae,beforeMenuShow:Se,getPanelPinState:u,togglePinState:c,isVisible:function(){return r}}}();var Shortcut=function(){"use strict";var e={Open:{shortcutAction:"FileOpen.fileOpenDialog",shortcutParams:[],shortcutKey:"Ctrl+O"},Save:{shortcutAction:"FileMenu.saveFile",shortcutParams:[],shortcutKey:"Ctrl+S"},SaveAs:{shortcutAction:"UIUtils.openMakeaCopy",shortcutParams:["editor",!0],shortcutKey:"Ctrl+Shift+S"},Undo:{shortcutAction:"editor.doc.execCmd",shortcutParams:["undo"],shortcutKey:"Ctrl+Z"},Redo:{shortcutAction:"editor.doc.execCmd",shortcutParams:["redo"],shortcutKey:"Ctrl+Y"},UpdateFormula:{shortcutAction:"FormulaHandler.updateFormulasInSelection",shortcutParams:[],shortcutKey:"<F9>"},Find:{shortcutAction:"FindAdaptor.openFind",shortcutParams:"true",shortcutKey:"Ctrl+F"},Replace:{shortcutAction:"FindAdaptor.openReplace",shortcutParams:"true",shortcutKey:"Ctrl+Shift+F"},Thesaurus:{shortcutAction:"Thesaurus.insertThDlg",shortcutParams:[],shortcutKey:"Shift+<F7>"},ViewHistory:{shortcutAction:"HistoryUI.loadHistoryPage",shortcutParams:[],shortcutKey:"Ctrl+Alt+Shift+G"},ShowPilcrow:{shortcutAction:"HiddenMarkers.toggleMarker",shortcutParams:["show_non_print_symbol"],shortcutKey:"Ctrl+Shift+8"},Print:{shortcutAction:"PrintPreview.printUsingBrowser",shortcutParams:!1,shortcutKey:"Ctrl+P"},Bold:{shortcutAction:"editor.doc.execCmd",shortcutParams:"Bold",shortcutKey:"Ctrl+B"},Italic:{shortcutAction:"editor.doc.execCmd",shortcutParams:"Italic",shortcutKey:"Ctrl+I"},Underline:{shortcutAction:"editor.doc.execCmd",shortcutParams:"Underline",shortcutKey:"Ctrl+U"},LeftAlign:{shortcutAction:"editor.doc.execCmd",shortcutParams:"JustifyLeft",shortcutKey:"Ctrl+Shift+L"},CenterAlign:{shortcutAction:"editor.doc.execCmd",shortcutParams:"JustifyCenter",shortcutKey:"Ctrl+Shift+E"},RightAlign:{shortcutAction:"editor.doc.execCmd",shortcutParams:"JustifyRight",shortcutKey:"Ctrl+Shift+R"},Justify:{shortcutAction:"editor.doc.execCmd",shortcutParams:"JustifyFull",shortcutKey:"Ctrl+Shift+J"},IncreaseIndent:{shortcutAction:"editor.doc.execCmd",shortcutParams:["indent","ID"],shortcutKey:"Ctrl+M"},DecreaseIndent:{shortcutAction:"editor.doc.execCmd",shortcutParams:["outdent","rclk-list-dec-indent"],shortcutKey:"Ctrl+Shift+M"},StrikeThrough:{shortcutAction:"editor.doc.execCmd",shortcutParams:"Strikethrough",shortcutKey:"Ctrl+Shift+X"},SuperScript:{shortcutAction:"editor.doc.execCmd",shortcutParams:"Superscript",shortcutKey:"Ctrl+."},SubScript:{shortcutAction:"editor.doc.execCmd",shortcutParams:"Subscript",shortcutKey:"Ctrl+,"},UpperCase:{shortcutAction:"editor.doc.execCmd",shortcutParams:["changecase","upper"],shortcutKey:"Ctrl+Shift+A"},FormatPainter:{shortcutAction:"editor.doc.execCmd",shortcutParams:"FormatPainter",shortcutKey:"Ctrl+Shift+C"},ClearFormat:{shortcutAction:"editor.doc.execCmd",shortcutParams:["RemoveFormat"],shortcutKey:"Ctrl+\\"},Heading0:{shortcutAction:"editor.doc.execCmd",shortcutParams:["FormatBlock",0],handleOn:"keyup",shortcutKey:"Ctrl+Alt+0",windowsShortcut:{key:"Ctrl+Alt+0",handleOn:"keyup"},macShortcut:{key:"Ctrl+Alt+0",handleOn:"keydown"}},Heading1:{shortcutAction:"editor.doc.execCmd",shortcutParams:["FormatBlock",1],handleOn:"keyup",shortcutKey:"Ctrl+Alt+1",windowsShortcut:{key:"Ctrl+Alt+1",handleOn:"keyup"},macShortcut:{key:"Ctrl+Alt+1",handleOn:"keydown"}},Heading2:{shortcutAction:"editor.doc.execCmd",shortcutParams:["FormatBlock",2],handleOn:"keyup",shortcutKey:"Ctrl+Alt+2",windowsShortcut:{key:"Ctrl+Alt+2",handleOn:"keyup"},macShortcut:{key:"Ctrl+Alt+2",handleOn:"keydown"}},Heading3:{shortcutAction:"editor.doc.execCmd",shortcutParams:["FormatBlock",3],handleOn:"keyup",shortcutKey:"Ctrl+Alt+3",windowsShortcut:{key:"Ctrl+Alt+3",handleOn:"keyup"},macShortcut:{key:"Ctrl+Alt+3",handleOn:"keydown"}},Heading4:{shortcutAction:"editor.doc.execCmd",shortcutParams:["FormatBlock",4],handleOn:"keyup",shortcutKey:"Ctrl+Alt+4",windowsShortcut:{key:"Ctrl+Alt+4",handleOn:"keyup"},macShortcut:{key:"Ctrl+Alt+4",handleOn:"keydown"}},Heading5:{shortcutAction:"editor.doc.execCmd",shortcutParams:["FormatBlock",5],handleOn:"keyup",shortcutKey:"Ctrl+Alt+5",windowsShortcut:{key:"Ctrl+Alt+5",handleOn:"keyup"},macShortcut:{key:"Ctrl+Alt+5",handleOn:"keydown"}},Heading6:{shortcutAction:"editor.doc.execCmd",shortcutParams:["FormatBlock",6],handleOn:"keyup",shortcutKey:"Ctrl+Alt+6",windowsShortcut:{key:"Ctrl+Alt+6",handleOn:"keyup"},macShortcut:{key:"Ctrl+Alt+6",handleOn:"keydown"}},IncreaseFontSize:{shortcutAction:"editor.doc.execCmd",shortcutParams:"increaseFontSize",shortcutKey:"Ctrl+Shift+>"},DecreaseFontSize:{shortcutAction:"editor.doc.execCmd",shortcutParams:"decreaseFontSize",shortcutKey:"Ctrl+Shift+<"},InsertLink:{shortcutAction:"LinkDialog.openLinkPopup",shortcutParams:[],shortcutKey:"Ctrl+K"},PageBreak:{shortcutAction:"editor.doc.execCmd",shortcutParams:["inshr",{cls:"pgbrk",bid:"pgbrk"}],shortcutKey:"Ctrl+Enter"},ColumnBreak:{shortcutAction:"editor.doc.execCmd",shortcutParams:["inshr",{cls:"colbrk",bid:"colbrk"}],shortcutKey:"Ctrl+shift+Enter"},InsertEndnote:{shortcutAction:"editor.doc.execCmd",shortcutParams:["insertnote",{type:"endnote",options:{focusElement:!0}}],shortcutKey:"Ctrl+Alt+D"},InsertFootnote:{shortcutAction:"editor.doc.execCmd",shortcutParams:["insertnote",{type:"footnote",options:{focusElement:!0}}],shortcutKey:"Ctrl+Alt+F"},AddComment:{shortcutAction:"CommentManager.newComment",shortcutParams:"parent",shortcutKey:"Ctrl+Alt+M",trackActivity:!0},BulletedList:{shortcutAction:"ListOperation.applyDefaultList",shortcutParams:[2],shortcutKey:"Ctrl+Shift+U"},NumberedList:{shortcutAction:"ListOperation.applyDefaultList",shortcutParams:[1],shortcutKey:"Ctrl+Shift+O"},Fullscreen:{shortcutAction:"UIUtils.handleBrowserFullscreen",shortcutParams:[],shortcutKey:"Ctrl+<F11>"},DocumentNavPane:{shortcutAction:"DocumentMap.openPane",shortcutParams:[],shortcutKey:"Shift+<F4>"},HelpPage:{shortcutAction:"UIUtils.openExternalLinks",shortcutParams:"howto",shortcutKey:"<F1>"},ToggleTc:{shortcutAction:"TCAdaptor.toggleState",shortcutParams:[],shortcutKey:"Ctrl+Alt+t",trackActivity:!0},ToggleTcToAll:{shortcutAction:"TCAdaptor.toggleState",shortcutParams:[],shortcutKey:"Ctrl+Alt+t",trackActivity:!0},MoveToTableRowFirstCell:{shortcutAction:"TableActions.moveToTableRowFirstCell",shortcutParams:[],shortcutKey:"Alt+shift+Home",trackActivity:!0},MoveToTableRowLastCell:{shortcutAction:"TableActions.moveToTableRowLastCell",shortcutParams:[],shortcutKey:"Alt+shift+End",trackActivity:!0}},t={Open:["filemenu-open"],Save:["filemenu-save"],SaveAs:["filemenu-makeacopy"],Undo:["fmt-lpnl-undo","undo_list","undo_smart"],Redo:["fmt-lpnl-redo","redo_list","redo_smart"],UpdateFormula:["updateformula"],Find:["readonly-tb-find","sharemode-tb-find","fmt-lpnl-find"],Replace:["fmt-lpnl-replace"],Thesaurus:["tools-lpnl-thesaurus"],ViewHistory:["filemenu-viewhistory"],ShowPilcrow:["fmt-lpnl-sub-non-printing-char","fmt-lpnl-non-printing-char"],Print:["filemenu-print-chrome","filemenu-print","sharemode-tb-print-chrome","sharemode-tb-print"],Bold:["smart_bold","bold"],Italic:["smart_italic","italic"],Underline:["smart_underline","underline"],LeftAlign:["pcm-textalign","smart-textalign","sub-LEFT","LEFT"],CenterAlign:["pcm-textalign","smart-textalign","sub-CENTER","CENTER"],RightAlign:["pcm-textalign","smart-textalign","sub-RIGHT","RIGHT"],Justify:["pcm-textalign","smart-textalign","sub-JUSTIFY","JUSTIFY"],IncreaseIndent:["pcm-incindent","rclk-list-inc-indent","fmt-lpnl-incindent"],DecreaseIndent:["pcm-decindent","fmt-lpnl-decindent"],StrikeThrough:["smart_strikethrough","strikethrough"],SuperScript:["superscript"],SubScript:["subscript"],UpperCase:["fmt-lnpl-uppercase"],FormatPainter:["smart_formatpainter","fmt-lpnl-painter"],ClearFormat:["delete","smart-clearformat","fmt-lpnl-clearformat"],Heading0:["contentHeading0"],Heading1:["contentHeading1","contentHeadingListApply"],Heading2:["contentHeading2"],Heading3:["contentHeading3"],Heading4:["contentHeading4"],Heading5:["contentHeading5"],Heading6:["contentHeading6"],IncreaseFontSize:["smart-font-inc","fmt-lnpl-inc-font"],DecreaseFontSize:["smart-font-dec","fmt-lnpl-dec-font"],InsertLink:["rt_btn_ins_link","ins-lpnl-link","smart-insertlink"],PageBreak:["ins-lpnl-page-break"],ColumnBreak:["ins-lpnl-col-break"],InsertEndnote:["ins-lpnl-endnote"],InsertFootnote:["ins-lpnl-footnote"],AddComment:["rt_btn_add_comment","rt_img_add_comment","readcomment-tb-comment","ins-lpnl-cmnt","smart-addcomment"],BulletedList:["pcm-list-bullet","fmt-lpnl-sub-list-bullet","smart-fmt-lpnl-list-bullet","fmt-lpnl-list-bullet"],NumberedList:["pcm-list-number","fmt-lpnl-sub-list-number","fmt-lpnl-list-number"],Fullscreen:["bbar-enter-full-screen"],DocumentNavPane:["view-lpnl-navigatepane"],HelpPage:["help-page"],ToggleTc:[],ToggleTcToAll:[],MoveToTableRowFirstCell:[],MoveToTableRowLastCell:[]},i={Save:{permission:"document.edit"},SaveAs:{permission:"document.copy"},Undo:{permission:"document.edit"},Redo:{permission:"document.edit"},UpdateFormula:{permission:"document.edit"},Replace:{permission:"document.edit"},Thesaurus:{permission:"document.edit"},ViewHistory:{permission:"document.versions.view"},ShowPilcrow:{permission:"document.edit"},Print:{permission:"document.print"},Bold:{permission:"document.edit"},Italic:{permission:"document.edit"},Underline:{permission:"document.edit"},LeftAlign:{permission:"document.edit"},CenterAlign:{permission:"document.edit"},RightAlign:{permission:"document.edit"},Justify:{permission:"document.edit"},IncreaseIndent:{permission:"document.edit"},DecreaseIndent:{permission:"document.edit"},StrikeThrough:{permission:"document.edit"},SuperScript:{permission:"document.edit"},SubScript:{permission:"document.edit"},UpperCase:{permission:"document.edit"},FormatPainter:{permission:"document.edit"},ClearFormat:{permission:"document.edit"},Heading0:{permission:"document.edit"},Heading1:{permission:"document.edit"},Heading2:{permission:"document.edit"},Heading3:{permission:"document.edit"},Heading4:{permission:"document.edit"},Heading5:{permission:"document.edit"},Heading6:{permission:"document.edit"},IncreaseFontSize:{permission:"document.edit"},DecreaseFontSize:{permission:"document.edit"},InsertLink:{permission:"document.edit"},PageBreak:{permission:"document.edit"},ColumnBreak:{permission:"document.edit"},InsertEndnote:{permission:"document.edit"},InsertFootnote:{permission:"document.edit"},AddComment:{permission:"review.comment.add"},BulletedList:{permission:"document.edit"},NumberedList:{permission:"document.edit"},ToggleTc:{permission:"review.changes.trackself"},ToggleTcToAll:{permission:"review.changes.resolve"},MoveToTableRowFirstCell:{permission:"document.edit"},MoveToTableRowLastCell:{permission:"document.edit"}},n=function(t){return e[t]},o=function(e){var t=n(e),i=Utils.getAsFunction(t.shortcutAction),o=t.shortcutParams;i.callable(o),t.trackActivity&&PubSub.publish("Shortcut/ReportCapture",e)},r=function(){var n,o=editor.getRole().permissions,r=[];for(var a in e){if(!e.hasOwnProperty(a))return;n=e[a],i[a]&&!o.can(i[a].permission)||(n.elementIds=t[a]||[],n.actionName=a,n.action="Shortcut.execute",n.params=[a],r.push(n))}return r},a=function(){ZShortCut.addShortcuts(r(),{shownSymbol:!0})};return PubSub.subscribe("Document/AfterInit",a),{execute:o}}(),CurUtil=function(){"use strict";var e,t={},i=function(){if(editor.getRole().permissions.can("document.edit")&&!isHeadlessPDF&&editor.doc.getSelection().isCollapsed()&&editor.getRole().permissions.can("document.edit")&&!EventHandler.isMenuOpened&&!EventHandler.isDialogOpened){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");e&&e.addClass("blink")}},n=function(e,t,i){if(isV8Engine)return{};i=i||editor.doc.domCursor[t].zuid;var n=editor.doc.getUserData()||{};n=n[i]||{};var o=t!==editor.uuid,r=o&&n.color||"black",a="&#8203;",s="comment"===t?"":n.fname_HTML||"Unknown",l="z-cursor-"+e+"-"+t;o&&"comment"!==t&&(a='<div class="callout-con"><div class="callout user_name" style="background-color:'+r+";border:1px solid "+r+';color:white;font-weight:bold;">'+s+'</div><div class="callout-outer" style="border-top-color:'+r+'"><div class="callout-inner" style="border-top:5px solid '+r+';display:none;"></div></div></div>'),isIPadSafariBrowser&&!o&&(l=l+"_"+e,a='<div class="handler-callout-con" style="display:none;"><div class="handler-callout user_name handler-callout-'+e+'" style="border:1px solid;border-color: rgba(20, 119, 255,0.8);color:white;font-weight:bold;border-width: 8px;border-radius: 50%;"></div></div><div class="handler-callout zwcursor-draggable-'+e+" handler-callout-"+e+' " style="display: block;"></div>');var d=J(document.createElement("div")).attr("id","z-cursor-"+e+"-"+t).attr("id",l).addClass(o?"otherUserCollapsedCursor":"cursor").css("border-color",r).append(a).appendTo(editor.jeditorPane[0]),c=editor.getRole().permissions;return c.can("document.edit")||c.can("review.comment.add")||d.css("opacity",0),editor.doc.setDomCursorNode(t,e,d),d[0]},o=function(e,t){return e=t?J(e).closestParent(".zw-tr").find(".zw-line-div:last")[0]:J(e).closest(".zw-line-div")[0],DomViewManager.getStartIndex(e)},r=function(e){var t=(editor.jeditorPane.offset(),e.offset()),i=e.height(),n=t.left,o=t.top;return{left:n,top:o,height:i}},a=function(){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),t=r(e);return t.top=t.top+t.height,t},s=function(e){if(DomUtil.nodeNameEquals(e,"td"))return 0;e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);var t=J(e);t.hasClass("zw-space")&&(t=t.closestParent(".zw-portion")),DomUtil.nodeNameEquals(t.parent()[0],"bdo")&&(t=t.parent());var i,n=0,o=t.prev();for(!o.length&&t.parent().hasClass("zw-portion-outline")&&(o=t.parent().prev());o.length;){i=J(o);var r=o[0];if(r.classList.contains("zw-portion")||(r=r.querySelector(".zw-portion")),r&&(r.classList.contains(NODE_TYPE.FILLABLEFIELD)||r.classList.contains(NODE_TYPE.SIGNERFIELD)||r.classList.contains(NODE_TYPE.MAILMERGEFIELD)))for(var a=0;a<r.childElementCount;a++){var s=r.children[a];n+=parseInt(s.getAttribute("data-text-len")||0)}else n+=parseInt(r&&r.getAttribute("data-text-len")||0);o=i.prev()}return n},l=function(e){editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start").css("visibility",e?"visible":"hidden")},d=function(e){var i=editor.doc.getSelection(e);if(i&&i.isCollapsed()){var n=editor.doc.getDomCursorNode(e);n&&n.find(".callout-con").fadeIn(0,function(){var i=J(this);clearTimeout(t[e]),t[e]=setTimeout(function(){i.fadeOut("2500",function(){J(this).css("display","")}),delete t[e]},1e3)})}},c=function(e){if(editor.doc.getRole()!=USER_ROLE.PUBLIC&&!isHeadlessPDF){var t=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");t&&(e&&editor.doc.getSelection().isCollapsed()?t.addClass("blink"):t.removeClass("blink"))}},u=function(t){e=t},p=function(){return!!e};return PubSub.subscribe("cursor/blinkCursor",i),PubSub.subscribe("cursor/createCursor",n),PubSub.subscribe("Cursor/showCollbUserName",d),{blinkCursor:i,createCursor:n,getCursorLineOffset:o,getCursorPortionOffset:s,offset:{start:{top:0,left:0,rects:{}},end:{top:0,left:0,rects:{}}},scrollTop:0,showCollbUserName:d,stopBlinking:c,setCursorVisiblity:l,isFloatingCursor:p,setFloatingCursor:u,getCursorOffset:a}}();WC=function(e){var t=e.TABLE+"|"+e.TABLEEND+"|"+e.ROW+"|"+e.CELL+"|"+e.BR+"|"+e.TAB+"|"+e.IMAGE+"|"+e.RANGE_START+"|"+e.RANGE_END+"|"+e.SECTION_START+"|"+e.HR+"|"+e.TOCSTART+"|"+e.TOCEND,i=t+"|"+e.PARA,n=i+"|"+e.SPACE+"|"+e.MULTIBYTE_SPACE,o=function(){for(var e=DocTreeManager.getSectionsByType(SECTION_TYPES.ENDNOTE),t=DocTreeManager.getSectionsByType(SECTION_TYPES.FOOTNOTE),i="",n=e.first;n;)i+=editor.doc.getContent(n.getIndex(),n.getEndIndex()),n=n.next;for(var n=t.first;n;)i+=editor.doc.getContent(n.getIndex(),n.getEndIndex()),n=n.next;return i},r=function(){for(var e=DocTreeManager.getSectionsByType(SECTION_TYPES.TEXTBOX),t="",i=e.first;i;)t+=editor.doc.getContent(i.getIndex(),i.getEndIndex()),i=i.next;return t},a=function(){for(var e=DocTreeManager.getSectionsByType(SECTION_TYPES.CONTENT),t="",i=e.first;i;)t+=editor.doc.getContent(i.getIndex(),i.getEndIndex()),i=i.next;return t},s=function(){var e={},t=[];if(DocTreeManager.doc&&(t.push(a()),t.push(o()),t.push(r())),e.wordcount=t.reduce(function(e,t){return e+d(t)},0),e.charCountWithSpaces=t.reduce(function(e,t){return e+c(t)},0),e.charCountWithoutSpaces=t.reduce(function(e,t){return e+u(t)},0),!editor.doc.getSelection())return e;var i=editor.doc.getSelection().getStart();if(editor.doc.getSelection().isCollapsed())e.sel_wordcount=0,e.sel_charcount_withspaces=0,e.sel_charcount_withoutspaces=0;else{var n=editor.doc.getSelection().getEnd(),s=editor.doc.getContent(i,n);e.sel_wordcount=d(s),e.sel_charcount_withspaces=c(s),e.sel_charcount_withoutspaces=u(s)}return e},l=function(e){return e=e.replace(/\xa0/," "),e=e.replace(/\s{2,}/g," "),e=e.replace(/^\s+/,""),e=e.replace(/\s+$/,"")},d=function(e){var i=RegExp(t,"g");e=e.replace(i,""),e=l(e);var n=e.split(/\s+/g),o=n.length;return""==n[o-1]&&0!=o&&o--,""==n[0]&&0!=o&&o--,o},c=function(e){var t=RegExp(i,"g"),n=e.replace(t,""),o=n.length;return o},u=function(e){var t=RegExp(n,"g"),i=e.replace(t,""),o=i.length;return o};return{getNotesContent:o,getAllSectionsContent:a,getTextBoxesContent:r,getWordCountDetails:s,getWordCount:d}}(UNICODE);var RestoreResourceId;RestoreDocumentProperVersion.init=function(e){e&&(RestoreResourceId=e),UIUtils.openDialog("restoredocument")},RestoreDocumentProperVersion.restoreToNextProperVersion=function(e,t){UIUtils.closeDialog("restoredocument");var i={};e||(e=RestoreResourceId),e=e?e:editor.doc.docInfo.RID,i.rid=e,RestoreDocumentProperVersion.lastRestoreVersion&&(i.lastRestoreVersion=RestoreDocumentProperVersion.lastRestoreVersion,i.overWrite="true"),i.sid=editor.uuid,i.tstamp=(new Date).getTime(),ZWNetworkUtils.setCsrfParam(i);var n=ZWNetworkUtils.getUrl("restore");J.ajax({type:"POST",global:!1,dataType:"json",url:n,data:i,success:function(e){"FAILED"==e.RESPONSE?UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION"),J.i18n("error","OOPS"),"error",function(){var e=editor.getBaseURL()+"/ropen.do";window.open(e,"_self")}):RestoreDocumentProperVersion.lastRestoreVersion=e.RESTORE_VERSION},error:function(e,t,i){0==e.status?UIUtils.showNetworkError():UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION"),J.i18n("error","OOPS"),"error",function(){var e=editor.getBaseURL()+"/ropen.do";window.open(e,"_self")})}}),UIUtils.hideLoadingMsg()};var ExportDialog=function(){"use strict";var e,t,i={DIALOG:"exportwithpassworddlg",IFRAME:"exportErr"},n=U.once(function(){I()}),o=function(){return{include_changes:"as_markups",include_comments:window.CommentAdapter&&CommentAdapter.docHasComments()?"all":"none"}},r={type:"nonpassword",operationType:"export",track_changes:!1,format:"docx",onclick:null,init:function(){if(n(),f(),E(r.format),m(r.format),"preview"==r.operationType)e=J.i18n("writer.common.PREVIEW"),t=J.i18n("writer.conversion.PREVIEW_OPTIONS");else if("print"==r.format){var i=editor.doc.getTrackChangeDetails().getDisplayMode();i==TCConstants.NO_MARKUP_VIEW?(J("#export-changesaccepted").zstatebutton("checked",!0),J("#export-changeasmarkup").zstatebutton("checked",!1)):i==TCConstants.ALL_MARKUP_VIEW?(J("#export-changeasmarkup").zstatebutton("checked",!0),J("#export-changesaccepted").zstatebutton("checked",!1)):i==TCConstants.ORIGINAL_VIEW&&(r.set({action:"includeChanges"},!1,J("#export-includeChanges")[0]),J("#export-includeChanges").zstatebutton("checked",!1)),e=J.i18n("writer.common.PRINT_BUTTON_LABEL"),t=J.i18n("writer.conversion.PRINT_OPTIONS")}else e=J.i18n("writer.common.DOWNLOAD"),t=J.i18n("writer.conversion.DOWNLOAD_OPTIONS");J("#downloadsubmit").zbutton("setAttribute","text",e),J("#exportwithpassworddlgzdialog").zdialog("setAttribute","title",t),J("#export-confirmation-mismatch-error").hide(),J("#export-password-input-cont")["password"==this.type?"show":"hide"](),J("#export-password").attr("placeholder","**********"),editorProps.isFillableForm||J("#export-format-options").zselectbox("setOptionAttributes","pdfform","hidden",!0),Macros.isPDFDocument()&&(J("#export-format-options").zselectbox("setOptionAttributes","docx","hidden",!0),J("#export-format-options").zselectbox("setValue","pdf"))},set:function(e,t,i){if("includeChanges"===e.action){var n=J("#export-includeChanges-options");n[t?"slideDown":"slideUp"]()}else"format"===e.action&&h(t)}},a=function(e,t){var i=editor.getView();"undefined"==typeof HistoryUI||i!=EDITOR_VIEWS.HISTORY&&i!=EDITOR_VIEWS.VERSIONVIEW?e.versionid||"PUBLIC"!=editor.doc.role?editor.doc.applyConditionsForFillableFields()&&(e.applyFillConditions=!0):e.versionid=editor.doc.docInfo.VERSION_ID:e.versionid=HistoryUI.getSelectedVersionId(),"preview"==t?PrintPreview.loadPreview(e):"print"==t?PrintPreview.initiatePrint(e,!1):Export.exportAs(e)},s=function(e,t){if("print"!=e&&!Export.hasDownloadPermissionInOrg())return void Export.showReqDownloadPermissionDlg();var i=A(),n=S();if(i||n&&T(e))r.format=e,d("nonpassword",t);else{var s=o();s.format=e,a(s,t)}},l=function(){return Export.hasDownloadPermissionInOrg()?(r.format="docx",void d("password")):void Export.showReqDownloadPermissionDlg()},d=function(e,t){r.track_changes=A(),r.comments=S(),r.type=e,r.operationType=t||"export",J.dialogutil.open(i.DIALOG,void 0,r)},c=function(){J.dialogutil.close(i.DIALOG)},u=function(e){var t=o(),n=J("#"+i.DIALOG),s=n.zvalidation("validateAllFields",n);s&&(r.track_changes&&(t.include_changes=p()),r.comments&&(t.include_comments=g()),"password"==r.type?(t.format=J("#export-format-options").val(),t.password=J("#export-password").val()):t.format=r.format,c(),a(t,r.operationType))},p=function(){var e="none";return J("#export-includeChanges").is(":checked")&&(e=J("#export-changesaccepted").is(":checked")?"all":"as_markups"),e},g=function(){var e="none";return J("#export-includeComments").is(":checked")&&(e="all"),e},f=function(){var e=r.track_changes;J("#export-tc-options")[e?"show":"hide"]()},E=function(e){var t=r.comments&&T(e);J("#export-comment-options")[t?"show":"hide"]()},T=function(e){var t=!0;return"pdf"!=e&&"pdfform"!=e&&"html"!=e&&"zip"!=e||(t=!1),t},m=function(e){J("#export-options-text").hide(),J("#export-tc-options-text").hide(),J("#export-comment-text").hide(),J("#print-options-text").hide(),J("#print-tc-options-text").hide(),J("#print-comment-text").hide(),r.track_changes&&r.comments?(J("#export-options").show(),"print"==e?J("#print-options-text").show():J("#export-options-text").show()):r.track_changes?(J("#export-options").show(),"print"==e?J("#print-tc-options-text").show():J("#export-tc-options-text").show()):r.comments&&T(e)&&(J("#export-options").show(),"print"==e?J("#print-comment-text").show():J("#export-comment-text").show())},h=function(e){J("#export-options").hide(),f(),m(e),E(e)},I=function(e){ZComponents.init("#export-format-options"),J("#export-format-options").bind("zselectboxchange",function(){f()})},_=function(){var e=J("#export-password"),t=J("#export-show-password"),i=e.attr("type");"password"===i?(t.html(J.i18n("writer.common.HIDE")),e.attr("type","text")):(t.html(J.i18n("writer.common.SHOW")),e.attr("type","password")),e.focus()},A=function(){var e=!1,t=editor.doc.getTrackChangeDetails();t.getDisplayMode();return TcManager.docHasTrackedChanges()&&(e=!0),e},S=function(){return window.CommentAdapter&&CommentAdapter.docHasPrintableComments()},R=function(e){var t=/^(pdf|doc|docx|rtf|odt|txt|html|zip|epub|zdoc)$/i;return t.test(e)};return{exportAs:s,onsubmit:u,showHidePassword:_,open:l,isExportSupportedFormat:R}}();HeaderFooter=function(){var e,t,i=function(e){a(e,"ui-hf-border-blue",".ui-hf-dbl-clk"),PubSub.subscribe("Document/HeaderMouseLeave",n)},n=function(e){s(e,"ui-hf-border-blue",".ui-hf-dbl-clk"),PubSub.unsubscribe("Document/HeaderMouseLeave",n)},o=function(e){a(e,"ui-hf-border-blue",".ui-hf-dbl-clk"),PubSub.subscribe("Document/FooterMouseLeave",r)},r=function(e){s(e,"ui-hf-border-blue",".ui-hf-dbl-clk"),PubSub.unsubscribe("Document/FooterMouseLeave",r)},a=function(i,n,o){var r=i.currentTarget||i.srcElement,a=J(r);clearTimeout(e),e=setTimeout(function(){var e=a.find(o);a.addClass(n),e.show(),t=setTimeout(function(){e.hide()},1500)},500)},s=function(i,n,o){var r=i.currentTarget||i.srcElement,a=J(r);clearTimeout(e),clearTimeout(t),a.find(o).hide(),a.removeClass(n)},l=function(){PubSub.subscribe("Document/HeaderMouseEnter",i),PubSub.subscribe("Document/FooterMouseEnter",o),PubSub.subscribe("Document/SectionChanged",c)},d=function(){PubSub.unsubscribe("Document/HeaderMouseEnter",i),PubSub.unsubscribe("Document/FooterMouseEnter",o),PubSub.unsubscribe("Document/HeaderMouseLeave",n),PubSub.unsubscribe("Document/FooterMouseLeave",r)},c=function(e){HF_SECTIONS.contains(e)?d():editor.editable&&l()},u=function(e){e?l():d()};PubSub.subscribe("Document/EditPermissionChanged",u)}();var ZWComponentUtil=function(){"use strict";var e=[],t=function(t,i,n){if(e.indexOf(t)==-1){var o=Z(t);o[0]?(r(o,i,n),e.push(t)):i&&i()}},i=function(t){t&&e.push(t)},n=function(t){if(t){var i=e.indexOf(t);i!=-1&&e.splice(i,1)}},o=function(){return e},r=function(e,t,i){t=t||null,i=i||"ctype";var n=function(){"undefined"!=typeof UIStateHandler&&UIStateHandler.build(e[0]),t&&t()};ZComponents.init(e,n,i)};return{init:t,addComponentToList:i,removeComponentFromList:n,getInitializedComponentList:o,initElem:r}};ZWComponentUtil=ZWComponentUtil(),function(e){"use strict";e.ZRange=function(e,t){this.start=e||0,this.end=t||this.start},ZRange.prototype.containsRange=function(e){return this.start<=e.start&&e.end<=this.end},ZRange.prototype.overlapsRangeAtEnd=function(e){return e.start<=this.end&&this.end<=e.end},ZRange.prototype.overlapsRangeAtStart=function(e){return e.start<=this.start&&this.start<=e.end},ZRange.prototype.overlapsRange=function(e){return this.overlapsRangeAtStart(e)||this.overlapsRangeAtEnd(e)},ZRange.prototype.strictlyContainsRange=function(e){return this.start<e.start&&e.end<this.end},Object.defineProperties(ZRange.prototype,{length:{get:function(){return Math.abs(this.end-this.start)}}})}(window);var OpUtil=function(e,t,i,n,o){"use strict";var r=function(t,i){if(t){var r=[UNICODE.RANGE_START,UNICODE.RANGE_END,UNICODE.FIELD_SEPARATOR],a=e.doc.getCharAt(t);if(ZWArrayUtils.arrayContains(r,a)){var s={};if(i||(i=e.doc.getRawFormatAt(t)),a===UNICODE.FIELD_SEPARATOR)for(var l,d=t;(d=e.doc.findNextIndexOf(UNICODE.RANGE_END,d))!=-1;){if(l=e.doc.getRawFormatAt(d),l&&l.id==i.id){s.type="conditionalmerge",s.start=n.getRangeStart(d),s.end=d;break}d++}else i.type==o.CONDITIONAL_IF_START||i.type==o.CONDITIONAL_IF_END?s.type="conditionalmerge":s.type=i.type,a===UNICODE.RANGE_START?(s.start=t,s.end=n.getRangeEnd(t)):(s.start=n.getRangeStart(t),s.end=t);if(s.start&&s.end)return s}}},a=function(){var n,r,a,s=this.specialNodes,l=this.idsMap,d=this.ops,c=this.rng.start,u=this.rng.end;if(s&&(n=Object.keys(s))&&n.length)for(var p=0;p<n.length;p++){var g=n[p],f=s[g];(f.type==o.LINK||f.type==o.BOOKMARK&&g.indexOf("toc")==-1)&&(f.start<c?(a=t.randomString(),r=i.clone(e.doc.getRawFormatAt(f.start)),l[r.id]&&(r.id=l[r.id]),d.splice(1,0,{as:{start:r,id:a}},{is:UNICODE.RANGE_START},{as:{end:i.getKeys(r),id:a}})):f.end>u&&(a=t.randomString(),r=i.clone(e.doc.getRawFormatAt(f.end)),l[r.id]&&(r.id=l[r.id]),d.push({as:{start:r,id:a}}),d.push({is:UNICODE.RANGE_END}),d.push({as:{end:i.getKeys(r),id:a}})))}},s=function(e,t,i){var n=!0,r=t[e.id];return r&&r.type!=o.LINK&&(r.type!=o.BOOKMARK||r.type==o.BOOKMARK&&e.id.indexOf("toc")!=-1)&&(r.start>=i.start&&r.end<=i.end||(n=!1)),n},l=function(l,d){var c={};if(c.rng=l,c.val=l.start<l.end?l.getContent():"",c.idsMap=d||{},c.noteIdsList=[],c.textBoxIdsList=[],c.cursorStyle=n.getTextStyle(l.start),c.ops=[],c.sectionOps=[],c.selectedOps={},c.start=0,c.end=c.val.length,c.startIdx=c.start,c.specialNodes={},c.val&&c.val.length){c.ops.push({r:l.start});for(var u,p,g,f,E,T,m=c.start;m<c.end;m++){if(u=null,p=null,g=null,f=null,E=null,T=null,u=e.doc.getRawFormatAt(l.start+m))f=i.clone(u);else{if(0!=c.startIdx||i.isEmptyObject(c.cursorStyle))throw"error";f=c.cursorStyle,c.cursorStyle={}}f.id&&!c.idsMap[f.id]&&f.type!=o.COMMENT&&(p=t.randomString(),f.type===o.ENDNOTE||f.type===o.FOOTNOTE||f.cls&&(f.cls===o.ENDNOTE||f.cls===o.FOOTNOTE)?(p="zw"+p,c.noteIdsList.push(f.id)):f.subType===o.TEXTBOX?c.textBoxIdsList.push(f.id):f.type===o.BOOKMARK&&f.id.indexOf("toc")!=-1&&(p="toc_"+p),c.idsMap[f.id]=p),c.specialNodes[f.id]||(T=r(l.start+m,f),T&&(c.specialNodes[f.id]=T));for(var h=m+1;!e.doc.getRawFormatAt(l.start+h)&&h<c.end;)h++;m=h-1,s(f,c.specialNodes,l)&&(g=c.val.substring(c.startIdx,m+1),f.id&&c.idsMap[f.id]?f.id=c.idsMap[f.id]:f.sid&&c.idsMap[f.sid]?f.sid=c.idsMap[f.sid]:f.fieldinfo&&c.idsMap[f.fieldinfo]&&(f.fieldinfo=c.idsMap[f.fieldinfo]),E=t.randomString(),c.ops.push({as:{start:f,id:E}}),c.ops.push({is:g}),c.ops.push({as:{end:i.getKeys(f),id:E}})),c.startIdx=m+1}}c.ops=NamedRange.getInsertionOps(l,c.ops),a.call(c),c.selectedOps.ops=c.ops;var I,_,A,S,R,O=[];for(I=0;I<c.noteIdsList.length;I++)_=DocTreeManager.getSectionWithSid(c.noteIdsList[I]),_&&(S=e.doc.createRange(_.start,_.end),R=OpUtil.getInsertionOps(S,c.idsMap).ops,R[0].r=e.doc.getContent().length,O.push(R));for(I=0;I<c.textBoxIdsList.length;I++)A=DocTreeManager.getSectionWithSid(c.textBoxIdsList[I]),A&&(S=e.doc.createRange(A.start,A.end),R=OpUtil.getInsertionOps(S,c.idsMap).ops,R[0].r=e.doc.getContent().length,O.push(R));return O.length&&(c.selectedOps.sectionOps=O),c.selectedOps},d=function(e,i){for(var r,a=function(e,i){var n=[],o=t.randomString();return Array.prototype.push.apply(n,[{as:{start:i,id:o}},{is:e},{as:{end:Object.keys(i),id:o}}]),n},s=[],l=e.length,d="",c=0,u=e.indexOf("«",c);u!=-1;){if(c<u){d=e.substring(c,u);var p=a(d,i);Array.prototype.push.apply(s,p)}var g=e.indexOf("»",u);if(g==-1)throw new Error("Incorrect text provided: Range character mismatch.");var f=e.substring(u+1,g),E=MailMergeFieldUtil.getFieldIdFromName(f),T=MailMergeFieldUtil.getFieldInfo(E);if(!T)throw new Error("Incorrect text provided: No such field info found.");var m=t.randomString();r=t.randomString(),s.push({as:{start:{type:o.MAILMERGEFIELD,id:m,ftype:o.MAILMERGEFIELD,mminfo:T},id:r}}),s.push({is:UNICODE.RANGE_START}),s.push({as:{end:["type","id","ftype","mminfo"],id:r}});var h=n.copyStyle(i);h[ATTR_COMMON.CLS]=o.MAILMERGEFIELD,h[ATTR_COMMON.FIELDINFO]=m;var I=a(ZWUtils.getMergeFieldName(T),h);Array.prototype.push.apply(s,I),r=t.randomString(),s.push({as:{start:{type:o.MAILMERGEFIELD,id:m,ftype:o.MAILMERGEFIELD},id:r}}),s.push({is:UNICODE.RANGE_END}),s.push({as:{end:["type","id","ftype"],id:r}}),c=g+1,u=e.indexOf("«",c)}if(c<l){d=e.substring(c,l);var _=a(d,i);Array.prototype.push.apply(s,_)}return s},c=function(e,i){var n=DocLayoutManager.getViewAtIdxWithType(e,VIEW.PARA).getNode(),o=DocTreeManager.getSectionAtIndex(e);if(o.getSectionType()===SECTION_TYPES.CONTENT){var r=o.getStylesForNewSection(i),a=t.randomString(),s=t.randomString(),l=[{r:e},{as:{start:n.format,id:a}},{is:UNICODE.PARA},{as:{end:Object.keys(n.format),id:a}},{as:{start:r,id:s}},{is:UNICODE.SECTION_START},{as:{end:Object.keys(r),id:s}}];Op.processMsg(l)}};return{getInsertionOps:l,getInsertionOpsForText:d,createContentSectionOps:c}}(editor,Utils,ZWJSONUtils,DocUtil,NODE_TYPE),ZWSelectionUtils=function(){for(var e=Array.prototype.slice,t=" "+UNICODE.BR,i=UNICODE.PARA+UNICODE.IMAGE+UNICODE.TAB,n='`~!@#$%^&*()–—-_+=|{}[];:"“�?/?\\.,„<«»>¿¡',o=[UNICODE.TABLE,UNICODE.TABLEEND,UNICODE.ROW,UNICODE.CELL,UNICODE.SECTION_START,UNICODE.SECTION_END,UNICODE.RANGE_START,UNICODE.RANGE_END,UNICODE.TOCEND,UNICODE.TOCSTART,UNICODE.IMAGE,UNICODE.HR],r={},a={},s=0,l=t.length;s<l;s++)r[t[s]]=1;for(var s=0,l=o.length;s<l;s++)r[o[s]]=1,a[o[s]]=1;for(var d=i+n,s=0,l=i.length+n.length;s<l;s++)r[d[s]]=1;var c=function(e){return e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FILLABLEFIELD||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.SIGNERFIELD||e===NODE_TYPE.PLACEHOLDER||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE},u=function(e,t){if(!e)return!1;var i=t.start,n=t.end,o=e.getIndex(),r=e.getEndIndex();return o<n&&i<=r},p=function(e,t,i,n,o){var r=ZWSelectionUtils.getLayer(e,n,o);J(r).appendTo(t).css({width:i.width,height:i.height,top:i.top||0,left:i.left||0})},g=function(e,t){var i=DomViewManager.getDOMElem(t);if(!i||!i.parentNode)return e;for(var n=DocLayoutManager.getRectsFromDocViews([t]),o=0;o<n.length;o++){var r=n[o],a=DomViewManager.getDOMElemById(r.id),s=DomViewManager.getDOMElemById(r.parentId);if(!a||!s)return;var d=DomViewManager.getDTNode(s);if(!d)return;if(PubSub.publish("ZWRange/ClearSelection",e,a),d.type===NODE_TYPE.ROW){var c=t.getNode().getIndex(),u=t.getColumn().getId()||t.getPage().getId(),g=J(a).find("div.zw-cell-container:first")[0]||void 0;for(l=0;l<r.rects.length;l++){var f=r.rects[l];0==f.width&&(f.width+=10),p(e,g,f,c+l,u)}}}return e},f=function(e,t,i){var n="_"+e.id+"_"+t+"_"+(i&&i.substring("page_".length)||""),o={"background-color":e.color};return e.type===ZWRange.TYPE.SPELLCHECK?(o["border-bottom"]="2px dotted red",o.opacity=1):e.type===ZWRange.TYPE.HISTORY_HIGHLIGHT||e.type===ZWRange.TYPE.NAMED_RANGE_HIGHLIGHT?o["background-color"]="transparent":(o["border-bottom"]="",o.opacity=""),"NamedRange"===e.SID&&(o["background-color"]="transparent",e.class="ui-vhistory-highlight-anim"),J("<div class='overlay"+(e.collaborator?" collaborator "+e.SID:"")+(e.type==ZWRange.TYPE.FIND?" zw-find":"")+"' id='"+n+"' data-range-info='"+JSON.stringify({SID:e.SID,id:e.id})+"'/>").addClass(e.class).css(o)[0]},E=function(e,t){var i;if(e<=1)return 1;if(e--,R(editor.doc.getCharAt(e),t)){for(e--;e>0&&_(editor.doc.getCharAt(e));)e--;return e+1}for(;e>0&&A(editor.doc.getCharAt(e));)e--;for(;e>0&&ZWSelectionUtils.isWordBoundaryCharacter(editor.doc.getCharAt(e));)e--;for(;(e>0&&!ZWSelectionUtils.isBoundaryCharacter(editor.doc.getCharAt(e),t)||i&&i.type===NODE_TYPE.NAMED_RANGE)&&(e--,!ZWSelectionUtils.isCJKWordBoundaryChar(editor.doc.getCharAt(e)));)i=editor.doc.getRawFormatAt(e);return e+1},T=function(e){var t,i=editor.doc.getSectionEnd(e);if(R(editor.doc.getCharAt(e))){for(e++;e<i&&_(editor.doc.getCharAt(e));)e++;return e}for(;e<i&&A(editor.doc.getCharAt(e));)e++;for(;e<i&&ZWSelectionUtils.isWordBoundaryCharacter(editor.doc.getCharAt(e));)e++;for(;e<i&&(!ZWSelectionUtils.isBoundaryCharacter(editor.doc.getCharAt(e))||t&&t.type===NODE_TYPE.NAMED_RANGE)&&(e++,!ZWSelectionUtils.isCJKWordBoundaryChar(editor.doc.getCharAt(e)));)t=editor.doc.getRawFormatAt(e);return e},m=function(e,t){var i=r[e]||0;return i&&t&&(i=!(n.indexOf(e)>=0)),i},h=new RegExp(WORD_BREAK_CHAR,"gm"),I=function(e){return h.lastIndex=0,h.test(e)},_=function(e){return n.indexOf(e)>=0},A=function(e){return a[e]||0},S=function(e){return t.indexOf(e)>=0},R=function(e,t){var n=t?i:d;return n.indexOf(e)>=0},O=function(){return"undefined"!=typeof EventHandler},b=function(t){if(!t.collaborator){var i=e.call(arguments);i.splice(0,1),PubSub.publish.apply(null,i)}},v=function(e){return null===e||"undefined"==typeof e||(Array.isArray(e)?0===e.length:"object"==typeof e?0===Object.keys(e).length:void 0)},D=function(e){e._.isMultipleTablesSelected=e._.isPartialTableSelected=e._.isPartialTableSelectedFromBottom=e._.isPartialTableSelectedFromTop=e._.isSelectionWithinTable=!1,e._.selectedCells=[];var t=e.start,i=e.end,n=DocTreeManager.getParents(NODE_TYPE.CELL,e.start),o=DocTreeManager.getParents(NODE_TYPE.CELL,e.endChar===UNICODE.CELL||e.endChar===UNICODE.ROW?e.end-1:e.end),r=n&&n.parent.parent,a=o&&o.parent.parent,s=editor.doc.getSelection(e.SID);if(r&&!a)L(e,!0);else if(!r&&a)P(e,!0);else if(r&&a){var l=DocTreeManager.getParentCells(n),d=DocTreeManager.getParentCells(o);if(n.id===o.id)(e._.isRowSelection||e._.isColumnSelection||e._.isCellSelection||s.isRowSelection)&&(e.getCells().forEach(function(t){DocLayoutManager.getViews(t).forEach(function(t){e.selectCells(t)})}),e._.isSelectionWithinTable=!0,e._.isRowSelection=e._.isColumnSelection=e._.isCellSelection=!1);else if(F(l,d))P(e);else if(N(l,d))L(e);else{var c=C(DocTreeManager.getParentTables(e.start),DocTreeManager.getParentTables(e.end));if(c)n=y(c,l),o=y(c,d),e.setStart(n.getIndex()+1),e.setEnd(o.getEndIndex()+1),e._.isSelectionWithinTable=!0;else{var s=editor.doc.getSelection(e.SID),u=s.getParents(NODE_TYPE.ROW);e.setStart(u.getStart()+2);var p=s.getParents(NODE_TYPE.ROW,!0);e.setEnd(p.getEnd()),e._.isMultipleTablesSelected=!0}}}if(!isV8Engine&&t!==e.start){var g=e.getStartPortionNode();g&&editor.doc.setCursorPortionNode(e.SID,"start",g)}if(!isV8Engine&&i!==e.end){var f=editor.doc.getPortionData(e.end-1,editor.getPageID()),E=f&&f.node;E&&editor.doc.setCursorPortionNode(e.SID,"end",E)}},L=function(e,t){var i=DocTreeManager.getTreeNodeAtIndex(e.start);i=t?ZWArrayUtils.lastElementOf(i.getParents(NODE_TYPE.ROW)):i.getParent(NODE_TYPE.ROW),e.setStart(i.getIndex()+1+1),e._.isPartialTableSelected=!0,e._.isPartialTableSelectedFromTop=!0},N=function(e,t){var i,n=t[0];for(i=0;i<e.length;i++)if(e[i].id==n.id)return!0;return!1},P=function(e,t){if(e.startChar==UNICODE.TABLE&&e.setStart(e.start+1+1+1+1),e.endChar!==UNICODE.ROW&&e.endChar!==UNICODE.TABLEEND){var i=DocTreeManager.getTreeNodeAtIndex(e.end);i=t?ZWArrayUtils.lastElementOf(i.getParents(NODE_TYPE.ROW)):i.getParent(NODE_TYPE.ROW),e.setEnd(i.getEndIndex()+1)}e._.isPartialTableSelected=!0,e._.isPartialTableSelectedFromBottom=!0},C=function(e,t){for(var i=e.length-1,n=t.length-1;i>=0&&n>=0&&e[i].id===t[n].id;)i--,n--;return e[i+1]},y=function(e,t){var i,n;for(n=0;n<t.length;n++)if(t[n].parent.parent.id==e.id){i=t[n];break}return i},F=function(e,t){var i,n=e[0];for(i=0;i<t.length;i++)if(t[i].id==n.id)return!0;return!1};return{isField:c,isNodeInRange:u,drawTableCell:g,getLayer:f,getWordStart:E,getWordEnd:T,isBoundaryCharacter:m,isCJKWordBoundaryChar:I,isWordBoundaryCharacter:S,isEventhandlerSupported:O,publishEvent:b,isEmpty:v,updateTablesInRange:D,isSplChars:_}}(),ZWRange=function(){"use strict";var e={NONE:0,DOWN:1,UP:2},t=new ZWConsole,i=function(t,n,o){t=t||1,n=n||t,ZRange.call(this,Math.min(t,n),Math.max(t,n)),this.id="RNG_"+("x"+Math.random()).replace(/\D/g,""),this._={focus:!0,isFooterActvied:void 0,isHeaderActived:void 0,isHeaderRowActived:void 0,isMultipleTablesSelected:!1,isPartialTableSelected:!1,isPartialTableSelectedFromBottom:!1,isPartialTableSelectedFromTop:!1,isSelectionWithinTable:!1,scrollDirection:e.NONE,SID:o||editor.uuid,selectedCells:[],type:i.TYPE.SELECTION,isColumnSelection:!1,isRowSelection:!1,isSelectionRedrawing:!1};var r={},a=this;Object.defineProperties(this._,{userData:{get:function(){return ZWSelectionUtils.isEmpty(r)&&extend(r,S(a.SID)||{})||r},set:function(){r={}}}})};i.prototype=Object.create(ZRange.prototype),i.prototype.constructor=i,Object.defineProperties(i.prototype,{collaborator:{get:function(){return this.SID!==editor.uuid&&"NamedRange"!==this.SID}},collapsed:{get:function(){return this.start===this.end}},color:{get:function(){return this.type===i.TYPE.COMMENT?"#1477FF":this.type===i.TYPE.SPELLCHECK?"transparent":this.collaborator&&this._.userData.color||""}},endChar:{get:function(){return editor.doc.getCharAt(this.end)}},endRawFormat:{get:function(){return editor.doc.getRawFormatAt(this.end)}},length:{get:function(){return this.end-this.start}},SID:{get:function(){return this._.SID},set:function(e){e!==this._.SID&&(this._.userData={},this._.SID=e)}},startChar:{get:function(){return editor.doc.getCharAt(this.start)}},startRawFormat:{get:function(){return editor.doc.getRawFormatAt(this.start)}},stringify:{get:function(){return JSON.stringify(editor.doc.getContent(this.start,this.end))}},type:{get:function(){return this._.type},set:function(e){this._.type=e}},ZUID:{get:function(){return this._.userData.zuid},set:function(e){this._.userData.zuid=e}},focus:{get:function(){return this._.focus},set:function(e){this._.focus=e}}}),i.prototype.addSubscriber=function(){return this.collapsed||PubSub.subscribe([DOCVIEW.PARAVIEW_AFTER_CREATE,DOCVIEW.CELLVIEW_AFTER_CREATE],this.drawSelection,{context:this}),this},i.prototype.cloneRange=function(e){return editor.doc.createRange(this.start,this.end,e||this.SID)},i.prototype.createOp=function(e){var t={type:"cursor",zuid:e||editor.zuid},i=Utils.randomString();return[{r:this.start},{as:{start:t,id:i}},{r:this.length},{as:{end:ZWJSONUtils.getKeys(t),id:i}}]},i.prototype.deleteContentsInRange=function(){var e=this.start,t=this.end;editor.doc.getContent(e,t)!=UNICODE.HR&&(e=_(this,e),t=_(this,t),this.setStart(e),this.setEnd(t));var i=editor.doc.getCharAt(t);if(this.isEOPOnlySelected()&&(i==UNICODE.TABLE||i==UNICODE.HR||i==UNICODE.TOCSTART))return this;var n=this.getNodes(NODE_TYPE.PARAGRAPH)||[];if(n.length>1){if(DocTreeViewManager.getNoteRanges(NODE_TYPE.ENDNOTE,e,t).length>1||DocTreeViewManager.getNoteRanges(NODE_TYPE.FOOTNOTE,e,t).length>1)return void PubSub.publish("Document/Warning",WARNING_MSG.OPERATION_NOT_ALLOWED);if(n[0].getStart()!==e&&n[0].getEnd()-1!==e){var o=n[0].getEnd();this.deleteContents(e,o-1),e=o}}if(this.isTableOnlySelected())m(this,this.getSelectedDocCells()),this._.selectedCells=[],this._.cellsInRange=[],this._.cellsList={};else if(this.isMultipleTablesSelected()){var r=e,a=t,s=aRNG.getSelectedDocCells();m(this,s[0],function(e){e.getEnd()>r&&(r=e.getEnd())}),m(this,s[1],function(e){e.getStart()<a&&(a=e.getStart())});this.deleteContents(r+1,a-3)}else if(this.isPartialTableSelected()){var r=e,a=t;m(this,this.getSelectedDocCells(),function(e){e.getStart()<a&&(a=e.getStart()),e.getEnd()>r&&(r=e.getEnd())}),e<a&&a<t?this.deleteContents(e,a-3):this.deleteContents(r+1,t)}else this.deleteContents(e,t)};var n=function(e,t){t&&t.length&&Op.processMsg([{r:e},{ds:t}])};i.prototype.deleteContents=function(e,t){if(!e||!t)return this;var i=editor.doc.getCharAt(e),o=editor.doc.getCharAt(t),r=editor.doc.getSectionStart(e)+1,a=editor.doc.getSectionEnd(e);Utils.isTrailSurrogateChar(i)&&e>r&&Utils.isLeadSurrogateChar(editor.doc.getCharAt(e-1))&&(e-=1),Utils.isTrailSurrogateChar(o)&&(t+=1);var s=editor.doc.getTrackChangeDetails(),l=s.getProcessingTC();if(s.setProcessingContentDeletion(!0),t+1==a){var d=DocTreeManager.doc.getSection(r).getSectionType();PubSub.publish("ZWSelection/BeforeClearSection",d)}if(t==a){if(e==r){var c=editor.doc.createElement(NODE_TYPE.PARAGRAPH);c.setStart(r),c.setEnd(r+1),c.insert();var u=[{r:e},{ds:editor.doc.getContent(e,t)}];if(Op.processMsg(u),/zw-contentpane/.test(editor.clientActiveSection&&editor.clientActiveSection.id||""))for(var p=editor.doc.findNextIndexOf(UNICODE.SECTION_START,e);p!=-1;){var g=editor.doc.getSectionEnd(p),f=editor.doc.getRawFormatAt(p),d=f[ATTR_SECTION.ST];ZWArrayUtils.arrayContains([CONST.HEADER_EVEN,CONST.HEADER_PRIMARY,CONST.FOOTER_EVEN,CONST.FOOTER_PRIMARY,CONST.HEADER_FIRST,CONST.FOOTER_FIRST],parseInt(d||-1))||(u=[{r:p},{ds:editor.doc.getContent(p,g)}],Op.processMsg(u)),p=editor.doc.findNextIndexOf(UNICODE.SECTION_START,g)}return s.setProcessingContentDeletion(!1),this}e++}for(var E,T,m=!1,h="",I=e;I<t;I++){var _=editor.doc.getCharAt(I);switch(UNICODE.TOCSTART==_&&(n(I-h.length,h),h=""),!l||I!==E&&I!==T||(n(I-h.length,h),h="",E=T=void 0),_){case UNICODE.TOCSTART:var A=editor.doc.findNextIndexOf(UNICODE.TOCEND,e);Toc.deleteTOC(),I=A;break;case UNICODE.TOCEND:var S=editor.doc.findPreviousIndexOf(UNICODE.TOCSTART,e);S>0&&S>=e?h+=_:m=!0;break;case UNICODE.TABLE:var R=TableUtil.getTableEnd(I+1);R>0&&R<=t?h+=_:m=!0;break;case UNICODE.ROW:var O=TableUtil.getRowEnd(I+1);O>0&&O<=t?h+=_:m=!0;break;case UNICODE.CELL:var b=TableUtil.getCellEnd(I+1);b>0&&b<=t?h+=_:m=!0;break;case UNICODE.TABLEEND:var v=TableUtil.getTableStart(I);v>0&&v>=e?h+=_:m=!0;break;case UNICODE.RANGE_START:var D=DocUtil.getRangeEnd(I),f=editor.doc.getRawFormatAt(I);D<t?(f&&f.type==NODE_TYPE.BOOKMARK&&f.id&&f.id.indexOf("toc_")==-1&&(delete editor.bookmarks[f.id],PubSub.publish("Bookmarkbutton/update")),h+=_):m=!0;break;case UNICODE.RANGE_END:var L=DocUtil.getRangeStart(I);if(L>=e){h+=_;var f=editor.doc.getRawFormatAt(I);if(f){var N=f.type;if(N==NODE_TYPE.ENDNOTE||N==NODE_TYPE.FOOTNOTE){var P=editor.doc.getFloatElement(N,f.id);P.section.remove()}}}else m=!0;break;case UNICODE.PARA:var f=editor.doc.getRawFormatAt(I);if(0!=I){var C=editor.doc.getCharAt(I-1),y=h[h.length-1];if(C==UNICODE.TABLEEND&&y!=UNICODE.TABLEEND){var F=editor.doc.findNextIndexOf(CONT_REGEXP.PARAEND,I);if(F>t)break}else if(editor.doc.getCharAt(I+1)===UNICODE.TOCEND){var S=editor.doc.findPreviousIndexOf(UNICODE.TOCSTART,e);if(S>0&&S>=e){m=!0;break}}}default:var f=editor.doc.getRawFormatAt(I);if(f){var d=f[ATTR_SECTION.ST];if(ZWArrayUtils.arrayContains([CONST.HEADER_EVEN,CONST.HEADER_PRIMARY,CONST.FOOTER_EVEN,CONST.FOOTER_PRIMARY,CONST.HEADER_FIRST,CONST.FOOTER_FIRST],parseInt(d||-1)))throw editor.lastError=new Error(ZWCollaboration.SHOW_SELECTION_ERROR),ZWLogger.log("_"+editor.lastError.message+"_SHOW_SELECTION_ERROR Given range: ["+e+", "+t+"], Last Op: "+editor.lastOperation+"\nException: Trying to delete a Header / Footer section character format @"+I+" is "+JSON.stringify(f)),editor.lastError;"image"==f.type&&"textbox"==f.subType&&TextBoxHandler.removeTextBoxSection(f.id),"image"==f.type&&PubSub.publish("ZWSelection/ImageDeleted",f)}h+=_}m&&(n(I-h.length,h),h="",m=!1)}if(h.length>0&&(n(I-h.length,h),h=""),s.setProcessingContentDeletion(!1),e>r){var M=DocUtil.getTextStyle(e),w=editor.doc.getCharAt(e);M&&w!=UNICODE.PARA&&(this.tempCursorFormat=M)}return this},i.prototype.updateCellsInrange=function(){var e=[];this._.cellsInRange=[],this._.cellsList={};var t=h(this.start);if(!t)return e;var i=h(this.end);if(!i)return e;var n,o=t.getMatrixPosition(),r=i.getMatrixPosition(),a=Math.min(o[0],r[0]),s=Math.max(o[0],r[0]),l=Math.min(o[1],r[1]),d=Math.max(o[1],r[1]),c=t.parent.parent,u=A(this.start),p={};if(0===a&&0===l&&s===c.children.length-1&&d===u.children.length-1){c.children.forEach(function(t){e=ZWArrayUtils.union([e,t.children])}),this._.cellsInRange=e;for(var g=0;g<e.length;g++)n=e[g],p[n.getId()]=n;return void(this._.cellsList=p)}var f=I(c,{top:a,left:l,bottom:s,right:d,cells:[]});this._.cellsInRange=f.allCells,this._.cellsList=f.cellsList},i.prototype.getCells=function(){return this._.cellsInRange||[]},i.prototype.getCellsList=function(){return this._.cellsList||{}},i.prototype.isTableInRange=function(){return!!DocTreeManager.doc.getNodesBetweenIndex(NODE_TYPE.TABLE,this.start,this.end).length},i.prototype.getContent=function(){return editor.doc.getContent(this.start,this.end)},i.prototype.getEndPortionData=function(e){var t=this.start,i=this.end,n=DocLayoutManager.getSectionViewAtIndex(t),o=DocLayoutManager.getSectionViewAtIndex(i);return n.getSectionType()!==o.getSectionType()&&(i=i-1>0?i-1:i),editor.doc.getPortionData(i,e||editor.getPageID())},i.prototype.getEndPortionNode=function(e){var t=this.getEndPortionData(e);return t&&t.node||void 0},i.prototype.getNodes=function(e){var t=[],i=editor.doc.getSelection(this.SID);if(i.isTableSelected())return i.getSelectedCells().forEach(function(i){for(var n=i.children(),o=0,r=n.length;o<r;o++){var a=n[o];if(e==NODE_TYPE.TEXT){var s=a.getEnd(),l=editor.doc.getNodesInSelection(e,a.getStart(),s);t=t.concat(l)}else e==NODE_TYPE.PARAGRAPH&&t.push(a)}}),t;var n=this.start,o=this.end;if(this.isMultipleTablesSelected()){var r=n,a=o,s=this.getSelectedDocCells(),l=[];return s[0].forEach(function(i){for(var n=i.children(),o=0,a=n.length;o<a;o++){var s=n[o];if(e==NODE_TYPE.TEXT){var l=s.getEnd(),d=editor.doc.getNodesInSelection(e,s.getStart(),l);t=t.concat(d)}else e==NODE_TYPE.PARAGRAPH&&t.push(s)}i.getEnd()>r&&(r=i.getEnd())}),s[1].forEach(function(t){for(var i=t.children(),n=0,o=i.length;n<o;n++){var r=i[n];if(e==NODE_TYPE.TEXT){var s=r.getEnd(),d=editor.doc.getNodesInSelection(e,r.getStart(),s);l=l.concat(d)}else e==NODE_TYPE.PARAGRAPH&&l.push(r)}t.getStart()<a&&(a=t.getStart())}),t=t.concat(editor.doc.getNodesInSelection(e,r+1,a-3)),t=t.concat(l)}if(this.isPartialTableSelected()){var r=n,a=o;if(this.getSelectedDocCells().forEach(function(i){for(var n=i.children(),o=0,s=n.length;o<s;o++){var l=n[o];if(e==NODE_TYPE.TEXT){var d=l.getEnd(),c=editor.doc.getNodesInSelection(e,l.getStart(),d);t=t.concat(c);}else e==NODE_TYPE.PARAGRAPH&&t.push(l)}i.getStart()<a&&(a=i.getStart()),i.getEnd()>r&&(r=i.getEnd())}),n<a&&a<o){var d=editor.doc.getNodesInSelection(e,n,a-3);t=d.concat(t)}else t=t.concat(editor.doc.getNodesInSelection(e,r+1,o));return t}var c=[],u=DocTreeViewManager.getNoteRanges(NODE_TYPE.ENDNOTE,n,o),p=DocTreeViewManager.getNoteRanges(NODE_TYPE.FOOTNOTE,n,o),g=[];if(u.length||p.length){g=u.length?u:p;var f,E,T=0;for(g.length;T<g.length;T++)E=g[T],f=editor.doc.getNodesInSelection(e,E.start,E.end),c=c.concat(f);return c}return editor.doc.getNodesInSelection(e,n,o)},i.prototype.getStartPortionData=function(e){return editor.doc.getPortionData(this.start,e||editor.getPageID())},i.prototype.getStartPortionNode=function(e){var t=this.getStartPortionData(e);return t&&t.node||void 0},i.prototype.isEOPOnlySelected=function(){var e=this.start,t=this.end;return t-e==1&&editor.doc.getContent(e,t)==UNICODE.PARA},i.prototype.isIntersectWithRange=function(e){return this.start<=e.end&&this.end>=e.start||e.start-this.end===2&&editor.doc.getCharAt(this.end)===UNICODE.ROW&&editor.doc.getCharAt(e.start-1)===UNICODE.CELL},i.prototype.isMultipleTablesSelected=function(){return this._.isMultipleTablesSelected},i.prototype.isPartialTableSelected=function(){return this._.isPartialTableSelected},i.prototype.isSameRange=function(e){return e&&e.SID===this.SID&&e.start===this.start&&e.end===this.end},i.prototype.isTableOnlySelected=function(){return this._.isSelectionWithinTable},i.prototype.isTableSelected=function(){return this._.isSelectionWithinTable||this._.isPartialTableSelected||this._.isPartialTableSelectedFromTop||this._.isPartialTableSelectedFromBottom||this._.isMultipleTablesSelected},i.prototype.offset=function(){return{start:this.start,end:this.end}},i.prototype.remove=function(){var e=editor.doc.getSelection(this.SID);if(!this.collaborator&&e.isTextDrag)return this;var t=editor.clientActiveSection!==editor.prevClientActiveSection;return this.removeSubscriber(),E(this),(this.collapsed||t)&&(this._.isHeaderActived?(R(this,"header/changed",t?0:50),this._.isHeaderActived=!1):this._.isFooterActvied&&(R(this,"footer/changed",t?0:50),this._.isFooterActvied=!1),this._.isHeaderRowActived&&(PubSub.publish("Document/Table/HeaderView/Update"),this._.isHeaderRowActived=!1)),this},i.prototype.removeSubscriber=function(){return PubSub.unsubscribe([DOCVIEW.PARAVIEW_AFTER_CREATE,DOCVIEW.CELLVIEW_AFTER_CREATE],this.drawSelection,{context:this}),this},i.prototype.selectCells=function(e){return ZWSelectionUtils.drawTableCell(this,e)},i.prototype.getSelectedDocCells=function(){return T(this._.selectedCells)},i.prototype.getParents=function(e,t){return editor.doc.getParents(e,t?this.end:this.start)},i.prototype.setEnd=function(e){return e=e>0?e:1,this.end=e,this.end<this.start&&(this.end=this.start,this.start=e),this},i.prototype.setFocus=function(e){return this.focus=e,this},i.prototype.setStart=function(e){return e=e>0?e:1,this.start=e,this.end||(this.end=e),this},i.prototype.toCursorOp=function(){return{si:this.start,ei:this.end}},i.prototype.toDocOpBuilder=function(){var e=new DocOpBuilder,t=new DocOp,i={type:"cursor"},n=Utils.randomString();return t.skipChars(this.start),e.docOps.push(t),t=new DocOp,t.changeStyles([],i,n),e.docOps.push(t),t=new DocOp,t.skipChars(this.length),e.docOps.push(t),t=new DocOp,t.changeStyles(Object.keys(i),[],n),e.docOps.push(t),e},i.prototype.toString=function(){var e=this.getContent(),t=RegExp(UNICODE.PARA+"|"+UNICODE.TAB+"|"+UNICODE.BR+"|"+UNICODE.SECTION_START+"|"+UNICODE.TABLE+"|"+UNICODE.TABLEEND+"|"+UNICODE.ROW+"|"+UNICODE.CELL,"g");return e=e.replace(t,"")},i.prototype.visitAllNodesInRange=function(e){for(var t,i=this,n=i.start,p=(i.end,editor.doc.getSelection()),g=DocTreeManager.getTreeNodeAtIndex(n),E=[];ZWSelectionUtils.isNodeInRange(g,i);)if(t=g,(p.isTableSelected()||i.isTableSelected())&&g.type===NODE_TYPE.CELL){if(l(g,i,E,e),g=g.next,!g){var T=t.parent;a(E,T,e),T&&T.next?g=T.next:(a(E,T.parent,e),g=T.parent.next)}}else{if(!(g.type!==NODE_TYPE.CELL&&g.type!==NODE_TYPE.ROW&&g.type!==NODE_TYPE.TABLE||p.isTableSelected()||i.isTableSelected()||d(g,i)))break;if(g.type===NODE_TYPE.PARA){f(g,i,E,e);var m=DocLayoutManager.getSectionViewAtIndex(g.getIndex()),h=DocLayoutManager.getSectionViewAtIndex(g.getEndIndex());if(g=g.next,!g)if(t.getParent().getType()===NODE_TYPE.SECTION){var I=m&&DocLayoutManager.getNextSection(m),_=h&&DocLayoutManager.getNextSection(h);if(!I||!_)break;g=I.getNode().getFirstChild()}else{var A=t.parent;A&&A.next?(a(E,A,e),g=A.next):A.parent&&A.parent.next?(a(E,A.parent,e),g=A.parent.next):(a(E,A.parent.parent,e),g=A.parent.parent.next)}}else g.type==NODE_TYPE.ROW?(u(g,i,E,e),g=g.next,g||(a(E,t.parent,e),g=t.parent&&t.parent.next)):g.type===NODE_TYPE.TABLE?(c(g,i,E,e),g=g.next):g.type===NODE_TYPE.TOC?(s(g,i,E,e),g=g.next):(o(e,g),r(e,g),g=g.next)}if(E.length)for(var S;E.length;)S=E.pop(),r(e,S);return this},i.prototype.isSameTextFormat=function(e){var t=editor.doc.getNodesInSelection(NODE_TYPE.TEXT,this.start,this.end),i=t.length;if(i<=1)return!0;for(var n,o=0;o<i;o++){var r=editor.doc.getComputedFormatAt(t[o].getStart(),NODE_TYPE.TEXT);if(n){if(n[e]!=r[e])return!1}else n=r}return!0},i.enableLogger=function(e){t.enable(e)},i.disableLogger=function(){t.disable()},Object.defineProperties(i.TYPE={},{SELECTION:defineWithValue(1),COMMENT:defineWithValue(2),SPELLCHECK:defineWithValue(3),FIND:defineWithValue(4),HISTORY_HIGHLIGHT:defineWithValue(5),NAMED_RANGE_HIGHLIGHT:defineWithValue(6)});var o=function(e,t){t&&e&&"function"==typeof e.nodeStartHandler&&e.nodeStartHandler.call(null,t)},r=function(e,t){t&&e&&"function"==typeof e.nodeEndHandler&&e.nodeEndHandler.call(null,t)},a=function(e,t,i){if(t&&e.length&&e.slice(-1)&&e.slice(-1)[0]===t){var n=e.pop();r(i,n)}},s=function(e,t,i,n){if(e){o(n,e);for(var a,s=e.children||{},l=0,d=s.length;l<d;l++)a=s[l],f(a,t,i,n);r(n,e)}},l=function(e,t,i,n){if(e&&e&&g(e,t)){for(var l,d=e.children||{},u=0;u<d.length;u++)l=d[u],ZWSelectionUtils.isNodeInRange(l,t)&&("para"==l.type?f(l,t,i,n):l.type===NODE_TYPE.TABLE?c(l,t,i,n):l.type===NODE_TYPE.TOC?s(l,t,i,n):(o(n,l),r(n,l)));a(i,e,n)}},d=function(e,t){return!(!e||e.type!=NODE_TYPE.TABLE)&&(e.getIndex()>=t.start&&e.getEndIndex()<=t.end)},c=function(e,t,i,n){if(e){for(var o,r=e.children||{},s=0,l=r.length;s<l;s++)o=r[s],u(o,t,i,n);a(i,e,n)}},u=function(e,t,i,n){if(e){for(var o,r=e.children||{},s=0,d=r.length;s<d;s++)o=r[s],l(o,t,i,n);a(i,e,n)}},p=function(e,t){return!!e&&e.getEndIndex()+1<=t.end},g=function(e,t){if(!e||e.type!==NODE_TYPE.CELL)return!1;for(var i,n=t.getSelectedDocCells(),o=0,r=n.length;o<r;o++)if(i=n[o],Array.isArray(i)){for(var a,s=0;s<i.length;s++)if(a=i[s],a.dtNode===e)return!0}else if(i.dtNode===e)return!0;return!(e.parent.parent.parent.type!==NODE_TYPE.CELL||!g(e.parent.parent.parent,t))||!!d(e.parent.parent,t)},f=function(e,t,i,n){if(e){var r,s,l,c=editor.doc.getSelection(),u=e.children,c=editor.doc.getSelection();e.parent.type===NODE_TYPE.CELL&&(c.isTableSelected()||t.isTableSelected()||d(e.parent.parent.parent,t))&&(l=e.parent,s=l.parent,r=s.parent,g(l,t)&&(ZWArrayUtils.arrayContains(i,r)||(o(n,r),i.push(r)),ZWArrayUtils.arrayContains(i,s)||(o(n,s),i.push(s)),ZWArrayUtils.arrayContains(i,l)||(o(n,l),i.push(l)))),p(e,t)&&(o(n,e),i.push(e));for(var f,E,T=0,m=u.length;T<m;T++)f=u[T],ZWSelectionUtils.isNodeInRange(f,t)&&(f.getIndex()<t.start&&f.getEndIndex()>=t.end?(E=new DTNode.types[f.type](Math.abs(t.start-e.getIndex()),Math.abs(t.end-e.getIndex()),e),o(n,E)):f.getIndex()<t.start?(E=new DTNode.types[f.type](Math.abs(t.start-e.getIndex()),Math.abs(f.getEndIndex()-e.getIndex()+1),e),o(n,E)):f.getEndIndex()>=t.end?(E=new DTNode.types[f.type](Math.abs(f.getIndex()-e.getIndex()),Math.abs(t.end-e.getIndex()),e),o(n,E)):o(n,f));a(i,e,n)}},E=function(e){var t=DocLayoutManager.getCurrentSection();if(t){t.sectionType===SECTION_TYPE.HEADER||t.sectionType===SECTION_TYPE.FOOTER||t.sectionType===NODE_TYPE.TEXTBOX?PubSub.publish("ZWRange/ClearSelection",e,DomViewManager.getDOMElem(t)):PubSub.publish("ZWRange/ClearSelection",e),e._.isMultipleTablesSelected=e._.isPartialTableSelected=e._.isPartialTableSelectedFromBottom=e._.isPartialTableSelectedFromTop=e._.isSelectionWithinTable=!1,e._.selectedCells=[],e._.cellsInRange=[],e._.cellsList={};var i=editor.doc.getSelection(e.SID);i.setIsTableSelected(!1),i.setSelectedCells([]),i.setStartCell(null),i.setEndCell(null),i.setSelectedTable(null),i.setSelectedRowNumbers([])}},T=function(e){var t,i=[];return e.forEach(function(e){Array.isArray(e)?i.push(T(e)):(t=editor.doc.createElement(NODE_TYPE.CELL,e),t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1),i.push(t))}),i},m=function(e,t,i){t.forEach(function(t){i&&i(t);var n=TableUtil.getCellEnd(t.getStart()+1);n>0&&e.deleteContents(t.getStart()+1,n-1)})},h=function(e){var t=editor.doc.getCharAt(e);return(t===UNICODE.CELL||t===UNICODE.ROW)&&e--,DocTreeManager.getParents(NODE_TYPE.CELL,e)},I=function(e,i){for(var n,o,r,a=extend({},i),s=[],l={},d=i.top;d<=i.bottom;d++)if(o=e.children[d])for(n=i.left;n<=i.right;n++)(r=o.children[n])&&(r.format[ATTR_CELL.TDS_MRG]&&(r="fc"===r.format[ATTR_CELL.TDS_MRG]?r:r.getRootMergeCell()),s.push(r),l[r.getId()]=r);return t.info([i.top,i.left],[i.bottom,i.right],[a.top,a.left],[a.bottom,a.right]),JSON.stringify(a)===JSON.stringify(i)?{allCells:s,cellsList:l}:I(e,a)},_=function(e,t){if(e._.isCellSelection)return t;0===t?t++:t===editor.doc.getDocumentLength()&&t--;var i=editor.doc.getCharAt(t);if(i===UNICODE.SECTION_START||i===UNICODE.HR||i===UNICODE.TABLE||i==UNICODE.CELL||i===UNICODE.ROW||i===UNICODE.TABLEEND||i===UNICODE.TOCSTART||i===UNICODE.TOCEND){if(editor.doc.getCharAt(t-1)===UNICODE.PARA)return--t;for(var n,o=editor.doc.getSectionEnd(t),r=t;r<o;r++)if((n=editor.doc.getRawFormatAt(r))&&(n.type===NODE_TYPE.TEXT||n.type===NODE_TYPE.IMAGE||n.type===NODE_TYPE.BR||n.type===NODE_TYPE.PARAGRAPH||ZWSelectionUtils.isField(n.type)))return r}return t},A=function(e){var t=editor.doc.getCharAt(e);return t===UNICODE.ROW&&e--,DocTreeManager.getParents(NODE_TYPE.ROW,e)},S=function(e){return"comment"===e?{color:"#F88017",zuid:editor.zuid}:editor.doc.getUserData(e)},R=function(e,t,i){if(!e.collaborator)return i?setTimeout(function(){PubSub.publish.call(null,t)},i):void PubSub.publish.call(null,t)};return i}(),ZWSelection=function(){"use strict";var e=Array.prototype.slice,t={cs:"normal",bgc:"none",fgc:"#000000",ff:"normal",fv:"normal",fs:"normal",size:11,type:"text",hd:0,fw:"normal"},i=new ZWConsole,n=function(e){e&&(this.SID=e),this._={isTableSelectionInProgress:!1,startCell:null,endCell:null,selectedCells:[],preCurrTd:null,selectedTable:null,isTableSelected:!1,OFFSET:{start:{left:0},end:{left:0}},LAST_MODIFIED_POSITION:n.MODIFIED_POSITION_START,PREV_RANGE:void 0,LAST_RANGE:void 0,SELECTION_TYPE:0,TARGET_RANGE:void 0,IS_LIST_ITEM_SELECTION:!1,IS_MULTIPLE_SELECTION:!1,IS_ROW_SELECTION:!1,IS_CELL_SELECTION:!1,LIST_LEVEL:void 0,LIST_ID:void 0,IS_CTRL_SELECTION:!1,IS_TEXT_DRAG_STARTED:!1,IS_MOUSE_MOVE_SELECTION:!1};var t={},i=this;Object.defineProperties(this._,{userData:{get:function(){return ZWSelectionUtils.isEmpty(t)&&extend(t,editor.doc.getUserData(i.SID)||{})||t}}}),e!==editor.uuid&&"NamedRange"!==e||(e===editor.uuid&&PubSub.subscribe(["Document/AfterInit","Selection/updateClientLeft"],function(){var e=i.getLastRange();i._.OFFSET={start:{idx:e.start,left:0},end:{idx:e.end,left:0}}}),PubSub.subscribe([DOMVIEW.PARAVIEW_AFTER_CREATE,DOMVIEW.CELLVIEW_AFTER_CREATE,DOMVIEW.PARAVIEW_AFTER_UPDATE,DOMVIEW.CELLVIEW_AFTER_UPDATE],this.drawSelection,{context:this}))};n.prototype={constructor:n,each:function(){if(this.length){var e=Array.prototype.slice.call(arguments);if(e.length){var t=this,e=Array.prototype.concat.call([t],e);U.each.apply(t,e)}}},length:0,sortRanges:function(){return Array.prototype.sort.call(this,function(e,t){return e.start-t.start})},indexOf:Array.prototype.indexOf,push:Array.prototype.push,splice:Array.prototype.splice,toArray:function(){return e.call(this)}},Object.defineProperties(n.prototype,{collaborator:{get:function(){return this.SID!==editor.uuid}},isCellSelection:{get:function(){return this._.IS_CELL_SELECTION},set:function(e){this._.IS_CELL_SELECTION=!!e}},isCtrlSelection:{get:function(){return this._.IS_CTRL_SELECTION},set:function(e){this._.IS_CTRL_SELECTION=!!e}},isMultipleSelection:{get:function(){return this._.IS_MULTIPLE_SELECTION},set:function(e){this._.IS_MULTIPLE_SELECTION=!!e}},isListItemSelection:{get:function(){return this._.IS_LIST_ITEM_SELECTION},set:function(e){this._.IS_LIST_ITEM_SELECTION=!!e}},isMouseMoveSelection:{get:function(){return this._.IS_MOUSE_MOVE_SELECTION},set:function(e){this._.IS_MOUSE_MOVE_SELECTION=!!e}},isRowSelection:{get:function(){return this._.IS_ROW_SELECTION},set:function(e){this._.IS_ROW_SELECTION=!!e}},isTextDrag:{get:function(){return this._.IS_TEXT_DRAG_STARTED},set:function(e){this._.IS_TEXT_DRAG_STARTED=!!e}},selectedListID:{get:function(){return this._.LIST_ID}},selectedListLevel:{get:function(){return this._.LIST_LEVEL}},selectionType:{get:function(){return this._.SELECTION_TYPE},set:function(e){return this._.SELECTION_TYPE=e,this}},ZUID:{get:function(){return this._.userData.zuid}}});var o;n.prototype.addRange=function(e){if(!e)return this;this.showCaret(e),this.setCursorFormat(),clearTimeout(o),!this.isMouseMoveSelection&&ZWSelectionUtils.publishEvent(this,"Document/CursorPositionChanged",this.SID);var t=this._.LAST_RANGE;return this.collaborator||0==editor.doc.collabUsers.length||!editor.getRole().permissions.can("document.edit")||this.isCollapsed()&&this.getLastRange().start==t.start&&this.getLastRange().end==t.end||(o=setTimeout(function(){ZWCollaboration.sendCursorMutation()},1e3)),this},n.prototype.addRanges=function(e,t){if(!e||0==e.length)return this;for(var i=0,n=e.length;i<n;i++)t?this.showCaret(e[i]):this.addRange(e[i]);return this},n.prototype.collapse=function(e){var t,i,n,o,r;return this.isMultipleSelection?o=r=this.getTargetRange():(o=this.getFirstRange(),r=this.getLastRange()),e?(i=o.start,n=1):(i=r.end,n=-1),i+=editor.doc.getCharAt(i)==UNICODE.SECTION_START?n:0,t=editor.doc.createRange(i),this.removeAllRanges().addRange(t)},n.prototype.collapseToEnd=function(){return this.collapse(!1)},n.prototype.collapseToStart=function(){return this.collapse(!0)},n.prototype.createCursorOp=function(e,t,i){return editor.doc.createRange(e,t).createOp(i)},n.prototype.drawSelection=function(e,t){for(var i,n=0,o=this.length;n<o;n++)if(i=this[n],!i.collapsed&&!i.collaborator){var r=i.getCellsList(),a=e.getIndex(),s=e.getEndIndex();if(e.type===NODE_TYPE.PARA)if(Object.keys(r).length)!editor.doc.createRange(a,s).isIntersectWithRange(i)||i.isTableSelected()||i.isTableOnlySelected()||PubSub.publish("ZWSelection/DrawSelectionForParaViewCreation",i,a,s,t);else{if(!i.isIntersectWithRange(editor.doc.createRange(a,s))||i.end===a)continue;var l=DocLayoutManager.getViews(e)||[],d=l.length&&DomViewManager.getDOMElemById(l[0].getId()),c=d&&d.parentElement;if(c&&c.classList.contains("zw-cell-container")&&c.querySelector("div.overlay"))continue;PubSub.publish("ZWSelection/DrawSelectionForParaViewCreation",i,a,s,t)}else if(e.type===NODE_TYPE.CELL){var l;if(!Object.keys(r).length){if(!i.isIntersectWithRange(editor.doc.createRange(a,s)))continue;if(l=DocLayoutManager.getViews(e)||[],!l.length)continue;PubSub.publish("ZWSelection/DrawSelectionForCellViewCreation",i,l[0])}var u=new ZWRange(a,s);if(i.isIntersectWithRange(u)&&r[e.getId()]){l=DocLayoutManager.getViews(e)||[];for(var p,g=0,f=l.length;g<f;g++)(p=l[g])&&PubSub.publish("ZWSelection/DrawSelectionForCellViewCreation",i,p)}}}return this},n.prototype.find=function(e,t,i){return i=i||"start","previous"==e?this.findPrevious(t,i):this.findNext(t,i)},n.prototype.getAllHeadings=function(e){for(var t,n,o=[],r=editor.doc.createRange(1,editor.doc.getSectionEnd(1)),a=r.getNodes(NODE_TYPE.PARAGRAPH),s=0,l=a.length;s<l;s++)n=a[s],t=n&&parseInt(n.attr(ATTR_PARAGRAPH.PS_HD)||0),!t||parseInt(t)>9||e&&t!=parseInt(e)||o.push(n);return i.log("@getAllHeadings",o),o},n.prototype.getAllRangeOffsets=function(){for(var e=[],t=0,i=this.length;t<i;t++)e.push(this[t].offset());return e},n.prototype.getAllRangesWithCursorFormat=function(){var e,t=this.getLastRange(),n=editor.doc.getSectionStart(t.start),o=editor.doc.getSectionEnd(t.start),r=[],a=[];if(g(this)){var s=this.getParents(NODE_TYPE.PARAGRAPH)||{},d=s.dtNode&&s.dtNode.paraProperties.level,p=editor.doc.createRange(s.getStart(),s.getEnd()),f=p.getNodes(NODE_TYPE.TEXT)[0];e=editor.doc.getComputedFormatAt(f?f.getStart():s.getEnd()-1,NODE_TYPE.TEXT,d),r=c(this,e,d)}else{e=this.getComputedTextFormat()||{},e=DocUtil.getRenderingFormat(e);var E,T,m,h,I=[];for(E=n+1;E<o;E++)T=DocTreeManager.getTreeNodeAtIndex(E),editor.doc.getCharAt(E)!=UNICODE.TABLEEND&&T&&T.type===NODE_TYPE.PARA?(h=editor.doc.getRawFormatAt(E))&&(m=T.getParaStyles()[ATTR_PARAGRAPH.PS_HD]||0,(h=u(E,m))&&(l(e,h)?!I.length&&I.push(E):I.length&&h.type==NODE_TYPE.TEXT&&(I.push(E),r.push(I),I=[]))):T.type!==NODE_TYPE.HR&&I.length&&(I.push(E),r.push(I),I=[]);I.length&&(I.push(o),r.push(I))}for(var _,A=0,S=r.length;A<S;A++)_=r[A],a.push(editor.doc.createRange(_[0],_[1]).setFocus(!1));return i.log("getAllRangesWithCursorFormat",a),a},n.prototype.getAllInsertionOps=function(){for(var e=[],t=0,i=this.length;t<i;t++)e.push(OpUtil.getInsertionOps(this[t]));return e},n.prototype.getClientLeft=function(e){e=e&&e===n.MODIFIED_POSITION_END&&n.MODIFIED_POSITION_END||this.getLastModifiedPosition();var t=this._.OFFSET[e];if(!t.left){var i,o=editor.doc.createRange(t.idx),r=o.getStartPortionData().line;r&&(i=DomViewManager.getDOMElem(r)),t.left=DocLayoutManager.getLeftRelativeToPageAtIndex(t.idx)*editor.zoomFactor+editor.editorOffset.left}return t.left},n.prototype.getComputedTextFormat=function(){return this.computedTextFormat},n.prototype.getCursorOp=function(){var e=[];if(this.isListItemSelection){var t=editor.doc.createRange(this.getFirstRange().start);e.push(t.toCursorOp())}else for(var i=0,n=this.length;i<n;i++)e.push(this[i].toCursorOp());if(this.length<1){ZWLogger.log("_"+ZWCollaboration.CURSOR_IDX_ERROR+"_CURSOR_IDX_ERROR_ Selection length is 0 for ZUID: "+this.ZUID+", SID: "+this.SID);var o=new Error(ZWCollaboration.CURSOR_IDX_ERROR);throw editor.lastError=o,o}return JSON.stringify(e)},n.prototype.getEnd=function(){var e=this.getTargetRange();return e&&e.end||1},n.prototype.getStartCell=function(){return this._.startCell},n.prototype.getEndCell=function(){return this._.endCell},n.prototype.getSelectedTable=function(){return this._.selectedTable},n.prototype.getSelectedText=function(){return Utils.removeUnWantedUnicodes(this.getLastRange().getContent())},n.prototype.getSelectedColumns=function(){var e,t,i,n,o,r,a,s,l=[];for(n=0,a=this._.selectedCells.length;n<a;n++)for(e=this._.selectedCells[n],t=e.parentNode().nodeCountBefore(e),i=e.attr(ATTR_CELL.TDS_CSPAN),i=i?i:1,r=0;r<i;r++)l.contains(t+r)||l.push(t+r);for(n=0;n<l.length-1;n++)for(o=n+1;o<l.length;o++)l[n]>l[o]&&(s=l[n],l[n]=l[o],l[o]=s);return l},n.prototype.setSelectedRowNumbers=function(e){var t,i,n;for(t=0;t<e.length-1;t++)for(i=t+1;i<e.length;i++)e[t]>e[i]&&(n=e[t],e[t]=e[i],e[i]=n);this._.selectedRowNumbers=e},n.prototype.getSelectedRows=function(e){return this._.selectedRowNumbers},n.prototype.getFirstRange=function(){return this.getRangeAt(0)},n.prototype.getLastModifiedPosition=function(){return this._.LAST_MODIFIED_POSITION},n.prototype.getLastRange=function(){return this.getRangeAt(this.length-1)},n.prototype.getNextWordEnd=function(){var e=this.getLastRange(),t=e.end,i=e.start,o=editor.doc.getRawFormatAt(t);if(o&&o.type&&DocUtil.isNonEditablePortion(o.type)){var r=editor.doc.getCharAt(t);if(r===UNICODE.RANGE_START)return DocUtil.getRangeEnd(t);if(r===UNICODE.RANGE_END){var a=DocUtil.getRangeStart(t);if(a<i)return a}}var s=ZWSelectionUtils.getWordEnd(t),l=DocLayoutManager.getSectionViewAtIndex(s),d=DocLayoutManager.getNextSection(l);return s===t&&editor.doc.getCharAt(t)!=UNICODE.SECTION_START&&d&&DocLayoutManager.getSectionViewAtIndex(t).getSectionType()===l.getSectionType()&&(s=ZWSelectionUtils.getWordEnd(t+1)),this.setLastModifiedPosition(n.MODIFIED_POSITION_END),s},n.prototype.getNextWordStart=function(){var e=this.getLastRange(),t=e.start,i=(e.end,editor.doc.getRawFormatAt(t));if(i&&i.type&&DocUtil.isNonEditablePortion(i.type)){var o=editor.doc.getCharAt(t);if(o===UNICODE.RANGE_START)return DocUtil.getRangeEnd(t);if(o===UNICODE.RANGE_END){var r=DocUtil.getRangeStart(t);if(r>e.end)return r}}var a=ZWSelectionUtils.getWordEnd(t),s=DocLayoutManager.getSectionViewAtIndex(t),l=DocLayoutManager.getNextSection(s);return editor.doc.getCharAt(a)===UNICODE.SECTION_START&&l&&DocLayoutManager.getSectionViewAtIndex(a).getSectionType()===s.getSectionType()&&(a=ZWSelectionUtils.getWordEnd(t+1)),a>e.end&&this.setLastModifiedPosition(n.MODIFIED_POSITION_END),a},n.prototype.getNodesInSection=function(e,t){var i,n;if(e){var o=editor.doc.getSection(e,e);if(!o)return[];i=o.getStart()+2,n=o.getEnd()}else i=0,n=editor.doc.getSectionEnd(0);var r=editor.doc.getNodesInSelection(t,i,n);return r},n.prototype.getNodesInSelection=function(t){var i=e.call(arguments);if(i.length>2)return editor.doc.createRange(i[1],i[2]).getNodes(t);for(var n=[],o=0,r=this.length;o<r;o++)n=n.concat(this[o].getNodes(t));return n},n.prototype.getParaFormat=function(){return this.paraFormat},n.prototype.getParents=function(e,t){return this.getTargetRange().getParents(e,t)},n.prototype.getPrevWordEnd=function(){var e=this.getLastRange(),t=e.end,i=e.start,o=editor.doc.getRawFormatAt(t);if(o&&o.type&&DocUtil.isNonEditablePortion(o.type)){var r=editor.doc.getCharAt(t);if(r===UNICODE.RANGE_START){var a=DocUtil.getRangeEnd(t);if(a<i)return a}else if(r===UNICODE.RANGE_END){var s=DocUtil.getRangeStart(t);if(s<t)return s}}var l=ZWSelectionUtils.getWordStart(t);return l<e.start&&this.setLastModifiedPosition(n.MODIFIED_POSITION_START),l},n.prototype.getPrevWordStart=function(){var e=this.getLastRange(),t=e.start,i=e.end,o=editor.doc.getRawFormatAt(t);if(o&&o.type&&DocUtil.isNonEditablePortion(o.type)){var r=editor.doc.getCharAt(t);if(r===UNICODE.RANGE_START){var a=DocUtil.getRangeEnd(t);if(i<a)return a}else if(r===UNICODE.RANGE_END)return DocUtil.getRangeStart(t)}var s=DocLayoutManager.getSectionViewAtIndex(t),l=DocLayoutManager.getPrevSection(s);if(t&&editor.doc.getCharAt(t-1)==UNICODE.SECTION_START&&!l)return t;var d=ZWSelectionUtils.getWordStart(t);return d===t&&(d=ZWSelectionUtils.getWordEnd(t-1)),this.setLastModifiedPosition(n.MODIFIED_POSITION_START),d},n.prototype.getRangeAt=function(e){return e<0||e>=this.length?null:this[e]},n.prototype.getStart=function(){var e=this.getTargetRange();return e&&e.start||1},n.prototype.getTargetRange=function(){if(this.isListItemSelection)return this.getFirstRange();var e=this.length;if(1===e||!this._.TARGET_RANGE)return this.getLastRange();for(var t,i=0,n=e;i<n;)t=i+n>>>1,this[t].start<this._.TARGET_RANGE.start?i=t+1:n=t;return i-=n>0&&i===n?1:0,this.getRangeAt(i)},n.prototype.getTextFormat=function(){return this.textFormat},n.prototype.getTextFormatWithCls=function(){var e,t=this.getLastRange(),i=t.start,n=this.getParents(NODE_TYPE.SECTION).getEnd();if(n==i)i-=1;else if(i>0){var o=editor.doc.getCharAt(i-1),r=editor.doc.getCharAt(i);this.isCollapsed()?o!=UNICODE.SECTION_START&&o!=UNICODE.PARA&&o!=UNICODE.CELL&&o!=UNICODE.TOCSTART&&(i-=1):r===UNICODE.RANGE_START&&(i+=1)}return e=DocUtil.getTextStyle(i),e?(delete e[ATTR_TEXT.TS_SP],delete e[ATTR_TEXT.TS_GR],delete e[ATTR_TEXT.TS_PROOFING_WQ]):e={type:NODE_TYPE.TEXT},e},n.prototype.hasIntersectRange=function(e){for(var t=0,i=this.length;t<i;t++)if(this.getRangeAt(t).isIntersectWithRange(e))return t;return-1},n.prototype.hasRange=function(e){for(var t=0,i=this.length;t<i;t++)if(this.getRangeAt(t).isSameRange(e))return!0;return!1},n.prototype.isCollapsed=function(){for(var e=0,t=this.length;e<t;e++)if(!this.getRangeAt(e).collapsed)return!1;return!0},n.prototype.canEditLockRange=function(){var e=!1,t=this.getLastRange();return e=Lock.isIdxInLockArea(t.start,editor.zuid),this.isCollapsed()||e||(e=Lock.isIdxInLockArea(t.end)),e},n.prototype.isTableSelected=function(){return!!this._.isTableSelected},n.prototype.isTableSelectionInProgress=function(){return!!this._.isTableSelectionInProgress};var r=function(e,t){for(var i=0,n=e.length;i<n;i++){var o=e[i].data.allowed_zuids.split(",");if(!o.contains(editor.zuid)){t=!1;break}t=!0}return t};n.prototype.isUnlockAllowed=function(){var e=this.getLastRange(),t=Lock.getLockRanges(e.start);return t.length||(t=Lock.getLockRanges(e.start,e.end)),!(!t.length||!Lock.isUnLockRangeAllowed())||r(t,!1)},n.prototype.isLockUnlockAllowed=function(){var e=this.getLastRange(),t=Lock.getLockRanges(e.start);return t.length||(t=Lock.getLockRanges(e.start,e.end)),!!Lock.isUnLockRangeAllowed()||r(t,!0)},n.prototype.mapAllSelectionsToBulletin=function(){if(this.length<2)return void(this.isCollapsed&&PubSub.publish("QuickSeek/hideBarWithID","Selection"));var e={buttonBGColor:"#94a1de",buttonBRColor:"#0a42e2",id:"Selection",overlayToBeAnimated:".overlay",ranges:[]};return this.toIntervals().forEach(function(t){e.ranges.push({start:t[0],end:t[1]})}),PubSub.publish("QuickSeek/showBarWithObj",e),this},n.prototype.moveTo=function(e,t){var i=editor.doc.createRange(t?e.getStart():e.getEnd());return this.addRange(i)},n.prototype.removeAllRanges=function(){for(var e=0,t=this.length;e<t;e++)this[e].remove();return this._.PREV_RANGE&&this._.PREV_RANGE.remove(),this.splice(0),this},n.prototype.removeLastRange=function(){return this.removeRange(this.getLastRange())},n.prototype.removeRange=function(e){if(!e||ZWSelectionUtils.isEmpty(e))return this;e.remove();var t=this.indexOf(e);return t<0?this:(this.splice(t,1),this)},n.prototype.removeRangeAt=function(e){return this.removeRange(this.getRangeAt(e))},n.prototype.removeTableSelection=function(){return this.removeSelectedCellsBGImage(),this.setStartCell(null),this.setEndCell(null),delete this._.preCurrTd,this.isCellSelection=!1,this.isRowSelection=!1,this._.isTableSelected=!1,this._.isTableSelectionInProgress=!1,this.setSelectedCells([]),this.setSelectedRowNumbers([]),this.collapse(!0)},n.prototype.replace=function(e,t,i){var n=e.getStart(),o=t.nodeValue,r=0,a=[],s=!1;e.getStart()===t.getStart()?s=!0:a.push({r:n});var l=Utils.randomString();"start"==i?a.push({as:{start:{type:"cursor",uuid:editor.uuid},id:l}},{r:0},{as:{end:["type","uuid"],id:l}}):"surround"==i&&a.push({as:{start:{type:"cursor",uuid:editor.uuid},id:l}});var d=0,c=!1;if(e.nodeValue.length==t.nodeValue.length&&(c=!0,d=e.nodeValue.length),c){for(var u,p=0;p<d;p++){var g=editor.doc.getRawFormatAt(n+p);if(g){if(u){var f=Utils.randomString(),E=ZWJSONUtils.getKeys(u);a.push({as:{start:DocUtil.copyStyle(u),id:f}}),a.push({is:o.substring(r,p)}),a.push({as:{end:E,id:f}})}else a.push({is:o.substring(r,p)});u=g,r=p}}if(r<p){g="",u&&(g=u);var f=Utils.randomString();if(g&&a.push({as:{start:DocUtil.copyStyle(g),id:f}}),a.push({is:o.substring(r,p)}),g){var T=["type"];a.push({as:{end:T,id:f}})}}}else{var g=editor.doc.getRawFormatAt(n);if(g){"section"==g.type&&(g={type:"text"});var f=Utils.randomString(),E=ZWJSONUtils.getKeys(g);a.push({as:{start:DocUtil.copyStyle(g),id:f}}),a.push({is:o}),a.push({as:{end:E,id:f}})}else a.push({is:o})}editor.doc.getTrackChangeDetails().getProcessingTC()&&Op.sendMsg();var m=editor.doc.getContent(e.getStart(),e.getEnd());if(s){var h=[];h.push({r:e.getStart()}),h.push({ds:m}),"end"==i?a.push({as:{start:{type:"cursor",uuid:editor.uuid},id:l}},{r:0},{as:{end:["type","uuid"],id:l}}):"surround"==i&&a.push({as:{end:["type","uuid"],id:l}}),h=h.concat(a),Op.processMsg(h)}else Op.processMsg([{r:e.getStart()},{ds:m}]),editor.doc.getTrackChangeDetails().getProcessingTC()&&Op.sendMsg(),"end"==i?a.push({as:{start:{type:"cursor",uuid:editor.uuid},id:l}},{r:0},{as:{end:["type","uuid"],id:l}}):"surround"==i&&a.push({as:{end:["type","uuid"],id:l}}),Op.processMsg(a);return this},n.prototype.resetLastModifiedPosition=function(){return this._.LAST_MODIFIED_POSITION=n.MODIFIED_POSITION_START,this};var a=function(e){var t=e.start,i=e.end,n=editor.doc.getCharAt(t-1),o=editor.doc.getCharAt(i),r=editor.doc.getRawFormatAt(t-1),a=editor.doc.getRawFormatAt(i);if(r&&a&&r.type===NODE_TYPE.NAMED_RANGE&&a.type===NODE_TYPE.NAMED_RANGE&&r.id===a.id)e.start=t-1,e.end=i+1;else if(r&&r.type===NODE_TYPE.NAMED_RANGE){if(n==UNICODE.RANGE_START){var s=DocUtil.getRangeEnd(t-1);s<i&&s>t&&(e.start=t-1)}else if(n==UNICODE.RANGE_END){var l=DocUtil.getRangeStart(t-1);l>t&&l<i&&(e.end=i+1)}}else if(a&&a.type===NODE_TYPE.NAMED_RANGE)if(o==UNICODE.RANGE_START){var s=DocUtil.getRangeEnd(i);s<i&&s>t&&(e.start=t-1)}else if(o==UNICODE.RANGE_END){var l=DocUtil.getRangeStart(i);l>t&&l<i&&(e.end=i+1)}};n.prototype.showCaret=function(e){try{if(!e)return this;i.trace(),!e.collapsed&&p(e),!e.collapsed&&a(e);var t=e.collapsed,n=this.getCorrectedCursorPosition(e.start),o=e.end;return o=t?n:o,e.SID=this.SID,this.push(e),e.setStart(n),e.setEnd(o),!t&&T(e),PubSub.publish("ZWSelection/RangeAdded",e),i.log("SLen",this.length,"RNG",e),this._.LAST_RANGE=this._.PREV_RANGE,this._.PREV_RANGE=e.cloneRange(),this}catch(e){ZWLogger.log(e.stack)}},n.prototype.select=function(){var e=this.toArray();return e.length?this.removeAllRanges().addRanges(e):this},n.prototype.selectAll=function(){var e,t,i,o=DocLayoutManager.getCurrentSection().getSectionType();if(o===SECTION_TYPE.CONTENT)t=DocTreeManager.doc.getFirstContentSection().getIndex(),i=DocTreeManager.doc.getLastContentSection().getEndIndex()+1;else{var e=this.getLastRange(),t=editor.doc.getSectionStart(e.start)+1;i=editor.doc.getSectionEnd(t)-1}var e=editor.doc.createRange(t,i);if(PubSub.publish("QuickSeek/hideBarWithID","Selection"),this.isTableSelected()&&this.removeTableSelection(),this.isListItemSelection&&(this.isListItemSelection=!1),"undefined"!=typeof TransformHandler){var r=TransformHandler.getCurrentObjectInfo().type;if(r)if("textbox"==r){var a=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,t);a||TransformEventHandler.deselectObjects()}else TransformEventHandler.deselectObjects()}e.setFocus(!1),this.removeAllRanges().addRange(e);var s=DocTreeManager.getAllSectionsByType(SECTION_TYPE.CONTENT);return s[0].getIndex()===t&&s[s.length-1].getEndIndex()+1===i&&ZWLogger.log("Selection : Selection all content in Content Section, Sel Start"+t+" Sel End ::"+i+" Last Operation ::"+editor.lastOperation+" Event Keycode :: "+(event&&event.keyCode)),this.setLastModifiedPosition(n.MODIFIED_POSITION_END)},n.prototype.reArrangeRanges=function(e,t){var i=this.getLastRange();i.setStart(e).setEnd(t);var n=this.toArray();return n=ZWArrayUtils.removeDuplicates(n),ZWSelectionUtils.isEventhandlerSupported()&&EventHandler.getUniqueRanges(n),this.removeAllRanges().addRanges(n).mapAllSelectionsToBulletin()},n.prototype.selectAllTextWithCursorFormat=function(){var e=this.getAllRangesWithCursorFormat();return e&&e.length&&(this._.IS_MULTIPLE_SELECTION=!0,this._.TARGET_RANGE=this.getLastRange().cloneRange(),this.removeAllRanges().addRanges(e)),ZWLogger.addToStatistics("SIMILAR_TEXT_FORMATTING"),this.mapAllSelectionsToBulletin()},n.prototype.selectCell=function(e){if(!e)return this;var t=DomViewManager.getDocView(e).getNode(),i=this.getLastRange();return t&&(i.setStart(t.getIndex()+1),i.setEnd(t.getEndIndex()+1),i._.isRowSelection=!1,this.isRowSelection=!1,i._.isCellSelection=!0,this.isCellSelection=!0),this},n.prototype.selectWord=function(){var e=this.getLastRange(),t=e.start;if(editor.doc.getCharAt(t)==UNICODE.PARA)return e=editor.doc.createRange(t,t+1),this.removeAllRanges().addRange(e);var i=!1,n=e.end;if(t){var o=editor.doc.getCharAt(t-1);o==UNICODE.RANGE_START&&(e.setStart(t-1),i=!0)}var r=editor.doc.getCharAt(n);if(r==UNICODE.RANGE_END&&(i||e.setStart(t),e.setEnd(n+1),i=!0),i)this.removeAllRanges().addRange(e);else{var a=this.getWord();a.select()}return this},n.prototype.selectRow=function(e){if(e&&e.parentNode){var t=DomViewManager.getDocView(e).getNode(),i=this.getLastRange();return i.setStart(t.firstChild().getIndex()),i.setEnd(t.lastChild().getEndIndex()+1),i._.isCellSelection=!1,this.isCellSelection=!1,i._.isRowSelection=!0,this.isRowSelection=!0,PubSub.publish("Selection/updateClientLeft"),ZWLogger.addToStatistics("Cell Selection"),this}};var s=function(){if(this.isListItemSelection){var e=editor.doc.getListObj(this._.LIST_ID),t=this._.LIST_LEVEL;return e["level"+t].paraFormat||(e["level"+t].paraFormat={}),this.computedTextFormat=DocUtil.mergeObjs([this.textFormat,this.paraFormat.textFormat,DocUtil.copyStyle(e["level"+t].paraFormat.textFormat)||{}]),this.textFormat=this.computedTextFormat,this}var i=DocUtil.mergeObjs([this.paraFormat.textFormat,this.textFormat]);return i.hasOwnProperty(ATTR_TEXT.CHAR_STY)&&(i=DocUtil.mergeObjs([DocumentDesign.getCharStyle(i[ATTR_TEXT.CHAR_STY]),i])),this.computedTextFormat=i,!isV8Engine&&f(),this};n.prototype.setCursorFormat=function(){if(this.SID!==editor.uuid)return this;var e,t=this.getLastRange(),i=t.start,n=i;if(this.textFormat=this.paraFormat={},ZWSelectionUtils.isEmpty(this.tempCursorFormat)){if(n>0){var o=editor.doc.getCharAt(n-1),r=editor.doc.getCharAt(n);if(this.isCollapsed()){var a=DocTreeManager.doc.getParents(NODE_TYPE.PARAGRAPH,i);if(!a){var l=DocTreeManager.getTreeNodeAtIndex(i),d=DocLayoutManager.getSectionViewAtIndex(i);ZWLogger.log("!!Para Not Found, There is no para for startIndex. startIndex : "+n+", Current Node Type : "+(l&&l.getType())+", Current Section Type  : "+(d&&d.getSectionType())+", Current Char : "+JSON.stringify(r)+", Last Operation : "+editor.lastOperation+", Event Keycode : "+(event&&event.keyCode))}var c=editor.doc.getDocumentContent().substr(a.getIndex(),a.getEndIndex()-a.getIndex());c=c.replace(new RegExp(UNICODE.RANGE_START+"|"+UNICODE.RANGE_END,"g"),""),1!=c.length&&o!=UNICODE.PARA&&o!=UNICODE.CELL&&o!=UNICODE.TOCSTART&&o!=UNICODE.SECTION_START&&(n-=1)}else r===UNICODE.RANGE_START&&(n+=1)}if(e=DocUtil.getTextStyle(n),0==Object.keys(e).length)try{var u=DocUtil.getStyleIndex(n,NODE_TYPE.TEXT,"next",!0);u&&(e=DocUtil.getTextStyle(u))}catch(t){e=[]}if(e){var p=e[ATTR_COMMON.CLS];if(p)if(p.indexOf("link")!=-1){var g=editor.doc.getParents(NODE_TYPE.LINK,i);g||(delete e[ATTR_COMMON.CLS],delete e[ATTR_LINK.LINK_TYPE],delete e[ATTR_LINK.LINK_URL],delete e[ATTR_LINK.LINK_TOOLTIP],delete e[ATTR_LINK.LINK_TARGET])}else if(p.indexOf("comment")!=-1){var f=editor.doc.getParents(NODE_TYPE.COMMENT,i);f||delete e[ATTR_COMMON.CLS]}else p.indexOf(NODE_TYPE.FILLABLEFIELD)==-1&&p.indexOf(NODE_TYPE.SIGNERFIELD)==-1||delete e[ATTR_COMMON.CLS];delete e[ATTR_TEXT.TS_SP],delete e[ATTR_TEXT.TS_GR],delete e[ATTR_TEXT.TS_PROOFING_WQ]}else e={type:NODE_TYPE.TEXT};this.textFormat=e}else this.textFormat=DocUtil.copyStyle(this.tempCursorFormat),this.tempCursorFormat={};var E=editor.doc.findNextIndexOf(CONT_REGEXP.PARASTART,i);return E<0&&(E=1),e=DocUtil.getParaFormat(E),this.paraFormat=e,s.call(this)},n.prototype.setLastModifiedPosition=function(e){return e!==n.MODIFIED_POSITION_START&&e!==n.MODIFIED_POSITION_END?this:(this._.LAST_MODIFIED_POSITION=e,this)},n.prototype.setSelectionType=function(e){return this.selectionType=e,this},n.prototype.setStartCell=function(e){return this._.startCell=e,this},n.prototype.setEndCell=function(e){return this._.endCell=e,this},n.prototype.setSelectedCells=function(e){return(this.isCtrlSelection||ZWSelectionUtils.isEventhandlerSupported()&&EventHandler.isOnlyCtrlKeyPressed)&&e.length?(this._.selectedCells=this._.selectedCells.concat(e),this._.selectedCells=ZWArrayUtils.removeDuplicates(this._.selectedCells)):this._.selectedCells=e,this},n.prototype.setSelectedTable=function(e){return this._.selectedTable=e,this},n.prototype.setIsTableSelected=function(e){return this._.isTableSelected=e,this},n.prototype.surroundTextWith=function(e,t,i,n){var o=isNaN(i)?this.getTargetRange():this.getRangeAt(i);if(!o)return this;var r,a=o.start,s=o.end;if(editor.doc.getCharAt(a)==UNICODE.HR&&s-a==1&&(this.collapse(!0),s=a),this.isCollapsed()||editor.doc.getCharAt(s-1)!=UNICODE.PARA||(s-=1),e.style||t.style){var l=ZWJSONUtils.getKeys(e.style),d=ZWJSONUtils.getKeys(t.style),c=Utils.randomString(),u=Utils.randomString();r=[{r:a},{as:{start:e.style,id:c}},{is:e.char},{as:{end:l,id:c}},{r:s-a},{as:{start:t.style,id:u}},{is:t.char},{as:{end:d,id:u}}]}else r=[{r:a},{is:e.char},{r:s-a},{is:t.char}];return Op.processMsg(r),n&&Op.appendCursor(),this},n.prototype.toIntervals=function(){var e=[];return this.each(function(t){e.push([t.start,t.end])}),e},n.prototype.toString=function(){for(var e="",t=0,i=this.length;t<i;t++)e+=this[t].toString();return e},n.prototype.updateCursorFormat=function(e,t){switch(e){case"RemoveFormat":this.textFormat={type:NODE_TYPE.TEXT},this.textFormat[ATTR_TEXT.TS_NULL]=!0;break;default:var i=this.getComputedTextFormat(),n=DocUtil.formatGenerator.getTextFormat(i,e,t);this.textFormat=DocUtil.mergeObjs([this.textFormat,n]);var o=this.getParents(NODE_TYPE.PARAGRAPH);this.isCollapsed()&&o.getEnd()-o.getStart()!==1&&s.call(this)}return this},n.prototype.visitAllNodes=function(e){for(var t=[],i=0,n=this.length;i<n;i++)t=t.concat(this[i].visitAllNodesInRange(e));return t},n.prototype.setMouseDownCoordIdx=function(e){this.mouseDownCoord_idx=e||this.getRangeAt(0).start},n.MODIFIED_POSITION_START="start",n.MODIFIED_POSITION_END="end",n.enableLogger=function(e){i.enable(e)},n.disableLogger=function(){i.disable()};var l=function(e,t){var i=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t),o=ZWArrayUtils.removeDuplicates(i.concat(n)),r={},a={};extend(r,e),extend(a,t),r=d(r,o),a=d(a,o);for(var s,l=0,c=o.length;l<c;l++)if(s=o[l],r[s]!==a[s])return!1;return!0},d=function(e,i){if(!e||!i)return e;delete e[ATTR_LINK.LINK_URL],delete e[ATTR_COMMON.CLS],delete e[ATTR_TEXT.TS_SP],delete e[ATTR_TEXT.TS_GR],delete e[ATTR_TEXT.TS_PROOFING_WQ],delete e[TCConstants.TC];for(var n,o=0,r=i.length;o<r;o++){if(!e.hasOwnProperty(n=i[o])&&t.hasOwnProperty(n))e[n]=t[n];else if("fgc"==n||"bgc"==n){var a=e[n];0===a.indexOf("rgb")&&(e[n]=zoho.color.rgbToHex(a))}else"none"==e[n]&&(e[n]="normal");e[n]&&(e[n]=e[n].toString())}return e},c=function(e,t,i){for(var n,o,r,a,s,d,c=e.getAllHeadings(i),u=0,p=c.length,g=[];u<p;u++)s=c[u],n=s.getStart(),o=s.getEnd(),r=editor.doc.createRange(n,o),a=r.getNodes(NODE_TYPE.TEXT)[0],d=editor.doc.getComputedFormatAt(a?a.getStart():o-1,NODE_TYPE.TEXT,i),l(t,d)&&g.push([n,o]);return g},u=function(e,t){return editor.doc.getComputedFormatAt(e,NODE_TYPE.TEXT,t)},p=function(e){var t,i;if(!ZWSelectionUtils.isEventhandlerSupported()||EventHandler.mouseDown_coord.idx&&(EventHandler.mouseDown_coord.idx===e.start||EventHandler.mouseDown_coord.idx===e.end)){t=ZWSelectionUtils.isEventhandlerSupported()&&EventHandler.mouseDown_coord.idx||e.end,i=t===e.start?i=editor.doc.getCharAt(e.end)===UNICODE.SECTION_START?e.end-1:e.end:e.start;var n=DocTreeManager.doc.getSection(t),o=DocTreeManager.doc.getSection(i);if(o&&n&&o.getSectionType()!==n.getSectionType()){var r=(n.getIndex(),n.getEndIndex(),o.getIndex(),o.getEndIndex(),DocLayoutManager.getColumnAtIndex(t));DocLayoutManager.getColumnAtIndex(i);if(n.getSectionType()===SECTION_TYPES.CONTENT&&(o.getSectionType()===SECTION_TYPES.ENDNOTE||o.getSectionType()===SECTION_TYPES.FOOTNOTE)||n.getSectionType()===SECTION_TYPES.ENDNOTE&&o.getSectionType()===SECTION_TYPES.FOOTNOTE){if(e.start=t,n.getSectionType()===SECTION_TYPES.CONTENT)e.end=ZWArrayUtils.lastElementOf(DocLayoutManager.getLineAtIndex(t).view.column.childViews.last.nodeLines).absEnd;else if(n.getSectionType()===SECTION_TYPES.ENDNOTE){var a=ZWArrayUtils.lastElementOf(r.getLastEndNote().getNode().children);e.end=a.getEndIndex()}}else n.getSectionType()===SECTION_TYPES.ENDNOTE?e.start=r.getPage().getFirstSection(SECTION_TYPES.ENDNOTE).getNode().getFirstChild().getIndex():n.getSectionType()===SECTION_TYPES.FOOTNOTE&&(e.start=r.getPage().getFirstSection(SECTION_TYPES.FOOTNOTE).getNode().children[0].getIndex()),e.end=t}o||e.end!==editor.doc.getDocumentLength()||(e.end=t)}},g=function(e){var t=e.getParents(NODE_TYPE.PARAGRAPH)||{};return t.dtNode&&t.dtNode.isHeading()},f=function(){var e=editor.doc.getSelection(),t=editor.doc.getDomCursorNode(e.SID,e.ZUID,"start");if(t&&e.isCollapsed()&&!isIPadSafariBrowser){var i=e.getComputedTextFormat(),n=e.getParaFormat(),o=TableUtil.getCellBgcAt(e.getStart()),r=editor.doc.getBodyFormat(),a={},s={};a[ATTR_TEXT.TS_BGC]=E(i[ATTR_TEXT.TS_BGC])||E(n[ATTR_PARAGRAPH.PS_BGC])||E(o[ATTR_CELL.Z_TD_BGC])||E(r[ATTR_BODY.DS_BGC]),s[ATTR_TEXT.TS_FGC]=E(i[ATTR_TEXT.TS_FGC]);var l=""!==a[ATTR_TEXT.TS_BGC]&&"#ffffff"!==ZWColorUtils.rgbToHex(a[ATTR_TEXT.TS_BGC]),d=DocUtil.getRenderingFormat(l?a:s);d=ZWColorUtils.rgbToHex(l?d[ATTR_TEXT.TS_BGC]||"rgb(255 , 255 , 255)":d[ATTR_TEXT.TS_FGC]||"rgb(0 ,0 ,0)");var c=ZWColorUtils.rgbToHex(a[ATTR_TEXT.TS_BGC]),u=ZWColorUtils.rgbToHex(l?ZWColorUtils.rgbToHex(DocUtil.getRenderingFormat(s).fgc):d);l=l?l:c===u;var p=l?ZWColorUtils.invertColor(d||"#000000"):d||"#000000";t.css("border-color",p),t[i&&"italic"==i[ATTR_TEXT.TS_FS]?"addClass":"removeClass"]("italic")}},E=function(e){var t=e&&e.toLowerCase()||"";if(!t||"none"===t||"transparent"===t)return"";if(0===t.indexOf("rgba")){var i=t.replace(/[rgba()]*/g,"").split(",")||[];return i.length>3&&"0"!==i[3].trim()?"rgb("+i[0].trim()+","+i[1].trim()+","+i[2].trim()+")":""}return e},T=function(e){ZWSelectionUtils.updateTablesInRange(e);var t,i,n=DocLayoutManager.getNodesBetweenRange(e.start,e.end)||[],o=n.length;if(e._.isMultipleTablesSelected){for(e._.selectedCells=[[],[]],i=0;i<o&&(t=n[i],t.type==NODE_TYPE.CELL);i++)e._.selectedCells[0]=e._.selectedCells[0].concat(t.getNode());for(i=o-1;i>=0&&(t=n[i],t.type==NODE_TYPE.CELL);i--)e._.selectedCells[1]=e._.selectedCells[1].concat(t.getNode())}else if(e._.isPartialTableSelectedFromTop)for(i=0;i<o&&(t=n[i],t.type==NODE_TYPE.CELL);i++)e._.selectedCells=e._.selectedCells.concat(t.getNode());else if(e._.isPartialTableSelectedFromBottom)for(i=0;i<o;i++)t=n[i],t.type==NODE_TYPE.CELL&&(e._.selectedCells=e._.selectedCells.concat(t.getNode()));e.updateCellsInrange()};return n}();!function(){"use strict";var e=ZWSelection,t=new ZWConsole,i=Array.prototype.slice,n=function(e,t,i){for(var n,o=0,r=e.length;o<r;o++)n=e[o],t.apply(this,[n.getStart()+1,n.getEnd()-1].concat(i))},o=function(e){var t=Utils.randomString();Op.processMsg([{r:e},{as:{start:{type:"cursor",uuid:editor.uuid},id:t}},{r:0},{as:{end:["type","uuid"],id:t}}])};e.prototype.applyFormat=function(e){var t,i,n=this.getLastRange(),o=n.start,r=n.end;if(this.isTableSelected())g(this.getSelectedCells(),e);else if(n.isMultipleTablesSelected()){t=o,i=r;var a=n.getSelectedDocCells();g(a[0],e,function(e){e.getEnd()>t&&(t=e.getEnd())}),g(a[1],e,function(e){e.getStart()<i&&(i=e.getStart())}),l(t+1,i-3,e)}else if(n.isPartialTableSelected())t=o,i=r,g(n.getSelectedDocCells(),e,function(e){e.getStart()<i&&(i=e.getStart()),e.getEnd()>t&&(t=e.getEnd())}),o<i&&i<r?l(o,i-3,e):l(t+1,r,e);else if(this.isListItemSelection)ListUtils.updateLevelStyles(this._.LIST_ID,this._.LIST_LEVEL,e);else for(var s=0,d=this.length;s<d;s++)n=this[s],l(n.start,n.end,e);return this},e.prototype.applyOnSelection=function(e){for(var t,o,r,a=0,s=this.length;a<s;a++){t=this.getRangeAt(a),o=t.start,r=t.end,editor.doc.getContent(o,r)!=UNICODE.HR&&(o=this.getCorrectedCursorPosition(o),r=this.getCorrectedCursorPosition(r),t.setStart(o),t.setEnd(r));var l=editor.doc.getCharAt(r);if(this.isEOPOnlySelected()&&(l==UNICODE.TABLE||l==UNICODE.HR||l==UNICODE.TOCSTART))return this.collapse(!0),this;var d=i.call(arguments,1);if(this.isTableSelected())n(this.getSelectedCells(),e,d);else if(t.isMultipleTablesSelected()){var c=o,u=r,p=t.getSelectedDocCells();n(p[0],e,d),n(p[1],e,d),c=p[0][0].parentNode().parentNode().getEnd(),u=p[1][0].parentNode().parentNode().getStart();var g=[];g.push(c),g.push(u),d=g.concat(d),e.apply(this,d)}else if(t.isPartialTableSelected()){var c=o,u=r,p=t.getSelectedDocCells();n(p,e,d);var f=p[0],E=f.getStart();E>o?u=f.parentNode().parentNode().getStart():c=f.parentNode().parentNode().getEnd();var g=[];g.push(c),g.push(u),d=g.concat(d),e.apply(this,d)}else{var g=[];g.push(o),g.push(r),d=g.concat(d),e.apply(this,d)}}return this},e.prototype.deleteContents=function(e,t){if(!e||!t||this.collaborator)return this;var i=editor.doc.getCharAt(e),n=editor.doc.getCharAt(t),o=editor.doc.getSectionStart(e)+1,a=editor.doc.getSectionEnd(e),s="",l=DocTreeManager.getAllSectionsByType(SECTION_TYPE.CONTENT);if(l[0].getIndex()+1===e&&l[l.length-1].getEndIndex()===t&&ZWLogger.log("DeleteContent: Deleted all contents In the document : Sel Start ::"+e+" Sel End ::"+t+" Last Operation ::"+editor.lastOperation+" Selection Type ::"+this.selectionType+" Event Keycode :: "+(event&&event.keyCode)),"undefined"!=typeof TransformHandler&&(s=TransformHandler.getCurrentObjectInfo().type),s===NODE_TYPE.IMAGE){var d,c=editor.doc.getRawFormatAt(e);c&&(c.type===NODE_TYPE.SIGNERFIELD&&c[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.ESIGN&&(d=c[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE])&&(d===SIGNERFIELD_TYPE.SIGNATURE||d===SIGNERFIELD_TYPE.INITIAL)||c.type===NODE_TYPE.FILLABLEFIELD)&&(t+=(UNICODE.IMAGE+UNICODE.RANGE_END).length)}Utils.isTrailSurrogateChar(i)&&e>o&&Utils.isLeadSurrogateChar(editor.doc.getCharAt(e-1))&&(e-=1),Utils.isTrailSurrogateChar(n)&&(t+=1);var u=editor.doc.getTrackChangeDetails(),p=u.getProcessingTC();if(u.setProcessingContentDeletion(!0),t+1==a){var g=DocTreeManager.doc.getSection(o).getSectionType();PubSub.publish("ZWSelection/BeforeClearSection",g)}if(t==a){if(e==o){this.paraFormat={type:NODE_TYPE.PARAGRAPH};var f=editor.doc.createElement(NODE_TYPE.PARAGRAPH);f.setStart(o),f.setEnd(o+1),f.insert();var E=this.getFirstRange();E.setStart(o+1);var T=[{r:e},{ds:editor.doc.getContent(e,t)}];if(Op.processMsg(T),/zw-contentpane/.test(editor.clientActiveSection&&editor.clientActiveSection.id||""))for(var m=editor.doc.findNextIndexOf(UNICODE.SECTION_START,e);m!=-1;){var h=editor.doc.getSectionEnd(m),I=editor.doc.getRawFormatAt(m),g=I[ATTR_SECTION.ST];ZWArrayUtils.arrayContains([CONST.HEADER_EVEN,CONST.HEADER_PRIMARY,CONST.FOOTER_EVEN,CONST.FOOTER_PRIMARY,CONST.HEADER_FIRST,CONST.FOOTER_FIRST],parseInt(g||-1))||(T=[{r:m},{ds:editor.doc.getContent(m,h)}],Op.processMsg(T)),m=editor.doc.findNextIndexOf(UNICODE.SECTION_START,h)}return u.setProcessingContentDeletion(!1),this}e++;var E=this.getFirstRange();E.setStart(o+1),PubSub.publish("ZWSelection/RangeAdded",E)}for(var _,A,S=!1,R="",O=e;O<t;O++){var b=editor.doc.getCharAt(O);switch(UNICODE.TOCSTART==b&&(r(O-R.length,R),R=""),!p||O!==_&&O!==A||(r(O-R.length,R),R="",_=A=void 0),b){case UNICODE.TOCSTART:var v=editor.doc.findNextIndexOf(UNICODE.TOCEND,e);Toc.deleteTOC(),O=v;break;case UNICODE.TOCEND:var D=editor.doc.findPreviousIndexOf(UNICODE.TOCSTART,e);D>0&&D>=e?R+=b:S=!0;break;case UNICODE.TABLE:var L=TableUtil.getTableEnd(O+1);L>0&&L<=t?R+=b:S=!0;break;case UNICODE.ROW:var N=TableUtil.getRowEnd(O+1);N>0&&N<=t?R+=b:S=!0;break;case UNICODE.CELL:var P=TableUtil.getCellEnd(O+1);P>0&&P<=t?R+=b:S=!0;break;case UNICODE.TABLEEND:var C=TableUtil.getTableStart(O);C>0&&C>=e?R+=b:S=!0;break;case UNICODE.RANGE_START:var y=DocUtil.getRangeEnd(O),I=editor.doc.getRawFormatAt(O);if(y<t)I&&I.type==NODE_TYPE.BOOKMARK&&I.id&&I.id.indexOf("toc_")==-1&&(delete editor.bookmarks[I.id],PubSub.publish("Bookmarkbutton/update")),I&&I.type===NODE_TYPE.FILLABLEFIELD?PubSub.publish("FillableFieldDeleted",I):I&&I.type===NODE_TYPE.NAMED_RANGE&&PubSub.publish("NamedRangeDeleted",I),R+=b;else if(!editor.doc.getTrackChangeDetails().isEnabled()&&I&&I.type!=NODE_TYPE.CONDITIONAL_IF_START){var F=DocUtil.getRangeEnd(O),M=editor.doc.findNextIndexOf(UNICODE.PARAGRAPH,t),f=editor.doc.getParents(NODE_TYPE.PARAGRAPH,M);f&&f.getStart()<F?(M=f.getStart(),M<e&&(M=e)):M=t,R+=b;var w=DocUtil.copyStyle(editor.doc.getRawFormatAt(O)),U=ZWJSONUtils.getKeys(w),T=[{r:M}];T.push({as:{start:w}}),T.push({is:UNICODE.RANGE_START}),T.push({as:{end:U}}),Op.processMsg(T)}else S=!0;break;case UNICODE.RANGE_END:var x=DocUtil.getRangeStart(O);if(x>=e){R+=b;var I=editor.doc.getRawFormatAt(O);if(I){var B=I.type;if(B==NODE_TYPE.ENDNOTE||B==NODE_TYPE.FOOTNOTE){var H=editor.doc.getFloatElement(B,I.id);H.section.remove()}}}else{var I=editor.doc.getRawFormatAt(O);if(!editor.doc.getTrackChangeDetails().isEnabled()&&I&&I.type!=NODE_TYPE.CONDITIONAL_IF_END){R+=b;var J=editor.doc.findPreviousIndexOf(UNICODE.PARAGRAPH,e);J<x&&(J=e);var w=DocUtil.copyStyle(editor.doc.getRawFormatAt(O)),U=ZWJSONUtils.getKeys(w),T=[{r:J}];T.push({as:{start:w}}),T.push({is:UNICODE.RANGE_END}),T.push({as:{end:U}}),Op.processMsg(T)}else S=!0}break;case UNICODE.FIELD_SEPARATOR:var G=DocUtil.getRangeStart(O),F=DocUtil.getRangeEnd(O);G>=e&&F<=t?R+=b:S=!0;break;case UNICODE.PARA:var I=editor.doc.getRawFormatAt(O);if(0!=O){var k=editor.doc.getCharAt(O-1),W=R[R.length-1];if(k==UNICODE.TABLEEND&&W!=UNICODE.TABLEEND){var Y=editor.doc.findNextIndexOf(CONT_REGEXP.PARAEND,O);if(Y>t)break}else if(editor.doc.getCharAt(O+1)===UNICODE.TOCEND){var D=editor.doc.findPreviousIndexOf(UNICODE.TOCSTART,e);if(D>0&&D>=e){S=!0;break}}}case UNICODE.IMAGE:var I=editor.doc.getRawFormatAt(O);if(I[ATTR_IMAGE.WM_INFO]){S=!0;break}R+=b,"textbox"==I.subType&&TextBoxHandler.removeTextBoxSection(I.id),PubSub.publish("ZWSelection/ImageDeleted",I);break;default:var I=editor.doc.getRawFormatAt(O);if(I){var g=I[ATTR_SECTION.ST];if(ZWArrayUtils.arrayContains([CONST.HEADER_EVEN,CONST.HEADER_PRIMARY,CONST.FOOTER_EVEN,CONST.FOOTER_PRIMARY,CONST.HEADER_FIRST,CONST.FOOTER_FIRST],parseInt(g||-1)))throw editor.lastError=new Error(ZWCollaboration.SHOW_SELECTION_ERROR),ZWLogger.log("_"+editor.lastError.message+"_SHOW_SELECTION_ERROR Given range: ["+e+", "+t+"], Last Op: "+editor.lastOperation+"\nException: Trying to delete a Header / Footer section character format @"+O+" is "+JSON.stringify(I)),editor.lastError;"image"==I.type&&PubSub.publish("ZWSelection/ImageDeleted",I)}R+=b}S&&(r(O-R.length,R),R="",S=!1)}if(R.length>0&&(r(O-R.length,R),R=""),u.setProcessingContentDeletion(!1),e>o){var z=DocUtil.getTextStyle(e),Z=editor.doc.getCharAt(e);z&&Z!=UNICODE.PARA&&(this.tempCursorFormat=z)}return this},e.prototype.deleteChar=function(e){if(this.collaborator)return this;var t,i,n,r,a,s,l,d,p,g=e===KEYS.BACKSPACE,f=e===KEYS.DELETE;for(t=0,i=this.length;t<i;t++)if(n=Utils.randomString(),r=this.getRangeAt(t),a=r.start,s=r.end,r.collapsed){if(g?d=c(this,a):f&&(p=u(this,a)),r=this.getRangeAt(t),a=r.start,s=r.end,g){if(a==editor.doc.getSectionStart(a))return this;if(d){a=r.start-1,s=r.end;var E=editor.doc,T=E.getRawFormatAt(a),m=E.getRawFormatAt(a+1);if(m&&m.type==NODE_TYPE.NAMED_RANGE){var h=E.getRawFormatAt(a-1);h&&h.type===NODE_TYPE.NAMED_RANGE&&(a-=1,s+=1)}var I=!1;if(T&&ListUtils.isList(T)&&ListUtils.isList(m)&&("text"==m.type||"paragraph"==m.type)&&s-a==1&&(I=!0),editor.doc.getCharAt(a)==UNICODE.PARA){var _=(editor.doc.getCharAt(a-1),E.getParents(NODE_TYPE.PARAGRAPH,a)),A=E.getNodesInSelection(NODE_TYPE.PARAGRAPH,r.start,r.end)[0].dtNode;if(I&&ZWCode.isContinueWithPreviousList(A))for(var S=A.next.id,R=A.next.format[ATTR_PARAGRAPH.LS_DATA].id,O=A.prev.format[ATTR_PARAGRAPH.LS_DATA].id,b=!1,v=DocTreeManager.doc.getSection(r.start).lists[R],D=0;D<v.length;D++)if(v[D].id==S&&(b=!0),b){var L=ZWJSONUtils.clone(v[D].format);L.ls_data.id=parseInt(O);var N=E.createElement(NODE_TYPE.PARAGRAPH);N.setStart(v[D].getEndIndex()),N.setEnd(v[D].getEndIndex()+1),N.attr(L)}if(_&&_.getEnd()-_.getStart()>1&&(editor.doc.getTrackChangeDetails().canCarryParaStyle()||TCHandler.isListData(editor.doc.getRawFormatAt(a)))||I){var L=DocUtil.copyStyle(editor.doc.getRawFormatAt(a));L[ATTR_PARAGRAPH.PS_NULL]=!0,L[ATTR_TEXT.TS_NULL]=!0,_=this.getParents(NODE_TYPE.PARAGRAPH);var P=ZWJSONUtils.getKeys(L),n=Utils.randomString(),C=[{r:_.getEnd()-1},{as:{start:L,id:n}},{r:1},{as:{end:P,id:n}}];Op.processMsg(C)}}l=a,this.deleteContents(a,s)}}else if(p){a=r.start,s=r.end+1;var m=editor.doc.getRawFormatAt(s);if(m&&m.type==NODE_TYPE.NAMED_RANGE){var h=editor.doc.getRawFormatAt(a-1);h&&h.type===NODE_TYPE.NAMED_RANGE&&(a-=1,s+=1)}if(editor.doc.getCharAt(a)==UNICODE.PARA){var E=editor.doc,_=E.getParents(NODE_TYPE.PARAGRAPH,a),A=DocTreeManager.getTreeNodeAtIndex(a),T=E.getRawFormatAt(a),m=E.getRawFormatAt(a+1),I=!1;if(T&&ListUtils.isList(T)&&ListUtils.isList(m)&&("text"==m.type||"paragraph"==m.type)&&s-a==1&&(I=!0),I&&ZWCode.isContinueWithPreviousList(A))for(var S=A.next.id,R=A.next.format[ATTR_PARAGRAPH.LS_DATA].id,O=A.prev.format[ATTR_PARAGRAPH.LS_DATA].id,b=!1,v=DocTreeManager.doc.getSection(r.start).lists[R],D=0;D<v.length;D++)if(v[D].id==S&&(b=!0),b){var L=ZWJSONUtils.clone(v[D].format);L.ls_data.id=parseInt(O);var N=E.createElement(NODE_TYPE.PARAGRAPH);N.setStart(v[D].getEndIndex()),N.setEnd(v[D].getEndIndex()+1),N.attr(L)}if(_&&_.getEnd()-_.getStart()>1){var L=DocUtil.copyStyle(editor.doc.getRawFormatAt(a));L[ATTR_PARAGRAPH.PS_NULL]=!0,L[ATTR_TEXT.TS_NULL]=!0;var y=E.findNextIndexOf(UNICODE.PARA,a+1);if(y>0&&(E.getTrackChangeDetails().canCarryParaStyle()||TCHandler.isListData(L))){var n=Utils.randomString(),P=ZWJSONUtils.getKeys(L),C=[{r:y},{as:{start:L,id:n}},{r:1},{as:{end:P,id:n}}];Op.processMsg(C)}}}l=s,this.deleteContents(a,s)}(g&&d||f&&p)&&(Op.cursorProcessed(),o(l))}else if(f){if(s==editor.doc.getSectionEnd(r.start)){r.setEnd(s-1);var L={};L[ATTR_COMMON.TYPE]=NODE_TYPE.PARAGRAPH,L[ATTR_PARAGRAPH.PS_NULL]=!0;var n=Utils.randomString(),P=ZWJSONUtils.getKeys(L),C=[{r:r.end},{as:{start:L,id:n}},{r:1},{as:{end:P,id:n}}];Op.processMsg(C)}this.deleteSelectedContents(r,t<i-1),Op.cursorProcessed(),o(r.end)}else{var F;editor.doc.getCharAt(r.start-1)===UNICODE.SPACE&&editor.doc.getCharAt(r.end)===UNICODE.SPACE?r.setEnd(r.end+1):1!==r.length||editor.doc.getCharAt(r.start)!==UNICODE.IMAGE||!(F=editor.doc.getRawFormatAt(r.start-1))||F.type!==NODE_TYPE.SIGNERFIELD&&F.type!==NODE_TYPE.FILLABLEFIELD||(r.start--,r.end++),this.deleteSelectedContents(r,!0),Op.cursorProcessed(),o(r.start)}return this};var r=function(e,t){t&&t.length&&Op.processMsg([{r:e},{ds:t}])};e.prototype.deleteSelectedContents=function(e,t){e=e||this.getLastRange();var i=e.start,n=e.end;editor.doc.getContent(i,n)!=UNICODE.HR&&(i=this.getCorrectedCursorPosition(i),n=this.getCorrectedCursorPosition(n),e.setStart(i),e.setEnd(n));var o=editor.doc.getCharAt(n);if(this.isEOPOnlySelected()&&(o==UNICODE.TABLE||o==UNICODE.HR||o==UNICODE.TOCSTART))return this.collapse(!0),this;var r=e.getNodes(NODE_TYPE.PARAGRAPH)||[];if(r.length>1){if(DocTreeViewManager.getNoteRanges(NODE_TYPE.ENDNOTE,i,n).length>1||DocTreeViewManager.getNoteRanges(NODE_TYPE.FOOTNOTE,i,n).length>1)return void PubSub.publish("Document/Warning",WARNING_MSG.OPERATION_NOT_ALLOWED);if(r[0].getStart()!==i&&r[0].getEnd()-1!==i){var s=r[0].getEnd();this.deleteContents(i,s-1),i=s}}if(this.isTableSelected())a(this,this.getSelectedCells()),this.removeTableSelection();else if(e.isMultipleTablesSelected()){var l=i,d=n,c=e.getSelectedDocCells();a(this,c[0],function(e){e.getEnd()>l&&(l=e.getEnd())}),a(this,c[1],function(e){e.getStart()<d&&(d=e.getStart())});this.deleteContents(l+1,d-3)}else if(e.isPartialTableSelected()){var l=i,d=n;a(this,e.getSelectedDocCells(),function(e){e.getStart()<d&&(d=e.getStart()),e.getEnd()>l&&(l=e.getEnd())}),i<d&&d<n?this.deleteContents(i,d-3):this.deleteContents(l+1,n),t=!1}else this.deleteContents(i,n);return this};var a=function(e,t,i){t.forEach(function(t){i&&i(t);var n=TableUtil.getCellEnd(t.getStart()+1);n>0&&e.deleteContents(t.getStart()+1,n-1)})};e.prototype.insert=function(e,t,i,n){var o=this.getLastRange(),r=o.start,a=o.end;this.isCollapsed()||(0==r&&a-r==1?o.setStart(a):(this.isTableSelected()||a>r)&&(this.length>1&&(o=this.getTargetRange()),this.deleteSelectedContents(o,!0))),r=o.start,e.setStart(r);var s=e.type;if(0!=r&&s==NODE_TYPE.PARAGRAPH||s==NODE_TYPE.HR||s==NODE_TYPE.BR||s==NODE_TYPE.IMAGE||t&&t.st==NODE_TYPE.TAB)this.textFormat=this.getTextFormat();else if(s==NODE_TYPE.TEXT&&0!=r){var l=editor.doc.getCharAt(r-1);if(ZWSelectionUtils.isEmpty(t)){if(DocUtil.isBoundaryChar(l)){var d=editor.doc.getRawFormatAt(r-1);if(t=d?d[ATTR_PARAGRAPH.PS_TS]:null,!t){var c=editor.doc.getRawFormatAt(r);t=c&&c.type==NODE_TYPE.TEXT&&c.st!=NODE_TYPE.TAB?DocUtil.copyStyle(c):this.getTextFormat()}}}else if(!DocUtil.isBoundaryChar(l)){var u=DocUtil.getTextStyle(e.getStart()-1);ZWJSONUtils.compareJSON(t,u)&&(t=void 0)}this.textFormat={}}return e.insert(t,i,n),this},e.prototype.mergeCells=function(){var e=this.getLastRange().getCells(),t=[],i=[];e.forEach(function(e){"fc"===e.getMergeType()?e.getMergeCells().forEach(function(e){ZWArrayUtils.arrayContains(i,e.id)||(t.push(e),i.push(e.id))}):ZWArrayUtils.arrayContains(i,e.id)||(t.push(e),i.push(e.id))}),t.sort(function(e,t){var i=e.parent.getChildIndex(),n=e.getChildIndex(),o=t.parent.getChildIndex(),r=t.getChildIndex();return i===o?n-r:i-o});var n=t[0].getMatrixPosition(),o=t[t.length-1].getMatrixPosition(),r=(t.length,editor.doc.getTrackChangeDetails(),m(t,n,o)),a=t[0].parent&&t[0].parent.parent;if(a&&a.format.type==NODE_TYPE.TABLE){for(var s,l,d,c,u=a.children.slice(n[0],o[0]+1),p=!0,g=0,f=0;f<u.length;f++){s=u[f].children.slice(n[1],o[1]+1);for(var E=0;E<s.length;E++){if(l=s[E],d=editor.doc.getElementAt(l.getIndex()),c={},p)p=!1,c[ATTR_CELL.TDS_RSPAN]=u.length,c[ATTR_CELL.TDS_CSPAN]=s.length,c[ATTR_CELL.TDS_MRG]="fc",g=TableUtil.getCellEnd(d.getStart()+1);else{d.attr(ATTR_CELL.TDS_MRG)&&(c[ATTR_CELL.TDS_MRG]=""),d.attr(ATTR_CELL.TDS_RSPAN)&&(c[ATTR_CELL.TDS_RSPAN]=""),d.attr(ATTR_CELL.TDS_CSPAN)&&(c[ATTR_CELL.TDS_CSPAN]=""),0==E?c[ATTR_CELL.TDS_MRG]="vmp":c[ATTR_CELL.TDS_MRG]="hmp";var T=d.getStart(),h=TableUtil.getCellEnd(d.getStart()+1);if(h-T>2){var I=editor.doc.createRange(T+1,h),_=OpUtil.getInsertionOps(I);_.sectionOps&&_.sectionOps.length&&TableUtil.handleSectionOpsArr(_.sectionOps);var A=_.ops;A[0]={r:g},Op.processMsg(A)}this.deleteContents(d.getStart(),d.getEnd()-1)}d.attr(c)}if(r.rowIds.contains(u[f].id))for(var S=u[f].children,R=null,O=null,b=null,v=0;v<S.length;v++)R=S[v],O=editor.doc.getElementAt(R.getIndex()),b={},b[ATTR_CELL.TDS_HT]=r.rowHtMap[u[f].id],O.attr(b)}this.removeTableSelection()}},e.prototype.isEOPOnlySelected=function(){var e=this.getFirstRange(),t=e.start,i=e.end;return i-t==1&&editor.doc.getContent(t,i)==UNICODE.PARA},e.prototype.getCorrectedCursorPosition=function(e){if(this._.IS_CELL_SELECTION)return e;0===e?e++:e===editor.doc.getDocumentLength()&&e--;var t=editor.doc.getCharAt(e);if(t===UNICODE.SECTION_START||t===UNICODE.HR||t===UNICODE.TABLE||t==UNICODE.CELL||t===UNICODE.ROW||t===UNICODE.TABLEEND||t===UNICODE.TOCSTART||t===UNICODE.TOCEND){if(editor.doc.getCharAt(e-1)===UNICODE.PARA){if(t===UNICODE.SECTION_START){var i=DocTreeManager.getSectionAtIndex(e-1),n=i&&i.next;return n&&n.getSectionType()===SECTION_TYPE.CONTENT&&i.getSectionType()===n.getSectionType()?++e:--e}return--e}for(var o,r=editor.doc.getSectionEnd(e),a=e;a<r;a++)if((o=editor.doc.getRawFormatAt(a))&&(o.type===NODE_TYPE.TEXT||o.type===NODE_TYPE.IMAGE||o.type===NODE_TYPE.BR||o.type===NODE_TYPE.PARAGRAPH||ZWSelectionUtils.isField(o.type)))return a}return e},e.prototype.getSelectedCells=function(){return this._.selectedCells};var s={paragraph:".zw-paragraph",table:".zw-table",tbody:".zw-tbody",tr:".zw-tr",td:".zw-td",link:".link",image:".zw-image"};e.prototype.hasDOMParent=function(t,i){var n,o=this.getLastRange(),r=i&&i==e.MODIFIED_POSITION_END?o.getEndPortionNode():o.getStartPortionNode();return!r||!(n=s[t])||!!J(r).closestParent(n)[0]},e.prototype.mouseDown=function(e,t){if(delete this._.isTableSelectionInProgress,this._.isTableSelected=!!this._.selectedCells.length,t||"mousedown"==e.type&&editor.browserInfo.is_mac&&e.ctrlKey&&(this.isTableSelected()||editor.browserInfo.is_safari)||t&&editor.browserInfo.is_mac)return!1;var i=e.target,n=W(i).hasClass("zw-td")?i:i.closest("td");n&&(this._.isTableSelectionInProgress=!0,this.setStartCell(n),this.setSelectedTable(J(this.getStartCell()).closestParent(NODE_NAME.TABLE)[0]),this.setEndCell(null))},e.prototype.mouseMove=function(e){if(this.isTableSelectionInProgress()&&(this.collaborator||!TableResize.isInProgress())){var t=document.elementFromPoint(e.clientX,e.clientY);DomUtil.nodeNameEquals(t,NODE_NAME.TD)||(t=J(t).closestParent(NODE_NAME.TD).get(0));var i=J(this.getStartCell()).closestParent(NODE_NAME.TABLE)[0],n=J(t).parents(NODE_NAME.TABLE);if(i==n[0])this.setEndCell(t);else for(var o=1;n[o];){if(i==n[o]){t=J(t).parents(NODE_NAME.TD)[o-1],this.setEndCell(t);break}o++}var r=J(t);return t==this.getStartCell()||r.closestParent(NODE_NAME.TABLE)[0]!=J(this.getStartCell()).closestParent(NODE_NAME.TABLE)[0]?(J(this.getSelectedTable()).find("td.selectedCell").removeClass("selectedCell").end().removeClass("unselectable_table"),delete this._.isTableSelected,!0):void(this.isTableSelectionInProgress()&&r.is(NODE_NAME.TD)&&this._.preCurrTd!=t&&(this.isTableSelected()||J(this.getStartCell()).parents(NODE_NAME.TABLE).addClass("unselectable_table"),this._.isTableSelected=!0,this.selectCells(),this._.preCurrTd=t))}},e.prototype.findNext=function(e,t,i,n,o){if(i)n=i.getEnd();else if(!n){var r=this.getLastRange();n=r.start,"end"==t&&(n=r.end)}var a=DocLayoutManager.getSectionViewAtIndex(n),s=a&&DocLayoutManager.getNextSection(a);editor.doc.getCharAt(n)==UNICODE.SECTION_START&&(n=s?n+1:n);for(var l,d,c,u=editor.doc.getSectionEnd(n),p=new RegExp(UNICODE.TABLE+"|"+UNICODE.TABLEEND+"|"+UNICODE.ROW+"|"+UNICODE.CELL+"|"+UNICODE.PARA+"|"+UNICODE.SECTION_START+"|"+UNICODE.RANGE_START+"|"+UNICODE.RANGE_END+"|"+UNICODE.BR+"|"+UNICODE.HR+"|"+UNICODE.TOCSTART+"|"+UNICODE.TOCEND,"g");!l&&n<u;){switch(d=editor.doc.getCharAt(n),c=editor.doc.getRawFormatAt(n),!0){case e.indexOf(NODE_TYPE.TEXT)>-1&&!p.test(d):l=editor.doc.createElement(NODE_TYPE.TEXT,d),l.setStart(n),l.setEnd(n+1);break;case e.indexOf(NODE_TYPE.BR)>-1&&d==UNICODE.BR:l=editor.doc.createElement(NODE_TYPE.BR,d),l.setStart(n),l.setEnd(n+1);break;case e.indexOf(NODE_TYPE.PARAGRAPH)>-1&&"\n"==d:l=editor.doc.createElement(NODE_TYPE.PARAGRAPH,d),l.setStart(n),l.setEnd(n+1);break;case d==UNICODE.HR&&e.indexOf(NODE_TYPE.HR)>-1:l=editor.doc.createElement(NODE_TYPE.HR),l.setStart(n),l.setEnd(n+1);break;case e.indexOf(NODE_TYPE.IMAGE)>-1&&d==UNICODE.IMAGE:l=editor.doc.createElement(NODE_TYPE.IMAGE),l.setStart(n),l.setEnd(n+1);break;case e.indexOf(NODE_TYPE.IFRAME)>-1&&d==UNICODE.IFRAME:l=editor.doc.createElement(NODE_TYPE.IFRAME),l.setStart(n),l.setEnd(n+1);break;case e.indexOf(NODE_TYPE.SECTION)>-1&&d==UNICODE.SECTION_START:var g=editor.doc.findNextIndexOf(CONT_REGEXP.SECTIONEND,n+1);g<0&&(g=u);var f=editor.doc.getContent(n,g);l=editor.doc.createElement(c[ATTR_SECTION.ST],c.sid),l.setStart(n),l.setEnd(g),l.setContent(f),n=g-1;break;case e.indexOf(UNICODE.RANGE_START)>-1&&d==UNICODE.RANGE_START&&o==c.type||e.indexOf(NODE_TYPE.FILLABLEFIELD)>-1&&d==UNICODE.RANGE_START&&o.indexOf(c.type)>-1||e.indexOf(NODE_TYPE.SIGNERFIELD)>-1&&d==UNICODE.RANGE_START&&o.indexOf(c.type)>-1||e.indexOf(NODE_TYPE.MAILMERGEFIELD)>-1&&d==UNICODE.RANGE_START&&o.indexOf(c.type)>-1:l=editor.doc.getElementAt(n)}n++}return l},e.prototype.findPrevious=function(e,t,i,n,o){if(i)n=i.getStart();else if(!n){var r=this.getLastRange();n=r.start,"end"==t&&(n=r.end)}for(var a,s,l,d=new RegExp(UNICODE.TABLE+"|"+UNICODE.TABLEEND+"|"+UNICODE.ROW+"|"+UNICODE.CELL+"|"+UNICODE.PARA+"|"+UNICODE.SECTION_START+"|"+UNICODE.RANGE_START+"|"+UNICODE.RANGE_END+"|"+UNICODE.BR+"|"+UNICODE.HR+"|"+UNICODE.TOCSTART+"|"+UNICODE.TOCEND,"g");!a&&n>0;)switch(n--,s=editor.doc.getCharAt(n),l=editor.doc.getRawFormatAt(n),!0){case e.indexOf(NODE_TYPE.TEXT)>-1&&!d.test(s):a=editor.doc.createElement(NODE_TYPE.TEXT,s),a.setStart(n),a.setEnd(n+1);break;case e.indexOf(NODE_TYPE.BR)>-1&&s==UNICODE.BR:a=editor.doc.createElement(NODE_TYPE.BR,s),a.setStart(n),a.setEnd(n+1);break;case e.indexOf(NODE_TYPE.PARAGRAPH)>-1&&"\n"==s:a=editor.doc.createElement(NODE_TYPE.PARAGRAPH,s),a.setStart(n),a.setEnd(n+1);break;case e.indexOf(NODE_TYPE.CELL)>-1&&s==UNICODE.CELL:a=editor.doc.createElement(NODE_TYPE.CELL),a.setStart(n);var c=editor.doc.findNextIndexOf(CONT_REGEXP.CELLEND,n+1);a.setEnd(c);break;case e.indexOf(NODE_TYPE.ROW)>-1&&s==UNICODE.ROW:a=editor.doc.createElement(NODE_TYPE.ROW),a.setStart(n);var u=editor.doc.findNextIndexOf(CONT_REGEXP.ROWEND,n+1);a.setEnd(u);break;case s==UNICODE.HR&&e.indexOf(NODE_TYPE.HR)>-1:a=editor.doc.createElement(NODE_TYPE.HR),a.setStart(n),a.setEnd(n+1);break;case e.indexOf(NODE_TYPE.IMAGE)>-1&&s==UNICODE.IMAGE:a=editor.doc.createElement(NODE_TYPE.IMAGE),a.setStart(n),a.setEnd(n+1);break;case e.indexOf(NODE_TYPE.IFRAME)>-1&&s==UNICODE.IFRAME:a=editor.doc.createElement(NODE_TYPE.IFRAME),a.setStart(n),a.setEnd(n+1);break;case e.indexOf(NODE_TYPE.SECTION)>-1&&s==UNICODE.SECTION_START:var p=editor.doc.findNextIndexOf(CONT_REGEXP.SECTIONEND,n+1);p<0&&(p=editor.doc.getSectionEnd(n));var g=editor.doc.getContent(n,p);a=editor.doc.createElement(l[ATTR_SECTION.ST],l.sid),a.setStart(n),a.setEnd(p),a.setContent(g),n=p-1;break;case e.indexOf(UNICODE.RANGE_START)>-1&&s==UNICODE.RANGE_START&&o==l.type:a=editor.doc.getElementAt(n)}return a},e.prototype.getNextWord=function(){var e,t,i=this.getLastRange(),n=i.start,o=editor.doc.getRawFormatAt(n);t=o&&o.id,e=f(n)&&t&&0!=t.indexOf("toc")?DocUtil.getRangeEnd(n)+1:ZWSelectionUtils.getWordEnd(n);var r=editor.doc.createElement(NODE_TYPE.TEXT);return r.setStart(n),r.setEnd(e),r},e.prototype.getTextPortionsInSelection=function(){var e,t,i,n=this.getNodesInSelection(NODE_TYPE.TEXT),o=0,r=0,a=n.length,s=[];for(o=0;o<a;o++)if(e=n[o],t=e.attr("*"),0==o||t&&t.type==NODE_TYPE.TEXT){for(i=editor.doc.createElement(NODE_TYPE.TEXT),i.setStart(e.getStart()),r=e.getStart()+1;r<e.getEnd();r++)editor.doc.getRawFormatAt(r)&&(i.setEnd(r),i.nodeValue=editor.doc.getContent(i.getStart(),i.getEnd()),s.push(i),i=editor.doc.createElement(NODE_TYPE.TEXT),i.setStart(r));i&&(i.setEnd(e.getEnd()),i.nodeValue=editor.doc.getContent(i.getStart(),i.getEnd()),s.push(i))}else s.push(e);return s},e.prototype.getPreviousWordWithoutSplChar=function(){return this.getPreviousWord(!0)},e.prototype.getPreviousWord=function(e){var t,i,n=this.getLastRange(),o=n.start,r=editor.doc.getRawFormatAt(o-1);i=r&&r.id,t=E(o-1)&&i&&0!=i.indexOf("toc")?DocUtil.getRangeStart(o-1):ZWSelectionUtils.getWordStart(o,e);var a=editor.doc.createElement(NODE_TYPE.TEXT);return a.setStart(t),a.setEnd(o),a},e.prototype.getWord=function(){function e(e){if(e<=1)return 1;if(s&&!o)return e;if(e--,ZWSelectionUtils.isWordBoundaryCharacter(editor.doc.getCharAt(e)))for(;e>0&&ZWSelectionUtils.isWordBoundaryCharacter(editor.doc.getCharAt(e));)e--;else if(ZWSelectionUtils.isSplChars(editor.doc.getCharAt(e)))for(;e>0&&ZWSelectionUtils.isSplChars(editor.doc.getCharAt(e));)e--;else for(;e>0;){var t=editor.doc.getRawFormatAt(e),i=t&&t.id;if(ZWSelectionUtils.isBoundaryCharacter(editor.doc.getCharAt(e))&&(!i||i.toString().indexOf("toc")==-1))break;if(ZWSelectionUtils.isCJKWordBoundaryChar(editor.doc.getCharAt(e)))break;e--}return e+1}function t(e){if(ZWSelectionUtils.isSplChars(editor.doc.getCharAt(e)))for(var t=editor.doc.getSectionEnd(e);e<t&&ZWSelectionUtils.isSplChars(editor.doc.getCharAt(e));)e++;else if(ZWSelectionUtils.isWordBoundaryCharacter(editor.doc.getCharAt(e)))for(var t=editor.doc.getSectionEnd(e);e<t&&ZWSelectionUtils.isWordBoundaryCharacter(editor.doc.getCharAt(e));)e++;else{if(o)return e;for(var t=editor.doc.getSectionEnd(e);e<t;){var i=editor.doc.getRawFormatAt(e),n=i&&i.id;if(ZWSelectionUtils.isBoundaryCharacter(editor.doc.getCharAt(e))&&(!n||n.toString().indexOf("toc")==-1))break;if(e++,ZWSelectionUtils.isCJKWordBoundaryChar(editor.doc.getCharAt(e)))break}}return e}var i,n,o,r=this.getLastRange(),a=r.start,s=!0;i=editor.doc.getCharAt(a),a>0&&(n=editor.doc.getCharAt(a-1)),o=ZWSelectionUtils.isBoundaryCharacter(i),n&&(s=ZWSelectionUtils.isBoundaryCharacter(n));var l=editor.doc.createElement(NODE_TYPE.TEXT),d=e(a),c=t(a),u=editor.doc.getRawFormatAt(d-1),p=editor.doc.getRawFormatAt(c);return u&&p&&u.type===NODE_TYPE.NAMED_RANGE&&p.type===NODE_TYPE.NAMED_RANGE&&u.id===p.id&&(d-=1,c+=1),l.setStart(d),l.setEnd(c),l},e.prototype.removeSelectedCellsBGImage=function(){return W.get(".zw-table").removeClass("unselectable_table"),editor.jeditorPane.find("td.selectedCell").removeClass("selectedCell"),this},e.prototype.resetTableSelection=function(){if(!this.isTableSelected()){var e=W(this.getSelectedTable());e[0]&&e.removeClass("unselectable_table")}return this._.isTableSelectionInProgress=!1,!1},e.prototype.selectAllCells=function(){var e=this.getTargetRange().getStartPortionNode();if(!(this._.selectedTable=J(e).closestParent(NODE_NAME.TABLE)[0]))return this;var t=DomViewManager.getDocView(this.getSelectedTable()).getNode(),i=t.firstChild().firstChild().getIndex()+1,n=t.lastChild().lastChild().getEndIndex()+1;if(ZWSelectionUtils.isEventhandlerSupported()&&EventHandler.isOnlyCtrlKeyPressed)return this.isCtrlSelection=!0,this.reArrangeRanges(i,n);var o=editor.doc.createRange(i,n);return this.removeAllRanges().addRange(o),!this.collaborator&&EditorUtil.focusMultiByteSpan(),this},e.prototype.selectCells=function(){var e=d(this.getStartCell(),this.getEndCell());e.left+=2,e.right-=2,e.bottom-=2,e.top+=2,this.isCtrlSelection||this.setSelectedCells([]);for(var t,i,n,o=this.getSelectedTable()&&this.getSelectedTable().dtNode||null,r=DomViewManager.getAllDomFromCurrentPage(o),a=0,s=r.length;a<s;a++)for(t=J(r[a]).find("td.zw-td"),i=0,n=t.length;i<n;i++){var l=t.eq(i),c=d(l[0]);if(p(e,c)||p(c,e)){if(l.closestParent(NODE_NAME.TABLE)[0]!=J(this.getStartCell()).closestParent(NODE_NAME.TABLE)[0])return;this._.selectedCells.push(DocUtil.getDocElement(l[0])),l.addClass("selectedCell")}else l.removeClass("selectedCell")}return this},e.showCollabCursors=function(){W.get("#hideCollabCursors").remove()},e.isCollabCursorShown=function(){return!document.getElementById("hideCollabCursors")},e.hideCollabCursors=function(){var e=document.getElementById("hideCollabCursors");e||(e=document.createElement(NODE_NAME.STYLE),e.id="hideCollabCursors",e.type="text/css",document.head.appendChild(e)),W(e).text(".otherUserCollapsedCursor,.otherUserCursorStart,.otherUserCursorEnd,.overlay.collaborator{display:none !important;}")},e.prototype.selectAllListItems=function(e){var i,n=e||this.getLastRange().start,o=DocTreeManager.getParents(NODE_TYPE.PARAGRAPH,n);if(!o||!o.paraProperties||!(i=o.paraProperties.listData))return this;for(var r,a,s=this.setSelectionType(SEL_MOUSE),l=1,d=0,c=DocTreeManager.doc.getAllSectionWithListId(i.id),u=i.listType==LIST_TYPE.LOWER_ROMAN||i.listType==LIST_TYPE.UPPER_ROMAN&&!o.paraProperties.isHeadingList,p=0;p<c.length;p++){r=c[p],a=r.lists[i.id]||[],t.log("@selectAllListItems :: list paras",a);var g,f,E;a.forEach(function(e){if(t.log("@selectAllListItems",e),e.paraProperties.listData.listLevel===i.listLevel){l&&(s.removeAllRanges(),s.isListItemSelection=!0,s._.LIST_LEVEL=i.listLevel,s._.LIST_ID=i.id),t.log("@selectAllListItems :: list level matched",e),n=e.getEndIndex(),E=(E=n+UNICODE.PARA.length)>=editor.doc.getDocumentLength()?n:E;var o=editor.doc.createRange(n,E);if(o.setFocus(!1),l?(s.addRange(o),l=0):!o.collapsed&&s.showCaret(o),g=g||o._.isHeaderActived,f=f||o._.isFooterActvied,o.collapsed)return;var r,a,c=DocLayoutManager.getListData(e),p=Math.max(c.listNumOriginalWidth,c.listCharSize.width),T=DocLayoutManager.getLineAtIndex(e.getIndex()),m=DomViewManager.getDOMElem(T),h=-1*(u?c.listCharSize.width:0),I=parseInt(m.style.paddingTop)||0,_=1,A=3;if(c.listType!==LIST_TYPE.IMAGE){var S=T.contentHeight,a=c.listCharSize.height;a<S&&(I=I+S-a-_),r=a+_}var R=editor.doc.getRawFormatAt(n),O=(R[ATTR_PARAGRAPH.PS_TI]||0).convertor().pixels*editor.zoomFactor,b=R.dir||PARA_DIR.LTR;if(b===PARA_DIR.LTR){if(R.al&&0!=R.al||u){var v=e.getIndex();h+=DocLayoutManager.getLeftAtIndex(v)-p}u||(p=p-c.listPaddingRight+A),u&&(h-=c.listRight-p),O>0&&(h+=O),h--,W.get(".overlay").eq(d++).css({left:h.toString()+"px",width:p.toString()+"px",height:r.toString()+"px",top:I.toString()+"px"})}else{var D=0;W.get(".overlay").eq(d++).css({right:D.toString()+"px",width:p.toString()+"px",height:r.toString()+"px",top:I.toString()+"px"})}}})}return g?ZWSelectionUtils.publishEvent(this,"header/changed"):f&&ZWSelectionUtils.publishEvent(this,"footer/changed"),ZWSelectionUtils.publishEvent(this,"ZWSelection/ListItemSelected"),this.setCursorFormat()},e.prototype.selectColumn=function(e){if(!e)return this;var t=Array.prototype.slice.call(e.parentElement.childNodes).indexOf(e),i=J(e).closestParent("table.zw-table"),n=DomViewManager.getDocView(i[0]).getNode(i),o=(n.firstChild().children[t].getIndex(),n.lastChild().children[t].getEndIndex()),r=this.getLastRange();return r.setEnd(n&&1==n.children.length?o+1:o),r._.isColumnSelection=!0,r.setFocus(!1),TableResize.setColSelection(!1),PubSub.publish("Selection/updateClientLeft"),this};var l=function(e,t,i){var n,o=DocTreeManager.doc.getSection(e),r=o.getSectionType();n=r===SECTION_TYPES.ENDNOTE||r===SECTION_TYPES.FOOTNOTE?DocTreeViewManager.getNoteRanges(r,e,t)||[]:[{start:e,end:t}];for(var a,s,l=0,d=n.length;l<d;l++)a=n[l],s=s||editor.doc.createElement(NODE_TYPE.TEXT,""),s.setStart(a.start),s.setEnd(a.end),s.attr(i)},d=function(e,t){var i={},n=J(e).offset();if(i.left=n.left,i.top=n.top,i.right=n.left+e.offsetWidth,i.bottom=n.top+e.offsetHeight,t){var o=J(t).offset(),r=o.left,a=o.top,s=o.left+t.offsetWidth,l=o.top+t.offsetHeight;i.left=r<i.left?r:i.left,i.top=a<i.top?a:i.top,i.right=s>i.right?s:i.right,i.bottom=l>i.bottom?l:i.bottom}return i},c=function(e,t){var i=editor.doc.getCharAt(t-1),n=editor.doc.getRawFormatAt(t-1),o=!0,r=editor.doc.getParents(NODE_TYPE.PARAGRAPH,t);if(t==r.getStart()){var a=r.attr(ATTR_PARAGRAPH.PS_DIR)||"ltr",s=r.attr(ATTR_PARAGRAPH.PS_AL),l=parseFloat(r.attr(ATTR_PARAGRAPH.PS_ML)),d=r.attr(ATTR_PARAGRAPH.EN_PB),u=parseFloat(r.attr(ATTR_PARAGRAPH.PS_TI)),p=DocLayoutManager.getSectionViewAtIndex(t),g=DocLayoutManager.getPrevSection(p);if(a==PARA_DIR.RTL&&(0==s?s=2:2==s&&(s=0)),"undefined"!=typeof Macros&&Macros.skipToApplyDefaultParaFormats()&&s&&(0!=s&&a==PARA_DIR.LTR||2!=s&&a==PARA_DIR.RTL)&&3!=s){var f={};f[ATTR_PARAGRAPH.PS_AL]=s-1+"",r.attr(f),o=!1}else if(d&&n[ATTR_PARAGRAPH.EN_PB])o=!1;else if(ListUtils.isList(r.attr("*"))){if(!r.attr(ATTR_PARAGRAPH.PS_CODE)||"section"==n.type){var E=r.attr(ATTR_PARAGRAPH.LS_DATA);E.l=-1,ListUtils.outdentList(E,r),o=!1}}else if(u&&0!=u){var m={};m[ATTR_PARAGRAPH.PS_TI]="0",r.attr(m),o=!1}else if("undefined"!=typeof Macros&&Macros.skipToApplyDefaultParaFormats()&&l>0&&!r.dtNode.isCode()){var h=w_usersettings[ATTR_BODY.DS_UN],I={};I[ATTR_PARAGRAPH.PS_ML]="0"+h,r.attr(I),o=!1}else if(i==UNICODE.HR){var _=e.findPrevious(NODE_TYPE.HR),A=e.getFirstRange();A.setStart(_.getStart()),A.setEnd(_.getEnd()),_.select(),o=!1}else if(i==UNICODE.SECTION_START&&g){var A=e.getFirstRange();A.setStart(A.start-2),A.setEnd(A.end-2),o=!0}else i&&i!=UNICODE.CELL&&i!=UNICODE.TABLEEND&&i!=UNICODE.TABLE&&i!=UNICODE.SECTION_START&&i!=UNICODE.TOCSTART&&i!=UNICODE.TOCEND||(o=!1)}else if(i==UNICODE.IMAGE){if("digisign-field"==n[ATTR_COMMON.ST])return!0;var S=e.findPrevious(NODE_TYPE.IMAGE),R=S.getStart(),O=S.getEnd();if(n.hasOwnProperty(ATTR_IMAGE.WM_INFO)){var A=editor.doc.createRange(R,R);e.removeAllRanges().addRange(A)}else if(n[ATTR_COMMON.SUBTYPE]==NODE_TYPE.TEXTBOX)TextBoxHandler.selectTextBox(R);else if(n[ATTR_FILLABLEFIELD.FF_INFO]){var A=editor.doc.createRange(R,O);e.removeAllRanges().addRange(A)}else{var A=e.getFirstRange();A.setStart(R),A.setEnd(O),S.select()}o=!1}else{if(i==UNICODE.SECTION_START&&!g)return!1;if(i==UNICODE.RANGE_END){if(n.type==NODE_TYPE.COMMENT){var A=editor.doc.createRange(t-1,t-1);return e.removeAllRanges().addRange(A),c(e,t-1)}if(n.type===NODE_TYPE.BOOKMARK&&n.id&&n.id.indexOf("toc_")!=-1||n.type===NODE_TYPE.REPEAT_END){if(!T(t-1,i,n,KEYS.BACKSPACE)){var A=editor.doc.createRange(t-1,t-1);return e.removeAllRanges().addRange(A),!1}var A=e.getFirstRange();return A.setStart(t-1),A.setEnd(t),!0}var b=editor.doc.getRawFormatAt(DocUtil.getRangeStart(t-1));if(b.type===NODE_TYPE.FILLABLEFIELD&&b.hasOwnProperty(ATTR_IMAGE.I_WRAP_TYPE)){var A=e.getFirstRange();return A.setStart(DocUtil.getRangeStart(t-1)),A.setEnd(t),PubSub.publish("Field/Selected",b.id,{idx:A.start}),!1}var A=editor.doc.createRange(DocUtil.getRangeStart(t-1),t);e.removeAllRanges().addRange(A),o=!1}else if(i==UNICODE.RANGE_START){if(n.type==NODE_TYPE.COMMENT){var A=editor.doc.createRange(t-1,t-1);return e.removeAllRanges().addRange(A),c(e,t-1)}if(n.type===NODE_TYPE.BOOKMARK&&n.id&&n.id.indexOf("toc_")!=-1||n.type===NODE_TYPE.REPEAT_START){if(!T(t-1,i,n,KEYS.BACKSPACE)){var A=editor.doc.createRange(t-1,t-1);return e.removeAllRanges().addRange(A),!1}var A=e.getFirstRange();return A.setStart(t-1),A.setEnd(t),!0}var A=editor.doc.createRange(t-1,DocUtil.getRangeEnd(t-1)+1);e.removeAllRanges().addRange(A),o=!1}else if(i==UNICODE.FIELD_SEPARATOR){var A=editor.doc.createRange(DocUtil.getRangeStart(t-1),DocUtil.getRangeEnd(t-1)+1);e.removeAllRanges().addRange(A),o=!1}}return o},u=function(e,t){var i=editor.doc.getCharAt(t),n=editor.doc.getRawFormatAt(t),o=editor.doc.getCharAt(t+1),r=DocLayoutManager.getSectionViewAtIndex(t),a=r&&DocLayoutManager.getNextSection(r);if(i==UNICODE.TABLEEND||i==UNICODE.TABLE||i==UNICODE.CELL||i==UNICODE.ROW||i==UNICODE.TOCSTART||i==UNICODE.TOCEND)return!1;if(i==UNICODE.PARA&&o==UNICODE.IFRAME){var s=e.getFirstRange(),l=e.findNext(NODE_TYPE.IFRAME);return s.setStart(l.getStart()),s.setEnd(l.getEnd()+1),!1}if(i==UNICODE.PARA&&o==UNICODE.HR){var d=e.findNext(NODE_TYPE.HR);d.select();var s=e.getFirstRange();return s.setStart(d.getStart()),s.setEnd(d.getEnd()),!1}if(i==UNICODE.IMAGE){if(isV8Engine||"digisign-field"==n[ATTR_COMMON.ST])return!0;var l=e.findNext(NODE_TYPE.IMAGE),c=l.getStart(),p=l.getEnd();if(n.hasOwnProperty(ATTR_IMAGE.WM_INFO)){var s=editor.doc.createRange(p,p);e.removeAllRanges().addRange(s)}else if(n.hasOwnProperty(ATTR_IMAGE.I_SHAPEDATA))InsertShape.moveCursorIdx(c,p);else if(n[ATTR_COMMON.SUBTYPE]==NODE_TYPE.TEXTBOX)TextBoxHandler.selectTextBox(c);else if(n[ATTR_FILLABLEFIELD.FF_INFO]){var s=editor.doc.createRange(c,p);e.removeAllRanges().addRange(s)}else{var s=e.getFirstRange();s.setStart(c),s.setEnd(p),l.select()}return!1}if(i==UNICODE.SECTION_START&&!a)return!1;if(i==UNICODE.RANGE_START){if(n.type==NODE_TYPE.COMMENT){var s=editor.doc.createRange(t+1,t+1);return e.removeAllRanges().addRange(s),u(e,t+1)}if(n.type===NODE_TYPE.BOOKMARK&&n.id&&n.id.indexOf("toc_")!=-1||n.type===NODE_TYPE.REPEAT_START){if(!T(t,i,n,KEYS.DELETE)){var s=editor.doc.createRange(t+1,t+1);return e.removeAllRanges().addRange(s),!1}var s=e.getFirstRange();return s.setStart(t),s.setEnd(t+1),!0}if(n.type===NODE_TYPE.FILLABLEFIELD&&n.hasOwnProperty(ATTR_IMAGE.I_WRAP_TYPE)){var s=e.getFirstRange();return s.setStart(t),s.setEnd(DocUtil.getRangeEnd(t)+1),PubSub.publish("Field/Selected",n.id,{idx:s.start}),!1}var s=editor.doc.createRange(t,DocUtil.getRangeEnd(t)+1);return e.removeAllRanges().addRange(s),!1}if(i==UNICODE.RANGE_END){if(n.type===NODE_TYPE.COMMENT){var s=editor.doc.createRange(t+1,t+1);return e.removeAllRanges().addRange(s),u(e,t+1)}if(n.type===NODE_TYPE.BOOKMARK&&n.id&&n.id.indexOf("toc_")!=-1||n.type===NODE_TYPE.REPEAT_END){if(!T(t+1,i,n,KEYS.DELETE)){var s=editor.doc.createRange(t+1,t+1);return e.removeAllRanges().addRange(s),!1}var s=e.getFirstRange();return s.setStart(t),s.setEnd(t+1),!0}var s=editor.doc.createRange(DocUtil.getRangeStart(t),t+1);return e.removeAllRanges().addRange(s),!1}if(i==UNICODE.FIELD_SEPARATOR){var s=editor.doc.createRange(DocUtil.getRangeStart(t),DocUtil.getRangeEnd(t)+1);return e.removeAllRanges().addRange(s),!1}if(i==UNICODE.PARA&&o==UNICODE.SECTION_START&&a&&DocLayoutManager.getSectionViewAtIndex(t+1).getSectionType()===r.getSectionType()){var s=e.getTargetRange();return s.setEnd(t+1),!0}return!(i==UNICODE.PARA&&(!o||o==UNICODE.SECTION_START&&!a||o==UNICODE.CELL||o==UNICODE.TABLE||o==UNICODE.TABLEEND||o==UNICODE.ROW||o==UNICODE.TOCSTART||o==UNICODE.TOCEND))},p=function(e,t){return(e.left<=t.left&&t.left<e.right||e.left<t.right-2&&t.right-2<=e.right)&&(e.top<=t.top&&t.top<e.bottom||e.top<t.bottom-2&&t.bottom-2<=e.bottom)},g=function(e,t,i){e.forEach(function(e){i&&i(e);var n=TableUtil.getCellEnd(e.getStart()+1);n>0&&l(e.getStart()+1,n,t)})},f=function(e){return editor.doc.getCharAt(e)===UNICODE.RANGE_START},E=function(e){return editor.doc.getCharAt(e)===UNICODE.RANGE_END},T=function(e,t,i,n){var o=n==KEYS.BACKSPACE?e-1:e+1,r=editor.doc.getRawFormatAt(o);if(t===UNICODE.RANGE_START||t===UNICODE.RANGE_END)switch(i.type){case NODE_TYPE.REPEAT_START:return r.type===NODE_TYPE.REPEAT_END;case NODE_TYPE.REPEAT_END:return r.type===NODE_TYPE.REPEAT_START;default:return!1}},m=function(e,t,i){var n={rowIds:[],rowHtMap:{}},o=i[0]-t[0]+1,r=i[1]-t[1]+1,a=e[0],s=e[e.length-1],l=a.parent,d=s.parent,c=l,u=l.parent;if(u.cols.length==r&&1!=o)for(var p=0;c;){if(p+=DocLayoutManager.getViewsHeight(c),c.id==d.id){n.rowIds.push(l.id),n.rowHtMap[l.id]=(p+"px").convertUnitTo(Conversions.globalUnit)+Conversions.globalUnit;break}c=c.next}else if(1!=o)for(var g,f,E,T=u.children.slice(t[0],i[0]+1),p=0,m=function(e){return!(!e.merge||"fc"!=e.merge)},h=function(e,t){return t.rspan<e.rspan&&(e=t),e},I=0;I<T.length;I++){g=T[I],f=[];for(var _=0;_<g.children.length;_++)f.push(g.children[_]);f.splice(t[1],r);for(var A=!0,_=0;_<f.length;_++)if(!f[_].merge){A=!1;break}if(A&&(f=f.filter(m),0!=f.length)){if(E=f.reduce(h),E.rspan>o)for(var p=0;c;){if(p+=DocLayoutManager.getViewsHeight(c),c.id==d.id){n.rowIds.push(l.id),n.rowHtMap[l.id]=(p+"px").convertUnitTo(Conversions.globalUnit)+Conversions.globalUnit;break}c=c.next}else{var S=E.getLastVmpCell();if("fc"==S.merge)continue;if(!S.merge)throw new Error("Invalid last vmp cell node.");for(var R=DocLayoutManager.getViews(E),_=0;_<R.length;_++)p+=R[_].getFCCellTotalHeight()}n.rowIds.push(g.id),n.rowHtMap[g.id]=(p+"px").convertUnitTo(Conversions.globalUnit)+Conversions.globalUnit}}return n};e.prototype.surroundAndInsert=function(e,t,i,n){var o=this.getLastRange(),r=o.start,a=o.end;if(this.isCollapsed()||editor.doc.getCharAt(a-1)!=UNICODE.PARA||(a-=1),e.style||t.style){var s=ZWJSONUtils.getKeys(e.style),l=ZWJSONUtils.getKeys(t.style),d=Utils.randomString(),c=Utils.randomString(),u=[{r:r},{as:{start:e.style,id:d}},{is:e.char},{as:{end:s,id:d}}];if(i.css){var p=Utils.randomString();u.push({as:{start:i.css,id:p}}),u.push({is:i.nodeValue});var g=i.css,f=ZWJSONUtils.getKeys(g);u.push({as:{end:f,id:p}})}else u.push({is:i.nodeValue});u.push({as:{start:t.style,id:c}}),u.push({is:t.char}),u.push({as:{end:l,id:c}})}else{var u=[{r:r},{is:e.char}];if(i.css){var p=Utils.randomString();u.push({as:{start:i.css,id:p}}),u.push({is:i.value});var g=i.css,f=ZWJSONUtils.getKeys(g);u.push({as:{end:f,id:p}})}else u.push({is:i.value});u.push({is:t.char})}return Op.processMsg(u),n&&Op.appendCursor(),this},e.prototype.canDeletePrevChar=function(e){e=e?e:this.getStart();var t=c(this,e);return!t&&Op.sendMsg(),t};var h={active:[],context:{},handlers:{}};e.prototype.bind=function(e,t){var i=h.context[e];return i||(h.context[e]=i=[]),i.push(t.id=Utils.randomString()),h.handlers[t.id]=t,this},e.prototype.unbind=function(e,t){var i=h.context[e];if(i&&i.contains(t.id)){var n=h.active;return n.length&&n.splice(n.indexOf(t.id),1),i.length&&i.splice(i.indexOf(t.id),1),delete h.handlers[t.id],this}},PubSub.subscribe("Cursor/Collapsed",function(){for(var e,t=editor.doc.getSelection().getTargetRange(),i=editor.doc.getRawFormatAt(t.start)||{},n=i.cls===NODE_TYPE.SIGNERFIELD||i[ATTR_SIGNERFIELD.SFINFO],o=h.context[n?NODE_TYPE.SIGNERFIELD:i.cls===NODE_TYPE.FILLABLEFIELD?i.cls:i.ffInfo?NODE_TYPE.FILLABLEFIELD:i.type],r=h.active,a=r.length;a;)e=h.handlers[r[a-1]],e.onDeselect.call(),r.splice(r.indexOf(e.id),1),a--;if(o&&o.length)for(var e,s=0,a=o.length;s<a;s++)e=h.handlers[o[s]],e.onSelect.call(),r.push(e.id)})}(),function(e){"use strict";PubSub.subscribe("ZWRange/ClearSelection",function(e,t){var i=e.collaborator?"":".cursor";J("#z-cursor-start-"+e.SID+i).add("#z-cursor-end-"+e.SID+i).remove(),isIPadSafariBrowser&&e.collapsed&&J("#z-cursor-start-"+e.SID+"_start").add("#z-cursor-end-"+e.SID+"_end").remove();for(var n=(t||editor.jeditorPane[0]).getElementsByClassName("overlay"),o=n.length-1;o>=0;o--){var r=J(n[o]),a=r.length&&JSON.parse(r[0].getAttribute("data-range-info"))||JSON.parse(n[0].getAttribute("data-range-info"));a&&a.SID===e.SID&&a.id==e.id&&r.remove()}});var t=document.getElementById("mouseMoveSelection");t=document.createElement(NODE_NAME.STYLE),t.id="mouseMoveSelection",t.type="text/css",t.media="screen",document.head.appendChild(t),J(t).text("div#editorpane span::selection { background: transparent;} div#editorpane span::-moz-selection { background: transparent;} .zw-line-div::selection, .zw-line-content::selection, .zw-contentpane::selection, .zw-page::selection, .zw-column::selection, .zw-column-container::selection{background: transparent;} .zw-line-div::-moz-selection, .zw-line-content::-moz-selection, .zw-contentpane::-moz-selection, .zw-page::-moz-selection, .zw-column::selection,.zw-column-container::-moz-selection{background: transparent;} #editorpane::selection, #drawcontainer::selection, #editorpane-container::selection, #ui-editor-outer-div::selection {background: transparent;}#editorpane::-moz-selection, #drawcontainer::-moz-selection, #editorpane-container::-moz-selection, #ui-editor-outer-div::-moz-selection {background: transparent;}");var i,n,o,r,a={NONE:0,DOWN:1,UP:2},s=(" "+UNICODE.BR,[UNICODE.TABLE,UNICODE.TABLEEND,UNICODE.ROW,UNICODE.CELL,UNICODE.SECTION_START,UNICODE.SECTION_END,UNICODE.RANGE_START,UNICODE.RANGE_END,UNICODE.TOCEND,UNICODE.TOCSTART,UNICODE.IMAGE,UNICODE.HR],new ZWConsole),l=function(e,t){var i,n,o=t.paraProperties.listData,r=(o.listType==LIST_TYPE.LOWER_ROMAN||o.listType==LIST_TYPE.UPPER_ROMAN)&&!t.paraProperties.isHeadingList,a=DocLayoutManager.getListData(t),s=Math.max(a.listNumOriginalWidth,a.listCharSize.width),l=DocLayoutManager.getLineAtIndex(t.getIndex()),d=DomViewManager.getDOMElem(l),c=-1*(r?a.listCharSize.width:0),u=1,p=3,g=parseInt(d.style.paddingTop)||0;a.listType!==LIST_TYPE.IMAGE&&(n=a.listCharSize.height,n<l.contentHeight&&(g=g+l.contentHeight-n-u),i=n+u),PubSub.publish("ZWRange/ClearSelection",e,d);var f=ZWSelectionUtils.getLayer(e,l.start),E=editor.doc.getRawFormatAt(t.getEndIndex()),T=(E[ATTR_PARAGRAPH.PS_TI]||0).convertor().pixels*editor.zoomFactor,m=E.dir||PARA_DIR.LTR;if(m===PARA_DIR.LTR){if(E.al||r){var h=t.getIndex();c+=DocLayoutManager.getLeftAtIndex(h)-s}r||(s=s-a.listPaddingRight+p),r&&(c-=a.listRight-s),T>0&&(c+=T),c--,J(f).appendTo(d).css({left:c,width:s,height:i,top:g})}else{var I=0;J(f).appendTo(d).css({right:I,width:s,height:i,top:g})}},d=function(e,t){for(var i,n,o,r=0;r<t.length;r++){var a=t[r],s=DomViewManager.getDOMElemById(a.id),l=DomViewManager.getDOMElemById(a.parentId);if(!s||!l)return;var d,c,u=DomViewManager.getDTNode(l);if(PubSub.publish("ZWRange/ClearSelection",e,s),u.type===NODE_TYPE.ROW){var p=(DomViewManager.getDocView(l),DomViewManager.getDocView(s)),g=DomViewManager.getDTNode(s).getIndex(),f=p.column.id||p.getPage().getId(),E=J(s).find("div.zw-cell-container:first")[0]||void 0;for(i=0;i<a.rects.length;i++)n=ZWSelectionUtils.getLayer(e,g+i,f),o=a.rects[i],J(n).appendTo(E).css({width:o.width,height:o.height,top:o.top||0,left:o.left||0})}else for(d=DomViewManager.getDocView(l),c=d.getNodeLineWithId(a.id).absStart,i=0;i<a.rects.length;i++)n=ZWSelectionUtils.getLayer(e,c+i),o=a.rects[i],J(n).appendTo(s).css({width:o.width,height:o.height,top:o.top,left:o.left})}},c=function(e,t,i,n){try{t=t||e.start,i=i||e.end,t<e.start&&(t=e.start),i>e.end&&(i=e.end);var o=i;if(editor.doc.getSelection(e.SID).isListItemSelection&&"regeneratetoc"!=editor.lastOperation)return l(e,DocTreeManager.getParents(NODE_TYPE.PARAGRAPH,t));var r=DocLayoutManager.getRectsToDrawSelection(t,o,n);d(e,r)}catch(e){ZWLogger.log(e.stack)}},u=function(e){if(e._.focus&&!e.collaborator&&e.getStartPortionNode()&&e.getEndPortionNode()&&(!ZWSelectionUtils.isEventhandlerSupported()||!EventHandler.isOnlyCtrlKeyPressed)){var t=PUtil.offsetTop(e.getStartPortionNode())*editor.zoomFactor,i=PUtil.offsetTop(e.getEndPortionNode())*editor.zoomFactor,n=editor.editorPaneContainer[0].scrollTop,o=editor.editorPaneContainer.height()-W.get("#bottombar").height(),r=o+n,s=0;t<n&&i<n?s=i-n-30:t<n&&(i<n||e._.scrollDirection==a.DOWN)?s=t-n:i>r&&t>r?s=t-r:i>r&&(t>r||e._.scrollDirection==a.UP)&&(s=i-r+30),s&&(editor.editorPaneContainer[0].scrollTop+=s)}},p=function(e){var t=DocLayoutManager.getLineAtIndex(e);return!!t&&t.parent.getIndex()+t.start===e},g=function(e){if(f(e)){var t,n=DocLayoutManager.getColumnAtIndex(e.start),o=DocLayoutManager.getCurrentSection().sectionType,r=!!DocTreeManager.getParents(NODE_TYPE.TEXTBOX,e.start);if(null==n||r||o===SECTION_TYPE.HEADER||o===SECTION_TYPE.FOOTER?(t=DocLayoutManager.getPageWithId(editor.getPageID())||DocLayoutManager.getFirstPage(),editor.currentColumnIndex=0):(t=n.getPage(),editor.currentColumnIndex=n.getColumnIndex()),t){var a=t.getAbsolutePageNumber();!e.collaborator&&e._.focus&&(editor.currentPageIndex=a-1),DomViewManager.forceToRender(t)}var s=editor.doc.getSelection()._.PREV_RANGE;if(!s||!s.collapsed){var l=DocLayoutManager.getCurrentSection().sectionType;l==SECTION_TYPE.HEADER?ZWSelectionUtils.publishEvent(e,"header/changed"):l==SECTION_TYPE.FOOTER&&ZWSelectionUtils.publishEvent(e,"footer/changed")}if(e.collapsed){var d=editor.doc.getDomCursorNode(e.SID,e.ZUID,"start")||J(CurUtil.createCursor("start",e.SID));if(!d||!d[0])return;e.collaborator&&d.removeClass("otherUserCursorStart").removeClass("otherUserCursorEnd").addClass("otherUserCollapsedCursor"),_(e,d),clearTimeout(i),e.collaborator||(i=setTimeout(function(){editor.getRole().permissions.can("document.edit")&&ZWSelectionUtils.isEventhandlerSupported()&&!EventHandler.isMenuOpened&&!EventHandler.isDialogOpened&&!J(editor.doc.getDomCursorNode(e.SID,e.ZUID,"start")).hasClass("selectionHanldlerStart")&&J(editor.doc.getDomCursorNode(e.SID,e.ZUID,"start")).addClass("blink")},500))}else!e.collaborator&&J(editor.doc.getDomCursorNode(e.SID,e.ZUID,"start")).css("visibility","hidden"),E(e);var c=editor.doc.getSelection();c.isMouseMoveSelection||(ZWSelectionUtils.publishEvent(e,"SDK/Cursor/Collapsed"),ZWSelectionUtils.publishEvent(e,e.collapsed?"Cursor/Collapsed":"Cursor/Selected"))}else try{throw new Error(ZWCollaboration.NO_LINE_CANNOT_SELECT)}catch(e){ZWLogger.sendErrorDetails("NO_ERROR_MAIL<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>NO_LINE_CANNOT_SELECT\nCLIENT INFO: "+ZWCollaboration.clientInfo+"\nException Stack: "+e.stack,null,ZWCollaboration.NO_LINE_CANNOT_SELECT)}},f=function(e){if(e.start){var t,i;if((t=DocLayoutManager.getLineAtIndex(e.start))||(i="!!CAN'T SELECT!! There is no line for start. Range: ["+e.start+", "+e.end+"]"),e.collapsed||!e.end||(t=DocLayoutManager.getLineAtIndex(e.end))||(i="!!CAN'T SELECT!! There is no line for end. Range: ["+e.start+", "+e.end+"]"),!i)return!0;ZWLogger.log(i),s.warn(i)}return!1},E=function(e){if(e.collaborator)return h(e);isIPadSafariBrowser&&h(e),editor.doc.setDomCursorIdx(e.SID,"start",e.start),editor.doc.setDomCursorIdx(e.SID,"end",e.end);try{e.collaborator||(b(e),ZWSelectionUtils.isEventhandlerSupported()&&EventHandler.mouseDown_coord.isLineEnd&&(EventHandler.mouseDown_coord.isLineEnd=!1,editor.doc.setCursorPortionNode(e.SID,"start",EventHandler.mouseDown_coord.portion))),O(e);var t=editor.doc.getSelection(e.SID);t._.PREV_RANGE&&!e.isSameRange(t._.PREV_RANGE)&&(e._.scrollDirection=e.start==t._.PREV_RANGE.start?a.UP:a.NONE,e._.scrollDirection=e.end==t._.PREV_RANGE.end?a.DOWN:e._.scrollDirection),T(e)}catch(t){return s.error(t),ZWLogger.log(Utils.getMouseLogs()),void ZWLogger.log("_"+editor.lastError.message+"_SHOW_CARET_SELECTION_ERROR_ Range: ["+e.start+", "+e.end+"]\nException: "+t.stack)}s.log(e);var i=editor.doc.getDomCursorNode(e.SID,e.ZUID,"start");!isIPadSafariBrowser&&i.css({top:0,left:CurUtil.offset.start.left,visibility:"hidden"});var n=editor.editorPaneContainer[0].scrollTop;editor.jMultiByteSpan&&editor.jMultiByteSpan.css({top:n/editor.zoomFactor}),EditorUtil.updateMultiByteSpanLeft(),CurUtil.scrollTop!=n&&(editor.editorOffset=editor.jeditorPane.offset(),CurUtil.scrollTop=n)},T=function(e){if(u(e),m(e),e._.isHeaderActived?ZWSelectionUtils.publishEvent(e,"header/changed"):e._.isFooterActvied&&ZWSelectionUtils.publishEvent(e,"footer/changed"),DocTreeManager.doc.getSection(editor.doc.getSelection()[0].start).getSectionType()===SECTION_TYPES.TEXTBOX){var t=DomViewManager.getDomFromCurrentPage(DocLayoutManager.getCurrentLine());editor.clientActiveSection=J(t).parents("div.zw-textbox-div")[0],editor.prevClientActiveSection=editor.clientActiveSection}e._.isHeaderRowActived&&PubSub.publish("Document/Table/HeaderView/Update"),v(e),e._.isRowSelection=e._.isColumnSelection=!1},m=function(e){var t=editor.doc.getSelection(e.SID);t.getSelectedCells().length&&(t.isCtrlSelection||t.setSelectedCells([]),t.setIsTableSelected(!1)),e._.isSelectionWithinTable?R(e):c(e)},h=function(e){var t=editor.doc.getSelection(e.SID),i=editor.doc.createRange(e.start,e.start,e.SID),n=DocTreeManager.getTreeNodeAtIndex(e.start),o=n.end===e.end;if(isIPadSafariBrowser){var r,a=e.SID!==editor.uuid;if(t.isListItemSelection)return;var s=J(editor.doc.getDomCursorNode(e.SID,e.ZUID,"start",!0)),l=a?J(CurUtil.createCursor("start",e.SID)).removeClass("otherUserCollapsedCursor").addClass("otherUserCursorStart"):s.length&&s.addClass("selectionHanldlerStart")||J(CurUtil.createCursor("start",e.SID)).removeClass("otherUserCollapsedCursor").addClass("selectionHanldlerStart");_(i,l),a||(l.css("border-color","rgba(20,119,225,0.6)"),l.removeClass("blink").find(".handler-callout-con").css("display","block"));var d=DocLayoutManager.getLineAtIndex(e.start);r=DocLayoutManager.getRectsToDrawSelection(e.start,e.start,"document")[0].rects[0];var c=r.top;l.css({height:r.height,top:c,left:function(e,t){return parseFloat(t)}}),i=editor.doc.createRange(e.end,e.end,e.SID),EventHandler.mouseDown_coord.isLineEnd=o;var u=J(editor.doc.getDomCursorNode(e.SID,e.ZUID,"end",!0)),l=a?J(CurUtil.createCursor("end",e.SID)).removeClass("otherUserCollapsedCursor").addClass("otherUserCursorEnd"):u.length&&u.addClass("selectionHanldlerEnd")||J(CurUtil.createCursor("end",e.SID)).removeClass("otherUserCollapsedCursor").addClass("selectionHanldlerEnd");return _(i,l),a||(l.css("border-color","rgba(20,119,225,0.6)"),l.find(".handler-callout-con").css("display","block")),d=DocLayoutManager.getLineAtIndex(e.end),r=DocLayoutManager.getRectsToDrawSelection(e.end,e.end,"document")[0].rects[0],c=r.top,l.css({height:r.height,top:c,left:function(e,t){return parseFloat(t)}}),e}var l=J(CurUtil.createCursor("start",e.SID)).removeClass("otherUserCollapsedCursor").addClass("otherUserCursorStart");_(i,l);var d=DocLayoutManager.getLineAtIndex(e.start);l.css({height:d.height,top:-2,left:function(e,t){return parseFloat(t)-2}}),i=editor.doc.createRange(e.end,e.end,e.SID);var l=J(CurUtil.createCursor("end",e.SID)).removeClass("otherUserCollapsedCursor").addClass("otherUserCursorEnd");return _(i,l),d=DocLayoutManager.getLineAtIndex(e.end),l.css({height:d.height,top:-2,left:function(e,t){return parseFloat(t)-2}}),e},I=0,_=function(e,t){var i,a,l=editor.getPageID(),d=e.end;try{var c=DocTreeManager.getSectionAtIndex(d);!e.collaborator&&ZWSelectionUtils.isEventhandlerSupported()&&EventHandler.mouseDown_coord.isLineEnd&&e.endChar!==UNICODE.PARA&&e.endChar!==UNICODE.BR&&p(d)&&c.getIndex()<d-1&&d-1<c.getEndIndex()?e.endChar===UNICODE.IMAGE&&"Ins Para"==editor.lastOperation?i=e.getEndPortionData(l):(i=editor.doc.getPortionData(d-1,l),d=e.endChar===UNICODE.IMAGE?d:d-1):i=e.getEndPortionData(l);var u=editor.editorPaneContainer[0].scrollTop;if(e.collaborator||CurUtil.scrollTop==u||(editor.editorOffset=editor.jeditorPane.offset(),CurUtil.scrollTop=u),!i||!(a=i.node))return}catch(t){return!e.collaborator&&ZWSelectionUtils.isEventhandlerSupported()&&(EventHandler.mouseDown_coord.isLineEnd=!1),s.error(t),void ZWLogger.log("_"+ZWCollaboration.SHOW_CARET_GETPORTION_ERROR+"_SHOW_CARET_GETPORTION_ERROR_ Cursor-Start: "+e.start+"\nException: "+t.stack)}var g,f=0,E=i.line,T=E.parent.getParaStyles();T[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL;if(ZWSelectionUtils.isEventhandlerSupported()&&EventHandler.mouseDown_coord.x){var m=EventHandler.mouseDown_coord.x-J(a.parentElement).offset().left;g=DocLayoutManager.getIndexAtLeft(m,E).isClosedInterval}else g=DocLayoutManager.getIntervalFromIndex(d);f+=DocLayoutManager.getLeftAtIndex(d,E,g,CurUtil.isFloatingCursor()&&VIEW.DOCUMENT),editor.doc.setDomCursor(e.SID,"start",a,e.end,e.ZUID),editor.doc.setDomCursor(e.SID,"end",a,e.end,e.ZUID,!0);var h,_=a.className,A=_.indexOf("zeroSize")!=-1,S=_.indexOf("zw-br-portion")!==-1,R=_.indexOf("EOP")!==-1;S&&(a=J(a.previousElementSibling).hasClass("zw-bullet")?a.parentNode:a);var O=W(a),v=J(a);A&&(h="zeroSize",_.indexOf("aligntop")!=-1&&(h+=" aligntop"),O.removeClass(h)),S&&W(a).hasClass("zw-portion")&&O.removeClass("zw-br-portion"),R&&O.addClass("zw-portion").removeClass("EOP"),(e.collaborator||isIPadSafariBrowser||ZWSelectionUtils.isEventhandlerSupported()&&EventHandler.mouseDown_coord.isLineEnd)&&!R&&(editor.doc.setCursorPortionNode(e.SID,"start",a),editor.doc.setCursorPortionNode(e.SID,"end",a));var D,L=v.parents(".zw-textbox-div")[0];if(L){var N=TextBoxHandler.getDataBasedOnParent(L,a).top,P=J(a).offsetParent()[0],C=TextBoxHandler.getDataBasedOnParent(L,P).top;D={height:J(a).height()||15,top:(N-C||0)/editor.zoomFactor,left:f,visibility:"visible"}}else{var y,F=EditorUtil.isTypingAllowedOnKeypress()?"visible":"hidden";if(CurUtil.isFloatingCursor()){var M=DocLayoutManager.getRectsToDrawSelection(e.start,e.start,"document");y=M[0].rects[0].top+(E&&E.getContentTop()||0)}else y=(v.position().top||0)/editor.zoomFactor;D={height:(a.getBoundingClientRect().height||15*editor.zoomFactor)/editor.zoomFactor,top:y,left:f,visibility:F,borderWidth:1!==editor.zoomFactor||isIPadSafariBrowser&&!e.collaborator?"0px 0px 0px 2px":""}}if("exact"==T.lineRule){var y=v.parent().position().top+v.position().top;D.top=y<0?"0px":y+"px"}if(h&&A&&O.addClass(h),S&&W(a).hasClass("zw-portion")&&O.addClass("zw-br-portion"),R&&O.addClass("EOP").removeClass("zw-portion"),t.find(".handler-callout-con").css("display","none"),CurUtil.isFloatingCursor()?(e.collaborator||(t.find(".handler-callout-con").css("display","none"),t.css("border-color","black")),editor.jeditorPane.append(t.css(D)[0])):v.closestParent(".zw-line-div").append(t.css(D)[0]),s.log(e,v),!e.collaborator){b(e,t[0]),ZWSelectionUtils.isEventhandlerSupported()&&(EventHandler.mouseDown_coord.isLineEnd=e.endChar===UNICODE.IMAGE),editor.jMultiByteSpan&&editor.jMultiByteSpan.css({top:CurUtil.offset.start.top}),EditorUtil.updateMultiByteSpanLeft(),r=r||l,l&&r!==l&&(r=l,ZWSelectionUtils.publishEvent(e,"Cursor/PageChanged"));var w=E&&E.parent||void 0;if(w){var U=w.getIndex(),x=U+E.start;if(o=o||U,U&&o!==U){o=U,ZWSelectionUtils.publishEvent(e,"Cursor/ParaChanged");var B=DocTreeManager.doc.getSection(U);I!==B&&(I=B,ZWSelectionUtils.publishEvent(e,"Cursor/SectionChanged"))}n=n||x,x&&n!==x&&(n=x,ZWSelectionUtils.publishEvent(e,"Cursor/LineChanged"))}}},A=function(e){var t,i,n,o,r,a=[];for(i=e.parentNode(),n=i.parentNode(),t=n.nodeCountBefore(i),o=e.attr(ATTR_CELL.TDS_RSPAN),o=o?o:1,r=0;r<o;r++)a.contains(t+r)||a.push(t+r);return a},S=function(e){var t=editor.doc.createElement(NODE_TYPE.CELL,e);return t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1),t},R=function(e){var t,i=editor.doc.getSelection(e.SID),n=(e.start,e.end,e.getCells());e._.selectedCells=[];for(var o=[],r=0;r<n.length;r++){e._.selectedCells.push(t=n[r]);for(var a=DocLayoutManager.getViews(t),s=0;s<a.length;s++)ZWSelectionUtils.drawTableCell(e,a[s]);o=o.concat(A(S(t)))}var l=e.getSelectedDocCells(),d=l[0],c=l[l.length-1];i.setIsTableSelected(!0),i.setSelectedCells(l),i.setStartCell(d),i.setEndCell(c),i.setSelectedTable(d.parentNode().parentNode()),i.setSelectedRowNumbers(o),b(e,DomViewManager.getDOMElem(DocLayoutManager.getViews(d.dtNode)[0]),DomViewManager.getDOMElem(DocLayoutManager.getViews(c.dtNode)[0]))},O=function(e){if(!e.collaborator&&editor.clientActiveSection){var t=DocTreeManager.getRootSectionType(e.start);t==SECTION_TYPES.HEADER?e._.isHeaderActived=!0:t==SECTION_TYPES.FOOTER&&(e._.isFooterActvied=!0);var i=DocTreeManager.doc.getParents(NODE_TYPE.ROW,e.start);i&&i.isHeaderRow()&&(e._.isHeaderRowActived=!0)}},b=function(e){if(!e.collaborator){var t,i={top:0,left:0,rects:{top:0,left:0,height:0,width:1}},n=e.start,o=DocLayoutManager.getLineAtIndex(n),r=null;if(o&&(r=DomViewManager.getDomFromCurrentPage(o)),r){ZWSelectionUtils.isEventhandlerSupported()&&EventHandler.mouseDown_coord.isLineEnd&&o.prev&&(o=o.prev,n--);var a=DocLayoutManager.getLeftAtIndex(n)*editor.zoomFactor;if(e.collapsed){var s=editor.editorPaneContainer.scrollTop()/editor.zoomFactor,l=editor.editorPaneContainer.scrollLeft()/editor.zoomFactor,d=J(r).offset()||{top:0,left:0};DocLayoutManager.blockAtIndex(n);i.top=parseFloat(s+d.top/editor.zoomFactor-editor.editorPaneContainerOffset.top/editor.zoomFactor)-parseFloat(editor.editorPaneContainer.css("padding-top")||0),i.left=parseFloat(l+d.left+a-editor.editorPaneContainerOffset.left)}else i=PUtil.offset(r),i.left+=a;t=r.getBoundingClientRect(),i.rects={top:t.top,left:t.left,height:o.height},i.rects.bottom=i.rects.top+i.rects.height,i.rects.right=i.rects.left+(i.left-i.rects.left)+i.rects.width}CurUtil.offset.start=i,i={top:0,left:0,rects:{top:0,left:0,height:0,width:1}},n=e.end,o=DocLayoutManager.getLineAtIndex(n),r=null,o&&(r=DomViewManager.getDomFromCurrentPage(o)),!e.collapsed&&r&&(i=PUtil.offset(r),i.left+=DocLayoutManager.getLeftAtIndex(e.end)*editor.zoomFactor,t=r.getBoundingClientRect(),i.rects={top:t.top,left:t.left,height:o.height,width:1},i.rects.bottom=i.rects.top+i.rects.height,i.rects.right=i.rects.left+(i.left-i.rects.left)+i.rects.width),CurUtil.offset.end=i}},v=function(e){editor.doc.setDomCursor(e.SID,"start",e.getStartPortionNode(),e.start,e.ZUID),editor.doc.setDomCursor(e.SID,"end",e.getEndPortionNode(),e.end,e.ZUID,!0)};PubSub.subscribe("ZWSelection/RangeAdded",g),PubSub.subscribe("ZWSelection/DrawSelectionForParaViewCreation",c),PubSub.subscribe("ZWSelection/DrawSelectionForCellViewCreation",ZWSelectionUtils.drawTableCell)}(window);var NavUtil=function(){"use strict";var e="start",t="end",i={NEXT:"next",PREV:"prev"},n=NODE_TYPE.TEXT+"|"+NODE_TYPE.PARAGRAPH+"|"+NODE_TYPE.BR,o=NODE_TYPE.AUTOFIELD+"|"+NODE_TYPE.SIGNERFIELD+"|"+NODE_TYPE.FILLABLEFIELD+"|"+NODE_TYPE.MAILMERGEFIELD,r=function(t){try{var i=editor.doc.getSelection(),n=i.getLastRange(),o=i.getLastModifiedPosition(),r=o==e?n.start:n.end,a=editor.doc.getCharAt(r),s=DocLayoutManager.getSectionViewAtIndex(r),l=r,d=s&&DocLayoutManager.getNextSection(s);if(r&&(editor.doc.getCharAt(r+1)==UNICODE.SECTION_START||a===UNICODE.SECTION_START)&&!d)return r;a==UNICODE.RANGE_START&&(l=DocUtil.getRangeEnd(r)+1);var c=DocLayoutManager.getLineAtIndex(r),p=i.getClientLeft(o)||CurUtil.offset.start.left,g=C(c,p,t);if(!g)return c.absEnd;g&&DocTreeManager.doc.getSection(r).getSectionType()!=SECTION_TYPES.CONTENT&&(g=DocLayoutManager.getLineAtIndex(g.absStart));var f=DocLayoutManager.getPageAtIndex(g.absStart);f&&DomViewManager.forceToRender(f);var E=g&&DomViewManager.getDomFromCurrentPage(g);if(!g||!E)return c.absEnd;for(var T=J(DomViewManager.getDOMElem(c)).find(".zw-portion,.EOP").last()[0],m=J(E).find(".zw-portion,.EOP"),h=m.length,I=0;I<h;I++){var _=m[I].getBoundingClientRect();if(p<_.right){T=m[I];break}I+1==h&&(T=m[I])}var A=(CurUtil.getCursorLineOffset(T)+CurUtil.getCursorPortionOffset(T),{cursorOffset:DocLayoutManager.getIndexAtLeft((p-J(E).offset().left)/editor.zoomFactor,g).index}),S=A.cursorOffset;S&&i.isCollapsed()&&editor.doc.getCharAt(S-1)==UNICODE.BR&&S--,r==S&&S++;var R;T.className;return(R=DocLayoutManager.blockAtIndex(S))&&R.isNonEditable?S=editor.doc.findNextIndexOf(UNICODE.RANGE_END,S)+1:S&&editor.doc.getCharAt(S-1)==UNICODE.RANGE_START&&S--,S&&editor.doc.getCharAt(S)===UNICODE.RANGE_END&&S++,t&&a==UNICODE.RANGE_START&&S<l&&(S=l),a==UNICODE.PARA&&editor.doc.getCharAt(r+1)==UNICODE.BR?(EventHandler.mouseDown_coord.isLineEnd=!0,EventHandler.mouseDown_coord.portion=J(DomViewManager.getDOMElem(g)).find("span.zw-portion,span.EOP")[0]):A.cursorOffset==Utils.textLen(T)&&(EventHandler.mouseDown_coord.isLineEnd=!0,EventHandler.mouseDown_coord.portion=T),S=Ae(S)}catch(e){u(e)}},a=function(e,t){if(e){var i=e.getColumn();for(s(i);i;){var n=s(i),o=i.next&&s(i.next)||n;if(n<=t&&o>t||!i.next)break;i=i.next}return i}},s=function(e){if(e){var t=DomViewManager.getDOMElem(e),i=t&&t.getBoundingClientRect();return i&&i.left||0}return 0},l=function(t){try{var i=editor.doc.getSelection(),n=i.getLastRange(),o=i.getLastModifiedPosition(),r=o==e?n.start:n.end,a=editor.doc.getCharAt(r>0?r-1:r),s=DocLayoutManager.getLineAtIndex(r),l=i.getClientLeft(o)||CurUtil.offset.start.left,d=s&&DocLayoutManager.getPrevSection(s.getSection()),c=i.findPrevious(NODE_TYPE.PARAGRAPH+"|"+NODE_TYPE.TEXT+"|"+NODE_TYPE.BR);if(r&&(editor.doc.getCharAt(r-1)==UNICODE.SECTION_START||a===UNICODE.SECTION_START)&&!d)return r;if(r>=2&&editor.doc.getCharAt(r-2)==UNICODE.PARA&&editor.doc.getCharAt(r-1)==UNICODE.BR){var p=y(s,l,t);return DocTreeManager.doc.getSection(r).getSectionType()!=SECTION_TYPES.CONTENT&&(p=DocLayoutManager.getLineAtIndex(p.absStart)),EventHandler.mouseDown_coord.isLineEnd=!0,EventHandler.mouseDown_coord.portion=J(DomViewManager.getDomFromCurrentPage(p)).find("span.zw-portion,span.EOP")[0],r-1}if(c&&(c.type==NODE_TYPE.BR||c.type==NODE_TYPE.PARAGRAPH)){var g=i.findPrevious(NODE_TYPE.TEXT+"|"+NODE_TYPE.BR,"",c);if(g&&g.type==NODE_TYPE.BR)return c.getStart()}var f=r-1;a==UNICODE.RANGE_END&&(f=DocUtil.getRangeStart(r-1));var p=y(s,l,t);if(p&&DocTreeManager.doc.getSection(r).getSectionType()!=SECTION_TYPES.CONTENT&&(p=DocLayoutManager.getLineAtIndex(p.absStart)),!p||!DomViewManager.getDomFromCurrentPage(p))return s.absStart;var E=DocLayoutManager.getPageAtIndex(p.absStart);E&&DomViewManager.forceToRender(E);for(var T=DomViewManager.getDomFromCurrentPage(s),m=DomViewManager.getDomFromCurrentPage(p),h=T.firstChild,h=J(T).find(".zw-portion,span.EOP").first()[0],I=J(m).find(".zw-portion,span.EOP"),_=I.length,A=_-1;A>=0;A--){var S=I[A].getBoundingClientRect();if(S.left<=l+1){h=I[A];break}0==A&&(h=I[A])}var R,O=(CurUtil.getCursorLineOffset(h)+CurUtil.getCursorPortionOffset(h),{cursorOffset:DocLayoutManager.getIndexAtLeft((l-J(m).offset().left)/editor.zoomFactor,p).index}),b=O.cursorOffset;h.className;return b&&i.isCollapsed()&&editor.doc.getCharAt(b-1)==UNICODE.BR&&b--,(R=DocLayoutManager.blockAtIndex(b))&&R.isNonEditable?b=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,b):b&&editor.doc.getCharAt(b-1)==UNICODE.RANGE_START&&b--,b&&editor.doc.getCharAt(b)===UNICODE.RANGE_END&&b++,t&&a==UNICODE.RANGE_END&&b>f&&(b=f),O.cursorOffset==Utils.textLen(h)&&(EventHandler.mouseDown_coord.isLineEnd=!0,EventHandler.mouseDown_coord.portion=h),b=Ae(b)}catch(e){u(e)}},d=function(i){var o={element:"",position:!0},r=editor.doc.getSelection(),a=r.getLastModifiedPosition(),s=r.getStart();a==t&&(s=r.getEnd());var l=DocLayoutManager.getLineAtIndex(s);if(s&&editor.doc.getCharAt(s-1)==UNICODE.SECTION_START){var d=l&&DocLayoutManager.getPrevSection(l.getSection());if(!d||DocLayoutManager.getSectionViewAtIndex(s-1).getSectionType()!==d.getSectionType())return o;s-=1}var c=editor.doc.getCharAt(s-1);if(r.isCollapsed()&&(c==UNICODE.CELL||c==UNICODE.TABLEEND)){var u=c==UNICODE.CELL?s-1:editor.doc.findPreviousIndexOf(UNICODE.CELL,s)+1;if(u>0){var p=editor.doc.getParents(NODE_TYPE.CELL,u-1),g=TabKeyHandler.getNextVisibleCell(p,!0);if(g&&g.getStart()!=p.getStart()){var f=r.getLastRange();f&&f.setStart(g.getEnd())}}}if(Utils.isTrailSurrogateChar(c)){var E=s-2;if(Utils.isLeadSurrogateChar(editor.doc.getCharAt(E))){var T=editor.doc.createElement(NODE_TYPE.TEXT);return T.setStart(E),T.setEnd(E),o.element=T,o}}if(s>=2&&editor.doc.getCharAt(s-2)==UNICODE.PARA&&editor.doc.getCharAt(s-1)==UNICODE.BR){var m=DocLayoutManager.getLineAtIndex(a),h=y(m,i);EventHandler.mouseDown_coord.isLineEnd=!0,EventHandler.mouseDown_coord.portion=J(DomViewManager.getDOMElem(h)).find("span.zw-portion,span.EOP")[0]}if(s&&(c===UNICODE.RANGE_END||c===UNICODE.RANGE_START)){var I=editor.doc.getRawFormatAt(s-1);if(I&&(I.type===NODE_TYPE.CONDITIONAL_IF_START||I.type===NODE_TYPE.CONDITIONAL_IF_END||I.type===NODE_TYPE.REPEAT_END)){var T=editor.doc.createElement(NODE_TYPE.TEXT);return T.setStart(s-1),T.setEnd(s-1),o.element=T,o.position=!1,o}if(i&&(!I.id||I.id.indexOf("toc")==-1&&I.type!==NODE_TYPE.NAMED_RANGE)||I&&(DocUtil.isNonEditablePortion(I.type)||I.type==NODE_TYPE.CONDITIONAL_IF_START)){o.position=!1;var _=DocUtil.getRangeStart(s-1),T=editor.doc.createElement(NODE_TYPE.TEXT);return T.setStart(_),T.setEnd(_),o.element=T,o}}o.element=r.find("previous",NODE_TYPE.TEXT+"|"+NODE_TYPE.PARAGRAPH+"|"+NODE_TYPE.BR,a);var A=o.element.getStart(),S=editor.doc.getCharAt(A);if(!i&&o.element&&A){var R=editor.doc.getRawFormatAt(A-1);if(R&&(R.type==NODE_TYPE.TABLE||"bookmark"==R.type||"link"==R.type||"comment"==R.type||"endnote"==R.type||"footnote"==R.type))if(R.type==NODE_TYPE.TABLE)o.element=editor.doc.getElementAt(A-2).lastChild(),o.position=!1;else{var O=editor.doc.getCharAt(A-1);O==UNICODE.RANGE_START&&(o.element=editor.doc.getElementAt(A-1))}if(R&&R.type===NODE_TYPE.CELL||S===UNICODE.ROW)for(var b=DocTreeManager.doc.getParents(NODE_TYPE.CELL,o.element.getStart()-1);b&&(MailMergeRepeatUtil.isNonEditableRepeatCell(b)||!b.isVisible);)o.element=r.findPrevious(n,a,o.element,null,null),b=DocTreeManager.doc.getParents(NODE_TYPE.CELL,o.element.getStart())}var v=editor.doc.getRawFormatAt(o.element.getStart());if(S===UNICODE.RANGE_END&&v&&DocUtil.isNonEditablePortion(v.type)&&(o.position=!1),i){var R,D=editor.doc.getRawFormatAt(A+1);if(D&&D.type==NODE_TYPE.ROW||editor.doc.getCharAt(A+1)==UNICODE.TABLEEND){for(var L=DocLayoutManager.getLineAtIndex(A),N=L.parent.parent,P=N.parent,C=P.parent,F=P.parent.children,M=0;M<F.length;M++)if(P.id===F[M].id){0==M?(o.element=editor.doc.getElementAt(C.prev.end-1).lastChild(),o.position=!1):(o.element=r.find("previous",NODE_TYPE.TABLE+"|"+NODE_TYPE.ROW,a),a==e&&(o.position=!1));break}}else o.element&&A&&(R=editor.doc.getRawFormatAt(A-1))&&R.type==NODE_TYPE.TABLE&&(o.element=r.find("previous",NODE_TYPE.PARAGRAPH,a))}return o},c=function(i){var r={element:"",position:!1},a=editor.doc.getSelection(),s=i?a.getLastModifiedPosition():e;i&&s==t&&a.isCollapsed()&&(s=e);var l=s==t?a.getEnd():a.getStart(),d=DocLayoutManager.getCurrentSection(),c=DocLayoutManager.getSectionViewAtIndex(l);if(a.getTargetRange(0).endChar===UNICODE.SECTION_START){if(d.getSectionType()!==c.getSectionType())return r;l-=1}var u=DocLayoutManager.getLineAtIndex(l);if(!u)return r;var p=u.getParent(),g=editor.doc.getCharAt(l),f=p&&p.getSection().getSectionType();if(Utils.isLeadSurrogateChar(g)){var E=l+2;if(Utils.isTrailSurrogateChar(editor.doc.getCharAt(l+1))){var T=editor.doc.createElement(NODE_TYPE.TEXT);return T.setStart(E),T.setEnd(E),r.element=T,r}}if(g==UNICODE.PARA&&editor.doc.getCharAt(l+1)==UNICODE.BR){var m=C(u,i);m&&DomViewManager.getDOMElem(m)&&(EventHandler.mouseDown_coord.isLineEnd=!0,EventHandler.mouseDown_coord.portion=J(DomViewManager.getDOMElem(m)).find("span.zw-portion,span.EOP")[0])}else if(g==UNICODE.PARA&&editor.doc.getCharAt(l+1)==UNICODE.SECTION_START&&f!==SECTION_TYPES.ENDNOTE&&f!==SECTION_TYPES.FOOTNOTE){var T=editor.doc.createElement(NODE_TYPE.PARAGRAPH),h=u&&DocLayoutManager.getNextSection(u.getSection());return h&&DocLayoutManager.getSectionViewAtIndex(l+1).getSectionType()===f&&(l+=1),T.setStart(l),T.setEnd(l+1),r.element=T,r}if(l&&(g===UNICODE.RANGE_START||g===UNICODE.RANGE_END)){var I=editor.doc.getRawFormatAt(l);if(I&&(I.type===NODE_TYPE.CONDITIONAL_IF_START||I.type===NODE_TYPE.CONDITIONAL_IF_END||I.type===NODE_TYPE.REPEAT_END)){var T=editor.doc.createElement(NODE_TYPE.TEXT);return T.setStart(l+1),T.setEnd(l+1),r.element=T,(s=e)&&(r.position=!0),r}if(i&&(!I.id||I.id.indexOf("toc")==-1&&I.type!==NODE_TYPE.NAMED_RANGE)||I&&(DocUtil.isNonEditablePortion(I.type)||I.type===NODE_TYPE.CONDITIONAL_IF_END)){var _=DocUtil.getRangeEnd(l),T=editor.doc.createElement(NODE_TYPE.TEXT);return T.setStart(_+1),T.setEnd(_+1),r.element=T,(s=e)&&(r.position=!0),r}}r.element=a.findNext(n,s);var A=editor.doc.getCharAt(r.element.getEnd()),S=editor.doc.getRawFormatAt(r.element.getEnd());if(r.element?r.element.type!=NODE_TYPE.PARAGRAPH||i&&(A==UNICODE.CELL||A==UNICODE.ROW||A==UNICODE.TABLE)||/toc_/.test(S&&S.id)||(r.element=a.findNext(n+"|"+o,s,r.element,null,o),r.position=!0):(r.element=editor.doc.getElementAt(a.getParents(NODE_TYPE.SECTION).getEnd()-1),r.position=!0),A==UNICODE.CELL||A==UNICODE.ROW)for(var R=DocTreeManager.doc.getParents(NODE_TYPE.CELL,r.element.getStart());R&&(MailMergeRepeatUtil.isNonEditableRepeatCell(R)||!R.isVisible);)r.element=a.findNext(o+"|"+n,s,r.element,null,o),R=DocTreeManager.doc.getParents(NODE_TYPE.CELL,r.element.getStart());else A===UNICODE.RANGE_END&&r.element.setEnd(r.element.getEnd()+1);if(r.element){var O=editor.doc.getCharAt(r.element.getStart()),b=editor.doc.getRawFormatAt(r.element.getStart());O===UNICODE.RANGE_START&&b&&DocUtil.isNonEditablePortion(b.type)&&(r.position=!0)}return r},u=function(e){var t=editor.doc.getSelection().getTargetRange();ZWLogger.sendErrorDetails("NO_ERROR_MAIL<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>KEYBOARD_NAVIGATION_FAILURE\nError Log Start \nException Stack: "+e.stack+"\nRange: "+JSON.stringify(t&&t.toCursorOp())+"\nCLIENT INFO: "+ZWCollaboration.clientInfo+"\nbuildLabel: "+buildLabel+"\nError Log End",null,ZWCollaboration.KEYBOARD_NAVIGATION_FAILURE)},p=function(){var e={element:"",position:!0},t=editor.doc.getSelection(),i=t.getStart(),n=editor.doc.getSectionStart(i),o=DocLayoutManager.getCurrentSection(i),r=DocLayoutManager.getPrevSection(o);if(i-1==n&&!r)return e;var a=t.findPrevious(NODE_TYPE.TEXT),s=editor.doc.getCharAt(i-1);if(s==UNICODE.BR)return d();if(s!=UNICODE.RANGE_START&&s!=UNICODE.RANGE_END||!a)e.element=t.getPreviousWord();else{e.element=a,e.position=!1;var l=editor.doc.getRawFormatAt(i-1),c=l&&l.type;if(c&&DocUtil.isNonEditablePortion(c)){var u=DocUtil.getRangeStart(i-1);e.element.setStart(u),e.position=!0}}return e},g=function(){var t={element:"",position:!1},i=editor.doc.getSelection(),n=i.getStart(),o=i.find("next",NODE_TYPE.TEXT),r=editor.doc.getCharAt(n),a=(editor.doc.getCharAt(n+1),editor.doc.getRawFormatAt(n)),s={};DocLayoutManager.getSectionViewAtIndex(n);if(r==UNICODE.RANGE_END){var l=DocUtil.getRangeStart(n);s=editor.doc.getRawFormatAt(l)}i.getParents(NODE_TYPE.PARAGRAPH);if(r==UNICODE.BR)return c();if((r==UNICODE.RANGE_START&&a.type==NODE_TYPE.LINK||r==UNICODE.RANGE_END&&s.type==NODE_TYPE.LINK)&&o)t.element=o,t.position=!0;else{t.element=i.getNextWord();var d=i.getParents(NODE_TYPE.SECTION).getEnd();t.element&&(editor.doc.getCharAt(t.element.getEnd()-1)==UNICODE.HR||n==t.element.getEnd()?t.element=i.findNext(NODE_TYPE.PARAGRAPH,"",t.element):editor.doc.getCharAt(t.element.getEnd()-1)==UNICODE.PARA&&(t.element=i.findNext(NODE_TYPE.TEXT+"|"+NODE_TYPE.PARAGRAPH+"|"+NODE_TYPE.BR,e,t.element),t.position=!0),t.element.getEnd()>d&&t.element.setEnd(d))}return t},f=function(){var e=editor.doc.getSelection(),i=e.getLastModifiedPosition(),n=i==t?e.getEnd():e.getStart(),o=editor.doc.getSectionStart(n),r=DocLayoutManager.getSectionViewAtIndex(n),a=DocLayoutManager.getPrevSection(r);if(n==o+1&&!a)return n;var s=editor.doc.getCharAt(n-1);if(e.isCollapsed()&&(s==UNICODE.CELL||s==UNICODE.TABLEEND)){var l=s==UNICODE.CELL?n-1:editor.doc.findPreviousIndexOf(UNICODE.CELL,n)+1;if(l>0){var d=editor.doc.getParents(NODE_TYPE.CELL,l-1),c=TabKeyHandler.getNextVisibleCell(d,!0);if(c&&c.getStart()!=d.getStart()){var u=e.getLastRange();u&&u.setStart(c.getEnd()),e.removeAllRanges().addRange(u)}}}var p=e.getParents(NODE_TYPE.PARAGRAPH,i===t),g=p.getStart();if(g==n&&(p=e.findPrevious(NODE_TYPE.PARAGRAPH,"",p)),p){g=p.getStart();var f=editor.doc.getSectionStart(n);g<f&&!a&&(g=f)}return g},E=function(){var i=null,n=editor.doc.getSelection(),o=n.getLastModifiedPosition();i=n.getParents(NODE_TYPE.PARAGRAPH,o===t);var r=i.getStart(),a=o==e?n.getStart():n.getEnd(),s=DocLayoutManager.getSectionViewAtIndex(a),l=DocLayoutManager.getNextSection(s),d=editor.doc.getCharAt(a);if(editor.doc.getCharAt(a+1)==UNICODE.CELL){var c=editor.doc.getParents(NODE_TYPE.CELL,a+2);if(c){var u=TabKeyHandler.getNextVisibleCell(c);if(u)return r=editor.doc.findNextIndexOf(UNICODE.PARA,u.getStart());var p=c.attr();if(p&&(p[ATTR_CELL.TDS_MRG]||"fc"==p[ATTR_CELL.TDS_MRG])){var g=TableUtil.getTableEnd(a);if(g>0)return r=editor.doc.findNextIndexOf(UNICODE.PARA,g)}}}d==UNICODE.PARA&&(i=n.findNext(NODE_TYPE.PARAGRAPH,"",i)),i&&(r=editor.doc.findNextIndexOf(CONT_REGEXP.PARASTART,i.getStart()));var f=n.getParents(NODE_TYPE.SECTION).getEnd()-1;return(r>f&&(!l||DocLayoutManager.getSectionViewAtIndex(r).getSectionType()!==s.getSectionType())||r<0)&&(r=f),r},T=function(i,n){var o=editor.doc.getSelection(),r=o.getLastRange(),a=o.getLastModifiedPosition(),s=CurUtil.offset.start.top,l=DocTreeManager.getSectionAtIndex(r.start),d=DocTreeManager.getSectionAtIndex(r.end);if(l&&d&&l.getSectionType()!==d.getSectionType())return r;("start"!=a&&i==KEYS.PAGEDOWN&&!r.collapsed||"end"==a&&i==KEYS.PAGEUP&&!r.collapsed)&&(s=CurUtil.offset.end.top);var c=editor.editorPaneContainerHt-parseFloat(editor.editorPaneContainer.css("padding-top")),u=s+c*(i==KEYS.PAGEDOWN?1:-1)+(i==KEYS.PAGEDOWN?200:-150),p=a===ZWSelection.MODIFIED_POSITION_START?r.start:r.end,g=DocLayoutManager.getPageAtIndex(p);g=i==KEYS.PAGEUP?g&&g.prev:g&&g.next,g&&!DomViewManager.isPageRendered(g)&&DomViewManager.forceToRender(g);var f,E=J(editor.doc.getCursorPortionNode(editor.uuid,a)),T=E.parents("div.zw-contentpane:first, div.header_primary:first, div.footer_primar:first").first(),m=T.children("div.zw-paragraph:first")[0],h=T.children("div.zw-paragraph:last")[0];if(f=T.hasClass("zw-contentpane")?Utils.binarySearch(editor.jeditorPane.find("div.zw-contentpane").find("span.zw-portion,span.EOP"),PUtil.nodeCompare,u):PUtil.getElementAtOffset(T[0],u),f&&!J(f).is("div.zw-paragraph")){var I=J(f);f=I.parents("div.zw-paragraph:first")[0],Math.abs(s-PUtil.offsetTop(I[0])<50)&&f!=m&&f!=h&&(f=i==KEYS.PAGEUP?J(f).prev("div.zw-paragraph")[0]||f:J(f).next("div.zw-paragraph")[0]||f)}if(T.hasClass("zw-contentpane")&&f===E.parents("div.zw-paragraph")[0]&&(f=g?J(DomViewManager.getDOMElem(g)).find(".zw-contentpane").find("div.zw-paragraph:first")[0]:f),n){r.collapsed&&o.setLastModifiedPosition(i==KEYS.PAGEUP?e:t);var _=r.start,A=r.end,S=DocUtil.getDocElement(f);return i==KEYS.PAGEUP?r.collapsed||"end"!=a?_=S.getStart():A=S.getStart()>r.start?S.getEnd():r.start:f==h?A=o.getParents(NODE_TYPE.SECTION).getEnd()-1:r.collapsed||"start"!=a?A=S.getEnd():_=S.getStart()>r.end?r.end:S.getStart(),_=_<=0?1:_,editor.doc.createRange(_,A)}var R={element:"",position:!0};return f==h&&i==KEYS.PAGEDOWN?(R.element=editor.doc.getElementAt(o.getParents(NODE_TYPE.SECTION).getEnd()-2),R.position=!1):f==m&&i==KEYS.PAGEUP?(R.element=DocUtil.getDocElement(f),R.position=!0):(R.element=DocUtil.getDocElement(f),R.position=i!=KEYS.PAGEDOWN),R},m=function(t){var i=J(editor.doc.getCursorPortionNode(editor.uuid,e)).parents("div.zw-line-div").find("span.zw-portion")[0];if(!i)return editor.doc.getSelection().getStart();var n=CurUtil.getCursorLineOffset(i)+CurUtil.getCursorPortionOffset(i),o=n;return DocUtil.isNonEditablePortion(i.className)&&editor.doc.getCharAt(n-1)==UNICODE.RANGE_END?o=DocUtil.getRangeStart(n-1):editor.doc.getCharAt(n)==UNICODE.RANGE_START&&(o=n),o},h=function(t){var i=J(editor.doc.getCursorPortionNode(editor.uuid,e)).parents("div.zw-line-div").find("span.zw-portion").last()[0],n=editor.doc.getSelection();if(!i)return n.getStart()+(t?1:0);var o=CurUtil.getCursorLineOffset(i)+CurUtil.getCursorPortionOffset(i),r=W(i).hasClass("zw-br-portion")?o:o+Utils.textLen(i);EventHandler.mouseDown_coord.isLineEnd=!0,EventHandler.mouseDown_coord.portion=i,DocUtil.isNonEditablePortion(i.className)?(r=DocUtil.getRangeEnd(o+1)+1,EventHandler.mouseDown_coord.isLineEnd=!1,EventHandler.mouseDown_coord.portion=null):editor.doc.getCharAt(o)==UNICODE.RANGE_END&&(r=o+1);var a=n.getParents(NODE_TYPE.SECTION).getEnd()-1;return r>a&&(r=a),r},I=function(){var e=DocLayoutManager.getFirstSection().getNode().getIndex();return e>=0&&e++,e},_=function(){return DocLayoutManager.getLastSection().getNode().getEndIndex()},A=function(e,t){var n=(t===i.PREV?-1:1)*DocLayoutManager.getPageCount();return DomViewManager.isMultiplePagesInRow()?DocLayoutManager.getPageAtPageNumber(e.getAbsolutePageNumber()+n)||null:e[t]},S=function(e,t){for(var n=DocLayoutManager.getPageAtIndex(e),o=DocLayoutManager.getNextPage(n),r=DocLayoutManager.getColumnAtIndex(e),s=r.getSection(),l=DocLayoutManager.getNextSection(s),d=l&&a(l,t),c=d&&d.getChildViews().first;!c&&o;)s=l,l=s&&DocLayoutManager.getNextSection(s),d=l&&a(l,t),c=d&&d.getChildViews().first,o=A(o,i.NEXT),o&&DomViewManager.forceToRender(o);if(c&&c.type===NODE_TYPE.HR){if(!n.next.next)return null;r=c.column,d=n.next.next.getFirstSection(SECTION_TYPES.CONTENT).getColumn(r.getColumnIndex()),c=d&&d.childViews.first}if(c&&c.type===NODE_NAME.TABLE){var s=DocTreeManager.doc.getSection(e),u=s.getSectionType()===SECTION_TYPES.HEADER||s.getSectionType()===SECTION_TYPES.FOOTER;return L(d.childViews.first.childViews.first.getNode(),t,d,u)}if(d&&!d.getChildViews().first){var p=d.getPage().getFirstSection(SECTION_TYPES.ENDNOTE);return p&&b(p.getNode().children[0])}if(c&&c.type==NODE_TYPE.TOC){var g=c.getChildViews().first;return g&&g.nodeLines[0]}return d&&d.getChildViews().first.nodeLines[0]},R=function(e,t){for(var i=DocLayoutManager.getPageAtIndex(e),n=DocLayoutManager.getPrevPage(i),o=DocLayoutManager.getSectionViewAtIndex(e),r=(DocLayoutManager.getColumnAtIndex(e),DocLayoutManager.getPrevSection(o)),s=r&&a(r,t),l=r&&s.childViews.last;!l&&n&&r;)o=r,r=DocLayoutManager.getPrevSection(o),s=r&&a(r,t),l=s.childViews.last;if(l)return l.type===NODE_TYPE.TABLE?O(s,t,e):l.type===NODE_TYPE.TOC?l.getLastChild().nodeLines[0]:v(l)},O=function(e,t,i){var i=i||editor.doc.getSelection()[0].start,n=e.getChildViews().last;if(n&&n.type===NODE_NAME.TABLE){var o=DocTreeManager.doc.getSection(i),r=o.getSectionType()===SECTION_TYPES.HEADER||o.getSectionType()===SECTION_TYPES.FOOTER;return N(e.childViews.last.childViews.last.getNode(),t,e,r)}if(n&&n.type===NODE_NAME.HR)return e&&ZWArrayUtils.lastElementOf(e.childViews.last.prev.nodeLines);{if(n)return e&&ZWArrayUtils.lastElementOf(e.getChildViews().last.nodeLines);var a=DocLayoutManager.getPageAtIndex(i),s=DocLayoutManager.getColumnAtIndex(i),l=DocLayoutManager.getPrevPage(a),d=l&&l.getLastSection(SECTION_TYPES.CONTENT).getColumn(s.getColumnIndex()),c=d.hasFootNotes();if(c||d.hasEndNotes())return F(prevColumn,c)||O(d,t,i)}},b=function(e){for(;e&&e.type!=NODE_TYPE.PARA;)e=e.next;return e&&e.nodeLines&&e.nodeLines[0]},v=function(e){for(;e&&e.type!=NODE_TYPE.PARA;)e=e.prev;return e&&ZWArrayUtils.lastElementOf(e.nodeLines)},D=function(e,t,i,n){var o,r,a,s=0;if(o=DocLayoutManager.getViews(e),i)for(var l=0,d=o.length;l<d;l++){var c=o[l];if(i.id==c.column.id){r=DomViewManager.getDOMElem(c),s=l,a=c;break}}else a=o[0];var u=[],p=M(a,t,n),g=p&&DocLayoutManager.getViews(p)[s].childViews;return u.push(g,s),u},L=function(e,t,n,o){var r=D(e,t,n,i.NEXT);if(!r[0])return b(DocLayoutManager.getViews(e.parent.next)[0]);var a=r[0].first,s=r[1],l=DocLayoutManager.getViews(e).length;if(!a){for(;++s<l;)a=DocLayoutManager.getViews(e)[s].childViews.first.childViews.first;return a&&a.nodeLines[0]||e.next&&L(e.next,t,n,o)||b(e.parent.next)}return a.type==NODE_TYPE.PARA?a.nodeLines[0]:a.type==NODE_TYPE.TABLE?L(a.childViews.first.getNode(),t,n,o):void 0},N=function(e,t,n,o){var r=D(e,t,n,i.PREV);if(!r[0])return v(DocLayoutManager.getViews(e.parent.prev)[0]);var a=r[0].last,s=r[1]||0;if(!a){for(;--s>=0;)a=DocLayoutManager.getViews(e)[s].childViews.last.childViews.last;return a&&ZWArrayUtils.lastElementOf(a.nodeLines)||e.prev&&N(e.prev,t,n,o)||v(e.parent.prev)}return a.type==NODE_TYPE.PARA?a&&ZWArrayUtils.lastElementOf(a.nodeLines):a.type==NODE_TYPE.TABLE?N(a.childViews.last.getNode(),t,n,o):void 0},P=function(e,t){var i=DocLayoutManager.getColumnAtIndex(e),n=DocLayoutManager.getColumnAtIndex(t);return i&&n&&i.id===n.id},C=function(e,t,i){var n=e.next,o=e.absStart,r=DocLayoutManager.getSectionViewAtIndex(e.absStart),s=r.getSectionType()===SECTION_TYPES.HEADER||r.getSectionType()===SECTION_TYPES.FOOTER,l=e.parent,d=l.next,c=DocLayoutManager.getNextSection(r),u=e.view;u&&u.next;if(n)return n;if(!i&&!e.view.next&&r.getSectionType()===SECTION_TYPES.CONTENT&&"section"==e.parent.parent.type){var p=DocLayoutManager.getColumnAtIndex(o);if(!d&&c)var n=S(o,t);var g=p&&p.getPage(),f=g&&g.hasEndNotes(),E=g&&g.hasFootNotes();if((E||f)&&(c.sectionType===SECTION_TYPES.ENDNOTE||c.sectionType===SECTION_TYPES.FOOTNOTE)){var T;return T=f?DocTreeViewManager.getFirstNoteView(NODE_TYPE.ENDNOTE):p.getPage().getFirstSection(SECTION_TYPES.FOOTNOTE),T&&(n=b(T.getNode().children[0])),n}}var m=new RegExp(UNICODE.TOCSTART+"|"+UNICODE.TOCEND);if((!d&&l.parent.type==NODE_TYPE.TOC||d&&d.parent.type===NODE_TYPE.TOC&&m.test(editor.doc.getCharAt(d.getIndex()+1)))&&(d=l.parent.next),d){if(d.type===NODE_TYPE.TOC&&(d=d.children[0]),/^(hr|para)$/.test(d.type))if(P(o,d.getIndex()+(d.type===NODE_TYPE.HR?1:0))||s)n=b(DocLayoutManager.getViews(d)[0]);else if(c&&c.getNodeId()===r.getNodeId())n=S(o,t);else{var h=a(c,t),I=h&&h.childViews.first;n=I&&b(I)}else if(d.type==NODE_NAME.TABLE){var _=d.children[0];if(P(o,_.getIndex()+2)||s){var A=DocLayoutManager.getColumnAtIndex(_.getIndex()+2);n=L(_,t,A,s)}else n=S(o,t)}}else if(l.parent.type==NODE_TYPE.CELL){var _=l.parent.parent.next;if(_)if(P(o,_.getIndex()+2)||s){var A=DocLayoutManager.getColumnAtIndex(_.getIndex()+2);n=L(_,t,A,s)}else n=S(o,t);else d=l.parent.parent.parent.next,n=P(o,d.getIndex())||s?b(DocLayoutManager.getViews(d)[0]):S(o,t)}else if(l.parent.type!==NODE_TYPE.SECTION||l.parent.getSectionType()!==SECTION_TYPES.ENDNOTE&&l.parent.getSectionType()!==SECTION_TYPES.FOOTNOTE){var R=l.parent.type===NODE_TYPE.SECTION&&l.parent.getSectionType()===SECTION_TYPES.TEXTBOX;R||(n=S(e.absStart,t))}else{var O,p=DocLayoutManager.getColumnAtIndex(o);if(l.parent.getSectionType()===SECTION_TYPES.ENDNOTE){var v=p.getPage().endnote;(!i&&l.parent.id!==v.last.getNode().id||i)&&(O=DocLayoutManager.getViews(l.getParent())[0].next)}else{var D=p.getPage().footnote;(!i&&l.parent.id!==D.last.getNode().id||i)&&(O=DocLayoutManager.getViews(l.getParent())[0].next)}if(O){var N=O.getNode().children[0];n=b(DocLayoutManager.getViews(N)[0])}else if(!i)return e}return n},y=function(e,t,i){var n=e.prev,o=e.absStart,r=DocLayoutManager.getColumnAtIndex(o),s=DocLayoutManager.getSectionViewAtIndex(e.absStart),l=HF_SECTIONS.contains(s.getSectionType()),d=e.parent,c=d.prev,u=DocLayoutManager.getPrevSection(s),p=e.view,g=(p&&p.prev,e.getSection());if(n)return n;if(!i&&!e.view.prev&&g.getSectionType()===SECTION_TYPES.CONTENT&&"section"==e.parent.parent.type){var f=DocLayoutManager.getPageAtIndex(o),r=DocLayoutManager.getColumnAtIndex(o),E=f.prev&&DocLayoutManager.getPrevColumn(r),T=f&&f.hasEndNotes(),m=f&&f.hasFootNotes();if(!c&&u){var h=a(u,t);return n=O(h,t)}if((m||T)&&(u.sectionType===SECTION_TYPES.ENDNOTE||u.sectionType===SECTION_TYPES.FOOTNOTE))return F(E,m)}var d=e.parent,c=d.prev,I=new RegExp(UNICODE.TOCSTART+"|"+UNICODE.TOCEND);if((!c&&d.parent.type===NODE_TYPE.TOC||c&&c.parent.type===NODE_TYPE.TOC&&I.test(editor.doc.getCharAt(c.getIndex()+1)))&&(c=d.parent.prev),c){if(c.type===NODE_TYPE.TOC&&(c=ZWArrayUtils.lastElementOf(c.children)),/^(hr|para)$/.test(c.type))if(P(o,c.getEndIndex()-(c.type===NODE_TYPE.HR?1:0))||l){var _=DocLayoutManager.getViews(c);n=v(_[_.length-1])}else n=R(o,t);else if(c.type==NODE_NAME.TABLE){var A=ZWArrayUtils.lastElementOf(c.children),S=DocLayoutManager.getViews(A),b=ZWArrayUtils.lastElementOf(S),D=b.column,r=DocLayoutManager.getColumnAtIndex(o);n=D&&D.id!==r.id&&!l?R(o,t):N(A,t,D,l)}}else if(d.parent.type==NODE_TYPE.CELL){var A=d.parent.parent.prev;if(A){var S=DocLayoutManager.getViews(A),b=ZWArrayUtils.lastElementOf(S),D=b.column,r=DocLayoutManager.getColumnAtIndex(o);n=D&&D.id!==r.id&&!l?R(o,t):N(A,t,D,l)}else if(c=d.parent.parent.parent.prev,P(o,c.getEndIndex())||l){var L=DocLayoutManager.getViews(c)[0];n=v(L)}else n=R(o,t)}else if(d.parent.type!==NODE_TYPE.SECTION||d.parent.getSectionType()!==SECTION_TYPES.ENDNOTE&&d.parent.getSectionType()!==SECTION_TYPES.FOOTNOTE){var C=d.parent.type===NODE_TYPE.SECTION&&d.parent.getSectionType()===SECTION_TYPES.TEXTBOX;if(C||(n=R(o,t)),!c){if(!u)return;var y=a(u,t),M=y.childViews.last;return n=v(M)}}else{var u;if(d.parent.getSectionType()===SECTION_TYPES.ENDNOTE){var w=r.getPage().endnote;(!i&&d.parent.id!==w.first.getNode().id||i)&&(u=DocLayoutManager.getViews(d.getParent())[0].prev)}else{var U=r.getPage().footnote;(!i&&d.parent.id!==U.first.getNode().id||i)&&(u=DocLayoutManager.getViews(d.getParent())[0].prev)}if(!u)return i?n:e;var x=ZWArrayUtils.lastElementOf(u.getNode().children);n=v(ZWArrayUtils.lastElementOf(DocLayoutManager.getViews(x)))}return n},F=function(e,t){var i;return i=t?e.getLastFootNote():DocTreeViewManager.getLastNoteView(NODE_TYPE.ENDNOTE),i&&v(ZWArrayUtils.lastElementOf(i.getNode().children))},M=function(e,t,i){var n,o,r,a=e.getSection(),s=0,l=editor.jeditorPane.offset().left+a.getLeft(),d=e.column&&e.column.left||0,c=e.getNode().children,u=c.length,p=l+d;if(c){var g=DocLayoutManager.getViews(c[0])[0];p+=g.left}if(MailMergeRepeatUtil.isCellRepeatPresent(e.parent.getNode()))return c[0];for(var f,E=0;E<u;E++)if(r=c[E],f=DocLayoutManager.getViews(r)[0],p+=f.actualWidth/(f.isFCCell()?f.cspan:1),r.isVisible||(n=r.getRootMergeCell(),o=n&&DocLayoutManager.getViews(n)[0],s+=o.actualWidth/(o.isFCCell()?o.cspan:1)||0),p+s>=t)return r.isVisible?r:o&&e.getId()===o.getParent().getId()?n:e[i]?M(e[i],t,i):null;return r},w=function(){if(editor.doc.getSelection().isCollapsed()){var t=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,e);DomUtil.scrollElementIntoView(t[0])}EditorUtil.focusMultiByteSpan()},U=function(){PubSub.publish("Selection/updateClientLeft")},x=function(e,t,i){if(!TransLiteration_EventHandler.isTransliterationEnabled()||!EventHandler.multiByteTyping){var n=editor.doc.getSelection(),o=n.getLastModifiedPosition();if(Utils.getCurrentTypingDirection(o)==PARA_DIR.RTL&&!i)return z(e,t,!0);var r,a=n.getStart();if(n.isCollapsed()){var s=d();s.element&&n.removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(s.element,s.position).mapAllSelectionsToBulletin()}else a==editor.doc.getSectionStart(a)&&(a+=1),r=editor.doc.createRange(a),n.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(r),TransformEventHandler.onCursorChanged(a,a);return w(),U(),!1}},B=function(e,t,i){var n=editor.doc.getSelection(),o=n.getLastModifiedPosition();if(Utils.getCurrentTypingDirection(o)==PARA_DIR.RTL&&!i)return Z(e,t,!0);var r=p();return r.element&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(r.element,r.position).mapAllSelectionsToBulletin(),w(),U(),!1},H=function(e,t,i){var n=editor.doc.getSelection(),o=(n.getLastModifiedPosition(),m()),r=editor.doc.getElementAt(o);return r&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(r,!0).mapAllSelectionsToBulletin(),w(),U(),!1},G=function(i,n,o){var r,a=editor.doc,s=a.getSelection(),c=s.getStart(),u=s.getEnd(),p=a.getCharAt(u),g=!1,f=!1;if(r=s.getLastModifiedPosition(),Utils.getCurrentTypingDirection(r)==PARA_DIR.RTL&&!o)return j(i,n,!0);if(s.isCollapsed()&&s.setLastModifiedPosition(e),s.isTableSelected()&&(g=a.getCharAt(c-2)==UNICODE.ROW&&s.getLastModifiedPosition()==e,f=(p==UNICODE.CELL||p==UNICODE.ROW||p==UNICODE.TABLEEND)&&s.getLastModifiedPosition()==t),g)r=s.getLastModifiedPosition(),c=l(!0);else if(f){var E=s.getEndCell(),T=E.previousSibling();if(T){u=T.getEnd()-1}else{var m=E.parentNode(),E=m.previousSibling().children()[0];u=E.getEnd()-1}}else{r=s.getLastModifiedPosition();var h=d(!0),I=h.element;if(I)if(r==e)c=h.position?I.getStart():I.getEnd();else if(r==e){var _=h.position?I.getStart():I.getEnd();c=_<1?1:_}else{var A=editor.doc.getRawFormatAt(u-1),S=editor.doc.getRawFormatAt(c);u=h.position?I.getStart():I.getEnd(),A&&A.type==NODE_TYPE.NAMED_RANGE&&S&&S.type===NODE_TYPE.NAMED_RANGE&&(c+=1),a.getCharAt(u-1)==UNICODE.PARA&&(u-=1)}}var R=editor.doc.createRange(c,u);return s.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(R).mapAllSelectionsToBulletin(),U(),!1},k=function(i,n,o){var r,a,s=editor.doc.getSelection(),l=s.getStart(),d=s.getEnd(),c=s.getLastModifiedPosition();if(Utils.getCurrentTypingDirection(c)==PARA_DIR.RTL&&!o)return X(i,n,!0);if(s.isCollapsed()&&s.setLastModifiedPosition(e),c===t)d=s.getPrevWordEnd();else if(l=s.getPrevWordStart(),r=editor.doc.getCharAt(l-1),r==UNICODE.RANGE_START){var a=editor.doc.getRawFormatAt(l-1);if(a&&a.type&&("link"===a.type||DocUtil.isNonEditablePortion(a.type))){l--;var u=DocUtil.getRangeEnd(l);u>d&&(d=u)}}else if(r==UNICODE.RANGE_END){var a=editor.doc.getRawFormatAt(l-1);a&&a.type&&("link"===a.type||DocUtil.isNonEditablePortion(a.type))&&(l=DocUtil.getRangeStart(l-1))}var p=editor.doc.createRange(l,d);return s.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(p).mapAllSelectionsToBulletin(),U(),!1},Y=function(t,i,n){var o=editor.doc.getSelection(),r=o.getStart(),a=o.getEnd(),s=o.getLastModifiedPosition();if(Utils.getCurrentTypingDirection(s)==PARA_DIR.RTL&&!n)return K(t,i,!0);o.isCollapsed()&&o.setLastModifiedPosition(e),s==e?r=m(!0):(a=m(!0),a<r&&o.setLastModifiedPosition(e));var l=editor.doc.createRange(r,a);return o.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(l).mapAllSelectionsToBulletin(),U(),!1},z=function(e,t,i){if(!TransLiteration_EventHandler.isTransliterationEnabled()||!EventHandler.multiByteTyping){var n=editor.doc.getSelection(),o=n.getLastModifiedPosition();if(Utils.getCurrentTypingDirection(o)==PARA_DIR.RTL&&!i)return x(e,t,!0);var r,a,s,l=n.getEnd();if(!n.isCollapsed()){a=n.getCorrectedCursorPosition(l),s=n.getStart();var d=editor.doc.createRange(a);return n.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(d),TransformEventHandler.onCursorChanged(s,a),!0}return r=c(),r.element&&n.removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(r.element,r.position).mapAllSelectionsToBulletin(),w(),U(),!1}},Z=function(e,t,i){var n=editor.doc.getSelection(),o=n.getLastModifiedPosition();if(Utils.getCurrentTypingDirection(o)==PARA_DIR.RTL&&!i)return B(e,t,!0);var r=g(),a=r.element,s=r.position;return a&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(a,s).mapAllSelectionsToBulletin(),w(),U(),!1},V=function(e,t,i){var n=editor.doc.getSelection(),o=(n.getLastModifiedPosition(),h()),r=editor.doc.getElementAt(o),a=!0;return r.type==NODE_TYPE.PARAGRAPH&&(r=r.lastChild(),a=!1),r&&n.removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(r,a).mapAllSelectionsToBulletin(),w(),U(),!1},j=function(i,n,o){var a,s,l=editor.doc,d=l.getSelection(),u=d.getStart(),p=d.getEnd();if(a=d.getLastModifiedPosition(),Utils.getCurrentTypingDirection(a)==PARA_DIR.RTL&&!o)return G(i,n,!0);if(l.getCharAt(s)==UNICODE.CELL){var g=l.getParents(NODE_TYPE.CELL,s+1);if(g){var f=TabKeyHandler.getNextVisibleCell(g);if(f)if(s=f.getStart(),a==t){p=s;var E=editor.doc.getSelection().getLastRange();E&&E.setEnd(p)}else{var E=editor.doc.getSelection().getLastRange();if(d.isCollapsed()){var T=editor.doc.findPreviousIndexOf(UNICODE.PARA,s);T>0&&(s=T),p=s,E&&E.setEnd(p)}E&&E.setStart(s),u=s}else{var m=g.attr();if(m&&(m[ATTR_CELL.TDS_MRG]||"fc"==m[ATTR_CELL.TDS_MRG])){var h=TableUtil.getTableEnd(s);if(h>0)if(s=h,a==t){p=s;var E=editor.doc.getSelection().getLastRange();E&&E.setEnd(p)}else{var E=editor.doc.getSelection().getLastRange();d.isCollapsed()&&(T=editor.doc.findPreviousIndexOf(UNICODE.PARA,s),T>0&&(s=T),p=s,E&&E.setEnd(p)),E&&E.setStart(s),u=s}}}}}if(d.isCollapsed()&&d.setLastModifiedPosition(t),a=d.getLastModifiedPosition(),a==t&&l.getCharAt(p)==UNICODE.ROW)d.setIsTableSelected(!1),p=r(!0);else if(!d.isTableSelected()||l.getCharAt(u-1)!=UNICODE.CELL&&l.getCharAt(u-2)!=UNICODE.ROW||a!=e){var I=c(!0),_=I.element;if(_)if(a==e)u=I.position?_.getStart():_.getEnd(),l.getCharAt(u)==UNICODE.PARA&&(u+=1);else if(p=I.position?_.getStart():_.getEnd(),l.getCharAt(p)==UNICODE.CELL||l.getCharAt(p)==UNICODE.ROW){var A=TableUtil.getCellStart(u);A>0&&(u=A+1)}}else{var S=d.getStartCell(),R=S.nextSibling();R&&(u=R.getStart()+1)}var E=editor.doc.createRange(u,p);return d.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(E).mapAllSelectionsToBulletin(),U(),!1},X=function(i,n,o){var r,a=editor.doc.getSelection(),s=a.getStart(),l=a.getEnd(),d=a.getLastModifiedPosition();if(Utils.getCurrentTypingDirection(d)==PARA_DIR.RTL&&!o)return k(i,n,!0);if(a.isCollapsed()&&a.setLastModifiedPosition(t),d===e){if(s=a.getNextWordStart(),r=editor.doc.getCharAt(s),r==UNICODE.RANGE_START){var c=editor.doc.getRawFormatAt(s);if(c&&c.type&&"link"===c.type){var u=DocUtil.getRangeEnd(s);l<u&&(l=u,a.setLastModifiedPosition(t))}}else if(r==UNICODE.RANGE_END){var c=editor.doc.getRawFormatAt(s);if(c&&c.type&&("link"===c.type||DocUtil.isNonEditablePortion(c.type))){var p=DocUtil.getRangeStart(s);p<l&&l<s&&(l=p)}}else r!=UNICODE.HR&&r!=UNICODE.TOCSTART&&r!=UNICODE.TOCEND||s++;if(r===UNICODE.CELL){var g=DocTreeManager.doc.getParents(NODE_TYPE.TABLE,s);s=g&&MailMergeRepeatUtil.isCellRepeatPresent(g)?g.getEndIndex()+1:s}}else{l=a.getNextWordEnd();var f=DocLayoutManager.getSectionViewAtIndex(s),E=DocLayoutManager.getNextSection(f);if(l>=editor.doc.getSectionEnd(s)&&(!E||DocLayoutManager.getSectionViewAtIndex(l).getSectionType()!==f.getSectionType()))return!1;if(r=editor.doc.getCharAt(l),r==UNICODE.RANGE_START){var c=editor.doc.getRawFormatAt(l);c&&c.type&&("link"===c.type||DocUtil.isNonEditablePortion(c.type))&&(l=DocUtil.getRangeEnd(l))}else if(r==UNICODE.RANGE_END){var c=editor.doc.getRawFormatAt(l);if(c&&c.type&&("link"===c.type||DocUtil.isNonEditablePortion(c.type))){var p=DocUtil.getRangeStart(l);p<s&&(s=p)}}}var T=editor.doc.createRange(s,l);return a.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(T).mapAllSelectionsToBulletin(),U(),!1},K=function(i,n,o){var r=editor.doc.getSelection(),a=r.getStart(),s=r.getEnd(),l=r.getLastModifiedPosition();if(Utils.getCurrentTypingDirection(l)==PARA_DIR.RTL&&!o)return Y(i,n,!0);l==e?(a=h(!0),a>s&&editor.doc.getSelection().setLastModifiedPosition(t)):s=h(!0);var d=editor.doc.createRange(a,s);return r.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(d).mapAllSelectionsToBulletin(),U(),!1},q=function(e){if(!TransLiteration_EventHandler.isTransliterationEnabled()||!EventHandler.multiByteTyping){var t=editor.doc.getSelection();if(!t.isCollapsed()){t.collapseToEnd(),U();var i=t.getStart();TransformEventHandler.onCursorChanged(i)}var n=r(),o=editor.doc.getElementAt(n),a=!0;return o.type==NODE_TYPE.PARAGRAPH&&(o=o.lastChild(),a=!1),o&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(o,a).mapAllSelectionsToBulletin(),w(),!1}},Q=function(e){var t,i,n=E(),o=editor.doc.getCharAt(n-1);return o!=UNICODE.CELL?(t=editor.doc.getElementAt(n-1),i=!1):(t=editor.doc.getElementAt(n),i=!0),t&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(t,i).mapAllSelectionsToBulletin(),w(),!1},$=function(e){var t=_(),i=editor.doc.getElementAt(t),n=!1;return i&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(i,n).mapAllSelectionsToBulletin(),w(),!1},ee=function(i){var n,o=editor.doc,a=o.getSelection(),s=a.getStart(),l=a.getEnd();(a.isCollapsed()||a.isRowSelection||a.isCellSelection)&&a.setLastModifiedPosition(t),n=a.getLastModifiedPosition();var d,c;a.isTableSelected()?(a.setIsTableSelected(!1),d=l=r(!0)):n==e?d=s=r(!0):(d=l=r(!0),c=DocTreeManager.doc.getSection(d),c.getSectionType()!==SECTION_TYPES.ENDNOTE&&c.getSectionType()!==SECTION_TYPES.FOOTNOTE&&(l=l<d?d:l));var u=editor.doc.createRange(s,l);if(a.hasRange(u))return!1;if(a.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(u).mapAllSelectionsToBulletin(),c=DocTreeManager.doc.getSection(d),c.getSectionType()===SECTION_TYPES.ENDNOTE||c.getSectionType()===SECTION_TYPES.FOOTNOTE){var p=DocTreeViewManager.getNoteRanges(c.getSectionType(),a[0].start,a[0].end),g=ZWArrayUtils.lastElementOf(p).end;g===d&&g!==a[0].end&&a.setLastModifiedPosition(e)}return!1},te=function(i){var n,o=editor.doc.getSelection(),r=o.getStart(),a=o.getEnd();o.isCollapsed()&&o.setLastModifiedPosition(t),n=o.getLastModifiedPosition(),n==e?(r=E(!0),r>a&&o.setLastModifiedPosition(t)):a=E(!0);var s=editor.doc.createRange(r,a);return o.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(s).mapAllSelectionsToBulletin(),w(),!1},ie=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.ROW),t=editor.doc.getSelection();if(e){if(TableUtil.isVerticalMergedRow(e))return!1;TableActions.moveRowDown(e),t.isTextDrag=!0,t.isTextDrag=!1}else{var i=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH),n=i.length,o=editor.doc.getSelection().getStart(),r=editor.doc.getSelection().getEnd();o==i[0].getStart()&&r==i[n-1].getEnd()||(o=i[0].getStart(),r=i[n-1].getEnd());var a=editor.doc.getSectionEnd(o),s=editor.doc.findNextIndexOf(UNICODE.PARA,r);if(s>0&&s<a){if(s+1===a||s>a){var l=editor.doc.getParents(NODE_TYPE.PARAGRAPH,s);if(l.getEnd()-l.getStart()===1)return!1;var d=DocUtil.copyStyle(editor.doc.getRawFormatAt(a-1)),c=ZWJSONUtils.getKeys(d);Op.processMsg([{r:a-1},{as:{start:d}},{is:UNICODE.PARA},{as:{end:c}}]),Op.sendMsg()}else{var u=editor.doc.getCharAt(r),p=editor.doc.getCharAt(s+1);if(p==UNICODE.TABLE||p==UNICODE.TOCSTART||p==UNICODE.HR){r-=1;var d=DocUtil.copyStyle(editor.doc.getRawFormatAt(r)),c=ZWJSONUtils.getKeys(d);Op.processMsg([{r:s},{as:{start:d}},{is:UNICODE.PARA},{as:{end:c}}]),Op.sendMsg()}else if(u==UNICODE.TABLE||u==UNICODE.HR||u==UNICODE.TOCSTART||u==UNICODE.CELL){r-=1;var d=DocUtil.copyStyle(editor.doc.getRawFormatAt(r)),c=ZWJSONUtils.getKeys(d);s=editor.doc.findPreviousIndexOf(CONT_REGEXP.PARASTART,s),s&&(Op.processMsg([{r:s+1},{as:{start:d}},{is:UNICODE.PARA},{as:{end:c}}]),Op.sendMsg())}else if(u==UNICODE.TABLEEND||u==UNICODE.TOCEND){r-=1,s=r+1;var d=DocUtil.copyStyle(editor.doc.getRawFormatAt(r)),c=ZWJSONUtils.getKeys(d);Op.processMsg([{r:r+2},{as:{start:d}},{is:UNICODE.PARA},{as:{end:c}}]),Op.sendMsg()}}var g=editor.doc.getSelection().getLastRange();return g&&g.setStart(s+1),EventHandler.textDragStart=!0,t.isTextDrag=!0,EventHandler.textDragSt=o,EventHandler.textDragEnd=r,EventHandler.moveText(),!1}}},ne=function(i){var n,o=editor.doc.getSelection(),r=o.getStart(),a=o.getEnd();o.getParents(NODE_TYPE.SECTION);o.isCollapsed()&&o.setLastModifiedPosition(t),n=o.getLastModifiedPosition(),n==e?(r=_(),r>a&&o.setLastModifiedPosition(t)):a=_();var s=editor.doc.createRange(r,a);return o.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(s).mapAllSelectionsToBulletin(),!1},oe=function(e){if(!TransLiteration_EventHandler.isTransliterationEnabled()||!EventHandler.multiByteTyping){var t=editor.doc.getSelection();if(!t.isCollapsed()){t.collapseToStart(),U();var i=t.getStart();TransformEventHandler.onCursorChanged(i)}var n=l(),o=editor.doc.getElementAt(n),r=!0;return o.type==NODE_TYPE.PARAGRAPH&&(o=o.lastChild(),r=!1),o&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(o,r).mapAllSelectionsToBulletin(),w(),!1}},re=function(e){var t=!0,i=editor.doc.getElementAt(f());return i&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(i,t).mapAllSelectionsToBulletin(),w(),!1},ae=function(e){var t=I(),i=editor.doc.getElementAt(t),n=!0;return i&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(i,n).mapAllSelectionsToBulletin(),w(),!1},se=function(t){var i=editor.doc.getSelection(),n=editor.doc.getCursorPortionNode(editor.uuid,e),o=J(n).closestParent(NODE_NAME.TABLE)[0];if(o){var r=DomViewManager.getDocView(o).getNode(),a=r.firstChild().firstChild().getIndex()+1,s=editor.doc.createRange(a);return i.removeAllRanges().addRange(s).mapAllSelectionsToBulletin(),w(),!1}},le=function(t){var i=editor.doc.getSelection(),n=editor.doc.getCursorPortionNode(editor.uuid,e),o=J(n).closestParent(NODE_NAME.TABLE)[0];if(!o)return!1;var r=DomViewManager.getDocView(o).getNode(),a=r.lastChild().lastChild().getEndIndex()+1,s=editor.doc.createRange(a);return i.removeAllRanges().addRange(s).mapAllSelectionsToBulletin(),w(),!1},de=function(i){var n,o=editor.doc.getSelection(),r=o.getStart(),a=o.getEnd();(o.isCollapsed()||o.isRowSelection||o.isCellSelection)&&o.setLastModifiedPosition(e);var s,d=DocTreeManager.doc.getSection(r);if(n=o.getLastModifiedPosition(),s=n==e?r=l(!0):a=l(!0),o.hasRange(editor.doc.createRange(r,a)))return!1;var c=editor.doc.createRange(r,a);if(o.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(c).mapAllSelectionsToBulletin(),d.getSectionType()===SECTION_TYPES.ENDNOTE||d.getSectionType()===SECTION_TYPES.FOOTNOTE){var u=DocTreeViewManager.getNoteRanges(d.getSectionType(),o[0].start,o[0].end),p=u[0].start;p===s&&p!==o[0].start&&o.setLastModifiedPosition(t)}return!1},ce=function(t){var i,n,o=editor.doc.getSelection(),r=o.getStart(),a=o.getEnd();o.isCollapsed()&&o.setLastModifiedPosition(e),i=o.getLastModifiedPosition(),n=f(!0),n==editor.doc.getSectionStart(r)&&(n+=1),i==e?r=n:(a=n,a<r&&o.setLastModifiedPosition(e));var s=editor.doc.createRange(r,a);return o.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(s).mapAllSelectionsToBulletin(),w(),!1},ue=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.ROW);if(e){if(TableUtil.isVerticalMergedRow(e))return!1;TableActions.moveRowUp(e)}else{var t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH),i=t.length,n=editor.doc.getSelection().getStart(),o=editor.doc.getSelection().getEnd(),r=editor.doc.getSectionStart(n);if(n==t[0].getStart()&&o==t[i-1].getEnd()||(n=t[0].getStart(),o=t[i-1].getEnd()),r+1===n)return!1;var a=editor.doc.findPreviousIndexOf(CONT_REGEXP.PARASTART,n-1);if(a){var s=editor.doc.getCharAt(a),l=editor.doc.getCharAt(o);if(s==UNICODE.ROW&&(a=editor.doc.findPreviousIndexOf(UNICODE.PARA,a)),a>0)if(s=editor.doc.getCharAt(a+1),s==UNICODE.TABLE||s==UNICODE.HR||s==UNICODE.TOCSTART){var d=DocUtil.copyStyle(editor.doc.getRawFormatAt(a)),c=ZWJSONUtils.getKeys(d);Op.processMsg([{r:a},{as:{start:d}},{is:UNICODE.PARA},{as:{end:c}}]),Op.sendMsg(),n+=1,o+=1}else if(l==UNICODE.CELL||l==UNICODE.TABLEEND||l==UNICODE.TOCEND){var d=DocUtil.copyStyle(editor.doc.getRawFormatAt(o-1)),c=ZWJSONUtils.getKeys(d);Op.processMsg([{r:o-1},{as:{start:d}},{is:UNICODE.PARA},{as:{end:c}}]),Op.sendMsg()}}if(a<0&&(a=editor.doc.getSectionStart(n)),a>=0){var u=editor.doc.getSelection().getLastRange();return u&&u.setStart(a+1),EventHandler.textDragStart=!0,EventHandler.textDragSt=n,EventHandler.textDragEnd=o,EventHandler.moveText(!0),!1}}},pe=function(t){var i,n=editor.doc.getSelection(),o=n.getStart(),r=n.getEnd();n.isCollapsed()&&n.setLastModifiedPosition(e),i=n.getLastModifiedPosition(),i==e?o=I():(r=I(),r<o&&n.setLastModifiedPosition(e));var a=editor.doc.createRange(o,r);n.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(a).mapAllSelectionsToBulletin()},ge=function(e){var t=T(KEYS.PAGEUP,!1),i=t.element,n=t.position;return i&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(i,n).mapAllSelectionsToBulletin(),w(),U(),!1},fe=function(e){var t=T(KEYS.PAGEUP,!0),i=editor.doc.getSelection();return i.hasRange(t)||i.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(t).mapAllSelectionsToBulletin(),w(),U(),!1},Ee=function(e){var t=T(KEYS.PAGEDOWN,!1),i=t.element,n=t.position;return i&&editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_KEYBOARD).moveTo(i,n).mapAllSelectionsToBulletin(),w(),U(),!1},Te=function(e){var t=T(KEYS.PAGEDOWN,!0),i=editor.doc.getSelection();return i.hasRange(t)||i.removeAllRanges().setSelectionType(SEL_KEYBOARD).addRange(t).mapAllSelectionsToBulletin(),w(),U(),!1},me=function(e){var t=editor.doc.getSelection(),i=t.getStart(),n=t.getParents(NODE_TYPE.PARAGRAPH);return i!==n.getStart()&&re(),!1},he=function(e){var t=editor.doc.getSelection(),i=t.getStart(),n=t.getParents(NODE_TYPE.PARAGRAPH);return i!==n.getStart()&&ce(),!1},Ie=function(e){var t=editor.doc.getSelection(),i=t.getEnd(),n=t.getParents(NODE_TYPE.PARAGRAPH,!0);return i!==n.getEnd()-1&&Q(),!1},_e=function(e){var t=editor.doc.getSelection(),i=t.getEnd(),n=t.getParents(NODE_TYPE.PARAGRAPH,!0);return i!==n.getEnd()-1&&te(),!1},Ae=function(e){var t,i=DocLayoutManager.getLineAtIndex(e),n=(i.getSegmentAtIndex(e),i.getParentNode().getIndex()),o=i.fieldsInfo;for(var r in o)if(t=o[r],n+t.start<e&&e<n+t.end){e=n+t.start;break}return e};return{moveLeft:x,moveToPrevWordStart:B,moveToLineStart:H,selectLeft:G,selectToPrevWordStart:k,selectToLineStart:Y,moveRight:z,moveToCurrentWordEnd:Z,moveToLineEnd:V,getLineEnd:h,selectRight:j,selectToCurrentWordEnd:X,selectToLineEnd:K,moveDown:q,moveToParaEnd:Q,moveToDocumentEnd:$,selectDown:ee,selectToParaEnd:te,selectToDocumentEnd:ne,moveUp:oe,moveToParaStart:re,moveToDocumentStart:ae,selectUp:de,selectToParaStart:ce,selectToDocumentStart:pe,moveToPrevPage:ge,selectToPrevPage:fe,moveToNextPage:Ee,selectToNextPage:Te,moveParaUp:ue,moveParaDown:ie,moveToCurrentParaStart:me,selectToCurrentParaStart:he,moveToCurrentParaEnd:Ie,selectToCurrentParaEnd:_e,moveToTableStart:se,moveToTableEnd:le}}();TransLiterationUtils=function(){"use strict";var e=function(e){var t={};t.settings=JSON.stringify(e),J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/transliteration"),data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){e.response},error:function(e){e.response}})},t=function(e){var t={};t.transliterationsettings=JSON.stringify(e),J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getActivitiesUrl("transliterationsettings"),data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){e.response},error:function(e){e.response}})},i=function(e){if("undefined"!=typeof ZWP){var t=new ZWP.ZWProofingErrorNode(null,null,e.text,"TRANSLITERATION",null,null,e.suggestions,null,e.lang,null,null,null,null);ZWP.Utils.reportSuggestion(t)}},n=function(e){var t={},i=editor.doc.docInfo;t.zuid=editor.zuid,t.zoid=editor.zoid,t.language=editor.lang,t.reason="Help",t.app_name=editorProps.permissionsInfo?editorProps.permissionsInfo.appInfo.NAME:"WRITER",t.view=window.EditorView?EditorView.getView():"Dashboard",i?(t.spellcheck_language=DocLocaleHandler.getLanguage()||"-",t.document_rid=i.RID,t.document_version=i.VERSION+"."+i.REVISION,t.deployment_detail=editorProps.deployment.customername+" : "+editorProps.deployment.domain,t.userrole=editor.doc.getRole()):t.deployment_detail=editorProps.deployment.domain,e.additional_info=JSON.stringify(t);var n=ZWNetworkUtils.getContextUrl("api/v1/sendmail/feedback");J.ajax({url:n,type:"POST",dataType:"json",data:e,success:function(e){UIUtils.showMessage("info",J.i18n("writer.common.TRANSLITERATION_REQ_SUCCESS"),!1,"normalfont",3e3)},error:function(e,t,i){UIUtils.showMessage("error",J.i18n("writer.common.TRANSLITERATION_REQ_FAILURE"),!1,"normalfont",3e3)},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})};return{saveTransliterationLangAjax:e,saveDocTransliterationSettingsAjax:t,reportTransliterationOptions:i,requestTransliterationLangAjax:n}}(),TransLiteration_EventHandler=function(){"use strict";var e,t,i,n,o,r={word:"",arr:[]},a=!1,s=!1,l={hindi:"hi",tamil:"ta",spanish:"sp",french:"fr"},d={hindi:"deva_phone.js",tamil:"ta_phone.js",spanish:"sp_phone.js",french:"fr_phone.js"},c=Object.keys(d),u=[],p=function(){return o},g=function(){return TransLiteration_EventHandler.isTransliterationOn&&!editor.isOffline()},f=function(){var e={errorcode:ZWCollaboration.TRANSLITERATION_REPORT_ERROR,text:r.word,suggestions:JSON.stringify(r.arr),type:"TRANSLITERATION",lang:l[o]};TransLiterationUtils.reportTransliterationOptions(e),TransLiterationHandler.handleInsert(r.word?r.word:"")},E=function(e){s=e},T=function(e){n=o=e},m=function(e){TransLiteration_EventHandler.isTransliterationOn=e.state,e.state||TransLiterationUtils.saveDocTransliterationSettingsAjax({enabled:!1,language:o}),J("#transliterationToggleContainer").enable(),J("#transliterationToggle").enable(),PubSub.publish("Document/TransLiteration/StateChanged")},h=function(e){var t={};t.subject="Transliteration Language Request",t.topic="Help",t.mail_content="Transliteration Language Request for "+e,t.from="editor",t.attachment_info=JSON.stringify([]),TransLiterationUtils.requestTransliterationLangAjax(t)},I=function(){i=void 0},_=function(e){i=e&&e.toUpperCase()},A=function(){return i?i.toUpperCase():i},S=function(){var e=A();"undefined"!=typeof e&&h(e),J.dialogutil.close("translitrequestlang")},R=function(e){return c.indexOf(e.toLowerCase())!=-1},O=function(){var e={init:function(){J("#language-request-primary-btn").zbutton("disable");for(var e=J("#translit_lang_req_selectbox"),t=DocLocaleHandler.getSupportedLanguages(),i=[],n=0;n<t.length;n++){var o=t[n],r=o.nativeLangName,a=o.name;key==ATTR_AUTOFIELD.LOCALE||a.toLowerCase().indexOf("english")!=-1||R(a)||i.push({label:r,value:a})}e.zselectbox("addOption",i),I()},set:function(e,t){e&&"language"==e.action&&(_(t),J("#language-request-primary-btn").zbutton("enable"))}};J.dialogutil.open("translitrequestlang",null,e)},b=function(){e=void 0},v=function(t){e=t&&t.toLowerCase()},D=function(){return e?e.toLowerCase():e},L=function(){t=void 0},N=function(e){t=e},P=function(){return t},C=function(){var e=D();"undefined"!=typeof e&&d.hasOwnProperty(e)&&(N(e),n=o=e,!Macros.isRemote()&&TransLiterationUtils.saveTransliterationLangAjax({language:e}),U()),J.dialogutil.close("translitlanguageselect")},y=function(){var e={init:function(){J("#language-select-primary-btn").zbutton("disable"),b(),L()},set:function(e,t){e&&"language"==e.action&&(v(t),J("#language-select-primary-btn").zbutton("enable"))}};J.dialogutil.open("translitlanguageselect",null,e)},F=function(e,t){s?(Transliterate.init(e),o=e,TransLiterationUtils.saveDocTransliterationSettingsAjax({enabled:!0,language:o}),m({state:!0}),t&&"function"==typeof t?t():void 0,UIUtils.showMessage("info","Transliteration is now ready to use.",!1,"normalfont",2e3)):loadJS({async:"async",defer:"defer",src:transliterationJsUrl,callback:function(){s=!0,Transliterate.init(e),m({state:!0}),o=e,TransLiterationUtils.saveDocTransliterationSettingsAjax({enabled:!0,language:o}),t&&"function"==typeof t?t():void 0,UIUtils.showMessage("info","Transliteration is now ready to use.",!1,"normalfont",2e3)},failed:function(){J("#transliterationToggle").enable(),Z("transliterationToggle").ztoggleswitch("switchOff"),UIUtils.showMessage("error","Oops! Transliteration failed to load. Please try again in a while",!1,"normalfont",3e3)}})},M=function(e,t){loadJS({async:"async",defer:"defer",src:cdnZWStaticPath+fingerPrintObj["js/common/transliteration/languagedata/"+d[e]],callback:function(){u.indexOf(e)==-1?u.push(e):void 0,F(e,t)},failed:function(){J("#transliterationToggle").enable(),Z("transliterationToggle").ztoggleswitch("switchOff"),UIUtils.showMessage("error","Oops! Transliteration failed to load. Please try again in a while",!1,"normalfont",3e3)}})},w=function(e){J("#transliterationToggleContainer").disable(),J("#transliterationToggle").disable(),UIUtils.showMessage("info","Processing transliteration language sources",!1,"normalfont",5e3),d.hasOwnProperty(e)&&(u.indexOf(e)==-1?M(e):F(e))},U=function(e){var t=o?o:n;UIUtils.showMessage("info","Processing transliteration language sources",!1,"normalfont",5e3),u.indexOf(t)==-1?M(t,e):F(t,e)},x=function(e,t){if(J("#transliterationToggleContainer").disable(),J("#transliterationToggle").disable(),t.state&&!n)return void y();if(t.state){var i=o?o:n;if(!i||!d[i])return J("#transliterationToggle").enable(),void Z("transliterationToggle").ztoggleswitch("switchOff");J("#transliterationLanguageSelect").zlabeledselectbox("setValue",i),U()}else m(t)},B=function(e,t){var i=t?J(t.menuitem).data().metadata.properties.value:void 0;"request_lang"==i&&TransLiteration_EventHandler.openLanguageRequestDialogue()},H=function(e,t){var i=J(t.menuitem).data().metadata.properties.value;"request_lang"==i?TransLiteration_EventHandler.openLanguageRequestDialogue():w(i)},G=function(e){return 8==e||32==e||e>=48&&e<=90||e>=96&&e<=111||e>=160&&e<=165||e>=170&&e<=171||e>=186&&e<=223},k=function(e,t){var i=document.createEvent("CustomEvent"),n="undefined"!=typeof t?{data:t}:{data:void 0};return i.initCustomEvent(e,!0,!0,n),i.data=t,i},W=function(e){return r.word=e.key,r.arr=[r.word],PubSub.publish("Document/TransLiteration/CharacterOperation",r),k("compositionstart")},Y=function(e){var t=r.word&&r.word.length;return e.keyCode==KEYS.BACKSPACE?r.word=r.word.substr(0,r.word.length-1):G(e.keyCode)&&t<40&&(r.word+=e.key),r.arr=[r.word],PubSub.publish("Document/TransLiteration/CharacterOperation",r),r.word.length>0?k("compositionupdate",r.word):k("compositionend")},z=function(e){var t="";if(e){var i=e.key||e.keyIdentifier;if(e.keyCode==KEYS.DELETE||e.keyCode==KEYS.SPACE||e.keyCode==KEYS.ENTER||e.keyCode==KEYS.TAB||e.ctrlKey||e.metaKey||e.altKey)t=("undefined"!=typeof r.arr[0]?r.arr[0]:r.word)+" ";else if(e.keyCode>=48&&e.keyCode<=57){var n=e.keyCode-48;t=0==n?r.word+" ":n>r.arr.length?r.arr[r.arr.length-1]+" ":r.arr[n-1]+" "}else/['`~!@#$%^&*()_|+-=?;:'",.<>\{\}\[\]\\\/]/.exec(i)?t=r.arr[0]+i+" ":e.composedWord&&(t=e.composedWord)}return PubSub.publish("Document/TransLiteration/closeMenu"),k("compositionend",t)},V=function(e){},j=function(){},X=function(e){r.arr[e]&&(r.word=r.arr[e],r.arr=[r.arr[e]])},K=function(){r.word="",r.arr=[""]},q=function(e){U(e)},Q=function(){TransLiteration_EventHandler.isTransliterationEnabled()&&Z("transliterationToggle").ztoggleswitch("switchOn")};return function(){var e=docProps.collabUsersDetails[editor.zuid].transliterationsettings&&docProps.collabUsersDetails[editor.zuid].transliterationsettings,t=e&&e.language,i=e&&e.enabled,n=editor.doc.getBodyFormat().transliteration&&editor.doc.getBodyFormat().transliteration,o=n&&n.language,r=t?t:o;T(r),"true"==i&&(a=!0,Z("transliterationToggle").ztoggleswitch("switchOn"))}(),PubSub.subscribe("Dialog/BeforeClose",function(e){if("translitlanguageselectzdialog"==e.target[0].id){var t=P();t?J("#transliterationLanguageSelect").zlabeledselectbox("setValue",t):(J("#transliterationToggle").enable(),Z("transliterationToggle").ztoggleswitch("switchOff"))}}),{getCurrentLanguage:p,isTransliterationEnabled:g,reportTransliteration:f,setProcessingJSLoaded:E,applyDlgSelectLanguage:C,requestDlgSelectLanguage:S,setDefaultLanguage:T,preloadTransliteration:q,openLanguageRequestDialogue:O,setTransliterationSettings:Q,changeLanguage:w,isTransliterationOn:a,toggleTransLiterationState:x,clickEvents:H,requestLang:B,isAllowedKeyCode:G,getCompositionStartEvent:W,getCompositionUpdateEvent:Y,getCompositionEndEvent:z,getTextInputEvent:V,setComposedDataInLayerHTML:j,setComposedDataByIndex:X,clearComposedData:K}}(),EventHandler.clickEvt={clkCount:0,pos:{X:0,Y:0},timeout:!1},EventHandler.mouseDown_coord={},EventHandler.mouseLogs=[],EventHandler.isTableColSelection=!1,EventHandler.mouseUpDone=!0,EventHandler.isCheckListRightClk=!1,EventHandler.isCheckListOperation=!1,EventHandler.isDialogFocused=!1,EventHandler.isImageDrag=!1,EventHandler.handleMouseDown=function(e){EventHandler.mouseDown_coord.idx=e.index,EventHandler.mouseDown_coord.srcElem=e.srcElement},EventHandler.handleMouseUp=function(e){},EventHandler.handleMouseMove=function(e){},EventHandler.getIndex=function(e,t,i,n){if(isV8Engine){var o,r=Offset.getClosest(e.clientX,e.clientY).content.section.type,a=Offset.getClosest(e.clientX,e.clientY,r);switch(o=a.image?a.image.index:a.content.index,t||(t=e.target,t instanceof jQuery&&(t=t[0])),e.type){case"mousedown":EventHandler.handleMouseDown({index:o,srcElement:t});break;case"mouseup":EventHandler.handleMouseUp({index:o,srcElement:t});break;case"mousemove":EventHandler.handleMouseMove({index:o,srcElement:t})}return o}if(isIPadSafariBrowser)return EventHandler.getIndexFromCoords(e,t);t||(t=e.target,t instanceof jQuery&&(t=t[0]));var s=Utils.getCorrectedCoord(e),l=s.x,d=s.y;if(editor.browserInfo.is_firefox&&("mousemove"===e.type||"touchmove"===e.type)&&(!DomUtil.nodeNameEquals(t,"image")||J(t).hasClass("zw-bullet-image"))&&!J(t).hasClass("zw-ifr-div"))if(DomViewManager&&DomViewManager.isMultiplePagesInRow()){var c=DomViewManager.getClosestPage({left:l,top:d});t=Utils.getClosestChild(c,"span.zw-portion,span.EOP",l,d)}else t=Utils.getClosestChild(editor.jeditorPane[0],"div.zw-column",l,d),t=Utils.getClosestChild(t,"span.zw-portion,span.EOP",l,d);i&&(l=i,d=n,t="zw-contentpane selectableSection"==editor.clientActiveSection.className?Utils.getClosestChild(editor.editorPaneContainer[0],"span.zw-portion",l,d):Utils.getClosestChild(editor.clientActiveSection,"span.zw-portion",l,d));var u=t.id,p=!1,g=J(t),f=e.type;"contextmenu"===f&&(f="mousedown"),u&&u.indexOf("z-cursor-")!=-1&&(t=Utils.getClosestChild(editor.clientActiveSection,"span.zw-portion,span.EOP",l,d),g=J(t)),t.className==CONST.FIELD_TEXT_NODE&&(g=g.parents("span.zw-portion"),t=g[0]),"mousedown"!=f&&"touchstart"!=f||(EventHandler.isTableColSelection=!1);var E=editor.doc.getSelection(),T=DomViewManager.getCurrentSectionLeft(ABSOLUTE_TO.WINDOW)-10,m=("mouseup"==f||"touchend"==f)&&EventHandler.isTableColSelection&&g.closestParent(".zw-td").length;if(("mouseup"==f||"touchend"==f)&&(EventHandler.mouseDown_coord.x==l&&EventHandler.mouseDown_coord.y==d||l<T||m)){var h=t?t.className:"";if("object"!=typeof h&&h.indexOf("placeholder")!=-1&&EventHandler.mouseDown_coord.x==l&&EventHandler.mouseDown_coord.y==d)return DocUtil.getFloatElementRange("placeholder",EventHandler.mouseDown_coord.idx+1).end;if(EventHandler.textDragStart){J(editor.clientActiveSection).removeClass("unselectable").addClass("selectableSection");var I=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");I&&I.css("border-left-style",""),EventHandler.moveText()}if(EventHandler.mouseDown_coord.idx){var _=editor.doc.getRawFormatAt(EventHandler.mouseDown_coord.idx-1);if(_&&("bookmark"==_.type||"link"==_.type||"comment"==_.type||"endnote"==_.cls||"footnote"==_.cls)&&t&&"image"!=t.nodeName.toLowerCase()){var A=editor.doc.getCharAt(EventHandler.mouseDown_coord.idx-1),S=editor.doc.getCharAt(EventHandler.mouseDown_coord.idx);A&&A==UNICODE.RANGE_START?EventHandler.mouseDown_coord.idx-=1:S&&S==UNICODE.RANGE_END&&(EventHandler.mouseDown_coord.idx+=1)}}var R=E.getLastRange();E.isListItemSelection||EventHandler.isOnlyCtrlKeyPressed||R&&R.setStart(EventHandler.mouseDown_coord.idx);var O=parseFloat(g.parents("div.zw-paragraph").css("margin-left")||0);if(O<0&&(T+=O),O=parseFloat(g.parents(".zw-table:last").css("margin-left")||0),O<0&&(T+=O),l<T&&!TransformHandler.getCurrentObjectInfo().type){R&&R.setEnd(EventHandler.mouseDown_coord.idx),EventHandler.isOnlyCtrlKeyPressed?E.showCaret(R):E.removeAllRanges().addRange(R);var b=g.parent().hasClass("zw-float")&&J(t).hasClass("fillablefield");if(t=Utils.getClosestSpan(editor.clientActiveSection,l,d),g=J(t),EventHandler.mouseDown_coord.x==l&&EventHandler.mouseDown_coord.y==d){var v=editor.doc.getCursorPortionNode(editor.uuid,EventHandler.isOnlyCtrlKeyPressed?"end":"start"),D=J(v).closestParent("tr")[0];return D?E.selectRow(D).getEnd():b?EventHandler.mouseDown_coord.idx:NavUtil.getLineEnd(!0)}var L=CurUtil.getCursorLineOffset(t,!!g.parents(".zw-tr").length),N=CurUtil.getCursorPortionOffset(t);return L+N}return EventHandler.isTableColSelection?E.selectColumn(g.closest(".zw-td")[0]).getEnd():TableResize.isCellSelectionInProgress()?(TableResize.setIsCellSelectionInProgress(!1),E.selectCell(TableResize.getCellSelectionTD()).getEnd()):EventHandler.mouseDown_coord.idx}if("mousedown"==f||"dragover"==f||"mousemove"==f||"mouseup"==f||"touchstart"==f||"touchend"==f||"touchmove"==f){var P=t.parentNode;if(P){var C=P.id;if(C&&("imgResizeGrid"==C||"wmstoolbar"===C)||"imgResizeGrid"==u|"wmstoolbar"===u)return E.getStart()}var y=DomViewManager.getCurrentPage().el;"mousedown"!=f&&"touchstart"!=f||(EventHandler.mouseDown_coord.x=l,EventHandler.mouseDown_coord.y=d,EventHandler.mouseDown_coord.srcElem=t),EventHandler.setActivePageAndSection(g,l,d),"mousedown"!=f&&"touchstart"!=f||(EventHandler.mouseDown_coord.activeSection=editor.clientActiveSection);var F=editor.clientActiveSection?editor.clientActiveSection.className:void 0;if(EventHandler.isCurrentSectionUnselectable()||("mousemove"==f||"touchmove"==f)&&F.indexOf("zw-textbox-div")==-1&&editor.prevClientActiveSection.className.indexOf("zw-textbox-div")!=-1&&"textbox"==TransformHandler.getCurrentObjectInfo().type){var o,M=editor.prevClientActiveSection||EventHandler.mouseDown_coord.activeSection,w=editor.doc.getSectionStart(E.getStart()),U=editor.doc.getSectionEnd(E.getStart()),x=M.className,B=editor.clientActiveSection.className;if(!DocLayoutManager.isPageView())return x.indexOf("zw-contentpane")!=-1||x.indexOf("zw-notepane")!=-1?o=B.indexOf("header_primary")!=-1?w+1:U-1:x.indexOf("header_primary")!=-1?o=U-1:x.indexOf("footer_primary")!=-1&&(o=w+1),editor.currentPageIndex=editor.jeditorPane.children(".zw-page").index(y),editor.clientActiveSection=M,EventHandler.mouseDown_coord.idx=o,EventHandler.mouseDown_coord.isLineEnd=!1,o;var H;x.indexOf("zw-contentpane")!==-1?H="div.zw-contentpane":x.indexOf("zw-notepane")!=-1?H="div.zw-notepane":x.indexOf("header_primary")!=-1?H="div.header_primary":x.indexOf("footer_primary")!=-1&&(H="div.footer_primary"),editor.clientActiveSection=H?Utils.getClosestChild(y,H,l,d):M,t=Utils.getClosestChild(editor.clientActiveSection,"span.zw-portion,span.EOP",l,d),g=J(t)}}var G=g.parents("div.zw-contentpane, div.header_primary, div.footer_primary, div.zw-notepane,div.float-image-container")[0],k=("mouseup"==f||"touchend"==f)&&G&&G!=editor.clientActiveSection;if(!G||k){t=Utils.getClosestChild(editor.clientActiveSection,"span.zw-portion,span.EOP",l,d);var W=J(t.nextElementSibling).hasClass("zw-br-portion");g=W?J(t.nextElementSibling):J(t)}t=ImageActions.fgImgToImage(t),g=J(t);var Y=g.hasClass(TAG_CLASS)||g.parents().hasClass(TAG_CLASS);Y&&Y&&!g.hasClass(TAG_CLASS)&&(g=g.parents("."+TAG_CLASS));var z=!!g.hasClass("zw-chart-canvas"),Z=g.hasClass("fillablefield")||g.parents().hasClass("fillablefield"),V=g.hasClass("signerfield")||g.parents().hasClass("signerfield"),j=g.hasClass("mergeField")||g.parents().hasClass("mergeField");(Z||V||j)&&(Z&&!g.hasClass("fillablefield")?g=g.parents(".fillablefield"):V&&!g.hasClass("signerfield")?g=g.parents(".signerfield"):j&&!g.hasClass("mergeField")&&(g=g.parents(".mergeField")),t=g[0]);var X=V&&("image"===g[0].getAttribute("data-field-type")||"stamp"===g[0].getAttribute("data-field-type")),K=g.parents().hasClass("zw-float")&&(Z||V||j)&&!X;if(z||DomUtil.nodeNameEquals(t,"image")&&!g.hasClass("zw-bullet-image")||K||X||J(t).hasClass("zw-ifr-div")||null!=J(t).parents(".shape_box")[0]){p=!0;var q=g.parents("span.zw-portion"),Q={isInline:!0,ev:e},u=t.id,$=TransformHandler.getCurrentObjectInfo(),ee="move"==$.action,te=g.parents().hasClass("fillablefield"),ie=!("mousedown"!=e.type&&"touchstart"!=e.type||ee||TransformEventHandler.isObjectInSelection(u)||TransformEventHandler.getCurrentDownObject()||te||K),ne=!q[0]||te&&g.parents().hasClass("zw-float")||X&&g.parents().hasClass("zw-float");if(ne){var oe=J(t).parents(".fgImgOuterDiv").find(".shape_box")[0];g[0]&&"dummyImage"==g[0].id&&!oe?EventHandler.mouseDown_coord.idx=editor.doc.getSelection().getStart():J(t).hasClass("fillablefield")||J(t).hasClass("signerfield")||J(t).hasClass("mergeField")?X?EventHandler.mouseDown_coord.idx=DocTreeManager.getFloatImageIndex(q.attr("pid"),q.attr("fid")):EventHandler.mouseDown_coord.idx=DocTreeManager.getFloatImageIndex(g.attr("pid"),g.attr("fid")):EventHandler.mouseDown_coord.idx=DocTreeManager.getFloatImageIndex(J(g.parents("div.fgImgOuterDiv")[0]).attr("pid"),J(g.parents("div.fgImgOuterDiv")[0]).attr("fid")),Q.isInline=!1;var re="Image/Selected";return oe&&(u=J(t).parents(".zw-image").attr("id"),re="Shape/Selected"),ie&&PubSub.publish(re,u,Q),g.hasClass(NODE_TYPE.SIGNERFIELD)&&PubSub.publish("digiSignpanel/showMenu"),EventHandler.mouseDown_coord.idx}if(ie){var re="Image/Selected";null!=J(t).parents(".fgImgOuterDiv").find(".shape_box")[0]&&(u=J(t).parents(".zw-image").attr("id"),re="Shape/Selected"),PubSub.publish(re,u,Q)}t=q[0],g=q}else{if(DomUtil.isHRDiv(t)){var ae=DocUtil.getDocElement(t),se=ae.getStart();EventHandler.mouseDown_coord.idx=se-1;var u=DocTreeManager.getTreeNodeAtIndex(se).id,Q={ev:e},$=TransformHandler.getCurrentObjectInfo(),ee="move"==$.action,le=!("mousedown"!=e.type&&"touchstart"!=e.type||ee||TransformEventHandler.isObjectInSelection(u)||TransformEventHandler.getCurrentDownObject());return le&&PubSub.publish("Hr/Selected",u,Q),EventHandler.mouseDown_coord.idx}if(J(t).hasClass("zw-textbox-div")||null!=J(t).parents(".zw-textbox-div")[0]){var de=t.className.indexOf("zw-textbox-div")!=-1;if(de)t=Utils.getClosestChild(editor.clientActiveSection,"span.zw-portion,span.EOP",l,d),g=J(t);else{var u=DomViewManager.getViewData(J(t).parents(".zw-textbox-div")[0]).nodeId,$=TransformHandler.getCurrentObjectInfo(),ee="move"==$.action,ce=!("mousedown"!=e.type&&"touchstart"!=e.type||ee||TransformEventHandler.isObjectInSelection(u)||TransformEventHandler.getCurrentDownObject()),ue=editor.getRole().permissions.can("document.edit");if(ce){var pe=DocTreeManager.getSectionWithSid(u);EventHandler.mouseDown_coord.idx=pe.getRangeIndex(),TransformEventHandler.deselectObjects();var Q={ev:e};return ue&&PubSub.publish("TextBox/Selected",u,Q),EventHandler.mouseDown_coord.idx}var pe=DocTreeManager.getSectionWithSid(u),ge=editor.doc.getRawFormatAt(pe.getRangeIndex()),fe=ge[ATTR_IMAGE.I_ROTATE]||0,Ee=ge.rot_width||ge[ATTR_IMAGE.I_WID],Te=ge.rot_ht||ge[ATTR_IMAGE.I_HT],me=DocLayoutManager.getSectionViews(u)[0],he=DomViewManager.getDOMObj(me.getPage()),Ie=he.getRenderedDOM(me),a=J(Ie).offset(),_e={x:a.left+Ee/2,y:a.top+Te/2},Ae={angle:fe,center:_e},Se=/zw-textbox-div|zw-textbox-content|zw-textbox-align/.test(t.className);if(Se){var Q={};Q.transformationData=Ae,t=Utils.getClosestChild(editor.clientActiveSection,"span.zw-portion,span.EOP",l,d,Q),g=J(t)}}}}if(!p){if(DomUtil.nodeNameEquals(t,"path")||0!=g.closestParent("div.shape_box").length){var Re=g.closestParent(".zw-line-div"),L=CurUtil.getCursorLineOffset(Re[0]),N=CurUtil.getCursorPortionOffset(Re[0]);return EventHandler.mouseDown_coord.idx=L+N,EventHandler.mouseDown_coord.idx}if(!DomUtil.nodeNameEquals(t,"span")||g.hasClass("zw-bullet")){var R=E.getLastRange();if(f==(isIPadSafariBrowser?"touchmove":"mousemove")||f==(isIPadSafariBrowser?"touchend":"mouseup")||R.collapsed||E.isTableSelected()||R.isMultipleTablesSelected()||!g.hasClass("overlay")||isIPadSafariBrowser||E.isListItemSelection||EventHandler.isOnlyCtrlKeyPressed||1!=E.length||JSON.parse(t.getAttribute("data-range-info")).SID!=editor.uuid||!editor.getRole().permissions.can("document.edit")){if(g.hasClass("zw-bullet")||g.hasClass("zw-bullet-image")){if(("mousedown"==f||"touchstart"==f)&&editor.getRole().permissions.can("document.edit")){var Oe=CurUtil.getCursorLineOffset(t);E.removeAllRanges().showCaret(editor.doc.createRange(Oe)).setCursorFormat();var v=E.getNodesInSelection(NODE_TYPE.PARAGRAPH)[0]||[],be=v&&v.dtNode,ve=be&&DocLayoutManager.getViews(be)[0],ge=E.getParaFormat(),De=ge&&ge[ATTR_PARAGRAPH.PS_ML]||0,Le=ge&&ge[ATTR_PARAGRAPH.PS_PL]||0,Ne=ge&&ge[ATTR_PARAGRAPH.PS_TI]||0,Pe=ve&&ve.getSection();Pe&&Pe.getSectionType()==SECTION_TYPES.TEXTBOX&&(Pe=Pe.getRootSection());var Ce,ye,Fe,Me,we=Pe?Pe.getLeft():0,Ue=be&&be.paraProperties.listData&&be.paraProperties.listData.listType,a=J("#editorpane").offset().left+we*editor.zoomFactor,xe=ve&&ve.column&&ve.column.left||0,Be=ge.dir===PARA_DIR.RTL||!1,He=DocLayoutManager.getLineAtIndex(E.getTargetRange().start),Je=He&&He.left*editor.zoomFactor||0,Ge=He&&He.width*editor.zoomFactor||0;a+=xe,De=De.convertor().pixels*editor.zoomFactor,Ne=Ne.convertor().pixels*editor.zoomFactor,Me=De+Ne+Le.convertor().pixels*editor.zoomFactor;var ke=DocLayoutManager.getListData(be);ye=ke&&Math.max(ke.listCharSize.width,ke.listNumOriginalWidth)*editor.zoomFactor||0,Fe=ke&&ke.listPaddingRight*editor.zoomFactor||0,Ce=TableUtil.getAbsoluteCellLeft()*editor.zoomFactor;var We=DocTreeManager.getSectionAtIndex(Oe),Ye=We.getSectionType()==SECTION_TYPES.TEXTBOX?We:null,ze=TextBoxHandler.getAbsoluteLeft(Ye)*editor.zoomFactor;a=Be?a+Je+Ge+Ce+ze:a+Me+ye+Je-Fe+Ce+ze,Ue!==LIST_TYPE.UPPER_ROMAN&&Ue!==LIST_TYPE.LOWER_ROMAN||(a+=ye);var Ze;e.button>=2&&4!==e.button?Ze=!0:e.which>=2&&4!==e.which&&(Ze=!0);var Ve=l;if(Ye=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,Oe)){var u=Ye.sid,se=Ye.getRangeIndex(),fe=editor.doc.getRawFormatAt(se)[ATTR_IMAGE.I_ROTATE]||0,me=DocLayoutManager.getSectionViews(u)[0],he=DomViewManager.getDOMObj(me.getPage()),Ie=he.getRenderedDOM(me),je={x:l,y:d},Xe=TransformationUtils.rotateWRToEl(je,fe,Ie.children[0],editor.zoomFactor);Ve=Xe.x}if(!Be&&Ve<=a||Be&&a<=Ve)return CheckListOperations&&!CheckListOperations.isCheckList(ge)?(EventHandler.mouseDown_coord.idx=Oe,E.selectAllListItems(),ZWLogger.addToStatistics("List Item Selection")):Ze?EventHandler.isCheckListRightClk=!0:(EventHandler.isCheckListOperation=!0,editor.doc.execCmd("toggleItemState"),t=Utils.getClosestChild(editor.clientActiveSection,"span.zw-bullet.zw-bullet-image-list",l,d),EventHandler.mouseDown_coord.srcElem=t),Oe;g=g.hasClass("zw-bullet-image")?g.parent().next("span.zw-portion,span.EOP"):g.next("span.zw-portion,span.EOP"),t=g[0]}}else if(g.hasClass("spell-error")||g.hasClass("grammar-error")||g.hasClass("ui-comment-indication-new")||g.hasClass("overlay")||g.hasClass("replace-overlay")||g.hasClass("lock-overlay")||g.hasClass("writer-glyphs-tab"))t=t.parentNode,g=J(t);else if(g.hasClass("zw-textbox")&&g.parents().hasClass("selectableSection")){var u=g.attr("id"),se=DocTreeManager.getTreeNodeById(u).getIndex()+1,Ke=editor.doc.createRange(se,se);return editor.doc.getSelection().removeAllRanges().addRange(Ke),se}}else t=t.parentNode,E.isTextDrag=!0,EventHandler.textDragStart=!0,EventHandler.textDragRange=E.getLastRange(),EventHandler.textDragSt=E.getStart(),EventHandler.textDragEnd=E.getEnd();var qe=Utils.getBlockParent(t),Qe=J(qe);if(Qe.hasClass("zw-cell-container")&&0==Qe.children(".zw-paragraph:first").length&&(Qe=Qe.parents(".zw-td:first"),qe=Qe[0]),DomViewManager.isMultiplePagesInRow()&&Qe.hasClass("zw-column")&&(qe=Qe.parents(".zw-contentpane")[0]),t=Utils.getClosestSpan(qe,l,d),"zw-td"===t.className)for(var be=DomViewManager.getDocView(t).getNode(),$e=DocLayoutManager.getViews(be),et=$e.length-1;et>=0;et--)if($e[et].childViews.length){var tt=DomViewManager.getDOMElem($e[et]);t=Utils.getClosestSpan(tt,l,DocLayoutManager.getPageHeightAtIdx(be.getIndex()));break}if(g=J(t),g&&g.hasClass("zw-float")){var it=g.parent()&&g.parent().children()[0],nt=CurUtil.getCursorLineOffset(it),ot=CurUtil.getCursorPortionOffset(it);return nt+ot}if(t&&"td"==t.nodeName.toLowerCase()){var be=DomViewManager.getDocView(t).getNode(),$e=DomViewManager.getAllDomFromCurrentPage(be),rt=J();J($e).each(function(){J(this).find(".zw-paragraph:first").length&&(rt=rt.add(this))});for(var at,st=rt.length,et=st,lt=g.offset().top;et>0;et--)if(at=rt.eq(et-1),1==et||at.offset().top<=lt){qe=Utils.getBlockParent(at[0]),t=Utils.getClosestChild(qe,"span.zw-portion",l,d),g=J(t);break}}l=Math.max(l,g.offset().left)}}var dt=g.closest(".zw-tr")[0],ct=g.closest(".zw-td")[0];if(dt&&dt.classList.contains("ui-state-disabled")||ct&&ct.classList.contains("ui-state-disabled"))return E[0].start;var L=CurUtil.getCursorLineOffset(t),N=CurUtil.getCursorPortionOffset(t),ut={cursorOffset:L+N};if(!p&&!g.hasClass("zw-br-portion")){g.hasClass("zw-space")&&(g=g.parents("span.zw-portion"),t=g[0]);var pt=g.closest(".zw-line-div"),gt=DomViewManager.getDocView(pt.parent()[0]).nodeLines,He=gt[pt.prevAll(".zw-line-div").length],ft=pt.parents(".zw-textbox-div");if(ft[0]&&pt.parents().hasClass("selectableSection")){var Et={x:l,y:d},Tt=TextBoxHandler.getOffsetX(ft,pt[0],Et);ut.cursorOffset=DocLayoutManager.getIndexAtLeft(Tt/editor.zoomFactor,He).index}else{var se=isIPadSafariBrowser?e.pageX:e.x;ut.cursorOffset=DocLayoutManager.getIndexAtLeft((se-pt.offset().left)/editor.zoomFactor,He).index}}var se=ut.cursorOffset;"mousedown"!=f&&"touchstart"!=f||!TableResize.getColSelection()||(EventHandler.isTableColSelection=!0);var mt,h=t?t.className:"";if(!h||"object"==typeof h||h.indexOf("auto")==-1&&h.indexOf(NODE_TYPE.FILLABLEFIELD)==-1&&h.indexOf(NODE_TYPE.SIGNERFIELD)==-1&&h.indexOf(NODE_TYPE.MAILMERGEFIELD)==-1&&h.indexOf(CONST.NEXTRECORD)==-1&&h.indexOf("placeholder")==-1&&h.indexOf(AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER)===-1){if((mt=DocLayoutManager.blockAtIndex(se))&&mt.isNonEditable)return se=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,se),"mousedown"!=f&&"touchstart"!=f||(EventHandler.mouseDown_coord.idx=se),se;if(h.indexOf(TAG_CLASS)!==-1)return se=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,se),"mousedown"!=f&&"touchstart"!=f||(EventHandler.mouseDown_coord.idx=se),se}else{var ht,s=Utils.getCorrectedCoord(e);if(h.indexOf(NODE_TYPE.SIGNERFIELD)!=-1&&PubSub.publish("digiSignpanel/showMenu"),h.indexOf("placeholder")!=-1)ht=NODE_TYPE.PLACEHOLDER;else if(EventHandler.mouseDown_coord.x==l&&EventHandler.mouseDown_coord.y==d&&h.indexOf(NODE_TYPE.FILLABLEFIELD)!=-1)ht=NODE_TYPE.FILLABLEFIELD;else if(EventHandler.mouseDown_coord.x==l&&EventHandler.mouseDown_coord.y==d&&h.indexOf(NODE_TYPE.SIGNERFIELD)!=-1)ht=NODE_TYPE.SIGNERFIELD;else if(EventHandler.mouseDown_coord.x==l&&EventHandler.mouseDown_coord.y==d&&h.indexOf(NODE_TYPE.MAILMERGEFIELD)!=-1)ht=NODE_TYPE.MAILMERGEFIELD;else if(EventHandler.mouseDown_coord.x==l&&EventHandler.mouseDown_coord.y==d){se=L+N-1;var It=editor.doc.getRawFormatAt(se);if(!It&&(h.indexOf("auto")!=-1||h.indexOf(AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER)!=-1)){var _t=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,se);se=_t>0?_t:se}var R=E.getLastRange();R&&R.setStart(se)}else se=d>EventHandler.mouseDown_coord.y?DocUtil.getRangeEnd(L+N-1)+1:L+N-1;if(ht){var At=editor.doc.getRawFormatAt(se),St=At&&At.type===NODE_TYPE.IMAGE?{start:se}:At&&At.type===ht&&editor.doc.getCharAt(se)===UNICODE.RANGE_START?{start:se}:DocUtil.getFloatElementRange(ht,se);return(h.indexOf(NODE_TYPE.FILLABLEFIELD)==-1||St||g.find(".zw-image").length)&&h.indexOf(TAG_CLASS)===-1||(se=editor.doc.findPreviousIndexOf(UNICODE.RANGE_END,se),St=DocUtil.getFloatElementRange(ht,se)),"mousedown"!=f&&"touchstart"!=f||(EventHandler.mouseDown_coord.idx=St&&St.start||se),St&&St.start||se}}var Rt=editor.doc.getDocumentLength();if(se>Rt)se=editor.doc.getSectionStart(E.getStart())+1;else if(0==se){var qe=Utils.getBlockParent(editor.clientActiveSection);t=Utils.getClosestChild(qe,"span.zw-portion",l,d),g=J(t),l=Math.max(l,g.offset().left),L=CurUtil.getCursorLineOffset(t),N=CurUtil.getCursorPortionOffset(t),se=L+N+ut.cursorOffset}if("mousedown"==f||"touchstart"===f){var ge=He&&He.parent.getParaStyles(),Be=ge&&ge[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1,Ot=editor.jeditorPane.offset().left+PUtil.offsetLeft(t)*editor.zoomFactor+g.outerWidth()*editor.zoomFactor;l>Ot&&!Be&&(EventHandler.mouseDown_coord.isLineEnd=!0),EventHandler.mouseDown_coord.portion=t,EventHandler.mouseDown_coord.idx=se,Utils.addMouseLogs(Utils.getMouseLogs())}else if("mouseup"==f||"touchend"==f){if(editor.doc.getCharAt(se)==UNICODE.PARA){var bt=t.className.indexOf("EOP")!==-1?t:t.nextSibling,vt=bt&&bt.getBoundingClientRect()||0;!(EventHandler.mouseDown_coord.idx<=se&&vt.right-vt.width/2<=l||EventHandler.mouseDown_coord.isLineEnd)||i||EventHandler.isTableDrag||(se+=1)}EventHandler.mouseDown_coord.isLineEnd=!1}return se},EventHandler.isCurrentSectionUnselectable=function(){var e=EventHandler.getParentSectionClsName();return e.indexOf("unselectableSection")!=-1},EventHandler.getParentSectionClsName=function(){var e=editor.clientActiveSection,t=e.className;if(t.indexOf("zw-textbox-div")!=-1){var i=DomViewManager.getViewData(editor.clientActiveSection).nodeId,n=DocLayoutManager.getSectionViews(i)[0],o=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(n.getRangeIndex()),r=DomViewManager.getDOMObj(n.getPage());return r.getActiveSectionElem(o).className}return/contentpane|header_primary|footer_primary|footnotepane|endnotepane/.test(t)?t:t},EventHandler.handleShortCuts=function(e,t){var i=e.metaKey,n=e.ctrlKey,o=e.altKey,r=e.shiftKey,t=String.fromCharCode(t).toLowerCase(),a=!1,s=editor.doc.getSelection();if(!o&&r&&(n||i))switch(t){case"v":editor.getRole().permissions.can("document.edit")&&r&&PasteEventHandler.prePasteProcess(!0)}else if(!i&&!n||o){if(!o&&r&&!n&&!i&&editor.getRole().permissions.can("document.edit"))if(t==KEYS.INSERT)Toolbar.handleClick(e,"paste");else if(113==e.which){s.isCollapsed()&&s.getWord().select();var l=s.getNodesInSelection(NODE_TYPE.TEXT,s.getStart(),s.getEnd())[0].nodeValue.trim(),d=l.charCodeAt(0),c=l.charCodeAt(1);d<90&&c<90?editor.doc.execCmd("changecase","lower"):d>90&&c>90?editor.doc.execCmd("capitalizeword"):editor.doc.execCmd("changecase","upper")}}else switch(t){case"x":!editor.getRole().permissions.can("document.edit")||s.isCollapsed()||s.isListItemSelection?DomUtil.stopEvent(e):CopyEventHandler.preCutProcess("cut"),a=!1;break;case"o":FileOpen.fileOpenDialog(),a=!0;break;case"c":editor.browserInfo.is_edge&&CopyEventHandler.preCopyProcess("copy");break;case"v":editor.getRole().permissions.can("document.edit")&&PasteEventHandler.prePasteProcess();break;case"s":a=Macros.ctrlSave(a,e);break;case"f":i&&n||(FindAdaptor.openFind(),a=!0);break;case"k":!editor.getRole().permissions.can("document.edit")||s.isListItemSelection?(DomUtil.stopEvent(e),a=!1):(LinkDialog.openLinkPopup(),a=!0);break;default:a=!1}return a},EventHandler.handleClickEvents=function(e){var t=function(){var e=EventHandler.clickEvt.timeout;e&&clearTimeout(EventHandler.clickEvt.timeout),EventHandler.clickEvt.timeout=0};t();var i=EventHandler.clickEvt.pos;isIPadSafariBrowser||!i||i.X==e.clientX&&i.Y==e.clientY||(EventHandler.clickEvt.clkCount=0);var n=EventHandler.clickEvt.lastTapTime||0,o=(new Date).getTime(),r=o-n;r<600&&r>0||(EventHandler.clickEvt.clkCount=0);var a=EventHandler.clickEvt.clkCount;if(EventHandler.clickEvt.clkCount=a?a+1:1,EventHandler.clickEvt.lastTapTime=o,EventHandler.clickEvt.pos={X:e.clientX,Y:e.clientY},EventHandler.clickEvt.clkCount>1){if(e.srcElement&&e.srcElement.classList&&e.srcElement.classList.contains("ui-condt-expand-icon"))return;var s=e.target,l=s.parentNode;if(l){var d=l.id;if(d&&"imgResizeGrid"==d||"imgResizeGrid"==s.id)return}}2==EventHandler.clickEvt.clkCount?(EventHandler.handleDoubleClickEvent(e),EventHandler.mouseDown=!1):3==EventHandler.clickEvt.clkCount&&(EventHandler.handleTripleClickEvent(e),editor.doc.getSelection().setLastModifiedPosition("end"),DomUtil.stopEvent(e),EventHandler.mouseDown=EventHandler.mouseDown),EventHandler.clickEvt.timeout=setTimeout(function(){t(),EventHandler.clickEvt.clkCount=0,EventHandler.clickEvt.lastTapTime=0},500)},EventHandler.bringBehindImagesToFront=function(e){if(e)if(EventHandler.isBehind=!0,e.getSectionType()!=SECTION_TYPES.HEADER&&e.getSectionType()!=SECTION_TYPES.FOOTER){var t=DomViewManager.getDOMElem(e);J(t.closest("div.zw-page").querySelectorAll("div.zw-float-behind[pid="+e.id+"_id]")).css("z-index",10).addClass("zw-float-behind-active"),J(t.closest("div.zw-page").querySelectorAll("div.zw-textbox-behind[pid="+e.id+"_id]")).css("z-index",11).addClass("zw-textbox-behind-active")}else J("div.zw-float-behind[pid="+e.id+"_id]").css("z-index",10).addClass("zw-float-behind-active"),J("div.zw-textbox-behind[pid="+e.id+"_id]").css("z-index",11).addClass("zw-textbox-behind-active")},EventHandler.handleTripleClickEvent=function(e){if(!e.altKey){EventHandler.isBehind=!0,"zw-contentpane selectableSection"!=editor.clientActiveSection.className&&(J(".hf_content:first").find("div.zw-float-behind").css("z-index",10).addClass("zw-float-behind-active"),J(".hf_content:first").find("div.zw-textbox-behind").css("z-index",11).addClass("zw-textbox-behind-active"));var t=e.target,i=J(t);if(!i.parents(".shape_box")[0]){var n=editor.doc.getSelection();if(DomUtil.nodeNameEquals(t,"image"))return void ImageActions.selectImage();if(!i.hasClass("zw-bullet")||n.isListItemSelection){var o=Utils.getCorrectedCoord(e),r=o.x,a=o.y;!isIPadSafariBrowser||r&&a||(o=Utils.getCorrectedCoord(e.changedTouches[0]),r=o.x,a=o.y);var s=n.getParents(NODE_TYPE.PARAGRAPH),l=DomViewManager.getCurrentSectionLeft(ABSOLUTE_TO.WINDOW)-5,d=J(t).closestParent("div.zw-paragraph");d.find("div.zw-float-behind").css("z-index",10).addClass("zw-float-behind-active"),J(t).closestParent("div.zw-paragraph").find("div.zw-textbox-behind").css("z-index",11).addClass("zw-textbox-behind-active");var c=DomViewManager.getDocView(d[0]);EventHandler.bringBehindImagesToFront(c);var u=editor.doc.getCursorPortionNode(editor.uuid,"start"),p=J(u).closestParent("td")[0],g=J(u).closestParent("tr")[0];if("s-resize"==J(p).css("cursor")&&TableResize.setColSelection(!0),n.isListItemSelection)return n.selectAllListItems();if(r>editor.editorOffset.left&&r<l)return n.selectAll();var f;if(TableResize.isCellSelectionInProgress()||g&&o.x>editor.editorOffset.left&&o.x<l||TableResize.getColSelection())n.selectAllCells(),TableResize.setIsCellSelectionInProgress(!1);else if(s){var E=s.getStart(),T=s.getEnd();EventHandler.isOnlyCtrlKeyPressed?(n.isCtrlSelection=!0,n.reArrangeRanges(E,T)):(f=editor.doc.createRange(s.getStart(),s.getEnd()),n.removeAllRanges().setSelectionType(SEL_MOUSE).addRange(f))}}}}},EventHandler.handleDoubleClickEvent=function(e){var t=EventHandler.mouseDown_coord.srcElem;if(t){var i=J(t),n=editor.doc.getSelection();if(!i.hasClass("zw-bullet")||n.isListItemSelection){if(!editor.getRole().permissions.can("document.edit")||editor.doc.paintFormat_dblClick)return n.setSelectionType(SEL_MOUSE).selectWord(),void n.setLastModifiedPosition("end");var o=t.parentNode;if(o){var r=o.id;if(r&&"imgResizeGrid"==r||"imgResizeGrid"==t.id)return}i.hasClass("ui-hf-dbl-clk")&&(i=i.parent(),t=i[0]),i.hasClass("overlay")&&(t=e.target,i=J(t));var a=Utils.getCorrectedCoord(e),s=a.x,l=a.y;if(!isIPadSafariBrowser||s&&l||(a=Utils.getCorrectedCoord(e.changedTouches[0]),s=a.x,l=a.y),t!=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0]){var d=(t.id,t.className,DomViewManager.getCurrentSectionLeft(ABSOLUTE_TO.WINDOW)-5);if(a.x>editor.editorOffset.left&&a.x<d){var c=editor.doc.getCursorPortionNode(editor.uuid,"start"),u=J(c).closestParent("tr")[0];if(u)return n.selectAllCells();var p=n.getParents(NODE_TYPE.PARAGRAPH),g=p.getStart(),f=p.getEnd();if(EventHandler.isOnlyCtrlKeyPressed)n.isCtrlSelection=!0,n.reArrangeRanges(g,f);else{var E=editor.doc.createRange(g,f);n.removeAllRanges().setSelectionType(SEL_MOUSE).addRange(E)}return}EventHandler.setActivePageAndSection(i,s,l)}var T,m=editor.clientActiveSection.className,h=!1;if(!EventHandler.isCurrentSectionUnselectable()){if(DomUtil.nodeNameEquals(t,"image"))return void ImageActions.selectImage();if(i.parents(".shape_box")[0])return;var I=i.parents("div.zw-column").find("div.zw-paragraph:visible").last();if(I[0]||(I=i.parent().find("div.zw-column").find("div.zw-paragraph:visible").last()),!i.parents().hasClass("zw-table")&&I[0]){var _=Utils.getCorrectedCoord(e),A=I.offset().top+I.height()*editor.zoomFactor,S=n.getParents(NODE_TYPE.PARAGRAPH);if(m&&m.indexOf("zw-contentpane")!=-1&&_.y>A)return void EventHandler.addNewParas(_,S,I);if(S.getEnd()-S.getStart()==1)return void EventHandler.insertTabInEmptyPara(_,S)}var c=editor.doc.getCursorPortionNode(editor.uuid,"start"),R=J(c).closestParent("td")[0];if(R)for(var O,b,v=DomViewManager.getDocView(R).getNode(),D=DocLayoutManager.getViews(v),L=D.length,N=0;N<L;N++)O=DomViewManager.getDOMElem(D[N]),b=J(O).css("cursor"),"ne-resize"==b?TableResize.setIsCellSelectionInProgress(!0):"s-resize"==b&&TableResize.setColSelection(!0);if(e.altKey&&n.getParents(NODE_TYPE.TABLE)||TableResize.getColSelection())n.selectAllCells();else if(TableResize.isCellSelectionInProgress()){var g=DomViewManager.getDocView(J(J(R).parent()).find("td:first")[0]).getNode().getIndex(),f=n.selectRow(J(R).parent()[0]).getEnd();EventHandler.isOnlyCtrlKeyPressed?(n.isCtrlSelection=!0,n.reArrangeRanges(g,f)):n.removeAllRanges().addRange(editor.doc.createRange(g,f))}else n.isListItemSelection?n.selectAllListItems():n.setSelectionType(SEL_MOUSE).selectWord();return EventHandler.mouseDown_coord.idx=n.getTargetRange().start,void n.setLastModifiedPosition("end")}EditorUtil.isCursorInHeaderFooter()?(PanelUtil.openHeaderFooter(),editor.jeditorPane.find("div.header_primary,div.footer_primary").removeClass("unselectableSection").addClass("selectableSection"),T=EventHandler.getIndex(e,t),h=!0):(PanelUtil.closeHeaderFooter(!1),editor.jeditorPane.find("div.zw-contentpane").removeClass("unselectableSection").addClass("selectableSection"),editor.jeditorPane.find("div.zw-notepane").removeClass("unselectableSection").addClass("selectableSection"),T=EventHandler.getIndex(e),h=!0),editor.prevClientActiveSection=editor.clientActiveSection;var E=editor.doc.createRange(T);n.removeAllRanges().addRange(E),h&&EventHandler.toggleSection(),PubSub.publish("Document/SwitchSection")}}},EventHandler.prevEvent=function(){var e;return{get:function(){return e},set:function(t){e=t}}}(),EventHandler.handleMouseEvents=function(e){var t=e.type,i=e.target;if(isIPadSafariBrowser&&"touchmove"===e.type){var n=e.changedTouches[0];i=document.elementFromPoint(n.clientX,n.clientY)}var o=!1,r=!1,a=!1,s=(i.id,i.className&&"string"==typeof i.className),l=J(i),d=i.nodeName.toLowerCase();editor.scrollOn=!1,EventHandler.isCheckListRightClk=!1,EventHandler.isOnlyCtrlKeyPressed=!e.altKey&&!e.shiftKey&&(editor.browserInfo.is_mac?!e.ctrlKey&&e.metaKey:e.ctrlKey),i.className==CONST.FIELD_TEXT_NODE&&(l=l.parents("span.zw-portion"),i=l[0],s=i.className?i.className.toLowerCase():""),e.which<2?o=!0:2==e.which?a=!0:r=!0;var c=editor.doc.getSelection(),u=!1,p=i.getAttribute("class");("tableProp"==i.id||p&&p.indexOf("js-hfedit")!=-1)&&(u=!0);var g=l.closest(".zw-tr")[0];if(g&&g.classList.contains("ui-state=disabled"))return c[0].start;if("mousemove"==t||"touchmove"===t){EventHandler.textDragStart||editor.imgDrag||!c.isTableSelectionInProgress()||TableResize.isInProgress()||c.mouseMove(e);var f=DomViewManager.getCurrentSectionLeft(ABSOLUTE_TO.WINDOW)-10,E=parseFloat(l.parents("div.zw-paragraph").css("margin-left")||0);E<0&&(f+=E);var T,m=Utils.getCorrectedCoord(e),h=e.target;if(isIPadSafariBrowser&&"touchmove"===e.type){var n=e.changedTouches[0];h=document.elementFromPoint(n.clientX,n.clientY)}if(T=J(h),editor.editorOffset.left<m.x&&m.x<f&&TableVisualCueHandler&&!TableVisualCueHandler.isOpen()&&!DomViewManager.isMultiplePagesInRow()?editor.editorPaneContainer.css("cursor","ne-resize"):DomViewManager.isMultiplePagesInRow()&&EventHandler.isMousePointerNotInthePage(l)?editor.editorPaneContainer.css("cursor","ne-resize"):editor.editorPaneContainer.css("cursor",""),PubSub.publish("Editor/MouseMove",e),EventHandler.textDragStart&&EventHandler.moveCursor(e),EventHandler.mouseDown&&!EventHandler.textDragStart&&!EventHandler.isMenuOpened&&!editor.imgDrag&&!EventHandler.isImageDrag&&!TableResize.isInProgress()){if(DomUtil.nodeNameEquals(e.target,"image")&&J(e.target).parents(".zw-float").length)return;var I=EventHandler.getIndex(e);if(c.isMouseMoveSelection=!0,EventHandler.isOnlyCtrlKeyPressed&&!c.isCollapsed()&&c.length>1){var _=c.getLastRange(),A=c.getLastModifiedPosition();I>_.start?c.setLastModifiedPosition("end"):c.setLastModifiedPosition("start"),"start"===A?_.setStart(I):_.setEnd(I),_&&c.select()}else if(c.isListItemSelection&&(c.isListItemSelection=!1,EventHandler.isOnlyCtrlKeyPressed=!1),!c.isCollapsed()&&isIPadSafariBrowser){var _=c.getLastRange(),A=c.getLastModifiedPosition(),S=_.start,R=_.end;"start"===A?(S=I,R=_.end,I>_.end&&c.setLastModifiedPosition("end")):(S=_.start,R=I,I<_.start&&c.setLastModifiedPosition("start"));var O=editor.doc.createRange(S,R);c.removeAllRanges().addRange(O)}else{var O=editor.doc.createRange(EventHandler.mouseDown_coord.idx,I);c.removeAllRanges().addRange(O)}}EventHandler.isImageDrag=!1}else if("mousedown"==t||"touchstart"==t){if(EventHandler.isCheckListOperation=!1,editor.currentCommand=COMMAND.ANY,EventHandler.mouseDown=!isIPadSafariBrowser,WordComplete.removeSuggestion(),EventHandler.mutiByteTyping&&EditorUtil.flushContents(),EventHandler.handleClickEvents(e),EventHandler.clickEvt.clkCount>1)return;if(!TableResize.isColumnResize()&&!TableResize.isRowResize()&&!e.shiftKey&&EventHandler.clickEvt.clkCount<=1&&!u){var b=c.isListItemSelection;r||(c.isListItemSelection=!1);var v=EventHandler.getIndex(e);if(l.hasClass("overlay")&&c.length>1&&EventHandler.isOnlyCtrlKeyPressed){var D=c.hasIntersectRange(editor.doc.createRange(v));if(D!==-1)return void c.removeRangeAt(D)}var O=c.getLastRange();if(b||!EventHandler.isOnlyCtrlKeyPressed||c.isCollapsed())if(b&&(EventHandler.isOnlyCtrlKeyPressed=!1),O&&isIPadSafariBrowser&&i.classList.contains("handler-callout")){EventHandler.mouseDown=!0;var _=O,A=c.getLastModifiedPosition(),S=O.start,R=O.end;l.hasClass("handler-callout-start")?(O.setStart(v),c.setLastModifiedPosition("start")):l.hasClass("handler-callout-end")&&(O.setEnd(v),c.setLastModifiedPosition("end"))}else isIPadSafariBrowser||O&&O.setStart(v)&&O.setEnd(O.start);else{var L=editor.doc.createRange(v);L&&c.hasIntersectRange(L)==-1&&c.showCaret(L)}if(EventHandler.textDragStart||EventHandler.isOnlyCtrlKeyPressed||isIPadSafariBrowser||O.remove(),r){if(l.hasClass("embedobj-play-icon")||l.parent().hasClass("zw-float-behind-active"))return;c.isListItemSelection?c.selectAllListItems():EventHandler.isCheckListRghtClk||(ZWLogger.log("@handleClickEvents isRightClick: "+r+", Type: "+t+"\nMouse logs: "+Utils.getMouseLogs()),c.setSelectionType(SEL_CONTEXT).select()),PubSub.publish("Selection/updateClientLeft")}}var N=!1;c.isTableSelected()&&(N=!0,EventHandler.isOnlyCtrlKeyPressed||c.removeTableSelection()),("td"==d||l.parents("td").get(0))&&(!N&&editor.getRole().permissions.can("document.edit")&&TableResize.mouseDown(e),c.mouseDown(e,r)),PubSub.publish("Editor/MouseDown",v,e)}else if(("mouseup"==t||"touchend"===t)&&!EventHandler.isInline){if(EventHandler.mouseDown=!1,c.isMouseMoveSelection=!1,EventHandler.isImageDrag=!1,(editor.browserInfo.is_mac&&e.metaKey||editor.browserInfo.is_windows&&e.ctrlKey)&&editor.doc.getParents(NODE_TYPE.LINK,editor.doc.getSelection().getStart())&&Utils.goToLink(),(!TableResize.isInProgress()||!TableResize.isColumnResize()&&!TableResize.isRowResize())&&EventHandler.clickEvt.clkCount<=1&&!u){var P=EventHandler.getIndex(e);if(l.hasClass("overlay")&&c.length>1&&EventHandler.isOnlyCtrlKeyPressed&&EventHandler.clickEvt.clkCount<=1){var D=c.hasIntersectRange(editor.doc.createRange(P));if(D!==-1&&P===EventHandler.mouseDown_coord.idx)return void c.removeRangeAt(D)}var I=c.getStart();if(!EventHandler.textDragStart){var C=c.isTableSelected()&&document.elementFromPoint(e.clientX,e.clientY)||void 0;I=C&&!c.isCellSelection&&EventHandler.getIndex(e,C)||P}if(!c.isListItemSelection){var O=c.getLastRange(),m=Utils.getCorrectedCoord(e),f=DomViewManager.getCurrentSectionLeft(ABSOLUTE_TO.WINDOW)-5,L=editor.doc.createRange(O.start,I);(e.shiftKey||editor.editorOffset.left<m.x&&m.x<f||EventHandler.isCheckListOperation||DocUtil.isPlaceHolderRange(L))&&(e.shiftKey&&"start"==c.getLastModifiedPosition()?O.setStart(I)&&O.setEnd(O.end):O.setEnd(I)),I>O.start?c.setLastModifiedPosition("end"):c.setLastModifiedPosition("start")}if(editor.prevClientActiveSection!=editor.clientActiveSection&&(EventHandler.toggleSection(),editor.prevClientActiveSection=editor.clientActiveSection),jQuery.isEmptyObject(editor.doc.paintFormat)){if(EventHandler.textDragStart&&!c.isListItemSelection)EventHandler.moveText();else{if(c.isListItemSelection)c.selectAllListItems();else{var y=editor.doc.getRawFormatAt(editor.doc.getSelection().getTargetRange().start);if(EventHandler.isOnlyCtrlKeyPressed&&!InsertShape.isShapeSelected()&&y&&y.type===NODE_TYPE.IMAGE&&c.getTargetRange().setEnd(c.getTargetRange().start+UNICODE.IMAGE.length),c.length>1)if(EventHandler.isOnlyCtrlKeyPressed){var F=c.toArray();F=U.unique(F),!c.isTableSelected()&&EventHandler.getUniqueRanges(F),c.isCtrlSelection=!0,c.removeAllRanges().addRanges(F).mapAllSelectionsToBulletin(),2==c.length&&ZWLogger.addToStatistics("Control Selection")}else c.removeAllRanges().setSelectionType(SEL_MOUSE).addRange(O);else{var y=editor.doc.getRawFormatAt(editor.doc.getSelection()[0].start);editor.doc.getSelection().isCollapsed()&&i.classList&&i.classList.contains("conditional-block")&&!i.classList.contains("ui-condt-expand-icon")&&y&&y.type==NODE_TYPE.CONDITIONAL_IF_START&&(y.condition&&y.condition&&y.condition[0].lhs.type===NODE_TYPE.MAILMERGEFIELD?ConditionsDlg.openPopup(NODE_TYPE.MAILMERGEFIELD):y.condition&&y.condition[0]&&y.condition[0].lhs.type===NODE_TYPE.FILLABLEFIELD&&ConditionsDlg.openPopup(NODE_TYPE.FILLABLEFIELD)),isIPadSafariBrowser&&"touchmove"!==EventHandler.prevEvent.get()&&O&&O.setStart(I)&&O.setEnd(O.start),c.setSelectionType(r?SEL_CONTEXT:SEL_MOUSE).select()}}editor.handleScroll()}PubSub.publish("Selection/updateClientLeft")}else EventHandler.applyStoredFormat()}if(c.resetTableSelection(),EventHandler.isBehind&&EventHandler.clickEvt.clkCount<=1&&!l.parent().hasClass("zw-textbox-behind-active")&&J("div.zw-textbox-behind-active").removeClass("zw-textbox-behind-active").css("z-index",0),EventHandler.isBehind&&EventHandler.clickEvt.clkCount<=1&&!l.parent().hasClass("zw-float-behind-active")&&(J("div.zw-float-behind-active").removeClass("zw-float-behind-active").css("z-index",0),EventHandler.isBehind=!1),TableResize.isInProgress()&&(TableResize.isColumnResize()||TableResize.isRowResize())?(TableResize.mouseUp(e),TableResize.setIsProgress(!1)):TableResize.isInProgress()&&TableResize.setIsProgress(!1),c.isTableSelected()){c.removeSelectedCellsBGImage();var O=c.getLastRange();O&&O.setStart(c.getStartCell().getStart()+1)&&O.setEnd(c.getEndCell().getEnd())}PubSub.publish("Editor/MouseUp",I,e)}EventHandler.prevEvent.set(t)},EventHandler.getUniqueRanges=function(e){for(var t,i,n=0;n<e.length;n++){i=e[n];for(var o,r=0;r<e.length;r++)n!=r&&i.isIntersectWithRange(e[r])&&(o=e[r],t=editor.doc.createRange(Math.min(i.start,o.start),Math.max(i.end,o.end)),r>n?(e.splice(r,1),e.splice(n,1)):(e.splice(n,1),e.splice(r,1)),e.push(t))}},EventHandler.isMousePointerNotInthePage=function(e){var t=e.parents(".selectableSection")[0]||e.parents(".unselectableSection")[0],i=e.hasClass(".selectableeSection")||e.hasClass(".unselectableSection");return!t&&!i},EventHandler.handleEnter=function(e){EditorUtil.handleEnter(e)},EventHandler.handleKeyDown=function(e){var t=e.type,i=e.keyCode,n=!1,o=e.metaKey,r=e.ctrlKey,a=e.altKey,s=e.shiftKey;editor.currentCommand=COMMAND.ANY,editor.currentKey=i;var l=!1,d=/[a-z(0-9){,1} ,\.]/i.test(i);editor.scrollOn=!1,i>=33&&i<=40&&(l=!0);var c=editor.doc.getSelection();if(s||r||o||a||l||c.resetLastModifiedPosition(),Widget.isTargetWidget()){var u=c.getLastRange();u&&u.setEnd(u.start+1)}var p=TransformHandler.getCurrentObjectInfo().type;if(p)if("hr"==p){var g=editor.doc.getElementAt(c.getStart()+1);if(g){var u=c.getLastRange();u&&u.setStart(g.getStart())&&u.setEnd(g.getEnd())}}else if("image"==p||"shape"==p){var u=c.getLastRange();u&&u.setEnd(u.start+1)}var f=TransformHandler.getCurrentObjectInfo().type,E=editor.doc.getRawFormatAt(c.getStart());if(E&&"textbox"==E.subType&&"textbox"==f){var u=c.getLastRange();u&&u.setEnd(u.start+1)}if(EventHandler.isDocumentMenuOpened){if(38==i||40==i)return DomUtil.stopEvent(e),!1;J("#documentmenu").hide(),EventHandler.isDocumentMenuOpened=!1}if(editor.getRole().permissions.can("document.edit")&&EditorUtil.isTypingAllowedOnKeypress()&&!r&&i==KEYS.TAB)!s&&WordComplete.isSuggestionShown()?WordComplete.insertSuggestion():(c.isListItemSelection?editor.doc.execCmd(s?"outdent":"indent"):(c.setSelectionType(SEL_KEYBOARD),TabKeyHandler.tabKeyHandling(s),UIUtils.playSound("normalKey")),s&&!c.isCollapsed()&&CurUtil.stopBlinking()),n=!0;else if(editor.getRole().permissions.can("document.edit")&&EditorUtil.isTypingAllowedOnKeypress()&&i==KEYS.ENTER)n=!a&&EventHandler.handleEnter(e),UIUtils.playSound("returnKey");else if(editor.getRole().permissions.can("document.edit")&&EditorUtil.isTypingAllowedOnKeypress()&&i==KEYS.BACKSPACE){var t="prevchar";(editor.browserInfo.is_mac&&(o||a)||!editor.browserInfo.is_mac&&r&&!a)&&c.isCollapsed()&&(t="prevword"),editor.doc.execCmd("delete",t),UIUtils.playSound("normalKey"),DomUtil.stopEvent(e),n=!0}else if(editor.getRole().permissions.can("document.edit")&&EditorUtil.isTypingAllowedOnKeypress()&&i==KEYS.DELETE){var t="nextchar";(editor.browserInfo.is_mac&&(o||a)||!editor.browserInfo.is_mac&&r&&!a)&&c.isCollapsed()&&(t="nextword"),editor.doc.execCmd("delete",t),UIUtils.playSound("normalKey"),n=!0}else e.keyCode==KEYS.ESC?(EditorView.isFullView()&&EditorView.gotoFullView(),InsertShape.isDrawingMode&&(PubSub.publish("Gridlines/hide"),J(".shape_box").css({width:"0",height:"0px"}),editor.jeditorPane.children(".zw-page").css("cursor","default"),J(editor.clientActiveSection).css({"-moz-user-select":"default"}),InsertShape.isDrawingMode=!1,InsertShape.isTextBox&&(J(".ui-textbox").removeClass("ui-state-highlight"),InsertShape.isTextBox=!1)),TransformHandler.getCurrentObjectInfo().isCropActive&&TransformHandler.removeCrop(),UIUtils.playSound("bellKey"),n=!0):e.keyCode==KEYS.CAPS||e.keyCode==KEYS.INSERT?n=!0:i==KEYS.SPACE||(r||o||a||s)&&(s&&r&&o&&a&&"220"==i&&Utils.showDebugger(),i!=KEYS.CTRL&&i!=KEYS.ALT&&i!=KEYS.SHIFT&&(d=/[a-z(0-9){,1} ,\.]/i.test(i),n=EventHandler.handleShortCuts(e,i)));return n},EventHandler.moveText=function(e){editor.lastOperation="Drag and Drop";var t=editor.doc.getSelection(),i=t.getLastRange();t.isTextDrag=!1,i.remove(),J(editor.clientActiveSection).removeClass("unselectable").addClass("selectableSection");var n=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");n&&n.css("border-left-style","");var o=i.start;if(e||(EventHandler.textDragSt=t.getCorrectedCursorPosition(EventHandler.textDragSt),EventHandler.textDragEnd=t.getCorrectedCursorPosition(EventHandler.textDragEnd)),EventHandler.textDragSt<=o&&o<=EventHandler.textDragEnd)EventHandler.textDragStart=!1,i&&i.setStart(i.end)&&t.removeAllRanges().addRange(i);else{var r=OpUtil.getInsertionOps(editor.doc.createRange(EventHandler.textDragSt,EventHandler.textDragEnd));TableUtil.handleSectionOpsArr(r.sectionOps);var a=r.ops;if(!a.length)return EventHandler.textDragStart=!1,void t.removeAllRanges().addRange(i);if(i=editor.doc.createRange(EventHandler.textDragSt,EventHandler.textDragEnd),t.removeAllRanges().addRange(i),editor.doc.getTrackChangeDetails().setContentMovedFromSource(!0),i.isPartialTableSelected()){var s=t.getParents(NODE_TYPE.TABLE),l=t.getParents(NODE_TYPE.TABLE,!0),d=s?TableUtil.getTableStart(t.getStart()):0,c=l?TableUtil.getTableEnd(t.getEnd()):0;if(t.deleteSelectedContents(),s&&d&&d<EventHandler.textDragSt&&EventHandler.textDragEnd>=s.getEnd()){a.shift();var u=DocUtil.copyStyle(t.getParents(NODE_TYPE.TABLE).attr()),p=ZWJSONUtils.getKeys(u),g=DocUtil.copyStyle(t.getParents(NODE_TYPE.ROW).attr()),f=ZWJSONUtils.getKeys(g),E=DocUtil.copyStyle(t.getParents(NODE_TYPE.CELL).attr()),T=ZWJSONUtils.getKeys(E),m=DocUtil.getParaStyle(o),h=ZWJSONUtils.getKeys(m),I=Utils.randomString(),_=Utils.randomString(),A=Utils.randomString(),S=Utils.randomString(),R=[{r:o},{as:{start:m,id:I}},{is:UNICODE.PARA},{as:{end:h,id:I}},{as:{start:u,id:_}},{is:UNICODE.TABLE},{as:{end:p,id:_}},{as:{start:g,id:A}},{is:UNICODE.ROW},{as:{end:f,id:A}},{as:{start:E,id:S}},{is:UNICODE.CELL},{as:{end:T,id:S}}];a=R.concat(a)}else if(l&&c&&c>EventHandler.textDragEnd){var m={type:"paragraph"},O=editor.doc.getParents(NODE_TYPE.PARAGRAPH,EventHandler.textDragEnd);O&&(m=DocUtil.copyStyle(O.attr("*")));var h=ZWJSONUtils.getKeys(m);a[0].r=o;var b=Utils.randomString();a.push({as:{start:m,id:b}},{is:UNICODE.PARA},{as:{end:h,id:b}},{is:UNICODE.TABLEEND})}}else{editor.doc.getContent(EventHandler.textDragSt,EventHandler.textDragEnd);t.deleteSelectedContents(),a[0].r=o,Op.resetCursorPos()}editor.doc.getTrackChangeDetails().setContentMovedFromSource(!1);var b=Utils.randomString(),o={as:{start:{type:"cursor",uuid:editor.uuid},id:b}},v={as:{end:["type","uuid"],id:b}};EventHandler.textDragStart=!1,a.splice(1,0,o),a.push(v),editor.doc.getTrackChangeDetails().setContentMovedToTarget(!0),Op.processMsg(a),editor.doc.getTrackChangeDetails().setContentMovedToTarget(!1),Op.cursorProcessed(),Op.sendMsg()}EventHandler.textDragRange&&EventHandler.textDragRange.remove()},EventHandler.moveCursor=function(e,t,i){var n=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");n&&n.css("border-left-style","dotted");var o;o="drag"==e.type?EventHandler.getIndex(e.originalEvent):EventHandler.getIndex(e,"",t,i);var r=editor.doc.getSelection();o=r.getCorrectedCursorPosition(o);var a=r.getLastRange();if(a&&a.setStart(o)&&a.setEnd(o),!("mousemove"!=e.type&&"touchmove"!=e.type||EventHandler.textDragSt<o&&o<EventHandler.textDragEnd)){var s=r.getWord(),l=s.getStart(),d=s.getEnd(),c=(l+d)/2;d-l>1&&o!=l&&(o=o<c?l:d)}a=editor.doc.createRange(o),r.removeAllRanges().addRange(a)},EventHandler.moveCursorToParaStart=function(e,t,i){var n=EventHandler.getIndex(e,"",t,i),o=editor.doc.getSelection();n=o.getCorrectedCursorPosition(n);var r=editor.doc.getParents(NODE_TYPE.PARAGRAPH,n);n=r.getStart();var a=editor.doc.createRange(n);o.removeAllRanges().addRange(a)},EventHandler.updatePageCount=function(){J("#totalPage").text("of "+DocLayoutManager.getPageCount())},PubSub.subscribe(DOCVIEW.PAGE_REMOVED,EventHandler.updatePageCount),PubSub.subscribe(DOCVIEW.PAGE_CREATED,EventHandler.updatePageCount),EventHandler.toggleSection=function(){editor.doc.clearLastAction();var e=DocTreeManager.doc.getSection(editor.doc.getSelection().getStart()),t=e.getSectionType();editor.getRole().permissions.can("document.edit")&&(t===SECTION_TYPES.TEXTBOX&&(t=DocTreeManager.doc.getSection(e.getRangeIndex()).getSectionType()),HF_SECTIONS.contains(t)?(editor.jeditorPane.find("div.zw-contentpane").removeClass("selectableSection").addClass("unselectableSection"),editor.jeditorPane.find("div.zw-notepane").removeClass("selectableSection").addClass("unselectableSection"),editor.jeditorPane.find("div.float-image-header-container").removeClass("unselectableSection").addClass("selectableSection"),editor.jeditorPane.find("div.float-image-footer-container").removeClass("unselectableSection").addClass("selectableSection"),editor.jeditorPane.find("div.float-image-content-container").removeClass("selectableSection").addClass("unselectableSection"),editor.jeditorPane.find("div.footer_primary").removeClass("unselectableSection").addClass("selectableSection ui-hf-border-blue"),editor.jeditorPane.find("div.header_primary").removeClass("unselectableSection").addClass("selectableSection ui-hf-border-blue")):(editor.jeditorPane.find("div.footer_primary").removeClass("selectableSection ui-hf-border-blue").addClass("unselectableSection"),editor.jeditorPane.find("div.header_primary").removeClass("selectableSection ui-hf-border-blue").addClass("unselectableSection"),editor.jeditorPane.find("div.float-image-header-container").removeClass("selectableSection").addClass("unselectableSection"),editor.jeditorPane.find("div.float-image-footer-container").removeClass("selectableSection").addClass("unselectableSection"),editor.jeditorPane.find("div.float-image-content-container").removeClass("unselectableSection").addClass("selectableSection"),editor.jeditorPane.find("div.zw-contentpane").removeClass("unselectableSection").addClass("selectableSection"),editor.jeditorPane.find("div.zw-notepane").removeClass("unselectableSection").addClass("selectableSection"))),PubSub.publish("Document/SectionChanged",t)},EventHandler.dropImage=function(e){for(var t,i=e.originalEvent?e.originalEvent.dataTransfer.files:e.dataTransfer.files,n={setHeaders:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},onprogress:function(){},success:function(e){var t=jQuery.parseJSON(e),i=t.validation;if("success"==i){r={};var n=t.uploadedFileUrl,o=document.createElement("img");JImg=J(o),document.body.appendChild(o),o.src=Macros.getBaseURL()+n,o.src.indexOf("image.do")!=-1?o.src=o.src+"&rid="+editor.doc.rid:o.src.indexOf("remoteImage.do")!=-1&&(o.src=o.src+"&rsid="+RemoteEditor.rsid),JImg.one("load",function(){JImg.unbind("load");var e=o.width,t=o.height,i=t,r=e,a={};a[ATTR_COMMON.TYPE]="image",a[ATTR_IMAGE.I_SRC]=n,a[ATTR_IMAGE.I_OP]="100%";var s=editor.doc.getSelection(),l=DocLayoutManager.getContentWidthAtIndex(s.getStart());e>l&&(r=l,JImg.width(r),i=t/e*l),a[ATTR_IMAGE.I_HT]=i,a[ATTR_IMAGE.I_WID]=r,a[ATTR_IMAGE.I_ORGINALHT]=i,a[ATTR_IMAGE.I_ORGINALWID]=r,editor.doc.execCmd("insimg",[a]),JImg.remove(),PubSub.publish("DocOperation/AfterDropImage")}).each(function(){this.complete&&J(this).load()})}},fail:function(){PubSub.publish("DocOperation/AfterDropImage")}},o=0;t=i[o++];)if(0!=t.size&&ZWImageUtils.isImage(t)){PubSub.publish("DocOperation/BeforeDropImage");var r={imageByte:"",fileName:t.name},a=new FileReader;a.onload=function(e){return function(e){var t=ZWNetworkUtils.getUrl("uploadImageFile");r.imageByte=e.target.result,J.ajaxUpload(t,r,n,"json")}}(t),a.readAsDataURL(t)}},EventHandler.handleCompositionStart=function(e){EventHandler.isDialogOpened||EventHandler.isMenuOpened||!editor.getRole().permissions.can("document.edit")||!J(document.activeElement).parent("span#zohoMultiByteSpan")[0]||InsertShape.getSelectedShape()||(editor.isCompositionEventStart=!0,EventHandler.multiByteTyping=!0,TransLiteration_EventHandler.isTransliterationEnabled()?void 0:EditorUtil.positioningMultiByteSpan(),EventHandler.updateMultiByteSpanHeight("start"),EditorUtil.focusMultiByteSpan())},EventHandler.updateMultiByteSpanHeight=function(e){var t=document.getElementById("zohoMultiByteSpan");editor.browserInfo.is_safari&&t&&("start"===e?t.style.removeProperty("height"):t.style.height="1px")},EventHandler.handleCompositionUpdate=function(e){if(InsertShape.getSelectedShape()){var t=J("#"+InsertShape.getSelectedShape().data.nvOProps.nvDProps.id).offset();return void J("#scaleSpan").css({top:t.top,left:t.left})}if(editor.isCompositionEventStart){EventHandler.multiByteTyping=!0;var i=String(e.newValue);if(i=i.replace(/\u200b/gi,""),!editor.browserInfo.is_firefox&&(i==UNICODE.MULTIBYTE_SPACE||" "==i))return EditorUtil.flushContents(),!1;EditorUtil.setHTML(e)}},EventHandler.handleCompositionEnd=function(e){if(!EventHandler.isDialogOpened&&!EventHandler.isMenuOpened&&editor.getRole().permissions.can("document.edit")&&J(document.activeElement).parent("span#zohoMultiByteSpan")[0]&&!InsertShape.getSelectedShape()){EventHandler.updateMultiByteSpanHeight("end");var t=J("#cursorSpan");if(e.data)return editor.lastCompositionData=e.data,EditorUtil.flushContents(e),EventHandler.multiByteTyping=!1,t.remove(),editor.isCompositionEventStart=!1,EditorUtil.updateMultiByteSpanLeft(),CurUtil.blinkCursor(),DomUtil.stopEvent(e),!1;if(!e.data){EventHandler.multiByteTyping=!1;var i=t.parent()[0];t.remove(),i&&i.normalize(),EditorUtil.updateMultiByteSpanLeft()}return!0}},EventHandler.handleTextInput=function(e){if(!EventHandler.isDialogOpened&&!EventHandler.isMenuOpened&&editor.getRole().permissions.can("document.edit")&&J(document.activeElement).parent("span#zohoMultiByteSpan")[0]){var t=e.data;if(e.detail&&(t=e.detail.data),editor.getRole().permissions.can("document.edit")&&t&&t!=editor.lastCompositionData){if(J(e.target).parents("span#zohoMultiByteSpan")[0]&&!TransLiteration_EventHandler.isTransliterationEnabled())return EventHandler.multiByteTyping=!0,EditorUtil.flushContents(e),EditorUtil.focusMultiByteSpan(),EventHandler.multiByteTyping=!1,DomUtil.stopEvent(e),!1}else EditorUtil.focusMultiByteSpan(),DomUtil.stopEvent(e)}return editor.lastCompositionData=void 0,!1},EventHandler.insertNonbreakingSpace=function(e){var t=String.fromCharCode(160);editor.addChar(t)},EventHandler.setActivePageAndSection=function(e,t,i){(e.hasClass("zw-pagecontainer")||e.hasClass("zw-content-wrapper"))&&(e=e.parents("div.zw-page"));var n=e[0],o=n.className,r=n.id,a=e.hasClass("zw-page")?n:e.parents(".zw-page")[0];if(o&&/contentpane|header_primary|footer_primary|notepane|textbox-div/.test(o))editor.clientActiveSection=n;else{editor.clientActiveSection=e.parents("div.zw-contentpane,div.header_primary, div.footer_primary,div.zw-notepane,div.zw-textbox-div")[0];var s=e.parents("div.float-image-content-container,div.float-image-header-container,div.float-image-footer-container")[0];if(!editor.clientActiveSection&&s){var o=s.className;o.indexOf("header")!=-1?editor.clientActiveSection=J(a).find("div.header_primary")[0]:o.indexOf("footer")!=-1?editor.clientActiveSection=J(a).find("div.footer_primary")[0]:o.indexOf("content")!=-1&&(editor.clientActiveSection=Utils.getClosestChild(a,"div.zw-contentpane",t,i))}}if(a||(a=DomViewManager.getClosestPage({left:t,top:i})),!editor.clientActiveSection){var l="div.zw-contentpane,div.header_primary,div.footer_primary,div.zw-notepane,div.zw-textbox-content",d=Utils.getClosestChild(a,l,t,i);d.className.indexOf("zw-textbox-content")!=-1?editor.clientActiveSection=d.parentElement:editor.clientActiveSection=d}if(editor.clientActiveSection.className.indexOf("zw-textbox-div")!=-1){var r=DomViewManager.getViewData(editor.clientActiveSection).nodeId;if(!TransformEventHandler.isObjectInSelection(r)){var c=DocLayoutManager.getSectionViews(r)[0],u=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(c.getRangeIndex()),p=DomViewManager.getDOMObj(c.getPage());editor.clientActiveSection=p.getActiveSectionElem(u)}}var g=Utils.getClosestChild(editor.clientActiveSection,"div.zw-column",t,i);editor.currentPageIndex=editor.jeditorPane.children(".zw-page").index(a),editor.currentColumnIndex=J(editor.clientActiveSection).find(".zw-column").index(g)},EventHandler.addNewParas=function(e,t,i){for(var n=DocLayoutManager.getSectionViewAtIndex(t.getStart()),o=n.getLeft(),r=J(".zw-page").offset().left+o,a=e.y-(i.offset().top+i.height()*editor.zoomFactor),s=i.children(".zw-line-div:first").height()*editor.zoomFactor,l=parseInt(a/s)||1,d=editor.currentColumnIndex-1;d!=-1;)r+=n.getColumnSpace(d),r+=n.getColumnWidth(d),d--;var c={type:"paragraph"},u=ZWJSONUtils.getKeys(c),r=J(".zw-page").offset().left/editor.zoomFactor+o,p=(e.x/editor.zoomFactor-r+"px").convertor(),g=p.inches;"mm"==Conversions.globalUnit&&(g=p.millimeters),c=DocUtil.copyStyle(t.attr("*"));for(var f,E=[{r:t.getEnd()-1}],T=0;T<l;T++)0!=T&&(c={type:"paragraph"}),f=Utils.randomString(),E.push({as:{start:c,id:f}},{is:UNICODE.PARA},{as:{end:u,id:f}});var m=Utils.randomString();E.push({as:{start:{type:NODE_TYPE.TEXT,st:NODE_TYPE.TAB},id:m}},{is:UNICODE.TAB},{as:{end:["type","st"],id:m}}),Op.processMsg(E),Op.appendCursor();var h=[{id:"0",point:g+Conversions.globalUnit,align:"0",leader:"0"}],I={};I[ATTR_PARAGRAPH.PS_NULL]=!0,I[ATTR_TEXT.TS_NULL]=!0,I[ATTR_PARAGRAPH.PS_TPS]=h,t.attr(I),Op.sendMsg()},EventHandler.insertTabInEmptyPara=function(e,t){for(var i=DocLayoutManager.getSectionViewAtIndex(t.getStart()),n=J(".zw-page").offset().left/editor.zoomFactor+i.getLeft(),o=editor.currentColumnIndex-1;o!=-1;)n+=i.getColumnSpace(o),n+=i.getColumnWidth(o),o--;var r=(e.x/editor.zoomFactor-n+"px").convertor(),a=r.inches;"mm"==Conversions.globalUnit&&(a=r.millimeters);var s=[],l=Utils.randomString();s.push({r:editor.doc.getSelection().getStart()},{as:{start:{type:NODE_TYPE.TEXT,st:NODE_TYPE.TAB},id:l}},{is:UNICODE.TAB},{as:{end:["type","st"],id:l}}),Op.processMsg(s);var d=[{id:"0",point:a+Conversions.globalUnit,align:"0",leader:"0"}],c={};c[ATTR_PARAGRAPH.PS_TPS]=d,t.attr(c),Op.sendMsg()},EventHandler.applyStoredFormat=function(){var e=editor.doc.getSelection(),t=e.getLastRange(),i=t.start,n=t.end,o=[],r=[],a=[];if(i==n){o.push(e.getWord()),a.push(editor.doc.paintFormat.text);var s=e.getParents(NODE_TYPE.PARAGRAPH);if(s.getEnd()-s.getStart()==1){var l={};editor.doc.paintFormat.para&&(l=editor.doc.paintFormat.para),l[ATTR_PARAGRAPH.PS_TS]=ZWJSONUtils.clone(editor.doc.paintFormat.text),delete l[ATTR_PARAGRAPH.PS_TS][ATTR_TEXT.TS_NULL],s.attr(l)}else editor.doc.paintFormat.para&&(r.push(e.getParents(NODE_TYPE.PARAGRAPH)),a.push(editor.doc.paintFormat.para))}else o=e.getNodesInSelection(NODE_TYPE.TEXT,i,n),a=(new Array).repeat(editor.doc.paintFormat.text,o.length),editor.doc.paintFormat.para&&(r=e.getNodesInSelection(NODE_TYPE.PARAGRAPH,i,n),a=a.concat((new Array).repeat(editor.doc.paintFormat.para,r.length)));editor.doc.execCmd("applyStyle",[o.concat(r),a,"formatPainter"])},EventHandler.setClientActiveSection=function(e){var t,i=e.getSectionType();if(i===SECTION_TYPES.CONTENT)t=editor.jeditorPane.children(".zw-page").eq(editor.currentPageIndex).find("div.zw-contentpane")[0];else if(i===SECTION_TYPES.HEADER)DocLayoutManager.isPageView()||(editor.currentPageIndex=0),t=editor.jeditorPane.children(".zw-page").eq(editor.currentPageIndex).find("div.header_primary")[0];else if(i===SECTION_TYPES.FOOTER)DocLayoutManager.isPageView()||(editor.currentPageIndex=editor.jeditorPane.children(".zw-page").length-1),t=editor.jeditorPane.children(".zw-page").eq(editor.currentPageIndex).find("div.footer_primary")[0];else if(i===SECTION_TYPES.FOOTNOTE||i===SECTION_TYPES.ENDNOTE||i===SECTION_TYPES.TEXTBOX){var n=DocLayoutManager.getSectionViews(e.sid)[0];t=DomViewManager.getDOMElem(n)}editor.clientActiveSection=editor.prevClientActiveSection=t},EventHandler.getIndexFromCoords=function(e,t){if(isIPadSafariBrowser){if(editor.isCompositionEventStart){var i=document.getElementById("zohoMultiByteSpan");if(i){var n=new CompositionEvent("compositionend",{data:i.children[0].innerText});editor.jeditorPane[0].ownerDocument.dispatchEvent(n)}}var o=Utils.getCorrectedCoord(e),r=o.x,a=o.y;r&&a||(o=Utils.getCorrectedCoord(e.changedTouches[0]),r=o.x,a=o.y);var s,l,d,c,u=e.type,p=editor.doc.getSelection();t||(t=e.target,t instanceof jQuery&&(t=t[0]));var g=J(t);EventHandler.mouseDown_coord.srcElem=t;var f=DomViewManager.getCurrentPage();null!==f&&(f=f.el),EventHandler.setActivePageAndSection(g,r,a),"mousedown"!=u&&"touchstart"!=u||(EventHandler.mouseDown_coord.activeSection=editor.clientActiveSection);var E=editor.clientActiveSection?editor.clientActiveSection.className:void 0;if(EventHandler.isCurrentSectionUnselectable()||("mousemove"==u||"touchmove"==u)&&E.indexOf("zw-textbox-div")==-1&&editor.prevClientActiveSection.className.indexOf("zw-textbox-div")!=-1&&"textbox"==TransformHandler.getCurrentObjectInfo().type){var s,T=editor.prevClientActiveSection||EventHandler.mouseDown_coord.activeSection,m=DocTreeManager.doc.getSection(p.getStart()),h=m.getIndex(),I=m.getEndIndex(),_=T.className,A=editor.clientActiveSection.className;if(!DocLayoutManager.isPageView())return _.indexOf("zw-contentpane")!=-1||_.indexOf("zw-notepane")!=-1?s=A.indexOf("header_primary")!=-1?h+1:I-1:_.indexOf("header_primary")!=-1?s=I-1:_.indexOf("footer_primary")!=-1&&(s=h+1),editor.currentPageIndex=editor.jeditorPane.children(".zw-page").index(f),editor.clientActiveSection=T,EventHandler.mouseDown_coord.idx=s,EventHandler.mouseDown_coord.isLineEnd=!1,s;var S;_.indexOf("zw-contentpane")!==-1?S="div.zw-contentpane":_.indexOf("zw-notepane")!=-1?S="div.zw-notepane":_.indexOf("header_primary")!=-1?S="div.header_primary":_.indexOf("footer_primary")!=-1&&(S="div.footer_primary"),editor.clientActiveSection=S?Utils.getClosestChild(f,S,r,a):T}if(c=editor.clientActiveSection?editor.clientActiveSection.className:void 0,c.indexOf("header_primary")!==-1?d=SECTION_TYPES.HEADER:c.indexOf("footer_primary")!==-1?d=SECTION_TYPES.FOOTER:c.indexOf("content")!==-1?d=SECTION_TYPES.CONTENT:c.indexOf("zw-notepane")!==-1&&(d=SECTION_TYPES.ENDNOTE),l=Offset.getClosest(r,a,d),s=l.image?l.image.index:l.content.index,"mousedown"===u||"touchstart"===u){EventHandler.mouseDown_coord.x=r,EventHandler.mouseDown_coord.y=a,EventHandler.mouseDown_coord.idx=s,EventHandler.mouseDown_coord.activeSection=editor.clientActiveSection;var R=l.content.line,O=R&&R.parent.getParaStyles(),b=O&&O[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1;s!==R.absEnd||b||(EventHandler.mouseDown_coord.isLineEnd=!0)}return s}},EventHandler.shouldDrawHandlers=function(e){isIPadSafariBrowser=e||!1},PubSub.subscribe("Document/ViewportChanged",function(e,t){try{var i=t.top,n=i+editor.editorPaneContainerHt,o=CurUtil.offset.start.top*editor.zoomFactor,r=editor.doc.getSelection().getLastRange(),a=r&&r.getStartPortionData().line,s=o+(a&&a.contentHeight||0);if(o>i&&s<n&&(e=DocLayoutManager.getPageAtPageNumber(editor.currentPageIndex+1)),J("#totalPage").text(J.i18n("common","OF")+" "+DocLayoutManager.getPageCount()),J("#bbar-pagenuminput").html(e.getAbsolutePageNumber()),DocTreeManager.doc.setOperationComplete(DOCUMENT_OPERATIONS.SCROLL),DocLayoutManager.isPageView()){var i=t.top,l=editor.editorPaneContainerOffset.top,d=editor.editorPaneContainer[0].scrollHeight,c=d/editor.editorPaneContainerHt,u=l+i/c,p=UIUtils.JscrollbarPageInfoFlag.find(".page-info-flag");p.text(J.i18n("common","PAGE")+" "+e.getAbsolutePageNumber()),UIUtils.JscrollbarPageInfoFlag.css({left:document.body.offsetWidth-UIUtils.JscrollbarPageInfoFlag.width()-30,top:u-10}).show(),clearTimeout(EventHandler.scrollBarTimer),EventHandler.scrollBarTimer=void 0,EventHandler.scrollBarTimer=setTimeout(function(){UIUtils.JscrollbarPageInfoFlag.fadeOut("slow")},100)}}catch(e){}}),HiddenMarkers=function(){var e,t,i=0,n=FontUtils.getFontString({ff:"Lato",size:"9pt"}),o=J.i18n("common","PAGE_BREAK"),r=J.i18n("common","COLUMN_BREAK"),a=!0,s="writer-glyphs-end-of-paragraph",l=function(){i=FontUtils.getCharSize("-",n).width,e=FontUtils.getCharSize(o,n).width,t=FontUtils.getCharSize(r,n).width,PubSub.subscribeOnce(["Document/Error","Document/readonlyview"],d),PubSub.subscribe(DOMVIEW.HRVIEW_AFTER_CREATE,R),PubSub.subscribe([DOMVIEW.LINE_UPDATED,DOMVIEW.LINE_ADDED],c)},d=function(){PubSub.unsubscribe(DOMVIEW.HRVIEW_AFTER_CREATE,R),PubSub.unsubscribe([DOMVIEW.LINE_UPDATED,DOMVIEW.LINE_ADDED],c)},c=function(e,t){var i=t.el;b(e,i),C(e,i),g(t),A(t),E(t)},u=function(e,t){v(t.el),y(t.el),f(t),S(t),T(t)},p=function(e,t){var n=[],o=(t/i).toFixed(0);o%2===1&&o--;for(var r=1;r<=o;r++)n.push("-"),r===o/2&&(n.push(" "),n.push(e),n.push(" "));return n.join("")},g=function(e){var t=e.getEOPPortion();t&&!t.classList.contains(s)&&t.classList.add(s)},f=function(e){var t=e.getEOPPortion();t&&t.classList.contains(s)&&t.classList.remove(s)},E=function(e){var t=e.getAllTextSpanPortions(),i=TEXT_ALIGN[e.nodeLine.align]==ALIGN.JUSTIFY;if(!i)for(var n=0;n<t.length;n++){for(var o=t[n].innerText,r=[],a=0;a<o.length;a++)r.push(Utils.encodeHTMLChars(o[a]));o=r.join("");for(var s=/\s|\u00A0/g,l=0,d=s.exec(o),c="";d;){var u=d.index;c+=o.substring(l,u)+"<span class='zw-space writer-glyphs-space' style='display:inline-block;'>&#8203;</span>",l=u+1,d=s.exec(o)}c+=o.substring(l),t[n].innerHTML=c}var p,g=J(e.el).find("span.zw-space"),f=g.length;p=i?e.nodeLine.renderedSpaceWidths:e.nodeLine.spaceWidths;for(var n=0;n<f;n++)i&&g[n].classList.add("writer-glyphs-space"),g[n].style.width=p[n]+"px"},T=function(e){for(var t=e.getAllTextSpanPortions(),i=TEXT_ALIGN[e.nodeLine.align]==ALIGN.JUSTIFY,n=0;n<t.length;n++){for(var o,r="",a=t[n],s=a.firstChild;s;)o=s.nextSibling,"#text"===s.nodeName?r+=s.textContent:"SPAN"===s.nodeName&&(s.classList.contains("writer-glyphs-space")||s.classList.contains("writer-glyphs-non-breaking-space"))&&(r+="&nbsp;",i?s.classList.remove("writer-glyphs-space","writer-glyphs-non-breaking-space"):s.remove()),s=o;if(!i){var l=[];r=r.replace(/&nbsp;/g," ");for(var d=0;d<r.length;d++)l.push(Utils.encodeHTMLChars(r[d]));a.innerHTML=l.join("").replace(/ /g,"&nbsp;")}}},m="Section Break (Continuous)",h="Section Break (Next Page)",I=isV8Engine?0:FontUtils.getCharSize(m,n).width,_=isV8Engine?0:FontUtils.getCharSize(h,n).width,A=function(e){var t=e.nodeLine,i=e.getEOPPortion(),n=t.getView().getSection();if(!i||n.getSectionType()!==SECTION_TYPES.CONTENT||!n.getDTView().next||n.getNode().getEndIndex()!==t.absEnd)return null;var o,r=t.remainingWidth,a=n.getDTView().next;a.getBreakType()===BREAK_TYPES.CONTINUOUS?(o=m,r-=I):(o=h,r-=_),r-=8;var s=p(o,r),l=document.createElement("span");l.innerHTML=s,l.style.background="none",l.style.fontSize="9pt",l.style.color="#4190f2",l.style.fontFamily="Lato",l.className="writer-glyphs-section-break",i.parentNode.insertBefore(l,i.nextSibling)},S=function(e){var t=e.el.querySelector(".writer-glyphs-section-break");t&&t.remove()},R=function(i){var n,a,s=DocLayoutManager.getViews(i)[0],l=s.getColumn().getWidth();s.isPageBreak()?(a=l-e,n=o):(a=l-t,n=r),a-=8;var d=p(n,a),c=DomViewManager.getDOMElem(s);s.isPageBreak()?J(c).css({background:"none","font-size":"9pt",color:"#4190f2","font-family":"Lato"}).html(d).show():s.isColumnBreak()&&J(c).css({background:"none","font-size":"9pt",color:"#4190f2","font-family":"Lato"}).html(d).show()},O=function(e,t){var i=t.el;(e.isPageBreak()||e.isColumnBreak())&&(i.innerText="",i.style.fontSize="0pt",i.style.removeProperty("color"),i.style.removeProperty("fontFamily"),i.style.removeProperty("background"),i.style.removeProperty("display"))},b=function(e,t){var i,n,o={},r=e.parent.getIndex(),a=0,s=e.tabs;i=document.createElement("div"),i.className="writer-glyphs-tab";for(var l=0;l<s.length;l++)if(n=s[l].index,t){o.left=DocLayoutManager.getLeftAtIndex(n+r)+editor.doc.getRawFormatAt(n+r).width/2-8+"px",o.position="absolute",o.width="12px",o.display="inline-block",o.bottom=e.contentHeight/2+"px";for(var d,c,u=e.segments,p=u.length;a<p;){if(u[a].start==n){c=u[a];break}a++}d=c&&c.format.size||e.parent.paraProperties.textFormat.size||e.parent.getParaStyles().textFormat.size,o.fontSize=d+"pt",J(i).css(o),t.appendChild(i.cloneNode(!0))}},v=function(e){for(var t=e.querySelectorAll(".writer-glyphs-tab"),i=0;i<t.length;i++)t[i].remove()},D=function(e){"string"==typeof e&&(e="true"===e),e&&editor.getRole().permissions.can("document.edit")?l():d()},L=function(){editor.doc.isHiddenMarkersEnabled=!editor.doc.isHiddenMarkersEnabled,D(editor.doc.isHiddenMarkersEnabled);var e,t=DomViewManager.getAllLineDOM();for(var i in t)e=t[i].nodeLine,e.id&&(editor.doc.isHiddenMarkersEnabled?c(t[i].nodeLine,t[i]):u(t[i].nodeLine,t[i]));var n=DomViewManager.getAllHrDOM();for(var i in n)editor.doc.isHiddenMarkersEnabled?R(n[i].getDocView().getNode()):O(n[i].getDocView(),n[i]);var o=DomViewManager.getAllPagesObj();for(var i in o){var r=o[i].docView,a=r.getHeader();DomViewManager.handleAfterHFSectionUpdate(a,r);var s=r.getFooter();DomViewManager.handleAfterHFSectionUpdate(s,r)}editor.doc.isHiddenMarkersEnabled?(ZWLogger.addToStatistics("Hidden_markers"),J("#fmt-lpnl-non-printing-char,#fmt-lpnl-sub-non-printing-char").zbutton("check"),J("#view-lpnl-pilcrow").zstatebutton("checked",!0)):(J("#fmt-lpnl-non-printing-char,#fmt-lpnl-sub-non-printing-char").zbutton("uncheck"),J("#view-lpnl-pilcrow").zstatebutton("checked",!1))},N=function(e,t){a=t.state;var i=W.get(".writer-glyphs-anchored-object");a?i.show():i.hide()},P=function(){return a},C=function(e,t){if(t){var i=t.querySelector(".zw-br-portion");if(i){var n;i.className+=" writer-glyphs-soft-return-line-break";for(var o=e.segments.length,r=o-1;r>=0&&(n=e.segments[r],"text"!=n.format.type);r--);var a=n&&n.format.size||e.parent.paraProperties.textFormat.size||e.parent.getParaStyles().textFormat.size;J(i).css({fontSize:a+"pt",display:"inline-block",width:"14px"})}}},y=function(e){var t=e.querySelector(".zw-br-portion");t&&(t.classList.remove("writer-glyphs-soft-return-line-break"),t.style.fontSize="0pt",t.style.removeProperty("display"),t.style.removeProperty("width"))},F=function(){return editor.doc.isHiddenMarkersEnabled},M=function(){PubSub.subscribe("Document/show_non_printing_char/changed",D)};return{init:M,toggleMarker:L,showOrHideObjectIndicator:N,isObjectIndicatorVisible:P,isEnabled:F,getBreakString:p}}(),Paragraph.TYPE_NORMAL=0,Paragraph.TYPE_LIST=1,ZWImg.ERROR_MSG_1="Invalid arguments",isV8Engine||(Image.ERROR_MSG_1="Invalid arguments"),ElementBuilder=function(){var e=Array.prototype.slice,t=function(t){function i(){}return i.prototype=t.prototype,function(){var n=e.call(arguments);return t.apply(new i,n)}},i=function(e){return e=e||{rows:2,cols:2,cellVals:void 0,dtNode:null},t(Table).call(null,e.rows,e.cols,e.cellAttrs,e.cellVals,e.dtNode)},n=function(e){return e=e||{cols:0,action:"",dtNode:null},t(Row).call(null,e.cols,e.dtNode,e.dtNode)},o=function(e){return t(bookmarkElement).call(null,NODE_TYPE.BOOKMARK,e.id,e.name)},r=function(e){return t(autofieldElement).call(null,NODE_TYPE.AUTOFIELD,e.id)},a=function(e){return t(placeholderElement).call(null,NODE_TYPE.PLACEHOLDER,e.id)},s=function(e){return t(FloatElement).call(null,NODE_TYPE.COMMENT,e.sectionId,e.parentId,e.cType,e.userName,e.time,e.userId,e.color,e.activity)},l=function(e){return function(i){return t(FloatElement).call(null,e,i)}},d={};d[NODE_TYPE.BODY]=t(Body),d[NODE_TYPE.PARAGRAPH]=t(Paragraph),d[NODE_TYPE.SECTION]=t(Section),d[NODE_TYPE.FOOTNOTE]=l(NODE_TYPE.FOOTNOTE),d[NODE_TYPE.ENDNOTE]=l(NODE_TYPE.ENDNOTE),d[NODE_TYPE.COMMENT]=s,d[NODE_TYPE.TABLE]=i,d[NODE_TYPE.ROW]=n,d[NODE_TYPE.CELL]=t(Cell),d[NODE_TYPE.TOC]=t(Toc);var c=function(){d[NODE_TYPE.TEXT]=t(Text),d[NODE_TYPE.BR]=t(BR),d[NODE_TYPE.IMAGE]=t(ZWImg),d[NODE_TYPE.CHART]=t(ZW_CHART),d[NODE_TYPE.IFRAME]=t(Iframe),d[NODE_TYPE.HR]=t(HR),d[NODE_TYPE.LINK]=t(LinkItem),d[NODE_TYPE.HEADER_PRIMARY]=l(NODE_TYPE.HEADER_PRIMARY),d[NODE_TYPE.FOOTER_PRIMARY]=l(NODE_TYPE.FOOTER_PRIMARY),d[NODE_TYPE.BOOKMARK]=o,d[NODE_TYPE.AUTOFIELD]=r,d[NODE_TYPE.PLACEHOLDER]=a},u=function(e,t){return d[e]||c(),d[e].call(null,t)};return{createElement:u}}(),DefaultAutoCorrects=function(){var e={},t=function(){if(jQuery.isEmptyObject(e)){var t,i;e.en={},e.en.days={},e.en.months={},e.gr={},e.gr.days={},e.gr.months={};var n=["m o n d a y","t u e s d a y","w e d n e s d a y","t h u r s d a y","f r i d a y","s a t u r d a y","s u n d a y"],o=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],r=[],a=[],s=["m o n t a g","d i e n s t a g","m i t t w o c h","d o n n e r s t a g","f r e i t a g","s a m s t a g","s o n n t a g"],l=["Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag","Sonntag"],d=["j a n u a r","f e b r u a r","m ä r z","a p r i l","m a i","j u n i","j u l i","a u g u s t","s e p t e m b e r","o k t o b e r","n o v e m b e r","d e z e m b e r"],c=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];for(t=0,i=n.length;t<i;t++)e.en.days[n[t]]=o[t];for(t=0,i=r.length;t<i;t++)e.en.months[r[t]]=a[t];for(t=0,i=s.length;t<i;t++)e.gr.days[s[t]]=l[t];for(t=0,i=d.length;t<i;t++)e.gr.months[d[t]]=c[t]}return e},i=function(){n(),o()},n=function(){if(editor.getRole().permissions.can("document.edit")&&"SHAREDREADCOMMENT"!==editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!=editor.doc.getRole()){var e=t(),i=DocLocaleHandler.getLanguage();if(!i)return;var n=[];0===i.indexOf("en")?(n=ZWJSONUtils.getKeys(e.en.days),n=n.concat(ZWJSONUtils.getKeys(e.en.months))):0===i.indexOf("de")&&(n=ZWJSONUtils.getKeys(e.gr.days),n=n.concat(ZWJSONUtils.getKeys(e.gr.months)));for(var o=0,r=n.length;o<r;o++)Mousetrap.unbind(n[o])}},o=function(){if(editor.getRole().permissions.can("document.edit")&&"SHAREDREADCOMMENT"!==editor.doc.getRole()&&"ANYONELINK_SHAREDREADCOMMENT"!==editor.doc.getRole()){var e,i,n,o,r,a=t(),s=DocLocaleHandler.getLanguage();if(!s)return;if(0===s.indexOf("en")){e="en",i=a[e].days;for(n in i)Mousetrap.bind(n,function(e,i){AutoCorrect.correctDayAndMonths(t().en.days[i])},"keypress");o=a[e].months;for(r in o)Mousetrap.bind(r,function(e,i){AutoCorrect.correctDayAndMonths(t().en.months[i])},"keypress")}else if(0===s.indexOf("de")){e="gr",i=a[e].days;for(n in i)Mousetrap.bind(n,function(e,i){AutoCorrect.correctDayAndMonths(t().gr.days[i])},"keypress");o=a[e].months;for(r in o)Mousetrap.bind(r,function(e,i){AutoCorrect.correctDayAndMonths(t().gr.months[i])},"keypress")}}};return PubSub.subscribe("Document/ComponentInitialized",o),PubSub.subscribe("Document/LanguageChanged",i),{getDefaultAutoCorrects:t}}(),Op.msgBuffer=[],Op.Id=0,Op.cursor=[],Op.isListItemSelection=!1,Op.isCtrlSelection=!1,Op.containCursor=!1,Op.lastOperationsArray=[],Op.processMsg=function(e){try{TCHandler.processMsg(e);var t=DocOpBuilder.build(e);Op.msgBuffer.push(t),Op.addLastOperation(editor.lastOperation)}catch(e){if("Error in TcBlock Deletion"==e){var i=new Error(ZWCollaboration.DELETE_TC_BLOCK_ERROR);throw editor.lastError=i,i}throw e}},Op.appendCursor=function(){var e=Op.msgBuffer.pop();if(e){var t=e.toJson().concat(Op.getCursor());Op.msgBuffer.push(DocOpBuilder.build(t)),Op.cursorProcessed()}},Op.cursorProcessed=function(){Op.containCursor=!0},Op.resetCursorPos=function(){Op.containCursor=!1,Op.cursor=[]},Op.resetBuffer=function(){ZWLogger.log("Reset Buffer"),Op.msgBuffer=[],Op.resetCursorPos()},Op.addLastOperation=function(e){e&&e.length&&Op.lastOperationsArray.push(e)},Op.resetLastOperations=function(){Op.lastOperationsArray=[]},Op.getLastOperationSequence=function(){var e,t,i=100,n="",o=Op.lastOperationsArray;for(e=o.length-1;e>=0;e--)if(t=o[e],n.length){if(!(n.length+t.length<=i))break;n=t+","+n}else n=t;return Op.resetLastOperations(),n},Op.sendMsg=function(){var e=Op.msgBuffer,t=e.length;if(0!=t){var i,n=new DocOpBuilder,o=null,r=editor.doc.getSelection();if(r&&!Op.containCursor){r.length>1&&!r.isListItemSelection&&!r.isMultipleSelection&&r.sortRanges();for(var a,s,l=[],d=0,c=r.length,u=0;d<c;d++)s=r.getRangeAt(d),a=Utils.randomString(),l.push({r:s.start-u},{as:{start:{type:"cursor",uuid:editor.uuid},id:a}},{r:s.end-s.start},{as:{end:["type","uuid"],id:a}}),u=s.end;o=o?DocOpBuilder.compose(o,DocOpBuilder.build(l)):DocOpBuilder.build(l)}try{var p=e[0];if(newComposedOps=DocOpBuilder.combineOps(e),p=newComposedOps,Op.containCursor){var g=p.getOpAndCursorPos();p=g.op,g.positions.length&&(Op.cursor=g.positions)}else if(o&&!Op.containCursor){var f=DocOpBuilder.xform(p,o),E=f.second.getCursorPos();E.length>0&&(Op.cursor=E)}i=p}catch(e){Op.resetBuffer(),ZWLogger.log("Exception in compose/concise: "+e.stack);var T="concise_error"===e||"compose_error"===e?ZWCollaboration.OP_PROCESSING_ERR:ZWCollaboration.OP_APPLYTO_ERROR,m=new Error(T);throw editor.lastError=m,m}TCHandler.hasOPs()&&(i=DocOpBuilder.compose(i,TCHandler.getBufferOPs()),TCHandler.convertMovedOpToNormalTcOp(i),TCHandler.resetBuffer());try{var h=i.isLock;if((h||editor.lastOperation==COMMAND.RE_PASTE||editor.lastOperation==COMMAND.IMAGE_STYLE_OP)&&editor.doc.snapShotManager.setSkipSnapShot(!0),n=i,editor.doc.getTrackChangeDetails().isNoMarkupON()&&!isV8Engine?n=TcNoMarkupHandler.processClientToServerOp(DocOpBuilder.clone(i)):HiddenRangesHandler.hasHiddenRangeOps()&&(n=HiddenRangesHandler.processClientToServerOp(DocOpBuilder.clone(i))),ZWLogger.recordAction(editor.lastOperation),ZWLogger.log("FINAL OPS"+i.toProtoString()+"  Operation is:::"+editor.lastOperation+" Op.msgBuffer.length :: "+Op.msgBuffer.length),i.applyTo(Op.createOpInfo(),o),(h||editor.lastOperation==COMMAND.RE_PASTE||editor.lastOperation==COMMAND.IMAGE_STYLE_OP)&&editor.doc.snapShotManager.setSkipSnapShot(!1),ZWLogger.log("Afetr Apply To"),i.docOpId=Op.Id++,ZWLogger.log("DOC OP IDS Increment"),editor.doc.getTrackChangeDetails().isEnabled()){var I=TCHandler.isSameUserTcStyleOpPresents(n);if(I){ZWLogger.log("GETTING SAME USER TC STYLE");var m=new Error(ZWCollaboration.OP_TC_ERROR);throw editor.lastError=m,m}}}catch(e){throw Op.logApplyToError(e,i,n),editor.lastError}Op.resetBuffer();try{ZWCollaboration.addToQueue(n),ZWLogger.log("OPS ADDED INTO QUEUE"),ZWCollaboration.sendPendingMutation()}catch(e){throw Op.resetBuffer(),ZWLogger.log("Exception when sending pending mutations: "+e.stack),editor.lastError=new Error(ZWCollaboration.OP_APPLYTO_ERROR),editor.lastError}Op.resetBuffer()}},Op.addLogForApplOpsError=function(e,t,i){for(var n=0,o=e.length;n<o;n++)ZWLogger.log(" clientOperations [ "+n+" ]"+e[n].toProtoString());ZWLogger.log(" OLD OP : "+t.toProtoString()),ZWLogger.log("NEW OP : "+i.toProtoString())},Op.logApplyToError=function(e,t,i){Op.resetBuffer(),ZWLogger.log("Exception in Apply To in OP SEND MSG"),ZWLogger.log("Final Operation: "+t.toProtoString()),ZWLogger.log("Final Operation -- op2send: "+i.toProtoString()),ZWLogger.log("Exception: "+e.stack,e.stack),"autofield"===editor.lastOperation&&ZWLogger.log("Exception while inserting autofield. Builder: "+t.toString());var n=e.message;n===ZWCollaboration.SET_CURSOR_ERROR||n===ZWCollaboration.SET_COLLAB_CURSOR_ERROR||n===ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR||n===ZWCollaboration.OP_TC_ERROR?editor.lastError=e:"error in document applyTo"==e?editor.lastError=new Error(ZWCollaboration.OP_IDX_IOB):"error in dom applyTo"===e?editor.lastError=new Error(ZWCollaboration.OP_APPLYTO_ERROR_DOM):"Error in TC"===e?editor.lastError=new Error(ZWCollaboration.OP_TC_ERROR):editor.lastError=new Error(ZWCollaboration.OP_APPLYTO_ERROR)},Op.createOpInfo=function(){var e={cursor:{},operation:editor.lastOperation};return e.cursor[editor.uuid]=Op.cursor,e},Op.isApplyOpisEnable=function(){return editorProps.userInfo.NG_APPLYOPS},Op.getCursor=function(e,t){var i=[];void 0==e&&(e=0),void 0==t&&(t=0),e&&i.push({r:e});var n=Utils.randomString();return i.concat([{as:{start:{type:"cursor",uuid:editor.uuid},id:n}},{r:t-e},{as:{end:["type","uuid"],id:n}}])},PubSub.subscribe("DocOperation/CommandComplete",function(){Op.isCtrlSelection=!1,Op.isListItemSelection=!1}),Utils.preference=function(e,t,i,n,o){var r=editor.doc.createElement(NODE_TYPE.TEXT,e);r.setStart(i),r.setEnd(n-(o?0:1));var a=editor.doc.createElement(NODE_TYPE.TEXT,t);a.setStart(i),a.setEnd(parseInt(i)+t.length),editor.doc.getSelection().replace(r,a),Op.sendMsg()},Utils.handleDashes=function(e,t,i){var n=/^[a-zA-Z0-9"“”']{1,}--[a-zA-Z0-9"“”'\s]{1,}$/,o=/^[a-zA-Z0-9]{1,} - [a-zA-Z0-9\s]{1,}$/,r=/^[a-zA-Z0-9"��']{1,} -- [a-zA-Z0-9"��'\s]{1,}$/,a="";t>5&&(a=editor.doc.getContent(t-5,i));var s=r.test(a);if("true"===(w_usersettings[ATTR_BODY.DS_AUTOEMDASH]||"").toString()&&(n.test(e)||s)){s&&(t-=5,e=a);var l=e.indexOf("--"),d=DocUtil.getTextStyle(l+t),c=editor.doc.getRawFormatAt(l+t)||{};if(c&&"OFF"==c[ATTR_TEXT.TS_AUTO_COREECT])return delete c[ATTR_TEXT.TS_AUTO_COREECT],delete d[ATTR_TEXT.TS_AUTO_COREECT],void editor.doc.setFormatAt(t,c);var u="—",p=(e.substr(0,l)+u+e.substr(l+2),editor.doc.createElement(NODE_TYPE.TEXT,"--"));p.setStart(t+l),p.setEnd(t+l+2);var g=editor.doc.createElement(NODE_TYPE.TEXT,u);g.setStart(t+l),g.setEnd(t+l+2),editor.doc.getSelection().replace(p,g),Op.sendMsg();var f=DocUtil.copyStyle(DocUtil.getTextStyle(t+l));f[ATTR_TEXT.TS_AUTO_COREECT]="ON",editor.doc.setFormatAt(t+l,f),f=DocUtil.copyStyle(DocUtil.getTextStyle(t+l+1)),delete f[ATTR_TEXT.TS_AUTO_COREECT],editor.doc.setFormatAt(l+t+1,f),editor.doc.setFormatAt(l+t+1,f)}else if("true"===(w_usersettings[ATTR_BODY.DS_AUTOENDASH]||"").toString()&&t>4&&(t-=4,e=editor.doc.getContent(t,i),o.test(e))){var u="–",l=e.indexOf("-"),d=DocUtil.getTextStyle(l+t),c=editor.doc.getRawFormatAt(l+t)||{};if(c&&"OFF"==c[ATTR_TEXT.TS_AUTO_COREECT])return delete c[ATTR_TEXT.TS_AUTO_COREECT],delete d[ATTR_TEXT.TS_AUTO_COREECT],void editor.doc.setFormatAt(t+l,c);var p=(e.substr(0,l)+u+e.substr(l+1),editor.doc.createElement(NODE_TYPE.TEXT," - "));p.setStart(t+l-1),p.setEnd(t+l+1);var g=editor.doc.createElement(NODE_TYPE.TEXT," "+u);g.setStart(t+l-1),g.setEnd(t+l);var E=DocUtil.copyStyle(d);E[ATTR_TEXT.TS_AUTO_COREECT]="ON",delete d[ATTR_TEXT.TS_AUTO_COREECT],editor.doc.getSelection().replace(p,g),Op.sendMsg(),editor.doc.setFormatAt(l+t,DocUtil.copyStyle(E)),editor.doc.setFormatAt(l+t+1,DocUtil.copyStyle(d))}},Utils.autoCapitalizeI=function(e,t,i){var n=DocLocaleHandler.getLanguage();if(n&&("en-US"===n||"en-GB"===n||"en_ZA"===n||"en-AU"===n||"en-NZ"===n||"en-CA"===n)){if(ZWCode.isCodePara())return;var o=editor.doc.createElement(NODE_TYPE.TEXT,e);o.setStart(t),o.setEnd(i);var r=editor.doc.getSelection().textFormat,a=editor.doc.getRawFormatAt(t)||{},s=/(^i'|^i,|^i $)/,l=/(^i;d $)/,d=e;if(s.test(e))d=e.charAt(0).toUpperCase()+e.slice(1);else{if(!l.test(e))return;d="I'd "}if(a&&"OFF"==a[ATTR_TEXT.TS_AUTO_COREECT])return delete a[ATTR_TEXT.TS_AUTO_COREECT],delete r[ATTR_TEXT.TS_AUTO_COREECT],void editor.doc.setFormatAt(t,a);var c=editor.doc.createElement(NODE_TYPE.TEXT,d);c.setStart(t),c.setEnd(t+d.length);var u=DocUtil.copyStyle(r);u[ATTR_TEXT.TS_AUTO_COREECT]="ON",delete r[ATTR_TEXT.TS_AUTO_COREECT],editor.doc.getSelection().replace(o,c),Op.sendMsg(),editor.doc.setFormatAt(t,u)}},Utils.afterSpaceOperations=function(e,t){var i,n,o,r,a,s,l;updatePrevWord=function(){i=editor.doc.getSelection().getPreviousWordWithoutSplChar(),n=i.getStart(),o=i.getEnd(),r=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),a=r.getStart(),s=r.getEnd(),l=editor.doc.getContent(n,o)},updatePrevWord();var d=w_usersettings[ATTR_BODY.DS_AUTOCORRECTS]||{};if(w_usersettings[ATTR_BODY.DS_PREF]&&1==w_usersettings[ATTR_BODY.DS_PREF]){var c=l.trim();if(d[c]&&1==d[c].tobeEnabled&&!CONST.DEFAULT_AUTO_CORRECTS.contains(c)){var u=d[c].value||null;u&&u!==c&&(Utils.preference(l,u,n,o,t),updatePrevWord(),ZWLogger.addToStatistics("AutoCorrectApplied"))}else if(n>1){var p=editor.doc.getContent(n-1,o);if(d[p]&&1==d[p].tobeEnabled&&!CONST.DEFAULT_AUTO_CORRECTS.contains(c)){var u=d[p].value||null;u&&u!==p&&(l=p,Utils.preference(l,u,n-1,o+1,t),updatePrevWord(),ZWLogger.addToStatistics("AutoCorrectApplied"))}}}if(w_usersettings[ATTR_BODY.DS_AUTOLINK]&&1==w_usersettings[ATTR_BODY.DS_AUTOLINK]&&l.length>5){var g=t?null:editor.doc.createElement(NODE_TYPE.TEXT,e);Utils.makeLink(l,g,t),updatePrevWord()}"1"==w_usersettings[ATTR_BODY.DS_AUTOCAPS]&&l.length>=1&&/[a-z]/.test(l.substring(0,1))&&Utils.firstLetterCaps(l,n,o),"1"==w_usersettings[ATTR_BODY.DS_AUTOLIST]&&!ListUtils.isList(r.attr("*"))&&l.length<=3&&s-a<=4&&Utils.makeList(l,r),1==w_usersettings[ATTR_BODY.DS_AUTOCORRECTCAPSLOCK]&&Utils.autoCorrectCapsLock(l,n,o),Utils.autoCapitalizeI(l,n,o),Utils.handleDashes(l,n,o)},Utils.autoCorrectCapsLock=function(e,t,i){var n=new RegExp(/^[A-Z]{2}[a-z]{1,}$/),o=n.test(e.trim()),r=editor.doc.getRawFormatAt(t+1),a=!(!r||"OFF"!=r[ATTR_TEXT.TS_AUTO_COREECT]);if(o&&!a&&!ZWCode.isCodePara()){r=DocUtil.getTextStyle(t);var s=editor.doc.createElement(NODE_TYPE.TEXT,e);s.setStart(t),s.setEnd(i);var l=e.substring(0,1).toUpperCase()+e.substring(1,e.length).toLowerCase(),d=editor.doc.createElement(NODE_TYPE.TEXT,l);d.setStart(t),d.setEnd(parseInt(t)+l.length);var c=DocUtil.copyStyle(r);c[ATTR_TEXT.TS_AUTO_COREECT]="ON",editor.doc.getSelection().replace(s,d),Op.sendMsg(),editor.doc.setFormatAt(t+1,c),editor.doc.setFormatAt(t+2,r)}},Utils.firstLetterCaps=function(e,t,i){var n=RegExp(CONT_REGEXP.PARASTART);if(!n.test(e)&&!ZWCode.isCodePara()){var o=n.test(editor.doc.getCharAt(t-1));if(" "==editor.doc.getCharAt(t-1)&&"."==editor.doc.getCharAt(t-2)&&"."!=editor.doc.getCharAt(t-3)||o){var r=e.substring(0,1),a=r.toUpperCase(),s=editor.doc.createElement(NODE_TYPE.TEXT,r);s.setStart(t),s.setEnd(t+1);var l=editor.doc.createElement(NODE_TYPE.TEXT,a);l.setStart(t),l.setEnd(t+1),editor.doc.getSelection().replace(s,l),Op.sendMsg()}}},Utils.showTop=function(){editor.editorPaneContainer.animate({scrollTop:"0px"},"slow");var e=editor.doc.getSelection();if(e&&(EditorUtil.focusMultiByteSpan(),e.isCollapsed())){var t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,1);editor.doc.getSelection().removeAllRanges().moveTo(t,!0),editor.clientActiveSection=J("div.zw-contentpane")[0]}},Utils.getBlockParent=function(e){return e&&"p td div".indexOf(e.nodeName.toLowerCase())!=-1?e:J(e).parents("p,td,div")[0]},Utils.getClosestSpan=function(e,t,i){var n=e.nodeName.toLowerCase(),o=e,r=J(e);if("span"==n)return e;if("img"==n||3==e.nodeType)return J(e).parents("span.zw-portion")[0];if(r.hasClass("zw-paragraph")||r.hasClass("zw-td")||r.hasClass("zw-cell-container"))o=e;else{var a=e.className;if(a&&a.indexOf("zw-line")!=-1)return Utils.getClosestChild(e,"span",t,i);var s,o=Utils.getClosestChild(e,"div.zw-paragraph",t,i),l=J(o).parents("table")[0];l&&(s=Utils.getClosestChild(l,"td",t,i),o=s)}return Utils.getClosestChild(o,"span",t,i)},Utils.removeHiddenNodes=function(e){for(var t=[],i=e.length,n=0;n<i;n++)J(e[n]).is(":hidden")||t.push(e[n]);return t},Utils.getClosestColumn=function(e,t){var i=function(e,t,i){return!!J(i).parentsUntil(e).hasClass("zw-textbox-div")},n=e.find("div.zw-column-container").not(i.bind(null,e)),o=DomViewManager.getDocView(e[0]),r=o.getColumnSpaceArray();if(n){for(var a,s,l,d=0,c=n.length;d<c&&(a=n.eq(d),s=a.offset().left,l=a.width()+(r[0]||"0in").convertor().pixels/2,!(s<=t&&t<=s+l||s>t));d++);return J(n[d]?n[d]:n.last()[0])}},Utils.getClosestSection=function(e,t,i){var n,o,r=DomViewManager.getAllPages(),a={x:e,y:t};return o=J(Utils.binarySearch(r,Utils.nodeCompare,a,i)),n=J(Utils.binarySearch(o.find("div.header_primary,div.footer_primary,div.zw-contentpane"),Utils.nodeCompare,a,i))},Utils.isElementInsideXY=function(e,t,i){var n=J(e).offset(),o=t>=n.top&&t<=n.top+e.offsetHeight,r=i>=n.left&&i<=n.left+e.offsetWidth;return i&&t?r&&o:i?r:t?o:void 0},Utils.getClosestTd=function(e,t,i){var n=e;n[0].className.indexOf("zw-table")===-1&&(n=e.find(".zw-table:visible"));var o=function(e,t,i){if(e)for(var n,o=e.length,r=0;r<o;r++){if(n=e[r],Utils.isElementInsideXY(n,t,i))return n;if(Utils.isElementInsideXY(n,t)&&!n.nextSibling)return n}},r=o(n,i);if(r)for(var a=[],s=r.querySelector(".zw-tr");s;){for(var l=s.querySelector(".zw-td");l;)a.push(l),l=l.nextSibling;s=s.nextSibling}return o(a,i,t)},Utils.getClosestChild=function(e,t,i,n,o){var r,a=o&&o.transformationData,s=o&&o.excludeNoteSection,l=J(e),d={x:i,y:n};r=e?e.className:"",l.parents("div.zw-column:first")[0]||l.parents("div.header_primary")[0]||l.parents("div.footer_primary")[0]||l.parents("div.zw-footnotecontainer")[0]||l.parents("div.zw-endnotecontainer")[0]||l.parents("div.float-image-container")[0]||t.indexOf("contentpane")===-1&&t.indexOf("header")===-1&&t.indexOf("footer")===-1&&t.indexOf("page")===-1&&(r.indexOf("contentpane")===-1&&r.indexOf("header")===-1&&r.indexOf("footer")===-1&&r.indexOf("page")===-1&&(l=Utils.getClosestSection(i,n,a)),l[0].className.indexOf("zw-contentpane")!==-1&&(l=Utils.getClosestColumn(l,i))),t=DomUtil.getTagWithClassName(t);var c=function(){var e=function(e,t,i){var n="";return s&&(n+="div.zw-endnotecontainer,div.zw-footnotecontainer"),!(!J(i).parentsUntil(e).hasClass("zw-textbox-div")&&!J(i).parentsUntil(e).is(n))},i=l.find(t+":visible").not(e.bind(null,l)),n=i.length;return t.indexOf("header_primary")===-1||DocLayoutManager.isPageView()||(i=Utils.removeHiddenNodes(i)),"span.zw-portion"===t&&0===n&&(i=l.find("span.EOP")),i},u=c();if(1===u.length)return u[0];var p=J(Utils.binarySearch(u,Utils.nodeCompare,d,a));if(0===p.length)return e;var g=J(p).parents("table.zw-table");if(g.length){var f=g.last();if(r=l[0]?l[0].className:"",r.indexOf("zw-column")!==-1||r.indexOf("header")!==-1||r.indexOf("footer")!==-1){var E=Utils.getClosestTd(J(f),i,n);for(l=E?J(E):l;J(E).find(".zw-table").length;)E=Utils.getClosestTd(J(E),i,n);l=E?J(E):l}if(u=c(),1===u.length)return u[0];if(p=J(Utils.binarySearch(u,Utils.nodeCompare,d,a)),0===p.length)return e}var T=p,m=p.offset(),h=m.left,I=p.height(),_=m.top,A=_+I,S=h<i,R=p[0].getBoundingClientRect(),O=R.right;if("span.zw-portion"==t&&(n=Math.round(R.top+.7*(R.bottom-R.top))),S)for(;p.length>0&&h<i&&O<i&&("span.zw-portion"==t||Math.round(_)<n&&n<=Math.round(A));){for(T=p,p=p.next(t);p.is(":hidden");)p=p.next(t);if(p[0]){R=p[0].getBoundingClientRect(),O=R.right;var I=p.height();m=p.offset(),h=m.left,_=m.top,A=_+I}}else for(;p.length>0&&h>i&&O>i&&("span.zw-portion"==t||Math.round(_)<n&&n<=Math.round(A));){for(T=p,p=p.prev(t);p.is(":hidden");)p=p.prev(t);if(p[0]){R=p[0].getBoundingClientRect(),O=R.right;var I=p.height();m=p.offset(),h=m.left,_=m.top,A=_+I}}return p.length>0&&p.offset().top<n&&p.offset().top+p.height()>n&&(T=p),T[0]},Utils.getCorrectedCoord=function(e){var t,i;return"number"==typeof e.pageX?(t=e.pageX,i=e.pageY):"number"==typeof e.clientX&&(t=e.clientX,i=e.clientY,document.body&&(document.body.scrollLeft||document.body.scrollTop)?(t+=document.body.scrollLeft,i+=document.body.scrollTop):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(t+=document.documentElement.scrollLeft,i+=document.documentElement.scrollTop)),{x:t,y:i}},Utils.nodeCompare=function(e,t,i){var n=J(e),o=t.y;if(i){var r=i.center,a=i.angle;o=TransformationUtils.rotate(t,a,r).y}var s=n.height()*editor.zoomFactor,l="";0==s&&(l=n.html(),n.html("&#8203;"));var d=n.offset().top;if(i){var r=i.center,a=i.angle;d=TransformationUtils.rotateElement(e,a,editor.zoomFactor,r).y}var c=d<=o&&o<s+d,u=c?0:d<o?-1:1;return 0==s&&n.html(l),u},Utils.containsOffsetY=function(e,t){var i=J(e),n=i.offset().top,o=i.height();return n<=t&&t<o+n},Utils.makeList=function(e,t){var i=/^(\d|a|A|i|I)+(\.)+\s/,n=/^(\[\]|\*)\s/,o=ListUtils.getDefaultListType(),r={1:LIST_TYPE.DECIMAL,a:LIST_TYPE.LOWER_ALPHA,A:LIST_TYPE.UPPER_ALPHA,i:LIST_TYPE.LOWER_ROMAN,I:LIST_TYPE.UPPER_ROMAN,"*":o&&o.unordered?o.unordered.ListType:LIST_TYPE.DISC,"[]":LIST_TYPE.CHECKLIST};if(i.test(e)||n.test(e)){var a=i.test(e)?i.exec(e):n.exec(e),s=/^\d+$/.test(a[1])?r[1]:r[a[1]],l=s==LIST_TYPE.DECIMAL&&"1"!=a[1]?a[1]:void 0,d=editor.doc.getRawFormatAt(t.getEnd()-1),c=!(!d||"ON"!=d[ATTR_TEXT.TS_AUTO_COREECT]);if(c)d[ATTR_TEXT.TS_AUTO_COREECT]="OFF",editor.doc.setFormatAt(t.getEnd(),d);else{var u=editor.doc.createElement(NODE_TYPE.TEXT);u.setStart(t.getStart()),u.setEnd(t.getEnd()-1);var p=editor.doc.createElement(NODE_TYPE.TEXT,"");p.setStart(t.getStart()+1),p.setEnd(t.getEnd());var g={};ListUtils.fillListProps(g,{t:s,l:0,id:editor.doc.getNewListId()});editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH);s==LIST_TYPE.CHECKLIST?PubSub.publish("CheckListOperations/makeCheckList",1):void 0==l?ListOperation.manageListOption([3,s]):ListOperation.manageListOption([3,s,void 0,l]),editor.doc.getSelection().replace(u,p),Op.sendMsg();var f=DocUtil.copyStyle(editor.doc.getRawFormatAt(t.getStart()));f[ATTR_TEXT.TS_AUTO_COREECT]="ON",editor.doc.setFormatAt(t.getStart(),f)}}},Utils.makeLink=function(e,t,i){var n=/^http(s)?:\/\/.*\..*/i,o=/^www\..*\..*/i,r=e.trim(),a=r;if(n.test(r)||o.test(r)){o.test(r)&&(a=editor.scheme+"://"+r);var s={url:a,target:"_blank",type:LINK_TYPES.WEBURL},l=editor.doc.getSelection().getStart(),d=e.length,c=editor.doc.getSelection().getLastRange();c&&c.setStart(l-d)&&c.setEnd(l-(i?0:1)),editor.doc.execCmd("CreateLink",s),t&&Command.exec("InsertChar",{cmd:"insert",element:t})}},Utils.repSplChar=function(e){return e=e.replace(/[()<#?%&>\"\'\/]/gi,"-")},Utils.replaceText=function(e,t,i){if(0!=e.length)for(var n,o=editor.doc.getSelection(),r=editor.doc.getNodesInSelection(NODE_TYPE.TEXT,t,i),a=0;n=r[a++];){for(var s=n.nodeValue,l=n.getStart(),d=n.getEnd(),c="",u=0;u<e.length;u++){var p=e[u];p-=l,c=s.substring(0,p)+s.charAt(p).toUpperCase()+s.substring(p+1,d).toLowerCase(),s=c}if(c.length>0){var g=editor.doc.createElement(NODE_TYPE.TEXT,c);g.setStart(l),g.setEnd(d),o.replace(n,g,!0),Op.sendMsg()}}},Utils.getMouseLogs=function(){var e="",t=EventHandler.mouseDown_coord.srcElem,i="",n="",o="",r="",a="",s="";t&&(i=t.className,n=t.id);var l=EventHandler.mouseDown_coord.portion;l&&(o=l.id,r=l.className);var d=EventHandler.mouseDown_coord.srcElem.parentNode;return d&&(a=d.id,s=d.className),e+=EventHandler.mouseDown_coord.x+" : "+EventHandler.mouseDown_coord.y+" : "+i+" : "+n+" : "+s+" : "+a+" : "+r+" : "+o},Utils.addMouseLogs=function(e){var t=EventHandler.mouseLogs.length;t>100&&(EventHandler.mouseLogs=EventHandler.mouseLogs.slice(t/2,t)),e=editor.editorPaneContainer[0].scrollTop+" : "+e+"\n",EventHandler.mouseLogs.push(e)},Utils.renamedocument=function(e,t){var i={};i.operations=JSON.stringify({name:e}),ZWNetworkUtils.setCsrfParam(i),J.ajax({type:"POST",url:ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/meta"),data:i,dataType:"json",global:!1,error:function(e){UIUtils.showMessage("error",J.i18n("rename","RENAME_FAILED_MSG"),"","normalfont",5e3),t()},success:function(e){var i=editor.doc.docInfo;UIUtils.showMessage("info",J.i18n("rename","RENAME_SUCCESS_MSG"),"showclose","normalfont",5e3),hipurl=void 0,1==i.VERSION&&0==i.REVISION&&(ZWCollaboration.sendMessage(ZWCollaboration.handleRenameSaveSuccess,ZWCollaboration.handleSendMutationError),PubSub.publish("Document/Renamed",e.name)),t()}})},Utils.moveToBookmark=function(e,t,i){if(e){var n;n=t||i?DocUtil.getFloatElementIdx(null,e):DocUtil.getFloatElementIdx(e,null);var o=!1;if(editor.doc.getRole()!=USER_ROLE.PUBLIC&&!editorProps.isPreviewMode)for(var r=editor.doc.getElement("bookmark"),a=0,s=r.length;a<s;a++)r[a].name===e&&r[a].id.indexOf("toc")!==-1&&(o=!0);if(n>0)if(editor.getRole().permissions.can("document.edit")){var l=DocLayoutManager.getLineAtIndex(n);if(!l)return;var d=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),c=DocTreeManager.doc.getSection(editor.doc.getSelection().getStart()),u=editor.doc.getSelection(),p=editor.doc.createRange(n);u.removeAllRanges().addRange(p);var g=n>=c.start&&n<=c.end,f=null!=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,n);if(DomUtil.scrollElementIntoView(d[0],500,!0),CurUtil.scrollTop=editor.editorPaneContainer[0].scrollTop,editor.editorOffset=editor.jeditorPane.offset(),f){var E=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,n),T=E.getRangeIndex(),m=editor.doc.getRawFormatAt(T);TextBoxHandler.selectTextBox(T),TextBoxHandler.handleCursorInsideTextBox(m.id)}t||o||DomUtil.updateMarkingDiv(),g||EventHandler.toggleSection(),CurUtil.blinkCursor()}else{var h=editor.doc.getPortionData(n),E=h.node;if(!E&&editor.doc.getRole()!=USER_ROLE.PUBLIC){var I=DocLayoutManager.getPageAtIndex(n);DomViewManager.forceToRender(I),h=editor.doc.getPortionData(n),E=h.node}DomUtil.scrollElementIntoView(E.parentNode,500,!0)}else t?PubSub.publish("Document/Warning",WARNING_MSG.HEADING_REMOVED):PubSub.publish("Document/Warning",WARNING_MSG.BOOKMARK_REMOVED)}},Utils.removeUnWantedUnicodes=function(e,t){var i="";for(var n in UNICODE)if("MULTIBYTE_SPACE"!=n&&"SPACE"!=n){if(i=UNICODE[n],t&&t.contains(i))continue;e=e.replace(new RegExp(i,"gi"),"")}return e=e.replace(/\u2028|\u2029/gi,"")},Utils.getChildNodes=function(e,t){for(var i,n=J(e).find(t),o=[],r=0;i=n[r++];)J(i).parents(e.nodeName.toLowerCase())[0]==e&&o.push(i);return o},Utils.contextMenuSupportedBrowser=function(){var e=editor.browserInfo,t=e.browserVersion_short;return e.is_chrome&&t>=43||e.is_edge&&t>=12||e.is_firefox&&t>=41||e.is_opera&&t>=30||e.is_macApp&&!e.is_safari},Utils.fetchDocName=function(e){var t={rid:editor.doc.docInfo.RID,sid:editor.uuid};e&&(t.renamed=!0),ZWNetworkUtils.setCsrfParam(t),J.ajax({async:!1,type:"POST",url:ZWNetworkUtils.getUrl("getdocname"),data:t,dataType:"json",global:!1,error:function(e){PubSub.publish("Document/RenameFailed")},success:function(e){e&&"SUCCESS"==e.RESPONSE?PubSub.publish("Document/Renamed",e.DOCUMENT_NAME):"FAILED"==e.RESPONSE&&PubSub.publish("Document/RenameFailed")}})},Utils.convertSVGToImg=function(e){return e.find("image.zw-image").each(function(){var e=document.createElement("img");e.setAttribute("src",this.getAttribute("xlink:href"));var t=J(this).parent().parent(),i=J(this),n={};n.opacity=i.css("opacity"),n.width=this.width.animVal.value,n.height=this.height.animVal.value,n.margin=i.parent().css("margin"),n.align=i.css("align"),J(e).css(n),e.setAttribute("linkdata",this.getAttribute("linkdata")),t.parent().css("overflow","hidden"),J(e).addClass("zw-image"),J(this).parent().parent().parent().append(e);var o={};o.border=t.css("border"),o.top=t.parent().css("top"),o.left=t.parent().css("left"),o.margin=t.css("margin"),o.width=t.css("width"),o.height=t.css("height"),J(e).parent().css(o),J(this).parent().parent().remove()}),e},Utils.showLink=function(e,t,i){Z("bookmark-popup").css({top:t,left:i}).show(),Z("bookmarklink-text").val(e).select()},Utils.getCursorSectionName=function(){var e=editor.doc.getSelection().getTargetRange().start,t=DocLayoutManager.getPageAtIndex(e),i=t.getGroup().getHFType();i||(doc_hf_type=0);var n="PRIMARY",o=t.getRelativePageNumber();return 1!=o||i!=HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE&&i!=HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE?o%2!=0||i!=HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE&&i!=HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE||(n="EVEN"):n="FIRST",n},Utils.getSectionByHfType=function(e,t){t||(t=Utils.getCursorSectionName());for(var i=CONST[e+"_"+t],n=editor.doc.getSelection().getTargetRange().start,o=DocLayoutManager.getPageAtIndex(n),r=o.getGroup(),a=DocTreeManager.doc.getAllSections(),s=a.length,n=0;n<s;n++){var l=a[n],d=DocLayoutManager.getSectionViews(l.getId())[0],c=editor.doc.getRawFormatAt(l.start);if(c.hasOwnProperty("hftype")&&c.hftype==i&&d&&r.doesDocSectionExist(d))return l}return null},Utils.showDebugger=function(){if(window.Debugger)Debugger.enable();else{var e={callback:function(){Debugger.enable(),ZWDebugger.on()},src:jsCdnZWStaticPath+fingerPrintObj["js/zwdebugger.js"],async:"async",id:"symbolJson"};loadJS(e)}},Utils.startMobileDebugging=function(){ZWJsThreadExecutor.init("/writer/js/writer_mobile_min_all.js");var e=JSON.stringify(editorProps),t=JSON.stringify(docProps),i={editorProps:e,docProps:t,csrf:getcsrf()};ZWJsThreadExecutor.execFn("initEditorFromMobile",i),PubSub.subscribe("WMS/Message",function(){ZWJsThreadExecutor.execFn("handleWMSFromDebug",arguments)})},Utils.getValueFromResult=function(e,t){var i;if(e.getFillableFieldType()!==FILLABLEFIELD_TYPE.SELECTBOX&&"string"!=typeof t)return null;switch(i=e.getFillableFieldType()){case FILLABLEFIELD_TYPE.EMAIL:return FILLABLEFIELD_REGEX[i].test(t)?null:t;case FILLABLEFIELD_TYPE.DATE:return new ZWDateTime(t,e.getFormat(),e.getLocale()).getOriginalUTC();case FILLABLEFIELD_TYPE.PERCENT:i=FILLABLEFIELD_TYPE.NUMBER;case FILLABLEFIELD_TYPE.SINGLELINE:case FILLABLEFIELD_TYPE.NUMBER:case FILLABLEFIELD_TYPE.CURRENCY:case FILLABLEFIELD_TYPE.PHONE:return t.replaceAll(FILLABLEFIELD_REGEX[i],"");case FILLABLEFIELD_TYPE.SELECTBOX:return"number"!=typeof t?null:t;case FILLABLEFIELD_TYPE.CHECKBOX:return!!t}},Utils.isLocaleSupportedFormat=function(e,t){var i=!1;return t.some(function(t){if(t.format==e)return i=!0}),i},Utils.getCurrencyCodeOfLocale=function(e){return DocLocaleHandler&&DocLocaleHandler.getCurrencyCode(e)},Utils.getLocaleOfCurrencyCode=function(e){var t;return DocLocaleHandler.getSupportedLanguages().some(function(i){if(i.currencyCode==e)return t=i.code}),t};var ChangeCaseRegex={sentenceCase:/(^[\u000e\u000f\u0010\u0011\u0012\u000b\u001c\u0013\t\s\«]*)|((\.\s)[\u000e\u000f\u0010\u0011\u0012\u000b\u001c\u0013\t\s\«]*)/g,capitalizeWord:/(^[\u000e\u000f\u0010\u0011\u0012\u000b\u001c\u0013\t\s\«]*)|((\.|\s)[\u000e\u000f\u0010\u0011\u0012\u000b\u001c\u0013\t\s\«]*)/g};Utils.changeCase=function(e,t,i){for(var n=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH),o=0,r=n.length;o<r;o++){for(var a=n[o],s=a.getStart(),l=a.getEnd(),d=a.text(!0),c=Utils.getReplacedIndex(e,d),u=0;u<c.length;u++)if(c[u]=c[u]+s,c[u]<t)c.splice(u,1),u--;else if(c[u]>=i||c[u]>=l){c.splice(u);break}Utils.replaceText(c,s,l)}},Utils.getReplacedIndex=function(e,t){var i=t,n=ChangeCaseRegex[e],o=0,r="",a=[],s=[],l=0;if(i.length>0){a=i.match(n);for(var d=0;d<a.length;d++)r=a[d],l=i.indexOf(r),o+=l+r.length,i=i.substring(l+r.length),s.push(o)}return s},Utils.changeCaseInPlainText=function(e,t){if("upper"==e)return t.toUpperCase();if("lower"==e)return t.toLowerCase();for(var i=t,n=Utils.getReplacedIndex(e,t),o=0,r=n.length;o<r;o++){var a=n[o];i=i.substring(0,a)+i.charAt(a).toUpperCase()+i.substring(a+1).toLowerCase()}return i},Utils.isWebImage=function(e){var t=/(ht|f)(tp|tps):\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s\/]{2,}|www\.[^\s]+\.[^\s\/]{2,}/;return e.match(t)},Utils.initializeZWJSThread=function(){var e=ZWJsThreadExecutor.init(jsCdnZWStaticPath+fingerPrintObj["js/writer_worker_min_all.js"],!0);e.done(function(){PubSub.publish("Document/CommonWorkerFileLoaded")}).fail(function(e){var t=e&&e.code||ZWCollaboration.COMMON_WORKER_ERROR,i=e&&e.message||"Common worker file not loaded";ReviewUtil.sendErrorMail(t,i)})},PubSub.subscribe("Document/ComponentInitialized",Utils.initializeZWJSThread),Utils.getDigisignData=function(e){var t={},i=e.getValue(),n=e.getSignFieldType();return t.sfType=n,t.mandatory=e.isMandatory(),t.recipient=e.getRecipient(),t.name=e.name,n==SIGNERFIELD_TYPE.CUSTOMDATE?t.dateFormat=i?i.split('"')[1]:"dd MMM yyyy":n==SIGNERFIELD_TYPE.DROPDOWN?t.dropdownOptions=i?i.split('"')[1]:"Option1":n==SIGNERFIELD_TYPE.RADIO&&(t.fieldValue=i?i.split("(")[1].split(")")[0]:ZOHOSIGN_TAG[n]),t},Utils.highlightFillableFieldsOnClick=function(){var e=function(e){var t=editor.getDocument(),n=editor.getDocument().getSelection().getRangeAt(0);if(n){var o=n.getStartNode(),r=o.type===NODE_TYPE.FIELD_START&&o.getField();if(r&&r.type===NODE_TYPE.FILLABLEFIELD&&(r.getFillableFieldType()===FILLABLEFIELD_TYPE.RADIO||r.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTIPLECHOICE)){var a,s=r.getFillableFieldType(),l=r.getName();t.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(t){t&&t.getFillableFieldType()===s&&t[ATTR_FILLABLEFIELD.FF_NAME]===l&&(a=document.querySelector('span[data-field-id = "'+t.getId()+'"]'),a&&("add"==e?a.classList.add(i.FIELD_SELECTED):a.classList.remove(i.FIELD_SELECTED)))})}}},t=function(e){for(var t=this;t&&t.classList.contains(i.FILLABLE_FIELD);){var n=t.closest(".zw-line-div");if("add"==e?t.classList.add(i.FIELD_SELECTED):t.classList.remove(i.FIELD_SELECTED),t=t.previousSibling?t.previousSibling:n&&n.previousSibling&&n.previousSibling.querySelector(".fillablefield:last-child"),W(t).find("div.fgImgOuterDiv").length)break}for(var o=this;o&&o.classList.contains(i.FILLABLE_FIELD);){var n=o.closest(".zw-line-div");if("add"==e?o.classList.add(i.FIELD_SELECTED):o.classList.remove(i.FIELD_SELECTED),o=o.nextSibling?o.nextSibling:n&&n.nextSibling&&n.nextSibling.querySelector(i.FILLABLE_FIELD),W(o).find("div.fgImgOuterDiv").length)break}},i={FIELD_SELECTED:"ffield-selected",FILLABLE_FIELD:"fillablefield"};return function(){J(document).on("click","span.fillablefield",function(){this.classList.contains("ffield-disabled")||editor.isOfflineMode||editor.isFinalDocument()||(t.call(this,"add"),e.call(null,"add"))}).on("dblclick","span.fillablefield",function(){t.call(this,"remove")})}}(),Utils.openEsignDialog=function(){var e={js:[jsCdnZWStaticPath+fingerPrintObj["js/writer_esign_min_all.js"]]},t=function(e){EsignController.handleEsignModuleLoaderConfigurations(),EsignController.handleEsignSelection(e)};return function(i){zw.require(e,[],t.bind(null,i))}}(),Utils.convertBase64ToArrayBuffer=function(e){for(var t=window.atob(e),i=t.length,n=new Uint8Array(i),o=0;o<i;o++)n[o]=t.charCodeAt(o);return n};var MsgQueueMixins=function(e){var t=function(t){var i,n,o,r={pendingEdits:[],ackPendingEdit:null};for(t.ackPendingEdit&&(r.ackPendingEdit={mc:t.ackPendingEdit.mc,sid:t.ackPendingEdit.sid,op:e.build(JSON.parse(t.ackPendingEdit.op))}),i=0,n=t.pendingEdits.length;i<n;i++)o=t.pendingEdits[i],r.pendingEdits.push({mc:o.mc,sid:o.sid,op:e.build(JSON.parse(o.op))});return r},i=function(){return JSON.stringify(this.getStringifiedQueue())},n=function(){var e={ackPendingEdit:null,pendingEdits:[]};this.ackPendingEdit&&(e.ackPendingEdit={sid:this.ackPendingEdit.sid,mc:this.ackPendingEdit.mc,op:this.ackPendingEdit.op.toProtoString()});var t,i,n;for(t=0,i=this.pendingEdits.length;t<i;t++)n=this.pendingEdits[t],e.pendingEdits.push({sid:n.sid,mc:n.mc,op:n.op.toProtoString()});return JSON.stringify(e)},o=function(){var e={ackPendingEdit:null,pendingEdits:[]};this.ackPendingEdit&&(e.ackPendingEdit={sid:this.ackPendingEdit.sid,mc:this.ackPendingEdit.mc,op:this.ackPendingEdit.op.toString()});var t,i,n;for(t=0,i=this.pendingEdits.length;t<i;t++)n=this.pendingEdits[t],e.pendingEdits.push({sid:n.sid,mc:n.mc,op:n.op.toString()});return e},r=function(t){var i,n;n=this.ackPendingEdit&&this.ackPendingEdit.op,n&&(i=e.xform(t,n),this.ackPendingEdit.op=e.concise(i.second),t=e.concise(i.first));for(var o=0,r=this.pendingEdits.length;o<r;o++)try{n=this.pendingEdits[o].op,n&&(i=e.xform(t,n),this.pendingEdits[o].op=e.concise(i.second),t=e.concise(i.first))}catch(e){throw e}return t},a=function(e){var t=e;return t=e.isLock?this.xformLockOps(e):this.xformOps(e)},s=function(t){var i,n;t=e.concise(t),i=this.ackPendingEdit&&this.ackPendingEdit.op,i&&(n=e.xform(i,t),this.ackPendingEdit.op=e.concise(n.first),t=e.concise(n.second));for(var o=0,r=this.pendingEdits.length;o<r;o++)i=this.pendingEdits[o].op,i&&(n=e.xform(i,t),this.pendingEdits[o].op=e.concise(n.first),t=e.concise(n.second));return t};return function(){this.parseStringifiedQueue=t,this.toString=i,this.toProtoString=n,this.getStringifiedQueue=o,this.xformOps=s,this.xformLockOps=r,this.xform=a}}(DocOpBuilder),MsgQueue=function(e,t,i){"use strict";function n(e){this.editor=e,this.ackPendingEdit=null,this.pendingEdits=[],o.call(this),this.empty(),t.subscribe("NetworkState/Changed",o.bind(this))}var o=function(){var e=!this.editor.isOffline();this.setComposeState(e)};return n.prototype.setComposeState=function(e){this.shouldComposeOp=e},n.prototype.add=function(i){var n=e.clone(i),o=i.docOpId,r=[];if(n){var a,s=this.pendingEdits.length,l=Utils.WriterCallbacks.reduce("getOpMeta",function(e,t){return extend(e,t)},{}),d=l.commentIds||[];if(s>0&&this.shouldComposeOp){a=s-1;var c=this.pendingEdits[a],u=c.op;d.unshift.apply(d,c.commentIds),n=e.compose(u,n),n=e.concise(n);try{r=u.docOpIds?u.docOpIds:[],r.push(o)}catch(e){}}else a=s,r.push(o);n.docOpIds=r,this.pendingEdits[a]={op:n,mc:this.editor.getCursorOp?this.editor.getCursorOp():'[{"si":1,"ei":1}]',sid:this.editor.uuid,commentIds:d},t.publish("MessageQueue/EditAdded")}},n.prototype.getAckPendingEdit=function(){return this.ackPendingEdit},n.prototype.getPendingToPushEdit=function(){return this.pendingEdits},n.prototype.isAckPending=function(){return null!=this.ackPendingEdit},n.prototype.isOpQueued=function(){return this.pendingEdits.length>0},n.prototype.ackReceived=function(){var e=this.ackPendingEdit;this.ackPendingEdit=null,t.publish("MessageQueue/AckReceived",e)},n.prototype.msgQueueInitialize=function(e){e=this.parseStringifiedQueue(e),this.ackPendingEdit=e.ackPendingEdit,this.pendingEdits=e.pendingEdits,!this.isAckPending()&&this.isOpQueued()&&this.shift(),o.call(this)},n.prototype.shift=function(){var e=this.pendingEdits.shift();e&&(this.ackPendingEdit=e,t.publish("MessageQueue/AckEditSent"))},n.prototype.xformQueue=function(e){var i=this.xform(e);return t.publish("MessageQueue/EditsTransformed"),i},n.prototype.isEmpty=function(){return!this.isAckPending()&&!this.isOpQueued()},n.prototype.empty=function(){this.pendingEdits=[],this.ackPendingEdit=null,t.publish("MessageQueue/Emptied")},n.prototype.getPendingEditsCount=function(){return this.pendingEdits.length},i.call(n.prototype),n}(DocOpBuilder,PubSub,MsgQueueMixins);Toc=function(e,t,i,n,o,r){var a=!1,s={},l={},d={styles:{h1:{fs:12,ml:"0in"},h2:{fs:11,ml:"0.17in"},h3:{fw:"normal",fs:10,ml:"0.33in"},h4:{fw:"normal",fs:10,ml:"0.49in"},h5:{fw:"normal",fs:10,ml:"0.65in"},h6:{fw:"normal",fs:11,ml:"0.81in"}},theme:"classic",leader:1},c={styles:{h1:{fw:"bold",tt:"uppercase",fs:12,ml:"0in"},h2:{tt:"uppercase",fs:11,ml:"0.17in"},h3:{fst:"italic",fs:11,ml:"0.33in"},h4:{fw:"normal",fs:9,ml:"0.49in"},h5:{fw:"normal",fs:9,ml:"0.65in"},h6:{fw:"normal",fs:9,ml:"0.81in"}},theme:"formal",leader:1},u={styles:{h1:{fw:"normal",fs:11},h2:{fw:"normal",fs:11},h3:{fst:"italic",fs:10,ml:"0.17in"},h4:{fw:"normal",fs:10,ml:"0.33in"},h5:{fw:"normal",fs:10,ml:"0.49in"},h6:{fw:"normal",fs:10,ml:"0.65in"}},theme:"modern",leader:1},p={styles:{h1:{fw:"normal",fs:"11"},h2:{fw:"normal",ml:"0.17in",fs:"11"},h3:{fs:11,ml:"0.33in"},h4:{fw:"normal",ml:"0.49in",fs:10},h5:{fw:"normal",ml:"0.65in",fs:10},h6:{fw:"normal",ml:"0.81in",fs:10}},theme:"simple",leader:0},g={styles:{h1:{fw:"normal",tt:"uppercase"},h2:{fw:"normal",tt:"uppercase"},h3:{fw:"normal",tt:"uppercase",fs:11},h4:{fw:"normal",tt:"uppercase",fs:"11"},h5:{fw:"normal",tt:"uppercase",fs:"11"},h6:{fw:"normal",tt:"uppercase",fs:"11"}},theme:"contemporary",leader:0},f={};f[o.TYPE]=r.PARAGRAPH,f[e.PS_LS]=1.2,f[e.PS_SB]="12pt",f[e.PS_SA]="12pt";var E={};E[o.TYPE]=r.TEXT,E[t.TS_SIZE]=14,E[t.TS_FW]="bold",E[t.TS_FGC]="rgb(96,96,96)";var T=function(i){var n,o,n=i[ATTR_TOC.leader],r=i.styles,a=i[ATTR_TOC.theme];for(o in r)void 0!=r[o].fw&&(l[a][o].textFormat[t.TS_FW]=r[o].fw),void 0!=r[o].tt&&(l[a][o].textFormat[t.TS_TT]=r[o].tt),void 0!=r[o].fs&&(l[a][o].textFormat[t.TS_SIZE]=r[o].fs),void 0!=r[o].ml&&(l[a][o].paraFormat[e.PS_ML]=r[o].ml),void 0!=r[o].fst&&(l[a][o].textFormat[t.TS_FS]=r[o].fst),l[a][o].paraFormat[e.PS_TPS]=[{id:0,point:"0in",align:2,leader:n}]},m={classic:d,formal:c,contemporary:g,simple:p,modern:u};(function(){var e,t,i,n=0;for(e=["classic","contemporary","formal","modern","simple"],n=0,t=e.length;n<t;n++)for(i=e[n],l[i]={},j=1;j<=6;j++)l[i]["h"+j]={},l[i]["h"+j].textFormat={type:"text"},l[i]["h"+j].paraFormat={type:"paragraph"};for(key in m)T(m[key])})();l.contemporary.h1.paraFormat[o.BORDERS]={},l.contemporary.h1.paraFormat[o.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={},l.contemporary.h1.paraFormat[o.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.TYPE]="solid",l.contemporary.h1.paraFormat[o.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.WIDTH]="1px",l.contemporary.h1.paraFormat[o.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.COLOR]="rgb(0,0,0)",l.contemporary.h1.paraFormat[e.PS_LS]=1,l.modern.h1.textFormat[t.TS_FGC]="rgb(0, 176, 240)",l.contemporary.h2.paraFormat[e.PS_SB]="12pt";var h=function(){var e=0;if(e=editor.doc.findNextIndexOf(n.TOCSTART,0),s={theme:"classic",level:3,leader:1,showNo:!0,al_right:!0},e<0){var t=editor.doc.getSelection().getParents(r.PARAGRAPH);e=t.getStart(),a=!1}else{a=!0,e=e;var o=editor.doc.getRawFormatAt(e),l=DocTreeManager.getTreeNodeAtIndex(e),d=v(l).tocParas,c=d[0],u=c?c.getParaStyles().tps:null;u=u&&u.length?u[u.length-1]:null;var p=!(!u||2!=u.align);void 0!==o.theme&&(s=i.copyStyle(o),s.al_right=p)}return e},I=function(e){var o="",a=[],s=h();if(1==s&&editor.jeditorPane.find("div.heading1,div.heading2,div.heading3,div.heading4,div.heading5,div.heading6").text().length>0){var l=(editor.doc.getSelection().getStart(),editor.doc.getSelection().getParents(r.PARAGRAPH)),d={type:r.PARAGRAPH};l&&(d=i.copyStyle(l.attr()));var c=ZWJSONUtils.getKeys(d),u=Utils.randomString();Op.processMsg([{r:s},{as:{start:d,id:u}},{is:n.PARA},{as:{end:c,id:u}}]),Op.sendMsg(),s+=1}e[ATTR_TOC.theme]=e[ATTR_TOC.theme]?e[ATTR_TOC.theme]:"classic";for(var p,g,p=0,g=editor.doc.getSectionEnd(p)-1,T=!1,m=DocTreeManager.getSectionsByType(SECTION_TYPES.CONTENT).first,I=[];m;)p=m.getIndex()+1,g=m.getEndIndex(),I=I.concat(DocTreeManager.getNodesBetweenIndex(r.PARA,p,g)),m=m.next;for(var A,S=s,R=[],O=I.length,b=[],v=6,D=!1,L=2,N=0;N<O;N++){var P=I[N],A=P.type==r.PARA&&parseInt(P.getHeadingType());A>0&&A<=e.level&&P.firstChild()?b.push(P):A&&A>e.level&&A<=6&&(D=!0,A>L&&(L=A)),v>A&&(v=A)}O=b.length;for(N=0;N<O;N++){var l=b[N];if(A=l.getHeadingType(),A=parseInt(A),!T){({type:r.PARAGRAPH});if(s&&(editor.doc.getCharAt(s-1)==n.CELL||editor.doc.getCharAt(s-1)==n.HR||editor.doc.getCharAt(s-1)==n.TABLE)){var u=Utils.randomString();Op.processMsg([{r:s},{as:{start:{type:r.PARAGRAPH},id:u}},{is:n.PARA},{as:{end:["type"],id:u}}])}o=n.TOCSTART;var C={type:"toc",theme:e[ATTR_TOC.theme],level:e[ATTR_TOC.level],leader:e[ATTR_TOC.leader],showNo:e[ATTR_TOC.showNo]},y=Utils.randomString();Op.processMsg([{r:s},{as:{start:C,id:y}},{is:o},{as:{end:ZWJSONUtils.getKeys(C),id:y}}]);var M=i.copyStyle(f),w=i.copyStyle(E),U=e[ATTR_TOC.theme],x=J.i18n("writer.common.TABLEOFCONTENTS");"contemporary"==U?(w[t.TS_FGC]="rgb(102,171,255)",x=x.toUpperCase()):"modern"==U?w[t.TS_FGC]="rgb(102,171,255)":"simple"==U&&(x=x.toUpperCase());var B=Utils.randomString(),H=Utils.randomString();Op.processMsg([{r:s},{as:{start:w,id:B}},{is:x},{as:{end:ZWJSONUtils.getKeys(w),id:B}},{as:{start:M,id:H}},{is:n.PARA},{as:{end:ZWJSONUtils.getKeys(M),id:H}}]),S+=x.length+1}T=!0,F(l,s,e)}if(!T&&editor.getRole().permissions.can("document.edit"))return void(D?PubSub.publish("Document/Warning",WARNING_MSG.LOWER_HEADING_FOUND,L):PubSub.publish("Document/Warning",WARNING_MSG.HEADING_NOT_FOUND));var G=Utils.randomString();Op.processMsg([{r:s},{as:{start:{type:r.PARAGRAPH},id:G}},{is:n.PARA},{as:{end:["type"],id:G}}]);var a=[];o=n.TOCEND,a.push({r:s},{is:o}),a=a.concat(Op.getCursor()),Op.cursorProcessed(),R.length&&(a=a.concat(R)),Op.processMsg(a),Op.sendMsg(),_()},_=function(){PubSub.subscribe("Document/Pagination/Complete",A)},A=function(){PubSub.unsubscribe("Document/Pagination/Complete",A),"inserttoc"!=editor.lastOperation&&"regeneratetoc"!=editor.lastOperation||x()},S=function(t){var n,o={},r=0,a=[],s=t.listNumber,l=t.paraFormat,d=i.copyStyle(t.textFormat),c=0,u=0;d=i.mergeObjs([DocumentDesign.getParaStyle("h0").textFormat,d]),o=FontUtils.getCharSize(s,FontUtils.getFontString(d)).width,a=DocLayoutManager.getFirstSection().getDefaultTabPointWidth();var p=DocLayoutManager.getCurrentSection();for(u=p.getLeft(),o+=u,l&&l[e.PS_ML]&&(c=l[e.PS_ML].convertor().pixels),r=0,n=a.length;r<n&&!(a[r].value>o);r++);return a[r].value-u+c},R=function(e,t,o){for(var r=e.children,a=(e.content(),r.length,[]),s=r[0],l=!1;s;){if(l||"text"!=s.type)if("fieldstart"==s.type&&"mergeField"==s.format.type){var d=s.getIndex();rangeEnd=i.getRangeEnd(d);var c=Utils.randomString(),u=Utils.randomString(),p=Utils.randomString(),g=Utils.randomString(),f=editor.doc.getContent(s.getIndex(),rangeEnd).replace(REGEX.docUnicodes,"").trim(),E=i.copyStyle(s.format);E.id=p;var T={};T.fieldinfo=p,T.type="text";var m=i.copyStyle(editor.doc.getRawFormatAt(rangeEnd));m.id=p,ZWJSONUtils.mergeJsonObjs(T,t),T.cls="mergeField",a=a.concat([{as:{start:E,id:c}},{is:n.RANGE_START},{as:{end:ZWJSONUtils.getKeys(E),id:c}},{as:{start:T,id:u}},{is:f},{as:{end:ZWJSONUtils.getKeys(T),id:u}},{as:{start:m,id:g}},{is:n.RANGE_END},{as:{end:ZWJSONUtils.getKeys(m),id:g}}]),l=!0}else"fieldend"==s.type&&"mergeField"==s.format.type&&(l=!1);else{var h=s.getContent();!s.next&&o&&(h+=" ");var u=Utils.randomString();a=a.concat([{as:{start:t,id:u}},{is:h},{as:{end:ZWJSONUtils.getKeys(t),id:u}}])}s=s.next}return a},O=function(t){para=t.para,pointPosition=t.pointPosition,cursorIdx=t.cursorIdx,paraContent=t.paraContent,theme_name=t.attr[ATTR_TOC.theme],attr=t.attr,bookmark_name=t.bookmark_name;var o=Utils.randomString(),a=Utils.randomString(),s=para.attr("*"),d=s[e.PS_HD],c=attr[ATTR_TOC.leader],u=attr[ATTR_TOC.al_right],p=i.copyStyle(l[theme_name]["h"+d].textFormat);p.cls="link",p.lnktype=2,p.url=bookmark_name;var g=i.copyStyle(l[theme_name]["h"+d].paraFormat);void 0!=c&&u&&(g[e.PS_TPS][0].leader=c);var f=[{r:cursorIdx}];if(t.listNumber){w(p,g,t.listNumber,pointPosition);var E=Utils.randomString();f.push({as:{start:p,id:E}}),f.push({is:t.listNumber}),f.push({as:{end:ZWJSONUtils.getKeys(p),id:E}}),E=Utils.randomString(),f.push({as:{start:{type:r.TEXT,st:r.TAB},id:E}}),f.push({is:n.TAB}),f.push({as:{end:["type","st"],id:E}}),g[e.PS_TPS][1].align=u?2:0}else g[e.PS_TPS][0].point=pointPosition+"in",g[e.PS_TPS][0].align=u?2:0;u||(paraContent+=" ");var T=i.copyStyle(p);T.lnktype=p.lnktype,T.url=p.url,T.cls="autopno_toc link",T.type=r.TEXT;var m=Utils.randomString(),h=Utils.randomString(),I=(Utils.randomString(),Utils.randomString()),_=Utils.randomString(),A=Utils.randomString(),S=Utils.randomString(),O=Utils.randomString(),b=[{as:{start:{id:a,lnktype:2,target:"_self",tooltip:"",type:"link",url:bookmark_name},id:m}},{is:n.RANGE_START},{as:{end:["type","id","lnktype","target","tooltip","url"],id:m}}];b=b.concat(R(para.dtNode,p,u)),u&&(b=b.concat([{as:{start:{type:r.TEXT,st:r.TAB},id:I}},{is:n.TAB},{as:{end:["type","st"],id:I}}]));var v=DocLayoutManager.getPageAtIndex(para.getStart()),D=v.getPageNumber(),L=v.getGroup().getPageNumberFormat();return D=ListUtils.getListNumber(L,D,null,!0),b=b.concat([{as:{start:{type:"autofield",id:o,ftype:AUTOFIELD_TYPE.AUTO_PAGE_REF,bookmarkId:T.url},id:A}},{is:n.RANGE_START},{as:{end:["type","id","ftype","val"],id:A}},{as:{start:T,id:_}},{is:D+""},{as:{end:ZWJSONUtils.getKeys(T),id:_}},{as:{start:{type:"autofield",id:o,ftype:AUTOFIELD_TYPE.AUTO_PAGE_REF},id:S}},{is:n.RANGE_END},{as:{end:["type","id","ftype"],id:S}},{as:{start:{id:a,type:"link"},id:h}},{is:n.RANGE_END},{as:{end:["type","id"],id:h}},{as:{start:g,id:O}},{is:n.PARA},{as:{end:ZWJSONUtils.getKeys(g),id:O}}]),f=f.concat(b)},b=function(e){for(var t,i,n=DocTreeManager.getSectionsByType(SECTION_TYPES.CONTENT).first,o=[];n;)t=n.getIndex()+1,i=n.getEndIndex(),o=o.concat(DocTreeManager.getNodesBetweenIndex(r.PARA,t,i)),n=n.next;for(var a=o.length,s=[],l=0;l<a;l++){var d=o[l];d.type==r.PARA&&parseInt(d.getHeadingType())>0&&parseInt(d.getHeadingType())<=e.level&&d.firstChild()&&s.push(d)}return s},v=function(e){for(var t=e.children,i=t.length,n=[],o=!1,a=[],s=0;s<i;s++){var l=t[s],d=D(l,r.AUTOFIELD);!d||d.format[ATTR_AUTOFIELD.FIELDTYPE]!=AUTOFIELD_TYPE.AUTO_PAGENUMBER&&d.format[ATTR_AUTOFIELD.FIELDTYPE]!=AUTOFIELD_TYPE.AUTO_PAGE_REF?o&&s!=i-1&&a.push(l):(o||(o=!0),n.push(l))}return{tocParas:n,nodesTobeRemoved:a}},D=function(e,t,i){if(!e)return null;for(var n=e.children,o=e.children.length,r=0;r<o;r++){var a=n[r];if("fieldstart"==a.type&&a.format.type==t){if(!i)return a;if(a.format.ftype==i)return a}}return null},L=function(e,t){if(!e&&(e=editor.doc.findNextIndexOf(n.TOCSTART,0),e==-1))return null;if(!t)var o=DocTreeManager.doc.getTreeNodeAtIndex(e),a=v(o),t=a.tocParas;for(var s=t.length,l=null,d=0;d<s;d++){var c=t[d].children,u=(c.length,D(t[d],r.AUTOFIELD,AUTOFIELD_TYPE.AUTO_PAGE_REF));if(u){var p=u.getIndex(),g=editor.doc.getContent(p+1,i.getRangeEnd(p)),f=Utils.randomString(),E=u.next.format,T=u.getIndex()+1,m=i.getFloatElementIdx(null,u.format.bookmarkId);if(m!=-1){var h=DocLayoutManager.getPageAtIndex(m),I=h.getPageNumber(),_=h.getGroup().getPageNumberFormat();if(I=ListUtils.getListNumber(_,I,null,!0),I+="",g+="",g!=I){var A=[{r:T},{ds:g},{as:{start:E,id:f}},{is:I},{as:{end:ZWJSONUtils.getKeys(E),id:f}}];l?l.applyOp(DocOpBuilder.build(A)):l=DocOpBuilder.build(A)}}else{var S=J.i18n("writer.editor.TOC.BOOKMARK_NOT_FOUND");isHeadlessPDF&&(S="Bookmark missing");var A=[{r:T},{ds:g},{as:{start:E,id:f}},{is:S},{as:{end:ZWJSONUtils.getKeys(E),id:f}}];l?l.applyOp(DocOpBuilder.build(A)):l=DocOpBuilder.build(A)}}}return l?l.toJson():void 0},N=function(e,n){var o=i.copyStyle(E),r=n[ATTR_TOC.theme];"contemporary"==r?(o[t.TS_FGC]="rgb(102,171,255)",o[t.TS_TT]="uppercase"):"modern"==r?(o[t.TS_FGC]="rgb(102,171,255)",o[t.TS_TT]=""):"simple"==r?o[t.TS_TT]="uppercase":o[t.TS_TT]="";var a=Utils.randomString();Op.processMsg([{r:e.getIndex()},{as:{start:o,id:a}},{r:e.end-e.start},{as:{end:ZWJSONUtils.getKeys(o),id:a}}])},P=function(e){if("object"==typeof e){for(key in e)void 0==e[key]&&(e[key]=s[key]);"simple"!==e[ATTR_TOC.theme]&&"contemporary"!==e[ATTR_TOC.theme]&&e[ATTR_TOC.showNo]?s[ATTR_TOC.leader]=1:s[ATTR_TOC.leader]=0}else void 0!=e&&e[ATTR_TOC.theme]||(e={},e=ZWJSONUtils.clone(s));return e},C=function(e,t){var o,a=h(),e=(editor.doc.findNextIndexOf(n.TOCEND,a)+1,P(e)),s=b(e),l=s.length,d=DocTreeManager.doc.getTreeNodeAtIndex(a),c=v(d),u=c.tocParas,p=c.nodesTobeRemoved,g=u.length,f=D(u[0],r.AUTOFIELD,AUTOFIELD_TYPE.AUTO_PAGE_REF);f||(t=!0);var E=[];if(t){var T={type:"toc",theme:e[ATTR_TOC.theme],level:e[ATTR_TOC.level],leader:e[ATTR_TOC.leader],showNo:e[ATTR_TOC.showNo]},m=Utils.randomString();Op.processMsg([{r:a},{as:{start:T,id:m}},{r:1},{as:{end:ZWJSONUtils.getKeys(T),id:m}}]),N(d.children[0],e)}for(var I=0;I<l;I++){var A=s[I],S=A.firstChild(),R=A.getContent().replace(REGEX.docUnicodes,"").trim();if(S&&""!=R){var O=!1,C=!1;if(!t)for(var y=0;y<g;y++){var M=u[y];if(M){var w=D(M,r.AUTOFIELD),U=w.format;if(S.format.name==U.bookMarkId){O=!0,listVal="",A.paraProperties.listData&&(listVal=A.paraProperties.listData.listNumberString);var f=D(M,r.AUTOFIELD,AUTOFIELD_TYPE.AUTO_PAGE_REF),x=f.getIndex(),B=editor.doc.getContent(x+1,i.getRangeEnd(x)),H=listVal+R+B,J=M.getContent().replace(REGEX.docUnicodes,"").trim();H!==J&&(C=!0);break}}}if(t||!O){var G;G=o?o.getEndIndex()+1:u[0]?u[0].getIndex():a+1,F(s[I],G,e)}else O&&C?(F(s[I],u[y].getEndIndex(),e),o=u[y]):O&&(o=u[y],E=L(a,[u[y]]),E&&E.length&&Op.processMsg(E),u[y]=null)}}p=p.concat(u),removeUnwantedNodes(p),Op.sendMsg(),_(),0==s.length&&PubSub.publish("Document/Warning",WARNING_MSG.NOHEADINGFOUND_FOR_OPTION_CHOOSED,"H"+e.level)};removeUnwantedNodes=function(e){for(var t=e.length,i=0;i<t;i++){var n=e[i];if(n){var o=editor.doc.createRange(n.getIndex(),n.getEndIndex()+1);o.deleteContentsInRange()}}};var y=function(e){var t=e.firstChild();return!(!t||t.type!=r.FIELD_START||t.format.type!=r.BOOKMARK||t.format.id.indexOf("toc_")==-1)},F=function(e,t,i){var a=e.getContent().replace(REGEX.docUnicodes,"").trim();if(a.length){var s,l=e.firstChild(),d=(editor.doc.getPaperWidth()-48)/96,c=y(e);if(c&&l.format.name.indexOf("_Toc")!=-1)s=l.format.name;else{s="_Toc"+Utils.randomString(),id="toc_"+Utils.randomString(),startObj={},startObj[o.TYPE]=r.BOOKMARK,startObj[o.ID]=id,startObj[o.NAME]=s,endObj={},endObj[o.TYPE]=r.BOOKMARK,endObj[o.ID]=id;var u=Utils.randomString(),p=Utils.randomString();if(Op.processMsg([{r:e.getIndex()},{as:{start:startObj,id:u}},{is:n.RANGE_START},{as:{end:["type",o.ID,o.NAME],id:u}},{r:e.getEndIndex()-e.getIndex()},{as:{start:endObj,id:p}},{is:n.RANGE_END},{as:{end:["type",o.ID],id:p}}]),c&&l.format.name.indexOf("_Toc")==-1){var g=editor.doc.getElement("bookmark",l.format.id)[0];g.remove()}}var f=editor.doc.getElementAt(e.getEndIndex()),E=M(e),T={para:f,bookmark_name:s,paraContent:a,cursorIdx:t,pointPosition:d,attr:i,listNumber:E},m=O(T);Op.processMsg(m)}},M=function(e){var t=e.paraProperties,i="";return t.listData&&(i=t.listData.listNumberString,"&#x25CF;"===i?i="●":"&#x25CB;"===i?i="○":"&#x25A0;"===i&&(i="■")),i},w=function(t,i,n,o){var r={};r.listNumber=n,r.textFormat=t,r.paraFormat=i,r.bodyFormat=editor.doc.getBodyFormat();var a=S(r),s=i[e.PS_TPS][0];i[e.PS_TPS]=[],i[e.PS_TPS][0]={id:0,point:"0in",align:0,leader:0},i[e.PS_TPS][1]=s,i[e.PS_TPS][0].point=(a+"px").convertor().inches+"in",i[e.PS_TPS][1].point=o+"in",i[e.PS_TPS][1].id=1},U=function(e){var t=e,i=editor.doc.findNextIndexOf(n.TOCSTART,0);if(!(i<0)){var o=editor.doc.findNextIndexOf(n.TOCEND,i)+1,r=editor.doc.getContent(i,o),a=[];return a.push({r:i},{ds:r}),Op.processMsg(a),t}},x=function(){var e=h(),t=DocTreeManager.doc.getTreeNodeAtIndex(e),i=v(t),n=i.tocParas,o=[],a=D(n[0],r.AUTOFIELD,AUTOFIELD_TYPE.AUTO_PAGE_REF);return a?(o=L(e,n),void(o&&o.length&&(Op.processMsg(o),Op.sendMsg()))):void C()};return{generate:I,deleteTOC:U,regenerateTOC:C,updatePageNumber:x,getPageNumberOps:L,getTocParas:v}}(ATTR_PARAGRAPH,ATTR_TEXT,DocUtil,UNICODE,ATTR_COMMON,NODE_TYPE);var SnapShotManager=function(){var e=[],t=[],i=[],n=!1,o=function(){var e="";for(var t in ATTR_TEXT)e+=(e?"|":"")+ATTR_TEXT[t];return new RegExp(e)}(),r=function(e,t){for(var i=s(e);e>=0;){for(;null==editor.doc.getRawFormatAt(e)&&e>0;)e--;if(i==s(e))break;e--}return e>=0?t?editor.doc.getRawFormatAt(e)&&editor.doc.getRawFormatAt(e)[t]:editor.doc.getRawFormatAt(e):null},a=function(e,t){var i=editor.doc.getBodyFormat()[e];return"undefined"!=typeof i||isNaN(e)||(i=editor.doc.getRawListObj(e),"object"==typeof i&&0==Object.keys(i).length&&(i=t[e])),"object"==typeof i&&(i=DocUtil.copyStyle(i)),"st"===e&&(i="listFormat"),i},s=function(){var e={};return e[UNICODE.HR]=NODE_TYPE.HR,e[UNICODE.TABLE]=NODE_TYPE.TABLE,e[UNICODE.ROW]=NODE_TYPE.ROW,e[UNICODE.CELL]=NODE_TYPE.CELL,e[UNICODE.TABLEEND]=NODE_TYPE.TABLEEND,e[UNICODE.BR]=NODE_TYPE.BR,e[UNICODE.PARA]=NODE_TYPE.PARAGRAPH,e[UNICODE.SECTION_START]=NODE_TYPE.HEADER,function(t){var i=editor.doc.getRawFormatAt(t);return i&&i.type||e[editor.doc.getCharAt(t)]||NODE_TYPE.TEXT}}(),l=function(e){for(var t,i=e.length,n=i-1;n>=0;n--)if(t){if(t.styles.begin.type!==e[n].styles.begin.type)break;DocUtil.mergeStyles(t.styles.begin,e[n].styles.begin)}else t=e[n];return t},d={},c=[];d.snapShotOps=[],d.getPrevious=function(){var t=e.pop();return t&&(c=t.opCursor,JSON.stringify(c)),t},d.getLastUndoOp=function(){return e[e.length-1]},d.getLastRedoOp=function(){return t[t.length-1]},d.clearRedo=function(){t.length=0},d.isRedoQueueEmpty=function(){var e=0==t.length;return e},d.isUndoQueueEmpty=function(){var t=0===e.length&&0===i.length;return t},d.getNext=function(){return t.pop()},d.clearUndo=function(){e.length=0},d.clearRedo=function(){t.length=0},d.resetTypedCharBuffer=function(){i=[]},d.resetSnapShotManager=function(){this.clearUndo(),this.clearRedo(),this.resetTypedCharBuffer(),PubSub.publish("Document/RedoQueue/Updated"),PubSub.publish("Document/UndoQueue/Updated")},d.getTypedCharBuffer=function(){return i},d.getUndo=function(){return e},d.getRedo=function(){return t},d.flushTypedCharOps=function(){i.length&&(e.push(i[0]),i=[])},d.setSkipSnapShot=function(e){n=e},d.isSnapShotAllowed=function(){return!n},d.getReverseOp=function(e){var i,n=[],o=0,r=-1,a=[],s=[],d=[],c=e.getDocOps(),u=0,p=Utils.randomString();editor.currentCommand!==COMMAND.UNDO&&editor.currentCommand!==COMMAND.REDO&&(t.length=0);for(var g,f=c.length,E=0;E<f;E++){var T,m=c[E],h="";if(m.isRetain()){if(u+=m.retain_count,o+=m.retain_count,g=d.length){u=0;var I=s[g-1],_=o,A=l(d),S=ZWJSONUtils.getKeys(a[g-1]);if(A.styles.begin.type===NODE_TYPE.BODY){n.push({r:0}),n.push({as:{end:S,id:p}}),p=Utils.randomString();continue}for(var R=c[E-1],O=R.isAnnotationEnd()?I:I+1;O<=_;O++){var b=editor.doc.getRawFormatAt(O);if(b||O==_){var v=O-I;n.push({r:v}),n.push({as:{end:S,id:p}}),p=Utils.randomString(),b&&O!=_&&(i=this.takeFmtBackup(O,A),n.push({as:{start:i,id:p}}),S=ZWJSONUtils.getKeys(i)),I=O}}}}else if(m.isInsert()){u&&(T={r:u},n.push(T),u=0);var R=c[E-1];R&&R.isAnnotationStart()&&n.pop(),h=m.characters,T={ds:h},n.push(T)}else if(m.isDelete()){h=m.delete_characters;var I=0,_=h.length,D="";u&&(T={r:u},n.push(T),u=0);for(var L="",O=I;O<_;){var b=editor.doc.getRawFormatAt(o+O);if(D=b?DocUtil.copyStyle(b):b){if(L&&(n.push({is:L}),L=""),delete D[ATTR_TEXT.TS_AUTO_COREECT],delete D.fid,T={as:{start:D,id:p}},n.push(T),D[ATTR_COMMON.TYPE]===NODE_TYPE.TEXT){var N=DocUtil.getTextStyleEnd(o+O);N-=o,N<_?n.push({is:h.substring(O,N)}):n.push({is:h.substring(O,_)}),O=N}else n.push({is:h.substring(O,O+1)}),O++;var P=ZWJSONUtils.getKeys(D);n.push({as:{end:P,id:p}}),p=Utils.randomString()}else L+=h.substring(O,O+1),O++}L?n.push({is:L}):"",o+=h.length}else if(m.isAnnotation()){var R=(c[E+1],c[E-1]);if(m.isAnnotationStart()){r=o,s.push(r),d.push(m);var C=l(d),y=this.takeFmtBackup(r,C,!0);a.push(y);var F=y.type===NODE_TYPE.BODY;(u||0===u&&F)&&(T={r:u},n.push(T),u=0),T={as:{start:y,id:p}},n.push(T)}else m.styles.end&&(a.pop(),s.pop(),d.pop())}}return n},d.pushOps=function(o){if(!n){editor.currentCommand!==COMMAND.UNDO&&editor.currentCommand!==COMMAND.REDO&&(t.length=0);var r=!o.length;r&&(o=(new DocOpBuilder).getDocOps());var a=editor.currentCommand==COMMAND.UNDO?t:e;builder=DocOpBuilder.build(o),builder=DocOpBuilder.concise(builder);var s,l=editor.doc.getSelection()||[],d=l.length;if(0==d&&builder)return builder=DocOpBuilder.concise(DocOpBuilder.compose(builder,DocOpBuilder.build(Op.getCursor(1,1)))),o=builder.toJson(),void a.push({ops:o,isCtrlSelection:l.isCtrlSelection,isListItemSelection:l.isListItemSelection});for(var u,p,g=editor.currentCommand==COMMAND.UNDO?c.length:d,f=0;f<g;f++){s=editor.currentCommand==COMMAND.UNDO?c[f]:l.getRangeAt(f);var p=DocOpBuilder.build(Op.getCursor(s.start,s.end));u=u?DocOpBuilder.concise(DocOpBuilder.compose(u,p)):p}u&&(builder=DocOpBuilder.concise(DocOpBuilder.compose(builder,u))),o=builder.toJson(),editor.currentCommand!=COMMAND.TYPING||r?(this.flushTypedCharOps(),a.push({ops:o,isCtrlSelection:l.isCtrlSelection,isListItemSelection:l.isListItemSelection,opCursor:Op.cursor})):i.length?i[0].ops[1]&&i[0].ops[1].ds&&l.getRangeAt(0).start==i[0].ops[0].r+i[0].ops[1].ds.length?(i[0].ops[1].ds=i[0].ops[1].ds+o[1].ds,i[0].opCursor=Op.cursor):(this.flushTypedCharOps(),i.push({ops:o,opCursor:Op.cursor})):i.push({ops:o,opCursor:Op.cursor}),PubSub.publish("Document/RedoQueue/Updated"),PubSub.publish("Document/UndoQueue/Updated")}},d.takeFmtBackup=function(e,t,i){var n,s=DocUtil.copyStyle(t.styles.begin),l={},d=s.type,c=i?r(e):editor.doc.getRawFormatAt(e);c&&(c=DocUtil.copyStyle(c),c.st&&(l.st=c.st),l.type="body"===d?d:c.type);for(n in s){var u;if("type"!==n&&s.hasOwnProperty(n)){if("body"===d){if("resetBackground"===n){l[ATTR_BODY.DS_BGC]=a(ATTR_BODY.DS_BGC);continue}if("resetBorder"===n){l[ATTR_COMMON.BORDERS]=a(ATTR_COMMON.BORDERS);continue}u=a(n,s)}else{if(n==ATTR_TEXT.TS_NULL||n==ATTR_PARAGRAPH.PS_NULL||"resetBackground"==n||"resetBorder"==n){l=DocUtil.mergeObjs([l,c]);continue}if(c)if(c.type===NODE_TYPE.PARAGRAPH)s.type===NODE_TYPE.TEXT&&o.test(n)?(u=DocUtil.copyStyle(c[ATTR_PARAGRAPH.PS_TS]||{}),u[n]=u[n],n=ATTR_PARAGRAPH.PS_TS):u=n==ATTR_PARAGRAPH.PS_TS?DocUtil.copyStyle(c[ATTR_PARAGRAPH.PS_TS]):c[n];else if(c.type===NODE_TYPE.TABLE)if(u=c[n],"cols"!=n||u)"ver"!=n||u||(u="4.0");else{var p=editor.doc.getElementAt(e);u=p.dtNode.cols}else u=c[n];if(n===TCConstants.TC)for(var g,f,E,T,m,h=s[TCConstants.TC],u=[],I=0,_=h.length;I<_;I++){if(g=h[I],f=g[TCConstants.TASK],E=g[TCConstants.ACTION],c&&c.hasOwnProperty(TCConstants.TC)){for(var A=c[TCConstants.TC],S=0,R=A.length;S<R;S++)if(E===A[S][TCConstants.ACTION]){T=A[S];break}if(E===TCConstants.FF_VALUE_UPDATE)if(f&&f===TCConstants.REMOVE)g=T;else{m=g[TCConstants.DETAILS];for(var O,S=0,b=m.length;S<b;S++)O=m[S],O[TCConstants.TASK]&&O[TCConstants.TASK]===TCConstants.REMOVE?delete O[TCConstants.TASK]:O[TCConstants.TASK]=TCConstants.REMOVE}else g=T||g,T||f||(g[TCConstants.TASK]=TCConstants.REMOVE)}else if(E===TCConstants.FF_VALUE_UPDATE){m=g[TCConstants.DETAILS];for(var S=0,b=m.length;S<b;S++)m[S][TCConstants.TASK]=TCConstants.REMOVE}else g[TCConstants.TASK]=TCConstants.REMOVE;u.push(g)}}"undefined"==typeof u&&(u=""),l[n]=u}}return delete l.fid,delete l[ATTR_TEXT.TS_AUTO_COREECT],l},d.takeDeletedContentBackup=function(e,t,i){for(var n="",o="",r=e,a=Utils.randomString(),s=NamedRange.getAllRanges(),l={},c={},u=0;u<s.length;u++)rng=s[u],(rng.start<=e&&rng.end<=t&&e<=rng.end||rng.start<=t&&t<=rng.end&&rng.start>=e||rng.start>=e&&rng.end<=t)&&(rng.start=rng.start<e?e:rng.start,rng.end=rng.end>t?t:rng.end,l[rng.start]||(l[rng.start]=[]),c[rng.end]||(c[rng.end]=[]),l[rng.start].push({as:{start:rng.styles,id:rng.styleId}}),c[rng.end].push({as:{end:ZWJSONUtils.getKeys(rng.styles),id:rng.styleId}}));for(;r<t;){var p,g=editor.doc.getRawFormatAt(r);if(g||r!=e||(p=DocUtil.getStyleIndex(r,NODE_TYPE.TEXT,"prev",!0),g=editor.doc.getRawFormatAt(p)),n=g?DocUtil.copyStyle(g):g){if(o&&(i.push({is:o}),o=""),delete n[ATTR_TEXT.TS_AUTO_COREECT],delete n.fid,i.push({as:{start:n,id:a}}),n[ATTR_COMMON.TYPE]===NODE_TYPE.TEXT){var f=DocUtil.getTextStyleEnd(r),E=r;for(f=f>t?t:f;E<f;)(l[E]||c[E])&&(r!=E&&(i.push({is:editor.doc.getContent(r,E)}),r=E),i=l[E]?i.concat(l[E]):i,i=c[E]?i.concat(c[E]):i),E++;r!=f&&(i.push({is:editor.doc.getContent(r,f)}),r=f)}else i=l[r]?i.concat(l[r]):i,i=c[r]?i.concat(c[r]):i,i.push({is:editor.doc.getContent(r,r+1)}),r++;var T=ZWJSONUtils.getKeys(n);i.push({as:{end:T,id:a}}),a=Utils.randomString()}else(l[r]||c[r])&&(o&&(i.push({is:o}),o=""),i=l[r]?i.concat(l[r]):i,i=c[r]?i.concat(c[r]):i),o+=editor.doc.getContent(r,r+1),r++}o?i.push({is:o}):"",i=l[r]?i.concat(l[r]):i,i=c[r]?i.concat(c[r]):i,d.snapShotOps=i};var u=function(e,t,i){if(d.isSnapShotAllowed()){var n=editor.doc.snapShotManager.takeFmtBackup(e,t,i);if("body"==n.type&&n.styles){var o=[];for(var r in n.styles)if(!ZWJSONUtils.compareJSON(t.styles.begin.styles[r],n.styles[r])){o.push(r);break}if(1==o.length&&"para"==o[0])for(var r in t.styles.begin.styles.para)if(!n.styles.para[r])return}var a=Utils.randomString();d.snapShotOps.push({as:{start:n,id:a}}),d.snapShotOps.push({r:0}),d.snapShotOps.push({as:{end:ZWJSONUtils.getKeys(n),id:a}})}},p=function(e,t){d.isSnapShotAllowed()&&editor.doc.snapShotManager.takeDeletedContentBackup(e,t,d.snapShotOps)},g=function(){editor.doc.snapShotManager.pushOps(d.snapShotOps),d.snapShotOps=[]},f=function(e,t){!e&&d.isSnapShotAllowed()&&d.snapShotOps.push({r:t})},E=function(e){editor.doc.snapShotManager.isSnapShotAllowed()&&d.snapShotOps.push({ds:e})},T=function(e,t,i){for(var n,o,r=[],a=[],s=e;s<t;s++){var l=d.model.getFormatAt(s);d.model.getCharAt(s);if(l&&d.isSnapShotAllowed()){if(o){d.snapShotOps.push({r:s-n});for(var c=0,u=a.length;c<u;c++)d.snapShotOps.push({as:{end:ZWJSONUtils.getKeys(a[c]),id:r[c]}});r=[],a=[]}n=s;for(var p in i){var g=new DocOp;g.changeStyles(null,i[p]),o=editor.doc.snapShotManager.takeFmtBackup(s,g,!0),a.push(o);var f=Utils.randomString();r.push(f),d.snapShotOps.push({as:{start:o,id:f}})}}}if(o&&d.isSnapShotAllowed()){d.snapShotOps.push({r:t-n});for(var c=0,u=a.length;c<u;c++)d.snapShotOps.push({as:{end:ZWJSONUtils.getKeys(a[c]),id:r[c]}})}};return d.attachModel=function(e){d.model=e,d.model.on(MODEL.STYLE_BEFORE_CHANGE,u),d.model.on(MODEL.BEFORE_CONTENT_DELETION,p),d.model.on(MODEL.APPLYTO_COMPLETE,g),d.model.on(MODEL.APPLYTO_AFTER_RETAIN_PROCESS,f),d.model.on(MODEL.BEFORE_CONTENT_INSERTION,E),d.model.on(MODEL.APPLYTO_BEFORE_STYLE_CHANGED,T)},d.transformCollaboratorsOp=function(i){var n,o,r,a,s,l,d,c=editor.doc.getSelection();U.each([e,t],function(e){n=DocOpBuilder.clone(i),U.each(U.range(e.length-1,-1,-1),function(t){o=e[t],r=DocOpBuilder.build(o.ops),a=DocOpBuilder.xform(n,r),s=DocOpBuilder.concise(a.second),o.ops=s.toJson(),n=DocOpBuilder.concise(a.first),U.each(o.cursorStartPos,function(e,t){l=DocOpBuilder.build(c.createCursorOp(o.cursorStartPos[t],o.cursorEndPos[t])),a=DocOpBuilder.xform(n,l),d=a.second.getCursorPos()[0],o.cursorStartPos[t]=d.start,o.cursorEndPos[t]=d.end})})})},d}(),TableResize=function(e,t,n){var o,r,a,s,l,d,c,u,p,g,f,E,T,m,h=!1,I=!1,_=!1,A=null,S=!1,R=0,O=0,b=0,v=null,D=null,L={},N=!1,P=null,C=null,y=!1,F=20,M=!1,w=Z("tableResizeIconDiv"),U=Z("tableResizeGridDiv"),x=function(e){if((I||_)&&(editor.jMultiByteSpan.css({top:editor.editorPaneContainer.scrollTop()/editor.zoomFactor}),h=!0),h){PubSub.publish("Gridlines/show"),J("div#editorpane, table").children().css({"user-select":"none","-o-user-select":"none","-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none"});var t=e.target;A=t;var i=J(t);!i.is("td")&&i.parents("td")[0]&&(A=i.parents("td")[0]);var o=J(A).parents("table");L.x=e.clientX,L.y=e.clientY;var r=J(A).parents(".zw-textbox-div")[0],a=!!r,s=a?TextBoxHandler.getRotation(r):0;if(a){var l={x:e.clientX,y:e.clientY},d=TransformationUtils.rotateWRToEl(l,s,o[0],editor.zoomFactor);L.x=d.x,L.y=d.y,S=!0,R=s}Jeditor=editor.jeditorPane,b=Jeditor.offset().left;var c=UIUtils.getEventWithZoomFactor(e);a&&(c.clientX=TransformationUtils.distanceBetween(L.x,b,editor.zoomFactor)+b,c.clientY=TransformationUtils.distanceBetween(L.y,O,editor.zoomFactor)+O);var u=0,p=0,g="";if(rotateAngleStr=S?"rotate("+s+"deg)":"",I){if(u=n.offsetTop(o[0]),p=c.clientX-b,S){var f=TransformationUtils.rotateElement(o[0],s,editor.zoomFactor);u=TransformationUtils.distanceBetween(f.y,O,editor.zoomFactor);var l={x:e.clientX,y:e.clientY},d=TransformationUtils.rotateWRToEl(l,s,o[0],editor.zoomFactor);p=TransformationUtils.distanceBetween(d.x,b,editor.zoomFactor);var E=o.height()/2+"px",T=TransformationUtils.distanceBetween(f.x,b,editor.zoomFactor),m=T+o.width()/2-p+"px";g=m+" "+E}J(document.createElement("div")).attr("id","colReLine").css({height:o.height(),position:"absolute",width:"2px","border-left":"1px solid #5fabf2","z-index":10,top:u,left:p,"-ms-transform":rotateAngleStr,"-moz-transform":rotateAngleStr,"-webkit-transform":rotateAngleStr,"-o-transform":rotateAngleStr,transform:rotateAngleStr,"-ms-transform-origin":g,"-moz-transform-origin":g,"-webkit-transform-origin":g,"-o-transform-origin":g,"transform-origin":g,"-moz-user-select":"none"}).appendTo(J("#editorpane")[0]),v=J("div#colReLine")}else if(_){if(u=c.clientY-O,p=n.offsetLeft(o[0]),S){var f=TransformationUtils.rotateElement(o[0],s,editor.zoomFactor);p=TransformationUtils.distanceBetween(f.x,b,editor.zoomFactor);var l={x:e.clientX,y:e.clientY},d=TransformationUtils.rotateWRToEl(l,s,o[0],editor.zoomFactor);u=TransformationUtils.distanceBetween(d.y,O,editor.zoomFactor);var N=TransformationUtils.distanceBetween(f.y,O,editor.zoomFactor),E=N+o.height()/2-u+"px",m=o.width()/2+"px";g=m+" "+E}J(document.createElement("div")).attr("id","rowReLine").css({height:"2px",position:"absolute",width:o.width(),"border-top":"1px solid #5fabf2","z-index":10,top:u,left:p,"-ms-transform":rotateAngleStr,"-moz-transform":rotateAngleStr,"-webkit-transform":rotateAngleStr,"-o-transform":rotateAngleStr,transform:rotateAngleStr,"-ms-transform-origin":g,"-moz-transform-origin":g,"-webkit-transform-origin":g,"-o-transform-origin":g,"transform-origin":g,"-moz-user-select":"none"}).appendTo(J("#editorpane")[0]),D=J("div#rowReLine")}else i.css("cursor","auto")}},B=function(i){if(y=!1,C=null,N=!1,P=null,!editor.getRole().permissions.can("document.edit"))return!1;var n,o,r,a,s,l=i.target,d=i.clientX,c=i.clientY,u=J(l).parents(".zw-textbox-div")[0],p=!!u;if(p){var g={x:i.clientX,y:i.clientY},f=TextBoxHandler.getPtBasedOnParent(u,g);d=f.x,c=f.y}p?TextBoxHandler.getRotation(u):0;if(n=J(l).is("td")?l:J(l).parents("td").get(0),o=J(n),s=J("#editorpane"),r=o.parents("table").get(0),a=J(r),O=editor.jeditorPane.offset().top,h){if(EditorUtil.focusMultiByteSpan(),I&&v){var E=d-b,T=A.nextSibling&&t.getDocElement(A.nextSibling);a=J(A.parentElement.parentElement.parentElement);var r=t.getDocElement(a[0]),m=r&&TableUtil.getCols(r);if(S){var g={x:i.clientX,y:i.clientY},f=TransformationUtils.rotateWRToEl(g,R,a[0],editor.zoomFactor);E=TransformationUtils.distanceBetween(f.x,b,editor.zoomFactor)}if(T){var w=T&&TableUtil.findColIdx(T)-1,U=e.toPixels(m[w].wt);TableUtil.isTableWidthInPercentage(r.attr())&&(U=U/100*parseFloat(DocLayoutManager.getViews(r.dtNode)[0].actualWidth))}var x=t.getDocElement(A);if(x){var B=TableUtil.findColIdx(x)-1,H=e.toPixels(m[B].wt);TableUtil.isTableWidthInPercentage(r.attr())&&(H=H/100*parseFloat(DocLayoutManager.getViews(r.dtNode)[0].actualWidth))}var G=TransformationUtils.distanceBetween(L.x,b,editor.zoomFactor);M=!1,E>G+U-F?E=G+U-F:E<G-H+F&&(E=G-H+F);var k=S?TransformationUtils.rotateElement(a[0],R,editor.zoomFactor).x:a.offset().left;if(!A.previousSibling&&L.x>=k&&L.x<=k+5){if(E=d-b,S){var g={x:i.clientX,y:i.clientY},f=TransformationUtils.rotateWRToEl(g,R,a[0],editor.zoomFactor);E=TransformationUtils.distanceBetween(f.x,b,editor.zoomFactor)}E>G+H-F&&(E=G+H-F),M=!0}var W="";if(S){var Y=TransformationUtils.rotateElement(a[0],R,editor.zoomFactor),z=a.height()/2+"px",Z=TransformationUtils.distanceBetween(Y.x,b,editor.zoomFactor),V=Z+a.width()/2-E+"px";W=V+" "+z}else E/=editor.zoomFactor;return void v.css({"-ms-transform-origin":W,"-moz-transform-origin":W,"-webkit-transform-origin":W,"-o-transform-origin":W,"transform-origin":W,left:E})}if(_&&D){var j=(i.clientY-O)/editor.zoomFactor;if(S){var a=J(A).parents("table"),Y=TransformationUtils.rotateElement(a[0],R,editor.zoomFactor),g={x:i.clientX,y:i.clientY},f=TransformationUtils.rotateWRToEl(g,R,a[0],editor.zoomFactor);j=TransformationUtils.distanceBetween(f.y,O,editor.zoomFactor);var X=TransformationUtils.distanceBetween(Y.y,O,editor.zoomFactor),z=X+a.height()/2-j+"px",V=a.width()/2+"px";W=V+" "+z}D.css({"-ms-transform-origin":W,"-moz-transform-origin":W,"-webkit-transform-origin":W,"-o-transform-origin":W,"transform-origin":W,top:j})}}if(!h&&n&&o.is("td")&&0==J(l).parents(".unselectableSection").length){var K=o.offset(),q={left:K.left,top:K.top,width:parseFloat(window.getComputedStyle(n).width)*editor.zoomFactor,height:parseFloat(window.getComputedStyle(n).height)*editor.zoomFactor};q=p?TextBoxHandler.getDataBasedOnParent(u,o):q,p&&(K.left=q.left,K.top=q.top);var Q=q.width,$=n.offsetParent,ee=p?TextBoxHandler.getDataBasedOnParent(u,$).top:0,te=p?q.top-ee:n.offsetTop,ie=p?TextBoxHandler.getDataBasedOnParent(u,a).top:a.offset().top,ne=p?TextBoxHandler.getDataBasedOnParent(u,a).left:a.offset().left,oe=p?te+n.offsetHeight*editor.zoomFactor:(n.offsetTop+n.offsetHeight)*editor.zoomFactor;d>K.left+Q-5&&d<K.left+Q+10?(o.css("cursor","col-resize"),I=!0,_=!1):c>ie+oe-5&&c<ie+oe+20?(o.css("cursor","row-resize"),_=!0,I=!1):o.parents("tr.zw-tr")[0]==a.find("tr.zw-tr")[0]&&c>=(n.offsetTop+ie)*editor.zoomFactor-10&&c<=(n.offsetTop+ie)*editor.zoomFactor+3||(!n.previousSibling&&d>=ne&&d<=ne+5?(o.css("cursor","col-resize"),I=!0,_=!1):(N=!1,jQuery.isEmptyObject(editor.doc.paintFormat)?o.css("cursor","auto"):o.css("cursor","pointer"),v||D||(_=!1,I=!1),d>K.left&&d<K.left+20&&c>ie+oe-10&&(o.css("cursor","ne-resize"),y=!0,C=n)))}},H=function(i){PubSub.publish("Gridlines/hide");var n,o=J(A).parents("table").get(0);if(v){var r=v.offset().left;if(S){var a={x:i.clientX,y:i.clientY},s=TransformationUtils.rotateWRToEl(a,R,o,editor.zoomFactor);r=s.x}n=r-L.x,v.remove(),v=null;var l=t.getDocElement(A),d=l.parentNode(),o=d.parentNode();if(M){var c=TableUtil.calculateTableMarginLeft(o.dtNode).convertUnitTo(RULER_UNITS.PIXELS),u=e.toGlobalValue(c+n+RULER_UNITS.PIXELS),p=u;n=-n}var g=re(TableUtil.findColIdx(t.getDocElement(A)),d.dtNode),f=k(g,o,n/editor.zoomFactor);p&&(f.styArr[0][ATTR_TABLE.TBLS_ML]=p),editor.doc.execCmd("applyStyle",[f.eleArr,f.styArr,J(A).next().length?"updateColumnWidth":"updateLastColumnWidth"]),PubSub.publish("Document/TableResized")}else if(D){var E=i.clientY;if(S){var a={x:i.clientX,y:i.clientY},s=TransformationUtils.rotateWRToEl(a,R,o,editor.zoomFactor);E=s.y}n=E-L.y,D.remove(),D=null,W(n/editor.zoomFactor)}A=null,S=!1,R=0},G=function(e,t,n,o){var a,s,l=e.dtNode,d=TableUtil.getCols(e),c=d.length,u=[];s=DocLayoutManager.getViews(l)[0].actualWidth,a=s,r=parseFloat(e.attr(ATTR_TABLE.TBLS_WID)),a=s+t;var p=r/s*a,g=p-r;if(p>100){var f=p-100;g-=f,p=100}p=p.toFixed(3)+UNITS.PERCENTAGE;var E=100+g;if(n)for(i=0;i<c;i++){var T=d[i].wt;i==o&&(T=parseFloat(T)+g+UNITS.PERCENTAGE),T=100*parseFloat(T)/E+UNITS.PERCENTAGE,u.push({wt:T})}else for(i=0;i<c;i++){var T=d[i].wt;i==c-1&&(T=parseFloat(T)+g+UNITS.PERCENTAGE),T=100*parseFloat(T)/E+UNITS.PERCENTAGE,u.push({wt:T})}return{newcols:u,newTableWidth:p}},k=function(t,i,n){var o=[],r=[];if(0==n)return{eleArr:o,styArr:r};var a,s=i.attr(),l=TableUtil.isTableWidthInPercentage(s),d=i.dtNode,c=t,u=TableUtil.getCols(i),p=u.length,g=[],f=s.dir?s.dir:"ltr",E=TableUtil.getColumnRepeatInfo(i.dtNode);if(o.push(i),"ltr"===f&&c+1===p||M){var T;if(l){var m=G(i,n,M,c);g=m.newcols,T=m.newTableWidth}else if(T=e.toPixels(i.attr(ATTR_TABLE.TBLS_WID)),T+=n,T=e.toGlobalValue(T+UNITS.PIXELS),M)for(a=0;a<p;a++){var h=u[a].wt;a==c&&(h=e.toGlobalValue(e.toPixels(h)+n+UNITS.PIXELS)),g.push({wt:h})}else for(a=0;a<p;a++){var h=u[a].wt;a==p-1&&(h=e.toGlobalValue(e.toPixels(h)+n+UNITS.PIXELS)),g.push({wt:h})}r.push({ver:"4.0",wid:T,cols:g})}else{if(l)if("rtl"===s.dir&&0==c){var m=G(i,n,!0,c);g=m.newcols,T=m.newTableWidth}else{var I=DocLayoutManager.getViews(d)[0].actualWidth,_=100*n/I;for(a=0;a<p;a++){var h=u[a].wt;"rtl"===s.dir?a==c?h=(parseFloat(h)+_).toFixed(3)+UNITS.PERCENTAGE:a==c-1&&(h=(parseFloat(h)-_).toFixed(3)+UNITS.PERCENTAGE):a==c?h=(parseFloat(h)+_).toFixed(3)+UNITS.PERCENTAGE:a==c+1&&(h=(parseFloat(h)-_).toFixed(3)+UNITS.PERCENTAGE),g.push({wt:h})}}else for(a=0;a<p;a++){var h=u[a].wt;"rtl"===s.dir?a==c?h=e.toGlobalValue(e.toPixels(h)+n+UNITS.PIXELS):a==c-1&&(h=e.toGlobalValue(e.toPixels(h)-n+UNITS.PIXELS)):a==c?h=e.toGlobalValue(e.toPixels(h)+n+UNITS.PIXELS):a==c+1&&(h=e.toGlobalValue(e.toPixels(h)-n+UNITS.PIXELS)),g.push({wt:h})}"rtl"===s.dir&&0==c&&(l||(T=e.toPixels(i.attr(ATTR_TABLE.TBLS_WID)),T+=n,T=e.toGlobalValue(T+UNITS.PIXELS)),r.push({ver:"4.0",wid:T,cols:g})),r.push({ver:"4.0",cols:g})}return E&&TableUtil.updateColumnRepeatInfo(g,E),{eleArr:o,styArr:r}},W=function(i){try{if(0==i)return;var n,o,r,a,s=J(A),l=s.parents("table").get(0),d=(t.getDocElement(l),s.offset()),c=DomViewManager.getDocView(l).getNode(),u=DomViewManager.getAllDomFromCurrentPage(c),p=u.length,g=(d.top+A.offsetHeight)*editor.zoomFactor,f=[],E=[],T=[],m=J(l).parents(".zw-textbox-div")[0],h=!!m;if(h){var I={left:d.left,top:d.top,width:parseFloat(window.getComputedStyle(A).width)*editor.zoomFactor,height:parseFloat(window.getComputedStyle(A).height)*editor.zoomFactor};I=TextBoxHandler.getDataBasedOnParent(m,s),d.left=I.left,d.top=I.top,g=(d.top+A.offsetHeight)*editor.zoomFactor}for(r=0;r<p;r++){o=J(u[r]).children("tbody").children("tr.zw-tr").children("td.zw-td");var _=o.length;for(a=0;a<_;a++)T.push(o[a])}var S=T.length;for(n=0;n<S;n++){var R=T[n];if(!("fc"===R.getAttribute("merge")&&parseFloat(R.getAttribute("rowspan"))>1)){var O=J(R),b=O.offset(),v=b.top*editor.zoomFactor,D=parseInt(R.offsetHeight),L=v+D*editor.zoomFactor;if(h){var N=TextBoxHandler.getDataBasedOnParent(m,O);b.left=N.left,b.top=N.top,v=b.top*editor.zoomFactor,L=v+D*editor.zoomFactor}if(L>=g-5&&L<=g+5){var P=(D+i)/e.globalUnitInPx+e.globalUnit,C=t.getDocElement(R),y={};y[ATTR_CELL.TDS_HT]=P,f.push(C),E.push(y)}}}editor.doc.execCmd("applyStyle",[f,E,"updateRowHeight"])}catch(e){ZWLogger.log("_"+ZWCollaboration.ROW_RESIZE_HEIGHT+"\nException: "+e.stack);var F=new Error(ZWCollaboration.ROW_RESIZE_HEIGHT);throw editor.lastError=F,F}},Y=function(){return I},z=function(e){I=e},V=function(){return _},j=function(e){_=e},X=function(){return h},K=function(e){h=e},q=function(){return N},Q=function(e){N=e},$=function(){return P},ee=function(){return y},te=function(e){y=e},ie=function(){return C},ne=function(t){if(l=t,E=l&&J(DomViewManager.getAllDomFromCurrentPage(l.dtNode)),E&&E.length){var i=E.offset().top,n=E.offset().left,o=i+E.height()*editor.zoomFactor,r=n+E.width()*editor.zoomFactor;o+=parseFloat(J(E).css("borderTopWidth"))+parseFloat(J(E).css("borderBottomWidth")),r+=parseFloat(J(E).css("borderLeftWidth"))+parseFloat(J(E).css("borderRightWidth")),U.hide(),w.css({border:"1px solid var(--themeColor)","background-color":"var(--buttonActiveClr)"});var a=E.parents(".zw-textbox-div")[0],s=!!a;if(s||w.show(),w.offset({top:o,left:r}),TableUtil.isInnerTable(l)){var d=DomViewManager.getAllDomFromCurrentPage(l.parentNode().dtNode);parseInt(l.attr().wid)>parseInt(e.toGlobalValue(J(d).width()+UNITS.PIXELS))&&(U.show(),U.height(E.height()),U.width(E.width()),U.offset({top:E.offset().top,left:E.offset().left}))}}};w.mousedown(function(e){PubSub.publish("Gridlines/show");var t=Z("drawcontainer"),i=t.height()*editor.zoomFactor,n=t.width()*editor.zoomFactor;return T=TableUtil.getCols(l),m=T.length,o=E.height()*editor.zoomFactor,r=E.width()*editor.zoomFactor,a=E.offset().top,s=E.offset().left,d=s+r,c=e.clientX-d,tableRigthCornerY=a+o,diffY=e.clientY-tableRigthCornerY,u=0,p=parseFloat(o),g=0,f=parseFloat(r),u=0,p=parseInt(o),g=0,f=parseInt(r),U.show(),w.height(i),w.width(n),w.css({"border-color":"black","border-width":"0px","border-style":"solid","background-color":"transparent"}),w.offset({top:t.offset().top,left:t.offset().left}),U.height(o),U.width(r),U.offset({top:a,left:s}),TableResize.isTableResizeIsInProgress=!0,!1}),w.mousemove(function(e){if(TableResize.isTableResizeIsInProgress){var t=Z("editorpane"),i=E.parents(".zw-contentpane"),n=e.clientX,l=e.clientY,T=20,h=20;u=l-tableRigthCornerY-diffY,p=o+u,g=n-d-c,f=r+g,n>=t.width()*editor.zoomFactor+t.offset().left?(g=t.width()*editor.zoomFactor+t.offset().left-d-c,f=r+g):n<s+h*m&&(g=s+h*m-d-c,f=r+g),l>=i.height()+i.offset().top?(u=i.height()+i.offset().top-tableRigthCornerY-diffY,p=o+u):l<a+T*E.children()[1].children.length&&(u=a+T*E.children()[1].children.length-tableRigthCornerY-diffY,p=o+u),U.width(f),U.height(p),f/=editor.zoomFactor,p/=editor.zoomFactor}}),w.mouseup(function(i){PubSub.publish("Gridlines/hide");var n=0,d=0,c=8,p=8,E=[],h=[];TableResize.isTableResizeIsInProgress=!1,U.hide(),w.hide(),U.height(n),U.width(d),w.height(c),w.width(p),w.offset({top:a+o,left:s+r}),w.css({"border-color":"black","border-width":"1px","border-style":"solid"});var I;if(setTimeout(function(){w.show()},2e3),0!=g&&f)if(l.dtNode.isTableWidthInPercentage){var _=r,A=l.attr().wid,S=f*parseFloat(A)/_;I=S.toFixed(3)+UNITS.PERCENTAGE,E.push(l),h.push({ver:"4.0",wid:I})}else{var R;for(R=0;R<m;R++){var O=e.toGlobalValue(T[R].wt),b=parseFloat(O)/parseFloat(r)*100;T[R].wt=e.toGlobalValue(parseFloat(O)+parseFloat(g)/100*b)}I=e.toGlobalValue(f+UNITS.PIXELS),E.push(l),h.push({ver:"4.0",wid:I,cols:T}),g=0}if(0!=u){var v=DocLayoutManager.getViews(l.dtNode);if(1==v.length){var R,D,L=l.children(),N=L.length;for(R=0;R<N;R++){var P=L[R];for(D=0;D<P.children().length;D++){var C=J(DomViewManager.getAllDomFromCurrentPage(P.children()[D].dtNode)),y=C.height(),F=parseFloat(y)/parseFloat(o)*100,M=parseFloat(u)/100*F,x={};x[ATTR_CELL.TDS_HT]=e.toGlobalValue(parseFloat(y)+parseFloat(M)+UNITS.PIXELS),E.push(t.getDocElement(C[0])),h.push(x)}}u=0}}0!=E.length&&0!=h.length&&(editor.doc.execCmd("applyStyle",[E,h,"tableResize"]),PubSub.publish("Table/Resize")),ZWLogger.addToStatistics("tableResize");var B=editor.doc.getSelection(),H=B.getStart(),G=B.getEnd(),k=editor.doc.createRange(H,G).setFocus(!1);return B.removeAllRanges().addRange(k),!1});var oe=function(e){for(var t=editor.doc.getSelection().getParents(NODE_TYPE.ROW).dtNode,i=t.children,n=0;n<=e;){var o=i[n];"fc"==o.merge?(n+=o.cspan,e+=o.cspan-1):o.merge||n++}return e},re=function(e,t){var i=0,n=t.children[e-1];return"fc"==n.merge?i=e-1+n.cspan:n.merge||(i=e),i-1},ae=function(e){for(var t=editor.doc.getSelection().getParents(NODE_TYPE.ROW).dtNode,i=t.children,n=0,o=-1;n<=e;n++){var r=i[n];r.merge&&"fc"!=r.merge||o++}return o};return{mouseUp:H,mouseDown:x,resizeColumnWidth:k,mouseMove:B,isColumnResize:Y,setIsColumnResize:z,isRowResize:V,setIsRowResize:j,isInProgress:X,setIsProgress:K,getColSelection:q,setColSelection:Q,getColSelectionTD:$,getCellSelectionTD:ie,setIsCellSelectionInProgress:te,isCellSelectionInProgress:ee,updateTableResizeIcon:ne,getResizedCellIdx:oe,getOriginalCellIdx:re,getVisibleCellIdx:ae}}(Conversions,DocUtil,PUtil);!function(e,t,n,o){var r=function(e,i,r,a){try{if(!e)return;var s,l,d,c,u,p,g,f,E,T=e.parentNode(),m=T.parentNode(),h=m.children(),I=h.length,_=T.nodeCountBefore(e),A=n.getColumnWidthsInPercentage(m.getStart()),S=m.attr(ATTR_TABLE.TBLS_WID),R=0,O=[],b=!1,v=[],D=!1,L=n.getColumnRepeatInfo(e.dtNode);S&&S.indexOf(UNITS.PERCENTAGE)!==-1?(b=!0,S=100):S=t.toPixels(S);var N=A[_];if(0===N)for(d=_-1;d>=0;d--)if(0!==A[d]){N=A[d];break}if(i)for(d=0;d<r;d++)A.push(N);else for(d=0;d<r;d++)A.splice(_,0,N);var P=A.length;for(d=0;d<P;d++)R+=A[d];for(d=0;d<P;d++)A[d]=Math.round(A[d]/R*100*100)/100,O.push(Math.round(A[d]/100*S*1e3)/1e3);var C=[],y={},F=editor.doc.getRawFormatAt(m.getStart());F.name&&(y.name=F.name);var M=O.length;if(b)for(d=0;d<M;d++)ele={wt:O[d]+UNITS.PERCENTAGE},C.push(ele);else for(d=0;d<M;d++)ele={wt:t.toGlobalValue(O[d]+UNITS.PIXELS)},C.push(ele);L&&n.updateColumnRepeatInfo(C,L,_,"insert",a,!1),y[ATTR_TABLE.TBLS_COLS]=C,s=i?O[_+1]:O[_],s=b?s+UNITS.PERCENTAGE:t.toGlobalValue(s+UNITS.PIXELS);var w=(m.getStart(),0);for(u=0;u<I;u++){var U=h[u],x=U.children(),B=x.length;for(p=0;p<B;p++)if(p==_){var x=(editor.doc.createElement(NODE_TYPE.CELL),U.children()),H={},J=x[_];if(void 0==J)continue;"after"!=a||i||(J=x[_-1]);var G,k=J.attr();i||"after"==a?(v.push({r:J.getEnd()-w}),w=J.getEnd()):(v.push({r:J.getStart()-w}),w=J.getStart());for(E in k)if("wid"!=E&&"cspan"!=E&&"rspan"!=E){var W=k[E];switch(E){case ATTR_CELL.TDS_MRG:if("hmp"==W){if(!i){for(l=J,c=_;l;){if("fc"==l.attr(ATTR_CELL.TDS_MRG)){var Y={};colSpan=l.attr(ATTR_CELL.TDS_CSPAN),Y[ATTR_COMMON.TYPE]="cell",Y[ATTR_CELL.TDS_CSPAN]=colSpan+r,l.attr(Y);break}if("vmp"==l.attr(ATTR_CELL.TDS_MRG))break;l=l.previousSibling(),c--}H[E]=W}}else if("vmp"==W){var z=J.dtNode.getRootMergeCell();"after"==a&&z.cspan>1?H[E]="hmp":H[E]=W}else if("fc"===W)if("after"==a){var Z=k[ATTR_CELL.TDS_CSPAN];if(Z&&Z>1){H[E]="hmp";var Y={};Y[ATTR_CELL.TDS_CSPAN]=Z+r,J.attr(Y)}else k[ATTR_CELL.TDS_RSPAN]&&k[ATTR_CELL.TDS_RSPAN]>1&&(H[E]=W,H[ATTR_CELL.TDS_RSPAN]=k[ATTR_CELL.TDS_RSPAN],H[ATTR_CELL.TDS_CSPAN]=1)}else k[ATTR_CELL.TDS_RSPAN]&&k[ATTR_CELL.TDS_RSPAN]>1&&(H[E]=W,H[ATTR_CELL.TDS_RSPAN]=k[ATTR_CELL.TDS_RSPAN],H[ATTR_CELL.TDS_CSPAN]=1);break;case ATTR_CELL.TDS_WID:break;case ATTR_COMMON.BORDERS:H[E]=W;var V=m.attr(ATTR_COMMON.BORDERS);if(!V)break;var j=V[ATTR_BORDERS.BORDER_LEFT],X=V[ATTR_BORDERS.BORDER_RIGHT],K=W[ATTR_BORDERS.BORDER_LEFT],q=W[ATTR_BORDERS.BORDER_RIGHT];if("after"==a){if(1==_&&j&&K)ZWJSONUtils.compareJSON(K,j)&&delete H[E][ATTR_BORDERS.BORDER_LEFT];else if(i&&X&&q&&ZWJSONUtils.compareJSON(q,X)){var Q=o.copyStyle(W);delete Q[ATTR_BORDERS.BORDER_RIGHT],J.attr({borders:Q})}}else if(0==_&&j&&K){if(ZWJSONUtils.compareJSON(K,j)){var Q=o.copyStyle(W);delete Q[ATTR_BORDERS.BORDER_LEFT],J.attr({borders:Q}),D=!0}}else _==x.length-1&&X&&q&&ZWJSONUtils.compareJSON(q,X)&&delete H[E][ATTR_BORDERS.BORDER_RIGHT];break;case MAILMERGE.MMINFO:H[E]=W;break;default:H[E]=W}}for(G=o.copyStyle(J.firstChild().attr()),d=0;d<r;d++){var $=Utils.randomString(),ee=Utils.randomString();if(Utils.addId(H,"cl-",4),v.push({as:{start:H,id:$}}),v.push({is:UNICODE.CELL}),v.push({as:{end:ZWJSONUtils.getKeys(H),id:$}}),v.push({as:{start:G,id:ee}}),!f){var te=Utils.randomString();v.push({as:{start:{type:"cursor",uuid:editor.uuid},id:te}}),v.push({r:0}),v.push({as:{end:["type","uuid"],id:te}})}v.push({is:UNICODE.PARA}),v.push({as:{end:ZWJSONUtils.getKeys(G),id:ee}})}f||(g=H,f=J)}}if(D&&Op.sendMsg(),i)if(g[ATTR_CELL.TDS_MRG])for(l=f;l;){if("fc"==l.attr(ATTR_CELL.TDS_MRG)){curPos=l.getStart()+1;break}l=l.previousSibling()}else curPos=f.getEnd()+1;else if(g[ATTR_CELL.TDS_MRG])for(l=f;l;){if("fc"==l.attr(ATTR_CELL.TDS_MRG)){curPos=l.getStart()+1;break}l=l.previousSibling()}else curPos=f.getStart()+1;Op.resetCursorPos(),Op.cursorProcessed(),editor.doc.getSelection().removeTableSelection(),editor.doc.getTrackChangeDetails().setProcessingTC(!1),Op.processMsg(v),editor.doc.getTrackChangeDetails().setProcessingTC(!0),n.setTableAttr(m,y)}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_INSERT_COLUMN+"\nException: "+e.stack);var ie=new Error(ZWCollaboration.TABLE_INSERT_COLUMN);throw editor.lastError=ie,ie}},a=function(e){var t,i,n,o,a=[],s=[],e=e?e:1,l=!1,d=editor.doc.getSelection();s=d.getSelectedColumns(),t=d.getEndCell()?d.getEndCell():d.getParents(NODE_TYPE.CELL);var c,u=t.attr(ATTR_CELL.TDS_CSPAN);if(u)for(c=1;c<u;c++)t=t.nextSibling();e>1?(i=t.parentNode().parentNode(),a=i.children(),n=s[s.length-1],t=a[0].children()[n],t=t?t:d.getParents(NODE_TYPE.CELL),o=t.nextSibling(),t=o?o:t,o||(l=!0)):(o=t.nextSibling(),t=o?o:t,o||(l=!0)),r(t,l,e,"after")},s=function(e){var t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.CELL),e=e?e:1;r(i,!1,e,"before")},l=function(e,t,i,r){try{if(!e)return;var a,s,l,d,c,u,p,g,f,E,T,m=e.parentNode(),h=m.attr(ATTR_TABLE.TBLS_WID),I=e.children(),_=(n.getColumnWidthsInPx(m),I.length),A=[],S=[],R=e.attr(),O={},b={},v={},D=!1;for(R&&R.mminfo&&delete R.mminfo,h&&h.indexOf(UNITS.PERCENTAGE)!==-1&&(D=!0),R&&R.condition&&(delete R.condition,delete R.pattern,delete R.ftype,delete R.fieldInfos),R&&R.format&&delete R.format.sortinfo,a=0;a<_;a++){if(s=I[a],O=s.attr(),b={},v=s.firstChild().attr(),"after"==r){for(p in O)if(g=O[p],"wid"!=p&&"cspan"!=p&&"rspan"!=p)if("merge"===p)if("fc"===g)if(b[p]="vmp",O[ATTR_CELL.TDS_RSPAN]&&O[ATTR_CELL.TDS_RSPAN]>1){var L=O[ATTR_CELL.TDS_RSPAN]+i;s.attr({rspan:L})}else b[p]="fc",b[ATTR_CELL.TDS_RSPAN]=1,b[ATTR_CELL.TDS_CSPAN]=O[ATTR_CELL.TDS_CSPAN];else if("hmp"===g)b[p]=g;else if(t){for(E=1,T=s.nextSibling();T&&(f=T.attr(ATTR_CELL.TDS_MRG),f&&"hmp"===f);)T=T.nextSibling(),E++;E>1&&(b[ATTR_CELL.TDS_CSPAN]=E,b[ATTR_CELL.TDS_RSPAN]=1,b[ATTR_CELL.TDS_MRG]="fc")}else{for(l=e.previousSibling();l;){if(d=l.children()[a],c=d.attr(),u=c[ATTR_CELL.TDS_MRG],"fc"===u){var L=c[ATTR_CELL.TDS_RSPAN];d.attr({rspan:L+i});break}l=l.previousSibling()}b[p]=g}else if(p===ATTR_CELL.TDS_WID);else if(p===ATTR_COMMON.BORDERS){b[ATTR_COMMON.BORDERS]=g;var N=m.attr(ATTR_COMMON.BORDERS);if(N){var P=N[ATTR_BORDERS.BORDER_TOP],C=N[ATTR_BORDERS.BORDER_BOTTOM],y=g[ATTR_BORDERS.BORDER_TOP],F=g[ATTR_BORDERS.BORDER_BOTTOM];if(n.findRowIdx(s.parentNode())==m.children().length&&C&&F){if(ZWJSONUtils.compareJSON(F,C)){var M=o.copyStyle(g);delete M[ATTR_BORDERS.BORDER_BOTTOM],s.attr({borders:M})}}else 1==n.findRowIdx(s.parentNode())&&P&&y&&ZWJSONUtils.compareJSON(y,P)&&delete b[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]}}else b[p]=g}else for(p in O)if(g=O[p],"cspan"===p&&O[ATTR_CELL.TDS_RSPAN]&&O[ATTR_CELL.TDS_RSPAN]>1)O[ATTR_CELL.TDS_MRG]&&"fc"===O[ATTR_CELL.TDS_MRG]&&O[ATTR_CELL.TDS_CSPAN]&&O[ATTR_CELL.TDS_CSPAN]>1&&(b[p]=g);else{if("rspan"===p)continue;if("merge"===p){if(b[p]=g,"vmp"===g)for(var l=e.previousSibling();l;){if(d=l.children()[a],c=d.attr(),u=c[ATTR_CELL.TDS_MRG],"fc"===u){var L=c[ATTR_CELL.TDS_RSPAN];d.attr({rspan:L+i});break}l=l.previousSibling()}}else{if(p===ATTR_CELL.TDS_WID)continue;if(p===ATTR_COMMON.BORDERS){b[ATTR_COMMON.BORDERS]=g;var N=m.attr(ATTR_COMMON.BORDERS);if(N){var P=N[ATTR_BORDERS.BORDER_TOP],C=N[ATTR_BORDERS.BORDER_BOTTOM],y=g[ATTR_BORDERS.BORDER_TOP],F=g[ATTR_BORDERS.BORDER_BOTTOM];if(n.findRowIdx(s.parentNode())==m.children().length&&C&&F)ZWJSONUtils.compareJSON(F,C)&&delete b[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM];else if(1==n.findRowIdx(s.parentNode())&&P&&y&&ZWJSONUtils.compareJSON(y,P)){var M=o.copyStyle(g);delete M[ATTR_BORDERS.BORDER_TOP],s.attr({borders:M})}}}else b[p]=g}}A.push(b),S.push(v)}t?m.appendChild(R,A,S,!0,i):"before"==r?m.insertBefore(e,R,A,S,!0,i):(e=e.nextSibling(),m.insertBefore(e,R,A,S,!0,i));var w;if(t)w=e.getEnd()+2;else if(w=e.getStart()+2,f=I[0].attr(ATTR_CELL.TDS_MRG),"vmp"===f)for(l=e.previousSibling();l;){if(d=l.children()[0],c=d.attr(),u=c[ATTR_CELL.TDS_MRG],"fc"===u){w=l.getStart()+2;break}l=l.previousSibling()}}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_INSERT_ROW+"\nException: "+e.stack);var U=new Error(ZWCollaboration.TABLE_INSERT_ROW);throw editor.lastError=U,U}},d=function(e,t){var t,i=editor.doc.getSelection(),n=e?e:i.getParents(NODE_TYPE.CELL),o=n.parentNode(),r=[];r=i.getSelectedRows();var t=t?t:1;l(o,!1,t,"before"),i.removeTableSelection()},c=function(e,t){var t,i,n=editor.doc.getSelection(),o=e?e:n.getEndCell()?n.getEndCell():n.getParents(NODE_TYPE.CELL),r=o.parentNode(),a=!1,t=t?t:1,s=o.attr(ATTR_CELL.TDS_RSPAN);if(s>1){var d;for(d=1;d<s;d++)r=r.nextSibling()}i=r.nextSibling(),i||(a=!0),l(r,a,t,"after"),n.removeTableSelection()},u=function(){var e=editor.doc.getSelection(),t=e.getSelectedCells(),o=n.getRowsToBeDeleted();cell=t[0];var r=o.length;if(cell&&cell.dtNode){var a=cell.dtNode,s=a.parent.parent.children.length;if(s==r)return void editor.doc.execCmd("deltable")}for(i=0;i<r;i++)p(o[i])},p=function(e,t){if(e){var i,o,r=e.children(),a=r.length;for(i=0;i<a;i++){var s=r[i];jsonObj=s.attr();for(o in jsonObj){var l=jsonObj[o],d=e.nextSibling(),c=e.previousSibling();if("vmp"==l)for(;c;){var u=c.children()[i];if(u.attr(ATTR_CELL.TDS_MRG)&&"fc"==u.attr(ATTR_CELL.TDS_MRG)){u.attr({rspan:u.attr("rspan")-1});break}c=c.previousSibling()}else if("fc"==l){var p=s.attr("rspan")?s.attr("rspan"):1,g=s.attr("cspan")?s.attr("cspan"):1;if(p>1){var d=e.nextSibling(),f=d.children()[i];f.attr({merge:"fc",rspan:p-1,cspan:g})}}else if(o==ATTR_COMMON.BORDERS){var E=e.parentNode(),T=E&&E.attr()[ATTR_COMMON.BORDERS];if(T){var m=T[ATTR_BORDERS.BORDER_TOP],h=T[ATTR_BORDERS.BORDER_BOTTOM],I=l[ATTR_BORDERS.BORDER_TOP],_=l[ATTR_BORDERS.BORDER_BOTTOM];if(n.findRowIdx(e)==E.children().length&&h&&_){var A=c.children()[i].attr()[ATTR_COMMON.BORDERS]||{};ZWJSONUtils.compareJSON(_,h)?A[ATTR_BORDERS.BORDER_BOTTOM]=_:A[ATTR_BORDERS.BORDER_BOTTOM]=I,c.children()[i].attr({borders:A})}else if(1==n.findRowIdx(e)&&m&&I){var S=d.children()[i].attr()[ATTR_COMMON.BORDERS]||{};ZWJSONUtils.compareJSON(I,m)?S[ATTR_BORDERS.BORDER_TOP]=I:S[ATTR_BORDERS.BORDER_TOP]=_,d.children()[i].attr({borders:S})}}}}}if(t=t?t:editor.doc.getSelection().getParents(NODE_TYPE.CELL)){var E=t.parentNode().parentNode(),g=t.attr("cspan"),p=t.attr("rspan");if(p===n.getNumberOfRows(E))return void editor.doc.execCmd("deltable");if(g&&g===n.getNumberOfColumns(E)){var p=t.attr("rspan");if(p>1){var R,O=e;for(R=1;R<p;R++)O.nextSibling().remove(),O=O.nextSibling()}}e.remove()}}},g=function(){try{if(editor.doc.getSelection().getSelectedCells().length>0)return void u();var e=editor.doc.getSelection().getParents(NODE_TYPE.CELL),t=e.parentNode(),i=t.previousSibling(),o=t.nextSibling(),r=n.getNumberOfRows(t.parentNode());if(!i&&!o||r==e.attr().rspan)return void editor.doc.execCmd("deltable");p(t,e);var a,i=t.previousSibling();if(i)para=i.firstChild().firstChild(),a=para.getEnd()-1;else{para=t.nextSibling().firstChild().firstChild();t.nextSibling().getStart()-t.getStart();a=para.getStart()-(t.nextSibling().getStart()-t.getStart())}}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_DELETE_ROW+"\nException: "+e.stack);var s=new Error(ZWCollaboration.TABLE_DELETE_ROW);throw editor.lastError=s,s}},f=function(e,i,o){try{var r=i[0],a=i.length,s=e.dtNode,l=e.children(),d=l.length,c=l[0].children().length;if(a===c)return void editor.doc.execCmd("deltable");var u,p,g,f,E,T,m,h,I={},_=[],A=[],S=[],a=i.length,R=i[i.length-1],O=s.isTableWidthInPercentage,b=n.getColumnRepeatInfo(s),v=(e.attr(ATTR_TABLE.TBLS_WID),0);S=n.getColumnWidthsInPx(e);var D={},L=n.getCols(e);L.splice(r,i.length);var N=L.length;if(O){for(g=0;g<N;g++)v+=parseFloat(L[g].wt);v=v.toFixed(3)+UNITS.PERCENTAGE}else{for(g=0;g<N;g++)v+=t.toPixels(L[g].wt);v=t.toGlobalValue(v+UNITS.PIXELS)}if(O){var g,P=[];for(g=0;g<N;g++)P.push({wt:100*parseFloat(L[g].wt)/parseFloat(v)+UNITS.PERCENTAGE});L=P}for(b&&n.updateColumnRepeatInfo(L,b,r,"delete"),D[ATTR_TABLE.TBLS_COLS]=L,I={},I[ATTR_TABLE.TBLS_WID]=v,I[ATTR_TABLE.TBLS_COLS]=L,u=0;u<d;u++){var C=[];for(p=0;p<c;p++)C.push(!1);_.push(C)}for(u=0;u<d;u++){row=l[u],A=row.children();var y=!1;for(p=r;p<=R;p++){if(f=A[p],E=f.attr(ATTR_CELL.TDS_MRG),f.attr(ATTR_COMMON.BORDERS)){var e=row.parentNode(),F=e.attr()[ATTR_COMMON.BORDERS],M=f.attr(ATTR_COMMON.BORDERS);if(F){var w=F[ATTR_BORDERS.BORDER_LEFT],U=F[ATTR_BORDERS.BORDER_RIGHT],x=M&&M[ATTR_BORDERS.BORDER_LEFT],B=M&&M[ATTR_BORDERS.BORDER_RIGHT];if(0==p&&w&&x){var H=f.nextSibling().attr()[ATTR_COMMON.BORDERS]||{};ZWJSONUtils.compareJSON(x,w)?H[ATTR_BORDERS.BORDER_LEFT]=x:H[ATTR_BORDERS.BORDER_LEFT]=B,f.nextSibling().attr({borders:H})}else if(p==A.length-1&&U&&B){var J=f.previousSibling().attr()[ATTR_COMMON.BORDERS]||{};ZWJSONUtils.compareJSON(B,U)?J[ATTR_BORDERS.BORDER_RIGHT]=B:J[ATTR_BORDERS.BORDER_RIGHT]=x,f.previousSibling().attr({borders:J})}}}if(E){if("fc"===E)cspan=f.attr(ATTR_CELL.TDS_CSPAN),cspan=cspan?cspan:1,T=f.attr(ATTR_CELL.TDS_RSPAN),T=T?T:1,p+cspan-1<=R?f.remove():(m=A[R+1],m.attr({merge:"fc",cspan:cspan-(R-p+1),rspan:T}),_[u][R+1]=!0,f.remove());else if("vmp"===E){if(m=A[R+1]){var G=m.attr(ATTR_CELL.TDS_MRG);if("hmp"===G){var k=!1;for(g=p;g<=R;g++){var W=A[g],Y=W.attr(ATTR_CELL.TDS_MRG);if("hmp"!==Y){k=!0;break}}k||m.attr({merge:"vmp"})}}f.remove()}else if("hmp"===E){if(!y){var z=p-1;for(h=f.previousSibling();h;){if("fc"==h.attr(ATTR_CELL.TDS_MRG)){if(z>=r&&z<=R)break;for(var Z=1,V=f.nextSibling();V&&"hmp"===V.attr(ATTR_CELL.TDS_MRG)&&Z+p<=R;)V=V.nextSibling(),Z++;cspan=h.attr(ATTR_CELL.TDS_CSPAN),h.attr({cspan:cspan-Z}),_[u][z]=!0;break}if("vmp"==h.attr(ATTR_CELL.TDS_MRG))break;h=h.previousSibling(),z--}y=!0}f.remove()}}else f.remove()}}var j=r-1;j<0?(j=0,f=l[0].children()[1]):f=l[0].children()[j];var X;if(f.attr(ATTR_CELL.TDS_MRG))for(h=f;h;){if("fc"==h.attr(ATTR_CELL.TDS_MRG)){X=h.getStart()+1;break}h=h.previousSibling()}else X=f.getStart()+1;o||(Op.cursorProcessed(),Op.processMsg(Op.getCursor(X,X))),n.setTableAttr(e,I)}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_DELETE_COLUMN+"\nException: "+e.stack);var K=new Error(ZWCollaboration.TABLE_DELETE_COLUMN);throw editor.lastError=K,K}},E=function(){var e=editor.doc.getSelection(),t=n.getColumnsToBeDeleted();f(e.getParents(NODE_TYPE.TABLE),t)},T=function(e,t){if(e){var i=e.parentNode(),n=i.nodeCountBefore(e),o=e.attr(ATTR_CELL.TDS_CSPAN);o=o?o:1;var r,a=[];for(r=0;r<o;r++)a.push(n+r);f(e.parentNode().parentNode(),a,t)}},m=function(e){var t;editor.doc.getTrackChangeDetails().setProcessingTC(!1),editor.doc.getSelection().getSelectedCells().length>0?E():(t=editor.doc.getSelection().getParents(NODE_TYPE.CELL),T(t,e)),editor.doc.getTrackChangeDetails().setProcessingTC(!0)},h=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.CELL),i=e.parentNode(),o=i.nodeCountBefore(e),r=i.parentNode();if("fc"==e.attr(ATTR_CELL.TDS_MRG)){var a=n.getCellWidth(e),s=!1,l=e.attr("rspan"),d=e.attr("cspan");l=l?l:1,d=d?d:1,a.indexOf(UNITS.PERCENTAGE)!==-1?(s=!0,a=parseFloat(a)):a=t.toPixels(a);var c,u=n.getColumnWidthsInPx(r),p=[],g=0,f=0,E=0;for(c=0;c<d;c++){var T=o+c;0!==u[T]?(p.push(u[T]),E+=u[T]):(p.push(0),g++)}if(g>0){var m=a-E;f=m/g,f=f.toFixed(3),f=s?f+UNITS.PERCENTAGE:t.toGlobalValue(f+UNITS.PIXELS)}for(var h=i,I=0,c=0;I<l;){var _=h.children();for(c=0;c<d;){var a,A=_[o+c];0!==p[c]?(a=p[c],a=s?a+UNITS.PERCENTAGE:t.toGlobalValue(a+UNITS.PIXELS)):a=f;var S={merge:"",wid:a};(A.attr(ATTR_CELL.TDS_CSPAN)||A.attr(ATTR_CELL.TDS_RSPAN))&&(S.cspan="",S.rspan=""),A.attr(S),c++}h=h.nextSibling(),I++}}},I=function(e,t){var i=editor.doc.getElementAt(e),o=DocTreeManager.getTreeNodeAtIndex(e),r=DocLayoutManager.getViews(o)[0],a=r.actualWidth,s={};s[ATTR_TABLE.TBLS_WID]=t+UNITS.PERCENTAGE;var l=n.getCols(i);o.isTableWidthInPercentage&&(a=parseFloat(editor.doc.getRawFormatAt(o.getIndex())[ATTR_TABLE.TBLS_WID]));var d,c=n.getColumnRepeatInfo(i.dtNode),u=[],p=l.length;for(d=0;d<p;d++)if(!o.isTableWidthInPercentage){var g=l[d].wt.convertor().pixels/a*t;ele={wt:g.toFixed(3)+UNITS.PERCENTAGE},u.push(ele),s[ATTR_TABLE.TBLS_COLS]=u}c&&s[ATTR_TABLE.TBLS_COLS]&&n.updateColumnRepeatInfo(s[ATTR_TABLE.TBLS_COLS],c),n.setTableAttr(i,s)},_=function(){try{var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE),i=t.getStart();I(i,100),e.removeTableSelection()}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_FIT_TO_WINDOW+"\nException: "+e.stack);var n=new Error(ZWCollaboration.TABLE_FIT_TO_WINDOW);throw editor.lastError=n,n}},A=function(e){var i=DocTreeManager.getTreeNodeAtIndex(e),o=DocLayoutManager.getViews(i)[0],r=o.actualWidth;tableStyle=editor.doc.getRawFormatAt(i.getIndex()),tableEle=editor.doc.getElementAt(e),cols=n.getCols(tableEle);var a,s=n.getColumnRepeatInfo(tableEle.dtNode),l={};l[ATTR_TABLE.TBLS_WID]=t.toGlobalValue(r+UNITS.PIXELS);var d=[],c=cols.length;if(n.isTableWidthInPercentage(tableStyle)){for(a=0;a<c;a++){var u=parseFloat(cols[a].wt)*parseFloat(t.toGlobalValue(r+UNITS.PIXELS))/100,p={wt:u+t.globalUnit};d.push(p)}s&&n.updateColumnRepeatInfo(d,s),l[ATTR_TABLE.TBLS_COLS]=d,n.setTableAttr(tableEle,l)}},S=function(){try{var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE),i=t.getStart();A(i),e.removeTableSelection()}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_FIXED_COLUMN_WIDTH+"\nException: "+e.stack);var n=new Error(ZWCollaboration.TABLE_FIXED_COLUMN_WIDTH);throw editor.lastError=n,n}},R=function(){for(var e=editor.doc.getSelection(),t=DocLayoutManager.getPageAtPageNumber(editor.currentPageIndex+1),i=(t.getContentContainerHeight()+"px").convertor().inches,o=e.getParents(NODE_TYPE.TABLE,e.getStart()),r=DocLayoutManager.getViews(o.dtNode),a=0,s=-1,l=-1,d=-1,c=o.dtNode.children.length,u=0;u<r.length;u++){var p=r[u];a+=p.getHeightWithoutBorders();for(var g=p.getRowsHeightWithoutBorders(),f=0;f<g.length;f++){var E=(g[f].ht+"px").convertor().inches;s<E&&(s=E,d=u,l=f)}}if(!(s==-1||s>i)){var T=r[d].getRowAt(l),m=0;if(T){for(var h,I=T.childViews.first;I;)h=I.getContentHeight(),m<h&&(m=h),I=I.next;var _=n.getCellsFromTable(o);m*c>a?O(_,m):O(_,a/c)}}},O=function(e,t){for(var t=(t+"px").convertor().inches,i=0;i<e.length;i++){var n=e[i];n.attr({ht:t+"in"})}},b=function(e,t){var i,n={},o={};switch(t){case"topleft":n[ATTR_CELL.TDS_VA]="top",n[ATTR_CELL.TDS_TXTAL]="left",o[ATTR_PARAGRAPH.PS_AL]="0";break;case"topcenter":n[ATTR_CELL.TDS_VA]="top",n[ATTR_CELL.TDS_TXTAL]="center",o[ATTR_PARAGRAPH.PS_AL]="1";break;case"topright":n[ATTR_CELL.TDS_VA]="top",n[ATTR_CELL.TDS_TXTAL]="right",o[ATTR_PARAGRAPH.PS_AL]="2";break;case"middleleft":n[ATTR_CELL.TDS_VA]="middle",n[ATTR_CELL.TDS_TXTAL]="left",o[ATTR_PARAGRAPH.PS_AL]="0";break;case"middlecenter":n[ATTR_CELL.TDS_VA]="middle",n[ATTR_CELL.TDS_TXTAL]="center",o[ATTR_PARAGRAPH.PS_AL]="1";break;case"middleright":n[ATTR_CELL.TDS_VA]="middle",n[ATTR_CELL.TDS_TXTAL]="right",o[ATTR_PARAGRAPH.PS_AL]="2";break;case"bottomleft":n[ATTR_CELL.TDS_VA]="bottom",n[ATTR_CELL.TDS_TXTAL]="left",o[ATTR_PARAGRAPH.PS_AL]="0";break;case"bottomcenter":n[ATTR_CELL.TDS_VA]="bottom",n[ATTR_CELL.TDS_TXTAL]="center",o[ATTR_PARAGRAPH.PS_AL]="1";break;case"bottomright":n[ATTR_CELL.TDS_VA]="bottom",n[ATTR_CELL.TDS_TXTAL]="right",o[ATTR_PARAGRAPH.PS_AL]="2"}e.attr(n);var r=editor.doc.getNodesInSelection(NODE_TYPE.PARAGRAPH,e.getStart(),e.getEnd()),a=r.length;for(i=0;i<a;i++)r[i].attr(o)},v=function(){try{var e,i=editor.doc.getSelection(),o=i.getParents(NODE_TYPE.TABLE),r=o.attr(),a=n.getCols(o),s=a.length,l=[],d=0,c=0,u=[],p=n.getColumnRepeatInfo(o.dtNode);if(l=i.getSelectedColumns(),0==l.length)for(e=0;e<s;e++)l.push(e);if(l.length<s&&i.isTableSelected())if(n.isTableWidthInPercentage(r)){for(var e=0;e<a.length;e++)l.contains(e)&&(d+=parseFloat(a[e].wt));for(c=parseFloat(d/l.length)+UNITS.PERCENTAGE,e=0;e<s;e++){var g;l.contains(e)?u.push({wt:c}):u.push({wt:a[e].wt})}}else{for(e=0;e<s;e++)l.contains(e)&&(d+=t.toPixels(a[e].wt));for(c=t.toGlobalValue(parseInt(d/l.length)+UNITS.PIXELS),e=0;e<s;e++){var g;l.contains(e)?u.push({wt:c}):u.push({wt:a[e].wt})}}else{var f=r[ATTR_TABLE.TBLS_WID];if(n.isTableWidthInPercentage(r)){f=100;var E=f/s;for(e=0;e<s;e++){var g={wt:E.toFixed(3)+UNITS.PERCENTAGE};u.push(g)}}else{var E=t.toGlobalValue((t.toPixels(f)/s).toFixed(3)+UNITS.PIXELS);for(e=0;e<s;e++){var g={wt:E};u.push(g)}}}p&&n.updateColumnRepeatInfo(u,p);var T={};T[ATTR_TABLE.TBLS_COLS]=u,n.setTableAttr(o,T),i.removeTableSelection()}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_DISTRIBUTE_COLUMNS+"\nException: "+e.stack);var m=new Error(ZWCollaboration.TABLE_DISTRIBUTE_COLUMNS);throw editor.lastError=m,m}},D=function(){var e=editor.doc.getSelection(),t=e[0].start,i=DocTreeManager.getParents(NODE_TYPE.CELL,t),n=i.getIndex()+UNICODE.CELL.length,o=i.getEndIndex(),r=editor.doc.getContent(n,o),a=r.length;if(a){for(var s=new DocOpBuilder,l=function(e,t,i){var n=[];n.push({r:e}),n.push({as:{start:t}}),n.push({is:i}),n.push({as:{end:ZWJSONUtils.getKeys(t)}}),s=DocOpBuilder.concise(DocOpBuilder.compose(s,DocOpBuilder.build(n)))},d=0,c=editor.doc.getRawFormatAt(n),u=1;u<a;u++){var p=editor.doc.getRawFormatAt(n+u);if(p){var g=r.substring(d,u);l(d,c,g),d=u,c=p}}var f=r.substring(d,a);f.length&&l(d,c,f);for(var E=[],T=[],m=DocTreeManager.getParents(NODE_TYPE.TABLE,t),h=m.children,I=h.length,u=0;u<I;u++)for(var _=h[u],A=_.children,S=A.length,R=0;R<S;R++){var i=A[R],O=i.getIndex()+UNICODE.CELL.length,b=i.getEndIndex();E.push([O,b]);var v=editor.doc.getRawFormatAt(O-1)||{};if(!v.merge||"fc"==v.merge){s=DocOpBuilder.clone(s);for(var D,L=s.docOps,N=L.length,P=0;P<N;P++){var C=L[P],y=L[P+1];if(y&&y.characters){var F=y.characters;F!=UNICODE.RANGE_START&&F!=UNICODE.IMAGE||(D=Utils.randomString())}if(C.isAnnotation()&&C.isAnnotationStart()){var M=C.styles.begin;M.id?M.id=D:M[ATTR_COMMON.FIELDINFO]&&(M[ATTR_COMMON.FIELDINFO]=D)}}s.docOps[0].skipChars(O),T.push(s)}}Op.tableComposeOps(T,E)}},L=function(e){if(n.isVerticalMergedRow(e))return!1;var t=e.nextSibling();return!!t&&(!n.isVerticalMergedRow(t)&&(P(e,t,!0),PubSub.publish("Document/TableStructureModified"),!1))},N=function(e){var t=e.previousSibling();return!!t&&(!n.isVerticalMergedRow(t)&&(P(e,t),PubSub.publish("Document/TableStructureModified"),!1))},P=function(e,t,i){var o=e.getStart(),r=e.getEnd(),a=OpUtil.getInsertionOps(editor.doc.createRange(o,r)),s=a.ops;n.handleSectionOpsArr(a.sectionOps),EventHandler.textDragStart=!0,editor.doc.getSelection().deleteContents(o,r),EventHandler.textDragStart=!1,i?s[0].r=t.getEnd():s[0].r=t.getStart();for(var l,d=Utils.randomString(),c=0;c<s.length;c++)if(s[c].as&&s[c].as.start&&"cell"==s[c].as.start.type)l=s[c].as.id;else if(s[c].as&&s[c].as.end&&s[c].as.id==l){s.splice(c+1,0,{as:{start:{type:"cursor",uuid:editor.uuid},id:d}});break}return s.push({as:{end:["type","uuid"],id:d}}),Op.cursorProcessed(),Op.processMsg(s),Op.sendMsg(),!1},C=function(e){var t=e.parentNode(),i=t.parentNode(),n=i.children(),o=(n.length,t.nodeCountBefore(e)),r=e.previousSibling();r&&F(r,!1,1,o,e)},y=function(e){var t=e.parentNode(),i=t.parentNode(),n=i.children(),o=(n.length,t.nodeCountBefore(e)),r=e.nextSibling();r&&F(r,!0,1,o,e)},F=function(t,i,r,a,s){try{var l,d,c,u,p,g,f,E=t.parentNode(),T=E.parentNode(),m=T.children(),h=m.length,I=E.nodeCountBefore(t),_=T.attr(ATTR_TABLE.TBLS_WID),A=[],S=[],R=n.getCols(T);S=R;var O=n.getColumnRepeatInfo(t.dtNode),b=S[a];S.splice(a,1),S.splice(I,0,b),O&&n.updateColumnRepeatInfo(S,O);var v={};v[ATTR_TABLE.TBLS_COLS]=S,v[ATTR_TABLE.TBLS_WID]=_;var D=(T.getStart(),0),L=Utils.randomString(),N=!1;for(c=0;c<h;c++){var P=m[c],C=P.children(),y=C.length;for(u=0;u<y;u++)if(u==I){var C=(editor.doc.createElement(NODE_TYPE.CELL),P.children()),F={},M=C[I];if(void 0==M)continue;0==c&&(l=M);var w,U=C[a],x=U.attr();i?(A.push({r:M.getEnd()-D}),D=M.getEnd()):(A.push({r:M.getStart()-D}),D=M.getStart());for(f in x)if("wid"!=f){var B=x[f];switch(f){case ATTR_CELL.TDS_RSPAN:x[ATTR_CELL.TDS_MRG]&&"fc"===x[ATTR_CELL.TDS_MRG]&&x[ATTR_CELL.TDS_RSPAN]&&x[ATTR_CELL.TDS_RSPAN]>1&&(F[f]=B);break;case ATTR_CELL.TDS_MRG:"vmp"==B?F[f]=B:"fc"===B&&x[ATTR_CELL.TDS_RSPAN]&&x[ATTR_CELL.TDS_RSPAN]>1&&(F[f]=B);break;case ATTR_CELL.TDS_WID:break;default:F[f]=B}}for(w=o.copyStyle(U.firstChild().attr()),d=0;d<r;d++){var H=Utils.randomString(),J=Utils.randomString();Utils.addId(F,"cl-",4),A.push({as:{start:F,id:H}}),A.push({is:UNICODE.CELL}),A.push({as:{end:ZWJSONUtils.getKeys(F),id:H}}),N||(A.push({as:{start:{type:"cursor",uuid:editor.uuid},id:L}}),N=!0);var G=C[a],k=editor.doc.createRange(G.getStart()+1,G.getEnd()-1),W=OpUtil.getInsertionOps(k),Y=W.ops;Y.length&&(Y=Y.slice(1)),n.handleSectionOpsArr(W.sectionOps),A=A.concat(Y),A.push({as:{start:w,id:J}}),A.push({is:UNICODE.PARA}),A.push({as:{end:ZWJSONUtils.getKeys(w),id:J}})}g||(p=F,g=M)}}A.push({as:{end:["type","uuid"],id:L}}),editor.doc.getSelection().removeTableSelection(),editor.doc.getTrackChangeDetails().setProcessingTC(!1),e.deleteColumn(s,!0),Op.processMsg(A),editor.doc.getTrackChangeDetails().setProcessingTC(!0),n.setTableAttr(T,v),Op.resetCursorPos(),Op.cursorProcessed(),Op.sendMsg()}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_INSERT_COLUMN+"\nException: "+e.stack);var z=new Error(ZWCollaboration.TABLE_INSERT_COLUMN);throw editor.lastError=z,z}},M=function(e,t){var i,n={rows:e[0],cols:e[1],cellVals:e[2]||void 0,cursor:1},o=editor.doc.createElement(NODE_TYPE.TABLE,n);o.setStart(editor.doc.getSelection().getStart()+1);var r=editor.doc.getSelection().getParents(NODE_TYPE.CELL);if(r){var a=editor.doc.getCursorPortionNode(editor.uuid,"start");i=J(a).parents("td")}o.setCursor(0,0),editor.doc.getSelection().insert(o,t),Op.cursorProcessed()},w=function(e,t){var i=editor.doc.getSelection().getParents(NODE_TYPE.TABLE),o=TableResize.getResizedCellIdx(e),r=TableResize.resizeColumnWidth(o,i,t);editor.doc.execCmd("applyStyle",[r.eleArr,r.styArr,o==n.getCols(i).length?"updateLastColumnWidth":"updateColumnWidth"])},U=function(e){if(e&&0!=e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t].attr().cantsplit;n&&n!==!1||e[t].attr({cantsplit:!0})}},x=function(e){if(e&&0!=e.length)for(var t=0,i=e.length;t<i;t++){var n=e[t].attr().cantsplit;n&&n===!0&&e[t].attr({cantsplit:""})}},B=function(e,t){if(e&&0!=e.length&&t)for(var i,n=0,o=e.length;n<o;n++)i=e[n].attr().htRule,i||(e[n].attr({htRule:"exact"}),G(e[n],t))},H=function(e,t){if(e&&0!=e.length){t=t||"";for(var i,n=0,o=e.length;n<o;n++)i=e[n].attr().htRule,i&&"exact"==i&&e[n].attr({htRule:""}),G(e[n],t)}},G=function(e,t){if(e){for(var i=e.children(),n=i.length,o=[],r=0;r<n;r++)o.push({ht:t});Command.exec("applyStyle",[i,o,"updateRowHeight"])}},k=function(){var e=editor.doc.getSelection(),t=DocLayoutManager.getLineAtIndex(e.getStart()),i=DomViewManager.getDOMElem(t),n=J(i).parents("td.zw-td")[0];e.selectCell(n).select()},W=function(e){if(!e||0==e.length)return[];for(var t=e[0],i=1;i<e.length;i++)t.applyOp(e[i]);return t.toJson()},Y=function(e,t){var i=[],n=editor.doc.getSelection(),o=editor.doc.getParents(NODE_TYPE.TABLE,e),r=o.dtNode;if((t.deleteEmptyRow||t.deleteEmptyColumn)&&r.isEmpty(t))return n.deleteContents(o.getStart(),o.getEnd()),i=i.concat(Op.msgBuffer),Op.resetBuffer(),W(i);var a,s=o.children();if(t.deleteEmptyRow){for(var l=s.length-1;l>=0;l--)a=s[l],a.dtNode.isEmpty(t)&&p(a);i=i.concat(Op.msgBuffer),Op.resetBuffer()}if(t.deleteEmptyColumn){for(var d,c=s&&s[0]&&s[0].children()||[],u=c.length,l=u-1;l>=0;l--)r.isColumnEmpty(l,t)&&(d=c[l],T(d));i=i.concat(Op.msgBuffer),Op.resetBuffer()}return W(i)},z={insertColumnAfter:a,insertColumnBefore:s,insertRowAfter:c,insertRowBefore:d,deleteRow:g,deleteColumns:f,deleteColumn:m,unMergeCells:h,fitToWindow:_,fixedColumnWidth:S,setCellAlign:b,distributeColumns:v,delRow:p,duplicateToAllCells:D,moveRowDown:L,moveRowUp:N,distributeRows:R,insertTable:M,cantSplitRow:U,removeCantSplitRow:x,rowHtRule:B,removeRowHtRule:H,setHeightForCellsInRow:G,moveColumn:F,moveColumnRight:y,moveColumnLeft:C,moveRow:P,updateCurrentColumn:w,selectCell:k,getDeletionOpsOnEmpty:Y};return extend(e,z),e}(TableActions,Conversions,TableUtil,DocUtil);var TableSplit=function(e,t,i){var n=function(){var n,o,r,a,s,l,d=editor.doc.getSelection().getParents(NODE_TYPE.CELL),c=d.parentNode(),u=c.parentNode(),p=u.children(),g=p.length,f=c.nodeCountBefore(d),E=t.findRowIdx(c)-1,T=(d.parentNode().parentNode().attr(),t.getCols(u)),m=t.getColumnRepeatInfo(u.dtNode),h=T[f].wt,I=[],_={},A=!1;h.indexOf(UNITS.PERCENTAGE)!==-1?(A=!0,h=parseFloat(h),o=h/2,o+=UNITS.PERCENTAGE):(o=e.toPixels(h),o/=2,o=e.toGlobalValue(o+UNITS.PIXELS));var S=0,R=[],O=d.attr(),b=O.cspan,v=O.rspan;if(O.merge&&"fc"==O.merge){if(b&&b>1)if(b%2==0)if(2==b){var D={};D[ATTR_CELL.TDS_MRG]="fc",D[ATTR_CELL.TDS_CSPAN]=1,d.attr(D);var L=d.nextSibling();D[ATTR_CELL.TDS_MRG]="fc",D[ATTR_CELL.TDS_CSPAN]=1,D[ATTR_CELL.TDS_RSPAN]=v?v:1,L.attr(D)}else{var D={};D[ATTR_CELL.TDS_MRG]="fc",D[ATTR_CELL.TDS_CSPAN]=b/2,d.attr(D);var N=t.findColIdx(d),I=c.children(),L=I[N+b/2-1];D[ATTR_CELL.TDS_MRG]="fc",D[ATTR_CELL.TDS_CSPAN]=b/2,D[ATTR_CELL.TDS_RSPAN]=v?v:1,L.attr(D)}else var D={}}else if(!b||1==b){for(l=0;l<g;l++){s=p[l],I=s.children(),d=I[f];var P=Utils.randomString(),C=Utils.randomString();if(l!==E){n=d.attr(),Utils.addId(n,"cl-",4),n[ATTR_CELL.TDS_MRG]="hmp",r=i.copyStyle(d.firstChild().attr()),R.push({r:d.getEnd()-S}),R.push({as:{start:n,id:P}}),R.push({is:UNICODE.CELL}),R.push({as:{end:ZWJSONUtils.getKeys(n),id:P}}),R.push({as:{start:r,id:C}}),R.push({is:UNICODE.PARA}),R.push({as:{end:ZWJSONUtils.getKeys(r),id:C}}),a=d.attr(ATTR_CELL.TDS_MRG);var _={};if(a){if("fc"===a)_[ATTR_CELL.TDS_CSPAN]=parseInt(d.attr(ATTR_CELL.TDS_CSPAN))+1,d.attr(_);else if("hmp"===a)for(firstCell=d.previousSibling();firstCell;){var y=firstCell.attr(ATTR_CELL.TDS_MRG);if("fc"===y){_[ATTR_CELL.TDS_CSPAN]=parseInt(firstCell.attr(ATTR_CELL.TDS_CSPAN))+1,firstCell.attr(_);break}if("vmp"===y)break;firstCell=firstCell.previousSibling()}}else _[ATTR_CELL.TDS_MRG]="fc",_[ATTR_CELL.TDS_CSPAN]=2,_[ATTR_CELL.TDS_RSPAN]=1,d.attr(_)}else n=d.attr(),Utils.addId(n,"cl-",4),r=i.copyStyle(d.firstChild().attr()),R.push({r:d.getEnd()-S}),R.push({as:{start:n,id:P}}),R.push({is:UNICODE.CELL}),R.push({as:{end:ZWJSONUtils.getKeys(n),id:P}}),R.push({as:{start:r,id:C}}),R.push({is:UNICODE.PARA}),R.push({as:{end:ZWJSONUtils.getKeys(r),id:C}});S=d.getEnd()}Op.processMsg(R),T.splice(f,1,{wt:o},{wt:o}),m&&t.updateColumnRepeatInfo(T,m,f,"insert","after",!1);var F={};F[ATTR_TABLE.TBLS_COLS]=T,t.setTableAttr(u,F)}};return{splitCells:n}}(Conversions,TableUtil,DocUtil);Replace.searchFor="",Replace.casesensitive=!1,Replace.backwards=!1,Replace.replaceStr="",Replace.replaceCount=0,Replace.searchIn="",Replace.pos=-1,Replace.replaceOn=!1,Replace.drawLineQueue=Replace.resultArray=[],Replace.drawLineIntervalId=void 0,Replace.navigator=void 0,Replace.quickSeekInfo={buttonBGColor:"#FFF500",buttonBRColor:"#FFAD00",focusClass:"animated",id:"Replace",overlayToBeAnimated:".replace-overlay"},Replace.mapAllMatchesToBulletin=function(){var e=[];U.each(Replace.resultArray,function(t){e.push({start:t[0],end:t[1]})}),Replace.quickSeekInfo.ranges=e,PubSub.publish("QuickSeek/showBarWithObj",Replace.quickSeekInfo)},Replace.getRegExForSearchStr=function(e){var t,i,n=e.length,o="";for(t=0;t<n-1;t++)i=Utils.escapeSplChars(e.charAt(t)),"]"===i&&(i="\\]"),o+="["+i+"]["+UNICODE.RANGE_START+"-"+UNICODE.RANGE_END+"]{0,}";i=e.charAt(n-1),o+="]"===i?"[\\]]":"["+Utils.escapeSplChars(i)+"]";var r="g";Replace.casesensitive||(r+="i");var a=new RegExp(o,r);return a},Replace.search=function(){var e=0,t=editor.doc.getDocumentContent(),i=Replace.searchFor,n=i.length,o=!1;if(0==n)return o;if(Replace.casesensitive||(t=editor.doc.getDocumentContent().toLowerCase(),i=Replace.searchFor.toLowerCase()),Replace.backwards){Replace.pos>0&&(t=t.substring(0,Replace.pos));var r,a,s,l,d,c,u=Replace.getRegExForSearchStr(i);if(r=t.substring(0,Replace.pos),a=u.exec(r),!a&&(r=editor.doc.getDocumentContent(),a=u.exec(r),!a))return-1;for(s=0,u.lastIndex=0,d=0,c=r.length+1;d+1<c;)l=parseInt((d+c)/2),u.lastIndex=l,a=u.exec(r),a?(d=l,u.lastIndex=l):(c=l,u.lastIndex=d);a=u.exec(r),e=a.index,a&&(n=a[0].length),e<0&&!Replace.replaceAllVal&&(t=editor.doc.getDocumentContent(),e=t.lastIndexOf(i))}else{var u=Replace.getRegExForSearchStr(i);u.lastIndex=Replace.pos;var p=u.exec(t);p?(e=p.index,n=p[0].length):Replace.replaceAllVal||(u.lastIndex=0,p=u.exec(t),p&&(e=p.index,n=p[0].length))}var g=editor.doc.getSectionStart(Replace.pos),f=editor.doc.getSectionEnd(Replace.pos);if(e>=0&&g<e&&e<f){var E=e,T=E+n,m=editor.doc.createRange(E,T);m.type=ZWRange.TYPE.FIND,editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(m),editor.jeditorPane.find("div.overlay").addClass("animated"),Replace.pos=editor.doc.getSelection().getEnd(),Replace.replaceOn=!0,o=!0}else Replace.replaceOn=!1;return o},Replace.updateCurrentPosition=function(){if(Replace.navigator||(Replace.navigator=J(".js_fnavigator")),!(Replace.pos<0)){var e=Replace.getRegExForSearchStr(Replace.searchFor),t=editor.doc.getSectionStart(Replace.pos),i=editor.doc.getSectionEnd(Replace.pos),n=editor.doc.getContent(t,i),o=0,r=0,a=n.match(e);if(a&&(o=a.length),o){var n=editor.doc.getContent(1,editor.doc.getSelection().getStart()),a=n.match(e);a&&(r=a.length),r!==o&&r++}Replace.navigator.text(r+" of "+o),Replace.foundText=o>0}},Replace.drawLine=function(e,t){var i=DocLayoutManager.getLeftAtIndex(e),n=DocLayoutManager.getLeftAtIndex(t),o=DocLayoutManager.getLineAtIndex(e);if(o){for(var r=[],a=DocLayoutManager.linesBetween(e,t),s=a.length,l=s>1,d=0;d<s;d++){o=a[d];var c=DomViewManager.getDOMElem(o),u=J(c),p=document.createElement("div");p.className="replace-overlay";var g={};l?0===d?(g.left=i,g.width=o.width-i):(g.left=0,g.width=o.width>=n?n:o.width):(g.left=i,g.width=n-i);var f=parseFloat(u.css("padding-top")||0)+"px";g.top=f,g.height=o.height-3,J(p).css(g).appendTo(u[0]),r.push(p)}return r}},Replace.searchString=function(e,t,i,n,o){if(e){var r=editor.doc.getContent(t,i);Replace.casesensitive||(r=r.toLowerCase(),e=e.toLowerCase());for(var a,s=Replace.getRegExForSearchStr(e),l=s.exec(r);l&&l.index>-1;)a=l.index,Replace.drawLineQueue.push([t+a,t+a+l[0].length]),s.lastIndex=a+l[0].length,l=s.exec(r);n||o?o&&(Replace.resultArray=Replace.resultArray.concat(Replace.drawLineQueue)):Replace.resultArray=U.clone(Replace.drawLineQueue),clearInterval(Replace.drawLineIntervalId),Replace.drawLineIntervalId=setInterval(function(){if(0===Replace.drawLineQueue.length)return clearInterval(Replace.drawLineIntervalId),void(n||Replace.mapAllMatchesToBulletin());var e=Replace.drawLineQueue.shift();Replace.drawLine(e[0],e[1])},10),Replace.updateCurrentPosition()}},Replace.find=function(e){PubSub.publish("QuickSeek/hideBarWithID","Selection"),e?Replace.pos=e:Replace.backwards?Replace.pos=editor.doc.getSelection().getStart():Replace.pos=editor.doc.getSelection().getEnd();var t=Replace.search();return t||(Replace.pos==editor.doc.getSelection().getEnd()?0==Replace.replaceCount&&PubSub.publish("Document/Warning",WARNING_MSG.REPLACE_NO_MATCHES_FOUND):(Replace.pos=0,t=Replace.search())),t},Replace.replace=function(){var e=Replace.replaceOn;if(e){e=!0;var t=editor.doc.getSelection().getEnd(),i=editor.doc.getSelection().getStart(),n=editor.doc.getDocumentContent(),o=(Replace.searchFor,n.substring(0,i)+Replace.replaceStr+n.substring(t));o==n&&Replace.searchFor!==Replace.replaceStr||(Replace.replaceOn=!1,Replace.replaceCount++,Replace.replaceText(i,t),Replace.searchIn=editor.doc.getDocumentContent(),Replace.pos=editor.doc.getSelection().getEnd())}else 0==Replace.replaceCount?PubSub.publish("Document/Warning",WARNING_MSG.REPLACE_NO_MATCHES_FOUND):Replace.replaceCount>0&&(PubSub.publish("Document/Warning",WARNING_MSG.REPLACE_SEARCH_COMPLETED_MSG,Replace.replaceCount),Replace.pos=0,Replace.replaceCount=0,Replace.replaceOn=!1);return e},Replace.replaceAll=function(){Replace.replaceAllVal=!0,Replace.pos=0;var e,t,i=editor.doc,n=i.getDocumentContent(),o=Replace.searchFor,r=o.length,a=0,s=i.getSectionStart(Replace.pos),l=i.getSectionEnd(Replace.pos),d=Replace.replaceStr,c=d.length,u=0;for(Replace.casesensitive||(n=n.toLowerCase(),o=o.toLowerCase());;){if(e=Replace.getRegExForSearchStr(o),e.lastIndex=a,t=e.exec(n),!t)break;if(a=t.index,r=t[0].length,a<s||a>l)break;var p=a,g=p+r,f=i.getContent(p,g),E=i.createElement(NODE_TYPE.TEXT,f);E.setStart(p),E.setEnd(g);var T=i.createElement(NODE_TYPE.TEXT,d);T.setStart(p),T.setEnd(p+c),DocUtil.replaceNodes(E,T),editor.doc.getTrackChangeDetails().getProcessingTC()&&(Op.sendMsg(),a+=c,n=i.getDocumentContent(),Replace.casesensitive||(n=n.toLowerCase()),s=i.getSectionStart(0),l=i.getSectionEnd(0)),a+=r,u++}0==u?PubSub.publish("Document/Warning",WARNING_MSG.REPLACE_NO_MATCHES_FOUND):u>0&&(Op.sendMsg(),PubSub.publish("Document/Warning",WARNING_MSG.REPLACE_SEARCH_COMPLETED_MSG,u),Replace.pos=0,Replace.replaceCount=0,Replace.replaceOn=!1),Replace.replaceAllVal=!1},Replace.replaceText=function(e,t){var i=editor.doc.getContent(e,t),n=editor.doc.createElement(NODE_TYPE.TEXT,i);n.setStart(e),n.setEnd(t);var o=editor.doc.createElement(NODE_TYPE.TEXT,Replace.replaceStr);if(o.setStart(e),o.setEnd(e+Replace.replaceStr.length),editor.doc.execCmd("replace",[n,o,!0]),editor.doc.getTrackChangeDetails().getProcessingTC()){var r=editor.doc.getSelection().getLastRange();r&&r.setStart(editor.doc.getSelection().getStart()+Replace.searchFor.length)&&r.setEnd(editor.doc.getSelection().getEnd()+Replace.searchFor.length)}Replace.find()},Replace.openFindMenu=function(e){ZWLogger.addToStatistics("FindIn"),Replace.addSubscribers();var t=J("#findToolbar"),i={"margin-top":0};t.css(i),e&&t.find("#find_advanced_option").hide(),EventHandler.isDialogOpened=!0,t.slideDown(100,function(){t.show().find("input").select(),J(this).show().find("input").focus(),setTimeout(function(){CurUtil.stopBlinking()},100)}),Replace.navigator=J(".js_fnavigator");var n=t.find("input");Replace.findAllTexts(n),n.unbind("input").bind("input",function(){Replace.findAllTexts(n)}).unbind("keydown").bind("keydown",function(e){var t=e.keyCode,i=String.fromCharCode(t).toLowerCase();if(t===KEYS.ENTER||t===KEYS.F3||(e.metaKey||e.ctrlKey)&&"g"===i)return Replace.findTextInDocument||Replace.findAllTexts(void 0,!0),e.shiftKey?(Replace.backwards=!0,Replace.find(editor.doc.getSelection().getStart())):(Replace.backwards=!1,Replace.find()),Replace.updateCurrentPosition(),!1;if(t===KEYS.ESC)return Replace.closeFindMenu(),!1;var t=e.keyCode,i=String.fromCharCode(t).toLowerCase();return(!e.metaKey&&!e.ctrlKey||"f"!==i)&&void 0}).focus(function(){EventHandler.isDialogOpened=!0,CurUtil.stopBlinking()}).blur(function(){EventHandler.isDialogOpened=!1,CurUtil.blinkCursor()});var o=Z("find_advanced_option");editor.getRole().permissions.can("document.edit")?o.show():o.hide()},Replace.findAllTexts=function(e,t){editor.jeditorPane.find("div.replace-overlay,div.animated").remove(),e&&(Replace.searchFor=Utils.removeUnWantedUnicodes(e.val())),Replace.findTextInDocument=!1,0==Replace.searchFor.length&&Replace.drawLineIntervalId&&(clearInterval(Replace.drawLineIntervalId),Replace.drawLineIntervalId=void 0,PubSub.publish("QuickSeek/hideBarWithID","Replace")),Replace.searchFor.length>0||t?(Replace.drawLineQueue=[],Replace.drawLineIntervalId&&(clearInterval(Replace.drawLineIntervalId),Replace.drawLineIntervalId=void 0),Replace.findTextInDocument=!0,setTimeout(function(){Replace.searchString(Replace.searchFor,0,editor.doc.getDocumentLength()),Replace.find(editor.doc.getSelection().getStart()),Replace.updateCurrentPosition()},500)):(Replace.updateCurrentPosition(),PubSub.publish("QuickSeek/hideBarWithID","Replace"))},Replace.findPrevious=function(){J("#findToolbar").find("input").select(),Replace.backwards=!0,Replace.findTextInDocument||Replace.findAllTexts(void 0,!0),Replace.find(editor.doc.getSelection().getStart()),Replace.updateCurrentPosition()},Replace.findNext=function(){J("#findToolbar").find("input").select(),Replace.findTextInDocument||Replace.findAllTexts(void 0,!0),Replace.backwards=!1,Replace.find(editor.doc.getSelection().getEnd()),Replace.updateCurrentPosition()},Replace.closeFindMenu=function(){PubSub.publish("QuickSeek/hideBarWithID","Replace");var e=J("#findToolbar");e.hide(),Replace.unsubscribe(),Replace.resultArray=[],ReplaceDialog.handleClose(),EditorUtil.focusMultiByteSpan()},Replace.findTextInPara=function(e){if(Replace.searchFor&&!Replace.replaceAllVal){var t=e.getIndex(),i=e.getEndIndex();DocTreeManager.doc.currentDocopBuilder&&"InsertChar"===DocTreeManager.doc.currentDocopBuilder.operation||i++,Replace.searchString(Replace.searchFor,t,i,!0,!1)}},Replace.findTextInLine=function(e){if(Replace.searchFor&&!Replace.replaceAllVal){var t=e.parent.getIndex();Replace.searchString(Replace.searchFor,t+e.start,t+e.end,!1,!0)}},Replace.addSubscribers=function(){PubSub.subscribe(DOCVIEW.PARAVIEW_AFTER_CREATE,Replace.findTextInPara),PubSub.subscribe(DOCVIEW.LINE_UPDATED,Replace.findTextInLine)},Replace.unsubscribe=function(){PubSub.unsubscribe(DOCVIEW.PARAVIEW_AFTER_CREATE,Replace.findTextInPara),PubSub.unsubscribe(DOCVIEW.LINE_UPDATED,Replace.findTextInLine)},PasteUtil=function(){"use strict";var e,t={},i={},n=J("#pasteToolbar"),o=(new RegExp(CONST.PASTE_DESTINATIONFORMAT+"|"+CONST.PASTE_SOURCEFORMAT+"|"+CONST.PASTE_TEXTONLYFORMAT),{});t[ATTR_TEXT.TS_FW]="none",t[ATTR_TEXT.TS_FS]="none",t[ATTR_TEXT.TS_TD]="none",t[ATTR_TEXT.TS_FGC]="rgb( 0, 0, 0 )",t[ATTR_TEXT.TS_BGC]="transparent",o[ATTR_PARAGRAPH.PS_AL]="0",o[ATTR_PARAGRAPH.PS_ML]="0in",o[ATTR_PARAGRAPH.PS_MR]="0in",o[ATTR_PARAGRAPH.PS_SA]="0in",o[ATTR_PARAGRAPH.PS_SB]="0in",o[ATTR_PARAGRAPH.PS_TI]="0in",o[ATTR_PARAGRAPH.PS_BGC]="transparent";var r=["merge","colspan","rowspan","cellpadding","src","href","target","align","width","start"],a=(new ZSEC.HTMLPurifier({GLOBAL_ATTRIBUTES:r,ALLOWED_STYLE:"ALL",STYLE_VALIDATION:!1}),["data-tab-info","data-keep-line-info","data-page-break-info","data-hd-info","data-textformat","data-codeformat","data_styles","data-hlist-type","data-custom_data","data-format","data-video-data","data-mminfo","data-crop-info","data-zw-imagesrc","data-thumbnail","data-hr-info","data-align","data-cols","data-width","data-theme","data-list-info","data-list-id","data-bullet-id","data-format-attr","data-section-info","data-footnote-info","data-endnote-info","section-bullet-format","section-list-format","data-spl-bullet-format","data-list-format","data-continue-list-id","data-continue-bullet-id","data-para-info","data-text-info","data-tab","data-white-space","data-bullet-info","data-writer-border-info","data-window-control-info","data-bgimg-name","data-mergefield-info","data-autofield-info","data-fillablefield-info","data-shapedata","data-range-char-type","data-comment-info","merge","colspan","rowspan","cellpadding","src","href","data-chartfield-info","target","align","latexexpression","imagesize","width","start","source","data-tag-info","data-display-type"]),s=new ZSEC.HTMLPurifier({ALLOWED_STYLE:"ALL",STYLE_VALIDATION:!1,GLOBAL_ATTRIBUTES:a,GLOBAL_TAGS:["#comment","iframe"],WHOLE_DOCUMENT:!0,TAG_RULES:{iframe:{NAME:"iframe",ATTRIBUTE_RULES:{sandbox:{NAME:"sandbox",NOT_CONTAINS:["allow-top-navigation","allow-popups-to-escape-sandbox"],DEFAULT_VALUE:"allow-popups allow-forms allow-scripts allow-same-origin allow-presentation"}},APPEND_ATTRIBUTES:[{NAME:"sandbox",VALUE:"allow-popups allow-forms allow-scripts allow-same-origin allow-presentation"}]}}}),l=function(){return s},d=function(){var e=editor.doc.getSelection();return e.getSelectedCells()},c=function(e){var t=document.createNodeIterator(e,NodeFilter.SHOW_TEXT);return!t.nextNode()&&e.getElementsByTagName("img").length>0},u=function(e){for(var t,i=e.childNodes,n=i.length,o=!1,r=[],a=0,s=0;t=i[s++];)if(t.nodeType!=Node.TEXT_NODE)if(t.nodeType!=Node.COMMENT_NODE){if(0==a&&(DomUtil.nodeNameEquals(t,"ol|ul")||DomUtil.nodeNameEquals(t,"p")&&t.classList.contains("zw-check-list-para")))a++,o=!0;else if(t.nodeType==Node.TEXT_NODE||t.nodeType==Node.ELEMENT_NODE){o=!1;break}}else r.push(t);else{var l=t.textContent;if(l=l.replace(/ *(\n+) */g,""),l=l.replace(/ *(\t+) */g,""),l=l.replace(/ *(\s+) */g,""),0!=l.length){o=!1;break}r.push(t)}if(o&&r.length)for(var s=0,d=r.length;s<d;s++){var c=r[s];c.parentNode.removeChild(c)}var u=J(e).find("p.zw-check-list-para");return o=!(!n||n!=u.length)||DomUtil.nodeNameEquals(e.childNodes[0],"ol|ul")},p=function(e){var t=!1,i=editor.doc.getSelection(),n=i.getParents(NODE_TYPE.TABLE);if(n){for(var o,r=e.childNodes,a=0,s=[],l=0;o=r[l++];)if(o.nodeType!=Node.TEXT_NODE)if(o.nodeType!=Node.COMMENT_NODE&&"style"!=o.nodeName.toLowerCase()){if(0==a&&DomUtil.nodeNameEquals(o,"table"))a++,t=!0;else if(o.nodeType==Node.TEXT_NODE||o.nodeType==Node.ELEMENT_NODE){t=!1;break}}else s.push(o);else{var d=o.textContent;if(d=d.replace(/ *(\n+) */g,""),d=d.replace(/ *(\t+) */g,""),d=d.replace(/ *(\s+) */g,""),0!=d.length){t=!1;break}s.push(o)}if(t&&s.length)for(var l=0,c=s.length;l<c;l++){var u=s[l];u.parentNode.removeChild(u)}}return n&&t},g=function(e){var t="";for(var i in UNICODE)"MULTIBYTE_SPACE"!=i&&"SPACE"!=i&&"MERGEFIELD_START"!=i&&"MERGEFIELD_END"!=i&&"PARA"!=i&&"TAB"!=i&&"HR"!=i&&(t=UNICODE[i],e=e.replace(new RegExp(t,"gi"),""));return e=e.replace(/\u2028|\u2029|\u200b|\u000d/gi,""),e=e.replace(/[\u0020\r\u00a0]/g," ")},f=function(){var e=Z("_zohoPaste")[0],t=document.createRange();window.getSelection().removeAllRanges(),t.selectNodeContents(e),window.getSelection().addRange(t)},E=function(e){var t=J(e).find("[data-doc-id]")[0];return t&&t.getAttribute("data-doc-id")==editor.doc.docInfo.DOCUMENT_ID},T=function(e){var t=J(e).find("[data-plain-text]")[0];return!!t},m=function(e){for(var t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),e=t.nextNode(),i=/[\n\s\r]/g,n=!1;e;){if("style"!=e.parentNode.nodeName.toLowerCase()&&e.parentNode.nodeType!=Node.COMMENT_NODE&&e.textContent.replace(i,"").length>0){n=!0;break}e=t.nextNode()}return n},h=function(e){var t=J(e).find("[data-doc-id]")[0];return!!t},I=function(){return _(),f(),!1},_=function(e){var t=Z("_zohoPaste"),i=editor.editorPaneContainer.scrollTop()/editor.zoomFactor,n=document.getElementById("zohoMultiByteSpan");i<=0&&(i=20),t.css({top:i,left:n?J(n).position().left:100,width:"200px",height:"1px",backgroundColor:"transparent"}).show(),t[0].innerHTML=e||"",t[0].contentEditable=!0,t[0].focus()},A=function(){var e=Z("_zohoPaste");e.hide()},S=function(){var e=J("#pastemenu"),t=PasteEventHandler.getRecentPasteOption(),i={0:"sourceFormat",1:"destinationFormat",2:"textOnly",3:"continueList",4:"pasteNewList",5:"mergeList",6:"newList",9:"screenplayPaste_fountain"};if("screenplay"==Macros.getDocumentType()){var n="9"==t?"screenplayPaste_fountain":"screenplayPaste_text";e.zmenu("setMenuItemsAttribute",Z(n),"checked",!0)}else PasteEventHandler.getPasteInfo().pasteOpnInfo.sheetTablePaste?e.zmenu("setMenuItemsAttribute",Z("sheetTablePaste_removelink"),"checked",!0):e.zmenu("setMenuItemsAttribute",Z(i[t]),"checked",!0)},R=function(e,t,i){J(e).find("img").removeAttr("onload onerror");var n=editor.doc.getSelection();n.isCollapsed()||(n.deleteSelectedContents(),Op.sendMsg()),Op.processMsg(L(e,t,i)),Op.sendMsg()},O=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.PARAGRAPH),i=null,n=t.attr();return t.dtNode.prev&&"para"==t.dtNode.prev.type&&(i=t.dtNode.prev.format),n.hasOwnProperty(ATTR_PARAGRAPH.PS_HD)||(n[ATTR_PARAGRAPH.PS_HD]=0),{textFormat:e.getTextFormat(),paraFormat:n,prevParaFormat:i}},b=function(e){var t=e.getElementsByTagName("img"),i=[],n=J.Deferred();t=Array.prototype.slice.call(t),t.forEach(function(e){var t=J.Deferred();i.push(t.promise());var n=e.getAttribute("src");x(n,function(i){e.setAttribute("width",i[ATTR_IMAGE.I_WID]+"px"),e.setAttribute("height",i[ATTR_IMAGE.I_HT]+"px"),t.resolve()})});var o=function(){return PasteEventHandler.uploadExtImg(e),WriterContentBuilder.parseHTML(e)};return i.length?J.when.apply(null,i).done(function(){n.resolve(o())}):n.resolve(o()),n.promise()},v=function(e){var t=document.getElementById("insertHTML"),i=Utils.randomString(),n=J("iframe#"+i)[0];n||(n=t.cloneNode(),n.setAttribute("id",i),n.setAttribute("name",Utils.randomString()),document.body.appendChild(n));var o=PasteUtil.getHtmlSanitizer();return PasteEventHandler.setContentInIframe(n,o.sanitize(e)),n.contentWindow.document.body},D=function(e){var t,i,n=e.htmlString,o=e.additionalInfo,r=v(n);return o&&o.shouldProcessAfterImgLoad?i=b(r):(o||(o={},o.isWriterDocument=PasteUtil.isWriterDocumentContent(r),o.isSameDoc=o.isWriterDocument&&PasteUtil.isSameDocumentPaste(r)),o.selection=editor.doc.getSelection(),t=WriterContentBuilder.parseHTML(r,o)),{opJson:t,promise:i}},L=function(e,t,i,n){var o=D({htmlString:e.innerHTML,additionalInfo:i});if(!o.opJson)return[];var r=editor.doc.getSelection(),a=n?n:r.getStart(),s=PasteUtil.getComposedDocOp(o.opJson,a);return u(e)&&(t=CONST.PASTE_MERGELIST),t&&t!=CONST.PASTE_SOURCEFORMAT&&(s=PasteUtil.getProcessedDocOpForPasteOption(s,t,O())),s.toJson()},N=function(e,t){var i;return i=DocOpBuilder.xform(e,t),e=DocOpBuilder.compose(e,i.second),DocOpBuilder.concise(e)},P=function(e,t){var i,n,o=editor.doc.getDocumentLength(),r=e.bodyFormat,a=e.sectionOp,s=e.mainSection,l=e.namedRangeInfo;if(t&&s.unshift({r:t}),s=r?r.concat(s):s,n=DocOpBuilder.build(s),U.isEmpty(a)||(a.unshift({r:o}),i=DocOpBuilder.build(a),n=N(n,i)),!U.isEmpty(l)){var d=DocOpBuilder.build(l),c=d.docOps[0];c.retain_count=t+c.retain_count,PubSub.publish("PasteUtil/namedRange",d),n=DocOpBuilder.compose(n,d)}return n},C=function(e,t){for(var i in e)t.hasOwnProperty(i)&&delete t[i]},y=function(e,i,n){var r=e.docOps,a={},s=r.length,l=new DocOpBuilder,d=n.textFormat,c=n.paraFormat,u=null,p=DocUtil.mergeObjs([t,n.computedTextFormat]),g=DocUtil.mergeObjs([o,n.computedParaFormat]);i==CONST.PASTE_MERGELIST&&(u=ListUtils.isList(c)?c:n.prevParaFormat);for(var f=0;f<s;f++){var E,T,m,h=DocOp.clone(r[f]);if(h.isAnnotationStart())switch(E=h.styles,m=E.begin.type){case NODE_TYPE.PARAGRAPH:var T=E.begin;if(i==CONST.PASTE_TEXTONLYFORMAT)E.begin=c;else if(i==CONST.PASTE_DESTINATIONFORMAT){var I=DocUtil.copyStyle(T);if(!T.hasOwnProperty(ATTR_PARAGRAPH.PS_CODE)&&ListUtils.isList(T)){var _=[ATTR_PARAGRAPH.PS_ML,ATTR_PARAGRAPH.PS_TI,ATTR_PARAGRAPH.PS_PL],A=U.omit(c,_);C(U.omit(g,_),T),E.begin=DocUtil.mergeObjs([T,A])}else T.hasOwnProperty(ATTR_PARAGRAPH.PS_CODE)&&!g.hasOwnProperty(ATTR_PARAGRAPH.PS_CODE)||(C(g,T),E.begin=DocUtil.mergeObjs([T,c]));I.hasOwnProperty(ATTR_PARAGRAPH.PS_LINE_RULE)&&(T[ATTR_PARAGRAPH.PS_LINE_RULE]=I[ATTR_PARAGRAPH.PS_LINE_RULE],T[ATTR_PARAGRAPH.PS_LS]=I[ATTR_PARAGRAPH.PS_LS])}else i==CONST.PASTE_CONTINUELIST&&ListUtils.isList(T)?(E.begin[ATTR_PARAGRAPH.LS_DATA][ATTR_COMMON.ID]=E.begin["continue-list-id"],E.begin[ATTR_PARAGRAPH.LS_DATA][ATTR_PARAGRAPH.BULLET_ID]&&E.begin.hasOwnProperty("continue-bullet-id")&&(E.begin[ATTR_PARAGRAPH.LS_DATA][ATTR_PARAGRAPH.BULLET_ID]=E.begin["continue-bullet-id"])):ListUtils.isList(T)&&i==CONST.PASTE_MERGELIST&&u&&(E.begin[ATTR_PARAGRAPH.LS_DATA]=u[ATTR_PARAGRAPH.LS_DATA],E.begin[ATTR_PARAGRAPH.PS_ML]=u[ATTR_PARAGRAPH.PS_ML],E.begin[ATTR_PARAGRAPH.PS_TI]=u[ATTR_PARAGRAPH.PS_TI],E.begin[ATTR_PARAGRAPH.PS_TYPE]=u[ATTR_PARAGRAPH.PS_TYPE]);a[E.id]=Object.keys(E.begin);break;case NODE_TYPE.TEXT:var T=E.begin;i==CONST.PASTE_TEXTONLYFORMAT?E.begin=DocUtil.mergeObjs([T,d]):i==CONST.PASTE_DESTINATIONFORMAT&&(T.hasOwnProperty("parent")&&T.parent==ATTR_PARAGRAPH.PS_CODE||(C(p,T),E.begin=DocUtil.mergeObjs([T,d]))),a[E.id]=Object.keys(E.begin)}else if(h.isAnnotationEnd()){var S;E=h.styles,S=E.id,a.hasOwnProperty(S)&&(E.end=a[S])}l.push(h)}return l},F=function(e){for(var t=e.childNodes,i=t.length,n=0;n<i;n++){var o=t[n];if(HTMLUtil.isInlineElement(o)){for(var r=document.createElement("p");e.firstChild;)r.appendChild(e.firstChild);e.appendChild(r);break}}},M=function(e,t){i[e]=t},w=function(e){return i[e]},x=function(e,t){var i=document.createElement("img");i.onload=function(e){var i=e.target,n={wid:i.naturalWidth,ht:i.naturalHeight,orginalWid:i.naturalWidth,orginalHt:i.naturalHeight};PubSub.publish("loadedImageStyles",n),t(n)},i.onerror=function(e){var i=(e.target,{wid:250,ht:150,orginalWid:250,orginalHt:150});PubSub.publish("loadedImageStyles",i),t(i)},i.setAttribute("src",e)},B=function(e){for(var t=e.docOps,i=0,n=t.length,o=new XFormMap,r=[],a=0;a<n;a++){var s=t[a];if(i+=s.isRetain()?s.retain_count:0,i+=s.isInsert()?s.characters.length:0,s.isAnnotationStart()){var l=s.styles,d=l.begin;if(d.type==NODE_TYPE.IMAGE&&d.tempId){var c=Utils.randomString(),u=[{r:i},{as:{start:d,id:c}},{r:1},{as:{end:Object.keys(d),id:c}}];o.putOp(DocOpBuilder.build(u),c)}}}o.enableAutoUpdate(),U.each(o.map,function(e,t){var i,n=J.Deferred(),a=o.getOp(t),s=a.docOps[1].styles.begin,l=s.src;i=PasteEventHandler.getSourceURLInfo(l),x(i,function(e){a=o.getOp(t),extend(s,e),M(i,s),a.docOps[1].styles.begin=s,a.docOps[3].styles.end=Object.keys(s),n.resolve()}),r.push(n.promise())}),r.length&&J.when.apply(null,r).done(function(){for(var e in o.map){var t=o.map[e];Op.processMsg(t.toJson())}editor.lastOperation=COMMAND.IMAGE_STYLE_OP,Op.sendMsg(),o.flushOp(),o=void 0})},H=function(e,t){if(!t){var i=document.createElement("span");return i.innerText=" ",i.setAttribute("class","EOP"),e.appendChild(i),!1}for(var n=t.split(UNICODE.TAB),o=0,r=n.length;o<r;o++){if(""!=n[o]){var i=document.createElement("span");i.innerText=n[o],i.setAttribute("data-text-info",JSON.stringify({type:"text"})),e.appendChild(i)}if(o<r-1){var a=document.createElement("span"),s={st:NODE_TYPE.TAB,type:NODE_TYPE.TEXT,leader:"0"};a.innerText="\t",a.setAttribute("data-text-info",JSON.stringify(s)),a.setAttribute("data-writer-tab",JSON.stringify({cls:"Apple-tab-span"})),e.appendChild(a)}}},G=function(e){for(var t,i=e.split(UNICODE.PARA),n=document.createDocumentFragment(),o=0,r=i.length;o<r;o++)o<r-1?(t=document.createElement("p"),t.setAttribute("data-para-info",JSON.stringify({type:"paragraph"})),n.appendChild(t)):t=n,H(t,i[o]);var a=document.createElement("div");return a.appendChild(n),a.firstElementChild&&a.firstElementChild.setAttribute("data-plain-text",!0),a.innerHTML},k=function(e,t){var i=new XFormMap,n=Utils.randomString();i.putOp(e,n),i.enableAutoUpdate(),UIUtils.hidePasteToolbar(),Notification.show({message:"writer.sheet.LINK_TABLE_SHEET",close:!0,setTimer:!1,type:"info"});var o=function(e){Notification.hide();var o=i.map[n],r=o.docOps[4].styles.begin;e[ATTR_TABLE.TBLS_COLS]=DocUtil.copyStyle(r[ATTR_TABLE.TBLS_COLS]),r[ATTR_TABLE.SHEET_RANGE_INFO]=e,o.docOps[4].styles.begin=r,o.docOps[6].styles.end=Object.keys(r),t.resolve(o),i.flushOp(),i=void 0},r=function(){Notification.show({message:"writer.sheet.UNABLE_TO_LINK_SHEET_TABLE",close:!1,setTimer:!0,type:"error"});var e=i.map[n];t.resolve(e),i.flushOp(),i=void 0},a=ZWNetworkUtils.getContextUrl("v1/chart/"+Macros.getRId()+"/gettableclipdata");J.ajax({type:"POST",global:!1,async:!0,url:a,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){o(e)},error:function(e,t,i){r()}})},W=function(e,t){var i=new XFormMap,n=Utils.randomString();i.putOp(e,n),i.enableAutoUpdate(),UIUtils.hidePasteToolbar(),Notification.show({message:"writer.chart.PASTE_CHART_MSG",close:!0,setTimer:!1,type:"info"});var o=function(e){Notification.hide();var o=i.map[n],r=o.docOps[1].styles.begin;r[ATTR_CHART.SHEET_ID]=e.rid,r[ATTR_CHART.CHART_ID]=e.chartid,r[ATTR_COMMON.SUBTYPE]="chart",o.docOps[1].styles.begin=r,o.docOps[3].styles.end=Object.keys(r),t.resolve(o),i.flushOp(),i=void 0},r=function(){Notification.show({message:"writer.chart.UNABLE_TO_PASTE_CHART",close:!1,setTimer:!0,type:"error"});var e=i.map[n];t.resolve(e),i.flushOp(),i=void 0},a=ZWNetworkUtils.getContextUrl("v1/chart/"+Macros.getRId()+"/getchartclipdata");J.ajax({type:"POST",global:!1,async:!0,url:a,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){e.rid&&e.chartid?o(e):r()},error:function(e,t,i){r()}})},Y=function(e){var t=[],i={type:NODE_TYPE.SECTION,st:e.type,sid:e.id},n=Utils.randomString();return t.push({as:{start:i,id:n}},{is:UNICODE.SECTION_START},{as:{end:ZWJSONUtils.getKeys(i),id:n}}),t},z=function(e){e.contentWindow.document.body;if(!U.isEmpty(DocumentDesign.getComputedParaStyle("h0"))){var t=DocumentDesign.getComputedParaStyle("h0"),i=t.textFormat,n=["fontWeight","fontSize","fontFamily","fontStyle","color","text-decoration","backgroundColor","verticalAlign","letter-spacing","fontVariant"],o=["textAlign","textIndent","lineHeight"],r=["marginRight","marginTop","marginBottom","marginLeft","paddingLeft","paddingRight","paddingTop","paddingBottom"],a="";for(var s in r){switch(s=r[s]){case"marginRight":var l=t[ATTR_PARAGRAPH.PS_MR]||"0in";a+="margin-right : "+l+";";break;case"marginTop":var l=t[ATTR_PARAGRAPH.PS_MT]||"0pt";a+="margin-top : "+l+";";break;case"marginBottom":var l=t[ATTR_PARAGRAPH.PS_MB]||"0pt";a+="margin-bottom : "+l+";";break;case"marginLeft":var l=t[ATTR_PARAGRAPH.PS_MB]||"0in";a+="margin-left : "+l+";";break;case"paddingLeft":var l=t[ATTR_PARAGRAPH.PS_PL]||"0in";a+="padding-left : "+l+";";break;case"paddingRight":var l=t[ATTR_PARAGRAPH.PS_PR]||"0in";a+="padding-right : "+l+";";break;case"paddingTop":var l=t[ATTR_PARAGRAPH.PS_PT]||"0in";a+="padding-top : "+l+";";break;case"paddingBottom":var l=t[ATTR_PARAGRAPH.PS_PB]||"0in";a+="padding-bottom : "+l+";"}a+="\n"}var d=" body * :not(td){ \n"+a+"}";a="";for(var s in o){switch(s=o[s]){case"textAlign":var l=TEXT_ALIGN[t[ATTR_PARAGRAPH.PS_AL]]||"left";a+="text-align : "+l+";";break;case"textIndent":var l=t[ATTR_PARAGRAPH.PS_TI]||"0in";a+="text-indent : "+l+";";break;case"lineHeight":var l=parseFloat(t[ATTR_PARAGRAPH.PS_LS])||"normal";a+="line-height : "+l+";"}a+="\n"}var c="";for(var s in n){switch(s=n[s]){case"fontWeight":var l=i[ATTR_TEXT.TS_FW]||"normal";c+="font-weight : "+(isNaN(l)&&FONT_WEIGHT[l]||l)+";";break;case"fontSize":var l=i[ATTR_TEXT.TS_SIZE];c+="font-size : "+l+"pt;";break;case"fontFamily":var l=i[ATTR_TEXT.TS_FF];c+="font-family : "+l+";";break;case"fontStyle":var l=i[ATTR_TEXT.TS_FS]||"normal";c+="font-style : "+l+";";break;case"color":var l=i[ATTR_TEXT.TS_FGC]||"rgb(0, 0, 0)";c+="color : "+l+";";break;case"text-decoration":var l=i[ATTR_TEXT.TS_TD]||"none";c+="text-decoration : "+l+";";break;case"backgroundColor":var l=i[ATTR_TEXT.TS_BGC]||"transparent";c+="background-color : "+l+";";break;case"verticalAlign":var l=i[ATTR_TEXT.TS_VA]||"baseline";c+="vertical-align : "+l+";";break;case"letter-spacing":var l=i[ATTR_TEXT.TS_CS]||"0pt";c+="letter-spacing : "+l+";";break;case"fontVariant":var l=i[ATTR_TEXT.TS_FV]||"normal";c+="font-variant : "+l+";"}c+="\n"}d+=" body{ \n"+c+"\n"+a+"}";var u=J(e.contentWindow.document).find("style#styleforeditor"),p=u[0];if(!p){var g=e.contentWindow.document.head;p=DomUtil.createStyleTag(d),p.id="styleforeditor",g.appendChild(p)}var f,E=editor.doc.getSelection();if(DocLayoutManager)f=DocLayoutManager.getFirstSection().getWidth(),E&&(f=DocLayoutManager.getContentWidthAtIndex(E.getStart()));else{var T,m=DocTreeManager.getSectionAtIndex(0);E?(T=DocTreeManager.getTreeNodeAtIndex(E.getStart()).getSection(),T.getSectionType()!=SECTION_TYPES.CONTENT&&(T=m)):T=m,f=T.getContentWidth()}J(e).css({width:f})}},V=function(e){for(var t=e,i="ul|ol";t;){if(t.parentElement&&i.match(t.parentElement.tagName.toLocaleLowerCase()))return t;t=t.parentElement}return e},j=function(t){var i=HTMLUtil.getParentNode(t,"button");("paste-option-split-button"==t.id||i&&"paste-option-split-button"==i.id)&&(e="paste-option-split-button")},X=function(){return e},K=function(){e=void 0};return{getHtmlSanitizer:l,pasteToolbar:n,getSelectedCells:d,positionPasteDiv:_,updatePasteOptionsMenu:S,preparePasteDiv:I,isSameDocumentPaste:E,isPlainTextPaste:T,focusPasteDiv:f,hidePasteDiv:A,isTablePaste:p,hasTextNodes:m,isListPaste:u,isImagePaste:c,convertTabletoSheetTable:k,processCellContent:F,insertCustomContent:R,getComposedOpForCustomContent:L,getOpForCustomConent:D,getComposedDocOp:P,getProcessedDocOpForPasteOption:y,setImageCache:M,getImageCache:w,processDocOpForUnloadedImage:B,getHTMLFromTextString:G,removeDocUniCodes:g,setStylesInFrame:z,getSectionCharOp:Y,isWriterDocumentContent:h,convertImageToChart:W,getLsNode:V,getCursorFormats:O,setContextItemClicked:j,getContextItemClicked:X,clearContextItemClicked:K}}();var WriterPasteHandler=function(){"use strict";var e=null,t=function(e){if(!e)return"";e=e.replace(/'|"/g,"");var t=Utils.getFontFamilies(e);if(Utils.isCustomFont(t)){var i=Utils.getCustomFont(t),n=FontUtils.getWebFont(i.fallback);t+=","+n.getFontName()}return t},i=function(e){if(!e||!e.selection)return!1;var t=e.selection.getParents(NODE_TYPE.SECTION),i=t.subType;return"endnote"==i||"footnote"==i?i:void 0},n=function(e,t){for(var i=e.length,n=i-1;n>0;n--)if(e[n].type==t)return e[n]},o=function(e,t){var i=e.style.imgInfo,n=t&&t.selection?ZWImageUtils.getNewDimensionBasedOnContainer(i[ATTR_IMAGE.I_WID],i[ATTR_IMAGE.I_HT]):{};i[ATTR_IMAGE.I_ORGINALWID]=i[ATTR_IMAGE.I_WID]="undefined"!=typeof n.width?n.width:i[ATTR_IMAGE.I_WID],i[ATTR_IMAGE.I_ORGINALHT]=i[ATTR_IMAGE.I_HT]="undefined"!=typeof n.height?n.height:i[ATTR_IMAGE.I_HT],i[ATTR_IMAGE.I_ID]||(i[ATTR_IMAGE.I_ID]=Utils.getRandomNumber()),e.style.chartInfo&&ZWJSONUtils.mergeJsonObjs(i,e.style.chartInfo);for(var o in i)o!=ATTR_IMAGE.I_ML&&o!=ATTR_IMAGE.I_MT&&o!=ATTR_IMAGE.I_MB&&o!=ATTR_IMAGE.I_MR||i[o].indexOf("in")!=-1||i[o].indexOf("mm")!=-1?o==ATTR_IMAGE.I_OP&&(i[o]=100*i[o]):i[o]=Conversions.toGlobalValue(i[o]);if(e.style.hasOwnProperty("sheetInfo")&&t.isSameDoc){e.type=NODE_TYPE.WIDGET,e.style.iframeInfo={};for(var o in i)e.style.iframeInfo[o]=i[o];e.style.iframeInfo[ATTR_WIDGET.THUMBNAIL]="true",e.style.iframeInfo[ATTR_WIDGET.TYPE]="image",e.style.iframeInfo[ATTR_WIDGET.SUBTYPE]=ATTR_WIDGET.WIDGET,e.style.iframeInfo.sheetInfo=e.style.sheetInfo,delete e.style.imgInfo}if(e.style.hasOwnProperty("signerfieldInfo")){var r=e.style.signerfieldInfo;e.style.imgInfo.signService=r.signService,e.style.imgInfo.signType=r.signType,e.style.imgInfo.sfInfo=r.sfInfo,e.style.imgInfo.cls=r.cls,e.style.imgInfo.id=Utils.getRandomNumber(),e.style.imgInfo.sfInfo.id=Utils.randomString(),e.style.signerfieldInfo.src=" "}},r=function(e){var t=ZWImageUtils.getNewDimensionBasedOnContainer(e[ATTR_IMAGE.I_WID],e[ATTR_IMAGE.I_HT]);e[ATTR_IMAGE.I_ORGINALWID]=e[ATTR_IMAGE.I_WID]="undefined"!=typeof t.width?t.width:e[ATTR_IMAGE.I_WID],e[ATTR_IMAGE.I_ORGINALHT]=e[ATTR_IMAGE.I_HT]="undefined"!=typeof t.height?t.height:e[ATTR_IMAGE.I_HT]},a=function(e,t){var i=t&&t.selection&&editor.doc.model&&editor.doc.getParents(NODE_TYPE.CELL,t.selection.getStart()),o=e.style,r=o.tableInfo,a=o.tableName||"",s=r.width,l=s.indexOf("%")!=-1;r.theme=r.theme?r.theme:{themeName:"theme1",themeObj:TableNewThemeInfo.theme1};var d=0,c=parseFloat(TableUtil.getMinCellWidth().convertUnitTo(Conversions.globalUnit).toFixed(3)),u=e.parents,p="cell"==u[u.length-1].type,g=0;if(r.ml&&(g=parseFloat(r.ml.convertUnitTo(Conversions.globalUnit).toFixed(3)),r.ml=g+Conversions.globalUnit),o.bgimgName&&(r[ATTR_TABLE.TBLS_BGIMG_NAME]=o.bgimgName),!a||TableCollectionInstance.isAlreadyExistingTableName(a)?r.name=TableCollectionInstance.getNewTableName():r.name=a,p){var f=n(u,"table"),E=n(u,"cell"),T=0,m=1,h=Conversions.defaultCellPadding,I=Conversions.defaultCellPadding;if(E&&E.style){var _=E.style;_.matrixPosition&&(T=E.style.matrixPosition[1]);var A=_.cellInfo;A.cspan&&(m=_.cellInfo.cspan),A.pl&&(h=A.pl),A.pr&&(I=A.pr)}var S=f.style.tableInfo.cols;if(m>1)for(var R=S.length,O=T;O<R&&m>0;O++,m--)d+=parseFloat(Conversions.toGlobalValue(S[O].wt));else d=parseFloat(Conversions.toGlobalValue(S[T].wt));var b=parseFloat(Conversions.toGlobalValue(h))+parseFloat(Conversions.toGlobalValue(I));d-=b}else if(i){var v=DocLayoutManager.getViews(i.dtNode)[0];d=parseFloat(Conversions.toGlobalValue(v.width+"px"))}else if(editor.doc.model){var D,L=0;if(DocLayoutManager){var N=editor.doc.getSelection(),P=N?DocLayoutManager.getCurrentSection():DocLayoutManager.getFirstSection();D=P.getWidth(),L=P.getRight()}else{var P=DocTreeManager.getSectionAtIndex(0);D=P.getContentWidth()}var C=parseFloat(Conversions.toGlobalValue(D.toFixed(2)+"px")),y=L+"px"||"0in";y=parseFloat(y.convertUnitTo(Conversions.globalUnit).toFixed(3)),d=C+y-g}var F=r.cols,M=F.length,w=[];if(!l){s=parseFloat(Conversions.toGlobalValue(s));for(var U=0,O=0;O<M;O++){var x=parseFloat(parseFloat(Conversions.toGlobalValue(F[O].wt)).toFixed(3));if(s>d){var B=parseFloat((x/s*100).toFixed(3)),H=parseFloat((d*B/100).toFixed(3));F[O].wt=H+Conversions.globalUnit}else F[O].wt=x+Conversions.globalUnit;t&&!t.isWriterDocument&&parseFloat(F[O].wt)<c&&(F[O].wt=c+Conversions.globalUnit),U+=parseFloat(F[O].wt)}s=U+Conversions.globalUnit}for(var J=0;J<F.length;J++)w.push(F[J]);o.hasOwnProperty("sheetRangeInfo")&&(r[ATTR_TABLE.SHEET_RANGE_INFO]=o.sheetRangeInfo),r.cols=w,r.wid=s,delete r.width},s=function(t){var i=t.style,n=i.rowInfo;e=JSON.stringify(n||{});for(var o in n)"type"!=o&&"id"!=o&&"htRule"!=o&&"mminfo"!=o&&delete n[o]},l=function(t){var i=t.parents,o=n(i,"table"),r=(n(i,"row"),o.style),a=t.style,s=r.tableInfo,l=JSON.parse(e),d=a.cellInfo,c=l.borders||{},u=s.borders||{},p=o.style.childrenCount;TableUtil.deriveCellBordersOnPaste(d,a.matrixPosition,u,c,p.rows,p.cols),!d.z_td_bgc&&l.bgc&&(d.z_td_bgc=l.bgc),a.cellHeight&&(delete d.ht,"auto"!=a.cellHeight&&(d.ht=a.cellHeight)),a.bgimgName&&(d[ATTR_CELL.TDS_BGIMG_NAME]=a.bgimgName);for(var g in d)switch(g){case"pl":case"pr":d[g]?d[g]=Conversions.toGlobalValue(d[g]):d[g]=Conversions.toGlobalValue("0px");break;case"pb":case"pt":d[g]?d[g]=Conversions.toGlobalValue(d[g]):d[g]=Conversions.toGlobalValue("0px");break;case"ht":d[g]=Conversions.toGlobalValue(d[g])}},d=function(e){var t=e.style.shapedata,i=e.style.imgInfo;i[ATTR_IMAGE.I_ID]||(i[ATTR_IMAGE.I_ID]=Utils.getRandomNumber()),ShapesUtil.renewShape(t)},c=function(e,t){if(e.style){var i=!!e.style.thumbnail&&e.style.thumbnail;e.style.thumbnailSrc?e.style.thumbnailSrc:ATTR_WIDGET.WIDGET_DEF_IMG;e.style.iframeInfo[ATTR_WIDGET.THUMBNAIL]=i.toString(),e.style.iframeInfo[ATTR_WIDGET.TYPE]="image",e.style.iframeInfo[ATTR_WIDGET.SUBTYPE]=ATTR_WIDGET.WIDGET,e.style.iframeInfo[ATTR_COMMON.ID]=Utils.getRandomNumber()}},u=function(e,t){var i=e.style,n=i.paraInfo.borders,o=parseInt(i.paraInfo.hd),r=editor.doc.model&&editor.doc.getHeadingListId();if(n){for(var a in n)"0px"!=n[a].width||i.writerBorderInfo&&"-1"!=i.writerBorderInfo["border-sides"].indexOf(a)||delete i.paraInfo.borders[a];for(var s in n[ATTR_BORDERS.BORDER_RADIUS]){var l=n[ATTR_BORDERS.BORDER_RADIUS][s];0==l&&delete n[ATTR_BORDERS.BORDER_RADIUS][s]}U.isEmpty(n[ATTR_BORDERS.BORDER_RADIUS])&&delete n[ATTR_BORDERS.BORDER_RADIUS],U.isEmpty(n)&&delete i.paraInfo.borders}var d,c,u,p,g=t?t.selection:null;DocLayoutManager?(u=g?DocLayoutManager.getSectionViewAtIndex(g.getStart()):DocLayoutManager.getFirstSection(),p=u.getMargin()):(u=DocTreeManager.getSectionAtIndex(0),g&&(u=DocTreeManager.getTreeNodeAtIndex(g.getStart()).getSection()),p=u.getLayoutProps().margin);var f=((p.left||0)+"px").convertor().inches,E=((p.right||0)+"px").convertor().inches;if(editor.doc.model&&"undefined"!=typeof(d=i.paraInfo[ATTR_PARAGRAPH.PS_ML])&&parseFloat(d)<parseFloat("-"+f)&&(i.paraInfo[ATTR_PARAGRAPH.PS_ML]="-"+f),editor.doc.model&&"undefined"!=typeof(c=i.paraInfo[ATTR_PARAGRAPH.PS_MR])&&parseFloat(c)<parseFloat("-"+E)&&(i.paraInfo[ATTR_PARAGRAPH.PS_MR]="-"+E),!U.isEmpty(DocumentDesign.getComputedParaStyle("h0"))&&o){var T=DocumentDesign.getComputedParaStyle("h"+o);U.isEmpty(T)?delete i.paraInfo.hd:StyleUtil.compareAndRemoveParaStyles(T,i.paraInfo),"undefined"!=typeof r&&o>0&&o<=6&&(delete i.paraInfo[ATTR_PARAGRAPH.PS_ML],delete i.paraInfo[ATTR_PARAGRAPH.PS_TI],ListUtils.fillListProps(i.paraInfo,{l:o-1,id:r}))}if(i.writerBorderInfo&&i.writerBorderInfo["border-between"]&&(i.paraInfo.borders=n?n:{},i.paraInfo.borders["border-between"]=i.writerBorderInfo["border-between"]),n&&0==Object.keys(n).length&&delete i.paraInfo.borders,i.paraInfo.hasOwnProperty(ATTR_PARAGRAPH.PS_CODE)){var m=i.paraInfo[ATTR_PARAGRAPH.PS_CODE],h=DocUtil.copyStyle(ZWCode.THEME_SYTLES[m.theme]);delete h[ATTR_PARAGRAPH.PS_ML],i.paraInfo=DocUtil.mergeObjs([i.paraInfo,h])}},p=function(e,o){var r,a=e.style,s=n(e.parents,"paragraph");if(a.textInfo.hasOwnProperty("td")){var l=a.textInfo.td,d="";if(l.indexOf("none")!=-1)d="none";else{var c=l.indexOf("underline")!=-1,u=l.indexOf("line-through")!=-1;c?d="underline":void 0,u&&(d.length?d+=" line-through":d="line-through")}d.length?a.textInfo.td=d:delete a.textInfo.td}if(a.textInfo.hasOwnProperty(ATTR_TEXT.TS_FF)){var p=a.textInfo[ATTR_TEXT.TS_FF];p=p.replace(/\s{2,}/g," ");var g=p.replace(/["]{1}/gi,"'");p=t(g),a.textInfo[ATTR_TEXT.TS_FF]=p}if(r=a.textInfo[ATTR_TEXT.TS_FW],r=isNaN(r)&&FONT_WEIGHT[r]||r,700===r?a.textInfo[ATTR_TEXT.TS_FW]="bold":(a.textInfo[ATTR_TEXT.TS_FW]="none",a.textInfo[ATTR_TEXT.TS_FW_I]=r),!U.isEmpty(DocumentDesign.getComputedParaStyle("h0"))&&s){var f=s.style.paraInfo.hd;f&&DocumentDesign.getComputedParaStyle("h"+f)&&DocumentDesign.getComputedParaStyle("h"+f).textFormat&&StyleUtil.compareAndRemoveTextStyles(DocumentDesign.getComputedParaStyle("h"+f).textFormat,e.style.textInfo)}if("link"==a.textInfo.cls){var E=n(e.parents,"anchor");if("anchor"==E.type&&(a.textInfo.url=E.style.linkInfo.url,a.textInfo.lnktype=E.style.linkInfo.lnktype,a.textInfo.hasOwnProperty("fgc"))){var T=DocumentDesign.getComputedParaStyle("h0").textFormat;try{if(T.hasOwnProperty("fgc")){var m=a.textInfo.fgc,h=m.indexOf("zw")>-1,I=m.indexOf("#")>-1,_=m.indexOf("rgb")>-1,A=_?m:null;I?A=zoho.color.hexToRgb(T.fgc):h&&(A=DocUtil.getRenderingFormat({fgc:m}).fgc),A=A.toLowerCase(),A==T.fgc.toLowerCase()&&delete a.textInfo.fgc}}catch(e){}}}if(!a.hasOwnProperty("commentInfo")||o&&o.isSameDoc||delete a.commentInfo,a.hasOwnProperty("sectionInfo")&&i(o)&&delete a.sectionInfo,a.hasOwnProperty("textboxInfo")&&(delete a.textboxInfo.fid,a.hasOwnProperty("sectionInfo"))){var S=JSON.parse(a.sectionInfo.fmt),R=S[ATTR_FILLABLEFIELD.FF_INFO];R&&(S[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]=Utils.randomString()),delete S.fid,a.sectionInfo.fmt=JSON.stringify(S)}if(a.hasOwnProperty("fillablefieldInfo")){var O=a.fillablefieldInfo;if(O.type===NODE_TYPE.FILLABLEFIELD&&O[ATTR_FILLABLEFIELD.FF_INFO]&&O[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.CURRENCY){var b=ZWUtils.getLocaleDetails();O[ATTR_FILLABLEFIELD.FF_INFO].locale=b.code,O[ATTR_FILLABLEFIELD.FF_INFO].currencyISOCode=b.currencyCode,O[ATTR_FILLABLEFIELD.FF_INFO].currencySymbol=Numeral.getFormattedNumberAndCurrencySymbol(b.code,b.currencyCode).symbol,O[ATTR_FILLABLEFIELD.FF_INFO].useCurrencySymbol=!0,e.cont=Utils.getFillableFieldResult(O),e.cont===O[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CURRENCY_SYMBOL]&&(e.cont=O[ATTR_FILLABLEFIELD.FF_NAME]||e.cont)}}a.hasOwnProperty("displayType")&&(a.textInfo[ATTR_CUSTOM.DISPLAY_TYPE]=a.displayType);try{var v=o?o.selection:null,E=n(e.parents,"paragraph");if(v&&v.paraFormat.code)for(var D in a.textInfo)"type"!==D&&delete a.textInfo[D]}catch(e){PubSub.publish("GenerateOp/PasteError","visitedNodeInfo is undefined")}(v&&v.paraFormat.code||E&&E.style.paraInfo&&E.style.paraInfo.hasOwnProperty(ATTR_PARAGRAPH.PS_CODE))&&(a.textInfo.parent=ATTR_PARAGRAPH.PS_CODE)},g=function(e,t){var i=e.style,n=i.linkInfo[ATTR_LINK.LINK_URL],o=LINK_TYPES.WEBURL;i.hasOwnProperty("mminfo")?o=LINK_TYPES.MMFIELD:n.indexOf("mailto:")!=-1?o=LINK_TYPES.MAILTO:editor.doc.model&&n.indexOf(editor.base_url+"/open/"+editor.doc.rid+"/bookmarks/")!=-1&&(t&&t.isSameDoc?(o=LINK_TYPES.BOOKMARK,n=i.bookmarkName):o=LINK_TYPES.WEBURL),o==LINK_TYPES.WEBURL&&i.relativepath&&(n=i.relativepath),o!=LINK_TYPE.WEBURL&&delete i.linkInfo[ATTR_LINK.LINK_TARGET],i.linkInfo[ATTR_COMMON.ID]=Utils.randomString(),i.linkInfo[ATTR_COMMON.TYPE]=NODE_TYPE.LINK,i.linkInfo[ATTR_LINK.LINK_TYPE]=o,i.linkInfo[ATTR_LINK.LINK_URL]=n},f=function(e){var t=e.style;if(i())t.hasOwnProperty("footnoteInfo")?delete t.footnoteInfo:void 0,t.hasOwnProperty("endnoteInfo")?delete t.endnoteInfo:void 0;else{var n=editor.doc.model&&editor.doc.getBodyFormat();(!n||t.hasOwnProperty("footnoteInfo")&&n.footnote)&&delete t.footnoteInfo,(!n||t.hasOwnProperty("endnoteInfo")&&n.endnote)&&delete t.endnoteInfo}},E=function(e,t){switch(e.type){case NODE_TYPE.IMAGE:var i=e.style&&e.style.shapedata||null;i?d(e,t):o(e,t);break;case NODE_TYPE.TABLE:a(e,t);break;case NODE_TYPE.ROW:s(e);break;case NODE_TYPE.CELL:l(e);break;case NODE_TYPE.WIDGET:c(e,t);break;case NODE_TYPE.PARAGRAPH:u(e,t);break;case NODE_TYPE.TEXT:p(e,t);break;case"anchor":g(e,t);break;case NODE_TYPE.BODY:f(e)}};PubSub.subscribe("InsertHTML/nodeCreated",E),PubSub.subscribe("loadedImageStyles",r)}();HTMLBuilder=function(){"use strict";var e=" ",t={};t[ATTR_PARAGRAPH.PS_ML]="data-margin-left",t[ATTR_PARAGRAPH.PS_TI]="data-text-indent",t[ATTR_PARAGRAPH.PS_PL]="data-padding-left",t[ATTR_PARAGRAPH.PS_SA]="data-margin-bottom",t[ATTR_PARAGRAPH.PS_SB]="data-margin-top",t[ATTR_PARAGRAPH.PS_HD]="data-hd-info",t[ATTR_PARAGRAPH.PS_TPS]="data-tab-info",t[ATTR_PARAGRAPH.EN_BL]="data-keep-line-info",t[ATTR_PARAGRAPH.EN_PB]="data-page-break-info",t[ATTR_PARAGRAPH.EN_WO]="data-window-control-info",t[ATTR_PARAGRAPH.EN_KN]="data-keep-next-info",t[ATTR_PARAGRAPH.PS_TS]="data_styles",t[ATTR_PARAGRAPH.PS_CODE]="data-codeformat",t[ATTR_PARAGRAPH.PS_LINE_RULE]="data-lineRule",t[ATTR_PARAGRAPH.PS_LS]="data-line-height";var i=function(e){var i,n=(e.segments,e.getEndIndex()),o=editor.doc.getComputedFormatAt(n,NODE_TYPE.PARAGRAPH),r=(o[ATTR_PARAGRAPH.PS_HD]||0,"p"),a={},s=ListUtils.isList(o),l=document.createElement(r);for(var d in t)if(o.hasOwnProperty(d)){var u=o[d];"object"===(typeof u).toLowerCase()&&(u=JSON.stringify(u)),a[t[d]]=u}if(s){o.hasOwnProperty(ATTR_PARAGRAPH.PS_ML)&&(a["data-margin-left"]=o[ATTR_PARAGRAPH.PS_ML]),o.hasOwnProperty(ATTR_PARAGRAPH.PS_TI)&&(a["data-text-indent"]=o[ATTR_PARAGRAPH.PS_TI]),o.hasOwnProperty(ATTR_PARAGRAPH.PS_PL)&&(a["data-padding-left"]=o[ATTR_PARAGRAPH.PS_PL]),o.hasOwnProperty(ATTR_PARAGRAPH.PS_SA)&&(a["data-margin-bottom"]=o[ATTR_PARAGRAPH.PS_SA]),o.hasOwnProperty(ATTR_PARAGRAPH.PS_SB)&&(a["data-margin-top"]=o[ATTR_PARAGRAPH.PS_SB]);var p=o[ATTR_PARAGRAPH.LS_DATA],g=p[ATTR_COMMON.ID],f=ListUtils.isBasicList(e),E=ListUtils.isHeadingList(e);if(!f&&c(l,e,o),!f&&l.classList.add("zw-special-list"),!E){if(delete o[ATTR_PARAGRAPH.PS_ML],delete o[ATTR_PARAGRAPH.PS_TI],CheckListOperations.isCheckList(o)){var T=editor.doc.getListObj(g),m=ListUtils.getSplBulletInfo(T);a["data-list-format"]=JSON.stringify(T),a["data-spl-bullet-format"]=JSON.stringify(m),J(l).addClass("zw-check-list-para")}a["data-list-id"]=g,a["data-list-info"]=JSON.stringify(p),p.hasOwnProperty(ATTR_COMMON.BULLET_ID)&&(a["data-bullet-id"]=p.bullet_id),l.classList.add("zw-list")}}var i={margin:"0px"};if(J(l).css(i),DomUtil.setParaStyle(l,o,null,!0),o[ATTR_COMMON.BORDERS]){var h=o[ATTR_COMMON.BORDERS],I=[],_={};h[ATTR_BORDERS.BORDER_BETWEEN]&&(_["border-between"]=h[ATTR_BORDERS.BORDER_BETWEEN]);for(var A in h)I.push(A);_["border-sides"]=I,a["data-writer-border-info"]=JSON.stringify(_)}J(l).attr(a);var S=document.createElement("span");return J(S).addClass("EOP"),S.innerHTML="&nbsp;",l.appendChild(S),J(l).addClass("zw-paragraph"),l},n=function(e){var t,i={},n=e.getFormat(),o=document.createElement("table"),r=e.getIndex(),a=editor.doc.getThemeStyleFormatAt(r);t=a[ATTR_TABLE.TBLS_BGIMG],t=t&&"none"!=t.substr(-4)?t:"";var s=a[ATTR_TABLE.TBLS_BGIMG_NAME];t=HTMLUtil.getImageData(t),i={backgroundColor:a[ATTR_TABLE.TBLS_TBL_BGC],marginLeft:a[ATTR_TABLE.TBLS_ML],"border-collapse":"collapse"};var l=a[ATTR_TABLE.TBLS_WID],d={"data-theme":JSON.stringify(a[ATTR_TABLE.TBLS_THEME]),"data-cols":JSON.stringify(e.cols),"data-width":l};return t&&s&&(d["data-bgimg-name"]=s),n&&n.name&&(d["data-table-name"]=n.name),J(o).attr(d).addClass("zw-table"),t&&extend(i,{backgroundImage:"url("+t+")"}),J(o).css(i),o},o=function(e){var t,i=document.createElement("tr"),n=e.getIndex(),o=editor.doc.getThemeStyleFormatAt(n),r={};return o.htRule&&(r.htRule=o.htRule),o.mminfo&&(r.mminfo=o.mminfo),t={"data-row-info":JSON.stringify(r)},J(i).attr(t),i},r=function(e){var t,i=e.getIndex(),n={},o=(e.getFormat(),e.getMatrixPosition()[1]),r=DocUtil.getRenderingFormat(editor.doc.getThemeStyleFormatAt(i)),s=r[ATTR_TABLE.TBLS_BGIMG_NAME],l=DomUtil.createTD(e,TableUtil.generateFormatForCell(e));extend(n,{width:e.getCellWidth()});var d=HTMLUtil.getImageData(r[ATTR_CELL.TDS_BGIMG]);d&&extend(n,{backgroundImage:"url("+d+")"}),"undefined"!=typeof r[ATTR_CELL.TDS_HT]?n.height=r[ATTR_CELL.TDS_HT]:n.height="auto","undefined"==typeof r[ATTR_CELL.TDS_VA]&&(n.verticalAlign="top"),J(l).css(n);var c=a(e,NODE_TYPE.CELL),u=c.parentNode(),p=(u.parentNode(),TableUtil.findColIdx(c),TableUtil.findRowIdx(u),BorderUtils.getTdBdrDomStyle(c)),g={};for(key in p){var f=p[key];g[key]=f}if(g&&J(l).css(g).addClass("zw-td"),r[ATTR_CELL.TDS_MRG]&&"fc"!=r[ATTR_CELL.TDS_MRG]&&J(l).hide(),t={"col-index":o,"data-cell-height":n.height},s&&(t["data-bgimg-name"]=s),r.mminfo){var E={};E.mminfo=r.mminfo,t["data-cell-info"]=JSON.stringify(E)}return J(l).attr(t),l},a=function(e,t){var i=editor.doc.createElement(t,e);return i.setStart(e.getIndex()),i.setEnd(e.getEndIndex()),i},s=function(e){var t=DomUtil.createHR(),i=DocLayoutManager.getViews(e),n=editor.doc.getRawFormatAt(e.getEndIndex());return DomUtil.setHRStyle(t,i,!0),t.setAttribute("data-hr-info",JSON.stringify(n)),n.cls&&t.classList.add(n.cls),t},l=function(e,t,i,n){var o,r;null==i&&(i=-1,n=null!=n?n:0,o=editor.doc.getListObj(t),r=ListUtils.getSplBulletInfo(o));var a,s,l=i;do{l++;var d=document.createElement(e?"ol":"ul"),c=editor.doc.getListType(t,l);c==LIST_TYPE.SYMBOL||c==LIST_TYPE.IMAGE?d.style.listStyle=ListUtils.getHTMLListType(LIST_TYPE.DISC):d.style.listStyle=ListUtils.getHTMLListType(c),a?a.appendChild(d):s=d,a=d}while(l<n);var u={};return u["data-list-id"]=t,u["data-list-format"]=o&&JSON.stringify(o),u["data-spl-bullet-format"]=r&&JSON.stringify(r),J(s).attr(u),s},d=function(t,i){var n=editor.doc.getContent(t,i),o=n.length,r="";if(1==o&&/\s/g.test(n))return e;for(var a=0;a<o;a++){var s=n.substr(a,1);s=Utils.encodeHTMLChars(s),r+=s}if(/\s{2,}/g.test(n)){for(var l,d=0,c="",u=RegExp(/\s{2,}/g);null!==(l=u.exec(n));){c+=n.substr(d,l.index-d);for(var p=l[0].length;p>0;)c+=e,p--;d=l.index+l[0].length}d<n.length&&(c+=n.substr(d,n.length-d)),n=c}return n},c=function(t,i,n){var o,r=i.format.ls_data;if(CheckListOperations.isCheckList(n)||ListUtils.isSymbolList(r)||ListUtils.isHeadingList(i)||ListUtils.isModifiedListChar(i)){var a=CheckListOperations.isCheckList(n)?CheckListOperations.getCheckListChar(n):i.paraProperties.listData.listNumberString,s=DocLayoutManager.getListData(i);o=document.createElement("span"),o.innerText=a,o.setAttribute("style",s.listStyle),J(o).css("paddingRight","0px")}else if(ListUtils.isImageList(i.format)){o=document.createElement("img");var l=i.paraProperties.listData.listImageData,d=l[ATTR_IMAGE.I_SRC];d=HTMLUtil.getImageData(d);var c={src:d,width:l[ATTR_IMAGE.I_WID],height:l[ATTR_IMAGE.I_HT]};J(o).attr(c)}var p=document.createElement("span"),g=p.cloneNode();p.append(o,g),g.innerText=e,p.setAttribute("class","zw-list-char"),u(t,p)},u=function(e,t){var i=document.createComment("Zoho writer list char starts"),n=document.createComment("Zoho writer list char starts ends");J(e).prepend(i,[t,n])},p=function(e,t){var i,n,o=e.parent,r=o.getIndex(),a=r+e.start,s=r+e.end,l=editor.doc.getCharAt(a),c=editor.doc.getComputedFormatAt(a,NODE_TYPE.TEXT),u=c.type?c.type:NODE_TYPE.TEXT,p=DocTreeManager.getSectionAtIndex(r);switch(u){case NODE_TYPE.TAB:case NODE_TYPE.PLACEHOLDER:case NODE_TYPE.TEXT:var g,f=d(a,s),E=DocUtil.getComputedTextFormat(a),T={};n=DomUtil.createSpan(E);var m=Object.keys(ZWJSONUtils.jsonCleanser(DocUtil.getTextStyle(a)));if(c.st&&c.st==NODE_TYPE.TAB||c.type&&c.type==NODE_TYPE.TAB){var h={leader:c.leader,cls:"Apple-tab-span",st:NODE_TYPE.TAB,type:NODE_TYPE.TEXT};f=UNICODE.TAB,g={"data-text-info":JSON.stringify(h)},T={"white-space":"pre"}}else if(!c.cls||"footnote"!=c.cls&&"endnote"!=c.cls)if(c.cls&&(c.cls.indexOf(CONST.MERGEFIELD)!=-1||c.cls.indexOf(CONST.NEXTRECORD))!=-1)i={cls:c.cls},c.cls.indexOf(CONST.NEXTRECORD)==-1&&c.cls.indexOf(CONST.MERGEFIELD)==-1||(g={"data-mergefield-info":JSON.stringify(t),"data-text-info":JSON.stringify(i)});else if(c.cls&&HTMLUtil.getAutoFieldClass(c.cls)){var I,_=c.fieldinfo,A=HTMLUtil.getAutoFieldClass(c.cls);if("autopcnt"===A)I=DocLayoutManager.getPageCount();else if("autopno"===A){var S=DocLayoutManager.getViews(o)[0];I=S&&S.page?S.getPage().getRelativePageNumber():1}else I="autoformula"===A?/^(#)+$/.test(f)?o.viewProperties.fields[_].value:f:"autodocname"===A?/^(#)+$/.test(f)?o.viewProperties.fields[_].value:f:"autoauthor"===A?/^(#)+$/.test(f)?o.viewProperties.fields[_].value:f:"autodocversion"===A?/^(#)+$/.test(f)?o.viewProperties.fields[_].value:f:o.viewProperties.fields[_];f=I,i={cls:A},g={"data-autofield-info":JSON.stringify(t),"data-text-info":JSON.stringify(i)}}else c.cls&&HTMLUtil.getUserFieldCls(c.cls)?(i={cls:c.cls},g={"data-autofield-info":JSON.stringify(t),"data-text-info":JSON.stringify(i)}):c.cls&&c.cls==NODE_TYPE.FILLABLEFIELD?n=HTMLUtil.convertFillableFieldsToStdHTML(c,t):c.cls&&c.cls==NODE_TYPE.SIGNERFIELD?(i={cls:c.cls},g={"data-signerfield-info":JSON.stringify(t),"data-text-info":JSON.stringify(i)}):c.cls&&c.cls.indexOf(NODE_TYPE.LINK)!=-1?e.format&&!e.format.hasOwnProperty(ATTR_TEXT.TS_FGC)&&(delete E[ATTR_TEXT.TS_FGC],n.style.color=""):c.hasOwnProperty(ATTR_CUSTOM.DISPLAY_TYPE)&&(g={"data-display-type":c[ATTR_CUSTOM.DISPLAY_TYPE]});else f="#",g={},g["data-"+c.cls+"-id"]=c.id,g["data-text-info"]=JSON.stringify({cls:c.cls}),"footnote"==c.cls?g["data-footnote-info"]=JSON.stringify({footnote:p.getFormats().footnote}):g["data-endnote-info"]=JSON.stringify({endnote:p.getFormats().footnote}),T={"vertical-align":"super"};n.removeAttribute("class"),n.textContent=f,g&&J(n).attr(g),T&&J(n).css(T),e.parent.isCode()&&(n.setAttribute("data-format-attr",JSON.stringify(m)),n.style.color="");break;case NODE_TYPE.IFRAME:n=DomUtil.createIframe(c);break;case NODE_TYPE.CHART:n=DomUtil.createImage(c);var R={};R["data-chartfield-info"]=JSON.stringify(c),J(n).attr(R);break;case NODE_TYPE.IMAGE:n=c.hasOwnProperty(ATTR_WIDGET.SRC)?DomUtil.createWidget(c):DomUtil.createImage(c);var R={},T={};c.hasOwnProperty(ATTR_WIDGET.SHEET_INFO)&&(R["data-sheet-info"]=JSON.stringify(c[ATTR_WIDGET.SHEET_INFO])),c.hasOwnProperty(ATTR_IMAGE.I_CROPRECT)&&(R["data-crop-info"]=JSON.stringify(c[ATTR_IMAGE.I_CROPRECT])),c.hasOwnProperty(ATTR_IMAGE.BARCODE_INFO)&&(R["data-barcode-info"]=JSON.stringify(c[ATTR_IMAGE.BARCODE_INFO])),c.hasOwnProperty(ATTR_IMAGE.QRCODE_INFO)&&(R["data-qrcode-info"]=JSON.stringify(c[ATTR_IMAGE.QRCODE_INFO])),c.hasOwnProperty(ATTR_COMMON.SUBTYPE)&&(R["data-subtype-info"]=JSON.stringify(c[ATTR_COMMON.SUBTYPE]),"textbox"==c[ATTR_COMMON.SUBTYPE]&&(n=document.createElement("span"),n.classList.add("zw-textbox-image"),n.innerText="#",delete c.tempId,R["data-textbox-id"]=c.id,R["data-text-info"]=JSON.stringify({cls:"textbox"}),R["data-textbox-info"]=JSON.stringify(c),T["vertical-align"]="super")),c.cls&&c.cls==NODE_TYPE.FILLABLEFIELD?(R["data-fillablefield-info"]=JSON.stringify(c),n.classList.add("zw-fillablefield-image")):c.cls&&c.cls==NODE_TYPE.SIGNERFIELD?R["data-signerfield-info"]=JSON.stringify(c):c.src&&Macros.isWriterImage(c.src)&&(n.src=HTMLUtil.getImageData(c.src)),c.hasOwnProperty(ATTR_WIDGET.SERVICE)&&"YOUTUBE"==c[ATTR_WIDGET.SERVICE]&&(R["data-video-data"]=JSON.stringify(c),n.classList.add("zw-video-image")),c.subType&&"chart"==c.subType&&(R["data-chart-info"]=JSON.stringify({subType:c.subType,chart_id:c.chart_id,sheet_id:c.sheet_id})),c.hasOwnProperty(ATTR_IMAGE.I_SHAPEDATA)&&(R["data-shapedata"]=JSON.stringify(c[ATTR_IMAGE.I_SHAPEDATA]),n.classList.add("zw-shape-image")),c.hasOwnProperty("mminfo")&&(R["data-mminfo"]=JSON.stringify(c),n.classList.add("zw-mminfo-image")),J(n).attr(R).css(T);break;case NODE_TYPE.BR:n=DomUtil.createBR();break;case NODE_TYPE.MAILMERGEFIELD:break;case NODE_TYPE.COMMENT:n=document.createElement("span");var l=editor.doc.getCharAt(a);J(n).attr({"data-range-char-type":l===UNICODE.RANGE_START?"start":"end","data-comment-info":JSON.stringify(c),"data-range-id":c.id}),n.innerHTML="&nbsp;";break;case NODE_TYPE.NAMED_RANGE:case NODE_TYPE.BOOKMARK:n=document.createElement("span"),J(n).attr({"data-range-char-type":l===UNICODE.RANGE_START?"start":"end","data-bookmark-info":JSON.stringify(c),"data-bookmark-id":c.id}),n.innerHTML="&nbsp;";break;case NODE_TYPE.TAG:n=document.createElement("span"),J(n).attr({"data-range-char-type":l===UNICODE.RANGE_START?"start":"end","data-tag-info":JSON.stringify(c),"data-tag-id":c.id}),n.innerHTML="&nbsp;";break;case NODE_TYPE.FILLABLEFIELD:case NODE_TYPE.FOOTNOTE:case NODE_TYPE.ENDNOTE:case NODE_TYPE.AUTOFIELD:break;case NODE_TYPE.SIGNERFIELD:break;case NODE_TYPE.LINK:if(editor.doc.getCharAt(a)==UNICODE.RANGE_START){var O,n=document.createElement("a");if(c.lnktype==LINK_TYPES.BOOKMARK)O=BookmarkDialog.getLink(c.url),J(n).attr({"data-bookmark-name":c.url});else{var b=c.url;Utils.isRelativeLink(b)&&(J(n).attr({"data-relativepath":b}),b=Utils.getAbsoluteLink(b)),O=b}c.hasOwnProperty(ATTR_LINK.LINK_TARGET)&&n.setAttribute("target",c[ATTR_LINK.LINK_TARGET]),c.lnktype==LINK_TYPES.MMFIELD?J(n).attr({"data-mminfo":JSON.stringify(c.mminfo)}):"",J(n).css({color:"rgb( 0, 0, 255 )"}),n.setAttribute("href",O)}else editor.doc.getCharAt(a)!=UNICODE.RANGE_END&&(n=DomUtil.createSpan(c),n.textContent=d(a,s));break;case NODE_TYPE.WIDGET:n=DomUtil.createWidget(c);break;case NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR:case NODE_TYPE.CONDITIONAL_IF_END:case NODE_TYPE.CONDITIONAL_IF_START:n=document.createElement("span");var l=editor.doc.getCharAt(a),v={};l==UNICODE.RANGE_START||l==UNICODE.RANGE_END?(v["data-range-char-type"]=l===UNICODE.RANGE_START?"start":"end",v["data-condition-info"]=JSON.stringify(c),v["data-condition-id"]=c.id):u==NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR&&(v["data-range-char-type"]="else",v["data-condition-id"]=c.id),n.innerHTML="&nbsp;",J(n).attr(v);break;case NODE_TYPE.REPEAT_START:case NODE_TYPE.REPEAT_END:n=document.createElement("span");var l=editor.doc.getCharAt(a),v={};l!=UNICODE.RANGE_START&&l!=UNICODE.RANGE_END||(v["data-range-char-type"]=l===UNICODE.RANGE_START?"start":"end",v["data-repeat-info"]=JSON.stringify(c),v["data-repeat-id"]=c.id),n.innerHTML="&nbsp;",J(n).attr(v)}return n},g=function(e,t,i){for(var n=e.length,o=[],r="%",a=[],s=0,l=0;l<n;l++){var d,c=e[l],u=c.getAttribute("col-index");d=parseFloat(t[u].wt),d*=i/100,o.push(d),s+=d}for(var l=0;l<n;l++){var p=100*o[l]/s,g={wt:p+r};t[l].mminfo&&(g.mminfo=t[l].mminfo),a.push(g)}return{dataCols:a,width:s}},f=function(e,t){for(var i=[],n=0,o=0,r=e.length;o<r;o++){var a,s=e[o],l=s.getAttribute("col-index");a=t[l],i.push(a),n+=parseFloat(a.wt)}return{dataCols:i,width:n}},E=function(e){var t,i,n,o,r,a,s=JSON.parse(e.getAttribute("data-cols")),l=0,d=parseFloat(e.getAttribute("data-width"));r=e.firstElementChild,t=r.cells,s[0].wt.indexOf("%")!=-1?(a=g(t,s,d),o="%"):(a=f(t,s),o=s[0].wt.indexOf("mm")!=-1?"mm":"in"),l=a.width.toFixed(2)+o,n=a.dataCols,i={"data-width":l,"data-cols":JSON.stringify(n)},J(e).attr(i),J(e).find('[merge="vmp"]').remove(),J(e).find('[merge="hmp"]').remove()};return{getParagraph:i,getTable:n,getCell:r,getPortionNode:p,getHR:s,getRow:o,createListElement:l,processTableElemsForCopy:E,paraStyleKeyDataAttrMap:t,getDocElementFromDTNode:a}}();var JsonTreeBuilder=function(){var e,t,i,n=new ZWConsole,o=function(e){var t,i=null,n={},o=e.nodeName.toLowerCase(),r={};switch(o){case"span":i=e.textContent,t=NODE_TYPE.TEXT;break;case"a":t="anchor";break;case"br":i=UNICODE.BR,t=NODE_TYPE.BR;break;case"table":i=UNICODE.TABLE,t=NODE_TYPE.TABLE;break;case"th":case"td":i=UNICODE.CELL,t=NODE_TYPE.CELL;break;case"tr":i=UNICODE.ROW,t=NODE_TYPE.ROW;break;case"hr":i=UNICODE.HR,t=NODE_TYPE.HR;break;case"img":i=UNICODE.IMAGE,t=NODE_TYPE.IMAGE;break;case"iframe":i=UNICODE.IMAGE,t=NODE_TYPE.WIDGET;break;case"p":i=UNICODE.PARA,t=NODE_TYPE.PARAGRAPH;break;case"body":i=null,t=NODE_TYPE.BODY}return extend(n,HTMLUtil.getDataSet(e)),r={cont:i,style:n,type:t}},r=function(e,t){return Boolean(e&&e[t]&&"function"==typeof e[t])},a=function(t){"undefined"!=typeof PubSub&&PubSub.publish("JSONTreeBuilder/ElementConfig",[t,e])},s=function(e){"undefined"!=typeof PubSub&&PubSub.publish("JSONTreeBuilder/StylesConfig",[e,t,i])},l=function(e){var n=e.style,o=Object.keys(n),r=Utils.getCommonKeys(o,i),a=r.length;for(var s in n)if(t.hasOwnProperty(s)){for(var l=0,d=t[s].length;l<d;l++)delete n[s][t[s][l]];"undefined"!=typeof PubSub&&PubSub.publish("JSONTreeBuilder/styleObj",[n,t])}if(a)for(var c=0,u=a;c<u;c++)delete n[r[c]]},d=function(e,t){var i=o(e),n=e.children,a=n.length;if(l(i),r(t,"startHandler")&&t.startHandler(i),a){i.children=[];for(var s=0;s<a;s++){var c=d(n[s],t);i.children.push(c)}}return r(t,"endHandler")&&t.endHandler(i),i},c=function(o,r){n.log(" From JSONTree BUilder :: "+o[0].outerHTML);var l=o[0],c=o[1]?o[1]:{};return e={},t={},i=[],a(c),s(c),processedEle=HTMLPreProcessor.getProcessedHTML(l,e),d(processedEle,r)},u=function(){n.enable()};return{parseHTML:c,enableLogger:u}}();!function(){"use strict";var e=["comment","footnoteSection","endnoteSection","input","signerField","bookmark","autoField","mailmergeField","conditionalField","textBox"],t=["commentInfo","footnoteInfo","endnoteInfo","fillablefieldInfo","signerfieldInfo","bookmarkInfo","autofieldInfo","mergefieldInfo","conditionInfo"],i={text:"textInfo",para:"paraInfo",comment:"commentInfo",footnoteSection:["footnoteInfo","footnoteId"],endnoteSection:["endnoteInfo","endnoteId"],input:"fillablefieldInfo",signerField:"signerfieldInfo",bookmark:"bookmarkInfo",autoField:"autofieldInfo",mailmergeField:"mergefieldInfo",conditionalField:"conditionInfo",textBox:["textboxInfo","textboxId"]},n={text:"textInfo",para:"paraInfo",comment:"commentInfo",footnoteSection:"footnoteInfo",endnoteSection:"endnoteInfo",input:"fillablefieldInfo",signerField:"signerfieldInfo",bookmark:"bookmarkInfo",autoField:"autofieldInfo",mailmergeField:"mergefieldInfo",conditionalField:"conditionInfo",image:"imgInfo",textBox:"textboxInfo"},o=function(t){var i=t[0],n=t[1];for(var o in i)e.indexOf(o)==-1&&(n[o]=i[o])},r=function(t){var o=t[0],r=t[1],a=t[2];for(var s in o){if(e.indexOf(s)!=-1&&o[s].hasOwnProperty("isAllowed")&&!o[s].isAllowed){var l=i[s];if(Array.isArray(l))for(var d=0,c=l.length;d<c;d++)a.push(l[d]);else a.push(l)}o[s].hasOwnProperty("excludeStyles")&&(r[n[s]]=o[s].excludeStyles)}},a=function(e){var i=e[0],n=e[1];for(var o in i)if(t.indexOf(o)!=-1&&i.hasOwnProperty("textInfo")&&n.hasOwnProperty(o))for(var r=n[o],a=0,s=r.length;a<s;a++)delete i.textInfo[r[a]]};PubSub.subscribe("JSONTreeBuilder/styleObj",a),PubSub.subscribe("JSONTreeBuilder/StylesConfig",r),PubSub.subscribe("JSONTreeBuilder/ElementConfig",o)}();var CSSToJSON=function(){"use strict";var e=["fontFamily","fontSize","fontWeight","fontStyle","fontVariant","color","text-decoration","letter-spacing","backgroundColor","verticalAlign"],t=["textIndent","textAlign","lineHeight","direction","backgroundColor","marginRight","marginLeft","marginTop","marginBottom"],i=["color","fontSize"],n=["backgroundColor","backgroundImage","text-align","margin-left"],o=["backgroundColor","text-align","vertical-align","paddingLeft","height","backgroundImage"],r=["backgroundColor","text-align","vertical-align","paddingLeft","height","backgroundImage"],a=["backgroundColor","textAlign"],s=["backgroundColor","text-align"],l=["backgroundColor","text-align"],d=["backgroundColor","text-align","height"],c=["center","left","right","justify"],u=function(i,o,a){switch(o){case NODE_TYPE.PARAGRAPH:a=t;break;case NODE_TYPE.TABLE:a=n;break;case NODE_TYPE.CELL:a=r;break;case NODE_TYPE.TEXT:a=e}var s=[];return"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/getStyleKeys",[i,s]),s.length?s:a},p=function(e){var t=e.getAttribute("href"),i=e.getAttribute("target");i||(i="new");var n={};return n.href=t,n.target=i,"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/LinkStyles",n),n},g=function(e,t){var i,n,o=e.classList;if(o.contains("ms-list"))i=JSON.parse(e.getAttribute("data-list-info")),n=i.l;else if(e.getAttribute("data-list-info")&&(o.contains("zw-check-list-para")||o.contains("zw-list")))i=JSON.parse(e.getAttribute("data-list-info")),n=i.l,i.id=e.getAttribute("data-list-id"),e.hasAttribute("data-bullet-id")&&(i.bullet_id=e.getAttribute("data-bullet-id"));else{if(!HTMLUtil.nodeNameEquals(e,"li")){var r=HTMLUtil.getParentNode(e,"li");if(!r)return null;e=r}var a=HTMLUtil.getParentNode(e,["ol","ul"]),s=a.getAttribute("data-list-id");n=HTMLUtil.getParents(e,["ol","ul"]).length-1,n=n>8?8:n,e.hasAttribute("data-list-info")?(i=JSON.parse(e.getAttribute("data-list-info")),i.id=s):i={id:s,l:n}}i&&(t.ls_data=i)},f=function(e){return!(!e||"rgba(0, 0, 0, 0)"==e||"transparent"==e)},E=function(e,t){CSSToJSON.getBorderStyles(e,t);var i=HTMLUtil.getParentsUntil(e,"body|td|th"),n=["marginLeft","marginRight","marginTop","marginBottom"],o=["backgroundColor"],r=function(e){for(var t=0,i=n.length;t<i;t++)if("0px"!=e[n[t]])return!0;return!1},a=i.length,s=0;do{if(!e)break;if(e.nodeType==Node.ELEMENT_NODE){var l,d=[];if(t.hasOwnProperty("marginTop")||(d=d.concat(n)),t.hasOwnProperty("backgroundColor")||(d=d.concat(o)),0==d.length)break;var l=HTMLUtil.getComputedStylesFromBrowser(e,d);if(r(l))for(var c=0,a=n.length;c<a;c++)t[n[c]]=l[n[c]];f(l.backgroundColor)&&(t.backgroundColor=l.backgroundColor),e=i[s]}else e=i[s]}while(s++<a)},T=function(e,t){var i,n=["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle"],o=["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"],r=HTMLUtil.nodeNameEquals(e,"p"),a=r||HTMLUtil.nodeNameEquals(e,"hr")?NODE_TYPE.PARAGRAPH:HTMLUtil.nodeNameEquals(e,["td","th"])?NODE_TYPE.CELL:null,s=function(e){var t={},i=HTMLUtil.getComputedStylesFromBrowser(e,o),n=Math.round(parseFloat(i.borderTopLeftRadius))||0,r=Math.round(parseFloat(i.borderTopRightRadius))||0,a=Math.round(parseFloat(i.borderBottomLeftRadius))||0,s=Math.round(parseFloat(i.borderBottomRightRadius))||0;return t={},t["br-topLeft"]=n,t["br-topRight"]=r,t["br-bottomLeft"]=a,t["br-bottomRight"]=s,t},l=function(e){var t={},i=HTMLUtil.getComputedStylesFromBrowser(e,n),o=Math.round(parseFloat(i.borderTopWidth))||0,r=Math.round(parseFloat(i.borderRightWidth))||0,a=Math.round(parseFloat(i.borderLeftWidth))||0,l=Math.round(parseFloat(i.borderBottomWidth))||0;return t.borders={},t.borders["border-top"]={type:i.borderTopStyle||"none",width:o+"px",color:i.borderTopColor.replaceAll(" ","")||"rgb(0,0,0)",space:"0px"},t.borders["border-right"]={type:i.borderRightStyle||"none",width:r+"px",color:i.borderRightColor.replaceAll(" ","")||"rgb(0,0,0)",space:"0px"},t.borders["border-left"]={type:i.borderLeftStyle||"none",width:a+"px",color:i.borderLeftColor.replaceAll(" ","")||"rgb(0,0,0)",space:"0px"},t.borders["border-bottom"]={type:i.borderBottomStyle||"none",width:l+"px",color:i.borderBottomColor.replaceAll(" ","")||"rgb(0,0,0)",space:"0px"},ZWJSONUtils.isEmptyObject(t.borders)?delete t.borders:t.borders["border-radius"]=s(e),t},d=function(e,t,i){var n;i==NODE_TYPE.PARAGRAPH?n={paddingTop:"border-top",paddingBottom:"border-bottom",paddingRight:"border-right",paddingLeft:"border-left"}:i==NODE_TYPE.CELL&&(n={paddingTop:"pt",paddingBottom:"pb",paddingRight:"pr",paddingLeft:"pl"});var o,r=["paddingTop","paddingBottom","paddingRight","paddingLeft"],a=HTMLUtil.getParentsUntil(e,"body|td|th"),s=function(){for(var e in n){var r=e,a=o[e];a=parseFloat(a.convertor().pixels.toFixed(2))+"px",i==NODE_TYPE.PARAGRAPH?(t.borders=t.borders||{},t.borders[n[r]]=t.borders[n[r]]||{},t.borders[n[r]].space=a):t[n[r]]=a}},l=function(){for(var e=0,t=r.length;e<t;e++)if(o[r[e]])return!0;return!1},d=0,c=a.length;do if(e.nodeType==Node.ELEMENT_NODE){if(o=HTMLUtil.getComputedStylesFromBrowser(e,r),l()){s();break}if("td"==e.nodeName.toLowerCase()||"th"==e.nodeName.toLowerCase())break;e=a[d]}else e=a[d];while(d++<c)},c=e;if(a==NODE_TYPE.PARAGRAPH){var u={};u.borders={};var p="0px",g="none",f="rgb(0,0,0)";u.borders["border-top"]={type:g,width:p,color:f},u.borders["border-right"]={type:g,width:p,color:f},u.borders["border-bottom"]={type:g,width:p,color:f},u.borders["border-left"]={type:g,width:p,color:f};var E=HTMLUtil.getParentsUntil(e,"body|td|th");if(i=l(e),ZWJSONUtils.isEmptyObject(i))for(var T=E.length,m=T-1;m>=0;m--)if(E[m].nodeType==Node.ELEMENT_NODE&&(i=l(E[m]),!ZWJSONUtils.isEmptyObject(i))){c=E[m];break}ZWJSONUtils.isEmptyObject(i)&&(i=u)}else i=l(e);a&&d(c,i,a),extend(t,i)},m=function(e){var t=HTMLUtil.getComputedStylesFromBrowser(e,o),i={};CSSToJSON.getBorderStyles(e,i);for(var n in t){var r=n,a=t[r];"text-align"==r&&a.indexOf(c)!=-1?i[r]=a:"vertical-align"==r&&"baseline"!=a?i[r]=a:"backgroundColor"==r&&f(a)?i[r]=a:"backgroundImage"==r&&"none"!=L(a)?i[r]=L(a):"height"==r&&parseFloat(a)>0&&(i[r]=parseFloat(a))}return"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/RowStyles",[e,i]),i},h=function(e){var t=u(e,NODE_TYPE.CELL),i=HTMLUtil.getComputedStylesFromBrowser(e,t),n={},o=e.getAttribute("merge"),r=e.getAttribute("colspan"),a=e.getAttribute("rowspan");r&&(n.colspan=parseInt(r),a||(n.rowspan=1),n.merge="fc"),a&&(n.rowspan=parseInt(a),r||(n.colspan=1),n.merge="fc"),o&&(n.merge=o),CSSToJSON.getBorderStyles(e,n);for(var s in i){var l=s,d=i[l];"text-align"==l&&c.indexOf(d)!=-1?n[l]=d:"vertical-align"==l&&"baseline"!=d?n[l]=d:"backgroundColor"==l&&f(d)?n[l]=d:"backgroundImage"==l&&"none"!=L(d)?n[l]=L(d):"height"==l&&parseFloat(d)>0&&(n[l]=d)}return"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/CellStyles",[e,n]),n},I=function(e){return b(e,a)},_=function(e){var t={};for(var i in e)d.indexOf(i)!=-1&&(t[i]=e[i]);return"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/CellStyles",[null,t]),t},A=function(e){var t={};for(var i in e)l.indexOf(i)!=-1&&(t[i]=e[i]);return"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/CellStyles",[null,t]),t},S=function(e){var t={};for(var i in e)s.indexOf(i)!=-1&&(t[i]=e[i]);return"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/RowStyles",[null,t]),t},R=function(e){var t={};if(!e)return t;CSSToJSON.getBorderStyles(e,t);var i=(n.length,{}),o=u(e,NODE_TYPE.TABLE);i=HTMLUtil.getComputedStylesFromBrowser(e,o),i.backgroundImage=L(i.backgroundImage);for(var r in i){var a=r,s=i[a];"text-align"==a&&s.indexOf(c)!=-1?t[a]=s:"backgroundColor"==a&&f(s)?t[a]=s:"backgroundImage"==a&&"none"!=s?t[a]=s:"margin-left"==a&&(t[a]=s)}return e.hasAttribute("align")&&(t.align=e.getAttribute("align")),e.hasAttribute("cellpadding")&&(t.cellpadding=e.getAttribute("cellpadding")),"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/TableStyles",[e,t]),t},O=function(e){return v(e,i)},b=function(e,t){var i=u(e,NODE_TYPE.PARAGRAPH),n=HTMLUtil.getComputedStylesFromBrowser(e,i),o=HTMLUtil.getParentNode(e,["h1","h2","h3","h4","h5","h6"]),r=0;HTMLUtil.nodeNameEquals(e,"h1|h2|h3|h4|h5|h6")&&(o=e),o&&(r=o.nodeName.substr(1),n.heading=r),E(e,n);for(var a in n){var s=a,l=n[s];if(l&&"normal"!=l){if("textAlign"==s)l.indexOf("center")!=-1&&(l="center");else if("marginRight"==s||"marginLeft"==s)l=l.convertor().inches,l=parseFloat(l.toFixed(3))+"in";else if("marginTop"==s||"marginBottom"==s)l=l.convertor().points,l<0&&(l=0),l=parseFloat(l.toFixed(2))+"pt";else if("textIndent"==s)l=parseFloat(l.convertor().inches.toFixed(2))+"in";else if("lineHeight"==s){var d=HTMLUtil.getComputedStylesFromBrowser(e,["font-size"])["font-size"],c=l.convertor().pixels,p=d.convertor().pixels;l=c/p,l=parseFloat(l.toFixed(1))}else"backgroundColor"==s&&"transparent"==l&&(l=null);null!=l&&(n[s]=l)}else delete n[a]}if(g(e,n),t&&t.length)for(var a in n)t.indexOf(a)==-1&&delete n[a];return"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/ParagraphStyles",[e,n]),n},v=function(e,t){if(3==e.nodeType&&(e=e.parentNode,!e))return{};var i=u(e,NODE_TYPE.TEXT),n=HTMLUtil.getComputedStylesFromBrowser(e,i),o=P(e);o&&(n["text-decoration"]=o),n.backgroundColor=f(n.backgroundColor)?n.backgroundColor:N(e),i.indexOf("verticalAlign")!=-1&&(n.verticalAlign=D(e));for(var r in n){var a=r,s=n[a];if(s){if("fontWeight"==a)if(isNaN(s))switch(s){case"lighter":s=100;break;case"bolder":s=700;break;case"normal":case"bold":break;default:s="normal"}else s=parseInt(s),s=s<100?100:s>900?900:100*parseInt(s/100);else if("fontSize"==a)s=s.convertor().points.toFixed(2);else if("color"==a)(HTMLUtil.nodeNameEquals(e,"a")||HTMLPreProcessor.isInsideAnchor(e))&&"#0000EE"==ZWColorUtils.rgbToHex(s).toUpperCase()&&""==e.style.color&&(s=e.style.color);else if("verticalAlign"!==a||"super"!==s&&"sub"!==s)"letter-spacing"==a?(s="normal"==s?"0pt":s,s=Math.round(100*s.convertor().points)/100+"pt"):"backgroundColor"==a&&"transparent"==s?s=null:"text-decoration"==a&&(HTMLUtil.nodeNameEquals(e,"a")||HTMLPreProcessor.isInsideAnchor(e))&&"underline"==s&&"underline"!=e.style.textDecoration&&(s=e.style.textDecoration);else{var l=n.fontSize.convertor().points;l=parseInt(l*(1/.7)),n.fontSize=l}null!=s&&(n[a]=s)}}if(t&&t.length)for(var r in n)t.indexOf(r)==-1&&delete n[r];return"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/TextStyles",[e,n]),n},D=function(e){var t=HTMLUtil.getParentsUntil(e,"body|td|th"),i=HTMLUtil.getComputedStylesFromBrowser(e,["verticalAlign"]).verticalAlign;if("super"==i||"sub"==i)return i;for(var n=0,o=t.length;n<o&&(t[n].nodeType!=Node.ELEMENT_NODE||(i=HTMLUtil.getComputedStylesFromBrowser(t[n],["verticalAlign"]).verticalAlign,"super"!=i&&"sub"!=i));n++);return i},L=function(e){try{e&&e.indexOf("url")!=-1&&(e=e.replace(/url\(("|)|((|")\))/g,""))}catch(t){e="none"}return e},N=function(e){for(var t=HTMLUtil.getParentsUntil(e,"body|td|th"),i="rgba(0, 0, 0, 0)",n=0,o=t.length;n<o;n++)if(t[n].nodeType==Node.ELEMENT_NODE){var r=HTMLUtil.getComputedStylesFromBrowser(t[n],["backgroundColor"]);if(f(r.backgroundColor)){i=r.backgroundColor;break}}return i},P=function(e){var t=HTMLUtil.getParentsUntil(e,"body"),i=!1,n=!1;e.nodeType==Node.ELEMENT_NODE&&t.unshift(e);for(var o=0,r=t.length;o<r;o++)if(t[o].nodeType!=Node.DOCUMENT_FRAGMENT_NODE){var a=["textDecoration"],s=HTMLUtil.getComputedStylesFromBrowser(t[o],a).textDecoration;s.indexOf("none")==-1&&(i||s.indexOf("underline")==-1||(i=!0),n||s.indexOf("line-through")==-1||(n=!0))}var l=i?"underline ":"";return l+=n?"line-through":"",l.trim()},C=function(e){var t=(e.getAttribute("data-format"),HTMLUtil.getComputedStylesFromBrowser(e,["width","height","transform","opacity","top","left","marginTop","marginBottom","marginLeft","marginRight"]));CSSToJSON.getBorderStyles(e,t);for(var i in t){var n=i,o=t[n];switch(n){case"transform":if("none"!=o&&o.length){var r=o.match(/matrix\((.+?)\)/);if(r[1]){var a=r[1].split(","),s=a[0],l=a[1],d=Math.round(Math.atan2(l,s)*(180/Math.PI));d<0&&(d+=360),t.transform=d}}else delete t[n];break;case"height":case"width":o=parseInt(o),t[n]=o?o:0;break;case"top":case"left":o=parseInt(o,10),t[n]=o?o:0}}var c=e.style,u=e.getAttribute("align")||c.float,p=e.getAttribute("src");return u&&(t.align=u),p&&(t.src=p),"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/ImageStyles",[e,t]),t},y=function(e){var t={},i=HTMLUtil.getComputedStylesFromBrowser(e,["width","height"]),n=parseInt(i.width),o=parseInt(i.height),r=e.getAttribute("src");return t.width=n,t.height=o,t.src=r,"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/IframeStyles",[e,t]),t},F=function(e){var t={};if(e.hasAttribute("width")){var i=HTMLUtil.getComputedStylesFromBrowser(e,["width"]),n=parseInt(i.width);t.width=n}return CSSToJSON.getBorderStyles(e,t),"undefined"!=typeof PubSub&&PubSub.publish("CSSTOJSON/HRStyles",[e,t]),t};return{getListStyles:g,getRowStyles:m,getBorderStyles:T,getCellStyles:h,getTableStyles:R,getParagraphStylesOfBlockEle:b,getTextStylesOfBlockEle:O,getTextStylesOfTextNode:v,getBackgroundColor:N,getTextDecorationInfo:P,getImageStyles:C,getIframeStyles:y,getLinkStyles:p,getHRStyles:F,getRowStylesInTable:S,getCellStylesInTable:A,getCellStylesinRow:_,getParaStyleFromCell:I}}();!function(){"use strict";var e={fontWeight:ATTR_TEXT.TS_FW,fontSize:ATTR_TEXT.TS_SIZE,fontFamily:ATTR_TEXT.TS_FF,fontStyle:ATTR_TEXT.TS_FS,color:ATTR_TEXT.TS_FGC,"text-decoration":ATTR_TEXT.TS_TD,backgroundColor:ATTR_TEXT.TS_BGC,verticalAlign:ATTR_TEXT.TS_VA,"letter-spacing":ATTR_TEXT.TS_CS,fontVariant:ATTR_TEXT.TS_FV},t={fw:"fontWeight",size:"fontSize",ff:"fontFamily",fs:"fontStyle",fgc:"color",td:"text-decoration",bgc:"backgroundColor",va:"verticalAlign",cs:"letter-spacing",fv:"fontVariant",z_tbl_bgc:"backgroundColor",z_td_bgc:"backgroundColor",bgimg:"backgroundImage",ht:"height",ml:"margin-left"},i={textAlign:ATTR_PARAGRAPH.PS_AL,textIndent:ATTR_PARAGRAPH.PS_TI,backgroundColor:ATTR_PARAGRAPH.PS_BGC,marginLeft:ATTR_PARAGRAPH.PS_ML,marginRight:ATTR_PARAGRAPH.PS_MR,marginBottom:ATTR_PARAGRAPH.PS_SA,marginTop:ATTR_PARAGRAPH.PS_SB,lineHeight:ATTR_PARAGRAPH.PS_LS,borders:ATTR_COMMON.BORDERS,heading:ATTR_PARAGRAPH.PS_HD,direction:ATTR_PARAGRAPH.PS_DIR,ls_data:ATTR_PARAGRAPH.LS_DATA},n={"text-align":ATTR_TABLE.TBLS_AL,backgroundColor:ATTR_TABLE.TBLS_TBL_BGC,"margin-left":ATTR_TABLE.TBLS_ML,backgroundImage:ATTR_TABLE.TBLS_BGIMG,align:ATTR_TABLE.TBLS_AL,cellpadding:ATTR_TABLE.TBLS_CP},o={backgroundColor:ATTR_ROW.TRS_BGC,"text-align":ATTR_CELL.TDS_TXTAL},r={backgroundColor:ATTR_CELL.Z_TD_BGC,"text-align":ATTR_CELL.TDS_TXTAL,rowspan:ATTR_CELL.TDS_RSPAN,colspan:ATTR_CELL.TDS_CSPAN,"vertical-align":ATTR_CELL.TDS_VA,backgroundImage:ATTR_CELL.TDS_BGIMG,height:ATTR_CELL.TDS_HT},a={width:ATTR_IMAGE.I_WID,height:ATTR_IMAGE.I_HT,transform:ATTR_IMAGE.I_ROTATE,opacity:ATTR_IMAGE.I_OP,top:ATTR_IMAGE.I_TOP,left:ATTR_IMAGE.I_LEFT,marginTop:ATTR_IMAGE.I_MT,marginBottom:ATTR_IMAGE.I_MB,marginLeft:ATTR_IMAGE.I_ML,marginRight:ATTR_IMAGE.I_MR,src:ATTR_IMAGE.I_SRC,align:ATTR_IMAGE.I_AL,borders:ATTR_COMMON.BORDERS},s=function(e){var i=e[0],n=e[1],o=i.getAttribute("data-format-attr");if(o=o&&JSON.parse(o))for(var r=0,a=o.length;r<a;r++){var s=o[r];t.hasOwnProperty(s)&&n.push(t[s])}},l=function(e){for(var t in e)switch(t){case"href":e[ATTR_LINK.LINK_URL]=e[t],delete e[t];break;case"target":e[ATTR_LINK.LINK_TARGET]=e[t],delete e[t]}},d=function(e){var t=e[0],n=e[1];for(var o in n){var r=o,a=n[o];switch(o){case"textAlign":if(a=a.indexOf("center")!=-1?1:"left"==a?0:"right"==a?2:"justify"==a?3:0,n.hasOwnProperty("direction")){var s=n.direction;"rtl"==s&&2==a&&(a=0)}break;case"ls_data":var l=a.l;n[ATTR_PARAGRAPH.PS_TI]="-0.25in",n[ATTR_PARAGRAPH.PS_ML]=.5*(l+1)+"in",ListUtils.fillListProps(n,a)}var d=i[r];delete n[r],n[d]=a}try{if(t&&t.classList.contains("zw-paragraph")){var c=U.invert(HTMLBuilder.paraStyleKeyDataAttrMap);for(var u in c)if(t.hasAttribute(u)){var p=t.getAttribute(u),g=c[u];try{p=JSON.parse(p)}catch(e){}n[g]=p}}}catch(e){}if(n.hasOwnProperty(ATTR_PARAGRAPH.PS_HD)||(n[ATTR_PARAGRAPH.PS_HD]=0),t&&t.hasAttribute("data-hlist-type")){var f=parseInt(t.getAttribute("data-hd-info"));n[ATTR_PARAGRAPH.LS_DATA]={l:f-1,id:0}}t&&t.hasAttribute("data-custom_data")&&(n.customdata=t.getAttribute("data-custom_data")),n[ATTR_COMMON.TYPE]=NODE_TYPE.PARAGRAPH},c=function(t){var i=t[0],n=t[1];for(var o in n){var r=o,a=n[o],s=e[r];delete n[r],n[s]=a}i.hasAttribute("data-custom_data")&&(n.customdata=i.getAttribute("data-custom_data")),n[ATTR_COMMON.TYPE]=NODE_TYPE.TEXT},u=function(e){var t=e[0],i=e[1];if(i[ATTR_COMMON.TYPE]=NODE_TYPE.HR,t.hasAttribute("data-hr-info")){var n=JSON.parse(t.getAttribute("data-hr-info"));n.hasOwnProperty("cls")&&(i.cls=n.cls)}t.hasAttribute("data-align")&&(i[ATTR_HR.HR_AL]=t.getAttribute("data-align"))},p=function(e){var t=e[0],i=e[1];i[ATTR_COMMON.TYPE]=NODE_TYPE.WIDGET;for(var n in i){var o=n,r=i[n];switch(o){case"width":i[ATTR_WIDGET.WID]=r?r:"400",delete i[o];break;case"height":i[ATTR_WIDGET.HT]=r?r:"400",delete i[o];break;case"src":i[ATTR_WIDGET.SRC]=r}}return t.hasAttribute("data-sheet-info")&&(i[ATTR_WIDGET.SHEET_INFO]=JSON.parse(t.getAttribute("data-sheet-info"))),t.hasAttribute("data-thumbnail")&&(i[ATTR_WIDGET.THUMBNAIL]=t.getAttribute("data-thumbnail"),i[ATTR_IMAGE.I_SRC]=t.getAttribute("data-thumbnail-src")),i},g=function(e){var t=e[0],i=e[1];i[ATTR_COMMON.TYPE]=NODE_TYPE.IMAGE;var n=t.classList;if(n.contains("zw-video-image"))return ZWJSONUtils.emptyJSON(i),ZWJSONUtils.mergeJsonObjs(i,JSON.parse(t.getAttribute("data-video-data"))),void(i[ATTR_COMMON.ID]=Utils.randomString());if(n.contains("zw-mminfo-image"))return ZWJSONUtils.emptyJSON(i),ZWJSONUtils.mergeJsonObjs(i,JSON.parse(t.getAttribute("data-mminfo"))),void(i[ATTR_COMMON.ID]=Utils.randomString());var o=t.getAttribute("data-zw-imagesrc");o&&(i.src=o);for(var r in i){var s=r,l=i[r];switch(s){default:a.hasOwnProperty(s)&&(i[a[s]]=l)}a.hasOwnProperty(s)&&s!=a[s]&&delete i[s]}i[ATTR_IMAGE.I_ORGINALWID]=i[ATTR_IMAGE.I_WID],i[ATTR_IMAGE.I_ORGINALHT]=i[ATTR_IMAGE.I_HT],i[ATTR_IMAGE.I_WID_UN]="px",i[ATTR_IMAGE.I_HT_UN]="px",t.hasAttribute("data-crop-info")&&(i[ATTR_IMAGE.I_CROPRECT]=JSON.parse(t.getAttribute("data-crop-info"))),t.hasAttribute("data-subtype-info")&&(i[ATTR_COMMON.SUBTYPE]=JSON.parse(t.getAttribute("data-subtype-info"))),t.hasAttribute("data-wrap-info")&&(i[ATTR_IMAGE.I_WRAP_TYPE]=t.getAttribute("data-wrap-info")),t.hasAttribute("data-position-h-info")&&(i[ATTR_IMAGE.I_H_POSITION]=JSON.parse(t.getAttribute("data-position-h-info"))),t.hasAttribute("data-position-v-info")&&(i[ATTR_IMAGE.I_V_POSITION]=JSON.parse(t.getAttribute("data-position-v-info"))),t.hasAttribute("data-barcode-info")&&(i[ATTR_IMAGE.BARCODE_INFO]=JSON.parse(t.getAttribute("data-barcode-info"))),t.hasAttribute("data-qrcode-info")&&(i[ATTR_IMAGE.QRCODE_INFO]=JSON.parse(t.getAttribute("data-qrcode-info"))),t.hasAttribute("data-chartfield-info")&&(ZWJSONUtils.emptyJSON(i),ZWJSONUtils.mergeJsonObjs(i,JSON.parse(t.getAttribute("data-chartfield-info"))),i[ATTR_COMMON.ID]=i.chartDetails.chartId=Utils.randomString());var d=t.getAttribute("latexexpression");d&&(i[ATTR_IMAGE.I_LATEXEXP]=d,i[ATTR_IMAGE.I_IMGSIZE]=t.getAttribute("imagesize"))},f=function(e){var t=e[0],i=e[1];i[ATTR_COMMON.TYPE]=NODE_TYPE.ROW;for(var n in i){var r=n,a=i[n];o.hasOwnProperty(r)&&(i[o[r]]=a,delete i[r])}if(t){var s=t.getAttribute("data-row-info");s?s=JSON.parse(s):void 0,s&&s.htRule&&(i.htRule=s.htRule),s&&s.mminfo?i.mminfo=s.mminfo:void 0,i[ATTR_COMMON.ID]=t.getAttribute("id")}},E=function(e){var t=e[0],i=e[1];i[ATTR_COMMON.TYPE]=NODE_TYPE.CELL;for(var n in i){var o=n,a=i[n];r.hasOwnProperty(o)&&(i[r[o]]=a,delete i[o])}if(t&&(i[ATTR_COMMON.ID]=t.getAttribute("id"),t.hasAttribute("data-cell-info"))){var s=JSON.parse(t.getAttribute("data-cell-info"));s.mminfo?i.mminfo=s.mminfo:void 0}},T=function(e){var t=e[0],i=e[1];i[ATTR_COMMON.TYPE]=NODE_TYPE.TABLE;for(var o in i){var r=o,a=i[o];n.hasOwnProperty(r)&&(i[n[r]]=a,delete i[r])}i[ATTR_COMMON.ID]=t.getAttribute("id"),t.hasAttribute("data-width")&&(i.width=t.getAttribute("data-width")),t.hasAttribute("data-cols")&&(i[ATTR_TABLE.TBLS_COLS]=JSON.parse(t.getAttribute("data-cols"))),t.hasAttribute("data-theme")&&(i[ATTR_TABLE.TBLS_THEME]=JSON.parse(t.getAttribute("data-theme")))};PubSub.subscribe("CSSTOJSON/IframeStyles",p),PubSub.subscribe("CSSTOJSON/CellStyles",E),PubSub.subscribe("CSSTOJSON/RowStyles",f),PubSub.subscribe("CSSTOJSON/TableStyles",T),PubSub.subscribe("CSSTOJSON/ImageStyles",g),PubSub.subscribe("CSSTOJSON/HRStyles",u),PubSub.subscribe("CSSTOJSON/ParagraphStyles",d),PubSub.subscribe("CSSTOJSON/TextStyles",c),PubSub.subscribe("CSSTOJSON/LinkStyles",l),PubSub.subscribe("CSSTOJSON/getStyleKeys",s)}();var HTMLPreProcessor=function(){"use strict";var e=[],t=new ZWConsole,i={},n={para:{},text:{},bookmarks:{},headings:{},textBox:{},list:{},whiteSpace:{},table:{},anchor:{},image:{},iframe:{},lineBreak:{},horizontalRule:{},noteSettings:{},namedRange:{},conditionMerge:{},simpleRepeat:{},input:{},comments:{},tagCollection:{}},o=function(e){var t,i=e.getAttribute("data-list-format");if(i)t=JSON.parse(i);else{var n=HTMLUtil.getListType(e),o=e.getAttribute("start"),r=e.querySelectorAll("ol,ul");t=ZWJSONUtils.clone(LIST_STYLE_OBJECT[n]),t.level0.startsWith=o?parseInt(o):1;for(var a=1;a<=8;a++){var s,l=r[a-1];if(void 0==l)break;s=l.getAttribute("start"),t["level"+a].type=HTMLUtil.getListType(l),t["level"+a].startsWith=s?parseInt(s):1}}return t},r=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/Input",[e])},a=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/TextBox",[e])},s=function(e){var t={};return"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/NoteContainer",[e,t]),t},l=function(e){var t={};return"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/NamedRange",[e,t]),t},d=function(e){var t={};return"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/TagCollection",[e,t]),t},c=function(e,t){for(var i=!1,n=t.length-1;n>-1;n--)for(var o=e.querySelectorAll("["+t[n]+"]"),r=o.length-1;r>-1;r--){var a=o[r].getAttribute(t[n]);try{JSON.parse(a)}catch(e){i=!0}if(i)break}if(i)for(var n=t.length-1;n>-1;n--)for(var o=e.querySelectorAll("["+t[n]+"]"),r=o.length-1;r>-1;r--)o[r].removeAttribute(t[n])},u=function(e){for(var t=e.childNodes,i=Array.prototype.slice.call(t),n=0,o=i.length;n<o;n++){var r=i[n];if(r.nodeType===Node.COMMENT_NODE&&"[if !supportLists]"==r.textContent)return r;if(r.nodeType==Node.ELEMENT_NODE){var a=u(r);if(a)return a}}return null},p=function(e){g(e);var t={};t.listInfo={},t.bulletInfo={},c(e,["data-spl-bullet-format","data-list-format","data-list-id"]);var i=function(){for(var i=e.querySelectorAll("ol:not([data-list-id]),ul:not([data-list-id])"),n=i.length,r=[],a=0;a<n;a++){var s=i[a];HTMLUtil.nodeNameEquals(s.parentNode,"ol|ul")||r.push(s)}for(var n=r.length,a=0;a<n;a++){var s=r[a],l=Utils.getRandomNumber();s.setAttribute("data-list-id",l);for(var d=s.querySelectorAll("ol,ul,li"),c=o(s),u=0,p=d.length;u<p;u++)d[u].setAttribute("data-list-id",l);t.listInfo[l]=c}},n=function(){var i=HTMLUtil.getParentNode(e,"html");if(i){var n=/mso-list:\s*l\d+\s+level\d+\s+lfo\d+/g,o=i.innerHTML,r=Boolean(o.match(n));if(r)for(var a={},s=e.querySelectorAll("p, h1, h2, h3, h4, h5, h6"),a={},l=0,d=s.length;l<d;l++){var c=s[l],p=c.getAttribute("style");if(p){var g=p.match(n);if(g){var f,E=g[0],T=E.match(/level(.+?)\s+/)[1],m=E.match(/l(\d+?)\s+/)[1],h=!1,I=Array.from(c.childNodes),_=(I.length,u(c));if(_){var A=_.nextSibling,S=A.textContent,f=HTMLUtil.getListTypeByCharCode(S);h=!0,A.parentNode.removeChild(A)}if(a.hasOwnProperty(m)||(a[m]=Utils.getRandomNumber(),t.listInfo[a[m]]=f),0==c.innerText.length){var R=document.createElement("span");R.classList.add("EOP"),R.innerHTML="&nbsp;",c.appendChild(R)}HTMLUtil.setAttribute(c,{"data-list-info":JSON.stringify({id:a[m],l:parseInt(T)-1}),class:"ms-list"})}}}}};return"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/List",[e,t]),i(),n(),ZWJSONUtils.isEmptyObject(t.bulletInfo)?void 0:t.bulletInfo.st="bulletStyles",ZWJSONUtils.isEmptyObject(t.listInfo)?void 0:t.listInfo.st="listFormat",t},g=function(e){for(var t=e.querySelectorAll("li"),i=[],n=0,o=t.length;n<o;n++)HTMLUtil.nodeNameEquals(t[n].parentNode,"ul|ol")||i.push(t[n]);for(var r=0,o=i.length;r<o;r++){var a=document.createElement("ul"),s=i[r];s.parentNode.insertBefore(a,s);for(var l=[s];HTMLUtil.nodeNameEquals(s.nextSibling,"ol|ul|li");)HTMLUtil.nodeNameEquals(s.nextSibling,"li")&&(r+=1),l.push(s.nextSibling),s=s.nextSibling;for(var d=l.length-1;d>=0;--d)a.insertBefore(l[d],a.firstChild)}},f=function(e){for(var t=e.querySelectorAll("a"),i=0,n=t.length;i<n;i++){var o=t[i];o.setAttribute("data-link-info",JSON.stringify(CSSToJSON.getLinkStyles(o))),o.setAttribute("id",Utils.randomString())}},E=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/Headings",[e])},T=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/Comments",[e])},m=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/Bookmarks",[e])},h=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/Tags",[e])},I=function(e){for(var t=0,i=function(e){return e.hasAttribute("colspan")&&parseInt(e.getAttribute("colspan"))>1},n=function(e){return i(e)||e.hasAttribute("merge")&&"fc"!=e.hasAttribute("merge")},o=HTMLUtil.findNodesInTable(e,"tr"),r=o.length,a=!0,s=0;s<r;s++){var l=o[s],d=HTMLUtil.findNodesInTable(l,"td,th");if(0!=d.length){a=!0,t=s;for(var c=0,u=d.length;c<u;c++)if(n(d[c])){a=!1;break}if(a)break}}var p=HTMLUtil.findNodesInTable(o[t],"td,th"),g=[],f=HTMLUtil.getElementWidth(e);if(a)p.forEach(function(e,t){var n=i(e),o=1;n&&(o=parseInt(e.getAttribute("colspan")));var r=HTMLUtil.getElementWidth(e);r=r/o+UNITS.PIXELS;for(var a=0;a<o;a++)g.push({wt:r})});else{var E=p.length,T=(f/E).toFixed(2);T+=UNITS.PIXELS;for(var m=0,h=E;m<h;m++)g.push({wt:T})}return g},_=function(e){for(var t=e.querySelectorAll("img"),i=0,n=t.length;i<n;i++){var o=t[i];if(o.hasAttribute("src")&&null!=o.getAttribute("src"))return!0}return!1},A=function(e,t){var i=e.childNodes,n=i.length;if(!t&&_(e))return!1;if(t)e.innerHTML="<p>"+e.innerHTML+"</p>";else if(!(e.textContent.length&&n&&e.innerText!=UNICODE.TAB||null!=e.querySelector("br")))return void e.appendChild(D("p").appendChild(document.createElement("br")))},S=function(e){var t=HTMLUtil.findNodesInTable(e,"tr"),i=t.length;HTMLUtil.fixMergeforTableEl(e);for(var n=O(e),o=0;o<i;o++){var r=t[o],a=HTMLUtil.findNodesInTable(t[o],"td,th"),s=a.length;0==s&&r.parentNode.removeChild(r);for(var l=0;l<s;l++){var d=a[l],c=l==s-1;A(d)}if(c)for(var u=t[o].cells.length;u<n;){var p=D("td"),g=D("p"),f=a[s-1];if(f&&f.hasAttribute("data-cell-height")){p.setAttribute("data-cell-height",f.getAttribute("data-cell-height"));var E=f.querySelector("p.zw-paragraph");if(E){E=E.cloneNode();var T=document.createElement("span");J(T).addClass("EOP"),T.innerHTML="&nbsp;",E.appendChild(T)}p.appendChild(E)}else g.appendChild(document.createElement("br")),p.appendChild(g);r.appendChild(p),u++}}},R=function(e){for(var t,i=HTMLUtil.findNodesInTable(e,"tr"),n=i.length,o=n,r=0;r<n;r++){var a=(i[r],HTMLUtil.findNodesInTable(i[r],"td,th")),s=a.length;"undefined"==typeof t?t=s:void 0;for(var l=0;l<s;l++){var d=a[l];d.setAttribute("data-matrix-position",JSON.stringify([r,l]))}}e.setAttribute("data-children-count",JSON.stringify({rows:o,cols:t}))},O=function(e){for(var t=0,i=HTMLUtil.findNodesInTable(e,"tr"),n=i.length,o=0;o<n;o++){for(var r=0,a=i[o].childNodes,s=0,l=a.length;s<l;s++){var d=a[s];HTMLUtil.nodeNameEquals(d,"td|th")&&(r+=1)}t=Math.max(t,r)}return t},b=function(e){for(var t=function(e){var t=e.parentNode;if(HTMLUtil.nodeNameEquals(t,"body")){var i=e.nextSibling;if(i&&HTMLUtil.nodeNameEquals(i,"table")){var n=D("p");HTMLUtil.insertAfter(n,e)}}else if(HTMLUtil.nodeNameEquals(t,"td|th")){var i=e.nextSibling;if(!i||i&&HTMLUtil.nodeNameEquals(i,"table")){var n=D("p");HTMLUtil.insertAfter(n,e)}}},i=function(e){var t=e.parentNode;if(HTMLUtil.nodeNameEquals(t,"body")){var i=e.previousSibling;if(!i){var n=D("p");HTMLUtil.setAttribute(n,{"data-para-info":JSON.stringify({type:NODE_TYPE.PARAGRAPH})}),e.parentNode.insertBefore(n,e)}}else if(HTMLUtil.nodeNameEquals(t,"td|th")){var i=e.previousSibling;if(!i){var n=D("p");e.parentNode.insertBefore(n,e)}}},n=e.querySelectorAll("table"),o=0,r=n.length;o<r;o++)t(n[o]);for(var o=0,r=n.length;o<r;o++)i(n[o])},v=function(e){L(e);for(var t=e.querySelectorAll("table"),i={},n=t.length,o=function(e){e.setAttribute("id","tb-"+Utils.randomString());var t=HTMLUtil.findNodesInTable(e,"caption");try{t.forEach(function(e){e.parentNode.removeChild(e)})}catch(e){throw PubSub.publish("GenerateOp/PasteError","exception in caption removing"),e}var n,o=[],r=e.getAttribute("data-width"),a=e.getAttribute("data-cols");S(e),R(e);var s=HTMLUtil.findNodesInTable(e,"tr");if(0==s.length)return void e.parentNode.removeChild(e);a=a&&JSON.parse(a)||[];var l=O(e);a.length==l;if(a.length)for(var d=0;d<a.length;d++)o.push(a[d]);else o=I(e);if(r)n=r;else{n=0;for(var d=0;d<o.length;d++)n+=parseFloat(o[d]);n+=UNITS.PIXELS}i={"data-width":n,"data-cols":JSON.stringify(o)},HTMLUtil.setAttribute(e,i)},r=0;r<n;r++){var a=t[r];o(a)}},D=function(e){var t=document.createElement(e);if("p"===e)HTMLUtil.setAttribute(t,{"data-para-info":JSON.stringify({type:NODE_TYPE.PARAGRAPH})});else if("tr"===e){t.setAttribute("id","rw-"+Utils.randomString());var i=document.createElement("td");i.setAttribute("id","cl-"+Utils.randomString()),t.appendChild(i)}else"td"===e?t.setAttribute("id","cl-"+Utils.randomString()):"table"===e&&t.setAttribute("id","tb-"+Utils.randomString());return t},L=function(e){for(var t=e.querySelectorAll("td,th"),i=t.length,n=0;n<i;n++){var o=t[n];if(o.setAttribute("id","cl-"+Utils.randomString()),!HTMLUtil.nodeNameEquals(o.parentNode,"tr")){var r=D("table"),a=D("tr");r.appendChild(a),HTMLUtil.insertAfter(o,r),a.appendChild(o)}}for(var s=e.querySelectorAll("tr"),i=s.length,n=0;n<i;n++){var l=s[n];if(l.setAttribute("id","rw-"+Utils.randomString()),!HTMLUtil.nodeNameEquals(l.parentNode,"table|tbody|thead|tfoot")){var r=D("table");HTMLUtil.insertAfter(l,r),r.appendChild(l)}}},N=function(e){return e.textContent&&e.textContent.length},P=function(e){if(e.nodeType!=Node.ELEMENT_NODE||e.hasAttribute("data-writer-tab")){if(e.nodeType==Node.TEXT_NODE&&!e.parentNode.hasAttribute("data-writer-tab")&&!e.parentNode.classList.contains("EOP")){var t=e.textContent;if(t=t.replace(/ *(\n+) */g," "),t=t.replace(/ *(\t+) */g," "),t.length){var i=e.parentNode.getAttribute("data-white-space");if(i&&"false"==i&&("span"!=e.parentNode.nodeName.toLowerCase()||" "!=e.parentNode.textContent)){var n=t.replace(/ */g,"");t=n.length?t:n}}var o={content:t};"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/TextContent",o),e.textContent=o.content}}else{var r=["whiteSpace"],a=HTMLUtil.getComputedStylesFromBrowser(e,r).whiteSpace,s=e.innerHTML,l="false";if(a.indexOf("pre")!=-1&&(l="true",(s.match(/\n/g)||s.match(/\t/g))&&s.indexOf("data-text-info")==-1)){s=s.replace(/[\n]/g,"<br>");var d=document.createElement("span"),c={st:NODE_TYPE.TAB,type:NODE_TYPE.TEXT,leader:"0"};d.innerText="\t",d.setAttribute("data-text-info",JSON.stringify(c)),d.setAttribute("data-writer-tab",JSON.stringify({cls:"Apple-tab-span"})),s=s.replace(/[\t]/g,d.outerHTML),e.innerHTML=s}e.setAttribute("data-white-space",l)}for(var u=0,p=e.childNodes,g=e.childNodes.length;u<g;u++){var f=p[u];P(f)}},C=function(t){for(var i=[],n=0,o=t.childNodes,r=t.childNodes.length;n<r;n++){var a=o[n];a.nodeType==Node.COMMENT_NODE||HTMLUtil.nodeNameEquals(a,"style")||(e.indexOf(a.nodeName.toLowerCase())!=-1?a.nodeType==Node.TEXT_NODE?N(a)?i.push(a):"":i.push(a):a.nodeType!=Node.TEXT_NODE&&a.hasAttribute("data-writer-tab")?i.push(a):i=i.concat(C(a)))}return i},y=function(e){var t=HTMLUtil.getParentNode(e,"a");return!(!t||!t.hasAttribute("href"))},F=function(e){for(var t=e.querySelectorAll("img"),i=0,n=t.length;i<n;i++){var o=t[i];HTMLUtil.setAttribute(o,{"data-img-info":JSON.stringify(CSSToJSON.getImageStyles(o))})}},M=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/Iframe",[e]);for(var t=e.querySelectorAll("iframe"),i=0,n=t.length;i<n;i++){var o=t[i];HTMLUtil.setAttribute(o,{"data-iframe-info":JSON.stringify(CSSToJSON.getIframeStyles(o))})}},w=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/HR",[e]);for(var t=e.querySelectorAll("hr"),i=0,n=t.length;i<n;i++)HTMLUtil.setAttribute(t[i],{"data-hr-info":JSON.stringify(CSSToJSON.getHRStyles(t[i]))})},U=function(e){i.notAllowedTags;H(e)},x=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/MailMerge",[e])},B=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/SimpleRepeat",[e])},H=function(e){for(var t=e.querySelectorAll("xmp"),i=0;i<t.length;i++){var n=document.createElement("div"),o=t[i].getAttribute("style"),r=t[i].parentNode;n.innerText=t[i].innerText,n.setAttribute("style",o),r.replaceChild(n,t[i])}},G=function(e){"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/RemoveSpecialLisr",[e])},k=function(e){for(var t=["data-hlist-type","data-continue-list-id","data-continue-bullet-id"],i="",n=t.length-1;n>-1;n--)i+="["+t[n]+"]",0!=n&&(i+=",");for(var o=Array.from(e.querySelectorAll(i)),n=o.length-1;n>-1;n--)z(o[n],t)},W=function(e){for(var t=Array.from(e.querySelectorAll("[data-shapedata]")),i=t.length-1;i>-1;i--){var n=t[i];n.parentNode.removeChild(n)}},Y=function(e){for(var t=Array.from(e.querySelectorAll("span[data-tag-info]")),i=t.length-1;i>-1;i--){var n=t[i];n.parentNode.removeChild(n)}for(var t=Array.from(e.querySelectorAll("span[data-display-type]")),i=t.length-1;i>-1;i--){var n=t[i];n.removeAttribute("data-display-type")}},z=function(e,t){for(var i=t.length-1;i>-1;i--)e.removeAttribute(t[i])},Z=function(){var e=[];return i.isAllowed.text?e.push("#text"):void 0,i.isAllowed.lineBreak?e.push("br"):void 0,i.isAllowed.horizontalRule?e.push("hr"):void 0,i.isAllowed.image?e.push("img"):void 0,i.isAllowed.iframe?e.push("iframe"):void 0,e},V=function(t){t=t?t:{};var o=ZWJSONUtils.clone(n);ZWJSONUtils.mergeJsonObjs(o,t);var r={horizontalRule:"hr",lineBreak:"br",image:"img",iframe:"iframe",input:"input",table:"table",shape:"shape"};i.isAllowed={},i.notAllowedTags=[],i.fn={};for(var a in o)i.isAllowed[a]=!("undefined"!=typeof o[a].isAllowed&&!o[a].isAllowed),i.isAllowed[a]?i.fn[a]=Q[a]:(i.fn[a]=$[a],r.hasOwnProperty(a)&&i.notAllowedTags.push(r[a]));return e=Z(),i.allowedPostionToInsert=i.isAllowed.table?["td","th","body"]:["body"],i},j=function(e){var t={};for(var n in i.fn)t[n]="function"==typeof i.fn[n]?i.fn[n](e):void 0;return t},X=function(e,n){t.log("FROM HTMLPREProcessor :: "+e.outerHTML);var o=e,r=[],a=document.createElement("body");i=V(n),U(o);var s=j(o);if(r=C(o),s.list&&s.list.listInfo&&Object.keys(s.list.listInfo).length){var l=s.list||{},d=l.listInfo;if(a.setAttribute("data-list-info",JSON.stringify(d)),l.hasOwnProperty("paraStyles")&&Object.keys(l.paraStyles).length&&a.setAttribute("data-para-info",JSON.stringify(l.paraStyles)),l.hasOwnProperty("bulletInfo")&&Object.keys(l.bulletInfo).length){var c=l.bulletInfo;a.setAttribute("data-bullet-info",JSON.stringify(c))}}s.noteSettings&&s.noteSettings.footnote&&a.setAttribute("data-footnote-info",JSON.stringify(s.noteSettings.footnote)),s.noteSettings&&s.noteSettings.endnote&&a.setAttribute("data-endnote-info",JSON.stringify(s.noteSettings.endnote)),s.namedRange&&s.namedRange.op&&a.setAttribute("data-named-range-info",JSON.stringify(s.namedRange)),Object.keys(s.tagCollection).length&&a.setAttribute("data-tag-collection-info",JSON.stringify(s.tagCollection));for(var u,p=r.length,g=0;g<p;){var f=r[g],E=[f],T=HTMLUtil.getBlockParent(f),m=!1;HTMLUtil.nodeNameEquals(f,"hr")&&(m=!0);var h,I,_=document.createElement("p");if(h=HTMLUtil.nodeNameEquals(T,"body")?{type:NODE_TYPE.PARAGRAPH}:HTMLUtil.nodeNameEquals(T,"td|th")?CSSToJSON.getParaStyleFromCell(T):T.hasAttribute("data-para-info")?JSON.parse(T.getAttribute("data-para-info")):CSSToJSON.getParagraphStylesOfBlockEle(T),I=CSSToJSON.getTextStylesOfBlockEle(T),h.hasOwnProperty("ts")||(h.ts={},"undefined"!=typeof PubSub&&PubSub.publish("HTMLPreProcessor/mergeObjs",[h.ts,I])),T.hasAttribute("data-hlist-type")&&_.setAttribute("data-hlist-type",T.getAttribute("data-hlist-type")),T.hasAttribute("data-continue-list-id")){var A=T.getAttribute("data-continue-list-id");_.setAttribute("data-continue-list-id",A)}if(T.hasAttribute("data-continue-bullet-id")){var S=T.getAttribute("data-continue-bullet-id");_.setAttribute("data-continue-bullet-id",S)}for(T.hasAttribute("data-writer-border-info")&&_.setAttribute("data-writer-border-info",T.getAttribute("data-writer-border-info")),HTMLUtil.setAttribute(_,{"data-para-info":JSON.stringify(h)});g+1<p&&!HTMLUtil.nodeNameEquals(r[g+1],"hr")&&T==HTMLUtil.getBlockParent(r[g+1]);)E.push(r[g+1]),g++;var R=!1;g+1==p&&HTMLUtil.nodeNameEquals(HTMLUtil.getBlockParent(E[0]),"body")&&(R=!0);for(var O,v,D=HTMLUtil.getParentNode(f,i.allowedPostionToInsert),L=0;L<E.length;L++){var N=E[L],P=!1;if(v=N,!v.parentNode||!v.parentNode.classList.contains("EOP")){try{P=!!N.hasAttribute("data-writer-tab")}catch(e){P=!1}if(v.nodeType!=Node.TEXT_NODE)v=v.cloneNode(P);else{var u=CSSToJSON.getTextStylesOfTextNode(v),F=HTMLUtil.getParentNode(v,"span"),M=F?F.cloneNode():document.createElement("span");M.hasAttribute("data-text-info")&&extend(u,JSON.parse(M.getAttribute("data-text-info"))),M.innerText=v.textContent,M.setAttribute("data-text-info",JSON.stringify(u)),v=M}if(i.isAllowed.anchor&&y(N)){var w=HTMLUtil.getParentNode(N,"a");if((O&&O.id!=w.id||!O)&&(O=HTMLUtil.getParentNode(N,"a").cloneNode()),v.hasAttribute("data-text-info")){var x=JSON.parse(v.getAttribute("data-text-info"));x.hasOwnProperty("cls")&&x.cls.indexOf("link")==-1?x.cls+=" link":x.hasOwnProperty("cls")||(x.cls="link"),v.setAttribute("data-text-info",JSON.stringify(x))}else v.setAttribute("data-text-info",JSON.stringify({cls:"link"}));O.appendChild(v),v=O}m||R?a.appendChild(v):_.appendChild(v)}}if(R)break;if(m||D&&!HTMLUtil.nodeNameEquals(D,"body")){if(HTMLUtil.nodeNameEquals(D,"td|th")){var B=a.querySelector("#"+D.getAttribute("id"));if(!B){for(var H=HTMLUtil.getParents(D,"table"),J=H.length,G=J-1;G>=0;G--){var k=a.querySelector("#"+H[G].id);if(!k){var W=q(H[G]),Y=HTMLUtil.getParentNode(H[G],["td","th","body"]);HTMLUtil.nodeNameEquals(Y,"body")?a.appendChild(W):a.querySelector("#"+Y.id).appendChild(W)}}B=a.querySelector("#"+D.getAttribute("id"))}B.appendChild(_)}}else a.appendChild(_);g++}return b(a),K(a),a},K=function(e){for(var t=e.querySelectorAll("br"),i=0,n=t.length;i<n;i++){var o=t[i];!o.nextSibling&&o.parentNode.removeChild(o)}},q=function(e){var t=e.cloneNode(),i=HTMLUtil.findNodesInTable(e,"tr"),n=CSSToJSON.getTableStyles(e);HTMLUtil.setAttribute(t,{"data-table-info":JSON.stringify(n),"data-row-info":JSON.stringify(CSSToJSON.getRowStylesInTable(n)),"data-cell-info":JSON.stringify(CSSToJSON.getCellStylesInTable(n))});for(var o=0,r=i.length;o<r;o++){var a=i[o].cloneNode();t.appendChild(a);var s=CSSToJSON.getRowStyles(i[o]);HTMLUtil.setAttribute(a,{"data-row-info":JSON.stringify(s),"data-cell-info":JSON.stringify(CSSToJSON.getCellStylesinRow(s))});for(var l=HTMLUtil.findNodesInTable(i[o],"td,th"),d=0,c=l.length;d<c;d++){var u=l[d].cloneNode();a.appendChild(u);var p=CSSToJSON.getCellStyles(l[d]);HTMLUtil.setAttribute(u,{"data-cell-info":JSON.stringify(p)})}}return t},Q={table:v,anchor:f,image:F,iframe:M,list:p,horizontalRule:w,noteSettings:s,conditionMerge:x,headings:E,bookmarks:m,whiteSpace:P,input:r,comments:T,textBox:a,namedRange:l,simpleRepeat:B,tags:h,tagCollection:d},$={list:k,specialList:G,shape:W,tags:Y},ee=function(){t.enable()},te=function(){t.disable()};return{getDummyNode:D,getProcessedHTML:X,isInsideAnchor:y,processTD:A,enableLogger:ee,disableLogger:te}}();!function(){var e=function(e){for(var i=e[0],n=e[1],o=i.querySelectorAll("[data-spl-bullet-format]"),r={},a=0;a<o.length;a++){var s=o[a],l=JSON.parse(s.getAttribute("data-spl-bullet-format"));for(var d in l)r.hasOwnProperty(d)||(g=Utils.getRandomNumber(),n.bulletInfo[g]=l[d],r[d]=g)}var c=i.querySelectorAll("[data-list-format]");oldListInfo={};for(var a=0;a<c.length;a++){var s=c[a],u=JSON.parse(s.getAttribute("data-list-format")),p=s.getAttribute("data-list-id");oldListInfo[p]=u}for(var d in oldListInfo){var g=Utils.getRandomNumber();n.listInfo[g]=oldListInfo[d];for(var f=i.querySelectorAll('[data-list-id="'+d+'"]'),a=0;a<f.length;a++){var s=f[a],E={};if(s.querySelectorAll("ol,ul").forEach(function(e){e.setAttribute("data-list-id",g)}),s.hasAttribute("data-list-info")){var T=JSON.parse(s.getAttribute("data-list-info"));if(T.id=g,s.hasAttribute("data-bullet-id"))if(oldListInfo[d]["level"+T.l].type!=LIST_TYPE.IMAGE)s.removeAttribute("data-bullet-id"),delete T[ATTR_PARAGRAPH.BULLET_ID];else{var m;if(r.hasOwnProperty(T.bullet_id))m=r[T.bullet_id];else{var h=T.l,I=n.listInfo[g]["level"+h],_=I.bullet_id;m=r[_]}E["data-continue-bullet-id"]=s.getAttribute("data-bullet-id"),T.bullet_id=m,E["data-bullet-id"]=m}E["data-list-info"]=JSON.stringify(T),E["data-continue-list-id"]=d}E["data-list-id"]=g,HTMLUtil.setAttribute(s,E)}}t(n.listInfo,r);for(var A=i.querySelectorAll("span.zw-list-char"),a=0;a<A.length;a++)A[a].parentNode.removeChild(A[a])},t=function(e,t){var i=[ATTR_COMMON.BULLET_ID,"checked","unchecked"],n=function(e){for(var o in e){var r=e[o];e.hasOwnProperty("type")&&e.type!=LIST_TYPE.IMAGE&&e.type!=LIST_TYPE.SYMBOL?(delete e[ATTR_COMMON.BULLET_ID],delete e["data-custom_data"]):isNaN(Number(r))||i.indexOf(o)==-1?"object"==(typeof r).toLowerCase()&&n(r):e[o]=t[r]}};n(e)},i=function(e){var t=e[0],i=t.querySelectorAll('[data-bookmark-id^="toc_"]'),i=Array.prototype.slice.call(i);i.forEach(function(e){e.parentNode.removeChild(e)});for(var n=t.querySelectorAll("h1,h2,h3,h4,h5,h6,p.heading1,p.heading2,p.heading3,p.heading4,p.heading5,p.heading6"),o=0,r=n.length;o<r;o++){var a=n[o],s=document.createElement("span"),l="toc_"+Utils.randomString(),d="_Toc"+Utils.randomString();s.innerText=" ",s.setAttribute("data-range-char-type","start"),s.setAttribute("data-bookmark-id",l),s.setAttribute("data-bookmark-info",JSON.stringify({type:"bookmark",id:l,name:d}));var c=s.cloneNode(!0);c.setAttribute("data-range-char-type","end"),a.appendChild(s),a.appendChild(c)}},n=function(e){for(var t=e[0],i=t.querySelectorAll("span[data-comment-info]"),n=0,o=i.length;n<o;n++){var r=i[n],a=JSON.parse(r.getAttribute("data-comment-info")),s=a.id,l=t.querySelectorAll('[data-range-id="'+s+'"]');2==l.length||r.parentNode.removeChild(r)}},o=function(e){for(var t=e[0],i=t.querySelectorAll("span[data-tag-info]"),n={},o=0,r=i.length;o<r;o++){var a=i[o],s=JSON.parse(a.getAttribute("data-tag-info")),l=s.id,d=t.querySelectorAll('[data-tag-id="'+l+'"]');if(2==d.length){if(!n[l]){var c=Utils.randomString();n[l]=c}s.id=n[l],a.setAttribute("data-tag-info",JSON.stringify(s))}else a.parentNode.removeChild(a)}},r=function(e){for(var t=e[0],i=t.querySelectorAll("span[data-bookmark-info]"),n={},o=0,r=i.length;o<r;o++){var a=i[o],s=JSON.parse(a.getAttribute("data-bookmark-info")),l=s.id,d=t.querySelectorAll('[data-bookmark-id="'+l+'"]');if(2==d.length){if(!n[l]){var c=Utils.randomString();l.indexOf("toc_")!=-1&&(c="toc_"+c),n[l]=c}s.id=n[l],a.setAttribute("data-bookmark-info",JSON.stringify(s))}else a.parentNode.removeChild(a)}},a=function(e){var t=e[0],i=Array.from(t.getElementsByTagName("input")),n=function(e){try{var t=HTMLUtil.convertHTMLToFillableFields(e),i=HTMLUtil.convertFillableFieldsToWriterHTML(t);e.parentNode.insertBefore(i,e)}catch(t){e.parentNode.removeChild(e)}};i.forEach(n)},s=function(e){for(var t=e[0],i=t.querySelectorAll("span[data-textbox-id]"),n=0,o=i.length;n<o;n++){var r=i[n],a={};a.fmt=r.getAttribute("data-textbox-info"),a.id="zw"+Utils.randomString(),a.type="textbox",HTMLUtil.setAttribute(r,{"data-section-info":JSON.stringify(a),"data-old-section-id":r.getAttribute("data-textbox-id")});var s=r.parentNode;s.parentNode.insertBefore(r,s),s.parentNode.removeChild(s)}},l=function(e){var t=e[0],i=e[1],n=t.querySelector("[data-named-range-info]"),o={},r=function(e){for(var t in e)Array.isArray(e[t])||"object"!=typeof e[t]||r(e[t]);e.hasOwnProperty("id")&&(o.hasOwnProperty(e.id)||(o[e.id]=Utils.randomString()),e.id=o[e.id])};if(n){for(var a=JSON.parse(n.getAttribute("data-named-range-info")),s=0,l=a.length;s<l;s++)r(a[s]);i.op=JSON.stringify(a)}},d=function(e){var t=e[0],i=e[1],n=t.querySelector("[data-tag-collection-info]");n&&ZWJSONUtils.mergeJsonObjs(i,JSON.parse(n.getAttribute("data-tag-collection-info")))},c=function(e){for(var t=e[0],i=e[1],n=["footnote","endnote"],o=0,r=n.length;o<r;o++){var a=n[o],s=t.querySelectorAll("span[data-"+a+"-id]");if(0!=s.length){str="data-"+a+"-info",noteInfo=t.querySelector("span["+str+"]").getAttribute(str),i[a]=noteInfo?JSON.parse(noteInfo):void 0;for(var l=0,d=s.length;l<d;l++){var c=s[l],u={};u.id="zw"+Utils.randomString(),u.type=a,HTMLUtil.setAttribute(c,{"data-section-info":JSON.stringify(u),"data-old-section-id":c.getAttribute("data-"+a+"-id")});var p=c.parentNode;p.parentNode.insertBefore(c,p),p.parentNode.removeChild(p)}}}},u=function(e){for(var t=e[0],i=t.querySelectorAll("iframe"),n=0,o=i.length;n<o;n++){var r=i[n];r.getAttribute("src")}},p=function(e){for(var t=e[0],i=Array.from(t.querySelectorAll("hr")),n=0,o=i.length;n<o;n++){var r=i[n];if(!r.hasAttribute("data-hr-info")){var a=HTMLUtil.getComputedStylesFromBrowser(t,["pageBreakAfter"]);"always"!=a.pageBreakAfter&&"auto"!=a.pageBreakAfter||r.setAttribute("data-hr-info",JSON.stringify({cls:"pgbrk",type:"hr",bid:"pgbrk"}))}}},g=function(e){var t=e[0],i=Array.from(t.querySelectorAll("[data-condition-id]")),n=[];i.forEach(function(e){n.push(e.getAttribute("data-condition-id"))}),n=Utils.uniqueArray(n),Array.isArray(n)&&n.forEach(function(e){var i=Array.from(t.querySelectorAll('[data-condition-id="'+e+'"]'));if(3!=i.length)i.forEach(function(e){e.parentNode.removeChild(e)});else{var n=Utils.randomString();i.forEach(function(e){if(e.setAttribute("data-condition-id",n),e.hasAttribute("data-condition-info")){var t=JSON.parse(e.getAttribute("data-condition-info"));t.id=n,e.setAttribute("data-condition-info",JSON.stringify(t))}})}})},f=function(e){var t=e[0],i=Array.from(t.querySelectorAll("[data-repeat-id]")),n=[];i.forEach(function(e){n.push(e.getAttribute("data-repeat-id"))}),n=Utils.uniqueArray(n),Array.isArray(n)&&n.forEach(function(e){var i=Array.from(t.querySelectorAll('[data-repeat-id="'+e+'"]'));if(2!=i.length)i.forEach(function(e){e.parentNode.removeChild(e)});else{var n=Utils.randomString();i.forEach(function(e){if(e.setAttribute("data-repeat-id",n),e.hasAttribute("data-repeat-info")){var t=JSON.parse(e.getAttribute("data-repeat-info"));t.id=n,e.setAttribute("data-repeat-info",JSON.stringify(t))}})}})},E=function(e){e.content=PasteUtil.removeDocUniCodes(e.content)},T=function(e){var t=e[0],i=Array.from(t.querySelectorAll(".zw-special-list"));i.forEach(function(e){e.removeAttribute("data-list-info")})},m=function(e){var t=DocUtil.mergeObjs(e);for(var i in e[0])delete e[0][i];for(i in t)e[0][i]=t[i]};PubSub.subscribe("HTMLPreProcessor/RemoveSpecialLisr",T),PubSub.subscribe("HTMLPreProcessor/mergeObjs",m),PubSub.subscribe("HTMLPreProcessor/TextContent",E),PubSub.subscribe("HTMLPreProcessor/List",e),PubSub.subscribe("HTMLPreProcessor/Headings",i),PubSub.subscribe("HTMLPreProcessor/Comments",n),PubSub.subscribe("HTMLPreProcessor/Bookmarks",r),PubSub.subscribe("HTMLPreProcessor/Tags",o),PubSub.subscribe("HTMLPreProcessor/NoteContainer",c),PubSub.subscribe("HTMLPreProcessor/NamedRange",l),PubSub.subscribe("HTMLPreProcessor/TagCollection",d),PubSub.subscribe("HTMLPreProcessor/Input",a),PubSub.subscribe("HTMLPreProcessor/TextBox",s),PubSub.subscribe("HTMLPreProcessor/Iframe",u),PubSub.subscribe("HTMLPreProcessor/HR",p),PubSub.subscribe("HTMLPreProcessor/MailMerge",g),PubSub.subscribe("HTMLPreProcessor/SimpleRepeat",f)}();var WriterContentBuilder=function(){var e,t=new ZWConsole,i=UNICODE.CELL+"|"+UNICODE.TABLE+"|"+UNICODE.ROW+"|"+UNICODE.IMAGE+"|"+UNICODE.TAB,n=["data-tab-info","data-keep-line-info","data-page-break-info","data-hd-info","data-textformat","data-codeformat","data_styles","data-hlist-type","data-custom_data","data-format","data-video-data","data-mminfo","data-crop-info","data-zw-imagesrc","data-thumbnail","data-hr-info","data-align","data-cols","data-width","data-theme","data-list-info","data-list-id","data-bullet-id","data-format-attr","data-section-info","data-footnote-info","data-endnote-info","section-bullet-format","section-list-format","data-spl-bullet-format","data-list-format","data-continue-list-id","data-continue-bullet-id","data-para-info","data-text-info","data-tab","data-white-space","data-bullet-info","data-writer-border-info","data-window-control-info","data-bgimg-name","data-mergefield-info","data-autofield-info","data-fillablefield-info","data-signerfield-info","data-shapedata","data-range-char-type","data-comment-info","data-condition-id","data-condition-info","data-repeat-info","data-repeat-id","data-sheet-info","data-cell-height","data-chartfield-info","data-tag-info","data-tag-id","data-display-type"],o=["data-para-info","data-writer-border-info","data-window-control-info","data-tab-info","data-keep-line-info","data-page-break-info","data-hd-info","data-textformat","data-codeformat","data_styles","data-hlist-type","data-custom_data","data-list-info"],r=["data-cols","data-width","data-theme","data-bgimg-name","data-format-attr","data-sheet-range-info"],a=["data-format","data-video-data","data-mminfo","data-crop-info","data-zw-imagesrc","data-shapedata","data-barcode-info","data-qrcode-info","data-subtype-info","data-fillablefield-info"],s=["data-thumbnail","data-sheet-info"],l=["dataAttrs.hr"],d=["data-text-info","data-section-info","data-footnote-info","data-mergefield-info","data-autofield-info","data-fillablefield-info","data-signerfield-info","data-range-char-type","data-comment-info","data-endnote-info","section-bullet-format","section-list-format","data-format-attr","data-condition-id","data-condition-info","data-repeat-info","data-repeat-id","data-tag-info","data-tag-id","data-display-type"],c=["data-list-info","data-list-id","data-bullet-id","data-textFormat","data_styles"],u=["data-spl-bullet-format","data-list-format","data-list-id"],p=["data-format-attr","data-cell-height"],g={fontWeight:ATTR_TEXT.TS_FW,fontSize:ATTR_TEXT.TS_SIZE,fontFamily:ATTR_TEXT.TS_FF,fontStyle:ATTR_TEXT.TS_FS,color:ATTR_TEXT.TS_FGC,"text-decoration":ATTR_TEXT.TS_TD,backgroundColor:ATTR_TEXT.TS_BGC,verticalAlign:ATTR_TEXT.TS_VA,"letter-spacing":ATTR_TEXT.TS_CS,fontVariant:ATTR_TEXT.TS_FV},f={textAlign:ATTR_PARAGRAPH.PS_AL,textIndent:ATTR_PARAGRAPH.PS_TI,backgroundColor:ATTR_PARAGRAPH.PS_BGC,marginLeft:ATTR_PARAGRAPH.PS_ML,marginRight:ATTR_PARAGRAPH.PS_MR,marginBottom:ATTR_PARAGRAPH.PS_SA,marginTop:ATTR_PARAGRAPH.PS_SB,lineHeight:ATTR_PARAGRAPH.PS_LS,borders:ATTR_COMMON.BORDERS},E=[ATTR_BORDERS.BORDER_TOP,ATTR_BORDERS.BORDER_RIGHT,ATTR_BORDERS.BORDER_LEFT,ATTR_BORDERS.BORDER_BOTTOM],T=[AUTOFIELD_TYPE.AUTO_FORMULA,CONST.MERGEFIELD,NODE_TYPE.FILLABLEFIELD,NODE_TYPE.SIGNERFIELD,AUTOFIELD_TYPE.AUTO_DOCNAME,AUTOFIELD_TYPE.AUTO_AUTHOR,AUTOFIELD_TYPE.AUTO_DOCVERSION,AUTOFIELD_TYPE.USER_PHONE,AUTOFIELD_TYPE.USER_FIRST_NAME,AUTOFIELD_TYPE.USER_LAST_NAME,AUTOFIELD_TYPE.USER_EMAIL],m=[AUTOFIELD_TYPE.AUTO_PAGECOUNT],h=function(e){var t={};if(!U.isEmpty(DocumentDesign.getComputedParaStyle("h0"))){var i=e?DocumentDesign.getComputedParaStyle("h"+e):{};t=U.isEmpty(i)?DocumentDesign.getComputedParaStyle("h0").textFormat:i.textFormat}return{fontWeight:t[ATTR_TEXT.TS_FW]||"normal",fontSize:t[ATTR_TEXT.TS_SIZE],fontFamily:t[ATTR_TEXT.TS_FF],fontStyle:t[ATTR_TEXT.TS_FS]||"normal",color:t[ATTR_TEXT.TS_FGC]||"rgb(0, 0, 0)","text-decoration":t[ATTR_TEXT.TS_TD]||"none",backgroundColor:t[ATTR_TEXT.TS_BGC]||"rgba(0, 0, 0, 0)",verticalAlign:t[ATTR_TEXT.TS_VA]||"baseline","letter-spacing":t[ATTR_TEXT.TS_CS]||"0pt",fontVariant:t[ATTR_TEXT.TS_FV]||"normal"}},I=function(e){var t={};if(!U.isEmpty(DocumentDesign.getComputedParaStyle("h0"))){var i=e?DocumentDesign.getComputedParaStyle("h"+e):{};t=U.isEmpty(i)?DocumentDesign.getComputedParaStyle("h0"):i}var n={};return n[ATTR_COMMON.BORDERS]={},n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]={type:"none",width:"0px",color:"rgb(0, 0, 0)",space:"0px"},n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]={type:"none",width:"0px",color:"rgb(0, 0, 0)",space:"0px"},n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]={type:"none",width:"0px",color:"rgb(0, 0, 0)",space:"0px"},n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={type:"none",width:"0px",color:"rgb(0, 0, 0)",space:"0px"},{borders:t[ATTR_COMMON.BORDERS]||n[ATTR_COMMON.BORDERS],textAlign:t[ATTR_PARAGRAPH.PS_AL]||0,marginRight:t[ATTR_PARAGRAPH.PS_MR]||"0in",marginTop:t[ATTR_PARAGRAPH.PS_SB]||"0pt",marginBottom:t[ATTR_PARAGRAPH.PS_SA]||"0pt",marginLeft:t[ATTR_PARAGRAPH.PS_ML]||"0in",paddingLeft:t[ATTR_PARAGRAPH.PS_PL]||"0in",paddingRight:t[ATTR_PARAGRAPH.PS_PR]||"0in",paddingTop:t[ATTR_PARAGRAPH.PS_PT]||"0in",paddingBottom:t[ATTR_PARAGRAPH.PS_PB]||"0in",backgroundColor:t[ATTR_PARAGRAPH.PS_BGC]||"rgba(0, 0, 0, 0)",textIndent:t[ATTR_PARAGRAPH.PS_TI]||"0in",lineHeight:parseFloat(t[ATTR_PARAGRAPH.PS_LS])||1.2}},_=function(t,n){var o=[];"string"==typeof t&&(t=[{cont:t,styles:n}]);for(var r=t.length,a=0;a<r;a++){var s=t[a].cont,l=Utils.randomString();n=t[a].styles,e&&s==UNICODE.CELL&&(e!=UNICODE.PARA&&e!=UNICODE.ROW?PubSub.publish("GenerateOp/PasteError","paraCharMissingInCell"):void 0),n&&U.isEmpty(n)&&PubSub.publish("GenerateOp/PasteError","empty style obj"),n?o.push({as:{start:n,id:l}},{is:s},{as:{end:ZWJSONUtils.getKeys(n),id:l}}):(i.indexOf(s)!=-1&&PubSub.publish("GenerateOp/PasteError",s+" without style"),o.push({is:s})),e=s}return o},A=function(e){var t,i=UNICODE.RANGE_START,n=[],o=UNICODE.RANGE_END,r=e.style,a=r.textInfo||r.fillablefieldInfo,s=a[ATTR_COMMON.CLS],l={},d={},c={},u=!0,p=r.hasOwnProperty("mergefieldInfo")?r.mergefieldInfo:r.hasOwnProperty("autofieldInfo")?r.autofieldInfo:r.hasOwnProperty("fillablefieldInfo")?r.fillablefieldInfo:r.hasOwnProperty("signerfieldInfo")?r.signerfieldInfo:null;d=p?p:{},d.id="zw"+Utils.randomString();for(var g=!1,f=0,E=T.length;f<E;f++){var h=T[f];if(s.indexOf(h)!=-1){g=!0;break}}g||s.indexOf(AUTOFIELD_TYPE.AUTO_DATE)==-1||0!=d[ATTR_AUTOFIELD.ISAUTO]||(g=!0);var I=g?e.cont:m.indexOf(s)!=-1?"##":"#";if(d.type!==NODE_TYPE.AUTOFIELD&&d.type!==NODE_TYPE.MAILMERGEFIELD&&d.type!==NODE_TYPE.FILLABLEFIELD&&d.type!==NODE_TYPE.SIGNERFIELD||(l={cls:s,type:NODE_TYPE.TEXT},c={id:d.id,type:d.type},l.fieldinfo=d.id,extend(a,l)),r.fillablefieldInfo&&r.fillablefieldInfo.cls===NODE_TYPE.FILLABLEFIELD&&(I=UNICODE.IMAGE,a=r.fillablefieldInfo,a.fieldinfo=d.id,u=!1),r.hasOwnProperty("footnoteInfo")||r.hasOwnProperty("endnoteInfo")||r.hasOwnProperty("textboxInfo")){var _=r.sectionInfo;t=_.type,"textbox"==t?(I=UNICODE.IMAGE,a=JSON.parse(_.fmt),a.id=_.id,d=c={}):(d.type=t,d.id=_.id,l={type:NODE_TYPE.TEXT,cls:_.type,id:_.id},c=d,extend(a,l))}return u&&!U.isEmpty(d)&&n.push({cont:i,styles:d}),n.push({cont:I,styles:a}),u&&!U.isEmpty(c)&&n.push({cont:o,styles:c}),n},S=function(e){var t,i,n,o=e.type,r=e.style,a=e.cont;switch(o){case NODE_TYPE.TEXT:if(r.hasOwnProperty("mergefieldInfo")||r.hasOwnProperty("autofieldInfo")||r.hasOwnProperty("footnoteInfo")||r.hasOwnProperty("endnoteInfo")||r.hasOwnProperty("textboxInfo")||r.hasOwnProperty("fillablefieldInfo")||r.hasOwnProperty("signerfieldInfo"))i=A(e);else if(r.hasOwnProperty("commentInfo")||r.hasOwnProperty("bookmarkInfo")){var s=r.rangeCharType;t=r.hasOwnProperty("commentInfo")?r.commentInfo:r.bookmarkInfo,i="start"==s?UNICODE.RANGE_START:UNICODE.RANGE_END}else if(r.hasOwnProperty("tagInfo")){var s=r.rangeCharType;t=r.tagInfo,i="start"==s?UNICODE.RANGE_START:UNICODE.RANGE_END}else if(r.hasOwnProperty("conditionId")){var s=r.rangeCharType;switch(s){case"start":case"end":i="start"==s?UNICODE.RANGE_START:UNICODE.RANGE_END,t=DocUtil.copyStyle(r.conditionInfo);break;case"else":i=UNICODE.FIELD_SEPARATOR,t={},t.id=r.conditionId,t.type=NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR}}else if(r.hasOwnProperty("repeatId")){var s=r.rangeCharType;switch(s){case"start":case"end":i="start"==s?UNICODE.RANGE_START:UNICODE.RANGE_END,t=DocUtil.copyStyle(r.repeatInfo)}}else r.hasOwnProperty("textInfo")&&(t=r.textInfo,i=a);t&&t.hasOwnProperty("cls")&&(t.cls.indexOf("footnote")!=-1||t.cls.indexOf("endnote")!=-1||t.cls.indexOf("textbox")!=-1)&&delete t.cls;break;case NODE_TYPE.BR:t={type:NODE_TYPE.BR},i=a;break;case"anchor":t=r.linkInfo,r.hasOwnProperty("mminfo")&&(t.mminfo=r.mminfo),i=UNICODE.RANGE_START;break;case NODE_TYPE.TABLE:t=r.tableInfo,i=a;break;case NODE_TYPE.CELL:t=r.cellInfo,i=a;break;case NODE_TYPE.ROW:t=r.rowInfo,i=a;break;case NODE_TYPE.HR:t={},t=r.hrInfo,i=a;break;case NODE_TYPE.IMAGE:r.fillablefieldInfo?i=A(e):(t=r.imgInfo,i=a);break;case NODE_TYPE.WIDGET:t=r.iframeInfo,i=a}return n=U.isEmpty(i)?void 0:_(i,t)},R=function(e){var t=e.style,i=t.tocInfo;return contStyleArr=[],rngStart_style=i,rngEnd_style=ZWJSONUtils.clone(i),delete rngEnd_style.name,contStyleArr.push({cont:UNICODE.RANGE_START,styles:rngStart_style}),contStyleArr.push({cont:UNICODE.RANGE_END,styles:rngEnd_style}),contStyleArr.push({cont:UNICODE.PARA,styles:t.paraInfo}),contStyleArr},O=function(e){var t,i,n,o=e.type,r=e.style;switch(o){case NODE_TYPE.PARAGRAPH:t=r.paraInfo,r.hasOwnProperty("continueListId")&&extend(t,{"continue-list-id":r.continueListId}),r.hasOwnProperty("continueBulletId")&&extend(t,{"continue-bullet-id":r.continueBulletId}),i=UNICODE.PARA,r.hasOwnProperty("tocInfo")&&(i=R(e));break;case NODE_TYPE.TABLE:t={type:NODE_TYPE.TABLEEND},i=UNICODE.TABLEEND;break;case"anchor":t={id:r.linkInfo.id,type:NODE_TYPE.LINK},i=UNICODE.RANGE_END}return n=o==NODE_TYPE.BODY?b(r):U.isEmpty(i)?void 0:_(i,t)},b=function(e){var t=["listInfo","bulletInfo","paraInfo","endnoteInfo","footnoteInfo"],i=[],n=Object.keys(e);len=n.length;for(var o=0;o<len;o++){var r=e[n[o]];if(t.indexOf(r)){var a=Utils.randomString();extend(r,{type:"body"}),i.push({r:0},{as:{start:r,id:a}},{r:0},{as:{end:ZWJSONUtils.getKeys(r),id:a}})}}return i},v=function(t,i){e=void 0;var T=[],m=[],_=0,A=[],R=!0,b={},v={},L={},N=null,P={},C={},y=!1;i&&i.hasOwnProperty("imgProcess")&&(i.imgProcess.upload(t),y=!0);var F=function(e){if(e.parents=A,PubSub.publish("InsertHTML/nodeCreated",e,i),delete e.parents,!U.isEmpty(e)){var t;if(A.push(e),style=e.style,e.type==NODE_TYPE.IMAGE&&!e.style.hasOwnProperty("chartfieldInfo")||e.type==NODE_TYPE.WIDGET&&e.style.hasOwnProperty("sheetInfo"))if(style.shapedata)style.imgInfo[ATTR_IMAGE.I_SHAPEDATA]=style.shapedata;else{var n,o,r=style.fillablefieldInfo||style.signerfieldInfo||style.imgInfo||style.iframeInfo,n=r.src||r.ffInfo&&r.ffInfo.value;if(!(n&&(HTMLUtil.isValidImageURL(n)||HTMLUtil.isBase64Img(n)||r.hasOwnProperty(MAILMERGE.MMINFO)||style.fillablefieldInfo||style.signerfieldInfo)))return void UIUtils.showImageFailedMsg();if(r.hasOwnProperty(MAILMERGE.MMINFO)||r.ffInfo||r.sfInfo||(n=y?i.imgProcess.getImgSrc(n):n),r.src=n,width=r[ATTR_IMAGE.I_WID],height=r[ATTR_IMAGE.I_HT],0==width||0==height){var a=PasteUtil.getImageCache(n);U.isEmpty(a)?(r[ATTR_IMAGE.I_WID]=250,r[ATTR_IMAGE.I_HT]=150,o=Utils.randomString(),style.imgInfo.tempId=o):(r[ATTR_IMAGE.I_WID]=a[ATTR_IMAGE.I_WID],r[ATTR_IMAGE.I_HT]=a[ATTR_IMAGE.I_HT])}}else if(e.type==NODE_TYPE.TABLE){var n=style.tableInfo[ATTR_TABLE.TBLS_BGIMG];style.tableInfo[ATTR_TABLE.TBLS_COLS]&&(style.tableInfo[ATTR_TABLE.TBLS_VER]="4.0"),n&&n.indexOf("data:image")!=-1&&n.indexOf("base64")!=-1&&(style.tableInfo[ATTR_TABLE.TBLS_BGIMG]=HTMLUtil.storeImageInFileStore(n))}else if(e.type==NODE_TYPE.CELL){var n=style.cellInfo[ATTR_CELL.TDS_BGIMG];n&&n.indexOf("data:image")!=-1&&n.indexOf("base64")!=-1&&(style.cellInfo[ATTR_CELL.TDS_BGIMG]=HTMLUtil.storeImageInFileStore(n))}else if(e.type==NODE_TYPE.TEXT){var s=h(_);s=L[_];for(var l in s)s[l]==style.textInfo[g[l]]&&delete style.textInfo[g[l]];e.style.sectionInfo&&(e.style.hasOwnProperty("footnoteInfo")||e.style.hasOwnProperty("endnoteInfo")||e.style.hasOwnProperty("textboxInfo"))&&(P[e.style.oldSectionId]=e.style.sectionInfo)}else e.type==NODE_TYPE.PARAGRAPH?_=style.paraInfo[ATTR_PARAGRAPH.PS_HD]:e.type==NODE_TYPE.BODY&&(N=style.listInfo);t=S(e),t?T=T.concat(t):void 0}},M=function(e){if(!U.isEmpty(e)){var t,i=e.style;if(e.type==NODE_TYPE.BODY){if(i.hasOwnProperty("bulletInfo")){var n=i.bulletInfo;for(var o in n){var r=n[o].img;r&&r.src.indexOf("data:image")!=-1&&r.src.indexOf("base64")>-1&&(r.src=HTMLUtil.storeImageInFileStore(r.src))}}i.hasOwnProperty("namedRangeInfo")&&(C=JSON.parse(i.namedRangeInfo.op),delete i.namedRangeInfo),i.hasOwnProperty("tagCollectionInfo")&&(PubSub.publish("WriterContentBuilder/TagCollectionInfo",i.tagCollectionInfo),delete i.tagCollectionInfo),U.isEmpty(b)||(i.paraInfo={},i.paraInfo[ATTR_BODY.DS_STYLES]=b,i.hasOwnProperty("listInfo")?i.listInfo[0]=v:(i.listInfo={},i.listInfo[0]=v,i.listInfo.st="listFormat"))}else if(e.type==NODE_TYPE.PARAGRAPH){if(i.hasOwnProperty("hlistType")&&R){var a=parseInt(e.style.hlistType);v=HLIST_TYPE[a],b=ListUtils.getBodyStylesForHeadingList(a,0),R=!1}var s=i.paraInfo;if(s.hasOwnProperty("ls_data")){if(s.ls_data.hasOwnProperty("bullet_id")){var l=N[s.ls_data.id];if(l.level0.hasOwnProperty("data-custom_data")){var d=l.level0["data-custom_data"];Number(d.unchecked)!=Number(s.ls_data.bullet_id)&&Number(d.checked)!=Number(s.ls_data.bullet_id)&&PubSub.publish("GenerateOp/PasteError","Check List ID mismatch")}}s.ls_data.l>8&&PubSub.publish("GenerateOp/PasteError","Invalid list Data")}var c,c=I(_),i=e.style,u=!0;for(var o in c)if("borders"==o){for(var o in E){var p=E[o],g=i.paraInfo[ATTR_COMMON.BORDERS]&&i.paraInfo[ATTR_COMMON.BORDERS][p]?i.paraInfo[ATTR_COMMON.BORDERS][p]:{};defaultParaBorderVal=c[ATTR_COMMON.BORDERS][p]?c[ATTR_COMMON.BORDERS][p]:{},ZWJSONUtils.compareJSON(g,defaultParaBorderVal)||(u=!1)}if(u)for(var o in E)delete i.paraInfo[o]}else c[o]==i.paraInfo[f[o]]&&delete i.paraInfo[f[o]];_=0}else if("anchor"==e.type){var h=A.length-1,S=A[h].style.linkInfo;i.linkInfo[ATTR_COMMON.ID]=S.id}t=O(e),t&&e.type==NODE_TYPE.BODY?m=t:t?T=T.concat(t):void 0,A.pop()}},w={startHandler:F,endHandler:M};if(!(PasteUtil.isPlainTextPaste(t)||i&&i.isWriterDocument)){for(var x="",B=t,H=n.length-1;H>-1;H--)x+="["+n[H]+"]",0!=H&&(x+=",");DomUtil.nodeNameEquals(t,"iframe")&&(B=t.contentWindow.document);var J=Array.from(B.querySelectorAll(x));if(J.length)for(var H=J.length-1;H>-1;H--){var G,k=J[H].nodeName.toLowerCase();switch(k){case"p":G=o;break;case"table":G=r;break;case"img":J[H].removeAttribute("class"),G=a;break;case"iframe":G=s;break;case"hr":G=l;break;case"li":G=c;break;case"span":G=d;break;case"ol":G=u;case"ul":G=u;break;case"td":G=p;break;default:G=n}D(J[H],G)}}var W=i?i.config:void 0;return JsonTreeBuilder.parseHTML([t,W],w),{mainSection:T,bodyFormat:m,sectionInfo:P,namedRangeInfo:C}},D=function(e,t){for(var i=t.length-1;i>-1;i--)e.removeAttribute(t[i])},L=function(e,i){return t.log("WriterContentBuilder parse HTML Called ::"+e.outerHTML),v(e,i)},N=function(){t.enable()},P=function(){t.disable()};return{parseHTML:L,enableLogger:N,disableLogger:P}}(),PasteEventHandler=function(){"use strict";var e=new ZWConsole,t=Macros.getPasteSectionConfig(),i=function(){var e=editor.doc.getSelection();!e.isCollapsed()&&e.deleteSelectedContents(),editor.lastOperation=COMMAND.ANY,Op.appendCursor(),Op.sendMsg()},n={isListItemSelection:function(){return editor.doc.getSelection().isListItemSelection},videoEmbed:function(){var e=!0;!w_usersettings||"2"!==w_usersettings.pasteOptions&&0!=w_usersettings[ATTR_BODY.DS_AUTOEMBED]&&0!=w_usersettings[ATTR_BODY.DS_AUTOEMBED]||(e=!1);var t=r.content.text;if(e&&t&&VideoEmbed.isSupportedUrl(t)&&!ZWCode.isCodePara()){var n,o=document.getElementById("insertHTML"),a=VideoEmbed.createPasteBody(t),s={};return s.isWriterDocument=!0,s.isSameDoc=!1,o.contentWindow.document.body.innerHTML=a.outerHTML,n=J(o.contentWindow.document.body).find("div")[0],i(),editor.lastOperation=COMMAND.PASTE,PasteUtil.insertCustomContent(n,null,s),!1}return!0},imagePaste:function(){var e=document.getElementById("pasteFrame"),t=e.contentWindow.document.getElementsByTagName("body")[0];return!r.content.imageItem||!PasteUtil.isImagePaste(t)||(i(),Y(r.content.imageItem),!1)},tablePaste:function(){var e=document.getElementById("pasteFrame"),t=e.contentWindow.document,i=t.body,n=r.selectedCells;return!n.length&&!PasteUtil.isTablePaste(i)||(Z(r.content),!1)},textOnlyPaste:function(){var e=r.content.text,t=r.content.html;return!(ZWCode.isCodePara()||e&&!t||Macros.isScreenplayPaste())||(i(),z(r.content,Macros.getCursorFmtForPaste()),!1)},normalPaste:function(){return i(),h(),!1}},o=!1,r={},a=[],s={},l={},d=function(){r={}},c=null,u=function(e){c=e},p=function(e){if(e==CONST.BUTTON_1_CLICKED){var t=PasteEventHandler.getPasteInfo(),i=t.content.html,n=t.content.text,o=encodeURIComponent(i),r=encodeURIComponent(n);ZWLogger.sendErrorDetails("PasteError<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"."+editor.doc.docInfo.RID+"<ZWERROR>\n Error Log Start \n buildLabel: "+buildLabel+"\n Error Log End \n <ZWERROR>#### PasteError: \n\n AditionalInfo: PasteError(pasteFrame) ="+o+"\n PasteError(textFrame) ="+r+"errorOrgin ="+JSON.stringify(a)+"::\n Selection ::"+t.selectionRanges+"\n #####",null,ZWCollaboration.PASTE_PARA_CHAR_STYLE_MISSING)}};PubSub.subscribe("GenerateOp/PasteError",function(e){a.push(e)});var g=function(e){var t=e.getData("text/html"),i=e.getData("text/plain"),n=null;if(e.files&&e.files.length){var o=e&&e.items&&e.items.length;if(o>0)for(var r,a=0;a<o;){if(r=e.items[a],r&&r.type.indexOf("image")!=-1){n=r.getAsFile();break}a++}}return{html:t,text:i,imageItem:n}},f=function(t){if(!editor.getRole().permissions.can("document.edit"))return!1;UIUtils.showLoadingMsg(J.i18n("mailmergepopup","PROCESSING"));var i,r,a,s=t.originalEvent,l={},d=s&&s.clipboardData?s.clipboardData:t.clipboardData;d&&(l=g(d),e.log("clipboard Data :: ",l),o||(r=l.html,a=l.imageItem),i=l.text);for(var c=Macros.getPrePasteCheckList(),u=!0,p=0,f=c.length;p<f;p++){var E=n[c[p]];1==E()&&(u=!1)}if(!u)return!0;var T=function(){var t=document.getElementById("_zohoPaste"),n=document.getElementById("pasteFrame"),s=PasteUtil.getHtmlSanitizer();PasteUtil.hidePasteDiv(),editor.clientActiveSection.focus(),!o&&editor.browserInfo.is_edge&&(n.contentWindow.document.body.innerHTML=t.innerHTML,r=t.innerHTML,l.html=r),l.text=i,UIUtils.hideLoadingMsg(),(i||r||a)&&(PubSub.publish("DocOperation/BeforePaste"),PasteUtil.setStylesInFrame(n),l.html=""!=l.html?s.sanitize(l.html):"",e.log("called exec cmd for paste"),editor.doc.execCmd(COMMAND.PASTE,l),o=!1)};return setTimeout(T,0),!!editor.browserInfo.is_edge||void DomUtil.stopEvent(t)},E=function(e){P(),C(e),Macros.savePasteOpnInfo(r),r.retain=r.retain?r.retain:editor.doc.getSelection().getStart(),r.selectionRanges=editor.doc.getSelection().toIntervals().join("|"),r.selectedCells=PasteUtil.getSelectedCells()},T=function(e){for(var t=e.contentWindow.document.getElementsByTagName("head")[0];t&&t.firstChild;)t.removeChild(t.firstChild)},m=function(e,t){return o=!!e&&e,PasteUtil.positionPasteDiv(),PasteUtil.focusPasteDiv(),"undefined"!=typeof t&&u(t),!1},h=function(){document.getElementById("pasteFrame");w()},I=function(e,t){var i=e.stack,n=null;try{n=DocTreeManager.getAllSectionsByType(SECTION_TYPES.CONTENT).length}catch(e){n="empty"}ZWLogger.sendErrorDetails("PasteError :: "+t+" <ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"."+editor.doc.docInfo.RID+"<ZWERROR>\n Error Log Start \n buildLabel: "+buildLabel+"\n Error Log End \n <ZWERROR>#### CopyError: \n\n ExceptionInfo: "+i+"\n Section Length::"+n+"\n #####",null,t)},_=function(t){Macros.beforePasteHandling(t),d(),a=[],S(t,function(){e.log("Content wrote in iframe"),E(t);for(var i=Macros.getPasteEventListeners(),o=0,r=i.length;o<r;o++){e.log("Calling :: ",i[o]);var a=n[i[o]];if(0==a()){e.log("executed succesfully :: ",i[o]);break}}})},A=function(e,t,i){e.contentWindow.document.open(),e.contentWindow.document.write(t),e.contentWindow.document.close(),i&&T(e),t&&PasteUtil.setStylesInFrame(e)},S=function(t,i){var n=t.html,o=t.text,r=t.imageItem,a=document.getElementById("pasteFrame"),s=document.getElementById("textFrame"),l=[],d=/[\n\s\r]/g;if(e.log("called iframe writing"),A(a,n,t),t.surroundLastTextNode&&n.length){var c=a.contentWindow.document.body,u=document.createElement("p"),p=c.innerHTML;c.innerHTML="",c.appendChild(u),u.innerHTML=p}if((!o.replace(d,"").length||!PasteUtil.hasTextNodes(a.contentWindow.document.body))&&r){var g=new FileReader,f=J.Deferred();l.push(f),g.onload=function(t){var i=document.createElement("img");i.setAttribute("src",t.target.result),e.log("image from clipboard written succesfully"),A(a,i.outerHTML),f.resolve()},g.readAsDataURL(t.imageItem)}s||(s=a.cloneNode(!0),J(s).attr({id:"textFrame",name:"textFrame"}).insertAfter(a)),o="undefined"==typeof o?"":o,o&&(t.surroundLastTextNode&&(o+="\n"),A(s,PasteUtil.getHTMLFromTextString(o),!0));var E=a.contentWindow.document,T=E.readyState,m=E.body,h=function(e,t){e.onreadystatechange=function(){"complete"===e.readyState&&t.resolve()}};if(!U.isEmpty(n)&&"complete"!==T){var I=J.Deferred();l.push(I.promise()),h(E,I)}R(m,l,h),J.when.apply(null,l).done(i)},R=function(e,t,i){var n=e.querySelectorAll("div.footnote-elements"),o=e.querySelectorAll("div.endnote-elements"),r=e.querySelectorAll("div.textbox-elements");if(n[0]||o[0]||r[0]){var a=n[0],s=o[0],l=r[0],d=a&&a.outerHTML,c=s&&s.outerHTML,u=l&&l.outerHTML;a&&a.parentNode.removeChild(a),s&&s.parentNode.removeChild(s),l&&l.parentNode.removeChild(l);for(var p=new DOMParser,g=p.parseFromString(d,"text/html"),f=p.parseFromString(u,"text/html"),E=p.parseFromString(c,"text/html"),T=[g,E,f],m=0,h=T.length;m<h;m++)for(var I=T[m],_=J(I).find("div[data-section-node]"),S=0,R=_.length;S<R;S++){var O=_[S];O.removeChild(O.firstChild);var b=document.getElementById("pasteFrame"),v=O.getAttribute("name"),D=J('iframe[id="'+v+'"]')[0];D||(D=b.cloneNode(),D.setAttribute("id",v),document.body.appendChild(D)),A(D,O.innerHTML);var L=D.contentWindow.document,N=L.readyState;if("complete"!==N){var P=J.Deferred();t.push(P.promise()),i(L,P)}}}},O=function(e){return l.hasOwnProperty(e)?l[e]:null},b=function(t){e.log("image uploaded status :: "+JSON.stringify(t)),l[t[0]]=t[1]},v=function(e){return U.invert(s)[e]},D=function(e){return s[e]},L=function(t){if(t&&(!e.debug||!s.hasOwnProperty(t))){var i,n=HTMLUtil.isBase64Img(t),o=HTMLUtil.isValidImageURL(t);if(e.log("isValidImageURL :: "+o+" :: isBase64 :: "+n),o||n)if(editor.isOffline()&&ZWOffline.isOfflineOperationsAllowed())i=n?OfflineImpl.storeImageInOfflineDB(t):t;else if(HTMLUtil.isWriterImage(t)){e.log("isWriterImage :: "+HTMLUtil.isWriterImage(t));var r=editor.uuid.replace(/[\/\\_\-%]/gi,""),a=r+Utils.randomString(),l=Macros.getImageURLValue(a);i=Macros.getImageSrc(l),PubSub.publish("externalImage/uploadStatus",[i,"uploading"]),ZWImageUtils.getImageBytes("/writer/"+t,null,null,function(e){HTMLUtil.uploadImageInFileStore(e,a)})}else e.log("image is uploading :: "),i=n?HTMLUtil.storeImageInFileStore(t):HTMLUtil.storeImageInFileStoreByURL(t);i&&(s[t]=i)}},N=function(e){for(var t=e.getElementsByTagName("img"),i=0,n=t.length;i<n;i++){var o=t[i],r=o.getAttribute("src");L(r)}},P=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.PARAGRAPH),i=null,n=t.attr(),o=e.getComputedTextFormat(),a=e.getParaFormat(),s=e.getTextFormat();t.dtNode.prev&&"para"==t.dtNode.prev.type&&(i=t.dtNode.prev.format),n.hasOwnProperty(ATTR_PARAGRAPH.PS_HD)||(n[ATTR_PARAGRAPH.PS_HD]=0);var l={computedTextFormat:U.isEmpty(o)?{type:NODE_TYPE.TEXT}:o,computedParaFormat:U.isEmpty(a)?{type:NODE_TYPE.PARAGRAPH}:a,textFormat:U.isEmpty(s)?{type:NODE_TYPE.TEXT}:s,paraFormat:U.isEmpty(n)?{type:NODE_TYPE.PARAGRAPH}:n,prevParaFormat:i};r.cursorFormats=l},C=function(e){r.content=e},y=function(){return r},F=function(){var e=r.pasteOpnInfo,t=CONST.PASTE_SOURCEFORMAT;return e.normalPaste||e.DiffDocNonListPaste?null!=c?(t=c,c=null):"undefined"!=typeof w_usersettings.pasteOptions&&(t=parseInt(w_usersettings.pasteOptions)):e.sameDocNonListPaste?t=CONST.PASTE_ASNEWLIST:(e.sameDocSameListPaste||e.sameDocDiffListPaste||e.DiffDocDifflistPaste)&&(t=CONST.PASTE_MERGELIST),t},M=function(e,t){r.hasOwnProperty("backUp")?void 0:r.backUp={},r.backUp[e]=t},w=function(){var e=F();W(e)},x=function(){return r.recentPasteOption},B=function(e){a=[],editor.doc.snapShotManager.clearRedo();var t=editor.doc.snapShotManager.getPrevious();Op.processMsg(t.ops),t&&(editor.lastOperation=COMMAND.RE_PASTE),Op.sendMsg(),W(e)},H=function(t){U.isEmpty(a)?(e.log("sent op for paste :: "+t.toString()),editor.doc.getTrackChangeDetails().setContentMovedToTarget(!0),Op.processMsg(t.toJson()),editor.doc.getTrackChangeDetails().setContentMovedToTarget(!1),editor.lastOperation=COMMAND.PASTE,Op.sendMsg(),PasteUtil.processDocOpForUnloadedImage(t)):(PubSub.publish("DocOperation/PasteError"),MsgDialog.showMessage(CONST.MSG_TYPE_REPORT,CONST.SEVERITY_ERROR,J.i18n("writer.error.UH_OH"),J.i18n("writer.paste.PASTE_ERROR"),null,p,null))},G=function(e){var i=e.getParents(NODE_TYPE.SECTION),n=i.secId,o=parseInt(n)<=5&&parseInt(n)>=0,r="footnote"==i.subType||"endnote"==i.subType,a="textbox"==i.subType,s="main";return o?s="header":r?s="noteSection":a&&(s="textbox"),t[s]},k=function(e,i){var n=e.contentWindow.document.body,o={};try{o.isWriterDocument=PasteUtil.isWriterDocumentContent(n),o.isSameDoc=o.isWriterDocument&&PasteUtil.isSameDocumentPaste(n),o.selection=editor.doc.getSelection(),o.config=G(o.selection),o.imgProcess={upload:N,getImgSrc:D};var r=WriterContentBuilder.parseHTML(n,o),a={};if(r.sectionInfo)for(var s in r.sectionInfo){var l=J('iframe[id="'+s+'"]'),d=l[0].contentWindow.document.body,o={},c=r.sectionInfo[s].type;o.isWriterDocument=!0,o.config="textbox"==c?t[c]:t.noteSection,o.isSameDoc=PasteUtil.isSameDocumentPaste(n),o.imgProcess={upload:N,getImgSrc:D},a[s]=WriterContentBuilder.parseHTML(d,o)}var u=r.bodyFormat,g=[];for(var f in a){var E=a[f];u=u.concat(E.bodyFormat);var T=PasteUtil.getSectionCharOp(r.sectionInfo[f]);g=g.concat(T.concat(E.mainSection))}return delete r.sectionInfo,r.sectionOp=g,r.bodyFormat=u,PasteUtil.getComposedDocOp(r,i)}catch(e){I(e,ZWCollaboration.PASTE_PROCESSING_ERROR),PubSub.publish("DocOperation/PasteError"),MsgDialog.showMessage(CONST.MSG_TYPE_REPORT,CONST.SEVERITY_ERROR,J.i18n("writer.error.UH_OH"),J.i18n("writer.paste.PASTE_ERROR"),null,p,null)}},W=function(e){var t,i=!1,n=J.Deferred();if(r.recentPasteOption=e,r.backUp&&r.backUp[e])t=r.backUp[e];else{var o,a,s={1:CONST.PASTE_SOURCEFORMAT,3:CONST.PASTE_ASNEWLIST,5:CONST.PASTE_DONT_MERGELIST},l=e==CONST.PASTE_TEXTONLYFORMAT?document.getElementById("textFrame"):document.getElementById("pasteFrame"),d="undefined"==typeof r.retain?editor.doc.getSelection().getStart():r.retain;switch(parseInt(e)){case CONST.PASTE_CONTINUELIST:case CONST.PASTE_MERGELIST:case CONST.PASTE_DESTINATIONFORMAT:a=s[e],r.backUp&&r.backUp[a]?o=r.backUp[a]:(o=PasteEventHandler.getDocOp(l,d),M(a,o)),t=PasteUtil.getProcessedDocOpForPasteOption(o,e,r.cursorFormats),M(e,t);break;case CONST.PASTE_ASNEWLIST:case CONST.PASTE_DONT_MERGELIST:case CONST.PASTE_SOURCEFORMAT:t=PasteEventHandler.getDocOp(l,d),M(e,t);break;case CONST.PASTE_TEXTONLYFORMAT:t=PasteEventHandler.getDocOp(l,d);var c=r.cursorFormats;Macros.getCursorFmtForPaste()&&Object.keys(Macros.getCursorFmtForPaste())&&(c=Macros.getCursorFmtForPaste()),t=PasteUtil.getProcessedDocOpForPasteOption(t,e,c),M(e,t);break;case CONST.PASTE_CHART:i=!0,t=r.backUp[CONST.PASTE_SOURCEFORMAT],PasteUtil.convertImageToChart(t,n);break;case CONST.PASTE_SHEET_TABLE:i=!0,t=r.backUp[CONST.PASTE_SOURCEFORMAT],PasteUtil.convertTabletoSheetTable(t,n);break;case CONST.PASTE_SCREENPLAY_PASTE:t=Macros.getScreenplayPasteOp(r,d),M(e,t)}}i?n.done(function(e){H(e)}):H(t)},Y=function(t){var i=new FileReader;i.onload=function(t){var i=t.target.result,n=document.createElement("img"),o=document.getElementById("pasteFrame"),r=o.contentWindow.document.getElementsByTagName("body")[0];e.info(" pasted image src:: "+i),n.src=i,r.innerHTML=n.outerHTML,N(o);var a=PasteEventHandler.getDocOp(o,editor.doc.getSelection().getStart());H(a)},i.readAsDataURL(t)},z=function(e,t){var i=document.getElementById("textFrame"),n=k(i,r.retain?r.retain:editor.doc.getSelection().getStart());t="undefined"!=typeof t?t:r.cursorFormats,n=PasteUtil.getProcessedDocOpForPasteOption(n,CONST.PASTE_TEXTONLYFORMAT,t),H(n)},Z=function(e){var t=e.html?document.getElementById("pasteFrame"):document.getElementById("textFrame"),i=t.contentWindow.document.body,n=PasteUtil.isWriterDocumentContent(i),o=n?J(i).find("[data-doc-id]").attr("data-doc-id"):null;try{for(var s=editor.doc.getSelection(),l=s.getParents(NODE_TYPE.TABLE),d=r.selectedCells,c=l.children(),u=(c.count,s.getParents(NODE_TYPE.CELL)),g={},f=0,E=0,T=J(i).children("table")[0],m=0;m<c.length;m++)for(var h=c[m],I=h.children(),_=0;_<I.length;_++){var A=I[_];g[A.getStart()]=[m,_]}var S=g[u.getStart()],R={};if(T){var O=Utils.getChildNodes(T,"tr");if(d.length)for(var b=S[0],v=S[1],D=[],L=0,N=null,P=0;P<d.length;P++){var C=d[P];if(C.dtNode.isVisible&&D.indexOf(C.dtNode.id)==-1){var y=TableUtil.findRowIdx(C.parentNode())-1,F=TableUtil.findColIdx(C)-1,M=(y-b)%O.length,w=Utils.getChildNodes(O[M],"th,td"),U=(F-v)%w.length;G=L!=y?w[U]:N&&N.nextElementSibling?N.nextElementSibling:w[0],D.push(C.dtNode.id),G&&(PasteUtil.processCellContent(G),R[y+"|"+F]=G.innerHTML),L=y,N=G}}else for(var h,m=S[0];h=c[m++];){var x=O[f];if(!x)break;f++;for(var B,I=h.children(),_=S[1];B=I[_++];){for(;B&&B.attr("merge")&&"fc"!=B.attr("merge");)B=I[_++];if(B){var G=Utils.getChildNodes(x,"th,td")[E];E++;var W=m-1+"|"+(_-1);G&&(HTMLPreProcessor.processTD(G,!0),R[W]=G.innerHTML)}}E=0}}else for(var P=0;P<d.length;P++){var C=d[P],Y=TableUtil.findRowIdx(C.parentNode())-1+"|"+(TableUtil.findColIdx(C)-1);PasteUtil.processCellContent(i),R[Y]=i.innerHTML}var z=[],Z=[],t=document.getElementById("pasteFrame"),V=t.contentWindow.document.getElementsByTagName("body")[0];for(var j in R){var X=j.substring(0,j.indexOf("|")),K=j.substring(j.indexOf("|")+"|".length),q=c[X],I=q.children(),Q=I[K];z.push([Q.getStart()+1,Q.getEnd()]),V.innerHTML=R[j],n&&J(V.firstChild).attr("data-doc-id",o);var $=k(t,Q.getStart()+1);$&&Z.push($)}for(var ee=[],P=z.length-1;P>-1;P--){var te=[{r:z[P][0]},{ds:editor.doc.getContent(z[P][0],z[P][1])}];ee.push(DocOpBuilder.build(te))}for(var ie=Z.concat(ee),ne=ie[0],P=0;P<ie.length;P++){var oe=ie[P+1];if(oe){var re=DocOpBuilder.xform(ne,oe);ne=DocOpBuilder.compose(ne,re.second)}}ne.applyOp(DocOpBuilder.build(Op.getCursor(z[0][0],z[0][0]))),Op.cursorProcessed(),H(ne)}catch(e){throw a.push("Table Paste Error"),MsgDialog.showMessage(CONST.MSG_TYPE_REPORT,CONST.SEVERITY_ERROR,J.i18n("writer.error.UH_OH"),J.i18n("writer.paste.PASTE_ERROR"),null,p,null),e}},V=function(t){e.enable(t)},j=function(){e.disable()},X=function(){PubSub.unsubscribeAll("externalImage/uploadStatus"),PubSub.unsubscribeAll("GenerateOp/PasteError")};return PubSub.subscribe("externalImage/uploadStatus",b),{doPaste:_,rePaste:B,setContentInIframe:A,processPaste:h,handlePasteEvent:f,setPasteOpn:u,prePasteProcess:m,getPasteInfo:y,getDocOp:k,getRecentPasteOption:x,getExtImgURLInfo:D,getSourceURLInfo:v,uploadExtImg:N,getImgUploadStatus:O,setContentInIframe:A,enableLogger:V,disableLogger:j,unSubscribe:X,sendErrorMail:I}}();CopyEventHandler=function(){"use strict";var e=new RegExp("^("+NODE_TYPE.BR+"|"+NODE_TYPE.TAB+"|"+NODE_TYPE.TEXT+"|"+NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR+"|"+NODE_TYPE.RUN+"|"+NODE_TYPE.FIELD_START+"|"+NODE_TYPE.FIELD_END+"|"+NODE_TYPE.IMAGE+")$"),t={},i=new RegExp(String.fromCharCode(160),"g"),n=new ZWConsole,o=!1,r=function(e){PubSub.publish("DocOperation/AfterGettingSelectedHTML",t,e),PasteUtil.positionPasteDiv(t.html),PasteUtil.focusPasteDiv(),n.log("content prepared in precopy")},a=function(){var e=editor.doc.getSelection();return!(e.isCollapsed()||e.isListItemSelection||!editor.getRole().permissions.can("document.content.copy"))},s=function(e){if(!o&&!a())return DomUtil.stopEvent(e),!1;if(U.isEmpty(t)&&g("copy"),t&&!editor.browserInfo.is_edge&&!EventHandler.isDialogOpened){n.log("content given to clipboard event");var i=document.getElementById("_zohoPaste");e.clipboardData.setData("text/html",i.innerHTML),e.clipboardData.setData("text/plain",t.text),e.preventDefault()}return t={},!0},l=function(e){s(e),editor.doc.execCmd("cut")},d=function(){var e=editor.doc.getSelection().sortRanges(),t="",i="";U.each(e,function(e){var n=E(e),o=n.noteObjs;t+=n.html,i+=n.text;for(var r in o){var a=o[r],s=document.createElement("div");if(s.innerHTML=t,a.length){var l=document.createElement("div");l.appendChild(document.createElement("hr")),l.setAttribute("class",r+"-elements");for(var d=0,c=a.length;d<c;d++){var u=a[d],p=J(s).find("[data-"+r+"-id="+u+"]")[0],g=document.createElement("a"),f=p.parentNode;g.setAttribute("href","#"+u),f.insertBefore(g,p),g.appendChild(p),p.innerText="["+(d+1)+"]";var T=DocTreeManager.getSectionWithSid(u),m="textbox"!=r?new ZWRange(T.start+2,T.end):new ZWRange(T.start+1,T.end),h=E(m),I=document.createElement("div"),_=g.cloneNode(!0);_.removeAttribute("href"),_.setAttribute("name",u),I.innerHTML=_.outerHTML+h.html,I.setAttribute("name",u),I.setAttribute("data-section-node","true"),l.appendChild(I)}s.appendChild(l)}t=s.innerHTML}});var n=document.createElement("div");n.innerHTML=t,n.firstChild&&(n.firstChild.setAttribute("data-doc-id",editor.doc.docInfo.DOCUMENT_ID),n.firstChild.setAttribute("data-doc-type",Macros.getDocumentType()));var o=NamedRange.getComposedRangesInSelection();if(o&&o.docOps.length){var r=o.docOps[0];r.retain_count=r.retain_count-e[0].start,n.firstChild.setAttribute("data-named-range-info",o.toString())}return Macros.handleTagInfo(n),t=n.innerHTML,e.length>1&&ZWLogger.addToStatistics("copy_ON_MUL_SEL"),{html:t,text:i}},c=function(e){U.isEmpty(e)?EditorUtil.focusMultiByteSpan():(t=e,o=!0,r("copy")),document.execCommand("copy",!1,null),o=!1},u=function(){EditorUtil.focusMultiByteSpan(),f("cut"),document.execCommand("copy",!1,null),editor.doc.execCmd("cut")},p=function(){for(var e,t=editor.doc.getSelection(),i=0,n=t.length;i<n;i++)e=t.getRangeAt(i),t.deleteSelectedContents(e,i<n-1);editor.lastOperation="delete"},g=function(e,i){n.log("pre Copy called"),t={};var o=editor.doc.getSelection(),a=[];PubSub.subscribe("ImageCache/CacheNotAvaialable",function(e){e&&HTMLUtil.isWriterImage(e)&&a.push(e)}),t=U.isEmpty(i)?o.isCollapsed()?null:d():i,PubSub.unsubscribe("ImageCache/CacheNotAvaialable"),a.length&&Notification.show({message:"writer.paste.IMG_NOT_COPIED",close:!0,setTimer:!0,type:"info"}),n.log("pre Copy :: ",t),t&&r(e)},f=g,E=function(t){try{var n,o,r,a,s=document.createDocumentFragment(),l=[],d={},c=[],u=[],p=[],g="",f=null,E=null,m=function(e,t){var i;return i="para"==t||"hr"==t?editor.doc.getRawFormatAt(e.getEndIndex()):editor.doc.getComputedFormatAt(e.getIndex(),NODE_TYPE.TEXT),!TcUtil.canCopy(i)},h=function(e){var t=editor.doc.getSelection(),i=t.getStart(),n=t.getEnd();if(e.type===NODE_TYPE.FIELD_START&&e.format&&e.format.type===NODE_TYPE.CONDITIONAL_IF_START){var o,r=e.getIndex();return o=DocUtil.getRangeEnd(r),i<=r&&n>=o}if(e.type===NODE_TYPE.FIELD_END&&e.format&&e.format.type===NODE_TYPE.CONDITIONAL_IF_END){var r,o=e.getIndex();return r=DocUtil.getRangeStart(o),i<=r&&n>=o}if(e.type===NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR){var r=DocUtil.getRangeStart(e.getIndex()),o=DocUtil.getRangeEnd(e.getIndex());return i<=r&&n>=o}return!0},I=function(e){e.type==NODE_TYPE.MAILMERGEFIELD?d[e.type]=e:e.type==NODE_TYPE.AUTOFIELD?d[e.id]=e:e.type==NODE_TYPE.FILLABLEFIELD?d[e.id]=e:e.type==NODE_TYPE.SIGNERFIELD&&(d[e.id]=e)},_=function(t){var i,s=t.type;if(!m(t,s)&&h(t)){var T,_=t.format;switch(s){case NODE_TYPE.PARA:i=HTMLBuilder.getParagraph(t),n=t.paraProperties.listData;break;case NODE_TYPE.TABLE:i=HTMLBuilder.getTable(t);break;case NODE_TYPE.ROW:i=HTMLBuilder.getRow(t);break;case NODE_TYPE.CELL:i=HTMLBuilder.getCell(t);break;case NODE_TYPE.HR:i=HTMLBuilder.getHR(t);break;case NODE_TYPE.FIELD_START:I(_);case NODE_TYPE.FIELD_END:case NODE_TYPE.IMAGE:case NODE_TYPE.TEXT:case NODE_TYPE.BR:case NODE_TYPE.TAB:case NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR:case NODE_TYPE.RUN:if(_&&_.type==NODE_TYPE.FOOTNOTE&&c.indexOf(_.id)==-1&&c.push(_.id),_&&_.type==NODE_TYPE.ENDNOTE&&u.indexOf(_.id)==-1&&u.push(_.id),_&&s==NODE_TYPE.TEXT&&(T=!_.cls||_.cls.indexOf("mergeField")==-1&&_.cls.indexOf("nextrecord")==-1?HTMLUtil.getAutoFieldClass(_.cls)||_.cls==NODE_TYPE.FILLABLEFIELD||_.cls==NODE_TYPE.SIGNERFIELD?d[_.fieldinfo]:void 0:d.mergeField),_&&s==NODE_TYPE.IMAGE&&(_.hasOwnProperty(ATTR_COMMON.SUBTYPE)&&"textbox"==_[ATTR_COMMON.SUBTYPE]&&p.indexOf(_.id)==-1&&p.push(_.id),_.cls==NODE_TYPE.FILLABLEFIELD&&(T=_)),i=HTMLBuilder.getPortionNode(t,T),s==NODE_TYPE.FIELD_START&&_.type==NODE_TYPE.LINK?(f=i,E=t.parent):s==NODE_TYPE.FIELD_END&&_.type==NODE_TYPE.LINK&&(f=null),s==NODE_TYPE.RUN||s==NODE_TYPE.BR||s==NODE_TYPE.TAB||s==NODE_TYPE.TEXT){var S=t.parent,R=S.getIndex();R+t.start,R+t.end;g+=_&&_.type==NODE_TYPE.BR?"\n":i.innerText}}if(!i)return void(t.format&&t.format.type&&t.format.type==NODE_TYPE.LINK&&l.pop());var O=A();DomUtil.nodeNameEquals(O,"h1|h2|h3|h4|h5|h6")&&(i.style.fontWeight?void 0:i.style.fontWeight="normal");var b="para"==s&&t.getParaStyles();if("para"!=s||!ListUtils.isList(b)||ListUtils.isHeadingList(t)||t.isCode())if("para"==s&&t.isCode()){var v,D,L=t.getEndIndex(),N=a,P="pre",C=r,y=editor.doc.getRawFormatAt(L);if(N&&N[ATTR_PARAGRAPH.PS_CODE]&&ZWJSONUtils.compareJSON(N[ATTR_PARAGRAPH.PS_CODE],y[ATTR_PARAGRAPH.PS_CODE]))J(i).insertAfter(C);else{v=document.createElement(P),DomUtil.setParaStyle(v,y,null,!0),v.hasAttribute("data-codeformat")&&J(v).removeAttr("data-codeformat");try{var F=editor.doc.getListObj(y[ATTR_PARAGRAPH.LS_DATA].id);v.setAttribute("data-list-format",JSON.stringify(F)),v.setAttribute("data-list-id",y[ATTR_PARAGRAPH.LS_DATA].id)}catch(e){}D=y[ATTR_PARAGRAPH.PS_CODE].t_fgc&&{color:y[ATTR_PARAGRAPH.PS_CODE].t_fgc},D&&J(v).css(D),v.appendChild(i),O.appendChild(v)}i.style["border-width"]="0px"}else O.appendChild(i);else{var M=ListUtils.isBasicList(t),w=editor.doc.getListType(n.id,n.listLevel),U=!(w>5&&w<9),x=n.listLevel,B="level"+x,H=t.paraProperties.listData.levelInfo[B],G=document.createElement("li");if(M?G.appendChild(i):G=i,o&&"para"==o.type&&o.paraProperties.listData&&o.paraProperties.listData.id==n.id){if(o.paraProperties.listData&&o.paraProperties.listData.id==n.id){var k=o.paraProperties.listData,W=k.listLevel,Y=PasteUtil.getLsNode(r);if(x==W)J(G).insertAfter(Y);else if(x<W){var z=J(Y).parents()[W-x];z.appendChild(G)}else if(x>W){var Z=HTMLBuilder.createListElement(U,n.id,W,x),V=x-W,z=Z;V>1&&(z=J(Z).find(U?"ol":"ul")[V-2]),1!=H&&z.setAttribute("start",t.paraProperties.listData.levelInfo[B]),z.appendChild(G),J(Z).insertAfter(Y)}}}else{var Z=HTMLBuilder.createListElement(U,n.id,null,x),z=Z;0!=x&&(z=J(Z).find(U?"ol":"ul")[x-1]),1!=H&&z.setAttribute("start",t.paraProperties.listData.levelInfo[B]),z.appendChild(G),O.appendChild(Z)}}if(!e.test(s)||t.format&&t.format.id&&"string"==typeof t.format.id&&t.format.id.indexOf("toc_")!=-1||!DomUtil.nodeNameEquals(O,"li|p|h1|h2|h3|h4|h5|h6")||J(O).find("span.EOP").remove(),e.test(s)?DomUtil.nodeNameEquals(i,"a")&&l.push(i):(l.push(i),o=t,a=y),s==NODE_TYPE.PARA&&f&&E!=t){var j=f.cloneNode();i.appendChild(j),l.push(j)}}},A=function(){var e=s,t=l.length;return t&&(e=l[t-1]),e},S=function(t){var i=t.type;!m(t,i)&&h(t)&&(g+=i==NODE_TYPE.PARA?"\n":"",e.test(i)||(f&&i==NODE_TYPE.PARA&&l.pop(),r=l.pop(),o=t),"table"==i&&HTMLBuilder.processTableElemsForCopy(r))},R={nodeStartHandler:_,nodeEndHandler:S};t.visitAllNodesInRange(R);var O=document.createElement("div"),b={footnote:c,endnote:u,textbox:p};O.appendChild(s),J(O.firstChild).attr("data-doc-id",editor.doc.docInfo.DOCUMENT_ID),g=g.replace(i," ");var v=editor.doc.getSelection();return""==O.innerHTML&&v.length>1?T({stack:"Multi-Selection issue"}):"undefined"==typeof O.innerHTML&&T({stack:"Div is undefined"}),{html:O.innerHTML,text:g,noteObjs:b}}catch(e){T(e)}},T=function(e){var t=e.stack;ZWLogger.sendErrorDetails("CopyError<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"."+editor.doc.docInfo.RID+"<ZWERROR>\n Error Log Start \n buildLabel: "+buildLabel+"\n Error Log End \n <ZWERROR>#### CopyError: \n\n ExceptionInfo: "+t+" #####",null,ZWCollaboration.COPY_DATA_MISSING)},m=function(e){n.enable(e)},h=function(){n.disable()};return{triggerCopyEvent:c,triggerCutEvent:u,onCopy:s,onCut:l,handleCutEvent:p,preCopyProcess:g,preCutProcess:f,getCopiedInfo:E,getCopedInfoFromSelection:d,enableLogger:m,disableLogger:h}}();var Note=function(){var e=function(e){if(e){var t=DocTreeManager.getSectionWithSid(e);if(t){var n=t.start+1;i(n)}}},t=function(e){if(e){var t=DocTreeManager.getSectionWithSid(e);if(t){var n=t.getRangeIndex()-1;i(n)}}},i=function(e){var t=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),i=editor.doc.getSelection(),n=editor.doc.createRange(e);i.removeAllRanges().addRange(n),DomUtil.scrollElementIntoView(t[0],500,!0),CurUtil.scrollTop=editor.editorPaneContainer[0].scrollTop,editor.editorOffset=editor.jeditorPane.offset(),CurUtil.blinkCursor();var o=DocTreeManager.doc.getSection(i.getStart());EventHandler.setClientActiveSection(o),EventHandler.toggleSection()},n=function(e,t,i){var n=e.getNoteTypeInfo(t)||{};if(i=i||{},0==Object.keys(n).length||0!=Object.keys(i).length&&(n.fmt!=i.format||n.stnum!=i.startNumber||n.pgrst!=i.pgrst)){var o=i.format||n.fmt||"num",r=i.startNumber||n.stnum||1,a="chicago"==o?PREDEFINED_NOTE_REFERENCE_SYMBOLS:[],s=i.pgrst||n.pgrst||NOTE_RESTART_NUM.CONTINUOUS;noteInfo={fmt:o,refchars:a,stnum:r,pgrst:s};var l=editor.doc.getSection(e.getSectionType(),e.getId()),d={};d[t]=noteInfo,l.attr(d)}},o=function(e,t,i){var o=editor.doc.getSelection(),r=DocTreeManager.doc.getSection(o.getStart());n(r,e,i),t=t||{};var a=o.getEnd();if(o.length>1&&ZWLogger.addToStatistics(e+"_ON_MUL_SEL"),!o.isCollapsed()&&editor.doc.getCharAt(a-1)==UNICODE.PARA){var s=o.getLastRange();s&&s.setEnd(a-1)}o.collapse(!1);var l=editor.doc.createElement(e);l.setContent(t.content||"");var d=null;t.referenceChar&&(d={refchar:t.referenceChar}),l.insert(d)},r=function(e,t,i){for(var o=0,r=e.length;o<r;o++){var a=DocTreeManager.doc.getSection(e[o].getStart());n(a,i),e[o].modify(i)}},a=function(e,t){var i=editor.doc.getSelection(),o=DocTreeManager.doc.getSection(i.getStart()),r=o.getContainingSection();n(r,e,t)},s=function(e,t){for(var i=[],n=DocTreeManager.getSectionsByType(e),o=n.first;o;)i.push(editor.doc.getFloatElement(e,o.sid)),o=o.next;r(i,e,t)},l=function(e,t){var i=editor.doc.getSelection(),n=DocTreeManager.getTreeNodeAtIndex(i.getStart()),o=editor.doc.getFloatElement(n.section.getSectionType(),n.section.sid);o&&r([o],e,t)},d=function(e){var t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.SECTION);i.attr({refchar:e.referenceChar})},c=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.SECTION);t.attr({refchar:null})},u=function(e){for(var t=DocTreeManager.getSectionsByType(e),i=t.first;i;){var n=editor.doc.getFloatElement(e,i.sid);n.remove(),i=i.next}},p=function(){var e=editor.doc.getSelection(),t=DocTreeManager.getTreeNodeAtIndex(e.getStart()),i=editor.doc.getFloatElement(t.section.getSectionType(),t.section.sid);i.remove()},g=function(e){var t=DocTreeViewManager.getFirstNoteView(e),i=DocTreeViewManager.getLastNoteView(e),n=t.getIndex()+1,o=i.getEndIndex(),r=editor.doc.createRange(n,o),a=editor.doc.getSelection();a.removeAllRanges().addRange(r)};return{moveToSection:e,moveToNoteRange:t,insertNote:o,changeNoteStyle:a,insertSymbol:d,removeSymbol:c,convertNote:l,convertAllNotes:s,removeAllNotes:u,removeNote:p,selectAllNotes:g}}();Command=function(){var e={},t=function(t,i){t in e||(e[t]=[]),e[t].push(i)},i=function(t){for(var i=Array.prototype.slice.call(arguments,1),n=0;n<e[t].length;n++)e[t][n].apply(editor.doc,i)},n=function(t){delete e[t]};return{on:t,exec:i,off:n}}(),function(e){e.on("InsertChar",function(e){if(!editor.doc.getSelection().canEditLockRange()){var t=e.cmd,i=e.element;if(editor.lastOperation="InsertChar",editor.currentCommand=COMMAND.ANY,"insert"==t){var n=editor.doc.getSelection();i.type==NODE_TYPE.TEXT&&n.isEOPOnlySelected()&&(n.collapse(!0),n.isListItemSelection&&(n.isListItemSelection=!1)),i.type==NODE_TYPE.TEXT&&n.isCollapsed()?editor.currentCommand=COMMAND.TYPING:editor.doc.snapShotManager.flushTypedCharOps();var o=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,n.getStart());if(o){var r=o.getRangeIndex(),a=editor.doc.getRawFormatAt(r);if(!TextBoxHandler.isCursorAllowed(a.id))return}var s;if("undefined"!=typeof TransformHandler){s=TransformHandler.getCurrentObjectInfo().type;var a=editor.doc.getRawFormatAt(n.getStart());if(a&&"textbox"==a.subType&&"textbox"==s){var l=a.id,d=DocTreeManager.getSectionWithSid(l),c=d.getEndIndex(),u=editor.doc.createRange(c,c);if(!TextBoxHandler.isCursorAllowed(l))return;editor.doc.getSelection().removeAllRanges().addRange(u),TextBoxHandler.handleCursorInsideTextBox(l)}}editor.doc.updateLastAction("InsertChar",i.nodeValue),editor.doc.getSelection().insert(i,i.css);i.getEnd();Op.appendCursor()}else if("insbr"==t){editor.doc.updateLastAction(t),editor.doc.snapShotManager.flushTypedCharOps();var p=editor.doc.createElement(NODE_TYPE.BR,UNICODE.BR);p.setStart(editor.doc.getSelection().getStart()),editor.doc.getSelection().insert(p),Op.appendCursor()}else editor.doc.execCmd(t,i);Op.sendMsg(),editor.currentCommand=COMMAND.ANY,!isV8Engine&&editor.doc.getSelection().isCollapsed()&&DomUtil.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0]),"insert"==t&&PubSub.publish("Document/CharInserted",i.nodeValue)}}),e.on("SmallCaps",function(e){if(!editor.doc.getSelection().isCollapsed()||(editor.doc.getSelection().getWord().select(),!editor.doc.getSelection().isCollapsed())){for(var t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.TEXT),i=0;i<t.length;i++){var n=t[i],o=n.getStart(),r=n.nodeValue.toLowerCase(),a=editor.doc.createElement(NODE_TYPE.TEXT,r);a.setStart(o),a.setEnd(n.getEnd());var s={};if(s[ATTR_TEXT.TS_FV]="small-caps",n.attr(s),o>0&&editor.doc.getCharAt(o-1)==UNICODE.RANGE_START){o--;var l=editor.doc.getRawFormatAt(o);if("mergeField"==l.type){var d={};d.type=l.type,d.format=DocUtil.copyStyle(l.format)||{},d.format[ATTR_TEXT.TS_FV]="small-caps";var c=Utils.randomString(),u=ZWJSONUtils.getKeys(d),p=[{r:o},{as:{start:d,id:c}},{r:1},{as:{end:u,id:c}}];Op.processMsg(p)}}}Op.sendMsg()}}),e.on("increaseFontSize",function(){var e=editor.doc.getSelection();if(e.isCollapsed()&&(e.getWord().select(),e=editor.doc.getSelection(),e.isCollapsed())){var t=e.getComputedTextFormat()[ATTR_TEXT.TS_SIZE],i=DocUtil.getNextFontSize(t);e.updateCursorFormat("FontSize",i);var n=e.getParents(NODE_TYPE.PARAGRAPH);if(n.getEnd()-n.getStart()==1){var o={};return o[ATTR_PARAGRAPH.PS_TS]=e.getTextFormat(),void n.attr(o)}}DocUtil.increaseOrDecreaseFontSize(e,1)}),e.on("decreaseFontSize",function(){var e=editor.doc.getSelection();if(e.isCollapsed()&&(e.getWord().select(),e=editor.doc.getSelection(),e.isCollapsed())){var t=e.getComputedTextFormat()[ATTR_TEXT.TS_SIZE],i=DocUtil.getPrevFontSize(t);e.updateCursorFormat("FontSize",i);var n=e.getParents(NODE_TYPE.PARAGRAPH);if(n.getEnd()-n.getStart()==1){var o={};return o[ATTR_PARAGRAPH.PS_TS]=e.getTextFormat(),void n.attr(o)}}DocUtil.increaseOrDecreaseFontSize(e,-1)}),e.on("CreateLink",function(e){var t,i,n,o,r,a,s,l,d=editor.doc,c=d.getSelection();c.length>1&&ZWLogger.addToStatistics("CreateLink_ON_MUL_SEL");for(var u=0,p=c.length;u<p;u++){if(a=c.getRangeAt(u),s=a.start,l=a.end,i=c.getTargetRange(),!c.isCollapsed()){var g=d.getCharAt(l-1);g==UNICODE.PARA?l-=1:" "==g&&(l-=1,a.setEnd(l))}t={type:NODE_TYPE.LINK},t[ATTR_LINK.LINK_TYPE]=e.type,t[ATTR_LINK.LINK_URL]=e.url,t[ATTR_LINK.LINK_TARGET]=e.target,t[ATTR_LINK.LINK_TOOLTIP]=e.tip,t[MAILMERGE.MMINFO]=e.mminfo,t[ATTR_LINK.LINK_TARGET]=e.target,e.text&&(c.deleteSelectedContents(),t.text=e.text),n=UNICODE.RANGE_START.length+(e.text?s+e.text.length:l)+UNICODE.RANGE_END.length,s==i.start&&l==i.end&&(r=n),o=d.createElement(NODE_TYPE.LINK,e),o.setStart(s),o.setEnd(l),o.insert(t,u)}}),e.on("ModifyLink",function(e){var t=e.linkObj;if(t){var i=editor.doc.createElement(NODE_TYPE.TEXT);i.setStart(t.getStart()+1),i.setEnd(t.getEnd()-1);var n={};if(n[ATTR_LINK.LINK_TYPE]=e.type,n[ATTR_LINK.LINK_URL]=e.url,n[ATTR_LINK.LINK_TARGET]=e.target,n[ATTR_LINK.LINK_TOOLTIP]=e.tip,n[MAILMERGE.MMINFO]=e.mminfo,n[ATTR_LINK.LINK_TARGET]=e.target,e.text){var o=editor.doc.createElement(NODE_TYPE.TEXT,e.text);o.attr(n),editor.doc.getSelection().replace(i,o)}else i.attr(n);n[ATTR_COMMON.ID]=e.id,n[ATTR_COMMON.TYPE]=NODE_TYPE.LINK,t.attr(n)}}),e.on("Unlink",function(){var e=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.LINK);if(e.length){var t,i,n=e.length;for(t=0;t<n;t++)i=e[t],i.remove()}}),e.on("bookmark",function(e){var t;e.insert();var i=editor.doc.getSelection();if(i.length>1){ZWLogger.addToStatistics("bookmark_ON_MUL_SEL");var n=editor.doc.getSelection().getTargetRange();t=n?n.end+2:editor.doc.getSelection().getEnd()+2}else t=editor.doc.getSelection().getEnd()+2;Op.appendCursor()}),e.on("updateTheme",function(e){DesignTab.setBodyTheme(e)}),e.on("updateChartColorJSON",function(e){DesignTab.setChartColorJson(e)}),e.on("updateStyles",function(e){DesignTab.setBodyStyles(e)}),e.on("updateHeadingStyle",function(e){var t;"object"==typeof e&&(t=e[1],e=e[0]),"103"==e?QuickStyle.updateQuoteStyle(e,t):QuickStyle.updateHeadingStyle(e)}),e.on("convertHeadingStyle",function(e){var t=e[0],i=e[1];QuickStyle.convertAppliedStylesToDefault(t,i),editor.lastOperation="convertHeadingStyle"}),e.on("renameHeadingStyle",function(e){var t=e.name,i=e.headingId,n=DocumentDesign.getStyles();n.para[i].info.cs_name=t,editor.doc.getSelection().getParents(NODE_TYPE.BODY).attr({styles:n}),editor.lastOperation="renameHeadingStyle"}),e.on("setNextParaStyle",function(e){var t=DocumentDesign.getStyles();for(var i in e)t.para[i].info.next=e[i];editor.doc.getSelection().getParents(NODE_TYPE.BODY).attr({styles:t}),editor.lastOperation="setNextParaStyle"}),e.on("deleteDocHeadingStyle",function(e){var t=DocumentDesign.getStyleUIInfo(),i=DocumentDesign.getStyles(),n=i.para;for(var o in n)n[o].info.next==e&&(n[o].info.next="h0");t.para[e].deleted=!0,editor.doc.getSelection().getParents(NODE_TYPE.BODY).attr({styleUIInfo:t,styles:i}),editor.lastOperation="deleteDocHeadingStyle"}),e.on("FormatBlock",function(e,t){var i=t||editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH)||[],n=i.length?i[0].attr()[ATTR_PARAGRAPH.PS_HD]:void 0;DocUtil.applyHeadingForSelection(e,t),"undefined"!=typeof n&&"undefined"!=typeof e||PubSub.publish("HeadingStyle/Changed",n,e)}),e.on("restartListing",function(){ListUtils.restartAsNewList()}),e.on("continueListing",function(){ListUtils.continueWithPreviousList()}),e.on("removeListing",function(){ListUtils.removeList()}),e.on("outdent",function(e){Indentation.init("outdent",e)}),e.on("indent",function(e){Indentation.init("indent",e)}),e.on("sortTextListDescendingly",function(){ListSort.sortList.call(null,ListUtils.getListId(),!1,SORT_TYPES.TEXT)}),e.on("sortTextInListAscendingly",function(){ListSort.sortList.call(null,ListUtils.getListId(),!0,SORT_TYPES.TEXT)}),e.on("sortDatesListDescendingly",function(){ListSort.sortList.call(null,ListUtils.getListId(),!1,SORT_TYPES.DATE)}),e.on("sortDatesInListAscendingly",function(){ListSort.sortList.call(null,ListUtils.getListId(),!0,SORT_TYPES.DATE)}),e.on("sortNumbersInListDescendingly",function(){ListSort.sortList.call(null,ListUtils.getListId(),!1,SORT_TYPES.NUMBER)}),e.on("sortNumbersInListAscendingly",function(){ListSort.sortList.call(null,ListUtils.getListId(),!0,SORT_TYPES.NUMBER)}),e.on("sortTextDescendingly",function(){CURSOR_CONTEXT_DEFINITIONS.isList()?ListSort.sortList.call(null,ListUtils.getListId(),!1,SORT_TYPES.TEXT):ParaSort.sort.call(null,!1,SORT_TYPES.TEXT)}),e.on("sortTextAscendingly",function(){CURSOR_CONTEXT_DEFINITIONS.isList()?ListSort.sortList.call(null,ListUtils.getListId(),!0,SORT_TYPES.TEXT):ParaSort.sort.call(null,!0,SORT_TYPES.TEXT)}),e.on("sortDatesDescendingly",function(e){CURSOR_CONTEXT_DEFINITIONS.isList()?ListSort.sortList.call(null,ListUtils.getListId(),!1,SORT_TYPES.DATE,e):ParaSort.sort.call(null,!1,SORT_TYPES.DATE,e)}),e.on("sortDatesAscendingly",function(e){CURSOR_CONTEXT_DEFINITIONS.isList()?ListSort.sortList.call(null,ListUtils.getListId(),!0,SORT_TYPES.DATE,e):ParaSort.sort.call(null,!0,SORT_TYPES.DATE,e)}),e.on("sortNumbersDescendingly",function(){CURSOR_CONTEXT_DEFINITIONS.isList()?ListSort.sortList.call(null,ListUtils.getListId(),!1,SORT_TYPES.NUMBER):ParaSort.sort.call(null,!1,SORT_TYPES.NUMBER)}),e.on("sortNumberstAscendingly",function(){CURSOR_CONTEXT_DEFINITIONS.isList()?ListSort.sortList.call(null,ListUtils.getListId(),!0,SORT_TYPES.NUMBER):ParaSort.sort.call(null,!0,SORT_TYPES.NUMBER)}),e.on("checkAll",function(){PubSub.publish("CheckListOperations/checkAll")}),e.on("uncheckAll",function(){PubSub.publish("CheckListOperations/uncheckAll")}),e.on("toggleItemState",function(){var e=editor.doc.getSelection(),t=DocTreeManager.getTreeNodeAtIndex(e[0].start),i=t.getEndIndex(),n=editor.doc.getRawFormatAt(i);PubSub.publish("CheckListOperations/toggleCurrentItem",t,n)}),e.on("removeChecked",function(){PubSub.publish("CheckListOperations/removeChecked")}),e.on("moveCheckedToBottom",function(){ListSort.sortList.call(null,ListUtils.getListId(),!0,SORT_TYPES.CHECKED)}),e.on("moveUp",function(){NavUtil.moveParaUp()}),e.on("moveDown",function(){NavUtil.moveParaDown()}),e.on("hlist",function(e){var t,i,n,o,r={};editor.doc.getHeadingListId();ListUtils.fillListProps(r,ls_data),t=editor.doc.getSelection().getAllHeadings(),n=[];for(var o=0;o<t.length;o+=1)i=t[o],parseInt(i.attr(ATTR_PARAGRAPH.PS_HD))&&!ListUtils.isList(i.attr("*"))&&n.push(i);t=n;var a=editor.doc.getSelection();if(a.isCollapsed()||a.isListItemSelection){var s=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH);parseInt(s.attr(ATTR_PARAGRAPH.PS_HD))||DocUtil.applyHeadingForSelection(1),t.push(s)}for(var l={},d=0;d<t.length;d++)l[t[d].getStart()]=t[d];var c=[];for(var u in l)c.push(l[u]);List.init(r,c,["hlist",e])}),e.on("removeHeadingList",function(){var e,t,i,n,o={},r=editor.doc.getHeadingListId(),a={id:0,l:-1};ListUtils.fillListProps(o,a),e=editor.doc.getSelection().getAllHeadings(),i=[];for(var n=0;n<e.length;n+=1){t=e[n];var s=t.attr(ATTR_PARAGRAPH.LS_DATA);ListUtils.isList(t.attr("*"))&&s&&s.id==r&&i.push(t)}List.init(o,i,["removeHeadingList"])}),e.on("orderedlist",function(){var e=editor.doc.getSelection(),t=e.getNodesInSelection(NODE_TYPE.PARAGRAPH),i=e.getTargetRange(),n=i.start,o=i.end;return t.length>1&&(DocTreeViewManager.getNoteRanges(NODE_TYPE.ENDNOTE,n,o).length>1||DocTreeViewManager.getNoteRanges(NODE_TYPE.FOOTNOTE,n,o).length>1)?void PubSub.publish("Document/Warning",WARNING_MSG.OPERATION_NOT_ALLOWED):void List.createNewList(LIST_TYPE.RECENT_ORDER,t)}),e.on("unorderedlist",function(e){var t=editor.doc.getSelection(),i=t.getNodesInSelection(NODE_TYPE.PARAGRAPH),n=t.getTargetRange(),o=n.start,r=n.end;if(i.length>1&&(DocTreeViewManager.getNoteRanges(NODE_TYPE.ENDNOTE,o,r).length>1||DocTreeViewManager.getNoteRanges(NODE_TYPE.FOOTNOTE,o,r).length>1))return void PubSub.publish("Document/Warning",WARNING_MSG.OPERATION_NOT_ALLOWED);var a,s;List.splListFormats={},e.type===LIST_TYPE.SYMBOL?List.splListFormats.c=e.char:e.type===LIST_TYPE.IMAGE&&(e.img?(List.splListFormats.imgData={},List.splListFormats.imgData.img=e.img):e.SVG_DATA&&(List.splListFormats.imgData=e.SVG_DATA),e.hasOwnProperty("listObj")&&(a=e.listObj,s=e.format)),List.createNewList(LIST_TYPE.RECENT_UNORDER,i,s,a)}),e.on("updateLevelNumbering",function(e){ListUtils.updateLevelNumbering(e)}),e.on("updateListPrefixAndSuffix",function(e){ListUtils.updateListPrefixAndSuffix(e)}),e.on("FormatPainter",function(){if(!editor.doc.paintFormat_dblClick){var e=editor.doc.getSelection(),t=e.getComputedTextFormat();delete t[ATTR_COMMON.CLS],delete t[ATTR_TEXT.TS_SP],delete t[ATTR_TEXT.TS_GR],delete t[ATTR_TEXT.TS_PROOFING_WQ],t[ATTR_TEXT.TS_NULL]=!0,editor.doc.paintFormat.text=t;var i=e.getParents(NODE_TYPE.PARAGRAPH),n=e.getTargetRange(),o=n.start,r=n.end;(e.isListItemSelection||r==o||i.getStart()===o&&(r===i.getEnd()||r===i.getEnd()-1))&&(t=e.getParaFormat(),t[ATTR_PARAGRAPH.PS_NULL]=!0,editor.doc.paintFormat.para=t),editor.jeditorPane.children(".zw-page").css("cursor","pointer")}});var t=function(e){var t=editor.doc.createElement(NODE_TYPE.HR,{c:UNICODE.HR}),i=editor.doc.getSelection().getStart();t.setStart(i);var n=e?e:{};e||(n[ATTR_COMMON.BORDERS]={},n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]={type:"solid",color:"rgb(0,0,0)",width:"1px",space:"1px"}),n[ATTR_HR.HR_AL]="0";var o=DocTreeManager.getSectionAtIndex(i);if(o.getSectionType()==SECTION_TYPES.TEXTBOX){var r=o.getRangeIndex(),a=editor.doc.getRawFormatAt(r),s=a[ATTR_CELL.TDS_PL]?parseFloat(a[ATTR_CELL.TDS_PL].convertor().pixels):0,l=a[ATTR_CELL.TDS_PR]?parseFloat(a[ATTR_CELL.TDS_PR].convertor().pixels):0,d=a[ATTR_IMAGE.I_WID]-s-l;n[ATTR_HR.HR_WID]=d}editor.doc.getSelection().insert(t,n)};e.on("inshr",function(e){editor.doc.getSelection().getStart();t(e)}),e.on("insblankpage",function(e){var t=editor.getDocument(),i=t.getSelection().getRangeAt(0),n=i.getStartNodeParents(NODE_TYPE.PARAGRAPH)[0],o=n.splitAt(i.start-n.start),r=t.createNode(NODE_TYPE.HR);r.style._.op.cls="pgbrk",o.insertBefore(r);var a=t.createNode(NODE_TYPE.PARAGRAPH);ZWJSONUtils.cloneAndExtend(a.style._,n.style._),r.insertAfter(a),t.moveCursor(a,!0),r=t.createNode(NODE_TYPE.HR),r.style._.op.cls="pgbrk",a.insertAfter(r),Op.processMsg(t.getChanges().toJson()),Op.cursorProcessed()}),e.on("insertsectionbreak",function(e,t){for(var i=editor.doc.getSelection(),n=0;n<i.length;n++){var o=i[n];if(!o.isTableSelected()){if(!o.collapsed){var r;r=!t||ZWJSONUtils.isEmptyObject(t)?{}:t,e[ATTR_SECTION.GUTTER]&&(r[ATTR_SECTION.GUTTER]=e[ATTR_SECTION.GUTTER]),OpUtil.createContentSectionOps(o.end,r)}OpUtil.createContentSectionOps(o.start,e)}}});var i=function(e,t){for(var i=e.sectionNodes,n=i.length,o=0,r=n;o<r;o++){var a=t.getZWNodeParentsAt(i[o].getIndex(),NODE_TYPE.SECTION)[0],s=i[o].next,l=s?t.getZWNodeParentsAt(s.getIndex(),NODE_TYPE.SECTION)[0]:null;a.setStyle(e.styles,l)}};e.on("applySectionsStyles",function(e){for(var t=e[0],n=t.length,o=e[1],r=0;r<n;r++){var a=t[r];i(a,o)}}),e.on("updatesectionstyle",function(e){var t=e[0],n=e[1];i(t,n)}),e.on("insquote",function(e){var t,i;t={char:e[0],style:editor.doc.getSelection().getTextFormat()},i={char:e[1],style:editor.doc.getSelection().getTextFormat()},editor.doc.getSelection().surroundTextWith(t,i,null,!0)}),e.on("insertnote",function(e){if(Note.insertNote(e.type,e.noteData,e.noteProps),e.options&&!e.options.focusElement){editor.doc.getSelection().getEnd()+3;Op.cursorProcessed()}}),e.on("removenote",function(){Note.removeNote()}),e.on("removeallnotes",function(e){Note.removeAllNotes(e)}),e.on("changenotetype",function(e){Note.convertNote.apply(null,e)}),e.on("changeallnotetype",function(e){Note.convertAllNotes.apply(null,e)}),e.on("changenotestyle",function(e){Note.changeNoteStyle.apply(null,e)}),e.on("insertnotesymbol",function(e){Note.insertSymbol(e)}),e.on("removenotesymbol",function(){Note.removeSymbol()}),e.on("regeneratetoc",function(e){editor.lastOperation="regeneratetoc",e?Toc.updatePageNumber():Toc.regenerateTOC()}),e.on("inserttoc",function(e){Toc.generate(e)}),e.on("deletetoc",function(){Toc.deleteTOC()}),e.on("insimg",function(e){var t=e[1],i=e[0],n=editor.doc.createElement(NODE_TYPE.IMAGE);i.shapeData&&(ZWLogger.addToStatistics("insshape"),editor.statistics.insimg-=1),PubSub.publish("DocOperation/BeforeImgInsert"),n.setStart(editor.doc.getSelection().getStart()),editor.doc.getSelection().insert(n,i,t)}),e.on("insertChart",function(e){var t=editor.doc.createElement(NODE_TYPE.CHART);t.setStart(editor.doc.getSelection().getStart());var i={id:Utils.randomString(),type:NODE_TYPE.CHART,wid_un:"px",ht_un:"px",chartDetails:e.chartDetails,ht:e.ht,wid:e.wid,orginalHt:e.ht,orginalWid:e.wid};e.mminfo&&(i.mminfo=e.mminfo),editor.doc.getSelection().insert(t,i,!1)}),e.on("insmultipleimg",function(e){for(var t=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE),i=DocUtil.copyStyle(t.attr());ImageHandler.newattr&&ImageHandler.newattr.cropRect&&(ImageHandler.newattr.cropRect=null),i[MAILMERGE.MMINFO]?i[ATTR_IMAGE.ALTSRC]=e:i[ATTR_IMAGE.I_SRC]=e,editor.doc.execCmd("applyStyle",[t,i,"replaceImage"]),ImageHandler.replaceImageAction=!1},i=function(e){var t={};return t[ATTR_IMAGE.I_HT]=e.HEIGHT,t[ATTR_IMAGE.I_WID]=e.WIDTH,t[ATTR_IMAGE.I_ORGINALHT]=e.HEIGHT,t[ATTR_IMAGE.I_ORGINALWID]=e.WIDTH,t[ATTR_IMAGE.I_SRC]=e.URL,t},n=function(e){var t=ZWImageUtils.getNewDimensionBasedOnContainer(e.WIDTH,e.HEIGHT);return e.WIDTH="undefined"!=typeof t.width?t.width:e.WIDTH,e.HEIGHT="undefined"!=typeof t.height?t.height:e.HEIGHT,i(e)},o=0,r=e.length;o<r;o++){var a=e[o];if(ImageHandler.replaceImageAction)t(a.URL);else{var s=n(a),l=editor.doc.createElement(NODE_TYPE.IMAGE);s.shapeData&&(ZWLogger.addToStatistics("insshape"),editor.statistics.insimg-=1),PubSub.publish("DocOperation/BeforeImgInsert"),l.setStart(editor.doc.getSelection().getStart()),editor.doc.getSelection().insert(l,s,!1)}}}),e.on("insobj",function(e){var t;t=editor.doc.createElement(NODE_TYPE.IMAGE),t.setStart(editor.doc.getSelection().getStart()),editor.doc.getSelection().insert(t,e),Op.appendCursor()}),e.on("autofield",function(e){var t,i,n,o,r,a,s,l;editor.doc.getSelection().isCollapsed()||editor.doc.getSelection().deleteSelectedContents(),t=e[0],"autopno"==t&&e[1]?n=e[1]:i=e[1],o=Utils.randomString();var d=!1;if(r={type:NODE_TYPE.AUTOFIELD,id:o},a=DocUtil.copyStyle(r),r[ATTR_AUTOFIELD.FIELDTYPE]=t,"autoformula"!==t&&(r[ATTR_AUTOFIELD.ISAUTO]=e[3]||0),"autodate"==t)s=e[1],r[ATTR_AUTOFIELD.DATEFMT]=e[2],r[ATTR_AUTOFIELD.LOCALE]=e[4];else if("autopcnt"==t)r[ATTR_AUTOFIELD.SECTIONPAGES]=e[2]||0;else if("autodocname"==t){var c=editor.doc.docInfo.DOCUMENT_NAME;l=c.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),"")}else if("autoauthor"==t)l=i?Utils.removeUnWantedUnicodes(i):editor.doc.docInfo.CREATOR;else if("autodocversion"==t)l=editor.doc.docInfo.DOCS_VERSION,!l&&editor.isOffline()&&ZWOffline.isOfflineSetupDone()&&(l="1.0"),ZWLogger.addToStatistics("autofield_docversion");else if("autoformula"==t){r[ATTR_AUTOFIELD.FORMULA]=i,r.fieldInfos=e[3],r.label=e[4];var u=Formula.getFormulaFormat(i),p=DocTreeManager.getTreeNodeAtIndex(editor.doc.getSelection().getStart());l=p.getAutoFieldValue(t,u),l=l.formattedVal,"Formula_Output"==l&&e[4]&&(l=e[4])}else if(t==AUTOFIELD_TYPE.USER_FIRST_NAME||t==AUTOFIELD_TYPE.USER_EMAIL||t==AUTOFIELD_TYPE.USER_LAST_NAME||t==AUTOFIELD_TYPE.USER_PHONE){if(d=!0,t==AUTOFIELD_TYPE.USER_FIRST_NAME?l=editorProps.userInfo.firstName:t==AUTOFIELD_TYPE.USER_LAST_NAME?l=editorProps.userInfo.lastName:t==AUTOFIELD_TYPE.USER_PHONE?l=editorProps.userInfo.phone:t==AUTOFIELD_TYPE.USER_EMAIL&&(l=editorProps.userInfo.email),!l||"null"==l){var g="<a href='"+UIUtils.iamServerURL+"' rel='noreferrer' target='_blank'>";return void MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_INFO,J.i18n("writer.common.FIELD_EMPTY_TITLE"),J.i18n("writer.common.FIELD_EMPTY_MESSAGE",[g,"</a>"]),null,null,null,!0,!0,null)}r.zuid=editor.zuid}r[ATTR_AUTOFIELD.VALUE]=s;var f={char:UNICODE.RANGE_START,style:r},E={char:UNICODE.RANGE_END,style:a},T={};T[ATTR_COMMON.TYPE]=NODE_TYPE.TEXT,T[ATTR_COMMON.CLS]=t,T[ATTR_COMMON.FIELDINFO]=o;var m=new RegExp(CONT_REGEXP.AUTOUPDATE_DOC_FIELDS);"autodate"==t||"autopno"==t?i="#":("autoformula"==t||d||m.test(t))&&(i=l);var h=editor.doc.createElement(NODE_TYPE.TEXT,i),I=DocUtil.copyStyle(editor.doc.getSelection().getTextFormat());I[TCConstants.TC]&&delete I[TCConstants.TC],DocUtil.mergeStyles(I,T),I.cls=t,h.css=I;var _=editor.doc.getSelection();if(n){var A=editor.doc.getSelection()[0].start;_.removeAllRanges().addRange(editor.doc.createRange(n))}_.surroundAndInsert(f,E,h,!0);var S;if(A?(_.removeAllRanges().addRange(editor.doc.createRange(A)),S=_.getEnd()):S=_.getEnd()+i.length+2,"autopno"==t){var R=e[2],O=e[3];R&&O&&editor.doc.execCmd("formatAutoField",[R,O])}}),e.on("mergeField",function(e){var t,i;editor.doc.getSelection().isCollapsed()||editor.doc.getSelection().deleteSelectedContents(),t=e[0],i=e[1];var n=Utils.randomString(),o={};o[ATTR_COMMON.ID]=n,o[ATTR_COMMON.TYPE]=NODE_TYPE.MAILMERGEFIELD,o[ATTR_AUTOFIELD.FIELDTYPE]=t,o[MAILMERGE.MMINFO]=i;var r={};r[ATTR_COMMON.TYPE]=NODE_TYPE.TEXT,r[ATTR_COMMON.CLS]=t;var a=DocUtil.copyStyle(o);delete a[MAILMERGE.MMINFO];var s="";t==CONST.MERGEFIELD?s=ZWUtils.getMergeFieldName(i):(r[ATTR_COMMON.FIELDINFO]=n,s="#");var l={char:UNICODE.RANGE_START,style:o},d={char:UNICODE.RANGE_END,style:a},c=(s.length+2,editor.doc.createElement(NODE_TYPE.TEXT,s)),u=DocUtil.copyStyle(editor.doc.getSelection().getTextFormat());u[TCConstants.TC]&&delete u[TCConstants.TC],DocUtil.mergeStyles(u,r),c.css=u,editor.doc.getSelection().surroundAndInsert(l,d,c,!0)}),e.on("instable",function(e){TableActions.insertTable(e)}),e.on("deltable",function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);e.deleteContents(t.getStart(),t.getEnd()),PubSub.publish("Document/TableDeleted")}),e.on("delrow",function(){TableActions.deleteRow()}),e.on("delcolumn",function(){TableActions.deleteColumn()}),e.on("delcolumns",function(e){var t=e[0],i=e[1];TableActions.deleteColumns(t,i)}),e.on("insrowafter",function(){TableActions.insertRowAfter()}),e.on("insrowbefore",function(e,t){TableActions.insertRowBefore(e,t)}),e.on("inscolafter",function(){var e=editor.doc.getSelection().getTargetRange(),t=DocTreeManager.doc.getParents(NODE_TYPE.TABLE,e.start),i=t.format[ATTR_TABLE.TBLS_DIR]||PARA_DIR.LTR;i===PARA_DIR.RTL?TableActions.insertColumnBefore():TableActions.insertColumnAfter()}),e.on("inscolbefore",function(){var e=editor.doc.getSelection().getTargetRange(),t=DocTreeManager.doc.getParents(NODE_TYPE.TABLE,e.start),i=t.format[ATTR_TABLE.TBLS_DIR]||PARA_DIR.LTR;i===PARA_DIR.RTL?TableActions.insertColumnAfter():TableActions.insertColumnBefore()}),e.on("mergecells",function(){editor.doc.getSelection().mergeCells()}),e.on("splitcells",function(){TableSplit.splitCells()}),e.on("distributeColumns",function(){TableActions.distributeColumns()}),e.on("selectAllCells",function(){var e=Array.prototype.slice.call(arguments),t=editor.doc.getSelection();t.selectAllCells.apply(t,e)}),e.on("fitToWindow",function(){TableActions.fitToWindow()}),e.on("fixedColumnWidth",function(){TableActions.fixedColumnWidth()}),e.on("unmergecells",function(){TableActions.unMergeCells()}),e.on("duplicateToAllCells",function(){TableActions.duplicateToAllCells()}),e.on("convertTableToText",function(e){var t=e[0];ZWLogger.addToStatistics("TableToText"),ConvertTableToText.convertTableToText(t)}),e.on("splitTable",function(){var e=(editor.doc.getSelection(),editor.doc.getSelection().getParents(NODE_TYPE.TABLE)),t=editor.doc.getSelection().getParents(NODE_TYPE.ROW);SplitTable.canAllowSplitTable(e,t)&&(SplitTable.split(e,t),ZWLogger.addToStatistics("SplitTable"))}),e.on("transposeTable",function(){var e=(editor.doc.getSelection(),editor.doc.getSelection().getParents(NODE_TYPE.TABLE));TransposeTable.canAllowTransposeTable(e)&&(TransposeTable.transpose(),ZWLogger.addToStatistics("TransposeTable"))}),e.on("distributeRows",function(){TableActions.distributeRows()}),e.on("convertTextToTable",function(e){TableActions.insertTable(e)}),e.on("cantSplitRow",function(e){TableActions.cantSplitRow(e)}),e.on("removeCantSplitRow",function(e){TableActions.removeCantSplitRow(e)}),e.on("rowHtRule",function(e){TableActions.rowHtRule(e[0],e[1])}),e.on("removeRowHtRule",function(e){TableActions.removeRowHtRule(e[0],e[1])}),e.on("tableDragDrop",function(e){TableMoveHandler.moveTableToTheGivenIndex(e.idx,e.jEl,e.left)}),e.on("cut",function(){editor.doc.getTrackChangeDetails().setContentMovedFromSource(!0),CopyEventHandler.handleCutEvent(),editor.doc.getTrackChangeDetails().setContentMovedFromSource(!1)}),e.on(COMMAND.PASTE,function(e){PasteEventHandler.doPaste(e)}),e.on("changecase",function(e){if(editor.doc.getSelection().isCollapsed()&&editor.doc.getSelection().getWord().select(),!editor.doc.getSelection().isCollapsed()){var t,i=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.TEXT);n(i);for(var o=0;o<i.length;o++){var r=i[o],a=r.nodeValue,s=r.getStart();if(s>0&&editor.doc.getCharAt(s-1)==UNICODE.RANGE_START){s--;var l=editor.doc.getRawFormatAt(s);if("mergeField"==l.type){var d={};d.type=l.type,d.format=DocUtil.copyStyle(l.format)||{},d.format[ATTR_TEXT.TS_FV]=e;var c=Utils.randomString(),u=ZWJSONUtils.getKeys(d),p=[{r:s},{as:{start:d,id:c}},{r:1},{as:{end:u,id:c}}];Op.processMsg(p)}}t="lower"==e?a.toLowerCase():a.toUpperCase();var g=editor.doc.createElement(NODE_TYPE.TEXT,t);g.setStart(r.getStart()),g.setEnd(r.getEnd()),editor.doc.getSelection().replace(r,g,!0)}}});var n=function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t];if("small-caps"==n.attr(ATTR_TEXT.TS_FV)){var o={};o[ATTR_TEXT.TS_FV]="",n.attr(o)}}Op.sendMsg()};e.on("sentencecase",function(){var e=editor.doc.getSelection(),t=e.getStart(),i=e.getEnd(),o=e.getNodesInSelection(NODE_TYPE.TEXT);n(o);for(var r=0,a=o.length;r<a;r++){var s=o[r],l=s.getStart();if(l>0&&editor.doc.getCharAt(l-1)==UNICODE.RANGE_START){l--;var d=editor.doc.getRawFormatAt(l);if("mergeField"==d.type){var c={};c.type=d.type,c.format=DocUtil.copyStyle(d.format)||{},c.format[ATTR_TEXT.TS_FV]="sentenceCase";var u=Utils.randomString(),p=ZWJSONUtils.getKeys(c),g=[{r:l},{as:{start:c,id:u}},{r:1},{as:{end:p,id:u}}];Op.processMsg(g)}}}Utils.changeCase("sentenceCase",t,i)}),e.on("capitalizeword",function(){var e=editor.doc.getSelection(),t=e.getStart(),i=e.getEnd();if(t==i){var o=e.getWord();t=o.getStart(),i=o.getEnd(),o.select()}var r=e.getNodesInSelection(NODE_TYPE.TEXT);n(r);for(var a=0,s=r.length;a<s;a++){var l=r[a],d=l.getStart();if(d>0&&editor.doc.getCharAt(d-1)==UNICODE.RANGE_START){d--;var c=editor.doc.getRawFormatAt(d);if("mergeField"==c.type){var u={};u.type=c.type,u.format=DocUtil.copyStyle(c.format)||{},u.format[ATTR_TEXT.TS_FV]="capitalizeWord";var p=Utils.randomString(),g=ZWJSONUtils.getKeys(u),f=[{r:d},{as:{start:u,id:p}},{r:1},{as:{end:g,id:p}}];Op.processMsg(f)}}}Utils.changeCase("capitalizeWord",t,i)}),e.on("replace",function(e){var t=e[0],i=e[1];DocUtil.replaceNodes(t,i)}),e.on("mailmerge",function(e){var t,i,n,o;for(t=0;t<e.length;t++)i=e[t],n=editor.doc.createElement(NODE_TYPE.TEXT,i),o={},o[ATTR_COMMON.CLS]="mergeField",o[ATTR_TEXT.MM_FIELDNAME]=i,editor.doc.getSelection().insert(n,o),n=editor.doc.createElement(NODE_TYPE.TEXT," "),editor.doc.getSelection().insert(n,{type:NODE_TYPE.TEXT})}),e.on("deleteParaRepeat",function(){var e=editor.doc.getSelection().getStart(),t=MailMergeRepeatUtil.getParaRangeInfo(e);if(t){var i=editor.getDocument(),n=ZWUtils.getZWNodeAt.call(i,t.start).getField();n.remove(),i.sync()}}),e.on("pararepeat",function(e){ZWLogger.addToStatistics("pararepeat"),e=e||[];for(var t,i,n=e[0],o=e[1],r=o.length,a=editor.getDocument(),s=[],l=0;l<r;l++)i=MailMergeUtil.getZWFieldNode(o[l]),t?(i.type==NODE_TYPE.IMAGE?t.append(i):t.appendField(i),s.push(t)):s.push(i),t=a.createNode(NODE_TYPE.PARAGRAPH);var d=a.createRepeatRange(n,s),c=a.getSelection().getRangeAt(0);c.insertField(d,!1),a.sync()});var o=function(e){var t=Utils.randomString();return e=e||{type:NODE_TYPE.PARAGRAPH},[{as:{start:e,id:t}},{is:UNICODE.PARA},{as:{end:ZWJSONUtils.getKeys(e),id:t}}]};e.on("rowrepeat",function(e){ZWLogger.addToStatistics("rowrepeat"),e=e||[];for(var t=e[0],i=e[1],n=i.length,o=[],r=0;r<2;r++){var a={};a.rowFormat={},1==r&&(a.rowFormat.mminfo=t);for(var s=[],l=0;l<n;l++){var d=i[l],c=[],u=Utils.randomString();if(c.push({as:{start:{type:NODE_TYPE.TEXT},id:u}}),0==r)c.push({is:MailMergeFieldUtil.getDisplayName(d)});else{var p=MailMergeUtil.getMMFieldInsertOp(d);c=c.concat(p)}c.push({as:{end:["type"],id:u}}),s.push(c)}a.cellValuesOpsArr=s,o.push(a)}TableActions.insertTable([2,n,o],{}),Op.sendMsg()}),e.on("columnrepeat",function(e){ZWLogger.addToStatistics("columnrepeat"),e=e||[];for(var t=e[0],i=e[1],n=e[2]||1,o=n+1,r=i.length,a=[],s=0;s<r;s++){for(var l={},d=[],c=0;c<2;c++){var u=i[s],p=[],g=Utils.randomString();if(p.push({as:{start:{type:NODE_TYPE.TEXT},id:g}}),0==c)p.push({is:MailMergeFieldUtil.getDisplayName(u)});else{var f=MailMergeUtil.getMMFieldInsertOp(u);p=p.concat(f)}p.push({as:{end:["type"],id:g}}),d.push(p)}l.cellValuesOpsArr=d,a.push(l)}var E="100%",T=[{wt:"25%"},{wt:"75%",mminfo:t}];TableActions.insertTable([r,o,a],{cols:T,wid:E}),Op.sendMsg()}),e.on("cellrepeat",function(e){ZWLogger.addToStatistics("cellrepeat"),e=e||[];var t=e[0],i=e[1],n=e[2]||1,r=i.length,a=[],s={};s.rowFormat={};for(var l=[],d=[],c=0;c<r;c++){var u=i[c],p=Utils.randomString();d.push({as:{start:{type:NODE_TYPE.TEXT},id:p}});var g=MailMergeUtil.getMMFieldInsertOp(u);d=d.concat(g),r!=c+1&&(d=d.concat(o())),d.push({as:{end:["type"],id:p}})}l.push(d),s.cellValuesOpsArr=l;for(var f=[],u=t,E="100%",T=100/n+"%",m=[],h=0;h<n;h++)f.push({mminfo:u}),u={type:MAILMERGE.PLACEHOLDER_CELL},m.push({wt:T});s.cellFormat=f,a.push(s),TableActions.insertTable([1,n,a],{wid:E,cols:m}),Op.sendMsg()}),e.on("insert",function(e){var t=e;editor.doc.getSelection().insert(t,t.css)}),e.on("inserttab",function(e){for(var t=0,i=e.length;t<i;t++){var n=editor.doc.createElement(NODE_TYPE.TEXT,UNICODE.TAB);n.css={st:"tab",type:"text"},n.setStart(e[t].getStart()),n.setEnd(e[t].getStart()),n.insert()}}),e.on("setTableTheme",function(e){TableTheme.applyTheme(e)}),e.on("cellalignment",function(e){var t=editor.doc.getSelection(),i=t.getSelectedCells();0==i.length&&(i=[t.getParents(NODE_TYPE.CELL)]);for(var n=0,o=i.length;n<o;n++)TableActions.setCellAlign(i[n],e)}),e.on("applyBorders",function(e){for(var t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH),i=0;i<t.length;i++)t[i].attr(e)}),e.on("applyLineSpacing",function(e){for(var t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH),i=0;i<t.length;i++)t[i].attr(e)}),e.on("applyStyle",function(e){var t,i=e[0],n=e[1],o=e[2];if(i instanceof Array){var r=jQuery.isArray(n);for(t=0;t<i.length;t++)r?i[t].attr(n[t]):i[t].attr(n)}else i.attr(n);if("applyTablePanelStyle"===o&&n.length&&n[0][ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL){var a=editor.doc.getSelection().getTargetRange(),s=editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION;ZWLogger.sendErrorDetails("NO_ERROR_MAIL<ZWERROR>"+s+"<ZWERROR>TABLE DIRECTION CHANGED TO RTL\nRange: "+JSON.stringify(a&&a.toCursorOp())+"\nVersion: "+s),ZWLogger.addToStatistics("TBL_DIRECTION")}o&&(editor.lastOperation=o)}),e.on("changeDesign",function(e){editor.doc.getSelection().getParents(NODE_TYPE.BODY).attr(e),StyleUI.reinitHeadingStylesMenu()}),e.on("removeTab",function(e){var t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH);TabStop.removeTab(e,t)}),e.on("modifyTab",function(e){var t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH);TabStop.updatePoint(e.tpid,e.point,t)}),e.on("applyTab",function(){var e=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH);TabStopDlg.applyValues(e)}),e.on("removeAlltab",function(){var e=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH);TabStop.removeAllTab(e)}),e.on("insertTab",function(e){var t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH);TabStop.insertTab(e.point,e.align,t)}),e.on("delete",function(e){var t,i,n,o,r=editor.doc.getSelection();if("string"==typeof e){var a=editor.doc.getRawFormatAt(r.getStart()),s=a&&a.id,l=/toc_/;if(o=e,"nextword"==o){if(t=r.getNextWord(),!t)return;if(i=r.getStart(),n=t.getEnd(),editor.doc.getCharAt(t.getEnd()-1)==UNICODE.RANGE_END&&l.test(s)){var d=editor.doc.createRange(t.getStart(),t.getEnd());r.removeAllRanges().addRange(d)}else i==n-1?r.deleteChar(KEYS.DELETE):t.remove()}else if("prevword"==o){if(t=r.getPreviousWord(),!t)return;if(n=t.getEnd(),i=t.getStart(),editor.doc.getCharAt(t.getEnd()-1)==UNICODE.RANGE_END&&l.test(s)){var d=editor.doc.createRange(t.getStart(),t.getEnd());r.removeAllRanges().addRange(d)}else i==n-1?r.deleteChar(KEYS.BACKSPACE):t.remove()}else if("nextchar"==o)r.deleteChar(KEYS.DELETE);else if("prevchar"==o)r.isListItemSelection?ListUtils.removeList():r.deleteChar(KEYS.BACKSPACE);else if("watermark"==o){var c=editor.doc.createElement(NODE_TYPE.BODY),u={};u[ATTR_BODY.WM_TYPE]="",u[ATTR_BODY.WM_FS]="",u[ATTR_BODY.WM_FF]="",u[ATTR_BODY.WM_TXT]="",u[ATTR_BODY.WM_AN]="",u[ATTR_BODY.WM_FGC]="",u[ATTR_BODY.WM_PURL]="",u[ATTR_BODY.WM_OURL]="",u[ATTR_BODY.WM_URL]="",u[ATTR_BODY.WM_OP]="",u[ATTR_BODY.WM_SIZE]="",u[ATTR_BODY.DS_BGC]=editor.doc.getBodyFormat()[ATTR_BODY.DS_BGC],c.attr(u)}}else{var p=e;p.remove()}}),e.on("deleteAllBookMarks",function(){var e;e=editor.doc.getElement(NODE_TYPE.BOOKMARK);for(var t,i=0;t=e[i++];)t.remove()}),e.on("RemoveFormat",function(){var e,t=editor.doc.getSelection(),i=t.getStart(),n=t.isCollapsed(),o=t.getEnd(),r={};if(i==o){e=t.getParents(NODE_TYPE.PARAGRAPH),r[ATTR_PARAGRAPH.PS_NULL]=!0,e.attr(r),Op.processMsg(Op.getCursor(i,o)),Op.cursorProcessed();var a=t.getWord();i=a.getStart(),o=a.getEnd();var s=editor.doc.createRange(i,o);t.removeAllRanges().addRange(s)}if(i!=o){if(!n){var l=t.getNodesInSelection(NODE_TYPE.PARAGRAPH);if(l.length>1||l[0].getEnd()<=o){r[ATTR_COMMON.TYPE]=NODE_TYPE.PARAGRAPH,r[ATTR_PARAGRAPH.PS_NULL]=!0;for(var d=0,c=l.length;d<c;d++)l[d].attr(r)}}var u={type:NODE_TYPE.TEXT};u[ATTR_TEXT.TS_NULL]=!0,t.applyFormat(u)}else t.textFormat={type:NODE_TYPE.TEXT},t.textFormat[ATTR_TEXT.TS_NULL]=!0}),e.on("changeHdrFtr",function(e){e=parseInt(e);var t=DocLayoutManager.getCurrentGroup(),i=t.getHFType();if(i!==e){var n=editor.doc.getTrackChangeDetails();n.setProcessingTC(!1);var o=DocTreeManager.getLastNonMetaSection().end,r=DTUtils.getHFTypeDetails(e),a=t.getFirstSection().getNode(),s=DocTreeManager.getSectionsByType(SECTION_TYPES.CONTENT).first,l={};l.headerIds=s.getHFIds(SECTION_TYPES.HEADER),l.footerIds=s.getHFIds(SECTION_TYPES.FOOTER);var d,c=DocLayoutManager.getCurrentSection(),u=[];for(var p in r)for(var g=r[p],f=0;f<g.length;f++){var E=a.getHFIdByHFType(p,g[f]);if(E){var T=DocTreeManager.getSectionWithSid(E);T.getSectionType()==c.getSectionType()&&g[f]!=CONST.HEADER_EVEN&&g[f]!=CONST.FOOTER_EVEN&&(d=T.start+1)}else{var m=Utils.randomId(p);p==SECTION_TYPES.HEADER?l.headerIds.push(m):l.footerIds.push(m);var h=DocUtil.getSectionOps(g[f],o,p,m);u.length&&h.splice(0,1),u=u.concat(h)}}var I=editor.getDocument();if(u.length){var _=DocOpBuilder.compose(DocOpBuilder.build(u),DocOpBuilder.build(Op.getCursor(o+1,o+1)));Op.cursorProcessed(),u=_.toJson(),Op.processMsg(u);var A=I.getZWNodeParentsAt(s.getIndex(),NODE_TYPE.SECTION)[0];A.setStyle(l)}else Op.processMsg(Op.getCursor(d,d)),Op.cursorProcessed();var S=I.getZWNodeParentsAt(a.getIndex(),NODE_TYPE.SECTION)[0],R={};R[ATTR_BODY.DS_HF_TYPE]=e,S.setStyle(R),I.sync(),n.setProcessingTC(!0)}}),e.on("linkHdrFtr",function(){var e=editor.doc.getTrackChangeDetails();e.setProcessingTC(!1);for(var t,i,n,o,r=editor.getDocument(),a=DocLayoutManager.getCurrentGroup(),s=a.getFirstSection().getNode(),l=DocLayoutManager.getCurrentPage(),d={},c=0;c<HF_SECTIONS.length;c++){if(t=HF_SECTIONS[c],i=l.getHFSection(t),n=i.getNode(),o=n.getId(),t==SECTION_TYPES.HEADER){d.headerIds=s.getHFIds(t);var u=d.headerIds.indexOf(o);d.headerIds.splice(u,1)}else{d.footerIds=s.getHFIds(t);var u=d.footerIds.indexOf(o);d.footerIds.splice(u,1)}var p=n.getIndex(),g=n.getEndIndex()+1,f=n.getSectionType(),E=editor.doc.createSection(f,editor.doc.getContent(p+1,g),n.getId());E.setStart(p),E.setEnd(g),E.remove()}var T=r.getZWNodeParentsAt(s.getIndex(),NODE_TYPE.SECTION)[0];T.setStyle(d),r.sync(),e.setProcessingTC(!0)}),e.on("unlinkHdrFtr",function(){var e=editor.doc.getTrackChangeDetails();e.setProcessingTC(!1);for(var t,i,n,o,r=editor.getDocument(),a=DocLayoutManager.getCurrentGroup(),s=a.getFirstSection().getNode(),l=DocLayoutManager.getCurrentPage(),d=DocTreeManager.getLastNonMetaSection().end,c={},u=[],p=0;p<HF_SECTIONS.length;p++){t=HF_SECTIONS[p],i=l.getHFSection(t),n=i.getNode(),o=Utils.randomId(t),t==SECTION_TYPES.HEADER?(c.headerIds=s.getHFIds(t),c.headerIds.push(o)):(c.footerIds=s.getHFIds(t),c.footerIds.push(o));var g=DocUtil.getSectionOps(n.getHFType(),d,t,o);u.length&&g.splice(0,1),u=u.concat(g)}var f=DocOpBuilder.compose(DocOpBuilder.build(u),DocOpBuilder.build(Op.getCursor(d+1,d+1)));Op.cursorProcessed(),u=f.toJson(),Op.processMsg(u);var E=r.getZWNodeParentsAt(s.getIndex(),NODE_TYPE.SECTION)[0];E.setStyle(c),r.sync(),e.setProcessingTC(!0)}),e.on("updateFormula",function(t){var i;i=t[2]?t[2]:editor.doc.getSelection().getStart();var n=DocTreeManager.getTreeNodeAtIndex(i);if("cell"==n.parent.type&&n.parent.isContainsFormula()){n=n.parent.getChildrenWithFormula();var o=n.getFormula(),r=editor.doc,a=r.getSelection(),s=r.getParents(NODE_TYPE.AUTOFIELD,o.index+1),l=editor.doc.createRange(s.getStart(),s.getEnd());a.removeAllRanges().addRange(l),a.deleteSelectedContents(),n.viewProperties.fields.containsOldFormula?n.viewProperties.fields.containsOldFormula=!1:n.viewProperties.fields.isMailMergeHTML&&(n.viewProperties.fields.isMailMergeHTML=!1)}e.exec("autofield",t)}),e.on("ignoreWord",function(e){var t=e[0],i=e[1],n={};n[ATTR_TEXT.TS_SP]="Ignore";var o=editor.doc.createElement(NODE_TYPE.TEXT,n);o.setStart(t),o.setEnd(i),o.attr(n)}),e.on("ignoreGrammar",function(e){var t=e[0],i=e[1],n={};n[ATTR_TEXT.TS_GR]="Ignore";var o=editor.doc.createElement(NODE_TYPE.TEXT,n);o.setStart(t),o.setEnd(i),o.attr(n)}),e.on("ignoreWritingQualitySuggestion",function(e){var t=e[0],i=e[1],n=e[2],o={};o[ATTR_TEXT.TS_PROOFING_WQ]=n;var r=editor.doc.createElement(NODE_TYPE.TEXT,o);r.setStart(t),r.setEnd(i),r.attr(o)}),e.on("insertPlaceHolder",function(e){var t=e,i=Utils.randomString(),n=Utils.randomString(),o=Utils.randomString(),r=[{r:editor.doc.getSelection().getStart()},{as:{start:{id:o,type:"placeholder"},id:i}},{is:""},{as:{end:["id","type"],id:i}}],a=[{as:{start:{id:o,type:"placeholder"},id:n}},{is:""},{as:{end:["id","type"],id:n}}],s=t.split(UNICODE.PARA);_.each(s,function(e,t){0!=e.length&&(i=Utils.randomString(),r.push({as:{start:{cls:"placeholder",type:"text"},id:i}}),r.push({is:e}),r.push({as:{end:["cls","type"],id:i}}));var i=Utils.randomString();r.push({as:{start:{type:"paragraph"},id:i}}),r.push({is:UNICODE.PARA}),r.push({as:{end:["type"],id:i}})}),Op.processMsg(r.concat(a))}),e.on("redact",function(){Lock.insertRedact()}),e.on("lock_nonselction",function(e){ZWCollaboration.msgQueue.isAckPending()||(null==e&&(e={},e.allowed_zuids=editor.zuid+","),Lock.lockUnSelection(e))}),e.on("lock",function(e){ZWCollaboration.msgQueue.isAckPending()||(null==e&&(e={},e.allowed_zuids=editor.zuid+","),Lock.lockSelection(e))}),e.on("unlock",function(){ZWCollaboration.msgQueue.isAckPending()||Lock.unlockSelection()}),e.on("ins_random_text",function(e){var t,i,n,o,r,a;if(r=e.text(),a=r.substring(6,r.length-2).split(","),i=parseInt(a[0]||1),t=parseInt(a[1]||0),editor.doc.getSelection().deleteContents(e.getStart(),e.getEnd()-1),randTextArray=[],randTextArray[0]="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce ac massa id dolor porttitor egestas sed laoreet purus. Donec non nisl volutpat, aliquet justo sed, volutpat nisi. Aliquam maximus hendrerit libero vitae consectetur. In rutrum vel ex et maximus. Cras blandit elit suscipit erat dapibus varius. Vestibulum sit amet convallis justo. Aliquam finibus sem ac massa consectetur porttitor. Fusce ullamcorper sapien tincidunt ligula aliquet, vel vulputate sapien malesuada. Nulla dui sapien, hendrerit bibendum justo ut, fermentum fringilla urna. Morbi id odio iaculis, malesuada lectus id, ullamcorper lectus. Nam feugiat, urna in sollicitudin molestie, augue risus scelerisque orci, sed maximus leo augue sed eros. Sed sed neque ut lectus lobortis ultrices. Nam imperdiet massa at ante viverra vehicula. Donec non massa dui. Aliquam hendrerit tellus non dolor fermentum, eget ornare elit faucibus.",randTextArray[1]="Suspendisse aliquet, justo ut egestas luctus, velit nisi convallis diam, ac venenatis justo ipsum sed nisi. Phasellus vestibulum enim a tellus feugiat efficitur. Ut pharetra ante purus. Aliquam sit amet odio vehicula, tempor sapien nec, vulputate mauris. Mauris dictum fringilla posuere. Fusce ut leo quis mi interdum pharetra. Nullam volutpat sapien non hendrerit eleifend.",randTextArray[2]="Donec sagittis nec erat eleifend venenatis. Integer quis lorem sed nulla pretium aliquam. Vestibulum ac dignissim elit, vitae congue est. Vivamus maximus sagittis sapien sed bibendum. Quisque tempor sem nulla, nec vehicula nisl porta quis. Proin vitae dui bibendum, accumsan arcu ut, luctus est. Vivamus non ex elementum, viverra sem lacinia, interdum tortor. Phasellus elementum erat metus, euismod ultrices nulla fringilla ut. In ornare a velit at condimentum.",randTextArray[3]="Donec lacinia ligula orci, iaculis congue velit porttitor vel. Phasellus sollicitudin pulvinar tristique. Donec eget ipsum ipsum. Integer ultrices aliquam porttitor. Aenean laoreet diam in ante gravida facilisis. Nam elementum ante risus, et porttitor nibh condimentum quis. In pellentesque efficitur aliquet. Phasellus at augue ut magna finibus tristique. Nam placerat magna diam, eu ultrices nulla rutrum at. In eu nibh ut lectus laoreet placerat. Etiam purus ipsum, cursus consequat euismod non, vestibulum vitae ligula. Duis feugiat ipsum vel interdum dictum. Suspendisse fermentum odio velit.",randTextArray[4]="Duis vestibulum ex id cursus feugiat. Aenean aliquet aliquet dui, vel venenatis magna feugiat eget. Ut a nisi vehicula, lobortis nisi eu, pulvinar neque. Curabitur scelerisque venenatis aliquet. In ac mattis ipsum. Praesent in mollis orci, a mollis eros. Aliquam volutpat ligula eget ultricies tempus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Curabitur sagittis leo non ultricies viverra. Vestibulum sed risus scelerisque, sodales velit id, malesuada metus.",t>0){var s=[];for(n=0;n<randTextArray.length;n++){if(s=randTextArray[n].split("."),o=s.length,t>o)for(j=o;j<=t;j++)s.push(s[j-o]);else s.splice(t);randTextArray[n]=s.join("."),randTextArray[n]+="."}}var l=[{r:e.getStart()}];for(i>200&&(i=200),n=0;n<i;n++){var d=Utils.randomString(),c=Utils.randomString();l.push({as:{start:{type:NODE_TYPE.TEXT},id:d}},{is:randTextArray[n%5]},{as:{end:["type"],id:d}},{as:{start:{type:NODE_TYPE.PARAGRAPH},id:c}},{is:UNICODE.PARA},{as:{end:["type"],id:c}})}Op.processMsg(l)}),e.on("ins_random_code",function(e){PubSub.publish("Document/Command/Code/InsertRandomCode",e)}),e.on("insautotable",function(t){var i,n,o,r,a,s,l,d,c,u,p,g,f,E=[];g=t[0],f=t[1],s=t[2];var T=editor.doc.getSelection(),m=T.getLastRange();if(m&&m.setStart(g.getStart())&&m.setEnd(g.getStart()),T.deleteContents(g.getStart(),g.getEnd()-1),"rand"==s){f=f.replace("=table(","");var h,I=f.split(",");return h=parseInt(I[0]),i=parseInt(I[1]),h>200&&(h=200),i>20&&(i=20),void e.exec("instable",[h,i,null])}if(i=f.match(/\+/g).length-1,p=f.split("+"),n=DocTreeManager.getTreeNodeAtIndex(g.getStart()),u=editor.doc.getComputedFormatAt(g.getStart(),NODE_TYPE.TEXT,n.getParaStyles()[ATTR_PARAGRAPH.PS_HD]),prop=FontUtils.getFontString(u,n?n.getParaStyles().textFormat:{}),a=FontUtils.getCharSize("+",prop).width,c=p.length,s!=UNICODE.TAB)for(d=0;d<c;d++)p[d]&&(r={},o=FontUtils.getCharSize(p[d],prop),r[ATTR_CELL.TDS_WID]=a+o.width,E.push(r));else for(l=g.getStart(),d=0;d<c;d++)if(p[d]){l++;for(var _=0,A=p[d].length;_<A;_++)u=editor.doc.getRawFormatAt(l+_),r={},r[ATTR_CELL.TDS_WID]=a+u.width,E.push(r);l+=A}e.exec("instable",[1,i,null,E])}),e.on("changeView",function(e){ZWLogger.addToStatistics(e),InsertShape.shapeCache={},InsertShape.clearSelection();var t;"object"==typeof e&&(t=e.view_width,e=e.view);var i=EditorView.getView(),n=EditorView.getViewWidth();if(i!=e||"Web View"!=i||n!=t){if(editor.doc.snapShotManager.setSkipSnapShot(!0),!editor.isNonEditableView()){var o=editor.doc.createElement(NODE_TYPE.BODY),r={};r[ATTR_BODY.DS_VIEW]=e,r[ATTR_BODY.DS_VIEW_WIDTH]=t,editor.doc.execCmd("applyStyle",[o,r,"updateView"])}editor.doc.snapShotManager.setSkipSnapShot(!1)}}),e.on("code",function(e){e=e||[],PubSub.publish("Document/Command/Code/Insert",e[0],e[1])}),e.on("updatecode",function(e){e=e||[],PubSub.publish("Document/Command/Code/Update",e[0],e[1])}),e.on("delcode",function(){PubSub.publish("Document/Command/Code/Delete")}),e.on("changeCodeFontSize",function(e){PubSub.publish("Document/Command/Code/ChangeFontSize",{increaseFontSize:e})}),e.on("uncode",function(e){PubSub.publish("Document/Command/Code/Remove",e)}),e.on("applyLineNumbering",function(){PubSub.publish("Document/Command/Code/ApplyLineNumbering")}),e.on("removeLineNumbering",function(){PubSub.publish("Document/Command/Code/RemoveLineNumbering")}),e.on("removeAutoField",function(e){var t=e[0],i=[{r:t},{ds:UNICODE.RANGE_START+"#"+UNICODE.RANGE_END}];Op.processMsg(i)}),e.on("formatAutoField",function(e){var t=e[0],i=e[1];t.attr(i)}),e.on("movecolumn",function(e){TableActions.moveColumn(e[0],e[1],e[2],e[3],e[4])}),e.on("moverow",function(e){TableActions.moveRow(e[0],e[1],e[2])}),e.on("cropToFit",function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE),t={type:"image"},i=DocUtil.copyStyle(editor.doc.getRawFormatAt(e.getStart()));i.orginalHt&&i.orginalWid||(i.orginalHt=i.ht,i.orginalWid=i.wid);var n=ZWImageUtils.calculateAspectRatio(i.orginalWid,i.orginalHt),o=0,r=0;if(n<0&&(n=ZWImageUtils.calculateAspectRatio(i.orginalHt,i.orginalWid)),i.wid>i.ht){var a=i.ht,s=a*n;s>i.wid&&(s=i.wid,a=s/n)}else{var s=i.wid,a=s/n;a>i.ht&&(a=i.ht,s=a*n)}o=(i.wid-s)/2,r=(i.ht-a)/2;var l=(ZWImageUtils.getOrginalHeighWidthOfImage(i),{cropTop:-r,cropBottom:-r,cropLeft:-o,cropRight:-o});l=ZWImageUtils.convertCropDataToPercentage(l,a,s),t.img_fit="cropFit",t[ATTR_IMAGE.I_CROPRECT]=l,e.attr(t)}),e.on("removeCropOpt",function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE),t=e.attr(),i=ZWImageUtils.getOrginalHeighWidthOfImage(t),n={wid:i.wid,ht:i.ht,wid_un:"px",ht_un:"px",cropRect:{cropTop:"0.000%",cropBottom:"0.000%",cropLeft:"0.000%",cropRight:"0.000%"},type:"image"};e.attr(n)}),e.on("cropToFill",function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE),t={type:"image"};t.img_fit="cropToFill";var i=DocUtil.copyStyle(editor.doc.getRawFormatAt(e.getStart()));i.orginalHt&&i.orginalWid||(i.orginalHt=i.ht,i.orginalWid=i.wid);var n=ZWImageUtils.calculateAspectRatio(i.orginalWid,i.orginalHt),o=0,r=0;if(i.wid>i.ht){var a=i.wid,s=a/n;s<i.ht&&(s=i.ht,a=s*n)}else{var s=i.ht,a=s*n;a<i.wid&&(a=i.wid,s=a/n)}o=(i.wid-a)/2,r=(i.ht-s)/2;var l=(ZWImageUtils.getOrginalHeighWidthOfImage(i),{cropTop:Math.abs(r),cropBottom:Math.abs(r),cropLeft:Math.abs(o),cropRight:Math.abs(o)});l=ZWImageUtils.convertCropDataToPercentage(l,s,a),t[ATTR_IMAGE.I_CROPRECT]=l,e.attr(t)}),e.on("sortRelatedListTable",function(e){var t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.TABLE),n=i.children();ZWLogger.addToStatistics("RLTable sort");for(var o=0,r=n.length;o<r;o++){var a=n[o],s=a.getStart(),l=editor.doc.getRawFormatAt(s);if(l&&l.mminfo){var d={};d.type=l.type,d.format=DocUtil.copyStyle(l.format)||{},d.format[ATTR_TEXT.SORT_INFO]=e;var c=Utils.randomString(),u=ZWJSONUtils.getKeys(d),p=[{r:s},{as:{start:d,id:c}},{r:1},{as:{end:u,id:c}}];Op.processMsg(p)}}Op.sendMsg()}),e.on("updateAutoField",function(e){for(var t=function(t,i,n){var o,r,a,s,l,d,c,u,p,g=[],f=[],E={};if("autodocname"===t){var T=editor.doc.docInfo.DOCUMENT_NAME;l=T.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),"")}else"autoauthor"===t?l=editor.doc.docInfo.CREATOR:"autodocversion"===t?l=editor.doc.docInfo.DOCS_VERSION:t==AUTOFIELD_TYPE.USER_FIRST_NAME?l=editorProps.userInfo.firstName:t==AUTOFIELD_TYPE.USER_LAST_NAME?l=editorProps.userInfo.lastName:t==AUTOFIELD_TYPE.USER_PHONE?l=editorProps.userInfo.phone:t==AUTOFIELD_TYPE.USER_EMAIL&&(l=editorProps.userInfo.email);var m=editor.doc;o=m.getRawFormatAt(i);var h=new RegExp(CONT_REGEXP.AUTOUPDATE_DOC_FIELDS);return o.val&&(o.val=""),e&&h.test(t)?(l="#",o[ATTR_AUTOFIELD.ISAUTO]=1):h.test(t)&&(o[ATTR_AUTOFIELD.ISAUTO]=0),void 0==l||"null"==l?{ops:[],dtParas:[],docNameObj:{}}:(r=m.getRawFormatAt(n),s=m.getRawFormatAt(i+1),a=o.id,p=DocLayoutManager.getLineAtIndex(i).view.getNode(),E[p.id]=l,c=Utils.randomString(),u=[],u.push({r:i}),d=Utils.randomString(),u.push({as:{start:o,id:d}}),u.push({is:UNICODE.RANGE_START}),u.push({as:{end:ZWJSONUtils.getKeys(o),id:d}}),d=Utils.randomString(),u.push({as:{start:s,id:d}}),u.push({is:l}),u.push({as:{end:ZWJSONUtils.getKeys(s),id:d}}),d=Utils.randomString(),u.push({as:{start:r,id:d}}),u.push({is:UNICODE.RANGE_END}),u.push({as:{end:ZWJSONUtils.getKeys(r),id:d}}),g.push(u),f.push(p),{ops:u,dtParas:f,docNameObj:E})},i=function(e,i,n){var o,r=[];o=t(e,i,n),o&&o.ops&&o.ops.length>0&&(r=o.ops,Op.processMsg(r))},n=function(e,t){for(var n;e<t&&(startIndex=DocUtil.getRangeStart(e),!(startIndex<0||startIndex>t))&&(fmt=editor.doc.getRawFormatAt(startIndex)||{},n=DocUtil.getRangeEnd(startIndex),!(n<0));){var o=new RegExp(CONT_REGEXP.AUTOUPDATE_DOC_FIELDS),r=new RegExp(CONT_REGEXP.AUTOFIELD_USER_FIELD);fmt&&"autofield"==fmt.type&&(o.test(fmt.ftype)||r.test(fmt.ftype))&&i(fmt.ftype,startIndex,n),e=n}},o=editor.doc.getSelection(),r=editor.doc.createRange(o.getLastRange().start),a=o.length-1;a>=0;a--){var s,l=o[a],d=l.start;s=o.isCollapsed()?DocUtil.getRangeEnd(d):l.end-1,l.setEnd(s+1),l.deleteContentsInRange(),n(d,s)}o.removeAllRanges(),o.addRange(r)}),e.on("createNamedRange",function(e){var t=editor.doc.getSelection();NamedRange.createRange(t.getStart(),t.getEnd(),e),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}),e.on("modifyNamedRange",function(e){var t=editor.doc.getSelection();NamedRange.modifyRange(t.getStart(),t.getEnd(),e),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}),e.on("textbox",function(e){var t=e&&e[0],i=e&&e[1],n=Utils.randomString(),o=editor.doc.getSelection()[0].start,r=ImagePanel.getDefaultImagePostionJson(t),a="0.098in",s={type:"paragraph"};if(Macros.isPDFDocument()&&(a="0in",s.ls=1),!t){var l=ImageHandler.getTopLeftForIndex(o);t=r,t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=l.top,t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=l.left,t[ATTR_COMMON.BORDERS]={"border-top":{color:"rgb(0,0,0)",width:"1px",type:"dashed",space:"0px"},"border-right":{color:"rgb(0,0,0)",width:"1px",type:"dashed",space:"0px"},"border-left":{color:"rgb(0,0,0)",width:"1px",type:"dashed",space:"0px"},"border-bottom":{color:"rgb(0,0,0)",width:"1px",type:"dashed",space:"0px"}}}t[ATTR_COMMON.TYPE]="image",t[ATTR_COMMON.SUBTYPE]="textbox",t[ATTR_IMAGE.I_WRAP_TYPE]=t[ATTR_IMAGE.I_WRAP_TYPE]||"front",t.z_tb_bgc=t.z_tb_bgc||"rgb(255, 255, 255, 1)",t.pb=t.pb||a,t.pr=t.pr||a,t.pl=t.pl||a,t.pt=t.pt||a,t.id=n,t.op=100,t[ATTR_IMAGE.I_WID]=t[ATTR_IMAGE.I_WID]||173,t[ATTR_IMAGE.I_HT]=t[ATTR_IMAGE.I_HT]||98,t[ATTR_IMAGE.I_HT_UN]="px",t[ATTR_IMAGE.I_WID_UN]="px",i&&(i[ATTR_COMMON.TYPE]="text");var d={};d.imageData=t,d.textData=i,d.paraStyle=s,d.start=o,Op.cursorProcessed(),DocUtil.insertTextbox(d)}),e.on("RemoveRowCondition",function(){ConditionsDlg.removeRowCondition();var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE).nodeCountBefore(e.getParents(NODE_TYPE.ROW));TableVisualCueHandler.constructRowContainer(t,!0),TableVisualCueHandler.bindEvents()}),e.on("InsertSelectedRowsBefore",function(e){if(e)TableActions.insertRowBefore(void 0,e);else{var t=TableUtil.getSelectedRowAndColForInsertion().row;t>1?TableActions.insertRowBefore(void 0,t):TableActions.insertRowBefore()}}),e.on("InsertSelectedRowsAfter",function(e){var t=editor.doc.getSelection();if(e)TableActions.insertRowAfter(t?t.getEndCell():t,e);else{var i=TableUtil.getSelectedRowAndColForInsertion().row;i>1?TableActions.insertRowAfter(t.getEndCell(),i):TableActions.insertRowAfter()}}),e.on("InsertSelectedColumnBefore",function(e){if(e)TableActions.insertColumnBefore(e);else{var t=TableUtil.getSelectedRowAndColForInsertion().column;t>1?TableActions.insertColumnBefore(t):TableActions.insertColumnBefore()}}),e.on("InsertSelectedColumnAfter",function(e){if(e)TableActions.insertColumnAfter(e);else{var t=TableUtil.getSelectedRowAndColForInsertion().column;t>1?TableActions.insertColumnAfter(t):TableActions.insertColumnAfter()}})}(Command),Indentation.init=function(e,t){var i,n=editor.doc.getSelection(),o=n.getNodesInSelection(NODE_TYPE.PARAGRAPH),r=!1,a=0;for(i=0;i<o.length;i++){var s=o[i].attr("*"),l=ListUtils.isList(s);if(!a&&l){var d=s[ATTR_PARAGRAPH.LS_DATA].id;a=DocTreeManager.doc.getSection(n.getStart()).lists[d].length}if(r||l||(r=!0),r&&a)break}"indent"==e?Indentation.indent(t,a,r,o):"outdent"==e&&Indentation.outdent(t,a,r,o)},Indentation.indent=function(e,t,i,n){var o=editor.doc.getBodyFormat().tps;o=Conversions.toGlobalUnit(o);for(var r=editor.doc.getSelection(),a=DocLayoutManager.getContentWidthAtIndex(r.getStart()),s=editor.doc.getHeadingListId(),l=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),d=0;d<n.length;d++){var c=n[d];if(t>0){var u=ListUtils.getListData(c);if(u)if(l.getStart()>DocTreeManager.doc.getSection(r.getStart()).lists[u.id][0].start){var p=c.attr(ATTR_PARAGRAPH.PS_ML);if(p="string"==typeof p?p.convertor().pixels:p,p>=a)return;if(u.l++,u.l>MAX_LIST_LEVELS)return;var s=editor.doc.getHeadingListId();if("undefined"==typeof s||"undefined"!=typeof s&&s!=u.id){if(CheckListOperations&&CheckListOperations.isCheckList(c.attr())&&u.l>=3)return;u.t=editor.doc.getListType(u.id,u.l),ListUtils.indentList(u,c)}else{if(!(u.l<6))return;DocUtil.applyHeadingForSelection(u.l+1)}}else{if(0==u.l){var g,u,f,E,c=n[d],p=c.attr(ATTR_PARAGRAPH.PS_ML);if(p="string"==typeof p?p.convertor().pixels:p,p>=a)return;var p=c.attr(ATTR_PARAGRAPH.PS_ML);if(p="string"==typeof p?p.convertor().pixels:p,"undefined"!=typeof s&&s==u.id?(E="0.5in",E="string"==typeof E?E.convertor().pixels:E,f=p+E):(E="0.25in",E="string"==typeof E?E.convertor().pixels:E,f=p+E),f>=a)return;do{if(u=c.attr(ATTR_PARAGRAPH.LS_DATA),u.t=editor.doc.getListType(u.id,u.l),editor.doc.getSelection().isCollapsed()||!editor.doc.getSelection().isCollapsed()&&0==i?ListUtils.indentList(u,c):!editor.doc.getSelection().isCollapsed()&&c.getStart()<editor.doc.getSelection().getEnd()&&ListUtils.indentList(u,c),d++,g=editor.doc.getParents(NODE_TYPE.PARAGRAPH,DocTreeManager.doc.getTreeNodeAtIndex(c.getEnd()).start),!g)return;for(var T=g.attr("*");!(ListUtils.isList(T)&&T[ATTR_PARAGRAPH.LS_DATA].id==u.id||g.getStart()>DocTreeManager.doc.getSection(editor.doc.getSelection().getStart()).lists[u.id][t-1].start);){if(!editor.doc.getSelection().isCollapsed()&&g.getStart()<editor.doc.getSelection().getEnd()){var m=g.attr(ATTR_PARAGRAPH.PS_TI),a=Conversions.toGlobalUnit(a/96+"in"),h=Conversions.toGlobalUnit("0.25in"),I=g.attr(ATTR_PARAGRAPH.PS_ML);I=void 0==I?"0in":I,I=Conversions.toGlobalUnit(I)+h,I=I>a?a:I;var _={};I&&(I<a||m&&I+Conversions.toGlobalUnit(m)<a)&&(_[ATTR_PARAGRAPH.PS_ML]=I+Conversions.globalUnit,g.attr(_))}g=editor.doc.getParents(NODE_TYPE.PARAGRAPH,DocTreeManager.doc.getTreeNodeAtIndex(g.getEnd()).start)}if(g.getStart()==c.getStart())break;c=g}while(ListUtils.isList(T)&&T[ATTR_PARAGRAPH.LS_DATA].id==u.id);if(d==n.length)break;d--;continue}if(u.l++,u.l>MAX_LIST_LEVELS)return;if("undefined"==typeof s||"undefined"!=typeof s&&s!=u.id)u.t=editor.doc.getListType(u.id,u.l),ListUtils.indentList(u,c);else{if(!(u.l<6))return;DocUtil.applyHeadingForSelection(u.l+1)}}else{var m=c.attr(ATTR_PARAGRAPH.PS_TI);if(1!=n.length||e||"undefined"!=typeof m&&0!=parseFloat(m)){var I=c.attr(ATTR_PARAGRAPH.PS_ML);I=void 0==I?"0in":I;var A=Conversions.toGlobalUnit(a/96+"in"),h=Conversions.toGlobalUnit("0.25in");I=Conversions.toGlobalUnit(I)+h,I=I>A?A:I;var _={};I&&(I<A||m&&I+Conversions.toGlobalUnit(m)<A)&&(_[ATTR_PARAGRAPH.PS_ML]=I+Conversions.globalUnit,c.attr(_))}else{m=o;var S={};S[ATTR_PARAGRAPH.PS_TI]=m+Conversions.globalUnit,c.attr(S)}}}else{var I=Conversions.toGlobalUnit(c.attr(ATTR_PARAGRAPH.PS_ML)),R=Conversions.toGlobalUnit(a/96+"in");I=I?I+o>=R?I:I+o:o;var O={};O[ATTR_PARAGRAPH.PS_ML]=I+Conversions.globalUnit,c.attr(O)}}},Indentation.outdent=function(e,t,i,n){var o=editor.doc.getBodyFormat().tps;o=Conversions.toGlobalUnit(o);for(var r=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),a=0;a<n.length;a++){var s=n[a];if(t>0){var l=ListUtils.getListData(s);if(l&&l.l>=0){var d=editor.doc.getRawFormatAt(r.getStart()-1),c=editor.doc.getRawFormatAt(s.getStart()-1),u=editor.doc.getParents(NODE_TYPE.PARAGRAPH,s.getEnd()+1),p=editor.doc.getHeadingListId();if(0==l.l)if(ListUtils.isList(d)&&ListUtils.isList(c)&&d.ls_data.id==l.id)e&&(l.l--,delete l.t,ListUtils.outdentList(l,s));else{var g=s.attr(ATTR_PARAGRAPH.PS_ML);if(g="string"==typeof g?g.convertor().inches:g,g>.5||"undefined"!=typeof p&&p==l.id&&p>=0&&g>0){var u,l;do{if(l=s.attr(ATTR_PARAGRAPH.LS_DATA),l.t=editor.doc.getListType(l.id,l.l),editor.doc.getSelection().isCollapsed()||!editor.doc.getSelection().isCollapsed()&&0==i?ListUtils.outdentList(l,s):!editor.doc.getSelection().isCollapsed()&&s.getStart()<editor.doc.getSelection().getEnd()&&ListUtils.outdentList(l,s),a++,u=editor.doc.getParents(NODE_TYPE.PARAGRAPH,DocTreeManager.doc.getTreeNodeAtIndex(s.getEnd()).start),!u)return;for(var f=u.attr("*");!(ListUtils.isList(f)&&f[ATTR_PARAGRAPH.LS_DATA].id==l.id||u.getStart()>DocTreeManager.doc.getSection(editor.doc.getSelection().getStart()).lists[l.id][t-1].start);){if(!editor.doc.getSelection().isCollapsed()&&u.getStart()<editor.doc.getSelection().getEnd()){var E,T;E=u.attr(ATTR_PARAGRAPH.PS_TI),T=u.attr(ATTR_PARAGRAPH.PS_ML);var m=Conversions.toGlobalUnit("0.25in");if(!T||T<=m)continue;if(1==n.length&&!e&&E&&0!=parseFloat(E)){E=Conversions.toGlobalUnit(E)-o,E<0&&(E=0);var h={};h[ATTR_PARAGRAPH.PS_TI]=E+Conversions.globalUnit,u.attr(h)}else if(e||0==parseInt(E)||void 0==E||n.length>1){T=u.attr(ATTR_PARAGRAPH.PS_ML);var m=Conversions.toGlobalUnit("0.25in");T=T?Conversions.toGlobalUnit(T)-m:-o,T<0&&(T=0);var I={};I[ATTR_PARAGRAPH.PS_ML]=T+Conversions.globalUnit,u.attr(I)}}u=editor.doc.getParents(NODE_TYPE.PARAGRAPH,DocTreeManager.doc.getTreeNodeAtIndex(u.getEnd()).start)}if(u.getStart()==s.getStart())break;s=u}while(ListUtils.isList(f)&&u.attr(ATTR_PARAGRAPH.LS_DATA).id==l.id);if(a==n.length)break;a--;continue}e&&(l.l--,delete l.t,ListUtils.outdentList(l,s))}else if("undefined"==typeof p||"undefined"!=typeof p&&p!=l.id){if(1==l.l&&!ListUtils.isList(d)&&s!=n[0]&&!ListUtils.isList(c))continue;l.l--,delete l.t,ListUtils.outdentList(l,s)}else{if(l.l--,!(l.l>-1))return;DocUtil.applyHeadingForSelection(l.l+1)}}else{var E,T;E=s.attr(ATTR_PARAGRAPH.PS_TI),T=s.attr(ATTR_PARAGRAPH.PS_ML);var m=Conversions.toGlobalUnit("0.25in");if(!T||T<=m)continue;if(1==n.length&&!e&&E&&0!=parseFloat(E)){E=Conversions.toGlobalUnit(E)-o,E<0&&(E=0);var h={};h[ATTR_PARAGRAPH.PS_TI]=E+Conversions.globalUnit,s.attr(h)}else if(e||0==parseInt(E)||void 0==E||n.length>1){T=s.attr(ATTR_PARAGRAPH.PS_ML);var m=Conversions.toGlobalUnit("0.25in");T=T?Conversions.toGlobalUnit(T)-m:-o,T<0&&(T=0);var I={};I[ATTR_PARAGRAPH.PS_ML]=T+Conversions.globalUnit,s.attr(I)}}}else{T=s.attr(ATTR_PARAGRAPH.PS_ML),T=T?Conversions.toGlobalUnit(T)-o:-o,T<0&&(T=0);var _={};_[ATTR_PARAGRAPH.PS_ML]=T+Conversions.globalUnit,s.attr(_)}}};var FocusLine=function(e){this.id=!1,this.svgContainerDiv=null,this.init=function(){e?this.id=e:this.id=Utils.randomString(),this.make_div()},this.remove=function(){},this.make_div=function(){var e=DomUtil.createElement("div",{id:"focusline-div-"+this.id}),t="http",i=document.createElementNS(t+"://www.w3.org/2000/svg","svg");i.setAttributeNS(t+"://www.w3.org/2000/xmlns/","xmlns:xlink",t+"://www.w3.org/1999/xlink");var n=document.createElementNS(t+"://www.w3.org/2000/svg","defs"),o=document.createElementNS(t+"://www.w3.org/2000/svg","marker"),r=document.createElementNS(t+"://www.w3.org/2000/svg","path"),a=document.createElementNS(t+"://www.w3.org/2000/svg","circle");return i.setAttribute("width","100%"),i.setAttribute("height","100%"),r.setAttribute("id","svg-path-focusline-"+this.id),r.setAttribute("stroke-width",1),r.setAttribute("opacity",1),r.setAttribute("fill","none"),o.setAttribute("id","markerCircle-"+this.id),o.setAttribute("refX","5"),o.setAttribute("refY",this.getRefY()),o.setAttribute("markerUnits","strokeWidth"),o.setAttribute("markerWidth","10"),o.setAttribute("markerHeight","10"),a.setAttribute("id","focusline-marker-start-"+this.id),a.setAttribute("cx",6),a.setAttribute("cy",7),a.setAttribute("r",2.6),a.setAttribute("fill","#FFFFFF"),o.appendChild(a),i.appendChild(n),n.appendChild(o),r.setAttribute("marker-start","url(#markerCircle-"+this.id+")"),i.appendChild(r),e.appendChild(i),e.setAttribute("class","svg-ref-line-div"),document.getElementById("drawcontainer").appendChild(e),this.svgContainerDiv=e,e},this.getRefY=function(){return"mmrepeatvisualcue"==this.id?"7":"5"},this.drawLine=function(e,t,i,n,o){function r(){var t=P-h,n=C-I,o=y-_;e.top=e.top-t,g.top=g.top-t,p.top=p.top-o,i.top=i.top-o,T&&(g.left=g.left-n,p.left=p.left-n,i.left=i.left-n),e.left=e.left-n,F>u?s=p.left-u/2:(s=p.left-5,g.left=s-5);var r=p.top-g.top;r>50?(l=e.top+25,d=p.top-25):r<-50?(l=e.top-25,d=p.top+25):(l=e.top+r/2,d=p.top-r/2);var a="M "+e.left+" "+e.top+" L "+g.left+" "+g.top+" C "+(g.left+1*(s-g.left))+" ";a+=g.top+" "+s+" "+(g.top+1*(l-g.top))+" "+s+" "+l+" L ",a+=s+" "+d+" C "+s+" "+(d+1*(p.top-d))+" "+(s+1*(p.left-s))+" "+p.top+" ",a+=p.left+" "+p.top+" L "+i.left+" "+i.top,L.setAttribute("d",a),e.top<R||e.top>O||i.top<b||i.top>v?L.style.visibility="hidden":L.style.visibility="visible",h=P,I=C,_=y,N=!1}function a(){P=f.scrollTop,C=m.scrollLeft,y=E.scrollTop,N||(N=!0,requestAnimationFrame(r))}this.remove();var s,l,d,c=10,u=50,p={top:i.top,left:i.left-c},g={top:e.top,left:p.left-u},f=document.getElementById(t),E=document.getElementById(n),T=f.contains(E),m=document.getElementById("ui-editor-outer-div"),h=f.scrollTop,I=m.scrollLeft,_=E.scrollTop,A=f.getBoundingClientRect(),S=E.getBoundingClientRect(),R=A.top,O=R+A.height,b=S.top,v=b+S.height,D=document.getElementById("focusline-marker-start-"+this.id),L=document.getElementById("svg-path-focusline-"+this.id),N=!1,P=h,C=I,y=_,F=p.left-e.left;this.remove=function(){f.removeEventListener("scroll",a),E.removeEventListener("scroll",a),L.style.visibility="hidden"},D.setAttribute("stroke",o),L.setAttribute("stroke",o),a(),f.addEventListener("scroll",a),E.addEventListener("scroll",a),f!==m&&m.addEventListener("scroll",a)},this.init()};zw.define("ReviewPopupHandler",[],["FocusLine"],function(e){var t,i={PROOFING:1,TC:2,COMMENT:3},n={POPUP_CONT:"popup-menu-tc-proof-cmnt-container",PROOFING_CONT:"popup-menu-proof-container",TC_CONT:"popup-menu-tc-container",COMMENT_CONT:"popup-menu-cmnt-container"},o={},r=function(){t=new FocusLine("reviewpopup")},a=function(e,i){try{var n=editor.doc.getSelection().getStart(),o=DocLayoutManager.getLineAtIndex(n);if(!o)return;var r=J(DomViewManager.getDOMElem(o)).offset(),a={};a.left=editor.editorPaneContainerOffset.left+CurUtil.offset.start.left*editor.zoomFactor,a.top=r.top;var s=Z(Z(c(e))[0].children[0].id),l=s.offset();l.top=l.top+s.height()/3,t.drawLine(a,"ui-editor-outer-div",l,"ui-editor-outer-div",i)}catch(e){var d=e.stack||e;ZWLogger.log("REVIEWPOPUP DRAW FOCUS LINE THROWS ERROR"+d)}},s=function(){try{t.remove()}catch(t){var e=t.stack||t;ZWLogger.log("REVIEWPOPUP REMOVEFOCUS LINE THROWS ERROR"+e)}},l=function(){var e=Z(n.POPUP_CONT),t=DocLayoutManager.getCurrentSection(),i=(t.getWidth()+t.getRight())*editor.zoomFactor,o=CurUtil.offset.start.top*editor.zoomFactor;DomViewManager.isMultiplePagesInRow()&&(i+=DomViewManager.getCurrentPageLeft()*editor.zoomFactor);var r=editor.editorPaneContainer[0],a=r.offsetWidth-r.clientWidth,s=editor.editorOffset.left+i+e.width()+a;if(o<editor.editorPaneContainerOffset.top&&(o=editor.editorPaneContainerOffset.top),window.innerWidth-s<0){var l=editor.doc.getDomCursorNode(editor.uuid,editor.zuid);i+=window.innerWidth-s,o=(CurUtil.offset.start.top+J(l).height())*editor.zoomFactor}return{top:o,left:i}},d=function(){var e=l();Z(n.POPUP_CONT).css({left:e.left,top:e.top})},c=function(e){var t;switch(e){case i.PROOFING:t=n.PROOFING_CONT;break;case i.TC:t=n.TC_CONT;break;case i.COMMENT:t=n.COMMENT_CONT}return t},u=function(){var e;s();for(var t in o)o.hasOwnProperty(t)&&(!e||e>o[t].type)&&(e=o[t].type);e&&setTimeout(function(){o[e]&&a(e,o[e].color)},300)},p=function(e,t){if(e&&t){for(var i in o)o.hasOwnProperty(i)&&e>o[i].type&&(e=o[i].type,t=o[i].color);s(),setTimeout(function(){a(e,t),PubSub.subscribeOnce("UiEvents/EditorParentOffsetChanged",s)},300)}},g=function(e,t){o[e]={color:t,type:e},Z(c(e)).show(),d(),u(),ZWJSONUtils.isEmptyObject(o)||PubSub.subscribe("UiEvents/EditorParentOffsetChanged",s)},f=function(e){delete o[e],Z(c(e)).hide(),u(),ZWJSONUtils.isEmptyObject(o)&&PubSub.unsubscribe("UiEvents/EditorParentOffsetChanged",s)};return r(),{POPUP_TYPES:i,showPopupCont:g,hidePopupCont:f,drawFocusLine:p,removeFocusLine:s,positionPopup:d}}),zw.define("ReviewPane",[],["PubSub","ReviewUtil"],function(e,t){var i=!1,n="comments",o=function(e,t){if(t&&ModeManager.getCurrentMode()!==EDITOR_MODES.COLLABORATE&&ModeManager.switchMode(EDITOR_MODES.COLLABORATE),i){var n={comments:"#li-comments-tab-header",review:"#li-review-tab-header",proofing:"#proofing-tab-header"},o=n[e],r=!0;Z("review_tab").ztabpanel("openTab",o,r)}},r=function(){ReviewPane.switchTab("review",!0)},a=function(){var e=Z("review_tab").ztabpanel("getAttribute","activeTab");return"li-comments-tab-header"===e.id},s=function(){var e={"li-comments-tab-header":{show:["comments-more-options"],hide:["changes-more-options-btn"]},"li-review-tab-header":{show:["changes-more-options-btn"],hide:["comments-more-options"]}};Z("review_tab").on("ztabpanelswitch",function(t,i){var n=e[i.activeTab.id].show,o=e[i.activeTab.id].hide;n.forEach(function(e){Z(e).show()}),o.forEach(function(e){Z(e).hide()}),"undefined"!=typeof CommentUtils&&CommentUtils.updateFocusLine()})},l=function(){i=!0,UIUtils.initComponent(ELEM_ID.EDITORRIGHTPANEL),J("#review_Rightpane").on("click",ToolbarHandler.handleZButtonClick),J("#tc-user-menu,#tc-view-menu").bind("zselectboxchange",ToolbarHandler.comboChangeHandler),J("#comments-viewmenu-opt").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),J("#review_tab").on("ztabpanelswitch",function(e,t){var i=t.activeTab.getAttribute("id");n="li-review-tab-header"===i?"review":"comments"}),s(),editor.onResize(),editor.getRole().permissions.can("review.comment.view")?ReviewPane.switchTab("comments"):ReviewPane.switchTab("review"),e.publish("Document/ReviewRightPanel/Loaded"),e.subscribe("PositionRightPane/InsideEditor",f),e.subscribe("PositionRightPane/OutsideEditor",E),u(),Macros.isRemote()&&c()},d=function(){return i},c=function(){var e=document.getElementById("editor-rightPanel");e.classList.add("ui-remote-reviewpane")},u=function(){var e={"comments-tb-showcomment":{title:UIUtils.getUIText("INSERT_COMMENT"),content:UIUtils.getUIText("COMMENT_TOOLTIP")}};UIUtils.addHTMLTooltips(e)},p=function(){d()&&(EditorLayout.isRightPaneVisible()?(EditorLayout.hideRightPanel(),e.publish("Reviewpane/closed")):(EditorLayout.showRightPanel(),o(editor.getRole().permissions.can("review.comment.view")?"comments":"review"),e.publish("Reviewpane/opened")),editor.onResize(),g())},g=function(){var e=J("#topband-showhide-rightpane");e.length&&(EditorLayout.isRightPaneVisible()?e.zbutton("setAttribute","text",J.i18n("writer.common.HIDE_SUGGESTIONS")):e.zbutton("setAttribute","text",J.i18n("writer.common.SHOW_SUGGESTIONS")))},f=function(){var e=document.getElementById("editorpane-wrapper"),t=document.getElementById("editorpane"),i=document.getElementById("review-rightpane-container");e.insertBefore(i,t);var n=document.getElementById("review-rightpane-container");n.classList.add("ui-reviewPane-sticky")},E=function(){var e=document.getElementById("document-wrapper"),t=document.getElementById("mainOuterDiv"),i=document.getElementById("review-rightpane-container");e.insertBefore(i,t);var n=document.getElementById("review-rightpane-container");n.classList.remove("ui-reviewPane-sticky")},T=function(){return n};return{switchTab:o,showChanges:r,bindRightPaneEvent:s,initReviewRightPanel:l,isReviewPanelLoaded:d,toggleRightPane:p,updateButtonLabel:g,isCommentsTabActive:a,positionPaneInsideTheEditor:f,positionPaneOutsideTheEditor:E,getCurrentTab:T}}),zw.define("LanguageDetector",[],["PubSub"],function(e){var t,i=function(){Macros.proofing.canDetectLanguage()&&(n()?l():e.subscribe(["Document/AfterContentInsertion","Document/AfterContentDeletion"],a))},n=function(){return editor.doc.getSectionContent(0).length>250},o=function(){return!!t},r=function(){return t},a=function(){n()&&(l(),e.unsubscribe(["Document/AfterContentInsertion","Document/AfterContentDeletion"],a))},s=function(){var e,t,i;return e=editor.doc.getSectionContent(0).substring(0,2e3),t=[UNICODE.IMAGE,UNICODE.BR,UNICODE.RANGE_START,UNICODE.RANGE_END,UNICODE.MULTIBYTE_SPACE,UNICODE.SECTION_START,UNICODE.HR,UNICODE.TOCSTART,UNICODE.TOCEND,UNICODE.MERGEFIELD_START,UNICODE.MERGEFIELD_END],i=[UNICODE.TABLE,UNICODE.ROW,UNICODE.CELL,UNICODE.TABLEEND,UNICODE.PARA,UNICODE.TAB],e=e.replaceAll("["+t.join("|")+"]+",""),e=e.replaceAll("["+i.join("|")+"]+"," "),e=e.replaceAll("[0-9]+","")},l=function(){var i=1,n=new Deferred,o=function(i){"SUCCESS"===i.RESPONSE&&(t="en"===i.LANGUAGE?"en-US":i.LANGUAGE,e.publish("DocumentContent/LanguageDetected",t),n.resolve(t))},r=function(e){i++,i<=3?a():n.reject()},a=function(){var e=s(),t={};t.content=e,J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/proofing/detectlanguage"),data:t,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:r,success:o})};return a(),n},d=function(){var e;return n()?e=l():(e=new Deferred,e.reject()),e};return e.subscribe("Document/ComponentInitialized",i),{init:i,isLanguageDetected:o,getLanguage:r,isSufficientContentAvailable:n,detect:d}});var DocLocaleDlg=function(e){"use strict";var t={},i=[],n="MM/DD/YYYY",o={LANG_MENU:"doclang-langlist",DIALOG:"doclocaledlg",PREVIEW_TIME:"lang-dlg-time",PREVIEW_NUMBER:"lang-dlg-number",PREVIEW_CURRENCY:"lang-dlg-currency"},r={DOC_LANGUAGE:"doclanguage",DATE_FMT:"datefmt"},a={init:function(t){var i=E(),n=J("#"+o.LANG_MENU),r=e.getLanguage();n.zcombobox("addOption",i),c(r),e.isSupportedLanguage(r)||l(),Macros.isGlobalSettingsAvailable()?J("#lang-dlg-nav-tosettings").html(J.i18n("common","TO_SET_AS_GLOBAL_SETTINGS",["<span onclick='DocLocaleDlg.openSettingsLangTab()' class='ui-text-blue ui-mouse-cursor'>","</span>"])):document.getElementById("lang-dlg-nav-tosettings").style.display="none"},set:function(e,i,n){var o=e.action;o===r.DOC_LANGUAGE?(t.language=i,c(i),d()):o===r.DATE_FMT&&(t.datefmt=i,p(t.language,t.datefmt))},get:function(i){var n=i.action;if(n===r.DOC_LANGUAGE)return t.language=e.getLanguage(),t.language;if(n===r.DATE_FMT){t.datefmt=e.getDateFormat();var o=ZWDate.getLocaleSupportedFormats(e.getLanguage());return t.datefmt=o&&o.contains(t.datefmt)?t.datefmt:o[0],t.datefmt}}},s=function(){var i={};t.language&&t.language!=e.getLanguage()&&(i[ATTR_BODY.DS_LANGUAGE]=t.language,ActivityTracker.track("Locale","ChangeLanguage","Doc")),t.datefmt&&t.datefmt!=e.getDateFormat()&&(i[ATTR_BODY.DS_DATEFORMAT]=t.datefmt,ActivityTracker.track("Locale","ChangeDateFmt","Doc")),ZWJSONUtils.isEmptyObject(i)||e.setDocumentProperty(i),f()},l=function(){document.getElementById("doclocale-warnning-msg").style.display="block"},d=function(){document.getElementById("doclocale-warnning-msg").style.display="none"},c=function(i){"locale"===i?J("#doc-datefmtContainer").disable():J("#doc-datefmtContainer").enable();var o=ZWDate.getLocaleSupportedFormats(i);u(i,o);var r=e.getDateFormat();r=o.contains(r)?r:o.contains(n)?n:o[0],J("#doc-datefmt").zselectbox("setValue",r),t.datefmt=r,p(i,r)},u=function(e,t){var i,n,o,r,a=J("#doc-datefmt");a.zselectbox("removeOption");for(var s in t)t.hasOwnProperty(s)&&(i=t[s],o="<div class='clearfix'><span class='ui-fl ui-right-margin-small'>#label#</span><span class='ui-fl zmenu__hint'>(#preview#)</span></span></div>",n={innerHTML:o,replaceWithText:!0,label:i,preview:ZWDate.getLocaleValue(e,i)},r=J(document.createElement("option")),r.attr({data:JSON.stringify(n),value:i}),a.append(r));a.zselectbox("refresh")},p=function(t,i){var n=e.getCurrencyCode(t),r=Formula.getSymbolAndFormat({code:t,currencyCode:n})||{};document.getElementById(o.PREVIEW_TIME).innerHTML=ZWDate.getLocaleValue(t,i),document.getElementById(o.PREVIEW_NUMBER).innerHTML=r.format||"-",document.getElementById(o.PREVIEW_CURRENCY).innerHTML=r.symbol||"-"},g=function(){J.dialogutil.open(o.DIALOG,void 0,a)},f=function(){J.dialogutil.close(o.DIALOG)},E=function(){if(i.length)return i;var t=e.getSupportedLanguages();return U.each(t,function(e){var t=e.countryNameInNativeLang+" - "+e.nativeLangName,n={value:e.code,label:t,contentType:"text",description:e.countryName+" - "+e.name,className:"ui-lang-selectbox"};i.push(n)}),i},T=function(){f(),Settings.showLanguageDlg()};return{apply:s,getLanguageOptions:E,openSettingsLangTab:T,openDialog:g}}(DocLocaleHandler),LanguageUI=function(){"use strict";var e=function(e){if(e=e||DocLocaleHandler.getLanguage(),editor.getRole().permissions.can("document.edit")){var t=DocLocaleHandler.getNativeLanguageName(e);t?Z("bbar-lang-unknown-info").hide():(t=J.i18n("common","LANGUAGE"),Z("bbar-lang-unknown-info").show()),Z("bbar-spellchecklang")[0]&&Z("bbar-spellchecklang").zbutton("changeLabel",t)}};return PubSub.subscribe(["Document/LanguageChanged","Document/ComponentInitialized","Document/EditorReady"],e),{updateLanguageInBottomBar:e}}(),ParaOffset=function(){var e=function(e){return e.getPreviousSplitView()},t=function(e,t,o){for(var r={};t!==n.PAGE;)t===n.INDEX?r.source=DocLayoutManager.getLineAtIndex(e):t===n.LINE?r.source=e.getView():t===n.VIEW?r.source=e.getColumn():t===n.COLUMN?r.source=e.getSection():t===n.SECTION&&(r.source=e.getPage()),t=i(t),r.type=t,r.x=-1,r.y=-1,o[t]=r,e=r.source},i=function(e){return e===n.SECTION?n.PAGE:e===n.COLUMN?n.SECTION:e===n.VIEW?n.COLUMN:e===n.LINE?n.VIEW:e===n.INDEX?n.LINE:n.INDEX},n={PAGE:"page",FOOTNOTE:"footnote",ENDNOTE:"endnote",HEADER:"header",CONTENT:"content",FOOTER:"footer",SECTION:"section",COLUMN:"column",VIEW:"view",PARA:"para",HR:"hr",CELL:"cell",LINE:"line",SEGMENT:"segment",BLOCK:"block",INDEX:"index"},o={page:function(e,t,i,o){for(var r=DocLayoutManager.getFirstPage(),a=Offset.getConfiguredOffset(),s=0;r&&(s=r.getDOMViewHeight(),!(t<s+a.pageGap/2));)t-=s+a.pageGap,r=DocLayoutManager.getNextPage(r);r||(r=DocLayoutManager.getLastPage()),o[n.PAGE]={source:r,x:e,y:t,type:n.PAGE}},section:function(e,t,i,o){var r,a,s,l=i.getHeaderHeight(),d=i.getContentContainerHeight(),c=i.getContentHeight(),u=i.getFooterHeight(),p=i.getEndNoteDOMHeight(),g=Offset.getSectionName();if(g&&(HF_SECTIONS.contains(g)||PAGINATING_SECTIONS.contains(g))){if(g===n.HEADER)r=i.getHeader(),t-=i.getGroup().getHeaderTop();else if(g===n.CONTENT){for(t-=l,a=i.getFirstSection(SECTION_TYPES.CONTENT);a&&(s=a.getHeight(),!(t<s));)a=a.next,a&&(t-=s);r=a,r||(r=i.getLastSection(SECTION_TYPES.CONTENT))}else if(g===n.ENDNOTE){for(t-=l,t-=c,a=i.getFirstSection(SECTION_TYPES.ENDNOTE);a&&(s=a.getHeight(),!(t<s));)a=a.next,a&&(t-=s);r=a,r||(r=i.getLastSection(SECTION_TYPES.ENDNOTE))}else if(g===n.FOOTNOTE){for(t-=l,t-=c,t-=p,a=i.getFirstSection(SECTION_TYPES.FOOTNOTE);a&&(s=a.getHeight(),!(t<s));)a=a.next,a&&(t-=s);r=a,r||(r=i.getLastSection(SECTION_TYPES.FOOTNOTE))}else g===n.FOOTER&&(t-=l,t-=d,r=i.getFooter());e-=r.getLeft(),o[n.SECTION]={source:r,x:e,y:t,type:n.SECTION}}else{if(t<l)return t-=i.getGroup().getHeaderTop(),void(o[n.SECTION]={source:i.getHeader(),x:e-i.getHeader().getLeft(),y:t,type:n.SECTION});for(t-=l,a=i.getFirstSection(SECTION_TYPES.CONTENT);a;){if(s=a.getHeight(),t<s)return void(o[n.SECTION]={source:a,x:e-a.getLeft(),y:t,type:n.SECTION});t-=s,a=a.next}t<u&&(o[n.SECTION]={source:i.getFooter(),x:e-i.getFooter().getLeft(),y:t,type:n.SECTION})}},column:function(e,t,i,o){for(var r=i.getFirstColumn();r&&!(e<r.getWidth())&&r.next;)r=r.next,e-=r&&r.getLeft()||0;o[n.COLUMN]={source:r,x:e,y:t,type:n.COLUMN}},view:function(i,r,a,s){if(a.getChildViewsLength())for(var l=a.getFirstChild(),d=0;l;){if(d=l.getHeight(),r<d||l.type===n.CELL){if(l.type===n.PARA)break;if(l.type===n.HR){l=l.prev,r+=l.getHeight();break}if(l.type===n.CELL){for(;l;){if(i<l.left||i>l.left&&i<l.left+l.width||!l.next){var c=l.borders,u=l.getNode().cellPadding,p=0,g=0,f=0,E=0;c&&(p=c.left+c.missedLeft||0,g=c.top+c.missedTop||0),u&&(f=u.left||0,E=u.top||0),i-=p+f,r-=g+E;break}l=l.next}i-=l.left}return o.view(i,r,l,s)}if(!l.next){if(l.type===n.PARA)break;if(l.type!==n.HR)return o.view(i,r,l,s);if(l.prev){if(r+=l.getHeight(),l.prev.type!==n.PARA)return ZWLogger.log("Paraview not found previous to HR view"),o.view(i,r,l.prev,s);l=l.prev;break}ZWLogger.log("Para view previous to HR view is not found ....")}l.type!==n.CELL&&(r-=d),l=l.next}else for(var T=e(a);T;){if(T.type===n.CELL&&T.getChildViews()&&T.getChildViewsLength()){var m=T.getLastChild();if(m.type===n.PARA){l=m,r=m.getHeight(),t(m,n.VIEW,s);break}ZWLogger.log("Expected the para view but got "+m.type)}else if(T.type===n.PARA){l=T;break}T=e(T)}i-=l?l.left:0,s[n.VIEW]={source:l||{},x:i,y:r,type:n.VIEW}},line:function(e,t,i,o){var r=!1;if(e<0&&(r=!0),i.type===n.PARA)for(var a,s=0,l=0,d=i.getNodeLinesLength();l<d&&(a=i.nodeLines[l],s=a.outerHeight,!(t<s));l++)t-=s;e-=a?a.left:0;var c=function(e,t){var i=t.view.getNode().getIndex(),n=DocLayoutManager.getContentWidthAtIndex(i);if(e<0||e>n)return!1;var o=t.getView(),r=o.getDTView(),a=r.isRTLPara(),s=r.getListData();return!U.isEmpty(s)&&(a?e>n-(o.getLeft()+t.getLeft()+s.listNumOriginalWidth)&&e<n-(o.getLeft()+t.getLeft()):e<s.listNumOriginalWidth)}(e,a);o.isListSelection=c,o.isLeftMarginClick=r,o[n.LINE]={source:a||{},x:e,y:t,type:n.LINE}},segment:function(e,t,i,o){for(var r,a=i.segments,s=a.length,l=0;l<s&&(r=a[l],!(e<r.left||e>r.left&&e<=r.left+r.width));l++);e-=r?r.left:0,o[n.SEGMENT]={source:r||{},x:e,y:t,type:n.SEGMENT}},block:function(e,t,i,o){var r=i.blocks||[];if(!r.length)return void(o[n.BLOCK]={source:"",x:e,y:t,type:n.BLOCK});var a=function e(t,i){if(1===t.length)return t[0];var n=parseInt(t.length/2),o=t[n];return i>=o.left&&i<=o.left+o.width?o:void(i<o.left?e(t.slice(0,n-1),i):i>o.left+o.width&&e(t.slice(n+1),i))}(r,e);o[n.BLOCK]={source:a,x:e,y:t,type:n.BLOCK}},index:function(e,t,i,o){e+=i.left;var r=DocLayoutManager.getIndexAtLeft(e,i).index;o[n.INDEX]={source:r||0,x:e,y:t,type:n.INDEX}}},r=function(e){return e===n.PAGE?n.SECTION:e===n.SECTION?n.COLUMN:e===n.COLUMN?n.VIEW:e===n.VIEW?n.LINE:e===n.LINE?n.INDEX:n.PAGE},a=function(e,t,i,s,l){if(s||(s=n.INDEX),i===s||i===n.INDEX)return l;var d,c=r(i),u=l[i]&&l[i].source;return o[c](e,t,u,l),d=l[c],a(d.x,d.y,c,s,l),l};return{findTarget:a}}(),FloatImageOffset=function(){var e={PAGE:"page",FOOTNOTE:"footnote",ENDNOTE:"endnote",HEADER:"header",CONTENT:"content",FOOTER:"footer",SECTION:"section",COLUMN:"column",VIEW:"view",PARA:"para",HR:"hr",CELL:"cell",LINE:"line",SEGMENT:"segment",BLOCK:"block",INDEX:"index"},t=function(e,t,i){var n=e.floatImages;if(n){var o,r,a;for(var s in n)if(o=e.getFloatImageById(s),r=o.getAbsTop(),a=o.getAbsLeft(),i>=r&&i<=r+o.getHeight()&&t>=a&&t<=a+o.getWidth())return o}},i={page:function(t,i,n,o){var r=DocLayoutManager.getFirstPage(),a=Offset.getConfiguredOffset(),s=0;if(DocLayoutManager.isPageView()){var l;s=DocLayoutManager.getPageDOMViewHeight(r),l=Math.ceil((i+a.pageGap)/(s+a.pageGap));var d=DocLayoutManager.getPageCount();l=l>d?d:l,l=l<=0?1:l,i-=(l-1)*s+(l-1)*a.pageGap,r=DocLayoutManager.getPageAtPageNumber(l)}else if(EditorView.isFixedView())for(i-=a.pageTopBorder;r&&(s=DocLayoutManager.getPageDOMViewHeight(r),!(i<s)&&r.next);)i-=s,r=r.next;t-=r.getMargin().left,o[e.PAGE]={source:r,x:t,y:i,type:e.PAGE}},section:function(t,i,n,o){var r,a,s,l=n.getHeaderHeight(),d=n.getContentContainerHeight(),c=n.getContentHeight(),u=n.getFooterHeight(),p=n.getPaginationHeight(),g=Offset.getSectionName();if(g&&(HF_SECTIONS.contains(g)||PAGINATING_SECTIONS.contains(g))){if(g===e.HEADER)r=n.getHeader(),i-=n.getGroup().getHeaderTop();else if(g===e.CONTENT){for(i-=l,a=n.getFirstSection(SECTION_TYPES.CONTENT);a&&(s=a.getHeight(),!(i<s));)a=a.next,a&&(i-=s);r=a,r||(r=n.getLastSection(SECTION_TYPES.CONTENT))}else if(g===e.ENDNOTE){for(i-=l,i-=c,a=n.getFirstSection(SECTION_TYPES.ENDNOTE);a&&(s=a.getHeight(),!(i<s));)a=a.next,a&&(i-=s);r=a,r||(r=n.getLastSection(SECTION_TYPES.ENDNOTE))}else if(g===e.FOOTNOTE){for(i-=l,i-=d,a=n.getFirstSection(SECTION_TYPES.FOOTNOTE);a&&(s=a.getHeight(),!(i<s));)a=a.next,a&&(i-=s);r=a,r||(r=n.getLastSection(SECTION_TYPES.FOOTNOTE))}else g===e.FOOTER&&(i-=l,i-=p,r=n.getFooter());t-=r.getLeft(),o[e.SECTION]={source:r,x:t,y:i,type:e.SECTION}}else{if(i<l)return i-=n.getGroup().getHeaderTop(),void(o[e.SECTION]={source:n.getHeader(),x:t-n.getHeader().getLeft(),y:i,type:e.SECTION});for(i-=l,a=n.getFirstSection(SECTION_TYPES.CONTENT);a;){if(s=a.getHeight(),i<s)return void(o[e.SECTION]={source:a,x:t-a.getLeft(),y:i,type:e.SECTION});i-=s,a=a.next}i<u&&(o[e.SECTION]={source:n.getFooter(),x:t-n.getFooter().getLeft(),y:i,type:e.SECTION})}},column:function(i,n,o,r){var a,s=t(o,i,n);s&&(r.isFloatImageClick=!0,r.floatImageInfo=s,a=s.getView().getColumn(),i-=a.left),r[e.COLUMN]={source:a||{},x:i,y:n,type:e.COLUMN}},view:function(i,n,o,r){var a,s=r[e.SECTION],l=t(s.source,s.x,s.y);l&&(r.isFloatImageClick=!0,r.floatImageInfo=l,a=l.getView(),n-=a.top),r[e.VIEW]={source:a||{},x:i,y:n,type:e.VIEW}},line:function(t,i,o,r){var a=!1;t<0&&(a=!0);var s;o.type===e.PARA&&(s=n(t,i,o)[0]);var l;if(s&&(l=DocLayoutManager.getLineAtIndex(s.index+o.getNodeStartIndex())),l){t-=l.left;for(var d=l;d;)i-=d.outerHeight,d=d.prev}r.isLeftMarginClick=a,r[e.LINE]={source:l||{},x:t,y:i,type:e.LINE}},segment:function(t,i,n,o){for(var r,a=n.segments,s=a.length,l=0;l<s&&(r=a[l],!(t<r.left||t>r.left&&t<=r.left+r.width));l++);t-=r?r.left:0,o[e.SEGMENT]={source:r||{},x:t,y:i,type:e.SEGMENT}},block:function(t,i,o,r){var a;if(o){var s,l=r[e.VIEW];l&&l.source&&!U.isEmpty(l.source)&&(s=n(l.x,l.y,l.source)[0]),s&&(a=DocTreeManager.blockAtIndex(s.index+l.source.getNodeStartIndex()))}r[e.BLOCK]={source:a||{},x:t,y:i,type:e.BLOCK}},index:function(t,i,o,r){var a;if(o){var s,l=r[e.VIEW];l&&l.source&&!U.isEmpty(l.source)&&(s=n(l.x,l.y,l.source)[0]),s&&(a=s.index+l.source.getNodeStartIndex())}r[e.INDEX]={source:a||0,x:t,y:i,type:e.INDEX}}},n=function(e,t,i){for(var n,o=i.getFloatImages(),r=o.length,a=[],s=0;s<r;s++)n=o[s],DocUtils.isInFloatImageArea(n,null,{top:t,left:e})&&a.push(n);return a},o=function(t){return t===e.PAGE?e.SECTION:t===e.SECTION?e.COLUMN:t===e.COLUMN?e.VIEW:t===e.VIEW?e.LINE:t===e.LINE?e.INDEX:e.PAGE},r=function(t,n,a,s,l){if(s||(s=e.INDEX),a===s||a===e.INDEX)return l;var d,c=o(a),u=l[a]&&l[a].source;if(c===e.VIEW){var p=l[e.SECTION]&&l[e.SECTION].source.type,g=l[e.PAGE]&&l[e.PAGE].source;g?p===e.HEADER?u=g[p].getHeader():p===e.FOOTER&&(u=g[p].getFooter()):ZWLogger.log("For Header/Footer source need to be from page not from section")}return i[c](t,n,u,l),d=l[c],r(d.x,d.y,c,s,l),l};return{findTarget:r}}(),Offset=function(){var e,t,t,i=function(){return t},n={top:0,left:0,pageGap:0,pageTopBorder:0,pageRightBorder:0,pageBottomBorder:0,pageLeftBorder:0},o={PAGE:"page",FOOTNOTE:"footnote",ENDNOTE:"endnote",HEADER:"header",CONTENT:"content",FOOTER:"footer",SECTION:"section",COLUMN:"column",VIEW:"view",PARA:"para",HR:"hr",CELL:"cell",LINE:"line",SEGMENT:"segment",BLOCK:"block",INDEX:"index"},r={IMAGE:"image",CONTENT:"content"},a=function(){return n},s=function(e){e=e||{},n.top=e.top||0,n.left=e.left||0,n.pageGap=e.pageGap||0,n.pageTopBorder=e.pageTop||0,n.pageRightBorder=e.pageRight||0,n.pageBottomBorder=e.pageBottom||0,n.pageLeftBorder=e.pageLeft||0},l=function(t,i,a,s,l){c();var f=u(r.CONTENT),E=u(r.IMAGE);return p(a),i-=n.top+n.pageTopBorder,t-=n.left+n.pageLeftBorder,g(s)?(f[s.type]=s,ParaOffset.findTarget(t,i,s.type,l,f),FloatImageOffset.findTarget(t,i,s.type,l,E)):(ParaOffset.findTarget(t,i,null,o.INDEX,f),FloatImageOffset.findTarget(t,i,null,o.INDEX,E)),d(f),d(E),e},d=function(t){for(var i=Object.keys(t),n=i.length,o=0;o<n;o++)t[i[o]]instanceof Object&&(t[i[o]]=t[i[o]].source);"image"===t.type&&(t.isFloatImageClick||delete e[t.type])},c=function(){e={}},u=function(t){var i={};return i.type=t,e[t]=i,i},p=function(e){t=e},g=function(e){if(e&&U.isObject(e)&&e.type)for(var t=[o.PAGE,o.HEADER,o.CONTENT,o.FOOTER,o.ENDNOTE,o.FOOTNOTE,o.COLUMN,o.VIEW,o.LINE,o.SEGMENT,o.INDEX],i=t.length,n=0;n<i;n++)if(e.type===t[n])return!0;return!1},f=function(){var e=a();e.top=editor.editorOffset&&editor.editorOffset.top||0,e.left=editor.editorOffset&&editor.editorOffset.left||0,e.pageGap=PAGE.GAP,e.pageTopBorder=0,e.pageBottomBorder=0,e.pageRightBorder=PAGE.RIGHT,e.pageLeftBorder=PAGE.LEFT,s(e)};return PubSub.subscribe("Document/Resize",f),PubSub.subscribe("Document/ScrollEvent",f),{getClosest:l,configureOffset:s,getConfiguredOffset:a,getSectionName:i}}(),ZWBeacon=function(e){"use strict";var t=function(e){setCsrfParam(e);var t=new FormData;for(key in e)t.append(key,e[key]);return t},i=function(){if(docProps.info.SERVICE)switch(docProps.info.SERVICE){case"TeamDrive":return"Workdrive";case"ZohoCRM":return"CRM";case"ZohoWiki":return"Wiki";case"ZohoForms":return"Forms"}return"Writer"},n={error:ZWNetworkUtils.getUtilUrl,stats:Macros.getActivityUrl,track:Macros.getActivityTrackUrl,analytics:Macros.getNewActivityUrl},o=function(e,t,i){return n[e](t,i)},r=function(e){l(o("error"),e)},a=function(e,t,i){l(o("stats",e,t),i)},s=function(e,t){t.service_name||(t.service_name=i()),l(o("track",e,!0),t)},l=function(e,i){navigator.sendBeacon(e,t(i))},d=function(e){e.service_name||(e.service_name=i()),e.editor_type||(e.editor_type=Macros.review.getAccessType()),l(o("analytics"),e)};return{sendErrorLogs:r,sendTrackStats:a,sendActivityTracks:s,sendActivityReport:d}}(window),XFormMap=function(e){"use strict";var t=function(){this.id=Utils.randomString(),this.map={}};return t.prototype.applyOp=function(e){if(!e||!e.length())return e;for(var t in this.map){var i=DocOpBuilder.xform(e,this.map[t]);this.map[t]=DocOpBuilder.concise(i.second)}},t.prototype.disableAutoUpdate=function(){PubSub.unsubscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.enableAutoUpdate=function(){PubSub.subscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.flushOp=function(){this.map={}},t.prototype.getOp=function(e){return this.map[e]},t.prototype.putOp=function(e,t){this.map[t]=e},t.prototype.removeOp=function(e){delete this.map[e]},t}(),XFormStack=function(e){"use strict";var t=function(){this.id=Utils.randomString()};return t.prototype.forEach=Array.prototype.forEach,t.prototype.length=0,t.prototype.pushOp=Array.prototype.push,t.prototype.splice=Array.prototype.splice,t.prototype.applyOp=function(e){if(!e||!e.length())return e;this.forEach(function(t,i,n){var o=DocOpBuilder.xform(e,t);n[i]=DocOpBuilder.concise(o.second)})},t.prototype.disableAutoUpdate=function(){PubSub.unsubscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.enableAutoUpdate=function(){PubSub.subscribe("Document/AfterModelUpdation",this.applyOp,{context:this})},t.prototype.flushOp=function(){this.splice(0)},t.prototype.getOp=function(e){return this[e]},t.prototype.removeOp=function(e){this.splice(e,1)},t}();!function(e){"use strict";e.ZWPoint=function(e,t){this.left=e||0,this.top=t||0},ZWPoint.prototype.clone=function(){return new ZWPoint(this.left,this.top)},ZWPoint.prototype.isEqualPoint=function(e){return e&&this.left===e.left&&this.top===e.top}}(window),function(e){"use strict";e.ZWSize=function(e,t){this.width=e||0,this.height=t||0},ZWSize.prototype.clone=function(){return new ZWSize(this.width,this.height)},ZWSize.prototype.isEqualSize=function(e){return e&&this.width===e.width&&this.height===e.height}}(window),function(e){"use strict";e.ZWRect=function(e,t,i,n){this.origin=new ZWPoint(e,t),this.size=new ZWSize(i,n)},ZWRect.prototype.clone=function(){return new ZWRect(this.left,this.top,this.width,this.height)},ZWRect.prototype.isEqualRect=function(e){return e&&this.origin.isEqualPoint(e.origin)&&this.size.isEqualSize(e.size)},ZWRect.prototype.setOrigin=function(e,t){this.origin.left=e||0,this.origin.top=t||0},ZWRect.prototype.setSize=function(e,t){this.size.width=e||0,this.size.height=t||0},Object.defineProperties(ZWRect.prototype,{left:{get:function(){return this.origin.left}},top:{get:function(){return this.origin.top}},width:{get:function(){return this.size.width}},height:{get:function(){return this.size.height}},right:{get:function(){return this.origin.left+this.size.width}},bottom:{get:function(){return this.origin.top+this.size.height}}})}(window),function(e){"use strict";var t=function(e){var t=e.toString(16);return(1==t.length?"0":"")+t};e.ZWColor=function(e,t,i,n){this.identifier="",this.red=Math.max(isNaN(e)?0:e,0),this.green=Math.max(isNaN(t)?0:t,0),this.blue=Math.max(isNaN(i)?0:i,0),this.alpha=Math.min(1,Math.max(isNaN(n)?1:n,0))},ZWColor.BLACK=new ZWColor(0,0,0),ZWColor.BLUE=new ZWColor(0,0,255),ZWColor.GREEN=new ZWColor(0,255,0),ZWColor.RED=new ZWColor(255,0,0),ZWColor.WHITE=new ZWColor(255,255,255),ZWColor.prototype.getHEX=function(){return"#"+t(this.red)+t(this.green)+t(this.blue)},ZWColor.prototype.getRGB=function(){return"rgb("+this.red+","+this.green+","+this.blue+")"},ZWColor.prototype.getRGBA=function(){return"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")"},ZWColor.prototype.toString=function(){return this.identifier?this.identifier:0===this.alpha?"tranparent":1===this.alpha?this.getRGB():this.getRGBA()}}(window),function(e){"use strict";e.ZWBorder=function(){this.width="0px",this.type="solid",this.color=new ZWColor,this.space="0px"},ZWBorder.ZERO_BORDER=new ZWBorder}(window);var ZWLinkedList=function(){"use strict";var e=function(){this.firstItem=null,this.lastItem=null,this.items={}},t=e.prototype;Object.defineProperties(t,{length:{get:function(){return Object.keys(this.items).length}}}),t.getItemById=function(e){return this.items[e]},t.insertItemAfter=function(e,t){if(!t||!this.items[t._.itemId])throw new TypeError(t+" is not in this linkedlist !!");if("object"!=typeof e)throw new TypeError(e+" is not an object !!");return this.items.hasOwnProperty(e._.itemId)&&i.call(this,e),e._.itemId=e._.itemId||Math.random(),e._.previousItem=null,e._.nextItem=null,t._.nextItem?(t._.nextItem._.previousItem=e,e._.nextItem=t._.nextItem,t._.nextItem=e):(this.lastItem=e,t._.nextItem=e),e._.nextItem==e&&(e._.nextItem=null),e._.previousItem=t,this.items[e._.itemId]=e,this},t.insertItemBefore=function(e,t){if(!t||!this.items[t._.itemId])throw new TypeError(t+" is not in this linkedlist !!");if("object"!=typeof e)throw new TypeError(e+" is not an object !!");return this.items.hasOwnProperty(e._.itemId)&&i.call(this,e),e._.itemId=e._.itemId||Math.random(),e._.previousItem=null,e._.nextItem=null,t._.previousItem?(t._.previousItem._.nextItem=e,e._.previousItem=t._.previousItem,t._.previousItem=e):(this.firstItem=e,t._.previousItem=e),e._.previousItem==e&&(e._.previousItem=null),e._.nextItem=t,this.items[e._.itemId]=e,this},t.addItem=function(e){if("object"!=typeof e)throw new TypeError(e+" is not an object !!");if(e._.itemId=e._.itemId||Math.random(),e._.previousItem=null,e._.nextItem=null,this.isEmpty())this.firstItem=e,this.lastItem=e,this.items[e._.itemId]=e;else if(e.type==NODE_TYPE.SECTION&&e.isBody())this.insertItemBefore(e,this.firstItem);else{var t=n.call(this,e);NODE_TYPE.PARAGRAPH==t.type&&t.start<=e.start&&t.end>=e.end||t.start>=e.start&&t.end<=e.end&&NODE_TYPE.PARAGRAPH!==e.type||t.start>=e.start&&t.end>=e.end?this.insertItemBefore(e,t):this.insertItemAfter(e,t)}return this};var i=function(e){e._.previousItem&&(e._.previousItem._.nextItem=e._.nextItem),e._.nextItem&&(e._.nextItem._.previousItem=e._.previousItem),delete this.items[e._.itemId]},n=function(e){for(var t=this.firstItem;t;){if(t.start>=e.start&&e.type!=NODE_TYPE.PARAGRAPH&&t.end<=e.end&&t.end>0)return t;if(t._.nextItem&&t._.nextItem.start>=e.start&&t._.nextItem.end>e.end)return t;t=t._.nextItem}return this.lastItem};return t.removeItem=function(e){var t=e._.itemId;e&&this.items.hasOwnProperty(t)&&(e._.previousItem?e._.nextItem?(e._.previousItem._.nextItem=e._.nextItem,e._.nextItem._.previousItem=e._.previousItem):(this.lastItem=this.lastItem._.previousItem,this.lastItem._.nextItem=null):e._.nextItem?(this.firstItem=this.firstItem._.nextItem,this.firstItem._.previousItem=null):(this.firstItem=null,this.lastItem=null),delete this.items[t],e=null)},t.forEach=function(e){if(!this.isEmpty()){for(var t=this.firstItem;t;)e(t),t=t._.nextItem;return this}},t.isEmpty=function(e){return!Object.keys(this.items).length},e}(),EXECCMD={BOLD:"bold",ITALIC:"italic",STRIKE_THROUGH:"line-through",SUBSCRIPT:"sub",SUPERSCRIPT:"super",UNDERLINE:"underline",INSERT_NAMED_RANGE:"InsertNamedRange",REMOVEREPEATHEADER:"RemoveRepeatHeader",REPEATHEADER:"RepeatHeader",TABLE_INSERT:"table_insert",TABLE_DELETE:"table_delete",TABLE_INSERT_ROW_BEFORE:"table_insert_row_before",TABLE_INSERT_ROW_AFTER:"table_insert_row_after",TABLE_DELROW:"table_delete_row",TABLE_INSERT_COLUMN_BEFORE:"table_insert_column_before",TABLE_INSERT_COLUMN_AFTER:"table_insert_column_after",TABLE_DELCOLUMN:"table_delete_column",CHANGE_CASE:"change_case",INSERT_DYNAMIC_CHART:"insert_dynamic_chart"},FIELD_TYPE={AUTHER_NAME:"autoauthor",AUTO:"autofield",AUTO_DATE:"autodate",AUTO_FORMULA:"autoformula",AUTO_PAGECOUNT:"autopcnt",AUTO_PAGENUMBER:"autopno",BOOKMARK:"bookmark",COMMENT:"comment",CREATED_DATE:"createddate",DOCUMENT_NAME:"autodocname",DOCUMENT_VERSION:"autodocversion",ENDNOTE:"endnote",FILLABLE:"fillablefield",FOOTNOTE:"footnote",LINK:"link",LAST_MODIFIED_DATE:"lastmodifieddate",MERGE:"mergeField",NAMED_RANGE:"namedrange",NEXT:"nextrecord",PLACEHOLDER:"placeholder",REPEAT_MERGE:"repeat_start",SIGN:"signerfield"},FILLABLEFIELD_TYPE={CHECKBOX:"checkbox",CURRENCY:"currency",DATE:"date",EMAIL:"email",IMAGE:"image",INITIAL:"initial",NUMBER:"number",PHONE:"phone",PERCENT:"percent",SIGNATURE:"signature",SELECTBOX:"selectbox",SINGLELINE:"singleline",MULTILINE:"multiline",MULTIPLECHOICE:"multiplechoice",RADIO:"radio"},TEXT_STYLE={1:1,2:2,3:3,4:4,5:5,6:6,7:7},PARAGRAPH_STYLE={H0:"h0",H1:"h1",H2:"h2",H3:"h3",H4:"h4",H5:"h5",H6:"h6",H7:"h7",H8:"h8",H9:"h9",H101:"h101",H102:"h102",H103:"h103",H104:"h104",H105:"h105",H106:"h106"},TEXT_CASE={UPPER_CASE:"upper",LOWER_CASE:"lower",SMALL_CAPS:"small-caps",SENTENCE_CASE:"sentenceCase",CAPITALIZE_WORD:"capitalizeWord"},SIGNERFIELD_TYPE={SIGNATURE:"signature",INITIAL:"initial",COMPANY:"company",DATE:"date",JOB_TITLE:"jobTitle",FIRST_NAME:"firstName",LAST_NAME:"lastName",FULL_NAME:"fullName",EMAIL:"email",TEXTBOX:"textbox",CHECKBOX:"checkbox",CUSTOMDATE:"customdate",DROPDOWN:"dropdown",ATTACHMENT:"attachment",RADIO:"radio",STAMP:"stamp",IMAGE:"image"},SIGN_TYPE={ESIGN:"esign",DIGISIGN:"digisign"},LINK_TYPE={BOOKMARK:2,MAILTO:3,MMFIELD:5,WEBURL:1,ZWDOC:4},CHART_TYPE={AREA:"XYAREA",BAR:"BAR",COLUMN:"COL",LINE:"XYLINE",PIE:"PIE"},PAGE_ORIENTATION={PORTRAIT:"Portrait",LANDSCAPE:"Landscape"},SECTION_TYPE={CONTENT:"content",HEADER:"header",FOOTER:"footer"},PAGE_SIZE={A3:"A3",A4:"A4",A5:"A5",B4:"B4",B5:"B5",CUSTOM:"Custom",ENVELOPE_DL:"Envelope_10",EXECUTIVE:"Executive",FOLIO:"Folio",LEGAL:"Legal",LETTER:"Letter",STATEMENT:"Statement",TABLOID:"Tabloid"},PAGE_DIMENSION={A3:new ZWSize(11.69,16.54),A4:new ZWSize(8.27,11.69),A5:new ZWSize(5.83,8.27),B4:new ZWSize(10.12,14.33),B5:new ZWSize(7.17,10.12),Envelope_10:new ZWSize(4.13,9.5),Executive:new ZWSize(7.25,10.5),Folio:new ZWSize(8,13),Legal:new ZWSize(8.5,14),Letter:new ZWSize(8.5,11),Statement:new ZWSize(5.5,8.5),Tabloid:new ZWSize(11,17)},STYLE_TYPE={TEXT:"char",PARAGRAPH:"para"},allowedHdrFtrRegex={header:new RegExp("^["+CONST.HEADER_EVEN+CONST.HEADER_PRIMARY+CONST.HEADER_FIRST+"]$"),footer:new RegExp("^["+CONST.FOOTER_EVEN+CONST.FOOTER_PRIMARY+CONST.FOOTER_FIRST+"]$")},HDR_FTR_REGEX={0:new RegExp("^["+CONST.HEADER_PRIMARY+CONST.FOOTER_PRIMARY+"]$"),1:new RegExp("^["+CONST.HEADER_FIRST+CONST.FOOTER_FIRST+CONST.HEADER_PRIMARY+CONST.FOOTER_PRIMARY+"]$"),2:new RegExp("^["+CONST.HEADER_EVEN+CONST.FOOTER_EVEN+CONST.HEADER_PRIMARY+CONST.FOOTER_PRIMARY+"]$"),3:new RegExp("^["+CONST.HEADER_FIRST+CONST.FOOTER_FIRST+CONST.HEADER_EVEN+CONST.FOOTER_EVEN+CONST.HEADER_PRIMARY+CONST.FOOTER_PRIMARY+"]$")},STYLE_KEYS_MAP={};STYLE_KEYS_MAP[NODE_TYPE.TEXT]={color:ATTR_TEXT.TS_FGC,fontFamily:ATTR_TEXT.TS_FF,fontSize:ATTR_TEXT.TS_SIZE,fontStyle:ATTR_TEXT.TS_FS,fontWeight:ATTR_TEXT.TS_FW,highlightColor:ATTR_TEXT.TS_BGC,letterSpacing:ATTR_TEXT.TS_CS,textDecoration:ATTR_TEXT.TS_TD,cls:ATTR_COMMON.CLS,verticalAlign:ATTR_TEXT.TS_VA},STYLE_KEYS_MAP[NODE_TYPE.IMAGE]={alignment:ATTR_IMAGE.I_AL,altText:ATTR_IMAGE.I_ALT,cropRect:ATTR_IMAGE.I_CROPRECT,height:ATTR_IMAGE.I_HT,id:ATTR_COMMON.ID,left:ATTR_IMAGE.I_LEFT,linkData:ATTR_IMAGE.I_LINKDATA,mminfo:MAILMERGE.MMINFO,marginBottom:ATTR_IMAGE.I_MB,marginLeft:ATTR_IMAGE.I_ML,marginRight:ATTR_IMAGE.I_MR,marginTop:ATTR_IMAGE.I_MT,opacity:ATTR_IMAGE.I_OP,originalHeight:ATTR_IMAGE.I_ORGINALHT,originalWidth:ATTR_IMAGE.I_ORGINALWID,rotation:ATTR_IMAGE.I_ROTATE,shapeData:ATTR_IMAGE.I_SHAPEDATA,src:ATTR_IMAGE.I_SRC,subType:ATTR_WIDGET.SUBTYPE,tooltip:ATTR_IMAGE.I_TOOLTIP,top:ATTR_IMAGE.I_TOP,width:ATTR_IMAGE.I_WID,fitType:ATTR_IMAGE.I_FITTYPE,zoom:ATTR_IMAGE.I_IMGSIZE,wrapType:ATTR_IMAGE.I_WRAP_TYPE,positionV:ATTR_IMAGE.I_V_POSITION,positionH:ATTR_IMAGE.I_H_POSITION,widthUnit:ATTR_IMAGE.I_WID_UN,heightUnit:ATTR_IMAGE.I_HT_UN,img_fit:"imgFit"},ZWJSONUtils.cloneAndExtend(STYLE_KEYS_MAP[NODE_TYPE.SHAPE]={},STYLE_KEYS_MAP[NODE_TYPE.IMAGE]),ZWJSONUtils.cloneAndExtend(STYLE_KEYS_MAP[NODE_TYPE.BARCODE]={mminfo:MAILMERGE.MMINFO,barcode_info:ATTR_IMAGE.BARCODE_INFO},STYLE_KEYS_MAP[NODE_TYPE.IMAGE]),ZWJSONUtils.cloneAndExtend(STYLE_KEYS_MAP[NODE_TYPE.QRCODE]={mminfo:MAILMERGE.MMINFO,qrcode_info:ATTR_IMAGE.QRCODE_INFO},STYLE_KEYS_MAP[NODE_TYPE.IMAGE]),ZWJSONUtils.cloneAndExtend(STYLE_KEYS_MAP[NODE_TYPE.CHART]={chartId:ATTR_CHART.CHART_ID,sheetId:ATTR_CHART.SHEET_ID,chartType:ATTR_CHART.CHART_TYPE},STYLE_KEYS_MAP[NODE_TYPE.IMAGE]),ZWJSONUtils.cloneAndExtend(STYLE_KEYS_MAP[NODE_TYPE.WIDGET]={thumbnail:ATTR_WIDGET.THUMBNAIL,widgetSrc:ATTR_WIDGET.SRC},STYLE_KEYS_MAP[NODE_TYPE.IMAGE]),STYLE_KEYS_MAP[NODE_TYPE.PARAGRAPH]={alignment:ATTR_PARAGRAPH.PS_AL,direction:ATTR_PARAGRAPH.PS_DIR,headingType:ATTR_PARAGRAPH.PS_HD,leftIndent:ATTR_PARAGRAPH.PS_ML,lineSpacing:ATTR_PARAGRAPH.PS_LS,rightIndent:ATTR_PARAGRAPH.PS_MR,spaceAfter:ATTR_PARAGRAPH.PS_SA,spaceBefore:ATTR_PARAGRAPH.PS_SB},STYLE_KEYS_MAP[NODE_TYPE.TABLE]={alignment:ATTR_TABLE.TBLS_AL,autoFitToPage:"autoFitToPage",borders:ATTR_COMMON.BORDERS,columnsWidth:ATTR_TABLE.TBLS_COLS,leftIndent:ATTR_TABLE.TBLS_ML,subType:ATTR_TABLE.TBLS_SUBTYPE,tableDirection:ATTR_TABLE.TBLS_DIR,tableHeader:ATTR_TABLE.TBLS_THEADER,width:ATTR_TABLE.TBLS_WID,backgroundColor:ATTR_TABLE.TBLS_TBL_BGC,backgroundImage:ATTR_TABLE.TBLS_BGIMG},STYLE_KEYS_MAP[NODE_TYPE.CELL]={backgroundColor:ATTR_CELL.Z_TD_BGC,backgroundImage:ATTR_CELL.TDS_BGIMG,backgroundImageName:ATTR_CELL.TDS_BGIMG_NAME,cellBorders:ATTR_COMMON.BORDERS,cellColSpan:ATTR_CELL.TDS_CSPAN,cellHeight:ATTR_CELL.TDS_HT,cellMerge:ATTR_CELL.TDS_MRG,cellRowSpan:ATTR_CELL.TDS_RSPAN,cellTextAlign:ATTR_CELL.TDS_TXTAL,cellVerticalAlign:ATTR_CELL.TDS_VA,cellWidth:ATTR_CELL.TDS_WID,paddingLeft:ATTR_CELL.TDS_PL,paddingRight:ATTR_CELL.TDS_PR,paddingTop:ATTR_CELL.TDS_PT,paddingBottom:ATTR_CELL.TDS_PB,verticalAlign:ATTR_CELL.TDS_VA,textAlign:ATTR_CELL.TDS_TXTAL,borders:ATTR_CELL.TDS_BORDERS},STYLE_KEYS_MAP[NODE_TYPE.ROW]={rowHeight:ATTR_ROW.TRS_HT,rowHeightRule:ATTR_ROW.TRS_HTRULE},STYLE_KEYS_MAP[NODE_TYPE.HR]={alignment:ATTR_HR.HR_AL,cls:ATTR_COMMON.CLS},STYLE_KEYS_MAP[NODE_TYPE.BODY]={},STYLE_KEYS_MAP[NODE_TYPE.TAB]={},STYLE_KEYS_MAP[NODE_TYPE.BR]={},STYLE_KEYS_MAP[NODE_TYPE.FIELD_START]={},STYLE_KEYS_MAP[NODE_TYPE.FIELD_END]={},ZWJSONUtils.cloneAndExtend(STYLE_KEYS_MAP[NODE_TYPE.TEXTBOX]={},STYLE_KEYS_MAP[NODE_TYPE.IMAGE]);var ZWUtils=function(){"use strict";var e=function(e,t){switch(e.type){case NODE_TYPE.PARAGRAPH:return t.type===NODE_TYPE.BR||t.type===NODE_TYPE.TAB||t.type===NODE_TYPE.TEXT||t.type===NODE_TYPE.FIELD_START||t.type===NODE_TYPE.FIELD_END||t.type===NODE_TYPE.IMAGE||t.type===NODE_TYPE.CHART||t.type===NODE_TYPE.WIDGET||t.type===NODE_TYPE.QRCODE||t.type===NODE_TYPE.BARCODE||t.type===NODE_TYPE.SHAPE;case NODE_TYPE.ROW:return t.type===NODE_TYPE.CELL;case NODE_TYPE.TABLE:return t.type===NODE_TYPE.ROW||t.type===NODE_TYPE.TABLEEND;case NODE_TYPE.CELL:case NODE_TYPE.SECTION:return t.type===NODE_TYPE.PARAGRAPH||t.type===NODE_TYPE.TABLE||t.type===NODE_TYPE.HR||t.type===NODE_TYPE.TOC;case NODE_TYPE.TOC:return t.type===NODE_TYPE.PARAGRAPH||t.type===NODE_TYPE.TOCEND;default:return 0}},t=function(e,t){if(e.type===t.type)return 1;switch(e.type){case NODE_TYPE.BR:case NODE_TYPE.TAB:case NODE_TYPE.TEXT:case NODE_TYPE.IMAGE:case NODE_TYPE.CHART:case NODE_TYPE.QRCODE:case NODE_TYPE.BARCODE:case NODE_TYPE.SHAPE:case NODE_TYPE.TEXTBOX:case NODE_TYPE.FIELD_START:case NODE_TYPE.FIELD_END:return t.type===NODE_TYPE.BR||t.type===NODE_TYPE.TAB||t.type===NODE_TYPE.TEXT||t.type===NODE_TYPE.IMAGE||t.type===NODE_TYPE.CHART||t.type===NODE_TYPE.WIDGET||t.type===NODE_TYPE.QRCODE||t.type===NODE_TYPE.BARCODE||t.type===NODE_TYPE.SHAPE||t.type===NODE_TYPE.TEXTBOX||t.type===NODE_TYPE.FIELD_START||t.type===NODE_TYPE.FIELD_END;case NODE_TYPE.TOC:case NODE_TYPE.HR:case NODE_TYPE.PARAGRAPH:case NODE_TYPE.TABLE:return t.type===NODE_TYPE.TOC||t.type===NODE_TYPE.PARAGRAPH||t.type===NODE_TYPE.TABLE||t.type===NODE_TYPE.HR||t.type===NODE_TYPE.SECTION;case NODE_TYPE.ROW:case NODE_TYPE.TABLEEND:return t.type===NODE_TYPE.TABLEEND||t.type===NODE_TYPE.ROW;default:return 0}},i=function(e){if("string"!=typeof e)return e;var t,i=e||"";return ZWColor.apply(t=new ZWColor,i.replace(/[rgba()]/g,"").split(",")),t},n=function(){return ZWDate.getDateString.apply(null,arguments)},o=function(){return"undefined"!=typeof DocLocaleHandler?DocLocaleHandler.getLanguageDetails(DocLocaleHandler.getLanguage())||{}:{}},r=function(e,t){return"undefined"!=typeof ZWDateTime?new ZWDateTime(e||(new Date).getTime(),null,t||"en-US"):null},a=function(e){return"undefined"==typeof MailMergeFieldUtil?"#":(e=e||{},e[MAILMERGE.TYPE]==MAILMERGE.FIELD_TYPE.CHECKBOX?UNICODE.MERGEFIELD_START+MAILMERGE.CHECK_BOX.UNCHECKED+UNICODE.MERGEFIELD_END:MailMergeFieldUtil.getFullMergeFieldName(e))},s=function(e){for(var t=e._.dtNodeId,i=!t&&e.previousSibling;i&&!(t=i._.dtNodeId);)i=i.previousSibling;for(i=!t&&e.nextSibling;i&&!(t=i._.dtNodeId);)i=i.nextSibling;if(t)for(var n,o=this._.dtDoc.getAllSections(),r=0,a=o.length;r<a;r++){if(n=o[r],n.id===t)return n;if(n.nodes.hasOwnProperty(t))return n.nodes[t]}},l=function(e){if(!this._.dtDoc)return null;var t=this._.dtDoc.getTreeNodeAtIndex(e);if(!t||!t.children.length||t.type!==NODE_TYPE.PARA||t.getEndIndex()===e)return t;t=t.getFirstChild();do if(t.getIndex()<=e&&e<=t.getEndIndex())break;while(t=t.getNextSibling());return t},d=function(e){return ZWUtils.isDTNode(e)?new ZRange(e.getIndex(),e.getEndIndex()+1):ZWUtils.isZWNode(e)?new ZRange(e.start,e.end):void 0},c=function(e){var t=editor.getDocument().createRange();return ZWUtils.isDTNode(e)&&(t.start=e.getIndex(),t.end=e.getEndIndex()+1),ZWUtils.isZWNode(e)&&(t.start=e.start,t.end=e.end),t},u=function(){var e={};if(this.type===NODE_TYPE.PARAGRAPH){for(var t=this.getLastChild();t&&(t.type!==NODE_TYPE.TEXT||t.isTab());)t=t.getPreviousSibling();t?e=DocUtil.copyStyle(t.style._.op):(e=DocUtil.copyStyle(this.style._.op[ATTR_PARAGRAPH.PS_TS]),this.style._.op[ATTR_PARAGRAPH.PS_HD]&&(e[ATTR_PARAGRAPH.PS_HD]=this.style._.op[ATTR_PARAGRAPH.PS_HD]))}else{for(var i=this.getPreviousSibling();i&&(i.type!==NODE_TYPE.TEXT||i.isTab());)i=i.getPreviousSibling();if(i)e=DocUtil.copyStyle(i.style._.op);else{var n=this.getParent();n&&n.type===NODE_TYPE.PARAGRAPH&&(e=DocUtil.copyStyle(n.style._.op[ATTR_PARAGRAPH.PS_TS]),n.style._.op[ATTR_PARAGRAPH.PS_HD]&&(e[ATTR_PARAGRAPH.PS_HD]=n.style._.op[ATTR_PARAGRAPH.PS_HD]))}}return delete e[ATTR_COMMON.CLS],delete e[ATTR_COMMON.FIELDINFO],delete e[ATTR_PARAGRAPH.PS_TS],delete e[ATTR_COMMON.ST],delete e[TCConstants.TC],e},p=function(e){var t;switch(t=e.type){case NODE_TYPE.TEXT:return"";case NODE_TYPE.TOC:return UNICODE.TOCSTART;case NODE_TYPE.FIELD_START:return UNICODE.RANGE_START;case NODE_TYPE.FIELD_END:return UNICODE.RANGE_END;case NODE_TYPE.IMAGE:case NODE_TYPE.SHAPE:case NODE_TYPE.CHART:case NODE_TYPE.WIDGET:return UNICODE.IMAGE;case NODE_TYPE.SECTION:return UNICODE.SECTION_START;default:return t&&UNICODE[t.toUpperCase()]}},g=function(e){if(e&&e._&&e._.doc)return e;var t=e&&T.call(this,e.id);return!t&&e&&(t=this.createZWNode(e)),t},f=function(e){return this._.dtDoc?g.call(this,l.call(this,e)):E(this._.zwNodesList.firstItem,e)},E=function(e,t){for(;e;){if(e.start<=t&&t<e.end)return e.hasChildNodes()&&e.start!=t&&NODE_TYPE.PARAGRAPH!==e.type?E(e._.nextItem,t):e;e=e._.nextItem}},T=function(e){return this._.dtNodes2zwNodesMap[e]},m=function(e){return e&&("undefined"!=typeof DTNode&&e instanceof DTNode||"undefined"!=typeof DTSection&&e instanceof DTSection)},h=function(e){return e&&"undefined"!=typeof ZWNode&&e instanceof ZWNode},I=function(e){if(e&&(e.type==NODE_TYPE.ENDNOTE||e.type==NODE_TYPE.FOOTNOTE)){var t=e.getDocument().getAllSections();t.map(function(t){t.style._.op[ATTR_SECTION.ST]==e.type&&t.style._.op[ATTR_SECTION.SID]==e.id&&t.remove()})}},_=function(e){if(e&&e.length){var t=editor.getDocument(),i=t.getSelection();i.removeAllRanges();for(var n=0,o=e.length;n<o;n++){var r=e[n],a=t.getNamedRangeById(r.id),s=t.createRange();s.start=a.start,s.end=a.end,i.addRange(s)}}},A=function(e){var t=new ZRange(e.start,e.end),i=new ZRange,n=[{r:t.end},{is:Array(t.length).join(".")}],o=DocOpBuilder.build(n);o.zuid="00000";var r=DocOpBuilder.xform(this._.composedDocOps,o).second,a=DocOpBuilder.concise(r);return i.start=e.start,i.end=a.docOps[0].retain_count,i};return{canAppend:e,canBeSibling:t,getColor:i,getDateString:n,getLocaleDetails:o,getMomentInstance:r,getMergeFieldName:a,getDTNode:s,getDTNodeAt:l,getNodeRange:d,getDocRange:c,getTextFormat:u,getUnicodeChar:p,getZWNode:g,getZWNodeAt:f,getZWNodeById:T,isDTNode:m,isZWNode:h,deleteNoteSection:I,updateSelectionWithNamedRanges:_,getComposedRange:A}}();!function(e){"use strict";function t(e){this._={op:{},refNode:e};var t=e.type;switch(t){case NODE_TYPE.TABLE:this._.op[ATTR_TABLE.TBLS_VER]="4.0",this._.op[ATTR_TABLE.TBLS_THEME]={},this._.op[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEMENAME]="theme1",this._.op[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT]={tblPr:{cell:{borders:{"border-top":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-left":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-bottom":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-right":{type:"solid",width:"1px",color:"rgb(0,0,0)"}}}}};break;case NODE_TYPE.ROW:this._.op[ATTR_ROW.TRS_HT]="auto";break;case NODE_TYPE.TAB:this._.op[ATTR_COMMON.ST]=t,t=NODE_TYPE.TEXT;break;case NODE_TYPE.FIELD_START:case NODE_TYPE.FIELD_END:t=e.subType;break;case NODE_TYPE.CHART:case NODE_TYPE.BARCODE:case NODE_TYPE.QRCODE:case NODE_TYPE.SHAPE:case NODE_TYPE.WIDGET:t=NODE_TYPE.IMAGE}this._.op.type=t}var i=function(e,t){return"function"==typeof e&&new(e.bind.apply(e,[e].concat(t||[])))},n={fields:{},nodes:{},nodeFormats:{},styles:{}};e.ZWFactory=n,Object.defineProperties(t.prototype,{rawFormat:{get:function(){var e;return ZWJSONUtils.cloneAndExtend(e={},this.style?this.style._.op:this._.op),e}}});var o=function(){var e,t,i,o,r={ZWTextFormat:NODE_TYPE.TEXT,ZWImageFormat:NODE_TYPE.IMAGE,ZWParagraphFormat:NODE_TYPE.PARAGRAPH,ZWTableFormat:NODE_TYPE.TABLE,ZWTableEndFormat:NODE_TYPE.TABLEEND,ZWCellFormat:NODE_TYPE.CELL,ZWRowFormat:NODE_TYPE.ROW,ZWTOCFormat:NODE_TYPE.TOC,ZWTOCEndFormat:NODE_TYPE.TOCEND,ZWHRFormat:NODE_TYPE.HR,ZWBRFormat:NODE_TYPE.BR,ZWTabFormat:NODE_TYPE.TAB,ZWFieldStartFormat:NODE_TYPE.FIELD_START,ZWFieldEndFormat:NODE_TYPE.FIELD_END,ZWSectionFormat:NODE_TYPE.SECTION,ZWShapeFormat:NODE_TYPE.SHAPE,ZWChartFormat:NODE_TYPE.CHART,ZWBarcodeFormat:NODE_TYPE.BARCODE,ZWQRCodeFormat:NODE_TYPE.QRCODE,ZWWidgetFormat:NODE_TYPE.WIDGET,ZWTextBoxFormat:NODE_TYPE.TEXTBOX};for(e in r){t=r[e],o=STYLE_KEYS_MAP[t]||{},n.nodeFormats[t]=new Function("return function "+e+"(aZWRefNode, ZWNodeFormat){ ZWNodeFormat.call(this, aZWRefNode); };")();for(i in o)!function(e,t,i){Object.defineProperty(e.prototype,t,{get:function(){return this._.refNode.getFormat(i)},set:function(e){this._.refNode.setFormat(i,e)}})}(n.nodeFormats[t],i,o[i])}};n.createField=function(e,t){var o,r=0;if(!(o=n.fields[e]))return null;r++,o.hasOwnProperty(t)&&(o=o[t]);var a=Array.prototype.slice.call(arguments).slice(r);return i(o,a)},n.createNode=function(e,t){var o=Array.prototype.slice.call(arguments),r=i(n.nodes[e],o.slice(1));if(r){switch(r.style=n.createNodeFormat(r.type=e,r),e){case NODE_TYPE.CHART:r.type=NODE_TYPE.IMAGE,r.style._.op.subType=ATTR_CHART.CHART,r._.responseHandler=o[1];break;case NODE_TYPE.SHAPE:r.type=NODE_TYPE.IMAGE,r.style._.op[ATTR_IMAGE.I_AL]="behind",r.style._.op[ATTR_IMAGE.I_SHAPEDATA]=t||{};break;case NODE_TYPE.WIDGET:r.type=NODE_TYPE.IMAGE,r.style._.op.subType=NODE_TYPE.WIDGET,r.style._.op[ATTR_WIDGET.THUMBNAIL]=!1,r.style._.op[ATTR_WIDGET.SRC]="",t&&t.hasOwnProperty(ATTR_WIDGET.SHEET_INFO)&&(r.style._.op[ATTR_WIDGET.SHEET_INFO]=t[ATTR_WIDGET.SHEET_INFO]);break;case NODE_TYPE.COMMENT:var a=o[2];r.style._.op.id=a;break;case NODE_TYPE.BARCODE:r.type=NODE_TYPE.IMAGE,r.style._.op.subType=NODE_TYPE.BARCODE;break;case NODE_TYPE.QRCODE:r.type=NODE_TYPE.IMAGE,r.style._.op.subType=NODE_TYPE.QRCODE;break;case NODE_TYPE.FIELD_START:case NODE_TYPE.FIELD_END:if(o[1]==NODE_TYPE.COMMENT){var a=o[2];r.style._.op.id=a}}return r}},n.createNodeFormat=function(e,i){return Object.keys(n.nodeFormats).length||o(),new n.nodeFormats[e](i,t)}}(window),function(e){"use strict";e.ZWTextStyle=function(e){e=e||{},ZWJSONUtils.cloneAndExtend(this._={},e)},ZWFactory.styles[STYLE_TYPE.TEXT]=ZWTextStyle}(window),function(e){"use strict";e.ZWParagraphStyle=function(e){e=e||{},ZWJSONUtils.cloneAndExtend(this._={},e),this._.textFormat=new ZWFactory.styles[STYLE_TYPE.TEXT](e.textFormat)},ZWFactory.styles[STYLE_TYPE.PARAGRAPH]=ZWParagraphStyle,ZWParagraphStyle.prototype.getTextStyle=function(){return this._.textFormat}}(window),function(e){"use strict";e.ZWStyles=function(e){var t,i,n,o,r={};r[STYLE_TYPE.TEXT]=TEXT_STYLE,r[STYLE_TYPE.PARAGRAPH]=PARAGRAPH_STYLE;for(t in r){this[t]={},i=r[t];for(n in i)o=i[n],this[t][o]=new ZWFactory.styles[t](e[t][o])}},ZWStyles.prototype.getCharacterStyles=function(){return this[STYLE_TYPE.TEXT]},ZWStyles.prototype.getParagraphStyles=function(){return this[STYLE_TYPE.PARAGRAPH]}}(window),function(e){"use strict";function t(e,t,i){if(i=parseFloat(i),!(i<4||22<i)){e._[t]=i+UNITS.INCHES;var n=parseFloat(e._[ATTR_BODY.DS_PW]),o=parseFloat(e._[ATTR_BODY.DS_PH]);e._[ATTR_BODY.DS_OR]=n<o?PAGE_ORIENTATION.PORTRAIT:PAGE_ORIENTATION.LANDSCAPE;var r,a,s;for(s in PAGE_DIMENSION)if(r=PAGE_DIMENSION[s].width,a=PAGE_DIMENSION[s].height,e._[ATTR_BODY.DS_OR]===PAGE_ORIENTATION.PORTRAIT){if(r===n&&a===o)return void(e._[ATTR_BODY.DS_PS]=s)}else if(a===n&&r===o)return void(e._[ATTR_BODY.DS_PS]=s);e.setPageSize(PAGE_SIZE.CUSTOM)}}e.ZWPageSetup=function(){this._={}},ZWPageSetup.prototype.getPageHeight=function(){return this._[ATTR_BODY.DS_PH]},ZWPageSetup.prototype.getPageOrientation=function(){return this._[ATTR_BODY.DS_OR]},ZWPageSetup.prototype.getPageSize=function(){return this._[ATTR_BODY.DS_PS]},ZWPageSetup.prototype.getPageWidth=function(){return this._[ATTR_BODY.DS_PW]},ZWPageSetup.prototype.setPageHeight=function(e){t(this,ATTR_BODY.DS_PH,e)},ZWPageSetup.prototype.setPageOrientation=function(e){var t,i,n,o;for(t in PAGE_ORIENTATION)if((i=PAGE_ORIENTATION[t])===e){this._[ATTR_BODY.DS_OR]=i;var n=parseFloat(this._[ATTR_BODY.DS_PW]),o=parseFloat(this._[ATTR_BODY.DS_PH]),r=Math.min(n,o)+UNITS.INCHES,a=Math.max(n,o)+UNITS.INCHES;return this._[ATTR_BODY.DS_PW]=i===PAGE_ORIENTATION.PORTRAIT?r:a,void(this._[ATTR_BODY.DS_PH]=i===PAGE_ORIENTATION.PORTRAIT?a:r)}},ZWPageSetup.prototype.setPageSize=function(e){if(e===PAGE_SIZE.CUSTOM)return void(this._[ATTR_BODY.DS_PS]=e);var t,i,n,o;for(t in PAGE_SIZE)if((o=PAGE_SIZE[t])===e)return this._[ATTR_BODY.DS_PS]=o,i=PAGE_DIMENSION[o].width,n=PAGE_DIMENSION[o].height,this.setPageWidth(this._[ATTR_BODY.DS_OR]===PAGE_ORIENTATION.PORTRAIT?i:n),void this.setPageHeight(this._[ATTR_BODY.DS_OR]===PAGE_ORIENTATION.PORTRAIT?n:i)},ZWPageSetup.prototype.setPageWidth=function(e){t(this,ATTR_BODY.DS_PW,e)}}(window),function(e){"use strict";var t=new RegExp(FIELD_TYPE.ENDNOTE+"|"+FIELD_TYPE.FOOTNOTE+"|"+FIELD_TYPE.LINK+"|"+FIELD_TYPE.BOOKMARK),i=function(e,t){var i=t?this.getEndNode():this.getStartNode();if(i.type===NODE_TYPE.PARAGRAPH)i.append(e);else if(i.type===NODE_TYPE.TEXT){var n=Math.abs((t?this.end:this.start)-i.start);0===n?i.insertBefore(e):n>0&&(n!==i.length&&i.splitAt(n),i.insertAfter(e))}else i.insertBefore(e)},n=function(e,t){var n=this.getStartNode();if(this.length)i.call(this,t,!0),i.call(this,e);else switch(n.type){case NODE_TYPE.PARAGRAPH:n.append(t),t.insertBefore(e);break;default:n.insertBefore(t),t.insertBefore(e)}},o=function(e){var t=this.getDocument(),i={};i[ATTR_AUTOFIELD.FIELDTYPE]=NODE_TYPE.REPEAT_START,i[MAILMERGE.MMINFO]=e||{},i[ATTR_COMMON.ID]=Utils.randomString();var n=t.createNode(NODE_TYPE.FIELD_START,NODE_TYPE.REPEAT_START),o=t.createNode(NODE_TYPE.FIELD_END,NODE_TYPE.REPEAT_END);return ZWJSONUtils.cloneAndExtend(n.style._.op,i),o.style._.op.id=n.style._.op.id,o.style._.op[ATTR_AUTOFIELD.FIELDTYPE]=NODE_TYPE.REPEAT_END,{start:n,end:o}};e.ZWDocRange=function(e,t){ZRange.call(this,e,t),this._={}},ZWDocRange.prototype=Object.create(ZRange.prototype),ZWDocRange.prototype.constructor=ZWDocRange,ZWDocRange.prototype.clone=function(){var e=this.getDocument().createRange();return e.start=this.start,e.end=this.end,e},ZWDocRange.prototype.createComment=function(e){var t=this.getDocument(),i=t.createComment(e),o=t.createNode(NODE_TYPE.FIELD_START,NODE_TYPE.COMMENT,e),r=t.createNode(NODE_TYPE.FIELD_END,NODE_TYPE.COMMENT,e);return ZWJSONUtils.cloneAndExtend(o.style._.op,i),r.style._.op.id=o.style._.op.id,n.call(this,o,r),this},ZWDocRange.prototype.createNamedRange=function(e,t){if(!this.length)return this;var n=this.getDocument(),o=n.createNamedRange(e,t),r=n.createNode(NODE_TYPE.FIELD_START,NODE_TYPE.NAMED_RANGE),a=n.createNode(NODE_TYPE.FIELD_END,NODE_TYPE.NAMED_RANGE);return ZWJSONUtils.cloneAndExtend(r.style._.op,o),a.style._.op.id=r.style._.op.id,i.call(this,a,!0),i.call(this,r),this},ZWDocRange.prototype.createPlaceholderField=function(){if(!this.length)return this;var e=this.getDocument(),t=e.createNode(NODE_TYPE.FIELD_START,NODE_TYPE.PLACEHOLDER),n=e.createNode(NODE_TYPE.FIELD_END,NODE_TYPE.PLACEHOLDER),o=t;for(ZWJSONUtils.cloneAndExtend(t.style._.op,{id:Utils.randomString()}),n.style._.op.id=t.style._.op.id,i.call(this,n,!0),i.call(this,t);(o=o.getNextSibling())&&o.type!==NODE_TYPE.FIELD_END;)o.type==NODE_TYPE.TEXT&&(o.style[ATTR_COMMON.CLS]=NODE_TYPE.PLACEHOLDER);return this},ZWDocRange.prototype.createRepeatRange=function(e){if(!this.length)return this;var t=o.call(this,e),n=t.start,r=t.end;return i.call(this,r,!0),i.call(this,n),this},ZWDocRange.prototype.filterNodes=function(e){var t=[];return this.visitNodes({handleNodeStart:function(i){e(i)&&t.push(i)},handleNodeEnd:function(i){!t.contains(i)&&e(i)&&t.push(i)}}),t},ZWDocRange.prototype.getDocument=function(){return this._.doc},ZWDocRange.prototype.getEndNode=function(){var e=ZWUtils.getDTNodeAt.call(this.getDocument(),this.end);return e?ZWUtils.getZWNode.call(this.getDocument(),e):ZWUtils.getZWNodeAt.call(this.getDocument(),this.end)},ZWDocRange.prototype.getEndNodeParents=function(e){return this.getDocument().getZWNodeParentsAt(this.end,e)},ZWDocRange.prototype.getNodes=function(){var e,t=new RegExp("^("+NODE_TYPE.TABLE+"|"+NODE_TYPE.ROW+"|"+NODE_TYPE.CELL+"|"+NODE_TYPE.HR+"|"+NODE_TYPE.TOC+")$"),i=function(t){t.type!=NODE_TYPE.PARAGRAPH&&e.push(t)},n=function(i){!t.test(i.type)&&e.push(i)};return function(){return e=[],this.visitNodes({handleNodeStart:i,handleNodeEnd:n}),e}}(),ZWDocRange.prototype.getStartNode=function(){var e=ZWUtils.getDTNodeAt.call(this.getDocument(),this.start);return e?ZWUtils.getZWNode.call(this.getDocument(),e):ZWUtils.getZWNodeAt.call(this.getDocument(),this.start)},ZWDocRange.prototype.getStartNodeParents=function(e){return this.getDocument().getZWNodeParentsAt(this.start,e)},ZWDocRange.prototype.insertField=function(e,n){if(!e||t.test(e.type))return this;var o,a,s,l,d,c,u;if((o=e.isAutoField())||(a=e.isFillableField())||(s=e.isSignerField())||(l=e.isNextRecordField())||(c=e.isPlaceholderField())||(u=e.isRepeatRange())||(d=e.isMailmergeField())){if(u)return r.call(this,e,n);var p,g=this.getDocument(),f=n?this.getEndNode():this.getStartNode(),E=(Math.abs((n?this.end:this.start)-f.start),o?FIELD_TYPE.AUTO:a?FIELD_TYPE.FILLABLE:u?FIELD_TYPE.MERGE:e.type),T=o?e.getAutoFieldResult():a&&e.getFillableFieldResult()||s&&Utils.getSignFieldContent(e)||(l||u)&&"#"||c&&e.getPlaceholderText()||d&&ZWUtils.getMergeFieldName(e._.op[MAILMERGE.MMINFO]),m=a?e.getFillableFieldType():null,h=s?e.getSignFieldType():"",I=g.createNode(NODE_TYPE.FIELD_START,E),_=g.createNode(NODE_TYPE.FIELD_END,E);if(a&&(" "===T||T===e.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CURRENCY_SYMBOL])&&e._.op.name&&(T=e._.op.name),m===FILLABLEFIELD_TYPE.CHECKBOX)p=g.createNode(NODE_TYPE.TEXT,T);else if(!s||e._.op[ATTR_SIGNERFIELD.SIGNTYPE]!==SIGN_TYPE.ESIGN||h!==SIGNERFIELD_TYPE.SIGNATURE&&h!==SIGNERFIELD_TYPE.INITIAL){p=g.createNode(NODE_TYPE.TEXT,T);var A=ZWUtils.getTextFormat.call(f);s&&delete A[ATTR_TEXT.TS_FV],A&&(p.style._.op=A,p.style._.op[ATTR_COMMON.TYPE]=NODE_TYPE.TEXT)}else p=g.createNode(NODE_TYPE.IMAGE),p.style[ATTR_IMAGE.I_SRC]=e._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SRC],p.style.width=(e._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SIZE].width||(h===SIGNERFIELD_TYPE.SIGNATURE?"300":"50"))+"px",p.style.height=(e._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SIZE].height||"50")+"px";return m!==FILLABLEFIELD_TYPE.RADIO&&m!==FILLABLEFIELD_TYPE.MULTIPLECHOICE||(p.style.fontFamily=RENDERING_FONTS.CHECKBOXES_AND_RADIO_FIELDS),ZWJSONUtils.cloneAndExtend(I.style._.op,e._.op),p.style._.op[ATTR_COMMON.CLS]=o?e._.op[ATTR_AUTOFIELD.FIELDTYPE]==FIELD_TYPE.CREATED_DATE||e._.op[ATTR_AUTOFIELD.FIELDTYPE]==FIELD_TYPE.LAST_MODIFIED_DATE?AUTOFIELD_TYPE.AUTO_DATE:e._.op[ATTR_AUTOFIELD.FIELDTYPE]:l?FIELD_TYPE.NEXT:e.type,!c&&(p.style._.op[ATTR_COMMON.FIELDINFO]=e.id),_.style._.op.id=e.id,(l||d)&&(_.style._.op[ATTR_AUTOFIELD.FIELDTYPE]=e._.op[ATTR_AUTOFIELD.FIELDTYPE]),i.call(this,I),I.insertAfter(p),p.insertAfter(_),this}},ZWDocRange.prototype.insertNode=function(e,t){if(!e)return this;var i=t?this.getEndNode():this.getStartNode();switch(e.type){case NODE_TYPE.TEXT:case NODE_TYPE.IMAGE:switch(i.type){case NODE_TYPE.PARAGRAPH:i.append(e);break;case NODE_TYPE.TEXT:var n=Math.abs((t?this.end:this.start)-i.start);0===n?i.insertBefore(e):n>0&&(n!==i.length&&i.splitAt(n),i.insertAfter(e));break;default:i.insertBefore(e)}break;case NODE_TYPE.TABLE:var o,r=new RegExp(NODE_TYPE.TABLE+"|"+NODE_TYPE.TOC+"|"+NODE_TYPE.HR);switch(i.type){case NODE_TYPE.SECTION:i.prepend(e),o=this.getDocument().createNode(NODE_TYPE.PARAGRAPH,""),e.insertBefore(o);break;case NODE_TYPE.PARAGRAPH:var a=i.getNextSibling();(i.getParent().getLastChild()==i||a&&r.test(a.type))&&(o=this.getDocument().createNode(NODE_TYPE.PARAGRAPH,"")),i.insertAfter(e),o&&e.insertAfter(o);break;case NODE_TYPE.TABLE:case NODE_TYPE.TOC:o=this.getDocument().createNode(NODE_TYPE.PARAGRAPH,""),i.insertBefore(o),o.insertBefore(e);break;default:var s=i.getParent(),n=Math.abs((t?this.end:this.start)-s.start);o=s.splitAt(n),o.insertBefore(e)}}return this};var r=function(e,t){for(var i,n,r,a,s=e._.mergeFields||[],l=t?this.getEndNode():this.getStartNode(),d=l.type==NODE_TYPE.PARAGRAPH?l.getNextSibling():l.getParent().getNextSibling(),c=0,u=s.length;c<u;c++){if(a=s[c],a.type==NODE_TYPE.PARAGRAPH&&r&&r.type!==NODE_TYPE.PARAGRAPH){var p=r.getParent();p.getLastChild()!=r&&(d=p.splitAt(r.end-p.start))}var g,f,E;if(a.type==NODE_TYPE.MAILMERGEFIELD){var T=this.getDocument(),m=a.type,h=ZWUtils.getMergeFieldName(a._.op[MAILMERGE.MMINFO]);g=T.createNode(NODE_TYPE.FIELD_START,m),f=T.createNode(NODE_TYPE.FIELD_END,m),E=T.createNode(NODE_TYPE.TEXT,h);var I=ZWUtils.getTextFormat.call(l);I&&(E.style._.op=I,E.style._.op[ATTR_COMMON.TYPE]=NODE_TYPE.TEXT),ZWJSONUtils.cloneAndExtend(g.style._.op,a._.op),E.style._.op[ATTR_COMMON.CLS]=a.type,E.style._.op[ATTR_COMMON.FIELDINFO]=a.id,f.style._.op.id=a.id,f.style._.op[ATTR_AUTOFIELD.FIELDTYPE]=a._.op[ATTR_AUTOFIELD.FIELDTYPE]}else g=a;if(0==c)if(i=g,l.type===NODE_TYPE.PARAGRAPH)l.append(g);else if(l.type===NODE_TYPE.TEXT){var _=Math.abs((t?this.end:this.start)-l.start);0===_?l.insertBefore(g):_>0&&(_!==l.length&&l.splitAt(_),l.insertAfter(g))}else l.insertBefore(g);else g.type==NODE_TYPE.PARAGRAPH?r.type==NODE_TYPE.PARAGRAPH?r.insertAfter(g):r.getParent().insertAfter(g):r.type==NODE_TYPE.PARAGRAPH&&(r=d)?r.getFirstChild()?r.getFirstChild().insertBefore(g):r.append(g):r&&r.insertAfter(g);a.type==NODE_TYPE.MAILMERGEFIELD&&(g.insertAfter(E),E.insertAfter(f)),r=a.type==NODE_TYPE.MAILMERGEFIELD?f:g,c==u-1&&(n=r.type==NODE_TYPE.PARAGRAPH?r.getLastChild():r)}if(i&&n){var A=o.call(this,e._.op[MAILMERGE.MMINFO]);n.insertAfter(A.end),i.insertBefore(A.start)}return this};ZWDocRange.prototype.setEnd=function(e,t){return this.end=e.start+(isNaN(t)?e.length:Math.abs(t)),this},ZWDocRange.prototype.setStart=function(e,t){return this.start=e.start+(isNaN(t)?0:Math.abs(t)),this},ZWDocRange.prototype.splitText=function(){var e=this.getStartNode();if(!e||e.type!==NODE_TYPE.TEXT)return this;var t=e.splitAt(this.start-e.start);return this.length&&this.end!==e.end?(e=t&&t.start<=this.end&&t.end>this.end?t:this.getEndNode(),e&&e.type===NODE_TYPE.TEXT?(e.splitAt(this.end-e.start),this):this):this},ZWDocRange.prototype.visitNodes=function(){var e,t=new RegExp("^("+NODE_TYPE.HR+"|"+NODE_TYPE.PARA+"|"+NODE_TYPE.PARAGRAPH+")$"),i=!0,n=function(t){if(!i){var n=ZWUtils.getComposedRange.call(t.getDocument(),new ZRange(e.start,e.end));t.end=n.end}},o=function(e,r,a){if(!e)return 0;var s=ZWUtils.getNodeRange(e);if(s.start>=r.end)return 0;do{var l=e&&e.type!==NODE_TYPE.SECTION&&e.getNextSibling();!i&&e.isInlineNode()&&e.end==r.start&&(s.end-=1);var d=e.hasChildNodes()||t.test(e.type);if(d){var c=new ZRange(s.start);if(r.end===c.start)return 0;if(r.containsRange(c)&&(a.handleNodeStart(ZWUtils.getZWNode.call(r.getDocument(),e)),n(r)),!o(e.getFirstChild(),r,a)&&!d)return 0;if(e.type===NODE_TYPE.SECTION)return 0;s.end>r.start&&r.containsRange(new ZRange(s.end))&&e.type!=NODE_TYPE.HR&&(a.handleNodeEnd(ZWUtils.getZWNode.call(r.getDocument(),e)),n(r))}else if(r.overlapsRangeAtStart(s)||r.containsRange(s)||r.end-1>=s.start&&r.end-1<=s.end){for(var u=ZWUtils.getZWNode.call(r.getDocument(),e);e&&u&&u.end<=r.start;)(u=u.getNextSibling())&&e.getEndIndex()<u.end-1&&(e=e.getNextSibling(),l=e&&e.type!==NODE_TYPE.SECTION&&e.getNextSibling());if(!i&&u&&u.end<=r.end&&u.start>=r.start?(a.handleNodeStart(u),n(r)):i&&u&&a.handleNodeStart(u),u&&u._.splitOffset)do(u=u.getNextSibling())&&u._.isSplitNode&&u.end<=r.end&&(a.handleNodeStart(u),n(r));while(u&&!u._.isOrphan&&u._.splitOffset&&e&&e.getEndIndex()>=u.end)}}while(e&&(e=l)&&(s=ZWUtils.getNodeRange(e)));return 1};return function(t){if(t&&t.handleNodeStart&&t.handleNodeEnd){var n,r=this.getDocument();for(n=r._.dtDoc&&r.getCharAt(this.start)===UNICODE.SECTION_START?ZWUtils.getZWNode.call(r,DocTreeManager.getTreeNodeAtIndex(this.start+UNICODE.SECTION_START.length).parent):ZWUtils[r._.dtDoc?"getDTNodeAt":"getZWNodeAt"].call(r,this.start);n&&n.type!==NODE_TYPE.SECTION&&!(n.getIndex()<=this.start&&this.end<=ZWUtils.getNodeRange(n).end);)n=n.getParent();r._.dtDoc||(i=!1),e=new ZRange(this.start,this.end),o(n,this,t)}}}(),ZWDocRange.prototype.isCollapsed=function(){return this.start===this.end}}(window),function(e){"use strict";e.ZWDocSelection=function(){XFormStack.call(this)},ZWDocSelection.prototype=Object.create(XFormStack.prototype),ZWDocSelection.prototype.constructor=ZWDocSelection,ZWDocSelection.prototype.applyOp=function(e){if(!e||!e.length())return e;this.forEach(function(t,i,n){var o=new ZRange(t.start,t.end),r=DocOpBuilder.xform(e,DocOpBuilder.createDocOpBuilderFromRange(o));r=DocOpBuilder.concise(r.second),t.start=r.docOps[0].retain_count,t.end=t.start+o.length})},ZWDocSelection.prototype.addRange=function(e){return this.pushOp(e),this},ZWDocSelection.prototype.getRangeAt=function(e){return this.getOp(e)},ZWDocSelection.prototype.removeAllRanges=function(){return this.flushOp(),this},ZWDocSelection.prototype.isCollapsed=function(){for(var e=0,t=this.length;e<t;e++)if(!this.getRangeAt(e).isCollapsed())return!1;return!0}}(window),function(e){"use strict";e.ZWNode=function(){ZRange.call(this),this._={isOrphan:1}},ZWNode.prototype=Object.create(ZRange.prototype),ZWNode.prototype.constructor=ZWNode,Object.defineProperties(ZWNode.prototype,{rawFormat:{get:function(){var e;return ZWJSONUtils.cloneAndExtend(e={},this.style?this.style._.op:this._.op),e}}}),ZWNode.prototype.appendTo=function(e){if(!ZWUtils.canAppend(e,this))throw new TypeError("Cannot append "+this.type+" to "+e.type);return e.append(this),this},ZWNode.prototype.clone=function(){var e,t=function(e){switch(e.type){case NODE_TYPE.TABLE:e.style._.op.id="tb-"+Utils.randomString(4);break;case NODE_TYPE.ROW:e.style._.op.id="rw-"+Utils.randomString(4);break;case NODE_TYPE.CELL:e.style._.op.id="cl-"+Utils.randomString(4);break;case NODE_TYPE.IMAGE:e.style._.op.id=e.style.subType?void 0:Utils.getRandomNumber(),e.isShape()&&(e.style._.op[ATTR_IMAGE.I_SHAPEDATA]=InsertShape.renewShape(e.style._.op[ATTR_IMAGE.I_SHAPEDATA]));break;case NODE_TYPE.FIELD_START:n[e.style._.op.id]=e.style._.op.id=Utils.randomString();break;case NODE_TYPE.FIELD_END:e.style._.op.id=n[e.style._.op.id]||Utils.randomString()}},i=function(e){var i,n=e.getDocument();switch(e.type){case NODE_TYPE.TEXT:i=n.createNode(e.type,e.text);break;case NODE_TYPE.PARAGRAPH:i=n.createNode(e.type,e.text);break;case NODE_TYPE.TABLE:i=n.createNode(e.type,[]);break;case NODE_TYPE.FIELD_START:case NODE_TYPE.FIELD_END:i=n.createNode(e.type,e.subType||e.style._.op.type);break;case NODE_TYPE.IMAGE:i=e.isShape()?n.createNode(NODE_TYPE.SHAPE,e.style._.op[ATTR_IMAGE.I_SHAPEDATA]):e.isChart()?n.createNode(NODE_TYPE.CHART,e._.responseHandler):n.createNode(e.type,null);break;default:i=n.createNode(e.type,null)}return i._.itemId=Utils.randomId("node"),ZWJSONUtils.cloneAndExtend(i.style._.op,e.style._.op),t(i),delete i.style._.op[TCConstants.TC],i},n={};return function(t){n={},e=t?e:this;var o=i(this),r=this.hasChildNodes()?this.getChildNodes():[],a=ZWBlockNode.prototype.append;return this.type==NODE_TYPE.TABLE&&(a=ZWNode.prototype.insertBefore,o=o.getLastChild()),r.map(function(e){return e.type==NODE_TYPE.PARAGRAPH?o.type==NODE_TYPE.PARAGRAPH?o.insertAfter(e.clone(!0)):a.call(o,e.clone(!0)):e.type==NODE_TYPE.CELL?o.type==NODE_TYPE.ROW&&a.call(o,e.clone(!0)):e.type==NODE_TYPE.ROW?o.type==NODE_TYPE.TABLEEND&&a.call(o,e.clone(!0)):e.type==NODE_TYPE.TABLE?a.call(o,e.clone(!0)):e.type==NODE_TYPE.FIELD_START?a.call(o,i(e)):e.type==NODE_TYPE.FIELD_END?a.call(o,i(e)):a.call(o,i(e)),e}),this.type==NODE_TYPE.TABLE?o.parent:o}}(),ZWNode.prototype.getChildIndex=function(){return this.getParent()?this.getParent().getChildNodes().indexOf(this):-1},ZWNode.prototype.getChildIndex=function(){var e=-1,t=this;if(!t)return e;if(t.type==NODE_TYPE.SECTION)return 0;for(e=0;t=t.getPreviousSibling();)e++;return e},ZWNode.prototype.getContent=function(){var e,t=this.getDocument(),i="";if(this._.dtNodeId&&(e=ZWUtils.getDTNode.call(t,this))){var n=new ZRange(e.getIndex(),e.getEndIndex()+1);n.end=n.start+(this.type===NODE_TYPE.TEXT&&this._.splitOffset||n.length);var o,r,a,s,l=DocOpBuilder.createDocOpBuilderFromRange(n),d=DocOpBuilder.concise(DocOpBuilder.xform(t._.composedDocOps,l).second),c=DocOpBuilder.concise(DocOpBuilder.compose(t._.composedDocOps,d)),u=DocOpBuilder.concise(DocOpBuilder.compose(DocOpBuilder.build([{r:n.start},{is:t.getContent(n)}]),c));for(r=u.docOps.length,o=r-1;o!=-1;o--)if((a=u.docOps[o])&&a.styles&&a.styles.begin&&"cursor"===a.styles.begin.type){s=a.styles.id;break}for(;o<r&&!((a=u.docOps[o])&&(i+=a.characters||"",a.styles&&a.styles.end.length&&a.styles.id===s));o++);}else NODE_TYPE.SECTION==this.type&&(i+=ZWUtils.getUnicodeChar(this)),t.visitNode(this,function(e){NODE_TYPE.SECTION!=e.type&&(i+=e.text||ZWUtils.getUnicodeChar(e))});return i},ZWNode.prototype.getDocument=function(){return this._.doc},ZWNode.prototype.getEndIndex=function(){return this.end},ZWNode.prototype.getFormat=function(e){var t=this.style._.op[e];switch(e){case ATTR_CELL.Z_TD_BGC:case ATTR_TEXT.TS_BGC:case ATTR_TEXT.TS_FGC:t=ZWUtils.getColor(t)}return t},ZWNode.prototype.getIndex=function(){return this.start},ZWNode.prototype.getNextSibling=function(){var e,t=this.getDocument();return!this.nextSibling&&this.type!==NODE_TYPE.SECTION&&(e=ZWUtils.getDTNode.call(t,this))&&(e=e.getNextSibling())&&ZWUtils.getZWNode.call(t,e),this.nextSibling},ZWNode.prototype.getParent=function(){var e,t=this.getDocument();return!this.parent&&this.type!==NODE_TYPE.SECTION&&(e=ZWUtils.getDTNode.call(t,this))&&(e=e.getParent())&&ZWUtils.getZWNode.call(t,e),this.parent},ZWNode.prototype.getParents=function(e){for(var t=this,i=[];t=t.getParent();)e&&t.type!==e||i.push(t);return i},ZWNode.prototype.getPreviousSibling=function(){var e,t=this.getDocument();return!this.previousSibling&&this.type!==NODE_TYPE.SECTION&&(e=ZWUtils.getDTNode.call(t,this))&&(e=e.getPreviousSibling())&&ZWUtils.getZWNode.call(t,e),this.previousSibling},ZWNode.prototype.hasChildNodes=function(){return this.isBlockNode()&&!!this.getFirstChild()},ZWNode.prototype.insertAfter=function(e){return this.getDocument().insertAfter(e,this),this},ZWNode.prototype.insertBefore=function(e){return this.getDocument().insertBefore(e,this),this},ZWNode.prototype.isBlockNode=function(){return this instanceof ZWBlockNode},ZWNode.prototype.isEqualNode=function(e){return e instanceof ZWNode&&e._.itemId===this._.itemId},ZWNode.prototype.isInlineNode=function(){return this instanceof ZWInlineNode},ZWNode.prototype.remove=function(){return this._.isOrphan?this:(this.isBlockNode()&&this.getDocument().visitNode(this,function(e){if(e.type==NODE_TYPE.FIELD_START&&(e.fieldType==NODE_TYPE.FOOTNOTE||NODE_TYPE.ENDNOTE)){var t=e.getDocument().getAllSections();t.map(function(t){t.style._.op[ATTR_SECTION.ST]==e.fieldType&&t.style._.op[ATTR_SECTION.SID]==e.style._.op.id&&t.remove()})}}),this.type==NODE_TYPE.TEXT&&this._.isJoinedNode?this.getDocument().removeTemporaryNode(this):this.getDocument().removeNode(this))},ZWNode.prototype.setFormat=function(){var e=[this].concat(Array.prototype.slice.call(arguments));return this.getDocument().setFormat.apply(this.getDocument(),e),this},ZWNode.prototype.setFormats=function(){var e=[this].concat(Array.prototype.slice.call(arguments));return this.getDocument().setFormats.apply(this.getDocument(),e),this}}(window),function(e){"use strict";e.ZWInlineNode=function(){ZWNode.call(this)},ZWInlineNode.prototype=Object.create(ZWNode.prototype),ZWInlineNode.prototype.constructor=ZWInlineNode,ZWInlineNode.prototype.insertAfter=function(e){var t=this.getNextSibling();return t?t.insertBefore(e):this.getParent().append(e),this}}(window),function(e){"use strict";e.ZWFieldStart=function(e){ZWInlineNode.call(this),this.subType=e},ZWFieldStart.prototype=Object.create(ZWInlineNode.prototype),ZWFieldStart.prototype.constructor=ZWFactory.nodes[NODE_TYPE.FIELD_START]=ZWFieldStart,Object.defineProperties(ZWFieldStart.prototype,{fieldType:{get:function(){return this.getFormat(ATTR_COMMON.TYPE)}},id:{get:function(){return this.getFormat(ATTR_COMMON.ID)}}}),ZWFieldStart.prototype.getField=function(){var e=[];switch(this.style._.op.type){case FIELD_TYPE.AUTO:e.push(NODE_TYPE.AUTOFIELD,this.style._.op[ATTR_AUTOFIELD.FIELDTYPE]);break;case FIELD_TYPE.MERGE:e.push(NODE_TYPE.MAILMERGEFIELD,this.style._.op[MAILMERGE.MMINFO]);break;case FIELD_TYPE.ENDNOTE:e.push(NODE_TYPE.ENDNOTE,this.style._.op[ATTR_COMMON.NAME],this.style._.op.id);break;case FIELD_TYPE.FOOTNOTE:e.push(NODE_TYPE.FOOTNOTE,this.style._.op[ATTR_COMMON.NAME],this.style._.op.id);break;case FIELD_TYPE.FILLABLE:e.push(NODE_TYPE.FILLABLEFIELD,this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]||this.style._.op[ATTR_FILLABLEFIELD.FF_TYPE]);break;case FIELD_TYPE.SIGN:e.push(NODE_TYPE.SIGNERFIELD,this.style._.op[ATTR_SIGNERFIELD.SIGNTYPE],this.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE]);break;case FIELD_TYPE.BOOKMARK:e.push(NODE_TYPE.BOOKMARK,this.style._.op[ATTR_COMMON.NAME]);break;case FIELD_TYPE.LINK:e.push(NODE_TYPE.LINK,this.style._.op[ATTR_LINK.LINK_TYPE]);break;case FIELD_TYPE.NEXT:e.push(NODE_TYPE.NEXTRECORD,this.style._.op[MAILMERGE.MMINFO]);break;case FIELD_TYPE.REPEAT_MERGE:e.push(NODE_TYPE.REPEAT_START,this.style._.op[MAILMERGE.MMINFO]);break;case FIELD_TYPE.PLACEHOLDER:e.push(NODE_TYPE.PLACEHOLDER,null);break;default:if(!e.length)return}var t=ZWFactory.createField.apply(null,e);return ZWJSONUtils.cloneAndExtend(t._.op,this.style._.op),t._.doc=this.getDocument(),t}}(window),function(e){"use strict";e.ZWFieldEnd=function(e){ZWInlineNode.call(this),this.subType=e},ZWFieldEnd.prototype=Object.create(ZWInlineNode.prototype),ZWFieldEnd.prototype.constructor=ZWFactory.nodes[NODE_TYPE.FIELD_END]=ZWFieldEnd,Object.defineProperties(ZWFieldEnd.prototype,{fieldType:{get:function(){return this.getFormat(ATTR_COMMON.TYPE)}},id:{get:function(){return this.getFormat(ATTR_COMMON.ID)}}}),ZWFieldEnd.prototype.getField=function(){for(var e=this.getPreviousSibling();e;){if(e.type===NODE_TYPE.FIELD_START&&e.style._.op.id===this.style._.op.id)return e.getField();e=e.getPreviousSibling()}return null}}(window),function(e){"use strict";e.ZWField=function(){this._={op:{id:Utils.randomString()}}},Object.defineProperties(ZWField.prototype,{id:{get:function(){return this._.op.id}},rawFormat:{get:function(){var e;return ZWJSONUtils.cloneAndExtend(e={},this._.op),e}}}),ZWField.prototype.getDocument=function(){return this._.doc},ZWField.prototype.getEnd=function(){return this.getDocument().getFieldNode(this.id,NODE_TYPE.FIELD_END)},ZWField.prototype.getStart=function(){return this.getDocument().getFieldNode(this.id,NODE_TYPE.FIELD_START)},ZWField.prototype.isAutoField=function(){return this instanceof ZWAutoField},ZWField.prototype.isComment=function(){return this instanceof ZWComment},ZWField.prototype.isFillableField=function(){return this instanceof ZWFillableField},ZWField.prototype.isSignerField=function(){return this instanceof ZWSignerField},ZWField.prototype.isBookmarkField=function(){return this instanceof ZWBookmarkField},ZWField.prototype.isLinkField=function(){return this instanceof ZWLinkField},ZWField.prototype.isNextRecordField=function(){return this instanceof ZWNextRecordField},ZWField.prototype.isMailmergeField=function(){return this instanceof ZWMailmergeField},ZWField.prototype.isEndnoteField=function(){return this instanceof ZWEndnoteField},ZWField.prototype.isFootnoteField=function(){return this instanceof ZWFootnoteField},ZWField.prototype.isRepeatRange=function(){return this instanceof ZWRepeatRange},ZWField.prototype.isPlaceholderField=function(){return this instanceof ZWPlaceholderField},ZWField.prototype.remove=function(){var e=this.getStart();if(e){var t=e.getNextSibling();e.remove();var i=this.getEnd()||t.getNextSibling(),n=t.getNextSibling()||e.getField().isFillableField()&&e.getField().getFillableFieldType()===FILLABLEFIELD_TYPE.SINGLELINE&&t.getParent().getNextSibling();for(t.remove();n&&n!=i;)t=n.type===NODE_TYPE.PARAGRAPH?n=n.getFirstChild():n,n=n.getNextSibling()||n.getParent(),t.remove(),n.type!==NODE_TYPE.PARAGRAPH||n.hasChildNodes()||(t=n,n=n.getNextSibling(),t.remove());i.remove()}},ZWField.prototype.isFillableImageField=function(){return!1}}(window),function(e){"use strict";var t=[];for(var i in DATE_TYPE)t.push(DATE_TYPE[i]);t.push(FIELD_TYPE.AUTO_DATE),t=new RegExp("^("+t.join("|")+")$",""),e.ZWAutoField=function(e,t,i){ZWField.call(this);var n={};n[ATTR_AUTOFIELD.FIELDTYPE]=e,n[ATTR_AUTOFIELD.ISAUTO]=0,e===FIELD_TYPE.AUTHER_NAME?n[ATTR_AUTOFIELD.VALUE]="Unauthor":e===FIELD_TYPE.AUTO_DATE||e===FIELD_TYPE.LAST_MODIFIED_DATE||e===FIELD_TYPE.CREATED_DATE?(n[ATTR_AUTOFIELD.VALUE]=Utils.getAutoDateValue(e),n[ATTR_AUTOFIELD.LABEL]="",n[ATTR_AUTOFIELD.DATEINFO]=i||{}):e===FIELD_TYPE.AUTO_FORMULA?n[ATTR_AUTOFIELD.FORMULA]=t||"=":e===FIELD_TYPE.DOCUMENT_NAME?n[ATTR_AUTOFIELD.VALUE]="Untitled Document":e===FIELD_TYPE.DOCUMENT_VERSION&&(n[ATTR_AUTOFIELD.VALUE]="1.0"),extend(this._.op,n),this.type=FIELD_TYPE.AUTO},ZWAutoField.prototype=Object.create(ZWField.prototype),ZWAutoField.prototype.constructor=ZWFactory.fields[NODE_TYPE.AUTOFIELD]=ZWAutoField,Object.defineProperties(ZWAutoField.prototype,{label:{get:function(){return this._.op[ATTR_AUTOFIELD.LABEL]},set:function(e){return this._.op[ATTR_AUTOFIELD.FIELDTYPE]!==FIELD_TYPE.AUTO_DATE&&!t.test(this.getAutoFieldType())||!e?this:(this._.op[ATTR_AUTOFIELD.LABEL]=e,void this.getDocument().setFormat(this.getStart(),ATTR_AUTOFIELD.LABEL,e))}}}),ZWAutoField.prototype.getAutoFieldType=function(){return this._.op[ATTR_AUTOFIELD.FIELDTYPE]},ZWAutoField.prototype.isAutoUpdate=function(){return!!this._.op[ATTR_AUTOFIELD.ISAUTO]},ZWAutoField.prototype.setAutoUpdate=function(e){var t=ATTR_AUTOFIELD.ISAUTO;return e=e?1:0,this._.op[t]=e,this.getDocument().setFormat(this.getStart(),t,e),this},ZWAutoField.prototype.getDateType=function(){return this.getAutoFieldType()===FIELD_TYPE.AUTO_DATE?DATE_TYPE.CURRENT:t.test(this.getAutoFieldType())?this._.op[ATTR_AUTOFIELD.FIELDTYPE]:""},ZWAutoField.prototype.setDateType=function(e){return t.test(this._.op[ATTR_AUTOFIELD.FIELDTYPE])&&t.test(e)?(DATE_TYPE.CURRENT==e&&(e=FIELD_TYPE.AUTO_DATE),this._.op[ATTR_AUTOFIELD.FIELDTYPE]=e,this.isAutoUpdate()?this.getDocument().updateField(this,e,!0):(this._.op[ATTR_AUTOFIELD.VALUE]=Utils.getAutoDateValue(e),this.getDocument().updateField(this,e=ZWDate.getDateString(this._.op),!1)),this):this},ZWAutoField.prototype.getFormat=function(){return this._.op[ATTR_AUTOFIELD.DATEFMT]||""},ZWAutoField.prototype.setFormat=function(e){if(this._.op[ATTR_AUTOFIELD.FIELDTYPE]!==FIELD_TYPE.AUTO_DATE&&!t.test(this.getAutoFieldType())||!e&&""!=e)return this;var i=ATTR_AUTOFIELD.DATEFMT;return this._.op[i]=e,this.isAutoUpdate()?this.getDocument().setFormat(this.getStart(),i,e):this.getDocument().updateField(this,e=ZWUtils.getDateString(this._.op),!1),this},ZWAutoField.prototype.getFormula=function(){return this._.op[ATTR_AUTOFIELD.FORMULA]||""},ZWAutoField.prototype.setFormula=function(e){if(this._.op[ATTR_AUTOFIELD.FIELDTYPE]!==FIELD_TYPE.AUTO_FORMULA||!e)return this;var t=ATTR_AUTOFIELD.FORMULA;return this._.op[t]=e,this.getDocument().setFormat(this.getStart(),t,e),this},ZWAutoField.prototype.getSequenceNumberInfo=function(){return this._.op[ATTR_AUTOFIELD.SEQUENCE_INFO]||null},ZWAutoField.prototype.getValue=function(){return this._.op[ATTR_AUTOFIELD.VALUE]||""},ZWAutoField.prototype.setValue=function(e){var t=ATTR_AUTOFIELD.VALUE;return this._.op[t]=e,this.isAutoUpdate()?(e=Math.abs(e),this._.op[t]=e,this.getDocument().updateField(this,e,!0)):this.getDocument().updateField(this,e=ZWUtils.getDateString(this._.op),!1),this},ZWAutoField.prototype.getLocale=function(){return this._.op[ATTR_AUTOFIELD.LOCALE]||""},ZWAutoField.prototype.setLocale=function(e){if(this._.op[ATTR_AUTOFIELD.FIELDTYPE]!==FIELD_TYPE.AUTO_DATE&&!t.test(this.getAutoFieldType())||!e)return this;var i=ATTR_AUTOFIELD.LOCALE;return this._.op[i]=e,this.isAutoUpdate()?this.getDocument().setFormat(this.getStart(),i,e):this.getDocument().updateField(this,e=ZWUtils.getDateString(this._.op),!1),this},ZWAutoField.prototype.getAutoFieldResult=function(){return t.test(this._.op[ATTR_AUTOFIELD.FIELDTYPE])&&!this._.op[ATTR_AUTOFIELD.ISAUTO]?ZWUtils.getDateString(this._.op):this._.op[ATTR_AUTOFIELD.FIELDTYPE]===FIELD_TYPE.AUTO_PAGECOUNT?"##":"#"},ZWAutoField.prototype.getDateInfo=function(){return this._.op[ATTR_AUTOFIELD.DATEINFO]||{}},ZWAutoField.prototype.setDateInfo=function(e){if(this._.op[ATTR_AUTOFIELD.FIELDTYPE]!==FIELD_TYPE.AUTO_DATE&&!t.test(this.getAutoFieldType())||!e)return this;var i=ATTR_AUTOFIELD.DATEINFO;return this._.op[i]=e,this.isAutoUpdate()?this.getDocument().setFormat(this.getStart(),i,e):this.getDocument().updateField(this,e=ZWUtils.getDateString(this._.op),!1),this},ZWAutoField.prototype.setFieldFormat=function(e){if(!e)return this;e.id=this._.op.id;for(var t in e)this._.op.hasOwnProperty(t)&&(t==ATTR_AUTOFIELD.ISAUTO?this._.op[t]=e[t]?1:0:t==ATTR_AUTOFIELD.FIELDTYPE&&DATE_TYPE.CURRENT==e[t]?this._.op[t]=FIELD_TYPE.AUTO_DATE:this._.op[t]=e[t]);var i=this.getAutoFieldType(),n=this._.op[ATTR_AUTOFIELD.VALUE];return i!==FIELD_TYPE.AUTO_DATE&&i!==FIELD_TYPE.LAST_MODIFIED_DATE&&i!==FIELD_TYPE.CREATED_DATE||(this._.op[ATTR_AUTOFIELD.VALUE]=this.isAutoUpdate()||!e.hasOwnProperty(ATTR_AUTOFIELD.FIELDTYPE)||e.hasOwnProperty(ATTR_AUTOFIELD.VALUE)?Math.abs(this._.op[ATTR_AUTOFIELD.VALUE]):Utils.getAutoDateValue(this.getDateType()),n=this.isAutoUpdate()?n:ZWUtils.getDateString(this._.op)),this._.op.type=NODE_TYPE.AUTOFIELD,this.getDocument().updateField(this,n,this.isAutoUpdate()),this}}(window),function(e){"use strict";e.ZWComment=function(e){ZWField.call(this);var t={};t[ATTR_COMMON.ID]=e||this._.op[ATTR_COMMON.ID],extend(this._.op,t),this.type=FIELD_TYPE.COMMENT},ZWComment.prototype=Object.create(ZWField.prototype),ZWComment.prototype.constructor=ZWFactory.fields[NODE_TYPE.COMMENT]=ZWComment,Object.defineProperties(ZWComment.prototype,{id:{get:function(){return this._.op[ATTR_COMMON.ID]},set:function(e){this._.op[ATTR_COMMON.ID]=e,this.getDocument().updateField(this)}}}),ZWComment.prototype.remove=function(){var e=this.getStart(),t=this.getEnd();e&&t&&(e.remove(),t.remove())}}(window),function(e){"use strict";e.ZWBookmarkField=function(e,t){ZWField.call(this);var i={};i[ATTR_COMMON.NAME]=e||"",t&&(i[ATTR_COMMON.ID]=t),extend(this._.op,i),this.type=FIELD_TYPE.BOOKMARK},ZWBookmarkField.prototype=Object.create(ZWField.prototype),ZWBookmarkField.prototype.constructor=ZWFactory.fields[NODE_TYPE.BOOKMARK]=ZWBookmarkField,Object.defineProperties(ZWBookmarkField.prototype,{name:{get:function(){return this._.op[ATTR_COMMON.NAME]},set:function(e){this._.op[ATTR_COMMON.NAME]=e,this.getDocument().updateField(this)}}}),ZWBookmarkField.prototype.remove=function(){var e=this.getStart(),t=this.getEnd();return e&&t?(e.remove(),void t.remove()):this}}(window),function(e){"use strict";e.ZWEndnoteField=function(e,t){ZWBookmarkField.call(this,e,t),this._.op.type=FIELD_TYPE.ENDNOTE,this.type=FIELD_TYPE.ENDNOTE},ZWEndnoteField.prototype=Object.create(ZWBookmarkField.prototype),ZWEndnoteField.prototype.constructor=ZWFactory.fields[NODE_TYPE.ENDNOTE]=ZWEndnoteField,ZWEndnoteField.prototype.remove=function(){ZWField.prototype.remove.call(this);var e=this,t=this.getDocument().getAllSections();t.map(function(t){t.style._.op[ATTR_SECTION.ST]==NODE_TYPE.ENDNOTE&&t.style._.op[ATTR_SECTION.SID]==e.id&&t.remove()})}}(window),function(e){"use strict";e.ZWFootnoteField=function(e,t){ZWBookmarkField.call(this,e,t),this._.op.type=FIELD_TYPE.FOOTNOTE,this.type=FIELD_TYPE.FOOTNOTE},ZWFootnoteField.prototype=Object.create(ZWBookmarkField.prototype),ZWFootnoteField.prototype.constructor=ZWFactory.fields[NODE_TYPE.FOOTNOTE]=ZWFootnoteField,ZWFootnoteField.prototype.remove=function(){ZWField.prototype.remove.call(this);var e=this,t=this.getDocument().getAllSections();t.map(function(t){t.style._.op[ATTR_SECTION.ST]==NODE_TYPE.FOOTNOTE&&t.style._.op[ATTR_SECTION.SID]==e.id&&t.remove()})}}(window),function(e){"use strict";e.ZWLinkField=function(e){ZWField.call(this);var t={};t[ATTR_LINK.LINK_TYPE]=e||1,t[ATTR_LINK.LINK_URL]="",t[ATTR_LINK.LINK_TARGET]="",t[ATTR_LINK.LINK_TOOLTIP]="",t[MAILMERGE.MMINFO]="",extend(this._.op,t),this.type=FIELD_TYPE.LINK},ZWLinkField.prototype=Object.create(ZWField.prototype),ZWLinkField.prototype.constructor=ZWFactory.fields[NODE_TYPE.LINK]=ZWLinkField,Object.defineProperties(ZWLinkField.prototype,{lnktype:{get:function(){return this._.op[ATTR_LINK.LINK_TYPE]},set:function(e){this._.op[ATTR_LINK.LINK_TYPE]=e,this.getDocument().updateField(this)}},url:{get:function(){return this._.op[ATTR_LINK.LINK_URL]},set:function(e){this._.op[ATTR_LINK.LINK_URL]=e,this.getDocument().updateField(this)}},target:{get:function(){return this._.op[ATTR_LINK.LINK_TARGET]},set:function(e){this._.op[ATTR_LINK.LINK_TARGET]=e,this.getDocument().updateField(this)}},tooltip:{get:function(){return this._.op[ATTR_LINK.LINK_TOOLTIP]},set:function(e){this._.op[ATTR_LINK.LINK_TOOLTIP]=e,this.getDocument().updateField(this)}},mminfo:{get:function(){return this._.op[MAILMERGE.MMINFO]},set:function(e){this._.op[MAILMERGE.MMINFO]=e,this.getDocument().updateField(this)}}}),ZWLinkField.prototype.updateProperties=function(e){if(!e)return this;var t=!1;for(var i in e)this._.op.hasOwnProperty(i)&&(this._.op[i]!=e[i]?(t=!0,this._.op[i]=e[i]):delete e[i]);t&&this.getDocument().updateField(this,e)},ZWLinkField.prototype.remove=function(){this.getDocument().updateField(this,{},!0)},ZWLinkField.prototype.isLinkedToMailMergeField=function(){return!(""==this._[MAILMERGE.MMINFO]||!Object.keys(this._[MAILMERGE.MMINFO]).length)}}(window),function(e){"use strict";e.ZWMailmergeField=function(e){ZWField.call(this);var t={};t[MAILMERGE.MMINFO]=e||{},t[ATTR_AUTOFIELD.FIELDTYPE]=FIELD_TYPE.MERGE,extend(this._.op,t),this.type=FIELD_TYPE.MERGE},ZWMailmergeField.prototype=Object.create(ZWField.prototype),ZWMailmergeField.prototype.constructor=ZWFactory.fields[NODE_TYPE.MAILMERGEFIELD]=ZWMailmergeField,ZWMailmergeField.prototype.setFormat=function(e){if(e){var t=this._.op.format||{};return ZWJSONUtils.cloneAndExtend(t,e),this._.op.format=t,this.getDocument().updateField(this),this}}}(window),function(e){"use strict";e.ZWFillableField=function(){ZWField.call(this);var e={};e[ATTR_FILLABLEFIELD.FF_DISABLED]=!1,e[ATTR_FILLABLEFIELD.FF_HELP_TEXT]="",e[ATTR_FILLABLEFIELD.FF_NAME]="",e[ATTR_FILLABLEFIELD.FF_INFO]={},extend(this._.op,e),this.type=FIELD_TYPE.FILLABLE},ZWFillableField.prototype=Object.create(ZWField.prototype),ZWFillableField.prototype.constructor=ZWFillableField,ZWFactory.fields[NODE_TYPE.FILLABLEFIELD]={},Object.defineProperties(ZWFillableField.prototype,{disabled:{get:function(){return!!this._.op[ATTR_FILLABLEFIELD.FF_DISABLED]},set:function(e){this._.op[ATTR_FILLABLEFIELD.FF_DISABLED]=!!e,this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_DISABLED],[!!e],null,!0)}},helpText:{get:function(){return this._.op[ATTR_FILLABLEFIELD.FF_HELP_TEXT]},set:function(e){this._.op[ATTR_FILLABLEFIELD.FF_HELP_TEXT]=e,this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_HELP_TEXT],[e],null,!0)}},name:{get:function(){return this._.op[ATTR_COMMON.NAME]},set:function(e){this._.op[ATTR_COMMON.NAME]=e,this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_NAME],[e])}}}),ZWFillableField.prototype.getFillableFieldType=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]||this._.op[ATTR_FILLABLEFIELD.FF_TYPE]},ZWFillableField.prototype.getFillableFieldResult=function(){return this.getFillableFieldType()===FILLABLEFIELD_TYPE.CHECKBOX||this.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTIPLECHOICE?this.isChecked()?FILLABLEFIELD_PROPS.CHECKED_SYMBOL:FILLABLEFIELD_PROPS.UNCHECKED_SYMBOL:this.getFillableFieldType()===FILLABLEFIELD_TYPE.RADIO?this.isChecked()?FILLABLEFIELD_PROPS.DISC_SYMBOL:FILLABLEFIELD_PROPS.CIRCLE_SYMBOL:Utils.getFillableFieldResult(this._.op)},ZWFillableField.prototype.getFieldValue=function(){switch(this.getFillableFieldType()){case FILLABLEFIELD_TYPE.CHECKBOX:return this.isChecked();case FILLABLEFIELD_TYPE.SELECTBOX:return this.getSelectedIndex();default:return this.getValue()}},ZWFillableField.prototype.isMandatory=function(){var e=this.getFillableFieldType();return FILLABLEFIELD_TYPE.CHECKBOX!=e&&!!this._.op[ATTR_FILLABLEFIELD.FF_MANDATORY]},ZWFillableField.prototype.setMandatory=function(e){return FILLABLEFIELD_TYPE.CHECKBOX==this.getFillableFieldType()?this:(this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_MANDATORY],[!!e]),this)},ZWFillableField.prototype.isFilled=function(){var e=this.getFillableFieldType();return FILLABLEFIELD_TYPE.CHECKBOX==e||(FILLABLEFIELD_TYPE.SELECTBOX==e?this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SELECTED_INDEX]!==-1:" "!=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]&&""!=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE])},ZWFillableField.prototype.setFieldFormat=function(e){if(!e)return this;e.id=this._.op.id;for(var t in e)ATTR_FILLABLEFIELD.FF_INFO!=t&&"prevInfo"!=t&&(this._.op[t]=e[t]);for(var t in e[ATTR_FILLABLEFIELD.FF_INFO])this._.op[ATTR_FILLABLEFIELD.FF_INFO][t]=e[ATTR_FILLABLEFIELD.FF_INFO][t];return this._.op.type=NODE_TYPE.FILLABLEFIELD,this.getDocument().updateField(this,[],[]),this},ZWFillableField.prototype.setResizeValues=function(e){var t={};t[ATTR_FILLABLEFIELD.FF_WIDTH_UNIT]=e.wid_un,t[ATTR_FILLABLEFIELD.FF_HEIGHT_UNIT]=e.ht_un,t[ATTR_FILLABLEFIELD.FF_WIDTH]=e.wid,t[ATTR_FILLABLEFIELD.FF_HEIGHT]=e.ht,t[ATTR_FILLABLEFIELD.FF_ROTATE]=e.rotation,t[ATTR_FILLABLEFIELD.FF_POSITIONV]=e.positionV,t[ATTR_FILLABLEFIELD.FF_POSITIONH]=e.positionH,this.setFieldFormat(t)},ZWFillableField.prototype.getId=function(){return this.id},ZWFillableField.prototype.getName=function(){return this.name},ZWFillableField.prototype.isFillableImageField=function(){return!1}}(window),function(e){"use strict";e.ZWFillableFieldTextInput=function(e){ZWFillableField.call(this),this._.op[ATTR_FILLABLEFIELD.FF_TYPE]="textinput";var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO];switch(t[ATTR_FILLABLEFIELD.FF_SUBTYPE]=e,t[ATTR_FILLABLEFIELD.FF_VALUE]=" ",t[ATTR_FILLABLEFIELD.FF_FORMAT]="",t[ATTR_FILLABLEFIELD.FF_MAX_LENGTH]=30,this._.op[ATTR_FILLABLEFIELD.FF_MANDATORY]=!1,e){case FILLABLEFIELD_TYPE.DATE:var i=ZWUtils.getLocaleDetails()||{},n=i.code||"en-US",o=ZWUtils.getMomentInstance(null,n);t[ATTR_AUTOFIELD.LOCALE]=n,t[ATTR_FILLABLEFIELD.FF_FORMAT]=o?o.getLocaleFormattedFormat("MM/DD/YYYY")||"MM/DD/YYYY":"MM/DD/YYYY",t[ATTR_FILLABLEFIELD.FF_MAX_LENGTH]=30;break;case FILLABLEFIELD_TYPE.MULTILINE:t[ATTR_FILLABLEFIELD.FF_MAX_LENGTH]=100,t[ATTR_FILLABLEFIELD.FF_SIZE]={width:100,height:50};break;case FILLABLEFIELD_TYPE.NUMBER:t[ATTR_FILLABLEFIELD.FF_NUMBER_FORMAT]="0";case FILLABLEFIELD_TYPE.PERCENT:e==FILLABLEFIELD_TYPE.PERCENT&&(t[ATTR_FILLABLEFIELD.FF_NUMBER_FORMAT]="0%");var i=ZWUtils.getLocaleDetails()||{},n=i.code||"en-US";t[ATTR_AUTOFIELD.LOCALE]=n,delete t[ATTR_FILLABLEFIELD.FF_FORMAT];case FILLABLEFIELD_TYPE.PHONE:t[ATTR_FILLABLEFIELD.FF_MAX_LENGTH]=10;break;case FILLABLEFIELD_TYPE.CURRENCY:var n=ZWUtils.getLocaleDetails()||{},r=n.currencyCode||"USD",a=Numeral.getFormattedNumberAndCurrencySymbol(n.code,r)||{};t[ATTR_FILLABLEFIELD.FF_CURRENCY_CODE]=r,t[ATTR_FILLABLEFIELD.FF_CURRENCY_SYMBOL]=a.symbol||"$",t[ATTR_FILLABLEFIELD.FF_USE_CURRENCY_SYMBOL]=!0,t[ATTR_FILLABLEFIELD.FF_VALUE]=" ",t[ATTR_FILLABLEFIELD.FF_MAX_LENGTH]=20,t[ATTR_AUTOFIELD.LOCALE]=n.code||"en-US"}},ZWFillableFieldTextInput.prototype=Object.create(ZWFillableField.prototype),ZWFillableFieldTextInput.prototype.constructor=ZWFillableFieldTextInput;for(var t in FILLABLEFIELD_TYPE)ZWFactory.fields[NODE_TYPE.FILLABLEFIELD][FILLABLEFIELD_TYPE[t]]||(ZWFactory.fields[NODE_TYPE.FILLABLEFIELD][FILLABLEFIELD_TYPE[t]]=ZWFillableFieldTextInput);ZWFillableFieldTextInput.prototype.getFormat=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_FORMAT]||""},ZWFillableFieldTextInput.prototype.setFormat=function(e){this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_FORMAT],[e])},ZWFillableFieldTextInput.prototype.getNumberFormat=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_NUMBER_FORMAT]||""},ZWFillableFieldTextInput.prototype.setNumberFormat=function(e){this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_NUMBER_FORMAT],[e])},ZWFillableFieldTextInput.prototype.getMaxLength=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_MAX_LENGTH]},ZWFillableFieldTextInput.prototype.setMaxLength=function(e){this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_MAX_LENGTH],[e])},ZWFillableFieldTextInput.prototype.getValue=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]},ZWFillableFieldTextInput.prototype.setValue=function(e){if(!e&&this.getFillableFieldType()!=FILLABLEFIELD_TYPE.CURRENCY)return this;var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE];this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]=e,this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_VALUE],[e],[t])},ZWFillableFieldTextInput.prototype.getCurrencyCode=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CURRENCY_CODE]},ZWFillableFieldTextInput.prototype.setCurrencyCode=function(e){var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO],i=t.locale,n=DocLocaleHandler.getLanguageDetails(i),o=Numeral.getFormattedNumberAndCurrencySymbol(i,e);t[ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.CURRENCY&&n&&o&&this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_CURRENCY_CODE,ATTR_FILLABLEFIELD.FF_CURRENCY_SYMBOL],[n.currencyCode,o.symbol])},ZWFillableFieldTextInput.prototype.isCurrencySymbolAsCode=function(){return!!this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_USE_CURRENCY_SYMBOL]},ZWFillableFieldTextInput.prototype.setCurrencySymbolAsCode=function(e){var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO];t[ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.CURRENCY&&this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_USE_CURRENCY_SYMBOL],[!!e])},ZWFillableFieldTextInput.prototype.getThousandSeparator=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_THOUSAND_SEPARATOR]},ZWFillableFieldTextInput.prototype.setThousandSeparator=function(e){if(!/^[., ]$/.test(e))return this;var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO];t[ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.CURRENCY&&this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_THOUSAND_SEPARATOR],[e])},ZWFillableFieldTextInput.prototype.getDecimalSeparator=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_DECIMAL_SEPARATOR]},ZWFillableFieldTextInput.prototype.setDecimalSeparator=function(e){if(!/^[.,]$/.test(e))return this;var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO];t[ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.CURRENCY&&this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_DECIMAL_SEPARATOR],[e])},ZWFillableFieldTextInput.prototype.getDecimalPlaces=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_DECIMAL_PLACES]},ZWFillableFieldTextInput.prototype.setDecimalPlaces=function(e){if(!/^[023]$/.test(e))return this;var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO];t[ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.CURRENCY&&this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_DECIMAL_PLACES],[e])},ZWFillableFieldTextInput.prototype.getLocale=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_AUTOFIELD.LOCALE]},ZWFillableFieldTextInput.prototype.setLocale=function(e){var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO];t[ATTR_FILLABLEFIELD.FF_SUBTYPE]!==FILLABLEFIELD_TYPE.CURRENCY&&t[ATTR_FILLABLEFIELD.FF_SUBTYPE]!==FILLABLEFIELD_TYPE.DATE||this.getDocument().updateField(this,[ATTR_AUTOFIELD.LOCALE],[e])},ZWFillableFieldTextInput.prototype.getSize=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SIZE]||{}},ZWFillableFieldTextInput.prototype.setSize=function(e){return e&&e.height&&e.width?void this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_SIZE],[e]):this}}(window),function(e){"use strict";e.ZWFillableFieldCheckBox=function(){ZWFillableField.call(this),this._.op[ATTR_FILLABLEFIELD.FF_TYPE]=FILLABLEFIELD_TYPE.CHECKBOX;var e=this._.op[ATTR_FILLABLEFIELD.FF_INFO];e[ATTR_FILLABLEFIELD.FF_CHECKED]=!1,e[ATTR_FILLABLEFIELD.FF_SIZE]=20,e[ATTR_FILLABLEFIELD.FF_CHECKED_VALUE]="True",e[ATTR_FILLABLEFIELD.FF_UNCHECKED_VALUE]="False"},ZWFillableFieldCheckBox.prototype=Object.create(ZWFillableField.prototype),ZWFillableFieldCheckBox.prototype.constructor=ZWFactory.fields[NODE_TYPE.FILLABLEFIELD][FILLABLEFIELD_TYPE.CHECKBOX]=ZWFillableFieldCheckBox,ZWFillableFieldCheckBox.prototype.isChecked=function(){return!!this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED]},ZWFillableFieldCheckBox.prototype.setChecked=function(e){var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED];this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED]=!!e,this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_CHECKED],[!!e],[!!t])},ZWFillableFieldCheckBox.prototype.getSize=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SIZE]},ZWFillableFieldCheckBox.prototype.setSize=function(e){this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_SIZE],[e])},ZWFillableFieldCheckBox.prototype.setCheckedValue=function(e){var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED_VALUE];this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_CHECKED_VALUE],[e],[t])},ZWFillableFieldCheckBox.prototype.getCheckedValue=function(e){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED_VALUE]},ZWFillableFieldCheckBox.prototype.setUncheckedValue=function(e){var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_UNCHECKED_VALUE];this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_UNCHECKED_VALUE],[e],[t])},ZWFillableFieldCheckBox.prototype.getUncheckedValue=function(e){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_UNCHECKED_VALUE]}}(window),function(e){"use strict";e.ZWFillableFieldSelectBox=function(e){ZWFillableField.call(this),this._.op[ATTR_FILLABLEFIELD.FF_TYPE]=FILLABLEFIELD_TYPE.SELECTBOX,this._.op[ATTR_FILLABLEFIELD.FF_MANDATORY]=!1;var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO];t[ATTR_FILLABLEFIELD.FF_LIST]=[""],t[ATTR_FILLABLEFIELD.FF_SELECTED_INDEX]=-1},ZWFillableFieldSelectBox.prototype=Object.create(ZWFillableField.prototype),ZWFillableFieldSelectBox.prototype.constructor=ZWFactory.fields[NODE_TYPE.FILLABLEFIELD][FILLABLEFIELD_TYPE.SELECTBOX]=ZWFillableFieldSelectBox,ZWFillableFieldSelectBox.prototype.getList=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_LIST]},ZWFillableFieldSelectBox.prototype.setList=function(e){var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_LIST];this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_LIST]=e,this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_LIST],[e],[t])},ZWFillableFieldSelectBox.prototype.getSelectedIndex=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SELECTED_INDEX]},ZWFillableFieldSelectBox.prototype.setSelectedIndex=function(e){this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_SELECTED_INDEX],["number"==typeof e?e:-1])}}(window),function(e){"use strict";e.ZWFillableFieldMultipleChoice=function(e){ZWFillableField.call(this),this._.op[ATTR_FILLABLEFIELD.FF_TYPE]=FILLABLEFIELD_TYPE.MULTIPLECHOICE,this._.op[ATTR_FILLABLEFIELD.FF_NAME]="",this._.op[ATTR_FILLABLEFIELD.FF_MANDATORY]=!1;var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO];t[ATTR_FILLABLEFIELD.FF_VALUE]="",t[ATTR_FILLABLEFIELD.FF_CHECKED]=!1},ZWFillableFieldMultipleChoice.prototype=Object.create(ZWFillableField.prototype),ZWFillableFieldMultipleChoice.prototype.constructor=ZWFactory.fields[NODE_TYPE.FILLABLEFIELD][FILLABLEFIELD_TYPE.MULTIPLECHOICE]=ZWFillableFieldMultipleChoice,ZWFillableFieldMultipleChoice.prototype.isChecked=function(){return!!this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED]},ZWFillableFieldMultipleChoice.prototype.setChecked=function(e){var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED];this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_CHECKED],[!!e],[!!t])},ZWFillableFieldMultipleChoice.prototype.setValue=function(e){if(!e)return this;var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE];this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]=e,this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_VALUE],[e],[t])},ZWFillableFieldMultipleChoice.prototype.getValue=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]}}(window),function(e){"use strict";e.ZWFillableFieldRadio=function(e){ZWFillableField.call(this),this._.op[ATTR_FILLABLEFIELD.FF_TYPE]=FILLABLEFIELD_TYPE.RADIO,this._.op[ATTR_FILLABLEFIELD.FF_NAME]="",this._.op[ATTR_FILLABLEFIELD.FF_MANDATORY]=!1;var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO];t[ATTR_FILLABLEFIELD.FF_VALUE]="",t[ATTR_FILLABLEFIELD.FF_CHECKED]=!1},ZWFillableFieldRadio.prototype=Object.create(ZWFillableField.prototype),ZWFillableFieldRadio.prototype.constructor=ZWFactory.fields[NODE_TYPE.FILLABLEFIELD][FILLABLEFIELD_TYPE.RADIO]=ZWFillableFieldRadio,ZWFillableFieldRadio.prototype.isChecked=function(){return!!this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED]},ZWFillableFieldRadio.prototype.setValue=function(e){if(!e&&this.getFillableFieldType()!=FILLABLEFIELD_TYPE.CURRENCY)return this;var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE];this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]=e,this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_VALUE],[e],[t])},ZWFillableFieldRadio.prototype.setChecked=function(e){var t=this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED];this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED]=!!e,this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_CHECKED],[!!e],[!!t])},ZWFillableFieldRadio.prototype.getValue=function(){return this._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]}}(window),function(e){"use strict";e.ZWSignerField=function(e,t){ZWField.call(this);var i={};i[ATTR_SIGNERFIELD.SIGNTYPE]=e,i[ATTR_SIGNERFIELD.SIGNSERVICE]="zohosign",i[ATTR_SIGNERFIELD.NAME]="",i[ATTR_SIGNERFIELD.SFINFO]={},i[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE]=t,e!==SIGN_TYPE.ESIGN||t!==SIGNERFIELD_TYPE.SIGNATURE&&t!==SIGNERFIELD_TYPE.INITIAL?i[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.VALUE]="":(i[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SRC]="",i[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SIZE]={}),e===SIGN_TYPE.DIGISIGN&&(i[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.RECIPIENT]="Recipient1",i[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.MANDATORY]=!1),extend(this._.op,i),this.type=FIELD_TYPE.SIGN},ZWSignerField.prototype=Object.create(ZWField.prototype),ZWSignerField.prototype.constructor=ZWFactory.fields[NODE_TYPE.SIGNERFIELD]=ZWSignerField,Object.defineProperties(ZWSignerField.prototype,{signType:{get:function(){return this._.op[ATTR_SIGNERFIELD.SIGNTYPE]},set:function(e){this._.op[ATTR_SIGNERFIELD.SIGNTYPE]=e,this.getDocument().updateField(this,null,null,!0)}},signService:{get:function(){return this._.op[ATTR_SIGNERFIELD.SIGNSERVICE]},set:function(e){this._.op[ATTR_SIGNERFIELD.SIGNSERVICE]=e,this.getDocument().updateField(this,null,null,!0)}},name:{get:function(){return this._.op[ATTR_SIGNERFIELD.NAME]},set:function(e){this._.op[ATTR_SIGNERFIELD.NAME]=e,this.getDocument().updateField(this,null,null,!0)}}}),ZWSignerField.prototype.updateSignValue=function(){var e=this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE],t=ZSignController.updateSign(this,e);this._.op[ATTR_SIGNERFIELD.SIGNTYPE]!==SIGN_TYPE.ESIGN||e!==SIGNERFIELD_TYPE.SIGNATURE&&e!==SIGNERFIELD_TYPE.INITIAL?this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.VALUE]=t:this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SRC]=t},ZWSignerField.prototype.getValue=function(){var e=this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE];return this._.op[ATTR_SIGNERFIELD.SIGNTYPE]!==SIGN_TYPE.ESIGN||e!==SIGNERFIELD_TYPE.SIGNATURE&&e!==SIGNERFIELD_TYPE.INITIAL?this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.VALUE]:this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SRC]},ZWSignerField.prototype.setValue=function(e){if(!e)return this;var t=this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE];this._.op[ATTR_SIGNERFIELD.SIGNTYPE]!==SIGN_TYPE.ESIGN||t!==SIGNERFIELD_TYPE.SIGNATURE&&t!==SIGNERFIELD_TYPE.INITIAL?this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.VALUE]=e:this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SRC]=e,this.getDocument().updateField(this,t,e,!1)},ZWSignerField.prototype.getSignFieldType=function(){return this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE]||""},ZWSignerField.prototype.getRecipient=function(){return this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.RECIPIENT]||""},ZWSignerField.prototype.setRecipient=function(e){if(!e||this._.op[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.ESIGN)return this;var t=this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE];this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.RECIPIENT]=e,this.getDocument().updateField(this,t,e,!0)},ZWSignerField.prototype.isMandatory=function(){return this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.MANDATORY]||!1},ZWSignerField.prototype.setMandatory=function(e){return void 0===e||this._.op[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.ESIGN?this:(this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.MANDATORY]=!!e,void this.getDocument().updateField(this,this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE],!!e,!0))},ZWSignerField.prototype.getSize=function(){return this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SIZE]||{}},ZWSignerField.prototype.setFieldFormat=function(e){if(!e)return this;e.id=this._.op.id;for(var t in e)ATTR_SIGNERFIELD.SFINFO!==t&&(this._.op[t]=e[t]);for(var t in e[ATTR_SIGNERFIELD.SFINFO])this._.op[ATTR_SIGNERFIELD.SFINFO][t]=e[ATTR_SIGNERFIELD.SFINFO][t];this.getDocument().updateField(this,this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE],this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.VALUE],!1)},ZWSignerField.prototype.setSize=function(e){if(!e||this._.op[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.DIGISIGN)return this;var t=this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE];return t!==SIGNERFIELD_TYPE.SIGNATURE&&t!==SIGNERFIELD_TYPE.INITIAL?this:e.height&&e.width?(this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SIZE]=e,void this.getDocument().updateField(this,t,e,!0)):this},ZWSignerField.prototype.updateInfo=function(e){if(!e||this._.op[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.ESIGN)return this;for(var t in e)this._.op.hasOwnProperty(t)?this._.op[t]=e[t]:(this._.op[ATTR_SIGNERFIELD.SFINFO].hasOwnProperty(t)||ATTR_SIGNERFIELD.MANDATORY==t)&&(this._.op[ATTR_SIGNERFIELD.SFINFO][t]=e[t]);this.getDocument().updateField(this,this._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE],e[ATTR_SIGNERFIELD.VALUE],!1)},ZWSignerField.prototype.isSignerImageField=function(){return!1}}(window),function(e){var t={ff:"fontFamily",fv:"fontVariant",fw:"fontWeight",fs:"fontStyle",fw_i:"fontWeightItalic",fgc:"foregroundColor",bgc:"backgroundColor",size:"fontSize",td:"textDecoration",cs:"letterSpacing",va:"verticalAlign",dir:"direction",ml:"marginLeft",mr:"marginRight",mb:"marginBottom",mt:"marginTop",ht:"height",ti:"textIndent",ri:"rightIndent",fb:"",sb:"",ls:"lineHeight",al:"textAlign",ws:"wordSpacing",pl:"paddingLeft",pr:"paddingRight",pt:"paddingTop",pb:"paddingBottom",hd:"",tps:"",fli:"",ps:"pageSize",or:"orientation",ph:"pageHeight",pw:"pageWidth"},i={};Object.keys(t).forEach(function(e,n){i[t[e]]=e});var n=function(e,n){var o={};for(var r in n){var a="toJSON"==e?t[r]:i[r];o[a]=n[r]}return o};e.ZWFormatConverter={convertJSONToFormat:n.bind(e,["toFormat"]),convertFormatToJSON:n.bind(e,["toJSON"])}}(window),function(e){"use strict";var t=function(){var e={};return e[ATTR_COMMON.ID]=MAILMERGE.NEXT,e[ATTR_COMMON.TYPE]=MAILMERGE.BUILD_IN_FIELD,e[MAILMERGE.FIELD_NAME]="Next Record",e};e.ZWNextRecordField=function(e){ZWField.call(this);var i={};i[MAILMERGE.MMINFO]=e||t(),i[ATTR_AUTOFIELD.FIELDTYPE]=FIELD_TYPE.NEXT,extend(this._.op,i),this.type=FIELD_TYPE.MERGE},ZWNextRecordField.prototype=Object.create(ZWField.prototype),ZWNextRecordField.prototype.constructor=ZWFactory.fields[NODE_TYPE.NEXTRECORD]=ZWNextRecordField,Object.defineProperties(ZWNextRecordField.prototype,{mminfo:{get:function(){return this._.op[MAILMERGE.MMINFO]},set:function(e){this._.op[MAILMERGE.MMINFO]=e,this.getDocument().updateField(this)}}})}(window),function(e){"use strict";e.ZWImage=function(){ZWInlineNode.call(this)},ZWImage.prototype=Object.create(ZWInlineNode.prototype),ZWImage.prototype.constructor=ZWFactory.nodes[NODE_TYPE.IMAGE]=ZWImage,ZWImage.prototype.getCrop=function(){return this.style._.op[ATTR_IMAGE.I_CROPRECT]},ZWImage.prototype.setCrop=function(e){return this.setFormat(ATTR_IMAGE.I_CROPRECT,e)},ZWImage.prototype.getLatexExpression=function(){return this.style._.op[ATTR_IMAGE.I_LATEXEXP]},ZWImage.prototype.setLatexExpression=function(e){return this.setFormat(ATTR_IMAGE.I_LATEXEXP,e)},ZWImage.prototype.setMMInfo=function(e){return this.setFormat(MAILMERGE.MMINFO,e)},ZWImage.prototype.isChart=function(){return this.style._.op[ATTR_COMMON.SUBTYPE]===NODE_TYPE.CHART},ZWImage.prototype.isBarcode=function(){return this.style._.op[ATTR_COMMON.SUBTYPE]===NODE_TYPE.BARCODE},ZWImage.prototype.isQRCode=function(){return this.style._.op[ATTR_COMMON.SUBTYPE]===NODE_TYPE.QRCODE},ZWImage.prototype.isField=function(){return this.style._.op.hasOwnProperty(ATTR_COMMON.FIELDINFO)||this.style._.op.hasOwnProperty(MAILMERGE.MMINFO)},ZWImage.prototype.isShape=function(){return this.style._.op.hasOwnProperty(ATTR_IMAGE.I_SHAPEDATA)},ZWImage.prototype.isShapeWatermark=function(){return this.isShape()&&"WATERMARK"===this.style._.op[ATTR_IMAGE.I_SHAPEDATA].shapetype},ZWImage.prototype.isNewWatermark=function(){return this.style._.op.hasOwnProperty(ATTR_IMAGE.WM_INFO)},ZWImage.prototype.isWatermark=function(){return this.isShapeWatermark()||this.isNewWatermark()},ZWImage.prototype.isWidget=function(){return this.style._.op[ATTR_COMMON.SUBTYPE]===NODE_TYPE.WIDGET},ZWImage.prototype.isEquation=function(){return this.style._.op.hasOwnProperty(ATTR_IMAGE.I_LATEXEXP)},ZWImage.prototype.isSignature=function(){return this.style._.op[ATTR_COMMON.SUBTYPE]===SIGNERFIELD_TYPE.SIGNATURE},ZWImage.prototype.isInitial=function(){return this.style._.op[ATTR_COMMON.SUBTYPE]===SIGNERFIELD_TYPE.INITIAL},ZWImage.prototype.getFillableFieldType=function(){return this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]||this._.op[ATTR_FILLABLEFIELD.FF_TYPE]},ZWImage.prototype.getValue=function(){return this.isSignerImageField()?this.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.VALUE]:this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]||this.style._.op.src},ZWImage.prototype.isFillableImageField=function(){return(this.rawFormat.cls||"").indexOf(NODE_TYPE.FILLABLEFIELD)!==-1},ZWImage.prototype.getFitType=function(){return this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_FIT_TYPE]},ZWImage.prototype.getSize=function(){var e=this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE],t=this.style._.op.ht||100,i=this.style._.op.wid||100;return e==FILLABLEFIELD_TYPE.SIGNATURE?(t=this.style._.op.ht||50,i=this.style._.op.wid||300):e==FILLABLEFIELD_TYPE.INITIAL&&(t=this.style._.op.ht||50,i=this.style._.op.wid||50),{ht:t,wid:i}},ZWImage.prototype.getFillableFieldResult=function(){return Utils.getFillableFieldResult(this.style._.op)},ZWImage.prototype.setValue=function(e){return e?(this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_VALUE],[e]),this):this},ZWImage.prototype.isMandatory=function(){return this.isSignerImageField()?!!this.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.MANDATORY]:!!this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_MANDATORY]},ZWImage.prototype.setMandatory=function(e){return this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_MANDATORY],[!!e],null,!0),this},ZWImage.prototype.isFilled=function(){return" "!=this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]&&""!=this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]},ZWImage.prototype.getId=function(){return this.isFillableImageField()?this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]:this.isSignerImageField()?this.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_COMMON.ID]:this.style._.op[ATTR_COMMON.ID]},ZWImage.prototype.getName=function(){return this.isFillableImageField()?this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.NAME]:""},ZWImage.prototype.setFitType=function(e){return e&&this.getFillableFieldType()===FILLABLEFIELD_TYPE.IMAGE?(this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_FIT_TYPE],[e]),this):this},ZWImage.prototype.getFieldValue=function(){return this.getValue()},ZWImage.prototype.isFillableField=function(){return(this.rawFormat.cls||"").indexOf(NODE_TYPE.FILLABLEFIELD)!==-1},Object.defineProperties(ZWImage.prototype,{name:{get:function(){return this.isFillableImageField()?this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_NAME]:this.isSignerImageField()?this.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.NAME]:""},set:function(e){this.isFillableImageField()&&this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_NAME],[e],null,!0)}},helpText:{get:function(){return this.isFillableImageField()&&this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_HELP_TEXT]},set:function(e){this.isFillableImageField()&&this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_HELP_TEXT],[e],null,!0)}},disabled:{get:function(){return this.isFillableImageField()&&this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_DISABLED]},set:function(e){this.isFillableImageField()&&this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_DISABLED],[e],null,!0)}}}),ZWImage.prototype.getRecipient=function(){return this.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.RECIPIENT]||""},ZWImage.prototype.setRecipient=function(e){if(!e||this.style._.op[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.ESIGN)return this;var t=this.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE];this.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.RECIPIENT]=e,this.getDocument().updateField(this,t,e,!0)},ZWImage.prototype.isSignerImageField=function(){return(this.rawFormat.cls||"").indexOf(NODE_TYPE.SIGNERFIELD)!==-1&&this.rawFormat.hasOwnProperty(ATTR_SIGNERFIELD.SFINFO)},ZWImage.prototype.getSignFieldType=function(){return this.isSignerImageField()&&this.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE]||""},ZWImage.prototype.updateSignerFieldInfo=function(e){if(!this.isSignerImageField()||!e||this.style._.op[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.ESIGN)return this;for(var t in e)this.style._.op.hasOwnProperty(t)?this.style._.op[t]=e[t]:(this.style._.op[ATTR_SIGNERFIELD.SFINFO].hasOwnProperty(t)||ATTR_SIGNERFIELD.MANDATORY==t)&&(this.style._.op[ATTR_SIGNERFIELD.SFINFO][t]=e[t]);this.getDocument().updateField(this,[ATTR_SIGNERFIELD.VALUE],[e[ATTR_SIGNERFIELD.VALUE]],!1)},ZWImage.prototype.isSignerField=function(){return(this.rawFormat.cls||"").indexOf(NODE_TYPE.SIGNERFIELD)!==-1}}(window),function(e){"use strict";e.ZWChart=function(){ZWImage.call(this)},ZWChart.prototype=Object.create(ZWImage.prototype),ZWChart.prototype.constructor=ZWFactory.nodes[NODE_TYPE.CHART]=ZWChart,Object.defineProperties(ZWChart.prototype,{chartId:{get:function(){return this.style._.op[ATTR_CHART.CHART_ID]},set:function(e){this.style._.op[ATTR_CHART.CHART_ID]=e,this.setFormat(ATTR_CHART.CHART_ID,e)}},sheetId:{get:function(){return this.style._.op[ATTR_CHART.SHEET_ID]},set:function(e){this.style._.op[ATTR_CHART.SHEET_ID]=e,this.setFormat(ATTR_CHART.SHEET_ID,e)}}}),ZWChart.prototype.setChartType=function(e){return e?(this._[ATTR_CHART.CHART_TYPE]=e,this):this},ZWChart.prototype.updateChart=function(e){this._.isUpdateInProgress=!0,this._.updateCallback=e||void 0},ZWChart.prototype.setResponseHandler=function(e){this._.responseHandler=e||void 0},ZWChart.prototype.getChartData=function(){return this._.chartData||""},ZWChart.prototype.setChartData=function(e){this._.chartData=e||void 0}}(window),function(e){"use strict";e.ZWWidget=function(){ZWImage.call(this)},ZWWidget.prototype=Object.create(ZWImage.prototype),ZWWidget.prototype.constructor=ZWFactory.nodes[NODE_TYPE.WIDGET]=ZWWidget,ZWWidget.prototype.getSheetInfo=function(){return this.style._.op[ATTR_WIDGET.SHEET_INFO]},ZWWidget.prototype.setSheetInfo=function(e){return this.isSheetWidget()&&e?this.setFormat(ATTR_WIDGET.SHEET_INFO,e):this;},ZWWidget.prototype.isSheetWidget=function(){return this.style._.op.hasOwnProperty(ATTR_WIDGET.SHEET_INFO)},ZWWidget.prototype.setResponseHandler=function(e){var t;return!this.isSheetWidget()||(t=this.getSheetInfo()||{})&&(t.rid||t.url)?this:(this._.responseHandler=e||void 0,this)}}(window),function(e){"use strict";e.ZWShape=function(){ZWImage.call(this)},ZWShape.prototype=Object.create(ZWImage.prototype),ZWShape.prototype.constructor=ZWFactory.nodes[NODE_TYPE.SHAPE]=ZWShape,ZWShape.prototype.getShapeData=function(){return this.style._.op[ATTR_IMAGE.I_SHAPEDATA]},ZWShape.prototype.setShapeData=function(e){return this.setFormat(ATTR_IMAGE.I_SHAPEDATA,e)},ZWShape.prototype.isShapeWatermark=function(){return"WATERMARK"===this.style._op[ATTR_IMAGE.I_SHAPEDATA].shapetype}}(window),function(e){"use strict";var t=function(e){for(var t=this.text,i=0;i<e.length;i++){var n=e[i],o="";n-=this.start,o=t.substring(0,n)+t.charAt(n).toUpperCase()+t.substring(n+1,this.end).toLowerCase(),t=o}return t},i=function(){if(this.style._.op.hasOwnProperty(ATTR_TEXT.TS_FV)){var e={};e[ATTR_TEXT.TS_FV]="",this.updateTextFormat(e)}return this},n=function(e){var t;if((t=this.getPreviousSibling())&&t.type==NODE_TYPE.FIELD_START&&t.fieldType==FIELD_TYPE.MERGE){var i={};i[ATTR_TEXT.TS_FV]=e,t.getField().setFormat(i)}};e.ZWText=function(e){ZWInlineNode.call(this),this.text=e||""},ZWText.prototype=Object.create(ZWInlineNode.prototype),ZWText.prototype.constructor=ZWFactory.nodes[NODE_TYPE.TEXT]=ZWText,ZWText.prototype.clearFormat=function(){return this.setFormat(ATTR_TEXT.TS_NULL,!0)},ZWText.prototype.deleteTextInRange=function(e){if(!e||!e.length||Math.min(e.start,e.end,this.text.length)===this.text.length)throw new TypeError("Range is not valid !!");return this.getDocument().replaceTextAtRange(this,e),this},ZWText.prototype.isTab=function(){return this.style._.op[ATTR_COMMON.ST]===NODE_TYPE.TAB},ZWText.prototype.joinSplitNodes=function(){var e=this;if(!this._.splitOffset&&!this._.isSplitNode)return this;if(this._.isSplitNode){for(;e._.isSplitNode&&e.getPreviousSibling();)e=e.getPreviousSibling();e._.splitOffset||e._.isSplitNode||!e.getNextSibling()||(e=e.getNextSibling())}for(var t=e.getNextSibling(),i=[];t;)t._.isSplitNode&&t.type==e.type&&(e.text+=t.text,e.end+=t.length,t._.isJoinedNode=!0,i.push(t)),t=t.getNextSibling();return i.forEach(function(e){e.remove()}),e},ZWText.prototype.splitAt=function(e){var t=this.text.length;if(!(isNaN(e)||e<=0||e>=t)){var i=this.getDocument().createNode(NODE_TYPE.TEXT,this.text.slice(e));return this.text=this.text.substring(0,e),this._.splitOffset=e,this.end=this.start+e,i._.isSplitNode=!0,this.style._.op&&ZWJSONUtils.cloneAndExtend(i.style._.op,this.style._.op),this.getDocument().insertAfter(i,this,!1),i}},ZWText.prototype.updateTextFormat=function(e){var t,i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n],n===ATTR_COMMON.CLS&&this.style._.op[ATTR_COMMON.CLS]&&this.style._.op[ATTR_COMMON.CLS]!==i[n]&&(i[n]=this.style._.op[ATTR_COMMON.CLS]+" "+i[n]));var o=[{r:this.start}];return o.push({as:{start:i,id:t=Utils.randomString()}}),o.push({r:this.length}),o.push({as:{end:ZWJSONUtils.getKeys(i),id:t}}),this.getDocument().composeMSG(o,!0),this},ZWText.prototype.setCase=function(e){switch(n.call(this,e),e){case TEXT_CASE.UPPER_CASE:this.setText(this.text.toUpperCase()),i.call(this);break;case TEXT_CASE.LOWER_CASE:this.setText(this.text.toLowerCase()),i.call(this);break;case TEXT_CASE.SMALL_CAPS:this.setText(this.text.toLowerCase());var o={};o[ATTR_TEXT.TS_FV]="small-caps",o[ATTR_COMMON.TYPE]=this.type,this.updateTextFormat(o);break;case TEXT_CASE.CAPITALIZE_WORD:case TEXT_CASE.SENTENCE_CASE:for(var r=Utils.getReplacedIndex(e,this.text),a=0;a<r.length;a++)r[a]=r[a]+this.start;var s=t.call(this,r);this.setText(s),i.call(this)}return this},ZWText.prototype.setText=function(e){if(e){var t=this.getDocument(),i=t.createRange();return i.start=0,i.end=this.end-this.start,t.replaceTextAtRange.call(t,this,i,e),this}}}(window),function(e){"use strict";e.ZWTab=function(){ZWInlineNode.call(this)},ZWTab.prototype=Object.create(ZWInlineNode.prototype),ZWTab.prototype.constructor=ZWFactory.nodes[NODE_TYPE.TAB]=ZWTab}(window),function(e){"use strict";e.ZWBR=function(){ZWInlineNode.call(this)},ZWBR.prototype=Object.create(ZWInlineNode.prototype),ZWBR.prototype.constructor=ZWFactory.nodes[NODE_TYPE.BR]=ZWBR}(window),function(e){"use strict";e.ZWBlockNode=function(){ZWNode.call(this)},ZWBlockNode.prototype=Object.create(ZWNode.prototype),ZWBlockNode.prototype.constructor=ZWBlockNode,ZWBlockNode.prototype.append=function(e){return this.getDocument().append(e,this),this},ZWBlockNode.prototype.prepend=function(e){var t=this.getFirstChild();return t?t.insertBefore(e):this.getDocument().append(e,this),this},ZWBlockNode.prototype.getAllDescendants=function(){var e=[],t=function(i){var n=this.getFirstChild();for(i&&e.push(this);n;)n.hasChildNodes()?t.call(n,!0):e.push(n),n=n.getNextSibling();return e};return function(){return e=[],t.call(this)}}(),ZWBlockNode.prototype.getChildNodeAt=function(e){var t=this.getChildNodes();if(e<0||t.length<=e)throw new TypeError("Child index is out of bounds!");return t[e]},ZWBlockNode.prototype.getChildNodes=function(){for(var e=[],t=this.getFirstChild();t;)t.type!==NODE_TYPE.TABLEEND&&e.push(t),t=t.getNextSibling();return e},ZWBlockNode.prototype.getFirstChild=function(){var e,t=this.getDocument();return!this.firstChild&&(e=ZWUtils.getDTNode.call(t,this))&&(e=e.getFirstChild())&&ZWUtils.getZWNode.call(t,e),this.firstChild},ZWBlockNode.prototype.getCurrentFirstChild=function(){var e,t,i=this.getDocument();if(!this.firstChild&&(e=ZWUtils.getDTNode.call(i,this))&&(e=e.getFirstChild())&&(t=ZWUtils.getZWNode.call(i,e)),this.firstChild)return this.firstChild;for(;t&&t._.isOrphan;)e=e&&e.next,t=e&&ZWUtils.getZWNode.call(i,e);return t||this.firstChild},ZWBlockNode.prototype.getLastChild=function(){var e,t=this.getDocument();return!this.lastChild&&(e=ZWUtils.getDTNode.call(t,this))&&(e=e.getLastChild())&&ZWUtils.getZWNode.call(t,e),this.lastChild},ZWBlockNode.prototype.getCurrentLastChild=function(){var e,t,i,n=this.getDocument();if(!this.lastChild&&(e=ZWUtils.getDTNode.call(n,this))&&(e=e.getLastChild())&&(t=ZWUtils.getZWNode.call(n,e)),this.lastChild)return this.lastChild;for(;t&&t._.isOrphan;)if(i=e,e=e&&e.prev,t=e&&ZWUtils.getZWNode.call(n,e),!t&&i){var o=ZWUtils.getNodeRange(this),r=ZWUtils.getNodeRange(i);r.start>o.start&&(e=i.getParent().prev)&&(e=e.getLastChild())&&(t=ZWUtils.getZWNode.call(n,e))}return t||this.lastChild},ZWBlockNode.prototype.getNoteFields=function(){var e,t,i=function(i){return e=i.getAllDescendants(),e.map(function(e){e instanceof ZWFieldStart&&(e=e.getField())&&(e.isFootnoteField()||e.isEndnoteField())&&t.push(e)}),t};return function(){return e=[],t=[],i(this)}}(),ZWBlockNode.prototype.hasEndChar=function(){return this.type==NODE_TYPE.TABLE||this.type==NODE_TYPE.TOC}}(window),function(e){"use strict";var t=new RegExp(FIELD_TYPE.ENDNOTE+"|"+FIELD_TYPE.FOOTNOTE+"|"+FIELD_TYPE.LINK);e.ZWParagraph=function(){ZWBlockNode.call(this)},ZWParagraph.prototype=Object.create(ZWBlockNode.prototype),ZWParagraph.prototype.constructor=ZWFactory.nodes[NODE_TYPE.PARAGRAPH]=ZWParagraph,ZWParagraph.prototype.appendField=function(e){if(!e||t.test(e.type))return this;var i=this.getDocument(),n=e.isAutoField(),o=e.isBookmarkField(),r=e.isFillableField(),a=e.isSignerField(),s=e.isNextRecordField(),l=e.isMailmergeField(),d=e.isPlaceholderField();if(n||r||a||s||l||d){var c,u=n?FIELD_TYPE.AUTO:e.type,p=a?e.getSignFieldType():"",g=r?e.getFillableFieldType():null,f=i.createNode(NODE_TYPE.FIELD_START,u),E=i.createNode(NODE_TYPE.FIELD_END,u);if(g===FILLABLEFIELD_TYPE.CHECKBOX){var T=e.getFillableFieldResult();c=i.createNode(NODE_TYPE.TEXT,T)}else if(!a||e._.op[ATTR_SIGNERFIELD.SIGNTYPE]!==SIGN_TYPE.ESIGN||p!==SIGNERFIELD_TYPE.SIGNATURE&&p!==SIGNERFIELD_TYPE.INITIAL){var T=n?e._.op[ATTR_AUTOFIELD.FIELDTYPE]===FIELD_TYPE.AUTO_PAGECOUNT?"##":"#":r&&e.getFillableFieldResult()||a&&Utils.getSignFieldContent(e)||s&&"#"||d&&e.getPlaceholderText()||l&&ZWUtils.getMergeFieldName(e._.op[MAILMERGE.MMINFO]);c=i.createNode(NODE_TYPE.TEXT,T);var m=ZWUtils.getTextFormat.call(this);m&&(c.style._.op=m,c.style._.op[ATTR_COMMON.TYPE]=NODE_TYPE.TEXT)}else c=i.createNode(NODE_TYPE.IMAGE),c.style[ATTR_IMAGE.I_SRC]=e._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SRC],c.style.width=(e._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SIZE].width||(p===SIGNERFIELD_TYPE.SIGNATURE?"300":"50"))+"px",c.style.height=(e._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SIZE].height||"50")+"px";g!==FILLABLEFIELD_TYPE.RADIO&&g!==FILLABLEFIELD_TYPE.MULTIPLECHOICE||(c.style.fontFamily=RENDERING_FONTS.CHECKBOXES_AND_RADIO_FIELDS),ZWJSONUtils.cloneAndExtend(f.style._.op,e._.op),!d&&(c.style._.op[ATTR_COMMON.FIELDINFO]=e.id),c.style._.op[ATTR_COMMON.CLS]=n?e._.op[ATTR_AUTOFIELD.FIELDTYPE]==FIELD_TYPE.CREATED_DATE||e._.op[ATTR_AUTOFIELD.FIELDTYPE]==FIELD_TYPE.LAST_MODIFIED_DATE?AUTOFIELD_TYPE.AUTO_DATE:e._.op[ATTR_AUTOFIELD.FIELDTYPE]:s?FIELD_TYPE.NEXT:e.type,E.style._.op.id=e.id,(s||l)&&(E.style._.op[ATTR_AUTOFIELD.FIELDTYPE]=e._.op[ATTR_AUTOFIELD.FIELDTYPE]),this.append(f),f.insertAfter(c),c.insertAfter(E)}else if(o){var f=i.createNode(NODE_TYPE.FIELD_START,FIELD_TYPE.BOOKMARK),E=i.createNode(NODE_TYPE.FIELD_END,FIELD_TYPE.BOOKMARK);ZWJSONUtils.cloneAndExtend(f.style._.op,e._.op),E.style._.op.id=e.id,this.append(f),f.insertAfter(E)}return this},ZWParagraph.prototype.clearFormat=function(){return this.setFormat(ATTR_PARAGRAPH.PS_NULL,!0)},ZWParagraph.prototype.getTabstops=function(){return this.style._.op[ATTR_PARAGRAPH.PS_TPS]},ZWParagraph.prototype.setTabstops=function(){return this},ZWParagraph.prototype.isHeading=function(){return this.style._.op.hasOwnProperty(ATTR_PARAGRAPH.PS_HD)&&/^[1-9]$/.test(this.style._.op[ATTR_PARAGRAPH.PS_HD])},ZWParagraph.prototype.isList=function(){return this.style._.op.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)},ZWParagraph.prototype.mergeToNextPara=function(){var e=this.getNextSibling(),t=this.end;if(e&&e.type===NODE_TYPE.PARAGRAPH){this.getFirstChild();var i,n=this.getCurrentLastChild(),o=this.getDocument();for(ZWDocument.setSkipCompose.call(o);n;){var r=e.getFirstChild();i=n.getPreviousSibling(),n.remove(),e.hasChildNodes()?r.insertBefore(n):e.append(n),n=i}return e.getFirstChild(),this.remove(),t-=UNICODE.PARAGRAPH.length,ZWDocument.resetSkipCompose.call(o),o.composeMSG([{r:t},{ds:UNICODE.PARAGRAPH}]),e}return this},ZWParagraph.prototype.splitAt=function(e){return this.getDocument().splitParagraphAt(this,e)},ZWParagraph.prototype.remove=function(){var e=this.getPreviousSibling(),t=this.getNextSibling();return(e&&e.type===NODE_TYPE.PARAGRAPH||t)&&(t&&t.type===NODE_TYPE.PARAGRAPH||e)?this.getDocument().removeNode(this):void this.getChildNodes().forEach(function(e){e.remove()})}}(window),function(e){"use strict";e.ZWPlaceholderField=function(e){ZWField.call(this),this.type=FIELD_TYPE.PLACEHOLDER,this._.text=e},ZWPlaceholderField.prototype=Object.create(ZWField.prototype),ZWPlaceholderField.prototype.constructor=ZWFactory.fields[NODE_TYPE.PLACEHOLDER]=ZWPlaceholderField,ZWPlaceholderField.prototype.getPlaceholderText=function(){return this._.text||""}}(window),function(e){"use strict";e.ZWHR=function(){ZWBlockNode.call(this)},ZWHR.prototype=Object.create(ZWBlockNode.prototype),ZWHR.prototype.constructor=ZWFactory.nodes[NODE_TYPE.HR]=ZWHR}(window),function(e){"use strict";e.ZWRepeatRange=function(e,t){ZWField.call(this);var i={};i[ATTR_AUTOFIELD.FIELDTYPE]=FIELD_TYPE.REPEAT_MERGE,i[MAILMERGE.MMINFO]=e||{},extend(this._.op,i),this.type=FIELD_TYPE.REPEAT_MERGE,this._.mergeFields=t},ZWRepeatRange.prototype=Object.create(ZWField.prototype),ZWRepeatRange.prototype.constructor=ZWFactory.fields[NODE_TYPE.REPEAT_START]=ZWRepeatRange,Object.defineProperties(ZWRepeatRange.prototype,{mminfo:{get:function(){return this._.op[MAILMERGE.MMINFO]},set:function(e){this._.op[MAILMERGE.MMINFO]=e,this.getDocument().updateField(this)}}}),ZWRepeatRange.prototype.remove=function(){var e=this.getDocument().getFieldRange(this),t=this.getStart();return this.getDocument().deleteContents(e),t&&!t._.isOrphan&&t.remove(),this}}(window),function(e){"use strict";e.ZWCell=function(){ZWBlockNode.call(this)},ZWCell.prototype=Object.create(ZWBlockNode.prototype),ZWCell.prototype.constructor=ZWFactory.nodes[NODE_TYPE.CELL]=ZWCell,ZWCell.prototype.getMatrixPosition=function(){return[this.getParent().getChildIndex(),this.getChildIndex()]},Object.defineProperties(ZWCell.prototype,{matrixPosition:{get:function(){return[this.getParent().getChildIndex(),this.getChildIndex()]}},merge:{get:function(){return this.style._.op.merge}},cspan:{get:function(){return this.style._.op.cspan}},rspan:{get:function(){return this.style._.op.rspan}},borders:{get:function(){return this.style._.op.borders}}}),ZWCell.prototype.remove=function(e){var t=this.getDocument();if(e)t.removeNode(this);else{var i=this.getChildNodes()||[],n=t.createNode(NODE_TYPE.PARAGRAPH);i.map(function(e){t.removeNode(e)}),this.append(n)}},ZWCell.prototype.setMergeType=function(e){var t={};return this.merge==ATTR_CELL_MRG.FC&&e!=ATTR_CELL_MRG.FC&&(t[ATTR_CELL.TDS_RSPAN]="",t[ATTR_CELL.TDS_CSPAN]=""),t[ATTR_CELL.TDS_MRG]=e,this.setFormats(t)},ZWCell.prototype.getRootMergeCell=function(){if(this.merge==ATTR_CELL_MRG.VMP||this.merge==ATTR_CELL_MRG.HMP){var e,t=this.getChildIndex();if(this.merge==ATTR_CELL_MRG.VMP)for(var i=this.getParent().getPreviousSibling();i;){if(e=i.getChildNodeAt(t),e&&e.merge==ATTR_CELL_MRG.FC)return e;i=i.getPreviousSibling()}else for(var e=this.getPreviousSibling();e;){if(e.merge==ATTR_CELL_MRG.FC||e.merge==ATTR_CELL_MRG.VMP)return e;e=e.getPreviousSibling()}}}}(window),function(e){"use strict";e.ZWRow=function(){ZWBlockNode.call(this)},ZWRow.prototype=Object.create(ZWBlockNode.prototype),ZWRow.prototype.constructor=ZWFactory.nodes[NODE_TYPE.ROW]=ZWRow;var t=function(e){try{var t=e.getPreviousSibling(),i=e.getNextSibling();if(!i&&!t)return e.getDocument().removeNode(e.getParent());for(var n,o,r,a,s,l,d,c=e.getChildNodes(),u=0;u<c.length;u++){n=c[u],o=n.rawFormat;for(l in o)if(l==ATTR_CELL.TDS_MRG||l==ATTR_COMMON.BORDERS)if(d=o[l],l==ATTR_CELL.TDS_MRG)d==ATTR_CELL_MRG.FC?(r=n.rspan||1,a=n.cspan||1,r>1&&i&&(s=i.getCellAtIndex(u),s&&s.setFormats({merge:ATTR_CELL_MRG.FC,cspan:a,rspan:r-1}))):d==ATTR_CELL_MRG.VMP&&(s=n.getRootMergeCell(),s&&s.setFormat(ATTR_CELL.TDS_RSPAN,s.rspan-1));else if(l==ATTR_COMMON.BORDERS){var p=e.getParent(),g=p&&p.borders,f=n.borders;if(g&&f){var E,T=g[ATTR_BORDERS.BORDER_TOP],m=g[ATTR_BORDERS.BORDER_BOTTOM],h=f[ATTR_BORDERS.BORDER_TOP],I=f[ATTR_BORDERS.BORDER_BOTTOM],_=e.getRowIdx();if(_==p.getChildNodes().length){s=t.getCellAtIndex(u);var E=ZWJSONUtils.clone(s.borders)||{};I&&m&&ZWJSONUtils.compareJSON(I,m)?E[ATTR_BORDERS.BORDER_BOTTOM]=I:h&&(E[ATTR_BORDERS.BORDER_BOTTOM]=h),s.setFormat(ATTR_COMMON.BORDERS,E)}else if(1==_){s=i.getCellAtIndex(u);var E=ZWJSONUtils.clone(s.borders)||{};h&&T&&ZWJSONUtils.compareJSON(h,T)?E[ATTR_BORDERS.BORDER_TOP]=h:I&&(E[ATTR_BORDERS.BORDER_BOTTOM]=I),s.setFormat(ATTR_COMMON.BORDERS,E)}}}}return e.getDocument().removeNode(e)}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_DELETE_ROW+"\nException: "+e.stack);var A=new Error(ZWCollaboration.TABLE_DELETE_ROW);throw editor.lastError=A,A}};ZWRow.prototype.remove=function(){var e,i=function(){e.map(function(e){ZWUtils.deleteNoteSection(e)})};return function(){(e=this.getNoteFields()).length&&i(),t(this)}}(),ZWRow.prototype.getCellAtIndex=function(e){var t=this.getChildNodes();if(e>=t.length||e<0)throw new TypeError("Cell index is out of bounds!");return t[e]},ZWRow.prototype.getRowIdx=function(){return this.getChildIndex()+1},ZWRow.prototype.getCellWithMaxRspan=function(){for(var e,t=0,i=this.getFirstChild();i;)i.rspan>t&&(t=i.rspan,e=i),i=i.next;return e}}(window),function(e){"use strict";e.ZWTable=function(e){ZWBlockNode.call(this)},ZWTable.prototype=Object.create(ZWBlockNode.prototype),ZWTable.prototype.constructor=ZWFactory.nodes[NODE_TYPE.TABLE]=ZWTable,ZWTable.prototype.constructTable=function(e){for(var t,i,n,o,r=this.getDocument(),a=e.rows,s=e.cols,l=0;l<a;l++){t=r.createNode(NODE_TYPE.ROW);for(var d=0;d<s;d++)o=r.createNode(NODE_TYPE.TEXT,""),n=r.createNode(NODE_TYPE.PARAGRAPH),n.append(o),i=r.createNode(NODE_TYPE.CELL),i.append(n),t.append(i);this.append(t)}},ZWTable.prototype.getColumnWidths=function(){var e=this.style.columnsWidth,t=this.getFirstChild();if(!e&&t){for(var i,n,o,r=this.style.width,a=r.indexOf(UNITS.PERCENTAGE)!=-1,s=!1,l=[],d=t.getChildNodes(),c=d.length,u=0;u<c;u++){if(n=d[u],o=n.style.cellWidth,i=!!o&&o.indexOf(UNITS.PERCENTAGE)!=-1,!o||"number"==typeof o||a!=i){s=!0;break}l.push(o)}if(e=[],s){var p,g;a?(p=parseFloat(r),g=(p/c).toFixed(2)+UNITS.PERCENTAGE):(p=parseFloat(Conversions.toGlobalValue(r)),g=(p/c).toFixed(2)+Conversions.globalUnit);for(var u=0;u<c;u++)e.push({wt:g})}else for(var u=0;u<l.length;u++)e.push({wt:l[u]})}return e},ZWTable.prototype.getRowAtIndex=function(e){var t=this.getChildNodes();if(e>=t.length||e<0)throw new TypeError("Row index is out of bounds!");return t[e]},ZWTable.prototype.setTCFormat=function(e){var t=TCConstants.TC,i=[this,t].concat(Array.prototype.slice.call(arguments));return this.getDocument().setFormat.apply(this.getDocument(),i),this};var t=function(e,t,i){if(e){t=t||1,i=i||1;for(var n=[],o=t,r=e.matrixPosition[1],a=e.getParent();a&&o>0;){for(var s=[],l=i,d=a.getCellAtIndex(r);d&&l;)s.push(d),d=d.getNextSibling(),l--;n.push(s),a=a.getNextSibling(),o--}return n}};ZWTable.prototype.mergeCells=function(e,i,n){if(e){i=i||1,n=n||1;var o=t(e,i,n);if(o)for(var r,a,s,l=o.length,d=0;d<l;d++){r=o[d],s=r.length;for(var c=0;c<s;c++){var a=r[c];if(0==d&&0==c){var u={};u[ATTR_CELL.TDS_MRG]=ATTR_CELL_MRG.FC,u[ATTR_CELL.TDS_RSPAN]=i,u[ATTR_CELL.TDS_CSPAN]=n,a.setFormats(u)}else 0==c?a.setMergeType(ATTR_CELL_MRG.VMP):a.setMergeType(ATTR_CELL_MRG.HMP)}}}},ZWTable.prototype.unMergeCells=function(e){if(e&&e.cellMerge==ATTR_CELL_MRG.FC){var i=t(e,e.cellRowSpan,e.cellColSpan);if(i)for(var n,o,r,a=i.length,s=0;s<a;s++){n=i[s],r=n.length;for(var l=0;l<r;l++){var o=n[l];if(0==s&&0==l){var d={};d[ATTR_CELL.TDS_MRG]="",d[ATTR_CELL.TDS_RSPAN]="",d[ATTR_CELL.TDS_CSPAN]="",o.setFormats(d)}else 0==l?o.setMergeType(""):o.setMergeType("")}}}};var i=function(e,t,i,n){try{var o=e.getDocument(),r=!1;i&&!t.getNextSibling()&&(r=!0);var a,s,l,d,c,u,p=e,g=p.getChildNodes(),f=p.getColumnWidths().length,E=t,T=E.getRowIdx(),m=E.getChildNodes(),h=E.rawFormat;h&&h.mminfo&&(h.mminfo="");for(var I,_,A,S,R=0;R<n;R++){a=o.createNode(NODE_TYPE.ROW),a.setFormats(h);for(var O=0;O<f;O++){u=m[O],A={},I=u.rawFormat;for(d in I)if(d!=ATTR_COMMON.ID&&d!=ATTR_CELL.TDS_WID&&d!=ATTR_CELL.TDS_RSPAN&&d!=ATTR_CELL.TDS_CSPAN){switch(c=I[d],d){case ATTR_CELL.TDS_MRG:c==ATTR_CELL_MRG.FC?i?r?(A[ATTR_CELL.TDS_RSPAN]=1,A[ATTR_CELL.TDS_CSPAN]=u.cellColSpan):(c=ATTR_CELL_MRG.VMP,u.setFormat(ATTR_CELL.TDS_RSPAN,u.cellRowSpan+1)):(A[ATTR_CELL.TDS_RSPAN]=1,A[ATTR_CELL.TDS_CSPAN]=u.cellColSpan):c==ATTR_CELL_MRG.VMP&&(S=u.getRootMergeCell(),i&&r?(c=ATTR_CELL_MRG.FC,A[ATTR_CELL.TDS_RSPAN]=1,A[ATTR_CELL.TDS_CSPAN]=S.cellColSpan):S.setFormat(ATTR_CELL.TDS_RSPAN,S.cellRowSpan+1));break;case ATTR_COMMON.BORDERS:var b=e.style.borders;if(b){var v=b[ATTR_BORDERS.BORDER_TOP],D=b[ATTR_BORDERS.BORDER_BOTTOM],L=c[ATTR_BORDERS.BORDER_TOP],N=c[ATTR_BORDERS.BORDER_BOTTOM];if(i)if(T==g.length&&D&&N){if(ZWJSONUtils.compareJSON(N,D)){var P=DocUtil.copyStyle(c);delete P[ATTR_BORDERS.BORDER_BOTTOM],u.setFormat(ATTR_COMMON.BORDERS,P)}}else 1==T&&v&&L&&ZWJSONUtils.compareJSON(L,v)&&delete c[ATTR_BORDERS.BORDER_TOP];else if(T==g.length&&D&&N)ZWJSONUtils.compareJSON(N,D)&&delete c[ATTR_BORDERS.BORDER_BOTTOM];else if(1==T&&v&&L&&ZWJSONUtils.compareJSON(L,v)){var P=DocUtil.copyStyle(c);delete P[ATTR_BORDERS.BORDER_TOP],u.setFormat(ATTR_COMMON.BORDERS,P)}}}if(c){if("object"==typeof c&&0==Object.keys(c).length)continue;A[d]=c}}_=u.getFirstChild().rawFormat,l=o.createNode(NODE_TYPE.PARAGRAPH),l.setFormats(_),s=o.createNode(NODE_TYPE.CELL),s.setFormats(A),s.append(l),a.append(s)}r?e.append(a):i?E.insertAfter(a):i||E.insertBefore(a)}}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_INSERT_ROW+"\nException: "+e.stack);var C=new Error(ZWCollaboration.TABLE_INSERT_ROW);throw editor.lastError=C,C}};ZWTable.prototype.insertRowAfter=function(e,t){if("undefined"!=typeof e){t||(t=1);var n=this.getRowAtIndex(e-1);return i(this,n,!0,t),this}},ZWTable.prototype.insertRowBefore=function(e,t){if("undefined"!=typeof e){t||(t=1);var n=this.getRowAtIndex(e-1);return i(this,n,!1,t),this}},ZWTable.prototype.deleteRow=function(e){var t=e-1,i=this.getChildNodes();if(!(t<0||t>=i.length))return 1==i.length?void this.remove():(i[t].remove(),this)};var n=function(e,t,i,n){try{var o=e.getDocument(),r=!1,a=e,s=a.getFirstChild(),l=s.getCellAtIndex(t);i&&!l.getNextSibling()&&(r=!0);var d=a.style.width,c=a.getColumnWidths().slice(0),u=!1,p=(c[t],[]);d&&d.indexOf(UNITS.PERCENTAGE)!==-1&&(u=!0);for(var g,f=0,E=0,T=0;T<c.length;T++)if(g=c[T],g=u?parseFloat(g.wt):Conversions.toPixels(g.wt),f+=g,E+=g,p.push(g),T==t)for(var m=n;m>0;)E+=g,p.push(g),m--;for(var T=0;T<p.length;T++)g=p[T],g=g/E*f,g=g.toFixed(2),p[T]={},u?p[T][ATTR_CELL.TDS_COL_WT]=g+UNITS.PERCENTAGE:p[T][ATTR_CELL.TDS_COL_WT]=Conversions.toGlobalValue(g+UNITS.PIXELS);a.setFormat(ATTR_TABLE.TBLS_COLS,p);for(var h,I,_,A,S,R,O,g;s;)if(l=s.getCellAtIndex(t)){h=l.rawFormat;for(var T=0;T<n;T++){I={};for(O in h)if(O!=ATTR_COMMON.ID&&O!=ATTR_CELL.TDS_WID&&O!=ATTR_CELL.TDS_RSPAN&&O!=ATTR_CELL.TDS_CSPAN){switch(g=h[O],O){case ATTR_CELL.TDS_MRG:if(g==ATTR_CELL_MRG.FC&&!i||g==ATTR_CELL_MRG.VMP&&!i||g==ATTR_CELL_MRG.HMP&&i&&r)continue;g==ATTR_CELL_MRG.FC?(g=ATTR_CELL_MRG.HMP,l.setFormat(ATTR_CELL.TDS_CSPAN,l.cellColSpan+1)):g==ATTR_CELL_MRG.HMP?(A=l.getRootMergeCell(),A.cellMerge==ATTR_CELL_MRG.FC&&A.setFormat(ATTR_CELL.TDS_CSPAN,A.cellColSpan+1)):g=ATTR_CELL_MRG.HMP;break;case ATTR_COMMON.BORDERS:var b=a.style.borders;if(b){var v=b[ATTR_BORDERS.BORDER_LEFT],D=b[ATTR_BORDERS.BORDER_RIGHT],L=g[ATTR_BORDERS.BORDER_LEFT],N=g[ATTR_BORDERS.BORDER_RIGHT];if(i)if(t+1==c.length&&D&&N){if(ZWJSONUtils.compareJSON(N,D)){var P=DocUtil.copyStyle(g);delete P[ATTR_BORDERS.BORDER_RIGHT],l.setFormat(ATTR_COMMON.BORDERS,P)}}else 0==t&&v&&L&&ZWJSONUtils.compareJSON(L,v)&&delete g[ATTR_BORDERS.BORDER_LEFT];else if(t+1==c.length&&D&&N)ZWJSONUtils.compareJSON(N,D)&&delete g[ATTR_BORDERS.BORDER_RIGHT];else if(0==t&&v&&L&&ZWJSONUtils.compareJSON(L,v)){var P=DocUtil.copyStyle(g);delete P[ATTR_BORDERS.BORDER_LEFT],l.setFormat(ATTR_COMMON.BORDERS,P)}}}if(g){if("object"==typeof g&&0==Object.keys(g).length)continue;I[O]=g}}_=l.getFirstChild().rawFormat,R=o.createNode(NODE_TYPE.PARAGRAPH),R.setFormats(_),S=o.createNode(NODE_TYPE.CELL),S.setFormats(I),S.append(R),i?l.insertAfter(S):l.insertBefore(S)}s=s.getNextSibling()}else s=s.nextSibling()}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_INSERT_COLUMN+"\nException: "+e.stack);var C=new Error(ZWCollaboration.TABLE_INSERT_COLUMN);throw editor.lastError=C,C}};ZWTable.prototype.insertColumnAfter=function(e,t){if("undefined"!=typeof e)return t||(t=1),n(this,e-1,!0,t),this},ZWTable.prototype.insertColumnBefore=function(e,t){if("undefined"!=typeof e)return t||(t=1),n(this,e-1,!1,t),this};var o=function(e,t){try{var i=e,n=t-1,o=i.style.width,r=i.getColumnWidths().slice(0),a=r.slice(0);if(n<0||n>=a.length)return;if(1==a.length)return void i.remove();a.splice(n,1);var s=!1;o.indexOf(UNITS.PERCENTAGE)!=-1&&(s=!0);var l=[],d=0;if(s)for(var c=0;c<a.length;c++)d+=parseFloat(a[c].wt);else for(var c=0;c<a.length;c++)d+=parseFloat(Conversions.toPixels(a[c].wt));if(s){for(var u=parseFloat(o),c=0;c<a.length;c++){var p=parseFloat(a[c].wt)/d*u;l.push({wt:p.toFixed(2)+UNITS.PERCENTAGE})}d=d.toFixed(2)+UNITS.PERCENTAGE}else l=a,d=Conversions.toGlobalValue(d+UNITS.PIXELS);i.setFormats({cols:l,wid:d});for(var g,f,E,T=i.getChildNodes(),m=i.style.borders,c=0;c<T.length;c++){if(g=T[c],f=g.getCellAtIndex(n),E=f.style.cellBorders,f.cellMerge)switch(f.cellMerge){case ATTR_CELL_MRG.FC:if(f.cellColSpan>1){var h=f.getNextSibling();h.setFormats({merge:ATTR_CELL_MRG.FC,rspan:f.cellRowSpan,cspan:f.cellColSpan-1})}break;case ATTR_CELL_MRG.VMP:var I=f.getRootMergeCell();if(I.cellColSpan>1){var h=f.getNextSibling();h.setFormat(ATTR_CELL.TDS_MRG,ATTR_CELL_MRG.VMP)}break;case ATTR_CELL_MRG.HMP:var I=f.getRootMergeCell();"fc"==I.cellMerge&&I.setFormat(ATTR_CELL.TDS_CSPAN,I.cellColSpan-1)}if(m&&E){var _=f.getPreviousSibling(),h=f.getNextSibling(),A=m[ATTR_BORDERS.BORDER_LEFT]||{},S=m[ATTR_BORDERS.BORDER_RIGHT]||{},R=E[ATTR_BORDERS.BORDER_LEFT]||{},O=E[ATTR_BORDERS.BORDER_RIGHT]||{};if(t==r.length&&S&&O&&_){if(ZWJSONUtils.compareJSON(S,O)){var b=_.style.cellBorders||{};b[ATTR_BORDERS.BORDER_RIGHT]=O,_.setFormat(ATTR_COMMON.BORDERS,b)}}else if(1==t&&A&&R&&h&&ZWJSONUtils.compareJSON(A,R)){var b=h.style.cellBorders||{};b[ATTR_BORDERS.BORDER_LEFT]=R,h.setFormat(ATTR_COMMON.BORDERS,b)}}f.remove(!0)}}catch(e){ZWLogger.log("_"+ZWCollaboration.TABLE_DELETE_COLUMN+"\nException: "+e.stack);var v=new Error(ZWCollaboration.TABLE_DELETE_COLUMN);throw editor.lastError=v,v}};ZWTable.prototype.deleteColumn=function(e){if("undefined"!=typeof e)return o(this,e),this}}(window),function(e){"use strict";e.ZWTableEnd=function(){ZWInlineNode.call(this)},ZWTableEnd.prototype=Object.create(ZWInlineNode.prototype),ZWTableEnd.prototype.constructor=ZWFactory.nodes[NODE_TYPE.TABLEEND]=ZWTableEnd}(window),function(e){"use strict";e.ZWTextBox=function(){ZWImage.call(this)},ZWTextBox.prototype=Object.create(ZWImage.prototype),ZWTextBox.prototype.constructor=ZWFactory.nodes[NODE_TYPE.TEXTBOX]=ZWTextBox,ZWTextBox.prototype.remove=function(){ZWImage.prototype.remove.call(this);var e=this,t=this.getDocument().getAllSections();t.map(function(t){t.style._.op[ATTR_SECTION.ST]==NODE_TYPE.TEXTBOX&&t.style._.op[ATTR_SECTION.SID]==e.style._.op[ATTR_COMMON.ID]&&t.remove()})},ZWTextBox.prototype.getMaxLength=function(){return this.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_MAX_LENGTH]||30},ZWTextBox.prototype.getSection=function(){for(var e,t=this,i=this.getDocument().getAllSections(),n=0;n<i.length;n++)if(e=i[n],e.style._.op[ATTR_SECTION.ST]==NODE_TYPE.TEXTBOX&&e.style._.op[ATTR_SECTION.SID]==t.style._.op.id)return e},ZWTextBox.prototype.setMaxLength=function(e){this.getDocument().updateField(this,[ATTR_FILLABLEFIELD.FF_MAX_LENGTH],[e])}}(window),function(e){"use strict";e.ZWTOCStart=function(){ZWBlockNode.call(this)},ZWTOCStart.prototype=Object.create(ZWBlockNode.prototype),ZWTOCStart.prototype.constructor=ZWFactory.nodes[NODE_TYPE.TOC]=ZWTOCStart,ZWTOCStart.prototype.setTCFormat=function(e){var t=TCConstants.TC,i=[this,t].concat(Array.prototype.slice.call(arguments));return this.getDocument().setFormat.apply(this.getDocument(),i),this}}(window),function(e){"use strict";e.ZWTOCEnd=function(){ZWInlineNode.call(this)},ZWTOCEnd.prototype=Object.create(ZWInlineNode.prototype),ZWTOCEnd.prototype.constructor=ZWFactory.nodes[NODE_TYPE.TOCEND]=ZWTOCEnd}(window),function(e){"use strict";e.ZWSection=function(){ZWBlockNode.call(this)},ZWSection.prototype=Object.create(ZWBlockNode.prototype),ZWSection.prototype.constructor=ZWFactory.nodes[NODE_TYPE.SECTION]=ZWSection,ZWSection.prototype.getHeaderType=function(){return this.style._.op.hftype},ZWSection.prototype.getFooterType=function(){return this.style._.op.hftype},ZWSection.prototype.isBody=function(){return SECTION_TYPE.CONTENT===this.style._.op[ATTR_SECTION.ST]},ZWSection.prototype.isEndnote=function(){return NODE_TYPE.ENDNOTE===this.style._.op[ATTR_SECTION.ST]},ZWSection.prototype.isFootnote=function(){return NODE_TYPE.FOOTNOTE===this.style._.op[ATTR_SECTION.ST]},ZWSection.prototype.isTextBox=function(){return NODE_TYPE.TEXTBOX===this.style._.op[ATTR_SECTION.ST]},ZWSection.prototype.isHeader=function(){return allowedHdrFtrRegex.header.test(this.style._.op.hftype)},ZWSection.prototype.isFooter=function(){return allowedHdrFtrRegex.footer.test(this.style._.op.hftype)},ZWSection.prototype.getSID=function(){return this.style._.op[ATTR_SECTION.SID]},ZWSection.prototype.getSectionType=function(){return this.style._.op[ATTR_SECTION.ST]},ZWSection.prototype.getBreakType=function(){return this.style._.op[ATTR_SECTION.BREAK_TYPE]};var t=[ATTR_SECTION.PS,ATTR_SECTION.PW,ATTR_SECTION.PH,ATTR_SECTION.OR];ZWSection.prototype.setStyle=function(e,i){var n=ZWJSONUtils.clone(e);n.type=NODE_TYPE.SECTION;var o=e[ATTR_SECTION.BREAK_TYPE],r=!1;if(this.getBreakType()==BREAK_TYPES.CONTINUOUS&&(!o||o==BREAK_TYPES.CONTINUOUS))for(var a=this.style._.op,s=0;s<t.length;s++){var l=t[s];if(e.hasOwnProperty(l)&&e[l]!=a[l]){n[ATTR_SECTION.BREAK_TYPE]=BREAK_TYPES.NEXT_PAGE,r=!0;break}}if(i&&r){var d=i.style._.op;d[ATTR_SECTION.BREAK_TYPE]=BREAK_TYPES.NEXT_PAGE,ZWJSONUtils.deepMerge(i.style._.op,d),i.getDocument().setFormats(i,d)}return ZWJSONUtils.deepMerge(this.style._.op,n),this.getDocument().setFormats(this,n)},ZWSection.prototype.getStylesForNewSection=function(e){var t={},i=this.style._.op[ATTR_SECTION.ST];switch(t[ATTR_SECTION.SID]=Utils.randomId(i),t[ATTR_COMMON.TYPE]=this.style._.op[ATTR_COMMON.TYPE],t[ATTR_SECTION.ST]=i,t[ATTR_SECTION.BREAK_TYPE]=BREAK_TYPES.CONTINUOUS,i){case SECTION_TYPES.CONTENT:t[ATTR_SECTION.PS]=this.style._.op[ATTR_SECTION.PS],t[ATTR_SECTION.OR]=this.style._.op[ATTR_SECTION.OR],t[ATTR_SECTION.PW]=this.style._.op[ATTR_SECTION.PW],t[ATTR_SECTION.PH]=this.style._.op[ATTR_SECTION.PH],t[ATTR_SECTION.MT]=this.style._.op[ATTR_SECTION.MT],t[ATTR_SECTION.ML]=this.style._.op[ATTR_SECTION.ML],t[ATTR_SECTION.MB]=this.style._.op[ATTR_SECTION.MB],t[ATTR_SECTION.MR]=this.style._.op[ATTR_SECTION.MR],t[ATTR_SECTION.HT]=this.style._.op[ATTR_SECTION.HT],t[ATTR_SECTION.FB]=this.style._.op[ATTR_SECTION.FB],t[ATTR_SECTION.COLS]=ZWJSONUtils.clone(this.style._.op[ATTR_SECTION.COLS]),t[ATTR_SECTION.HF_TYPE]=this.style._.op[ATTR_SECTION.HF_TYPE];break;case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:break;case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:}return extend(t,e||{}),t}}(window),function(e){"use strict";e.ZWBarcode=function(){ZWImage.call(this)},ZWBarcode.prototype=Object.create(ZWImage.prototype),ZWBarcode.prototype.constructor=ZWFactory.nodes[NODE_TYPE.BARCODE]=ZWBarcode,Object.defineProperties(ZWBarcode.prototype,{barcode_info:{get:function(){return this.style._.op[ATTR_IMAGE.BARCODE_INFO]},set:function(e){this.style._.op[ATTR_IMAGE.BARCODE_INFO]=e,this.setFormat(ATTR_IMAGE.BARCODE_INFO,e)}},mminfo:{get:function(){return this.style._.op[MAILMERGE.MMINFO]},set:function(e){this.style._.op[MAILMERGE.MMINFO]=e,this.setFormat(MAILMERGE.MMINFO,e)}}}),ZWBarcode.prototype.setBarcodeInfo=function(e){return e?this.setFormat(ATTR_IMAGE.BARCODE_INFO,e):this},ZWBarcode.prototype.setMMInfo=function(e){return this.setFormat(MAILMERGE.MMINFO,e)}}(window),function(e){"use strict";e.ZWQRCode=function(){ZWImage.call(this)},ZWQRCode.prototype=Object.create(ZWImage.prototype),ZWQRCode.prototype.constructor=ZWFactory.nodes[NODE_TYPE.QRCODE]=ZWQRCode,Object.defineProperties(ZWQRCode.prototype,{qrcode_info:{get:function(){return this.style._.op[ATTR_IMAGE.QRCODE_INFO]},set:function(e){this.style._.op[ATTR_IMAGE.QRCODE_INFO]=e,this.setFormat(ATTR_IMAGE.QRCODE_INFO,e)}},mminfo:{get:function(){return this.style._.op[MAILMERGE.MMINFO]},set:function(e){this.style._.op[MAILMERGE.MMINFO]=e,this.setFormat(MAILMERGE.MMINFO,e)}}}),ZWQRCode.prototype.setQRCodeInfo=function(e){return e?this.setFormat(ATTR_IMAGE.QRCODE_INFO,e):this},ZWQRCode.prototype.setMMInfo=function(e){return this.setFormat(MAILMERGE.MMINFO,e)}}(window),function(e){"use strict";var t=function(e){var t={};t.composedDocOps=DocOpBuilder.build([]),t.uncomposedDocOps=DocOpBuilder.build([]),t.content="undefined"!=typeof editor&&editor.doc&&!isHeadlessHTML?editor.doc.getContent(0,editor.doc.getDocumentLength()):UNICODE.SECTION_START+UNICODE.PARAGRAPH+UNICODE.SECTION_START+UNICODE.PARAGRAPH+UNICODE.SECTION_START+UNICODE.PARAGRAPH,t.cursorOp=[],t.dtNodes2zwNodesMap={},t.fieldsMap=null,t.namedRanges={map:null,order:null},t.commentRanges={map:null,order:null},t.op={type:NODE_TYPE.BODY},t.pageSetup=null,t.skipCompose=!1,t.zwNodesList=new ZWLinkedList,e&&(t.dtDoc=e),t.selection=new ZWDocSelection,this._=t},n="none",o=function(e,t){e&&e._.dtDoc&&t&&(e._.content=editor.doc.getContent(0,editor.doc.getDocumentLength()),ZWJSONUtils.cloneAndExtend(e._.op={type:NODE_TYPE.BODY},t))},r=function(e){this._.selection=this._.selection||new ZWDocSelection;var t=this._.selection;t.flushOp();for(var i,n,o,r=0,a=e.length;r<a;r++)i=e.getRangeAt(r),n=this.createRange(),(o=ZWUtils.getDTNodeAt.call(this,n.start=i.start))&&ZWUtils.getZWNode.call(this,o),(o=ZWUtils.getDTNodeAt.call(this,n.end=i.end))&&ZWUtils.getZWNode.call(this,o),t.pushOp(n);t.applyOp(this._.composedDocOps)},a=function(e,t){t.type=NODE_TYPE.BODY;var i,n=[{r:0}];n.push({as:{start:t,id:i=Utils.randomString()}}),n.push({r:0}),n.push({as:{end:ZWJSONUtils.getKeys(t),id:i}}),l.call(e,n)},s=function(e){var t,i,n=[{r:e.start}];H(e,function(e){e._.isOrphan=0,n.push({as:{start:t=e.style._.op,id:i=Utils.randomString()}}),n.push({is:e.text||ZWUtils.getUnicodeChar(e)}),n.push({as:{end:ZWJSONUtils.getKeys(t),id:i}})}),l.call(e.getDocument(),n)},l=function(){var e=function(e,t,i){var n=DocOpBuilder.build(e);return!t&&this._.selection&&this._.selection.applyOp(n),i=DocOpBuilder.compose(i,n),i=DocOpBuilder.concise(i)};return function(t,i){return this._.skipCompose?void(this._.uncomposedDocOps=e.call(this,t,!0,this._.uncomposedDocOps)):void(this._.composedDocOps=e.call(this,t,i,this._.composedDocOps))}}(),d=function(e){"undefined"!=typeof Op&&(Op.processMsg(e),Op.sendMsg())},c=function(){this._.skipCompose=!0},u=function(){this._.skipCompose=!1,this._.uncomposedDocOps=DocOpBuilder.build([])},p=function(e,t){var i=new ZRange(t.getIndex(),t.getEndIndex()+(t.type===NODE_TYPE.SECTION?0:1)),n=[{r:i.start},{is:Array(i.length).join(".")}],o=[{r:i.end},{is:Array(i.length).join(".")}],r=DocOpBuilder.xform(this._.composedDocOps,DocOpBuilder.build(n)).second,a=DocOpBuilder.xform(this._.composedDocOps,DocOpBuilder.build(o)).second;r=DocOpBuilder.xform(this._.uncomposedDocOps,r).second,a=DocOpBuilder.xform(this._.uncomposedDocOps,a).second;var s=DocOpBuilder.concise(r),l=DocOpBuilder.concise(a);e.start=s.docOps[0].retain_count,e.end=l.docOps[0].retain_count},g=function(e,t){var i,n=[];switch(e&&e.type){case NODE_TYPE.PARAGRAPH:var o=DocumentDesign.getComputedParaStyle("h"+(e.style.headingType||0));o[ATTR_PARAGRAPH.PS_TS]=o.textFormat,delete o.textFormat,delete o[TCConstants.TC],ZWJSONUtils.cloneAndExtend(i={},e.style._.op),i=DocUtil.mergeObjs([o,i]),t===NODE_TYPE.TEXT&&(i=i[ATTR_PARAGRAPH.PS_TS]);case NODE_TYPE.TEXT:i||(ZWJSONUtils.cloneAndExtend(i={},e.style._.op),delete i[TCConstants.TC]),n.push(i),n=n.concat(g(e.getParent(),e.type));break;case NODE_TYPE.FIELD_START:case NODE_TYPE.FIELD_END:ZWJSONUtils.cloneAndExtend(i={},e.style._.op),n.push(i)}return n},f=function(e){return Array.prototype.slice.call(e)},E=function(e){if(e.isInlineNode())return{};var t,i=e&&e.getFirstChild(),n={};switch(e.type){case NODE_TYPE.PARAGRAPH:for(;i&&!i._.isOrphan;)i.type!==NODE_TYPE.FIELD_START&&i.type!==NODE_TYPE.FIELD_END||(n.hasOwnProperty(t=i.style._.op.id)?delete n[t]:n[t]=i),i=i.getNextSibling();case NODE_TYPE.TABLE:case NODE_TYPE.ROW:case NODE_TYPE.CELL:for(var o,r;i&&!i._.isOrphan;){o=E(i);for(r in o)n.hasOwnProperty(r)?delete n[r]:n[r]=o[r];i=i.getNextSibling()}}return n},T=function(e){var t,i={};return e.visitNodes({handleNodeStart:function(e){e.type!==NODE_TYPE.FIELD_START&&e.type!==NODE_TYPE.FIELD_END||(i.hasOwnProperty(t=e.style._.op.id)?delete i[t]:i[t]=e)},handleNodeEnd:function(e){}}),i},m=function(e){if(e.type===NODE_TYPE.CELL||e.type===NODE_TYPE.ROW||e.type===NODE_TYPE.TABLE||e.type===NODE_TYPE.PARAGRAPH)return e;var t=e.lastChild;if(t)return m(t);if(!(t=e.firstChild))return e;for(;e;){if(!t.nextSibling)return m(t);t=t.nextSibling}},h=function(e){var t=(this._.zwNodesList.firstItem,0);!t&&this._.zwNodesList.addItem(e)},I=function(e,t){for(var i,n,o,r=e.getDocument(),a=0,s=t.children[a];s;){if(o=t.children[++a],n=r._.dtNodes2zwNodesMap[s.id]){if(1===a)for(i=n;i;){if(e.firstChild=i,i._.isOrphan&&!i._.isNewNode&&!i.previousSibling){for(var l=o,d=l&&r._.dtNodes2zwNodesMap[l.id];l&&d&&d._.isOrphan;)l=l.next,d=l&&r._.dtNodes2zwNodesMap[l.id];var c=n._.isOrphan?d:n;e.firstChild=c,i=c?c:i}i=i.previousSibling}if(!n.parent&&(n.parent=e),!o&&!e.lastChild)for(i=n;i;){if(e.lastChild=i,i._.isOrphan&&!i._.isNewNode&&!i.nextSibling){for(var u=s.prev,d=u&&r._.dtNodes2zwNodesMap[u.id];u&&d&&d._.isOrphan;)u=u.prev,d=u&&r._.dtNodes2zwNodesMap[u.id];var p=n._.isOrphan?d:n;e.lastChild=p,i=p?p:i}i=i.nextSibling}}s=o}},_=function(e,t){if(I(e,t),e.type!==NODE_TYPE.SECTION){var i,n;(i=t.getParent())&&(n=e.getDocument()._.dtNodes2zwNodesMap[i.id])&&(e.parent=n,I(n,i)),A(e,t.getPreviousSibling(),"nextSibling"),A(e,t.getNextSibling(),"previousSibling")}},A=function(e,t,i){var n;if(t){if((n=e.getDocument()._.dtNodes2zwNodesMap[t.id])&&e.getDocument()._.zwNodesList.items.hasOwnProperty(t.id)){for(var o,r=n[i];r&&(o=r[i])&&o._.dtNodeId!==t.id;)r=o;r=r||n,r[i]=e,e["previousSibling"===i?"nextSibling":"previousSibling"]=r}}else if("previousSibling"===i&&e.parent&&e.parent.lastChild&&!e.parent.lastChild.isEqualNode(e))for(var r=e.parent.lastChild;r;){if(!r.isEqualNode(e)&&!r[i]){e["previousSibling"===i?"nextSibling":"previousSibling"]=r,r[i]=e;break}r=r[i]}},S=function(e){for(var t=e.getDocument(),i=e;i&&i.end<=e.end;)t._.zwNodesList.removeItem(i),i._.isOrphan=1,i=i._.nextItem},R=function(e,t,i){if(e&&e.id)for(var n=this._.zwNodesList.firstItem;n;){if(n.type===NODE_TYPE.FIELD_START&&n.style._.op.id===e.id){if(n._.isOrphan)return;ZWJSONUtils.cloneAndExtend(n.style._.op={},e._.op);var o,r,a=n.getNextSibling(),s=a.text+"",d=n.style._.op.id,c=e._.op[ATTR_AUTOFIELD.FIELDTYPE],u=i?"#":t||(new Date).getTime(),p=u.length-s.length,g=[{r:n.start}];return g.push({as:{start:o=n.style._.op,id:r=Utils.randomString()}}),g.push({r:UNICODE.RANGE_START.length}),g.push({as:{end:ZWJSONUtils.getKeys(o),id:r}}),i&&"#"===s||(g.push({ds:s}),o=a.style._.op,o[ATTR_COMMON.CLS]=c==FIELD_TYPE.LAST_MODIFIED_DATE||c==FIELD_TYPE.CREATED_DATE?AUTOFIELD_TYPE.AUTO_DATE:c,o[ATTR_COMMON.FIELDINFO]=d,g.push({as:{start:o,id:r=Utils.randomString()}}),g.push({is:u}),g.push({as:{end:ZWJSONUtils.getKeys(o),id:r}}),a.text=t,a.end+=p,x(a,p),U(a,p,a._.nextItem)),void l.call(e.getDocument(),g)}n=n._.nextItem}},O=function(e,t,i){if(e&&e.id)for(var n=this._.zwNodesList.firstItem;n;){if(n.type===NODE_TYPE.FIELD_START&&n.style._.op.id===e.id){if(n._.isOrphan)return;ZWJSONUtils.cloneAndExtend(n.style._.op={},e._.op);var o,r,a=[{r:n.start}];return a.push({as:{start:o=n.style._.op,id:r=Utils.randomString()}}),a.push({r:UNICODE.RANGE_START.length}),a.push({as:{end:ZWJSONUtils.getKeys(o),id:r}}),void l.call(e.getDocument(),a)}n=n._.nextItem}},b=function(e){if(e&&e.id)for(var t=this._.zwNodesList.firstItem;t;){if(t.type===NODE_TYPE.FIELD_START&&t.style._.op.id===e.id){if(t._.isOrphan)return;ZWJSONUtils.cloneAndExtend(t.style._.op={},e._.op);var i,n,o=(t.style._.op.id,[{r:t.start}]);return o.push({as:{start:i=t.style._.op,id:n=Utils.randomString()}}),o.push({r:UNICODE.RANGE_START.length}),o.push({as:{end:ZWJSONUtils.getKeys(i),id:n}}),void l.call(e.getDocument(),o)}t=t._.nextItem}},v=function(e,t,i,n){if(e&&e.id)for(var o=this._.zwNodesList.firstItem;o;){if(o.type===NODE_TYPE.FIELD_START&&o.style._.op.id===e.id){if(o._.isOrphan)return;ZWJSONUtils.cloneAndExtend(o.style._.op={},e._.op);var r,a,s=o.getNextSibling(),d=s.getContent()+"",c=e._.op[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.ESIGN&&(t===SIGNERFIELD_TYPE.SIGNATURE||t===SIGNERFIELD_TYPE.INITIAL),u=o.style._.op.id,p=i.length-d.length,g=c?i:Utils.getSignFieldContent(e),f=[{r:o.start}];if(f.push({as:{start:r=o.style._.op,id:a=Utils.randomString()}}),f.push({r:UNICODE.RANGE_START.length}),f.push({as:{end:ZWJSONUtils.getKeys(r),id:a}}),!n){if(c)return r={type:NODE_TYPE.IMAGE},r[ATTR_COMMON.CLS]=NODE_TYPE.SIGNERFIELD,r[ATTR_COMMON.FIELDINFO]=u,r[ATTR_IMAGE.I_SRC]=i,f.push({as:{start:r,id:a=Utils.randomString()}}),f.push({r:UNICODE.IMAGE.length}),f.push({as:{end:ZWJSONUtils.getKeys(r),id:a}}),void l.call(e.getDocument(),f);f.push({ds:d}),r=s.style._.op,r[ATTR_COMMON.CLS]=NODE_TYPE.SIGNERFIELD,r[ATTR_COMMON.FIELDINFO]=u,delete r[ATTR_TEXT.TS_FV],f.push({as:{start:r,id:a=Utils.randomString()}}),f.push({is:g}),f.push({as:{end:ZWJSONUtils.getKeys(r),id:a}}),s.text=i,s.end+=p,x(s,p),U(s,p,s._.nextItem)}return void l.call(e.getDocument(),f)}o=o._.nextItem}},D=function(e,t,i,n,o){var r=e.isSignerField()&&e.isSignerImageField();if(e&&(e.isFillableImageField()||r))for(var a,s,d,c,u,p,g,f,E,T,m=this._.zwNodesList.firstItem,h=0,I=r?e.style._.op[ATTR_SIGNERFIELD.SFINFO]:e.style._.op[ATTR_FILLABLEFIELD.FF_INFO],_=r?NODE_TYPE.SIGNERFIELD:NODE_TYPE.FILLABLEFIELD;m;){if((m.type===NODE_TYPE.TEXTBOX||m.type===NODE_TYPE.IMAGE)&&(m.isFillableImageField()&&m.style._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]===I[ATTR_COMMON.ID]||m.isSignerImageField()&&m.style._.op[ATTR_SIGNERFIELD.SFINFO][ATTR_COMMON.ID]===I[ATTR_COMMON.ID])){if(m._.isOrphan)return;switch(a=m,a.type){case NODE_TYPE.IMAGE:s=[{r:a.start}],d={type:NODE_TYPE.IMAGE,cls:_};break;case NODE_TYPE.TEXTBOX:u=m.getSection(),s=[{r:u.start+1}],d={},p={type:NODE_TYPE.TEXT},E={type:NODE_TYPE.PARAGRAPH,ts:{type:NODE_TYPE.TEXT}},g=" "===I[ATTR_FILLABLEFIELD.FF_VALUE]?"":I[ATTR_FILLABLEFIELD.FF_VALUE]}if(t.map(function(t,n){e.style._.op.hasOwnProperty(t)?d[t]=e.style._.op[t]=i[n]:(d[ATTR_FILLABLEFIELD.FF_INFO]||ZWJSONUtils.cloneAndExtend(d[r?ATTR_SIGNERFIELD.SFINFO:ATTR_FILLABLEFIELD.FF_INFO]={},I),d[r?ATTR_SIGNERFIELD.SFINFO:ATTR_FILLABLEFIELD.FF_INFO][t]=I[t]=i[n])}),a.type===NODE_TYPE.IMAGE)return d[ATTR_IMAGE.I_SRC]=e.getValue(),s.push({as:{start:d,id:c=Utils.randomString()}}),s.push({r:UNICODE.IMAGE.length}),s.push({as:{end:ZWJSONUtils.getKeys(d),id:c}}),void l.call(a.getDocument(),s,!0);if(a.type===NODE_TYPE.TEXTBOX){var A=e.getFillableFieldResult()+"",S=A.trim()?A:"";if(S!==g&&!o){s.push({ds:g}),p=(f=u.getFirstChild().getFirstChild())&&f&&f.style._.op||p,E=(T=u.getLastChild())&&T&&T.style._.op||E,S=S||" ";for(var R,O=S.split(UNICODE.PARAGRAPH),b=0;b<O.length-1;b++){var v=O[b];s.push({as:{start:p,id:c=Utils.randomString()}}),s.push({is:v||""}),s.push({as:{end:ZWJSONUtils.getKeys(p),id:c}}),s.push({as:{start:E,id:R=Utils.randomString()}}),s.push({is:UNICODE.PARAGRAPH||" "}),s.push({as:{end:ZWJSONUtils.getKeys(E),id:R}})}var v=O[O.length-1];s.push({as:{start:p,id:c=Utils.randomString()}}),s.push({is:v||" "}),s.push({as:{end:ZWJSONUtils.getKeys(p),id:c}}),(h=S.length-g.length)&&(x(u,h),U(u,h,u._.nextItem),u.text=S,u.end=u.start+u.text.length),l.call(e.getDocument(),s)}return void a.setFormats(d)}}m=m._.nextItem}},L=function(e,t,i,n,o){if(e&&e.id)for(var r,a,s,d=this._.zwNodesList.firstItem,c=0;d;){if(d.type===NODE_TYPE.FIELD_START&&d.style._.op.id===e.id){if(d._.isOrphan)return;r=d,a=r.getNextSibling(),s=a.getNextSibling()||a.getParent().getNextSibling()||editor.getDocument().getFieldNode(r.style._.op.id,NODE_TYPE.FIELD_END);for(var u=a.text||"";s.type!==NODE_TYPE.FIELD_END;)u+=s.text?s.text:s.type===NODE_TYPE.PARAGRAPH?UNICODE.PARAGRAPH:s.type===NODE_TYPE.BR?UNICODE.BR:"",s=s.type===NODE_TYPE.PARAGRAPH&&s.getFirstChild()||s.getNextSibling()||s.getParent().getNextSibling();a=s.getPreviousSibling(),ZWJSONUtils.cloneAndExtend(r.style._.op={},e._.op);var p,g=[{r:r.start}],f=r.style._.op.id,E={};E[ATTR_COMMON.TYPE]=r.style._.op[ATTR_COMMON.TYPE],E.prevInfo={type:NODE_TYPE.FILLABLEFIELD},t.map(function(t,o){e._.op.hasOwnProperty(t)?(E.prevInfo[t]=e._.op[t],E[t]=e._.op[t]=i[o]):(E[ATTR_FILLABLEFIELD.FF_INFO]||(E[ATTR_FILLABLEFIELD.FF_INFO]={},E.prevInfo[ATTR_FILLABLEFIELD.FF_INFO]={},E[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]=e._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]),e._.op[ATTR_FILLABLEFIELD.FF_INFO].hasOwnProperty("checkedValue")&&e._.op[ATTR_FILLABLEFIELD.FF_INFO].hasOwnProperty("uncheckedValue")||(E[ATTR_FILLABLEFIELD.FF_INFO].checkedValue="",E[ATTR_FILLABLEFIELD.FF_INFO].uncheckedValue=""),E.prevInfo[ATTR_FILLABLEFIELD.FF_INFO][t]=n?n[o]:e._.op[ATTR_FILLABLEFIELD.FF_INFO][t],E[ATTR_FILLABLEFIELD.FF_INFO][t]=e._.op[ATTR_FILLABLEFIELD.FF_INFO][t]=i[o])}),E[ATTR_FILLABLEFIELD.FF_TYPE]=e._.op[ATTR_FILLABLEFIELD.FF_TYPE],!t.length&&(E=e._.op),g.push({as:{start:E,id:p=Utils.randomString()}}),g.push({r:UNICODE.RANGE_START.length}),g.push({as:{end:ZWJSONUtils.getKeys(E),id:p}});var T=(e.getFillableFieldType()===FILLABLEFIELD_TYPE.CHECKBOX,e.getFillableFieldResult()+""),m=T.trim()?T:e._.op[ATTR_FILLABLEFIELD.FF_NAME],h=e._.op.cls==NODE_TYPE.FILLABLEFIELD;if(e.getFillableFieldType()===FILLABLEFIELD_TYPE.CURRENCY&&m===(e.isCurrencySymbolAsCode()?e._.op[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CURRENCY_SYMBOL]:e.getCurrencyCode())&&(m=e._.op[ATTR_FILLABLEFIELD.FF_NAME]?e._.op[ATTR_FILLABLEFIELD.FF_NAME]:m),m===e._.op[ATTR_FILLABLEFIELD.FF_NAME]&&FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME].test(m)&&(m=m.replaceAll(FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME],"")),!o&&(u!=m||e.getFillableFieldType()===FILLABLEFIELD_TYPE.IMAGE)&&e.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE){if(h)return E={type:NODE_TYPE.IMAGE,cls:NODE_TYPE.FILLABLEFIELD,fieldinfo:f},E[ATTR_IMAGE.I_HT]=e.getSize().ht,E[ATTR_IMAGE.I_WID]=e.getSize().wid,E[ATTR_IMAGE.I_SRC]=e.getValue(),g.push({as:{start:E,id:p=Utils.randomString()}}),g.push({r:UNICODE.IMAGE.length}),g.push({as:{end:ZWJSONUtils.getKeys(E),id:p}}),void l.call(e.getDocument(),g);if(g.push({ds:u}),E=a.style._.op,E[ATTR_COMMON.FIELDINFO]=f,delete E[TCConstants.TC],e.getFillableFieldType()===FILLABLEFIELD_TYPE.SINGLELINE){for(var I,_=m.split(UNICODE.PARAGRAPH),m=m||" ",A=0;A<_.length-1;A++){var S=_[A];g.push({as:{start:E,id:p=Utils.randomString()}}),g.push({is:S||" "}),g.push({as:{end:ZWJSONUtils.getKeys(E),id:p}}),g.push({as:{start:{type:NODE_TYPE.PARAGRAPH,ts:{type:NODE_TYPE.TEXT}},id:I=Utils.randomString()}}),g.push({is:UNICODE.PARAGRAPH||" "}),g.push({as:{end:ZWJSONUtils.getKeys({type:NODE_TYPE.PARAGRAPH,ts:{type:NODE_TYPE.TEXT}}),id:I}})}var S=_[_.length-1];g.push({as:{start:E,id:p=Utils.randomString()}}),g.push({is:S||" "}),g.push({as:{end:ZWJSONUtils.getKeys(E),id:p}})}else g.push({as:{start:E,id:p=Utils.randomString()}}),g.push({is:m=m||" "}),g.push({as:{end:ZWJSONUtils.getKeys(E),id:p}});(c=m.length-u.length)&&(x(a,c),U(a,c,a._.nextItem),a.text=m,a.end=a.start+a.text.length)}return void l.call(e.getDocument(),g)}d=d._.nextItem}},N=function(){var e=editor.uuid.replace(/[\/\\_\-%]/gi,"")+Utils.randomString();return{imgId:e,imgSrc:Macros.getImageSrc(Macros.getImageURLValue(e)||"")}},P=function(e,t,i){t.docOps[1].styles.begin=i,t.docOps[2].retain_count=UNICODE.IMAGE.length,t.docOps[3].styles.end=ZWJSONUtils.getKeys(i),e._.composedDocOps=DocOpBuilder.compose(e._.composedDocOps,t),e._.composedDocOps=DocOpBuilder.concise(e._.composedDocOps)},C=function(e,t,i){editor.doc.snapShotManager.setSkipSnapShot(!0),e.sync(function(){editor.doc.snapShotManager.setSkipSnapShot(!1),t&&t.call(null,i)})},y=function(e,t,i,n,o,r,a,s){var l,d=e.getDocument(),c=[{r:e.start}];c.push({as:{start:l=e.style._.op,id:a}}),c.push({r:UNICODE.IMAGE.length}),c.push({as:{end:ZWJSONUtils.getKeys(l),id:a}}),r.putOp(DocOpBuilder.build(c),a),"undefined"!=typeof PubSub&&PubSub.subscribe("SDK/AfterSyncComplete",function(){r.enableAutoUpdate()});for(var u=0,p=d._.composedDocOps.docOps.length;u<p;u++)d._.composedDocOps.docOps[u][ATTR_BODY.DS_STYLES]&&d._.composedDocOps.docOps[u][ATTR_BODY.DS_STYLES].begin[ATTR_COMMON.SUBTYPE]===e.style.subType&&d._.composedDocOps.docOps[u-1].retain_count===e.start&&(d._.composedDocOps.docOps[u][ATTR_BODY.DS_STYLES].begin[ATTR_IMAGE.I_SRC]=s.imgSrc,d._.composedDocOps.docOps[u+2][ATTR_BODY.DS_STYLES].end.push(ATTR_IMAGE.I_SRC));var g={success:function(e){n(JSON.parse(e))},fail:function(e,t,i){o()},setHeaders:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}};J.ajaxUpload(t,i,g,"json")},F=function(){if(this._.responseHandler){var e=this,t=e.getDocument(),i=e._.responseHandler.success,n=e._.responseHandler.failure,o=new XFormMap,r=Utils.randomString(),a=function(e){var n=o.map[r],a=n.docOps[1].styles.begin;a[ATTR_WIDGET.SHEET_INFO]={rid:e.sheetRID},P(t,n,a),o.flushOp(),e[ATTR_IMAGE.I_SRC]=a[ATTR_IMAGE.I_SRC],C(t,i,e)},s=function(){var e=o.map[r],i=e.docOps[1].styles.begin;i[ATTR_WIDGET.SHEET_INFO]=null,P(t,e,i),o.flushOp(),C(t,n,info)},l="/writer/v1/sheet/"+Macros.getRId()+"/create",d={};y(e,l,d,a,s,o,r,{imgSrc:e.style[ATTR_IMAGE.I_SRC]})}},M=function(e){var t,i,n=this,o=n.getDocument(),r=([{r:n.start}],Utils.randomString()),a=new XFormMap,s=N();n._.responseHandler&&(t=n._.responseHandler.success,i=n._.responseHandler.failure);var l,d=function(e){var i=a.map[r],n=i.docOps[1].styles.begin;n[ATTR_CHART.SHEET_ID]=e.sheetid,n[ATTR_CHART.CHART_ID]=e.chartid,n[ATTR_IMAGE.I_SRC]=e.imageurl,P(o,i,n),a.flushOp(),C(o,t,e)},c=function(){var e=a.map[r],t=e.docOps[1].styles.begin;t[ATTR_CHART.SHEET_ID]=null,t[ATTR_CHART.CHART_ID]=null,t[ATTR_IMAGE.I_SRC]=info.imageurl,P(o,e,t),a.flushOp(),C(o,i,info)},u="/writer/v1/chart/"+Macros.getRId()+"/create",p={};(l=n.getChartData())&&(p.csv_data=l),p.chart_type=e,p.width=parseInt(n.style.width),p.height=parseInt(n.style.height),y(n,u,p,d,c,a,r,s)},w=function(e){var t,i,n=this,o=n.getDocument(),r=[{r:n.start}],a=new XFormMap;r.push({as:{start:t=n.style._.op,id:i=Utils.randomString()}}),r.push({r:UNICODE.IMAGE.length}),r.push({as:{end:ZWJSONUtils.getKeys(t),id:i}}),a.putOp(DocOpBuilder.build(r),i),a.enableAutoUpdate();var s=function(t){var r=a.map[i],s=r.docOps[1].styles.begin;s[ATTR_IMAGE.I_SRC]=t.imageurl,r.docOps[1].styles.begin=s,r.docOps[3].styles.end=ZWJSONUtils.getKeys(s),o._.composedDocOps=DocOpBuilder.compose(o._.composedDocOps,r),o._.composedDocOps=DocOpBuilder.concise(o._.composedDocOps),a.flushOp(),n._.isUpdateInProgress=!1,o.sync(function(){e&&e.success&&e.success(s[ATTR_CHART.CHART_ID],t)})},l=function(t){n._.isUpdateInProgress=!1,e&&e.failure&&e.failure(t)},d="/writer/v1/chart/"+Macros.getRId()+"/update",c={},u={};u.chart_id=n.chartId,u.sheet_id=n.sheetId,u.width=parseInt(n.style.width),u.height=parseInt(n.style.height),c.chart_info=JSON.stringify(u),J.ajax({type:"POST",global:!1,async:!0,url:d,data:c,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){s(e)},error:function(e,t,i){l(e)}})},U=function(e,t,i){for(var n,o=i;o;)n=!1,o&&o.type==NODE_TYPE.PARAGRAPH&&e.parent==o?(o.end+=t,o=o._.nextItem):(o.start>=e.start&&(o.start+=t,o.end<=e.end&&(n=!0,o.end+=t)),!n&&o.end>e.start&&(o.end+=t),o=o._.nextItem)},x=function(e,t){for(var i=e._.previousItem;i;)i.type!==NODE_TYPE.PARAGRAPH&&i.start<e.start&&e.start<i.end&&(i.end+=t),i=i._.previousItem},B=function(e,t){var i=(e.text||ZWUtils.getUnicodeChar(e)).length,n=e.parent.type===NODE_TYPE.PARAGRAPH||t;e.start=e.parent.end-(n?1:0),e.end=e.start+i;for(var o=e.isBlockNode()&&e.getFirstChild();o;)i+=B(o),o=o.getNextSibling();return e.parent.end+=i,i},H=function(e,t){if(t){var i=e.type===NODE_TYPE.PARAGRAPH||e.type===NODE_TYPE.SECTION;!i&&t(e),G(e,t),i&&t(e)}},G=function(e,t){if(t){for(var i=e.hasChildNodes()?e.getFirstChild():void 0,n=(e.type===NODE_TYPE.TABLE||e.type===NODE_TYPE.TOC)&&e.type;i;){var o=i.type===NODE_TYPE.PARAGRAPH||i.type===NODE_TYPE.SECTION;!o&&t(i),G(i,t),o&&t(i),i=i.getNextSibling()}if(n){var r=e.getDocument().createNode(n+"end");r.start=e.end-ZWUtils.getUnicodeChar(e).length,r.end=e.end,t(r)}}},k=function(e,t){var i=[];return Y(e).forEach(function(e,n){("header"===t?e.isHeader():e.isFooter())&&i.push(e)}),i},W=function(e,t){var i=[];return Y(e).forEach(function(e,n){(t===NODE_TYPE.ENDNOTE?e.isEndnote():e.isFootnote())&&i.push(e)}),i},Y=function(e){var t=HDR_FTR_REGEX[e._.op[ATTR_BODY.DS_HF_TYPE]||0],i=[];if(e._.dtDoc){var n,o=e._.dtDoc.getAllSections();o.forEach(function(o,r){n=ZWUtils.getZWNode.call(e,o),(t.test(n.style._.op.hftype)||n.isBody()||n.isFootnote()||n.isEndnote()||n.isTextBox())&&i.push(n)})}else if(e){var n=e.body;do(t.test(n.style._.op.hftype)||n.isBody()||n.isFootnote()||n.isEndnote()||n.isTextBox())&&i.push(n);while(n=n.getNextSibling())}return i},z=function(e,t){for(var i,n=0,o=e.length,r=[];n<o;n++)(i=e[n])&&(r=r.concat(Z.call(this,i,t)));r.forEach(function(e,t){e.remove()})},Z=function(e,t){var i=[],n=this.createRange();return n.start=e.start,n.end=e.end,n.visitNodes({handleNodeStart:function(o){o.type!==NODE_TYPE.PARAGRAPH&&o.start>=n.start&&o.end<=n.end&&(t||(o.type===NODE_TYPE.FIELD_START||o.type===NODE_TYPE.FIELD_END)&&o.style._.op.id===e.id)&&i.push(o)},handleNodeEnd:function(e){t&&e.type===NODE_TYPE.PARAGRAPH&&e.start>=n.start&&e.end<=n.end&&i.push(e)}}),i},V=function(e,t){var i,n,o,r,a,s=0,d=0,c=(o=e.getNextSibling())&&o.type===NODE_TYPE.PARAGRAPH&&o;if(i=e.getFirstChild())for(;i&&!i._.isOrphan;)o=i.getNextSibling(),t.hasOwnProperty(i.style._.op.id)?(r?(a?(a.nextSibling=i,i.previousSibling=a):(r.nextSibling=i,i.previousSibling=r),a=i):(r=i,delete r.previousSibling,delete r.nextSibling),c&&(i.parent=c),i.start-=s,i.end-=s,d++):(l.call(this,[{r:i.start-s},{ds:n=i.getContent()}]),this._.zwNodesList.removeItem(i),i.start=i.end=0,i._.isOrphan=1,s+=n.length),i=o;c&&(n=e.getContent(),n=n.substring(n.length-UNICODE.PARAGRAPH.length),l.call(this,[{r:e.end-UNICODE.PARAGRAPH.length-s},{ds:n}]),this._.zwNodesList.removeItem(e),e._.isOrphan=1,s+=n.length),x(e,0-s),U(e,0-s,e._.nextItem),c&&(this._.zwNodesList.items.hasOwnProperty(c._.dtNodeId)&&(c.start-=d),c.getFirstChild()?!r||r.nextSibling||a||(r.nextSibling=c.firstChild,c.firstChild.previousSibling=r,c.firstChild=r):c.lastChild=r),e._.isOrphan&&(ee(e),e.start=e.end=0,e.previousSibling=e.nextSibling=null)},j=function(e,t){var i=0===t?"getPreviousSibling":"getNextSibling",n=0===t?"getFirstChild":"getLastChild",o=e[i]();switch(e.type){case NODE_TYPE.TABLE:case NODE_TYPE.PARAGRAPH:if(!o){var r=e.getParent();if(r.type===NODE_TYPE.CELL){var a,s=r.getNextSibling();s?o=s.getFirstChild():(a=r.getParent().getNextSibling())&&(o=a.getFirstChild().getFirstChild())}return o}switch(o.type){case NODE_TYPE.PARAGRAPH:return o;case NODE_TYPE.TABLE:return o[n]()[n]()[n]();default:return null}case NODE_TYPE.ROW:return o?o[n]()[n]():e.getParent()[i]()}return null},X=function(e){return j(e,0)},K=function(e){return j(e,1)},q=function(e,t){var i,n,o,r,a;for(i in t)n=t[i],o=this.createNode(n.type,n.fieldType),ZWJSONUtils.cloneAndExtend(o.style._.op,n.style._.op),n.type===NODE_TYPE.FIELD_END?(r||(r=X(e)),r.append(o)):n.type===NODE_TYPE.FIELD_START&&(a||(a=K(e)),a.prepend(o))},Q=function(t,i){for(var n="undefined"!=typeof e.editor?editor.doc.getContent():this.getDocumentContent(),o=t==NODE_TYPE.FILLABLEFIELD||"*"==t?UNICODE.RANGE_START+"|"+UNICODE.IMAGE:UNICODE.RANGE_START,r=Utils.findNextIndexOf(o,1,n);r<n.length&&r!=-1;){var a=this.getRawFormatAt(r);if(a&&("*"==t||a.type===t||(a.cls||"").indexOf(t)!==-1)){var s=ZWUtils.getZWNodeAt.call(this,r),l=s&&s.type===NODE_TYPE.IMAGE,d=s&&s.type===NODE_TYPE.TEXTBOX,c=s&&s.type==NODE_TYPE.FIELD_START,u=(l||d)&&(s.isFillableImageField()||s.isSignerField()&&s.isSignerImageField())?s:c&&s.getField();i&&u&&i(u)}r=Utils.findNextIndexOf(o,r+1,n)}};e.ZWDocument=function(){t.call(this)},ZWDocument.prototype.append=function(e,t,i){if(!e||!e._.isOrphan)return t;if(!ZWUtils.canAppend(t,e))throw new TypeError("Can't append "+e.type+" to "+t.type);e.parent=t;var n=t.getLastChild();if(n?(e.nextSibling=null,n.nextSibling=e,e.previousSibling=n):t.firstChild=e,t.lastChild=e,t._.isOrphan)return t;var o,r,a=t.getDocument(),l=t._.nextItem;return t.type===NODE_TYPE.PARAGRAPH||t.type===NODE_TYPE.SECTION?a._.zwNodesList.insertItemBefore(e,t):o=t,H(e,function(i){o&&(e.type===NODE_TYPE.PARAGRAPH&&t.type!==NODE_TYPE.SECTION?a._.zwNodesList.insertItemBefore(i,o):o._.itemId||e.type!==NODE_TYPE.PARAGRAPH||t.type!==NODE_TYPE.SECTION?a._.zwNodesList.insertItemAfter(i,o):a._.zwNodesList.insertItemBefore(o,e)),o=i}),r=B(e,!(!t.hasEndChar()&&t.type!=NODE_TYPE.PARAGRAPH)),x(e,r),U(e,r,l),(void 0===i||i)&&s(e),e._.isOrphan=0,e.type===NODE_TYPE.TABLE&&e.insertBefore(a.createNode(NODE_TYPE.PARAGRAPH)),t},ZWDocument.prototype.applyChanges=function(e){this._.composedDocOps.applyTo(),e&&e()},ZWDocument.prototype.bindEvents=function(){PubSub.subscribe(["Document/BeforeModelUpdation","Document/ContentAdded","Document/ContentDeleted","Document/StyleChanged","Document/PostApplyTo"],function(){var e=editor.getDocument();t.call(e,e._.dtDoc),PubSub.subscribeOnce(["Document/AfterModelUpdation","Document/LoadingComplete"],function(){o(e,editor.doc.getBodyFormat())})}),PubSub.subscribe(["SDK/Cursor/Collapsed"],function(){var e=editor.doc.getSelection();e.selectionType!==SEL_OP_GEN&&r.call(editor.getDocument(),e)})},ZWDocument.prototype.clearChanges=function(){this._.composedDocOps=DocOpBuilder.build([])},ZWDocument.prototype.composeMSG=function(){return l.apply(this,arguments)},ZWDocument.prototype.createAutoField=function(){var e=[NODE_TYPE.AUTOFIELD].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createField=function(){var e=ZWFactory.createField.apply(null,arguments);return e._.doc=this,e},ZWDocument.prototype.createComment=function(){var e=[NODE_TYPE.COMMENT].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createFillableField=function(){var e=[NODE_TYPE.FILLABLEFIELD].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createSignerField=function(){var e=[NODE_TYPE.SIGNERFIELD].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createBookmarkField=function(){var e=[NODE_TYPE.BOOKMARK].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createEndnoteField=function(){var e=[NODE_TYPE.ENDNOTE].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createFootnoteField=function(){var e=[NODE_TYPE.FOOTNOTE].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createLinkField=function(){var e=[NODE_TYPE.LINK].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createMailmergeField=function(){var e=[NODE_TYPE.MAILMERGEFIELD].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createNextRecordField=function(){var e=[NODE_TYPE.NEXTRECORD].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createPlaceholderField=function(){var e=[NODE_TYPE.PLACEHOLDER].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createRepeatRange=function(){var e=[NODE_TYPE.REPEAT_START].concat(f(arguments));return this.createField.apply(this,e)},ZWDocument.prototype.createNode=function(e,t){var i=ZWFactory.createNode.apply(null,f(arguments));if(i)return i._.doc=this,t?(e===NODE_TYPE.PARAGRAPH?i.append(this.createNode(NODE_TYPE.TEXT,t)):e===NODE_TYPE.TABLE&&i.constructTable(t),i):i},ZWDocument.prototype.createZWNode=function(e){if(!e)throw new TypeError("DTNode not found !!");var t,i=e.type;if(i===NODE_TYPE.RUN||i===NODE_TYPE.TEXT)i=NODE_TYPE.TEXT,t=editor.doc.getContent(e.getIndex(),e.getEndIndex()+1);else if(i===NODE_TYPE.IMAGE&&e.format&&e.format[ATTR_COMMON.SUBTYPE]){var n=e.format[ATTR_COMMON.SUBTYPE];i=n!==SIGNERFIELD_TYPE.SIGNATURE&&n!==SIGNERFIELD_TYPE.INITIAL?n:i}i===NODE_TYPE.PARA&&(i=NODE_TYPE.PARAGRAPH);var o=this.createNode(i,t);if(o)return o._.isNewNode=!0,o.style&&ZWJSONUtils.cloneAndExtend(o.style._.op,e.format),p.call(this,o,e),o._.itemId=o._.dtNodeId=e.id,this._.dtNodes2zwNodesMap[e.id]=o,h.call(this,o),_(o,e),o._.isOrphan=0,delete o._.isNewNode,o},ZWDocument.prototype.createNamedRange=function(e,t){return{type:NODE_TYPE.NAMED_RANGE,id:Utils.randomString(),name:e||"unknown",hilite_name:t}},ZWDocument.prototype.createComment=function(e){return{type:NODE_TYPE.COMMENT,id:e}},ZWDocument.prototype.createRange=function(){var e=new ZWDocRange;return e._.doc=this,e},ZWDocument.prototype.createStyle=function(e,t){return new ZWFactory.styles[e](t)},ZWDocument.prototype.createSheetWidget=function(e){var t=this.createNode(NODE_TYPE.WIDGET,e);return e&&(t.style.src=e[ATTR_IMAGE.I_SRC],t.style.id=e[ATTR_COMMON.ID]||Utils.getRandomNumber(),t.style.height=e[ATTR_IMAGE.I_HT]||400,t.style.width=e[ATTR_IMAGE.I_WID]||400,t.style.widgetSrc=e[ATTR_WIDGET.SRC],t.style.thumbnail=e[ATTR_WIDGET.THUMBNAIL],t.setSheetInfo(e[ATTR_WIDGET.SHEET_INFO])),t},ZWDocument.prototype.execCmd=function(e,t,i){var o,r,a=this.getSelection(),s=!1,l="";switch(t=t||{},e){case EXECCMD.BOLD:o="fontWeight";case EXECCMD.ITALIC:o=o||"fontStyle";case EXECCMD.STRIKE_THROUGH:case EXECCMD.UNDERLINE:o=o||"textDecoration",i&&ZWUtils.updateSelectionWithNamedRanges(i),a.forEach(function(t){t.splitText().visitNodes({handleNodeStart:function(t){if(t.type!==NODE_TYPE.TEXT)return this;var i=t.style[o];r?e!==EXECCMD.STRIKE_THROUGH&&e!==EXECCMD.UNDERLINE||(r=s?i.replace(e,"").trim()||n:i===n?e:i+(i.indexOf(e)!==-1?"":" "+e)):e===EXECCMD.STRIKE_THROUGH||e===EXECCMD.UNDERLINE?(i=i||n,r=i!==n?(s=i.indexOf(e)!==-1)?i.replace(e,"").trim()||n:i+" "+e:e):r=t.style[o]===e?n:e,t.style[o]=r},handleNodeEnd:function(){}})});break;case EXECCMD.INSERT_NAMED_RANGE:a.getRangeAt(0).createNamedRange(t.name,t.hilite_name);break;case EXECCMD.REPEATHEADER:l=1;case EXECCMD.REMOVEREPEATHEADER:var d=a.getRangeAt(0),c=d.getStartNode().getParents(NODE_TYPE.TABLE)[0];c.style.tableHeader=l;break;case EXECCMD.TABLE_INSERT:var u=t?t:{},p={};p.rows=u.rows||3,p.cols=u.cols||3,p.columnsWidth=u.columnsWidth,p.tableWidth=u.tableWidth,p.paraStyle=u.paraStyle;var g,f,c=this.createNode(NODE_TYPE.TABLE,p),E=p.cols,T={},m=[];if(p.tableWidth&&p.columnsWidth)g=p.tableWidth,m=p.columnsWidth;else{g=100+UNITS.PERCENTAGE,f=(100/E).toFixed(2)+UNITS.PERCENTAGE,m=[];for(var h=0;h<E;h++)m.push({wt:f})}T[ATTR_TABLE.TBLS_WID]=g,T[ATTR_TABLE.TBLS_COLS]=m,p.paraStyle&&(p.paraStyle[ATTR_PARAGRAPH.PS_DIR]==PARA_DIR.RTL&&(T[ATTR_TABLE.TBLS_DIR]=PARA_DIR.RTL),c.visitNodes(function(e){e.type==NODE_TYPE.PARAGRAPH&&e.setFormats(p.paraStyle)})),c.setFormats(T);var d=a.getRangeAt(0);d.insertNode(c);var I=c.getFirstChild().getFirstChild().getFirstChild();I&&I.type==NODE_TYPE.PARAGRAPH&&this.moveCursor(I,!0);break;case EXECCMD.TABLE_DELETE:var d=a.getRangeAt(0),c=d.getStartNode().getParents(NODE_TYPE.TABLE)[0],I=c.getNextSibling();for(c.remove();I&&I.type!=NODE_TYPE.PARAGRAPH;)I=I.getNextSibling();I&&I.type==NODE_TYPE.PARAGRAPH&&this.moveCursor(I,!0);break;case EXECCMD.TABLE_INSERT_ROW_AFTER:var u=t?t:{},d=a.getRangeAt(0),_=u.rowIndex;if("undefined"==typeof _){var A=d.getStartNode().getParents(NODE_TYPE.ROW)[0];if(!A)break;_=A.getRowIdx()}var S=u.rowsCount||1,c=d.getStartNode().getParents(NODE_TYPE.TABLE)[0];c.insertRowAfter(_,S);var I=c.getRowAtIndex(_).getFirstChild().getFirstChild();I&&I.type==NODE_TYPE.PARAGRAPH&&this.moveCursor(I,!0);break;case EXECCMD.TABLE_INSERT_ROW_BEFORE:var u=t?t:{},d=a.getRangeAt(0),_=u.rowIndex;if("undefined"==typeof _){var A=d.getStartNode().getParents(NODE_TYPE.ROW)[0];if(!A)break;_=A.getRowIdx()}var S=u.rowsCount||1,c=d.getStartNode().getParents(NODE_TYPE.TABLE)[0];c.insertRowBefore(_,S);var I=c.getRowAtIndex(_-1).getFirstChild().getFirstChild();I&&I.type==NODE_TYPE.PARAGRAPH&&this.moveCursor(I,!0);break;case EXECCMD.TABLE_DELROW:var u=t?t:{},d=a.getRangeAt(0),_=u.rowIndex;if("undefined"==typeof _){var A=d.getStartNode().getParents(NODE_TYPE.ROW)[0];if(!A)break;_=A.getRowIdx()}var c=d.getStartNode().getParents(NODE_TYPE.TABLE)[0];if(1==c.getChildNodes().length){this.execCmd(EXECCMD.TABLE_DELETE);break}c.deleteRow(_);var I;_-2<0?(I=c.getRowAtIndex(_-1).getFirstChild().getFirstChild(),I&&I.type==NODE_TYPE.PARAGRAPH&&this.moveCursor(I,!0)):(I=c.getRowAtIndex(_-2).getLastChild().getLastChild(),I&&I.type==NODE_TYPE.PARAGRAPH&&this.moveCursor(I));break;case EXECCMD.TABLE_INSERT_COLUMN_AFTER:var u=t?t:{},d=a.getRangeAt(0),R=u.colIndex;if("undefined"==typeof R){var O=d.getStartNode().getParents(NODE_TYPE.CELL)[0];if(!O)break;R=O.getChildIndex()+1}var b=u.colsCount||1,c=d.getStartNode().getParents(NODE_TYPE.TABLE)[0];c.insertColumnAfter(R,b);var I=c.getFirstChild().getChildNodeAt(R).getFirstChild();I&&I.type==NODE_TYPE.PARAGRAPH&&this.moveCursor(I,!0);break;case EXECCMD.TABLE_INSERT_COLUMN_BEFORE:var u=t?t:{},d=a.getRangeAt(0),R=u.colIndex;if("undefined"==typeof R){var O=d.getStartNode().getParents(NODE_TYPE.CELL)[0];if(!O)break;R=O.getChildIndex()+1}var b=u.colsCount||1,c=d.getStartNode().getParents(NODE_TYPE.TABLE)[0];c.insertColumnBefore(R,b);var I=c.getFirstChild().getChildNodeAt(R-1).getFirstChild();I&&I.type==NODE_TYPE.PARAGRAPH&&this.moveCursor(I,!0);break;case EXECCMD.TABLE_DELCOLUMN:var u=t?t:{},d=a.getRangeAt(0),R=u.colIndex;if("undefined"==typeof R){var O=d.getStartNode().getParents(NODE_TYPE.CELL)[0];if(!O)break;R=O.getChildIndex()+1}var d=a.getRangeAt(0),c=d.getStartNode().getParents(NODE_TYPE.TABLE)[0];if(1==c.getColumnWidths().length){this.execCmd(EXECCMD.TABLE_DELETE);break}c.deleteColumn(R);var I;I=R-2<0?c.getFirstChild().getChildNodeAt(R-1).getFirstChild():c.getFirstChild().getChildNodeAt(R-2).getFirstChild(),I&&I.type==NODE_TYPE.PARAGRAPH&&this.moveCursor(I,!0);break;case EXECCMD.CHANGE_CASE:if(!/^(small-caps|upper|lower|sentenceCase|capitalizeWord)$/.test(t.case))break;for(var a=i||this.getSelection(),v=t.case,h=0;h<a.length;h++){var d=i&&i[h].clone()||a.getRangeAt(h).clone(),D=d.getNodes();D.forEach(function(e){e.type!==NODE_TYPE.TEXT||e.end<d.start||e.start>d.end||(e.start<d.start&&(e=e.splitAt(d.start-e.start)),e.end>d.end&&e.splitAt(d.end-e.start),e.setCase(v))})}break;case EXECCMD.INSERT_DYNAMIC_CHART:var L=t.chartData;ChartUtils.insertChartforInsights(L)}return PubSub.publish("ZWRange/ScrollIntoView"),this},ZWDocument.prototype.findNodes=function(e,t){if(!t)throw new TypeError("Hanlder is null or undefined !!");e=e||[];var i,n,o=this.getAllSections();for(i=0,n=e.length;i<n;i++){if(!o.length)return;for(var r,a,s=[],l=0,d=o.length;l<d;l++){r=o[l],a=r.isBlockNode()&&r.getChildNodes()||[];for(var c,u,p,g,f,E=0,T=a.length;E<T;E++)if(u=a[E],g=u.type,f=e[i],c=ZWUtils.getZWNodeById.call(this,u.id)){if(c._.isOrphan)continue;for(p=c.previousSibling;p&&!p._.dtNodeId;)!s.contains(p)&&s.push(p),p=p.previousSibling;for(c.type===f&&(!c||!c._.isOrphan)&&s.push(u),p=c.nextSibling;p&&!p._.dtNodeId;)!s.contains(p)&&s.push(p),p=p.nextSibling}else(g===f||g===NODE_TYPE.PARA&&f===NODE_TYPE.PARAGRAPH)&&(u instanceof ZWNode||!c||!c._.isOrphan)&&s.push(u)}o=s}if(n&&i===n&&o.length)for(i=0,n=o.length,r;i<n;i++)r=o[i],t(r instanceof ZWNode?r:ZWUtils.getZWNode.call(this,r));return this},ZWDocument.prototype.getAllComments=function(){if(!this._.commentRanges.map){var e,t={map:{},order:[]};this.filterNodes(function(e){return(e.type===NODE_TYPE.FIELD_START||e.type===NODE_TYPE.FIELD_END)&&e.fieldType===FIELD_TYPE.COMMENT},function(i){(e=t.map[i.style._.op.id])?e.end=i.end:(ZWJSONUtils.cloneAndExtend(e={},i.style._.op),e.start=i.start,t.map[e.id]=e,t.order.push(e.id))}),this._.commentRanges=t}for(var t=[],i=0,n=this._.commentRanges.order.length;i<n;i++)t.push(this._.commentRanges.map[this._.commentRanges.order[i]]);return t},ZWDocument.prototype.getAllEndNotes=function(){return W(this,NODE_TYPE.ENDNOTE)},ZWDocument.prototype.getAllFootNotes=function(){return W(this,NODE_TYPE.FOOTNOTE)},ZWDocument.prototype.getAllFooters=function(){return k(this,"footer")},ZWDocument.prototype.getAllHeaders=function(){return k(this,"header")},ZWDocument.prototype.getAllNamedRanges=function(){if(!this._.namedRanges.map){var e,t={map:{},order:[]};this.filterNodes(function(e){return(e.type===NODE_TYPE.FIELD_START||e.type===NODE_TYPE.FIELD_END)&&e.fieldType===FIELD_TYPE.NAMED_RANGE},function(i){(e=t.map[i.style._.op.id])?e.end=i.end:(ZWJSONUtils.cloneAndExtend(e={},i.style._.op),e.start=i.start,t.map[e.id]=e,t.order.push(e.id))}),this._.namedRanges=t}for(var t=[],i=0,n=this._.namedRanges.order.length;i<n;i++)t.push(this._.namedRanges.map[this._.namedRanges.order[i]]);return t},ZWDocument.prototype.getNamedRangesByName=function(e){var t,i=this.getAllNamedRanges(),n=[];for(var o in i)(t=i[o])&&t.name===e&&n.push(t);return n},ZWDocument.prototype.getNamedRangeById=function(e){return this.getAllNamedRanges(),this._.namedRanges.map[e]},ZWDocument.prototype.getCommentById=function(e){return this.getAllComments(),this._.commentRanges.map[e]},ZWDocument.prototype.getAllFields=function(){return this.getFieldById(),this._.fieldsMap},ZWDocument.prototype.getAllSections=function(){return Y(this)},ZWDocument.prototype.getBackgroundColor=function(){return this._[ATTR_BODY.DS_BGC]},ZWDocument.prototype.getBody=function(){return this.body||ZWUtils.getZWNode.call(this,this._.dtDoc.getAllSections()[0])},ZWDocument.prototype.getChanges=function(){return this._.cursorOp.length&&l.call(this,this._.cursorOp),this._.composedDocOps},ZWDocument.prototype.getComputedFormat=function(e){if(e){var t=(e.type,g(e)),i=DocUtil.mergeObjs(t.reverse()),n=DocumentDesign.getCharStyle(i[ATTR_TEXT.CHAR_STY]);return n&&(i=DocUtil.mergeObjs([n,i])),i=DocUtil.getRenderingFormat(i)}};var $="undefined"!=typeof editor;ZWDocument.prototype.getContent=function(e){var t=Math.max(e&&e.start||0,0),i=Math.min(e&&e.end||this._.content.length,this._.content.length);return this._.content.substring(Math.min(t,i),Math.max(t,i))},ZWDocument.prototype.getRawFormatAt=function(e){return $?editor.doc.getRawFormatAt(e):this._.styles[e]},ZWDocument.prototype.getFieldById=function(e){var t=this._.fieldsMap;return t||(t={},this.visitAllFields("*",function(e){t[e.isFillableImageField()||e.isSignerField()&&e.isSignerImageField()?e.getId():e.id]=e}),this._.fieldsMap=t),t[e]},ZWDocument.prototype.getTextBoxById=function(e){var t,i=this;return this.visitAllNodes(NODE_TYPE.TEXTBOX,function(n){var o=n.getIndex();i.getRawFormatAt(o).id==e&&(t=n)}),t},ZWDocument.prototype.getFieldsByName=function(e,t){this.getFieldById();var i=[];for(var n in this._.fieldsMap){var o=this._.fieldsMap[n],r=o.isFillableImageField()||o.isSignerField()&&o.isSignerImageField()?o.getName():o._.op[ATTR_FILLABLEFIELD.FF_NAME];if(r===e){if(!t)return o;i.push(o)}}return t?i:i[0]},ZWDocument.prototype.getFieldNode=function(e,t){for(var i=this._.zwNodesList.firstItem;i;){if(i.type===t&&i.style._.op.id===e)return i;i=i._.nextItem}};ZWDocument.prototype.getFieldRange=function(e){var t,n,o=this.getDocumentContent(),r=e.id,a=this.createRange(),s=UNICODE.RANGE_START;for(i=Utils.findNextIndexOf(s,1,o);i<o.length&&i!=-1;){t=this.getRawFormatAt(i);{if(t&&t.id==r){t&&t.id===r&&(n=ZWUtils.getZWNodeAt.call(this,i),n.type==NODE_TYPE.FIELD_START&&a.setStart(n));break}i=Utils.findNextIndexOf(s,i+1,o)}}for(s=UNICODE.RANGE_END,i=Utils.findNextIndexOf(s,i+1,o);i<o.length&&i!=-1;){t=this.getRawFormatAt(i);{if(t&&t.id==r){t&&t.id===r&&(n=ZWUtils.getZWNodeAt.call(this,i),n.type==NODE_TYPE.FIELD_END&&a.setEnd(n));break}i=Utils.findNextIndexOf(s,i+1,o)}}return a},ZWDocument.prototype.getLayout=function(){return DocLayoutManager},ZWDocument.prototype.getPageSetup=function(){var e=[ATTR_BODY.DS_OR,ATTR_BODY.DS_PH,ATTR_BODY.DS_PS,ATTR_BODY.DS_PW];return function(){if(!this._.pageSetup){this._.pageSetup=new ZWPageSetup;for(var t=0,i=e.length;t<i;t++)this._.pageSetup._[e[t]]=this._.op[e[t]]}return this._.pageSetup}}(),ZWDocument.prototype.getSelection=function(){return this._.selection&&!this._.selection.length&&r.call(this,this._.dtDoc&&editor.doc.getSelection()||[]),this._.selection},ZWDocument.prototype.getStyles=function(){var e;return ZWJSONUtils.cloneAndExtend(e={},this._.op[ATTR_BODY.DS_STYLES]),e},ZWDocument.prototype.setStyles=function(e){var t={};return t[ATTR_BODY.DS_STYLES]=e,a(this,t),this},ZWDocument.prototype.getTheme=function(){var e;return ZWJSONUtils.cloneAndExtend(e={},this._.op[ATTR_BODY.DS_THEME]),e},ZWDocument.prototype.setTheme=function(e){var t,i=this._.op[ATTR_BODY.DS_THEME],n={};try{var t={name:e.name||i.name,color:{name:e.color&&e.color.name||i.color&&i.color.name},font:{major:{latin:e.font&&e.font.major&&e.font.major.latin||i.font.major.latin},minor:{latin:e.font&&e.font.minor&&e.font.minor.latin||i.font.minor.latin},name:e.font&&e.font.name||i.font&&i.font.name},fmtScheme:{}};for(var o in i.color)"name"!==o&&(t.color[o]=ZWUtils.getColor(e.color&&e.color[o]||i.color[o]).getRGB())}catch(e){throw e}return n[ATTR_BODY.DS_THEME]=t,a(this,n),this},ZWDocument.prototype.getZWNodeParentsAt=function(e,t){var i,n=[];if(i=ZWUtils.getZWNodeAt.call(this,e))for(;i;)i.type===t&&n.push(i),i=i.getParent();return n},ZWDocument.prototype.insertAfter=function(e,t,i){if(!e._.isOrphan&&t._.isOrphan)return this.insertBefore(t,e);if(!e)return t;if(!ZWUtils.canBeSibling(t,e))throw new TypeError("Can't insert "+e.type+" before "+t.type);if(!e._.isOrphan)return e.remove(),e._.isOrphan&&this.insertAfter(e,t),t;var n,o=t.getParent();if(o&&(e.parent=o,n=o.lastChild,n&&n.isEqualNode(t)&&(o.lastChild=e)),(n=t.nextSibling)&&(n.previousSibling=e,e.nextSibling=n),e.previousSibling=t,t.nextSibling=e,t._.isOrphan)return t;var r,a=this,l=m(t),d=l._.nextItem;H(e,function(e){l&&a._.zwNodesList.insertItemAfter(e,l),l=e}),r=(e.text||ZWUtils.getUnicodeChar(e)).length,e.start=t.end,e.end=e.start+r;for(var c=e.isBlockNode()&&e.getFirstChild();c;)r+=B(c),c=c.getNextSibling();e.type!=NODE_TYPE.TABLE&&e.type!=NODE_TYPE.TOC||(r+=UNICODE[e.type.toUpperCase()+"END"].length),e.end=e.start+r,(void 0===i||i)&&(x(e,r),U(e,r,d),s(e)),H(e,function(e){e._.isOrphan=0})},ZWDocument.prototype.insertBefore=function(e,t){if(!e._.isOrphan&&t._.isOrphan)return this.insertAfter(t,e);if(!e)return t;if(!ZWUtils.canBeSibling(t,e))throw new TypeError("Can't insert "+e.type+" before "+t.type);if(!e._.isOrphan)return e.remove(),e._.isOrphan&&this.insertBefore(e,t),t;var i,n=t.getParent();if(n&&(e.parent=n,i=n.firstChild,i&&i.isEqualNode(t)&&(n.firstChild=e)),(i=t.previousSibling)&&(i.nextSibling=e,e.previousSibling=i),e.nextSibling=t,t.previousSibling=e,t._.isOrphan)return t;var o=t;if(t.type===NODE_TYPE.PARAGRAPH)for(var r=o._.previousItem;r&&!(r.start<t.start);)o=r,r=r._.previousItem;var a=t.getDocument();a._.zwNodesList.insertItemBefore(e,o);var l=e,d=o._.nextItem,c=(e.text||ZWUtils.getUnicodeChar(e)).length;G(e,function(t){l&&a._.zwNodesList[l.type==NODE_TYPE.PARAGRAPH&&e.type==NODE_TYPE.PARAGRAPH?"insertItemBefore":"insertItemAfter"](t,l),l=t}),e.start=t.start,e.end=e.start+c;for(var u=e.isBlockNode()&&e.getFirstChild();u;)c+=B(u),u=u.getNextSibling();return e.type!=NODE_TYPE.TABLE&&e.type!=NODE_TYPE.TOC||(c+=UNICODE[e.type.toUpperCase()+"END"].length),e.end=e.start+c,o.start+=c,o.end+=c,e.isBlockNode()&&(e.end=e.start+c),x(NODE_TYPE.PARAGRAPH==e.type&&e.firstChild?e.firstChild:e,c),U(e,c,d),s(e),H(e,function(e){e._.isOrphan=0}),t},ZWDocument.prototype.loadDocTree=function(e){return t.call(this,e),o(this,editor.doc.getBodyFormat()),this},ZWDocument.prototype.loadDocument=function(){Object.defineProperty(Array.prototype,"last",{enumerable:!1,value:function(){return this[this.length-1]}});var e=new RegExp(UNICODE.SECTION_START,"g"),i=(new RegExp([UNICODE.PARAGRAPH,UNICODE.TABLE,UNICODE.ROW,UNICODE.CELL,UNICODE.TABLEEND,UNICODE.TOCSTART,UNICODE.TOCEND].join("|"),"g"),function(e,t,i){var n,o,r,a,s,l=i.content,d=i.styles,c=[e],u=e.start+1;for(l.length;u<e.end;u++)switch(n=void 0,o=l.charAt(u),r=d[u],o){case UNICODE.TABLE:a=c.last(),s=t.createNode(NODE_TYPE.TABLE),ZWJSONUtils.cloneAndExtend(s.style._.op={},r),s.start=u,s.end=s.start+o.length,a.append(s),c.push(s),t._.zwNodesList.addItem(s);break;case UNICODE.TABLEEND:for(;s.type!==NODE_TYPE.TABLE;)s=c.pop(),s.end=u;s.end=u+UNICODE.TABLEEND.length;break;case UNICODE.ROW:for(a=c.last();a.type!==NODE_TYPE.TABLE;)s=c.pop(),s.end=u,a=c.last();s=t.createNode(NODE_TYPE.ROW),ZWJSONUtils.cloneAndExtend(s.style._.op={},r),s.start=u,s.end=s.start+o.length,a.append(s),c.push(s),t._.zwNodesList.addItem(s);break;case UNICODE.CELL:a=c.last(),a.type===NODE_TYPE.CELL&&(s=c.pop(),s.end=u,a=c.last()),s=t.createNode(NODE_TYPE.CELL),ZWJSONUtils.cloneAndExtend(s.style._.op={},r),s.start=u,s.end=s.start+o.length,a.append(s),c.push(s),t._.zwNodesList.addItem(s);break;case UNICODE.PARAGRAPH:a=c.last(),a.isInlineNode()?(a.end=a.start+Math.abs(u-a.start),c.pop(),a=c.last(),a.end=u+o.length,c.pop(),t._.zwNodesList.addItem(a)):(s=t.createNode(NODE_TYPE.PARAGRAPH),ZWJSONUtils.cloneAndExtend(s.style._.op={},r),s.start=u,s.end=u+o.length,a.append(s),t._.zwNodesList.addItem(s));break;case UNICODE.BR:n=n||NODE_TYPE.BR;case UNICODE.IMAGE:n=n||NODE_TYPE.IMAGE;case UNICODE.RANGE_END:n=n||NODE_TYPE.FIELD_END;case UNICODE.RANGE_START:n=n||NODE_TYPE.FIELD_START;case UNICODE.TAB:n=n||NODE_TYPE.TAB,a=c.last(),a.isInlineNode()&&(a.end=a.start+Math.abs(u-a.start),c.pop(),a=c.last()),a.type!==NODE_TYPE.PARAGRAPH&&(s=t.createNode(NODE_TYPE.PARAGRAPH),s.start=u,s.end=s.start+o.length,a.append(s),c.push(a=s)),s=t.createNode(n),ZWJSONUtils.cloneAndExtend(s.style._.op={},r),s.start=u,s.end=s.start+o.length,a.append(s),c.push(s),t._.zwNodesList.addItem(s);break;case UNICODE.TOCSTART:a=c.last(),s=t.createNode(NODE_TYPE.TOC),ZWJSONUtils.cloneAndExtend(s.style._.op={},r),s.start=u,s.end=s.start+o.length,a.append(s),c.push(s),t._.zwNodesList.addItem(s);break;case UNICODE.TOCEND:for(;s.type!==NODE_TYPE.TOC;)s=c.pop(),s.end=u;s.end=u+UNICODE.TOCEND.length;break;default:n=n||NODE_TYPE.TEXT,a=c.last(),(r=d[u])&&(a.isBlockNode()&&a.type!==NODE_TYPE.PARAGRAPH&&(s=t.createNode(NODE_TYPE.PARAGRAPH),s.start=u,a.append(s),c.push(a=s)),a.isInlineNode()&&(s.end=a.start+(a.text||"1").length,c.pop(),a=c.last()),s=t.createNode(n),ZWJSONUtils.cloneAndExtend(s.style._.op={},r),s.start=u,s.end=s.start+o.length,a.append(s),c.push(a=s),t._.zwNodesList.addItem(s)),a.text+=o}});return function(n){"string"==typeof n&&(n=JSON.parse(n)),t.call(this),ZWJSONUtils.cloneAndExtend(this._.op,n.defaults);var o,r,a=n.content,s=n.styles,l=this.body=this.createNode(NODE_TYPE.SECTION),d=n.ranges;this._.content=a,this._.styles=s;var c=ZWJSONUtils.clone(d||{});if(ZWJSONUtils.isEmptyObject(c))c.namedRange=DocOpBuilder.build([]);else for(var u in c)c[u]=DocOpBuilder.build(c[u]);for(l.style&&ZWJSONUtils.cloneAndExtend(l.style._.op,s[l.start=0]);null!==(o=e.exec(a));)o.index&&(l.end=o.index,this._.zwNodesList.addItem(r=l),i(l,this,n),l=this.createNode(NODE_TYPE.SECTION),l.style&&ZWJSONUtils.cloneAndExtend(l.style._.op,s[l.start=e.lastIndex-1]),r.insertAfter(l));return l.end=a.length,this._.zwNodesList.addItem(l),i(l,this,n),this._.zwNodesList.forEach(function(e){e._.isOrphan=!1}),"undefined"!=typeof NamedRange&&NamedRange.init(c.namedRange),this}}(),ZWDocument.prototype.moveCursor=function(e,t){var i,n,o=t?0:e.length-(NODE_TYPE.PARAGRAPH==e.type?1:0);return this._.cursorOp=[{r:e.start+o},{as:{start:i={type:"cursor"},id:n=Utils.randomString()}},{r:0},{as:{end:ZWJSONUtils.getKeys(i),id:n}}],"undefined"!=typeof Op&&Op.cursorProcessed(),this},ZWDocument.prototype.regenerateQRCodeAndBarcodeWithFilledValues=function(e){var t=function(e,t){for(var i=Object.keys(e),n=0;n<i.length;n++){var o=i[n];if(null!=o&&"is_test_submission"!==o&&"sequence_number_info"!==o){var r=e[o];if(r.hasOwnProperty("2")&&t===r[2])return r.hasOwnProperty("6")?r[6]:r[1]}}return""},i=function(e,i){for(var n=e.indexOf(UNICODE.MERGEFIELD_START);n!=-1;){var o=e.indexOf(UNICODE.MERGEFIELD_END,n),r=e.substring(n+1,o),a=t(i,r);e=e.replace(UNICODE.MERGEFIELD_START+r+UNICODE.MERGEFIELD_END,a),n=e.indexOf(UNICODE.MERGEFIELD_START,o+1)}return e};this.visitAllNodes(NODE_TYPE.IMAGE,function(t){if(t.isBarcode()||t.isQRCode())if(t.isBarcode()){var n=t.barcode_info,o=n.value;if(o.includes(UNICODE.MERGEFIELD_START)&&t.style._.op.hasOwnProperty("ffInfo")){n.value=i(o,e);var r=BarCodeGenerator.generateBarCodeForWriter(n);t.style.src=r,t.setFormat("ffInfo",null),t.setBarcodeInfo(n)}}else if(t.isQRCode()){for(var a=t.qrcode_info,s=a.values,l=Object.keys(s),d=0;d<l.length;d++){var c=l[d],u=s[c];u.includes(UNICODE.MERGEFIELD_START)&&t.style._.op.hasOwnProperty("ffInfo")&&(s[c]=i(u,e))}var r=QRCodeGenerator.generateQRCodeForWriter(a);t.setFormat("ffInfo",null),t.style.src=r,t.setQRCodeInfo(a)}})},ZWDocument.prototype.removeNode=function(e){var t,i,n=E(e),o=Object.keys(n).length;switch(e.type){case NODE_TYPE.PARAGRAPH:return void V.call(this,e,n);case NODE_TYPE.TEXT:e.getPreviousSibling(),e.getNextSibling(),e.getParent();break;case NODE_TYPE.ROW:o&&q.call(this,e,n);break;case NODE_TYPE.TABLE:o&&(t=e.getPreviousSibling(),i=e.getNextSibling())}var r=e._.previousItem;S(e);var a=e.length+(e.type==NODE_TYPE.SECTION?UNICODE.SECTION.length:0);if(x(e,-1*a),U(e,-1*a,r&&r._.nextItem||e._.nextItem),l.call(this,[{r:e.start},{ds:e.getContent()}]),ee(e),o&&e.type===NODE_TYPE.TABLE){var s,d,c;for(s in n)d=n[s],c=this.createNode(d.type,d.fieldType),ZWJSONUtils.cloneAndExtend(c.style._.op,d.style._.op),d.type===NODE_TYPE.FIELD_END?t.append(c):d.type===NODE_TYPE.FIELD_START&&i.prepend(c)}return e.previousSibling=e.nextSibling=null,e.start=e.end=0,e},ZWDocument.prototype.removeNodes=function(e){return e.forEach(function(e){e.remove(),e._.isOrphan=1}),e};var ee=function(e){var t=e.nextSibling,i=e.previousSibling,n=e.parent;n&&n.lastChild===e&&(n.lastChild=i),n&&n.firstChild===e&&(n.firstChild=t),t&&(t.previousSibling=i),i&&(i.nextSibling=t),e.parent=null};ZWDocument.prototype.removeComment=function(e){var t=this.getCommentById(e),i=Z.call(this,t,!1);return i.forEach(function(e,t){e.remove()}),this},ZWDocument.prototype.removeTemporaryNode=function(e){return S(e),ee(e),e.start=e.end=0,e},ZWDocument.prototype.removeNamedRangeById=function(e,t){return z.call(this,[this.getNamedRangeById(e)],t),this},ZWDocument.prototype.removeNamedRangesByName=function(e,t){return z.call(this,this.getNamedRangesByName(e),t),this},ZWDocument.prototype.replaceSequenceNumbersInDocument=function(e){this.visitAllFields(NODE_TYPE.AUTOFIELD,function(t){if("doc_sequence_number"==t.getAutoFieldType()){var i=t.getSequenceNumberInfo(),n=null!=i?i.name:"",o=e[n],r=editor.getDocument().createNode(NODE_TYPE.TEXT,o||"");t.getStart().insertBefore(r),t.remove()}})},ZWDocument.prototype.replaceTextAtRange=function(){var e=function(e,t,i){var n,o,r=i.length-t.length,a=e.type==NODE_TYPE.TEXT,s=a?e.text:e.getContent(),d=a?ZWJSONUtils.clone(e.style._.op):{},c=i==UNICODE.BR;c&&(d={type:NODE_TYPE.BR}),delete d[ATTR_COMMON.ST],delete d[TCConstants.TC],n=[{r:e.start+t.start}],i&&((a||c)&&n.push({as:{start:d,id:o=Utils.randomString()}}),n.push({is:i}),(a||c)&&n.push({as:{end:ZWJSONUtils.getKeys(d),id:o}})),t.length&&n.push({ds:s.slice(t.start,t.end)}),a&&(e.text=s.slice(0,t.start)+i+s.slice(t.end)),e.end+=r,x(e,r),U(e,r,e._.nextItem),l.call(this,n)},t=function(e){for(var t,i,n=new RegExp(UNICODE.BR+"|"+UNICODE.TAB,"g"),o=[],r=e.match(n)||[],a=0,s=r.length;a<s;a++)i=e.indexOf(r[a]),t=e.slice(0,i),t&&o.push(t),o.push(e.slice(i,i+1)),e=e.substring(i+1);return e&&o.push(e),o},i=function(e,t){var i=[];return e.forEach(function(e){var n,o;switch(e){case UNICODE.BR:o=NODE_TYPE.BR;break;case UNICODE.TAB:o=NODE_TYPE.TAB;break;default:o=NODE_TYPE.TEXT}n=editor.getDocument().createNode(o,e),o==NODE_TYPE.TEXT&&(t.type==NODE_TYPE.TEXT&&ZWJSONUtils.cloneAndExtend(n.style._.op,t.style._.op),delete n.style._.op[ATTR_COMMON.ST],delete n.style._.op[ATTR_BORDERS.WIDTH],delete n.style._.op[ATTR_TOC.leader],delete n.style._.op[TCConstants.TC]),i.push(n)}),i};return function(n,o,r){r=r||"";var a=t(r);if(a.length<=1)return e.call(this,n,o,r);var s=this.createRange();s.start=n.start+o.start,s.end=n.start+o.end,s.splitText();var l=i(a,n),d=0==o.start?n:n.nextSibling;l.forEach(function(e){d.insertBefore(e)}),o.length&&d.remove()}}(),ZWDocument.prototype.setBackgroundColor=function(e){this._[ATTR_BODY.DS_BGC]=e.toString()},ZWDocument.prototype.setFormat=function(e,t,i){if(e&&t){var o,r=1,a=!1;switch(t){case ATTR_AUTOFIELD.VALUE:if(!i)return;i=Math.abs(i);break;case ATTR_CELL.Z_TD_BGC:case ATTR_TEXT.TS_BGC:case ATTR_TEXT.TS_FGC:i=i.toString();break;case ATTR_TEXT.TS_VA:/^(sub|super|none)$/.test(i)||(i=n);break;case ATTR_TEXT.TS_FV:i=i?"small-caps":"";break;case ATTR_IMAGE.I_HT:o=ATTR_IMAGE.I_HT_UN;case ATTR_IMAGE.I_WID:if(o=o||ATTR_IMAGE.I_WID_UN,e.type===NODE_TYPE.IMAGE){i=i||0;var s=parseFloat(i),d=UNITS.PIXELS;if(isNaN(s))return;isNaN(i)&&(d=i.replace(/[(0-9).(0-9)]*/,"")),e.style._.op[o]=d,i=s}break;case ATTR_TEXT.TS_FS:if(!/^(italic|none)$/.test(i))return;break;case ATTR_TEXT.TS_FW:if(!/^(bold|none)$/.test(i))return;break;case ATTR_IMAGE.I_AL:if(!/^(bottom|front|left|right|center|square|behind)$/.test(i))return;break;case ATTR_PARAGRAPH.PS_AL:if(!/^[0-3]$/.test(i))return;break;case ATTR_PARAGRAPH.PS_DIR:if(!/^(ltr|rtl)$/.test(i))return;break;case TCConstants.TC:e.type!=NODE_TYPE.TABLE&&e.type!=NODE_TYPE.TOC||(a=!0);break;case"autoFitToPage":if(r=0,!i)return;e.style.width=100+UNITS.PERCENTAGE;var c=e.getColumnWidths().length||1;return void(e.style.columnsWidth=Array.apply(null,Array(c)).map(function(){return{wt:100/c+UNITS.PERCENTAGE}}));case ATTR_PARAGRAPH.PS_HD:if(!/^([0-6]|10[1-3])$/.test(i))return}if(r&&(e.style._.op[t]=i),!e._.isOrphan){var u=[{r:e.type===NODE_TYPE.PARAGRAPH?e.end-1:e.start}],p={type:e.style._.op.type},g=Utils.randomString();r&&(p[t]=i),u.push({as:{start:p,id:g}}),u.push({r:e.type===NODE_TYPE.TEXT?e.length:1}),u.push({as:{end:ZWJSONUtils.getKeys(p),id:g}}),l.call(this,u,!0),a&&te(this,e,t,i)}}},ZWDocument.prototype.setFormats=function(e,t){for(var i=Object.keys(t),n=i.length,o=0;o<n;o++){var r=i[o];e.setFormat(r,t[r])}};var te=function(e,t,i,n){var o=t.type==NODE_TYPE.TABLE?"TABLEEND":"TOCEND",r=e.createNode(NODE_TYPE[o]);r.start=t.end-1,r.end=r.start+UNICODE[o].length,r._.isOrphan=!1,e.setFormat(r,i,n)};ZWDocument.prototype.setLocale=function(e){if(!e||!this._.op)return this;var t={};return t[ATTR_BODY.DS_LANGUAGE]=e,a(this,t),this},ZWDocument.prototype.setPageSetup=function(e){if(!e)return this;var t=ZWFormatConverter.convertJSONToFormat(e);!this._.pageSetup&&(this._.pageSetup={}),!this._.pageSetup._&&(this._.pageSetup._={});for(var i in t)this._.pageSetup._[i]=t[i];var n=this._.pageSetup._;return a(this,n),this},ZWDocument.prototype.getPageSetupAsJSON=function(){return ZWFormatConverter.convertFormatToJSON(this._.pageSetup?this._.pageSetup._:this.getPageSetup()._)},ZWDocument.prototype.setPageMargins=function(e){if(!e)return this;for(var t in e){if(!(e[t]<4&&e[t]>0))throw new TypeError("Values should be between 0 and 4 !!");e[t]+=UNITS.INCHES}var i,n=ZWFormatConverter.convertJSONToFormat(e),o=[{r:0}],r=n;return r.type=NODE_TYPE.BODY,o.push({as:{start:r,id:i=Utils.randomString()}}),o.push({r:0}),o.push({as:{end:ZWJSONUtils.getKeys(r),id:i}}),l.call(this,o),this},ZWDocument.prototype.splitParagraphAt=function(e,t){var i=e.length;if(isNaN(t)||t<0||t>i)throw new TypeError("Index is not valid !!");for(var n,o,r=e.getFirstChild(),a=t+e.start,s=new ZRange(a);r;){if(n=new ZRange(r.start,r.end),n.strictlyContainsRange(s)){o=r.splitAt(a-r.start);break}if(n.start==s.start){o=r;break}r=r.getNextSibling()}var d,p=this.createNode(NODE_TYPE.PARAGRAPH);e.style._.op&&ZWJSONUtils.cloneAndExtend(p.style._.op,e.style._.op);for(var g,f=o,E=[];f;)d=f.getNextSibling(),g=f.length,S(f),x(f,-1*g),U(f,-1*g,e),f.start=0,f.end=0,E.push(f),f=d,f&&(f.start-=g,f.end-=g);c.call(this),e.insertAfter(p),u.call(this);var T,m,h=[{r:a}];h.push({as:{start:T=e.style._.op,id:m=Utils.randomString()}}),h.push({is:UNICODE.PARAGRAPH}),h.push({as:{end:ZWJSONUtils.getKeys(T),id:m}}),l.call(this,h);for(var I=0,_=E.length;I<_;I++)this.append(E[I],p,!1);return r&&(r.nextSibling=void 0),p},ZWDocument.prototype.surroundWithCommentRange=function(e,t){var i=this.createNode(NODE_TYPE.FIELD_START,NODE_TYPE.COMMENT,t),n=this.createNode(NODE_TYPE.FIELD_END,NODE_TYPE.COMMENT,t),o=e.getStartNode(),r=e.getEndNode();if(ZWJSONUtils.cloneAndExtend(i.style._.op,this.createComment(t)),n.style._.op.id=i.style._.op.id,r.type===NODE_TYPE.PARAGRAPH)r.append(n);else if(r.type===NODE_TYPE.TEXT){var a=Math.abs(e.end-r.start);0===a?r.insertBefore(n):a>0&&(a!==r.length&&r.splitAt(a),r.insertAfter(n))}else r.insertBefore(n);if(e.length)if(o.type===NODE_TYPE.PARAGRAPH)o.append(i);else if(o.type===NODE_TYPE.TEXT){var a=Math.abs(e.start-o.start);0===a?o.insertBefore(i):a>0&&(a!==o.length&&o.splitAt(a),o.insertAfter(i))}else o.insertBefore(i);else n.insertBefore(i);return this},ZWDocument.prototype.sync=function(e){for(var t=this._.zwNodesList.firstItem;t;)t._.dtNodeId||t.type!==NODE_TYPE.IMAGE?t.type===NODE_TYPE.IMAGE&&t.style._.op.subType===NODE_TYPE.CHART&&t._.isUpdateInProgress&&w.call(t,t._.updateCallback):(t.style._.op.subType===NODE_TYPE.CHART&&M.call(t,t._[ATTR_CHART.CHART_TYPE]),t.style._.op.subType===NODE_TYPE.WIDGET&&!t.style._.op.mminfo&&F.call(t)),t=t._.nextItem;var i=JSON.parse(this.getChanges().toString());d(i),"undefined"!=typeof PubSub&&PubSub.publish("SDK/AfterSyncComplete"),e&&e()},ZWDocument.prototype.updateField=function(e){switch(e.type){case NODE_TYPE.IMAGE:case NODE_TYPE.TEXTBOX:return D.apply(this,arguments);case NODE_TYPE.AUTOFIELD:return R.apply(this,arguments);case NODE_TYPE.SIGNERFIELD:return v.apply(this,arguments);case NODE_TYPE.FILLABLEFIELD:return L.apply(this,arguments);case NODE_TYPE.BOOKMARK:case NODE_TYPE.LINK:return O.apply(this,arguments);case NODE_TYPE.MAILMERGEFIELD:case NODE_TYPE.REPEAT_START:return b.apply(this,arguments)}},ZWDocument.prototype.visitAllFields=function(e,t){if("function"==typeof t)return isHeadlessHTML||!$?ie.call(this,e,t):Q.call(this,e,t),this};var ie=function(e,t){if("function"==typeof t)for(var i,n,o,r=this.getAllSections(),a=0,s=r.length;a<s;a++)i=r[a],n=this.createRange(),n.setStart(i,i.getIndex()+1-i.start),n.setEnd(i,i.getEndIndex()-i.start),n.visitNodes({handleNodeStart:function(i){e==NODE_TYPE.FILLABLEFIELD&&(i.type===NODE_TYPE.IMAGE||i.type===NODE_TYPE.TEXTBOX)&&i.isFillableImageField()||e===NODE_TYPE.SIGNERFIELD&&i.isSignerImageField()?t(i):i.type!==NODE_TYPE.FIELD_START||"*"!==e&&i.fieldType!==e||(o=i.getField())&&t(o)},handleNodeEnd:function(e){}})};ZWDocument.prototype.visitNode=function(e,t){H(e,t)},ZWDocument.prototype.visitAllNodes=function(e,t){if("function"==typeof t)for(var i,n,o=function(i){"*"!==e&&i.type!==e||t(i)},r=function(e){},a=0,s=this.getAllSections(),l=s.length;a<l;a++)i=s[a],n=this.createRange(),n.setStart(i,i.getIndex()+1-i.start),n.setEnd(i,i.getEndIndex()-i.start),n.visitNodes({handleNodeStart:o,handleNodeEnd:r})},ZWDocument.prototype.addWatermark=function(){return function(e,t){if("text"===e){var i={};i.text=t;for(var n,o=[],r=DocUtil.getWatermarkOps(i,"TEXT"),a=editor.getDocument(),s=0;s<r.length;s++)n=r[s],o.push(DocOpBuilder.build(n));var l=DocOpBuilder.combineOps(o);a._.composedDocOps=DocOpBuilder.combineOps([a._.composedDocOps,l])}return this}}(),ZWDocument.prototype.removeWatermark=function(){var e=function(e){e.type==NODE_TYPE.IMAGE&&e.isWatermark()&&e.remove()};return function(){var t=this.getAllHeaders();t.forEach(function(t){t.getAllDescendants().forEach(e.bind(this))})}}();var $="undefined"!=typeof editor;ZWDocument.prototype.getDocumentLength=function(){return $?editor.doc.getDocumentLength():this._.content.length},ZWDocument.prototype.getRawFormatAt=function(e){return $?editor.doc.getRawFormatAt(e):this._.styles[e]},ZWDocument.prototype.getCharAt=function(e){return $?editor.doc.getCharAt(e):this._.content.charAt[e]},ZWDocument.prototype.getDocumentContent=function(e,t){return $?editor.doc.getContent(e,t):this._.content.substring(e,t)},ZWDocument.prototype.deleteContents=function(e){if(e.length){var t=e.getStartNode();if(t){var i=t.type===NODE_TYPE.PARAGRAPH,n=!1;if(i){if(1===e.length)return void t.mergeToNextPara();n=!0}var o=i&&1===t.length;if(o||i||t.isInlineNode()){var r=e.start,a=e.end,s={inlnodes:[]},l=e.getEndNode(),d=T(e);s[NODE_TYPE.PARAGRAPH]=[],s[NODE_TYPE.TABLE]=[],s[NODE_TYPE.TOC]=[],s[NODE_TYPE.HR]=[],l&&l.isInlineNode()&&l.start!==a&&l.type==NODE_TYPE.TEXT&&l.splitAt(a-l.start);var c,u=o?t:t.getParent();for(n?u=t:t.start===r?t.start===u.start&&u.end<=a?s[u.type].push(u):c=t:c=t.splitAt(r-t.start);c&&e.containsRange(c);)d.hasOwnProperty(c.style._.op.id)||s.inlnodes.push(c),c=c.getNextSibling();for(var p=u.getNextSibling();p&&e.containsRange(p);)s[p.type].push(p),p=p.getNextSibling();if(p)if(p.type===NODE_TYPE.PARAGRAPH)for(c=p.getFirstChild();c&&e.containsRange(c);)s.inlnodes.push(c),c=c.getNextSibling();else if(p.type===NODE_TYPE.TABLE)for(var g=p.getFirstChild();g;){for(c=g.getFirstChild();c&&e.containsRange(c);)s[NODE_TYPE.PARAGRAPH]=s[NODE_TYPE.PARAGRAPH].concat(c.getChildNodes()),c=c.getNextSibling();g=g.getNextSibling()}for(var f,E,m,h=["inlnodes",NODE_TYPE.TABLE,NODE_TYPE.TOC,NODE_TYPE.HR,NODE_TYPE.PARAGRAPH],I=0,_=h.length;I<_;I++)for(m=s[h[I]],f=0,E=m.length;f<E;f++)m[f].remove();n&&t.mergeToNextPara()}}}},ZWDocument.prototype.deleteContentsInRange=function(e,t){if($){var i=editor.doc.createRange(e,t);i.deleteContentsInRange()}},ZWDocument.prototype.filterNodes=function(e,t){if("function"==typeof t)for(var i,n,o=function(i){e(i)&&t(i)},r=function(e){},a=0,s=this.getAllSections(),l=s.length;a<l;a++)i=s[a],n=this.createRange(),n.setStart(i,i.getIndex()+1-i.start),n.setEnd(i,i.getEndIndex()-i.start),n.visitNodes({handleNodeStart:o,handleNodeEnd:r})};for(var ne,oe=[{get:"getFooterDistance",set:"setFooterDistance",fmtKey:ATTR_BODY.DS_FB,minVal:0,maxVal:8,units:UNITS.INCHES},{get:"getHeaderDistance",set:"setHeaderDistance",fmtKey:ATTR_BODY.DS_HT,minVal:0,maxVal:8,units:UNITS.INCHES},{get:"getPageMarginBottom",set:"setPageMarginBottom",fmtKey:ATTR_BODY.DS_MB,minVal:0,maxVal:4,units:UNITS.INCHES},{get:"getPageMarginLeft",set:"setPageMarginLeft",fmtKey:ATTR_BODY.DS_ML,minVal:0,maxVal:4,units:UNITS.INCHES},{get:"getPageMarginRight",set:"setPageMarginRight",fmtKey:ATTR_BODY.DS_MR,minVal:0,maxVal:4,units:UNITS.INCHES},{get:"getPageMarginTop",set:"setPageMarginTop",fmtKey:ATTR_BODY.DS_MT,minVal:0,maxVal:4,units:UNITS.INCHES}],re=0,ae=oe.length;re<ae;re++)ne=oe[re],ZWDocument.prototype[ne.get]=function(e){return function(){return this._.op[e.fmtKey]}}(ne),ZWDocument.prototype[ne.set]=function(e){return function(t){if(t=isNaN(t)?parseFloat(t):t,e.fmtKey==ATTR_BODY.DS_HT&&parseFloat(this._.op[ATTR_BODY.DS_FB])+t>9||e.fmtKey==ATTR_BODY.DS_FB&&parseFloat(this._.op[ATTR_BODY.DS_HT])+t>9)throw new TypeError("Header and Footer distance cannot be greater than 9{units} when combined".replace("{units}",e.units));if(!(e.minVal<=t&&t<=e.maxVal))throw new TypeError("Value should be between "+e.minVal+" and "+e.maxVal+" !!");if(t+=e.units,this._.op[e.fmtKey]!==t){var i={};this._.op[e.fmtKey]=i[e.fmtKey]=t,a(this,i)}}}(ne);ZWDocument.showTree=function(e){if(e)for(var t=e._.zwNodesList.firstItem;t;)t=t._.nextItem},ZWDocument.setSkipCompose=c,ZWDocument.resetSkipCompose=u}(window),function(e){"use strict";var t="XX-ERR: ",i="\n",n=" ",o="!!-WARN: ",r=function(e,r){switch(r=Array.prototype.slice.call(r),this.logs+=i+this.timeStamp+n,e){case 1:e=t;break;case 2:e=o;break;default:e=""}this.logs+=e+r.join(n)};e.ZWLogs=new function(){this.logs=""},Object.defineProperties(ZWLogs,{timeStamp:{get:function(){return new Date}}}),ZWLogs.clear=function(){this.logs=""},ZWLogs.error=function(){r.call(this,1,arguments)},ZWLogs.log=function(){r.call(this,0,arguments)},ZWLogs.warn=function(){r.call(this,2,arguments)}}(window),DocMutationEvents=function(){var e=editorProps.deployment.writer,t=function(){document.location.reload()},i={SUCCESS:function(){var e=editor.doc.docInfo;1==e.VERSION&&0==e.REVISION&&DocInfo.setProperty({newDoc:!1}),ZWCollaboration.startingVersionId||(ZWCollaboration.startingVersionId=editor.doc.docInfo.VERSION_ID),ZWCollaboration.contentEdited=!0},VIEWING:function(){UIUtils.showMessagePopup(J.i18n("common","CHANGEPERMISSION"),J.i18n("common","CHANGEPERMISSION_TITLE_MSG"),"info",t,!0)},TRASHED_DOC:function(){PubSub.publish("Document/Trashed",editor.doc.docInfo.CREATOR_ZUID)},NOT_AUTHORIZED_USER:function(){UIUtils.isDialogOpened("commonerror")||UIUtils.showMessagePopup(J.i18n("common","ACCESS_MESSAGE"),J.i18n("common","ACCESS_REVOKED"),"",t,!1,!1,"access");},CLIENT_VERSIONDIFF_EXCEEDS:function(){UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"info",editor.reloadDocumentContent,!0)},REVERT_STATE:function(){UIUtils.showMessagePopup(J.i18n("common","REVERT_RELOAD"),J.i18n("common","REVERT_RELOAD_TITLE_MSG"),"info",editor.reloadDocumentContent,!0)},MARKAS_FINAL:function(e){U.isEmpty(e)||PubSub.publish("Document/FinalStateModified",e.FINAL_INFO)},NEW_VERSION_UPLOAD_STATE:function(){UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD_RELOAD"),e,"info",editor.reloadDocumentContent,!0)},CHECKEDOUT:function(e){e.MESSAGE&&(e.MESSAGE=J.i18n("writer.remote.LOCKED_USER_MSG",[e.CHECKEDOUTBY_NAME])),PubSub.publish("Collaboration/ResourceLocked",e.CHECKEDOUTBY_ZUID,e.CHECKEDOUTBY_NAME,!e.hasOwnProperty("RELOAD")||e.RELOAD,e.MESSAGE)},RESOURCE_EMPTY:function(){UIUtils.showMessagePopup(J.i18n("common","RESOURCE_NOT_ACCESSIBLE"),e,"info")},SAVEDCONTENT_REPAIRED:function(){UIUtils.showMessagePopup(J.i18n("error","CONTENT_REPAIR_ERROR"),J.i18n("error","CONTENT_REPAIR_ERROR_TITLE_MSG"),"info",editor.reloadDocumentContent,!0)},_default:function(){}},n=function(e){isV8Engine||J("#network_error_parent").css({"margin-left":e})},o=function(e,t){UIUtils.showFreezeMessage(!1);var n=i._default;return i.hasOwnProperty(e)&&(n=i[e]),n.apply(null,[t])},r=function(i){var o=i.responseText,r=i.responseJSON||{},a=["<a href='#' onclick='document.location.reload();'>","</a>"],s=J.i18n("writer.editor.ZFS_EXCEPTION",a);if(200==i.status&&i.getResponseHeader("Content-Type").toLowerCase().indexOf("text/html")>=0)UIUtils.showFreezeMessage(!0,"info",J.i18n("writer.common.SIGNED_OUT_MESSAGE",a));else if(500!==i.status&&400!==i.status||!o||o.indexOf("AUTHENTICATION_FAILED")==-1)if(500==i.status&&o&&o.indexOf("TRASHED_DOC")!=-1)PubSub.publish("Document/Trashed",editor.doc.docInfo.CREATOR_ZUID);else if(500==i.status&&o&&o.indexOf("ZFS_EXCEPTION")!=-1){var l=JSON.parse(o),d=l.ERROR_CODE;"F918"===d?PubSub.publish("Collaboration/ResourceLocked",l.CHECKEDOUTBY_ZUID,l.CHECKEDOUTBY_NAME,!0):(UIUtils.showFreezeMessage(!0,"warning",d+" : "+s),n("22%"))}else if(500===i.status&&o&&o.indexOf("REDIS_EXCEPTION")!==-1){var d=JSON.parse(i.responseText).ERROR_CODE;UIUtils.showFreezeMessage(!0,"warning",d+" : "+s),n("22%"),clearTimeout(Collaboration.slowRespTimer)}else if(500!==i.status&&400!==i.status||!i.responseText||i.responseText.indexOf("BROWSER_COOKIES_DISABLED")===-1)if(500===i.status||409===i.status){var d=JSON.parse(i.responseText).errorCode;UIUtils.showFreezeMessage(!0,"warning",d+" : "+s),n("22%")}else if(502===i.status)PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SERVER_ERROR_502_BAD_GATEWAY,errorMsg:"MSG_EDIT_ERROR"});else if("timeout"===i.statusText)ZWOffline.isOfflineSetupDone()?UIUtils.showNetworkError():PubSub.publish("Document/Mutation/SlowResponse",{title:"TITLE_SERVER_BUSY",errorNo:ZWCollaboration.ACKPENDING_ERROR,errorMsg:"MSG_SERVER_BUSY"});else if("SAMEVERSIONREVISION"==r.UPDATE)ZWCollaboration.checkForResend();else if("FAILED"==r.UPDATE)ZWCollaboration.handleUpdateFailure();else if("CLIENT_VERSIONDIFF_EXCEEDS"==r.UPDATE)UIUtils.showMessagePopup(J.i18n("common","VERSIONDIFF_EXCEED_MSG"),J.i18n("common","VERSIONDIFF_EXCEED_TITLE_MSG"),"info",editor.reloadDocumentContent,!0);else if("OPUPDATEFAILED_INLOCKSTATE"==r.UPDATE)PubSub.publish("Collaboration/LockReceived");else if("CHECKEDOUT"==r.UPDATE)PubSub.publish("Collaboration/ResourceLocked",r.CHECKEDOUTBY_ZUID,r.CHECKEDOUTBY_NAME,!0);else if("SAVE_FAILURE"==r.UPDATE)ZWCollaboration.handleUpdateFailure();else if("REDIS_VERSION_MISMATCH"==r.UPDATE)ZWCollaboration.handleUpdateFailure(ZWCollaboration.REDIS_EXCEPTION);else if("REMOTE_TRASH"==r.UPDATE)PubSub.publish("Document/RemoteTrashed");else if("RESOURCE_TRASHED"==r.UPDATE)PubSub.publish("Document/Trashed",editor.doc.docInfo.CREATOR_ZUID);else if("READ_ONLY_USER"==r.UPDATE||"OPS_NOT_PERMITTED"==r.UPDATE)PubSub.publish("Document/unauthorizededit");else if("TC_OPS_NOT_PERMITTED"==r.UPDATE)PubSub.publish("Document/UnauthorizedTCEdit");else if("PERMISSIONDENIED_FOR_LOCK"==r.UPDATE)PubSub.publish("Collaboration/LockNotAllowed");else if("REVERT_STATE"==r.UPDATE)UIUtils.showMessagePopup(J.i18n("common","REVERT_RELOAD"),J.i18n("common","REVERT_RELOAD_TITLE_MSG"),"info",editor.reloadDocumentContent,!0);else if("NEW_VERSION_UPLOAD_STATE"==r.UPDATE)UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD_RELOAD"),e,"info",editor.reloadDocumentContent,!0);else if("MARKAS_FINAL"==r.UPDATE){if(U.isEmpty(r.FINAL_INFO))return;PubSub.publish("Document/FinalStateModified",r.FINAL_INFO)}else if("SAVEDCONTENT_REPAIRED"==r.UPDATE)UIUtils.showMessagePopup(J.i18n("error","CONTENT_REPAIR_ERROR"),J.i18n("error","CONTENT_REPAIR_ERROR_TITLE_MSG"),"info",editor.reloadDocumentContent,!0);else{if("PERMISSIONDENIED_FOR_UNLOCK"!=r.UPDATE){var c="";return i&&(i.status?c=i.status:i.statusText&&(c=i.statusText)),ZWLogger.log("OTHER SERVER ERRORS ::: "+c),ZWLogger.sendErrorDetails("NO_ERROR_MAIL<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n RESPONSE STATUS ::: "+c+"\n"+ZWCollaboration.clientInfo+"\n Err No ="+ZWCollaboration.SXP_ERR_100+" DOC len ="+editor.doc.getDocumentLength()+" MsgQueue = "+ZWCollaboration.msgQueue.toProtoString()+" FULL DOC OP IDS :: "+ZWCollaboration.docOpIds+" buildLabel::: "+buildLabel+"\n Error Log End \n",null,ZWCollaboration.SXP_ERR_100),void UIUtils.showNetworkError()}PubSub.publish("Collaboration/UnockNotAllowed")}else{var d=JSON.parse(i.responseText).errorCode;UIUtils.showFreezeMessage(!0,"warning",d+" : "+J.i18n("writer.editor.BROWSER_COOKIE_DISABLE",["<a href='"+editorProps.urls.helpPageDomain+"/portal/kb/articles/how-can-i-enable-cookies-in-my-browser-26-11-2018-1' target='_blank'>","</a>"])),n("25%")}else{var l=JSON.parse(o),d=l.ERROR_CODE;"RF950"==d?UIUtils.showMessagePopup(J.i18n("common","SERVER_UPDATE_MSG"),J.i18n("common","NEW_UPDATE"),"info",t,!0):UIUtils.showMessagePopup(J.i18n("common","CHANGEPERMISSION"),J.i18n("common","CHANGEPERMISSION_TITLE_MSG"),"info",t,!0)}},a=function(e){var t=function(){PubSub.publish("System/NetworkUp")},i=function(){UIUtils.showNetworkError(J.i18n("common","SERVER_NOT_AVAILABLE"))};ZWNetworkUtils.checkNetwork(t,i)},s=function(){PubSub.subscribe("Document/Mutation/SendSuccess",o),PubSub.subscribe("Document/Mutation/SendError",r),PubSub.subscribe("Document/Mutation/SlowResponse",a)};return{addSubscribers:s}}(),DocOperationEvents=function(){var e,t=editorProps.deployment.writer,i={undo:1,redo:1,instable:1,mergecells:1,splitcells:1,unmergecells:1,deltable:1},n=function(t,n){if(i[t]?(UIUtils.toggleTableTabAndButtons(editor.zuid),"instable"==t&&PubSub.publish("Document/TableInserted")):"ForeColor"===t?Doc.curForeGrdColor=n:"BackColor"===t?Doc.curBackGrdColor=n:"ParaBackColor"===t?Doc.curParaBackGrdColor=n:"deleteAllBookMarks"==t?J("#bMarkGoTo,#bMarkDelete,#bAllDelete").attr("disabled",!0):"unlock"==t&&UIUtils.toggleRedactBtns(),("FormatPainter"!=t&&!editor.doc.paintFormat_dblClick&&!jQuery.isEmptyObject(editor.doc.paintFormat)||editor.doc.paintFormat_dblClick&&"applyStyle"!=t)&&(DomUtil.clearFormatPainterData(),UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","uncheck"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","uncheck")),("applyStyle"===t&&n.length&&"body"===n[0].type||"resetStyle"===t||"updateHeadingStyle"===t)&&(PubSub.publish("Document/bodyStyleChanged"),"updateView"==n[2]&&UIUtils.setEditorPaneWrapperHeight(!0)),"applyStyle"===t&&"updateLastColumnWidth"==n[2]&&PubSub.publish("Table/marginChanged"),"undo"===t||"redo"===t||"insertnote"===t||"removenote"===t||"changenotetype"===t||"changeallnotetype"===t){var o=DocTreeManager.doc.getSection(editor.doc.getSelection().getStart()),r=o.start;e!=r&&(EventHandler.setClientActiveSection(o),EventHandler.toggleSection(),editor.jMultiByteSpan.css({top:CurUtil.offset.start.top})),"undo"!==t&&"redo"!==t||PubSub.publish("Document/UndoRedo",t)}"tableLeftMarginChanged"!=editor.lastOperation&&"updateView"!=editor.lastOperation&&"applyTablePanelStyle"!=editor.lastOperation&&"updatePageLayout"!=editor.lastOperation&&"changeDesign"!=t||PubSub.publish("Document/TableStructureModified"),"delete"===t&&PubSub.publish("Selection/updateClientLeft"),editor.currentCommand=COMMAND.ANY,"Bold"!=t&&"Italic"!==t&&"Strikethrough"!==t&&"Underline"!==t||PubSub.publish("Toolbar/UpdateToolbar")},o=function(t,i){var n=editor.doc.getSelection(),o=TransformHandler.getCurrentObjectInfo().type;if(o&&!editor.imgDrag&&"string"==typeof t&&(t.indexOf("ins")!=-1||t.indexOf("auto")!=-1))if("hr"==o){var r=editor.doc.getElementAt(n.getStart()+1);if(r){var a=n.getLastRange();a.setStart(r.getStart()),a.setEnd(r.getEnd())}}else if("image"==o){var a=n.getLastRange();a.setEnd(n.getStart()+1)}else if("textbox"==o){var s=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,n.getStart());if(!s&&"InsertChar"!=t){var a=n.getLastRange();a.setEnd(n.getStart()+1)}}"undo"===t||"redo"===t||"notes"===t?e=editor.doc.getSectionStart(n.getStart()):"FormatPainter"==t&&(UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","check"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","check"))},r=function(){UIUtils.showLoadingMsg(J.i18n("common","PASTING")),d(),PubSub.subscribe("DocOperation/AfterPaste",s)},a=function(e,t){var i=e.html,n=document.createElement("div");n.innerHTML=i?i:"",JContainer=J(n),"cut"!=t&&JContainer.find("span[data-comment-info]").remove(),J(n.firstChild).attr("data-doc-id",editor.doc.docInfo.DOCUMENT_ID),i=n.innerHTML,e.html=i},s=function(){UIUtils.hideLoadingMsg(),Macros.shouldShowPasteToolbar()&&UIUtils.showPasteToolbar(),PubSub.unsubscribe("DocOperation/AfterPaste",s)},l=function(){UIUtils.hideLoadingMsg()},d=function(){UIUtils.hideControllers()},c=function(e){if(e&&e.cursor){var t,i,n,o,r=e.node,a=r.parent.getIndex(),s=a+r.start,l=a+r.end,d=e.cursor;for(t in d){i=d[t]||[];for(var c=0,u=i.length;c<u;c++)if((n=i[c])&&n.start&&n.end&&s<=n.start&&n.start<l&&n.start>-1&&n.end>-1){o=editor.doc.createRange(n.start,n.end,t);var p=editor.doc.getSelection(t);("tableResize"==editor.lastOperation||"updateRowHeight"==editor.lastOperation||"updateColumnWidth"==editor.lastOperation||"updateLastColumnWidth"==editor.lastOperation||Op.isListItemSelection||p.isListItemSelection||p.isMultipleSelection)&&o.setFocus(!1),ZWLogger.log("@handleCommandProgress: lastOperation: "+editor.lastOperation+", currentCommand: "+editor.currentCommand+", nodeType-"+r.type+": ["+s+", "+l+"], cursor: ["+o.start+", "+o.end+"]");try{p.removeAllRanges().setSelectionType(SEL_OP_GEN).showCaret(o).setCursorFormat()}catch(e){ZWLogger.log("@handleCommandProgress: Exception: "+e.stack);break}}}}},u=function(e){if("collabop"!==e.operation){w_usersettings.LAST_CLOSED_TIME=(new Date).getTime();var t=e.operation;if(t!=COMMAND.PASTE&&t!=COMMAND.IMAGE_STYLE_OP||PubSub.publish("DocOperation/AfterPaste"),t==COMMAND.PASTE||t==COMMAND.RE_PASTE){var i=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");i&&DomUtil.scrollElementIntoView(i[0])}}},p=function(){UIUtils.showLoadingMsg(J.i18n("common","CREATE_IMAGE"))},g=function(){UIUtils.hideLoadingMsg()},f=function(){document.location.reload()},E=function(e){"CreateLink"===e&&LinkDialog.openLinkPopup()},T=function(){UIUtils.showMessagePopup(J.i18n("common","YOUR_TRYING_TO_LOCK_CONTEND"),J.i18n("lock","CONTENT_LOCKED"),"info")},m=function(){if("PUBLIC"!=editor.doc.getRole()){J("#loading-html").hide(),CurUtil.blinkCursor();var e=Utils.endTime("LOADING_COMPONENT");editor.docClientInfo.LOADING_COMPONENT=e;var t=editor.doc.docInfo;1==t.CHECKEDOUT?(PubSub.publish("Collaboration/ResourceLocked",t.CHECKEDOUTBY_ZUID,t.CHECKEDOUTBY_NAME,!1),editor.zuid!=t.CHECKEDOUTBY_ZUID&&J("#Rmenu,#spellCheckMenu,#fmt-lpnl-linespacemenu").zmenu("disable")):t.newDoc&&J("#undo,#redo").each(function(){J(this).disable()}),UIEventHandler.addSubscribers(),J.ZToolbarHandler.init(),J.ZMenuHandler.init(),LinkDialog.init(),UIUtils.initDOMElements(),UIUtils.onEditorLoad(),ReviewUtil.initTooltips(),UIUtils.initMaskTooltipsInToolpnl(),editor.handleScroll(),UIUtils.toggleCollabActionButtons(),UIUtils.handleDocumentLoadingComplete(),DocTreeManager.isContentSectionBuildInProgress()&&UIUtils.JprogressDiv.css({display:"inline-block"}),editor.isOffline()||I(),"true"==String(t.ISSHARED)&&J("#collablistmenuinvoke").addClass("ui-display-block");var i=editor.doc.getUserData()[editor.zuid];i&&i.showNavigationPane&&DocumentMap.refreshMap(),J(document.createElement(NODE_TYPE.LINK)).attr({href:cssCdnZWStaticPath+fingerPrintObj["styles/writer_lazy_min_all.css"],rel:"stylesheet",type:"text/css"}).appendTo(document.head),RemoteDiff.loadDiff()}},h=function(){if(!isHeadlessPDF&&"PUBLIC"!=editor.doc.getRole()&&("undefined"!=typeof RemoteEditor?RemoteEditor.options.is_password_protected||editor.bindEvents():editor.bindEvents(),J("#editorpane").attr("data-context","Rmenu"),UIUtils.hideLoadingMsg(),editor.getRole().permissions.can("document.edit")&&(MarkAsFinal.updateMarkAsFinalPermissions(),editor.browserInfo.is_firefox&&J("#_zohoPaste").css("position","fixed")),"PUBLIC"!=editor.doc.getRole())){var e=ZWNetworkUtils.getContextUrl("jsp/fragments.jsp"),t=(editor.doc.docInfo,{});window.isCachedEditor?(t.action="offline",t.role="OFFLINE"):Macros.getRsidLangAction(t),J.ajax({type:"GET",url:e,data:t,success:function(e){var t=document.createElement("fragment");t.innerHTML=e;var i,n,o,r,a,s,l,d=0;for(n=t.children,d=0,i=n.length;d<i;d++)if(o=t.children[d],r=o.id,a=r.replace("frag-",""),s=J("#"+a),s[0])l=s[0].children,l.length?J(l[0]).before(o.innerHTML):s.append(o.innerHTML),UIStateHandler.build(s[0]);else if(DomUtil.nodeNameEquals(o,"script")){var c=document.createElement("script");c.innerText=o.innerHTML,document.body.appendChild(c)}else{for(var u=o.children,p=document.createDocumentFragment();u.length;)p.appendChild(u[0]);v(p),document.body.appendChild(p)}Jdocument.ztooltip({displayType:"callout",position:"auto",showShortcutKey:!0,showDelay:"500"}),UIUtils.setDocumentLogo(),UIUtils.initComponent(),PubSub.publish("UI/FrgamentJSPLoaded")}}),editor.jeditorPaneWrapper.append(Z("popup-menu-container")[0])}},I=function(){"undefined"!=typeof WordCountDlg&&WordCountDlg.updateWordCountInBottomPannel()},_=function(e,t){if(null!=editor.subAction.pages)e.getRelativePageNumber()>=editor.subAction.pages&&(editor.startCursorIdx=DocLayoutManager.getPageRange(parseInt(editor.subAction.pages)).start,editor.isLazyFileLoaded&&(editor.subAction.state=!0,editor.afterInit()));else if(null!=editor.subAction.bookmarks||null!=editor.subAction.comments||null!=editor.subAction.ranges){var i=e.isEmpty()?null:e.getLastParaView();null!=i&&editor.initAfterContentRendered(i.getNode())}DocTreeManager.isContentSectionBuildInProgress()||null==editor.subAction||editor.subAction.state||t||!editor.isLazyFileLoaded||(editor.startCursorIdx=1,editor.subAction.state=!0,editor.afterInit())},A=function(){if("PUBLIC"!=editor.doc.getRole()){var e=editor.doc.getRole(),t=editor.doc.docInfo;J("#documentname").zellipsis("setTitle",t.DOCUMENT_NAME),UIUtils.initUserInfoDialog(editorProps.userInfo),UIUtils.fetchUpdateAutoFieldMenu(),UIUtils.updateZohoLogoLink(),"TRYEDITOR_WRITER"===e?UIUtils.openSignupWelcome():UIUtils.updateBottomBar()}},S=function(){"undefined"!=typeof DesignUI&&DesignUI.updateDesignUI()},R=function(e){e&&UIUtils.setDocName(e),window.document.title=e;var t=editor.doc.docInfo;1==t.VERSION&&0==t.REVISION&&DocInfo.setProperty({newDoc:!1});var i=editor.editorPaneContainer[0].scrollTop;EditorUtil.focusMultiByteSpan(),editor.editorPaneContainer[0].scrollTop=i},O=function(e){switch(e){case"RequestError":UIUtils.enableRenameButton("rename_ok"),UIUtils.enterKey(J("#renamefilename"),FileMenu.renameFile);break;case"ResponseFailed":UIUtils.showMessagePopup(J.i18n("writer.common.UNABLE_TO_RENAME"),J.i18n("common","ALERT"),"info")}},b=function(){UIUtils.disableDocumentShortcuts(),UIUtils.handleDocumentLockByOwner()},v=function(e){if(DomUtil.nodeNameEquals(e,"script")){var t=e.parentNode,i=document.createElement("script"),n=e.innerHTML;return""!==n?i.innerText=n:(i.type="text/javascript",i.src=e.src),t.insertBefore(i,e),void t.removeChild(e)}for(var o=D(e),r=0;r<o.length;r++)v(o[r])},D=function(e){for(var t=[],i=e.firstChild;i;)t.push(i),i=i.nextSibling;return t},f=function(){document.location.reload()},L=function(e){UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD_RELOAD"),t,"info",editor.reloadDocumentContent,!0)},N=function(){PubSub.publish("Comment/ShowCurrentSelection")},P=function(e){UIUtils.showLoadingMsg(e?e:J.i18n("editor","REMOTE_TRASH"),6e4)},C=function(){UIUtils.enableDocumentShortcuts(),UIUtils.handleDocumentUnLockByOwner()},y=function(e){try{if(UIUtils.isPasteToolbarOn()&&editor.doc.getSelection().isCollapsed()&&!TransformHandler.getCurrentObjectInfo().type){var t=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");t.css("visibility","visible")}UIUtils.JdocumentMenu.hide(),UIUtils.hideControllers(),e&&e==KEYS.ESC&&(jQuery.isEmptyObject(editor.doc.paintFormat)||(UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","uncheck"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","uncheck")))}catch(e){}},F=function(e){e&&"mousedown"===e.type&&UIUtils.hideControllers()},M=function(){"undefined"!=typeof RemoteEditor&&RemoteEditor.options.pview&&editor.jeditorPane.find("div.zw-page").css({border:"1px solid #cbcbcb","box-shadow":"0px 0px 0px transparent",margin:"0px"})},w=function(e,t){UIUtils.clearView(t),UIUtils.updateViewStatus(e),"Web View"===e&&UIUtils.applyWebView()},U=function(){try{N(),UIUtils.toggleRedactBtns()}catch(e){}},x=function(){UIUtils.JdocumentMenu.hide(),UIUtils.hideControllers()},f=function(){document.location.reload()},B=function(){Macros.showMessagePopup(t,f)},H=function(e){EventHandler.isMenuOpened?EventHandler.isMenuOpened=!1:EventHandler.isDialogOpened&&J("#collabdialog").is(":visible")&&UIUtils.preProcessForDialogClose(),UIUtils.hideControllers()},G=function(e){EventHandler.isDialogOpened||EventHandler.isMenuOpened||(UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","check"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","check"))},k=function(e){CommonError.openBuildChangePopup(e)},W=function(){UIUtils.showMessagePopup(J.i18n("common","EDITING_NOT_ALLOWED"),t,"info",editor.reloadDocumentContent)},Y=function(){UIUtils.hideRightClickMenu()},z=function(){UIUtils.updateNonPrintingButtonLabel()},V=function(){PubSub.subscribe("DocOperation/AfterExecCmd",n),PubSub.subscribe("DocOperation/BeforeExecCmd",o),PubSub.subscribe("DocOperation/CommandProgress",c),PubSub.subscribe("DocOperation/CommandComplete",u),PubSub.subscribe("DocOperation/BeforePaste",r),PubSub.subscribe("DocOperation/PasteError",l),PubSub.subscribe("DocOperation/BeforeDropImage",p),PubSub.subscribe("DocOperation/AfterDropImage",g),PubSub.subscribe("DocOperation/applyLastAction",E),PubSub.subscribe("DocOperation/LockError",T),PubSub.subscribe("DocOperation/AfterGettingSelectedHTML",a),PubSub.subscribe("Document/ComponentInitialized",m),PubSub.subscribe("Document/AfterInit",h),PubSub.subscribe("Document/UserDataFetched",I),PubSub.subscribe("Document/Paginated",_),PubSub.subscribe("Document/ComponentInitialized",A),PubSub.subscribe("Document/themeChanged",S),PubSub.subscribe("Document/Renamed",R),PubSub.subscribe("Document/RenameFailed",O),PubSub.subscribe("Document/Locked",b),PubSub.subscribe("Document/UnLocked",C),PubSub.subscribe("Document/RemoteTrashed",P),PubSub.subscribe("Document/NewVersionUploaded",L),PubSub.subscribe("Document/view/changed",w),PubSub.subscribe("Document/CursorPositionChanged",U),PubSub.subscribe(DOCUMENT.PAGINATION_COMPLETE,M),PubSub.subscribe("Document/DocumentDblClick",G),PubSub.subscribe("Document/MouseEvent",F),PubSub.subscribe("Document/BeforeKeyDown",y),PubSub.subscribe("Document/BeforeMouseDown",H),PubSub.subscribe("Document/AfterNaviagtion",x),PubSub.subscribe("Document/SessionInvalid",B),PubSub.subscribe("Server/BuildChange",k),PubSub.subscribe("Document/show_non_printing_char/changed",z),PubSub.subscribe(["Editor/WheelEvent","Document/BeforeMouseDown"],Y),PubSub.subscribe("Document/unauthorizededit",W)};return{addSubscribers:V}}();var ContentChangeEventHandlers=function(){var e=null,t=function(t,i,n,o){e={type:t,from:i,to:n,chars:o}},i=function(i,n){e&&"is"===e.type&&e.to===i?e.to=n:e?(o(),t("is",i,n)):t("is",i,n)},n=function(i,n,r){e&&"ds"===e.type&&i===e.from?(e.to+=n-i,e.chars+=r):e?(o(),t("ds",i,n,r)):t("ds",i,n,r)},o=function(){return e?("is"===e.type?PubSub.publish("Document/ContentAdded/Optimized",e):PubSub.publish("Document/ContentDeleted/Optimized",e),void(e=null)):0};return{onInsert:i,onDelete:n,throwFinal:o}}();PubSub.subscribe("Document/ContentAdded",ContentChangeEventHandlers.onInsert),PubSub.subscribe("Document/ContentDeleted",ContentChangeEventHandlers.onDelete),PubSub.subscribe("Document/PostApplyTo",ContentChangeEventHandlers.throwFinal),CollabEvents=function(){var e=editorProps.deployment.writer,t=function(e,t){ZWCollaboration.addCollaborator(e,t),editor.zuid!=e&&UIUtils.showMsgStatusbar(J.i18n("writer.common.STATUSMSG.openedtheDocument",[t.fname]))},i=function(e){if(ZWCollaboration.removeCollaborator(e),editor.zuid!=e){var t=editor.doc.getUserData()[e]||{};UIUtils.showMsgStatusbar(J.i18n("writer.common.STATUSMSG.closedtheDocument",[t.fname]))}},n=function(t){UIUtils.showMessagePopup(J.i18n("common","CANT_DELETE_TABLE")+" "+J.i18n("common","IS_LOCK_THIS_TABLE",[t]),e,"info")},o=function(){document.location.reload()},r=function(e,t){UIUtils.showMessagePopup(J.i18n("common","CHANGEPERMISSION"),J.i18n("common","CHANGEPERMISSION_TITLE_MSG"),"info",o,!0)},a=function(e,t,i,n){var o=DocUtil.getVersionFromMsg(n),r=DocUtil.getCurrentDocVersion(),a=DocUtil.getVersionNumberDiff(r,o);if(a<0){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),editor.zuid===i&&editor.rebindEvents();var s=function(){editor.doc.getSelection().select(),UIUtils.hideLoadingMsg(),PubSub.unsubscribe("Document/LoadingStart",s)},l=editor.doc.docInfo;PubSub.subscribe("Document/LoadingStart",s),editor.fetchDocument(l.RID,""),UIUtils.showMessage("info",J.i18n("common","REVERTED_INFO",[e,new ZWDateTime(t,null,editorProps.userInfo.language).format("MMM DD YYYY, hh:mm A")]),"showclose","normalfont",5e3)}},s=function(){editor.rebindEvents(COLLAB_PERMISSION),UIUtils.hideLoadingMsg(),UIUtils.showMessagePopup(J.i18n("common","UPGRADE.DOC_UPGRADE_MSG_TO_OWNER"),J.i18n("common","DOC_UPGRADE_TO_OWNER_TITLE_MSG"),"info",o,!0)},l=function(){UIUtils.toggleCollabActionButtons()},d=function(e,t){DocInfo.setProperty({ISSHARED:"true"}),UIUtils.toggleCollabActionButtons(),J("#Collaborators_btn").is(":enabled")||J("#Collaborators_btn,#notifyCollaborators").prop("enable",!0),J("#collablistmenuinvoke").addClass("ui-display-block"),PubSub.publish("HandleResourceShare/Done")},c=function(e,t){UIUtils.isDialogOpened("commonerror")||UIUtils.showMessagePopup(J.i18n("common","ACCESS_MESSAGE"),J.i18n("common","ACCESS_REVOKED"),"",o,!1,!1,"access"),J("#collablistmenuinvoke").removeClass("ui-display-block")},u=function(e,t,i,n){UIUtils.handleDocumentCheckOut(e,t,i,n)},p=function(e,t){UIUtils.handleDocumentCheckIn(e,t)},g=function(){UIUtils.showMessagePopup(J.i18n("common","CONTENT_LOCK"),e,"info",o,!0)},f=function(){UIUtils.showMessagePopup(J.i18n("common","UNAUTHORIZELOCK"),e,"info",editor.reloadDocumentContent,!0)},E=function(){UIUtils.showMessagePopup(J.i18n("common","UNAUTHORIZE_UNLOCK"),e,"info",editor.reloadDocumentContent,!0)},T=function(e,t){t.sid!=editor.uuid&&UIUtils.handleDocumentMerged(e,t)},m=function(){PubSub.subscribe("Collaboration/UserAdded",t),PubSub.subscribe("Collaboration/UserRemoved",i),PubSub.subscribe("Collaboration/TableBeingUsed",n),PubSub.subscribe("Collaboration/DocumentReverted",a),PubSub.subscribe("Collaboration/DocPermissionChanged",r),PubSub.subscribe("Collaboration/DocumentMigratedTo3.0",s),PubSub.subscribe("Collaboration/EnableCollabPanel",l),PubSub.subscribe("Collaboration/ResourcePermissionRemoved",c),PubSub.subscribe("Collaboration/ResourceShared",d),PubSub.subscribe("Collaboration/ResourceLocked",u),PubSub.subscribe("Collaboration/ResourceUnLocked",p),PubSub.subscribe("Collaboration/LockReceived",g),PubSub.subscribe("Collaboration/LockNotAllowed",f),PubSub.subscribe("Collaboration/UnlockNotAllowed",E),PubSub.subscribe("Collaboration/DocumentMerged",T)};return{addSubscribers:m}}(),SystemEvents=function(){var e=function(){UIUtils.showNetworkError()},t=function(){ZWLogger.log("SystemEvents NetworkUp - Called"),ZWCollaboration.checkForResend(),ZWCollaboration.syncSent=!1,clearTimeout(ZWCollaboration.slowRespTimer),ZWCollaboration.slowRespTimer=void 0,UIUtils.UnfreezeEditor()},i=function(){PubSub.subscribe("System/NetworkFailure",e),PubSub.subscribe("System/NetworkUp",t)};return{addSubscribers:i}}(),UserEvents=function(){var e=function(){UIUtils.showFreezeMessage(!0,"info",J.i18n("common","SIGNED_OUT_MESSAGE"))},t=function(){PubSub.subscribe("User/SignedOut",e)};return{addSubscribers:t}}(),EditorEvents=function(){var e=function(){"undefined"!=typeof DocMutationEvents&&DocMutationEvents.addSubscribers(),"undefined"!=typeof DocOperationEvents&&DocOperationEvents.addSubscribers(),"undefined"!=typeof CollabEvents&&CollabEvents.addSubscribers(),"undefined"!=typeof SystemEvents&&SystemEvents.addSubscribers(),"undefined"!=typeof UserEvents&&UserEvents.addSubscribers()};return{addSubscribers:e}}(),EditorEvents.addSubscribers();var Export=function(){"use strict";var e=function(e){if((USER_ROLE.PUBLIC===editorProps.userInfo.role&&editorProps.isPublishToFill||/SHAREDREAD|ANYONELINK_SHAREDREAD/.test(editorProps.userInfo.role)&&editorProps.isFillableForm)&&"pdf"==e.format){var i=FillableFieldsHandler.getFillableFieldInfo();Object.keys(i).length&&(e.isFillableFieldMerge=!0,e.fillableFieldData=i)}var n=t.bind(e);/^(PUBLIC|ANYONELINK_SHAREDREADFILL)$/.test(editor.doc.getRole())?n():WebUtil.saveDocumentCurrentVersions(n)},t=function(){var e=ZWJSONUtils.clone(this),t=e.format;if("pdf"==t||"pdfform"==t)return void PrintPreview.downloadUsingPDF(!0,!1,"_self",e);delete e.format;var i=ZWNetworkUtils.getContextUrl("jsp/export.jsp?FORMAT="+t),o=Macros.getAction();i+=Macros.getRIdString(),i+="&ACTION="+o,e.versionid&&(i+="&versionid="+e.versionid,delete e.versionid),i+="&options="+encodeURIComponent(JSON.stringify(e)),n(i)},i=function(){var e=document.createElement("iframe");return e.id="exportErr",e.style.display="none",document.body.appendChild(e),e},n=function(e){var t=document.getElementById("exportErr");void 0==t&&(t=i()),t.src=e},o=function(){var e=!0;return editor.getRole().permissions.can("document.download")||(e=!1),e},r=function(){MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_WARNING,J.i18n("writer.common.WARNING"),J.i18n("writer.common.DOWNLOAD_NOT_ALLOWED"))};return{exportAs:e,loadUrl:n,createIframe:i,hasDownloadPermissionInOrg:o,showReqDownloadPermissionDlg:r}}();UIUtils.initDOMElements=function(){UIUtils.jToolbarComp=J("#panel-container, #paraPropMenu,#smartToolbar"),UIUtils.uiCopyButton=UIUtils.jToolbarComp.find("#fmt-lpnl-copy"),UIUtils.uiShapePortionStyles=UIUtils.jToolbarComp.find("#shapePortionstyles,#shapeParaAlign"),UIUtils.uiNotConnectorMenus=J("#shapenofill,#fillimage,#shadow,#reflection,#duplicateshapebtn,#vertiTextAlign,#shapeWrapType,#textFormattingContainer,#shapefillcolor"),UIUtils.uiNotWatermarkeMenus=J("#duplicateshapebtn,#shapeWrapType,#vertiTextAlign,#sendbackward,#bringforward,#shapereset,#shape-lpnl-mmbtn"),UIUtils.uiNotGroupShapeMenus=J("#textFormattingContainer"),UIUtils.uiNotChildShapeMenus=J("#shape-arrange-menus"),UIUtils.uiSmartToolbar=J("#smartPortionStyles"),UIUtils.uiTextAlignment=UIUtils.jToolbarComp.find("#fmt-lpnl-textalign, #pcm-text-alignment, #fmt-lpnl-sub-textalign"),UIUtils.uiParaDir=UIUtils.jToolbarComp.find("#fmt-lpnl-sub-dircontainer"),UIUtils.uiBulletsAndIndent=UIUtils.jToolbarComp.find("#bulletsAndIndent"),UIUtils.defaultFontSize=J("#smart_fontSize"),UIUtils.uiFontStyle=UIUtils.jToolbarComp.find("#fmt-lpnl-headingmenubtn,#fmt-lpnl-sub-headingmenubtn,#smart-headingmenubtn,#paraPropformat_headingStyle"),UIUtils.uiSaveButton=UIUtils.jToolbarComp.find("#undoRedoContainer"),UIUtils.saveStatusMsg=Z("topband-savestatus-msg"),UIUtils.JdocumentMenu=J("#documentmenu"),UIUtils.JscrollbarPageInfoFlag=J("#page-info-flag-container"),UIUtils.JnotifyMessageDiv=J("#notifyMessage"),UIUtils.bottomBar=J("#bottombar"),UIUtils.JredactBtn=J("#review-tb-redact"),UIUtils.JunredactBtn=J("#review-tb-unredact"),J("#filemnu_docOwnerName").html(docProps.info.CREATOR_HTML),J("#filemnu_userImg").attr("src",contactServer+"/file?t=user&ID="+docProps.info.CREATOR_ZUID+"&fs=thumb")},UIUtils.onEditorLoad=function(){var e=window.location.href;if(e.indexOf("upgrade")!=-1){var t=J("#mainOuterDiv").position().top;J("div#ng-preview-doc").height(t).show()}editor.browserInfo.is_chrome?(J("#remote-topband-print").remove(),J("#remote-topband-print-chrome").show()):editor.browserInfo.is_edge?(J("#remote-topband-print").remove(),J("#remote-topband-print-chrome").remove()):J("#remote-topband-print-chrome").remove()},UIUtils.initUserInfoDialog=function(e){J("#topband-userimg,#dashboard-topband-userimg").attr("src",contactServer+"/file?t=user&ID="+e.zuid+"&fs=thumb"),J("#topband-default-rightoptions").find("button#topband-userinfo").removeClass("ui-state-highlight")},UIUtils.updateZohoLogoLink=function(){J("#topband-zohologo").attr("href",editorProps.urls.writerLandingPageURL+"&src=gdrive")},UIUtils.postProcessingForUpgrade=function(){var e=J("#mainOuterDiv").position().top;J("div#ng-preview-doc").height(e).show(),editor.doc.docInfo.UpgradeTemplateToWriter3&&(J("#upgrade_preview_msg").text(J.i18n("common","UPGRADE_TEMPLATE_PREVIEW_MSG")),J("#BackToOldWriterlink").remove()),J("#quickFixedView,#quickPageView,#quickWebView,#quickFullScreen,#collaboratorPanelDiv").prop("disable",!0),UIUtils.bottomBar.hide()},UIUtils.updateSaveButton=function(e){J("#topband-save").zbutton(e)},UIUtils.showSaveStatus=function(e,t,i,n,o){try{if(clearInterval(window.saveStatusIntervalTimer),Z("topband-saved-icon").hide(),!e)return void UIUtils.saveStatusMsg.text(t);n||(n=(new Date).getTime());var r=function(e,t,i){if(!t)return void UIUtils.saveStatusMsg.text(e);var n,o=new Date(i),r=new Date,a=new ZWDateTime(o,null,editorProps.userInfo.language),s=r.getMonth()-o.getMonth()+12*(r.getFullYear()-o.getFullYear()),l=o.getFullYear()!=r.getFullYear()||s>2;n=l?a.format("MMMM DD YYYY"):Utils.getTimeFromNow(o);var d=e||"";if(editor.zuid==t)d=l?J.i18n("common","LAST_EDITED_ON_TIME",[n]):J.i18n("common","LAST_EDITED_TIME",[n]);else{var c=editor.doc.getUserData()[t],u=c.nickname||c.fname;d=l?J.i18n("common","LAST_EDITED_BY_COLLABORATOR_ON",[u,n]):J.i18n("common","LAST_EDITED_BY_COLLABORATOR",[u,n])}UIUtils.saveStatusMsg.text(d)};1==e?o?window.saveStatusTimer=setTimeout(function(){var e=J.i18n("common","SAVE_STATUS_ONLINE");editor.isOffline()?e=J.i18n("common","SAVE_STATUS_OFFLINE"):Z("topband-saved-icon").show(),r(e),clearInterval(window.saveStatusIntervalTimer),window.saveStatusIntervalTimer=setInterval(r,6e4,null,i,n)},2e3):(r(null,i,n),clearInterval(window.saveStatusIntervalTimer),window.saveStatusIntervalTimer=setInterval(r,6e4,null,i,n)):(clearInterval(window.saveStatusIntervalTimer),clearTimeout(window.saveStatusTimer),r(e,i,n))}catch(e){}},UIUtils.showViewChangesLink=function(){Z("sinceLastVisitLink").on("animationend",function(e){}).addClass("bInOut-animated bounceIn-anim").show(),Z("topband-savestatus").hide(),PubSub.subscribe("Document/SaveStatus",UIUtils.hideViewChangesLink)},UIUtils.hideViewChangesLink=function(e,t,i){ZWCollaboration.contentEdited&&(Z("sinceLastVisitLink").hide(),Z("topband-savestatus").fadeIn(100),PubSub.unsubscribe("Document/SaveStatus",UIUtils.hideViewChangesLink));},UIUtils.displayLinkForShowChanges=function(){var e=editor.doc.docInfo;if(!(editor.doc.docInfo.newDoc||isHeadlessPDF||isHeadlessHTML||editor.isOffline()||e.CHECKEDOUT||1==e.VERSION&&0==e.REVISION||!editor.getRole().permissions.can("document.edit")||editor.isNonEditableView())){var t=function(e){"SUCCESS"==e.RESPONSE&&"diff"==e.VERSION&&UIUtils.showViewChangesLink()};Macros.canDisplayChangesLink(t)}},UIUtils.FreezeEditor=function(e,t){UIUtils.freezeState=!0,UIUtils.hideWrappers(!0),UIUtils.showMessage(e,t),editor.rebindEvents(ERROR_PERMISSION),ZWLogger.log("FREEZE EDITOR - CALLED"),Z("Rmenu").zmenu("disableMenuItems",["undo_smart","redo_smart"]),J("#cutCopyPasteContainer").zbutton("disable","#fmt-lpnl-cut,#fmt-lpnl-copy,#fmt-lpnl-paste");try{var i=J("#bottombar");J("#topband-hamburger").prop("disabled",!0),J("#topband").find("#topband-settings,#topband-shared-label,#topband-spotlightsearch").disable(),J("#topband").find("#topband-share-owner").hide(),i.find("#bbar-shortcutdlg").disable(),J("#review-tb").find("button").disable(),J("#complete-tb").find("button").disable(),J("#topband-modes").zselectbox("disable")}catch(e){}ReviewUtil.setFreeze(!0),PubSub.publish("Editor/Freeze")},UIUtils.UnfreezeEditor=function(){if(UIUtils.freezeState){editor.rebindEvents(),UIUtils.preProcessForDialogClose(),UIUtils.freezeState=!1,ZWLogger.log("UNFREEZE EDITOR - CALLED"),J("#editorpane,.ui-qat-container").css({opacity:"1.0"}),Z("Rmenu").zmenu("enableMenuItems",["undo_smart","redo_smart"]),J("#cutCopyPasteContainer").zbutton("enable","#fmt-lpnl-cut,#fmt-lpnl-copy,#fmt-lpnl-paste");try{UIUtils.hideMessage(),ReviewUtil.setFreeze(!1),J("#topband-hamburger").prop("disabled",!1),J("#topband").find("#topband-settings,#topband-shared-label,#topband-spotlightsearch").enable(),J("#topband").find("#topband-share-owner").show(),J("#bottombar").find("button").enable(),J("#review-tb").find("button").enable(),J("#complete-tb").find("button").enable(),J("#topband-modes").zselectbox("enable"),UIUtils.hideWrappers(!1)}catch(e){}editor.getRole().permissions.can("document.edit")&&editor.doc.getSelection().select();var e="contentpane";J(editor.clientActiveSection).hasClass("zw-contentpane")||(e="hdrfooter"),UIUtils.handleUnfreezeEditor(e),PubSub.publish("Editor/Unfreeze")}},UIUtils.showMessage=function(e,t,i,n,o,r){var a=J("#topband-notification");a.find(".ui-znotifier-message").html(t),a.find("#notification-close").hide();var s="info"===e?"ui-wnotify-success":"ui-wnotify-fail";a.find(".ui-topbanner-notification-cont").removeClass("ui-wnotify-success ui-wnotify-fail").addClass(s),a.show(),a.find("#notification-close").toggle(!!i),a.find("#notification-reload").toggle(!!r),o&&setTimeout(function(){a.hide()},o)},UIUtils.hideMessage=function(){J("#topband-notification").hide()},UIUtils.showNetworkError=function(e){ZWLogger.log("SHOW NETWORKERROR CALLED"),clearTimeout(ZWCollaboration.slowRespTimer),ZWCollaboration.slowRespTimer=void 0,OfflineImpl.handleNetworkError(e),ZWNetworkUtils.retryNetwork()},UIUtils.toggleTableTabAndButtons=function(e){},UIUtils.openShareDialog=function(e){return editor.doc.docInfo.DOCUMENT_NAME!=J.i18n("writer.common.UNTITLED_DOCUMENT")||e||"false"!=editor.doc.docInfo.ISSHARED?void Macros.openShareDialog():(RenameDialog.open(Macros.openShareDialog),!1)},UIUtils.openShareToSupportDialog=function(){ZDComponents.openShareToSupportComponent(editor.doc.rid)},UIUtils.setWebViewWidth=function(e){var t=J("#webview-wid-percentage-combobox"),i=J("#web-view-widPercenge-view-pnl"),n=["25%","50%","75%","100%"];n.indexOf(parseInt(e)+"%")==-1&&(t.zcombobox("removeOption","#bbar-widpercent-webview-custom"),i.zcombobox("removeOption","#view-widpercent-webview-custom"),t.zcombobox("addOptionAt",J('<option value="'+parseInt(e)+'%" id="bbar-widpercent-webview-custom">'+parseInt(e)+"%</option>"),4),i.zcombobox("addOptionAt",J('<option value="'+parseInt(e)+'%" id="view-widpercent-webview-custom">'+parseInt(e)+"%</option>"),4)),e||(e="100"),t.zcombobox("setValue",parseInt(e)+"%"),i.zcombobox("setValue",parseInt(e)+"%")},UIUtils.updateViewStatus=function(e){e=e||EditorView.getView();var t=e.replace(/\s/,"");t=t.toLowerCase();var i,n=J("#bbar-editorview"),o="",r=J("#editorview-btn");"pageview"==t?(i="page_view",o="pageview-nw"):"webview"==t&&(i="web_view",o="webview-nw",J("#editorview-btn").zmenubutton("setAttribute","icon","ui-sprit-fast ui-icon-webview-nw-sm")),n.zmenu("check",i),J("#view-lpnl-pgview-grp-"+t).zbutton("check"),UIUtils.setWebViewWidth(EditorView.getViewWidth()),r.zmenubutton("setAttribute","icon","ui-sprit-fast ui-icon-"+o+"-sm");var a="Page View"==e?J.i18n("common","DOUBLE_CLICK_TO_HIDE_PAGE_BREAK"):J.i18n("common","DOUBLE_CLICK_TO_SHOW_PAGE_BREAK");J(".ui-page-collapse-div").attr("title",a).children().removeClass("ui-icon-page-collapse-sm").removeClass("ui-icon-page-expand-sm").attr("class",("Fixed View"==e?"ui-icon-page-expand-sm":"ui-icon-page-collapse-sm")+" js-collpse-span js-collpse-span zbutton__icon ui-sprit-lazy"),J("#ui-focus-typing").ztoggleswitch("1"===editorProps.userInfo.settings[ATTR_BODY.DS_FOCUS_TYPING]?"switchOn":"switchOff")},UIUtils.handleDocumentCheckOut=function(e,t,i,n){if(editor.zuid==e){J("#pausecollab").ztoggleswitch("switchOff");for(var o in editor.doc.domCursor)o!==editor.uuid&&(DomUtil.removeCursorNode(o,"start"),DomUtil.removeCursorNode(o,"end"));var r={};r.CHECKEDOUT=!0,r.CHECKEDOUTBY_NAME=editor.loginName,r.CHECKEDOUTBY_ZUID=editor.zuid,DocInfo.setProperty(r),UIUtils.showDocStatusIcon()}else{if(!editor.getRole().permissions.can("document.edit"))return;var a,s,l=editorProps.deployment.writer;n?a=n:i?(a=J.i18n("common","CHECKEDOUTBY",[t]),s=J.i18n("common","CHECKEDOUTBY_TITLE_MSG")):(a=J.i18n("common","CHECKEDOUTBY_LOCKED",[t]),s=l),i?(PubSub.publish("Document/SaveStatus",!1,void 0),UIUtils.showMessagePopup(a,s,"info",reload,!1,!1,void 0,reload)):(J(".ui-dialog-content").dialog(),J(".ui-dialog-content").dialog("close"),UIUtils.showFreezeMessage(!0,"info",a),J(".cursor").hide(),UIUtils.disableDocumentShortcuts(),Macros.updatePartnerSaveStatus(!0))}},UIUtils.handleDocumentCheckIn=function(e,t){if(editor.zuid==e){J("#pausecollab").ztoggleswitch("switchOn");var i={};i.CHECKEDOUT="",i.CHECKEDOUTBY_NAME="",i.CHECKEDOUTBY_ZUID="",DocInfo.setProperty(i),J("#topband-docstatus").find("#checkout-status").hide()}else{var n=J.i18n("common","CHECKINBY",[t]);UIUtils.showMessagePopup(n,J.i18n("common","CHECKINBY_TITLE_MSG"),"success",reload,!1,!1,void 0,reload)}},UIUtils.showZohoError=function(e,t,i,n){i||(i="0");try{if(editor.browserInfo.is_chrome)if(U){var o=Object.keys(U);o.contains("each")||ZWLogger.log("UNDER SCORE WAS OVERWRITE :: "+JSON.stringify(o))}else ZWLogger.log("UNDER SCORE IS NULL ::: "+U)}catch(e){}var r=ZWLogger.shrinkOperationSequence(ZWCollaboration.operationSequence).join(",");if(ZWLogger.sendErrorDetails(i+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+i+" DOC len ="+editor.doc.getDocumentLength()+" Cur St ="+editor.doc.getSelection().getStart()+" Cur end="+editor.doc.getSelection().getEnd()+" MsgQueue = "+ZWCollaboration.msgQueue.toProtoString()+" FULL DOC OP IDS :: "+ZWCollaboration.docOpIds+" buildLabel::: "+buildLabel+"\nOperation Sequence: \n"+r+"\nError Log End \n<ZWERROR>"+ZWCollaboration.mailInfo,null,i),ZWCollaboration.stopUpdates=!0,editor.rebindEvents(ERROR_PERMISSION),!n){var a=function(){window.location.reload()};UIUtils.showMessagePopup(J.i18n("error",t),J.i18n("error",e),"error",a,!0,!1)}},UIUtils.toggleButton=function(e,t,i){J("#"+e).zbutton(i,"#"+t)},UIUtils.toggleButtonStatus=function(e,t,i){J("#"+e).zbuttonset(i,"#"+t)},UIUtils.enableRenameButton=function(e){J("#"+e).removeClass("ui-state-disabled").addClass("ui-state-enabled")},UIUtils.closeDialog=function(e){J.dialogutil.close(e)},UIUtils.openDialog=function(e){J.dialogutil.open(e,void 0)},UIUtils.updateLockIconAndText=function(e){var t=J("#share_btn_lock"),i=J("#menuitem_share_btn_lock");e?(DocInfo.setProperty({DOCUMENT_LOCKED:!0}),t.zbutton("option","label",J.i18n("common","UNLOCK")),t.zbutton("option","icons",{primary:"zicon zicon-unlock"}),i.length?(i.find(".ui-zmenu-text").text(J.i18n("common","UNLOCK")),J("#sharetabmenu").zmenu("changeIcon","menuitem_share_btn_lock","zicon zicon-unlock")):(t.metadata().label=J.i18n("common","UNLOCK"),t.metadata().icons={primary:"zicon zicon-unlock"})):(DocInfo.setProperty({DOCUMENT_LOCKED:!1}),t.zbutton("option","label",J.i18n("common","LOCK")),t.zbutton("option","icons",{primary:"zicon zicon-lock"}),i.length?(i.find(".ui-zmenu-text").text(J.i18n("common","LOCK")),J("#sharetabmenu").zmenu("changeIcon","menuitem_share_btn_lock","zicon zicon-lock")):(t.metadata().label=J.i18n("common","LOCK"),t.metadata().icons={primary:"zicon zicon-lock"}))},UIUtils.enterKey=function(e,t){e.unbind("keydown"),e.bind("keydown",function(e){13===e.keyCode&&t&&t()})},UIUtils.isDialogOpened=function(e){return J.dialogutil.isDialogOpened(e)},UIUtils.handleUnfreezeEditor=function(e){try{"hdrfooter"==e?(Z("microtool-img").enable(),Z("microtool-tbl").enable(),Z("microtool-code").enable(),Z("inlineinsert-img").enable(),Z("inlineinsert-tbl").enable(),Z("smart_cell_merge").enable(),Z("smart-table_cellalignment").enable(),UIUtils.jToolbarComp.find("#ins-lpnl-img,#ins-lpnl-table,#ins-lpnl-shapes,#ins-lpnl-txtbox,#ins-lpnl-splchars,#ins-lpnl-equation,#ins-lpnl-object,#ins-lpnl-embed,#ins-lpnl-codeblock,#ins-lpnl-chart-button").enable(),UIUtils.jToolbarComp.find("#comments,#ins-lpnl-break-menu,#rt_btn_add_comment,#ins-lpnl-bookmark,#ins-lpnl-toc,#ins-lpnl-endnote,#ins-lpnl-footnote,#mailmerge-btn-insmergefld,#mailmerge-btn-insmergefldDropDown,#mailmerge-btn-finishmerge,#ins-lpnl-cmnt,#ins-lpnl-blnkpage,#smart-addcomment,#ins-fillable-fields,#ins-esign-fields,#ins-digisign-fields").disable(),Z("microtool-bookmark").disable(),Z("microtool-cmt").disable(),Z("inlineinsert-bookmark").disable(),Z("inlineinsert-cmt").disable(),Z("review-tb-showcomment").disable(),J("#mailmergemenu").zmenu("disableMenuItems",["mailmerge-btn-insmergefld","mailmerge-btn-finishmerge"]),J("#ins-lpnl-break").zmenu("disableMenuItems",["ins-lpnl-page-break","ins-lpnl-col-break"])):"contentpane"==e?(EditorView.isWebView()||UIUtils.jToolbarComp.find("#ins-lpnl-toc").enable(),UIUtils.jToolbarComp.find("#ins-lpnl-img,#ins-lpnl-table,#ins-lpnl-shapes,#ins-lpnl-txtbox,#ins-lpnl-splchars,#ins-lpnl-equation,#ins-lpnl-object,#comments,#ins-lpnl-break-menu,#rt_btn_add_comment,#ins-lpnl-bookmark,#ins-lpnl-toc,#ins-lpnl-endnote,#ins-lpnl-footnote,#readonly_add_comment,#mailmerge-btn-insmergefld,#mailmerge-btn-insmergefldDropDown,#mailmerge-btn-finishmerge,#ins-lpnl-cmnt,#ins-lpnl-blnkpage,#smart-addcomment,#ins-lpnl-embed,#ins-lpnl-codeblock,#ins-fillable-fields,#ins-esign-fields,#ins-digisign-fields,#ins-lpnl-chart-button").enable(),Z("microtool-bookmark").enable(),Z("microtool-cmt").enable(),Z("microtool-img").enable(),Z("microtool-tbl").enable(),Z("microtool-code").enable(),Z("inlineinsert-img").enable(),Z("inlineinsert-tbl").enable(),Z("inlineinsert-bookmark").enable(),Z("inlineinsert-cmt").enable(),Z("review-tb-showcomment").enable(),Z("smart_cell_merge").enable(),Z("smart-table_cellalignment").enable(),J("#mailmergemenu").zmenu("enableMenuItems",["mailmerge-btn-insmergefld","mailmerge-btn-finishmerge"]),J("#ins-lpnl-break").zmenu("enableMenuItems",["ins-lpnl-page-break","ins-lpnl-col-break"])):"notesectionpane"==e&&(UIUtils.jToolbarComp.find("#ins-lpnl-img,#ins-lpnl-table,#ins-lpnl-shapes,#ins-lpnl-txtbox,#ins-lpnl-splchars,#ins-lpnl-equation,#ins-lpnl-object,#comments,#ins-lpnl-break-menu,#rt_btn_add_comment,#ins-lpnl-bookmark,#ins-lpnl-toc,#ins-lpnl-endnote,#ins-lpnl-footnote,#readonly_add_comment,#mailmerge-btn-insmergefld,#mailmerge-btn-insmergefldDropDown,#mailmerge-btn-finishmerge,#ins-lpnl-cmnt,#ins-lpnl-blnkpage,#smart-addcomment,#ins-lpnl-embed,#ins-lpnl-codeblock,#ins-fillable-fields,#ins-esign-fields,#ins-digisign-fields,#ins-lpnl-chart-button").disable(),Z("microtool-bookmark").disable(),Z("microtool-cmt").disable(),Z("microtool-img").disable(),Z("microtool-tbl").disable(),Z("microtool-code").disable(),Z("inlineinsert-img").disable(),Z("inlineinsert-tbl").disable(),Z("inlineinsert-bookmark").disable(),Z("inlineinsert-cmt").disable(),Z("review-tb-showcomment").disable(),Z("smart_cell_merge").disable(),Z("smart-table_cellalignment").disable(),J("#mailmergemenu").zmenu("disableMenuItems",["mailmerge-btn-insmergefld","mailmerge-btn-finishmerge"]),J("#ins-lpnl-break").zmenu("disableMenuItems",["ins-lpnl-page-break","ins-lpnl-col-break"])),editor.isOffline()&&ZWOffline.isOfflineOperationsAllowed()&&OfflineImpl.disableOnlineFeatures()}catch(e){}},UIUtils.preProcessForDialogClose=function(){"undefined"==typeof EventHandler||EventHandler.isSubDlgOpened||(UIUtils.enableDocumentShortcuts(),J.dialogutil.isDialogOpened("insertshape")&&ShapeEditor.clear(),J.dialogutil.isDialogOpened("custdicdialog")&&(CustomDictionary.personaldictionarywindowstatus=!1),EventHandler.isDialogOpened=!1,"undefined"!=typeof ConditionsDlg&&ConditionsDlg.closePopup(),editor.getRole().permissions.can("document.edit")&&(editor.jMbSpan_editableSpan.attr("contenteditable","true"),editor.jMultiByteSpan.css({top:editor.editorPaneContainer.scrollTop()/editor.zoomFactor}),EditorUtil.focusMultiByteSpan(),CurUtil.blinkCursor()),editor.mustScroll=!0,document.body.scrollTop=0),"undefined"!=typeof EventHandler&&(EventHandler.isSubDlgOpened=!1)},UIUtils.preProcessForDialogOpen=function(){UIUtils.disableDocumentShortcuts(),editor.isShiftDown=!1,"undefined"!=typeof EventHandler&&EventHandler.isDialogOpened&&(EventHandler.mouseDown=!1,EventHandler.isSubDlgOpened=!0),jQuery.isEmptyObject(editor.doc.paintFormat)||(DomUtil.clearFormatPainterData(),UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","uncheck"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","uncheck")),UIUtils.hideControllers(),"undefined"!=typeof EventHandler&&(EventHandler.mouseDown=!1,EventHandler.isDialogOpened=!0),CurUtil.stopBlinking(editor.getRole().permissions.can("document.edit"))},UIUtils.bindDialogEvents=function(){Jdocument.bind("zdialogbeforeclose",function(e){PubSub.publish("Dialog/BeforeClose",e),"documentmapzdialog"==e.target[0].id?(DocumentMap.closePane(),J(".ui-widget-overlay").show()):UIUtils.preProcessForDialogClose(),UIUtils.isDialogOpened("findandreplace")&&setTimeout(function(){ReplaceDialog.handleClose()},100)}).bind("zdialogopen",function(e){"documentmapzdialog"!=e.target[0].id&&UIUtils.preProcessForDialogOpen(),e.target&&"collabdialog"===e.target[0].id&&editor.getRole().permissions.can("document.edit")&&(editor.jMbSpan_editableSpan.attr("contenteditable","true"),UIUtils.enableDocumentShortcuts())}),Jdocument.on("zdialogminimize",function(){UIUtils.preProcessForDialogClose()}),Jdocument.on("zdialogmaximize",function(){UIUtils.preProcessForDialogOpen()}),J("#collabdialog").on("collaboratorclose",function(e){EventHandler.isDialogOpened=!1}),J("#toolbarContainer").on("toolbarshow",function(e){editor.onResize()}).on("toolbarhide",function(e){editor.onResize()})},UIUtils.handleDocumentLoadingComplete=function(){UIUtils.hideLoadingMsg();var e=editor.doc.docInfo;e.UpgradeToWriter3&&(editor.rebindEvents(ERROR_PERMISSION),DomUtil.removeCursorNode(editor.uuid),UIUtils.disableDocumentShortcuts(),UIUtils.postProcessingForUpgrade()),e.newDoc||PubSub.publish("Document/SaveStatus",!0,void 0,editor.doc.docInfo.LASTMODIFIEDBY_ZUID,e.LAST_MODIFIED_TIME_LONG),editor.getRole().permissions.can("document.edit")&&UIUtils.updateViewStatus(),Macros.updateSaveButton(),DomUtil.scrollToEditorTop()},UIUtils.handleListMenu=function(){var e=J("#listmenu"),t=["#standard_unorder_list_option","#svg_unorder_list_option","#order_list_option","#heading_list_option","#symbol_image_list_option"],i=[],n=[],o=arguments[1].forElement.attr("id"),r=5,a=!0;"fmt-lpnl-list-bulletContainer"==o||"fmt-lpnl-sub-list-bulletContainer"==o||"rclk-listselectionmenu-unorder"==o||"pcm-list-bulletContainer"==o?(a=!1,i.push("#standard_unorder_list_option","#svg_unorder_list_option","#symbol_image_list_option"),n=U.without(t,"#standard_unorder_list_option","#svg_unorder_list_option","#symbol_image_list_option")):"fmt-lpnl-list-numberContainer"==o||"fmt-lpnl-sub-list-numberContainer"==o||"pcm-list-numberContainer"==o?(r=3,i.push("#order_list_option","#heading_list_option"),n=U.without(t,"#order_list_option","#heading_list_option"),n.push("#headinglistseperator")):"smart-fmt-lpnl-list-bullet"==o?(a=!1,i=U.without(t,"#heading_list_option"),n.push("#heading_list_option")):"rclk-headingList"==o?(a=!1,r=3,i.push("#heading_list_option"),n=U.without(t,"#heading_list_option")):"rclk-listselectionmenu-order"==o&&(r=3,i.push("#order_list_option"),n=U.without(t,"#order_list_option"),n.push("#orderlistseperator")),e.zmenu("option","columns",r),e.zmenu("refresh"),e.zmenu("setMenuItemsAttribute",i,"hidden",!1),n.length&&e.zmenu("setMenuItemsAttribute",n,"hidden",!0),e.find(".zmenu__title").hide(),a?J("#order_list_none").show():J("#order_list_none").hide()},UIUtils.showFreezeMessage=function(e,t,i){e?(UIUtils.freezeState&&UIUtils.UnfreezeEditor(),UIUtils.preProcessForDialogOpen(),UIUtils.FreezeEditor(t,i)):UIUtils.UnfreezeEditor()},UIUtils.isPasteToolbarOn=function(){return!PasteUtil.pasteToolbar.is(":hidden")},UIUtils.showPasteToolbar=function(){try{ZWComponentUtil.init("pasteToolbar");var e=editor.doc.getDomCursorNode(),t=LeftPanel.isContainerVisible(ELEM_ID.MAINPANELCONTAINER)&&!LayoutManager.isRichEditActive()?J("#"+ELEM_ID.MAINPANELCONTAINER).width():0;J(PasteUtil.pasteToolbar).css({width:"50px",top:CurUtil.offset.start.top*editor.zoomFactor+e[0].offsetHeight*editor.zoomFactor-5,left:CurUtil.offset.start.left+LeftPanel.getPanelWidth()-t-editor.jeditorPane.offset().left-e[0].offsetWidth+5-Z("ui-editor-outer-div").scrollLeft()}),PasteUtil.pasteToolbar.show()}catch(e){}},UIUtils.hideControllers=function(e){"undefined"==typeof LinkDialog||!LinkDialog.isDialogOpened()||e&&(J(e.target).has("#ins-lpnl-link")||J(e.target).parent().has("#ins-lpnl-link"))||LinkDialog.closeLinkPopup(),"undefined"!=typeof PasteEventHandler&&UIUtils.isPasteToolbarOn()&&UIUtils.hidePasteToolbar()},UIUtils.hidePasteToolbar=function(){J(PasteUtil.pasteToolbar).hide()},UIUtils.gotoPage=function(e,t){if(e){e=parseInt(e);var i,n=DocLayoutManager.getPageRange(e);i=t?n.end||-1:n.start||-1,DomViewManager.forceToRender(DocLayoutManager.getPageAtPageNumber(e)),i!=-1&&UIUtils.moveToPage(e,i)}J.dialogutil.close("gotopage")},UIUtils.moveToPage=function(e,t){var i=editor.doc.createRange(t),n=editor.doc.getSelection();n.removeAllRanges().addRange(i),e>DocLayoutManager.getPageCount()&&(e=DocLayoutManager.getPageCount()),editor.currentPageIndex=e-1,editor.clientActiveSection&&!J(editor.clientActiveSection).hasClass("zw-contentpane")&&EventHandler.toggleSection(),DomUtil.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0],500,!0)},UIUtils.getErrorMsg=function(e,t){var i="<div class='ui-status-wrapper'><div class='ui-state-"+e+" ui-corner-all ui-znotifier'><span class='ui-znotifier-message'><span  class='ui-components-icon ui-state-"+e+"-icon' ></span>"+t+"</span></div></div>";return i},UIUtils._itemClicked=function(e,t){var i=t.menuitem,n=J(i).metadata().appData;if(n){i&&i[0].hasAttribute("data-zw-action")&&PubSub.publish("UIFrameWork/MenuItemClick",{ev:t,ui:t,menuitem:i});var o=n.action,r=n.params,a=Utils.getAsFunction(o);a.callable(r)}},UIUtils.showMsgStatusbar=function(e){J("#statusInfo").text(e).fadeIn("fast").show(),setTimeout(function(){J("#statusInfo").fadeOut("slow").text("")},3e3)},UIUtils.showDocStatusIcon=function(){var e=editor.doc.docInfo,t=Z("topband-docstatus"),i=t.find("#checkout-status");if(e.CHECKEDOUT){var n=editor.zuid==e.CHECKEDOUTBY_ZUID?J.i18n("common","DOCUMENT_LOCKED_BY_YOU"):J.i18n("common","DOCUMENT_LOCKED_BY",[e.CHECKEDOUTBY_NAME]);i.show(),i.attr("title",n)}else i.hide();editor.zuid&&e.PUBLISH_SCOPE&&UIUtils.updateDocPublishStatus()},UIUtils.updateDocPublishStatus=function(){var e=editor.doc.docInfo,t=DomUtil.getPublishURL(editorProps.isFillableForm||!1),i=J("#complete-tb-publish"),n=J("#popup-filemenu");e.PUBLISH_SCOPE==PUBLISH_TYPE.INTERNAL||e.PUBLISH_SCOPE==PUBLISH_TYPE.EXTERNAL?(n.zmenu("setMenuItemsAttribute",["#filemenu-publish"],"label",J.i18n("writer.common.PUBLISH_SETTINGS")),i.zbutton("setAttribute","text",J.i18n("writer.common.PUBLISH_SETTINGS")),e.PUBLISH_SCOPE==PUBLISH_TYPE.INTERNAL?J("#corporate_docstatus").attr("href",t):e.PUBLISH_SCOPE==PUBLISH_TYPE.EXTERNAL&&J("#externallink_docstatus").attr("href",t)):(n.zmenu("setMenuItemsAttribute",["#filemenu-publish"],"label",J.i18n("writer.common.PUBLISH")),i.zbutton("setAttribute","text",J.i18n("writer.common.PUBLISH")))},UIUtils.revertDocToWriter2=function(){var e={};e.rid=editor.doc.docInfo.RID,J.ajax({type:"POST",url:ZWNetworkUtils.getContextUrl("revertDocToWriter2.do"),data:e,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){},error:function(e){}})},UIUtils.enableDocumentShortcuts=function(){ZShortCut.enable()},UIUtils.disableDocumentShortcuts=function(){ZShortCut.disable()},UIUtils.showImageFailedMsg=function(){ZAlertBanner.show({hideDelay:5e3,message:J.i18n("common","IMAGE_PROCESSING_FAILED"),type:"info",icon:!0,closeButton:"true",target:"#notifyMessage",position:"top",align:"center"})},UIUtils.showBackgroundRemoveFailedMsg=function(){ZAlertBanner.show({hideDelay:5e3,message:J.i18n("common","IMAGE_BG_REMOVE_FAILED"),type:"error",closeButton:"true",target:"#notifyMessage",position:"top",align:"center"})},UIUtils.showListFailedMsg=function(){ZAlertBanner.show({hideDelay:5e3,message:J.i18n("common","LIST_IMG_PROCESSING_FAILED"),type:"info",icon:!0,closeButton:"true",target:"#notifyMessage",position:"top",align:"center"})},UIUtils.closeLastModifiedCollabUsersList=function(){J("#modifiedusercontainer").hide()},UIUtils.applyWebView=function(){editor.jeditorPane.css("padding-left",0),J("#pg_size,#pg_orientation").prop("disable",!0)},UIUtils.clearView=function(e,t){if("Web View"===e){if(editor.getView()==EDITOR_VIEWS.HISTORY||editor.getView()==EDITOR_VIEWS.MAILMERGE_PREVIEW||editor.getView()==EDITOR_VIEWS.VERSIONVIEW)return;J("#pg_size,#pg_orientation").prop("enable",!0),editor.editorPaneContainer.css({border:"",margin:""}).parent().css("margin-right","")}},UIUtils.showZohoWriterWebAppInstalDlg=function(){J.dialogutil.open("clipboarddialog",void 0,"")},UIUtils.installWebapp=function(){var e=UIUtils.getExtensionUrl();null!=e&&Utils.safeWindowOpen(e),J.dialogutil.close("clipboarddialog")},UIUtils.getExtensionUrl=function(){var e=editor.browserInfo,t=null;return e.is_chrome?t=UIUtils.chromeExtensionURL:e.is_firefox?t=UIUtils.firefoxExtensionURL:e.is_safari?t=UIUtils.safariExtensionURL:e.is_edge&&(t=UIUtils.edgeExtensionURL),t},UIUtils.extensionSupportedBrowser=function(){var e=editor.browserInfo;return!!(e.is_chrome&&!e.is_macApp||e.is_firefox)},UIUtils.updateNonPrintingButtonLabel=function(e){"string"==typeof e&&(e="true"===e);var t=e?"check":"uncheck";UIUtils.toggleButtonStatus("hiddenmarker","fmt-lpnl-non-printing-char",t)},UIUtils.setEditorPaneWrapperHeight=function(e){if(1!=editor.zoomFactor||e){var t=J("#transform_event_div"),i=DomViewManager.getEntireGridHeight()*editor.zoomFactor;editor.jeditorPaneWrapper.css("height",i),t.css("height",i)}},PubSub.subscribe([DOMVIEW.PAGE_REMOVED,DOMVIEW.PAGE_CREATED],UIUtils.setEditorPaneWrapperHeight,{async:!0,timeout:500}),UIUtils.openAutoFormat=function(){Settings.showSettingsDlg();var e=J("#settingszdialog")[0]?0:500;setTimeout(function(){J("#settingszdialog #menutabs").ztabpanel("openTab",J("#settingszdialog, #tab3_autoformat").index()-1)},e)},UIUtils.setHeadingDropdownStyle=function(e,t){var i=DocumentDesign.getStyles().para,n=DocumentDesign.getComputedStyles().para,o="";StyleUI.updateHeadingStylesMenu();for(var r in i){var a=r.substring(1);if("minor"!=r&&"major"!=r){var s=J(".contentHeading"+a);if(PubSub.publish("HeadingStyle/Update",a),o+="#contentHeading"+a+" .zmenu__text { \n",o+=StyleUI.getHeadingStyleText(r)+"\n}\n",s.css("background-color",""),n[r].textFormat&&"rgb(255,255,255)"===n[r].textFormat.fgc){var l=n[r].bgc,d=n[r].textFormat.bgc;"undefined"!=typeof l&&"transparent"!=l&&"rgb(255,255,255)"!=l&&"undefined"!=typeof d&&"transparent"!=d&&"rgb(255,255,255)"!=d||s.css("background-color","#d9d9d9")}}}var c=document.getElementById("styleforheadingmenu");c||(c=document.createElement("style"),c.setAttribute("id","styleforheadingmenu"),document.getElementsByTagName("head")[0].appendChild(c)),c.styleSheet&&c.styleSheet.cssText?c.styleSheet.cssText=o:J(c).text(o)},UIUtils.updateBottomBar=function(){J("#wmstoolbar");"true"===w_usersettings.showchatbar?J("body").addClass("ui-show-wms"):"false"===w_usersettings.showchatbar&&J("body").removeClass("ui-show-wms"),editor.onResize()},UIUtils.handleChatBarView=function(e){if(editor.doc.getRole()!=USER_ROLE.PUBLIC){var t=J("#wmstoolbar"),i=J("#bbar-chat");if(void 0!=e){var n={};n.showchatbar=e,Settings.updateUserSettings(n)}"true"===w_usersettings.showchatbar?(t.show(),i.attr("title",J.i18n("writer.common.HIDE_CHAT"))):"false"===w_usersettings.showchatbar&&(t.hide(),i.attr("title",J.i18n("writer.common.SHOW_CHAT"))),editor.onResize()}},UIUtils.changeChatBarView=function(){var e={},t=J("#wmstoolbar").is(":visible")?"false":"true";e.showchatbar=t,Settings.updateUserSettings(e),e=Macros.getUUID(e),UIUtils.handleChatBarView(t),UIUtils.updateBottomBar()},UIUtils.setZoomFactor=function(e){J.isArray(e)&&(e=e[0],"fitPage"!=e&&"fitWidth"!=e&&(editor.customZoom="")),ZWLogger.addToStatistics("Zoom");J("#editorpane-wrapper");if("fitPage"!=e&&"fitWidth"!=e||(editor.customZoom=e,e=UIUtils.getCustomZoomFactor())){var t=parseInt(e),i=Z("bbar-zoom"),n=Z("view-lpnl-zoom"),o=["25%","50%","75%","100%","125%","150%","175%","200%"];if(t>200||t<=0||isNaN(t))return i.zcombobox("setValue",parseInt(100*editor.zoomFactor)+"%"),void n.zlabeledcombobox("setValue",parseInt(100*editor.zoomFactor)+"%");o.indexOf(t+"%")==-1&&(i.zcombobox("removeOption","#bbar-zoom-custom"),n.zlabeledcombobox("removeOption","#view-zoom-custom"),i.zcombobox("addOptionAt",J('<option value="'+parseInt(e)+'%" id="bbar-zoom-custom">'+parseInt(e)+"%</option>"),8),n.zlabeledcombobox("addOptionAt",J('<option value="'+parseInt(e)+'%" id="view-zoom-custom">'+parseInt(e)+"%</option>"),11));var r=editor.editorPaneContainer.scrollTop()/editor.zoomFactor;editor.zoomFactor=parseFloat(e)/100,i.zcombobox("setValue",parseInt(e)+"%"),n.zlabeledcombobox("setValue",parseInt(e)+"%");var a=Z(ELEM_ID.EDITORPANE)[0];e=parseFloat(e)/100,a.style.webkitTransform="scale("+e+")",a.style.MozTransform="scale("+e+")";var s="-ms-transform";a.style[s]="scale("+e+")",DocumentView.handleDimensionsUpdate(),EditorLayout.updateMainOuterDivProps(),UIUtils.setEditorPaneWrapperHeight(!0),editor.editorPaneContainer.scrollTop(r*editor.zoomFactor),PubSub.publish("Document/Zoom"),ZWLogger.addToStatistics("4.0_ZoomFactor")}},UIUtils.hideWrappers=function(e){e?(Z("microandparaVCContainer").hide(),J("#tablePropWrapper").hide()):UserPreferences.isPrefered("para_microtoolbar")&&Z("microandparaVCContainer").show()},UIUtils.toggleCollabActionButtons=function(){var e=editor.doc.getTrackChangeDetails().getDisplayMode();if(!(e===TCConstants.ORIGINAL_VIEW||editor.doc.docInfo.CHECKEDOUT&&editor.doc.docInfo.CHECKEDOUTBY_ZUID!=editor.zuid)){PubSub.publish("Collaboration/ToggleActionButtons");var t=J("#review-tb-collabaction"),i=t.find("#pausecollab");"true"==editor.doc.docInfo.ISSHARED&&editor.getRole().permissions.can("document.edit")?(editor.doc.docInfo.CHECKEDOUT||i.ztoggleswitch("switchOn"),t.attr("title","")):"false"==editor.doc.docInfo.ISSHARED&&t.attr("title",J.i18n("writer.common.PAUSE_COLLAB_TOOLTIP"))}},UIUtils.showBanner=function(e,t){var i=J("#banner-temp-offline-cont");i.find("#banner-temp-offline-txt").text(e),i.css("left","0px"),i.show().slideDown("slow")},UIUtils.showLinkCopiedBanner=function(){Notification.show({message:"writer.common.LINK_COPIED_TO_CLIPBOARD",close:!1,type:"warning",timeOut:"3000"})},UIUtils.showLinkCopyFailedBanner=function(){Notification.show({message:"writer.common.LINK_COPY_FAILED_MSG",close:!1,type:"warning",timeOut:"3000"})},UIUtils.showOfflineBanner=function(){var e=J("#banner-offline-cont");e.removeClass("ui-notification-info").addClass("ui-notification-blk"),J("#banner-temp-offline-cont").find("#offline-icon").show(),UIUtils.showBanner(J.i18n("writer.common.OFFLINE_MODE"),null)},UIUtils.showOfflineReadOnlyBanner=function(){var e=J("#banner-offline-cont");e.removeClass("ui-notification-blk").addClass("ui-notification-info");var t=J("#banner-temp-offline-cont"),i=J("#banner-temp-offline-txt");if(t.find("#offline-icon").hide(),0===J("#readOnlyModeMsg").length){var n="<span class='ui-znotifier-message'><span class='ui-components-icon ui-state-info-icon'></span><span id='readOnlyModeMsg'>"+J.i18n("writer.common.OFFLINE_SAMEDOCOPENED_INANOTHERTAB")+"</span></span>";t.show(),i.html(""),i.attr("style","border:1px;color:rgb(0,0,0)"),i.append(n)}},UIUtils.hideBanner=function(){J("#banner-temp-offline-cont").hide()},UIUtils.getOpenType=function(){var e="_blank",t=editor.doc.docInfo;return(!t||1==t.VERSION&&0==t.REVISION&&t.newDoc)&&(e="_self"),e},UIUtils.hideRightClickMenu=function(){var e=J.ZContextMenu.currentMenu;e&&e.is("#Rmenu")&&(J.ZContextMenu.hideMenu()._isMenuShowing=!1)},UIUtils.handleChkListMenu=function(){var e,t=editor.doc.getSelection(),i=t.getParaFormat(),n=function(t){e=t},o=J("#checklistmenu");CheckListOperations.getCheckListState({format:i,callback:n});var r,a;e==CHECKLIST_STATES.CHECKED?(r="menu-chlist-mark-unchecked",a="menu-chlist-mark-checked"):e==CHECKLIST_STATES.UNCHECKED&&(r="menu-chlist-mark-checked",a="menu-chlist-mark-unchecked"),o.zmenu("showMenuItem",r),o.zmenu("hideMenuItem",a)},UIUtils.beforeProcessRightClickMenu=function(e,t){window.getSelection().removeAllRanges(),EventHandler.mouseDown=!1,EventHandler.mouseUpDone=!0;var i=editor.doc.getSelection(),n=i.getParents(NODE_TYPE.PARAGRAPH),o=n.attr("*"),r=o.hd?o.hd:"0",a=J("#Rmenu"),s=t.originalEvent.target,l=StyleUI.getDocumentParaMapping();if(a.zmenu("changeLabel","heading_styl_update",J.i18n("writer.styles.UPDATEHD",[l[r]])),J("#heading_styl_update").attr("data","{appData:{action:'QuickStyle.onBeforeUpdateHeadingStyle',params:['"+r+"']}}"),J("#heading_styl_update").removeData("metadata"),CURSOR_CONTEXT_DEFINITIONS.isProofingAvailable()){var d=ProofingManager.getCollection().getWordDetailsAtIdx(i.getStart()),c=Thesaurus.getSynonyms(d.text);c.done(function(e,t){t==d.text&&"block"==Z("synonymsSubMenuCbmart").css("display")&&UIUtils.addSynonymsMenu(e)}),c.fail(function(e){e==d.text&&"block"==Z("synonymsSubMenuCbmart").css("display")&&UIUtils.addSynonymsMenu(new Array)})}if(CURSOR_CONTEXT_DEFINITIONS.isDocumentFieldSelected()){var u=i.getStart(),p=editor.doc.getRawFormatAt(u);p&&p[ATTR_AUTOFIELD.ISAUTO]?J("#Rmenu").zmenu("setMenuItemsAttribute",J("#btn-autofield-auto"),"checked",!0):J("#Rmenu").zmenu("setMenuItemsAttribute",J("#btn-autofield-keepvalue"),"checked",!0)}if(!i.isCollapsed()&&!J(s).hasClass("overlay")){var g=EventHandler.getIndex(e.originalEvent),f=editor.doc.createRange(g);ZWLogger.log("@beforeProcessRightClickMenu getIndex: "+g+"\nMouse logs: "+Utils.getMouseLogs()),i.removeAllRanges().setSelectionType(SEL_CONTEXT).addRange(f)}},UIUtils.updateDocumentMenu=function(e,t){!jQuery.isEmptyObject(editor.doc.paintFormat)&&editor.getRole().permissions.can("document.edit")&&(DomUtil.clearFormatPainterData(),UIUtils.toggleButtonStatus("fmt-lpnl-grp-paint","fmt-lpnl-painter","uncheck"),UIUtils.toggleButtonStatus("format-painter-set","smart_formatpainter","uncheck"));var i=Z("documentmenu");EventHandler.mouseUpDone=!0;var n=e.originalEvent.target,o=J(n);if(editor.jeditorPane.find("div.markingDiv").remove(),"bMark"==o.attr("class")){i.zmenu("removeMenuItems");var r=BookmarkDialog.constructMenu(n);return i.zmenu("addMenuItems",r),UIStateHandler.reInit(i[0]),!0}if("imgMark"==o.attr("class")){var a=o[0],s=DocLayoutManager.getLineAtIndex(DomViewManager.getStartIndex(a.parentElement),editor.getPageID()),l=DocLayoutManager.getFirstImageIndexAtLineInIndex(s.absStart);if(l!==-1){var d={operation:"imagePreview",idx:l};PubSub.publish("Image/HandleImageCarousel",d)}}else{var c=J(editor.doc.getCursorPortionNode(editor.uuid,"start")).is(".link"),u=o.parents("div.zw-contentpane,div.header_primary,div.footer_primary")[0]&&"SPAN"==n.nodeName;if(c&&u){var p=editor.doc.getParents(NODE_TYPE.LINK,editor.doc.getSelection().getStart()-1);if(p&&o.parents("#toc")[0]){var g=p.attr(ATTR_LINK.LINK_URL),f=editor.doc.getElement(NODE_TYPE.BOOKMARK,g);if(f.length>0&&!(editor.browserInfo.is_mac&&e.metaKey||editor.browserInfo.is_windows&&e.ctrlKey)){i.zmenu("removeMenuItems");var E=LinkDialog.getMenuObj(p);return i.zmenu("addMenuItems",E),i.hide(),!0}}}}return!1},UIUtils.initComponent=function(e){if(e)e&&ZWComponentUtil.init(e,function(){var t=editor.doc.docInfo.newDoc;e==ELEM_ID.HEADEROPTIONSPANEL&&t?J("#ins-version").disable():"menuView"==e&&editor.browserInfo.is_chrome&&J("#view-lpnl-printpreview").remove()});else{var t=[],i=[],n=[],o=[],r=[],a=[],s=["pastemenu","popup-filemenu","advancedTblPropSubMnu","changePublishTypeMenu","filemenu-shareinvite-menu","inserttblpopup","settingsmenu","printmenu","fmt-lpnl-headingmenulist","checkboxmenu","insertimage","ins-lpnl-break"],l=document.getElementById("bottombar"),d=document.getElementById("topband"),c=document.getElementById("toolbar-container"),u=document.getElementById("panel-container"),p=document.getElementById("branding"),g=document.getElementById("branding-publishfill"),f=[];l&&(i=l.querySelectorAll("[ctype]")),d?n=d.querySelectorAll("[ctype]"):p?n=p.querySelectorAll("[ctype]"):g&&(n=g.querySelectorAll("[ctype]")),c&&(o=c.querySelectorAll("[ctype]")),u&&(r=u.querySelectorAll("[ctype]")),a=document.body.querySelectorAll("[ctype]");for(var E,T=0,m=n.length;T<m;T++)E=n[T],ZWComponentUtil.addComponentToList(E.id),t.push(E);for(T=0,m=i.length;T<m;T++)E=i[T],ZWComponentUtil.addComponentToList(E.id),t.push(E);for(T=0,m=o.length;T<m;T++)E=o[T],ZWComponentUtil.addComponentToList(E.id),t.push(E);for(T=0,m=r.length;T<m;T++)E=r[T],ZWComponentUtil.addComponentToList(E.id),t.push(E);for(T=0,m=s.length;T<m;T++){var h=s[T],I=document.getElementById(h);I&&(ZWComponentUtil.addComponentToList(h),t.push(I),f.push(I))}var _={};_.nodeArray=t,_.chunkSize=5,_.delay=10,ZComponents.init(J("body"),function(){if(J("#Rmenu")[0]&&ZWComponentUtil.init("Rmenu"),"undefined"!=typeof UIStateHandler){l&&UIStateHandler.build(l),d&&UIStateHandler.build(d),c&&UIStateHandler.build(c),u&&UIStateHandler.build(u);for(var e=0,t=f.length;e<t;e++)UIStateHandler.build(f[e]);PubSub.publish("Document/ComponentInitialized")}},"ctype",_),editor.zuid!=-1||editor.options.is_kb_enable||Z("bbar-feedback").hide(),UIUtils.documentStateHanlder(),PubSub.publish("Document/ComponentReady"),PubSub.unsubscribe("Document/LoadingStart",UIUtils.initComponent)}UIUtils.initFileComponent()},UIUtils.positionDocumentMenu=function(e,t){var i=J(t.originalEvent.target),n=i.offset(),o=n.top+i.outerHeight();o+this.offsetHeight>editor.editorPaneContainerHt+editor.editorPaneContainerOffset.top&&(o-=this.offsetHeight),J(t.menu).css({left:e.originalEvent.clientX,top:o}),"bMark"!=i.attr("class")&&setTimeout(function(){EditorUtil.focusMultiByteSpan()},500)},UIUtils.documentStateHanlder=function(){"trashed"==editor.doc.docInfo.state&&PubSub.publish("Document/Trashed",editor.zuid)},UIUtils.changeTextBackgroundColor=function(e,t){editor.doc.execCmd("BackColor",Utils.getColorReference(t))},UIUtils.changeForegroundColor=function(e,t){editor.doc.execCmd("ForeColor",Utils.getColorReference(t))},UIUtils.updateParaBorderColor=function(e,t){t.color="default"==t.color?"rgb(0,0,0)":Utils.getColorReference(t),ParaBorders.updateColor(t.color),EventHandler.isMenuOpened=!1,CurUtil.blinkCursor()},UIUtils.changeParaBackgroundColor=function(e,t){editor.doc.execCmd("ParaBackColor",Utils.getColorReference(t))},UIUtils.getVisibleAreaTop=function(){var e=editor.editorPaneContainer.scrollTop(),t=editor.editorPaneContainer.height();viewportOffset={top:e,bottom:e+t};var i;return CurUtil.offset.start.top<viewportOffset.top&&CurUtil.offset.end.top>viewportOffset.bottom?i=e+t/2:CurUtil.offset.start.top<viewportOffset.top&&CurUtil.offset.end.top<viewportOffset.bottom?i=CurUtil.offset.end.top*editor.zoomFactor:(CurUtil.offset.start.top>=viewportOffset.top||CurUtil.offset.end.top<viewportOffset.bottom)&&(i=CurUtil.offset.start.top*editor.zoomFactor),i},UIUtils.toggleElemState=function(e,t){if("enable"==t)for(var i=0,n=e.length;i<n;i++){var o=Z(e[i]).attr("data_onclick");Z(e[i]).attr("onclick",o),Z(e[i]).enable(),Z(e[i]).removeAttr("data_onclick")}else if("disable"==t)for(var i=0,n=e.length;i<n;i++){var o=Z(e[i]).attr("onclick");Z(e[i]).attr("data_onclick",o),Z(e[i]).disable(),Z(e[i]).removeAttr("onclick")}},UIUtils.afterOnboardHelp=function(){PopupHandler.openPopup("paraPropMenu"),LeftPanel.toggleLeftPanel()},UIUtils.enableMenuTabs=function(e){J(e).removeClass("ui-zwdisabled")},UIUtils.disableMenuTabs=function(e){J(e).addClass("ui-zwdisabled")},PubSub.subscribe("ZWSelection/ListItemSelected",function(){var e=["fmt-lpnl-cut","fmt-lpnl-copy","fmt-lpnl-paste","fmt-lpnl-pasteDropDown","fmt-lpnl-quickbtn","review-tb-showcomment","microtoolbarbtndiv"],t="menu-insert-parent",i="menu-field-parent";U.each(U.union(e,[t,i]),function(e){Z(e).addClass("ui-zwdisabled")}),PubSub.subscribeOnce(["Cursor/Collapsed","Cursor/Selected"],function(){U.each(e,function(e){Z(e).removeClass("ui-zwdisabled")});var n=editor.doc.getSelection();n.isListItemSelection||InsertShape.getSelectedShape()||(Z(t).removeClass("ui-zwdisabled"),Z(i).removeClass("ui-zwdisabled"))})}),UIUtils.toggleRedactBtns=function(){if(editor.getRole().permissions.can("document.content.lock")){var e=editor.doc.getSelection();if(e&&!e.isCollapsed())return;if(editor.jeditorPane.find("div.lock-overlay").css({border:""}),Lock.getLockRanges(e.getStart()).length>0){var t=DomViewManager.getDomFromCurrentPage(DocLayoutManager.getCurrentLine());J(t).find("div.lock-overlay").css({border:"1px solid #808080",opacity:".5"})}}},UIUtils.showRedactWarningMsg=function(e){var t=editor.doc.getLocks();!t.isEmpty()&&t.isLock?MsgDialog.showMessage([J.i18n("writer.common.PROCEED"),J.i18n("writer.common.CANCEL")],CONST.SEVERITY_WARNING,J.i18n("writer.common.WARNING"),J.i18n("writer.common.REDACT_WARNING_TEXT"),null,function(t){switch(t){case CONST.BUTTON_1_CLICKED:e&&e()}}):e&&e()},UIUtils.addGridlinesStyle=function(){var e=document.getElementById("zw-page-gridlines");if(!e&&J("#view-lpnl-gridlines").ztoggleswitch("getState")){e=document.createElement(NODE_NAME.STYLE),e.id="zw-page-gridlines",e.type="text/css",e.media="screen",document.head.appendChild(e);var t=w_usersettings[ATTR_BODY.DS_UN],i=("in"==t?1:20)/4+t;J(e).text(".zw-page-gridlines { background-position: -1px -1px; background-size: "+i+" "+i+"; background-image: linear-gradient(to right, rgba(128, 128, 128, 0.25) 1px, transparent 1px), linear-gradient(to bottom, rgba(128, 128, 128, 0.25) 1px, transparent 1px); display: none; height: 100%; pointer-events: none; position: absolute; width: 100%; z-index: 11; }")}},UIUtils.removeGridlinesStyle=function(){J("#zw-page-gridlines").remove()},UIUtils.addGridLinesToPage=function(e){J(document.createElement("div")).addClass("zw-page-gridlines").prependTo(DomViewManager.getDOMElem(e))},function(){if("undefined"!=typeof DocLayoutManager&&DocLayoutManager.getAllPages){var e=DocLayoutManager.getAllPages();for(var t in e)UIUtils.addGridLinesToPage(e[t])}}(),PubSub.subscribe(DOMVIEW.PAGE_CREATED,function(e){UIUtils.addGridLinesToPage(e)}),PubSub.subscribe("Settings/UnitsChanged",UIUtils.updateGridlinesStyle=function(){UIUtils.removeGridlinesStyle(),UIUtils.addGridlinesStyle()}),PubSub.subscribe(["Gridlines/show"],function(){J("#view-lpnl-gridlines").ztoggleswitch("getState")?(UIUtils.addGridlinesStyle(),J(".zw-page-gridlines").show()):PubSub.publish("Gridlines/hide")}),PubSub.subscribe(["Gridlines/hide"],function(){J(".zw-page-gridlines").hide()}),UIUtils.getCustomZoomFactor=function(){var e,t=J(window);if("fitPage"==editor.customZoom){var i=DocLayoutManager.getPageHeightAtIdx(1),n=t.height(),o=Z("topband-wrapper").height(),r=Z("bottombar").height(),a=n-o-r-10;e=a/i}else if("fitWidth"==editor.customZoom){var s=t.width();J("#vruler-container").is(":visible")&&(s-=J("#vruler-container").outerWidth());var l=DocLayoutManager.getPageWidthAtIdx(1),d=Z(ELEM_ID.REVIEWRIGHTPANE),c=Z(ELEM_ID.PANELCONTAINER);LeftPanel.isContainerVisible(ELEM_ID.PANELCONTAINER)&&(s-=c.width()),d.is(":visible")&&(s-=d.width()),DocumentMap.getPanelPinState()&&(s-=J("#documentmapzdialog").outerWidth()),e=s/l}if(e&&e!=editor.zoomFactor){var u=100*e;return u>200&&(u=200),u}return null},UIUtils.getEventWithZoomFactor=function(e){var t=editor.jeditorPane.offset(),i=e.clientX-t.left,n=e.clientY-t.top;return i=t.left+i/editor.zoomFactor,n=t.top+n/editor.zoomFactor,{clientX:i,clientY:n}},UIUtils.openSignupWelcome=function(){var e=ZWNetworkUtils.getContextUrl("jsp/popups/writersignupwelcome.jsp");J.ajax({type:"GET",url:e,success:function(e,t,i){var n=document.createElement("div");n.innerHTML=e.trim(),J("body").append(J(n)),UIUtils.preProcessForDialogOpen(),editor.jMbSpan_editableSpan.attr("contenteditable","false")},error:function(){}})},UIUtils.openSignupDialog=function(e){var t={},i=editor.doc.getRole();"ANYONEWITHLINK"==editor.type?t.docType="anyone":"TRYEDITOR_WRITER"!==i&&"TRYEDITOR_OFFICEAPI"!==i||(t.docType="tryeditor",t.rsid=RemoteEditor.rsid,t.titleText="writer.signup.GET_STARTED_MESSAGE_MSG1",e&&(t.action=e)),zwritersignup.openSignupDialog(t)},UIUtils.closeSignupWelcome=function(){UIUtils.preProcessForDialogClose(),J("#wsignup-welcome-container").remove(),EditorUtil.focusMultiByteSpan()},UIUtils.openTopLinks=function(e){var t={accounts:"/IAMMyAccount",contacts:UIUtils.contactsURL,groups:"/IAMMyAccount#groups/allgroups",publicTemplate:UIUtils.publicTemplatesURL,forum:UIUtils.forumURL,blog:UIUtils.blogURL,reportabuse:UIUtils.reportabuseURL,writerLandingPage:UIUtils.writerLandingPageURL,faq:UIUtils.faqURL,howto:UIUtils.howtoURL,whatsNew:UIUtils.whatsNewURL,signIn:UIUtils.signInURL,fb:UIUtils.fbURL,twitter:UIUtils.twitterURL,linkedin:UIUtils.linkedinURL,iosApp:UIUtils.iosAppURL,macApp:UIUtils.macAppURL,androidApp:UIUtils.androidAppURL,chromeWebApp:UIUtils.chromeWebStoreURL,aboutoffline:UIUtils.aboutofflineURL,developerApi:UIUtils.developerApiURL,publishHelpCenter:UIUtils.publishHelpCenterURL};t.hasOwnProperty(e)?window.open(t[e]):"shortcut"==e?J.dialogutil.open("shortcut",void 0):"signout"==e&&(window.location.href="/jsp/logout.jsp")},UIUtils.changeView=function(e,t){var i=e[0],n=e[1]?e[1]:"bbar",o=event.srcElement,r="",a=J("#webview-wid-percentage-combobox"),s=J("#web-view-widPercenge-view-pnl"),l=J("#editorview-btn"),d="",c=!1,u=EditorView.getView();if("Web View"==i&&J(o).parents("#webview-percentage-div")[0])return event.preventDefault(),event.stopPropagation(),setTimeout(function(){var e="page_view";"Web View"==u&&(e="web_view"),J("#bbar-editorview").zmenu("check",e),J("#webview-wid-percentage-comboboxContainer").find("input").focus()}),!1;if("Web View"==i)r="bbar"==n?a.zcombobox().val():s.zcombobox().val(),d="webview-nw";else if("Page View"==i)a.zcombobox("setValue",parseInt(100)+"%"),s.zcombobox("setValue",parseInt(100)+"%"),d="pageview-nw";else if("Fullscreen View"!=i){if(isNaN(parseInt(i))||parseInt(i)>200||parseInt(i)<25)return void UIUtils.updateViewStatus(u);UIUtils.setWebViewWidth(i),r=parseInt(i)+"%",c=!0,i="Web View",d="webview-nw"}switch("Fullscreen View"!=i&&l.zmenubutton("setAttribute","icon","ui-sprit-fast ui-icon-"+d+"-sm"),i){case"Page View":case"Web View":var p={};p.view=i,p.view_width=r,editor.doc.execCmd("changeView",p),c&&J("#bbar-editorview").zmenu("hide");break;case"Fullscreen View":UIUtils.handleBrowserFullscreen(),UIUtils.updateViewStatus(u)}},UIUtils.addSynonymsMenu=function(e){var t=Z("synonymsSubMenuCbList");if(t.zmenu("removeAllMenuItems"),e){var i=e.length;if(0==i)t.zmenu("addMenuItem",{label:J.i18n("writer.proofing.NO_SUGGESTIONS"),disabled:"true"});else{for(var n=[],o=0;o<i;o++){var r={},a=e[o];r={label:a,customAttributes:{data:'{"appData":{"action":"Thesaurus.replace","params": "'+a+'"}}'}},n.push(r)}t.zmenu("addMenuItems",n)}t.zmenu("addMenuItem",{itemType:"separator",className:"ui-zmenu-item ui-zmenu-separator"}),t.zmenu("addMenuItem",{style:"width:100%",label:J.i18n("writer.proofing.THESAURUS"),action:"Thesaurus.insertThDlgFromRc"})}else t.zmenu("addMenuItem",{label:J.i18n("writer.common.LOADING"),disabled:"true"})},UIUtils.showSynonyms=function(){var e=editor.doc.getSelection().getWord(),t=e.getStart(),i=e.getEnd(),n=editor.doc.getContent(t,i);UIUtils.addSynonymsMenu(Thesaurus.getCachedThesaurusWords(n.toLowerCase())),ZWLogger.addToStatistics("rc_synonyms")},UIUtils.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(t.length),o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return{imageFile:new Blob([n],{type:i}),type:i}},UIUtils.convertHTMLToBlob=function(e,t){html2canvas(e,{useCORS:!0,allowTaint:!1,letterRendering:!0,onpreloaded:function(){t.onpreloaded&&t.onpreloaded(this)},onparsed:function(){t.onparsed&&t.onparsed(this)},onrendered:function(e){var i=e.toDataURL("image/png"),n=UIUtils.dataURItoBlob(i);t.success(n)}})},UIUtils.updateView=function(e){if("menuView"==e){var t=EditorView.getView(),i=t.replace(/\s/,"");i=i.toLowerCase(),J("#view-lpnl-pgview-grp-"+i).zbutton("check")}},PubSub.subscribe("BeforePanelOpen",UIUtils.updateView),UIUtils.hideEmptySeparators=function(){var e=function(e){var t=e.data().metadata;return"separator"===t.itemType},t=function(t,i){try{for(var n=i.menu.children().filter(":visible"),o=0;o<n.length-1;)e(J(n[o]))&&e(J(n[o+1]))?(J(n[o]).hide(),n.splice(o,1)):o++;var r=n.first(),a=n.last();e(r)&&r.hide(),e(a)&&a.hide()}catch(e){}};return t}(),UIUtils.addHTMLTooltips=function(e,t){U.each(e,function(e,i){var n='<div class="ui-ztooltip-content">{{content}}</div></div>';n=n.replace("{{content}}",t?e.content:J.i18n(e.content,[e.contentParams])),e.title&&(n='<div><div class="ui-ztooltip-header ui-colon">{{title}}</div>'+n,n=n.replace("{{title}}",t?e.title:J.i18n(e.title))),J("#"+i).attr("title",n)})},J(document).bind("zmenushow",UIUtils.hideEmptySeparators),UIUtils.openLatexDialog=function(){var e=function(){var e=editor.getDocument(),i={},n=e.getSelection().getRangeAt(0),o=n.getStartNode();o.type===NODE_TYPE.IMAGE&&(i.latexExpression=Utils.removeUnWantedUnicodes(o.getLatexExpression()||""),i.zoom=parseInt(o.style.zoom||0),i.latexImgSrc=o.style.src),i.resourceId=editor.doc.docInfo.RID,i.onInsertLatexImage=t,Latex.initDialog(i)},t=function(e){var t=e.latexImgSrc;t||i();var n=editor.getDocument(),o=n.getSelection(),r=o.getRangeAt(0),a=r.getStartNode(),s=n.createNode(NODE_TYPE.IMAGE);a.type===NODE_TYPE.PARAGRAPH?a.append(s):(a.type===NODE_TYPE.FIELD_END&&(a=a.getPreviousSibling()),a.type===NODE_TYPE.IMAGE?a.getLatexExpression()?s=a:a.insertBefore(s):a.type===NODE_TYPE.TEXT?(a.splitAt(r.start-a.start),a.insertAfter(s)):a.insertBefore(s)),s.style.height=e.height,s.style.width=e.width,s.style.zoom=e.resizeVal,s.style.id=Utils.getRandomNumber(),s.setLatexExpression(e.latexExp),t=HTMLUtil.storeImageInFileStore(t);var l=(l=t.indexOf("image.do?"))!==-1?l:t.indexOf("/scroll/viewImage.do?");s.style.src=t.slice(l),n.sync(function(){o.removeAllRanges().addRange(editor.doc.createRange(r.start)),i()})},i=function(){J.dialogutil.close("latexeditordialog")};return function(){J.dialogutil.open("latexeditordialog",void 0,{init:e})}}(),UIUtils.initDocumentMenu=function(){var e=Z("documentmenu");e.zmenu(),J("#editorpane").on("click",function(t){e.zmenu("show",{direction:"at-cursor",event:t})})},UIUtils.initReaderView=function(){ReaderView.init(),PubSub.subscribe("Writer/SwitchToDarkMode",ReaderView.setNightMode),ReaderView.setNightMode(1===editorProps.userInfo.settings[ATTR_BODY.DS_DARK_MODE])},UIUtils.showToast=function(e){ZAlertBanner.show({hideDelay:void 0===e.hideDelay?5e3:e.hideDelay,isMessageHTMLEncoded:e.isMessageHTMLEncoded||!1,message:e.message,type:e.type||"success",closeButton:!0,target:e.target||"body",position:"top",align:"center"})},UIUtils.insertFillableField=function(e,t,i){if(!(editor.getView()&&editor.getView()!==EDITOR_VIEWS.EDITOR||editor.isVersionView()||editor.isOfflineMode||editor.isFinalDocument())&&(J(editor.clientActiveSection).hasClass("zw-contentpane")||J(editor.clientActiveSection).hasClass("zw-textbox-div"))){var n,o=function(t,i){var n,o,r,a,s=0,l=i||Utils.getFillableFieldTooltip(t)+" ";return T.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(t){n=t.getFillableFieldType(),o=t.getName()||"",t&&n===e&&o.indexOf(l)!==-1&&(a=o.split(p?"_":" "),r=parseInt(a[a.length-1]),s<r&&(s=r))}),l+(s+1)},r=editor.getRole().permissions,a=r.can("document.edit"),s=r.can("document.fill"),l=editor.doc.getTrackChangeDetails(),d=editorProps.userInfo&&editorProps.userInfo.role,c=Macros.isPDFDocument();if(a&&(s||"REMOTEEDIT"===d)){var u=editor.doc.getSelection(),p=e===FILLABLEFIELD_TYPE.MULTIPLECHOICE||e===FILLABLEFIELD_TYPE.RADIO;c&&!u.isCollapsed()&&u.collapseToStart();var g=u.getRangeAt(0);g.cloneRange();g.collapsed||u.deleteSelectedContents(g);var f=editor.doc.getRawFormatAt(g.start-1),E=ImagePanel.getDefaultImagePostionJson(),T=editor.getDocument(),m=T.getSelection().getRangeAt(0);if(editor.doc.getCharAt(m.start-1)===UNICODE.RANGE_START&&f.type===NODE_TYPE.FILLABLEFIELD)return void ZWLogger.log("Cursor inside fillable field at index: "+(m.start-1));var h=c&&!DocTreeManager.getParents(NODE_TYPE.TEXTBOX,q);if(h){var I=0,_=0;if(E.positionV.from="page",E.positionH.from="page",i)m=T.createRange(),m.start=i.start,m.end=i.end,I=i.top,_=i.left,t||(t=e===FILLABLEFIELD_TYPE.RADIO||e===FILLABLEFIELD_TYPE.MULTIPLECHOICE?["Value 1","Value 2","Value 3"]:e===FILLABLEFIELD_TYPE.SELECTBOX?["Item 1","Item 2","Item 3"]:"");else{var A=m.start,S=DocLayoutManager.getLineAtIndex(A),R=S.view;I=R.getAbsTop("page"),_=R.getAbsLeft("page")}E[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=I,E[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=_}if(e===FILLABLEFIELD_TYPE.IMAGE||e===FILLABLEFIELD_TYPE.SIGNATURE||e===FILLABLEFIELD_TYPE.INITIAL){n=T.createNode(NODE_TYPE.IMAGE);var O={};O.cls=NODE_TYPE.FILLABLEFIELD,O[ATTR_FILLABLEFIELD.FF_INFO]={subType:e,value:" ",id:Utils.randomString(),disabled:!1};n.style[ATTR_IMAGE.I_SRC]=" ",O[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_FIT_TYPE]=e==FILLABLEFIELD_TYPE.SIGNATURE||e==FILLABLEFIELD_TYPE.INITIAL?"fluid":"fixed";var b=100,v=100;e==FILLABLEFIELD_TYPE.SIGNATURE?(b=n.style._.op.ht||50,v=n.style._.op.wid||300):e==FILLABLEFIELD_TYPE.INITIAL&&(b=n.style._.op.ht||50,v=n.style._.op.wid||50),h&&(n.style._.op.wrapType=WRAP_TYPE.FRONT,n.style._.op.positionV=E[ATTR_IMAGE.I_V_POSITION],n.style._.op.positionH=E[ATTR_IMAGE.I_H_POSITION]),O[ATTR_FILLABLEFIELD.FF_INFO].name=o(e),n.style.width=v,n.style.height=b,n.style.id=Utils.getRandomNumber(),n.setFormats(O),m.insertNode(n)}else if(e===FILLABLEFIELD_TYPE.MULTILINE){l.setProcessingTC(!1);var D=n=T.createNode(NODE_TYPE.IMAGE),L=T.createNode(NODE_TYPE.SECTION),N=(Utils.randomString(),{}),P=(Utils.randomString(),Utils.randomString(),Utils.randomString()),C="0in",y={type:NODE_TYPE.PARAGRAPH};h&&(C="0in",y.ls=1,N=E,N[ATTR_IMAGE.I_WRAP_TYPE]=WRAP_TYPE.FRONT),N[ATTR_COMMON.TYPE]=NODE_TYPE.IMAGE,N[ATTR_COMMON.SUBTYPE]=NODE_TYPE.TEXTBOX,N.pb=N.pb||C,N.pr=N.pr||C,N.pl=N.pl||C,N.pt=N.pt||C,N.id=P,N.op=100,N[ATTR_IMAGE.I_WID]=N[ATTR_IMAGE.I_WID]||300,N[ATTR_IMAGE.I_HT]=N[ATTR_IMAGE.I_HT]||98,N[ATTR_IMAGE.I_HT_UN]="px",N[ATTR_IMAGE.I_WID_UN]="px",N.cls=NODE_TYPE.FILLABLEFIELD,N[ATTR_FILLABLEFIELD.FF_INFO]={subType:FILLABLEFIELD_TYPE.MULTILINE,value:" ",id:Utils.randomString(),disabled:!1,maxLength:120},N[ATTR_FILLABLEFIELD.FF_INFO].name=o(e),D.setFormats(N),D.id=P,m.insertNode(D),L.setFormats({st:NODE_TYPE.TEXTBOX,sid:P,type:NODE_TYPE.SECTION});var F=T.getAllSections(),M=F.length,w=T.createNode(NODE_TYPE.PARAGRAPH);F[M-1].getLastChild().insertAfter(L),L.append(w),w.style.lineSpacing="1.0",w.style.spaceAfter="0pt",w.style.spaceBefore="0pt"}else if(p){l.setProcessingTC(!1);var U,x=m.getStartNode(),B=x.type===NODE_TYPE.FIELD_START&&x.getField();n=T.createFillableField(e);var H=1===t.length&&B?x.getField().getName():e===FILLABLEFIELD_TYPE.RADIO?"Radio_Group_":"Checkboxes_Group_",G=H;1===t.length&&B||(G=o(e,H));var k,W,Y,z;n._.op.name=n._.op.name||G;for(var Z=0,V=0;V<t.length;V++){if(k=t[V],W=k.split(" "),W=parseInt(W[W.length-1]),Y=T.createPlaceholderField("Option "+W),z=T.createNode(NODE_TYPE.TEXT," "),x.type===NODE_TYPE.PARAGRAPH)x.hasChildNodes()&&(x.splitAt(x.length),x=x.getNextSibling()),U=x;else{U=T.createNode(NODE_TYPE.PARAGRAPH);var j=x.type===NODE_TYPE.SECTION?x.getLastChild():x.getParent();if(!j||j.type!==NODE_TYPE.PARAGRAPH)return m;var X=m.start-j.start;if(X>0&&X<j.length){if(X!==j.length)var K=j.splitAt(X);K?K.insertBefore(U):j.insertAfter(U)}else m.start<=j.start?j[x.type===NODE_TYPE.FIELD_START?"insertAfter":"insertBefore"](U):(j.splitAt(j.length),U=j.getNextSibling())}n.setValue(k),n[ATTR_FILLABLEFIELD.FF_HELP_TEXT]=Utils.getFillableFieldTooltip(e),h&&(n._.op.wrapType=WRAP_TYPE.FRONT,E[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=I+Z,Z+=20,n._.op.positionV=E[ATTR_IMAGE.I_V_POSITION],n._.op.positionH=E[ATTR_IMAGE.I_H_POSITION],n._.op.wid=20,n._.op.ht=20,m.insertField(n)),h||(U=U.appendField(n),U=U.append(z),U=U.appendField(Y)),n=T.createFillableField(e),n._.op.name=n._.op.name||G,x=U}}else{n=T.createFillableField(e);var q=editor.doc.getSelection().getRangeAt(0).start;h&&(n._.op.wrapType="front",n._.op.wid=200,n._.op.ht=18.933,n._.op.positionV=E[ATTR_IMAGE.I_V_POSITION],n._.op.positionH=E[ATTR_IMAGE.I_H_POSITION],e===FILLABLEFIELD_TYPE.CHECKBOX&&(n._.op.wid=20,n._.op.ht=20)),e===FILLABLEFIELD_TYPE.CHECKBOX?n.setChecked(!!t):e===FILLABLEFIELD_TYPE.SELECTBOX?n.setList(t):n.setValue(t),n._.op.name=o(e),m.insertField(n)}try{T.sync(function(){EditorUtil.focusMultiByteSpan()}),PubSub.publish("FillableFieldInserted",n),ZWLogger.addToStatistics("Fillable Field Type:"+e+" inserted")}catch(e){var Q=ZWCollaboration.FILLABLE_FIELD_INSERT_ERROR;ZWLogger.log("Exception in fillable field insert: "+e.stack),ZWLogger.sendErrorDetails(Q+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>#\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+Q+"\n Error Log End \n <ZWERROR> Exception Stack: "+e.stack,null,Q)}(e===FILLABLEFIELD_TYPE.MULTILINE||p)&&l.setProcessingTC(!0)}}},UIUtils.insertZohoESign=function(e,t,i){if(e&&t){var n=J(editor.clientActiveSection);if((n.hasClass("zw-contentpane")||n.hasClass("header_primary")||n.hasClass("footer_primary")||n.hasClass("zw-textbox-div"))&&!(editor.getView()&&editor.getView()!==EDITOR_VIEWS.EDITOR||editor.isVersionView()||editor.isOfflineMode||editor.isFinalDocument())){var o=editor.doc.getSelection(),r=o.getRangeAt(0);r.collapsed||o.deleteSelectedContents(r);var a=editor.getDocument(),s=a.getSelection().getRangeAt(0),l=a.createSignerField(SIGN_TYPE.ESIGN,e);l&&(l.setValue(t),i&&l.setSize(i)),s.insertField(l);try{a.sync(function(){EditorUtil.focusMultiByteSpan()})}catch(e){var d=ZWCollaboration.MY_SIGNATURE_FIELD_INSERT_ERROR;ZWLogger.log("Exception in My Signature field insertion: "+e.stack),ZWLogger.sendErrorDetails(d+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>#\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+d+"\n Error Log End \n <ZWERROR>Exception Stack: "+e.stack,null,d)}}}},UIUtils.insertZohoDigiSign=function(e,t,i){if(e&&t){var n=J(editor.clientActiveSection);if((n.hasClass("zw-contentpane")||n.hasClass("header_primary")||n.hasClass("footer_primary")||n.hasClass("zw-textbox-div"))&&!(editor.getView()&&editor.getView()!==EDITOR_VIEWS.EDITOR||editor.isVersionView()||editor.isOfflineMode||editor.isFinalDocument())){var o=Macros.isPDFDocument(),r=editor.doc.getSelection();o&&!r.isCollapsed()&&r.collapseToStart();var a=r.getRangeAt(0);a.collapsed||r.deleteSelectedContents(a);var s=editor.getDocument(),l=s.getSelection().getRangeAt(0),d=s.createSignerField(SIGN_TYPE.DIGISIGN,e),c=e===SIGNERFIELD_TYPE.STAMP||e===SIGNERFIELD_TYPE.IMAGE;if(d){if(i&&0!=Object.keys(i).length){var u=i.start,p=i.end;u&&p&&(l=s.createRange(),l.start=u,l.end=p),d._.op.positionH=i[ATTR_IMAGE.I_H_POSITION],d._.op.positionV=i[ATTR_IMAGE.I_V_POSITION],d._.op.wid=i.wid||200,d._.op.ht=i.ht||20,d._.op.wrapType="front"}else Utils.allowTransformableSignerField()&&(d._.op.wid="radio"==e||"checkbox"==e?22:200,d._.op.ht=22);t.recipient&&d.setRecipient(t.recipient),e!=SIGNERFIELD_TYPE.SIGNATURE&&e!=SIGNERFIELD_TYPE.INITIAL||d.setMandatory(!0),t=Utils.getDigisignData(d);var g=Utils.getDigiSignTag(t,ESIGN.ZOHOSIGN);if(d.setValue(g||"",Macros.isSignTemplate()),c){d=s.createNode(NODE_TYPE.IMAGE);var f={};f.cls=NODE_TYPE.SIGNERFIELD;var E=50,T=150;if(d.style.width=T,d.style.height=E,i&&0!=Object.keys(i).length){var u=i.start,p=i.end;u&&p&&(l=s.createRange(),l.start=u,l.end=p),f.positionH=i[ATTR_IMAGE.I_H_POSITION],f.positionV=i[ATTR_IMAGE.I_V_POSITION],f.wid=T||200,f.ht=E||20,f.wrapType="front"}d.style.id=Utils.getRandomNumber(),f[ATTR_IMAGE.I_SRC]=" ",f[ATTR_SIGNERFIELD.SFINFO]={sfType:e,value:g,id:Utils.randomString(),mandatory:!1,recipient:t.recipient,signType:SIGN_TYPE.DIGISIGN,signService:"zohosign"},d.setFormats(f)}}c?l.insertNode(d):l.insertField(d);try{s.sync(EditorUtil.focusMultiByteSpan)}catch(e){var m=ZWCollaboration.SIGNER_FIELD_INSERT_ERROR;ZWLogger.log("Exception in signer field insertion: "+e.stack),ZWLogger.sendErrorDetails(m+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>#\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+m+"\n Error Log End \n <ZWERROR>Exception Stack: "+e.stack,null,m)}}}},UIUtils.appendZohoDigiSignFields=function(e,t,i){if(e.length){t||(t=SIGNERFIELD_TYPE.SIGNATURE);for(var n=editor.getDocument(),o=n.getBody(),r=0,a=e.length;r<a;r++){var s=n.createNode(NODE_TYPE.PARAGRAPH),l=n.createSignerField(SIGN_TYPE.DIGISIGN,t);if(l){t!=SIGNERFIELD_TYPE.SIGNATURE&&t!=SIGNERFIELD_TYPE.INITIAL||l.setMandatory(!0),e[r]&&l.setRecipient(e[r]);var d=Utils.getDigisignData(l);l.setValue(Utils.getDigiSignTag(d,ESIGN.ZOHOSIGN)||""),l._.op[ATTR_IMAGE.I_WID]=t==SIGNERFIELD_TYPE.RADIO||t==SIGNERFIELD_TYPE.CHECKBOX?22:200,l._.op[ATTR_IMAGE.I_HT]=22,s.appendField(l),o.append(s)}}return i?editor.getDocument().getChanges():void n.applyChanges()}},UIUtils.focusTyping=function(e){var t,i="zw-focus-para-style",n="zw-focus-para",o=".selectableSection .zw-paragraph{opacity:0.2;}.selectableSection .zw-paragraph."+n+"{opacity:1;}",r=[],a=function(){PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected","Document/PermissionUpdate"],d),PubSub.subscribe([DOMVIEW.PARAVIEW_AFTER_CREATE,DOMVIEW.CELLVIEW_AFTER_CREATE,DOMVIEW.PARAVIEW_AFTER_UPDATE,DOMVIEW.CELLVIEW_AFTER_UPDATE],d)},s=function(){PubSub.unsubscribe(["Cursor/Collapsed","Cursor/Selected","Document/PermissionUpdate"],d),PubSub.unsubscribe([DOMVIEW.PARAVIEW_AFTER_CREATE,DOMVIEW.CELLVIEW_AFTER_CREATE,DOMVIEW.PARAVIEW_AFTER_UPDATE,DOMVIEW.CELLVIEW_AFTER_UPDATE],d)},l=function(){var t=e.getElementById(i);t||(t=e.createElement(NODE_NAME.STYLE),t.id=i,t.type="text/css",J(e.head).append(t),J(t).text(o))},d=function(e){if(!editor.getRole().permissions.can("document.edit"))return void u();l(),!(r&&r.length)&&J("."+n).removeClass(n),e&&e.length||(t=editor.doc.getSelection()[0],e=DocTreeManager.getNodesBetweenIndex(NODE_TYPE.PARA,t.start,t.end));for(var i=0;i<e.length;i++)if(!r||r.contains(e[i]))for(var o=DocLayoutManager.getViews(e[i]),a=0;a<o.length;a++){var s=DomViewManager.getDOMElem(o[a]);J(s).addClass(n)}e.length&&c()},c=function(){var e=J(editor.clientActiveSection);e.hasClass("header_primary")?PubSub.publish("header/changed"):e.hasClass("footer_primary")&&PubSub.publish("footer/changed")},u=function(){J(e.getElementById(i)).remove(),J("."+n).removeClass(n)};return function(e,t){t&&t.state?(a(),l(),r=t.parasToBeFocussed,d(r)):(s(),u(),r=[]),EditorUtil.focusMultiByteSpan();var i={};i[ATTR_BODY.DS_FOCUS_TYPING]=t.state?1:0,Settings.updateUserSettings(i),"ANYONEWITHLINK"!==editor.type&&J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/options"),data:i,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})}}(document),UIUtils.switchTypewriterSound=function(e){var t,i=function(){var t=e.getElementById("typewriter-sound-container");if(!t){var i=J(t=document.createElement("div")).attr("id","typewriter-sound-container").appendTo(e.body),n={bellKey:"zw_bell.mp3",normalKey:"zw_key.mp3",spaceKey:"zw_space.mp3",returnKey:"zw_return.mp3"};for(var o in n)i.append('<audio id="'+o+'" preload="auto"><source src="'+cdnZWStaticPath+fingerPrintObj["sound/"+n[o]]+'" type="audio/mpeg"></source></audio>')}};return UIUtils.playSound=function(i){if(t)try{var n=e.getElementById(i);n.volume=1,n.playbackRate=1,0!==n.currentTime&&n.currentTime>0&&n.currentTime<n.duration&&(n.pause(),n.currentTime=0),n.play()}catch(e){}},function(e,n){(t=n&&n.state)&&i(),EditorUtil.focusMultiByteSpan();var o={};o[ATTR_BODY.DS_TYPEWRITER_SOUND]=n.state?1:0,Settings.updateUserSettings(o),"ANYONEWITHLINK"!==editor.type&&J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/options"),data:o,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})}}(document),UIUtils.markVisitedFeature=function(e){if(!(Macros.isRemote()||0==J("#new_tag_"+e).length||J("#new_tag_"+e).hasClass("uiframework-hide")||editorProps.userInfo.visited_features.contains(e.toString()))){var t=ZWNetworkUtils.getNiceUrlPrefix("util/features/markvisit"),i={};i.id=e,J.ajax({type:"POST",global:!1,async:!0,url:t,data:i,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){t&&t.RESPONSE&&(editorProps.userInfo.visited_features.push(e.toString()),PubSub.publish("Writer/NewFeatureVisited"))},error:function(e,t,i){}})}},UIUtils.openNewDocument=function(){ZWLogger.addToStatistics("try5_newFile"),window.open(editor.getBaseURL()+"/new?from=try5")},UIUtils.bindMenuHideEvent=function(){J("#changecasemenu,#insert-date-menu,#headerstyles,#footerstyles,#boderwidthmenu,#boderstylemenu,#page-bdr-width-menu,#page-bdr-style-menu,#para-bdr-width-menu,#para-bdr-style-menu").bind("zmenuhide",function(){setTimeout(function(){EditorUtil.focusMultiByteSpan()},10)})},UIUtils.showConditionalFieldNotification=function(){editor.conditionalFields.length>100&&(Notification.show({message:J.i18n("writer.common.MORE_CONDITION_FIELDPRESENT_MESSAGE"),translatedMessage:!0,close:!0,setTimer:!1,type:"warning"}),PubSub.unsubscribe("Document/LoadingComplete",UIUtils.showConditionalFieldNotification))},PubSub.subscribe("Document/ComponentInitialized",UIUtils.displayLinkForShowChanges),PubSub.subscribe("Document/ComponentInitialized",UIUtils.bindMenuHideEvent),PubSub.subscribe("Document/ComponentInitialized",function(){editor.conditionalFields.length>100?UIUtils.showConditionalFieldNotification():PubSub.subscribe("Document/LoadingComplete",UIUtils.showConditionalFieldNotification)}),PubSub.subscribeOnce("Document/ComponentInitialized",function(){if(J("#ui-typewriter-sound").ztoggleswitch("1"===editorProps.userInfo.settings[ATTR_BODY.DS_TYPEWRITER_SOUND]?"switchOn":"switchOff"),"1"!==editorProps.userInfo.settings[ATTR_BODY.DS_DARK_MODE]){var e=document.createElement(NODE_NAME.LINK);e.href=cssCdnZWStaticPath+fingerPrintObj["styles/writer_darkmode_min_all.css"],e.rel="stylesheet",e.type="text/css",document.head.appendChild(e),UIUtils.bindDialogEvents()}}),UIUtils.switchToDarkMode=function(e){var t=J(document.body),i=t.is(".darkMode"),n=i?"removeClass":"addClass";t[n]("darkMode")[n]("zmNightMode"),e?e.setAttribute("title",J.i18n("common",i?"TURN_ON_NIGHT_MODE":"TURN_OFF_NIGHT_MODE")):void 0;var o={};o[ATTR_BODY.DS_DARK_MODE]=i?0:1,Settings.updateUserSettings(o),J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/options"),data:o,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}}),PubSub.publish("Writer/SwitchToDarkMode",o[ATTR_BODY.DS_DARK_MODE])},UIUtils.handleBrowserFullscreen=function(){var e;UIUtils.handleEditorFullscreen=function(){var t=LayoutManager.isFullscreen();t||(e=LayoutManager.getCurrentLayout()),"true"==editorProps.userInfo.settings.showchatbar&&J("#wmstoolbar")[t?"show":"hide"](),J(".zw-page:first").css("margin-top",t||DomViewManager.isMultiplePagesInRow()?0:20),LayoutManager.loadLayout(t?e:LAYOUTS.FULLSCREEN),PubSub.publish("writer/fullScreenMode"),PubSub[(t?"un":"")+"subscribe"]("header/changed",i)};var t,i=function(){var e,t=document.getElementsByClassName("ui-hf-options");for(e=0;e<t.length;e++)UIStateHandler.build(t[e])};(t=document.fullscreenEnabled&&"requestFullscreen")?document.addEventListener("fullscreenchange",UIUtils.handleEditorFullscreen):(t=document.webkitFullscreenEnabled&&"webkitRequestFullscreen")?document.addEventListener("webkitfullscreenchange",UIUtils.handleEditorFullscreen):(t=document.mozFullScreenEnabled&&"mozRequestFullScreen")?document.addEventListener("mozfullscreenchange",UIUtils.handleEditorFullscreen):(t=document.msFullscreenEnabled&&"msRequestFullscreen")?document.addEventListener("MSFullscreenChange",UIUtils.handleEditorFullscreen):t=void 0;var n=function(){document.documentElement[t]()},o=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},r=!1;return PubSub.subscribe("Document/ComponentInitialized",function(){r=!0}),function(e){return ZWLogger.addToStatistics("FullScreen"),t?void(LayoutManager.isFullscreen()?o():r&&n()):void(r&&UIUtils.handleEditorFullscreen())}}(),UIUtils.handleDocumentTrash=function(e){if(editor.zuid==e||editor.getRole().permissions.can("document.restore"))MsgDialog.showMessage([J.i18n("writer.common.GO_TO_DASHBOARD"),J.i18n("writer.common.RESTORE")],"info",J.i18n("writer.common.MOVE_TO_TRASH_TITLE"),J.i18n("writer.common.MOVE_TO_TRASH_OWNER_MSG"),null,function(e){if(1==e){var t=editor.writerServerURL+"/documents";Utils.safeWindowOpen(decodeURI(t),{},"_self")}else 2==e&&PubSub.publish("Trash/Init",{operation:{action:"restore"}})});else{var t=function(e){switch(e){case 1:document.location.reload()}};MsgDialog.showMessage([J.i18n("common","OK")],"info",J.i18n("writer.common.MOVE_TO_TRASH_TITLE"),J.i18n("writer.common.MOVE_TO_TRASH_COLLAB_MSG"),null,t)}},PubSub.subscribeOnce("Document/Trashed",UIUtils.handleDocumentTrash),UIUtils.updateDocumentTitle=function(e){DocInfo.setProperty({title:e})},PubSub.subscribe("Document/Update/Title",UIUtils.updateDocumentTitle),UIUtils.handleDraftDeleteForever=function(e){MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_WARNING,J.i18n("writer.common.DOCUMENT_DELETED"),J.i18n("writer.common.DELETE_FOREVER_SUCCESS_MSG"),null,function(t){1==t&&window.open(decodeURI(e),"_self")})},PubSub.subscribeOnce("Document/Draft/DeleteForever",UIUtils.handleDraftDeleteForever),UIUtils.loadDistributeFileResouces=function(e,t){var i=jsCdnZWStaticPath+fingerPrintObj["js/writer_distribute_min_all.js"];zw.require({js:[i]},[],function(){if(e){var i=Utils.getAsFunction(e);i.callable(t)}})},UIUtils.loadDocsComMoveResources=function(e){var t=e[0],i=e[1];zw.require({js:[docsComponentjsMoveSource,docsComponentjsSaveasSource]},[],function(){if(t){var e=Utils.getAsFunction(t);e.callable(i)}})},UIUtils.initMovetoFolderComponent=function(e){var t=(e||{}).operations||{},i=editor.doc.docInfo;docName=t.document_name||i.DOCUMENT_NAME,rid=t.rid||i.RID,isWorkDriveUser=t.is_workdrive_user||"teamdrive"==editorProps.permissionsInfo.appInfo.NAME||"MACAPP_WD"==editorProps.permissionsInfo.appInfo.NAME,WDHandler.initialiseSaveAs(function(){isWorkDriveUser?WDHandler.showMoveDialog({createFolderEnable:!0,handback_obj:{},notifySuccessMessage:!0,okButtonName:J.i18n("writer.common.MOVE"),resId:rid,serviceName:"zw",showFileNameInHeader:!1,canShowResourceNameInAssociateDTForm:!1}):WDHandler.showMoveDialog({allowDuplicateName:!0,extension:"zwriter",fileExtension:"zwriter",fileName:docName,fileId:rid,dialogTitle:J.i18n("writer.zmoveto.MOVE_TO_FOLDER")})})},UIUtils.handleMoveDialog=function(){"draft"==editor.doc.docInfo.state?MsgDialog.showMessage([J.i18n("writer.common.MARK_AS_READY"),J.i18n("writer.common.CANCEL")],CONST.SEVERITY_INFO,J.i18n("writer.common.MARK_AS_READY_TO_MOVE_DOCUMENT"),J.i18n("writer.common.MARK_DRAFT_MSG_MOVE_DOCUMENT"),null,function(e){e==CONST.BUTTON_YES_CLICKED&&WDHandler.initialiseSaveAs(function(e){PubSub.publish("MovetoFolder/init")})}):WDHandler.initialiseSaveAs(function(e){PubSub.publish("MovetoFolder/init")})},UIUtils.handleFavouriteView=function(){var e,t,i,n,o=editorProps.userInfo;o.is_favourite?(e="fav",n=J.i18n("writer.common.REMOVE_FROM_FAVORITES")):(e="unfav",n=J.i18n("writer.common.ADD_TO_FAVORITES")),t="ui-icon-"+e+" checked",i="#zw-lp-"+e;var r=J(".fav-icon-span");r.attr("class","ui-fl fav-icon-span "+t),r.attr("title",n),r.find("use").attr("xlink:href",i)},UIUtils.initFileComponent=function(){Z("topband-file-cont").removeClass("ui-hide"),UIUtils.handleFavouriteView(),UIUtils.handleDocName()},UIUtils.setDocName=function(e){var t={};t.DOCUMENT_NAME=e,DocInfo.setProperty(t),UIUtils.handleDocName()},UIUtils.handleDocName=function(){var e=W.get("#topband-file-name");e.text(editor.doc.docInfo.DOCUMENT_NAME),e.attr({title:editor.doc.docInfo.DOCUMENT_NAME})},UIUtils.showFieldVisualCue=function(){var e=function(){var e=editor.getDocument(),t=e.getSelection().getRangeAt(0),i=t.getStartNode(),n=i&&i.type===NODE_TYPE.FIELD_START&&i.getField()||(i.type===NODE_TYPE.IMAGE||i.type===NODE_TYPE.TEXTBOX)&&i;editor.doc.getTrackChangeDetails().setProcessingContentDeletion(!0),n&&n.remove(),e.sync(EditorUtil.focusMultiByteSpan),editor.doc.getTrackChangeDetails().setProcessingContentDeletion(!1),Z("fieldvc-menu-parent").hide()},t=function(e){var t,i,n=editor.getDocument(),o=n.getSelection().getRangeAt(0),r=o.getStartNode(),a=editor.doc.getSelection();if(r&&r.type===NODE_TYPE.FIELD_START&&(t=r.getField()))i=t&&n.getFieldRange(t);else if(r&&r.isFillableImageField()){var s=r.getSection();i={start:s.getIndex()+1,end:s.getEndIndex()}}i&&a.removeAllRanges().addRange(editor.doc.createRange(i.start,i.end)),Z("fieldvc-menu-parent").hide()},i=function(){if(Macros.isPDFDocument()){var e=editor.getDocument(),t=e.getSelection().getRangeAt(0),i=t.getStartNode(),n=i&&i.type===NODE_TYPE.FIELD_START&&i.getField()||i.type===NODE_TYPE.IMAGE||i.type===NODE_TYPE.TEXTBOX&&i,o=n&&e.getFieldRange(n);if(n.type===NODE_TYPE.IMAGE){n&&editor.doc.getSelection().removeAllRanges().addRange(editor.doc.createRange(n.start,n.end)),o=editor.getDocument().createRange(),o.start=n.start,o.end=n.end;var r=ImagePanel.getDefaultImagePostionJson();r.positionV.from="page",r.positionH.from="page";var a=e.createNode(NODE_TYPE.IMAGE),s={};s.cls=NODE_TYPE.FILLABLEFIELD,s[ATTR_FILLABLEFIELD.FF_INFO]={subType:n.style._.op.ffInfo.subType,value:" ",id:Utils.randomString(),disabled:!1};n.style._.op.ffInfo.subType;a.style[ATTR_IMAGE.I_SRC]=n.style.src,s[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_FIT_TYPE]=n.style._.op.ffInfo.fitType,r[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=n.style.positionV.top+25,r[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=n.style.positionH.left+25,a.style.wrapType="front",a.style.positionV=r[ATTR_IMAGE.I_V_POSITION],a.style.positionH=r[ATTR_IMAGE.I_H_POSITION],a.style.width=n.style.width,a.style.height=n.style.height,a.setFormats(s),t.insertNode(a)}else n.type===NODE_TYPE.TEXTBOX?(n.style._.op.id=Utils.randomString(12),n.style._.op.positionH.left+=25,n.style._.op.positionV.top+=25,delete n.style._.op.fid,t.insertNode(n)):(o&&editor.doc.getSelection().removeAllRanges().addRange(editor.doc.createRange(o.start,o.end)),n._.op.id=Utils.randomString(12),n._.op.positionH.left+=25,n._.op.positionV.top+=25,delete n._.op.fid,t.insertField(n));e.sync(),Z("fieldvc-menu-parent").hide()}},n=function(e){var t=J("#fieldvc-menu-show-smtlbr"),i=J("#fieldvc-menu-show-fmtng"),n=J("#fieldvc-menu-reset-fmtng");t.show(),i.show(),n.show();var o,r,a=editor.getDocument().getSelection().getRangeAt(0);r=editor.doc.getRawFormatAt(e||a.start);var s=DocLayoutManager.getCurrentPage()&&DocLayoutManager.getCurrentPage().getId(),l=r&&r.cls===FIELD_TYPE.FILLABLE?a.start+1:a.start+2;o=J(editor.doc.getPortionData(l,s).node),o.hasClass("zeroSize")&&(o=J(editor.doc.getPortionData(l).node).next());var d=editor.doc.getRawFormatAt(e||a.start);if(d&&d[ATTR_IMAGE.I_WRAP_TYPE]){var c=d.ffInfo.id||d.id;o=J(J(editor.clientActiveSection).parents("div.zw-pagecontainer")[0].querySelector("div.float-image-container").querySelector("span[data-field-id='"+c+"']")),o.length||(o=J(J(editor.clientActiveSection).parents("div.zw-pagecontainer")[0].querySelector(r.ffInfo.subType===FILLABLEFIELD_TYPE.MULTILINE?"div[data-field-id='"+c+"']":"span[data-field-id='"+c+"']")))}d&&(d.cls||"").indexOf(AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER)!==-1&&o.addClass("ui-active-bg-clr");var u=o.offset(),p=editor.jeditorPane.offset(),g=document.getElementById("fieldvc-menu-parent");return g.style.display="block",g.style.top=u.top-p.top-54+"px",g.style.left=u.left-p.left-g.offsetWidth+84-5+(o.width()<40?o.width()/2-38:0)+"px",g.style.zIndex=20,r&&(r.cls||"").indexOf(FIELD_TYPE.FILLABLE)!==-1&&r[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]!==FILLABLEFIELD_TYPE.MULTILINE&&(t.hide(),i.hide(),n.hide()),!0};return function(o,r){return J("#fieldvc-menu-parent").length?n(r)&&o&&o():void J.ajax({type:"GET",url:ZWNetworkUtils.getContextUrl("jsp/popups/fieldvisualcues.jsp"),success:function(a){var s=document.createElement("fragment");s.innerHTML=a,J("#popup-menu-container").append(s.children),ZWComponentUtil.init("fieldvc-menu-parent"),J("#fieldvc-menu-delete").on("click",function(t,i){e()}),J("#fieldvc-menu-show-smtlbr").on("click",function(e,i){t("fieldvc-menu-show-smtlbr")}),J("#fieldvc-menu-duplicate").on("click",function(e,t){i()}),n(r),o&&o()}})}}(),UIUtils.hideEditorRenderedContent=function(){var e=J(DomViewManager.getAllPages()),t=e.first();e[0]=J("<span></span>"),e.remove(),t.find(".zw-paragraph,table,.zw-toc,.zw-hr").hide(),editor.jeditorPaneWrapper.height(t.height()+"px")},UIUtils.textAreaHeightHandler=function(e){e.style.height="5px",e.style.height=e.scrollHeight+"px"},UIUtils.isPropackEnabled=function(){return docProps.info&&docProps.info.IS_PRO_PACK_ENABLED||!1},UIUtils.isPropackAdmin=function(){var e=UIUtils.getPropackAdminZuids();return e.contains(parseInt(editor.zuid))},UIUtils.isServiceAdmin=function(){var e=Contacts.fetchAdminZuids(),t=new Deferred;return e.then(function(e){e=e||[],t.resolve(e.contains(parseInt(editor.zuid)))},function(e){t.reject(!1)}),t.promise()},UIUtils.getPropackAdminZuids=function(){var e=[];return docProps.info&&(e=docProps.info.ADDON_ADMIN_ZUIDS||docProps.info.ZID_ADMIN_ZUIDS||[]),e},UIUtils.toggleFixedView=function(e,t){var i="Fixed View"==EditorView.getView()||t?"Page View":"Fixed View",n=editor.doc.getBodyFormat();n[ATTR_COMMON.BORDERS]||(EditorView.setView(i),PubSub.publish("Document/view/changed"));var o;o=J(e).hasClass("zw-page")?J(e):J(e).parents("div.zw-page"),pageId=o.data("id"),dtPage=DocLayoutManager.getPageWithId(pageId),UIUtils.setEditorPaneWrapperHeight(!0),UIUtils.gotoPage(dtPage.getAbsolutePageNumber(),!0)},PubSub.subscribe("Document/Update/Permission",function(){var e,t={};e=ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"?from=editor"),J.ajax({url:e,data:t,type:"GET",dataType:"json",success:function(e){var t=e.writer_permissions;editorProps.permissionsInfo.permissions=t,editor.rebindEvents(t)},error:function(){},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})}),UIUtils.hideAllImages=function(){var e=function(e){if(DocTreeManager.isImagePreviewEnabled()){for(var t,i,n,o,r=DomViewManager.getDOMElem(e),a=J(e.imageMark),s=(isShape=!1,1==J(r).children(".imgMark").length),l=e.bookMarks.length,d=0;d<e.blocks.length;d++)if(n=e.blocks[d],o=!0,n.type==BLOCK_TYPE.IMAGE){for(var c in n.formats)if(i=n.formats[c],o=i.shapeData&&i.shapeData.type||!DocUtils.isImage(i),editor.doc.isHiddenMarkersEnabled&&"SHAPE"===o&&(isShape=!0),!o){t=i[ATTR_IMAGE.I_WRAP_TYPE];break}if(!o)break}if(!o&&!s){e.imageMark=document.createElement("div"),a=J(e.imageMark);var u="cell"==e.parent.parent.type,p=-30;if(u&&(p=-15),isShape||l||editor.doc.isHiddenMarkersEnabled&&t)p=-42;else if(isShape)return;a.css({left:p}),a.addClass("imgMark"),a.attr("title",J.i18n("writer.common.IMAGE_HAS_BEEN_HIDDEN_HERE"));var r=DomViewManager.getDOMElem(e);a.appendTo(r);var g=a.siblings(".zw-line-content").css("padding-top");a.css({top:parseInt(g)+2})}}},t=function(e,t){DocTreeManager.isImagePreviewEnabled()&&t!==LAYOUTS.COMPOSE&&t!==LAYOUTS.COLLABORATE&&t!==LAYOUTS.COMPLETE&&t!==LAYOUTS.FULLSCREEN&&(DocTreeManager.setImagePreviewEnabled(!1),J("#ui-hide-all-images").ztoggleswitch("switchOn"))},i=function(i){var n={setTimer:!1,type:"warning",close:!1,message:{key:"writer.common.HIDE_ALL_IMAGES_BANNER_TXT"}};n.btnText="writer.common.SHOW_ALL_IMAGES",n.callback=UIUtils.hideAllImages,Notification[i?"hide":"show"](n),PubSub[i?"unsubscribe":"subscribe"]([DOCVIEW.LINE_ADDED,DOCVIEW.LINE_UPDATED],e),PubSub[i?"unsubscribe":"subscribe"]("Document/LayoutChanged",t),DocTreeManager.setImagePreviewEnabled(!i);var o=new DocOpBuilder,r={};o.operation="load",DocTreeManager.refreshTree();for(var a,s=[],l=editor.doc.getSelection(),d=0,c=l.length;d<c;d++)a=l.getRangeAt(d),r.start=a.start,r.end=a.end,s.push(r),r={};o.cursor=s,o.postApplyTo(),EditorUtil.focusMultiByteSpan()};return function(e,t){"undefined"!=typeof t?i(t.state):J("#ui-hide-all-images").ztoggleswitch("undefined"!=typeof e.state&&e.state?"switchOff":"switchOn")}}(),UIUtils.openMakeaCopy=function(e){WDHandler.initialiseSaveAs(function(){PubSub.publish("MakeACopy/Open",{operation:e})})},UIUtils.openExternalLinks=function(e){var t={forum:UIUtils.forumURL,blog:UIUtils.blogURL,howto:UIUtils.howtoURL,iosApp:UIUtils.iosAppURL,macApp:UIUtils.macAppURL,androidApp:UIUtils.androidAppURL};t.hasOwnProperty(e)&&window.open(t[e])},UIUtils.openCustomFontSettingsDlg=function(){PubSub.publish("Font/CustomFontSettings")},UIUtils.showOrgPolicyDlg=function(){MsgDialog.showMessage([J.i18n("writer.common.GOT_IT")],CONST.SEVERITY_WARNING,J.i18n("writer.common.INSUFFICIENT_PERMISSIONS"),J.i18n("writer.common.INSUFFICIENT_PERMISSIONS_MSG"))},UIUtils.hanldeActionChange=function(){"TRYEDITOR_WRITER"==editor.doc.role?UIUtils.openSignupDialog():UIUtils.showOrgPolicyDlg()},PubSub.subscribe("Document/LoadingComplete",function(){void 0!=editorProps.options&&editorProps.options.isExtensionDevMode&&PubSub.publish("Marketplace/Init")}),PubSub.subscribe("UIStateHandler/actionChanged",UIUtils.hanldeActionChange),UIUtils.setDocumentLogo=function(){var e=J("#topband-logo"),t="";if("ANYONEWITHLINK"===editorProps.type){var i=editorProps.orgInfo,n=i.LOGO_URL;t=n?UIUtils.getLogoHtmlTemplate(n):editor.getRole().permissions.can("document.edit")||editor.isFinalDocument()?UIUtils.getLogoHtmlTemplate(!1,"ui-flex-container"):UIUtils.getLogoHtmlTemplate(!1,"ui-flex-container ui-zwlogo-wt")}else{if(editor.getRole().permissions.can("document.edit")||editor.isFinalDocument())return void e.remove();t=UIUtils.getLogoHtmlTemplate(!1,"ui-flex-container ui-zwlogo-wt")}e.append(t)},UIUtils.getLogoHtmlTemplate=function(e,t){var i="",n="<a class='logo ui-fl' ><img alt ='##customLogo## logo' src ='##customLogoUrl##' border = '0' /></a>",o="<a class='ui-fl ui-zoho-logo' zui-hide='state.offline' target='_blank' href='##writer_home_url##'><div class='##logo_class##'><svg class='ui-zwlogo__icon' width='24px' height='24px'><use xlink:href='##logo_id##'></use></svg><span class='ui-zwlogo__txt'>##productName##</div></a>";return e?(i=n.replace("##customLogoUrl##",e),i=i.replace("##customLogo##",e)):(i=o.replace("##logo_class##",t),i=i.replace("##productName##",void 0!=docProps.productInfo?docProps.productInfo.logo_name:editorProps.deployment.writer),i=i.replace("##writer_home_url##","https://"+editor.writerServerURL),i=i.replace("##logo_id##",productLogo)),i},UIUtils.showDocumentFieldUpdateMenu=function(e){var t=J("#updatefieldmenu");t.data().componentName||ZWComponentUtil.init("updatefieldmenu");var i=editor.doc.getSelection(),n=i.getStart(),o=DocUtil.getRangeEnd(n),r=editor.doc.createRange(n,o+1);if(i.removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(r),!J(e).parents(".zw-contentpane")[0]){var a=DocLayoutManager.getCurrentPage(),s=a?a.id:null;e=editor.doc.getPortionData(n+2,s).node}if(e){var l=editor.doc.getRawFormatAt(n);l&&l[ATTR_AUTOFIELD.ISAUTO]?t.zmenu("setMenuItemsAttribute",J("#callout-autofield-auto"),"checked",!0):t.zmenu("setMenuItemsAttribute",J("#callout-autofield-keepvalue"),"checked",!0),t.zmenu("show",{forElement:J(e)})}},UIUtils.fetchUpdateAutoFieldMenu=function(){if(editor.getRole().permissions.can("document.edit")){var e=J("#updatefieldmenu");if(!e[0]){var t=ZWNetworkUtils.getContextUrl("jsp/popups/updatefieldoptions.jsp");J.ajax({type:"GET",url:t,success:function(e){var t=document.createElement("fragment");t.innerHTML=e,J("#popup-menu-container").append(t.children),J("#updatefieldmenu").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)})}})}}},UIUtils.zoomOut=function(){UIUtils.setZoomFactor([""+100*(editor.zoomFactor-.25)])},UIUtils.zoomIn=function(){UIUtils.setZoomFactor([""+100*(editor.zoomFactor+.25)])},UIUtils.initMaskTooltipsInToolpnl=function(){var e={"tools-panel-redact":{title:"writer.common.REDACT_CONTENT",content:"writer.common.REDACT_CONTENT_TOOLTIP"},"tools-panel-unredact":{title:"writer.common.UNMASK_REDACT_CONTENT",content:"writer.common.UNMASK_REDACT_CONTENT_TOOLTIP"}};UIUtils.addHTMLTooltips(e)},UIUtils.handDraftPopup=function(e,t){MsgDialog.showMessage([J.i18n("writer.common.MARK_AS_READY"),J.i18n("writer.common.CANCEL")],CONST.SEVERITY_WARNING,J.i18n("writer.common.MARK_AS_READ_TITLE"),J.i18n("writer.common.MARK_AS_READY_MSG"),null,function(i){switch(i){case CONST.BUTTON_1_CLICKED:MarkAsReady.markComplete(e,t)}})},UIUtils.addFontFaceCSSInHTML=function(e){if(document&&void 0!==typeof editor&&e){var t,i,n,o=document,r="",a=ZWWebFontLoader.getLoadedWebFonts();a=a.length?a:editor.getUsedWebFonts();for(var s=0;s<a.length;s++)if(t=a[s],i=FontUtils.getWebFont(t)){n=i.getFontVariants();for(var l,d,c=0,u=n.length;c<u;c++)l=n[c],d=(/^[1-9]00i$/.test(l)?"i":"n")+l.replace(/[0i]/g,""),fontFaceCss=i.getFontFaceCSS(l,!1),r+=i.getFontFaceCSS(l)}if(r){var p=o.getElementById("webfonts-style");return p?r=J(p).text()+r:(p=o.createElement(isHeadlessHTML?"div":NODE_NAME.STYLE),p.id="webfonts-style",p.type="text/css",e.append(p)),J(p).text(r),e}}},UIUtils.handleDocumentMerged=function(e,t){editor.zuid===e&&editor.rebindEvents(),UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING"));var i=t.isnew_doc,n=editor.doc.getUserData(),o=t.userInfos||{};for(var r in o)o.hasOwnProperty(r)&&!n.hasOwnProperty(r)&&(n[r]=o[r]);i&&(DocInfo.setProperty({newDoc:!1}),PubSub.publish("Document/SaveStatus",!0,void 0,e,null,!1));var a=function(){UIUtils.hideLoadingMsg(),PubSub.unsubscribe("Document/LoadingStart",a)},s=editor.doc.docInfo;PubSub.subscribe("Document/LoadingStart",a),editor.fetchDocument(s.RID,"")},UIUtils.detectFieldsUsingZLabsApi=function(e,t){for(var i=editor.doc.getFormats(),n=[],o=[],r=0;r<i.length;r++)if(i[r]&&"image"==i[r].type&&"behind"==i[r].wrapType){var a=i[r].ht,s=i[r].wid,l=DocLayoutManager.getPageWidthAtIdx(r),d=DocLayoutManager.getPageHeightAtIdx(r);if(parseInt(a)==parseInt(d)&&parseInt(s)==parseInt(l)){var c=i[r].src.split("imgurl=").pop(),u={img_wid:s,img_ht:a};n.push(c),o.push(u)}}if(n.length<1)t("empty");else{var p={};p.img_attr=JSON.stringify(o),p.img_url=JSON.stringify(n);var g=Macros.getRId(),f=ZWNetworkUtils.getNiceUrlPrefix(g+"/fields/detect");UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),J.ajax({url:f,data:p,dataType:"json",type:"POST",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){UIUtils.hideLoadingMsg(),e(t.positions)},error:function(){UIUtils.hideLoadingMsg(),t("failure")}})}},PubSub.subscribe("Document/ComponentInitialized",function(){J("#bbar-editorview").unbind("zmenuitemclick").bind("zmenuitemclick",function(e,t){var i=t.menuitem,n=J(i).metadata().appData,o=n.params,r=UIUtils.changeView(o);return r})}),UIUtils.checkForUnsupportedContentInfo=function(){editorProps.hasOwnProperty("conversionInfo")&&PubSub.publish("UnsupportedPopOver/Init")},UIUtils.showProfileInfoEvent=function(e,t){var i=e.currentTarget;t||(t=J(i).data("userZuid")),UIUtils.showProfileInfo(e.target,t)},UIUtils.showProfileInfo=function(e,t){Macros.isRemote()||setTimeout(function(){WebMessanger.showProfileInfo(e,t),W.get("#profileinfo_wrapper").css({"z-index":1e6})},1)},PubSub.subscribeOnce("Document/ComponentInitialized",UIUtils.checkForUnsupportedContentInfo),function(){"use strict";var e=function(e,t){if(e.setAttribute("id",t.id),delete t.id,t.hasOwnProperty("style")){var i=t.style,n="";for(var o in i)n+=o+":"+i[o]+";";e.setAttribute("style",n),delete t.style}for(var o in t){var r="object"!=typeof t[o]?t[o]:JSON.stringify(t[o]);e.setAttribute(o,r)}},t=function(e){var t=(editor.jeditorPane.offset(),e.offset()),i=e.height(),n=t.left,o=t.top;return{left:n,top:o,height:i}},i=function(){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),i=t(e);return i.top=i.top+i.height,i},n=function(t,i){t.ctype="zmenu","undefined"==typeof t.id&&(t.id=Utils.randomId("custommenu")),this.maxLength=t["max-length"]?t["max-length"]:10,delete t["max-length"],this.openAtCursor=i,this.isInitialized=!1,this.id=t.id,this.componentObj=t,this.elem=document.createElement("div"),e(this.elem,t),this.init()};n.prototype.reposition=function(e){J("#"+this.id).zmenu("show",{position:{top:e.top,left:e.left},mustBeShown:!0})},n.prototype.init=function(){this.isInitialized||(document.body.appendChild(this.elem),ZWComponentUtil.init(this.id),J("#"+this.id).off("zmenuitemclick").on("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),this.generateMenu(),this.isInitialized=!0)},n.prototype.setFooter=function(e){this.footerItem=e,this.footerItem.isFooter=!0,J("#"+this.id).zmenu("addMenuItem",this.footerItem)},n.prototype.generateMenu=function(){if(!this.isInitialized){J("#"+this.id).zmenu("removeAllMenuItems");for(var e=0;e<this.maxLength;e++)J("#"+this.id).zmenu("addMenuItem",{id:"option"+e})}},n.prototype.constructMenu=function(e){var t=e.length;J("#"+this.id).zmenu("hideAllMenuItems");for(var i=[],n=0;n<this.maxLength;n++)if(n<t){var o=e[n],r="#option"+n;if("undefined"==typeof r)continue;for(var a in o)"id"!=a&&J("#"+this.id).zmenu("setMenuItemsAttribute",[r],a,o[a]);i.push(r)}J("#"+this.id).zmenu("showMenuItems",i)},n.prototype.show=function(e){"object"==typeof e?this.reposition(e):this.openAtCursor&&(e=i(),this.reposition(e)),this.elem.style.display="block"},n.prototype.hide=function(){J("#"+this.id).zmenu("hideAllMenuItems"),J(this.elem).zmenu("hide")},window.CustomMenu=n}(),function(e,t){var i=[],n={categoryListTemplate:"#category-topics-list-template",articleTemplate:"#article-cont-template",attachListTemplate:"#attach-list-cont-template",articleListTemplate:"#artical-list-template",helpSearchListTemplate:"#help-article-list-template",articleListTitleTemplate:"#help-article-list-title-template",kbSearchResultTemplate:"#kb-search-result-template",helpSearchResultTemplate:"#help-search-result-template",helpCenterErrorMsgTemplate:"#error-msg-template",articleListLoadingTemplate:"#article-list-loading-template",fileAttachListTemplate:"#file-attach-cont-template"},o=function(e){return i[e]=t.compile($(n[e]).html())},r=function(e){return i[e]||o(e)},a=function(e,t){n[e]=t};e.Templates={getTemplate:r,registerTemplate:a}}(window,Handlebars);var NotificationSettings=function(){var e={ALL_CHANGES:!1,ALL_COMMENTS:!1,NEW_COMMENTS:!1,PARTICIPATED_COMMENTS:!1,NO_NOTIFICATION:!1},t=NOTIFICATION_RULE_CONSTANTS,i=function(){var e=null;for(var t in this.states)this.states[t]&&(e&&(e|=this.stateValues[t]),e||(e=this.stateValues[t]));return e},n=function(e){e=e==-1?this.states.NO_NOTIFICATION:e;for(var t in this.stateValues){var i=this.stateValues[t];(e&i)===i&&(this.states[t]=!0)}return this.states},o=function(){NotificationSettings.states=NotificationSettings.decodeStates(parseInt(editor.doc.docInfo.NOTIFY_RULE))};return PubSub.subscribe("Document/ComponentInitialized",o),{init:o,encodeStates:i,decodeStates:n,stateValues:t,states:e}}(),NotificationSettingsView=new function(e){this.init=function(e){this.$el=e,this.syncUI()},this.enableCommentOptions=function(){this.$el.find("#comments-sub-options").find(":checkbox").enable(),this.$el.find("#comments-sub-options").find("label").removeClass("ui-zwdisabled")},this.disableCommentOptions=function(){this.$el.find("#comments-sub-options").find(":checkbox").disable(),this.$el.find("#comments-sub-options").find("label").addClass("ui-zwdisabled")},this.showCommentSubOptions=function(e){if(this.$el.find("#comment-changes").is(":checked")){var t=this;this.enableCommentOptions();var i=t.$el.find("#all-comments").prop("checked")||t.$el.find("#new-comments").prop("checked")||t.$el.find("#participated-comments").prop("checked");i?t.enforceValidation():t.$el.find("#all-comments").prop("checked",!0)}else{var t=this;this.disableCommentOptions()}},this.enforceValidation=function(e){this.$el.find("#all-comments").prop("checked")&&this.disableCustomCommentNotificationOptions()},this.disableCustomCommentNotificationOptions=function(){this.$el.find("#new-comments").prop("checked",!1),this.$el.find("#participated-comments").prop("checked",!1)},this.disableAllCommentNotificationOption=function(){this.$el.find("#all-comments").prop("checked",!1)},this.onSelectAllCommentNotifcations=function(){this.$el.find("#all-comments").prop("checked")?this.disableCustomCommentNotificationOptions():this.$el.find("#new-comments").prop("checked")||this.$el.find("#participated-comments").prop("checked")||this.$el.find("#all-comments").prop("checked",!0)},this.onSelectNewCommentNotifications=function(){this.$el.find("#new-comments").prop("checked")?this.disableAllCommentNotificationOption():this.$el.find("#all-comments").prop("checked")||this.$el.find("#participated-comments").prop("checked")||this.$el.find("#all-comments").prop("checked",!0)},this.onSelectParticipatedCommentNotifications=function(){this.$el.find("#participated-comments").prop("checked")?this.disableAllCommentNotificationOption():this.$el.find("#all-comments").prop("checked")||this.$el.find("#new-comments").prop("checked")||this.$el.find("#all-comments").prop("checked",!0)},this.events={"#all-changes,#comment-changes,#no-notifications click":this.showCommentSubOptions,"#all-comments click":this.onSelectAllCommentNotifcations,"#new-comments click":this.onSelectNewCommentNotifications,"#participated-comments click":this.onSelectParticipatedCommentNotifications},this._bindEvents=function(){var t=U.keys(this.events),i=this;t.map(function(t){var n=t.split(" ");e=n.length>1?i.$el.find(n[0]):i.$el;var o=n.pop(),r=i.events[t];e.on(o,U.bind(r,i))}),this.$el.data("events.bound",!0)},this.bindEvents=function(){var e=this.$el.data("events.bound");e||this._bindEvents()},this.syncUI=function(){NotificationSettings.states.ALL_CHANGES&&(this.disableCommentOptions(),this.$el.find("#all-changes").prop("checked",!0)),NotificationSettings.states.ALL_COMMENTS&&(this.enableCommentOptions(),this.$el.find("#comment-changes").prop("checked",!0),this.$el.find("#all-comments").prop("checked",!0)),NotificationSettings.states.NEW_COMMENTS&&(this.enableCommentOptions(),this.$el.find("#comment-changes").prop("checked",!0),this.$el.find("#new-comments").prop("checked",!0)),NotificationSettings.states.PARTICIPATED_COMMENTS&&(this.enableCommentOptions(),this.$el.find("#comment-changes").prop("checked",!0),this.$el.find("#participated-comments").prop("checked",!0)),NotificationSettings.states.NO_NOTIFICATION&&(this.disableCommentOptions(),this.$el.find("#no-notifications").prop("checked",!0))},this.done=function(){NotificationSettings.states.ALL_CHANGES=!1,NotificationSettings.states.ALL_COMMENTS=!1,NotificationSettings.states.NEW_COMMENTS=!1,NotificationSettings.states.PARTICIPATED_COMMENTS=!1,NotificationSettings.states.NO_NOTIFICATION=!1,this.$el.find("#all-changes").prop("checked")&&(NotificationSettings.states.ALL_CHANGES=!0),this.$el.find("#comment-changes").prop("checked")&&(this.$el.find("#all-comments").prop("checked")&&(NotificationSettings.states.ALL_COMMENTS=!0),this.$el.find("#new-comments").prop("checked")&&(NotificationSettings.states.NEW_COMMENTS=!0),this.$el.find("#participated-comments").prop("checked")&&(NotificationSettings.states.PARTICIPATED_COMMENTS=!0)),this.$el.find("#no-notifications").prop("checked")&&(NotificationSettings.states.NO_NOTIFICATION=!0);var e=NotificationSettings.encodeStates(),t=this.$el.find("#notify_makedefault").prop("checked"),i={};i.rid=editor.doc.docInfo.RID,i.notify=JSON.stringify(NotificationSettings.states),i.notify_default=t,ZWNetworkUtils.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/notificationrule"),data:i,error:function(){},success:function(){DocInfo.setProperty({NOTIFY_RULE:JSON.stringify(e)}),PubSub.publish("Document/NotificationSettingsUpdated",NotificationSettings.states)},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}}),ZWLogger.addToStatistics("doc_notificationSettings"),J.dialogutil.close("notification")}};Handlebars.registerHelper("getProp",function(e,t){return t[e]}),Handlebars.registerHelper("getId",function(){var e=null!=this.parentId?this.parentId:this.id;return editor.base_url+"/open/"+editor.doc.rid+"/comments/"+e}),Handlebars.registerHelper("innerHtml",function(e,t){var i=document.createElement("div");return i.innerHTML=this[e],i.innerHTML}),Handlebars.registerHelper("getUsername",function(e){var t;return t=e&&""!==e?ReviewUtil.getUserProp(e,"fname"):"Guest"}),Handlebars.registerHelper("zwtimeAgo",function(e){return Utils.getTimeFromNow(e)}),Handlebars.registerHelper("safestring",function(e){return new Handlebars.SafeString(e)}),Handlebars.registerHelper("i18n",function(){return J.i18n(arguments[0],arguments[1])}),Handlebars.registerHelper("i18n-fromconstantfile",function(){var e=arguments[0][arguments[1]];if(e==CONVERSION_UNSUPPORTED_TOOL_TIP["Work In Progress"]){var t=e.split(".");return J.i18n(t[1],t[2],[3,4])}return J.i18n(e)}),Handlebars.registerHelper("i18n-withplaceholder",function(){return J.i18n(arguments[0],arguments[1],Array.prototype.slice.call(arguments,2,arguments.length-1))}),Handlebars.registerHelper("getMarkedupCommentContent",function(e){var t=CommentUtils.getMarkedupCommentContent(Utils.encodeHTMLString(e));return new Handlebars.SafeString(t)}),Handlebars.registerHelper("getUserImg",function(e){return ZWNetworkUtils.getUserImageURL(e)}),Handlebars.registerHelper("getUserColor",function(e){return ReviewUtil.getUserColour(e)}),Handlebars.registerHelper("getCount",function(e){return CommentUtils.getCount(e)}),Handlebars.registerHelper("zwdatetime",function(e){var t="undefined"!=typeof editorProps&&editorProps.userInfo&&editorProps.userInfo.language?editorProps.userInfo.language:null;return e=new ZWDateTime(e,null,t),e.format("EEEE DD MMM YYYY hh mm")}),Handlebars.registerHelper("zwdatewithformat",function(e,t){if(!e||e.length<1)return"";"string"==typeof e&&(e=parseInt(e));var i="undefined"!=typeof editorProps&&editorProps.userInfo&&editorProps.userInfo.language?editorProps.userInfo.language:null,n="undefined"!=typeof editorProps&&editorProps.userInfo&&editorProps.userInfo.languageVariant?editorProps.userInfo.languageVariant:null;return i=n?i+"-"+n:i,e=new ZWDateTime(e,null,i),e.format(t||"DD MMM YYYY")}),Handlebars.registerHelper("clone",function(e){if(e){var t=J(e);if(t.length<1)return"";t=t.clone();var i=t.attr("id")+"-helper";t=t.attr("id",i).removeAttr("onclick").off("click"),t.find("[onclick]").removeAttr("onclick").off("click"),t.find("[title]").removeAttr("title").off("click");var n=t[0].outerHTML;return new Handlebars.SafeString(n)}return""}),Handlebars.registerHelper("unescapeHtml",function(e){return J("<textarea />").html(e).val()}),Handlebars.registerHelper("escapeHtml",function(e){var t=document.createTextNode(e);return t.nodeValue}),Handlebars.registerHelper("constructQTImgSrc",function(e){return"/writer/v1/web/autotext/preview/"+e}),Handlebars.registerHelper("math",function(e,t,i){return e=parseFloat(e),i=parseFloat(i),{"+":e+i}[t]}),Handlebars.registerHelper("compare",function(e,t,i,n){var o,r;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");if(void 0===n&&(n=i,i=t,t="==="),o={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},typeof:function(e,t){return typeof e==t}},!o[t])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+t);return r=o[t](e,i),r?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("ifCond",function(e,t,i,n){switch(t){case"==":return e==i?n.fn(this):n.inverse(this);case"===":return e===i?n.fn(this):n.inverse(this);case"!=":return e!=i?n.fn(this):n.inverse(this);case"!==":return e!==i?n.fn(this):n.inverse(this);case"<":return e<i?n.fn(this):n.inverse(this);case"<=":return e<=i?n.fn(this):n.inverse(this);case">":return e>i?n.fn(this):n.inverse(this);case">=":return e>=i?n.fn(this):n.inverse(this);case"&&":return e&&i?n.fn(this):n.inverse(this);case"||":return e||i?n.fn(this):n.inverse(this);default:return n.inverse(this)}}),Handlebars.registerHelper("getFavIconCls",function(e){return e?"fav":"unfav"}),Handlebars.registerHelper({eq:function(e,t){return e===t},ne:function(e,t){return e!==t},lt:function(e,t){return e<t},gt:function(e,t){return e>t},lte:function(e,t){return e<=t},gte:function(e,t){return e>=t},and:function(){return Array.prototype.every.call(arguments,Boolean)},or:function(){return Array.prototype.slice.call(arguments,0,-1).some(Boolean)},not:function(e){return!e}}),Handlebars.registerHelper("isDefined",function(e){return void 0!==e&&null!==e}),Handlebars.registerHelper("isNotDefined",function(e){return void 0===e||null===e}),Handlebars.registerHelper("getTransitionFields",function(e,t){return t.documentWorkflowInfo.transitionFieldsMap[e]}),Handlebars.registerHelper("getTransitionFieldInfo",function(e,t,i){return i.fields.filter(function(e){return e.customfield_id===t})[0]}),Handlebars.registerHelper("stringify",function(e){return JSON.stringify(e)}),Handlebars.registerHelper("getPicklistDisplayName",function(e,t){var i=e.picklist_details.filter(function(i){return i.picklist_id===(t||e.value)})[0].display_name;return i}),Handlebars.registerHelper("getStateColorClass",function(e,t){return e[t].history}),Handlebars.registerHelper("i18n-withplaceholder-escaped",function(){var e=J.i18n(arguments[0],Array.prototype.slice.call(arguments,1,arguments.length));return new Handlebars.SafeString(e)}),Handlebars.registerHelper("name-replacer",function(){var e={WRITER_ROLE_Approvers:"Approvers",WRITER_ROLE_OWNERS:"Owner",WRITER_ROLE_Assigners:"Assigner",WRITER_ROLE_Reviewers:"Reviewers"};return e[arguments[0]]||arguments[0]}),Handlebars.registerHelper("getFormattedTimeForWorkflow",function(e){var t=new ZWDateTime(parseInt(e)),i=t.format("DD MMMM YYYY"),e=t.format("hh:mm");return J.i18n("writer.common.DATE_AT_TIME",[i,e])}),Handlebars.registerHelper("insertTab",function(e){return e=e||1,"&nbsp".repeat(4*e)}),Handlebars.registerHelper("length",function(e,t){return e.length}),Handlebars.registerHelper("length_gt",function(e,t){return e&&e.length>t}),Handlebars.registerHelper("stringify",function(e){return JSON.stringify(e)}),Handlebars.registerHelper("combineString",function(){return Array.prototype.slice.call(arguments,0,arguments.length-1).join("")}),Handlebars.registerHelper("escapeString",function(e){return Handlebars.Utils.escapeExpression(e)}),Handlebars.registerHelper("timeInUnits",function(e){var t={SECOND:1e3,MINUTE:6e4,HOUR:36e5,DAY:864e5,WEEK:6048e5,MONTH:24192e5,YEAR:290304e5,SECONDS_45:45e3,MINUTES_45:27e5,HOURS_22:792e5,DAYS_26:22464e5,DAYS_320:27648e6},i="",n=e;return e>=t.DAYS_320?(n=Math.round(n/t.YEAR),i=n+" "+(n>1?" yrs.":" yr.")):e>=t.DAYS_26&&e<t.DAYS_320?(n=Math.round(n/t.MONTH),i=n+" "+(n>1?"mos.":"mo.")):e>=t.HOURS_22&&e<t.DAYS_26?(n=Math.round(n/t.DAY),i=n+" "+(n>1?"days":"day")):e>=t.MINUTES_45&&e<t.HOURS_22?(n=Math.round(n/t.HOUR),i=n+" "+(n>1?"hrs.":"hr.")):e>=t.SECONDS_45&&e<t.MINUTES_45?(n=Math.round(n/t.MINUTE),i=n+" "+(n>1?"mins.":"min.")):(n=Math.round(n/t.SECOND),i=n+" "+(n>1?"secs.":"sec.")),i}),Handlebars.registerHelper("timeInUnitsWithLineBreak",function(e){return Handlebars.helpers.timeInUnits(e).split(" ")[0]+"<br>"+Handlebars.helpers.timeInUnits(e).split(" ")[1]});var TcNoMarkupHandler=function(e,t,i,n,o){var r=e.build([]),a=!1,s="",l=function(t){r=e.build([]),HiddenRangesHandler.reset()},d=function(e){r=e},c=function(){return HiddenRangesHandler.getHiddenRangeOps()},u=function(){return HiddenRangesHandler.hasTcHiddenRange()},p=function(e){var t=editor.doc.docInfo;25==t.REVISION&&1!=t.VERSION&&(s="",ZWLogger.log("25 Revisions reached. Hence, Clearing No Markup related logs..."));var i="\n"+(new Date).toLocaleString()+"->"+e+"| DocId ="+Utils.getDocumentId()+" Doc Len ="+editor.doc.getDocumentLength()+"|CUR:"+t.VERSION+"."+t.REVISION,n=editor.doc.getSelection();n&&(i+="|Selection: "+n.toIntervals().join("|")),s+=i},g=function(){HiddenRangesHandler.addTcHiddenRangesOps(editor.doc.getTrackChangeDetails().getHiddenRangeOps())},f=function(){var t,i,n,r,s,l,d,c=editor.doc,u=o.getNoMarkupOPs(c.getContent(),c.getFormats()),p=u.dsNodesRanges,g=u.insNodesRanges,f=c.getFormats(),E=new e;for(t=0,i=p.length;t<i;t++)p[t].end++;for(t=0,i=g.length;t<i;t++)n=g[t],r=f[n.start],s={},s.type=r.type,l=Utils.randomString(),d=[],d.push({r:n.start}),d.push({as:{start:s,id:l}}),d.push({r:n.end+1-n.start}),d.push({as:{end:ZWJSONUtils.getKeys(s),id:l}}),E.applyOp(e.build(d));return E.applyTo(),HiddenRangesHandler.hideRanges("tc",p),void(a=!1);var u,E},E=function(e){try{var t=e;return HiddenRangesHandler.processClientToServerOp(t,n.TC);var i}catch(e){ZWLogger.log("Exception occurred while processing OPs from client to server in Tc_No_Markup mode"),ZWLogger.log("Exception: "+(e.stack||e)),ZWLogger.log("Tc No Markup OPs: "+r.toProtoString()),ZWLogger.log("Ops from client to Server: "+t.toProtoString());var o=new Error(ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR);throw editor.lastError=o,o}return ZWLogger.log("Tc No Markup client OPs after transform "+i.toProtoString()),p("Tc No Markup client OPs after transform "+i.toProtoString()),i},T=function(e){try{return HiddenRangesHandler.processClientToServerCursorOp(e);var t,i}catch(e){ZWLogger.log("Exception occurred while XForm the Cursor OP from Client to Server with Tc_No_Markup OPs"),ZWLogger.log("Tc No Markup OPs: "+r.toProtoString()),ZWLogger.log("Cursor OP : "+i.toProtoString()),ZWLogger.log("Exception: "+(e.stack||e));var n=new Error(ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR);throw editor.lastError=n,n}return JSON.stringify(t)},m=function(e,t){try{return HiddenRangesHandler.processServerToClientCursorOp(e,t);var i}catch(e){ZWLogger.log("Exception occurred while XForm the Cursor OP from Server to Client with Tc_No_Markup OPs"),ZWLogger.log("Tc No Markup OPs: "+r.toProtoString()),ZWLogger.log("Cursor OP : "+i.toProtoString()),ZWLogger.log("Exception: "+(e.stack||e));var n=new Error(ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR);throw editor.lastError=n,n}return{start:e,end:t}},h=function(e){for(var t=e.docOps,i=0,n=0,o=t.length;n<o;n++){var r=t[n];r.isInsert()&&(i+=r.length())}return i},I=function(e){for(var t=e.docOps,i="",n=0,o=t.length;n<o;n++){var r=t[n];r.isInsert()&&(i+=r.characters)}return i},_=function(t,i){var n=t.getContentStyleOp();n=n.length()>0?n.docOps:[];var o=e.build([]),r=e.build([]);contentIndex=0;for(var a=0,s=n.length;a<s;a++){var l=n[a];if(l.isAnnotation())o.push(l),r.push(l);else if(l.isInsert()){var d=l.length();if(contentIndex+d<=i)o.push(l);else if(contentIndex>=i)r.push(l);else{var c=l.characters,u=i-contentIndex,p=c.substr(0,u),g=c.substr(u),f=new DocOp;f.newCharacters(p);var E=new DocOp;E.newCharacters(g),o.push(f),r.push(E)}contentIndex+=d}}return o=e.concise(o),r=e.concise(r),{inclusiveCutop:o,exclusiveCutop:r}},A=function(e){try{var t=e;return HiddenRangesHandler.processServerToClientOp(e,n.TC)}catch(e){ZWLogger.log("Exception occurred while processing OPs from server to client in Tc_No_Markup mode"),ZWLogger.log("Tc No Markup OPs: "+r.toProtoString()),ZWLogger.log("Ops from server to client : "+t.toProtoString()),ZWLogger.log("Exception: "+(e.stack||e));var i=new Error(ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR);throw editor.lastError=i,i}return ZWLogger.log("Tc No Markup server OPs after transform "+e.toProtoString()),p("Tc No Markup server OPs after transform "+e.toProtoString()),e},S=function(){var e=editor.doc.getTrackChangeDetails().getDisplayMode();e===n.NO_MARKUP_VIEW&&l()},R=function(e){var t=editor.doc.getTrackChangeDetails();if(t.getDisplayMode()===n.NO_MARKUP_VIEW){if(e&&e.errorNo&&(e.errorNo===ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR||e.errorNo===ZWCollaboration.HIDDEN_RANGE_OPS_PROCESSING_ERROR))return;var i=ZWCollaboration.TC_NO_MARKUP_CLIENT_ERROR,o=ZWLogger.shrinkOperationSequence(ZWCollaboration.operationSequence).join(",");s=HiddenRangesHandler.getLog(),ZWLogger.sendErrorDetails(i+" <ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+s+"\n Err No ="+i+" DOC len ="+editor.doc.getDocumentLength()+" Cur St ="+editor.doc.getSelection().getStart()+" Cur end="+editor.doc.getSelection().getEnd()+" MsgQueue = "+ZWCollaboration.msgQueue.toProtoString()+" FULL DOC OP IDS :: "+ZWCollaboration.docOpIds+" buildLabel::: "+buildLabel+"\nOperation Sequence: \n"+o+"\nError Log End \n<ZWERROR>"+ZWCollaboration.mailInfo,null,i)}};(function(){t.subscribe("Document/EditorReady",g),t.subscribe("Document/Error",R),t.subscribe("Document/Error",S)})();return{setup:f,reset:l,getRangeOPs:c,setRangeOPs:d,hasTcHiddenRange:u,processClientToServerOp:E,processClientToServerCursorOp:T,processServerToClientCursorOp:m,processServerToClientOp:A,cutContentStyleOp:_,getContentStyleOpLength:h,getContentStyleOpChars:I}}(DocOpBuilder,PubSub,TcManager,TCConstants,TcUtil),ZDateField=function(){var e=function(){var e,t,i,n,o=[AUTOFIELD_TYPE.AUTO_DATE,AUTOFIELD_TYPE.CREATED_DATE,AUTOFIELD_TYPE.LAST_MODIFIED_DATE],r={POPUP:"fieldvc-menu-parent",DATEFIELD_EDIT:"datefield_edit_vc",FIELD_SMT_TOOLBAR:"fieldvc-menu-show-smtlbr"},a=function(){e&&DateFieldDlg.openPopup(e)},s=function(){i=J("#"+r.DATEFIELD_EDIT),n=J("#"+r.FIELD_SMT_TOOLBAR),t=J("#"+r.POPUP),n.hide(),i.show(),i.click(a)},l=function(){t&&i&&n&&(n.show(),i.hide(),i.click(""),t.hide()),t=null,i=null,n=null},d=function(){editor.getView()&&editor.getView()!==EDITOR_VIEWS.EDITOR||editor.isVersionView()||editor.isOfflineMode||editor.isFinalDocument()||LayoutManager.isFullscreen()||(e=ZDateField.getDateField(),editor.doc.getSelection().selectionType==SEL_MOUSE&&e&&o.contains(e.getAutoFieldType())&&!Lock.isIdxInLockArea(e.getStart().start,editorProps.userInfo.zuid)&&UIUtils.showFieldVisualCue(s))},c=function(){e&&(e=null,l())};return{init:d,destroy:c}}();PubSub.subscribeOnce("Cursor/Collapsed",function(){editor.doc.getSelection().bind(NODE_TYPE.AUTOFIELD,{onSelect:e.init,onDeselect:e.destroy})});var t=function(e){var t;"undefined"!=typeof e?(t=editor.getDocument().createRange(),t.start=e):t=editor.getDocument().getSelection().getRangeAt(0);var i=t.getStartNode(),n=i.type===NODE_TYPE.FIELD_START&&i.getField(),o=n&&n.type==NODE_TYPE.AUTOFIELD&&n.getAutoFieldType();return o!==AUTOFIELD_TYPE.AUTO_DATE&&o!==DATE_TYPE.CREATED&&o!==DATE_TYPE.LAST_MODIFIED&&o!==DATE_TYPE.CURRENT||ZWJSONUtils.isEmptyObject(n.getDateInfo())?null:i.getField()},i=function(e){var t=editor.getDocument(),i=t.getSelection().getRangeAt(0),n=t.createAutoField(FIELD_TYPE.AUTO_DATE),o={};o[ATTR_AUTOFIELD.ISAUTO]=e.isauto,o[ATTR_AUTOFIELD.DATEFMT]="",o[ATTR_AUTOFIELD.DATEINFO]=e.dateInfo,void 0!=e.label&&(o[ATTR_AUTOFIELD.LABEL]=e.label),e.date&&"Number"==e.date.constructor.name&&(o[ATTR_AUTOFIELD.VALUE]=e.date),o[ATTR_AUTOFIELD.FIELDTYPE]=e.type,n.setFieldFormat(o),i.insertField(n),t.sync(),EditorUtil.focusMultiByteSpan()},n=function(e,i){var n=t(i);if(null!=n){var o=(editor.getDocument(),{});void 0!=e.isauto&&(o[ATTR_AUTOFIELD.ISAUTO]=e.isauto),o[ATTR_AUTOFIELD.DATEFMT]="",o[ATTR_AUTOFIELD.DATEINFO]=e.dateInfo,void 0!=e.label&&(o[ATTR_AUTOFIELD.LABEL]=e.label),e.date&&"Number"==e.date.constructor.name&&(o[ATTR_AUTOFIELD.VALUE]=e.date),o[ATTR_AUTOFIELD.FIELDTYPE]=e.type,n.setFieldFormat(o)}},o=function(e,t,n,o,r){if(e||(e=(new Date).getTime()),t||(t=ZWDateTime.getDateInfo()),n||(n=AUTOFIELD_TYPE.AUTO_DATE),o="undefined"!=typeof o?o:1,r){var a=ZDateField.getDateFieldsWithLabel(r,!1);if(a.length&&a[0].getValue()!=e)return}i({date:e,dateInfo:t,type:n,isauto:o,label:r})},r=function(e){[AUTOFIELD_TYPE.AUTO_DATE,AUTOFIELD_TYPE.CREATED_DATE,AUTOFIELD_TYPE.LAST_MODIFIED_DATE].contains(e.getAutoFieldType())&&o(e.getValue(),ZWJSONUtils.clone(e.getDateInfo()),e.getAutoFieldType(),e.isAutoUpdate()?1:0,e.label)},a=function(){var e=ZWDateTime.getDateInfo();e.output.format="hh mm",o(null,e)},s=function(){o(null,null,null,0)},l=function(e,t){o(editor.doc.docInfo.LAST_MODIFIED_TIME_LONG,e,DATE_TYPE.LAST_MODIFIED,1,t)},d=function(e,t){o(editor.doc.docInfo.CREATED_DATE_LONG,e,DATE_TYPE.CREATED,0,t)},c=function(e,i,o,r,a,s){e||(e=(new Date).getTime()),i||(i=ZWDateTime.getDateInfo()),o||(o=AUTOFIELD_TYPE.AUTO_DATE),r="undefined"!=typeof r?r:1;var l=t(s),d=l.label;if(d)for(var c=u(d,!0),p=c.length-1;p>=0;p--)n({date:e,dateInfo:i,type:o,isauto:r,label:a},c[p].getStart().start);else n({date:e,dateInfo:i,type:o,isauto:r,label:a},s);editor.getDocument().sync(),EditorUtil.focusMultiByteSpan(),J(editor.clientActiveSection).find('div.field_text_node[data-fieldinfo="'+l.id+'"]').parent().addClass("ui-auto-date-selected")},u=function(e,t){var i=p(t);return i.filter(function(t){if(t.label==e)return!0})},p=function(e){var t=[],i=[],n=editor.getDocument();return n.visitAllFields("autofield",function(n){n.type==NODE_TYPE.AUTOFIELD&&[AUTOFIELD_TYPE.AUTO_DATE,AUTOFIELD_TYPE.CREATED_DATE,AUTOFIELD_TYPE.LAST_MODIFIED_DATE].includes(n.getAutoFieldType())&&n.label&&(i.contains(n.label)&&!e||(t.push(n),i.push(n.label)))}),t};return{getDateField:t,insertDate:o,insertCurrentDate:s,insertCurrentTime:a,insertCreatedDate:d,insertLastModDate:l,insertDateFieldFromField:r,updateDate:c,getDateFieldsWithLabel:u,getAllDateFieldsWithLabel:p}}();DateFormatDlg=function(){var e,t,i,n,o,r,a,s,l,d,c,u,p,g,f={},E={},T=null,m=!1,h={INPUT:"input",OUTPUT:"output",CUSTOM:"custom",DEFAULT_LOCALE:"en-US",DEFAULT_TIMEZONE:"America/Los_Angeles",DEFAULT_FORMAT:"DD MM YYYY",DEFAULT_PREVIEW_FORMAT:"DD MM YYYY",PREVIEW_DATE:"03/28/1996"},I={INPUT_LOCALE:"date_input_locale",INPUT_TIMEZONE:"date_input_timezone",INPUT_FORMAT:"date_input_format",INPUT_CUSTOM_FORMAT:"custom_input_date_format",CUSTOM_FORMAT_DIV:"date-custom-format-div",INPUT_FORMAT_PREVIEW:"date_input_format_preview",OUTPUT_LOCALE:"date_output_locale",OUTPUT_TIMEZONE:"date_output_timezone",OUTPUT_FORMAT:"date_output_format",OUTPUT_CUSTOM_FORMAT:"custom_ouput_date_format",OUTPUT_FORMAT_PREVIEW:"date_output_format_preview",TOOLTIP_MONTH_SHORT:"tooltip_month_short",TOOLTIP_MONTH_LONG:"tooltip_month_long",DATE_FORMAT_SAME:"date-format-same",SAVE_BTN:"date-config-save"},_={INPUT_LOCALE:"input_locale",INPUT_TIMEZONE:"input_timezone",INPUT_FORMAT:"input_format",CUSTOM_INPUT_FORMAT:"custom_input_format",OUTPUT_LOCALE:"output_locale",OUTPUT_TIMEZONE:"output_timezone",OUTPUT_FORMAT:"output_format",CUSTOM_OUTPUT_FORMAT:"custom_output_format",DATE_FORMAT_SAME:"date_format_same"},A=function(){DateUtil.isValidDateInfo(E)?c.addClass("ui-hide"):c.removeClass("ui-hide")},S=function(e,t){e.zcombobox("setAttribute","className","ui-validation-error ui-fl-width"),e.on("zcomboboxchange",function(){e.zcombobox("setAttribute","className","ui-fl-width"),t.zselectbox("setAttribute","className","ui-fl-width"),A()})},R=function(e,t){t?(e.addClass("ui-validation-error"),e.off("focus").on("focus",function(){e.removeClass("ui-validation-error"),A()})):(e.zselectbox("setAttribute","className","ui-validation-error ui-fl-width"),e.on("zselectboxchange",function(){e.zselectbox("setAttribute","className","ui-fl-width"),A()}))},O=function(){e.zcombobox("setAttribute","className","ui-fl-width"),t.zselectbox("setAttribute","className","ui-fl-width"),i.zselectbox("setAttribute","className","ui-fl-width"),n.removeClass("ui-validation-error"),r.zcombobox("setAttribute","className","ui-fl-width"),a.zselectbox("setAttribute","className","ui-fl-width"),s.zselectbox("setAttribute","className","ui-fl-width"),l.removeClass("ui-validation-error"),c.addClass("ui-hide")},b={init:function(){v(),e=D(I.INPUT_LOCALE),t=D(I.INPUT_TIMEZONE),i=D(I.INPUT_FORMAT),n=D(I.INPUT_CUSTOM_FORMAT),o=D(I.INPUT_FORMAT_PREVIEW),r=D(I.OUTPUT_LOCALE),a=D(I.OUTPUT_TIMEZONE),s=D(I.OUTPUT_FORMAT),l=D(I.OUTPUT_CUSTOM_FORMAT),d=D(I.OUTPUT_FORMAT_PREVIEW),u=D(I.TOOLTIP_MONTH_SHORT),p=D(I.TOOLTIP_MONTH_LONG),jFormatSame=D(I.DATE_FORMAT_SAME),g=D(I.SAVE_BTN),c=J("#date-config-error-div"),g.off("click").on("click",function(){if(DateUtil.isValidDateInfo(E))T&&T(E),q();else{var o=E.input,d=E.output;c.removeClass("ui-hide"),!o.locale&&S(e,t),!o.timezone&&R(t),!o.format&&R(i),"custom"==o.format&&!o.custom_format&&R(n,!0),!d.locale&&S(r,a),!d.timezone&&R(a),!d.format&&R(s),"custom"==d.format&&!d.custom_format&&R(l,!0)}}),E||(E={}),E.input||(E.input={}),E.output||(E.output={}),f=f||{},f.input=f.input||{},f.input.locale=f.input.locale||"",f.input.timezone=f.input.timezone||"",f.input.format=f.input.format||"",f.input.custom_format=f.input.custom_format||"",f.output=f.output||{},f.output.locale=f.output.locale||"",f.output.timezone=f.output.timezone||"",f.output.format=f.output.format||"",f.output.custom_format=f.output.custom_format||"",E=E||{},E.input=E.input||{},E.input.locale=E.input.locale||"",E.input.timezone=E.input.timezone||"",E.input.format=E.input.format||"",E.input.custom_format=E.input.custom_format||"",E.output=E.output||{},E.output.locale=E.output.locale||"",E.output.timezone=E.output.timezone||"",E.output.format=E.output.format||"",E.output.custom_format=E.output.custom_format||"",f.sameFormatCheckbox=m=!1,x()},get:function(e,i){var o;return e.action==_.INPUT_LOCALE?(o=E.input.locale,o&&G(),o&&B(t,E.input.locale),o&&H(h.INPUT)):e.action==_.INPUT_TIMEZONE?o=E.input.timezone:e.action==_.INPUT_FORMAT?(o=E.input.format,o==h.CUSTOM?(w(h.INPUT,E.input.custom_format),n.show(),m&&z(!1),X()):(E.input.custom_format&&(E.input.custom_format=""),w(h.INPUT,E.input.custom_format),n.hide(),j())):e.action==_.CUSTOM_INPUT_FORMAT?o=E.input.custom_format:e.action==_.OUTPUT_LOCALE?(o=E.output.locale,o&&B(a,E.output.locale),o&&H(h.OUTPUT)):e.action==_.OUTPUT_TIMEZONE?o=E.output.timezone:e.action==_.OUTPUT_FORMAT?(o=E.output.format,o==h.CUSTOM?(w(h.OUTPUT,E.output.custom_format),l.show()):(E.output.custom_format&&(E.output.custom_format=""),w(h.OUTPUT,E.output.custom_format),l.hide())):e.action==_.CUSTOM_OUTPUT_FORMAT?o=E.output.custom_format:e.action==_.DATE_FORMAT_SAME&&(o=m,z(o)),[_.INPUT_LOCALE,_.INPUT_TIMEZONE,_.INPUT_FORMAT,_.CUSTOM_INPUT_FORMAT].contains(e.action)?W():Y(),o},set:function(e,i,o){if(e.action==_.INPUT_LOCALE){E.input.locale=i,G(),B(t,E.input.locale);var r=DocLocaleHandler.getLanguageDetails(i),s=r&&r.timezones;s&&s.length&&(E.input.timezone=s[0]),F(h.INPUT,E.input.timezone),H(h.INPUT),M(h.INPUT,E.input.format)}else if(e.action==_.INPUT_TIMEZONE)E.input.timezone=i,H(h.INPUT),M(h.INPUT,E.input.format);else if(e.action==_.INPUT_FORMAT)i==h.CUSTOM?(w(h.INPUT,E.input.custom_format),n.show(),n.focus(),m&&z(!1),X()):(E.input.custom_format&&(E.input.custom_format=""),w(h.INPUT,E.input.custom_format),n.hide(),j()),E.input.format=i;else if(e.action==_.CUSTOM_INPUT_FORMAT)E.input.format==h.CUSTOM?E.input.custom_format=i:E.input.custom_format="";else if(e.action==_.OUTPUT_LOCALE){E.output.locale=i,B(a,E.output.locale);var r=DocLocaleHandler.getLanguageDetails(i),s=r&&r.timezones;s&&s.length&&(E.output.timezone=s[0]),F(h.OUTPUT,E.output.timezone),H(h.OUTPUT),M(h.OUTPUT,E.output.format)}else e.action==_.OUTPUT_TIMEZONE?(E.output.timezone=i,H(h.OUTPUT),M(h.OUTPUT,E.output.format)):e.action==_.OUTPUT_FORMAT?(i==h.CUSTOM?(w(h.OUTPUT,E.output.custom_format),l.show(),l.focus()):(E.output.custom_format&&(E.output.custom_format=""),w(h.OUTPUT,E.output.custom_format),l.hide()),E.output.format=i):e.action==_.CUSTOM_OUTPUT_FORMAT?E.output.format==h.CUSTOM?E.output.custom_format=i:E.output.custom_format="":e.action==_.DATE_FORMAT_SAME&&z(i);[_.INPUT_LOCALE,_.INPUT_TIMEZONE,_.INPUT_FORMAT,_.CUSTOM_INPUT_FORMAT].contains(e.action)?(m&&z(m),W(),Y()):Y()}},v=function(){var e=DocLocaleHandler.getLanguage(),t=DocLocaleHandler.getLanguageDetails(e),i=t.timezones||[],n=i[0]||h.DEFAULT_TIMEZONE;h.DEFAULT_LOCALE=e,h.DEFAULT_TIMEZONE=n},D=function(e){return J("#"+e)},L=function(e,t,i){i||(i="en-US");var n,o;e==h.INPUT?(n=N(h.INPUT),o=P(h.INPUT)):(n=N(h.OUTPUT),o=P(h.OUTPUT));var r=new ZWDateTime(new Date,null,i,o);return r.customFormat(t)},N=function(t){var i="",n=t==h.INPUT?e:r;return i=n.val()||h.DEFAULT_LOCALE},P=function(e){var i="",n=e==h.INPUT?t:a;return i=n.val()||h.DEFAULT_TIMEZONE},C=function(e){var t="",o=e==h.INPUT?i:s;return t=o.val(),t==h.CUSTOM&&(t=e==h.INPUT?n.val():l.val()),t||(t=h.DEFAULT_FORMAT),t},y=function(t,i){var n=t==h.INPUT?e:r;n.zcombobox("setValue",i),!!i&&t==h.INPUT&&G()},F=function(e,i){var n=e==h.INPUT?t:a;n.zselectbox("setValue",i)},M=function(e,t){var o=e==h.INPUT?i:s;o.zselectbox("setValue",t);var r=e==h.INPUT?n:l;t==h.CUSTOM?r.show():r.hide()},w=function(e,t){e==h.INPUT?n.val(t):l.val(t)},U=function(e){jFormatSame.zstatebutton("checked",e)},x=function(){DomUtil.populateLocaleOptions(e),DomUtil.populateLocaleOptions(r)},B=function(e,t){DomUtil.populateTimezoneOptions(e,t)},H=function(e){var t=e==h.OUTPUT?s:i;DomUtil.populateFormatOptions(t,E,e,!0)},G=function(){var e=new ZWDateTime;e.setLocale(E.input.locale);var t=e.getDateObj();t.setMonth(11),e.setDateObj(t),u.text(e.getMonth("short")),p.text(e.getMonth("long"))},k=function(e,t,i,n,o){var r=new ZWDateTime(new Date);return r.setLocale(e),r.setTimezone(t),r.format(o,i,n)},W=function(){var e="";e=E.input.format==h.CUSTOM?L(h.INPUT,C(h.INPUT),N(h.INPUT)):k(N(h.INPUT),P(h.INPUT),N(h.INPUT),P(h.INPUT),C(h.INPUT))||"-",o.text(e)},Y=function(){var e="";e=E.output.format==h.CUSTOM?L(h.OUTPUT,C(h.OUTPUT),N(h.OUTPUT)):k(N(h.INPUT),P(h.INPUT),N(h.OUTPUT),P(h.OUTPUT),C(h.OUTPUT))||"-",d.text(e)},z=function(e){if(m!=e){m=e;var t=!1;m?(E.output.locale!=E.input.locale?E.output.locale=E.input.locale:t=!0,E.input.format==h.CUSTOM?(E.output.custom_format=E.input.custom_format,l.show()):E.output.format==h.CUSTOM&&(E.output.custom_format="",l.hide()),E.output.format=E.input.format,E.output.timezone=E.input.timezone,V()):(E.output.locale=f.output.locale,E.output.timezone=f.output.timezone,E.output.format=f.output.format,E.output.custom_format=f.output.custom_format,Z()),t||(y(h.OUTPUT,E.output.locale),B(a,E.output.locale),H(h.OUTPUT)),F(h.OUTPUT,E.output.timezone),M(h.OUTPUT,E.output.format),E.output.format==h.CUSTOM&&w(h.OUTPUT,E.output.custom_format),U(m),A()}},Z=function(){r.enable(),s.enable(),a.enable()},V=function(){r.disable(),s.disable(),a.disable()},j=function(){jFormatSame.enable()},X=function(){jFormatSame.disable()},K=function(e){e||(e={}),e.callback&&(T=e.callback,delete e.callback),f=JSON.parse(JSON.stringify(e)),E=JSON.parse(JSON.stringify(e)),J.dialogutil.open("dateformatdialog",null,b)},q=function(){J.dialogutil.close("dateformatdialog")},Q=function(){E.input.locale=f.input.locale,E.input.timezone=f.input.timezone,E.input.format=f.input.format,E.input.custom_format=f.input.custom_format,E.output.locale=f.output.locale,E.output.timezone=f.output.timezone,E.output.format=f.output.format,E.output.custom_format=f.output.custom_format,m=f.sameFormatCheckbox,y(h.INPUT,E.input.locale),y(h.OUTPUT,E.output.locale),B(t,E.input.locale),B(a,E.output.locale),F(h.INPUT,E.input.timezone),F(h.OUTPUT,E.output.timezone),H(h.INPUT),H(h.OUTPUT),M(h.INPUT,E.input.format),M(h.OUTPUT,E.output.format),E.input.format==h.CUSTOM?w(h.INPUT,E.input.custom_format):w(h.INPUT,""),E.output.format==h.CUSTOM?(l.show(),w(h.OUTPUT,E.output.custom_format)):(l.hide(),w(h.OUTPUT,"")),U(m),m?V():Z(),W(),Y(),O()};return{openPopup:K,closePopup:q,resetPopup:Q}}(),DateFieldDlg=function(){var e,t,i,n,o,r,a,s,l,d,c,u,p,g,f,E,T,m,h,I,_,A,S,R,O,b,v,D=!1,L=!1,N=!1,P={DATE_TODAY:"Today's Date",DATE_TODAY_DYNAMIC:"Dynamic Today's Date",DATE_CREATED:"Date Created",DATE_MODIFIED:"Date Last Edited"},C={POPUP:"datefield-popup-container",POPUP_PRIMARY_BTN:"date_field_dlg_primary_btn",POPUP_NOTIFICATION:"datefield-popup-notify-container",FIELDNAME:"datefield-field-label",FIELDVALUE:"datefield-field-value",TOOLTIP_OUTPUT_INFO:"datefield-dateinfo-tooltip",LOCALE_OPTIONS_TOGGLER:"datefield-locale-options-toggler",OUTPUT_INFO_CONTAINER:"datefield_output_info",OUTPUT_LOCALE:"datefield_output_locale",OUTPUT_FORMAT:"datefield_output_format",OUTPUT_CUSTOM_FORMAT:"datefield_custom_format",OUTPUT_TIMEZONE:"datefield_output_timezone",ADJUSTMENT_MODE_NAME:"datefield_mode",ADJUST_DAYS:"datefield_adjust_days",ADJUST_MONTHS:"datefield_adjust_months",ADJUST_YEARS:"datefield_adjust_years",ADJUST_HOURS:"datefield_adjust_hours",ADJUST_MINUTES:"datefield_adjust_minutes",ADJUST_EXCLUDE:"datefield_adjust_exclude",ADJUST_EXCLUDE_VALUE:"datefield_adjust_filter_value",DATE_MENU:"insert-date-menu1",MENU_CURRENT_DATE:"datefielddlg_menu_current_date_label",MENU_DYNAMIC_DATE:"datefielddlg_menu_dynamic_date_label",MENU_CREATED_DATE:"datefielddlg_menu_created_date_label",MENU_MODIFIED_DATE:"datefielddlg_menu_modified_date_label",DATE_PICKER:"datefield-DatePicker",DATE_PICKER_PREVIEW:"datefielddlg_menu_picker_date_label",DATE_PICKER_CONTAINER:"datefield_body_datepicker-container",FIELDNAME_NOTIFICATION_CONTAINER:"datefielddlg_notification_container"},y={FIELD_LABEL:"field-label",FIELD_VALUE:"field-value",OUTPUT_LOCALE:"output_locale",OUTPUT_FORMAT:"output_format",CUSTOM_OUTPUT_FORMAT:"custom_output_format",OUTPUT_TIMEZONE:"output_timezone",ADJUSTMENT_MODE:"date_adjust_mode",ADJUST_DAYS:"date_adjust_days",ADJUST_MONTHS:"date_adjust_months",ADJUST_YEARS:"date_adjust_years",ADJUST_HOURS:"date_adjust_hours",ADJUST_MINUTES:"date_adjust_minutes",ADJUST_EXCLUDE:"datefield_adjust_filter_exclude",ADJUST_EXCLUDE_VALUE:"date_adjust_filter_value"},F=["#datefielddlg-date-created","#datefielddlg-date-modified"],M={init:function(){a=U(C.POPUP),d=U(C.FIELDNAME),c=U(C.FIELDVALUE),u=U(C.OUTPUT_LOCALE),g=U(C.OUTPUT_FORMAT),f=U(C.OUTPUT_CUSTOM_FORMAT),p=U(C.OUTPUT_TIMEZONE),E=U(C.TOOLTIP_OUTPUT_INFO),s=U(C.LOCALE_OPTIONS_TOGGLER),l=U(C.OUTPUT_INFO_CONTAINER),T=a.find("input:radio[name="+C.ADJUSTMENT_MODE_NAME+"]"),m=U(C.ADJUST_DAYS),h=U(C.ADJUST_MONTHS),I=U(C.ADJUST_YEARS),_=U(C.ADJUST_HOURS),A=U(C.ADJUST_MINUTES),S=U(C.ADJUST_EXCLUDE),R=U(C.ADJUST_EXCLUDE_VALUE),O=U(C.DATE_PICKER),v=U(C.FIELDNAME_NOTIFICATION_CONTAINER),b=U(C.DATE_PICKER_CONTAINER),0==b.length&&(b=J("<div>").attr({id:"datefield_body_datepicker-container",style:"display: none"}).appendTo("body")),w(),c.disable(),r=o.dateInfo,DomUtil.populateLocaleOptions(u),DomUtil.populateTimezoneOptions(p,r.output.locale),DomUtil.populateFormatOptions(g,r,null,!0),x(r)},get:function(e,t){var i;switch(e.action){case y.FIELD_LABEL:i=o.fieldName;break;case y.FIELD_VALUE:if("Number"==o.fieldValue.constructor.name){var n=new ZWDateTime(o.fieldValue,"",r.input.locale,r.input.timezone);i=n.format(r.input.format,r.input.locale,r.input.timezone)}else i=o.fieldValue;break;case y.OUTPUT_LOCALE:i=r.output.locale;break;case y.OUTPUT_FORMAT:i=r.output.format,"custom"==i?(f.show(),f.val(r.output.custom_format)):(f.hide(),f.val(""));break;case y.CUSTOM_OUTPUT_FORMAT:i=r.output.custom_format;break;case y.OUTPUT_TIMEZONE:i=r.output.timezone;break;case y.ADJUSTMENT_MODE:i=r.adjustment.mode;break;case y.ADJUST_DAYS:i=r.adjustment.days;break;case y.ADJUST_MONTHS:i=r.adjustment.months;break;case y.ADJUST_YEARS:i=r.adjustment.years;break;case y.ADJUST_HOURS:i=r.adjustment.hours||0;break;case y.ADJUST_MINUTES:i=r.adjustment.minutes||0;break;case y.ADJUST_EXCLUDE:i=r.adjustment.filter.exclude,i?R.zselectbox("setAttribute","disabled",!1):R.zselectbox("setAttribute","disabled",!0);break;case y.ADJUST_EXCLUDE_VALUE:i=r.adjustment.filter.excludeValue}return i},set:function(e,t,i){switch(e.action){case y.FIELD_LABEL:D||(v.hide(),B(t)&&v.show()),o.fieldName=t;break;case y.FIELD_VALUE:o.fieldValue=t;break;case y.OUTPUT_LOCALE:r.output.locale=t,r.input.locale=t,DomUtil.populateTimezoneOptions(p,r.output.locale),DomUtil.populateFormatOptions(g,r,null,!0);var n=DocLocaleHandler.getLanguageDetails(t),a=n&&n.timezones;a&&a.length&&(r.output.timezone=a[0],r.input.timezone=a[0]),p.zselectbox("setValue",r.output.timezone),g.zselectbox("setValue",r.output.format),x(r);break;case y.OUTPUT_FORMAT:r.output.format=t,"custom"==t?(f.show(),f.val(r.output.custom_format)):(f.hide(),f.val(""),r.output.custom_format&&(r.output.custom_format="")),x(r);break;case y.CUSTOM_OUTPUT_FORMAT:"custom"!=r.output.format&&(t=""),r.output.custom_format=t,x(r);break;case y.OUTPUT_TIMEZONE:r.output.timezone=t,r.input.timezone=t,x(r);break;case y.ADJUSTMENT_MODE:r.adjustment.mode=i.value;break;case y.ADJUST_DAYS:r.adjustment.days=t;break;case y.ADJUST_MONTHS:r.adjustment.months=t;break;case y.ADJUST_YEARS:r.adjustment.years=t;break;case y.ADJUST_HOURS:r.adjustment.hours=t;break;case y.ADJUST_MINUTES:r.adjustment.minutes=t;break;case y.ADJUST_EXCLUDE:r.adjustment.filter.exclude=t,t?(R.zselectbox("setAttribute","disabled",!1),R.zselectbox("setValue","weekends"),r.adjustment.filter.excludeValue="weekends"):(R.zselectbox("setAttribute","disabled",!0),R.zselectbox("setValue",""),r.adjustment.filter.excludeValue="");break;case y.ADJUST_EXCLUDE_VALUE:r.adjustment.filter.excludeValue=t}}},w=function(){D?a.parent().zdialog("setButtonAttributes",C.POPUP_PRIMARY_BTN,"text",J.i18n("writer.common.UPDATE_ALL")):a.parent().zdialog("setButtonAttributes",C.POPUP_PRIMARY_BTN,"text",J.i18n("writer.common.CREATE_AND_INSERT"))},U=function(e){return J("#"+e)},x=function(e){var t=ZWDateTime.intlToNormalFormatConverter(e.output.format,e.output.locale,e.output.timezone),i=e.output.timezone+" - "+DocLocaleHandler.getLanguageDetails(e.output.locale).nativeLangName+" - "+("custom"==e.output.format?"Custom ("+e.output.custom_format+")":t);E.text(i)},B=function(e){var t=ZDateField.getDateFieldsWithLabel(e,!1);return!!t.length},H=function(){var t=a.zvalidation("validateAllFields",a);if(t&&(D||!o.fieldName||!B(o.fieldName))){"custom"==r.output.format&&""==r.output.custom_format&&(r.output.custom_format="DD MM YYYY"),"custom"!=r.output.format&&""!=r.output.custom_format&&(r.output.custom_format="");var i=D?ZDateField.updateDate:ZDateField.insertDate,n=D?e.getStart().start:-1;switch(o.fieldValue){case P.DATE_TODAY:i.call(null,null,r,AUTOFIELD_TYPE.AUTO_DATE,0,o.fieldName,n);break;case P.DATE_TODAY_DYNAMIC:i.call(null,null,r,AUTOFIELD_TYPE.AUTO_DATE,1,o.fieldName,n);break;case P.DATE_CREATED:i.call(null,editor.doc.docInfo.CREATED_DATE_LONG,r,DATE_TYPE.CREATED,0,o.fieldName,n);break;case P.DATE_MODIFIED:i.call(null,editor.doc.docInfo.LAST_MODIFIED_TIME_LONG,r,DATE_TYPE.LAST_MODIFIED,1,o.fieldName,n);break;default:i.call(null,o.fieldValue,r,AUTOFIELD_TYPE.AUTO_DATE,0,o.fieldName,n)}ee()}},G=function(){var e=ZWDateTime.getDateInfo(),t=e.input||{},i=e.output||{},n=(t[MAILMERGE.DATE_FORMAT],t[MAILMERGE.DATE_LOCALE]),o=t[MAILMERGE.DATE_TIMEZONE],r=i[MAILMERGE.DATE_FORMAT],a=i[MAILMERGE.DATE_LOCALE],s=i[MAILMERGE.DATE_TIMEZONE],l=new ZWDateTime(new Date,"",n,o),d=l.format(r,a,s),c=new ZWDateTime(new Date(editor.doc.docInfo.CREATED_DATE_LONG),"",n,o),u=c.format(r,a,s),p=new ZWDateTime(new Date(editor.doc.docInfo.LAST_MODIFIED_TIME_LONG),"",n,o),g=p.format(r,a,s);U(C.MENU_CURRENT_DATE).text("("+d+")"),U(C.MENU_DYNAMIC_DATE).text("("+d+")"),U(C.MENU_CREATED_DATE).text("("+u+")"),U(C.MENU_MODIFIED_DATE).text("("+g+")"),U(C.DATE_PICKER_PREVIEW).text("("+d+")"),U(C.DATE_MENU).zmenu("setMenuItemsAttribute",F,"hidden",Macros.isRemote()),b.show()},k=function(){O.zdatetimepicker("close"),b.hide()},W=function(e){var t;switch(e){case"current":t=P.DATE_TODAY;break;case"dynamic":t=P.DATE_TODAY_DYNAMIC;break;case"created":t=P.DATE_CREATED;break;case"modified":t=P.DATE_MODIFIED}Y(t)},Y=function(e){o.fieldValue=e;var t;"Number"==e.constructor.name?(t=new ZWDateTime(e,"",r.input.locale,r.input.timezone),e=t.format(r.input.format,r.input.locale,r.input.timezone)):e.dateString&&e.dateCustomFormatter&&(t=new ZWDateTime(e.dateString,e.dateCustomFormatter,r.input.locale,r.input.timezone,!0),e=t.format(r.input.format,r.input.locale,r.input.timezone),o.fieldValue=t.getDateObj().getTime()),c.val(e)},z=function(e){return"custom"==e||e.indexOf("h")!=-1||e.indexOf("m")!=-1||e.indexOf("s")!=-1||e.indexOf("E")!=-1||e.indexOf("z")!=-1},Z=function(){var e,t,i,n,o=new ZWDateTime(new Date);return e=r.input.locale,i=r.input.timezone,t=r.input.format,z(t)&&(t="DD-MM-YYYY"),n=o.format(t,e,i)},V=function(){var e,t,i;e=r.input.locale,i=r.input.timezone,t=r.input.format,z(t)&&(t="DD-MM-YYYY");var n=new ZWDateTime(new Date);return t=n.getLocaleFormattedFormat(t,e,i),t=t.replaceAll("D","d"),t=t.replaceAll("Y","y"),t=t.replaceAll("h","H")},j=function(){t=V(),i=Z()},X=function(){j(),N=!1,L?O.zdatetimepicker("setAttributes",{format:t,value:i}):(O.zdatetimepicker({type:"inline",title:"Pick a Date",changeMonth:!0,changeYear:!0,format:t,value:i,dateselect:function(e,t){N=!0;var i="DD-MM-YYYY",n=new ZWDateTime(t.value).customFormat(i);Y({dateString:n,dateCustomFormatter:i})}}),L=!0),O.zdatetimepicker("open")},K=function(){return!!N&&void O.zdatetimepicker("close")},q=function(){l.hasClass("ui-hide")?(l.removeClass("ui-hide"),s.addClass("ui-locale-settings-expanded")):(l.addClass("ui-hide"),s.removeClass("ui-locale-settings-expanded"))},Q=function(){o=ZWJSONUtils.clone(n),r=o.dateInfo,d.val(o.fieldName);var e;if("Number"==o.fieldValue.constructor.name){var t=new ZWDateTime(o.fieldValue,"",r.input.locale,r.input.timezone);e=t.format(r.input.format,r.input.locale,r.input.timezone)}else e=o.fieldValue;c.val(e),x(r),DomUtil.populateTimezoneOptions(p,r.output.locale),DomUtil.populateFormatOptions(g,r,null,!0),u.zcombobox("setValue",r.output.locale),g.zselectbox("setValue",r.output.format),"custom"==r.output.format?(f.show(),f.val(r.output.custom_format)):(f.hide(),f.val("")),p.zselectbox("setValue",r.output.timezone),T.val([r.adjustment.mode]),m.znumberfield("setValue",r.adjustment.days),h.znumberfield("setValue",r.adjustment.months),I.znumberfield("setValue",r.adjustment.years),_.znumberfield("setValue",r.adjustment.hours||0),A.znumberfield("setValue",r.adjustment.minutes||0);var i=r.adjustment.filter.exclude;S.zstatebutton("checked",i),i?R.zselectbox("setAttribute","disabled",!1):R.zselectbox("setAttribute","disabled",!0),R.zselectbox("setValue",r.adjustment.filter.excludeValue)},$=function(t){var i,r={};if(t){switch(D=!0,e=t,i=ZWDateTime.getDateInfo(t.getDateInfo()),r.fieldName=t.label||"",t.getAutoFieldType()){case"createddate":r.fieldValue=P.DATE_CREATED;break;case"lastmodifieddate":r.fieldValue=P.DATE_MODIFIED;break;case"autodate":t.isAutoUpdate()?r.fieldValue=P.DATE_TODAY_DYNAMIC:r.fieldValue=t.getValue()}r.dateInfo=ZWJSONUtils.clone(i)}else D=!1,e=null,i=ZWDateTime.getDateInfo(),r.fieldName="",r.fieldValue="",r.dateInfo=i;n=r,o=ZWJSONUtils.clone(r),J.dialogutil.open("dateFieldDialog",null,M)},ee=function(){J.dialogutil.close("dateFieldDialog")};return{handleDateField:H,updateDateOptionsMenu:G,hideOptionsMenu:k,handleMenuClick:W,toggleOutputInfo:q,datePickerShow:X,datePickerHide:K,resetPopup:Q,openPopup:$,closePopup:ee}}(),TableInsertDlg=function(){},TableInsertDlg.noOfRows=3,TableInsertDlg.noOfColumns=3,TableInsertDlg.openTablePopup=function(){J.dialogutil.open("inserttabledialog",void 0,TableInsertDlg.info)},TableInsertDlg.info={get:function(e,t){return"COLUMNS"==e.action?TableInsertDlg.noOfColumns:"ROWS"==e.action?TableInsertDlg.noOfRows:void 0},set:function(e,t,i){"COLUMNS"==e.action?TableInsertDlg.noOfColumns=t:"ROWS"==e.action&&(TableInsertDlg.noOfRows=t)}},TableInsertDlg.insertTable=function(){editor.doc.execCmd("instable",[TableInsertDlg.noOfRows,TableInsertDlg.noOfColumns]),J.dialogutil.close("inserttabledialog")};var CustomRowDlg=function(e){"use strict";var t,i,n="customrowsdlg",o={ABOVE:"insertAbove",BELOW:"insertBelow",NO_OF_ROW:"noOfRows"},r={init:function(){t=1,i=o.ABOVE},set:function(e,n,r){var a=e.action;a==o.NO_OF_ROW?t=n:a!=o.ABOVE&&a!=o.BELOW||(i=a)},get:function(e){var n=e.action;return n==o.NO_OF_ROW?t:n==o.ABOVE||n==o.BELOW?n==i:void 0}},a=function(){i==o.ABOVE?editor.doc.execCmd("InsertSelectedRowsBefore",t):i==o.BELOW&&editor.doc.execCmd("InsertSelectedRowsAfter",t),l()},s=function(){J.dialogutil.open(n,void 0,r)},l=function(){J.dialogutil.close(n)};return{insertRows:a,openDialog:s}}(),CustomColumnDlg=function(e){"use strict";var t,i,n="customcolumnsdlg",o={LEFT:"insertLeft",RIGHT:"insertRight",NO_OF_COL:"noOfColumns"},r={init:function(){t=1,i=o.LEFT},set:function(e,n,r){var a=e.action;a==o.NO_OF_COL?t=n:a!=o.LEFT&&a!=o.RIGHT||(i=a)},get:function(e){var n=e.action;return n==o.NO_OF_COL?t:n==o.LEFT||n==o.RIGHT?n==i:void 0}},a=function(){i==o.LEFT?editor.doc.execCmd("InsertSelectedColumnBefore",t):i==o.RIGHT&&editor.doc.execCmd("InsertSelectedColumnAfter",t),l()},s=function(){J.dialogutil.open(n,void 0,r)},l=function(){J.dialogutil.close(n)};return{insertColumns:a,openDialog:s}}();!function(e,t,i){function n(){J("#searchdiv").children().remove(),J("#shortcutabs ul.menutabs li.ui-state-active").find("a").attr("href");var e=J("#shortcutabs ul.menutabs li.ui-state-active").find("a");$(e).bind("click",function(){var t=J(e).attr("href");J(t).css("display","block")})}function o(){return!1}function r(){var i=editor.browserInfo.is_mac?"alt":"ctrl";editor.getRole().permissions.can("document.edit")&&(editor.browserInfo.is_mac?(e.bind("ctrl+shift+up",t.moveParaUp),e.bind("ctrl+shift+down",t.moveParaDown),e.bind("ctrl+down",o),e.bind("ctrl+up",o),e.bind("ctrl+a",t.moveToParaStart),e.bind("ctrl+e",t.moveToParaEnd),e.bind("ctrl+d",function(){return editor.doc.execCmd("delete","nextchar"),!1}),e.bind("ctrl+h",function(){return editor.doc.execCmd("delete","prevchar"),!1}),e.bind("ctrl+f",t.moveLeft)):(e.bind("alt+shift+up",t.moveParaUp),e.bind("alt+shift+down",t.moveParaDown))),e.bind("left",t.moveLeft),e.bind(i+"+left",t.moveToPrevWordStart),e.bind("command+left",t.moveToLineStart),e.bind("shift+left",t.selectLeft),e.bind(i+"+shift+left",t.selectToPrevWordStart),e.bind("command+shift+left",t.selectToLineStart),e.bind("right",t.moveRight),e.bind(i+"+right",t.moveToCurrentWordEnd),e.bind("command+right",t.moveToLineEnd),e.bind("shift+right",t.selectRight),e.bind(i+"+shift+right",t.selectToCurrentWordEnd),e.bind("command+shift+right",t.selectToLineEnd),e.bind("down",t.moveDown),e.bind(i+"+down",t.moveToParaEnd),e.bind("command+down",t.moveToDocumentEnd),e.bind("shift+down",t.selectDown),e.bind(i+"+shift+down",t.selectToParaEnd),e.bind("command+shift+down",t.selectToDocumentEnd),e.bind("up",t.moveUp),e.bind(i+"+up",t.moveToParaStart),e.bind("command+up",t.moveToDocumentStart),e.bind("shift+up",t.selectUp),e.bind(i+"+shift+up",t.selectToParaStart),e.bind("command+shift+up",t.selectToDocumentStart),e.bind("pageup",t.moveToPrevPage),e.bind("shift+pageup",t.selectToPrevPage),e.bind("pagedown",t.moveToNextPage),e.bind("shift+pagedown",t.selectToNextPage),e.bind("home",t.moveToLineStart),e.bind(["ctrl+home","meta+home"],t.moveToDocumentStart),e.bind("shift+home",t.selectToLineStart),e.bind(["shift+ctrl+home","shift+meta+home"],t.selectToDocumentStart),e.bind("end",t.moveToLineEnd),e.bind(["ctrl+end","meta+end"],t.moveToDocumentEnd),e.bind("shift+end",t.selectToLineEnd),e.bind(["shift+ctrl+end","shift+meta+end"],t.selectToDocumentEnd),e.bind(["ctrl+alt+shift+j","meta+alt+shift+j"],t.moveToTableStart),e.bind(["ctrl+alt+shift+k","meta+alt+shift+k"],t.moveToTableEnd)}function a(){var i=editor.browserInfo.is_mac?"alt":"ctrl";editor.getRole().permissions.can("document.edit")&&(editor.browserInfo.is_mac?(e.unbind("ctrl+shift+up"),e.unbind("ctrl+shift+down"),e.unbind("ctrl+down"),e.unbind("ctrl+up"),e.unbind("ctrl+a",t.moveToParaStart),e.unbind("ctrl+e",t.moveToParaEnd),e.unbind("ctrl+d",function(){return editor.doc.execCmd("delete","nextchar"),!1}),e.unbind("ctrl+h",function(){return editor.doc.execCmd("delete","prevchar"),!1}),e.unbind("ctrl+f",t.moveLeft)):(e.unbind("alt+shift+up"),e.unbind("alt+shift+down"))),e.unbind("left"),e.unbind(i+"+left"),e.unbind("command+left"),e.unbind("shift+left"),e.unbind(i+"+shift+left"),e.unbind("command+shift+left"),e.unbind("right"),e.unbind(i+"+right"),e.unbind("command+right"),e.unbind("shift+right"),e.unbind(i+"+shift+right"),e.unbind("command+shift+right"),e.unbind("down"),e.unbind(i+"+down"),e.unbind("command+down"),e.unbind("shift+down"),e.unbind(i+"+shift+down"),e.unbind("command+shift+down"),e.unbind("up"),e.unbind(i+"+up"),e.unbind("command+up"),e.unbind("shift+up"),e.unbind(i+"+shift+up"),e.unbind("command+shift+up"),e.unbind("pageup"),e.unbind("shift+pageup"),e.unbind("pagedown"),e.unbind("shift+pagedown"),e.unbind("home"),e.unbind(["ctrl+home","meta+home"]),e.unbind("shift+home"),e.unbind(["shift+ctrl+home","shift+meta+home"]),e.unbind("end"),e.unbind(["ctrl+end","meta+end"]),e.unbind("shift+end"),e.unbind(["shift+ctrl+end","shift+meta+end"]),e.unbind(["ctrl+alt+shift+j","meta+alt+shift+j"]),e.unbind(["ctrl+alt+shift+k","meta+alt+shift+k"])}function s(){g||(e.init(document.getElementById("editorpane")),g=!0),Macros.isPDFDocument()||r(),e.bind(["alt+enter"],i.goToLink),e.bind(editor.browserInfo.is_mac?"shift+ctrl+command+f":"shift+ctrl+alt+f",function(){return J("#ui-focus-typing").ztoggleswitch("switch"),!1}),editor.browserInfo.is_mac?(e.bind("command+g",function(){return GoToDialogue.openGoToDialogue(),!1}),e.bind("command+shift+g",function(){return WordCountDlg.insertWCDlg(),!1})):(e.bind("ctrl+g",function(){return GoToDialogue.openGoToDialogue(),!1}),e.bind("ctrl+shift+g",function(){return WordCountDlg.insertWCDlg(),!1})),editor.browserInfo.is_mac?e.bind("command+a",function(){return editor.doc.getSelection().selectAll(),!1}):e.bind("ctrl+a",function(){return editor.doc.getSelection().selectAll(),!1}),editor.browserInfo.is_mac?(e.bind("command+alt+=",function(){return UIUtils.zoomIn(),!1}),e.bind("command+alt+-",function(){return UIUtils.zoomOut(),!1}),e.bind("command+alt+[",function(){return UIUtils.setZoomFactor("fitWidth"),!1})):(e.bind("ctrl+alt+=",function(){return UIUtils.zoomIn(),!1}),e.bind("ctrl+alt+[",function(){return UIUtils.setZoomFactor("fitWidth"),!1}),e.bind("ctrl+alt+-",function(){return UIUtils.zoomOut(),!1})),editor.getRole().permissions.can("document.edit")&&(e.bind("ctrl+space",o),editor.browserInfo.is_mac&&e.bind("command+shift+z",function(){return editor.doc.snapShotManager.getLastRedoOp()?(editor.doc.execCmd("redo"),!1):void editor.doc.applyLastAction()}),editor.browserInfo.is_mac?(e.bind("command+y",editor.doc.applyLastAction),e.bind("command+a",function(){return editor.doc.getSelection().selectAll(),!1})):(e.bind("ctrl+y",editor.doc.applyLastAction),e.bind("ctrl+a",function(){return editor.doc.getSelection().selectAll(),!1})),e.bind(["ctrl+shift+1","meta+shift+1"],function(){editor.doc.execCmd(["SetLineSpacing","1"])}),e.bind(["ctrl+shift+2","meta+shift+2"],function(){editor.doc.execCmd(["SetLineSpacing","2"])}),e.bind(["ctrl+shift+5","meta+shift+5"],function(){editor.doc.execCmd(["SetLineSpacing","1.5"])}),editor.browserInfo.is_mac?(e.bind("ctrl+shift+d",ZDateField.insertCurrentDate),e.bind("ctrl+shift+t",ZDateField.insertCurrentTime),e.bind("command+shift+space",EventHandler.insertNonbreakingSpace),e.bind("ctrl+alt+tab",function(){return TabKeyHandler.insertTab(),!1})):(e.bind("alt+shift+d",ZDateField.insertCurrentDate),e.bind("alt+shift+t",ZDateField.insertCurrentTime),e.bind("ctrl+shift+space",EventHandler.insertNonbreakingSpace)),e.bind(["ctrl+shift+f9","meta+shift+f9"],function(){editor.doc.execCmd("Unlink")}),AutoCorrect.addAutoCorrects())}function l(){var e=J("#shorcut_search").val().toLowerCase();if(""==e){J("#searchdiv").css("display","none");var t=J("#shortcutabs ul.menutabs li.ui-state-active").find("a").attr("href");J(t).css("display","block")}else J("#searchdiv").children().remove(),J(".ui-pop-content-div:visible").css("display","none"),J("#shortcutabs").find(".ui-key-short-label").each(function(){J(this).text().toLowerCase().indexOf(e)!=-1&&(J("#searchdiv").append(J(this).parent().clone(!0)),J("#searchdiv").css("display","block"))})}function d(){var e=document.createElement("div"),t=editorProps.deployment.writer;J(e).append('<div class="ui-kbsc-title"><b>'+t+" </b><span>Keyboard Shortcut Keys</span></div>");var i=document.createElement("div");J(e).append(i),J("#shortcutabs ul li").find("a").each(function(){var e=J(this).attr("href");if("searchdiv"!=e){var t=document.createElement("h5");J(t).text(J(this).text()),i.appendChild(t);var n=J(e).clone()[0];J(n).removeAttr("style"),i.appendChild(n)}});var n=document.createElement("style");n.type="text/css";var o=".ui-pop-content-div{border-top: 1px solid #000;height: auto;}";o+='.ui-pop-content-div:after{content:"";clear:both;display:block;}',o+=".ui-key-short-pTop{padding: 8px 0px;border-bottom: 1px dotted #ddd;width: 100%;}",o+=".ui-key-short-label{float: left;display:inline-block;width: 64%;}",o+=".ui-key-short-span {color: #666;display: inline-block;text-align: right;width:36%}",o+="h5 {font-size: 18px;margin: 20px 0px 5px 0px;}",o+=".ui-kbsc-title {font-size: 20px;margin: 10px 0px 0px 0px;}",o+=".ui-kbsc-title span {font-family: Lato-Light, open_sans_light, sans-serif;}}",o+=".ui-keyboardshortcut-note {font-style: italic;}",n.innerHTML=o,J(e).append(n);var r,a=document.getElementById("zw-shortcuts-print");if(!a){a=document.createElement("iframe"),a.id="zw-shortcuts-print",document.body.appendChild(a),r=a.contentWindow;var s=r.document;s.open(),s.write(e.innerHTML),s.close()}r=r||a.contentWindow,printFrameTimer=setInterval(function(){"complete"===a.contentWindow.document.readyState&&(r.document.body.style.overflow="auto",clearInterval(printFrameTimer),r.print())},0)}function c(){J.dialogutil.open("shortcut",void 0,E),ZWLogger.addToStatistics("KeyBrdDlg")}function u(e){e.keyCode==KEYS.ENTER&&l()}function p(e){e!==f&&(e?r():a()),f=e}var g=!1,f=!1,E={init:function(){for(var e=J("#shortcutabs li"),t=0;t<e.length;t++)e[t].addEventListener("click",n,!0)}};PubSub.subscribe("Document/EditPermissionChanged",s),this.KeyBoardShortCuts={init:s,searchShortCuts:l,keyDown:u,openKeyBoardShortcutDialog:c,printShortCuts:d,bindUnbindNavShortCuts:p}}(Mousetrap,NavUtil,Utils),WebUtil.saveDocumentCurrentVersions=function(e){var t={};t.sid=editor.uuid,t.tstamp=(new Date).getTime(),ZWNetworkUtils.setCsrfParam(t);var i=ZWNetworkUtils.getUrl("save");J.ajax({type:"POST",dataType:"json",global:!1,url:i,data:t,error:function(t){UIUtils.hideLoadingMsg(),"function"==typeof e&&e(t)},success:function(t){UIUtils.hideLoadingMsg(),"FAILED"==t.SAVE&&(editor.rebindEvents(ERROR_PERMISSION),PubSub.publish("Document/SaveStatus",!1,J.i18n("writer.common.SAVE_FAILURE")),PubSub.publish("Document/Error",{title:"OOPS",errorNo:ZWCollaboration.SERVER_EXCEPTION,errorMsg:"MSG_EDIT_ERROR"})),"function"==typeof e&&e(t)}})},WebUtil.notifyCollaborators=function(){var e=jsCdnZWStaticPath+fingerPrintObj["js/fcomponents_notifycollaborator.js"],t=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_notifycollaborator.css"],i=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_common.css"];zw.require({js:[e],css:[i,t]},[],function(){WebUtil.notifyCollabFilesLoadingCallback()})},WebUtil.notifyCollabFilesLoadingCallback=function(){ZWLogger.addToStatistics("Notify");var e={};e.product_type=docProps.productInfo.product_type,e.owner_id=docProps.productInfo.owner_id,e.fileId=editor.doc.docInfo.RID,NotifyCollaborator.open(e)},WebUtil.checkOutDocument=function(e,t){if(!t||t.fromui){J("#pausecollab").addClass("ui-pevents-none");var i={};i.rid=Utils.getDocumentId();var n=setTimeout(function(){UIUtils.showMessage("info",J.i18n("common","PAUSE_COLLABORATION_PROCESSING"),"showclose","normalfont")},1e3);J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getUrl("checkout"),data:i,dataType:"json",error:function(){clearTimeout(n),UIUtils.showMessage("error",J.i18n("common","UNABLE_TO_PROCESS_PAUSE_COLLABORATION"),"showclose","normalfont",5e3),J("#pausecollab").removeClass("ui-pevents-none"),J("#pausecollab").ztoggleswitch("switch")},success:function(e){if(clearTimeout(n),J("#pausecollab").removeClass("ui-pevents-none"),"SUCCESS"==e.RESPONSE){e&&e.VERSION&&e.REVISION&&(DocInfo.setProperty({VERSION:e.VERSION}),DocInfo.setProperty({REVISION:e.REVISION}));var t=e.ACTION;"CHECKEDIN"==t?(UIUtils.showMessage("info",J.i18n("common","CHECKIN_SUCCESS"),"showclose","normalfont",3e3),UIUtils.handleDocumentCheckIn(editor.zuid,editor.loginName)):"CHECKEDOUT"!=t&&"ALREADY_CHECKEDOUT"!=t||(UIUtils.showMessage("info",J.i18n("common","CHECKOUT_SUCCESS"),"showclose","normalfont",3e3),UIUtils.handleDocumentCheckOut(editor.zuid,editor.loginName,!1)),ZWLogger.addToStatistics("CheckOut")}else if("FAILED"==e.RESPONSE){J("#pausecollab").ztoggleswitch("switch");var t="CHECKEDOUT"==e.ACTION?"CHECKOUT_FAILURE":"CHECKIN_FAILURE";UIUtils.showMessage("error",J.i18n("common",t),"showclose","normalfont",3e3)}},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})}},WebUtil.TocMenuHTML={classic:{showNo:!0,level:3,leader:1,case:["small","small","small","small","small","small"]},contemporary:{showNo:!0,level:3,leader:0,case:["caps","caps","caps","small","small","small"]},formal:{showNo:!0,level:3,leader:1,case:["caps","caps","small","small","small","small"]},modern:{showNo:!0,level:3,leader:1,case:["small","small","small","small","small","small"]},simple:{showNo:!0,level:3,leader:0,case:["small","small","small","small","small","small"]}},WebUtil.nciku=function(){var e=editor.doc.getSelection(),t=e.isCollapsed()?e.getWord():e.getNextWord();t.select();var i=e.getSelectedText(e.getStart(),e.getEnd()),n=editorProps.deployment.writer;if(""!=i){var o="width=500,height=500,scrollbars=yes,resizable=no,toolbar=no,directories=no,menubar=no,copyhistory=no,status=no,location=no",r="http://ce.linedict.com/dict.html#/cnen/search?query="+encodeURI(i),a=window.open(r,"Nciku",o);a.moveTo(250,150),a.focus()}else MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,null,n,J.i18n("writer.common.PLEASESELECTSOMETEXT"))},WebUtil.saveStorageService=function(){var e={};e.rid=Utils.getDocumentId(),ZWNetworkUtils.setCsrfParam(e),J.ajax({type:"POST",global:!1,async:!1,dataType:"json",url:ZWNetworkUtils.getContextUrl("v1/web/gdrive/savestorage"),data:e,error:function(){UIUtils.showLoadingMsg(J.i18n("writer.remotesave.SAVE_FAILURE_MSG"),3e3)},success:function(e){var t=e.statusCode;e.statusValue;"200"===t?UIUtils.showLoadingMsg(J.i18n("writer.remotesave.SUCCESS"),3e3):UIUtils.showLoadingMsg(J.i18n("writer.remotesave.SAVE_FAILURE_MSG"),3e3)}})},WebUtil.clrError=function(){J("#errormsg").show().html(""),J("#errormsg").css("display","none")};var DocumentView=function(){var e=1,t=[],i={SINGLE_PAGE:1,DOUBLE_PAGE:2,MULTIPLE_PAGE:3},n=i.SINGLE_PAGE,o=!1,r=14,a=354,s=374,l=function(){var e=0;return LayoutManager.isRichEditActive()&&(e+=J("#panel-container").width()),e+=Macros.isRulerAllowed()?r:0},d=function(e){var t=n;n=e,DocLayoutManager.isFixedView()&&n!=i.SINGLE_PAGE&&DocLayoutManager.toggleFixedView(),e==i.SINGLE_PAGE||o||I(),e==i.MULTIPLE_PAGE?c():e==i.DOUBLE_PAGE?g():(p(),t==i.DOUBLE_PAGE&&UIUtils.setZoomFactor(100));var r="singlePage";n==i.DOUBLE_PAGE?r="doublePage":n==i.MULTIPLE_PAGE&&(r="multiPage"),J("#"+r).prop("checked",!0),J("#"+r+"-lpnl").prop("checked",!0)},c=function(){if(A()==i.MULTIPLE_PAGE){var e=u(),t=DomViewManager.getGridWrapType();t===PAGE_GRID.WRAP_TYPE.AUTO?(DomViewManager.updateGridLayoutDimensions({width:e/editor.zoomFactor,height:0}),DomViewManager.changeGridWrapType()):DomViewManager.changeGridLayout(e/editor.zoomFactor,0,i.MULTIPLE_PAGE),Z("editorpane-container").css("left",""),editor.handleScroll(),EditorLayout.updateMainOuterDivProps(),editor.onResize(),UIUtils.setEditorPaneWrapperHeight(!0);var n=editor.editorPaneContainer.scrollTop();editor.editorPaneContainer.scrollTop(n*editor.zoomFactor)}},u=function(){var e=J(window).width(),t=EditorLayout.isRightPaneAvailable()&&EditorLayout.isRightPaneVisible();e-=t?a:0;var i=LayoutManager.getCurrentLayout()==LAYOUTS.MAILMERGEPREVIEW;return e-=i?s:0,e-=l()},p=function(){DomViewManager.changeGridLayout(0,0,i.SINGLE_PAGE),editor.onResize()},g=function(){var e=J(window),t=e.height(),n=Z("topband-wrapper").height(),o=Z("bottombar").height(),r=t-n-o-MULTIPAGE_DEFAULT_SPACE,a=e.width()-10,s=Z(ELEM_ID.REVIEWRIGHTPANE),l=Z(ELEM_ID.PANELCONTAINER);LeftPanel.isContainerVisible(ELEM_ID.PANELCONTAINER)&&(a-=l.width()),s.is(":visible")&&(a-=s.width());var d=DomViewManager.getGridWrapType();if(d===PAGE_GRID.WRAP_TYPE.FIXED)DomViewManager.updateGridLayoutDimensions({width:a/editor.zoomFactor,height:0}),DomViewManager.changeGridWrapType();else{DomViewManager.changeGridLayout(a/editor.zoomFactor,0,i.DOUBLE_PAGE);var c=DomViewManager.getRowHeight(0),u=r/c,p=DomViewManager.getMaxRowWidth(),g=a/p,f=Math.min(u,g);f&&UIUtils.setZoomFactor(100*f)}editor.handleScroll(),setEditorPaneWidthHeightForMultiPage()};setEditorPaneWidthHeightForMultiPage=function(){if(DomViewManager.isMultiplePagesInRow()){var e=DomViewManager.getMaxRowWidth(),t=DomViewManager.getEntireGridHeight();editor.jeditorPane.css({height:t,width:e}),J("#editorpane-container").css({height:t*editor.zoomFactor,width:e*editor.zoomFactor})}},getPageOffset=function(i){var n,o,r,a=0,s=10,l=DocLayoutManager.getFirstPageHeight()*editor.zoomFactor;r=parseInt(i/e),i%e==0&&(r=parseInt((i-1)/e)),a=i%e,0==a&&(a=e),o=t[a-1],n=r*l/editor.zoomFactor,n+=(r+1)*(s/editor.zoomFactor),0==n&&(n=MULTIPAGE_DEFAULT_SPACE);var d={top:n,left:o};return d};var f=function(e,t){if(DomViewManager.isMultiplePagesInRow()){var i=e.getAbsolutePageNumber();t&&(i-=1);var n=getPageOffset(i);J(DomViewManager.getDOMElem(e)).css({position:"absolute",top:n.top,left:n.left})}},E=function(e){var t="";if("view-lpnl-zoom"==e.target[0].id&&(t="-lpnl"),!J("[name=zoompageview"+t+"]")[0]||!J("[name=zoompageview"+t+"]").data().componentName){var i=J("#zoommultipagemenu-grp"+t);i.find("#singlePage"+t)[0].setAttribute("data-label",J.i18n("writer.view.ONE_PAGE")),i.find("#doublePage"+t)[0].setAttribute("data-label",J.i18n("writer.view.TWO_PAGE")),i.find("#multiPage"+t)[0].setAttribute("data-label",J.i18n("writer.view.MULTIPLE_PAGES")),UIUtils.initComponent("zoommultipagemenu-grp"+t),J("[name=zoompageview"+t+"]").on("zstatebuttonchange",T)}m(EditorView.getView())},T=function(e){var t=parseInt(e.target[0].getAttribute("value"));d(t);var i=Z("bbar-zoom"),n=Z("view-lpnl-zoom");i.zcombobox("setValue",parseInt(100*editor.zoomFactor)+"%"),n.zlabeledcombobox("setValue",parseInt(100*editor.zoomFactor)+"%")},m=function(e){"Web View"==e?(n!=i.SINGLE_PAGE&&d(i.SINGLE_PAGE),J("#zoommultipagemenu-grp-lpnl").addClass("ui-state-disabled"),J("#zoommultipagemenu-grp").addClass("ui-state-disabled")):(J("#zoommultipagemenu-grp-lpnl").removeClass("ui-state-disabled"),J("#zoommultipagemenu-grp").removeClass("ui-state-disabled"))},h=function(){switch(n){case i.MULTIPLE_PAGE:c();break;case i.DOUBLE_PAGE:g()}},I=function(){o=!0,PubSub.subscribe("Document/Resize",setEditorPaneWidthHeightForMultiPage),PubSub.subscribe([DOCVIEW.CURRENT_GROUP_LAYOUT_CHANGED,"Document/RichEditLayoutClosed","Document/RichEditLayoutOpened","Document/LayoutChanged"],h),PubSub.subscribe("Document/PageNumberUpdated",f),PubSub.subscribe("Document/view/changed",function(e){m(e)}),PubSub.subscribe("DocOperation/CommandComplete",_)},_=function(){DomViewManager.isMultiplePagesInRow()&&"updatePageLayout"==editor.lastOperation&&editor.handleScroll()},A=function(){return n},S=function(){return editor.zoomFactor},R=function(e){UIUtils.setZoomFactor(100*e)};return{changeView:d,zoomBarBeforeOpen:E,getViewType:A,getZoomFactor:S,setZoomFactor:R,getLeftPaneWidth:l,getEditorWidth:u,handleDimensionsUpdate:h}}();_deferred=function(){"use strict";var e=([LIST_TYPE.DECIMAL,LIST_TYPE.UPPER_ROMAN,LIST_TYPE.LOWER_ROMAN,LIST_TYPE.UPPER_ALPHA,LIST_TYPE.LOWER_ALPHA,LIST_TYPE.DISC,LIST_TYPE.CIRCLE,LIST_TYPE.BOX],{}),t=function(){if(U.isEmpty(e)){var t=w_usersettings.DefaultListType;t&&"undefined"!=typeof t.ordered?ListUtils.setDefaultListType("ordered",t.ordered):void 0,t&&"undefined"!=typeof t.unordered?ListUtils.setDefaultListType("unordered",t.unordered):void 0}return e},i=function(t,i){e[t]=i},n=function(e){switch(e){case LIST_TYPE.DECIMAL:return"decimal";case LIST_TYPE.LOWER_ALPHA:return"lower-alpha";case LIST_TYPE.UPPER_ALPHA:return"upper-alpha";case LIST_TYPE.LOWER_ROMAN:return"lower-roman";case LIST_TYPE.UPPER_ROMAN:return"upper-roman";case LIST_TYPE.DISC:return"disc";case LIST_TYPE.CIRCLE:return"circle";case LIST_TYPE.BOX:return"square";case LIST_TYPE.NONE:return"none"}},o=function(e){var t=[],i={};for(var n in e){var o=e[n];if(o.hasOwnProperty(ATTR_COMMON.CUSTOM_DATA))for(var r in o[ATTR_COMMON.CUSTOM_DATA])t.push(o[ATTR_COMMON.CUSTOM_DATA][r]);else o.hasOwnProperty(ATTR_COMMON.BULLET_ID)&&t.push(o[ATTR_COMMON.BULLET_ID])}t=U.uniq(t);for(var a=0,s=t.length;a<s;a++){var l,d=t[a],c=editor.doc.getListBulletObj(d);if(c.hasOwnProperty("img")){var u=c.img[ATTR_IMAGE.I_SRC];!u||0!==u.indexOf("image.do")&&0!==u.indexOf("remoteImage.do")||(u=ZWNetworkUtils.getContextUrl(u),l=ImageCache.getCopyImageData(u),l||(l=document.createElement("img"),l.src=u),c.img[ATTR_IMAGE.I_SRC]=ZWImageUtils.getImageBytes(l))}i[d]=c}return i},r=function(e){var t=e.trim().charCodeAt(0),i=LIST_TYPE.DECIMAL;return 183==t?i=LIST_TYPE.DISC:111==t?i=LIST_TYPE.CIRCLE:167==t?i=LIST_TYPE.BOX:t>=48&&t<=57?i=LIST_TYPE.DECIMAL:t>=97&&t<=122?i=LIST_TYPE.LOWER_ALPHA:t>=65&&t<=90&&(i=LIST_TYPE.UPPER_ALPHA),i},a=function(e){e=e.toUpperCase();var t,i=e.replace("XL","XXXX"),n=i.replace("XC","LXXXX"),o=n.replace("CD","CCCC"),r=o.replace("CM","DCCCC"),a=r.replace("IV","IIII"),s=a.replace("IX","VIIII"),l=0,d=s.length,c=0;for(t=0;t<d;t++)l=s.charAt(t),"M"==l&&(c+=1e3),"D"==l&&(c+=500),"C"==l&&(c+=100),"L"==l&&(c+=50),"X"==l&&(c+=10),"V"==l&&(c+=5),"I"==l&&(c+=1);return c},s=function(e,t,i){var n=document.createElement("img");J(n).attr("src",e),n.setAttribute("crossorigin","anonymous"),J(n).on("load",function(e){var o=ZWImageUtils.getImageBytes(n,n.naturalWidth,n.naturalHeight),r=HTMLUtil.storeImageInFileStore(o),a=document.createElement("img");a.src=Macros.getCheckListImgPath(r);var s=n.width,l=n.height,a={wid:s,src:r,ht:l};t&&(t.img=a),"function"==typeof i&&i(!0)}),J(n).on("error",function(){t&&(t.img=null),"function"==typeof i&&i(!1)})},l=function(e){var t=editor.doc.getListObj(e);return U.isObject(t)?t.level0.type:LIST_STYLE_OBJECT[t].level0.type},d=function(e){if(e){var t=editor.doc.getListObj(e.id);return U.isObject(t)?t["level"+e.l].type:LIST_STYLE_OBJECT[t]["level"+e.l].type}},c=function(e){var t=editor.doc.getListObj(e.id);return"number"==typeof t?t<5?"ordered":"unordered":t["level"+e.l].type<5?"ordered":"unordered"},u=function(e){var t=editor.doc.getListObj(e);if("number"==typeof t)return t<5?"ordered":"unordered";var i;for(var n in t)if(i){var o=t[n].type<5?"ordered":"unordered";if(i!=o)return"mixed"}else i=t[n].type<5?"ordered":"unordered";return i},p=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.PARAGRAPH).dtNode;if(t.format.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)&&t.prev){var i=function(e,t){return e-t},n=DocTreeManager.doc.getSection(e.getStart()).lists,o=[],r={},a=t.prev&&t.prev.format.ls_data?t.prev.format.ls_data:void 0,s=t.format.ls_data,l=n[s.id];if(a)return a.id!=s.id?a.id:void 0;for(var d in n){var u=n[d];if(!(u[0].getIndex()>l[l.length-1].getEndIndex())){var p=ListUtils.getListVariant(d);if("unordered"!=p)for(var g=0;g<u.length;g++){var f=u[g].getIndex();t.getIndex()>f&&(o.push(f),r[f]=d)}}}o.sort(i);for(var g=o.length-1;g>=0;g--){var E=o[g],T=r[E];if(T&&"ordered"==c({id:T,l:s.l}))return T!=s.id?T:void 0}}},g=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.PARAGRAPH).dtNode;if(t.format.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)){var i=ListUtils.getPrevOrderedListId(),n=t.id,o=t.format[ATTR_PARAGRAPH.LS_DATA].id,r=DocTreeManager.doc.getSection(e.getStart()).lists[o],a=!1,s=t.prev&&t.prev.format.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)?t.prev.format[ATTR_PARAGRAPH.LS_DATA].id:void 0;if(!i&&s!==o)for(var l,d,c,u=t.section.prev;!i&&u;){for(var p=Object.keys(u.lists),g=0;g<p.length;g++)d=u.getListParasByListId(p[g]).slice(-1)[0],d&&(c=ListUtils.getListId(d.format),d&&c!==o&&(!l||d.getIndex()>l.getIndex())&&(l=d));i=l?ListUtils.getListId(l.format):void 0,u=u.prev}if(i)for(var f=t.section.doc.getAllSectionWithListId(o),g=0;g<f.length;g++){r=f[g].lists[o];for(var E=0;E<r.length;E++){r[E].id==n&&(a=!0);var T=ZWJSONUtils.clone(r[E].format);T.ls_data.id=parseInt(i);var m=editor.doc.createElement(NODE_TYPE.PARAGRAPH);m.setStart(r[E].getEndIndex()),m.setEnd(r[E].getEndIndex()+1),m.attr(T)}}}},f=function(e){var t=editor.doc.getSelection(),e=e?e:t.getParents(NODE_TYPE.PARAGRAPH).dtNode,i=DocTreeManager.doc.getSection(t.getStart()).lists,n=e.id;if(e.format.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)&&(DocTreeManager.doc.isListPresentInMultipleSection(e.format[ATTR_PARAGRAPH.LS_DATA].id)||n!=i[e.format[ATTR_PARAGRAPH.LS_DATA].id][0].id)){var o=e.format.ls_data,r=Utils.getRandomNumber(),a=editor.doc.getListObj(o.id);delete a.refAbstractNumId,delete a.startOverride,delete a.levelOverride,ListOperation.setBodyFormat(r,a);for(var s,l,d=!1,c=e.format.ls_data.l,u=e.section.doc.getAllSectionWithListId(e.format.ls_data.id),p=0;p<u.length;p++)if(l=u[p],l.getIndex()>=e.section.getIndex()){s=l.lists[e.format.ls_data.id];for(var g=0;g<s.length;g++)if(s[g].id==n&&(d=!0),d){if(c>s[g].format.ls_data.l)break;var f=ZWJSONUtils.clone(s[g].format);f.ls_data.id=r;var E=editor.doc.createElement(NODE_TYPE.PARAGRAPH);E.setStart(s[g].getEndIndex()),E.setEnd(s[g].getEndIndex()+1),E.attr(f)}}}},E=function(e){var t={};t.DefaultListType=JSON.stringify(e),J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/defaultlisttype"),data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){"SUCCESS"==t.RESPONSE&&e.ListVariant&&(ListUtils.setDefaultListType(e.ListVariant,e),"ordered"==e.ListVariant?UIUtils.showMessage("info",J.i18n("writer.list.ORDER_LIST_DEFAULT_UPDATED"),!0,"normalfont",1e3):"unordered"==e.ListVariant&&UIUtils.showMessage("info",J.i18n("writer.list.UNORDER_LIST_DEFAULT_UPDATED"),!0,"normalfont",1e3))},error:function(e){"FAILED"==e.RESPONSE&&UIUtils.showMessage("error",J.i18n("writer.list.LIST_DEFAULT_UPDATION_FAILED"),!0,"normalfont",1e3)}})},T=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH).dtNode,t=e.format.ls_data,i=ListUtils.getListLevelVariant(t),n=ListUtils.getListLevelTypeFromBody(t);if(n!=LIST_TYPE.TOC_TYPE_1&&n!=LIST_TYPE.NONE&&n!=LIST_TYPE.CHECKLIST){var o={};if("ordered"==i)o.ListVariant="ordered",o.ListType=n;else if(o.ListVariant="unordered",o.ListType=n,9==n){var r=editor.doc.getBodyFormat().listFormat[t.id]["level"+t.l].bullet_id;o.ListData=editor.doc.getBodyFormat().listFormat.bulletStyles[r].c}else if(10==n)return;ListUtils.saveListTypeAjax(o)}},m=function(){for(var e=DocTreeManager.doc.getAllSections(),t=[],i=[],n=e.length,o=0;o<n;o++){var r=e[o].headings;if(r&&ZWJSONUtils.getKeys(r).length)for(var a in r)a>=1&&a<=6&&(t=t.concat(r[a]))}for(var s=t.length,o=0;o<s;o++){var l=DocTreeManager.getTreeNodeById(t[o]),d=l?editor.doc.getElementAt(l.getEndIndex()):null;d&&i.push(d)}return i},h=function(e,t){var i={};ListUtils.fillListProps(i,e),e&&e.l>=0?(i[ATTR_PARAGRAPH.PS_ML]=_(t,e.l,.5),i[ATTR_PARAGRAPH.PS_TI]="-0.25in"):e&&e.l<0&&(i[ATTR_PARAGRAPH.PS_NULL]=!0,i[ATTR_TEXT.TS_NULL]=!0),t.attr(i)},I=function(e,t){var i={};ListUtils.fillListProps(i,e),e&&e.l>=0?(i[ATTR_PARAGRAPH.PS_ML]=_(t,e.l,-.5),i[ATTR_PARAGRAPH.PS_TI]="-0.25in"):e&&e.l<0&&(i[ATTR_PARAGRAPH.PS_ML]="0in",i[ATTR_PARAGRAPH.PS_TI]="0in"),t.attr(i)},_=function(e,t,i){if(e){var n=e.attr(ATTR_PARAGRAPH.PS_ML)||0;return n="string"==typeof n?n.convertor().inches:n,t>=0?isNaN(n)||0==n?n=(t+1)*i:n+=i:(n-=.5,n<0&&(n=0)),n+"in"}},A=function(e){switch(e){case LIST_TYPE.DECIMAL:return LIST_TYPE.LOWER_ALPHA;case LIST_TYPE.LOWER_ALPHA:return LIST_TYPE.LOWER_ROMAN;case LIST_TYPE.LOWER_ROMAN:return LIST_TYPE.DECIMAL;case LIST_TYPE.UPPER_ROMAN:case LIST_TYPE.UPPER_ALPHA:return LIST_TYPE.LOWER_ROMAN;case LIST_TYPE.DISC:return LIST_TYPE.CIRCLE;case LIST_TYPE.CIRCLE:return LIST_TYPE.BOX;case LIST_TYPE.BOX:return LIST_TYPE.DISC;case LIST_TYPE.IMAGE:return LIST_TYPE.CIRCLE;default:return LIST_TYPE.DISC}},S=function(e,t){if(("undefined"==typeof t||0==t)&&LIST_STYLE_OBJECT.hasOwnProperty(e))return e;var i={};t="undefined"!=typeof t?t:0;for(var n=t;n<=MAX_LIST_LEVELS+t;n++){n!=t&&(e=ListUtils.getNextListType(e));var o=n<=MAX_LIST_LEVELS?n:n-MAX_LIST_LEVELS-1;i["level"+o]={type:e,startsWith:1}}return i},R=function(e){var t=null;return e&&ListUtils.isList(e.attr("*"))&&(t=e.attr(ATTR_PARAGRAPH.LS_DATA)),t},O=function(){var e=editor.doc.getSelection(),t=e.getNodesInSelection(NODE_TYPE.PARAGRAPH),i=ListUtils.getListData(t[0]);if(i){i.l=-1;for(var n=0;n<t.length;n++){var o={};ListUtils.fillListProps(o,i),o[ATTR_PARAGRAPH.PS_NULL]=!0,o[ATTR_TEXT.TS_NULL]=!0,t[n].attr(o)}if(e.isListItemSelection){var r=t[0].getStart(),a=editor.doc.createRange(r);e.isListItemSelection=!1,e.removeAllRanges().showCaret(a)}}},b=function(e,t,i){var n=editor.doc.getListObj(e);if(n&&!(t<0)){var o=DocUtil.copyStyle(n);editor.doc.getListType(e,t);i.hasOwnProperty(ATTR_TEXT.TS_NULL)&&1==i[ATTR_TEXT.TS_NULL]?n["level"+t].paraFormat.textFormat={}:("text"==i.type?(delete i.type,n["level"+t].paraFormat||(n["level"+t].paraFormat={}),n["level"+t].paraFormat.textFormat=i):n["level"+t].paraFormat=i,n=DocUtil.mergeObjs([o,n])),ZWLogger.addToStatistics("List-Sel-Styles-Updation"),ListOperation.setBodyFormat(e,n)}},v=function(e){if(0!=e.length){var t,i=e[0],n=e[1],o=e[2],r=e[3],a=e[4],s=editor.doc.getListChar(i,n),l=editor.doc.getListObj(i),d=-1,c={};if(c.isLevelOverride=!0,c.level=n,c.isWholeList=!1,void 0!=o&&null!=o||(o=""),void 0!=r&&null!=r||(r=""),a){c.isWholeList=!0;for(var u=0;u<ListLevelNo.length;u++){var p=l["level"+u].type;"undefined"!=typeof p&&"orderedlist"!=L(p)||(t=o+ListLevelNo[u]+r,l["level"+u].c=t)}ListOperation.setBodyFormat(i,l,c),ZWLogger.addToStatistics("Prefix - Suffix Updation")}else for(var g,f=0;g=ListLevelNo[f++];)if(d=J.inArray(g,s),d>-1){t=o+ListLevelNo[n]+r,l["level"+n].c=t,ListOperation.setBodyFormat(i,l,c),ZWLogger.addToStatistics("Prefix - Suffix Updation");break}}},D=function(e){if(0!=e.length){var t=e[0],i=e[1],n=e[2],o=editor.doc.getListObj(t),r={};r.level=e[1],r.isNumberOverride=!0,o["level"+i].startsWith=n,ListOperation.setBodyFormat(t,o,r)}},L=function(e){var t;return e==LIST_TYPE.DISC||e==LIST_TYPE.BOX||e==LIST_TYPE.CIRCLE||e==LIST_TYPE.NONE||e===LIST_TYPE.IMAGE||e===LIST_TYPE.SYMBOL?(LIST_TYPE.RECENT_UNORDER=e,t="unorderedlist"):(LIST_TYPE.RECENT_ORDER=e,t="orderedlist"),t},N=function(e){var t=editor.doc.getSelection(),i=e||t.getParaFormat();return i.ls_data?i.ls_data.id:null},P=function(){var e=function(e){ListOperation.applyUserImageList(ImageHandler.getImageAttributes(e.DATA[0])),ZWImgLibDialog.close()},t=function(){UIUtils.showListFailedMsg(),ZWImgLibDialog.close()};ZWImgLibDialog.open({},e,t)},C=function(e){return U.find(DocTreeManager.doc.getAllSections(),function(t){return 1==t.lists.hasOwnProperty(e)})},m=function(){for(var e=DocTreeManager.doc.getAllSections(),t=[],i=[],n=0;n<e.length;n++){var o=e[n].headings;if(ZWJSONUtils.getKeys(o).length)for(key in o)key>=1&&key<=6&&(t=t.concat(o[key]))}for(var n=0;n<t.length;n++){var r=DocTreeManager.getTreeNodeById(t[n]),a=r?editor.doc.getElementAt(r.getEndIndex()):null;a&&i.push(a)}return i},y=function(e,t,i){if(i){i.id,i.listLevel,i.levelInfo;if(isNaN(t))return t}var n;switch(e){case LIST_TYPE.NONE:n="";break;case LIST_TYPE.DECIMAL:n=t;break;case LIST_TYPE.LOWER_ALPHA:case LIST_TYPE.UPPER_ALPHA:var o=ListUtils.numberToAlpha(parseInt(t));n=e==LIST_TYPE.UPPER_ALPHA?o:o.toLowerCase();break;case LIST_TYPE.LOWER_ROMAN:case LIST_TYPE.UPPER_ROMAN:var r=ListUtils.numberToRoman(parseInt(t));n=e==LIST_TYPE.UPPER_ROMAN?r:r.toLowerCase();break;case 22:break;default:n=""}return n},F=function(e){return e.paraProperties.isHeadingList},M=function(e){var t=e.getEndIndex(),i=editor.doc.getComputedFormatAt(t,NODE_TYPE.PARAGRAPH),n=e.paraProperties.listData;n.listType;if("ordered"==c(i[ATTR_PARAGRAPH.LS_DATA])){var o=editor.doc.getListChar(n.id,n.listLevel);if(o&&o!=ListLevelNo[n.listLevel]&&o!=ListLevelNo[n.listLevel]+".")return!0}return!1},w=function(e){if(!e.isList())return!1;var t=e.getEndIndex(),i=editor.doc.getComputedFormatAt(t,NODE_TYPE.PARAGRAPH),n=i.ls_data;return!(F(e)||ListUtils.isImageList(i)||ListUtils.isSymbolList(n)||CheckListOperations.isCheckList(i))&&!M(e)},x=function(){var e={};e={16:{level2:{startsWith:1,c:"()",type:4,htype:16},level3:{startsWith:1,c:"()",type:2,htype:16},level0:{startsWith:1,c:J.i18n("writer.common.LIST_ARTICLE")+" \0.",type:1,htype:16},level1:{startsWith:1,c:J.i18n("writer.common.LIST_SECTION")+" \0.",type:22,htype:16},level8:{startsWith:1,c:"\b.",type:1,htype:16},level7:{startsWith:1,c:".",type:1,htype:16},level6:{startsWith:1,c:")",type:1,htype:16},level5:{startsWith:1,c:")",type:4,htype:16},level4:{startsWith:1,c:")",type:0,htype:16}},17:{level0:{type:0,startsWith:1,c:"\0",htype:17},level1:{type:0,startsWith:1,c:"\0.",htype:17},level2:{type:0,startsWith:1,c:"\0..",htype:17},level3:{type:0,startsWith:1,c:"\0...",htype:17},level4:{type:0,startsWith:1,c:"\0....",htype:17},level5:{type:0,startsWith:1,c:"\0.....",htype:17},level6:{type:0,startsWith:1,c:"\0......",htype:17},level7:{type:0,startsWith:1,c:"\0.......",htype:17},level8:{type:0,startsWith:1,c:"\0........\b",htype:17}},18:{level0:{type:1,startsWith:1,c:"\0.",htype:18},level1:{type:3,startsWith:1,c:".",htype:18},level2:{type:0,startsWith:1,c:".",htype:18},level3:{type:4,startsWith:1,c:")",htype:18},level4:{type:0,startsWith:1,c:"()",htype:18},level5:{type:4,startsWith:1,c:"()",htype:18},level6:{type:1,startsWith:1,c:"()",htype:18},level7:{type:1,startsWith:1,c:"()",htype:18},level8:{type:1,startsWith:1,c:"(\b)",htype:18}},19:{level2:{startsWith:1,type:255,htype:19},level3:{startsWith:1,type:255,htype:19},level0:{startsWith:1,c:J.i18n("writer.common.LIST_CHAPTER")+" \0",type:0,htype:19},level1:{startsWith:1,type:255,htype:19},level8:{startsWith:1,type:0,htype:19},level7:{startsWith:1,type:0,htype:19},level6:{type:0,startsWith:1,htype:19},level5:{startsWith:1,type:255,htype:19},level4:{startsWith:1,type:255,htype:19}}},window.HLIST_TYPE=e},B=function(e,t){var i=DocumentDesign.getStyles().para;switch(e){case 16:for(var n=1;n<=6;n++){var o,r=i["h"+n];ListUtils.fillListProps(r,{id:t,l:n-1}),n>=3?(o=.5,o+=.1*(n-3)):o=0,r[ATTR_PARAGRAPH.PS_ML]=o+"in"}break;case 17:for(var n=1;n<=6;n++){var r=i["h"+n];ListUtils.fillListProps(r,{id:t,l:n-1}),r[ATTR_PARAGRAPH.PS_ML]="0in"}break;case 18:for(var n=1;n<=6;n++){var o,r=i["h"+n];ListUtils.fillListProps(r,{id:t,l:n-1});var o=.5*(n-1);r[ATTR_PARAGRAPH.PS_ML]=o+"in"}break;case 19:for(var n=1;n<=6;n++){var r=i["h"+n];ListUtils.fillListProps(r,{id:t,l:n-1}),r[ATTR_PARAGRAPH.PS_ML]="0in"}}var a=editor.doc.getSelection().getParents(NODE_TYPE.BODY),s=a.attr(ATTR_BODY.DS_STYLES);return s[ATTR_BODY.DS_PARA]=i,s},H=function(e){var t=parseFloat(e.attr(ATTR_PARAGRAPH.PS_TI));return!isNaN(t)&&ListUtils.isList(e)?t+=-.25:t=-.25,t+"in"};return x(),{getDefaultListType:t,setDefaultListType:i,getHTMLListType:n,getSplBulletInfo:o,getListTypeByCharCode:r,AlphatoRoman:a,loadContextualImgFromPng:s,getListTypeFromBody:l,getListLevelTypeFromBody:d,getListLevelVariant:c,getListVariant:u,getPrevOrderedListId:p,continueWithPreviousList:g,restartAsNewList:f,saveListTypeAjax:E,saveDefaultListType:T,indentList:h,outdentList:I,getListData:R,getNextListType:A,getListLevels:S,updateLevelStyles:b,updateListPrefixAndSuffix:v,updateLevelNumbering:D,getListCategory:L,getListId:N,loadImgLibrary:P,getListSection:C,getAllHeadingsForList:m,removeList:O,getStartsWith:y,isBasicList:w,isModifiedListChar:M,isHeadingList:F,getBodyStylesForHeadingList:B,getTextIndent:H}}(),extend(ListUtils,_deferred);var ListUI=function(){var e,t,i,n={get:function(e){if("listNumber"===e.action){var t,i=editor.doc.getSelection().paraFormat.ls_data.id,n=editor.doc.getSelection().paraFormat.ls_data,o=editor.doc.getSelection().paraFormat.ls_data.l,r=editor.doc.getListType(i,o);o>0&&(t=editor.doc.getListType(n.id,0));var a=J("#inputtxt");a.on("keyup",function(e){var t=J(this).val();if(0==r){var i=/^\d*[0-9]$/;return i.test(t)?(J("#errmsg").hide(),J("#applybtn1").enable(),!0):(J("#errmsg").show().html(UIUtils.getErrorMsg("error",J.i18n("common","ONLY_POSITIVE"))),J("#applybtn1").disable(),!1)}if(4==r||3==r){var n=/^\s*[a-zA-Z0-9]+\s*$/;return n.test(t)?(J("#errmsg").hide(),J("#applybtn1").enable(),!0):(J("#errmsg").show().html(UIUtils.getErrorMsg("error",J.i18n("common","ONLY_ALPHANUMERIC"))),J("#applybtn1").disable(),!1)}if(1==r||2==r){if(isNaN(t)){t=t.toUpperCase();var o=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/;return o.test(t)?(J("#errmsg").hide(),J("#applybtn1").enable(),!0):(J("#errmsg").show().html(UIUtils.getErrorMsg("error",J.i18n("common","ONLY_ROMAN_NUMERIC"))),J("#applybtn1").disable(),!1)}var i=/^\d*[0-9]$/;return i.test(t)?(J("#errmsg").hide(),J("#applybtn1").enable(),!0):(J("#errmsg").show().html(UIUtils.getErrorMsg("error",J.i18n("common","ONLY_ROMAN_NUMERIC"))),J("#applybtn1").disable(),!1)}});var s=editor.doc.getListObj(i)["level"+o].startsWith;0==r&&(s=parseInt(s));var l;return l=3==r||4==r?ListUtils.getStartsWith(r,s,n):1==r||2==r?ListUtils.getStartsWith(r,s,n):s}},set:function(e,i,n){"listNumber"===e.action&&(this.numberValue=t=i)},apply:function(){var e=editor.doc.getSelection().paraFormat.ls_data.id,i=editor.doc.getSelection().paraFormat.ls_data.l,n=(editor.doc.getSelection().paraFormat.ls_data,editor.doc.getListType(e,i));isNaN(t)||(t=parseInt(t)),0!=n&&isNaN(t)&&(3==n||4==n?t=ListUtils.AlphatoNumber(t):1!=n&&2!=n||(t=ListUtils.AlphatoRoman(t))),editor.doc.execCmd("updateLevelNumbering",[e,i,t]),J.dialogutil.close("listnumberingstart"),t=null}},o={init:function(){var e={action:"prefix"},t={action:"suffix"};J("#prefixInputTxt").donetyping(function(){o.set(e,this.value,J(this))},50),J("#suffixInputTxt").donetyping(function(){o.set(t,this.value,J(this))},50)},get:function(t){var n,o=editor.doc.getSelection(),a=o.getFirstRange(),s=editor.doc.getNodesInSelection(NODE_TYPE.PARAGRAPH,a.start,a.end),l=s[0].dtNode.paraProperties.listData,d=l.id,c=l.listLevel,u=editor.doc.getListChar(d,c),p=-1;if(u)for(var g,f=0;g=ListLevelNo[f++];)if(p=J.inArray(g,u),p>-1){n=u.replace(g,"");break}return"prefix"===t.action?(p>0?this.prefixVal=u.substring(0,p):(J(".prefixInput").attr("placeholder","Add Prefix"),this.prefixVal=""),e.prefix=i.prefix=this.prefixVal,U.unescape(this.prefixVal)):"suffix"===t.action?(p!=-1?this.suffixVal=u.substring(p+1,u.length):(J(".suffixInput").attr("placeholder","Add Suffix"),this.suffixVal=""),e.suffix=i.suffix=this.suffixVal,U.unescape(this.suffixVal)):"listnumlabel"==t.action?(this.listNumLabel=e.listNum=i.listNum=ListUtils.getStartsWith(l.listType,l.levelInfo["level"+l.listLevel],l,!0),this.listNumLabel):"applyToEntireList"==t.action?(e.isEntireList=i.isEntireList=this.isEntireList=e.isEntireList?e.isEntireList:0,this.isEntireList):void("preview"===t.action&&r())},set:function(e,t,n){t=U.escape(t),"prefix"===e.action&&(0===t.length&&J(".prefixInput").attr("placeholder","Add Prefix"),this.prefixVal=i.prefix=t,r()),"suffix"==e.action?(0==t.length&&J(".suffixInput").attr("placeholder","Add Suffix"),this.suffix=i.suffix=t,r()):"applyToEntireList"==e.action&&(this.isEntireList=i.isEntireList=t?1:0)},apply:function(){if(!ZWJSONUtils.compareJSON(e,i)){var t=editor.doc.getSelection(),n=t.getFirstRange(),o=editor.doc.getNodesInSelection(NODE_TYPE.PARAGRAPH,n.start,n.end),r=o[0].dtNode.paraProperties.listData,a=r.id,s=r.listLevel;editor.doc.getListChar(a,s);editor.doc.execCmd("updateListPrefixAndSuffix",[a,s,i.prefix,i.suffix,i.isEntireList])}J.dialogutil.close("listprefixsuffix"),i={}}},r=function(){var e=i.prefix+i.listNum+i.suffix;J("#prefSufPreview").html(e)},a=function(){t=null,J.dialogutil.open("listnumberingstart",void 0,ListUI.listNumberingInfo)},s=function(){e={},i={},J.dialogutil.open("listprefixsuffix",void 0,ListUI.listPrefixSuffixInfo)};return{listNumberingInfo:n,listPrefixSuffixInfo:o,updateListPreview:r,showNumberedList:a,showPrefixSuffixDialog:s}}();ListOperation=function(){"use strict";var e={APPLY_ORDER:1,APPLY_UNORDER:2,APPLY_LIST:3,CHANGE_LIST_TYPE:4,REMOVE_LIST:5,HEADING_LIST:6,CHANGE_HEADING_LIST_TYPE:7,REMOVE_HEADING_LIST:8,RECENT_ORDER:9,RECENT_UNORDER:10,MULTI_LEVEL:11},t=-1,i=0,n="0in",o="0pt",r="unorderedlist",a="orderedlist",s="bullet_id",l="l",d="ls_data",c="bulletListData",u="bulletInfo",p="checked_id",g="checkedListData",f="INVALID_LIST_OBJ",E="list",T={unorderedlist:null,orderedlist:null},m={unorderedlist:6,orderedlist:0},h=function(e){return editor.doc.getListObj(e)},I=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.PARAGRAPH),i=ListUtils.isList(t.attr("*")),n={};if(!i)return n;var o=ListUtils.getListData(t),r=h(o.id);return n.type=r["level"+o.l].type,n.listData=o,n},_=function(e,t){return ListUtils.getListLevels(e,t)},A=function(e,t){var i=e.attr(ATTR_PARAGRAPH.PS_ML)||0;return i="string"==typeof i?i.convertor().inches:isNaN(i)?0:i},S=function(e){var t=.5,i=0;return e>=0&&(i=(e+1)*t),i+"in"},R=function(e){var t=editor.doc.getBodyFormat().styles.para,i=t.h1;return i.hasOwnProperty(d)&&i[d].hasOwnProperty("id")?i[d].id:null},O=function(e){if(!(e>8)){var t=ListUtils.getListCategory(e);T[t]=e}},b=function(e){var t=ListUtils.getDefaultListType(),i=e==a?"ordered":"unordered",n=null;return n=t.hasOwnProperty(i)?t[i].ListType:null!=T[e]?T[e]:m[e]},v=function(e){return Boolean(ListUtils.isList(e.attr("*")))},D=function(){for(var e=editor.doc.getSelection(),t=e.getNodesInSelection(NODE_TYPE.PARAGRAPH),i=null,n=0,o=t.length;n<o;n++){var r=t[n],a=v(r),s=a?ListUtils.getListData(r).id:null;if(i=null===i?s:i,!a||s!=i)return!1}return!0},L=function(){var e=editor.doc.getSelection(),t=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),i=t.attr("*"),n=Number(i[ATTR_PARAGRAPH.PS_HD]),o=R();return!!(e.isCollapsed()&&n>0&&n<=6&&null!=o)},N=function(e,t,i){var n={st:"listFormat"};if(t.hasOwnProperty("refAbstractNumId")){var o=t.refAbstractNumId,r=ListUtils.getListIdsSharingCommonAbstractId(o),a=editor.doc.getRawListObj(e);if(r.length<=1)delete t.refAbstractNumId,delete t.startOverride,delete t.levelOverride,n[o]=t,n[e]=a;else{var s=i.isNumberOverride,l=i.isLevelOverride,d=!1;if(s){var c=i.level;a.hasOwnProperty("levelOverride")&&a.levelOverride.hasOwnProperty("level"+c)?(a.levelOverride["level"+c].startsWith=t["level"+c].startsWith,d=!0):a.hasOwnProperty("startOverride")&&(a.startOverride["level"+c]=t["level"+c].startsWith,d=!0),d&&(n[e]=a)}else if(l){var u=i.isWholeList,c=i.level,a=editor.doc.getRawListObj(e);u?(delete t.refAbstractNumId,delete t.startOverride,delete t.levelOverride,a.levelOverride=t,d=!0):a.hasOwnProperty("levelOverride")&&a.levelOverride.hasOwnProperty("level"+c)&&(a.levelOverride["level"+c]=t["level"+c],d=!0),d&&(n[e]=a)}d||(delete t.refAbstractNumId,delete t.startOverride,delete t.levelOverride,n[o]=t,n[e]=a)}}else n[e]=t;C(n)},P=function(e,t){var i={st:"bulletStyles"};i[e]=t,C(i)},C=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.BODY);for(var i in e){var n=e[i];if(!isNaN(parseInt(i))&&!isNaN(parseInt(n))&&!LIST_STYLE_OBJECT.hasOwnProperty(n)){var o={},r="Object NO :: "+n+" :: Trace :: "+(new Error).stack;o.shouldSendMail=!1,o.shouldWriteToFile=!0,o.feature_name=E,ZWClientLogger.sendToServer(f,r,o)}}t.attr(e)},y=function(e){editor.lastOperation=e,editor.doc.updateLastAction(e)},F=function(e){for(var t=0,i=e.getStart(),n=e.getEnd();"tab"==editor.doc.getRawFormatAt(i+t).st&&t<n;)t++;return t},M=function(e){for(var t=F(e),i=e.getStart(),n="",o=1;o<=t;)n+=UNICODE.TAB,o++;var r=[{r:i},{ds:n}];Op.processMsg(r)},w=function(e,t,i){var n,r=DocUtil.copyStyle(t),a=F(e),s={};if(i)n=i(e,r);else{var l;a>0?(M(e),a=a>9?9:a,l=.5*a+"in"):l=A(e),r.l=Z(l),n=S(r.l)}return s[ATTR_PARAGRAPH.PS_ML]=n,s[ATTR_PARAGRAPH.PS_TI]=ListUtils.getTextIndent(e),ListUtils.fillListProps(s,r),s[ATTR_PARAGRAPH.PS_SA]=o,s},x=function(e,t,i){for(var n=0,o=e.length;n<o;n++){var r,a=e[n],s=v(a),l={};switch(s){case!0:r=ListUtils.getListData(a),r.id=t.id,l[ATTR_PARAGRAPH.LS_DATA]=r;break;case!1:l=w(a,t,i)}a.attr(l)}},B=function(e){"string"!=(typeof e).toLowerCase()&&(e=string(e));var t=e.convertor().inches;return t-=.5,t=t<0?0:t,t+"in"},H=function(e){for(var i=0,o=e.length;i<o;i++){var r=e[i],a=v(r),s={};switch(a){case!0:var l=r.attr(ATTR_PARAGRAPH.PS_ML),d=ListUtils.getListData(r);d.l=t;var c;c=r.dtNode.isCode()?ZWCode.removeTextIndent(l,r):B(l),s[ATTR_PARAGRAPH.PS_ML]=c,s[ATTR_PARAGRAPH.PS_TI]=n,ListUtils.fillListProps(s,d)}r.attr(s)}},J=function(e,t){if("object"==typeof e){var i=t.listType,n=ListUtils.getListCategory(i);n==r?(delete e.startsWith,delete e.c):(11==t.listType&&(e.c=LIST_STYLE_OBJECT[t.listType]["level"+t.listLevel].c,i=LIST_TYPE.DECIMAL),e.startsWith=e.hasOwnProperty("startsWith")&&t.startsWith?parseInt(t.startsWith):1),e.type=i,t.hasOwnProperty(u)&&(e[s]=t[u][c][s])}},G=function(e,t){var i,n=ListUtils.getListData(e);t.listType;i=editor.doc.getListObj(n.id),"object"!=typeof i&&(i=DocUtil.copyStyle(LIST_STYLE_OBJECT[i]));var o=i["level"+n.l];if(J(o,t),t.hasOwnProperty(u)){var r=t[u];if(P(r[c][s],r[c].SVG_DATA),r.hasOwnProperty(g)){var a=r[g];k(i,t,a[p],r[c][s]),P(a[p],a.SVG_DATA)}}else if(CheckListOperations.isCheckList(e.dtNode.getFormat())){var l=ListUtils.getListSection(n.id);l.lists[n.id];l.lists[n.id].forEach(function(e){var i=e.getFormat(),n=i[ATTR_PARAGRAPH.LS_DATA];if(n.l==t.listLevel){var o=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e.getEndIndex());delete n[ATTR_PARAGRAPH.BULLET_ID];var r={};r[ATTR_PARAGRAPH.LS_DATA]=n,o.attr(r)}})}var d={};d.isLevelOverride=!0,d.level=n.l,d.isWholeList=!1,N(n.id,i,d)},k=function(e,t,i,n){var o={checked:i,unchecked:n};for(key in e){var r=e[key];"object"==typeof e[key]&&(J(r,t),r[ATTR_PARAGRAPH.CUST_DATA]=o)}},W=function(e,t){var i=_(t.listType,t.listLevel);if(t.hasOwnProperty(u)){var n=t[u],o=n[c];"object"!=typeof i&&(i=DocUtil.copyStyle(LIST_STYLE_OBJECT[i]));var r=i["level"+t.listLevel];if(J(r,t),P(o[s],o.SVG_DATA),n.hasOwnProperty(g)){var a=n[g];k(i,t,a[p],o[s]),P(a[p],a.SVG_DATA)}}if(t.startsWith){"object"!=typeof i&&(i=DocUtil.copyStyle(LIST_STYLE_OBJECT[i]));var r=i["level"+t.listLevel];J(r,t)}N(e.id,i)},Y=function(e){return{t:e.listType,l:0,id:editor.doc.getNewListId()}},z=function(t,i){var n=editor.doc.getSelection(),o=n.getNodesInSelection(NODE_TYPE.PARAGRAPH);switch(t){case e.APPLY_LIST:var r=Y(i);W(r,i),x(o,r);break;case e.REMOVE_LIST:H(o);break;case e.CHANGE_LIST_TYPE:G(o[0],i)}},Z=function(e){e>=4.5&&(e=4.5);var t=parseFloat(e)/.5-1;return t=t>0?t:0,parseInt(t)},V=function(t){var i={};if(i[c]={},"number"==typeof t){ZWLogger.addToStatistics("IMG_LIST_"+t),i[c].SVG_DATA={},i[c].SVG_DATA.svg_id=t,i[c][s]=null;var n=document.location.origin+ZWNetworkUtils.getContextUrl(SVG_FOR_LISTS[t].png),o=ListUtils.getSVGImgIds(i[c].SVG_DATA.svg_id);"undefined"!=typeof o?(i[c][s]=o,i[c].SVG_DATA=editor.doc.getBodyFormat().listFormat.bulletStyles[o],K([e.APPLY_LIST,LIST_TYPE.IMAGE,i])):ListUtils.loadContextualImgFromPng(n,i[c].SVG_DATA,function(t){t?(i[c][s]=editor.doc.getNewDocumentBulletId(),K([e.APPLY_LIST,LIST_TYPE.IMAGE,i])):UIUtils.showListFailedMsg()})}},j=function(t){var i={};i[c]={},i[c].SVG_DATA={},i[c].SVG_DATA.c="string"==typeof t?t:SYMBOL_LIST_MAPPING[t],i[c][s]=editor.doc.getNewDocumentBulletId(),K([e.APPLY_LIST,LIST_TYPE.SYMBOL,i])},X=function(t){var i={};i[c]={},i[c].SVG_DATA={},i[c][s]=editor.doc.getNewDocumentBulletId(),i[c].SVG_DATA.img=t,K([e.APPLY_LIST,LIST_TYPE.IMAGE,i])},K=function(t){var n=t[0],o=null,s=t[1],l=t[2],d=t[3],c=i,u={};if(L())switch(o=e.CHANGE_LIST_TYPE,n){case e.APPLY_ORDER:case e.APPLY_UNORDER:s=b(n==e.APPLY_ORDER?a:r)}else if(D()){var p=I(),c=U.isEmpty(p)?c:p.listData.l;switch(n){case e.APPLY_ORDER:case e.APPLY_UNORDER:var g=U.isEmpty(p)?null:p.type,f=ListUtils.getListCategory(g),E=f===(n==e.APPLY_ORDER?a:r);s=b(n==e.APPLY_ORDER?a:r),o=E?e.REMOVE_LIST:e.CHANGE_LIST_TYPE;break;case e.APPLY_LIST:var T=editor.doc.getSelection();o=T.isCollapsed()||T.isListItemSelection?e.CHANGE_LIST_TYPE:e.APPLY_LIST;break;case e.REMOVE_LIST:o=n}}else switch(n){case e.APPLY_ORDER:case e.APPLY_UNORDER:o=e.APPLY_LIST,s=b(n==e.APPLY_ORDER?a:r);break;case e.APPLY_LIST:case e.REMOVE_LIST:o=n}u.listType=s,u.listLevel=c,"undefined"!=typeof l&&(u.bulletInfo=l),"undefined"!=typeof d&&(u.startsWith=d),z(o,u),O(s),y(ListUtils.getListCategory(s)),Op.sendMsg(),EditorUtil.focusMultiByteSpan()},q=function(e,t){for(var i=e.length-1;i>=0;i--){var n=e[i],o=n.attr("*"),r=Number(o[ATTR_PARAGRAPH.PS_HD]),a={};if(a.id=t.id,!(r>0&&r<=6)||isNaN(r)){a[l]=0;var s={};ListUtils.fillListProps(s,a),s[ATTR_PARAGRAPH.PS_HD]=1,n.attr(s)}}},Q=function(e,t){for(var i=e.length-1;i>=0;i--){var n=e[i],o=n.attr("*"),r=Number(o[ATTR_PARAGRAPH.PS_HD]),a={};if(a.id=t.id,r>0&&r<=6){a[l]=r-1;var s={};ListUtils.fillListProps(s,a),n.attr(s)}}},$=function(e){var t=e.chkListData;for(var i in t){var n=t[i];if(!n.hasOwnProperty("img")){var o="checkedData"==i?"chkdBulletId":"unchkdBulletId",r=editor.doc.getListBulletObj(e[o]);n.img=r.img}}},ee=function(e,t){for(var e=ListUtils.getAllHeadingsForList(),i=e.length-1;i>=0;i--){var n=e[i],o=n.attr("*"),r=Number(o[ATTR_PARAGRAPH.PS_HD]),a={};if(a.id=t.id,!isNaN(r)&&r>0&&r<=6){a[l]=-1;var s={};ListUtils.fillListProps(s,a),n.attr(s)}}},te=function(t,i){var n,o,r=R(),a=ListUtils.getAllHeadingsForList(),s={},l=editor.doc.getSelection();if(s.id=null!=r?r:0,t==e.HEADING_LIST){s.listType=i,n=ListUtils.getBodyStylesForHeadingList(s.listType,s.id),Q(a,s);var d=l.getNodesInSelection(NODE_TYPE.PARAGRAPH);q(d,s);var c=HLIST_TYPE[s.listType];N(s.id,c),o="hlist"}else t==e.REMOVE_HEADING_LIST&&(n=DocUtil.getStylesWithoutHeadingList(),ee(a,s),o="removeHeadingList");var u=l.getParents(NODE_TYPE.BODY),p={};p[ATTR_BODY.DS_STYLES]=n,u.attr(p),y(o),Op.sendMsg()},ie=function(t){var i=t.chkdBulletId,n=t.unchkdBulletId,o=t.chkListData,r=t.format,a=(t.listObj,t.isUpdateCheckList);if(a)for(var l,d,u,f=CheckListOperations.getAllCheckListParasOfID(r.ls_data.id),E=CHECKLIST_STATES.UNCHECKED,T=function(e){E=e},m=0,h=f.length;m<h;m++)l=f[m],d=l.dtNode.paraProperties.listData.listLevel,u=l.attr(),CheckListOperations.getCheckListState({style:u,callback:T}),u.ls_data.bullet_id=E===CHECKLIST_STATES.CHECKED?i:n,f[m].attr(u);$(t);var I={};I[c]={},I[c][s]=n,I[c].SVG_DATA=o.uncheckedData,I[g]={},I[g][p]=i,I[g].SVG_DATA=o.checkedData,K([e.APPLY_LIST,LIST_TYPE.IMAGE,I])},ne=function(t){var i=t[0];if(i==e.APPLY_UNORDER){var n=ListUtils.getDefaultListType(),o=n?n.unordered:null;if(o&&o.ListData)return void j(o.ListData)}K(t),PubSub.publish("ZWRange/ScrollIntoView")};return{manageListOption:K,manageHeadingListOption:te,applyImageList:V,applyUserImageList:X,applySymbolList:j,setBodyFormat:N,setBulletFormat:P,applyCheckList:ie,applyDefaultList:ne,getHeadingListId:R,removeHeadingListProperitesForParas:ee,applyListProperties:x,removeListProperties:H}}();var FontSizeCombo=function(){"use strict";var e=[],t=[36,30,44,48,54,60,66,72,80,90,96,105,120,144],i=["fmt-lpnl-fontsize","smart_fontSize","shape_fontSize"],n=function(){return editor.doc.getDefaultFontSizeList()},o=function(e){for(var t=s(),i=0,n=t.length;i<n;i++){var o=t[i],r={label:o,value:o};Z(e).zcombobox("addOptionAt",r,i)}},r=function(){for(var e=Z("watermark-fontSize"),i=0,n=t.length;i<n;i++){var o=t[i],r={label:o,value:o};e.zcombobox("addOptionAt",r,i)}e.zcombobox("setValue",72)},a=function(e){t.push(e),t.sort(function(e,t){return e-t});var i=t.indexOf(e),n={label:e,value:e};J("#watermark-fontSize").zcombobox("addOptionAt",n,i)},s=function(){return 0==e.length&&(e=n()),e.slice(0)},l=function(){return U.unique(t).slice(0)},d=function(t){e.push(t),e.sort(function(e,t){return e-t});for(var n=e.indexOf(t),o={label:t,value:t},r=0,a=i.length;r<a;r++)Z(i[r]).zcombobox("addOptionAt",o,n)};return{getDefaultFontSizeList:n,getFontSizeList:s,getWMFontSizeList:l,addFontSize:d,addFontSizeInWMCombo:a,addAllDefaultFontSizeInCombo:o,addDefaultFontSizesInWMCombo:r}}();!function(){"use strict";var e=function(e,t){for(var i=t?"none":"block",n=e.length,o=0;o<n;o++){var r=e[o];r.style.display=i}},t=function(t,i,n){this.id=t,this.onSearchCallBack=i,this.container=document.getElementById(this.id),this.isDefaultHide=n;var o=this.container.querySelectorAll("[data-search-pattern]");e(o,n)};t.prototype.onSearch=function(t){var i=this.container.querySelectorAll("[data-search-pattern]"),n=i.length;if(!t)return void e(i,this.isDefaultHide);for(var o=0;o<n;o++){var r=i[o],a=r.getAttribute("data-search-pattern");this.onSearchCallBack(t,a)?r.style.display="block":r.style.display="none"}},window.searchBar=t}(),StyleUtil=function(){var e=[ATTR_COMMON.BORDERS,ATTR_PARAGRAPH.PS_AL,ATTR_PARAGRAPH.PS_BGC,ATTR_PARAGRAPH.PS_DIR,ATTR_PARAGRAPH.PS_LS,ATTR_PARAGRAPH.PS_ML,ATTR_PARAGRAPH.PS_MR,ATTR_PARAGRAPH.PS_PB,ATTR_PARAGRAPH.PS_PL,ATTR_PARAGRAPH.PS_PR,ATTR_PARAGRAPH.PS_PT,ATTR_PARAGRAPH.PS_RI,ATTR_PARAGRAPH.PS_SA,ATTR_PARAGRAPH.PS_SB,ATTR_PARAGRAPH.PS_TI,ATTR_PARAGRAPH.PS_TS,ATTR_PARAGRAPH.PS_WS],t=[ATTR_COMMON.BORDERS,ATTR_PARAGRAPH.PS_AL,ATTR_PARAGRAPH.PS_BGC,ATTR_PARAGRAPH.PS_DIR,ATTR_PARAGRAPH.PS_LS,ATTR_PARAGRAPH.PS_MR,ATTR_PARAGRAPH.PS_PB,ATTR_PARAGRAPH.PS_PL,ATTR_PARAGRAPH.PS_PR,ATTR_PARAGRAPH.PS_PT,ATTR_PARAGRAPH.PS_RI,ATTR_PARAGRAPH.PS_TS,ATTR_PARAGRAPH.PS_WS],i=[ATTR_TEXT.TS_BGC,ATTR_TEXT.TS_CS,ATTR_TEXT.TS_FF,ATTR_TEXT.TS_FGC,ATTR_TEXT.TS_FS,ATTR_TEXT.TS_FV,ATTR_TEXT.TS_FW,ATTR_TEXT.TS_SIZE,ATTR_TEXT.TS_TD],n=function(e){var t=["undefined","null","none","transparent",""];return!(!e||t.indexOf(e)!=-1||e.indexOf("rgba")!=-1&&"0"==e[e.lastIndexOf(",")+1])},o=function(e,t){for(var n=i.length,o=0;o<n;o++){var r=i[o],a=e[r],s=t[r];StyleUtil.compareTextStyleForModification(r,a,s)||r!=ATTR_COMMON.TYPE&&delete t[r]}},r=function(i,n){for(var o=n.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)||ListUtils.isList(n)?t:e,r=o.length,a=0;a<r;a++){var s=o[a],l=i[s],d=n[s];StyleUtil.compareParaStyleForModification(s,l,d)||s!=ATTR_PARAGRAPH.TEXTFORMAT&&s!=ATTR_COMMON.TYPE&&delete n[s]}},a=function(e,t,i){var n=ZWJSONUtils.clone(t),o=ZWJSONUtils.clone(i);if(e==ATTR_PARAGRAPH.TEXTFORMAT||e==ATTR_COMMON.TYPE||e==ATTR_PARAGRAPH.PS_TS)return!1;if(e==ATTR_PARAGRAPH.PS_AL||e==ATTR_PARAGRAPH.PS_MR||e==ATTR_PARAGRAPH.PS_ML||e==ATTR_PARAGRAPH.PS_SB||e==ATTR_PARAGRAPH.PS_TI){if(o!=n&&!("undefined"==typeof o&&0==parseFloat(n)||"undefined"==typeof n&&0==parseFloat(o)))return!0}else if(e==ATTR_COMMON.BORDERS){if(!BorderUtils.compareBorders(o,n))return!0}else if(e==ATTR_PARAGRAPH.PS_BGC){if(!("rgba(0, 0, 0, 0)"!=n&&"rgb(0, 0, 0)"!=n&&"undefined"!=typeof n&&"none"!=n||"rgba(0, 0, 0, 0)"!=o&&"rgb(0, 0, 0)"!=o&&"undefined"!=typeof o&&"none"!=o))return!1;if((n?n.replaceAll(" ",""):n)!=(o?o.replaceAll(" ",""):o))return!0}else if(n!=o)return!0},s=function(e,t,i){var o=ZWJSONUtils.clone(t),r=ZWJSONUtils.clone(i);if(e==ATTR_COMMON.TYPE)return!1;if(e==ATTR_TEXT.TS_CS||e==ATTR_TEXT.TS_FS||e==ATTR_TEXT.TS_FV||e==ATTR_TEXT.TS_FW){if("0px|0pt|none|normal|undefined".match(o)&&"0px|0pt|none|normal|undefined".match(r))return!1;if(o!=r)return!0}else if(e==ATTR_TEXT.TS_TD){if("none|''|undefined".match(o)&&"none|''|undefined".match(r))return!1;if(o!=r)return!0}else if(e==ATTR_TEXT.TS_BGC||e==ATTR_TEXT.TS_FGC){if(o=o?o.replaceAll(" ",""):o,r=r?r.replaceAll(" ",""):r,!n(o)&&!n(r))return!1;if(o!=r)return!0}else if(e==ATTR_TEXT.TS_FF){if(o=o?o.split(",")[0]:"",r=r?r.split(",")[0]:"",o.toLowerCase().indexOf(r.toLowerCase())==-1)return!0}else if(e==ATTR_TEXT.TS_SIZE){if(parseFloat(o)!=parseFloat(r))return!0}else if(o!=r)return!0},l=function(i,n){for(var o=n.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)||ListUtils.isList(n)?t:e,r=o.length,s=0;s<r;s++){var l=o[s],d=n[l],c=i[l];if(a(l,d,c))return!0}return!1},d=function(e,t){for(var n=i.length,o=0;o<n;o++){var r=i[o],a=t[r],l=e[r];if(s(r,a,l))return!0}return!1},c=function(e,t){for(var n=i.length,o=0;o<n;o++){var r=i[o],a=e[r],l=t[r];if(("undefined"!=typeof a||"undefined"!=typeof l)&&s(r,a,l))return!1}return!0},u=function(e,t){var i=U.isEqual(e,t);for(var n in e)if("name"!=n&&"cs_name"!=n&&"shape"!=n&&"table"!=n&&(i="object"==typeof e[n]?n==ATTR_PARAGRAPH.TEXTFORMAT?c(e[n],t[n]):u(e[n]?e[n]:{},t[n]?t[n]:{}):U.isEqual(e[n]?e[n].toString():"",t[n]?t[n].toString():""),!i))break;return i},p=function(e,t){var i=u(e,t),n=u(t,e);return i&&n};return{compareAndRemoveTextStyles:o,compareAndRemoveParaStyles:r,compareParaStyleForModification:a,compareTextStyleForModification:s,isParaFormatModified:l,isTextFormatModified:d,compareStyleJson:p}}(),DesignTab=function(){var e=function(e){if("undefined"!=typeof e){var i=editor.doc.getSelection().getParents(NODE_TYPE.BODY),n={};n[ATTR_BODY.DS_THEME]=e,i.attr(n),t(n.theme.color.name)}},t=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.BODY),i=ChartThemeUtil.getChartColorJson(e),n={};n.chartColorJson=i,t.attr(n)},i=function(e){if("undefined"!=typeof e){var t=editor.doc.getSelection().getParents(NODE_TYPE.BODY),i={};i[ATTR_BODY.DS_STYLES]=e,i[ATTR_BODY.DS_THEME]=DocumentDesign.getTheme(),t.attr(i)}},n=function(e,t){var i=t.value;if(i!=t.previousValue){var n=DocumentDesign.getTheme();n.font.major.latin=i,editor.doc.execCmd("updateTheme",n)}},o=function(e,t){var i=t.value;if(i!=t.previousValue){var n=DocumentDesign.getTheme();n.font.minor.latin=i,editor.doc.execCmd("updateTheme",n)}},r=function(e,t){var i=t.value;if(i!=t.previousValue){var n=FontSets[i],o=DocumentDesign.getTheme();o.font.major.latin=n.major.latin,o.font.minor.latin=n.minor.latin,o.font.name=n.name,editor.doc.execCmd("updateTheme",o)}},a=function(e,t){var i=t.value;if(i!=t.previousValue){var n=DocumentDesign.getTheme();n.color=ColorSets[i],n.color.name=i,editor.doc.execCmd("updateTheme",n)}},s=function(e){var t=DesignSets[e];if("undefined"!=typeof t){var i=DocumentDesign.getStyles(),n=t.styles;DesignUtil.styleMerge(i,n),editor.doc.execCmd("updateStyles",i)}};return{setBodyTheme:e,setChartColorJson:t,setBodyStyles:i,changeFontHeading:n,changeFontBody:o,changeFontCombo:r,changeColorSet:a,changeStyleSet:s}}(),DesignTabUI=function(){var e=!1,t={"arial,helvetica,sans-serif":"Arial","arial black,avant garde":"Arial Black","courier new,courier,monospace":"Courier New","georgia,times new roman,times,serif":"Georgia","ms mincho,ipmincho,serif":"MSMincho","ms pmincho,ipapmincho,serif":"MSPMincho","tahoma,arial,helvetica,sans-serif":"Tahoma","times new roman,times,serif":"Times New Roman","trebuchet ms,geneva":"Trebuchet MS"},i=function(){return e},n=function(e){return J('<div data-styleset-name="'+Utils.encodeHTMLString(e)+'" class="ui-dstyle-menuitem"></div>')[0]},o=function(e){for(var t=J(e).parents().toArray(),i=0;i<t.length;i++)if(t[i].hasAttribute("data-styleset-name"))return t[i]},r=function(e){var t=e.target;t=t.hasAttribute("data-styleset-name")?t:o(t);var i=t&&t.getAttribute("data-styleset-name");i&&DesignTab.changeStyleSet(i)},a=function(e){var t=e.target;t=t.hasAttribute("data-styleset-name")?t:o(t);var i=t&&t.getAttribute("data-styleset-name");if(i){var n=J("#docstylespreviewMenu").find("[data-hdval]"),r="current-set"==i?DocumentDesign.getStyles():DesignSets[i].styles,a=DocumentDesign.getTheme().font,s=DocumentDesign.getTheme().color;r=DesignUI.getRenderingStyleSet(r,a,s);for(var l=0;l<n.length;l++){var d=n[l].getAttribute("data-hdval");StyleUI.applyHeadingStyleToElem(d,J(n[l]),r.para)}var c=J(".ui-spreview-menu-scalecont"),u=c[0].cloneNode(!0);J(u).css({position:"absolute",top:"-1000px",left:"-1000px",width:"175px"}).appendTo(document.body),c[0].parentNode.style.height=parseInt(.6*u.offsetHeight)+20+"px",c[0].parentNode.style.width="153px",u.parentNode.removeChild(u),J("#docstylespreviewMenu").zmenu("show",{forElement:J("#style-set-container"),direction:"right"})}},s=function(){var e=J("#styleSetMenu")[0];if(e){var t=Array.from(e.children),i=DesignUI.getDesignName();i&&0==i.name.indexOf("custom|")&&t.push(document.getElementById("custom-styleSetMenu").children[0]);for(var n=0;n<t.length;n++){var o=t[n],r=o.getAttribute("data-styleset-name"),a="current-set"==r?DocumentDesign.getStyles():DesignSets[r].styles,s=DocumentDesign.getTheme().font,l=DocumentDesign.getTheme().color;DesignUI.getCustomDesignPreview(a,s,l,o)}}},l=function(){var e=DesignUI.removeCustomStyles(DocumentDesign.getStyles()),t=DesignUtil.getStyleSetName(e);DesignUI.getDesignName();t||(t="current-set");var i=J("#style-set-container").find(".is-selected"),n=J("#style-set-container").find("[data-styleset-name='"+t+"']");i.removeClass("is-selected"),n.addClass("is-selected")},d=function(){if(i()){s(),T();var e=DesignUI.removeCustomStyles(DocumentDesign.getStyles()),t=DesignUtil.getStyleSetName(e);t?J("#fmt-lpnl-docdesign-custom-style-set-container").hide():(J("#fmt-lpnl-docdesign-custom-style-set-container").show(),u()),l();var n=DesignUtil.getFontName(DocumentDesign.getTheme().font);if("undefined"==typeof n){var o=DocumentDesign.getTheme().font.major.latin,r=DocumentDesign.getTheme().font.minor.latin;m(o,r),n=J.i18n("writer.common.CUSTOM")}J("#thmFntCombo").zlabeledselectbox("setValue",n),E();var a=DesignUtil.getColorName(DocumentDesign.getTheme().color);"undefined"==typeof a&&(h(DocumentDesign.getTheme().color),a=J.i18n("writer.common.CUSTOM")),J("#themeColorCombo").zlabeledselectbox("setValue",a);var d=!DesignUI.getDesignName();d?J("#designSave").zbutton("enable"):J("#designSave").zbutton("disable")}},c=function(){var e=DesignUI.getDesignName(),t=null,i=!1;e&&e.name.indexOf("custom|")!=-1?i=!0:(e=e.name,t=e.type),StyleUI.openNextParaStyleDlg(t,e,i)},u=function(){for(var e=DocumentDesign.getStyles(),t="current-set",i=_getStyleSetContainer(e,t),n=J("#custom-styleSetMenu"),o="<div data-show-arrow-icon='false' class='ui-doctheme-actbtn ui-doctheme-actbtn-more' title="+J.i18n("writer.common.MORE")+"><span class='ui-icon-moreoptions1-black-sm'></span></div>",r=n[0].lastElementChild;r;)n[0].removeChild(r),r=n[0].lastElementChild;J(o).appendTo(i),n.append(i),J(i).hover(a),J(i).find(".ui-doctheme-actbtn").click(function(e){J("#doc-styleset-options").zmenu("show",{forElement:J(e.target)})})};_getStyleSetContainer=function(e,t){var i=DesignUI.getCustomDesignPreview(e,DocumentDesign.getTheme().font,DocumentDesign.getTheme().color),o=n(t);return o.append(i),o};var p=function(){for(var e=["Low-key","High Spirits","Glasshouse","Earthy","Delightful","Fresh Thinking","School Newsletter","Creative Energy","Big Classic","The Writer","Tranquility","The Blogger"],t=0;t<e.length;t++){var i=e[t];styleSet=DesignSets[i].styles,styleSetContainer=_getStyleSetContainer(styleSet,i),D(styleSetContainer),J("#styleSetMenu").append(styleSetContainer)}},g=function(){S(DocumentDesign.getTheme().font.name)},f=function(){R("#themeColorCombo",ColorSets,DocumentDesign.getTheme().color.name)},E=function(e,t){J("#themeColorCombo").zlabeledselectbox("removeOption",[J.i18n("writer.common.CUSTOM")])},T=function(){J("#thmFntCombo").zlabeledselectbox("removeOption",[J.i18n("writer.common.CUSTOM")])},m=function(e,t){var i={},n=I(e,t);i.innerHTML=n.innerHtml,i.replaceWithText=!0,i.label=n.label,i.value=J.i18n("writer.common.CUSTOM"),J("#thmFntCombo").zlabeledselectbox("addOptionAt",i,0)},h=function(e){var t={},i=J.i18n("writer.common.CUSTOM"),n=_(i,e);t.innerHTML=n.innerHtml,t.replaceWithText=!0,t.label=n.label,t.value=i,J("#themeColorCombo").zlabeledselectbox("addOptionAt",t,0)},I=function(e,i){var n=i,o=e,r=t[n]?t[n]:DesignUtil.getStrippedFontName(n),a=t[o]?t[o]:DesignUtil.getStrippedFontName(o),s='<div class="ui-themefont" style="text-align:left;width:192px;margin-top:2px;"><div style="font-family:'+o+';">'+a+'<span style="font-size: 11px;font-family: sans-serif;"> (Headings) </span></div>',l='<div style="font-family:'+n+';">'+r+'<span style="font-size: 11px;font-family: sans-serif;"> (Body) </span></div></div>';return{innerHtml:s+l,label:s}},_=function(e,t){var i="<div>"+e+"</div>",n='<div class="ui-themeclrschema"><span style="background: '+t.dark2+';"></span><span style="background:'+t.light2+';"></span><span style="background:'+t.accent1+';"></span><span style="background: '+t.accent2+';"></span><span style="background:'+t.accent3+';"></span><span style="background:'+t.accent4+';"></span><span style="background:'+t.accent5+'"></span><span style="background:'+t.accent6+';"></span></div>';return{innerHtml:i+n,label:n}},A=function(e){for(var t="<div><span >",i="</span> : <span>",n="</span></div>",o="",r=StyleUI.getHeadingArr(),a=0;a<r.length;a++){var s=r[a].substr(1),l=e.para["h"+s],d=l.info.next;o+=t+StyleUI.getDocumentParaMapping(s)+i+StyleUI.getDocumentParaMapping(d.substring("h".length))+n}return o},S=function(e){var t=U.keys(FontSets);J("#thmFntCombo").empty();for(var i=DocumentDesign.getTheme(),n=0;n<t.length;n++){var o={},r=t[n],a=FontSets[r].major.latin,s=FontSets[r].minor.latin,l=I(a,s);o.innerHTML=l.innerHtml,o.replaceWithText=!0,o.label=l.label;var d=document.createElement("option");J("#thmFntCombo").append(d),J(d).attr({data:JSON.stringify(o),value:r})}J("#thmFntCombo").zlabeledselectbox("refresh"),J("#thmFntCombo").zlabeledselectbox("setValue",e?e:i.font.name)},R=function(e,t,i){var n=U.keys(t);J(e).empty();for(var o=(DocumentDesign.getTheme(),0);o<n.length;o++){var r={},a=n[o],s=_(a,t[a]);r.innerHTML=s.innerHtml,r.replaceWithText=!0,r.label=s.label;var l=document.createElement("option");J(e).append(l),J(l).attr({data:JSON.stringify(r),value:a})}J(e).zselectbox("refresh"),J(e).zselectbox("setValue",i)},O=function(){UIUtils.initComponent("menuDesign"),e=!0,PubSub.publish("Design/Panel/init"),DesignUI.initializeThemeOptionGroup(),g(),f(),p(),u(),d(),AllStylesPanel.init(),DesignUtil.isWorkdriveUser()&&!DesignUtil.isWorkDrivePersonalUser()&&DesignUtil.retreiveOrgDesign()},b=function(){LeftPanel.showSubPanel(ELEM_ID.DESIGNPANEL),PubSub.publish("Design/Panel/open")},v=function(){LeftPanel.showAdvancedPanel({panelId:"subpanel-styles",animationType:ANIMATIONS.FLIPIN,parentPanels:["menu-design"]})},D=function(e){J(e).click(r),J(e).hover(a)},L=function(){var e=DesignUI.getCurrentDesignSet();DesignUtil.setAsDefault(e)},N=function(){var e=DesignUI.getDesignName();e&&"The Writer"==e.name?J("#docstylesMoreOpts").zmenu("setMenuItemsAttribute",["#docdesign-reset"],"disabled",!0):J("#docstylesMoreOpts").zmenu("setMenuItemsAttribute",["#docdesign-reset"],"disabled",!1)};return PubSub.subscribe("Document/themeChanged",d),PubSub.subscribe("DocumentDesign/Saved",d),{isDesignTabIntialized:i,setCurrentDesignAsDefault:L,getThemeColorHTML:_,getThemeFontsHTML:I,beforeDesignMenuShow:N,getNextStyleHTML:A,openSubPanel:v,init:O,showPanel:b,openNextStyleDlg:c}}(),AllStylesPanel=function(){"use strict";var e=[],t="all-styles-panel-headingstyle",i=!1,n=function(e){},o=function(e,i){StyleUI.renameHeadingStyleInUI(e,i,t)},r=function(i){var n=DocumentDesign.getComputedParaStyle(i).info.cs_name,o=e.indexOf(n);o!=-1&&e.splice(o,1),StyleUI.removeHeadingStyleInUI(i,t)},a=function(e,i){StyleUI.selectHeadingStyleInUI(e,i,t,"allstylespnl-")},s=function(){e=[],StyleUI.removeAllHeadingMenuItems(t)},l=function(e){},d=function(){if(!SavedStyles.para||!Object.keys(SavedStyles.para).length)return void J("#style-lib").hide();for(var e in SavedStyles.para){var t=SavedStyles.para[e].style,i=SavedStyles.para[e].description,n=SavedStyles.para[e].style.info.cs_name,o={style:t,id:e,description:i,cs_name:n};p(o)}},c=function(e){J("#all-styles").zaccordion("expandPanel",0),QuickStyle.applyUserHeadingStyle(e)},u=function(e,t){var i=e.originalEvent.originalEvent,n=J(i.target).closest(".ui-slibitem-del-icon");return!i||!n.length||(StyleUI.deleteUserHeadingStyle(n[0].id),e.stopPropagation(),!1)},p=function(e){if(i){J("#style-lib").show();var t=e.cs_name,n=(e.description,e.style),o=e.id,r={itemType:"custom",innerHTML:'<div class="clearfix"><span class="zmenu__text">'+Utils.encodeHTMLString(t)+'</span><span id="'+o+'" class="ui-slibitem-del-icon ui-fr zbutton__icon ui-sprit-lazy ui-icon-delete-blk-sm ui-ms-pointer ui-hide"></span></div>',appData:{action:"AllStylesPanel.applyStyleInStyleLibrary",params:[o]},label:t,class:"contentHeading contentHeading1",customAttributes:{id:"libraryHeading"+o,class:"custom-para-styles zmenu--split"}};J("#all-styles-panel-headingstylelibrary").zmenu("addMenuItem",r);var a=J("#libraryHeading"+o+" .zmenu__text"),s={};s[o]=n,StyleUI.applyHeadingStyleToElem(o,a,s)}},g=function(e){var t=e.id,i=SavedStyles.para?Object.keys(SavedStyles.para):[];!i.length||1==i.length&&i[0]==t?(J("#style-lib").hide(),J("#all-styles").zaccordion("expandPanel",0)):J("#style-lib").show(),J("#all-styles-panel-headingstylelibrary").zmenu("removeMenuItem",J("#libraryHeading"+t))},f=function(){i=!0,d()};return PubSub.subscribe("HeadingStyle/Add",n),PubSub.subscribe("HeadingStyle/Rename",o),PubSub.subscribe("HeadingStyle/Delete",r),PubSub.subscribe("HeadingStyle/CursorPosition",a),PubSub.subscribe("HeadingStyle/Update",l),PubSub.subscribe("HeadingStyle/RemoveAll",s),PubSub.subscribe("HeadingStyleLibrary/Add",p),PubSub.subscribe("HeadingStyleLibrary/Delete",g),{init:f,docStylesMenuId:t,applyStyleInStyleLibrary:c,beforeClick:u}}(),StyleUI=function(){var e,t,i={},n={},o=[],r=!1,a={},s={},l="h0|h1|h2|h3|h4|h5|h6|h7|h8|h9|h101|h102|h103|h104|h105|h106",d={0:UIUtils.getUIText("HEADING0"),1:UIUtils.getUIText("HEADING1"),2:UIUtils.getUIText("HEADING2"),3:UIUtils.getUIText("HEADING3"),4:UIUtils.getUIText("HEADING4"),5:UIUtils.getUIText("HEADING5"),6:UIUtils.getUIText("HEADING6"),7:UIUtils.getUIText("HEADING7"),8:UIUtils.getUIText("HEADING8"),9:UIUtils.getUIText("HEADING9"),101:UIUtils.getUIText("HEADING101"),102:UIUtils.getUIText("HEADING102"),103:UIUtils.getUIText("HEADING103"),104:UIUtils.getUIText("HEADING104"),105:"writer.styles.LIST_PARAGRAPH",106:"writer.styles.NO_SPACING"},c=[ATTR_COMMON.BORDERS,ATTR_PARAGRAPH.PS_AL,ATTR_PARAGRAPH.PS_BGC,ATTR_PARAGRAPH.PS_DIR,ATTR_PARAGRAPH.PS_LS,ATTR_PARAGRAPH.PS_MR,ATTR_PARAGRAPH.PS_PB,ATTR_PARAGRAPH.PS_PL,ATTR_PARAGRAPH.PS_PR,ATTR_PARAGRAPH.PS_PT,ATTR_PARAGRAPH.PS_RI,ATTR_PARAGRAPH.PS_TPS,ATTR_PARAGRAPH.PS_TS,ATTR_PARAGRAPH.PS_WS],u="<div id='style-creation-info' class='ui-style-empty-cont'><div>"+J.i18n("writer.styles.STYLE_LIBRARY_NOTE")+"</div><a href='"+editorProps.urls.helpPageURL+"working-with-document-styles.html' target='_blank'>"+J.i18n("writer.styles.LEARN_MORE_ABT_STYLE_LIBRARY")+"</a></div>",p=function(){r=!1},g=function(){r=!0,UIUtils.initComponent("modified-heading-style")},f=function(e){t.onSearch(e)},E=function(e,t){var i=t.split(" "),n=e.split(" "),o=!0,r=i.length,a=n.length;if(r<a)return!1;if(a<2){for(var s=0;s<r;s++)if(0==i[s].toLowerCase().indexOf(e.toLowerCase()))return!0;o=!1}else for(var s=0;s<a;s++){if(s+1==a){o=!1;for(var l=0;l<r;l++)if(0==i[l].toLowerCase().indexOf(n[s].toLowerCase()))return!0}else{o=!1;for(var l=0;l<r;l++)if(n[s].toLowerCase()==i[l].toLowerCase()){o=!0;break}}if(!o)break}return o},T=function(e){var t=a&&e?a[e]:ZWJSONUtils.clone(a);return t},m=function(){var e=CurUtil.offset.start.top*editor.zoomFactor,t=(editor.doc.getSelection(),Z(ELEM_ID.EDITORRIGHTPANEL));return t.is(":visible")?{top:e,left:"auto",right:editor.jeditorPaneWrapper.width()-(editor.jeditorPane.width()-10)*editor.zoomFactor+"px"}:{top:e,right:"auto",left:(editor.jeditorPane.width()+10)*editor.zoomFactor+"px"}},h=function(e){var t=m();return e&&(t.top=UIUtils.getVisibleAreaTop()),t},I=function(){J("#visual-queue-headingmenubtn").hide()},_=function(){J("#visual-queue-headingmenubtn").show()},A=function(e){if(editor.getRole().permissions.can("document.edit")){var t=editor.doc.getSelection(),i=t&&DocUtil.copyStyle(t.getParaFormat()),n=parseInt(i&&i[ATTR_PARAGRAPH.PS_HD]||0);if(!n||U.isEmpty(i)||i.hasOwnProperty("ls_data")||!QuickStyle.isCompleteHeadingModified())return void I();_();var o=d[n];o="undefined"==typeof o?J.i18n("writer.common.CUSTOM"):J.i18n(o),J("#visual-queue-headingmenubtn").zmenubutton("changeLabel",o+"*");var r=1,a=1,s=Z(ELEM_ID.EDITORRIGHTPANEL);s.is(":visible")&&(r=1,a=.5),J("#visual-queue-headingmenubtn").mouseover(function(){J("#visual-queue-headingmenubtn").css({opacity:r})}),J("#visual-queue-headingmenubtn").mouseout(function(){J("#visual-queue-headingmenubtn").css({opacity:a})}),J("#visual-queue-headingmenubtn").css({opacity:a}),J("#visual-queue-headingmenubtn").css(h(e))}},S=function(){var e=DocumentDesign.getStyles().para,t=Object.keys(e);for(var t in e){var i=parseInt(t.substr(1)),n=e[t].info,o=n.cs_name;if("undefined"==typeof o){var r=d[i];o=J.i18n(r)}a[i]=o}},R=function(e,t){var i=StyleUI.getDocumentParaMapping(),n=t.data.headingId.substr(1);i[n];applyCustomHeading=J.i18n("writer.format.APPLY_TO_CUSTOM_HEADING",[i[n]]),updateCustomHeading=J.i18n("writer.styles.UPDATEHD",[i[n]]),addHeadingToLibrary=J.i18n("writer.format.ADD_TO_STYLE_LIBRARY"),J("#contentHeadingList").zmenu("setMenuItemsAttribute",["#renameHeadingStyle"],"appData",{action:"StyleUI.openRenameStyleDlg",params:"h"+n}),n>106?(J("#contentHeadingList").zmenu("setMenuItemsAttribute",["#deleteHeadingFromDocument"],"hidden",!1),J("#contentHeadingList").zmenu("setMenuItemsAttribute",["#deleteHeadingFromDocument"],"appData",{action:"QuickStyle.removeUserHeadingStyle",params:"h"+n})):J("#contentHeadingList").zmenu("setMenuItemsAttribute",["#deleteHeadingFromDocument"],"hidden",!0),J("#contentHeadingList").zmenu("setMenuItemsAttribute",["#contentHeadingListApplyMatch"],"appData",{action:"QuickStyle.onBeforeUpdateHeadingStyle",params:[n]}),J("#contentHeadingList").zmenu("setMenuItemsAttribute",["#contentHeadingListApplyMatch"],"label",updateCustomHeading),J("#contentHeadingList").zmenu("setMenuItemsAttribute",["#contentHeadingAddToLibrary"],"appData",{action:"StyleUI.openSaveStyleDialogue",params:[t.data.headingId,i[n]]})},O=function(e,t,i,n){i||(i="fmt-lpnl-headingmenulist"),handleModifiedStateCard(e,t,i,n),J("#"+i).zmenu("setMenuItemsAttribute",["#contentHeading"+e],"checked",!0)},b=function(e,t,i){var n=e.substr(1);i||(i="fmt-lpnl-headingmenulist"),J("#"+i).zmenu("setMenuItemsAttribute",["#contentHeading"+n],"label",t)},v=function(e,t){var i=e.substr(1);t||(t="fmt-lpnl-headingmenulist"),J("#"+t).zmenu("removeMenuItem",J("#contentHeading"+i))},D=function(e,t,i){t||(t="fmt-lpnl-headingmenulist");for(var n=[],r=0,s=e.length;r<s;r++){var l=-1,d=e[r],c=DocumentDesign.getParaStyle(d);DOC_PARA_STYLES.indexOf(d)==-1&&c.info.hasOwnProperty("savedStyle")&&1==c.info.savedStyle&&(o.push(c.info.cs_name),l=DesignUI.getInsertPosition(c.info.cs_name,o));var u=DocumentDesign.getStyleUIInfo();if(!u||!u.para.hasOwnProperty(d)||"hidden"!==u.para[d].status&&!u.para[d].deleted){var p={name:"radioitems",itemType:"radio",splitmenu:!0,appData:{action:"editor.doc.execCmd",params:["FormatBlock",d.substr(1)]},label:a[d.substr(1)],headingId:d,menuId:"contentHeadingList",class:"contentHeading contentHeading"+d.substr(1),customAttributes:{id:"contentHeading"+d.substr(1),class:"custom-para-styles contentHeading"+d.substr(1)}};if(i)for(var g in i)p[g]=i[g];parseInt(d.substr(1))>0&&parseInt(d.substr(1))<=6&&(p.actionName="Heading"+parseInt(d.substr(1))),l!=-1?p.index=l+1:void 0,n.push(p)}}var f=[t];document.getElementById(AllStylesPanel.docStylesMenuId)&&f.push(AllStylesPanel.docStylesMenuId);for(var r=0,s=f.length;r<s;r++)J("#"+f[r]).zmenu("addMenuItems",n),J("#"+f[r]).off("zmenusubmenuitemclick")},L=function(e){e||(e="fmt-lpnl-headingmenulist"),J("#"+e).zmenu("removeMenuItem",".custom-para-styles")},N=function(e){for(var t=e?e:DocumentDesign.getStyles(),i=t.para,n=[],o=DOC_PARA_STYLES.length,r=0;r<o;r++){var a=DOC_PARA_STYLES[r];n.push(a)}for(var a in i)l.match(a)||n.push(a);return n},P=function(){S(),PubSub.publish("HeadingStyle/RemoveAll"),PubSub.publish("HeadingStyle/Add",N()),g()},C=function(e){var t=SavedStyles.para[e].style.info.cs_name,i=J.i18n("writer.styles.DELETE_PARA_STYLE_MSG",[t]);MsgDialog.showMessage(CONST.MSG_TYPE_DELETECANCEL,"info",J.i18n("writer.styles.DELETE_PARA_STYLE"),i,null,function(t){if(1==t){var i={};i.operation="delete",i.id=e.toString(),i.type="para",i.cs_name=QuickStyle.getParaStyleNameForId(i.id),QuickStyle.updateUserHeadingStyles(i)}},null)},y=function(e){J("#"+e.id).remove(),delete SavedStyles.para[e.id];var t=document.getElementsByClassName("ui-style-item-selected");0==t.length?J("#use-style").zbutton("disable"):J("#use-style").zbutton("enable"),0==document.getElementsByClassName("ui-style-item").length&&(document.getElementById("library-styles").innerHTML=u,document.getElementById("style-library-search-container").style.display="none")},F=function(e){var t=document.getElementById("style-msg-box");t?t.innerText=e:void 0},M=function(t,i){var n=document.getElementById("styleName"),o=(document.getElementById("style-msg-box"),n.value),r=/^(a-z|A-Z|0-9)*[^:*?()#%^&<>";'|\\\\\/]*$/;if(!e&&(o.length>0||"focusout"==i)&&(e=!0),e){if("focusout"==i)return void(U.isEmpty(o)&&(setTimeout(F,250,J.i18n("writer.common.FIELD_CANT_EMPTY")),J("#style-primary-btn").zbutton("disable")));U.isEmpty(o)?("save"==t?F(J.i18n("writer.styles.STYLE_NAME_CANNOT_BE_EMPTY")):"rename"==t&&F(J.i18n("writer.styles.STYLE_RENAME_CANNOT_BE_EMPTY")),J("#style-primary-btn").zbutton("disable")):r.test(o)?"save"==t&&QuickStyle.getParaStyleIdForName(o)||"rename"==t&&QuickStyle.getDocStyleIdForName(o)?(F(J.i18n("writer.design.DESIGN_NAME_EXIST")),J("#style-primary-btn").zbutton("disable")):(F(""),J("#style-primary-btn").zbutton("enable")):(F(J.i18n("writer.styles.SPECIAL_CHARS_NOT_ALLOWED",["# : * ? ) ( \\ / % < > &quot; ' |"])),J("#style-primary-btn").zbutton("disable"))}},w=function(e,t){var i=(DocumentDesign.getComputedStyles(),editor.doc.getSelection()),n=ZWJSONUtils.clone(i.textFormat),o=ZWJSONUtils.clone(i.paraFormat),r=DocumentDesign.getComputedParaStyle("h"+e);if(n=DocUtil.getRenderingFormat(n),o=DocUtil.getRenderingFormat(o),r){var a,s=r.textFormat;ZWJSONUtils.mergeJsonObjs(s,n),s[ATTR_TEXT.TS_SIZE]=s[ATTR_TEXT.TS_SIZE]>18?18:s[ATTR_TEXT.TS_SIZE],s[ATTR_TEXT.TS_SIZE]=s[ATTR_TEXT.TS_SIZE]<8?8:s[ATTR_TEXT.TS_SIZE],a=Utils.getStyle(s),t.removeAttr("style");var l=a.styles;for(var d in l)t.css(d,l[d]);if(r.hasOwnProperty(ATTR_PARAGRAPH.PS_BGC)){var c=o[ATTR_PARAGRAPH.PS_BGC]||r[ATTR_PARAGRAPH.PS_BGC];t.css("backgroundColor",c)}}},x=function(e){var t=DocumentDesign.getComputedParaStyle(e),i=t[ATTR_PARAGRAPH.TEXTFORMAT];return i.hasOwnProperty(ATTR_TEXT.TS_SIZE)&&(i[ATTR_TEXT.TS_SIZE]=i[ATTR_TEXT.TS_SIZE]>17?17:i[ATTR_TEXT.TS_SIZE]),t.hasOwnProperty(ATTR_PARAGRAPH.PS_BGC)&&(i[ATTR_TEXT.TS_BGC]=t[ATTR_PARAGRAPH.PS_BGC]),Utils.constructStyleText(i)},B=function(e,t,i,n){var o=i?i[e]:DocumentDesign.getComputedParaStyle(e),r=o[ATTR_PARAGRAPH.TEXTFORMAT];r.hasOwnProperty(ATTR_TEXT.TS_SIZE)&&(r[ATTR_TEXT.TS_SIZE]=r[ATTR_TEXT.TS_SIZE]>17?17:r[ATTR_TEXT.TS_SIZE]);var a=Utils.getStyle(r);t.removeAttr("style");var s=a.styles;for(var l in s)t.css(l,s[l]);return o.hasOwnProperty(ATTR_PARAGRAPH.PS_BGC)&&t.css("backgroundColor",o[ATTR_PARAGRAPH.PS_BGC]),a};setStyleForHeadingButton=function(e,t){var i=t?t:J("#fmt-lpnl-headingmenubtn .zbutton__text");w(e,i)},updateHeadingUI=function(e,t,i,n){var o,r,s=[],l=[],c=[];if(n.body&&n.body.styles&&n.body.styles.para){o=n.body.styles.para,r=i.styles.para;for(var u in o)"undefined"==typeof r[u]&&s.push(u),"undefined"!=typeof r[u]&&"undefined"!=typeof o[u]&&r[u].info.cs_name!==o[u].info.cs_name&&c.push(u)}if(n.body&&n.body.styleUIInfo){newParaStylesUI=n.body.styleUIInfo.para,oldParaStylesUI=i.styleUIInfo.para;for(var u in oldParaStylesUI)if(!oldParaStylesUI[u].deleted&&newParaStylesUI[u].deleted){var p=DocumentDesign.getComputedParaStyle(u).info.cs_name;l.push(u)}}for(var g=s.length,f=0;f<g;f++){var E=s[f].substr(1),p=o[s[f]].info.cs_name;a[parseInt(E)]=p}for(var T=l.length,f=0;f<T;f++)PubSub.publish("HeadingStyle/Delete",l[f]);for(var m=c.length,f=0;f<m;f++){var h=c[f],E=h.substr(1),p=o[h].info.cs_name||d[E]&&J.i18n(d[E]);a[parseInt(E)]=p,PubSub.publish("HeadingStyle/Rename",h,p)}},updateHeadingStylesMenu=function(){r||StyleUI.constructHeadingStyleMenu()},handleModifiedStateCard=function(e,t,i,n){i||(i="fmt-lpnl-headingmenulist");var o=J("#"+i);n=n?n:"",t?(o.zmenu("showMenuItems",[n+"modified-heading-style"]),J("#"+n+"heading-modified-card-text")[0]&&(J("#"+n+"heading-modified-card-text")[0].innerText=a[e],setStyleForHeadingButton(e,J("#"+n+"heading-modified-card-text"))),J("#fmt-lpnl-headingmenubtn").addClass("ui-headinglist-btn-with-star")):(o.zmenu("hideMenuItems",[n+"modified-heading-style"]),J("#fmt-lpnl-headingmenubtn").removeClass("ui-headinglist-btn-with-star"))},updateHeadingStyleButtons=function(){var e=DocUtil.copyStyle(editor.doc.getSelection().getParaFormat()),t=e[ATTR_PARAGRAPH.PS_HD]||0,i=QuickStyle.isHeadingStyleModified(parseInt(t),e);UIUtils.uiFontStyle.zmenubutton("changeLabel",a[t]),PubSub.publish("HeadingStyle/CursorPosition",t,i)};var H=function(e){for(var t in e)t!=ATTR_PARAGRAPH.TEXTFORMAT&&c.indexOf(t)==-1&&delete e[t]},G=function(e){var t;if(e)t=DocumentDesign.getComputedParaStyle(e),(t.hasOwnProperty("ls_data")||"list"==t[ATTR_PARAGRAPH.PS_TYPE])&&H(t);else{var i=editor.doc.getSelection(),n=ZWJSONUtils.clone(i.textFormat),o=ZWJSONUtils.clone(i.paraFormat);(o.hasOwnProperty("ls_data")||"list"==o[ATTR_PARAGRAPH.PS_TYPE])&&H(o),n=DocUtil.getRenderingFormat(n),o=DocUtil.getRenderingFormat(o),ZWJSONUtils.mergeJsonObjs(o.textFormat,n),t=o}return t},k=function(){if(!i.hasOwnProperty("invalid")){var e=Utils.getRandomNumber(),t={},n=i.style,o={};o[e]=n,o=DocUtil.getRenderingFormat(o,DocumentDesign.getTheme()),t.operation="add",t.cs_name=i.name,t.id=e.toString(),t.type="para",t.style=o[e],t.style.info={},t.style.info.next="h0",t.style.info.cs_name=i.name,t.isStyleFromCursor=i.isStyleFromCursor,t.style.info.savedStyle=!0,i.description?t.description=i.description:void 0,shouldNotCarryParaStyle.filter(function(e){e!=ATTR_PARAGRAPH.TEXTFORMAT&&delete t.style[e]}),shouldNotCarryTextStyle.filter(function(e){delete t.style.textFormat[e]}),QuickStyle.updateUserHeadingStyles(t),J.dialogutil.close("headingstylesavedlg")}},W=function(t){var n=t&&t[0],o=t&&t[1],r={init:function(){J("#style-primary-btn").zbutton("disable"),e=!1;var t=G(n);i={},i.description=null,i.isStyleFromCursor=!n,i.style=ZWJSONUtils.clone(t),t[ATTR_PARAGRAPH.TEXTFORMAT].hasOwnProperty(ATTR_TEXT.TS_SIZE)&&(t[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE]=t[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE]>18?18:t[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE]);var o=Utils.getStyle(t[ATTR_PARAGRAPH.TEXTFORMAT]),r=Utils.getStyle(t),a=o.styles,s=r.styles,l=document.getElementById("ui-heading-style-preview-spn-element"),d=document.getElementById("ui-heading-style-preview-para-element");for(var c in a)J(l).css(c,a[c]);for(var c in s)"line-height"!=c&&J(d).css(c,s[c])},get:function(){o&&!QuickStyle.getParaStyleIdForName(o)&&(document.getElementById("styleName").setAttribute("value",o),J("#style-primary-btn").zbutton("enable"))},set:function(e,t){var n=new RegExp("^(a-z|A-Z|0-9)*[^:*?()#%^&<>\";'|\\\\/]*$");"name"==e.action?t?QuickStyle.getParaStyleIdForName(t)?i.invalid="nameExist":n.test(t)?(delete i.invalid,i.name=t):i.invalid="invalidChar":i.invalid="null":"description"==e.action&&(i.description=t)}};J.dialogutil.open("headingstylesavedlg",null,r)},Y=function(e,t){t=U.isEmpty(t)?"":"<br><br><span>"+Utils.encodeHTMLString(t)+"</span>";var i=e.textFormat[ATTR_TEXT.TS_FGC],n=e.ls?e.ls:0,o=e.sa?e.sa:0,r=e.textFormat.size,i=U.isEmpty(i)?void 0:ZWColorUtils.rgbToHex(i),a='<div style="font-size: 11px;max-width: 115px;padding: 3px 3px;border-radius: 3px;"><div style="font-style:italic;"><span>'+r+'pts</span>,<span style="display:inline-block;width:8px;height:8px;box-shadow: 0 0 1px #ccc;background: '+i+';margin: 0px 3px;" class="ui-ttip-stl-clr"></span><span>'+i+'</span><br><span class="ui-colon ui-right-margin-vsmall">Line Spacing</span><span>'+n+'</span><br><span class="ui-colon ui-right-margin-vsmall">Spacing After</span><span>'+o+"</span></div>"+Utils.encodeHTMLString(t)+"</div>";return a},z=function(e,t){var i=document.createElement("div"),n=t.style,o="",r=["left","center","right","justify"],a=Y(n,t.description),s=DomUtil.getBorderStyles(n);U.isEmpty(s)||(parseInt(s["border-bottom-left-radius"])>25?s["border-bottom-left-radius"]="25px":void 0,parseInt(s["border-bottom-right-radius"])>25?s["border-bottom-right-radius"]="25px":void 0,parseInt(s["border-top-left-radius"])>25?s["border-top-left-radius"]="25px":void 0,parseInt(s["border-top-right-radius"])>25?s["border-top-right-radius"]="25px":void 0,parseInt(s.paddingBottom)>15?s.paddingBottom=15:void 0,parseInt(s.paddingLeft)>15?s.paddingLeft=15:void 0,parseInt(s.paddingRight)>15?s.paddingRight=15:void 0,parseInt(s.paddingTop)>15?s.paddingTop=15:void 0),"undefined"!=typeof n.al&&(o="ui-style-item-"+r[parseInt(n.al)]+" "),n[ATTR_PARAGRAPH.TEXTFORMAT].hasOwnProperty(ATTR_TEXT.TS_SIZE)&&(n[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE]=n[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE]>18?18:n[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE]),i.innerHTML="<div noi18n='true' id="+e+" class='"+o+"ui-style-item ui-ms-pointer' data-title-is-message-html-encoded='true' data-title-class-name='ui-slib-ttip' data-title-position='follow-cursor' title='"+a+"'><div onclick='StyleUI.deleteUserHeadingStyle("+e+")' class='ui-style-delete-icon ui-fr zbutton__icon ui-sprit-lazy ui-icon-delete-blk-sm ui-hide'></div><div class='ui-style-item-inner-cont'><div class='ui-preview-lines-sm ui-preview-lines-sm1'></div><div class='ui-preview-lines-sm ui-preview-lines-sm2'></div><div class='ui-stylecard-para'><span class='ui-stylecard-txt'>"+Utils.encodeHTMLString(n.info.cs_name)+"</span></div><div class='ui-preview-lines-sm ui-preview-lines-sm3'></div><div class='ui-preview-lines-sm'></div></div></div>";var l=i.getElementsByClassName("ui-stylecard-txt")[0],d=i.getElementsByClassName("ui-stylecard-para")[0],c=Utils.getStyle(n[ATTR_PARAGRAPH.TEXTFORMAT]),u=c.styles;for(var p in u)J(l).css(p,u[p]);return J(d).css(s),n.hasOwnProperty(ATTR_PARAGRAPH.PS_BGC)&&J(d).css("backgroundColor",n[ATTR_PARAGRAPH.PS_BGC]),i.firstElementChild},V=function(){var e=document.getElementsByClassName("ui-style-item-selected"),t=parseInt(e[0].getAttribute("id"));U.isNaN(t)?void 0:QuickStyle.applyUserHeadingStyle(t),J.dialogutil.close("stylelibrarydlg")},j=function(e){if(e.target.className.indexOf("ui-style-delete-icon")==-1){J("#use-style").zbutton("enable");var t=document.getElementsByClassName("ui-style-item-selected");t[0]&&t[0].classList.remove("ui-style-item-selected"),this.className+=0!=this.className.length?" ui-style-item-selected":"ui-style-item-selected"}},X=function(e){e.target.className.indexOf("ui-style-delete-icon")==-1&&V()},K=function(){var e={init:function(){J("#stylelibrarydlg").on("zdialogbeforeclose",function(){PubSub.unsubscribe("HeadingStyleLibrary/Delete",y)}),PubSub.subscribe("HeadingStyleLibrary/Delete",y),J("#use-style").zbutton("disable");var e=document.getElementById("style-library-search-box"),i=document.getElementById("library-styles"),n=SavedStyles.para,o=[],r={};n&&0!=Object.keys(n).length||(document.getElementById("library-styles").innerHTML=u,document.getElementById("style-library-search-container").style.display="none");for(var a in SavedStyles.para){var s=SavedStyles.para[a].style.info.cs_name;o.push(s),r[s]=a}o.sort(function(e,t){return DesignUI.compareStrings(e,t)});for(var l=0;l<o.length;l++){var a=r[o[l]],d=ZWJSONUtils.clone(n[a]),c=d.style,p=c.info.cs_name,g=document.createElement("div");if(c[ATTR_PARAGRAPH.TEXTFORMAT].hasOwnProperty(ATTR_TEXT.TS_SIZE)){var f=c[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE];f>=30?f=18:f>12&&f<30&&(f=12),c[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE]=f}var T=Utils.getStyle(c[ATTR_PARAGRAPH.TEXTFORMAT]),g=(T.styles,z(a,d));g.setAttribute("data-search-pattern",p),g.onclick=j,g.ondblclick=X,i.appendChild(g)}t=new searchBar("library-styles",E),e&&e.setAttribute("oninput","StyleUI.onSearch(event.target.value)")}};J.dialogutil.open("stylelibrarydlg",null,e)},q=function(){n.hasOwnProperty("invalid")||(editor.doc.execCmd("renameHeadingStyle",n),J.dialogutil.close("headingstylerename"))},Q=function(t){var i=DocumentDesign.getComputedParaStyle(t).info.cs_name||d[t.substr(1)]&&J.i18n(d[t.substr(1)]),o={init:function(){n={},J("#style-primary-btn").zbutton("disable"),e=!1},get:function(){var e=document.getElementById("styleName");e.setAttribute("value",i),setTimeout(function(){e.select()},10),J("#style-primary-btn").zbutton("disable")},set:function(e,i){var o=new RegExp("^(a-z|A-Z|0-9)*[^:*?()#%^&<>\";'|\\\\/]*$");"name"==e.action&&(i?QuickStyle.getDocStyleIdForName(i)?n.invalid="nameExist":o.test(i)?(delete n.invalid,n.name=i,n.headingId=t):n.invalid="invalidChar":n.invalid="null")}};J.dialogutil.open("headingstylerename",null,o)},$=function(){var e=s.desginData.designType,t=s.desginData.designId;if(e&&"writer"!=e){var i=s.desginData.designName,n="user"==e?SavedDesign[i]:DesignUtil.getOrgDesign()[t].content,o=n[ATTR_BODY.DS_STYLES];for(var r in s._nextParaStyleObj)o.para[r].info.next=s._nextParaStyleObj[r];UIUtils.showLoadingMsg(J.i18n("writer.common.UPDATING"));var a=function(){UIUtils.hideLoadingMsg(),te(),i="user"==e?i.substr("custom|".length):i,s.desginData.isAppliedToDocument?(ee(),UIUtils.showMessage("info",J.i18n("styles","NEXT_PARA_UPDATED_FOR_USER_DESIGN_AND_APPLIED",[i]),!0,"normalfont",2500)):(PubSub.publish("Document/themeChanged"),UIUtils.showMessage("info",J.i18n("styles","NEXT_PARA_UPDATED_FOR_USER_DESIGN",[i]),!0,"normalfont",2500))};"user"==e?DesignUtil.updateUserDocumentDesign(n,i,a):DesignUtil.updateOrgDocumentDesign(n,t,null,a)}else{var n={};n[ATTR_BODY.DS_STYLES]=DocumentDesign.getStyles(),n[ATTR_BODY.DS_THEME]=DocumentDesign.getTheme(),n[ATTR_BODY.DS_STYLE_UI_INFO]=DocumentDesign.getStyleUIInfo();var o=n[ATTR_BODY.DS_STYLES];for(var r in s._nextParaStyleObj)o.para[r].info.next=s._nextParaStyleObj[r];s.save?DesignUI.openDesignDialog(n,function(e,t){ee(),e="user"==t?e.substr("custom|".length):e,UIUtils.showMessage("info",J.i18n("styles","DESIGN_CREATED_AND_APPLIED_IN_DOCUMENT",[e]),!0,"normalfont",2500)},function(){UIUtils.showMessage("error",J.i18n("design","PROBLEM_IN_SAVING_DESIGN"),!0,"normalfont",2500),te()}):(ee(),UIUtils.showMessage("info",J.i18n("styles","NEXT_PARA_UPDATED_IN_DOCUMENT"),!0,"normalfont",2500))}},ee=function(){Object.keys(s._nextParaStyleObj).length>0&&editor.doc.execCmd("setNextParaStyle",s._nextParaStyleObj),PubSub.publish("DocumentDesgin/NextParaStyleAppliedInDlg")},te=function(){J.dialogutil.close("setnextparastyledlg")},ie=function(e,t,i,n){var o={splitmenu:"",appData:"",menuId:""},r='<div class="ui-flex-container ui-flex-row"></div>',l='<div noi18n="true" id="contentHeadingBasePara0" class="ui-para-style-list-item">Normal</div>',d='<button id="next-para-dlg-headingmenubtn0" ctype="zmenubutton" data=\'{"menuId":"nextpara-dlg-headingmenulist","label":"writer.common.NORMAL","tags":"writer.tags.HEADINGS","className":"ui-para-headinglist-btn"}\'></button>',c={beforeOpen:function(){},init:function(){s={},s._nextParaStyleObj={},s.desginData={},s.desginData.designType=e,s.desginData.designId=i,t&&(s.desginData.designName=t),t&&(s.desginData.isAppliedToDocument=n);var c="nextpara-dlg-headingmenulist",u="next-para-style-dlg-container",p=document.getElementById(u),g="";g=e&&t?"user"==e?SavedDesign[t][ATTR_BODY.DS_STYLES]:"org"==e?DesignUtil.getOrgDesign(i).content[ATTR_BODY.DS_STYLES]:DesignSets[t][ATTR_BODY.DS_STYLES]:DesignUI.getCurrentDesignSet()[ATTR_BODY.DS_STYLES];var f=StyleUI.getHeadingArr(g);L(c),D(f,c,o),J("#nextpara-dlg-headingmenulist").on("zmenubeforeshow",function(e,t){var i=t.forElement[0],n=i.getAttribute("id"),o=n.replace("next-para-dlg-headingmenubtn",""),r=g.para["h"+o].info.next.substr(1);J("#nextpara-dlg-headingmenulist").zmenu("setMenuItemsAttribute",["#contentHeading"+r],"checked",!0)});for(var E=0;E<f.length;E++){var T=f[E].substr(1),m=J(r)[0],h=J(l)[0],I=J(d)[0];m.appendChild(h),m.appendChild(I),h.setAttribute("id","contentHeadingBasePara"+T),h.innerHTML='<div class="ui-para-style-list-item_sub">'+a[T]+"</div>",I.setAttribute("id","next-para-dlg-headingmenubtn"+T),I.setAttribute("data-for",T),StyleUI.setStyleForHeadingButton(T,J(h.children[0])),p.appendChild(m),J("#next-para-dlg-headingmenubtn"+T).zmenubutton();var T=f[E].substr(1),_=g.para["h"+T].info.next.substr(1);J("#next-para-dlg-headingmenubtn"+T).zmenubutton("changeLabel",a[_]),StyleUI.setStyleForHeadingButton(_,J("#next-para-dlg-headingmenubtn"+T+" .zbutton__text"))}var A=document.getElementById("nextpara-dlg-save-design");if(e&&"writer"!=e){A?A.style.display="none":void 0;var S="user"==e?t.substr("custom|".length):t;J("#nextstyle-primary-btn .zbutton__text").text(J.i18n("writer.design.UPDATE_CHANGES").replace("{0}",Utils.encodeHTMLString(S)))}else A?A.style.display="block":void 0,J("#nextstyle-primary-btn .zbutton__text").text(J.i18n("writer.design.APPLY_TO_DOCUMENT"))},get:function(){},set:function(e,t,i,n,o){if("nextStyle"==e.action){var r=t.getAttribute("id"),l=o.forElement[0],d=r.split("contentHeading")[1],c=l.getAttribute("data-for");StyleUI.setStyleForHeadingButton(d,J(l).find(".zbutton__text")),J(l).zmenubutton("changeLabel",a[d]),s._nextParaStyleObj["h"+c]="h"+d}else if("saveDesign"==e.action){s.save=t;var u=t?J.i18n("writer.common.PROCEED"):J.i18n("writer.design.APPLY_TO_DOCUMENT");J("#nextstyle-primary-btn").text(u)}}};J.dialogutil.open("setnextparastyledlg",null,c,null,{ajax:{cache:!0}})},ne=function(){UIUtils.hideLoadingMsg(),ie()},oe=function(){!DesignUtil.isWorkdriveUser()||DesignUtil.isWorkDrivePersonalUser()||DesignUtil.orgDesignFetchStatus()?ie():(UIUtils.showLoadingMsg(),DesignUtil.retreiveOrgDesign(ne,ne))},re=function(){I()},ae=function(e,t){var i=editor.doc.getSelection(),n=i&&DocUtil.copyStyle(i.getParaFormat()),o=parseInt(n&&n[ATTR_PARAGRAPH.PS_HD]||0),r=a[o],s=J.i18n("writer.styles.UPDATE_ALL_STYLE",[r]),l=J.i18n("writer.styles.RESET_TO_STYLE",[r]);J("#headingmenu-list").zmenu("setMenuItemsAttribute",["#update-heading"],"label",s),J("#headingmenu-list").zmenu("setMenuItemsAttribute",["#reset-heading"],"label",l),J("#headingmenu-list").zmenu("setMenuItemsAttribute",["#update-heading"],"appData",{action:"QuickStyle.onBeforeUpdateHeadingStyle",params:[o]}),J("#headingmenu-list").zmenu("setMenuItemsAttribute",["#reset-heading"],"appData",{action:"editor.doc.execCmd",params:["FormatBlock",o]}),J("#visual-queue-headingmenubtn").mouseover(function(){J("#visual-queue-headingmenubtn").css({opacity:1})}),J("#visual-queue-headingmenubtn").mouseout(function(){J("#visual-queue-headingmenubtn").css({opacity:1})})},se=function(){J("#visual-queue-headingmenubtn").zmenubutton(),J("#heading-modified-create").click(StyleUI.openSaveStyleDialogue),J("#heading-modified-update").click(QuickStyle.updateParaHeadingStyle),StyleUI.constructHeadingStyleMenu(),PubSub.unsubscribe("Document/ComponentInitialized"),PubSub.subscribe(["UiEvents/EditorParentOffsetChanged","Document/view/changed"],A),PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected"],A,{async:!0,timeout:100}),PubSub.subscribe(["Editor/WheelEvent","Document/BeforeMouseDown"],function(){J("#headingmenu-list").zmenu("hide")})};return J("#ui-editor-outer-div").on("scroll",function(){var e=Z(ELEM_ID.STYLESMENU);e.css({top:this.scrollTop})}),PubSub.subscribe("Document/ComponentInitialized",se),PubSub.subscribe("Document/StyleChanged",updateHeadingUI),PubSub.subscribe("Document/MailmergePreview",re),PubSub.subscribe("Document/OpenHistoryMode",re),PubSub.subscribe("Document/themeChanged",P),PubSub.subscribe("HeadingStyle/Add",function(e,t){D(e,t)}),PubSub.subscribe("HeadingStyle/Delete",function(e,t){var i=DocumentDesign.getComputedParaStyle(e).info.cs_name,n=o.indexOf(i);n!=-1&&o.splice(n,1),v(e,t)}),PubSub.subscribe("HeadingStyle/RemoveAll",function(e){o=[],L(e)}),PubSub.subscribe("HeadingStyle/Rename",b),PubSub.subscribe("HeadingStyle/CursorPosition",O),PubSub.subscribe("DocumentDesgin/NextParaStyleAppliedInDlg",te),{reinitHeadingStylesMenu:p,PARA_NAME_MAPPING:d,onSearch:f,getDocumentParaMapping:T,setContextualSubmenu:R,getHeadingArr:N,constructHeadingStyleMenu:P,deleteUserHeadingStyle:C,removeStyleFromLibrary:y,validateStyleName:M,applyHeadingStyleForCursorPos:w,applyHeadingStyleToElem:B,setStyleForHeadingButton:setStyleForHeadingButton,addNewHeadingStyleInUI:D,renameHeadingStyleInUI:b,removeHeadingStyleInUI:v,selectHeadingStyleInUI:O,removeAllHeadingMenuItems:L,updateHeadingUI:updateHeadingUI,updateHeadingStylesMenu:updateHeadingStylesMenu,updateHeadingStyleButtons:updateHeadingStyleButtons,saveHeadingStyle:k,openSaveStyleDialogue:W,applySelectedStyle:V,openStyleLibrary:K,renameHeadingStyle:q,openRenameStyleDlg:Q,applyNextParaStyle:$,openNextParaStyleDlg:ie,getHeadingStyleText:x,beforeSmartHeadingmenuShow:ae,beforeOpenNextStyleDlg:oe}}(),StyleImportUtil=function(){"use strict";var e=function(e,t,i){var n={limit:t,category:"all",offset:e,from:"editor"};J.ajax({type:"GET",data:n,global:!1,dataType:"json",url:ZWNetworkUtils.getContextUrl("api/v1/documents"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(e){"object"==typeof i&&i.error&&"function"==typeof i.error&&i.error(e)},success:function(e){"object"==typeof i&&i.success&&"function"==typeof i.success&&i.success(e.documents)}})};return{getDocumentList:e}}(),StyleImportUI=function(){"use strict";var e,t,i=[],n={option:null},o={invalid_writer_url:J.i18n("writer.design.INVALID_URL"),invalid_docx_url:J.i18n("writer.design.INVALID_URL"),invalid_url:J.i18n("writer.design.INVALID_URL"),invalid_design_name:J.i18n("writer.design.INVALID_DESIGN_NAME"),design_name_exist:J.i18n("writer.design.DESIGN_NAME_EXIST"),noPermission:J.i18n("writer.common.ACCESS_MESSAGE")},r="style_import_upload",a="style_import_browse",s="style_doc_list_container",l="style_doc_list",d="style_docimport-url",c="dlg-loading-gif",u="style_import_note",p="style_imp_loading",g="style-import-preview",f="style_import_preview_parent",E="style_import_colors",T="doc-import-process",m="style_imp_fail",h="style_url_error",I="style_design_name",_="style_design_name_error",A="style_progress",S="ui-url-processing-cont",R="style_import_final",O={_writerDocument:s,_import:r,_URL:d},b={invalid:1,exist:2},v=null,D=null,L=null,N=null,P=null,C="ui-hide",y="importdocdesigndlg",F=/^((ht|f)tp(s?)|(HT|F)TP(S?))\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\:\'\/\\\+=&amp;%\$#_]*)?$/i,M=/([a-zA-Z0-9]{30,50})+/,w=["open","file","preview","published","template"],x=function(e){if(F.test(e)){var t=le(e);t.docx?(N=e,_e(N)):t.valid&&(N=t.rid,t.valid?Se(N):re(o.invalid_writer_url))}else re(o.invalid_url)},B=function(i){var o={set:function(e,t,i){if(i&&"docdeisgntype"==i.name)ce(e.action);else if("USER_URL"==e.action)x(t);else if("designName"==e.action){var n=/[0-9a-zA-Z_\-\.\$@\?\,\:\'\/\!\s]+/g,o=$(t);n.test(t)&&!o?(P=t,Q(R),ae()):(se(o?b.exist:b.invalid),q(R))}},init:function(){n.option=r,v=null,D=null,L=null,e=0,t=!1,de(T),de(n.option),q(R),K(),V(),X()},get:function(e,t){}};J.dialogutil.open(y,null,o)},H=function(){var e=document.getElementById(I).value;if(0==e.length)return ae(),void q(R);var t=new RegExp("^(a-z|A-Z|0-9)*[^:*?()#%^&<>\";'|\\\\/]*$"),i=$(e);t.test(e)&&!i?(P=e,Q(R),ae()):(se(i?b.exist:b.invalid),q(R))},G=function(e){var t=J("#"+l).find(".is-active")[0];t&&t.classList.remove("is-active"),e.classList.add("is-active")},k=function(){var e=J('<div id="loading-gif" ><span class="ui-loading-gif"> </span></div>')[0];J("#"+l).append(e)},W=function(){J("#"+l).find("#loading-gif").remove()},Y=function(e){var t=new Date(e.modified_time_ms),i=t.toDateString(),n=i.split(" ");n.shift(),i=n.join(" ");var o='<div class="ui-ltbl-row"><div id="styleImportDocName" class="ui-ltbl-col ui-ellipsis"></div><div id="styleImportAuthorName" class="ui-ltbl-col ui-ellipsis"></div><div id="styleImportDate" class="ui-ltbl-col ui-ellipsis"></div></div>',r=J(o);return r[0].setAttribute("data-doc-id",e.document_id),r.find("#styleImportDocName")[0].innerText=e.document_name,r.find("#styleImportAuthorName")[0].innerText=e.created_by,r.find("#styleImportDate")[0].innerText=i,r.click(function(e){if(e.currentTarget.hasAttribute("data-doc-id")){var t=e.currentTarget.getAttribute("data-doc-id");G(e.currentTarget),ue(c),x(editor.base_url+"/open/"+t)}}),r[0]},z=function(e,t){i[e];for(var n=[],o=e;o<t+e;o++){if("object"!=typeof i[o])return;n.push(i[o])}return n},Z=function(t){e+=t.length;for(var i=0;i<t.length;i++)J("#"+l).append(Y(t[i]))},V=function(){if(!t){k();var n=z(e,25);"undefined"!=typeof n?(Z(n),W()):(t=!0,StyleImportUtil.getDocumentList(e,25,{error:function(){t=!1,W()},success:function(e){t=!1,W(),i=i.concat(e),Z(e)}}))}},j=function(e){document.getElementById(e).focus()},X=function(){J("#"+l).scroll(function(){J("#"+l).scrollTop()+J("#"+l).height()==J("#"+l)[0].scrollHeight&&V()})},K=function(){J("#"+r).on("dragenter",function(e){EditorDropHandler.showDropContainer()})},q=function(e){J("#"+e).disable()},Q=function(e){J("#"+e).enable()},$=function(e){var t=!1;for(var i in SavedDesign){var n=i.substr("custom|".length);if(e==n){t=!0;break}}return t},ee=function(){var e=document.getElementById(d);e.classList.add(S),de(A)},te=function(){var e=document.getElementById(d);e.classList.remove(S)},ie=function(){N=null,re(o.invalid_docx_url),te()},ne=function(e){N=null;var t;"undefined"==typeof e?t=o.invalid_writer_url:"F224"==e.ERROR_CODE?t=o.invalid_writer_url:1==e.AUTHENTICATION_FAILED&&(t=o.noPermission),re(t),te(),pe(c)},oe=function(){de(m)},re=function(e){de(h);var t=document.getElementById(h);t.innerText=e},ae=function(){var e=document.getElementById(_);e.classList.add(C)},se=function(e){de(_);var t=document.getElementById(_);t.innerText=1==e?o.invalid_design_name:o.design_name_exist},le=function(e){var t=e.split("/"),i=U.intersection(t,w),n=i.length,o=!1,r=null,a=!1;if(n){var s=t.findIndex(function(e){return M.test(e)});r=s!=-1?t[s]:null,o=null!=r}else a=!0;return{valid:o,rid:r,docx:a}},de=function(e){var t=[],i=[];e==T?(t.push(g),i.push(T)):e==g?(i.push(g),t.push(T,u,d,c)):e==r?(i.push(r,a,u),t.push(d,p,m,s,d)):e==d?(i.push(d,u),t.push(r,p,m,h,s)):e==s?(i.push(s),t.push(r,p,u,m,h,d)):e==p?(i.push(p),t.push(a,m)):e==m?(i.push(m),t.push(a,p)):e==h?i.push(h):e==A?t.push(h):e==_&&i.push(_);for(var n=0,o=t.length;n<o;n++)pe(t[n]);for(var n=0,o=i.length;n<o;n++)ue(i[n])},ce=function(e){n.option=O[e],de(n.option)},ue=function(e){var t=document.getElementById(e);t.classList.remove(C)},pe=function(e){var t=document.getElementById(e);t.classList.add(C)},ge=function(){de(r)},fe=function(){te(),de(g),j(I);var e=DocUtil.getRenderingFormat(v,D),t={styles:v,theme:D,styleUIInfo:L},i=DesignUI.getDocThemeHTML("Test",t),n=document.getElementById(f),o=document.getElementById(E);i.label=DesignTabUI.getThemeColorHTML("Test",D.color).label,n.innerHTML=i.innerHtml,o.innerHTML=i.label;var r=n.getElementsByClassName("ui-design-theme-label")[0];r.parentNode.removeChild(r),DesignUI.setStyleForPreviewNode(n,e)},Ee=function(e){J("#styleImportBrowse").prop("files",e.originalEvent.dataTransfer.files),Te(e.originalEvent.dataTransfer)},Te=function(e){var t=document.getElementById("styleImportBrowse"),i=J(t).val(),n=i.split(".").pop().toLowerCase(),o=(editorProps.deployment.writer,{}),r=e.files?e.files[0]:e.originalEvent.fileDataTransfer.files[0];o.fileName=r.name,o.pwd="",o.extn=n,o.filePath=J("#styleImportBrowse"),de(p),Ae(o)},me=function(){J.dialogutil.close("importdocdesigndlg")},he=function(){var e={},t=function(e){!e&&me()};e.styles=v,e.theme=D,e.styleUIInfo=L,e.designName=P,DesignUtil.saveImportedDesign(e,t);var i={};i[ATTR_BODY.DS_STYLES]=v,i[ATTR_BODY.DS_THEME]=D,i[ATTR_BODY.DS_STYLE_UI_INFO]=L,UIUtils.showLoadingMsg(J.i18n("common","LOADING")),ZWLogger.log("@changeDesign-->addFonts"),editor.addFonts(Utils.getThemeFonts(D),frames.metricsFrame,function(){UIUtils.hideLoadingMsg(),i=DesignUtil.constructDocDesignObj(i),editor.doc.execCmd("changeDesign",i);var e=J.i18n("writer.design.DESIGN_APPLIED_TO_DOCUMENT").replace("{0}",Utils.encodeHTMLString(P));UIUtils.showMessage("info",e,!0,"normalfont",5e3),me()})},Ie=function(e){var t=e.font.minor.latin,i=e.font.major.latin;Utils.isUnsupportedFont(t)||(e.font.minor.latin="Roboto"),Utils.isUnsupportedFont(i)||(e.font.major.latin="Roboto")},_e=function(e){var t,i="null",n=e,o=n.substring(n.lastIndexOf("/")+1),r=/(ht|f)(tp|tps):\/\//g,a={};r.exec(n)||(n=editor.scheme+"://"+n),ee(),i=o.split(".")[0],t=o.split(".")[1]||"docx",a.fileName=i+"."+t,a.pwd="",a.extn=t,a.filePath=n,Ae(a,!0),ZWLogger.addToStatistics("import_Frome_url")},Ae=function(e,t){var i=({name:e.fileName,password:e.pwd},"/writer/importstyles"),n={};t?n.doc_url=e.filePath:n.doc=J("#styleImportBrowse");var o={success:function(e){var t=JSON.parse(e);DesignUtil.refineFormatObj(t[ATTR_BODY.DS_STYLES][ATTR_BODY.DS_PARA]),v=t.styles,v.shape="",v.table="",v.name="",L=DesignUtil.getDefaultStyleUIInfo(v),D=t.theme,Ie(D),fe()},fail:function(e,i,n){t?ie():oe()},setHeaders:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}};J.ajaxUpload(i,ZWNetworkUtils.setDefaultParams(n),o,"json")},Se=function(e){var t={};ee(),J.ajax({type:"POST",url:ZWNetworkUtils.getContextUrl("v1/web/document/"+e+"/importstyles"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){var t=e;D=t.theme,v=t.styles,L=DesignUtil.getDefaultStyleUIInfo(v),DesignUtil.refineFormatObj(t[ATTR_BODY.DS_STYLES][ATTR_BODY.DS_PARA]),Ie(D),fe()},error:function(e,t,i){ne(e.responseJSON)},data:t})};return{openStyleImportUI:B,styleImport:Te,onDropStyleImport:Ee,importFromUrl:_e,importFromWriterDocument:Se,closeImportError:ge,saveImportedDesign:he,handleDesignNameChange:H}}();var Toolbar=function(){var e={},t=function(t,i,n){if(t&&n&&i!==n){var o=e[t],r=o[i]||{},a=r.hideList||[],s=r.disableList||[],l=o[n]||{},d=l.hideList||[],c=l.disableList||[];if(i){var u=a.filter(function(e){return d.indexOf(e)==-1}),p=d.filter(function(e){return a.indexOf(e)==-1}),g=s.filter(function(e){return c.indexOf(e)==-1}),f=c.filter(function(e){return s.indexOf(e)==-1});a=u,d=p,s=g,c=f;for(var E=0,T=a.length;E<T;E++){var m=a[E];PopupHandler.isPinned("smartToolbar")?SmartToolbar.updateSmartToolbarPositionIfPinned("show",m):Z(m).show()}for(var E=0,T=s.length;E<T;E++)Z(s[E]).enable()}for(var E=0,T=d.length;E<T;E++){var m=d[E];PopupHandler.isPinned("smartToolbar")?SmartToolbar.updateSmartToolbarPositionIfPinned("hide",m):Z(m).hide()}for(var E=0,T=c.length;E<T;E++)Z(c[E]).disable()}},i=function(t,i){t&&i&&(e[t]=i)},n=function(t){t&&delete e[t]},o=function(e,t){if(e&&t&&t.length>0){var i=FontSizeCombo.getFontSizeList(),n=i.indexOf(e);n==-1&&FontSizeCombo.addFontSize(e);var o=editor.doc.getSelection().getTargetRange(),r=o.isSameTextFormat(ATTR_TEXT.TS_SIZE,NODE_TYPE.TEXT);r?(J(".js-fontsize-combo").removeClass("ui-fontsize-combo-placeholder"),t.zcombobox("setValue",e)):(J(".js-fontsize-combo").addClass("ui-fontsize-combo-placeholder"),t.zcombobox("setAttribute","selectedIndex",-1))}},r=function(e){var t=Math.max("bold"===e[ATTR_TEXT.TS_FW]?700:0,parseInt(e[ATTR_TEXT.TS_FW_I]||400));return!(t<700)},a=function(e){var t=e[ATTR_TEXT.TS_FS];return"italic"==t},s=function(e){var t=e[ATTR_TEXT.TS_TD];return!(!t||!(t.indexOf("underline")>=0||t.indexOf("link")>=0))},l=function(e){var t=e[ATTR_TEXT.TS_TD];return!!(t&&t.indexOf("line-through")>=0)},d=function(){if(LayoutManager.isRichEditActive()||PopupHandler.isVisible("smartToolbar"))try{var e=DocUtil.copyStyle(editor.doc.getSelection().getParaFormat());e[ATTR_PARAGRAPH.PS_AL]=e[ATTR_PARAGRAPH.PS_AL]||0;var t=editor.doc.getSelection().getComputedTextFormat(),i=["#bold","#smart_bold","#italic","#smart_italic","#underline","#smart_underline","#subscript","#superscript","#strikethrough","#smart_strikethrough"];UIUtils.uiTextAlignment.zbuttonset("check","#LEFT"),UIUtils.uiTextAlignment.zbuttonset("check","#pcm-left"),UIUtils.uiTextAlignment.zbuttonset("check","#sub-LEFT"),c(0),UIUtils.uiParaDir.zbuttonset("check","#fmt-lpnl-sub-dirltr"),J("#rtlmenu").zmenu("check","fmt-lpnl-dirltr");var n=J("#fmt-lpnl-charspacemenu"),d="charspace";UIUtils.uiFontStyle.zmenubutton("changeLabel","Normal"),UIUtils.uiBulletsAndIndent.find("#fmt-lpnl-list-number,#fmt-lpnl-list-bullet").parent().removeClass("ui-state-highlight"),editor.doc.getSelection().isCollapsed()?UIUtils.uiCopyButton.prop("disable",!0):UIUtils.uiCopyButton.prop("enable",!0);var u=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH);DropCap.updateDropcapButton(u);var p,g,f=editor.doc.getSelection().textFormat;if(f[ATTR_TEXT.TS_FF])p=f[ATTR_TEXT.TS_FF];else var E=u&&u.attr(ATTR_PARAGRAPH.PS_HD),p=E&&DocumentDesign.getComputedParaStyle("h"+E).textFormat.ff?DocumentDesign.getComputedParaStyle("h"+E).textFormat.ff:DocumentDesign.getParaStyle("h0").textFormat.ff;var T=9;UIUtils.uiSmartToolbar.zbuttonset("uncheck",i.join());for(var m in t)if(t.hasOwnProperty(m)&&"type"!=m){var h=t[m];m===ATTR_TEXT.TS_FW||m===ATTR_TEXT.TS_FW_I?r(t)&&(Z("bold").zbutton("check"),i.splice(i.indexOf("#bold"),1),UIUtils.uiSmartToolbar.zbuttonset("check","#smart_bold"),i.splice(i.indexOf("#smart_bold"),1)):m==ATTR_TEXT.TS_FS&&a(t)?(Z("italic").zbutton("check"),i.splice(i.indexOf("#italic"),1),UIUtils.uiSmartToolbar.zbuttonset("check","#smart_italic"),i.splice(i.indexOf("#smart_italic"),1)):m==ATTR_TEXT.TS_VA&&"super"==h?(Z("superscript").zbutton("check"),i.splice(i.indexOf("#superscript"),1)):m==ATTR_TEXT.TS_VA&&"sub"==h?(Z("subscript").zbutton("check"),i.splice(i.indexOf("#subscript"),1)):m==ATTR_TEXT.TS_TD&&"none"!=h||h&&"link"==h&&u&&"toc"!=u.parentNode().type?(s(t)&&(Z("underline").zbutton("check"),i.splice(i.indexOf("#underline"),1),UIUtils.uiSmartToolbar.zbuttonset("check","#smart_underline"),i.splice(i.indexOf("#smart_underline"),1)),l(t)&&(Z("strikethrough").zbutton("check"),i.splice(i.indexOf("#strikethrough"),1),UIUtils.uiSmartToolbar.zbuttonset("check","#smart_strikethrough"),i.splice(i.indexOf("#smart_strikethrough"),1))):m==ATTR_TEXT.TS_SIZE?(h=parseFloat(h),isNaN(h)||(T=h)):m==ATTR_TEXT.TS_CS&&(d=parseFloat(h));var I="charspace"+d,_=J("#"+I);n.zmenu("setMenuItemsAttribute",[_[0]?_:J("#charspace")],"checked",!0)}J(i.join()).zbutton("uncheck");var h;(h=e[ATTR_PARAGRAPH.PS_HD]||0)?StyleUI.setStyleForHeadingButton(e[ATTR_PARAGRAPH.PS_HD]):StyleUI.setStyleForHeadingButton(0),StyleUI.updateHeadingStyleButtons();for(var m in e)if(e.hasOwnProperty(m)&&"type"!=m&&m!=ATTR_PARAGRAPH.PS_HD){var h=e[m];if(m==ATTR_PARAGRAPH.PS_AL&&0==h)e.dir==PARA_DIR.RTL?(UIUtils.uiTextAlignment.zbuttonset("check","#RIGHT"),UIUtils.uiTextAlignment.zbuttonset("check","#pcm-right"),UIUtils.uiTextAlignment.zbuttonset("check","#sub-RIGHT"),c(2)):(UIUtils.uiTextAlignment.zbuttonset("check","#LEFT"),UIUtils.uiTextAlignment.zbuttonset("check","#pcm-left"),UIUtils.uiTextAlignment.zbuttonset("check","#sub-LEFT"),c(0));else if(m==ATTR_PARAGRAPH.PS_AL&&1==h)UIUtils.uiTextAlignment.zbuttonset("check","#CENTER"),UIUtils.uiTextAlignment.zbuttonset("check","#pcm-center"),UIUtils.uiTextAlignment.zbuttonset("check","#sub-CENTER"),c(1);else if(m==ATTR_PARAGRAPH.PS_AL&&2==h)e.dir==PARA_DIR.RTL?(UIUtils.uiTextAlignment.zbuttonset("check","#LEFT"),UIUtils.uiTextAlignment.zbuttonset("check","#pcm-left"),UIUtils.uiTextAlignment.zbuttonset("check","#sub-LEFT"),c(0)):(UIUtils.uiTextAlignment.zbuttonset("check","#RIGHT"),UIUtils.uiTextAlignment.zbuttonset("check","#pcm-right"),UIUtils.uiTextAlignment.zbuttonset("check","#sub-RIGHT"),c(2));else if(m==ATTR_PARAGRAPH.PS_AL&&3==h)UIUtils.uiTextAlignment.zbuttonset("check","#JUSTIFY"),UIUtils.uiTextAlignment.zbuttonset("check","#pcm-justify"),UIUtils.uiTextAlignment.zbuttonset("check","#sub-JUSTIFY"),c(3);else if(m==ATTR_PARAGRAPH.PS_TYPE&&ListUtils.isList(e)){var A=e[ATTR_PARAGRAPH.LS_DATA],S=A.id,R=A.l,O=editor.doc.getListType(S,R);O<6?UIUtils.uiBulletsAndIndent.find("#fmt-lpnl-list-number").parent().addClass("ui-state-highlight"):UIUtils.uiBulletsAndIndent.find("#fmt-lpnl-list-bullet").parent().addClass("ui-state-highlight")}else m==ATTR_PARAGRAPH.PS_DIR&&(h==PARA_DIR.RTL?(UIUtils.uiParaDir.zbuttonset("check","#fmt-lpnl-sub-dirrtl"),J("#fmt-lpnl-txtdir").zselectbox("setValue",PARA_DIR.RTL),J("#pcm-textdir").zselectbox("setValue",PARA_DIR.RTL)):h==PARA_DIR.LTR&&(UIUtils.uiParaDir.zbuttonset("check","#fmt-lpnl-sub-dirltr"),J("#fmt-lpnl-txtdir").zselectbox("setValue",PARA_DIR.LTR),J("#pcm-textdir").zselectbox("setValue",PARA_DIR.LTR)))}e.hasOwnProperty(ATTR_PARAGRAPH.PS_DIR)||(UIUtils.uiParaDir.zbuttonset("check","#fmt-lpnl-sub-dirltr"),J("#fmt-lpnl-txtdir").zselectbox("setValue",PARA_DIR.LTR)),Shapes.isSelected()||(document.getElementById("fmt-lpnl-fontfamily")&&FontComboUtil.updateFontFamily(p,g,"fmt-lpnl-fontfamily"),document.getElementById("smart_fontFamily")&&FontComboUtil.updateFontFamily(p,g,"smart_fontFamily")),o(T,UIUtils.defaultFontSize),PubSub.publish("EditorEvents/ToolbarUpdateComplete")}catch(e){}},c=function(e){var t=J("#smart-textalign");t.zselectbox("setValue",e);var i=J("#pcm-textalign");i.zselectbox("setValue",e)},u=function(){ZWComponentUtil.init("smartToolbar",function(){FontSizeCombo.addAllDefaultFontSizeInCombo("smart_fontSize"),SmartToolbar.updateWidth(),J("label[for=smart_formatpainter]").bind("dblclick",function(e){editor.doc.paintFormat_dblClick=!0,PubSub.publish("Document/DocumentDblClick",e)})}),PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected","Toolbar/UpdateToolbar"],d,{async:!0,timeout:500})};return PubSub.subscribeOnce("Document/ComponentInitialized",u,{async:!0,timeout:500}),{updateToolset:t,addToolsetToCollection:i,removeToolsetFromCollection:n,updateFontSize:o,updateToolbar:d,isBold:r,isItalic:a,isUnderline:s,isStrikethrough:l}};Toolbar=Toolbar(),function(e){e.ZToolbarHandler={init:function(){this._bindEvents()},_bindEvents:function(){var t=e("#panel-container,#topband-default,#footerContainer,#review-tb,#paraPropWrapper,#microtoolbardialog,#complete-tb,#topband-history,#topband-history-compare,#bottombar,#topband-mailmerge,#mmpreview-toolbarcontainer,#topband-fillablefields,#ffpreview-toolbarcontainer,#fmt-lpnl-sub-pc-container,#ui-reader-popup,#con-menu-parent,#toolbar_screenplay,#shape-con-menu-parent");t.find(":checkbox").on("click",function(t,i){var n=e(t.target);ToolbarHandler.handleUIEvents(n,i)}),t.on("click",ToolbarHandler.handleZButtonClick),e("#smartToolbar,#rht_click_clipboardSmart,#rht_click_clipboardSmart_shape,#code-menu-container").on("click",function(t,i){var n=e(t.target),o=i&&i.fromShortCut,r=o||n.hasClass("zbutton")?n:n.closest(".zbutton");(o||r&&r.hasClass("zbutton")&&!r.is("input")&&!r.is(":disabled"))&&(r.is("label")&&(r=r.prev()),ToolbarHandler.handleUIEvents(r,i),J(t.target).parents("#Rmenu").length&&J.ZContextMenu.currentMenu&&!J(t.target).parents("#paste-option-split-button").length&&J.ZContextMenu&&J.ZContextMenu.currentMenu&&J.ZContextMenu.currentMenu.hide())}),J("#pasteoptionmenu,#rht_click_paste_list").on("click",function(e,t){J.ZContextMenu&&J.ZContextMenu.currentMenu&&J.ZContextMenu.currentMenu.hide(),J("#pasteoptionmenu").hide()}),J("#menuHeaderFooter").on("statechange",function(e,t){var i=J(t.stateEle).metadata().appData,n=i.action;if(n){var o=i.params,r=Utils.getAsFunction(n);r.callable(o)}}),J("#hTop").bind("zlabelednumberfieldblur",function(e,t){CustomHdrFtr.changeHeaderMargin()}),J("#fBot").bind("zlabelednumberfieldblur",function(e,t){CustomHdrFtr.changeFooterMargin()}),J("#bbar-pagenuminput").bind("keydown",function(e){var t=RegExp(/^[0-9]*$/),i=J(this).html(),n=t.test(i);return n?(parseInt(i)>DocLayoutManager.getPageCount()&&J(this).html(editor.currentPageIndex+1),void(e.keyCode==KEYS.ENTER&&(e.preventDefault(),UIUtils.gotoPage(i)))):void J(this).html(editor.currentPageIndex+1)});var i="#fmt-lpnl-fontfamily,#fmt-lpnl-fontsize,#smart_fontFamily,#smart_fontSize,#smart-textalign,#pcm-textalign,#smart-table_cellalignment,#shapepanel-fontFamily,#shape_fontSize,#dropcap-fontfamily,#dropcap-fontsize,#watermark_fontFamily,#watermark-fontSize";J(i).bind("comboshow",function(e){e.currentTarget.selectedIndex=-1}),J("#view-lpnl-zoom").bind("zlabeledcomboboxchange",ToolbarHandler.comboChangeHandler),J("#bbar-zoom,#webview-wid-percentage-combobox,#web-view-widPercenge-view-pnl").bind("zcomboboxchange",ToolbarHandler.comboChangeHandler),J("#history-changesfilter").bind("zselectboxchange",ToolbarHandler.comboChangeHandler),J("#view-lpnl-tcmarkup").bind("zlabeledselectboxchange",ToolbarHandler.comboChangeHandler),J("#smart_fontSize,#shape_fontSize,#watermark-fontSize").bind("zcomboboxchange",ToolbarHandler.fontComboChangeHandler),J("#smart-table_cellalignment,#pcm-textdir").bind("zselectboxchange",ToolbarHandler.fontComboChangeHandler),J("#bbar-docviewslist,#format_headingStyle,#smart-textalign,#pcm-textalign,#code-lang-dropdown,#code-theme-dropdown,#topband-modes").bind("zselectboxchange",function(e,t){var i=this,n=i.options[i.selectedIndex],o=J(n).metadata().appData;if(o){var r=o.action,a=Utils.getAsFunction(r),s=o.params;a.callable(s)}}),J("#textforegroundcolorDropDown-smart,#textbackgroundcolorDropDown-smart").on("zcolorsplitbuttonbeforepickeropen",function(e,t){var i,n="fmt-lpnl-fgcolor"==this.id||"textforegroundcolorDropDown-smart"==this.id;i=n?editor.doc.getSelection().getComputedTextFormat().fgc:editor.doc.getSelection().getComputedTextFormat().bgc;var o=J("#writer-colorpicker");if(i&&"transparent"!=i){var r=ZWColorUtils.rgbToHex(Utils.getColorValFromRefString(i)).toUpperCase();o.find(".zcolorpicker__colorcode").text(r),o.find(".zcolorpicker__colorelem").css("background",r)}else o.zcolorpicker("options",{clrlbl:!1})}),J("#Rmenu,#documentmenu").bind("keydown",function(e){var t=e.keyCode||e.which;t!=KEYS.NAV_UP&&t!=KEYS.NAV_DOWN&&UIUtils.hideRightClickMenu()})}}}(jQuery);var ToolbarHandler=function(){"use strict";var e=function(e,t){var i=e;if(i&&i.length){if(i.attr("colorpalette"))return EventHandler.isMenuOpened=!0,void CurUtil.stopBlinking(!0);var n=i[0],o=J(i).attr("id"),r=o?o.indexOf("quick"):-1,a=(0==r?ZWLogger.addToStatistics(o):null,J(n).metadata().appData);if(i.blur(),a){var s=a.action,l=a.params;if(s){var d=Utils.getAsFunction(s);d.callable(l)}if(i&&i[0].hasAttribute("data-zw-action")){var s=i[0].getAttribute("data-zw-action");PubSub.publish("UIFrameWork/ReportCapture",[i[0],s,ActionJSON.getActionInfo(s)])}}}},t=function(e,t){var i=$(e.target),n=t&&t.fromShortCut,o=n||i.hasClass("zbutton")?i:i.closest(".zbutton");return n||o&&o.hasClass("zbutton")&&!o.is("input")&&!o.is(":disabled")?(o.is("label")&&(o=o.prev()),o):null},i=function(i,n){var o=t(i,n);o&&!o.is(":checkbox")&&e(o,n)},n=function(e,t){var i=J(this),n=i.metadata().appData,o=n.action,r=Utils.getAsFunction(o),a=[t.value];i[0].hasAttribute("data-zw-action")&&PubSub.publish("UIFrameWork/SelectOptionClick",{ev:e,selectitem:i}),r.callable(a)},o=function(e,t){var i=J(this),n=i.metadata().appData,o=n.action,r=t.selectedValue;if("FontSize"==n.params){r=parseFloat(r);var a=isNaN(r)?parseFloat(t.previousValue):r;if(a<1)r="1";else if(a>400)r="400";else{var s=a%1;.5!==s&&(a=.3<=s&&s<=.7?parseInt(a)+.5:Math.round(a),r=a.toString())}i.zcombobox("setValue",r)}var l=[n.params,r],d=Utils.getAsFunction(o);d.callable(l)};return{handleZButtonClick:i,comboChangeHandler:n,handleUIEvents:e,fontComboChangeHandler:o}}();SheetOperation=function(){"use strict";var e,t;ATTR_WIDGET.SHEET_DEF_IMG=imgCdnZWStaticPath+fingerPrintObj[ATTR_WIDGET.SHEET_DEF_IMG];var i=function(){t=new XFormMap,t.putOp(DocOpBuilder.build([{r:editor.doc.getSelection().getStart()}]),"index"),t.enableAutoUpdate()},n=function(){if(t)return t.map.index.docOps[0].retain_count},o=function(){t=void 0},r=function(e){var t={},i=editor.doc.getSelection(),n=DocLayoutManager.getContentWidthAtIndex(i.getStart());return t[ATTR_WIDGET.WID]=e.width?e.width:n,t[ATTR_WIDGET.HT]=e.height?e.height:n*(2/3),t[ATTR_COMMON.SUBTYPE]=ATTR_WIDGET.WIDGET,t[ATTR_COMMON.ID]=Utils.getRandomNumber(),t[ATTR_WIDGET.THUMBNAIL]="true",t[ATTR_COMMON.TYPE]="image",t[ATTR_IMAGE.I_SRC]=e.imgSrc,t[ATTR_WIDGET.SHEET_INFO]={url:e.url?e.url:null,rid:e.rid?e.rid:null,activeSheet:e.activeSheet?e.activeSheet:null,activeCell:e.activeCell?e.activeCell:null},t},a=function(e){return editorProps.urls.zohoSheetURL+"/sheet/open/"+e},s=function(t){var i,n;if(e)t(e);else{var o=function(i){e=i,t(i)};ZWImageUtils.getImageBytes(ATTR_WIDGET.SHEET_DEF_IMG,i,n,o)}},l=function(){var e=editor.doc.getSelection();e.selectionType&&e.selectionType!=SEL_AUTO_GEN&&e.selectionType!=SEL_OP_GEN&&(SheetOperation.clearXfmIdx(),PubSub.unsubscribe("Cursor/Collapsed",l))},d=function(){J(".widget-iframe").remove(),J("div[active-widget-sheet-rid]").removeAttr("active-widget-sheet-rid"),J(".wid-info-container").show(),J(J(".ui-iframe-loading-gif")[0]).removeClass("ui-iframe-loading-gif"),Widget.clearActiveWidgetInfo()},c=function(e){J(".widget-iframe").length&&d(),SheetOperation.clearXfmIdx();var t={onSuccess:function(){},onError:function(){}},i=HTMLUtil.storeImageInFileStoreByURL(ATTR_WIDGET.SHEET_DEF_IMG,t),n={imgSrc:i,activeCell:e&&e.activeCell?e.activeCell:null,activeSheet:e&&e.activeSheet?e.activeSheet:null,url:e&&e.url?e.url:null,rid:e&&e.rid?e.rid:null,width:e&&e.width?e.width:null,height:e&&e.height?e.height:null},o=r(n),a=editor.getDocument(),s=a.getSelection().getRangeAt(0),c=a.createSheetWidget(o);e||c.setResponseHandler({success:function(e){var t=SheetOperation.getXfmIdx();if("undefined"!=typeof t){var i=editor.getDocument(),n=i.createRange();n.start=t-1,n.end=t-1;var o=n.getStartNode();if(o.type==NODE_TYPE.IMAGE&&o.isWidget()&&o.isSheetWidget()){var r=editor.doc.getPortionData(t-1).node;Widget.loadWidgetInIFrame(J(r).find(".zw-ifr-div")[0],o.rawFormat),ImageActions.selectImg(t-1),TransformEventHandler.setContextInsideElement()}}else DomUtil.updateImageSrc(e.src);PubSub.unsubscribe("Cursor/Collapsed",l)},failure:function(){PubSub.unsubscribe("Cursor/Collapsed",l)}});var u=editor.doc.getSelection(),p=u.getRangeAt(0);p.collapsed||u.deleteSelectedContents(p),s.insertNode(c);var g=function(){var e=editor.doc.getSelection().getStart(),t=editor.getDocument(),i=t.createRange();i.start=e-1,i.end=e-1,setTimeout(function(){var t=i.getStartNode(),n=editor.doc.getPortionData(e-1).node;Widget.loadWidgetInIFrame(J(n).find(".zw-ifr-div")[0],t.rawFormat),ImageActions.selectImage(e-1),TransformEventHandler.setContextInsideElement()},1e3)},f=function(){SheetOperation.setXfmIdx(),PubSub.subscribe("Cursor/Collapsed",l)};a.sync(e?g:f),ZWLogger.addToStatistics("sheetInsert");},u=function(e){var t=e.indexOf("&t=");return t=t==-1?e.indexOf("#"):t,t!=-1&&(e=e.substr(0,t)),e},p=function(e){var t=e.deferred,i=e.data.sheetInfo.rid;t.done(function(t){var i=Widget.getActiveWidgetInfo(),n=editor.getDocument();ImageCache.removeFromCache(e.data.id),n.visitAllNodes(NODE_TYPE.IMAGE,function(e){if(e.isWidget()&&e.isSheetWidget()){var n=e.getSheetInfo();n.rid==t&&"undefined"!=typeof i.sheetResponse&&(n.activeSheet=i.sheetResponse.activeSheet,n.activeCell=i.sheetResponse.activeCell,e.setSheetInfo(n))}Widget.clearActiveWidgetInfo()}),n.sync()}.bind(null,i)),SheetOperation.setThumbnailImg(e)},g=function(e){var t=e.node,i=(e.deferred,J(t).find("iframe")[0]),n=J(t).find(".zw-image")[0];if(n){var o=n.getAttribute("xlink:href");o=u(o);var r=o.split("-");r[1],r[2];t.classList.add("ui-abs-loading-gif"),n.style.display="none",XDC.setTarget({window:i.contentWindow,origin:editorProps.urls.zohoSheetURL}),XDC.postMessage({message:"ZSheet.Snapshot",data:{},oncomplete:function(e){var t=Widget.getActiveWidgetInfo();"undefined"!=typeof t&&(t.sheetResponse=e,Widget.setActiveWidgetInfo(t),E(e),J("div[active-widget-sheet-rid]").find(".widget-iframe").remove(),J("div[active-widget-sheet-rid]").removeAttr("active-widget-sheet-rid"))},onexception:function(){var e=Widget.getActiveWidgetInfo();"undefined"!=typeof e&&(J("div[active-widget-sheet-rid]").find(".widget-iframe").remove(),J("div[active-widget-sheet-rid]").removeAttr("active-widget-sheet-rid"),e.deferred.resolve())}})}},f=function(){var e=function(e){for(var t=e.callbackDataFromWorkDrive,i=t.fileModel,n={},o=0;o<i.length;o++)n.rid=i[o].id;c(n)},t={service:"zw",resId:editor.doc.rid,WDDomainURL:window.location.protocol+"//"+editorProps.urls.teamdriveURL,height:"70%",width:"50%",primaryButtonName:"Pick",denyButtonName:"cancel",filesQueryOptions:{queryType:"type",queryValue:"spreadsheets_native,folder"},countToSelectMaxFiles:1,showSelectedFilesAsTag:!0,canUpload:!1,showSearch:!0,showPrimaryButton:!0,showDenyButton:!0,canShare:!1,loadAsDialog:!0,disableFolderSelection:!0,primaryActionCallBack:function(t){e(t)}};WDHandler.showResourcePicker(t)},E=function(e){var t=Widget.getActiveWidgetInfo();if(t&&t.hasOwnProperty("node")){var i={},n=t.node,o=J(n).find(".zw-image")[0],r=o.getAttribute("xlink:href");r=u(r),i.nodes=[o],i.src=r,i.def=t.deferred;var a=r.split("-"),s=a[2];if(e&&"object"==typeof e&&e.hasOwnProperty("data")){var l={onSuccess:function(e){var t=e.nodes,i=(e.src,0),n=t[i];J(n).parents("div.fgImgOuterDiv")[0].classList.remove("ui-abs-loading-gif"),n.style.display="block",e.def.resolve()}.bind(null,i),onError:function(e){e.def.resolve()}.bind(null,i)};HTMLUtil.uploadImageInFileStore(e.data,s,l)}}},T=function(e){var t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.TABLE),n=i.attr(ATTR_TABLE.SHEET_RANGE_INFO),o=editorProps.urls.zohoSheetURL+"/sheet/open/"+n.rid;return Utils.safeWindowOpen(o),!0},m=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE),i={};i[ATTR_TABLE.SHEET_RANGE_INFO]="",t.attr(i),editor.lastOperation="Remove Sheet link with table",Op.sendMsg()},h=function(e,t){var i="/writer/v1/sheet/"+Macros.getRId()+"/sheetrangecontent",n={},o={sheet_rid:e.rid,worksheet_name:e.sn,start_row:parseInt(e.sRange.rtc.sr),end_row:parseInt(e.sRange.rtc.er),start_column:parseInt(e.sRange.rtc.sc),end_column:parseInt(e.sRange.rtc.ec)};n.range_info=JSON.stringify(o),J.ajax({type:"GET",global:!1,async:!0,url:i,data:n,dataType:"json",success:t.success,error:t.error})},I=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE),i=t.attr(ATTR_TABLE.SHEET_RANGE_INFO);Notification.show({message:"writer.sheet.UPDATE_SHEET_TABLE",close:!0,setTimer:!1,type:"info"});var n=function(n){var o=R(n),r=document.createElement("div");o.setAttribute("data-sheet-range-info",JSON.stringify(i)),o.setAttribute("data-cols",JSON.stringify(i[ATTR_TABLE.TBLS_COLS])),r.appendChild(o);var a=t.getStart(),s=t.children(),l=s[0].children()[0],d=l.getStart()+1;e.deleteContents(t.getStart(),t.getEnd());var c=new ZWRange(1,1);e.addRange(c);var u=PasteUtil.getComposedOpForCustomContent(r,CONST.PASTE_SOURCEFORMAT,{selection:e,isWriterDocument:!0});u.splice(0,4),u.unshift({r:a}),Op.processMsg(u),Op.processMsg(Op.getCursor(d,d)),Op.cursorProcessed(),editor.lastOperation="Update Sheet Table",Op.sendMsg(),Notification.hide()},o=function(e,t,n){Notification.hide();var o,r,a=e.responseJSON,s=a.sheet_errorCode;switch(s){case"S401":o="writer.sheet.PERMISSION_DENIED_TO_UPDATE_TABLE";var l=editorProps.urls.zohoSheetURL+"/sheet/open/"+i.rid;r=["<a href='"+l+"' target='_blank' rel='nofollow noreferrer'>"+J.i18n("writer.mailmergepopup.LINK")+"</a>"];break;case"S404":o="writer.sheet.SHEET_NOT_FOUND";break;default:o="writer.sheet.UNABLE_TO_UPDATE_TABLE"}var d=J.i18n(o,r);UIUtils.showMessage("error",d,"showclose","normalfont",8e3)};h(i,{success:n,error:o})},_=function(e,t){var i=editor.doc.getSelection(),n=i.getParents(NODE_TYPE.TABLE),o=n.attr(ATTR_TABLE.SHEET_RANGE_INFO),r=parseInt(o.sRange.rtc.sr),a=parseInt(o.sRange.rtc.er),s=parseInt(o.sRange.rtc.sc),l=parseInt(o.sRange.rtc.ec),d=ListUtils.getListNumber(LIST_TYPE.UPPER_ALPHA,s,null,!0),c=ListUtils.getListNumber(LIST_TYPE.UPPER_ALPHA,l,null,!0),u='<span class="ui-fl ui-colon ui-right-margin-medium">'+J.i18n("writer.sheet.CHANGE_CELL_RANGE")+'</span><span class="ui-right-margin-verysmall">'+d+r+'</span>;<span class="ui-left-margin-verysmall">'+c+a+"</span>";J("#micro-tool-change-range").find(".zmenu__text").html(u)},A=function(){var e=parseInt(J("#cellrange-start-row").val()),t=parseInt(J("#cellrange-end-row").val()),i=ListUtils.AlphatoNumber(J("#cellrange-start-column").val()),n=ListUtils.AlphatoNumber(J("#cellrange-end-column").val()),o=editor.doc.getSelection(),r=o.getParents(NODE_TYPE.TABLE),a=r.attr(ATTR_TABLE.SHEET_RANGE_INFO);a.sRange.rtc.sr=e,a.sRange.rtc.er=t,a.sRange.rtc.sc=i,a.sRange.rtc.ec=n,Notification.show({message:"writer.sheet.UPDATE_SHEET_TABLE",close:!0,setTimer:!1,type:"info"});var s=function(e){var t=R(e),i=document.createElement("div");t.setAttribute("data-sheet-range-info",JSON.stringify(a)),t.setAttribute("data-cols",JSON.stringify(a[ATTR_TABLE.TBLS_COLS])),i.appendChild(t);var n=r.getStart(),s=r.children(),l=s[0].children()[0],d=l.getStart()+1;o.deleteContents(r.getStart(),r.getEnd());var c=new ZWRange(1,1);o.addRange(c);var u=PasteUtil.getComposedOpForCustomContent(i,CONST.PASTE_SOURCEFORMAT,{selection:o,isWriterDocument:!0});u.splice(0,4),u.unshift({r:n}),Op.processMsg(u),Op.processMsg(Op.getCursor(d,d)),Op.cursorProcessed(),editor.lastOperation="Update Sheet Table",Op.sendMsg(),Notification.hide()},l=function(e,t,i){Notification.hide();var n,o,r=e.responseJSON,s=r.sheet_errorCode;switch(s){case"S401":n="writer.sheet.PERMISSION_DENIED_TO_UPDATE_TABLE";var l=editorProps.urls.zohoSheetURL+"/sheet/open/"+a.rid;o=["<a href='"+l+"' target='_blank' rel='nofollow noreferrer' >"+J.i18n("writer.mailmergepopup.LINK")+"</a>"];break;case"S404":n="writer.sheet.SHEET_NOT_FOUND";break;default:n="writer.sheet.UNABLE_TO_UPDATE_TABLE"}var d=J.i18n(n,o);UIUtils.showMessage("error",d,"showclose","normalfont",8e3)};h(a,{success:s,error:l}),J.dialogutil.close("changecellrangedialog")},S=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE),i=t.attr(ATTR_TABLE.SHEET_RANGE_INFO),n=parseInt(i.sRange.rtc.sr),o=parseInt(i.sRange.rtc.er),r=parseInt(i.sRange.rtc.sc),a=parseInt(i.sRange.rtc.ec),s=ListUtils.getListNumber(LIST_TYPE.UPPER_ALPHA,r,null,!0),l=ListUtils.getListNumber(LIST_TYPE.UPPER_ALPHA,a,null,!0),d={get:function(e){return"sc"==e.action?s:"ec"==e.action?l:"sr"==e.action?n:"er"==e.action?o:void 0},set:function(e,t,i){"sc"==e.action?0==t.length?i.value=t=s:ListUtils.AlphatoNumber(t)>256&&(i.value=t="IV"):"ec"==e.action?0==t.length?i.value=t=l:ListUtils.AlphatoNumber(t)>256&&(i.value=t="IV"):"sr"==e.action?0!=t.length&&/^\d+$/.test(t)?parseInt(t)>65536&&(i.value=t="65536"):i.value=t=n:"er"==e.action&&(0!=t.length&&/^\d+$/.test(t)?parseInt(t)>65536&&(i.value=t="65536"):i.value=t=o)}};J.dialogutil.open("changecellrangedialog",null,d)},R=function(e){var t,i;Array.isArray(e.range_details)&&(t=e.range_details.length,i=e.range_details[0].length);var n=document.createElement("table");J(n).css({"border-collapse":"collapse","font-family":"Roboto","font-size":"10pt","line-height":"1.2",color:"rgb(29, 29, 29)"});for(var o=0;o<t;o++){var r=document.createElement("tr"),a=e.range_details[o];n.appendChild(r);for(var s=0;s<i;s++){var l=document.createElement("td");r.appendChild(l),l.style.border="1px solid rgb(213, 213, 213)",l.style.padding="2px 4px",l.innerText=a[s]}}return n};return{getXfmIdx:n,setXfmIdx:i,clearXfmIdx:o,insertSheet:c,pickExistSheet:f,getSheetURL:a,updateSheetTable:I,removeLinkWithSheet:m,beforeSheetClose:p,beforeMenuShow:_,openSourceSheet:T,setThumbnailImg:g,changeRange:A,getSheetTable:R,openRangeDialog:S,getSheetDefaultImageBytes:s}}(),function(e){e.ZMenuHandler={init:function(){J(document).bind("zmenushow",function(e,t){EventHandler.isMenuOpened=!0}).bind("zmenuhide",function(e,t){if(J("#quicksearchinput").is(":visible")){var n=J("#quicksearchmenu li");for(i=0;i<n.length;i++){var o=J(n[i]).metadata();o.submenu&&o.submenu.is(t.menu)&&"click"==window.event.type&&QuickSearch.hideSearchBar()}}else if(J("#helpDiv").is(":visible")&&J("#helpDiv").hide(),t.isBaseMenu){EventHandler.isMenuOpened=!1;var r=Utils.WriterCallbacks.evaluate("onmenuhide");r&&!EventHandler.isDialogOpened&&EditorUtil.focusMultiByteSpan()}}),J("[ctype=zmenu], [ctype_lazy=zmenu], [zw-ctype=zmenu], [zw-ctype_lazy=zmenu]").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),J("#micro-tool-theme-clr").on("zcolorpickerpick",function(e,t){TableTheme.changeThemeObjColor(J(this)[0],t)}),J("#bookmark-popup").on("focusout",function(){J("#bookmark-popup").hide(),BookmarkDialog.isGetLinkDialogueOpened=!1})}}}(jQuery);var TableTheme=function(e,t,i,n,o,r){"use strict";var a="",s=function(){return[a]},l=function(e){a=e,n.publish("TableThemes/colorChanged")},d=function(r,a,s){if(r&&a){J(".zw-column").children(".dummyTable").remove(),void 0==o[a]&&(a="theme1");var l=f(a,s),d={},c={};c[ATTR_TABLE.TBLS_THEMENAME]=a,c.themeObj=l,d[ATTR_TABLE.TBLS_THEME]=c;for(var u=e.getTableCells(r),p=u.allCells,g=p.length,E=0;E<g;E++){var T=p[E],m=T.attr(),h={};m[ATTR_COMMON.BORDERS]&&(h[ATTR_COMMON.BORDERS]={}),m.z_td_bgc&&(h.z_td_bgc=""),0!=Object.keys(h).length&&T.attr(h)}t.doc.execCmd("applyStyle",[r,d,"tabletheme"]),i.addToStatistics("theme"),i.addToStatistics("table"+a),n.publish("TableThemes/themeChanged")}},c=function(e){var i=t.doc.getSelection().getParents(NODE_TYPE.TABLE),n=e.indexOf(",");if(n!=-1)o=e.slice(n+1,e.length-1),e=e.slice(1,n);else var o=s()[0];"theme1"==e?o="rgb(0,0,0)":"theme3"==e&&(o="rgb(122, 122, 122)"),d(i,e,o)},u=function(e,t){t/=100;var i=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),n=parseInt(i[0]),o=parseInt(i[1]),r=parseInt(i[2]),a=Math.round(n+t*(255-n)),s=Math.round(o+t*(255-o)),l=Math.round(r+t*(255-r));return"rgb("+a+","+s+","+l+")"},p=function(){var e="zwaccent1",t="zwaccent2",i="zwaccent3",n="zwaccent4",o="zwaccent5",r="zwaccent6",a=["rgb(0,0,0)","","rgb(122, 122, 122)",i,o,r,e,t,n,i,o,r,t,n,i,e,o,n,t,n,i,i,t,r,o,i,t,r,t,r];return a},g=function(e){var t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),i=parseInt(t[0]),n=parseInt(t[1]),o=parseInt(t[2]);return i+n+o>=620?"rgb(0,0,0)":"rgb(255,255,255)"},f=function(e,t){if("MultiColor"==t){var i=p();t=i[e.split("theme")[1]-1]}var n=o[e],a=r.getColorValFromRefString(t),s=t.indexOf("/")!=-1?t.split("/")[0]:t.split("*")[0],l=g(a);n.firstRow&&n.firstRow.para&&(n.firstRow.para.textFormat.fgc=l),n.lastRow&&n.lastRow.para&&(n.lastRow.para.textFormat.fgc=l),n.firstColumn&&n.firstColumn.para&&(n.firstColumn.para.textFormat.fgc=l),n.lastColumn&&n.lastColumn.para&&(n.lastColumn.para.textFormat.fgc=l),n.band1Horz&&n.band1Horz.para&&(n.band1Horz.para.textFormat.fgc=l),n.band2Horz&&n.band2Horz.para&&(n.band2Horz.para.textFormat.fgc=l);var d=u(a,80),c=u(a,60),f=u(a,40),T=u(a,20);if(s&&t.indexOf("rgb")==-1)if(t.indexOf("*")!=-1){if(t.indexOf("50")!=-1)var d=s+"/40",c=s+"/60",f=s+"/80",T=s+"/90";else if(t.indexOf("75")!=-1)var d=s+"/20",c=s+"/40",f=s+"/60",T=s+"/80"}else{var d=u(a,80),c=u(a,60),f=u(a,40),T=u(a,20);d=E(s,d),c=E(s,c),f=E(s,f),T=E(s,T)}var m=JSON.stringify(n).replaceAll("color100%",t).replaceAll("colorLight80%",d).replaceAll("colorLight60%",c).replaceAll("colorLight40%",f).replaceAll("colorLight20%",T);return JSON.parse(m)},E=function(e,t){var i=T(e),n=i.substring(i.indexOf("(")+1,i.lastIndexOf(")")).split(/,\s*/),o=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);if(255==n[0]||0==n[0]||255==o[0]||0==o[0])if(255==n[1]||0==n[1]||255==o[1]||0==o[1])var r=n[2],a=o[2];else var r=n[1],a=o[1];else var r=n[0],a=o[0];var s=(parseInt(a)-parseInt(r))/(255-parseInt(r));return e+"/"+(100-parseInt(100*s))},T=function(e){var t=/[z][w](\w|\*|\/)+/,i=/\#(\w|\*|\/)+/,n=t.test(e),o=i.test(e);if(!n&&!o)return e;var r=t.exec(e),a=i.exec(e),s=e,l=n?r[0].substr("zw".length):a[0].substr("#".length);if(l.indexOf("accent")>-1||l.indexOf("dark")>-1||l.indexOf("light")>-1){var d=null,c=null,p=null,g=DocumentDesign.getTheme();l.indexOf("*")>-1?(d=l.split("*")[0],c=parseInt(l.split("*")[1])):l.indexOf("/")>-1?(d=l.split("/")[0],p=parseInt(l.split("/")[1])):d=l,d=g.color[d],s=c||p?c?m(d,100-c):u(d,100-p):d}return s},m=function(e,t){var i=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),n=parseInt(i[0]),o=parseInt(i[1]),r=parseInt(i[2]);t/=100;var a=Math.round(n*t),s=Math.round(o*t),l=Math.round(r*t);return"rgb("+a+","+s+","+l+")"},h=function(e,t){var i=T(e),n=i.substring(i.indexOf("(")+1,i.lastIndexOf(")")).split(/,\s*/),o=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);if(255==n[0]||0==n[0]||255==o[0]||0==o[0])if(255==n[1]||0==n[1]||255==o[1]||0==o[1])var r=n[2],a=o[2];else var r=n[1],a=o[1];else var r=n[0],a=o[0];var s=(parseInt(r)-parseInt(a))/parseInt(r);return e+"*"+parseInt(100*s)},I=function(e,i){var n=r.getColorReference(arguments[1]),o=t.doc.getSelection().getParents(NODE_TYPE.TABLE),a=o.dtNode.theme.themeName;l(r.getColorReference(arguments[1])),d(o,a,n)};return{getThemeColor:s,setThemeColor:l,changeThemeObjColor:I,getZWColorAfterShade:h,getColorValFromRefString:T,getZWColorAfterTint:E,getParaFontColor:g,getMultiColor:p,getTintColor:u,applyTheme:c,getShadeColor:m}}(TableUtil,editor,ZWLogger,PubSub,TableNewThemeInfo,Utils);Scale.prototype.destroy=function(){this.view.destroy(),this.unitProps=null,this.viewProps=null,this.view=null},Scale.prototype.getContent=function(){return this.view.getContent()},Scale.prototype.setWidth=function(e){this.width=e,this.view.updateWidth()},Scale.prototype.setHeight=function(e){this.height=e,this.view.updateHeight()},Scale.prototype.setMaxWidth=function(e){this.maxWidth=e,this.view.contructScale()},Scale.prototype.setMaxHeight=function(e){this.maxHeight=e,this.view.contructScale()},Scale.prototype.setZoomFactor=function(e){this.zoomFactor=e,this.view.updateScaleCSS()},Scale.prototype.setUnit=function(e){this.unit=e,this.view.contructScale()},Scale.prototype.setOrientation=function(e){if(this.orientation=e,e==ORIENTATION.HORIZONTAL&&parseFloat(this.height)>parseFloat(this.width)||e==ORIENTATION.VERTICAL&&parseFloat(this.width)>parseFloat(this.height)){var t=this.width;this.setWidth(this.height),this.setHeight(t)}this.view.contructScale()},Scale.prototype.setType=function(e){this.type=e,this.view.updateView()},Scale.prototype.attachTo=function(e){this.viewProps.parent=e,this.view.attach()};var UNIT_PROPS={in:{incrementVal:1,fragMeasurement:"1in",fragSegmentCount:8},mm:{incrementVal:20,fragMeasurement:"20mm",fragSegmentCount:4},cm:{incrementVal:1,fragMeasurement:"1cm",fragSegmentCount:10},pt:{incrementVal:36,fragMeasurement:"36pt",fragSegmentCount:6}},SCALE_TYPE={REGULAR:"REGULAR",INVERSE:"INVERSE"},SCALE_CSS_STR=" #{{sid}}.ui-scale-container .ui-fragment-container { width: {{containerwidth}}; }  #{{sid}}.ui-scale-container .ui-fragment-container { height:{{containerheight}}; }  #{{sid}}.ui-regular-scale .ui-fragment-container { counter-reset: frag-number {{regularstartingnumber}}; }  #{{sid}}.ui-inverse-scale .ui-fragment-container { counter-reset: frag-number {{inversestartingnumber}}; }  #{{sid}}.ui-horizontal-scale .ui-frag-parent span { width: {{spanwidth}}; }  #{{sid}}.ui-vertical-scale .ui-frag-parent span { height: {{spanheight}}; }  #{{sid}}.ui-scale-container .ui-frag-parent { width: {{fragwidth}}; width: {{mozfragwidth}}; }  #{{sid}}.ui-scale-container .ui-frag-parent { height: {{fragheight}}; height: {{mozfragheight}}; }  #{{sid}}.ui-regular-scale .ui-frag-parent::before { counter-increment: frag-number {{fragincrement}}; }  #{{sid}}.ui-inverse-scale .ui-frag-parent::before { counter-increment: frag-number -{{fragincrement}}; }  #{{sid}}.ui-scale-container .ui-frag-parent::before{ width: {{countertextwidth}}; width: {{mozcountertextwidth}}; } ";ScaleView.prototype.destroy=function(){this.detach(),this.scale=null,this.scaleContainer=null,this.styleTag=null},ScaleView.prototype.getContent=function(){return this.scaleContainer.outerHTML},ScaleView.prototype.getFragmentHTML=function(){for(var e="",t=0,i=this.scale.unitProps[this.scale.unit].fragSegmentCount;t<i;t++)e+="<span></span>";return e='<div class="ui-frag-parent">'+e+"</div>"},ScaleView.prototype.updateView=function(){var e=["ui-scale-container"],t=this.scale.viewProps.classStr;e.push(t||""),this.scale.orientation==ORIENTATION.HORIZONTAL?e.push("ui-horizontal-scale"):e.push("ui-vertical-scale"),this.scale.type==SCALE_TYPE.REGULAR?e.push("ui-regular-scale"):e.push("ui-inverse-scale"),this.scaleContainer.className=e.join(" ")},ScaleView.prototype.getFragmentCount=function(){var e,t=this.scale.unitProps[this.scale.unit];e=this.scale.orientation==ORIENTATION.HORIZONTAL?this.scale.maxWidth:this.scale.maxHeight;var i=Math.ceil(e.convertUnitTo(this.scale.unit)/parseFloat(t.fragMeasurement));return i+10},ScaleView.prototype.contructScale=function(){var e=this.getFragmentCount();this.updateScaleHTML(e),this.updateScaleCSS(e),this.updateView()},ScaleView.prototype.updateScaleHTML=function(e){e=e||this.getFragmentCount();for(var t="",i=this.getFragmentHTML(),n=0;n<e;n++)t+=i;t='<div class="ui-fragment-container">'+t+"</div>",this.scaleContainer.innerHTML=t},ScaleView.prototype.updateScaleCSS=function(e){e=e||this.getFragmentCount();var t=this.scale.unitProps[this.scale.unit],i=t.incrementVal*e,n=0,o=t.incrementVal+i;i*=this.scale.zoomFactor;var r=parseFloat(t.fragMeasurement)*this.scale.zoomFactor,a=1/t.fragSegmentCount*100+"%",s=r+this.scale.unit,l=s;this.scale.unit==RULER_UNITS.MM&&(l=r+"mozmm");var d,c,u,p,g,f;this.scale.orientation==ORIENTATION.HORIZONTAL?(d=i+this.scale.unit,u=a,g=s,mozfragWidth=l,c=p=f=mozfragHeight="inherit"):(c=i+this.scale.unit,p=a,f=s,mozfragHeight=l,d=u=g=mozfragWidth="inherit");var E=SCALE_CSS_STR.replace(/\{\{sid\}\}/g,this.scale.id);E=E.replace(/\{\{containerwidth\}\}/,d),E=E.replace(/\{\{containerheight\}\}/,c),E=E.replace(/\{\{spanwidth\}\}/,u),E=E.replace(/\{\{spanheight\}\}/,p),E=E.replace(/\{\{fragwidth\}\}/,g),E=E.replace(/\{\{mozfragwidth\}\}/,mozfragWidth),E=E.replace(/\{\{fragheight\}\}/,f),E=E.replace(/\{\{mozfragheight\}\}/,mozfragHeight),E=E.replace(/\{\{regularstartingnumber\}\}/,n),E=E.replace(/\{\{inversestartingnumber\}\}/,o),E=E.replace(/\{\{fragincrement\}\}/g,t.incrementVal),E=E.replace(/\{\{countertextwidth\}\}/,s),E=E.replace(/\{\{mozcountertextwidth\}\}/,l),this.styleTag.innerHTML=E},ScaleView.prototype.updateWidth=function(){this.scaleContainer.style.width=this.scale.width},ScaleView.prototype.updateHeight=function(){this.scaleContainer.style.height=this.scale.height},ScaleView.prototype.attach=function(){document.head.appendChild(this.styleTag),this.scale.viewProps.parent.appendChild(this.scaleContainer)},ScaleView.prototype.detach=function(){document.head.removeChild(this.styleTag),this.scale.viewProps.parent&&this.scale.viewProps.parent.removeChild(this.scaleContainer)};var RULER_UNITS={INCH:"in",MM:"mm",CM:"cm",POINT:"pt",PIXELS:"px"},ORIENTATION={HORIZONTAL:"HORIZONTAL",VERTICAL:"VERTICAL"},ORIENTATION_PROPS={HORIZONTAL:{axis:"x",start:"left",end:"right",sizeProp:"width"},VERTICAL:{axis:"y",start:"top",end:"bottom",sizeProp:"height"}},PROCESSING_TYPE={REGULAR:1,INVERSE:-1},RulerUtil=function(){var e=function(e){return{left:t(e),top:i(e)}},t=function(e){var t=0;do t+=e.offsetLeft,e=e.offsetParent;while(null!=e);return t},i=function(e){var t=0;do t+=e.offsetTop,e=e.offsetParent;while(null!=e);return t},n=function(e,t){var i={};if(t==RULER_ALIGN.FRONT)i={start:0,end:e};else if(t==RULER_ALIGN.MIDDLE){var n=e/2;i={start:n,end:n}}else t==RULER_ALIGN.REAR&&(i={start:e,end:0});return i};return{getElemOffset:e,getOffsetLeft:t,getOffsetTop:i,getDeltaRelativeToAlignment:n}};RulerUtil=RulerUtil(),RulerCustomObject.prototype.createContent=function(){var e=document.createElement("div");e.id=this.id,e.style.width=this.width,e.style.height=this.height,e.className=this.classStr,this.node=e},RulerCustomObject.prototype.setWidth=function(e){this.width=e,this.node.style.width=e},RulerCustomObject.prototype.setHeight=function(e){this.height=e,this.node.style.height=e},RulerCustomObject.prototype.attachTo=function(e){this.parent=e,this.parent.appendChild(this.node)},RulerCustomObject.prototype.detach=function(e){this.parent&&this.parent.removeChild(this.node)},RulerCustomObject.prototype.detroy=function(e){this.detach(),this.parent=null,this.node=null},RulerElement.prototype.getContainer=function(){return this.view.getContainer()},RulerElement.prototype.setDraggable=function(e){this.isDraggable=e},RulerElement.prototype.setDragRect=function(e){this.dragRect=e},RulerElement.prototype.setZoomFactor=function(e){this.zoomFactor=e,this.view.updateWidth(),this.view.updateHeight(),this.view.updatePosition()},RulerElement.prototype.setResizable=function(e){this.resizableOption=e,this.view.updateView()},RulerElement.prototype.updateResizeMargin=function(){this.resizeMargin=this.sizeInPx*this.resizeMarginRatio},RulerElement.prototype.setWidth=function(e){this.width=e,this.widthInPx=e.convertUnitTo(RULER_UNITS.PIXELS),this.orientation===ORIENTATION.HORIZONTAL&&(this.sizeInPx=this.widthInPx,this.updateResizeMargin()),this.updateRect(),this.view&&(this.view.updatePosition(),this.view.updateWidth())},RulerElement.prototype.setHeight=function(e){this.height=e,this.heightInPx=e.convertUnitTo(RULER_UNITS.PIXELS),this.orientation===ORIENTATION.VERTICAL&&(this.sizeInPx=this.heightInPx,this.updateResizeMargin()),this.updateRect(),this.view&&(this.view.updatePosition(),this.view.updateHeight())},RulerElement.prototype.setMaxSize=function(e){this.maxSize=e,this.maxSizeInPx=e.convertUnitTo(RULER_UNITS.PIXELS)},RulerElement.prototype.setMinSize=function(e){this.minSize=e,this.minSizeInPx=e.convertUnitTo(RULER_UNITS.PIXELS)},RulerElement.prototype.setOffset=function(e){this.offset=e,this.updateRect(),this.view&&this.view.updatePosition()},RulerElement.prototype.getRect=function(e,t){var i,n,o=ORIENTATION_PROPS[this.orientation].start,r=ORIENTATION_PROPS[this.orientation].end;this.orientation===ORIENTATION.HORIZONTAL?(i=t,n=this.heightInPx):(i=this.widthInPx,n=t);var a={left:e.left,right:e.left+i,top:e.top,bottom:e.top+n},s=RulerUtil.getDeltaRelativeToAlignment(t,this.align);return a[o]=e[o]-s.start,a[r]=e[o]+s.end,a},RulerElement.prototype.updateRect=function(){this.width&&this.height&&this.offset&&(this.rect=this.getRect(this.offset,this.sizeInPx))},RulerElement.prototype.destroy=function(){this.view.destroy(),this.offset=null,this.rect=null,this.dragRect=null,this.viewProps=null,this.eventProps=null,this.ruler=null,this.view=null,this.currentOperation=null},RulerElement.prototype.attachTo=function(e){this.viewProps.parent=e,this.view.attach()},RulerElement.prototype.remove=function(){this.view.detach()},RulerElement.prototype.handleMouseDown=function(e,t,i){return this.currentOperation={type:e.type,clickType:e.clickType,mouseDownCoords:t,originalOffset:{left:this.offset.left,top:this.offset.top},originalSizeInPx:this.sizeInPx},PubSub.publish(this.ruler.id+"/MouseDown",this.eventProps,this.currentOperation.clickType,this,t,i),this.rect},RulerElement.prototype.handleMouseUp=function(e,t){ORIENTATION_PROPS[this.orientation].axis;if(this.currentOperation&&this.currentOperation.type){var i=this.currentOperation.mouseDownCoords,n=this.processDisplacement(i,e);PubSub.publish(this.ruler.id+"/MouseUp",this.eventProps,this.currentOperation.clickType,this,e,t,n),this.currentOperation=null}},RulerElement.prototype.handleMouseMove=function(e,t){if(this.currentOperation&&this.currentOperation.type){var i=this.processDisplacement(this.currentOperation.mouseDownCoords,e);return this.hideOutOfDragRect&&i.outOfRect?(this.view.hide(),null):(this.view.show(),PubSub.publish(this.ruler.id+"/MouseMove",this.eventProps,this.currentOperation.clickType,this,e,t,i),i.newRect)}},RulerElement.prototype.updateDisplacement=function(e){e.offset&&this.setOffset(e.offset),this.orientation===ORIENTATION.HORIZONTAL?this.setWidth(e.sizeInPx+RULER_UNITS.PIXELS):this.setHeight(e.sizeInPx+RULER_UNITS.PIXELS)},RulerElement.prototype.processDisplacement=function(e,t){var i=ORIENTATION_PROPS[this.orientation].axis,n=t[i]-e[i],o=ORIENTATION_PROPS[this.orientation].start,r=ORIENTATION_PROPS[this.orientation].end,a={offset:{left:this.currentOperation.originalOffset.left,top:this.currentOperation.originalOffset.top},sizeInPx:this.sizeInPx,displacement:0};if("drag"===this.currentOperation.type){var s=a.offset[o];if(0==n||s==this.dragRect[o]&&n<0||s==this.dragRect[r]&&n>0)a.displacement=0;else{n*=this.computationFactor;var l=n;this.actualValue&&(l+=this.actualValue);var d=Math.round(l/this.ruler.roundingFactor)*this.ruler.roundingFactor,c=d-l;a.displacement=(n+c)*this.computationFactor}var u=s+a.displacement;u>this.dragRect[r]?u=this.dragRect[r]:u<this.dragRect[o]&&(u=this.dragRect[o]),a.displacement=u-s,a.offset[o]=u,a.newRect=this.getRect(a.offset,a.sizeInPx),t.x.isBetween(this.dragRect.left,this.dragRect.right,!0)&&t.y.isBetween(this.dragRect.top,this.dragRect.bottom,!0)?a.outOfRect=!1:a.outOfRect=!0}else if("resizeBefore"===this.currentOperation.type||"resizeAfter"===this.currentOperation.type){var p,g=this.currentOperation.originalSizeInPx,f=this.align==RULER_ALIGN.MIDDLE?2*n:n;f=Math.round(f/this.ruler.roundingFactor)*this.ruler.roundingFactor,"resizeBefore"===this.currentOperation.type?(p=g-f,p<this.minSizeInPx?p=this.minSizeInPx:this.maxSizeInPx<p&&(p=this.maxSizeInPx),f=p-g,n=this.align==RULER_ALIGN.MIDDLE?f/2:f,this.align==RULER_ALIGN.FRONT&&(a.displacement=n,a.offset[o]-=n)):(p=g+f,p<this.minSizeInPx?p=this.minSizeInPx:this.maxSizeInPx<p&&(p=this.maxSizeInPx)),a.sizeInPx=p,a.newRect=this.getRect(a.offset,a.sizeInPx),a.changeInSize=p-g}return a};var RESIZABLE_TYPE={NONE:0,BEFORE:1,AFTER:2},RULER_ALIGN={FRONT:0,MIDDLE:1,REAR:2};TableResizeElement.prototype=Object.create(RulerElement.prototype),TableResizeElement.prototype.constructor=TableResizeElement,TabPointElement.prototype=Object.create(RulerElement.prototype),TabPointElement.prototype.constructor=TabPointElement,IndentElement.prototype=Object.create(RulerElement.prototype),IndentElement.prototype.constructor=IndentElement,RulerElementView.prototype.getContainer=function(){return this.elementNode},RulerElementView.prototype.show=function(){this.elementNode.style.display="block"},RulerElementView.prototype.hide=function(){this.elementNode.style.display="none"},RulerElementView.prototype.updateWidth=function(){var e=this.getWidth();this.elementNode.style.width=e+RULER_UNITS.PIXELS},RulerElementView.prototype.getWidth=function(){var e=this.element.widthInPx;return this.element.orientation==ORIENTATION.HORIZONTAL&&(e*=this.element.zoomFactor),e},RulerElementView.prototype.updateHeight=function(){var e=this.getHeight();this.elementNode.style.height=e+RULER_UNITS.PIXELS},RulerElementView.prototype.getHeight=function(){var e=this.element.heightInPx;return this.element.orientation==ORIENTATION.VERTICAL&&(e*=this.element.zoomFactor),e},RulerElementView.prototype.updateView=function(){this.elementNode.className=this.element.viewProps.classStr||"",this.element.viewProps.zIndex&&(this.elementNode.style.zIndex=this.element.viewProps.zIndex),this.updatePosition(),this.updateWidth(),this.updateHeight()},RulerElementView.prototype.updatePosition=function(){var e=this.getOffset();this.elementNode.style.left=e.left+RULER_UNITS.PIXELS,this.elementNode.style.top=e.top+RULER_UNITS.PIXELS},RulerElementView.prototype.getOffset=function(){var e=this.element.rect.top,t=this.element.rect.left;return this.element.orientation==ORIENTATION.HORIZONTAL?t*=this.element.zoomFactor:e*=this.element.zoomFactor,{left:t,top:e}},RulerElementView.prototype.attach=function(){this.element.viewProps.parent.appendChild(this.elementNode),this.attached=!0,this.updateView()},RulerElementView.prototype.detach=function(){this.element.viewProps.parent&&this.element.viewProps.parent.removeChild(this.elementNode),this.attached=!1},RulerElementView.prototype.destroy=function(){this.attached&&this.detach(this.elementNode),this.element.viewProps.parent=null,this.elementNode=null,this.element=null},RulerEvtHandler.prototype.bindEvents=function(){this.eventNode.addEventListener("mousedown",this.mouseDownHandler),this.eventNode.addEventListener("mouseup",this.mouseUpHandler),this.eventNode.addEventListener("mousemove",this.mouseMoveHandler),this.eventNode.addEventListener("mouseout",this.mouseOutHandler)},RulerEvtHandler.prototype.unbindEvents=function(){this.eventNode.removeEventListener("mousedown",this.mouseDownHandler),this.eventNode.removeEventListener("mouseup",this.mouseUpHandler),this.eventNode.removeEventListener("mousemove",this.mouseMoveHandler),this.eventNode.removeEventListener("mouseout",this.mouseOutHandler)},RulerEvtHandler.prototype.destroy=function(){this.unbindEvents(),this.ruler.container.removeChild(this.eventNode),this.ruler.container.removeChild(this.lineNode),this.ruler=null,this.eventNode=null,this.lineNode=null,this.mouseDownHandler=null,this.mouseUpHandler=null,this.mouseMoveHandler=null,this.mouseOutHandler=null,this.currentOperation=null,this.hoverOperation=null,this.mouseCoords=null},RulerEvtHandler.prototype.getObsoluteOffset=function(e){return{left:this.ruler.containerRect.left+e.left,top:this.ruler.containerRect.top+e.top}},RulerEvtHandler.prototype.getRelativeCoords=function(e){var t={x:e.x-this.ruler.containerRect.left,y:e.y-this.ruler.containerRect.top},i=ORIENTATION_PROPS[this.ruler.orientation].axis;return t[i]=t[i]/this.ruler.zoomFactor,t},RulerEvtHandler.prototype.findElementAt=function(e){var t,i,n=null;for(t in this.ruler.elements)i=this.ruler.elements[t],e.x.isBetween(i.rect.left,i.rect.right,!0)&&e.y.isBetween(i.rect.top,i.rect.bottom,!0)&&(!n||n.priority<i.priority)&&(n=i);return n},RulerEvtHandler.prototype.getCurrentOperationAt=function(e){var t=this.findElementAt(e);if(t&&t.shouldHandleEvent){var i,n=t.resizableOption,o=ORIENTATION_PROPS[t.orientation].axis,r=ORIENTATION_PROPS[t.orientation].start,a=ORIENTATION_PROPS[t.orientation].end;return i=n.contains(RESIZABLE_TYPE.BEFORE)&&e[o].isBetween(t.rect[r],t.rect[r]+t.resizeMargin,!0)?"resizeBefore":n.contains(RESIZABLE_TYPE.AFTER)&&e[o].isBetween(t.rect[a]-t.resizeMargin,t.rect[a],!0)?"resizeAfter":t.isDraggable&&e[o].isBetween(t.rect[r]+t.resizeMargin,t.rect[a]-t.resizeMargin)?"drag":"none",{element:t,type:i}}return null},RulerEvtHandler.prototype.mouseDownHandler=function(e){if(!this.currentOperation){this.eventNode.removeAttribute("title");var t=Utils.getCorrectedCoord(e),i=this.getRelativeCoords(t);if(this.mouseCoords.x==i.x&&this.mouseCoords.y==i.y||(this.mouseCoords=i),this.currentOperation=this.getCurrentOperationAt(this.mouseCoords),0==e.button){if(!this.currentOperation)return;this.currentOperation.clickType="leftClick";var n=this.currentOperation.element.handleMouseDown(this.currentOperation,i,t);"none"!==this.currentOperation.type&&this.updateLineDiv(n)}else{if(2!=e.button)return;if(!this.currentOperation)return;this.currentOperation.clickType="rightClick",this.currentOperation.element.handleMouseDown(this.currentOperation,i,t)}}},RulerEvtHandler.prototype.mouseUpHandler=function(e){if(this.currentOperation){var t=Utils.getCorrectedCoord(e),i=this.getRelativeCoords(t);this.currentOperation.element.handleMouseUp(i,t),this.currentOperation=null,this.lineNode.style.display="none"}},RulerEvtHandler.prototype.mouseMoveHandler=function(e){var t=Utils.getCorrectedCoord(e);if(this.mouseCoords=this.getRelativeCoords(t),this.currentOperation){var i=this.currentOperation.element.handleMouseMove(this.mouseCoords,t);this.updateLineDiv(i)}else{this.hoverOperation=this.getCurrentOperationAt(this.mouseCoords);var n="auto";if(this.hoverOperation){var o=this.hoverOperation.element;if("drag"==this.hoverOperation.type?n="pointer":"resizeBefore"==this.hoverOperation.type?n=o.orientation===ORIENTATION.HORIZONTAL?"w-resize":"n-resize":"resizeAfter"==this.hoverOperation.type&&(n=o.orientation===ORIENTATION.HORIZONTAL?"e-resize":"s-resize"),this.hoverOperation.element.title){var r;r=o.orientation===ORIENTATION.HORIZONTAL?{left:(o.rect.left+o.rect.right)/2,top:o.rect.bottom}:{left:o.rect.right,top:(o.rect.top+o.rect.bottom)/2},this.eventNode.setAttribute("title",o.title),this.eventNode.setAttribute("data-title-display-type","box"),this.eventNode.setAttribute("data-title-position","bottom"),this.eventNode.setAttribute("data-title-offset",JSON.stringify(this.getObsoluteOffset(r))),this.eventNode.setAttribute("data-title-margin",JSON.stringify({top:"5px"}))}}this.eventNode.style.cursor=n}},RulerEvtHandler.prototype.mouseOutHandler=function(e){this.eventNode.removeAttribute("title")},RulerEvtHandler.prototype.updateLineDiv=function(e){if(null==e)return void(this.lineNode.style.display="none");var t=this.currentOperation.element,i={left:this.ruler.containerRect.left+e.right,top:this.ruler.containerRect.top+e.bottom},n=ORIENTATION_PROPS[t.orientation].start,o=ORIENTATION_PROPS[t.orientation].end,r=this.ruler.containerRect[n];if("resizeBefore"===this.currentOperation.type)i[n]=e[n]*t.zoomFactor;else if("resizeAfter"===this.currentOperation.type)i[n]=e[o]*t.zoomFactor;else if("drag"===this.currentOperation.type){var a=0;t.align==RULER_ALIGN.FRONT?a=e[n]:t.align==RULER_ALIGN.MIDDLE?a=(e[n]+e[o])/2:t.align==RULER_ALIGN.REAR&&(a=e[o]),i[n]=a*t.zoomFactor}i[n]+=r,this.lineNode.style.display="block",this.lineNode.style.left=i.left+RULER_UNITS.PIXELS,this.lineNode.style.top=i.top+RULER_UNITS.PIXELS},Ruler.prototype.updateRect=function(){var e=RulerUtil.getElemOffset(this.container);this.containerRect={left:e.left,top:e.top,right:e.left+this.widthInPx,bottom:e.top+this.heightInPx}},Ruler.prototype.getComputedProps=function(e){var t,i,n=e.convertUnitTo(RULER_UNITS.PIXELS);return this.orientation==ORIENTATION.HORIZONTAL?(t=n,i=this.heightInPx):(t=this.widthInPx,i=n),{size:e,sizeInPx:n,width:t+RULER_UNITS.PIXELS,height:i+RULER_UNITS.PIXELS}},Ruler.prototype.setZoomFactor=function(e){this.zoomFactor=e,this.view&&(this.view.updateWidth(),this.view.updateHeight())},Ruler.prototype.setInteractable=function(e){this.isInteractable=e,this.isInteractable?this.evtHandler=this.evtHandler?this.evtHandler:new RulerEvtHandler(this):(this.evtHandler&&this.evtHandler.destroy(),this.evtHandler=null)},Ruler.prototype.setWidth=function(e){this.width=e,this.widthInPx=this.width.convertUnitTo(RULER_UNITS.PIXELS),this.orientation===ORIENTATION.HORIZONTAL&&(this.sizeInPx=this.widthInPx),this.view&&this.view.updateWidth()},Ruler.prototype.setHeight=function(e){this.height=e,this.heightInPx=this.height.convertUnitTo(RULER_UNITS.PIXELS),this.orientation===ORIENTATION.VERTICAL&&(this.sizeInPx=this.heightInPx),this.view&&this.view.updateHeight()},Ruler.prototype.setUnit=function(e){this.unit=e},Ruler.prototype.setOrientation=function(e){if(this.orientation=e,e==ORIENTATION.HORIZONTAL&&this.heightInPx>this.widthInPx||e==ORIENTATION.VERTICAL&&this.widthInPx>this.heightInPx){var t=this.width;this.setWidth(this.height),this.setHeight(t)}},Ruler.prototype.setDirection=function(e){this.direction=e},Ruler.prototype.addElement=function(e,t){this.elements[e]=t,t.attachTo(this.container)},Ruler.prototype.removeElement=function(e){var t=this.elements[e];return t&&t.remove(),delete this.elements[e],t},Ruler.prototype.reset=function(){var e,t;for(e in this.elements)this.elements[e].retainOnReset||(t=this.removeElement(e),t&&t.destroy())},Ruler.prototype.attachTo=function(e){this.viewProps.parent=e,this.view.attach(),this.updateRect()},Ruler.prototype.destroy=function(){this.reset(),this.setInteractable(!1),this.elements=null,this.view.destroy(),this.viewProps.parent=null,this.viewProps=null,this.view=null,this.containerRect=null};var DIRECTION={LEFT_TO_RIGHT:1,RIGHT_TO_LEFT:2,TOP_TO_BOTTOM:3,BOTTOM_TO_TOP:4};RulerView.prototype.updateWidth=function(){var e=this.ruler.widthInPx;this.ruler.orientation==ORIENTATION.HORIZONTAL&&(e*=this.ruler.zoomFactor),this.ruler.container.style.width=e+RULER_UNITS.PIXELS},RulerView.prototype.updateHeight=function(){var e=this.ruler.heightInPx;this.ruler.orientation==ORIENTATION.VERTICAL&&(e*=this.ruler.zoomFactor),this.ruler.container.style.height=e+RULER_UNITS.PIXELS},RulerView.prototype.attach=function(){this.ruler.viewProps.parent.appendChild(this.ruler.container)},RulerView.prototype.destroy=function(){this.ruler.viewProps.parent.removeChild(this.ruler.container),this.ruler.container=null,this.ruler=null};var MARGIN_AREA={BEFORE:"before",AFTER:"after"},COLUMN_SPACE_PROPS={PAGE_COLUMN:{resizableOption:RESIZABLE_TYPE.BEFORE|RESIZABLE_TYPE.AFTER,resizeMarginRatio:.5,classStr:"ui-ruler-icon ui-ruler-colspace",updateOnMouseMove:!1,isDraggable:!1,shouldHandleEvent:!0,defaultSize:"25px",groupName:"PageColumnSpace",title:J.i18n("writer.common.RULER.RESIZE_PAGE_COLUMN")},TABLE_COLUMN:{resizableOption:RESIZABLE_TYPE.NONE,resizeMarginRatio:0,classStr:"ui-ruler-icon ui-ruler-tablecolspace",updateOnMouseMove:!0,isDraggable:!0,shouldHandleEvent:!0,defaultSize:"12px",groupName:"TableColumnSpace",title:J.i18n("writer.common.RULER.RESIZE_TABLE_COLUMN")}},MARGIN_TITLE={HORIZONTAL:{before:J.i18n("writer.common.RULER.LeftMargin"),after:J.i18n("writer.common.RULER.RightMargin")},VERTICAL:{before:J.i18n("writer.common.RULER.TOP_MARGIN"),after:J.i18n("writer.common.RULER.BOTTOM_MARGIN")}};ZWRuler.prototype=Object.create(Ruler.prototype),ZWRuler.prototype.constructor=ZWRuler,ZWRuler.prototype.setZoomFactor=function(e){Ruler.prototype.setZoomFactor.call(this,e),this.scale1&&this.scale1.setZoomFactor(e),this.scale2&&this.scale2.setZoomFactor(e);for(var t in this.elements){var i=this.elements[t];i.setZoomFactor(e)}},ZWRuler.prototype.setRulerLayoutProps=function(e){this.layoutProps=e,this.processMarginProps(),this.processColumnProps(),this.setMarginMinMaxSize()},ZWRuler.prototype.processMarginProps=function(){this.computedMargins.before=this.getComputedMargin(MARGIN_AREA.BEFORE,this.layoutProps.marginBefore.size),this.marginBeforeElement?this.updateMarginElement(this.marginBeforeElement,this.computedMargins.before.size,this.getMarginBeforeOffset()):this.createMarginBefore(),this.computedMargins.after=this.getComputedMargin(MARGIN_AREA.AFTER,this.layoutProps.marginAfter.size),this.marginAfterElement?this.updateMarginElement(this.marginAfterElement,this.computedMargins.after.size,this.getMarginAfterOffset()):this.createMarginAfter()},ZWRuler.prototype.getComputedMargin=function(e,t){var i,n,o=t.convertUnitTo(RULER_UNITS.PIXELS),r=0,a=0;return this.orientation==ORIENTATION.HORIZONTAL?(i=o,n=this.heightInPx,r=e===MARGIN_AREA.BEFORE?0:this.widthInPx-o):(i=this.widthInPx,n=o,a=e===MARGIN_AREA.BEFORE?0:this.heightInPx-o),{size:t,sizeInPx:o,width:i+RULER_UNITS.PIXELS,height:n+RULER_UNITS.PIXELS,rect:{top:a,left:r,bottom:a+n,right:r+i}}},ZWRuler.prototype.createMarginBefore=function(){var e={id:this.id+"margin-before-element",rulerInstance:this,orientation:this.orientation,zoomFactor:this.zoomFactor,width:this.computedMargins.before.width,height:this.computedMargins.before.height,offset:this.getMarginBeforeOffset(),viewProps:{parent:this.container,classStr:"ui-ruler-margin"},eventProps:{groupName:"MarginBefore"},priority:3,shouldHandleEvent:!0,isDraggable:!1,align:RULER_ALIGN.FRONT,resizableOption:RESIZABLE_TYPE.AFTER,resizeMarginRatio:1,title:MARGIN_TITLE[this.orientation].before,updateOnMouseMove:!0,retainOnReset:!0};this.marginBeforeElement=new RulerElement(e),this.addElement(this.marginBeforeElement.id,this.marginBeforeElement)},ZWRuler.prototype.getMarginBeforeOffset=function(){return{left:this.computedMargins.before.rect.left,top:this.computedMargins.before.rect.top}},ZWRuler.prototype.getMarginAfterOffset=function(){return{left:this.orientation===ORIENTATION.HORIZONTAL?this.computedMargins.after.rect.right:this.computedMargins.after.rect.left,top:this.orientation===ORIENTATION.VERTICAL?this.computedMargins.after.rect.bottom:this.computedMargins.after.rect.top}},ZWRuler.prototype.createMarginAfter=function(){var e={id:this.id+"margin-after-element",rulerInstance:this,orientation:this.orientation,zoomFactor:this.zoomFactor,width:this.computedMargins.after.width,height:this.computedMargins.after.height,offset:this.getMarginAfterOffset(),viewProps:{parent:this.container,classStr:"ui-ruler-margin"},eventProps:{groupName:"MarginAfter"},priority:3,shouldHandleEvent:!0,isDraggable:!1,align:RULER_ALIGN.REAR,resizableOption:RESIZABLE_TYPE.BEFORE,resizeMarginRatio:1,title:MARGIN_TITLE[this.orientation].after,updateOnMouseMove:!0,retainOnReset:!0};this.marginAfterElement=new RulerElement(e),this.addElement(this.marginAfterElement.id,this.marginAfterElement)},ZWRuler.prototype.updateMarginElement=function(e,t,i){this.orientation===ORIENTATION.HORIZONTAL?e.setWidth(t):e.setHeight(t),e.setOffset(i)},ZWRuler.prototype.setMarginMinMaxSize=function(){this.marginBeforeElement.setMinSize(this.layoutProps.marginBefore.minSize),this.marginAfterElement.setMinSize(this.layoutProps.marginAfter.minSize);var e=this.computedColProps.columnArea[0],t=this.computedColProps.columnArea[this.layoutProps.columnCount-1],i=this.computedMargins.before.sizeInPx+e.sizeInPx-this.layoutProps.minColumnAreaInPx,n=this.computedMargins.after.sizeInPx+t.sizeInPx-this.layoutProps.minColumnAreaInPx;if(this.layoutProps.columnType==COLUMN_TYPE.PAGE){if(this.indentProps&&1==this.layoutProps.columnCount&&(this.direction===DIRECTION.LEFT_TO_RIGHT||this.direction===DIRECTION.RIGHT_TO_LEFT)){var o=Math.max(this.indentProps[TABSELECTORS.RIGHTINDENT].value,0),r=Math.max(this.indentProps[TABSELECTORS.LEFTINDENT].value,this.indentProps[TABSELECTORS.FIRSTLINEINDENT].value,0);i-=r+o,n-=r+o}}else{var a=this.sizeInPx-(this.computedMargins.before.sizeInPx+this.computedMargins.after.sizeInPx);i=this.sizeInPx-a}i<this.computedMargins.before.sizeInPx&&(i=this.computedMargins.before.sizeInPx),n<this.computedMargins.after.sizeInPx&&(n=this.computedMargins.after.sizeInPx),i=this.layoutProps.marginBefore.maxSize||i+RULER_UNITS.PIXELS,n=this.layoutProps.marginAfter.maxSize||n+RULER_UNITS.PIXELS,this.marginBeforeElement.setMaxSize(i),this.marginAfterElement.setMaxSize(n)},ZWRuler.prototype.processColumnProps=function(){this.removeAllColumnSpaceElements(),this.computeColProps(),this.currentColumnElement?this.updateCurrentColumnElement():this.createCurrentColumnElement(),this.createColumnSpaceElements()},ZWRuler.prototype.updateCurrentColumnElement=function(){var e=this.getCurrentColumnProps();this.orientation===ORIENTATION.HORIZONTAL?this.currentColumnElement.setWidth(e.size):this.currentColumnElement.setHeight(e.size);var t={left:e.rect.left,top:e.rect.top};this.currentColumnElement.setOffset(t)},ZWRuler.prototype.createCurrentColumnElement=function(){var e=this.getCurrentColumnProps(),t={id:this.id+"column-area-element",rulerInstance:this,orientation:this.orientation,zoomFactor:this.zoomFactor,width:e.width,height:e.height,offset:e.offset,viewProps:{parent:this.container},eventProps:{groupName:"ActiveColumn"},priority:2,shouldHandleEvent:!0,isDraggable:!1,resizableOption:RESIZABLE_TYPE.NONE,align:RULER_ALIGN.FRONT,retainOnReset:!0};this.currentColumnElement=new RulerElement(t),this.addElement(this.currentColumnElement.id,this.currentColumnElement)},ZWRuler.prototype.computeColProps=function(){this.computedColProps={columnArea:[],columnSpace:[]};var e=ORIENTATION_PROPS[this.orientation].start,t={top:0,left:0};t[e]=this.computedMargins.before.sizeInPx;for(var i,n,o=this.layoutProps.columnCount,r=this.layoutProps.columnSpaces.length,a=COLUMN_SPACE_PROPS[this.layoutProps.columnType],s=0;s<o;s++)i=this.getComputedProps(this.layoutProps.columns[s]),i.offset={left:t.left,top:t.top},i.align=RULER_ALIGN.FRONT,i.rect=this.getComputedColRect(i),this.computedColProps.columnArea[s]=i,this.computedColProps.columnArea[s].id=this.id+"column-area-element"+s,t[e]+=i.sizeInPx,s<r&&(i={},this.layoutProps.columnType==COLUMN_TYPE.PAGE?(n=this.layoutProps.columnSpaces[s],i=this.getComputedProps(n),i.offset={left:t.left,top:t.top},i.offset[ORIENTATION_PROPS[this.orientation].start]+=i.sizeInPx/2,i.align=RULER_ALIGN.MIDDLE,t[e]+=i.sizeInPx):(n=a.defaultSize,i=this.getComputedProps(n),i.offset={left:t.left,top:t.top},i.align=RULER_ALIGN.MIDDLE),i.rect=this.getComputedColRect(i),this.computedColProps.columnSpace[s]=i,this.computedColProps.columnSpace[s].id=this.id+"column-space-element"+s)},ZWRuler.prototype.getComputedColRect=function(e){var t=ORIENTATION_PROPS[this.orientation].start,i=ORIENTATION_PROPS[this.orientation].end,n=e.width.convertUnitTo(RULER_UNITS.PIXELS),o=e.height.convertUnitTo(RULER_UNITS.PIXELS),r={left:e.offset.left,right:e.offset.left+n,top:e.offset.top,bottom:e.offset.top+o},a=RulerUtil.getDeltaRelativeToAlignment(e.sizeInPx,e.align);return r[t]=e.offset[t]-a.start,r[i]=e.offset[t]+a.end,r},ZWRuler.prototype.getCurrentColumnProps=function(){return this.computedColProps.columnArea[this.getCurrentColumnIndex()]},ZWRuler.prototype.createColumnSpaceElements=function(){for(var e=COLUMN_SPACE_PROPS[this.layoutProps.columnType],t=0,i=this.computedColProps.columnSpace.length;t<i;t++){var n,o=this.computedColProps.columnSpace[t],r={id:o.id,rulerInstance:this,orientation:this.orientation,zoomFactor:this.zoomFactor,width:o.width,height:o.height,offset:o.offset,viewProps:{parent:this.container,classStr:e.classStr,zIndex:1},eventProps:{groupName:e.groupName,spaceIndex:t},priority:3,shouldHandleEvent:e.shouldHandleEvent,isDraggable:e.isDraggable,resizableOption:e.resizableOption,resizeMarginRatio:e.resizeMarginRatio,title:e.title,updateOnMouseMove:e.updateOnMouseMove,align:RULER_ALIGN.MIDDLE,retainOnReset:!1},a=this.computedColProps.columnArea[t],s=this.computedColProps.columnArea[t+1];if(this.layoutProps.columnType==COLUMN_TYPE.PAGE){var l=a.sizeInPx+s.sizeInPx+o.sizeInPx-2*this.layoutProps.minColumnAreaInPx;l<o.sizeInPx&&(l=o.sizeInPx),r.minSize=6+RULER_UNITS.PIXELS,r.maxSize=l+RULER_UNITS.PIXELS,this.layoutProps.isEqualColumnWidth||(r.shouldHandleEvent=!1),n=new RulerElement(r)}else{var d={left:a.rect.left,top:a.rect.top,right:s.rect.right,bottom:s.rect.bottom},c=ORIENTATION_PROPS[this.orientation];d[c.start]+=this.layoutProps.minColumnAreaInPx,d[c.end]-=this.layoutProps.minColumnAreaInPx,d[c.start]>o.offset[c.start]&&(d[c.start]=o.offset[c.start]),d[c.end]<o.offset[c.start]&&(d[c.end]=o.offset[c.start]),r.dragRect=d,r.computationFactor=PROCESSING_TYPE.REGULAR,n=new TableResizeElement(r)}this.addElement(o.id,n)}},ZWRuler.prototype.removeAllColumnSpaceElements=function(){for(var e=0,t=this.computedColProps.columnSpace.length;e<t;e++){var i=this.removeElement(this.computedColProps.columnSpace[e].id);i&&i.destroy()}},ZWRuler.prototype.setCurrentColumnIndex=function(e){this.layoutProps.columnIndex=e},ZWRuler.prototype.getCurrentColumnIndex=function(){return this.layoutProps.columnIndex},ZWRuler.prototype.getColumnRectForScales=function(){var e;return e=this.layoutProps.columnType==COLUMN_TYPE.PAGE?this.getCurrentColumnProps():this.direction===DIRECTION.LEFT_TO_RIGHT||this.direction===DIRECTION.TOP_TO_BOTTOM?this.computedColProps.columnArea[0]:this.computedColProps.columnArea[this.layoutProps.columnCount-1],e.rect},ZWRuler.prototype.getComputedScaleValues=function(e){var t={left:0,top:0},i={left:e.left,top:e.top};this.direction===DIRECTION.RIGHT_TO_LEFT?i={left:e.right,top:e.top}:this.direction===DIRECTION.BOTTOM_TO_TOP&&(i={left:e.left,top:e.bottom});var n=0,o=0,r=0,a=0;return this.orientation===ORIENTATION.HORIZONTAL?(r=this.widthInPx-i.left,n=this.widthInPx-r,o=a=this.heightInPx):(a=this.heightInPx-i.top,o=this.heightInPx-a,n=r=this.widthInPx),{scale1:{width:n+RULER_UNITS.PIXELS,height:o+RULER_UNITS.PIXELS,offset:t},scale2:{width:r+RULER_UNITS.PIXELS,height:a+RULER_UNITS.PIXELS,offset:i}}},ZWRuler.prototype.createScales=function(){var e=this.getColumnRectForScales(),t=this.getComputedScaleValues(e),i={id:this.id+"scale1-element",rulerInstance:this,orientation:this.orientation,zoomFactor:this.zoomFactor,width:t.scale1.width,height:t.scale1.height,offset:t.scale1.offset,viewProps:{parent:this.container},priority:1,shouldHandleEvent:!1,isDraggable:!1,resizableOption:RESIZABLE_TYPE.NONE,resizeMarginRatio:0,retainOnReset:!0},n={id:this.id+"scale2-element",rulerInstance:this,orientation:this.orientation,zoomFactor:this.zoomFactor,width:t.scale2.width,height:t.scale2.height,offset:t.scale2.offset,viewProps:{parent:this.container},priority:1,shouldHandleEvent:!1,isDraggable:!1,resizableOption:RESIZABLE_TYPE.NONE,resizeMarginRatio:0,retainOnReset:!0};this.scale1Element=new RulerElement(i),this.scale2Element=new RulerElement(n),this.addElement(this.scale1Element.id,this.scale1Element),this.addElement(this.scale2Element.id,this.scale2Element);var o={id:this.id+"scale1",unit:this.unit,orientation:this.orientation,zoomFactor:this.zoomFactor,type:SCALE_TYPE.INVERSE,maxWidth:this.width,maxHeight:this.height,viewProps:{parent:this.scale1Element.getContainer()}},r={id:this.id+"scale2",unit:this.unit,orientation:this.orientation,zoomFactor:this.zoomFactor,type:SCALE_TYPE.REGULAR,maxWidth:this.width,maxHeight:this.height,viewProps:{parent:this.scale2Element.getContainer()}};this.scale1=new Scale(o),this.scale2=new Scale(r)},ZWRuler.prototype.setTabStops=function(e){this.removeAlltabPoints(),this.tabPoints=e||{},this.createtabPoints()},ZWRuler.prototype.createtabPoints=function(){var e,t=this.getCurrentColumnProps(),i=20,n={left:t.rect.left,right:t.rect.right,top:t.rect.top-i,bottom:t.rect.bottom+i};for(var o in this.tabPoints){var r,a=this.tabPoints[o],s=a.align;this.direction===DIRECTION.LEFT_TO_RIGHT?(e=t.rect.left+a.point,r=PROCESSING_TYPE.REGULAR):this.direction===DIRECTION.RIGHT_TO_LEFT&&(e=t.rect.right-a.point,s==TABSELECTORS.LEFTTAB?s=TABSELECTORS.RIGHTTAB:s==TABSELECTORS.RIGHTTAB&&(s=TABSELECTORS.LEFTTAB),r=PROCESSING_TYPE.INVERSE);var l={id:o,rulerInstance:this,orientation:this.orientation,zoomFactor:this.zoomFactor,width:TABSELECTORS_PROPS[s].width,height:TABSELECTORS_PROPS[s].height,offset:{left:e,top:TABSELECTORS_PROPS[s].top},viewProps:{parent:this.container,classStr:TABSELECTORS_PROPS[s].classStr,zIndex:5},eventProps:{groupName:"TabStop",tpid:a.tpid},priority:5,shouldHandleEvent:!0,isDraggable:!0,hideOutOfDragRect:!0,dragRect:n,actualValue:a.point,resizableOption:RESIZABLE_TYPE.NONE,updateOnMouseMove:!0,computationFactor:r,align:s,retainOnReset:!0},d=new TabPointElement(l);this.addElement(o,d)}},ZWRuler.prototype.removeAlltabPoints=function(){if(this.tabPoints)for(var e in this.tabPoints){var t=this.removeElement(e);t&&t.destroy()}},ZWRuler.prototype.setIndents=function(e){this.removeAllIndents(),this.indentProps=this.computeIndentProps(e),this.createIndents(),this.setMarginMinMaxSize()},ZWRuler.prototype.computeIndentProps=function(e){if(!e)return null;var t=this.getCurrentColumnProps(),i={};for(var n in e){var o=TABSELECTORS_PROPS[n];i[n]={id:this.id+o.id,width:o.width,height:o.height,classStr:o.classStr,title:o.title,value:e[n]}}if(this.direction===DIRECTION.LEFT_TO_RIGHT){i[TABSELECTORS.LEFTINDENT].offset={top:TABSELECTORS_PROPS[TABSELECTORS.LEFTINDENT].top,left:t.rect.left+e[TABSELECTORS.LEFTINDENT]},i[TABSELECTORS.FIRSTLINEINDENT].offset={top:TABSELECTORS_PROPS[TABSELECTORS.FIRSTLINEINDENT].top,left:t.rect.left+e[TABSELECTORS.FIRSTLINEINDENT]},i[TABSELECTORS.RIGHTINDENT].offset={top:TABSELECTORS_PROPS[TABSELECTORS.RIGHTINDENT].top,left:t.rect.right-e[TABSELECTORS.RIGHTINDENT]};var r=Math.min(i[TABSELECTORS.RIGHTINDENT].offset.left,this.widthInPx),a=0,s=0;e[TABSELECTORS.LEFTINDENT]<e[TABSELECTORS.FIRSTLINEINDENT]?s=e[TABSELECTORS.FIRSTLINEINDENT]-e[TABSELECTORS.LEFTINDENT]:a=e[TABSELECTORS.LEFTINDENT]-e[TABSELECTORS.FIRSTLINEINDENT],i[TABSELECTORS.LEFTINDENT].dragRect={left:a,top:0,right:r-this.layoutProps.minColumnAreaInPx-s,bottom:this.heightInPx},i[TABSELECTORS.FIRSTLINEINDENT].dragRect={left:0,top:0,right:r-this.layoutProps.minColumnAreaInPx,bottom:this.heightInPx};var l=Math.max(i[TABSELECTORS.LEFTINDENT].offset.left,i[TABSELECTORS.FIRSTLINEINDENT].offset.left,0);i[TABSELECTORS.RIGHTINDENT].dragRect={left:l+this.layoutProps.minColumnAreaInPx,top:0,right:this.widthInPx,bottom:this.heightInPx},i[TABSELECTORS.LEFTINDENT].dragRect.right<i[TABSELECTORS.LEFTINDENT].offset.left&&(i[TABSELECTORS.LEFTINDENT].dragRect.right=i[TABSELECTORS.LEFTINDENT].offset.left),i[TABSELECTORS.FIRSTLINEINDENT].dragRect.right<i[TABSELECTORS.FIRSTLINEINDENT].offset.left&&(i[TABSELECTORS.FIRSTLINEINDENT].dragRect.right=i[TABSELECTORS.FIRSTLINEINDENT].offset.left),i[TABSELECTORS.RIGHTINDENT].dragRect.left>i[TABSELECTORS.RIGHTINDENT].offset.left&&(i[TABSELECTORS.RIGHTINDENT].dragRect.left=i[TABSELECTORS.RIGHTINDENT].offset.left),i[TABSELECTORS.LEFTINDENT].computationFactor=PROCESSING_TYPE.REGULAR,i[TABSELECTORS.FIRSTLINEINDENT].computationFactor=PROCESSING_TYPE.REGULAR,i[TABSELECTORS.RIGHTINDENT].computationFactor=PROCESSING_TYPE.INVERSE}else if(this.direction===DIRECTION.RIGHT_TO_LEFT){i[TABSELECTORS.LEFTINDENT].offset={top:TABSELECTORS_PROPS[TABSELECTORS.LEFTINDENT].top,left:t.rect.right-e[TABSELECTORS.LEFTINDENT]},i[TABSELECTORS.FIRSTLINEINDENT].offset={top:TABSELECTORS_PROPS[TABSELECTORS.FIRSTLINEINDENT].top,left:t.rect.right-e[TABSELECTORS.FIRSTLINEINDENT]},i[TABSELECTORS.RIGHTINDENT].offset={top:TABSELECTORS_PROPS[TABSELECTORS.RIGHTINDENT].top,left:t.rect.left+e[TABSELECTORS.RIGHTINDENT]};var l=Math.max(i[TABSELECTORS.RIGHTINDENT].offset.left,0),a=0,s=0;e[TABSELECTORS.LEFTINDENT]<e[TABSELECTORS.FIRSTLINEINDENT]?a=e[TABSELECTORS.FIRSTLINEINDENT]-e[TABSELECTORS.LEFTINDENT]:s=e[TABSELECTORS.LEFTINDENT]-e[TABSELECTORS.FIRSTLINEINDENT],i[TABSELECTORS.LEFTINDENT].dragRect={left:l+this.layoutProps.minColumnAreaInPx+a,top:0,right:this.widthInPx-s,bottom:this.heightInPx},i[TABSELECTORS.FIRSTLINEINDENT].dragRect={left:l+this.layoutProps.minColumnAreaInPx,top:0,right:this.widthInPx,bottom:this.heightInPx};var r=Math.min(i[TABSELECTORS.LEFTINDENT].offset.left,i[TABSELECTORS.FIRSTLINEINDENT].offset.left,this.widthInPx);i[TABSELECTORS.RIGHTINDENT].dragRect={left:0,top:0,right:r-this.layoutProps.minColumnAreaInPx,bottom:this.heightInPx},i[TABSELECTORS.LEFTINDENT].dragRect.left>i[TABSELECTORS.LEFTINDENT].offset.left&&(i[TABSELECTORS.LEFTINDENT].dragRect.left=i[TABSELECTORS.LEFTINDENT].offset.left),i[TABSELECTORS.FIRSTLINEINDENT].dragRect.left>i[TABSELECTORS.FIRSTLINEINDENT].offset.left&&(i[TABSELECTORS.FIRSTLINEINDENT].dragRect.left=i[TABSELECTORS.FIRSTLINEINDENT].offset.left),i[TABSELECTORS.RIGHTINDENT].dragRect.right<i[TABSELECTORS.RIGHTINDENT].offset.left&&(i[TABSELECTORS.RIGHTINDENT].dragRect.right=i[TABSELECTORS.RIGHTINDENT].offset.left),i[TABSELECTORS.LEFTINDENT].computationFactor=PROCESSING_TYPE.INVERSE,i[TABSELECTORS.FIRSTLINEINDENT].computationFactor=PROCESSING_TYPE.INVERSE,i[TABSELECTORS.RIGHTINDENT].computationFactor=PROCESSING_TYPE.REGULAR}return i},ZWRuler.prototype.createIndents=function(){if(this.indentProps)for(var e in this.indentProps){var t=this.indentProps[e],i={id:t.id,rulerInstance:this,orientation:this.orientation,zoomFactor:this.zoomFactor,width:t.width,height:t.height,offset:t.offset,viewProps:{parent:this.container,classStr:t.classStr,zIndex:4},eventProps:{groupName:"Indents"},dragRect:t.dragRect,actualValue:t.value,priority:4,shouldHandleEvent:!0,isDraggable:!0,computationFactor:t.computationFactor,resizableOption:RESIZABLE_TYPE.NONE,title:t.title,updateOnMouseMove:!0,align:RULER_ALIGN.MIDDLE,retainOnReset:!0},n=new IndentElement(i);this.addElement(t.id,n),this.affectedElements[n.id]&&(this.affectedElements[n.id]={element:n,originalOffset:{left:n.offset.left,top:n.offset.top},originalSizeInPx:n.sizeInPx})}},ZWRuler.prototype.removeAllIndents=function(){if(this.indentProps)for(var e in this.indentProps){var t=this.indentProps[e],i=this.removeElement(t.id);i&&i.destroy()}},ZWRuler.prototype.setRoundingFactor=function(){var e=UNIT_PROPS[this.unit];this.roundingFactor=e.fragMeasurement.convertUnitTo(RULER_UNITS.PIXELS)/e.fragSegmentCount},ZWRuler.prototype.setUnit=function(e){Ruler.prototype.setUnit.call(this,e),this.setRoundingFactor(),this.scale1.setUnit(e),this.scale2.setUnit(e)},ZWRuler.prototype.setOrientation=function(e){Ruler.prototype.setOrientation.call(this,e),this.view.contructRuler()},ZWRuler.prototype.setDirection=function(e){Ruler.prototype.setDirection.call(this,e),this.updateScales()},ZWRuler.prototype.updateScales=function(e){if(!e){var t=this.getColumnRectForScales();e=this.getComputedScaleValues(t)}this.scale1Element.setWidth(e.scale1.width),this.scale1Element.setHeight(e.scale1.height),this.scale1Element.setOffset(e.scale1.offset),this.scale2Element.setWidth(e.scale2.width),this.scale2Element.setHeight(e.scale2.height),this.scale2Element.setOffset(e.scale2.offset)},ZWRuler.prototype.updateScalesDisplacement=function(e){var t=this.getColumnRectForScales(),t={left:t.left,top:t.top,right:t.right,bottom:t.bottom};e.before?this.direction===DIRECTION.LEFT_TO_RIGHT?t.left+=e.before:this.direction===DIRECTION.TOP_TO_BOTTOM&&(t.top+=e.before):e.after&&(this.direction===DIRECTION.RIGHT_TO_LEFT?t.right+=e.after:this.direction===DIRECTION.BOTTOM_TO_TOP&&(t.bottom+=e.after));var i=this.getComputedScaleValues(t);this.updateScales(i)},ZWRuler.prototype.setWidth=function(e){var t=this.widthInPx;Ruler.prototype.setWidth.apply(this,arguments),t!=this.widthInPx&&(this.scale1&&this.scale1.setMaxWidth(e),this.scale2&&this.scale2.setMaxWidth(e))},ZWRuler.prototype.setHeight=function(e){var t=this.heightInPx;Ruler.prototype.setHeight.apply(this,arguments),t!=this.heightInPx&&(this.scale1&&this.scale1.setMaxHeight(e),this.scale2&&this.scale2.setMaxHeight(e))};var TABSELECTORS={LEFTTAB:"0",CENTERTAB:"1",RIGHTTAB:"2",LEFTINDENT:"3",FIRSTLINEINDENT:"4",RIGHTINDENT:"5"},TABSELECTORS_PROPS={0:{id:"left-tab",width:"8px",height:"8px",top:3,classStr:"ui-ruler-icon ui-tabpoint-left",title:J.i18n("tabselector","LEFTTAB"),tabSelectorClass:"ui-ruler-icon ui-icon-ruler-lefttabpoint-sm"},1:{id:"center-tab",width:"12px",height:"8px",top:3,classStr:"ui-ruler-icon ui-tabpoint-center",title:J.i18n("tabselector","CENTERTAB"),tabSelectorClass:"ui-ruler-icon ui-icon-ruler-centertabpoint-sm"},2:{id:"right-tab",width:"8px",height:"8px",top:3,classStr:"ui-ruler-icon ui-tabpoint-right",title:J.i18n("tabselector","RIGHTTAB"),tabSelectorClass:"ui-ruler-icon ui-icon-ruler-righttabpoint-sm"},3:{id:"left-indent",width:"12px",height:"10px",top:6,classStr:"ui-ruler-icon ui-ruler-leftindent",title:J.i18n("writer.common.RULER.LEFTINDENT"),tabSelectorClass:"ui-ruler-icon ui-icon-ruler-leftindent-sm"},4:{id:"first-line-indent",width:"12px",height:"5px",top:0,classStr:"ui-ruler-icon ui-ruler-firstlineindent",title:J.i18n("writer.common.RULER.FirstLineIndent"),tabSelectorClass:"ui-ruler-icon ui-icon-ruler-firstlineindent-sm"},5:{id:"right-indent",width:"12px",height:"10px",top:6,classStr:"ui-ruler-icon ui-ruler-rightindent",title:J.i18n("writer.common.RULER.RIGHTINDENT"),tabSelectorClass:"ui-ruler-icon ui-icon-ruler-rightindent-sm"}},COLUMN_TYPE={PAGE:"PAGE_COLUMN",TABLE:"TABLE_COLUMN",TEXTBOX:"TEXTBOX"},MIN_HEADER_FOOTER_SIZE=24,ZWRulerController=function(){"use strict";var e,t,i,n={point:"0in",selector:TABSELECTORS.LEFTTAB},o={HRULER_WRAPPER:"ruler-wrapper",HRULER_OUTERCONTAINER:"hruler-container",VRULER_OUTERCONTAINER:"vruler-container",HRULER_CONTAINER:"HRuler",VRULER_CONTAINER:"VRuler",TAB_SELECTOR:"tabselector-container"},r=!0,a=function(){try{if(!editor.getRole().permissions.can("document.edit"))return;i=editor.doc;var n=(i.getSelection().getStart(),{id:o.HRULER_CONTAINER,unit:Conversions.globalUnit,direction:DIRECTION.LEFT_TO_RIGHT,orientation:ORIENTATION.HORIZONTAL,zoomFactor:editor.zoomFactor,width:0+RULER_UNITS.PIXELS,height:"14px",layoutProps:H(),isInteractable:!0,viewProps:{classStr:"ui-horizontal-ruler",parent:Z(o.HRULER_OUTERCONTAINER)[0],context:"RTabmenu"}}),r={id:o.VRULER_CONTAINER,unit:Conversions.globalUnit,direction:DIRECTION.TOP_TO_BOTTOM,orientation:ORIENTATION.VERTICAL,zoomFactor:editor.zoomFactor,width:"14px",height:0+RULER_UNITS.PIXELS,layoutProps:k(),isInteractable:!0,viewProps:{classStr:"ui-vertical-ruler",parent:Z(o.VRULER_OUTERCONTAINER)[0]}};e=new ZWRuler(n),t=new ZWRuler(r),g(),z(),K(TABSELECTORS.LEFTTAB),W(),d()}catch(e){var a="CRL_100";ZWLogger.sendErrorDetails(a+"<ZWERROR>"+e.stack+"\nHRULER_INFO::"+JSON.stringify(H())+"\nVRULER_INFO::"+JSON.stringify(k())+"<ZWERROR>#")}},s=function(){Z(o.HRULER_WRAPPER).show(),Z(o.VRULER_OUTERCONTAINER).show();var e=Z(o.VRULER_OUTERCONTAINER)[0];e&&(DocLayoutManager.isPageView()?e.style.visibility="":e.style.visibility="hidden"),editor.onResize()},l=function(){Z(o.HRULER_WRAPPER).hide(),Z(o.VRULER_OUTERCONTAINER).hide(),editor.onResize()},d=function(){Macros.isRulerAllowed()?(s(),r&&(u(),r=!1)):(l(),r||(p(),r=!0))},c=function(){Y(),editor.onResize(),d()},u=function(){PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected"],W,{async:!0,timeout:50}),PubSub.subscribe(["Document/ScrollEvent","Document/Resize"],z,{async:!0,timeout:50}),W()},p=function(){PubSub.unsubscribe(["Cursor/Collapsed","Cursor/Selected"],W,{async:!0,timeout:50}),PubSub.unsubscribe(["Document/ScrollEvent","Document/Resize"],z,{async:!0,timeout:50})},g=function(){PubSub.subscribe("Document/Zoom",ne),PubSub.subscribe("Settings/UnitsChanged",te),PubSub.subscribe("Document/view/changed",c),PubSub.subscribe(["UIEvents/UserPreferenceUpdated","Document/LayoutChanged","Document/RichEditLayoutOpened","Document/RichEditLayoutClosed"],d),PubSub.subscribe("HRuler/MouseDown",O),PubSub.subscribe("HRuler/MouseUp",b),PubSub.subscribe("HRuler/MouseMove",R),PubSub.subscribe("VRuler/MouseDown",I),PubSub.subscribe("VRuler/MouseUp",_),PubSub.subscribe("VRuler/MouseMove",h),Z("RTabmenu").bind("menubeforeshow",M)},f=function(e,t){t.offset&&e.setOffset(t.offset),e.orientation===ORIENTATION.HORIZONTAL?e.setWidth(t.sizeInPx+RULER_UNITS.PIXELS):e.setHeight(t.sizeInPx+RULER_UNITS.PIXELS)},E=function(e,t){for(var i in e.affectedElements){var n=e.affectedElements[i],o=n.element;if(o.isDraggable){var r={};e.orientation===ORIENTATION.HORIZONTAL?r={left:n.originalOffset.left+t,top:n.originalOffset.top}:e.orientation===ORIENTATION.VERTICAL&&(r={left:n.originalOffset.left,top:n.originalOffset.top+t}),o.setOffset(r)}}},T=function(e,t){for(var i=0,n=t.length;i<n;i++){var o=t[i];e.affectedElements[o.id]={element:o,originalOffset:{left:o.offset.left,top:o.offset.top},originalSizeInPx:o.sizeInPx}}},m=function(e){e.affectedElements={}},h=function(e,i,n,o,r,a){if("leftClick"==i&&n.updateOnMouseMove)switch(f(n,a),e.groupName){case"MarginBefore":var s={before:a.changeInSize};t.updateScalesDisplacement(s);break;case"MarginAfter":var s={after:-a.changeInSize};t.updateScalesDisplacement(s)}},I=function(e,t,i,n,o){if("leftClick"==t)switch(e.groupName){case"ActiveColumn":break;case"MarginBefore":break;case"MarginAfter":}},_=function(e,i,n,o,r,a){if("leftClick"==i){switch(e.groupName){case"ActiveColumn":break;case"MarginBefore":if(f(n,a),0!==a.changeInSize){var s={before:a.changeInSize};t.updateScalesDisplacement(s),A(n,a),ZWLogger.addToStatistics("VRULER_"+e.groupName)}break;case"MarginAfter":if(f(n,a),0!==a.changeInSize){var s={after:-a.changeInSize};t.updateScalesDisplacement(s),S(n,a),ZWLogger.addToStatistics("VRULER_"+e.groupName)}}m(t)}},A=function(e,n){var o=i.getSelection().getStart(),r=DocLayoutManager.getSectionViewAtIndex(o),a=e.sizeInPx,s=r.getGroup(),l=s.getFirstSection(),d=editor.doc.getSection(l.getSectionType(),l.getNodeId());if(r.getSectionType()==SECTION_TYPES.HEADER){var c={};c[ATTR_BODY.DS_HT]=(a+RULER_UNITS.PIXELS).convertUnitTo(t.unit)+t.unit,i.execCmd("applyStyle",[d,c,"updateFooterHeight"])}else if(r.getSectionType()==SECTION_TYPES.FOOTER){var u={},p=r.getHeight();u[ATTR_BODY.DS_MB]=(p-n.changeInSize+RULER_UNITS.PIXELS).convertUnitTo(t.unit)+t.unit,i.execCmd("applyStyle",[d,u,"updateFooterHeight"])}else if(r.getSectionType()==SECTION_TYPES.TEXTBOX)L(e,n);else{var g=s.getHeaderTop(),f=MIN_HEADER_FOOTER_SIZE;if(a<g+f){var E=Math.max(a-f,0),c={};c[ATTR_BODY.DS_HT]=(E+RULER_UNITS.PIXELS).convertUnitTo(t.unit)+t.unit,i.execCmd("applyStyle",[d,c,"updateDocHeight"])}var T={};T[ATTR_BODY.DS_MT]=(a+RULER_UNITS.PIXELS).convertUnitTo(t.unit)+t.unit,i.execCmd("applyStyle",[d,T,"updateDocMarginTop"])}},S=function(e,n){var o=i.getSelection().getStart(),r=DocLayoutManager.getSectionViewAtIndex(o),a=r.getGroup(),s=e.sizeInPx,l=a.getFirstSection(),d=editor.doc.getSection(l.getSectionType(),l.getNodeId());if(r.getSectionType()==SECTION_TYPES.FOOTER){var c={};c[ATTR_BODY.DS_FB]=(s+RULER_UNITS.PIXELS).convertUnitTo(t.unit)+t.unit,i.execCmd("applyStyle",[d,c,"updateFooterBottom"])}else if(r.getSectionType()==SECTION_TYPES.HEADER){var u={},p=r.getHeight();u[ATTR_BODY.DS_MT]=(p-n.changeInSize+RULER_UNITS.PIXELS).convertUnitTo(t.unit)+t.unit,i.execCmd("applyStyle",[d,u,"updateHeaderMarginTop"])}else if(r.getSectionType()==SECTION_TYPES.TEXTBOX)L(e,n);else{var g=a.getFooterBottom(),f=MIN_HEADER_FOOTER_SIZE;if(s<g+f){var E=Math.max(s-f,0),c={};c[ATTR_BODY.DS_HT]=(E+RULER_UNITS.PIXELS).convertUnitTo(t.unit)+t.unit,i.execCmd("applyStyle",[d,c,"updateDocFooterBottom"])}var T={};T[ATTR_BODY.DS_MB]=(s+RULER_UNITS.PIXELS).convertUnitTo(t.unit)+t.unit,i.execCmd("applyStyle",[d,T,"updateDocMarginBottom"])}},R=function(t,i,n,o,r,a){if("leftClick"==i&&n.updateOnMouseMove)switch(f(n,a),t.groupName){case"Indents":E(e,a.displacement);break;case"MarginBefore":E(e,a.changeInSize);var s={before:a.changeInSize};e.updateScalesDisplacement(s);break;case"MarginAfter":E(e,-a.changeInSize);var s={after:-a.changeInSize};e.updateScalesDisplacement(s)}},O=function(t,i,o,r,a){if("leftClick"==i)switch(m(e),t.groupName){case"ActiveColumn":if(n.selector==TABSELECTORS.LEFTTAB||n.selector==TABSELECTORS.CENTERTAB||n.selector==TABSELECTORS.RIGHTTAB)q(o,r.x),ee(n.selector);else if(n.selector==TABSELECTORS.LEFTINDENT||n.selector==TABSELECTORS.FIRSTLINEINDENT||n.selector==TABSELECTORS.RIGHTINDENT){var s=e.elements[e.indentProps[n.selector].id],l={left:s.offset.left,top:s.offset.top},d=r.x;r.x>s.dragRect.right?d=s.dragRect.right:r.x<s.dragRect.left&&(d=s.dragRect.left),l.left=d,s.setOffset(l),F(s)}break;case"Indents":if(o.id==e.indentProps[TABSELECTORS.LEFTINDENT].id){var c=e.elements[e.indentProps[TABSELECTORS.FIRSTLINEINDENT].id],u=[c];T(e,u)}break;case"MarginBefore":if(e.layoutProps.columnType==COLUMN_TYPE.PAGE){var u=[];if(e.direction===DIRECTION.LEFT_TO_RIGHT){var c=e.elements[e.indentProps[TABSELECTORS.FIRSTLINEINDENT].id],p=e.elements[e.indentProps[TABSELECTORS.LEFTINDENT].id];u=[c,p];for(var g in e.tabPoints){var o=e.elements[g];u.push(o)}}else if(e.direction===DIRECTION.RIGHT_TO_LEFT){var f=e.elements[e.indentProps[TABSELECTORS.RIGHTINDENT].id];u=[f]}T(e,u)}break;case"MarginAfter":if(e.layoutProps.columnType==COLUMN_TYPE.PAGE){var u=[];if(e.direction===DIRECTION.RIGHT_TO_LEFT){var c=e.elements[e.indentProps[TABSELECTORS.FIRSTLINEINDENT].id],p=e.elements[e.indentProps[TABSELECTORS.LEFTINDENT].id];u=[c,p];for(var g in e.tabPoints){var o=e.elements[g];u.push(o)}}else if(e.direction===DIRECTION.LEFT_TO_RIGHT){var f=e.elements[e.indentProps[TABSELECTORS.RIGHTINDENT].id];u=[f]}T(e,u)}}},b=function(t,i,n,o,r,a){if("leftClick"==i)switch(t.groupName){case"ActiveColumn":break;case"TabStop":var s=t.tpid;if(a.outOfRect)editor.doc.execCmd("removeTab",s);else if(0!==a.displacement){var l=a.offset.left;e.direction===DIRECTION.LEFT_TO_RIGHT?l-=n.dragRect.left:l=n.dragRect.right-l,l=(l+UNITS.PIXELS).convertUnitTo(e.unit);var d={tpid:s,point:l+e.unit};editor.doc.execCmd("modifyTab",d),ZWLogger.addToStatistics("HRULER_"+t.groupName)}break;case"Indents":f(n,a),E(e,a.displacement),m(e),0!==a.displacement&&(F(n),ZWLogger.addToStatistics("HRULER_"+t.groupName));break;case"MarginBefore":if(f(n,a),E(e,a.changeInSize),m(e),0!==a.changeInSize){var c={before:a.changeInSize};e.updateScalesDisplacement(c),e.layoutProps.columnType==COLUMN_TYPE.PAGE?(C(n),ZWLogger.addToStatistics("HRULER_PAGE_"+t.groupName)):e.layoutProps.columnType==COLUMN_TYPE.TEXTBOX?D(n,a):(N(n,a),ZWLogger.addToStatistics("HRULER_TABLE_"+t.groupName))}break;case"MarginAfter":if(f(n,a),E(e,-a.changeInSize),m(e),0!==a.changeInSize){var c={after:-a.changeInSize};if(e.updateScalesDisplacement(c),e.layoutProps.columnType==COLUMN_TYPE.PAGE)y(n),ZWLogger.addToStatistics("HRULER_PAGE_"+t.groupName);else if(e.layoutProps.columnType==COLUMN_TYPE.TEXTBOX)D(n,a);else{var u=e.layoutProps.columnCount-1;P(u,-a.changeInSize),ZWLogger.addToStatistics("HRULER_TABLE_"+t.groupName)}}break;case"PageColumnSpace":if(f(n,a),0!==a.changeInSize){var u=n.eventProps.spaceIndex;v(u,a),ZWLogger.addToStatistics("HRULER_"+t.groupName)}break;case"TableColumnSpace":if(f(n,a),0!==a.displacement){var u=n.eventProps.spaceIndex;P(u,a.displacement),ZWLogger.addToStatistics("HRULER_"+t.groupName)}}else if("rightClick"==i)switch(t.groupName){case"ActiveColumn":q(n,o.x)}},v=function(t,n){var o=i.getSelection().getStart(),r=DocLayoutManager.getSectionViewAtIndex(o),a=editor.doc.getSection(r.getSectionType(),r.getNodeId()),s=(n.sizeInPx+RULER_UNITS.PIXELS).convertUnitTo(e.unit)+e.unit,l=DocLayoutManager.getColumnFormatAtIdx(o),d={};d[ATTR_BODY.DS_COLCOLS]={},d[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLCOUNT]=l.count,d[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLWID]=[],d[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLSPACE]=[],d[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLSEP]=l.seperator,d[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_DEFAULTSPACE]=s,d[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLISEQWID]=l.iseqwidth,editor.doc.execCmd("applyStyle",[a,d])},D=function(e,t){var n=editor.doc.getSelection()[0].start,o=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,n),r={},a=o.getRangeIndex(),s=editor.doc.getParents(NODE_TYPE.IMAGE,a),l=TextBoxHandler.getWidth(o,!1);r[ATTR_IMAGE.I_WID]=l-t.changeInSize;var d=[s],c=[r];i.execCmd("applyStyle",[d,c,"updateTextBoxStyle"])},L=function(e,t){var n=editor.doc.getSelection()[0].start,o=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,n),r={},a=o.getRangeIndex(),s=editor.doc.getParents(NODE_TYPE.IMAGE,a),l=TextBoxHandler.getHeight(o,!1);r[ATTR_IMAGE.I_HT]=l-t.changeInSize;var d=[s],c=[r];i.execCmd("applyStyle",[d,c,"updateTextBoxStyle"])},N=function(t,n){var o=editor.doc.getSelection().getParents(NODE_TYPE.TABLE),r=TableUtil.calculateTableMarginLeft(o.dtNode).convertUnitTo(RULER_UNITS.PIXELS),a={},s=(r+n.changeInSize+RULER_UNITS.PIXELS).convertUnitTo(e.unit)+e.unit;a[ATTR_TABLE.TBLS_ML]=s,i.execCmd("applyStyle",[o,a,"tableLeftMarginChanged"])},P=function(e,t){TableActions.updateCurrentColumn(e,t)},C=function(t){var n=i.getSelection().getStart(),o=DocLayoutManager.getSectionViewAtIndex(n),r=o.getGroup().getFirstSection(),a=editor.doc.getSection(r.getSectionType(),r.getNodeId()),s={};s[ATTR_BODY.DS_ML]=t.width.convertUnitTo(e.unit)+e.unit,editor.doc.execCmd("applyStyle",[a,s,"applyAreaLeftMargin"])},y=function(t){var n=i.getSelection().getStart(),o=DocLayoutManager.getSectionViewAtIndex(n),r=o.getGroup().getFirstSection(),a=editor.doc.getSection(r.getSectionType(),r.getNodeId()),s={};s[ATTR_BODY.DS_MR]=t.width.convertUnitTo(e.unit)+e.unit,editor.doc.execCmd("applyStyle",[a,s,"applyAreaRightMargin"])},F=function(t){var n=editor.doc.getSelection(),o=n.getNodesInSelection(NODE_TYPE.PARAGRAPH),r=o[0],a=n.getParents(NODE_TYPE.CELL),s=0,l=0;if(a&&(s=a.dtNode.cellPadding.left,l=a.dtNode.cellPadding.right),t.id==e.indentProps[TABSELECTORS.LEFTINDENT].id){var d=r.attr(ATTR_PARAGRAPH.PS_PL);s+=d?d.convertUnitTo(RULER_UNITS.PIXELS):0;var c;e.direction===DIRECTION.LEFT_TO_RIGHT?c=t.offset.left-e.getCurrentColumnProps().rect.left:e.direction===DIRECTION.RIGHT_TO_LEFT&&(c=e.getCurrentColumnProps().rect.right-t.offset.left),c-=s;var u={};c=(c+RULER_UNITS.PIXELS).convertUnitTo(e.unit),u[ATTR_PARAGRAPH.PS_ML]=c.toFixed(3)+e.unit,editor.doc.execCmd("applyStyle",[o,u,"applyAreaLeftIndent"])}else if(t.id==e.indentProps[TABSELECTORS.RIGHTINDENT].id){var p=r.attr(ATTR_PARAGRAPH.PS_PR);l+=p?p.convertUnitTo(RULER_UNITS.PIXELS):0;var g;e.direction===DIRECTION.LEFT_TO_RIGHT?g=e.getCurrentColumnProps().rect.right-t.offset.left:e.direction===DIRECTION.RIGHT_TO_LEFT&&(g=t.offset.left-e.getCurrentColumnProps().rect.left),g-=l;var u={};g=(g+RULER_UNITS.PIXELS).convertUnitTo(e.unit),u[ATTR_PARAGRAPH.PS_MR]=g.toFixed(3)+e.unit,i.execCmd("applyStyle",[o,u,"applyAreaRightIndent"])}else if(t.id==e.indentProps[TABSELECTORS.FIRSTLINEINDENT].id){var f=r.attr(ATTR_PARAGRAPH.PS_ML),d=r.attr(ATTR_PARAGRAPH.PS_PL),E=f?f.convertUnitTo(RULER_UNITS.PIXELS):0;s+=d?d.convertUnitTo(RULER_UNITS.PIXELS):0,E+=s;var T;e.direction===DIRECTION.LEFT_TO_RIGHT?T=t.offset.left-e.getCurrentColumnProps().rect.left:e.direction===DIRECTION.RIGHT_TO_LEFT&&(T=e.getCurrentColumnProps().rect.right-t.offset.left),T-=E;var u={},m=(T+RULER_UNITS.PIXELS).convertUnitTo(e.unit);m<=0&&(E+=T,E=(E+RULER_UNITS.PIXELS).convertUnitTo(e.unit),u[ATTR_PARAGRAPH.PS_ML]=E.toFixed(3)+e.unit,u[ATTR_PARAGRAPH.PS_PL]=-m.toFixed(3)+e.unit),u[ATTR_PARAGRAPH.PS_TI]=m.toFixed(3)+e.unit,i.execCmd("applyStyle",[o,u,"applyAreaFirstLineIndent"])}},M=function(t,i){var n=e.getCurrentColumnProps().rect,o={x:t.clientX-e.containerRect.left,y:t.clientY-e.containerRect.top};return!(!o.x.isBetween(n.left,n.right,!0)||!o.y.isBetween(n.top,n.bottom,!0))},w=function(){X(),$()},U=function(){var t=H();e.setRulerLayoutProps(t),ie()},x=function(e){var t=e.dtNode.getMatrixPosition()[1];return TableResize.getVisibleCellIdx(t)},B=function(e,t){for(var i=[],n=0;n<e.length;n++)i[n]=e[n]+t;return i},H=function(){var e,t,n,o=i.getSelection().getStart(),r=DocLayoutManager.getSectionViewAtIndex(o),a=r.getGroup(),s=r.getLeft()+RULER_UNITS.PIXELS,l=r.getRight()+RULER_UNITS.PIXELS,d=96;if(r.getSectionType()==SECTION_TYPES.TEXTBOX){e=COLUMN_TYPE.TEXTBOX;var c=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,o),u=TextBoxHandler.getWidth(c,!1),p=u+RULER_UNITS.PIXELS;t=[p],n=[],s=Math.max(TextBoxHandler.getTextBoxLeftPosition(c),0),l=Math.max(a.getPageWidth()-(s+u),0),s+=RULER_UNITS.PIXELS,l+=RULER_UNITS.PIXELS}else e=COLUMN_TYPE.PAGE,t=DocLayoutManager.getColumnWidthArrayAtIdx(o),t=B(t,RULER_UNITS.PIXELS),n=DocLayoutManager.getColumnSpaceArrayAtIdx(o),n=B(n,RULER_UNITS.PIXELS);var g=editor.currentColumnIndex||0,f=DocLayoutManager.isEqualColumnWidthAtIdx(o);if(j()){editor.doc.getSelection().getParents(NODE_TYPE.TABLE);e=COLUMN_TYPE.TABLE,t=TableUtil.getCurrRowsVisibleColWidth(),n=[];for(var E=0+Conversions.globalUnit,T=0,m=t.length-1;T<m;T++)n.push(E);var h=editor.doc.getSelection().getParents(NODE_TYPE.CELL);g=x(h),f=!1,d=24;var I=DocLayoutManager.getCurrentView(VIEW.TABLE);s=Math.max(I.getAbsLeft(),0);var _=I.actualWidth,A=DocLayoutManager.getPageWidthAtIdx(o);l=Math.max(A-(s+_),0),s+=RULER_UNITS.PIXELS,l+=RULER_UNITS.PIXELS}return s=s.convertUnitTo(Conversions.globalUnit)+Conversions.globalUnit,l=l.convertUnitTo(Conversions.globalUnit)+Conversions.globalUnit,{columnIndex:g||0,columnCount:t.length,columns:t,columnSpaces:n,isEqualColumnWidth:f||!1,minColumnAreaInPx:d,columnType:e,marginBefore:{size:s,minSize:0+RULER_UNITS.PIXELS},marginAfter:{size:l,minSize:0+RULER_UNITS.PIXELS}}},G=function(){var e=k();t.setRulerLayoutProps(e),t.setDirection(DIRECTION.TOP_TO_BOTTOM)},k=function(){var e,t,n,o,r,a,s,l=i.getSelection().getStart(),d=DocLayoutManager.getSectionViewAtIndex(l),c=d.getPage(),u=c.getHeight(),p=COLUMN_TYPE.PAGE;if(d.getSectionType()==SECTION_TYPES.HEADER)e=c.getHeaderTop(),t=u-c.getHeaderHeight(),n=0+RULER_UNITS.PIXELS,o=u-c.getMaxHeaderHeight()+RULER_UNITS.PIXELS,r=MIN_HEADER_FOOTER_SIZE;else if(d.getSectionType()==SECTION_TYPES.FOOTER)e=u-c.getFooterHeight(),t=c.getFooterBottom(),n=u-c.getMaxFooterHeight()+RULER_UNITS.PIXELS,o=0+RULER_UNITS.PIXELS,r=MIN_HEADER_FOOTER_SIZE;else if(d.getSectionType()==SECTION_TYPES.TEXTBOX){p=COLUMN_TYPE.TEXTBOX;var l=editor.doc.getSelection()[0].start,g=(editor.doc.getRawFormatAt(l),DocTreeManager.getParents(NODE_TYPE.TEXTBOX,l));e=TextBoxHandler.getTextBoxTopPosition(g),t=u-e-TextBoxHandler.getHeight(g,!1),n=0+RULER_UNITS.PIXELS,o=0+RULER_UNITS.PIXELS,a=e+TextBoxHandler.getHeight(g,!1)-1+RULER_UNITS.PIXELS,s=t+TextBoxHandler.getHeight(g,!1)-1+RULER_UNITS.PIXELS,r=1}else e=c.getHeaderHeight(),t=c.getFooterHeight(),n=0+RULER_UNITS.PIXELS,o=0+RULER_UNITS.PIXELS,a=c.getMaxHeaderHeight()+RULER_UNITS.PIXELS,s=c.getMaxFooterHeight()+RULER_UNITS.PIXELS,r=.2*u;var f=(e+RULER_UNITS.PIXELS).convertUnitTo(Conversions.globalUnit)+Conversions.globalUnit,E=(t+RULER_UNITS.PIXELS).convertUnitTo(Conversions.globalUnit)+Conversions.globalUnit,T=u-(e+t)+RULER_UNITS.PIXELS,m={columnIndex:0,columnCount:1,columns:[T],columnSpaces:[],isEqualColumnWidth:!0,minColumnAreaInPx:r,columnType:p,marginBefore:{size:f,minSize:n,maxSize:a},marginAfter:{size:E,minSize:o,maxSize:s}};return m},W=function(){var e=i.getSelection().getStart(),t=DocLayoutManager.getSectionViewAtIndex(e);t&&(Y(),U(),w(),G(),z())},Y=function(){if(!EditorView.isWebView()){var n=i.getSelection().getStart(),o=DocLayoutManager.getSectionViewAtIndex(n),r=o.getGroup(),a=r.getPageWidth()+RULER_UNITS.PIXELS,s=r.getPageHeight();s=s>=2e3?2e3:s,s+=RULER_UNITS.PIXELS,e.setWidth(a),t.setHeight(s)}},z=function(){var t=DocLayoutManager.getPageAtPageNumber(editor.currentPageIndex+1),i=t&&J(DomViewManager.getDOMElem(t));if(i&&i[0]){var n=i.offset().left;n-=editor.editorPaneContainerOffset.left,Z(o.HRULER_CONTAINER).css("left",n+"px"),e.updateRect(),V(i)}},V=function(e){if(DocLayoutManager.isPageView()){var i=e.offset().top;if(0!==i){var n=editor.editorPaneContainer.offset().top;Z(o.VRULER_CONTAINER).css("margin-top",i-n)}t.updateRect()}},j=function(){var e=!1;try{var t=editor.doc.getSelection().getParents(NODE_TYPE.ROW);if(t){var i=t.dtNode,n=DocLayoutManager.getViews(i)||[];n.length&&i.children.length===n[0].childViews.length&&(e=!0)}}catch(t){e=!1}return e},X=function(){var t=i.getSelection(),n=t.getParaFormat(),o=0,r=0,a=0;if(n){n=DocUtil.copyStyle(n);var s=0,l=0;if(j()){var d=editor.doc.getSelection().getParents(NODE_TYPE.CELL);if(d){var c=d.dtNode.cellPadding.left,u=d.dtNode.cellPadding.right;s+=c,l+=u}}var p=n[ATTR_PARAGRAPH.PS_ML];p=p?p.convertUnitTo(RULER_UNITS.PIXELS):0;var g=n[ATTR_PARAGRAPH.PS_PL];g=g?g.convertUnitTo(RULER_UNITS.PIXELS):0;var f=n[ATTR_PARAGRAPH.PS_MR];f=f?f.convertUnitTo(RULER_UNITS.PIXELS):0;var E=n[ATTR_PARAGRAPH.PS_TI];E=E?E.convertUnitTo(RULER_UNITS.PIXELS):0,o=s+p+g,r=l+f,a=o+E}var T={};T[TABSELECTORS.LEFTINDENT]=o,T[TABSELECTORS.FIRSTLINEINDENT]=a,T[TABSELECTORS.RIGHTINDENT]=r,e.setIndents(T)},K=function(e){n.selector=e,Z("tabselector-btn")[0].className=TABSELECTORS_PROPS[e].tabSelectorClass,Z("tabselector-container")[0].setAttribute("title",TABSELECTORS_PROPS[e].title)},q=function(t,i){var o;e.direction===DIRECTION.LEFT_TO_RIGHT?o=i-t.rect.left:e.direction===DIRECTION.RIGHT_TO_LEFT&&(o=t.rect.right-i);var r=Math.round(o/e.roundingFactor)*e.roundingFactor;n.point=(r+UNITS.PIXELS).convertUnitTo(e.unit)+e.unit},Q=function(){Z("tabstop-position").find("#pos2").text(" "+n.point)},$=function(){for(var t,i,n=TabStop.getTabPoints(),o={},r=0,a=n.length;r<a;r++){t="tabpoint"+r,i=n[r];try{o[t]={tpid:i.id,align:i.align,point:i.point.convertUnitTo(RULER_UNITS.PIXELS)}}catch(e){}}e.setTabStops(o)},ee=function(e){var t={point:n.point,align:e};editor.doc.execCmd("insertTab",t)},te=function(){var i=Conversions.globalUnit;e.setUnit(i),t.setUnit(i)},ie=function(){var t,n=i.getSelection().getParaFormat();t=n&&n.dir&&"ltr"!=n.dir?DIRECTION.RIGHT_TO_LEFT:DIRECTION.LEFT_TO_RIGHT,e.setDirection(t)},ne=function(){e.setZoomFactor(editor.zoomFactor),t.setZoomFactor(editor.zoomFactor)};return PubSub.subscribe("Document/ComponentInitialized",a),{setDirection:ie,insertTabPoint:ee,showTabPtPosition:Q,setSelector:K,showHideRuler:d}};ZWRulerController=ZWRulerController();var TabStop=function(){"use strict";var e=function(){var e=editor.doc.getSelection();if(e.isTableSelected()||0==DocTreeManager.doc.getAllSections().length)return[];var t=e.getParents(NODE_TYPE.PARAGRAPH),i=t&&t.attr(ATTR_PARAGRAPH.PS_TPS);if(i)for(var n=0,o=i.length;n<o;n++)parseInt(i[n].align)>2&&(i[n].align="0");else i=[];return i},t=function(e){TabStopDlg.removeAllRow();var t,i,n,o;for(t=0,o=e.length;t<o;t++)i=e[t],n={},n[ATTR_PARAGRAPH.PS_TPS]=[],i.attr(n)},i=function(e,t){var i,n,o,r,a,s,l;for(i=0,n=t.length;i<n;i++){for(o=t[i],r=o.attr(ATTR_PARAGRAPH.PS_TPS),r||(r=[]),a=0,s=r.length;a<s;a++)if(r[a].id==e){r.splice(a,1);break}l={},l[ATTR_PARAGRAPH.PS_TPS]=r,o.attr(l)}},n=function(e,t,i){var n,o,r,a,s,l;for(o=0,n=i.length;o<n;o++){for(r=i[o],a=r.attr(ATTR_PARAGRAPH.PS_TPS),a||(a=[]),s=0,l=a.length;s<l;s++)a[s].id==e&&(a[s].point=t);var d={};d[ATTR_PARAGRAPH.PS_TPS]=a,r.attr(d)}},o=function(e,t,i){var n,o,r,a,s,l,d;for(n=0,s=i.length;n<s;n++)o=i[n],l=o.attr(ATTR_PARAGRAPH.PS_TPS),l||(l=[]),r=Utils.randomString(),a={id:r,point:e,align:t,leader:"0"},l.push(a),d={},d[ATTR_PARAGRAPH.PS_TPS]=l,o.attr(d)};return{getTabPoints:e,removeAllTab:t,removeTab:i,updatePoint:n,insertTab:o}};TabStop=TabStop();var TransformableObjectUtils=function(){"use strict";var e=8,t=25,i="currentData",n="initialData",o="cropData",r="gridData",a="resizeData",s="distanceFromEdges",l="offset",d=function(e){var t=0;return e>=337.5&&e<=360||e>=0&&e<=22.5?t=0:e>=22.6&&e<=67.5?t=1:e>=67.6&&e<=112.5?t=2:e>=112.6&&e<=157.5?t=3:e>=157.6&&e<=202.5?t=4:e>=202.6&&e<=247.5?t=5:e>=247.6&&e<=292.5?t=6:e>=292.6&&e<=337.5&&(t=7),t},c=function(t){this.currentAction=t,this.currentDirectionValue=this.currentAction.value+d(this[n][a].angle),this.currentDirectionValue=this.currentDirectionValue%e},u=function(e){var a=this[i][o][r],d=this[n][o][r],c=d.width+e.x;if(c<t)return a[l].y=d[l].y,void(a[l].x=d[l].x);var u=this[n][o][s].cropRight-e.x;this[i][o][s].cropRight=u,a.width=c,a[l].y=d[l].y,a[l].x=d[l].x},p=function(e){var a=this[i][o][r],d=this[n][o][r],c=d.height+e.y;if(c<t)return a[l].y=d[l].y,void(a[l].x=d[l].x);var u=this[n][o][s].cropBottom-e.y;this[i][o][s].cropBottom=u,a.height=c,a[l].y=d[l].y,a[l].x=d[l].x},g=function(e){var a=this[i][o][r],d=this[n][o][r],c=d.height-e.y;if(c<t){var u=TransformDOMHandler.getActualCropCoord(this.currentData[o][r][l]);return a[l].y=u.y,void(a[l].x=u.x)}var p=this[n][o][s].cropTop+e.y;this[i][o][s].cropTop=p,a.height=c,a[l].y=d[l].y+e.y,a[l].x=d[l].x},f=function(e){var a=this[i][o][r],d=this[n][o][r],c=d.width-e.x;if(c<t){var u=TransformDOMHandler.getActualCropCoord(this.currentData[o][r][l]);return a[l].y=u.y,void(a[l].x=u.x)}var p=this[n][o][s].cropLeft+e.x;this[i][o][s].cropLeft=p,a.width=c,a[l].x=d[l].x+e.x,a[l].y=d[l].y},E=function(e){var a=this[i][o][r],d=this[n][o][r],c=d.width+e.x,u=d.height+e.y;if(c<t||u<t)return a[l].y=d[l].y,void(a[l].x=d[l].x);var p=this[n][o][s],g=this[i][o][s],f=p.cropRight-e.x,E=p.cropBottom-e.y;g.cropRight=f,g.cropBottom=E,a.width=c,a.height=u,a[l].y=d[l].y,a[l].x=d[l].x},T=function(e){var a=this[i][o][r],d=this[n][o][r],c=d.width+e.x,u=d.height-e.y;if(c<t||u<t){var p=TransformDOMHandler.getActualCropCoord(a[l]);return a[l].y=p.y,void(a[l].x=p.x)}var g=this[n][o][s],f=this[i][o][s],E=g.cropTop+e.y,T=g.cropRight-e.x;f.cropRight=T,f.cropTop=E,a[l].y=d[l].y+e.y,a.width=c,a.height=u,a[l].x=d[l].x},m=function(e){var a=this[i][o][r],d=this[n][o][r],c=d.width-e.x,u=d.height-e.y;if(c<t||u<t){var p=TransformDOMHandler.getActualCropCoord(a[l]);return a[l].y=p.y,void(a[l].x=p.x)}var g=this[n][o][s],f=this[i][o][s],E=g.cropLeft+e.x,T=g.cropTop+e.y;f.cropTop=T,f.cropLeft=E,a[l].y=d[l].y+e.y,a[l].x=d[l].x+e.x,a.width=c,a.height=u},h=function(e){var a=this[i][o][r],d=this[n][o][r],c=d.width-e.x,u=d.height+e.y;if(c<t||u<t){var p=TransformDOMHandler.getActualCropCoord(a[l]);return a[l].y=p.y,void(a[l].x=p.x)}var g=this[n][o][s],f=this[i][o][s],E=g.cropLeft+e.x,T=g.cropBottom-e.y;f.cropBottom=T,f.cropLeft=E,a[l].x=d[l].x+e.x,a.width=c,a.height=u,a[l].y=d[l].y},I=function(e){var t=this[i][a],n=t.width;e.x<=t[l].x||(n=e.x-t[l].x,t.width=n)},_=function(e){var t=this[i][a],n=e.y,o=t[l].y,r=t.height;n<=o||(n<=o+r?r-=o+r-n:n>o+r&&(r+=n-(o+r)),t.height=r)},A=function(e){var t=this[i][a],n=t.height,o=e.y,r=t[l].y;o>=r+n||(o>r?n-=o-r:o<r&&(n+=r-o),t[l].y=o,t.height=n)},S=function(e){var t=this[i][a],n=t.width,o=e.x,r=t[l].x;o>=r+n||(o>r?n-=o-r:o<r&&(n+=r-o),t[l].x=o,t.width=n)},R=function(e){var t=e/this[i][a].width*100,n=t/100*this[i][a].height;return n},O=function(e){var t=e/this[i][a].height*100,n=t/100*this[i][a].width;return n},b=function(e){var t,n,o=this[i][a],r=0,s=0,d=!1;r=e.x-(o[l].x+o.width),s=e.y-(o[l].y+o.height),r>0?(t=o.width+r,s=R.call(this,r),n=o.height+s,d=!0):s>0?(n=o.height+s,r=O.call(this,s),t=o.width+r,d=!0):r<0&&s<0&&(r=Math.abs(r),s=Math.abs(s),r<s?(t=o.width-r,s=R.call(this,r),n=o.height-s):(n=o.height-s,r=O.call(this,s),t=o.width-r),d=!0),d&&t>=0&&n>=0&&(o.width=t,o.height=n)},v=function(e){var t,n,o,r=this[i][a],s=0,d=0,c=!1,u=r[l].y;s=e.x-(r[l].x+r.width),d=e.y-r[l].y,s>0?(t=r.width+s,d=R.call(this,s),n=r.height+d,o=u-d,c=!0):d<0?(d=Math.abs(d),n=r.height+d,s=O.call(this,d),t=r.width+s,o=u-d,c=!0):s<0&&d>0&&(s=Math.abs(s),s<d?(t=r.width-s,d=R.call(this,s),n=r.height-d):(n=r.height-d,s=O.call(this,d),t=r.width-s),o=u+d,c=!0),c&&t>=0&&n>=0&&(r.width=t,r.height=n,r[l].y=o)},D=function(e){var t,n,o,r,s=this[i][a],d=0,c=0,u=!1,p=s[l].x,g=s[l].y;d=e.x-p,c=e.y-g,d<0?(d=Math.abs(d),t=s.width+d,c=R.call(this,d),n=s.height+c,o=p-d,r=g-c,u=!0):c<0?(c=Math.abs(c),n=s.height+c,d=O.call(this,c),t=s.width+d,o=p-d,r=g-c,u=!0):d>0&&c>0&&(d<c?(t=s.width-d,c=R.call(this,d),n=s.height-c):(n=s.height-c,d=O.call(this,c),t=s.width-d),o=p+d,r=g+c,u=!0),u&&t>=0&&n>=0&&(s.width=t,s.height=n,s[l].x=o,s[l].y=r)},L=function(e){var t,n,o,r=this[i][a],s=0,d=0,c=!1,u=r[l].x;s=e.x-r[l].x,d=e.y-(r[l].y+r.height),s<0?(s=Math.abs(s),t=r.width+s,d=R.call(this,s),n=r.height+d,o=u-s,c=!0):d>0?(n=r.height+d,s=O.call(this,d),t=r.width+s,o=u-s,c=!0):s>0&&d<0&&(d=Math.abs(d),s<d?(t=r.width-s,d=R.call(this,s),n=r.height-d):(n=r.height-d,s=O.call(this,d),t=r.width-s),o=u+s,c=!0),c&&t>=0&&n>=0&&(r.width=t,r.height=n,r[l].x=o)},N=function(){return this[i][a][l].x+this[i][a].width/2},P=function(){return this[i][a][l].y+this[i][a].height/2},C=function(e){var t=editor.doc.getRawFormatAt(e),i=null;return t&&(i="hr"==t.type?DocTreeManager.getTreeNodeAtIndex(e).id:t.id),i};return{getStartingDirection:d,setCurrentValues:c,eastResize:I,northResize:A,westResize:S,southResize:_,southEastResize:b,northEastResize:v,northWestResize:D,southWestResize:L,eastCropResize:u,northCropResize:g,westCropResize:f,southCropResize:p,southEastCropResize:E,northEastCropResize:T,northWestCropResize:m,southWestCropResize:h,computeCenterX:N,computeCenterY:P,getIdFromIdx:C}}(),EventObject=function(){"use strict";function e(e,t,i,n,o,r,a){this.type=e,this.wid=t,this.ht=i,this.offset=n,this.angle=o,this.cursor=r;var s={x:this.offset.x+this.wid/2,y:this.offset.y+this.ht/2};this.pivot=a?a:s}return e.prototype.isBetween=function(e,t){var i=TransformationUtils.getTransformedSize(this.angle,this.wid,this.ht),n=TransformationUtils.getCorners(this.offset.x,this.offset.y,i.width,i.height,this.angle,this.wid,this.ht),o=TransformationUtils.rotatePoints(n,this.angle,this.pivot),r=TransformationUtils.getTop(o),a=TransformationUtils.getLeft(o),s={x:e,y:t},l=TransformationUtils.rotate(s,this.angle,this.pivot);return l.x.isBetween(a,a+this.wid,!0)&&l.y.isBetween(r,r+this.ht,!0)},e.prototype.destroy=function(){this.wid=null,this.ht=null,this.offset=null,this.angle=null,this.type=null,this.cursor=null,this.pivot=null},e}(),EventObjectCollection=function(){"use strict";function e(){this.objectList={}}var t={CROP_CORNER:5,RESIZE_CORNER:4,CROP_GRID:3,RESIZE_GRID:2,ROTATE:1},i=function(e,t,i,n,o,r){var a=7,s=3.5,l=[{x:e-s,y:t-s},{x:e+a-s,y:t-s},{x:e-s,y:t+a-s},{x:e+a-s,y:t+a-s}],d={x:e,y:t},c=TransformationUtils.rotatePoints(l,i?360-i:0,d),u=TransformationUtils.rotatePoints(c,i?360-i:0,n),p=TransformationUtils.getOffsetPtFromPtList(u),g=new EventObject(r,a,a,p,0,o);return[g]},n=21,o=4,r={NORTH:function(e,t,i,r,a,s){var l=[{x:e-n/2,y:t},{x:e+n/2,y:t},{x:e-n/2,y:t+o},{x:e+n/2,y:t+o}],d=TransformationUtils.rotatePoints(l,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d),u=new EventObject(s,n,o,c,i,a);return[u]},NORTHWEST:function(e,t,i,r,a,s){var l=[{x:e,y:t},{x:e+n,y:t},{x:e,y:t+o},{x:e+n,y:t+o}],d=TransformationUtils.rotatePoints(l,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d),u=new EventObject(s,n,o,c,i,a),p=[{x:e,y:t},{x:e+o,y:t},{x:e,y:t+n},{x:e+o,y:t+n}];d=TransformationUtils.rotatePoints(p,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d);var g=new EventObject(s,o,n,c,i,a);return[u,g]},NORTHEAST:function(e,t,i,r,a,s){var l=[{x:e,y:t},{x:e-n,y:t},{x:e,y:t+o},{x:e-n,y:t+o}],d=TransformationUtils.rotatePoints(l,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d),u=new EventObject(s,n,o,c,i,a),p=[{x:e,y:t},{x:e-o,y:t},{x:e,y:t+n},{x:e-o,y:t+n}];d=TransformationUtils.rotatePoints(p,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d);var g=new EventObject(s,o,n,c,i,a);return[u,g]},WEST:function(e,t,i,r,a,s){var l=[{x:e,y:t-n/2},{x:e+o,y:t-n/2},{x:e,y:t+n/2},{x:e+o,y:t+n/2}],d=TransformationUtils.rotatePoints(l,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d),u=new EventObject(s,o,n,c,i,a);return[u]},EAST:function(e,t,i,r,a,s){var l=[{x:e,y:t-n/2},{x:e-o,y:t-n/2},{x:e,y:t+n/2},{x:e-o,y:t+n/2}],d=TransformationUtils.rotatePoints(l,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d),u=new EventObject(s,o,n,c,i,a);return[u]},SOUTHWEST:function(e,t,i,r,a,s){var l=[{x:e,y:t},{x:e+n,y:t},{x:e,y:t-o},{x:e+n,y:t-o}],d=TransformationUtils.rotatePoints(l,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d),u=new EventObject(s,n,o,c,i,a),p=[{x:e,y:t},{x:e+o,y:t},{x:e,y:t-n},{x:e+o,y:t-n}];d=TransformationUtils.rotatePoints(p,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d);var g=new EventObject(s,o,n,c,i,a);return[u,g]},SOUTHEAST:function(e,t,i,r,a,s){var l=[{x:e,y:t},{x:e-n,y:t},{x:e,y:t-o},{x:e-n,y:t-o}],d=TransformationUtils.rotatePoints(l,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d),u=new EventObject(s,n,o,c,i,a),p=[{x:e,y:t},{x:e-o,y:t},{x:e,y:t-n},{x:e-o,y:t-n}];d=TransformationUtils.rotatePoints(p,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d);var g=new EventObject(s,o,n,c,i,a);return[u,g]},SOUTH:function(e,t,i,r,a,s){var l=[{x:e-n/2,y:t},{x:e+n/2,y:t},{x:e-n/2,y:t-o},{x:e+n/2,y:t-o}],d=TransformationUtils.rotatePoints(l,i?360-i:0,r),c=TransformationUtils.getOffsetPtFromPtList(d),u=new EventObject(s,n,o,c,i,a);return[u]}},a=function(e,t,i,n,o,a){var s="CROP_"+a,l=r[a](e,t,i,n,o,s);return l},s=function(e,i){var n=e.angle,o=e.gridData,r=(e.bgData,o.offset.x),s=o.offset.y,l=o.width,d=o.height,c=TransformationUtils.getCorners(r,s,l,d,0,l,d),i=i,u={x:r+l/2,y:s+d/2},p=TransformationUtils.getLeft(c),g=TransformationUtils.getTop(c),f=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],E=8,T=TransformableObjectUtils.getStartingDirection(e.angle),m=a(p+l/2,g,n,u,f[T++%E],"NORTH"),h=a(p+l,g,n,u,f[T++%E],"NORTHEAST"),I=a(p+l,g+d/2,n,u,f[T++%E],"EAST"),_=a(p+l,g+d,n,u,f[T++%E],"SOUTHEAST"),A=a(p+l/2,g+d,n,u,f[T++%E],"SOUTH"),S=a(p,g+d,n,u,f[T++%E],"SOUTHWEST"),R=a(p,g+d/2,n,u,f[T++%E],"WEST"),O=a(p,g,n,u,f[T++%E],"NORTHWEST");this.putElem(i,O,t.CROP_CORNER),this.putElem(i,h,t.CROP_CORNER),this.putElem(i,m,t.CROP_CORNER),this.putElem(i,I,t.CROP_CORNER),this.putElem(i,R,t.CROP_CORNER),this.putElem(i,S,t.CROP_CORNER),this.putElem(i,_,t.CROP_CORNER),this.putElem(i,A,t.CROP_CORNER);var b=e.borderWidth||0,v=[{x:p-b,y:g-b},{x:p+l+b,y:g-b},{x:p-b,y:g+d+b},{x:p+l+b,y:g+d+b}],D=TransformationUtils.rotatePoints(v,n?360-n:0,u),L=TransformationUtils.getOffsetPtFromPtList(D),N=new EventObject("CROP_CONTENT",l+2*b,d+2*b,L,n,"move");this.putElem(i,N,t.CROP_GRID)},l=function(e,n){var o=e.width,r=e.height,a=e.angle,s=e.offset.x,l=e.offset.y,d=TransformationUtils.getCorners(s,l,o,r,0,o,r),n=n,c={x:s+o/2,y:l+r/2},u=TransformationUtils.getLeft(d),p=TransformationUtils.getTop(d),g=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],f=8,E=TransformableObjectUtils.getStartingDirection(e.angle),T=i(u+o/2,p,a,c,g[E++%f],"NORTH"),m=i(u+o,p,a,c,g[E++%f],"NORTHEAST"),h=i(u+o,p+r/2,a,c,g[E++%f],"EAST"),I=i(u+o,p+r,a,c,g[E++%f],"SOUTHEAST"),_=i(u+o/2,p+r,a,c,g[E++%f],"SOUTH"),A=i(u,p+r,a,c,g[E++%f],"SOUTHWEST"),S=i(u,p+r/2,a,c,g[E++%f],"WEST"),R=i(u,p,a,c,g[E++%f],"NORTHWEST");this.putElem(n,R,t.RESIZE_CORNER),this.putElem(n,T,t.RESIZE_CORNER),this.putElem(n,m,t.RESIZE_CORNER),this.putElem(n,S,t.RESIZE_CORNER),this.putElem(n,h,t.RESIZE_CORNER),this.putElem(n,A,t.RESIZE_CORNER),this.putElem(n,_,t.RESIZE_CORNER),this.putElem(n,I,t.RESIZE_CORNER);var O=5,b=[{x:u+o/2-O,y:p-20-O},{x:u+o/2+O,y:p-20-O},{x:u+o/2-O,y:p-20+O},{x:u+o/2+O,y:p-20+O}],v=TransformationUtils.rotatePoints(b,a?360-a:0,c),D={x:TransformationUtils.getLeft(v),y:TransformationUtils.getTop(v)};if(e.isRotatable){var L=new EventObject("circle",2*O,2*O,D,a,"auto");this.putElem(n,L,t.ROTATE)}var N=e.borderWidth||0,P=[{x:u-N,y:p-N},{x:u+o+N,y:p-N},{x:u-N,y:p+r+N},{x:u+o+N,y:p+r+N}],C=TransformationUtils.rotatePoints(P,a?360-a:0,c),y=TransformationUtils.getOffsetPtFromPtList(C),F=new EventObject("content",o+2*N,r+2*N,y,a,"move");this.putElem(n,F,t.RESIZE_GRID)};return e.prototype.initObject=function(e){e.hasOwnProperty("cropData")&&s.call(this,e.cropData,e.id),e.hasOwnProperty("resizeData")&&l.call(this,e.resizeData,e.id)},e.prototype.addObject=function(e,t){this.objectList[e]={},this.objectList[e].elements=[],this.objectList[e].type=t},e.prototype.removeObject=function(e){if(e){for(var t=this.objectList[e],i=ZWJSONUtils.clone(t),n=0;t.elements[n];){var o=t.elements[n];o.destroy(),t.elements.splice(n,1)}return i}},e.prototype.putElem=function(e,t,i){if(Array.isArray(t))for(var n=0,o=t.length;n<o;n++){var r=t[n];r.zindex=i||1,this.objectList[e].elements.push(r)}else t.zindex=i||1,this.objectList[e].elements.push(t)},e.prototype.getEventObjectAtXY=function(e,t){var i=null,n=0;for(var o in this.objectList)for(var r=this.objectList[o],a=0,s=r.elements.length;a<s;a++){var l=r.elements[a];l.isBetween(e,t)&&l.zindex>n&&(i=l,n=l.zindex)}return i},e.prototype.getCurrentObjects=function(){var e=[];for(var t in this.objectList){var i=this.objectList[t],n={};n.id=t,n.type=i.type,e.push(n)}return e},e.prototype.destroy=function(){for(var e in this.objectList){for(var t=this.objectList[e],i=0;t.elements[i];){var n=t.elements[i];n.destroy(),t.elements.splice(i,1)}delete[this.objectList[e]]}this.objectList={}},e.prototype.setCursorForContent=function(e,t){for(var i=this.objectList[e].elements,n=0,o=i.length;n<o;n++){var r=i[n];if("content"==r.type){r.cursor=t;break}}},e.prototype.removeType=function(e,t){for(var i=this.objectList[e].elements,n=0;i[n];){var o=i[n];o.type.indexOf(t)!=-1&&(o.destroy(),i.splice(n,1),n--),n++}},e.prototype.isObjectInSelection=function(e){return this.objectList.hasOwnProperty(e)},e.prototype.isEmpty=function(){return ZWJSONUtils.isEmptyObject(this.objectList)},e.prototype.contains=function(e){return this.objectList.hasOwnProperty(e)},e.prototype.updateId=function(e,t){if(e&&t){var i=this.objectList[e];delete this.objectList[e],this.objectList[t]=i}},e}(),TransformEventHandler=function(e){"use strict";var t=Z("drawcontainer"),i=new EventObjectCollection,n=null,o={},r=null,a=["NORTH","NORTHEAST","NORTHWEST","EAST","WEST","SOUTH","SOUTHEAST","SOUTHWEST"],s=!1,l=!1,d="out",c=!1,u=!1,p=function(){var e=0,t=0,i={},n=function(){t&&(clearTimeout(t),t=0)},o=function(){e=0,t=0,i={}},r=function(r){n(),(ZWJSONUtils.isEmptyObject(i)||i.x==r.clientX&&i.y==r.clientY)&&(e+=1),i.x=r.clientX,i.y=r.clientY,t=setTimeout(o,500)},a=function(){return e};return{resetCount:o,onMouseDown:r,getClickCount:a}}(),g=function(e){var t,i=editor.jeditorPane.offset(),n=editor.zoomFactor;return t=e?{clientX:(e.clientX-i.left)/n,clientY:(e.clientY-i.top)/n}:{clientX:null,clientY:null}},f=function(e,t,i){var r=i.ev;if(o.id!=t&&h(),r&&"mousedown"==r.type){if(r.ctrlKey||r.metaKey)return;p.onMouseDown(r),n="content",i.fromEvent=!1;var a=N[e](e,t,r,i);a||DomUtil.stopEvent(r)}else{i.fromEvent=!0;var l=y[e](e,t,i);l&&(s=!0)}},E=function(e){o.id=e.id,i.removeObject(o.id),i.initObject(e),r&&"textbox"==r.type?D()&&TextBoxHandler.setCursorForTextBox(o.id,"text"):r&&"image"==r.type&&D()&&(d="out")},T=function(e,t,n){"resize"==e?(r=i.removeObject(t),i.updateId(t,n)):i.removeType(t,"CROP")},m={textbox:function(t){TextBoxHandler.setCursorForTextBox(t,"move"),e.publish("TransformableObject/Deselected","textbox",t)},field:function(t){e.publish("FillableField/hideFillableFieldPopUp",t)},hr:function(t){e.publish("TransformableObject/Deselected","hr",t)},image:function(t){e.publish("TransformableObject/Deselected","image",t)},shape:function(t){e.publish("TransformableObject/Deselected","shape",t)}},h=function(){for(var e=i.getCurrentObjects(),t=0,n=e.length;t<n;t++){var a=e[t].id;m[o.type](a)}r=null},I={content:{mousedown:function(e){var t={},i=N[o.type](o.type,o.id,e,t);i||DomUtil.stopEvent(e)},mousemove:function(e){var t=P[o.type](e);t||DomUtil.stopEvent(e)},mouseup:function(e){var t=C[o.type](e);t||DomUtil.stopEvent(e)}},corner:{mousedown:function(t,i){e.publish("Corner/Down",t,i.offset,i.type),DomUtil.stopEvent(t)},mousemove:function(t){e.publish("EventDiv/Move",t),DomUtil.stopEvent(t)},mouseup:function(t){"textbox"==o.type&&TextBoxHandler.setCursorForTextBox(o.id,"move"),d="out",e.publish("EventDiv/Up",t),DomUtil.stopEvent(t)}},circle:{mousedown:function(t){e.publish("Rotation/Down",t),DomUtil.stopEvent(t)},mousemove:function(t){e.publish("EventDiv/Move",t),DomUtil.stopEvent(t)},mouseup:function(t){"textbox"==o.type&&TextBoxHandler.setCursorForTextBox(o.id,"move"),d="out",e.publish("EventDiv/Up",t),DomUtil.stopEvent(t)}},CROP_CONTENT:{mousedown:function(t){var i=g(t);e.publish("TransformableObject/CropMouseDown",o.id,i),DomUtil.stopEvent(t)},mousemove:function(t){var i=g(t);e.publish("TransformableObject/CropMouseMove",o.id,i),DomUtil.stopEvent(t)},mouseup:function(t){e.publish("TransformableObject/CropMouseUp",o.id),DomUtil.stopEvent(t)}},crop_corner:{mousedown:function(t,i){e.publish("CropCorner/Down",t,i.offset,i.type),DomUtil.stopEvent(t)},mousemove:function(t){e.publish("EventDiv/Move",t),DomUtil.stopEvent(t)},mouseup:function(t){e.publish("EventDiv/Up",t),DomUtil.stopEvent(t)}},default:{mousedown:function(){h(),p.resetCount()},mousemove:function(e){var n=g(e),o=i.getEventObjectAtXY(n.clientX,n.clientY),r="";o&&(r=o.cursor),t[0].style.cursor=r},mouseup:function(){}}},_=function(e){if(e){for(var t=e.type,i=0,n=a.length;i<n;i++)e.type.indexOf(a[i])!=-1&&(t=e.type.indexOf("CROP")!=-1?"crop_corner":"corner");return t}},A=function(e,t){var i=e.target,n=J(i),o=n.parents("div.ui-widget-button-set")[0]||n.parents("div#popup-menu-container")[0];return!o&&(!t||!B(e)||(h(),p.resetCount(),!1))},S=function(e){editor.scrollOn=!1,p.onMouseDown(e),u=2==p.getClickCount();var t=g(e),o=i.getEventObjectAtXY(t.clientX,t.clientY),r=_(o);A(e,r)&&(n=r,r=r||"default",I[r][e.type](e,o))},R=function(e){editor.scrollOn=!1;var t=n||"default";I[t][e.type](e)},O=function(e){"undefined"!=typeof EventHandler&&(EventHandler.mouseDown=!1),editor.scrollOn=!1;var t=n||"default";I[t][e.type](e),n=null},b=function(){t[0].addEventListener("mousedown",S,!0),t[0].addEventListener("mousemove",R,!0),t[0].addEventListener("mouseup",O,!0)},v=function(){t[0].removeEventListener("mousedown",S,!0),t[0].removeEventListener("mousemove",R,!0),t[0].removeEventListener("mouseup",O,!0)},D=function(){return"in"==d&&s},L=function(e,t){"textbox"==e&&(TextBoxHandler.setCursorForTextBox(t,"text"),i.setCursorForContent(t,"text")),d="in"},N={textbox:function(e,t,i,o){var r=DocTreeManager.getSectionWithSid(t),a=r.getRangeIndex();if(D())return n=null,!0;o.coord=g(i),o.idx=a;var l=y[e]("textbox",t,o);return l?(c=!0,!!s&&1==p.getClickCount()):(n=null,!0)},field:function(e,t,i,r){var a=EventHandler.getIndex(i);r.coord=g(i),r.idx=a;var s=y[e]("field",t,r);return s?(c=!0,FillableFieldsHandler.changeCursor("mousedown",o.id),!1):(n=null,!0)},hr:function(e,t,i,o){var r=i.target,a=DocUtil.getDocElement(r),s=a.getStart();o.coord=g(i),o.idx=s;var l=y[e]("hr",t,o);return l?(c=!0,!1):(n=null,!0)},image:function(e,t,i,o){if(D())return n=null,!0;var r,a=TransformHandler.getCurrentObjectInfo().isCropActive;if(a||(r=EventHandler.getIndex(i)),c=!0,r>=0||a){o.coord=g(i),a||(o.idx=r);var s=y[e]("image",t,o);return!s&&(n=null,!0)}return!0},shape:function(e,t,i,o){if(D())return n=null,!0;var r,a=TransformHandler.getCurrentObjectInfo().isCropActive;if(a||(r=EventHandler.getIndex(i)),c=!0,r>=0||a){o.coord=g(i),a||(o.idx=r);var s=y[e]("image",t,o);return!s&&(n=null,!0)}return!0}},P={textbox:function(t){var i=g(t),n=TableResize.isColumnResize()||TableResize.isRowResize();return!(!D()&&o.id&&c&&!n)||(e.publish("TransformableObject/MouseMove",i,t),l=!0,!1)},image:function(t){var i=g(t);return!(!D()&&o.id&&c)||(e.publish("TransformableObject/MouseMove",i,t),l=!0,!1)},hr:function(t){var i=g(t);return!c||!o.id||(e.publish("TransformableObject/MouseMove",i,t),l=!0,!1)},field:function(t){var i=g(t);return!c||!o.id||(e.publish("TransformableObject/MouseMove",i,t),l=!0,!1)},shape:function(t){var i=g(t);return!c||!o.id||(e.publish("TransformableObject/MouseMove",i,t),l=!0,!1)}},C={textbox:function(t){var i=g(t);if(!D()&&o.id){if(c=!1,l)return e.publish("TransformableObject/MouseUp",i),s=!0,l=!1,!1;var n=TableResize.isColumnResize()||TableResize.isRowResize();return!s||n?(e.publish("TransformableObject/MouseUp",i),s=!0,!0):1==p.getClickCount()&&(e.publish("TransformableObject/MouseUp",i),!!TransformHandler.isContextAllowedInsideElement()&&(L("textbox",o.id),!0))}return!0},image:function(t){var i=g(t);if(!D()&&o.id){var n=TransformHandler.getCurrentObjectInfo().isCropActive;if(l||n)e.publish("TransformableObject/MouseUp",i),l=!1;else{if(!s)return e.publish("TransformableObject/MouseUp",i),c=!1,s=!0,!0;if(u){var r=TransformHandler.isWidgetSelected(),a={};r&&L("image",o.id),a.doubleClick=!0,y[NODE_TYPE.IMAGE]("image",o.id,a)}}return c=!1,s=!0,!1}return!0},hr:function(t){var i=g(t);return!o.id||(c=!1,e.publish("TransformableObject/MouseUp",i),s=!0,l=!1,!1)},field:function(t){var i=g(t);return!o.id||(c=!1,l&&(e.publish("TransformableObject/MouseUp",i),s=!0,l=!1),FillableFieldsHandler.changeCursor("mouseup",o.id),!1)},shape:function(t){var i=g(t);if(!D()&&o.id){var n=TransformHandler.getCurrentObjectInfo().isCropActive;if(l||n)e.publish("TransformableObject/MouseUp",i),l=!1;else{if(!s)return e.publish("TransformableObject/MouseUp",i),c=!1,s=!0,!0;u&&e.publish("TransformableObject/ShapeDoubleClicked",i)}return c=!1,s=!0,!1}return!0}},y={textbox:function(e,t,n){var r=n.coord?n.coord:g(),a=n.idx,s=!1,l=TransformHandler.getObject("textbox",a,n);return l.isPermissionSufficient()?(o.type="textbox",i.isEmpty()&&b(),i.contains(t)||i.addObject(t,e),o.id=t,TransformHandler.construct(l,r,n),s=!0):l.onDestroy(),s},field:function(e,t,n){var r=n.coord?n.coord:g(n.ev),a=n.idx,s=!1,l=TransformHandler.getObject("field",a,n);return l.isPermissionSufficient()?(o.type="field",i.isEmpty()&&b(),i.contains(t)||i.addObject(t,e),o.id=t,TransformHandler.construct(l,r,n),s=!0):l.onDestroy(),s},hr:function(e,t,n){var r=n.coord?n.coord:g(),a=n.idx,s=!1,l=TransformHandler.getObject("hr",a,n);return l.isPermissionSufficient()?(o.type="hr",i.isEmpty()&&b(),i.contains(t)||i.addObject(t,e),o.id=t,TransformHandler.construct(l,r,n),s=!0):l.onDestroy(),s},image:function(e,t,n){var r=n.coord?n.coord:g(),a=n.idx,s=!1,l=TransformHandler.getObject("image",a,n);return l.isPermissionSufficient()?(o.type="image",i.isEmpty()&&b(),t=l.getId(),i.contains(t)||i.addObject(t,e),o.id=t,TransformHandler.construct(l,r,n),s=!0):l.onDestroy(),s},shape:function(e,t,n){var r=n.coord?n.coord:g(),a=n.idx,s=!1,l=TransformHandler.getObject("shape",a,n);return l.isPermissionSufficient()?(o.type="shape",i.isEmpty()&&b(),t=l.getId(),i.contains(t)||i.addObject(t,e),o.id=t,TransformHandler.construct(l,r,n),s=!0):l.onDestroy(),s}},F=function(e){e==o.id&&(l=!1,s=!1,d="out",o.id=null,o.type=null,o={},i.destroy(),v(),t[0].style.cursor="",n=null)},M=function(e){var t=!1;return t=i.isObjectInSelection(e)},w=(function(){e.subscribe("ResizeDiv/Constructed",E),e.subscribe("ResizeDiv/Destroyed",T.bind(null,"resize")),e.subscribe("CropDiv/Destroyed",T.bind(null,"crop")),e.subscribe("TransformableObject/destroyed",F),e.subscribe(["Transformations/Remove","Document/BeforeViewChange"],h)}(),function(t){for(var i in t)t[i].selection&&e.subscribe(t[i].selection,f.bind(null,i))}),U=function(e,t){var i=TransformHandler.getCurrentObjectInfo().type;"textbox"==i?TextBoxHandler.isTextBoxAtIdx(e)&&h():h()},x=function(){return n},B=function(e){var t=e.target,i=!1,n=J(t).parents("#resizeGridSVG")[0]||J(t).parents("#cropGridSVG")[0]||J(t).parents("#bgImgOuterDiv")[0];if(n)i=!1;else{var o=W(t).hasClass("ui-hdr-ftr-exit");i=!!o||!TransformHandler.isEvOnCurrentObject(e)}return i};return{setContextInsideElement:L,isObjectInSelection:M,loadConfig:w,deselectObjects:h,onCursorChanged:U,getCurrentDownObject:x}}(PubSub),TransformableObject=function(e,t,i){"use strict";function n(e){this.idx=e,this.id=this.id?this.id:editor.doc.getRawFormatAt(this.idx).id,this.initialData={},this.currentAction=o.NONE,this.currentDirectionValue=o.NONE.value,this.isActive=!0,this.action=null,this.downCoord={},this.currentData={},this.parent=null,this.page=null,this.resizeRotTopDiff=0,this.resizeRotLeftDiff=0,this.objectType=null,this.isCropActive=!1,this.pointerStart={},this.elementStart={},this.isFirstMove=!1}var o={NONE:{value:0},NORTH:{value:1},NORTHEAST:{value:2},EAST:{value:3},SOUTHEAST:{value:4},SOUTH:{value:5},SOUTHWEST:{value:6},WEST:{value:7},NORTHWEST:{value:8}};return n.prototype.drawResizeRect=function(){},n.prototype.applyResizedValues=function(){},n.prototype.onRotationDown=function(){e.publish("Gridlines/show"),this.action="rotated"},n.prototype.onRotationMove=function(e){var i=e.x-t.computeCenterX.call(this),n=t.computeCenterY.call(this)-e.y,o=Math.atan(n/i),r=180*o/Math.PI,a=450-r;a+=i>=0&&n>=0?0:i<0&&n>=0?180:i<0&&n<0?180:360,a%=360,a=Math.round(a),a=360===a?0:a,this.currentData.resizeData.angle=a,this.trigger("Resize/UpdateRect",this.currentData,this.action,e)},n.prototype.onCropCornerDown=function(e,i){this.pointerStart=i,this.action="cropped",e=e.substring(5),t.setCurrentValues.call(this,o[e])},n.prototype.onCropCornerMove=function(e){switch(this.currentAction.value){case o.EAST.value:t.eastCropResize.call(this,e);break;case o.SOUTH.value:t.southCropResize.call(this,e);break;case o.NORTH.value:t.northCropResize.call(this,e);break;case o.WEST.value:t.westCropResize.call(this,e);break;case o.SOUTHEAST.value:t.southEastCropResize.call(this,e);break;case o.NORTHEAST.value:t.northEastCropResize.call(this,e);break;case o.NORTHWEST.value:t.northWestCropResize.call(this,e);break;case o.SOUTHWEST.value:t.southWestCropResize.call(this,e)}this.trigger("Resize/UpdateRect",this.currentData,this.action)},n.prototype.onCropCornerUp=function(e){var t={};t.offset={};var i=this.initialData.cropData.gridData;i.offset.x=e.left,i.offset.y=e.top;var n=this.currentData.cropData,r=n.gridData;i.width=r.width,i.height=r.height,this.initialData.cropData.distanceFromEdges=n.distanceFromEdges,this.applyResizedValues(),this.action=null,this.currentAction=o.NONE,this.currentDirectionValue=o.NONE.VALUE,this.pointerStart=null},n.prototype.onCornerDown=function(i,n,r){e.publish("Gridlines/show"),this.elementStart=n,this.pointerStart=r,this.action="resized",t.setCurrentValues.call(this,o[i])},n.prototype.onCornerMove=function(e,i){switch(this.currentAction.value){case o.EAST.value:t.eastResize.call(this,e);break;case o.SOUTH.value:t.southResize.call(this,e);break;case o.NORTH.value:t.northResize.call(this,e);break;case o.WEST.value:t.westResize.call(this,e);break;case o.SOUTHEAST.value:t.southEastResize.call(this,e);break;case o.NORTHEAST.value:t.northEastResize.call(this,e);break;case o.NORTHWEST.value:t.northWestResize.call(this,e);break;case o.SOUTHWEST.value:t.southWestResize.call(this,e)}this.trigger("Resize/UpdateRect",this.currentData,this.action,i)},n.prototype.onMouseUp=function(t){e.publish("Gridlines/hide");var i={};i.offset={},i.offset.x=t.left,i.offset.y=t.top;var n=this.currentData.resizeData;i.width=n.width,i.height=n.height,i.angle=n.angle;var r={};r.resizeData=i,this.initialData=ZWJSONUtils.clone(r),this.applyResizedValues(),this.trigger("Resize/AfterApply",this.action),this.action=null,this.currentAction=o.NONE,this.currentDirectionValue=o.NONE.VALUE},n.prototype.onDestroy=function(){this.trigger("Resize/RemoveRect",this.id),this.isFirstMove=!1,this.elementStart=null,this.pointerStart=null,this.isCropActive=!1,this.objectType=null,this.resizeRotLeftDiff=0,this.resizeRotTopDiff=0,this.page=null,this.parent=null,this.currentData=null,this.downCoord=null,this.action=null,this.isActive=!1,this.currentDirectionValue=o.NONE.value,this.currentAction=o.NONE,this.initialData=null,this.id=null,this.idx=null},n.prototype.isEvOnCurrentObject=function(){},n.prototype.getIdx=function(){return this.idx},n.prototype.getId=function(){return this.id},n.prototype.setType=function(e){this.objectType=e},n.prototype.getType=function(){return this.objectType},n.prototype.isObjectActive=function(){return this.isActive},n.prototype.setObjectActive=function(e){return this.isActive=e},n.prototype.isPermissionSufficient=function(){var e=editor.getRole().permissions.can("document.edit")||editor.getRole().permissions.can("document.fill")||editor.getView()===EDITOR_VIEWS.FILLABLEFIELDS_PREVIEW||editorProps.isPublishToFill;return e},n.prototype.isCropAllowed=function(){return!1},n.prototype.isWidget=function(){return!1},n.prototype.isContextAllowedInsideElement=function(){return!1},n.prototype.isActiveIdx=function(e){return e==this.idx},n.prototype.shouldHideCursor=function(e){return e==this.idx},i.call(n.prototype),n}(PubSub,TransformableObjectUtils,BaseEventHandler),TransformableUIObject=function(){"use strict";function e(e){this.idx=e,this.id=editor.doc.getRawFormatAt(this.idx).id,this.top=null,this.left=null}return e.prototype.updateIdx=function(e){this.idx=e,this.id=editor.doc.getRawFormatAt(this.idx).id},e.prototype.onDestroy=function(){this.top=null,this.left=null,this.id=null,this.idx=null},e.prototype.getContainingSectionType=function(){return DocLayoutManager.getSectionViewAtIndex(this.idx).getSectionType()},e}(),TransformableImageObject=function(){"use strict";function e(e){var t=editor.doc.getRawFormatAt(e);t&&t.type==NODE_TYPE.SIGNERFIELD?e+=1:t&&t.type===NODE_TYPE.CHART&&(this.id=t.id),TransformableObject.call(this,e)}function t(){var e=!1,t=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,this.idx);if(t){var i=t.getRangeIndex(),n=editor.doc.getRawFormatAt(i);e=n&&DTUtils.isNonWrappingFloatImage(n)}return e}function i(e){var t,i=editor.doc.getRawFormatAt(this.idx),n={},o=e.find("[id='"+i.id+"']")[0],r=DocTreeManager.getSectionAtIndex(this.idx);return t=r.getSectionType()!=SECTION_TYPES.TEXTBOX?J(o).parents("span.zw-portion, div.zw-float"):J(o).parents("div.fgImgOuterDiv"),n=J(t).offset()}function n(e){var t,i=editor.doc.getRawFormatAt(this.idx),n=e.find("[id='"+i.id+"']")[0],o=DocTreeManager.getSectionAtIndex(this.idx);return t=o.getSectionType()!=SECTION_TYPES.TEXTBOX?J(n).parents("span.zw-portion, div.zw-float"):J(n).parents("div.fgImgOuterDiv")}var o="currentData",r="initialData",a="cropData",s="gridData",l="resizeData",d="distanceFromEdges",c="offset",u="resizeRotLeftDiff",p="resizeRotTopDiff",g="deltaX",f="deltaY",E="cropTop",T="cropLeft",m="cropBottom",h="cropRight",I={NONE:{value:0},NORTH:{value:1},NORTHEAST:{value:2},EAST:{value:3},SOUTHEAST:{value:4},SOUTH:{value:5},SOUTHWEST:{value:6},WEST:{value:7},NORTHWEST:{value:8}};e.prototype=Object.create(TransformableObject.prototype),e.prototype.constructor=e,e.prototype.onElementDown=function(e){(e.clientX||e.clientY)&&(this.isCropActive?(PubSub.publish("Resize/hide"),this.action="cropBgMove"):this.action="move",this.downCoord={x:e.clientX,y:e.clientY})},e.prototype.onElementMove=function(e,t){var i=editor.doc.getRawFormatAt(this.idx);if(this.isCropActive){var n={x:e.clientX,y:e.clientY},l=(n.x-this.downCoord.x)/editor.zoomFactor,c=(n.y-this.downCoord.y)/editor.zoomFactor,i=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx)),u=l,p=c;if(i.hasOwnProperty(ATTR_IMAGE.I_ROTATE)){var I={x:0,y:0},_={x:l,y:c},A=TransformationUtils.rotate(_,i[ATTR_IMAGE.I_ROTATE],I);u=A.x,p=A.y}var S=this[o][a],R=S[s],O=S.bgData,b=R.width,v=R.height,D=O.height,L=O.width,N=S[d],P=this[r][a][d];N[E]=P[E]-p,N[T]=P[T]-u,N[h]=L-(b+N[T]),N[m]=D-(v+N[E]),this[o][g]=l,this[o][f]=c,this.trigger("Resize/UpdateRect",this[o],this.action)}else if(this.isFirstMove||(this.isFirstMove=!0,PubSub.publish("Gridlines/show"),DTUtils.isFloatingImage(i)&&this.trigger("Transform/DummyAdded")),DTUtils.isFloatingImage(i)){var n={x:e.clientX,y:e.clientY};this[o][g]=n.x-this.downCoord.x,this[o][f]=n.y-this.downCoord.y,this.trigger("Resize/UpdateRect",this[o],this.action)}else{var C=EventHandler.getIndex(t),y=DocTreeManager.getSectionAtIndex(C).getSectionType(),F=NOTE_SECTIONS.contains(y);F||EventHandler.moveCursor(t)}},e.prototype.onElementUp=function(){PubSub.publish("Gridlines/hide");var e=editor.jeditorPane.offset(),t=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx));if(this.isCropActive){var i=this[r][a][s][c];i.y=i.y*editor.zoomFactor+e.top,i.x=i.x*editor.zoomFactor+e.left,t.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&(i.x=i.x-this[u],i.y=i.y-this[p]),this[r][a][d]=this[o][a][d],this.applyResizedValues()}else if(DTUtils.isFloatingImage(t)){if(this.trigger("Transform/DummyRemoved"),this[o][f]||this[o][g]){var n=this[r][l][c];n.y=n.y*editor.zoomFactor+e.top,n.x=n.x*editor.zoomFactor+e.left,n.y+=this[o][f]*editor.zoomFactor,n.x+=this[o][g]*editor.zoomFactor,t.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&(n.y-=this[p]||0,n.x-=this[u]||0),this.applyResizedValues()}this.trigger("Resize/AfterApply",this.action)}else{var E=this.idx,T=editor.doc.getSelection().getStart();if(T<E||E+1<T){var m=[{r:E},{ds:editor.doc.getCharAt(E)}],h=OpUtil.getInsertionOps(editor.doc.createRange(E,E+1));Op.processMsg(m),Op.cursorProcessed();var I=ZWJSONUtils.clone(h.ops[1].as.start),_=I.id;t.id=_,this.setObjectActive(!1),"chart"==t.type?editor.doc.execCmd("insertChart",t):editor.doc.execCmd("insimg",[t,!0]),this.setObjectActive(!0)}else{var A=editor.doc.createRange(E);editor.doc.getSelection().removeAllRanges().addRange(A)}var S=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");S&&S.css("border-left-style","")}this.action=null,this.isFirstMove=!1},e.prototype.cropContentDown=function(e){(e.clientX||e.clientY)&&(this.action="cropFgMove",this.downCoord={x:e.clientX,y:e.clientY})},e.prototype.cropContentMove=function(e){var t={x:e.clientX,y:e.clientY},i=t.x-this.downCoord.x,n=t.y-this.downCoord.y,l=editor.doc.getRawFormatAt(this.idx),u=i,p=n,I=this[o][a],_=I[s],A=this[r][a][s];if(!(l.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&0!=l[ATTR_IMAGE.I_ROTATE]||DTUtils.isFloatingImage(l)||this.isFirstMove)){var S=A.width+2*A.borderWidth,R=A.height+2*A.borderWidth;this.trigger("Crop/HoldPlace",S,R),this.isFirstMove=!0}_[c].y=A[c].y+n,_[c].x=A[c].x+i;var O=l[ATTR_IMAGE.I_ROTATE]||0,b=DocTreeManager.getSectionAtIndex(this.idx);if(b.getSectionType()==SECTION_TYPES.TEXTBOX){var v=b.getRangeIndex(),D=editor.doc.getRawFormatAt(v),L=D.rotation||0;O+=L,O%=360;var N={x:0,y:0},P={x:i,y:n},C=TransformationUtils.rotate(P,L,N);i=C.x,n=C.y}if(O){var N={x:0,y:0},P={x:i,y:n},C=TransformationUtils.rotate(P,O,N);u=C.x,p=C.y}var y=_.width,F=_.height,M=I.bgData,w=M.height,U=M.width,x=I[d],B=this[r][a][d];x[E]=B[E]+p,x[T]=B[T]+u,x[h]=U-(y+x[T]),x[m]=w-(F+x[E]),this[o][g]=i,this[o][f]=n,this.trigger("Resize/UpdateRect",this[o],this.action)},e.prototype.cropContentUp=function(){var e=this[o];if(e[g]||e[f]){var t=editor.jeditorPane.offset(),i=this[r][a],n=i[s][c];n.y=n.y+e[f],n.x=n.x+e[g],n.y=n.y*editor.zoomFactor+t.top,n.x=n.x*editor.zoomFactor+t.left;var l=this[p]||0,E=this[u]||0;n.x=n.x-E,n.y=n.y-l,i[d]=e[a][d],this.applyResizedValues()}this.action=null,this.isFirstMove=!1},e.prototype.onMouseUp=function(e){PubSub.publish("Gridlines/hide");var t=this[o][l];if(this.isCropActive){var i=this[r][a],n=i[s],g=i[d],f=n[c],_=n.width,A=n.height,S=editor.jeditorPane.offset(),R={};R.top=f.y*editor.zoomFactor+S.top,R.left=f.x*editor.zoomFactor+S.left;var O=this[p]||0,b=this[u]||0;R.left=R.left-b,R.top=R.top-O,f.x=f.x*editor.zoomFactor+S.left,f.y=f.y*editor.zoomFactor+S.top,f.x=f.x-b,f.y=f.y-O,g[T]=R.left-e.left,g[E]=R.top-e.top,g[h]=t.width-(g[T]+_),g[m]=t.height-(g[E]+A)}var v=this[r][l],D=v[c];D.x=e.left,D.y=e.top,v.width=t.width,v.height=t.height,v.angle=t.angle,this.applyResizedValues(),this.trigger("Resize/AfterApply",this.action),this.action=null,this.currentAction=I.NONE,this.currentDirectionValue=I.NONE.VALUE},e.prototype.drawResizeRect=function(){var e=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx));e.hasOwnProperty(TCConstants.TC)&&(e=TcView.updateDOMStyles(e));var a={},s={};s.height=parseFloat(e.ht),s.width=parseFloat(e.wid),s.borderWidth=e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;var d=HF_SECTIONS.contains(DocTreeManager.getSection(this.idx).getSectionType()),g=null,f=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),E=t.call(this);if(DTUtils.isNonWrappingFloatImage(e)||E)g=W(DomViewManager.getDOMElem(f)).find("div.float-image-container");else if(d){var T=DomViewManager.getDOMObj(f),m=T.getRenderedDOM(DocLayoutManager.getViewAtIndex(this.idx));g=W(m)}else g=W(DomViewManager.getDOMObj(f).contentWrapper);var h=i.call(this,g);if(h){var I=editor.jeditorPane.offset();s.angle=e[ATTR_IMAGE.I_ROTATE]||0;var _=DocTreeManager.getSectionAtIndex(this.idx);if(_.getSectionType()==SECTION_TYPES.TEXTBOX){var A=_.getRangeIndex(),S=editor.doc.getRawFormatAt(A);s.angle=s.angle+(S.rotation||0),s.angle=s.angle%360;var R=n.call(this,g);editor.clientActiveSection=J(R).parents("div.zw-textbox-div")[0],editor.prevClientActiveSection=editor.clientActiveSection,EventHandler.toggleSection()}if(s.angle){var O=TransformationUtils.getTransformedSize(s.angle,e.wid,e.ht);this[p]=(O.height-e.ht)/2*editor.zoomFactor,this[u]=(O.width-e.wid)/2*editor.zoomFactor,h.top+=this[p],h.left+=this[u]}else this[p]=0,this[u]=0;h.top+=s.borderWidth*editor.zoomFactor,h.left+=s.borderWidth*editor.zoomFactor;var b={};s[c]=b;var v=0,D=0;DTUtils.isWrappingFloatImage(e)&&(v=e[ATTR_IMAGE.I_MT]?e[ATTR_IMAGE.I_MT].convertor().pixels*editor.zoomFactor:0,D=e[ATTR_IMAGE.I_ML]?e[ATTR_IMAGE.I_ML].convertor().pixels*editor.zoomFactor:0),b.x=h.left+D,b.y=h.top+v,b.x=(b.x-I.left)/editor.zoomFactor,b.y=(b.y-I.top)/editor.zoomFactor,a.id=this.id,a[l]=s,s.isRotatable=e.cls!==NODE_TYPE.FILLABLEFIELD&&e.cls!==NODE_TYPE.SIGNERFIELD,s.zindex=ZINDEX.FLOAT_IMG_FRONT+(e.zindex?e.zindex:0),this[r]=a,this[o]=ZWJSONUtils.clone(this[r]);var L=editor.doc.getSelection(),N=L&&L.getLastRange();N&&N.setStart(this.idx)&&N.setEnd(N.start),e.type===NODE_TYPE.CHART?PubSub.publish("MergeChart/fetchPanel",{async:!0,timeout:100}):!e[MAILMERGE.MMINFO]&&e.subType!=NODE_TYPE.BARCODE&&e.subType!=NODE_TYPE.QRCODE||e.subType==NODE_TYPE.WIDGET||PubSub.publish("BarcodeQrcode/fetchPanel",{async:!0,timeout:100}),this.parent=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(this.idx),this.page=f,this.trigger("ConstructRect",this[o],this.parent,this.page)}},e.prototype.drawCropRect=function(){var e=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx));e.hasOwnProperty(TCConstants.TC)&&(e=TcView.updateDOMStyles(e));var g={},f={},I={},_={},A={},S=HF_SECTIONS.contains(DocTreeManager.getSectionAtIndex(this.idx).getSectionType()),R=null,O=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),b=t.call(this);if(DTUtils.isNonWrappingFloatImage(e)||b)R=W(DomViewManager.getDOMElem(O)).find("div.float-image-container");else if(S){var v=DomViewManager.getDOMObj(O),D=v.getRenderedDOM(DocLayoutManager.getViewAtIndex(this.idx));R=W(D)}else R=W(DomViewManager.getDOMObj(O).contentWrapper);var L=i.call(this,R);if(L){var N=editor.jeditorPane.offset(),P=e[ATTR_IMAGE.I_ROTATE]||0,C=DocTreeManager.getSectionAtIndex(this.idx);if(C.getSectionType()==SECTION_TYPES.TEXTBOX){var y=C.getRangeIndex(),F=editor.doc.getRawFormatAt(y);P+=F.rotation||0,P%=360;var M=n.call(this,R);editor.clientActiveSection=J(M).parents("div.zw-textbox-div")[0],editor.prevClientActiveSection=editor.clientActiveSection,EventHandler.toggleSection()}if(P){var w=TransformationUtils.getTransformedSize(P,e.wid,e.ht);this[p]=(w.height-e.ht)/2*editor.zoomFactor,this[u]=(w.width-e.wid)/2*editor.zoomFactor,L.top+=this[p],L.left+=this[u]}else this[p]=0,this[u]=0;var U=e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;L.top+=U*editor.zoomFactor,L.left+=U*editor.zoomFactor;var x={};_[c]=x;var B=0,H=0;DTUtils.isWrappingFloatImage(e)&&(B=e[ATTR_IMAGE.I_MT]?e[ATTR_IMAGE.I_MT].convertor().pixels*editor.zoomFactor:0,H=e[ATTR_IMAGE.I_ML]?e[ATTR_IMAGE.I_ML].convertor().pixels*editor.zoomFactor:0),x.x=L.left+H,x.y=L.top+B,x.x=(x.x-N.left)/editor.zoomFactor,x.y=(x.y-N.top)/editor.zoomFactor,_.height=parseFloat(e.ht),_.width=parseFloat(e.wid),_.borderWidth=U;var G=e[ATTR_IMAGE.I_CROPRECT],k=ZWImageUtils.getOrginalHeighWidthOfImage(e);I.width=parseFloat(k.wid),I.height=parseFloat(k.ht);var Y={};G?Y=ZWImageUtils.convertCropDataToPixel(G,k.ht,k.wid):(Y[E]=0,Y[T]=0,Y[h]=0,Y[m]=0),L=i.call(this,R);var z=TransformationUtils.getCropOffset(_.width,_.height,Y,P,L,editor.zoomFactor);I[c]=z,z.y=z.y+U*editor.zoomFactor,z.x=z.x+U*editor.zoomFactor,z.x=z.x+H,z.y=z.y+B,z.x=(z.x-N.left)/editor.zoomFactor,z.y=(z.y-N.top)/editor.zoomFactor,f.angle=P,f[s]=_,f.bgData=I,f.zindex=ZINDEX.FLOAT_IMG_FRONT+(e.zindex?e.zindex:0),f[d]=Y,A=ZWJSONUtils.clone(I),A.angle=P,A.zindex=ZINDEX.FLOAT_IMG_FRONT+(e.zindex?e.zindex:0),A.isRotatable=!1,A.borderWidth=U,g[a]=f,g[l]=A,g.id=this.id,this[r]=g,this[o]=ZWJSONUtils.clone(this[r]),this.parent=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(this.idx),this.page=O,PubSub.publish("Crop/Constructed");var Z=editor.doc.getSelection(),V=Z&&Z.getLastRange();V&&V.setStart(this.idx)&&V.setEnd(V.start),this.trigger("ConstructRect",this[o],this.parent,this.page)}},e.prototype.applyResizedValues=function(){var e=editor.doc.getRawFormatAt(this.idx),t={};t[ATTR_IMAGE.I_WID_UN]="px",t[ATTR_IMAGE.I_HT_UN]="px";var i,n,o=this[r][l];t[ATTR_IMAGE.I_WID]=o.width,t[ATTR_IMAGE.I_HT]=o.height,t[ATTR_IMAGE.I_ROTATE]=o.angle;var u=DocTreeManager.getSectionAtIndex(this.idx);if(u.getSectionType()==SECTION_TYPES.TEXTBOX){var p=u.getRangeIndex(),g=editor.doc.getRawFormatAt(p);t[ATTR_IMAGE.I_ROTATE]=t[ATTR_IMAGE.I_ROTATE]-(g.rotation||0),t[ATTR_IMAGE.I_ROTATE]<0&&(t[ATTR_IMAGE.I_ROTATE]=360+t[ATTR_IMAGE.I_ROTATE])}if(this.isCropActive){i=this[r][a],n=i[s];var f=ZWImageUtils.convertCropDataToPercentage(i[d],t[ATTR_IMAGE.I_HT],t[ATTR_IMAGE.I_WID]);t[ATTR_IMAGE.I_CROPRECT]=f,t[ATTR_IMAGE.I_WID]=n.width,t[ATTR_IMAGE.I_HT]=n.height}if(e.cls===NODE_TYPE.FILLABLEFIELD){if(e.wrapType){var E={type:"absolute",from:"page"},T={type:"absolute",from:"page"},m=DomViewManager.getClosestPage({left:this.initialData.resizeData.offset.x,top:this.initialData.resizeData.offset.y}),h=J(m).offset(),I=this.initialData.resizeData.offset.y-h.top,_=this.initialData.resizeData.offset.x-h.left;T[ATTR_IMAGE.I_TOP]=I,E[ATTR_IMAGE.I_LEFT]=_,t[ATTR_IMAGE.I_H_POSITION]=E,t[ATTR_IMAGE.I_V_POSITION]=T,t.originalLeft=this.initialData.resizeData.offset.x,t.originalTop=this.initialData.resizeData.offset.y}return void PubSub.publish("Document/fillableResize",t)}if(DTUtils.isFloatingImage(e)){var A=ZWJSONUtils.clone(e);extend(A,t);var S=o[c],R={top:S.y,left:S.x};if(this.isCropActive){var O=n[c];R.top=O.y,R.left=O.x}Macros.isFloatAllowed()&&(A[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute"),A[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",ImageActions.moveFloatingImage(R,this.idx,A)}else{var b=editor.doc.getParents(e.type,this.idx);editor.doc.execCmd("applyStyle",[b,t,"resizeImage"]);var v=editor.doc.createRange(this.idx,this.idx);editor.doc.getSelection().removeAllRanges().addRange(v)}},e.prototype.removeCrop=function(){this.trigger("Crop/RemoveRect",this.id)};var _=function(e){var t={},i=this[p]||0,n=this[u]||0;return t.x=e.x-n,t.y=e.y-i,t};return e.prototype.getActualOffset=function(){var e=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx));e&&e.hasOwnProperty(TCConstants.TC)&&(e=TcView.updateDOMStyles(e));var t=_.call(this,this[r][l][c]),i=e&&e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;return t.x=t.x-i,t.y=t.y-i,t},e.prototype.getCropOffset=function(){var e=_.call(this,this[r][a][s][c]);return e},e.prototype.getCropWidth=function(){return this[r][a][s].width},e.prototype.isCropAllowed=function(){var e=Macros.isCropAllowed(),t=editor.doc.getRawFormatAt(this.idx),i=t[MAILMERGE.MMINFO]||t[ATTR_FILLABLEFIELD.FF_INFO]&&t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]!==FILLABLEFIELD_TYPE.IMAGE||t.subType==ATTR_WIDGET.WIDGET||t.subType==ATTR_CHART.CHART||t.subType==NODE_TYPE.QRCODE||t.subType==NODE_TYPE.BARCODE;return e&&!i},e.prototype.getWidgetParent=function(){var e,i,n=HF_SECTIONS.contains(DocTreeManager.getSectionAtIndex(this.idx).getSectionType()),o=editor.doc.getRawFormatAt(this.idx),r=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),a=t.call(this);if(DTUtils.isNonWrappingFloatImage(o)||a)i=W(DomViewManager.getDOMElem(r)).find("div.float-image-container");else if(n){var s=DomViewManager.getDOMObj(r),l=s.getRenderedDOM(DocLayoutManager.getViewAtIndex(this.idx));i=W(l)}else i=W(DomViewManager.getDOMObj(r).contentWrapper);var d=i.find("[id='"+o.id+"']")[0];return e=J(d).parents("div.fgImgOuterDiv")[0]},e.prototype.isWidget=function(){var e=this.getWidgetParent();return e&&W(e).hasClass("zw-ifr-div")},e.prototype.isPermissionSufficient=function(){var e=editor.doc.getRawFormatAt(this.idx),t=e.hasOwnProperty(ATTR_IMAGE.WM_INFO);return!t},e.prototype.isEvOnCurrentObject=function(e){var t=e.target;t=ImageActions.fgImgToImage(t);var i=editor.doc.getRawFormatAt(this.idx);if(DomUtil.nodeNameEquals(t,"image")){var n=t.id;if(n==i.id)return!0}if(W(t).hasClass("overlay")&&editor.doc.getSelection().isCollapsed()){var o=editor.doc.getSelection().getStart();if(o==this.idx)return!0}return!1},e.prototype.isPermissionSufficient=function(){var e=editor.doc.getRawFormatAt(this.idx),t=e.hasOwnProperty(ATTR_IMAGE.WM_INFO),i=Macros.isPDFDocument()&&"behind"==e.wrapType;return!(i||t||!TransformableObject.prototype.isPermissionSufficient.call(this))},e}(),TransformableTextBoxObject=function(e,t,i,n,o,r){"use strict";function a(i){var n=t.doc.getRawFormatAt(i);this.section=DocTreeManager.getSectionWithSid(n.id),e.call(this,i)}function s(e){var t={},i=this.rotTopDiff||0,n=this.rotLeftDiff||0;return t.x=e.x-n,t.y=e.y-i,t}return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype.onElementDown=function(e){(e.clientX||e.clientY)&&(this.action="move",this.downCoord={x:e.clientX,y:e.clientY});var i=t.doc.getSelection(),n=i.getLastRange();n&&n.setStart(this.idx)&&n.setEnd(n.start)},a.prototype.onElementMove=function(e,n){var o=t.doc.getRawFormatAt(this.idx),r=o.cls===NODE_TYPE.FILLABLEFIELD;if(!r||DTUtils.isFloatingImage(o))if(this.isFirstMove||(this.isFirstMove=!0,PubSub.publish("Gridlines/show"),DTUtils.isFloatingImage(o)&&this.trigger("Transform/DummyAdded")),DTUtils.isFloatingImage(o)){var a={x:e.clientX,y:e.clientY},s=this.currentData;s.deltaX=a.x-this.downCoord.x,s.deltaY=a.y-this.downCoord.y,this.trigger("Resize/UpdateRect",s,this.action)}else{var l=i.getIndex(n),d=DocTreeManager.getSectionAtIndex(l).getSectionType(),c=META_SECTIONS.contains(d);c||i.moveCursor(n)}},a.prototype.onElementUp=function(){var e=o.clone(t.doc.getRawFormatAt(this.idx)),i=e.cls===NODE_TYPE.FILLABLEFIELD;if(!i||DTUtils.isFloatingImage(e)){if(PubSub.publish("Gridlines/hide"),DTUtils.isFloatingImage(e)){if(this.trigger("Transform/DummyRemoved"),this.currentData.deltaY||this.currentData.deltaX){var r=t.jeditorPane.offset(),a=this.initialData.resizeData.offset;a.y=a.y*t.zoomFactor+r.top,a.x=a.x*t.zoomFactor+r.left,a.y+=this.currentData.deltaY*t.zoomFactor,a.x+=this.currentData.deltaX*t.zoomFactor,e.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&(a.y-=this.rotTopDiff||0,a.x-=this.rotLeftDiff||0),this.applyResizedValues()}this.trigger("Resize/AfterApply",this.action)}else{var s=this.idx,l=t.doc.getSelection().getStart(),d=this.section.getIndex()<l&&l<=this.section.getEndIndex();if((l<s||s+1<l)&&!d){var c=[{r:s},{ds:t.doc.getCharAt(s)}],u=OpUtil.getInsertionOps(t.doc.createRange(s,s+1));TableUtil.handleSectionOpsArr(u.sectionOps),TextBoxHandler.removeTextBoxSection(e.id),n.processMsg(c),n.cursorProcessed();var p=o.clone(u.ops[1].as.start),g=p.id;e.id=g,this.setObjectActive(!1),t.doc.execCmd("insimg",[e,!0]);var f=DomViewManager.getDOMObj(this.page);t.clientActiveSection=f.getActiveSectionElem(DocLayoutManager.getSectionViewWithResizeObjectAtIndex(this.idx)),t.prevClientActiveSection=t.clientActiveSection,this.setObjectActive(!0);var E=t.doc.getSelection(),T=E.getLastRange();T&&T.setStart(this.idx)&&T.setEnd(T.start)}else{var T=t.doc.createRange(s);t.doc.getSelection().removeAllRanges().addRange(T)}var m=t.doc.getDomCursorNode(t.uuid,t.zuid,"start");m&&m.css("border-left-style","")}this.action=null,this.isFirstMove=!1}},a.prototype.drawResizeRect=function(){var e=o.clone(t.doc.getRawFormatAt(this.idx));e.hasOwnProperty(TCConstants.TC)&&(e=TcView.updateDOMStyles(e));var i={};i.height=parseFloat(e.ht),i.width=parseFloat(e.wid),i.borderWidth=e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0,i.zoomFactor=t.zoomFactor;var n=DocLayoutManager.getSectionViews(e.id)[0],r=DomViewManager.getDOMObj(n.getPage()),a=r.getRenderedDOM(n),s=J(a).offset();if(s){var l=t.jeditorPane.offset();e.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&(this.rotTopDiff=a.children[0].style.top.convertor().pixels*t.zoomFactor||0,this.rotLeftDiff=a.children[0].style.left.convertor().pixels*t.zoomFactor||0,s.top+=this.rotTopDiff,s.left+=this.rotLeftDiff),s.top+=i.borderWidth*t.zoomFactor,s.left+=i.borderWidth*t.zoomFactor;var d={};i.offset=d;var c=0,u=0;DTUtils.isWrappingFloatImage(e)&&(c=e[ATTR_IMAGE.I_MT]?e[ATTR_IMAGE.I_MT].convertor().pixels*t.zoomFactor:0,u=e[ATTR_IMAGE.I_ML]?e[ATTR_IMAGE.I_ML].convertor().pixels*t.zoomFactor:0),d.x=s.left+u,d.y=s.top+c,d.x=(d.x-l.left)/t.zoomFactor,d.y=(d.y-l.top)/t.zoomFactor,i.angle=e[ATTR_IMAGE.I_ROTATE]||0,i.isRotatable=!e[ATTR_FILLABLEFIELD.FF_INFO]||e[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]!==FILLABLEFIELD_TYPE.MULTILINE,i.zindex=ZINDEX.FLOAT_IMG_FRONT+(e.zindex?e.zindex:0);var p={};p.id=this.id,p.resizeData=i,this.initialData=p,this.currentData=o.clone(this.initialData),this.parent||e[ATTR_FILLABLEFIELD.FF_INFO]&&e[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.MULTILINE||PubSub.publish("TextBox/ShowPanel");var g=t.doc.getSelection(),f=g&&g.getLastRange();f.start==this.idx&&f&&f.setStart(this.idx)&&f.setEnd(f.start),this.parent=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(this.idx),this.page=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),this.trigger("ConstructRect",this.currentData,this.parent,this.page)}},a.prototype.applyResizedValues=function(){var e=t.doc.getRawFormatAt(this.idx),n={},r=this.initialData.resizeData;if(n[ATTR_IMAGE.I_WID_UN]="px",n[ATTR_IMAGE.I_HT_UN]="px",n[ATTR_IMAGE.I_WID]=r.width,n[ATTR_IMAGE.I_HT]=r.height,n[ATTR_IMAGE.I_ROTATE]=r.angle,DTUtils.isFloatingImage(e)){var a=o.clone(e);extend(a,n);var s=r.offset,l={top:s.y,left:s.x};a[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",a[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",ImageActions.moveFloatingImage(l,this.idx,a)}else{var d=t.doc.getParents(NODE_TYPE.IMAGE,this.idx);t.doc.execCmd("applyStyle",[d,n,"resizeImage"]);var c=t.doc.createRange(this.section.getRangeIndex(),this.section.getRangeIndex());t.doc.getSelection().removeAllRanges().addRange(c)}var u=DomViewManager.getDOMObj(this.page);t.clientActiveSection=u.getActiveSectionElem(DocLayoutManager.getSectionViewWithResizeObjectAtIndex(this.idx)),t.prevClientActiveSection=t.clientActiveSection,i.toggleSection()},a.prototype.isActiveIdx=function(e){var t=!1;if(e==this.idx)t=!0;else{var i=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,e);if(null!=i){var n=i.getRangeIndex();n==this.idx&&(t=!0)}}return t},a.prototype.isEvOnCurrentObject=function(e){var i=e.target,n=J(i).parents(".zw-textbox-div")[0];if(n){var o=DomViewManager.getViewData(n).nodeId;if(o==this.id)return!0}if(W(i).hasClass("overlay")&&t.doc.getSelection().isCollapsed()){var r=t.doc.getSelection().getStart();if(r==this.idx)return!0}return!1},a.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.section=null},a.prototype.isPermissionSufficient=function(){var i=t.doc.getRawFormatAt(this.idx),n=i.hasOwnProperty(ATTR_IMAGE.WM_INFO);return!n&&e.prototype.isPermissionSufficient.call(this)},a.prototype.getActualOffset=function(){var e=o.clone(t.doc.getRawFormatAt(this.idx));e&&e.hasOwnProperty(TCConstants.TC)&&(e=TcView.updateDOMStyles(e));var i=s.call(this,this.initialData.resizeData.offset),n=e&&e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;return i.x=i.x-n,i.y=i.y-n,i},a.prototype.isContextAllowedInsideElement=function(){var e=t.doc.getRawFormatAt(this.idx);return TextBoxHandler.isCursorAllowed(e.id)},a}(TransformableObject,editor,EventHandler,Op,ZWJSONUtils,Utils),TransformableFieldObject=function(e,t){"use strict";function i(t){e.call(this,t)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.onElementDown=function(e){(e.clientX||e.clientY)&&(this.action="move",this.downCoord={x:e.clientX,y:e.clientY})},i.prototype.onElementMove=function(e,t){var i=editor.doc.getRawFormatAt(this.idx);if(this.isFirstMove||(this.isFirstMove=!0,PubSub.publish("Gridlines/show"),DTUtils.isFloatingImage(i)&&this.trigger("Transform/DummyAdded")),DTUtils.isFloatingImage(i)){var n={x:e.clientX,y:e.clientY};this.currentData.deltaX=n.x-this.downCoord.x,this.currentData.deltaY=n.y-this.downCoord.y,this.trigger("Resize/UpdateRect",this.currentData,this.action)}else EventHandler.moveCursor(t)},i.prototype.onElementUp=function(){PubSub.publish("Gridlines/hide");var e=t.clone(editor.doc.getRawFormatAt(this.idx));if(DTUtils.isFloatingImage(e)){if(this.trigger("Transform/DummyRemoved"),0!=this.currentData.deltaY||0!=this.currentData.deltaX){var i=editor.jeditorPane.offset(),n=this.initialData.resizeData;n.offset.y=n.offset.y*editor.zoomFactor+i.top,n.offset.x=n.offset.x*editor.zoomFactor+i.left,n.offset.y+=this.currentData.deltaY*editor.zoomFactor,n.offset.x+=this.currentData.deltaX*editor.zoomFactor,e.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&(n.offset.y-=this.rotTopDiff||0,n.offset.x-=this.rotLeftDiff||0),this.applyResizedValues()}this.trigger("Resize/AfterApply",this.action)}this.action=null,this.isFirstMove=!1},i.prototype.drawResizeRect=function(){var e=editor.doc.getRawFormatAt(this.idx),i=J("[data-field-id = '"+e.id+"']")[0],n=J(i).offset(),o={};o.offset={};var r=DocTreeManager.getTreeNodeAtIndex(this.idx).getParaStyles(),a=r.textFormat,s=DocTreeManager.getTreeNodeAtIndex(this.idx).getHeadingType(),l=editor.doc.getRawFormatAt(this.idx+1);if(o.width=0,o.height=0,e.type==NODE_TYPE.FILLABLEFIELD){o.width=DTUtils.getFillableFieldWidth(l,a,e);var d=editor.doc.getComputedFormatAt(this.idx+1,NODE_TYPE.TEXT,s);d=d&&d[ATTR_TEXT.TS_SIZE]?d:r&&r[ATTR_PARAGRAPH.TEXTFORMAT]&&r[ATTR_PARAGRAPH.TEXTFORMAT][ATTR_TEXT.TS_SIZE]?r[ATTR_PARAGRAPH.TEXTFORMAT]:d,o.height=DTUtils.getFillableFieldHeight(d,l)}e.hasOwnProperty(ATTR_IMAGE.I_WID)&&(o.width=e[ATTR_IMAGE.I_WID]),e.hasOwnProperty(ATTR_IMAGE.I_HT)&&(o.height=e[ATTR_IMAGE.I_HT]),o.angle=0;var c=DocTreeManager.getSectionAtIndex(this.idx);if(c.getSectionType()==SECTION_TYPES.TEXTBOX){var u=c.getRangeIndex(),p=editor.doc.getRawFormatAt(u);o.angle=o.angle+(p.rotation||0),o.angle=o.angle%360,editor.clientActiveSection=J(i).parents("div.zw-textbox-div")[0],editor.prevClientActiveSection=editor.clientActiveSection,EventHandler.toggleSection()}if(o.angle){var g=o.width,f=o.height,E=TransformationUtils.getTransformedSize(o.angle,g,f);this.resizeRotTopDiff=(E.height-f)/2*editor.zoomFactor,this.resizeRotLeftDiff=(E.width-g)/2*editor.zoomFactor,n.top+=this.resizeRotTopDiff,n.left+=this.resizeRotLeftDiff}else this.resizeRotTopDiff=0,this.resizeRotLeftDiff=0;var T=editor.jeditorPane.offset();n.left=(n.left-T.left)/editor.zoomFactor,n.top=(n.top-T.top)/editor.zoomFactor,o.offset.x=n.left,o.offset.y=n.top,o.isRotatable=!1,this.initialData={},this.initialData.id=this.id,this.initialData.resizeData=o,this.currentData=t.clone(this.initialData),this.parent=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(this.idx),this.page=DocLayoutManager.getPageAtIndex(this.idx),this.trigger("ConstructRect",this.currentData,this.parent,this.page)},i.prototype.applyResizedValues=function(){var e={},t={type:"absolute",from:"page"},i={type:"absolute",from:"page"},n=(editor.jeditorPane.offset(),this.initialData.resizeData);e[ATTR_IMAGE.I_WID_UN]="px",e[ATTR_IMAGE.I_HT_UN]="px",e[ATTR_IMAGE.I_WID]=n.width,e[ATTR_IMAGE.I_HT]=n.height,e[ATTR_IMAGE.I_ROTATE]=n.angle;var o=1*editor.zoomFactor,r=DomViewManager.getClosestPage({left:n.offset.x,top:n.offset.y}),a=J(r).offset(),s=n.offset.y-(a.top+o),l=n.offset.x-(a.left+o);i[ATTR_IMAGE.I_TOP]=s,t[ATTR_IMAGE.I_LEFT]=l,e[ATTR_IMAGE.I_H_POSITION]=t,e[ATTR_IMAGE.I_V_POSITION]=i;var d=editor.doc.getRawFormatAt(this.idx)||{};d.mminfo?PubSub.publish("Document/mergefieldResize",e):(e.originalLeft=n.offset.x,e.originalTop=n.offset.y,PubSub.publish("Document/fillableResize",e))},i.prototype.isPermissionSufficient=function(){var t=editor.doc.getRawFormatAt(this.idx),i=!!t.wrapType,n=!(t.cls||"").indexOf(NODE_TYPE.FILLABLEFIELD),o=t.type==NODE_TYPE.SIGNERFIELD;return n?e.prototype.isPermissionSufficient.call(this)&&(i||n):Utils.allowTransformableSignerField()&&o?e.prototype.isPermissionSufficient.call(this):e.prototype.isPermissionSufficient.call(this)&&i},i.prototype.isEvOnCurrentObject=function(e){var t=e.target,i=W(t),n=i.hasClass("fillablefield")||i.parents().hasClass("fillablefield"),o=i.hasClass("signerfield")||i.parents().hasClass("signerfield"),r=i.hasClass("mergeField")||i.parents().hasClass("mergeField");if(n||o||r){n&&!i.hasClass("fillablefield")?i=i.parents(".fillablefield"):o&&!i.hasClass("signerfield")?i=i.parents(".signerfield"):r&&!i.hasClass("mergeField")&&(i=i.parents(".mergeField")),t=i[0];var a=t.getAttribute("data-field-id");if(a==this.id)return!0}return!1},i.prototype.getActualOffset=function(){var e=this.initialData.resizeData.offset;return e},i}(TransformableObject,ZWJSONUtils),TransformableHrObject=function(e,t,i){"use strict";function n(t){this.id=DocTreeManager.getTreeNodeAtIndex(t).id,this.isDummyHt=!1,e.call(this,t)}var o={NONE:{value:0},NORTH:{value:1},NORTHEAST:{value:2},EAST:{value:3},SOUTHEAST:{value:4},SOUTH:{value:5},SOUTHWEST:{value:6},WEST:{value:7},NORTHWEST:{value:8}};return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.onElementDown=function(e){(e.clientX||e.clientY)&&(this.action="move",this.downCoord={x:e.clientX,y:e.clientY})},n.prototype.onElementMove=function(e,t){},n.prototype.onElementUp=function(){},n.prototype.onCornerMove=function(){this.currentAction.value!=o.WEST.value&&this.currentAction.value!=o.EAST.value&&(this.isDummyHt=!1),e.prototype.onCornerMove.apply(this,arguments)},n.prototype.drawResizeRect=function(){var e=t.doc.getRawFormatAt(this.idx),n=DocTreeManager.getTreeNodeAtIndex(this.idx),o={},r=DocLayoutManager.getViews(n)[0],a=DomViewManager.getDOMElem(r),s=J(a).offset();o.offset={},o.width=e.hasOwnProperty(ATTR_HR.HR_WID)?e[ATTR_HR.HR_WID]:r.getParent().getWidth();var l=1;e&&e.hasOwnProperty(ATTR_COMMON.BORDERS)&&e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]&&(l=parseFloat(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])),o.angle=0;var d=DocTreeManager.getSectionAtIndex(this.idx);if(d.getSectionType()==SECTION_TYPES.TEXTBOX){var c=d.getRangeIndex(),u=t.doc.getRawFormatAt(c);o.angle=o.angle+(u.rotation||0),o.angle=o.angle%360,t.clientActiveSection=J(a).parents("div.zw-textbox-div")[0],t.prevClientActiveSection=t.clientActiveSection,EventHandler.toggleSection()}if(o.angle){var p=o.width,g=l,f=TransformationUtils.getTransformedSize(o.angle,p,g);this.resizeRotTopDiff=(f.height-g)/2*t.zoomFactor,this.resizeRotLeftDiff=(f.width-p)/2*t.zoomFactor,s.top+=this.resizeRotTopDiff,s.left+=this.resizeRotLeftDiff}else this.resizeRotTopDiff=0,this.resizeRotLeftDiff=0;var E=t.jeditorPane.offset();s.left=(s.left-E.left)/t.zoomFactor,s.top=(s.top-E.top)/t.zoomFactor;var T=l<=1?4:0,m=l>1?l:10;o.height=m,o.offset.x=s.left,o.offset.y=s.top-T,o.isRotatable=!1,this.initialData={},this.initialData.id=this.id,this.isDummyHt=l<=1,this.initialData.resizeData=o,this.currentData=i.clone(this.initialData),this.parent=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(this.idx),this.page=DocLayoutManager.getPageAtIndex(this.idx);var h=t.doc.getSelection(),I=h.getLastRange();I&&I.setStart(this.idx-1)&&I.setEnd(I.start),this.trigger("ConstructRect",this.currentData,this.parent,this.page)},n.prototype.applyResizedValues=function(){var e=t.doc.createRange(this.idx,this.idx+1).getParents(NODE_TYPE.HR),i={};if(e){var n=e.attr(),o=this.initialData.resizeData.width,r=this.initialData.resizeData.height;i[ATTR_HR.HR_WID]=o;var a={};a[ATTR_BORDERS.BORDER_TOP]=n[ATTR_COMMON.BORDERS]?n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]:{type:"solid",color:"zwdark1",width:"1px",space:"0px"},i.borders=a;var s;s=r>10?"10px":r<1?"1px":this.isDummyHt&&10==r?"1px":r+"px",i.borders[ATTR_BORDERS.BORDER_TOP].width=s,t.doc.execCmd("applyStyle",[e,i,"resizeHR"])}},n.prototype.getActualOffset=function(){var e=i.clone(this.initialData.resizeData.offset);return e},n.prototype.getWidth=function(){return this.initialData.resizeData.width},n.prototype.isEvOnCurrentObject=function(e){var t=e.target,i=J(t).data();return i.nodeId==this.id},n.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.isDummyHt=null},n}(TransformableObject,editor,ZWJSONUtils),TransformHandler=function(e,t){"use strict";var i={},n=null,o=1,r=null,a=function(t,i,r){var a=n;if(!a){var s=T(t);a=new s(i,r),a.setType(t),a.xform=new XFormMap,a.xform.putOp(e.build([{r:a.idx},{as:{start:{type:t}}},{r:1},{as:{end:["type"]}}]),o),a.stateId=editor.doc.model.getApplyToSequence()}return a},s=function(e,t,i){var o=i.doubleClick||!1,r=n&&n.isCropAllowed(),a=n&&F();o&&r?(n.isCropActive=!0,n.drawCropRect(),PubSub.publish("TransformableObject/Crop/Active",n)):o&&a?PubSub.publish("TransformableObject/Widget/Active",n.getWidgetParent()):n==e?c(t):(n=e,m(n),n.drawResizeRect(),i.fromEvent||c(t),PubSub.publish("TransformableObject/Created",n))},l=function(e,t){n.onElementMove(e,t),r="move"},d=function(e){r=null,n.onElementUp(e)},c=function(e){n.onElementDown(e)},u=function(e,t){n.id==e&&n.cropContentDown(t)},p=function(e,t){n.id==e&&n.cropContentMove(t)},g=function(e){n.id==e&&(n.cropContentUp(),PubSub.publish("TransformableObject/Crop/MouseUp",n))},f=function(e,t){n&&n.id==t&&(n.isCropActive&&(n.removeCrop(),n.isCropActive=!1,PubSub.publish("TransformableObject/Crop/Remove",n)),n.onDestroy(),PubSub.publish("TransformableObject/destroyed",t),h(n),n=null)},E=function(e){i=e},T=function(e){var n=i[e].prototype;return t.getAsFunction(n).fn},m=function(e){e.on("Resize/UpdateRect",TransformDOMHandler.updateRect),e.on("Resize/AfterApply",TransformDOMHandler.afterApply),e.on("Resize/RemoveRect",TransformDOMHandler.removeResizeDiv),e.on("Transform/DummyAdded",TransformDOMHandler.addDummyImage),e.on("Transform/DummyRemoved",TransformDOMHandler.removeDummyImage),e.on("Crop/RemoveRect",TransformDOMHandler.removeCrop),e.on("ConstructRect",TransformDOMHandler.drawRect),e.on("Crop/HoldPlace",TransformDOMHandler.addPlaceHolder)},h=function(e){e.off("Resize/UpdateRect",TransformDOMHandler.updateRect),e.off("Resize/AfterApply",TransformDOMHandler.afterApply),e.off("Resize/RemoveRect",TransformDOMHandler.removeResizeDiv),e.off("Transform/DummyAdded",TransformDOMHandler.addDummyImage),e.off("Transform/DummyRemoved",TransformDOMHandler.removeDummyImage),e.off("Crop/RemoveRect",TransformDOMHandler.removeCrop),e.off("ConstructRect",TransformDOMHandler.drawRect),e.off("Crop/HoldPlace",TransformDOMHandler.addPlaceHolder)},I=function(e,t,i){r="resize",n.onCornerDown(e,t,i)},_=function(e,t){n.onCornerMove(e,t)},A=function(e,t,i){n.onCropCornerDown(e,t,i)},S=function(e){n.onCropCornerMove(e)},R=function(e){n.onCropCornerUp(e),PubSub.publish("TransformableObject/Crop/MouseUp",n)},O=function(){r="rotate",n.onRotationDown()},b=function(e){n.onRotationMove(e)},v=function(e){r=null;var t=n.xform.getOp(o).docOps[0].retain_count,i=TransformableObjectUtils.getIdFromIdx(t);i&&n&&i==n.id?(n.idx=t,n.onMouseUp(e)):destroyResizeGrid()},D=function(e){return!!DocLayoutManager.getViewContainingResizeObjectAtIndex(e.getIdx())},L=function(e){try{if(n.isCropActive&&(n.removeCrop(),PubSub.publish("TransformableObject/Crop/Remove",n)),TransformDOMHandler.removeResizeDiv(n.id,e),!D(n))return;n.id=e,TransformDOMHandler.updateIdx(n.getIdx()),n.isCropActive?(n.drawCropRect(),PubSub.publish("TransformableObject/Crop/Active",n)):(n.drawResizeRect(),PubSub.publish("TransformableObject/Resize/Active",n)),PubSub.publish("TransformableObject/Reconstructed",n)}catch(e){}},N=function(){var t=arguments[1];if(n){var i=editor.doc.model.getApplyToSequence();if(i==n.stateId)return;n.stateId=i,n.xform.applyOp(t);var a=n.xform.getOp(o).docOps[0].retain_count,s=n.id;if(t.cursor[0]&&t.cursor[0].selectObject){var l=n.getType();a=t.cursor[0].start,s=TransformableObjectUtils.getIdFromIdx(a),n.xform.putOp(e.build([{r:a},{as:{start:{type:l}}},{r:1},{as:{end:["type"]}}]),o);editor.doc.createRange(a,a);n.setObjectActive(!0)}var d=TransformableObjectUtils.getIdFromIdx(a);d&&d==s?(n.idx=a,r||L(s)):f(n.getType(),n.id)}},P=function(){if(n){var e=n.xform.getOp(o).docOps[0].retain_count,t=n.id,i=TransformableObjectUtils.getIdFromIdx(e);i&&i==t&&(r||L(t))}},C=function(){n&&n.setObjectActive(!1)},y=function(){var e={};return e.type=null,e.action=null,e.isCropActive=!1,e.offset=null,n&&n.isObjectActive()&&(e.type=n.getType(),e.action=n.action,e.isCropActive=n.isCropActive,e.offset=n.getActualOffset()),e},F=function(){return n&&n.isWidget()},M=function(){return n&&n.isContextAllowedInsideElement()},w=function(e){return n&&n.isActiveIdx(e)},U=function(e){return n&&n.shouldHideCursor(e)},x=function(){n&&(n.isCropActive=!1,n.removeCrop(),PubSub.publish("TransformableObject/Crop/Remove",n),L(n.id))},B=function(){n&&n.isCropAllowed()&&(n.isCropActive=!0,n.drawCropRect(),PubSub.publish("TransformableObject/Crop/Active",n))},H=function(e){return n&&n.isEvOnCurrentObject(e)};return PubSub.subscribe("DocOperation/CommandComplete",N),PubSub.subscribe("Document/Pagination/Complete",P),PubSub.subscribe("TransformableObject/Selected",s),PubSub.subscribe("TransformableObject/Deselected",f),PubSub.subscribe("TransformableObject/MouseDown",c),PubSub.subscribe("TransformableObject/MouseUp",d),PubSub.subscribe("TransformableObject/MouseMove",l),PubSub.subscribe("TransformableObject/CropMouseDown",u),PubSub.subscribe("TransformableObject/CropMouseMove",p),PubSub.subscribe("TransformableObject/CropMouseUp",g),{construct:s,showCrop:B,removeCrop:x,loadConfig:E,onCornerDown:I,onCornerMove:_,onMouseUp:v,onRotationDown:O,onRotationMove:b,onCropCornerDown:A,onCropCornerMove:S,onCropCornerUp:R,onCommandComplete:N,getCurrentObjectInfo:y,getObject:a,deactivateObject:C,isWidgetSelected:F,isContextAllowedInsideElement:M,isActiveIdx:w,shouldHideCursor:U,isEvOnCurrentObject:H,reconstructRect:L}}(DocOpBuilder,Utils),TransformationsConfig={textbox:{prototype:"TransformableTextBoxObject",uiPrototype:"TransformableTextBoxUIObject",selection:"TextBox/Selected"},image:{prototype:"TransformableImageObject",uiPrototype:"TransformableImageUIObject",selection:"Image/Selected"},field:{prototype:"TransformableFieldObject",uiPrototype:"TransformableFieldUIObject",selection:"Field/Selected"},hr:{prototype:"TransformableHrObject",uiPrototype:"TransformableHrUIObject",selection:"Hr/Selected"},shape:{prototype:"TransformableShapeObject",uiPrototype:"ShapeTransformableUIObject",selection:"Shape/Selected"}};TransformHandler.loadConfig(TransformationsConfig),TransformEventHandler.loadConfig(TransformationsConfig);var TransformDOMHandler=function(e,t,i,n){"use strict";var o=null,r=null,a=null,s=null,l=null,d=null,c=function(e,t,i){var n=ZWJSONUtils.clone(e);e.hasOwnProperty("cropData")&&(u(e.cropData,t,i),p(e.cropData,t,i)),e.hasOwnProperty("resizeData")&&T(e.resizeData,t,i),PubSub.publish("ResizeDiv/Constructed",n)},u=function(e,t,i){var o=n.getElementById("cropGridSVG");o&&W(o).remove();var r=Handlebars.compile(n.getElementById("img-crop-resize-svg").innerHTML),s=J(r())[0],l=t.getSectionType();NOTE_SECTIONS.contains(l)&&(l=SECTION_TYPES.CONTENT);var c=DomViewManager.getDOMObj(i),u=c.getWrapper(l);l==SECTION_TYPES.CONTENT?(s.style.top="0px",s.style.left="0px"):l==SECTION_TYPES.HEADER?(s.style.top=i.getHeaderHeight()+"px",s.style.left=i.getContentLeft()+"px"):(s.style.top=-i.getContentContainerHeight()+"px",s.style.left=i.getContentLeft()+"px"),s.style.zIndex=e.zindex,W(s).appendTo(u),d=s.children[0],d.style.top=-i.getHeaderHeight()+"px",d.style.left=-i.getContentLeft()+"px";var p=i.getDOMViewHeight();d.setAttribute("height",p),d.setAttribute("width",window.innerWidth-editor.jeditorPane.offset().left),a=d.createSVGPoint(),C.bindEvents(),g(e,t,i)},p=function(e,t,i){var n=e.bgData,o=l.getCropBg(n,e.angle),r=W(o);r.insertBefore(d.parentElement);var a=DomViewManager.getDOMObj(i),s=t.getSectionType();NOTE_SECTIONS.contains(s)&&(s=SECTION_TYPES.CONTENT);var c=a.getWrapper(s),u=J(c).offset(),p=editor.jeditorPane.offset();n.offset.x=n.offset.x*editor.zoomFactor+p.left,n.offset.y=n.offset.y*editor.zoomFactor+p.top,n.offset.x=(n.offset.x-u.left)/editor.zoomFactor,n.offset.y=(n.offset.y-u.top)/editor.zoomFactor;var g={top:n.offset.y+"px",left:n.offset.x+"px",position:"absolute"};r.css(g)},g=function(e,t,i){var n=DomViewManager.getDOMObj(i),o=t.getSectionType();NOTE_SECTIONS.contains(o)&&(o=SECTION_TYPES.CONTENT);var r=n.getWrapper(o),a=J(r).offset(),s=e.gridData,l=editor.jeditorPane.offset();s.offset.x=s.offset.x*editor.zoomFactor+l.left,s.offset.y=s.offset.y*editor.zoomFactor+l.top,s.offset.x=(s.offset.x-a.left)/editor.zoomFactor,s.offset.y=(s.offset.y-a.top)/editor.zoomFactor,o==SECTION_TYPES.CONTENT?(s.offset.y=s.offset.y+i.getHeaderHeight(),s.offset.x=s.offset.x+i.getContentLeft()):o==SECTION_TYPES.FOOTER&&(s.offset.y=s.offset.y+i.getHeaderHeight()+i.getContentContainerHeight());var c=d.querySelector("#mainRect"),u={x:s.offset.x,y:s.offset.y,width:s.width,height:s.height};W(c).attr(u),c.style.display="block",0!=e.angle&&f(e),E(s)},f=function(e){for(var t=e.angle,i=e.gridData,n=i.offset.x+i.width/2,o=i.offset.y+i.height/2,r=d.querySelectorAll(".rect"),a=0,s=r.length;a<s;a++)r[a].setAttribute("transform","rotate("+t+" "+n+" "+o+")");var l=d.querySelector("#mainRect");l.setAttribute("transform","rotate("+t+" "+n+" "+o+")")},E=function(e){for(var t={northWestRect:" v 18 h 4 v -14 h 14  v -4 h -14 z",northEastRect:" h 18 v 18 h -4 v -14 h -14 v -4 z",southWestRect:" h 18 v -4 h -14 v -14  h -4 v 14 z",southEastRect:" v -18 h -4 v 14 h -14  v 4 h 18 z"},i=18,n=4,o=10.5,r=function(){return{d:"M "+e.offset.x+" "+e.offset.y+t.northWestRect}},a=function(){return{d:"M "+(e.width+e.offset.x-i)+" "+e.offset.y+t.northEastRect}},s=function(){return{x:e.width/2+e.offset.x-o,y:e.offset.y}},l=function(){return{x:e.offset.x,y:e.offset.y+e.height/2-o}},d=function(){return{x:e.width+e.offset.x-n,y:e.offset.y+e.height/2-o}},c=function(){return{d:"M "+e.offset.x+" "+(e.offset.y+e.height)+t.southWestRect}},u=function(){return{d:"M "+(e.width+e.offset.x)+" "+(e.offset.y+e.height)+t.southEastRect}},p=function(){return{x:e.width/2+e.offset.x-o,y:e.offset.y+e.height-n}},g=["#northWestRect","#northEastRect","#northRect","#westRect","#eastRect","#southWestRect","#southEastRect","#southRect"],f=[r,a,s,l,d,c,u,p],E=0,T=g.length;E<T;E++){var m=g[E],h=f[E]();W.get(m).attr(h)}},T=function(e,t,i){var o,r,a;r=e.width,a=e.height;var s=e.zindex||5,l=DomViewManager.getDOMObj(i),d=t.getSectionType();META_SECTIONS.contains(d)&&(d=NOTE_SECTIONS.contains(d)?SECTION_TYPES.CONTENT:t.getRootSectionType());var c=l.getWrapper(d),u=J(c).offset().left,p=u/editor.zoomFactor-25,g=0;if(n.getElementById("ResizeGrid")){var f=n.getElementById("ResizeGrid");J(f).remove()}var E=-i.getSectionContainerTop(t.getSectionType()),T=J(n.createElement("div")).attr("id","ResizeGrid").css({top:E,left:-p,position:"absolute","pointer-events":"none","z-index":s}).appendTo(c);m(e,T,r,a,g,o||0,i)},m=function(e,t,i,a,l,d,c){var u,p=J(n).width(),g=e.offset.x+(d>i?d:i),f=p>g?(p-50)/editor.zoomFactor:g/editor.zoomFactor,E=c.getDOMViewHeight(),T=Handlebars.compile(J("#img-resize-svg").html()),m=T();u=J(m).css({height:E,width:f}),t.append(u),o=t[0].getElementsByTagName("svg")[0],r=o.createSVGPoint(),s=o.querySelector("rect"),h(e,i,a,l)},h=function(e,t,i,n){var o=J("#ResizeGrid").offset(),r={},a=editor.jeditorPane.offset();e&&(r=ZWJSONUtils.clone(e.offset),r.x=r.x*editor.zoomFactor+a.left,r.y=r.y*editor.zoomFactor+a.top);var l=(r.x-o.left)/editor.zoomFactor,d=(r.y-o.top)/editor.zoomFactor;s.setAttribute("x",l),s.setAttribute("y",d),s.setAttribute("width",e.width),s.setAttribute("height",e.height),e.offset.x=l,e.offset.y=d,I(e),0!=e.angle&&_(e),A(e),P.bindEvents()},I=function(e){var t=o.querySelector("path.rotationObject"),i=o.querySelector("circle.rotationObject");if(!e.isRotatable)return t.style.display="none",void(i.style.display="none");var n=Number(e.offset.x),r=Number(e.offset.y),a=Number(e.width),s=n+a/2,l="M"+s+","+r+" L"+s+" "+(r-20);t.setAttribute("d",l),i.setAttribute("cx",s),i.setAttribute("cy",r-20)},_=function(e){for(var t=e.angle,i=e.offset.x+e.width/2,n=e.offset.y+e.height/2,r=o.querySelectorAll(".rotationObject"),a=0,s=r.length;a<s;++a)r[a].setAttribute("transform","rotate("+t+" "+i+" "+n+")")},A=function(e){for(var t,i=[".NorthCircle",".NorthEastCircle",".EastCircle",".SouthEastCircle",".SouthCircle",".SouthWestCircle",".WestCircle",".NorthWestCircle"],n=[S,D,R,L,O,N,b,v],r=0,a=i.length;r<a;r++){var s=o.querySelector(i[r]);s&&(t=n[r](e),s.setAttribute("x",t.x-3.5),s.setAttribute("y",t.y-3.5))}},S=function(e){return r.x=e.offset.x+e.width/2,r.y=e.offset.y,r.matrixTransform(s.getCTM(o))},R=function(e){return r.x=e.offset.x+e.width,r.y=e.offset.y+e.height/2,r.matrixTransform(s.getCTM(o))},O=function(e){return r.x=e.offset.x+e.width/2,r.y=e.offset.y+e.height,r.matrixTransform(s.getCTM(o))},b=function(e){return r.x=e.offset.x,r.y=e.offset.y+e.height/2,r.matrixTransform(s.getCTM(o))},v=function(e){return r.x=e.offset.x,r.y=e.offset.y,r.matrixTransform(s.getCTM(o))},D=function(e){return r.x=e.offset.x+e.width,r.y=e.offset.y,r.matrixTransform(s.getCTM(o))},L=function(e){return r.x=e.offset.x+e.width,r.y=e.offset.y+e.height,r.matrixTransform(s.getCTM(o))},N=function(e){return r.x=e.offset.x,r.y=e.offset.y+e.height,r.matrixTransform(s.getCTM(o))},P=function(){var e=function(){var e=function(e){TransformHandler.onRotationDown();var t=function(e,o,r,a){function l(){PubSub.unsubscribe("EventDiv/Move",n),PubSub.unsubscribe("EventDiv/Up",t),i()}l();var d={},d=J(s).offset();TransformHandler.onMouseUp(d)},n=function(e){var t=y(e);TransformHandler.onRotationMove(t),DomUtil.stopEvent(e)};PubSub.subscribe("EventDiv/Move",n),PubSub.subscribe("EventDiv/Up",t)},t=function(){PubSub.subscribe("Rotation/Down",e)},n=function(){PubSub.unsubscribe("Rotation/Down",e)};return{unbindEvent:n,init:t}}(),t=function(){var e=function(e,t,n){var o=y(e),a=J("#ResizeGrid").offset(),l=editor.jeditorPane.offset();t.x=t.x*editor.zoomFactor+l.left,t.y=t.y*editor.zoomFactor+l.top;var d={x:(t.x-a.left)/editor.zoomFactor,y:(t.y-a.top)/editor.zoomFactor};TransformHandler.onCornerDown(n,d,o);var c=function(e,t,n,o){function r(){PubSub.unsubscribe("EventDiv/Move",u),PubSub.unsubscribe("EventDiv/Up",c),i()}r();var a={},a=J(s).offset();TransformHandler.onMouseUp(a)},u=function(e){var t=y(e);r.x=t.x-o.x,r.y=t.y-o.y;var i=d.x+r.x,n=d.y+r.y,a=Y(s,i,n);TransformHandler.onCornerMove(a,t),DomUtil.stopEvent(e)};PubSub.subscribe("EventDiv/Up",c),PubSub.subscribe("EventDiv/Move",u)},t=function(){PubSub.subscribe("Corner/Down",e)},n=function(){PubSub.unsubscribe("Corner/Down",e)};return{unbindEvent:n,init:t}}(),i=function(){e.unbindEvent(),t.unbindEvent()},n=function(){e.init(),t.init()};return{bindEvents:n,unbindDownEvents:i}}(),C=function(){var e=function(){var e=function(e,i,n){a.x=e.clientX,a.y=e.clientY;var o=a.matrixTransform(d.getScreenCTM().inverse());TransformHandler.onCropCornerDown(n,o);var r=e.target,s=function(e){a.x=e.clientX,a.y=e.clientY;var t=a.matrixTransform(d.getScreenCTM().inverse());a.x=t.x-o.x,a.y=t.y-o.y;var i=r.getCTM(d).inverse();i.e=i.f=0,a=a.matrixTransform(i),TransformHandler.onCropCornerMove(a)},l=function(){function e(){PubSub.unsubscribe("EventDiv/Move",s),PubSub.unsubscribe("EventDiv/Up",l),t()}e();var i=J("#mainRect").offset();TransformHandler.onCropCornerUp(i)};PubSub.subscribe("EventDiv/Move",s),PubSub.subscribe("EventDiv/Up",l)},i=function(){PubSub.subscribe("CropCorner/Down",e)},n=function(){PubSub.unsubscribe("CropCorner/Down",e)};return{unbindEvent:n,init:i}}(),t=function(){e.unbindEvent()},i=function(){e.init()};return{bindEvents:i,unbindDownEvents:t}}(),y=function(e){return r.x=e.clientX,r.y=e.clientY,r.matrixTransform(o.getScreenCTM().inverse())},F=function(e){switch(e){case"resized":var t=o.getElementById("resize_tooltip"),i=o.getElementById("resize_tooltip_bg");t.setAttributeNS(null,"visibility","hidden"),i.setAttributeNS(null,"visibility","hidden");break;case"rotated":var t=o.getElementById("tooltip"),i=o.getElementById("tooltip_bg");t.setAttributeNS(null,"visibility","hidden"),i.setAttributeNS(null,"visibility","hidden");break;case"move":}},M=function(e,t){var i=J("#ResizeGrid");i.get(0)&&i.remove(),PubSub.publish("ResizeDiv/Destroyed",e,t),P.unbindDownEvents()},w=function(e){if(d){var t=W(d.parentElement||d.parentNode);t[0]&&t.remove()}l.destroyCropBgImg(),PubSub.publish("CropDiv/Destroyed",e),C.unbindDownEvents()},U=function(){W.get("#ResizeGrid").hide()},x=function(){W.get("#ResizeGrid").show()},B=function(e){e&&(s.setAttribute("height",e.height),s.setAttribute("width",e.width),s.setAttribute("x",e.offset.x),s.setAttribute("y",e.offset.y))},H=function(e,t,i){l.updateBgImg(t,i,e),l.updateFgImgOnBgMove(t,i,e)},G=function(e,t,i){0!=e.angle&&f(e),l.updateFgImgOnFgMove(t,i,e)},k=function(e){var t=l.getContainingSectionType(),i=l.getParentEl(),n=l.getPageEl(),o=J(i).offset(),r=editor.jeditorPane.offset(),a=e.cropData.gridData;a.offset.x=a.offset.x*editor.zoomFactor+r.left,a.offset.y=a.offset.y*editor.zoomFactor+r.top,a.offset.x=(a.offset.x-o.left)/editor.zoomFactor,a.offset.y=(a.offset.y-o.top)/editor.zoomFactor,t==SECTION_TYPES.CONTENT?(a.offset.y=a.offset.y+n.getHeaderHeight(),a.offset.x=a.offset.x+n.getContentLeft()):t==SECTION_TYPES.FOOTER&&(a.offset.y=a.offset.y+n.getHeaderHeight()+n.getContentHeight());var s=d.querySelector("#mainRect"),c={x:a.offset.x,y:a.offset.y,width:a.width,height:a.height};W(s).attr(c),s.style.display="block",E(a)},Y=function(e,t,i){return r.x=t,r.y=i,r.matrixTransform(e.getCTM(o).inverse())},z=function(e,t,i){switch(t){case"resized":B(e.resizeData),I(e.resizeData);var n=o.getElementById("resize_tooltip"),r=o.getElementById("resize_tooltip_bg");n.setAttributeNS(null,"x",i.x+25),n.setAttributeNS(null,"y",i.y+29);var a=e.resizeData.width,s=e.resizeData.height;n.firstChild.data=Math.round(a)+" x "+Math.round(s),r.setAttributeNS(null,"x",i.x+15),r.setAttributeNS(null,"y",i.y+15),n.setAttributeNS(null,"visibility","visible"),r.setAttributeNS(null,"visibility","visible"),A(e.resizeData);break;case"rotated":_(e.resizeData);var n=o.getElementById("tooltip");n.setAttributeNS(null,"x",i.x+25),n.setAttributeNS(null,"y",i.y+29),n.firstChild.data="rotate : "+e.resizeData.angle+"°",n.setAttributeNS(null,"visibility","visible");var r=o.getElementById("tooltip_bg");r.setAttributeNS(null,"x",i.x+15),r.setAttributeNS(null,"y",i.y+15),r.setAttributeNS(null,"visibility","visible"),A(e.resizeData);break;case"move":l.changeDummyPosition(e);break;case"cropped":k(e);break;case"cropFgMove":k(e),G(e.cropData,e.deltaX,e.deltaY);break;case"cropBgMove":H(e.cropData,e.deltaX,e.deltaY)}},Z=function(e){var t=e.getType(),i=e.getIdx(),n=TransformationsConfig[t].uiPrototype,o=Utils.getAsFunction(n).fn;l=new o(i)},V=function(e,t){l&&l.addPlaceHolder(e,t)},j=function(e){l&&(l.onDestroy(),l=null)},X=function(){l&&l.addDummy()},K=function(){l&&l.removeDummy()},q=function(e){l&&l.updateIdx(e)},Q=function(e){var t={};if(t.x=e.x,t.y=e.y,l){var i=l.getContainingSectionType(),n=l.getParentEl(),o=l.getPageEl(),r=J(n).offset(),a=editor.jeditorPane.offset();return i==SECTION_TYPES.CONTENT?(t.y=t.y-o.getHeaderHeight(),t.x=t.x-o.getContentLeft()):i==SECTION_TYPES.FOOTER&&(t.y=t.y-(o.getHeaderHeight()+o.getContentHeight())),t.x=t.x*editor.zoomFactor+r.left,t.y=t.y*editor.zoomFactor+r.top,t.x=(t.x-a.left)/editor.zoomFactor,t.y=(t.y-a.top)/editor.zoomFactor,t}};return PubSub.subscribe("TransformableObject/Created",Z),PubSub.subscribe("TransformableObject/destroyed",j),PubSub.subscribe("Resize/hide",U),PubSub.subscribe("Resize/show",x),{removeResizeDiv:M,removeCrop:w,setResizeDiv:T,updateRect:z,afterApply:F,addDummyImage:X,removeDummyImage:K,updateIdx:q,addPlaceHolder:V,drawRect:c,getActualCropCoord:Q}}(SVGTransform,PUtil,CurUtil,document),TransformableTextBoxUIObject=function(e){"use strict";function t(t){e.call(this,t)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.addDummy=function(){var e=DocLayoutManager.getSectionViews(this.id)[0],t=DomViewManager.getDOMObj(e.getPage()),i=t.getRenderedDOM(e),n=J(i).clone(),o={position:"absolute",top:0,left:0,opacity:"0.6","z-index":"100",display:"none"};n.css(o),this.top=parseInt(i.style.top)||0,this.left=parseInt(i.style.left)||0,n[0].setAttribute("id","dummyDragTextBox"),J(i).parent().prepend(n)},t.prototype.changeDummyPosition=function(e){var t=J("#dummyDragTextBox");t.css({top:this.top+e.deltaY,left:this.left+e.deltaX}),t.css("display","block")},t.prototype.removeDummy=function(){var e=J("#dummyDragTextBox");e.remove()},t}(TransformableUIObject),TransformableFieldUIObject=function(e){"use strict";function t(t){e.call(this,t)}return t.prototype=Object.create(e.prototype),t.prototype.addDummy=function(){var e=HF_SECTIONS.contains(DocTreeManager.getSectionAtIndex(this.idx).getSectionType()),t=editor.doc.getRawFormatAt(this.idx),i=null,n=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage();if(DTUtils.isNonWrappingFloatImage(t))i=W(DomViewManager.getDOMElem(n)).find("div.float-image-container");else if(e){var o=DomViewManager.getDOMObj(n),r=o.getRenderedDOM(DocLayoutManager.getViewAtIndex(this.idx));i=W(r)}else i=W(DomViewManager.getDOMObj(n).contentWrapper);var a=i.find("[data-field-id='"+this.id+"']")[0],r=J(a).parents("span.zw-portion, div.zw-float")[0],s=J(r).clone(),l={position:"absolute",top:0,left:0,opacity:"0.6","z-index":"100",display:"none"};s.css(l),this.top=parseInt(r.style.top)||0,this.left=parseInt(r.style.left)||0,s[0].setAttribute("id","dummyDragImage"),J(r).parent().prepend(s)},t.prototype.changeDummyPosition=function(e){var t=J("#dummyDragImage");t.css({top:this.top+e.deltaY,left:this.left+e.deltaX}),t.css("display","block")},t.prototype.onDestroy=function(){this.idx=null},t.prototype.removeDummy=function(){var e=J("#dummyDragImage");e.remove()},t}(TransformableUIObject),TransformableImageUIObject=function(e){"use strict";function t(t){var i=editor.doc.getRawFormatAt(t);i&&i.type==NODE_TYPE.SIGNERFIELD&&(t+=1),e.call(this,t)}function i(){var e=editor.doc.getRawFormatAt(this.idx),t=HF_SECTIONS.contains(DocTreeManager.getSectionAtIndex(this.idx).getSectionType()),i=null,n=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),o=!1,r=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,this.idx);if(r){var a=r.getRangeIndex(),s=editor.doc.getRawFormatAt(a);o=s&&DTUtils.isNonWrappingFloatImage(s)}if(DTUtils.isNonWrappingFloatImage(e)||o)i=W(DomViewManager.getDOMElem(n)).find("div.float-image-container");else if(t){var l=DomViewManager.getDOMObj(n),d=l.getRenderedDOM(DocLayoutManager.getViewAtIndex(this.idx));i=W(d)}else i=W(DomViewManager.getDOMObj(n).contentWrapper);var c=i.find("[id='"+this.id+"']")[0];return c}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.addDummy=function(){var e=i.call(this),t=J(e).parents("span.zw-portion, div.zw-float")[0],n=J(t).clone(),o={position:"absolute",top:0,left:0,opacity:"0.6","z-index":"100",display:"none"};n.css(o),this.top=parseInt(t.style.top)||0,this.left=parseInt(t.style.left)||0,n[0].setAttribute("id","dummyDragImage"),J(t).parent().prepend(n)},t.prototype.changeDummyPosition=function(e){var t=J("#dummyDragImage");t.css({top:this.top+e.deltaY,left:this.left+e.deltaX}),t.css("display","block")},t.prototype.addPlaceHolder=function(e,t){var n=i.call(this),o=J(n).parents("span.zw-portion")[0],r=n.parentElement||n.parentNode,a=r.parentElement||r.parentNode,s={position:"relative",width:e+"px",height:t+"px"};W(o).css(s),s={position:"absolute"},W(a).css(s)},t.prototype.getParentEl=function(){var e=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),t=DomViewManager.getDOMObj(e),i=this.getContainingSectionType();return NOTE_SECTIONS.contains(i)&&(i=SECTION_TYPES.CONTENT),t.getWrapper(i)},t.prototype.getPageEl=function(){return DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage()},t.prototype.getCropBg=function(e,t){var i,n=W.get("#bgImgOuterDiv")[0];if(n)i=n;else{var o=editor.doc.getRawFormatAt(this.idx),r=Handlebars.compile(document.getElementById("dummy-image-div").innerHTML),a=J(r())[0],s=a.children[0],l=s.firstElementChild,d={width:e.width,height:e.height};if(o.hasOwnProperty(ATTR_IMAGE.I_SRC)){var c=DomUtil.processImgSrc(o[ATTR_IMAGE.I_SRC]);d["xlink:href"]=c}W(l).attr(d),a.style.zIndex=5;var u=o[ATTR_IMAGE.I_ROTATE]||0,p=DocTreeManager.getSectionAtIndex(this.idx);if(p.getSectionType()==SECTION_TYPES.TEXTBOX){var g=p.getRangeIndex(),f=editor.doc.getRawFormatAt(g);u+=f.rotation||0,u%=360}u&&0!=u&&(a.style.transform="rotate("+u+"deg)"),W(a).attr({width:e.width+"px",height:e.height+"px"}),W(s).attr({width:e.width+"px",height:e.height+"px",marginTop:"0px",marginLeft:"0px"}),i=a}return i},t.prototype.updateBgImg=function(e,t){var i=W.get("#bgImgOuterDiv"),n={marginTop:t+"px",marginLeft:e+"px"};i.css(n)},t.prototype.updateFgImgOnFgMove=function(e,t,n){var o=editor.doc.getRawFormatAt(this.idx),r=i.call(this),a=r.parentElement||r.parentNode,s=a.parentElement||a.parentNode,l=0,d=0;DTUtils.isWrappingFloatImage(o)&&(l=o[ATTR_IMAGE.I_ML]?o[ATTR_IMAGE.I_ML].convertor().pixels:0,d=o[ATTR_IMAGE.I_MT]?o[ATTR_IMAGE.I_MT].convertor().pixels:0);var c=l+e,u=d+t,p={marginLeft:c+"px",marginTop:u+"px"};W(s).css(p);var g=DocTreeManager.getSectionAtIndex(this.idx);if(g.getSectionType()==SECTION_TYPES.TEXTBOX){var f=g.getRangeIndex(),E=editor.doc.getRawFormatAt(f),T=E.rotation||0,m={x:0,y:0},h={x:e,y:t},I=TransformationUtils.rotate(h,-T,m);e=I.x,t=I.y}this.updateFgImgOnBgMove(-e,-t,n)},t.prototype.updateFgImgOnBgMove=function(e,t,n){var o=n.angle||0,r={x:0,y:0},a={x:e,y:t},s=TransformationUtils.rotate(a,o,r),l=0,d=0,c=editor.doc.getRawFormatAt(this.idx);if(c.hasOwnProperty(ATTR_IMAGE.I_CROPRECT)){var u=c[ATTR_IMAGE.I_CROPRECT],p=0,g=0;if("%"==c[ATTR_IMAGE.I_WID_UN])p=DocLayoutManager.getCurrentColumn().getWidth(),g=c[ATTR_IMAGE.I_ORGINALHT]*p/c[ATTR_IMAGE.I_ORGINALWID];else{var f=ZWImageUtils.getOrginalHeighWidthOfImage(c);p=f.wid,g=f.ht}u=ZWImageUtils.convertCropDataToPixel(u,g,p),l=-u.cropLeft,d=-u.cropTop}var E=l+s.x,T=d+s.y,m={marginLeft:E,marginTop:T},h=i.call(this),I=h.parentElement||h.parentNode;W(I).css(m)},t.prototype.destroyCropBgImg=function(){var e=W.get("#bgImgOuterDiv");e.remove()},t.prototype.removeDummy=function(){var e=J("#dummyDragImage");e.remove()},t}(TransformableUIObject),TransformableHrUIObject=function(e){"use strict";function t(t){e.call(this,t)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(TransformableUIObject),TransformableShapeObject=function(){"use strict";function e(e){var t=editor.doc.getRawFormatAt(e);t&&t.type==NODE_TYPE.SIGNERFIELD&&(e+=1),TransformableObject.call(this,e)}function t(){var e=!1,t=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,this.idx);if(t){var i=t.getRangeIndex(),n=editor.doc.getRawFormatAt(i);e=n&&DTUtils.isNonWrappingFloatImage(n)}return e}function i(e){var t,i=editor.doc.getRawFormatAt(this.idx),n={},o=e.find("[id='"+i.id+"']")[0],r=DocTreeManager.getSectionAtIndex(this.idx);return t=r.getSectionType()!=SECTION_TYPES.TEXTBOX?J(o).parents("span.zw-portion, div.zw-float"):J(o).parents("div.fgImgOuterDiv"),n=J(t).offset()}var n="currentData",o="initialData",r="cropData",a="gridData",s="resizeData",l="distanceFromEdges",d="offset",c="resizeRotLeftDiff",u="resizeRotTopDiff",p="deltaX",g="deltaY",f="cropTop",E="cropLeft",T="cropBottom",m="cropRight",h={NONE:{value:0},NORTH:{value:1},NORTHEAST:{value:2},EAST:{value:3},SOUTHEAST:{value:4},SOUTH:{value:5},SOUTHWEST:{value:6},WEST:{value:7},NORTHWEST:{value:8}};e.prototype=Object.create(TransformableObject.prototype),e.prototype.constructor=e,e.prototype.onElementDown=function(e){(e.clientX||e.clientY)&&(this.isCropActive?(PubSub.publish("Resize/hide"),this.action="cropBgMove"):this.action="move",this.downCoord={x:e.clientX,y:e.clientY})},e.prototype.onElementMove=function(e,t){var i=editor.doc.getRawFormatAt(this.idx);if(this.isCropActive){var s={x:e.clientX,y:e.clientY},d=(s.x-this.downCoord.x)/editor.zoomFactor,c=(s.y-this.downCoord.y)/editor.zoomFactor,i=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx)),u=d,h=c;if(i.hasOwnProperty(ATTR_IMAGE.I_ROTATE)){var I={x:0,y:0},_={x:d,y:c},A=TransformationUtils.rotate(_,i[ATTR_IMAGE.I_ROTATE],I);u=A.x,h=A.y}var S=this[n][r],R=S[a],O=S.bgData,b=R.width,v=R.height,D=O.height,L=O.width,N=S[l],P=this[o][r][l];N[f]=P[f]-h,N[E]=P[E]-u,N[m]=L-(b+N[E]),N[T]=D-(v+N[f]),this[n][p]=d,this[n][g]=c,this.trigger("Resize/UpdateRect",this[n],this.action)}else if(this.isFirstMove||(this.isFirstMove=!0,PubSub.publish("Gridlines/show"),DTUtils.isFloatingImage(i)&&this.trigger("Transform/DummyAdded")),DTUtils.isFloatingImage(i)){var s={x:e.clientX,y:e.clientY};this[n][p]=s.x-this.downCoord.x,this[n][g]=s.y-this.downCoord.y,this.trigger("Resize/UpdateRect",this[n],this.action)}else{var C=EventHandler.getIndex(t),y=DocTreeManager.getSectionAtIndex(C).getSectionType(),F=NOTE_SECTIONS.contains(y);F||EventHandler.moveCursor(t)}},e.prototype.onElementUp=function(){PubSub.publish("Gridlines/hide");var e=editor.jeditorPane.offset(),t=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx));if(this.isCropActive){var i=this[o][r][a][d];i.y=i.y*editor.zoomFactor+e.top,i.x=i.x*editor.zoomFactor+e.left,t.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&(i.x=i.x-this[c],i.y=i.y-this[u]),this[o][r][l]=this[n][r][l],this.applyResizedValues()}else if(DTUtils.isFloatingImage(t)){if(this.trigger("Transform/DummyRemoved"),this[n][g]||this[n][p]){var f=this[o][s][d];f.y=f.y*editor.zoomFactor+e.top,f.x=f.x*editor.zoomFactor+e.left,f.y+=this[n][g]*editor.zoomFactor,f.x+=this[n][p]*editor.zoomFactor,t.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&(f.y-=this[u]||0,f.x-=this[c]||0),this.applyResizedValues()}this.trigger("Resize/AfterApply",this.action)}else{var E=this.idx,T=editor.doc.getSelection().getStart();if(T<E||E+1<T){var m=[{r:E},{ds:editor.doc.getCharAt(E)}],h=OpUtil.getInsertionOps(editor.doc.createRange(E,E+1));Op.processMsg(m),Op.cursorProcessed();var I=ZWJSONUtils.clone(h.ops[1].as.start),_=I.id;t.id=_,this.setObjectActive(!1),editor.doc.execCmd("insimg",[t,!0]),this.setObjectActive(!0)}else{var A=editor.doc.createRange(E);editor.doc.getSelection().removeAllRanges().addRange(A)}var S=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");S&&S.css("border-left-style","")}this.action=null,this.isFirstMove=!1},e.prototype.cropContentDown=function(e){(e.clientX||e.clientY)&&(this.action="cropFgMove",this.downCoord={x:e.clientX,y:e.clientY})},e.prototype.cropContentMove=function(e){var t={x:e.clientX,y:e.clientY},i=t.x-this.downCoord.x,s=t.y-this.downCoord.y,c=editor.doc.getRawFormatAt(this.idx),u=i,h=s,I=this[n][r],_=I[a],A=this[o][r][a];if(!(c.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&0!=c[ATTR_IMAGE.I_ROTATE]||DTUtils.isFloatingImage(c)||this.isFirstMove)){var S=A.width+2*A.borderWidth,R=A.height+2*A.borderWidth;this.trigger("Crop/HoldPlace",S,R),this.isFirstMove=!0}_[d].y=A[d].y+s,_[d].x=A[d].x+i;var O=c[ATTR_IMAGE.I_ROTATE]||0,b=DocTreeManager.getSectionAtIndex(this.idx);if(b.getSectionType()==SECTION_TYPES.TEXTBOX){var v=b.getRangeIndex(),D=editor.doc.getRawFormatAt(v),L=D.rotation||0;O+=L,O%=360;var N={x:0,y:0},P={x:i,y:s},C=TransformationUtils.rotate(P,L,N);i=C.x,s=C.y}if(O){var N={x:0,y:0},P={x:i,y:s},C=TransformationUtils.rotate(P,O,N);u=C.x,h=C.y}var y=_.width,F=_.height,M=I.bgData,w=M.height,U=M.width,x=I[l],B=this[o][r][l];x[f]=B[f]+h,x[E]=B[E]+u,x[m]=U-(y+x[E]),x[T]=w-(F+x[f]),this[n][p]=i,this[n][g]=s,this.trigger("Resize/UpdateRect",this[n],this.action)},e.prototype.cropContentUp=function(){var e=this[n];if(e[p]||e[g]){var t=editor.jeditorPane.offset(),i=this[o][r],s=i[a][d];s.y=s.y+e[g],s.x=s.x+e[p],s.y=s.y*editor.zoomFactor+t.top,s.x=s.x*editor.zoomFactor+t.left;var f=this[u]||0,E=this[c]||0;s.x=s.x-E,s.y=s.y-f,i[l]=e[r][l],this.applyResizedValues()}this.action=null,this.isFirstMove=!1},e.prototype.onMouseUp=function(e){PubSub.publish("Gridlines/hide");var t=this[n][s];if(this.isCropActive){var i=this[o][r],p=i[a],g=i[l],I=p[d],_=p.width,A=p.height,S=editor.jeditorPane.offset(),R={};R.top=I.y*editor.zoomFactor+S.top,R.left=I.x*editor.zoomFactor+S.left;var O=this[u]||0,b=this[c]||0;R.left=R.left-b,R.top=R.top-O,I.x=I.x*editor.zoomFactor+S.left,I.y=I.y*editor.zoomFactor+S.top,I.x=I.x-b,I.y=I.y-O,g[E]=R.left-e.left,g[f]=R.top-e.top,g[m]=t.width-(g[E]+_),g[T]=t.height-(g[f]+A)}var v=this[o][s],D=v[d];D.x=e.left,D.y=e.top,v.width=t.width,v.height=t.height,v.angle=t.angle,this.applyResizedValues(),this.trigger("Resize/AfterApply",this.action),this.action=null,this.currentAction=h.NONE,this.currentDirectionValue=h.NONE.VALUE},e.prototype.drawResizeRect=function(){var e=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx));e.hasOwnProperty(TCConstants.TC)&&(e=TcView.updateDOMStyles(e));var r={},a={};a.height=parseFloat(e.ht),a.width=parseFloat(e.wid),a.borderWidth=e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;var l=HF_SECTIONS.contains(DocTreeManager.getSection(this.idx).getSectionType()),p=null,g=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),f=t.call(this);if(DTUtils.isNonWrappingFloatImage(e)||f)p=W(DomViewManager.getDOMElem(g)).find("div.float-image-container");else if(l){var E=DomViewManager.getDOMObj(g),T=E.getRenderedDOM(DocLayoutManager.getViewAtIndex(this.idx));p=W(T)}else p=W(DomViewManager.getDOMObj(g).contentWrapper);var m=i.call(this,p);if(m){var h=editor.jeditorPane.offset(),I=e.shapeData.props.transform;a.angle=I.rotAngle||0;DocTreeManager.getSectionAtIndex(this.idx);if(a.angle){var _=TransformationUtils.getTransformedSize(a.angle,e.wid,e.ht);this[u]=(_.height-e.ht)/2*editor.zoomFactor,this[c]=(_.width-e.wid)/2*editor.zoomFactor,m.top+=this[u],m.left+=this[c]}else this[u]=0,this[c]=0;m.top+=a.borderWidth*editor.zoomFactor,m.left+=a.borderWidth*editor.zoomFactor;var A={};a[d]=A;var S=0,R=0;DTUtils.isWrappingFloatImage(e)&&(S=e[ATTR_IMAGE.I_MT]?e[ATTR_IMAGE.I_MT].convertor().pixels*editor.zoomFactor:0,R=e[ATTR_IMAGE.I_ML]?e[ATTR_IMAGE.I_ML].convertor().pixels*editor.zoomFactor:0),A.x=m.left+R,A.y=m.top+S,A.x=(A.x-h.left)/editor.zoomFactor,A.y=(A.y-h.top)/editor.zoomFactor,r.id=this.id,a.isRotatable=!1,a.zindex=ZINDEX.FLOAT_IMG_FRONT+(e.zindex?e.zindex:0),r[s]=a,this[o]=r,this[n]=ZWJSONUtils.clone(this[o]);var O=editor.doc.getSelection(),b=O&&O.getLastRange();b&&b.setStart(this.idx)&&b.setEnd(b.start),PubSub.publish("Shapes/OpenToolbar",e.shapeData),this.parent=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(this.idx),this.page=g,this.trigger("ConstructRect",this[n],this.parent,this.page)}},e.prototype.drawCropRect=function(){var e=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx));e.hasOwnProperty(TCConstants.TC)&&(e=TcView.updateDOMStyles(e));var p={},g={},h={},I={},_={},A=HF_SECTIONS.contains(DocTreeManager.getSectionAtIndex(this.idx).getSectionType()),S=null,R=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),O=t.call(this);if(DTUtils.isNonWrappingFloatImage(e)||O)S=W(DomViewManager.getDOMElem(R)).find("div.float-image-container");else if(A){var b=DomViewManager.getDOMObj(R),v=b.getRenderedDOM(DocLayoutManager.getViewAtIndex(this.idx));S=W(v)}else S=W(DomViewManager.getDOMObj(R).contentWrapper);var D=i.call(this,S);if(D){var L=editor.jeditorPane.offset(),N=e[ATTR_IMAGE.I_ROTATE]||0,P=DocTreeManager.getSectionAtIndex(this.idx);if(P.getSectionType()==SECTION_TYPES.TEXTBOX){var C=P.getRangeIndex(),y=editor.doc.getRawFormatAt(C);N+=y.rotation||0,N%=360}if(N){var F=TransformationUtils.getTransformedSize(N,e.wid,e.ht);this[u]=(F.height-e.ht)/2*editor.zoomFactor,this[c]=(F.width-e.wid)/2*editor.zoomFactor,D.top+=this[u],D.left+=this[c]}else this[u]=0,this[c]=0;var M=e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;D.top+=M*editor.zoomFactor,D.left+=M*editor.zoomFactor;var w={};I[d]=w;var U=0,x=0;DTUtils.isFloatingImage(e)&&(U=e[ATTR_IMAGE.I_MT]?e[ATTR_IMAGE.I_MT].convertor().pixels*editor.zoomFactor:0,x=e[ATTR_IMAGE.I_ML]?e[ATTR_IMAGE.I_ML].convertor().pixels*editor.zoomFactor:0),w.x=D.left+x,w.y=D.top+U,w.x=(w.x-L.left)/editor.zoomFactor,w.y=(w.y-L.top)/editor.zoomFactor,I.height=parseFloat(e.ht),I.width=parseFloat(e.wid),I.borderWidth=M;var B=e[ATTR_IMAGE.I_CROPRECT],H=ZWImageUtils.getOrginalHeighWidthOfImage(e);h.width=parseFloat(H.wid),h.height=parseFloat(H.ht);var J={};B?J=ZWImageUtils.convertCropDataToPixel(B,H.ht,H.wid):(J[f]=0,J[E]=0,J[m]=0,J[T]=0),D=i.call(this,S);var G=TransformationUtils.getCropOffset(I.width,I.height,J,N,D,editor.zoomFactor);h[d]=G,G.y=G.y+M*editor.zoomFactor,G.x=G.x+M*editor.zoomFactor,G.x=G.x+x,G.y=G.y+U,G.x=(G.x-L.left)/editor.zoomFactor,G.y=(G.y-L.top)/editor.zoomFactor,g.angle=N,g[a]=I,g.bgData=h,g.zindex=ZINDEX.FLOAT_IMG_FRONT+(e.zindex?e.zindex:0),g[l]=J,_=ZWJSONUtils.clone(h),_.angle=N,_.zindex=ZINDEX.FLOAT_IMG_FRONT+(e.zindex?e.zindex:0),_.isRotatable=!1,_.borderWidth=M,p[r]=g,p[s]=_,p.id=this.id,this[o]=p,this[n]=ZWJSONUtils.clone(this[o]),this.parent=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(this.idx),this.page=R,PubSub.publish("Crop/Constructed");var k=editor.doc.getSelection(),Y=k&&k.getLastRange();Y&&Y.setStart(this.idx)&&Y.setEnd(Y.start),this.trigger("ConstructRect",this[n],this.parent,this.page)}},e.prototype.applyResizedValues=function(){var e=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx)),t={};t[ATTR_IMAGE.I_WID_UN]="px",t[ATTR_IMAGE.I_HT_UN]="px";var i,n=this[o][s];t[ATTR_IMAGE.I_WID]=n.width,t[ATTR_IMAGE.I_HT]=n.height,t[ATTR_IMAGE.I_ROTATE]=n.angle;var r=DocTreeManager.getSectionAtIndex(this.idx);if(r.getSectionType()==SECTION_TYPES.TEXTBOX){var a=r.getRangeIndex(),l=editor.doc.getRawFormatAt(a);t[ATTR_IMAGE.I_ROTATE]=t[ATTR_IMAGE.I_ROTATE]-(l.rotation||0),t[ATTR_IMAGE.I_ROTATE]<0&&(t[ATTR_IMAGE.I_ROTATE]=360+t[ATTR_IMAGE.I_ROTATE])}if(e.cls===NODE_TYPE.FILLABLEFIELD)return void PubSub.publish("Document/fillableResize",t);if(e.shapeData.props.transform.dim.height=n.height,e.shapeData.props.transform.dim.width=n.width,t[ATTR_IMAGE.I_SHAPEDATA]=e.shapeData,e.shapeData.dropcapData&&InsertShape.handleDropcapModified(e.shapeData),DTUtils.isFloatingImage(e)){var c=e;extend(c,t);var u=n[d],p={top:u.y,left:u.x};if(this.isCropActive){var g=i[d];p.top=g.y,p.left=g.x}c[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",c[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",ImageActions.moveFloatingImage(p,this.idx,c)}else{var f=editor.doc.getParents(NODE_TYPE.IMAGE,this.idx);editor.doc.execCmd("applyStyle",[f,t,"resizeImage"]);var E=editor.doc.createRange(this.idx,this.idx);editor.doc.getSelection().removeAllRanges().addRange(E)}},e.prototype.removeCrop=function(){this.trigger("Crop/RemoveRect",this.id)};var I=function(e){var t={},i=this[u]||0,n=this[c]||0;return t.x=e.x-n,t.y=e.y-i,t};return e.prototype.getActualOffset=function(){var e=ZWJSONUtils.clone(editor.doc.getRawFormatAt(this.idx));e&&e.hasOwnProperty(TCConstants.TC)&&(e=TcView.updateDOMStyles(e));var t=I.call(this,this[o][s][d]),i=e&&e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;return t.x=t.x-i,t.y=t.y-i,t},e.prototype.getCropOffset=function(){var e=I.call(this,this[o][r][a][d]);return e},e.prototype.getCropWidth=function(){return this[o][r][a].width},e.prototype.isCropAllowed=function(){var e=Macros.isCropAllowed(),t=editor.doc.getRawFormatAt(this.idx),i=t[MAILMERGE.MMINFO]||t[ATTR_FILLABLEFIELD.FF_INFO]&&t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]!==FILLABLEFIELD_TYPE.IMAGE||t.subType==ATTR_WIDGET.WIDGET||t.subType==ATTR_CHART.CHART||t.subType==NODE_TYPE.QRCODE||t.subType==NODE_TYPE.BARCODE;return e&&!i},e.prototype.getWidgetParent=function(){var e,i,n=HF_SECTIONS.contains(DocTreeManager.getSectionAtIndex(this.idx).getSectionType()),o=editor.doc.getRawFormatAt(this.idx),r=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),a=t.call(this);if(DTUtils.isNonWrappingFloatImage(o)||a)i=W(DomViewManager.getDOMElem(r)).find("div.float-image-container");else if(n){var s=DomViewManager.getDOMObj(r),l=s.getRenderedDOM(DocLayoutManager.getViewAtIndex(this.idx));i=W(l)}else i=W(DomViewManager.getDOMObj(r).contentWrapper);var d=i.find("[id='"+o.id+"']")[0];return e=J(d).parents("div.fgImgOuterDiv")[0]},e.prototype.isWidget=function(){var e=this.getWidgetParent();return e&&W(e).hasClass("zw-ifr-div")},e.prototype.isEvOnCurrentObject=function(e){var t=e.target,i=J(t).parents(".fgImgOuterDiv").find("div.zw-image")[0],n=editor.doc.getRawFormatAt(this.idx);if(i){var o=i.id;if(o==n.id)return!0}if(W(t).hasClass("overlay")&&editor.doc.getSelection().isCollapsed()){var r=editor.doc.getSelection().getStart();if(r==this.idx)return!0}return!1},e}(),ShapeTransformableUIObject=function(e){"use strict";function t(t){e.call(this,t)}function i(){var e=editor.doc.getRawFormatAt(this.idx),t=HF_SECTIONS.contains(DocTreeManager.getSectionAtIndex(this.idx).getSectionType()),i=null,n=DocLayoutManager.getViewContainingResizeObjectAtIndex(this.idx).getPage(),o=!1,r=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,this.idx);if(r){var a=r.getRangeIndex(),s=editor.doc.getRawFormatAt(a);o=s&&DTUtils.isNonWrappingFloatImage(s)}if(DTUtils.isNonWrappingFloatImage(e)||o)i=W(DomViewManager.getDOMElem(n)).find("div.float-image-container");else if(t){var l=DomViewManager.getDOMObj(n),d=l.getRenderedDOM(DocLayoutManager.getViewAtIndex(this.idx));i=W(d)}else i=W(DomViewManager.getDOMObj(n).contentWrapper);var c=i.find("[fid='"+e.fid+"']")[0];return c}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.addDummy=function(){var e=i.call(this),t=J(e).clone(),n={position:"absolute",top:0,left:0,opacity:"0.6","z-index":"100",display:"none"};t.css(n),this.top=parseInt(e.style.top)||0,this.left=parseInt(e.style.left)||0,t[0].setAttribute("id","dummyDragTextBox"),J(e).parent().prepend(t)},t.prototype.changeDummyPosition=function(e){var t=J("#dummyDragTextBox");t.css({top:this.top+e.deltaY,left:this.left+e.deltaX}),t.css("display","block")},t.prototype.removeDummy=function(){var e=J("#dummyDragTextBox");e.remove()},t}(TransformableUIObject),ImageActions=function(){var e=function(e,t){if(e!=t){var i=editor.doc.getSelection(),n=i.getLastRange(),o=editor.doc.createRange(n.start-1,n.start);i.removeAllRanges().addRange(o)}},t=function(e){var t=!0,i=e&&e[ATTR_IMAGE.I_V_POSITION];return i&&"align"==i[ATTR_IMAGE.I_POSITION_TYPE]&&"line"==i[ATTR_IMAGE.I_POSITION_FROM]&&(t=!1),t},i=function(e,i,o,r){var a,s=o.subType&&o.subType==NODE_TYPE.TEXTBOX,l=[{r:i},{ds:editor.doc.getCharAt(i)}],d=OpUtil.getInsertionOps(editor.doc.createRange(i,i+1)),c=editor.jeditorPane.offset().left,u=c<0?e.left-c:e.left,p=e.top,g=DocTreeManager.getSectionAtIndex(i),f=g?g.getSectionType():"";if(f.indexOf("header")!=-1||f.indexOf("footer")!=-1){var E=editor.clientActiveSection;if(s){var T=DocLayoutManager.getSectionViews(o.id)[0],m=DocLayoutManager.getSectionViewWithResizeObjectAtIndex(T.getRangeIndex()),h=DomViewManager.getDOMObj(T.getPage());E=h.getActiveSectionElem(m),editor.clientActiveSection=E,editor.prevClientActiveSection=editor.clientActiveSection}a=Utils.getClosestChild(E,"span.zw-portion,span.EOP",u,p)}else{var I={};I.excludeNoteSection=!0,a=Utils.getClosestChild(editor.editorPaneContainer[0],"span.zw-portion,span.EOP",u,p,I);var _=!!J(a).parents(".hf_content").length;if(_||DomViewManager.isMultiplePagesInRow()){var A=DomViewManager.getClosestPage({left:u,top:p}),S=J(A).find("div.zw-contentpane")[0];a=Utils.getClosestChild(S,"span.zw-portion,span.EOP",u,p,I)}}var R=J(a).parents("div.zw-paragraph")[0],A=J(R).parents("div.zw-page")[0];if(!R)return TransformHandler.reconstructRect(o.id),-1;s&&(TableUtil.handleSectionOpsArr(d.sectionOps),TextBoxHandler.removeTextBoxSection(o.id)),Op.processMsg(l);var O,b=CurUtil.getCursorLineOffset(a),v=editor.doc.getSelection(),D=0,L=0,N=DomViewManager.getDocView(R);D=N.getLeft();var P=N.getPrevView();if(P&&P.getType()===VIEW.PARA&&DTUtils.compareParaBorderFormats(N,P)&&N.getLeft()===P.getLeft()&&N.getWidth()===P.getWidth()||(L=N.getNode().paraProperties.spaceBeforeParagraph||0),!r&&t(o))if(!DTUtils.isNonWrappingFloatImage(o)||DTUtils.isNonWrappingFloatImage(o)&&"paragraph"==o[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_FROM])O=editor.doc.getParents(NODE_TYPE.PARAGRAPH,v.getCorrectedCursorPosition(b)).getStart();else{var N=DomViewManager.getDocView(R),C=N.getViews();if(C[0]&&C[0].id==N.id)O=N.getNode().getIndex();else{var y=N.nodeLines[0];O=N.nodeLines[0].start;for(var F=0,M=y.blocks.length;F<M;F++){var w=y.blocks[F];if("EOP"==w.type)O=w.start;else{if("IMAGE"==w.type)continue;if("TEXT"==w.type){O=w.end;var U=O+N.getNodeStartIndex(),x=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,U),B=editor.doc.findPreviousIndexOf(UNICODE.RANGE_END,U);if(x>B){var H=editor.doc.getRawFormatAt(x);if(H.type!=NODE_TYPE.COMMENT&&H.type!=NODE_TYPE.LINK)continue}break}}}O+=N.getNode().getIndex()}}else O=i;var v=editor.doc.getSelection(),G=N.getSplitHeight(),k=editor.doc.createRange(O);if(v.removeAllRanges().addRange(k),N.getSectionType()==SECTION_TYPES.HEADER||N.getSectionType()==SECTION_TYPES.FOOTER){var h=DomViewManager.getDOMObjById(DomViewManager.getViewData(A).docViewId);R=h.getRenderedDOM(N)}TransformHandler.deactivateObject();var W=ZWJSONUtils.clone(d.ops[1].as.start),Y=W.id,z=DTUtils.isWrappingFloatImage(o)&&o.ml?o.ml.convertor().pixels:0,Z=DTUtils.isWrappingFloatImage(o)&&o.mt?o.mt.convertor().pixels:0,V={};extend(V,o),s&&(V.id=Y);var j=o[ATTR_COMMON.BORDERS]?parseInt(o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0,X=o[ATTR_COMMON.BORDERS]?parseInt(o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.WIDTH]):0,K=1*editor.zoomFactor,q={},Q=editor.editorOffset.left>0?editor.editorOffset.left:0;if(q.top=(p-(PUtil.offsetTop(R)*editor.zoomFactor+editor.editorOffset.top+K)-Z*editor.zoomFactor-j*editor.zoomFactor)/editor.zoomFactor+G,q.left=(u-(PUtil.offsetLeft(R)*editor.zoomFactor+Q+K)-z*editor.zoomFactor-X*editor.zoomFactor)/editor.zoomFactor,V[ATTR_IMAGE.I_LEFT]=q.left,V[ATTR_IMAGE.I_TOP]=q.top,DTUtils.isNonWrappingFloatImage(o)){var e={};e.left=u,e.top=p,n(e,o,R,V,O),"paragraph"==o[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_FROM]&&(V[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=q.top+L,"column"==o[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_FROM]&&(V[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=q.left+D))}else"align"==o[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]?(V[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_ALIGN_VAL]=o[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_ALIGN_VAL],V[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="align",V[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=""):(V[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=q.left,V[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_ALIGN_VAL]="",V[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute"),V[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_FROM]="column",V[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_ALIGN_VAL]="",V[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=q.top,V[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",V[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_FROM]="paragraph";return V[ATTR_IMAGE.I_TOP]&&(V[ATTR_IMAGE.I_TOP]=""),V[ATTR_IMAGE.I_LEFT]&&(V[ATTR_IMAGE.I_LEFT]=""),o.shapeData&&ShapesUtil.copyFormatsToShapedata(V,V.shapeData),Op.cursorProcessed(),editor.doc.execCmd("insimg",[V,!0]),O},n=function(e,t,i,n,o){var r={},a=DTUtils.isWrappingFloatImage(t)&&t.ml?t.ml.convertor().pixels:0,s=DTUtils.isWrappingFloatImage(t)&&t.mt?t.mt.convertor().pixels:0,l=t[ATTR_COMMON.BORDERS]?parseInt(t[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0,d=t[ATTR_COMMON.BORDERS]?parseInt(t[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.WIDTH]):0,c=editor.zoomFactor,u=t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_FROM],p=t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_FROM],g=DocLayoutManager.getColumnAtIndex(o),f=g.getSection(),E=f.getPage()?f.getPage():DocLayoutManager.getCurrentPage(),T=DomViewManager.getDOMObj(E),m=T.getRenderedDOM(f),h=J(m).offset(),I=J(i).parents(".zw-pagecontainer").offset(),_=E.getAbsolutePageNumber();if(_%2==0&&("insidemargin"!=u&&"outsidemargin"!=u||(u="insidemargin"==u?"outsidemargin":"insidemargin"),"insidemargin"!=p&&"outsidemargin"!=p||(p="insidemargin"==p?"outsidemargin":"insidemargin")),"align"==t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE])n[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]="";else if("relative"==t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE])n[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_ALIGN_VAL]="";else{if("margin"==u)r.left=(e.left-I.left)/c-f.getLeft()-a-d;else if("page"==u||"leftmargin"==u||"insidemargin"==u)r.left=(e.left-I.left)/c-a-d;else if("rightmargin"==u||"outsidemargin"==u)r.left=(e.left-I.left)/c-a-d-(E.getDOMViewWidth()-f.getRight());else if("column"==u)r.left=(e.left-h.left)/c-g.getLeft()-a-d;else if("character"==u){var A=DomViewManager.getDocView(i);"paragraph"==t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_FROM]&&(A=A.getViews()[0]);var S=DocLayoutManager.getLeftRelativeToPageAtIndex();r.left=(e.left-I.left)/c-S-a-d}n[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=r.left,n[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",n[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_ALIGN_VAL]=""}if("align"==t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE])n[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]="";else if("relative"==t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE])n[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_ALIGN_VAL]="";else{if("margin"==p)r.top=(e.top-h.top)/c-s-l;else if("page"==p||"topmargin"==p||"insidemargin"==p)r.top=(e.top-I.top)/c-s-l;else if("bottommargin"==p||"outsidemargin"==p){var R=E.getDOMViewHeight();r.top=(e.top-I.top)/c-s-l-(R-E.getFooterHeight())}else if("paragraph"==p)r.top=n[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP];else if("line"==p){var O=DocLayoutManager.getLineAtIndex(o);r.top=(e.top-I.top)/c-O.getAbsTop(VIEW.PAGE)-s-l}n[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=r.top,n[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",n[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_ALIGN_VAL]=""}n[ATTR_IMAGE.I_TOP]="",n[ATTR_IMAGE.I_LEFT]=""},o=function(e){var t=W(e),i=t.hasClass("fgImgOuterDiv")||t.hasClass("ui-brokenImg-cont")||J(e).parents("div.ui-brokenImg-cont")[0]||J(e).parents("div.ui-efillablefield-label")[0];if(i){var n;if(t.hasClass("fgImgOuterDiv")){if(n=t.find("svg"),0==n.length)return t.find("canvas")[0]}else n=J(e).parents("div.fgImgOuterDiv").find("svg");var o=n.find("image");return o[0]}if(t.hasClass("fgImgOuterDiv")&&!W(e.parentNode).hasClass(NODE_TYPE.FILLABLEFIELD)){var r=J(e).find("image");return r[0]}return e},r=function(e){var t="undefined"!=typeof e?e:editor.doc.getSelection().getStart(),i=editor.doc.getRawFormatAt(t),n=i.id,o={idx:t};PubSub.publish("Image/Selected",n,o)};return{moveCursorOnImg:e,moveFloatingImage:i,fgImgToImage:o,selectImage:r}}(),ImageVisualCueHandler=function(){var e,t=function(){var e=editor.doc.getParents(NODE_TYPE.IMAGE,editor.doc.getSelection().getStart()),t=e.attr(),i=t[ATTR_IMAGE.I_WRAP_TYPE];"square"==i&&"align"==t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]&&(i=t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_ALIGN_VAL]),i||(i="bottom");var n="imgvc-wrap-"+i;Z("imgvc-wrap-menu").zmenu("setMenuItemsAttribute",Z(n),"checked",!0)},i=function(){var e=editor.doc.getParents(NODE_TYPE.IMAGE,editor.doc.getSelection().getStart()),t=parseFloat(e.attr().mb),i=parseFloat(e.attr().mt),n=parseFloat(e.attr().mr),o=parseFloat(e.attr().ml);if(t==i&&i==n&&n==o&&o==t){var r;switch(t){case 0:r=0;break;case.125:r=1;case 3:r=1;break;case.25:r=2;case 6:r=2;break;case.375:r=3;case 9:r=3;break;case.5:r=4;case 12:r=4}var a="imgMargin-"+r;Z("imgvc-margin-menu").zmenu("setMenuItemsAttribute",Z(a),"checked",!0)}},n=function(){W.get("#con-menu-parent").hide(),W.get("#ui-link-bubble-div").hide()},o=function(e){l(e),document.getElementById("con-menu-parent")?r(e):PubSub.publish("ImageVisualCues/Init",e),PubSub.publish("ImageVisualCue/Show")},r=function(t){if(!TransformHandler.getCurrentObjectInfo().isCropActive){var i=t.getIdx(),n=editor.doc.getRawFormatAt(i);if(n.type!==NODE_TYPE.CHART||n.hasOwnProperty(MAILMERGE.MMINFO)){var o=J("#margin-menu");DTUtils.isWrappingFloatImage(n)?o.enable():o.disable();var r=document.getElementById("con-menu-parent");r.style.display="block",e=t.getActualOffset();var a=e.y*editor.zoomFactor,s=e.x*editor.zoomFactor;r.style.top=a+"px",r.style.left=s-r.offsetWidth-5+"px",n&&n.linkData&&n.linkData.url&&J("#ui-link-bubble-div").show()}}},a=function(){var t=e.y*editor.zoomFactor,i=e.x*editor.zoomFactor,n=document.getElementById("con-menu-parent");n.style.top=t+"px",n.style.left=i-n.offsetWidth-5+"px"},s=function(e){ZWComponentUtil.init("con-menu-parent"),ZWComponentUtil.init("image-visualcue-popup"),J("#imgvc-wrap-menu,#imgvc-margin-menu").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)});var t=J("#crop-menu");Macros.isCropAllowed()?t.on("click",function(e,t){TransformHandler.showCrop()}):t.remove(),J("#imgvc-settings-button").on("click",function(e,t){ImagePanel.handleImagePropWrapper()}),J("#image-visualcue-popup").on("click",ToolbarHandler.handleZButtonClick),W.get("#img-delete-menu")[0].addEventListener("click",ImageHandler.removeImage),W.get("#textbox-delete-menu")[0].addEventListener("click",TextBoxHandler.removeTextBox),W.get("#textbox-settings-button")[0].addEventListener("click",TextBoxHandler.openPanel),W.get("#embed-options-dialog-open")[0].addEventListener("click",Widget.openEmbedOptionsPanel),W.get("#embed-video-in-newtab")[0].addEventListener("click",Widget.openWidgetInNewTab),W.get("#embed-to-hyperlink")[0].addEventListener("click",Widget.convertWidgetToHyperLink),W.get("#embed-delete")[0].addEventListener("click",Widget.deleteWidget),l(e),r(e)},l=function(e){var t=e.getIdx(),i=editor.doc.getRawFormatAt(t);if(i){var n=i[MAILMERGE.MMINFO]||i[ATTR_COMMON.FIELDINFO],o=i.subType==NODE_TYPE.TEXTBOX&&!i.hasOwnProperty(ATTR_FILLABLEFIELD.FF_INFO),r=i.subType==NODE_TYPE.QRCODE||i.subType==NODE_TYPE.BARCODE,a=i.subType===ATTR_CHART.CHART&&!i[ATTR_CHART.SHEET_ID],s=i.subType==ATTR_WIDGET.WIDGET||i.subType==ATTR_CHART.CHART||i.hasOwnProperty(ATTR_FILLABLEFIELD.FF_INFO)&&i.subType!=NODE_TYPE.QRCODE&&i.subType!=NODE_TYPE.BARCODE||o,l=s||n||i[ATTR_IMAGE.I_LATEXEXP]||i[ATTR_IMAGE.I_SHAPEDATA],d=l||!i.src||i.src.indexOf("http")!=-1||r,c=i.hasOwnProperty(ATTR_WIDGET.SHEET_INFO)||i.subType!=NODE_TYPE.QRCODE&&i.subType!=NODE_TYPE.BARCODE&&i.hasOwnProperty(ATTR_FILLABLEFIELD.FF_INFO)||o,u=i.type===NODE_TYPE.CHART;J("#img-fmt-option").css("display",c?"none":"block"),J(".chart-info-container").css("display",a?"none":"block"),J("#imgvc-settings-button").css("display",s?"none":"block"),J("#preview-image-div").css("display",l?"none":"block"),J("#img-annotate-menu")[d?"addClass":"removeClass"]("ui-state-disabled"),W.get(".chart-field-options").css({display:u?"block":"none"}),W.get("#textbox-delete-menu").css({display:o?"block":"none"}),W.get("#textbox-settings-button").css({display:o?"block":"none"})}},d=function(e){var t=e.getIdx(),i=editor.doc.getRawFormatAt(t);if(i&&!i.hasOwnProperty(ATTR_FILLABLEFIELD.FF_INFO)){var n=W.get("#image-visualcue-popup");if(n[0]&&e){var o=e.getCropOffset(),r=e.getCropWidth();n.show();var a=o.y-n[0].offsetHeight-10,s=o.x+r/2-n[0].offsetWidth/2,l={top:a+"px",left:s+"px"};n.css(l)}}},c=function(){var e=W.get("#image-visualcue-popup");e.hide()},u=function(){PubSub.subscribe("TransformableObject/Crop/Active",n),PubSub.subscribe(["TransformableObject/Crop/Active","TransformableObject/Crop/MouseUp"],d),PubSub.subscribe("TransformableObject/Crop/Remove",o),PubSub.subscribe(["TransformableObject/CropMouseDown","CropCorner/Down","TransformableObject/Crop/Remove","TransformableObject/destroyed"],c),PubSub.subscribe("TransformableObject/destroyed",f),PubSub.subscribe("TransformableObject/Resize/Active",o),PubSub.subscribe("Document/Zoom",a)},p=function(){PubSub.unsubscribe("TransformableObject/Crop/Active",n),PubSub.unsubscribe(["TransformableObject/Crop/Active","TransformableObject/Crop/MouseUp"],d),PubSub.unsubscribe("TransformableObject/Crop/Remove",o),PubSub.unsubscribe(["TransformableObject/CropMouseDown","CropCorner/Down","TransformableObject/Crop/Remove","TransformableObject/destroyed"],c),PubSub.unsubscribe("TransformableObject/destroyed",f),PubSub.unsubscribe("TransformableObject/Resize/Active",o),PubSub.unsubscribe("Document/Zoom",a)},g=function(e){var t=editor.doc.getRawFormatAt(e.getIdx()),i=t&&t[ATTR_COMMON.CLS]==NODE_TYPE.SIGNERFIELD,n=e.getType()==NODE_TYPE.TEXTBOX,r=e.getType()==NODE_TYPE.IMAGE;i||!r&&!n||t.shapeData||(u(),o(e))},f=function(){n(),p()},E=function(){editor.doc.getRawFormatAt(editor.doc.getSelection()[0].start).type===NODE_TYPE.CHART?ChartLeftPanel.open():ImagePanel.open()};(function(){PubSub.subscribe("TransformableObject/Created",g)})();return{bindEvents:u,unBindEvents:p,adjustContextMenu:r,imgWrapBeforeShow:t,imgMarginBeforeShow:i,showHideButtons:l,onMenuFetch:s,openCurrentObjectPanel:E}}(),NamedRangeDialog=function(e){"use strict";var t,i,n,o,r,a="",s=!1,l=!1,d=function(){var t=J("#modify_named_range_menu");t.zmenu("removeAllMenuItems");for(var i,n,o=editor.doc.getSelection(),r=e.getEnclosedRanges(o.getStart(),o.getEnd()),a=0,s=r.length;a<s;a++)i=r[a],n={id:"named_range_"+i.id,label:i.name,name:i.name,appData:{action:"NamedRange.modifyRange",params:[o.getStart(),o.getEnd(),i.id]}},t.zmenu("addMenuItem",n)},c=function(){t=J("#highlighter-options-value"),i=J("#existing-highlighter-options-value"),n=J("#existing-highlighters"),o=J("#new-highlighter-feature"),r=J("#existing-highlighter-name"),s=!1,l=!1},u=function(){i.hide(),n.hide(),o.hide()},p=function(){t.on("zstatebuttonchange",function(e,t){if(s=t.checked){var a=Highlighter.getAllHighlightes();ZWJSONUtils.getKeys(a).length>0?(i.show(),l?(r.zselectbox("removeOption"),n.show(),o.hide(),r.zselectbox("addOption",ZWJSONUtils.getKeys(a))):(n.hide(),o.show()),i.on("zstatebuttonchange",function(e,t){l=t.checked,l?(r.zselectbox("removeOption"),n.show(),o.hide(),r.zselectbox("addOption",ZWJSONUtils.getKeys(a))):(n.hide(),o.show())})):o.show()}else i.hide(),n.hide(),o.hide()}),J("#highlighter-clrpicker").on("zcolorpickerpick",function(e,t){J("#highlighterColor").val(t.color)}),J("#highlighter-border-clrpicker").on("zcolorpickerpick",function(e,t){J("#highlighterBorderColor").val(t.color)})},g={init:function(){c(),u(),p()},get:function(e){"namedrangediv"==e.action&&m()}},f=function(){var t=J("#named_range_link_menu");t.zmenu("removeAllMenuItems");for(var i,n,o=editor.doc.getSelection(),r=e.getNamedRangesBetween(o.getStart(),o.getEnd()),a=0,s=r.length;a<s;a++)i=r[a],n={id:"named_range_"+i.id,label:i.name,name:i.name,appData:{action:"NamedRange.showLink",params:[i.id]}},t.zmenu("addMenuItem",n)},E=function(e){var t=document.createElement("span");t.textContent=e,e?(CopyEventHandler.triggerCopyEvent({html:t.outerHTML,text:e}),UIUtils.showLinkCopiedBanner()):UIUtils.showLinkCopyFailedBanner(),J("#ui-link-bubble-div").hide()},T=function(e){var t,i;this.isGetLinkDialogueOpened=!0;var i=0,t=0,n=J("#"+e);if(n.length){var o=n.offset();0==i&&0==t&&(i=o.top,t=o.left);var r=editor.base_url+"/open/"+editor.doc.rid+"/ranges/"+e;Utils.contextMenuSupportedBrowser()&&E(r),Utils.showLink(r,i,t)}J("#ui-link-bubble-div").hide()},m=function(){var t=J("#namedRangeList"),i=e.getAllRanges();if(t.empty(),i.length){for(var n,o=0;n=i[o++];)n.name&&t.append(J("<p></p>").attr("id",n.id).addClass("ui-insert-bookmark-normal").click(NamedRangeDialog.optionSelect.bind(this)).text(n.name));J("#namedRangeDelete,#namedRangeAllDelete,#namedRangeLink").enable()}else t.empty(),J("#namedRangeDelete,#namedRangeAllDelete").disable();EventHandler.isDialogOpened&&CurUtil.stopBlinking(),J("#namedRangeText").focus()},h=function(t){a=t.target.id,J("p.ui-insert-bookmark-selected").removeClass("ui-insert-bookmark-selected").addClass("ui-insert-bookmark-normal"),J(t.target).removeAttr("class").addClass("ui-insert-bookmark-selected"),J("#namedRangeModify").disable();var i=editor.doc.getSelection(),n=e.getEnclosedRanges(i.getStart(),i.getEnd());n.length>0&&n.filter(function(e){if(e.id==a)return void J("#namedRangeModify").enable()})},I=function(){return a},_=function(){var e=editor.doc.getSelection();if(e.isCollapsed()){var t=e.getWord();t.select()}J.dialogutil.open("namedRangeDialog",J("#named_range_popup"),g)},A=function(){var t=J("#named_range_popup"),i={},n=t.zvalidation("validateAllFields",t);if(n){if(s)if(l)i.hilite_name=J("#existing-highlighter-name").val();else{var o=Utils.removeUnWantedUnicodes(J("#highlighterText").val()),r=J("#highlighterColor").val(),a={};a.type=J("#highlighter-style").zselectbox("getValue"),a.width=J("#highlighter-border").zselectbox("getValue"),a.color=J("#highlighterBorderColor").val(),i.hilite_name=o,Highlighter.createHiliter(o,r,a)}var d=Utils.removeUnWantedUnicodes(J("#namedRangeText").val()),c=editor.doc.getSelection();e.createRange(c.getStart(),c.getEnd(),d,i),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1),J("#namedRangeText").attr("value",""),J.dialogutil.close("namedRangeDialog")}},S=function(){var e=J("fieldset#manageNamedRange"),t=J("#named_range_popup");e.is(":hidden")?(e.show(),t.find(".ui-icon-triangle-1a-e").removeClass("ui-icon-triangle-1a-e").addClass("ui-icon-triangle-1a-s")):(e.hide(),t.find(".ui-icon-triangle-1a-s").removeClass("ui-icon-triangle-1a-s").addClass("ui-icon-triangle-1a-e"))},R=function(){e.removeAllRanges(),a="",m()},O=function(t){e.removeRangeById(t),a="",m()};return{openPopup:_,populateList:d,insertRange:A,showAdvancePanel:S,getSelectedId:I,optionSelect:h,removeAllRanges:R,populateListToGetLink:f,showLink:T,copyLink:E,removeRangeById:O}}(NamedRange);!function(){function e(e,i,n){var o=t(),r="",a=[],s=[];o.hasOwnProperty(e)&&o[e].hasOwnProperty("tobeEnabled")&&1!=o[e].tobeEnabled||(r="checked");var l="<div class='ui-bottom-margin-medium ui-pop-2c-variable'><input class='js-custom-autocorrect-checkbox ui-checkbox-textspace ui-fl' onclick='AutoCorrect.resetSelectAll(this)' style='margin-top:4px' type='checkbox' ctype='zstatebutton' "+r+"><input class='ztextbox autocorrect-key ui-fl autocorrect-key-"+n+"' maxlength='255' ctype='zstatebutton' type='text' /><input class='ztextbox autocorrect-val ui-fl autocorrect-val-"+n+"' maxlength='255' ctype='zstatebutton' type='text' /><span class='tkclose'><span class='ui-icon-autocor-delete-sm' onclick='AutoCorrect.deleteCorrect(this);'></span></span></div>";J("div#defdiv div").each(function(){var e=J(this),t=e.find("input.autocorrect-key").val(),i=e.find("input.autocorrect-val").val();a.push(t),s.push(i)});for(var d=0;d<a.length;d++)if(a[d]==e)return s[d]!=i?(J("#defdiv").find("input[value="+s[d]+"]").parent().parent().find('input[type="checkbox"]').check(!1),l):"";return l}function t(){return J.isEmptyObject(s)?s=w_usersettings&&w_usersettings[ATTR_BODY.DS_AUTOCORRECTS]||{}:s}function i(){var e=J("div#prefMainDiv").children("div");if(0!=e.length){s={},e.each(function(){var e=J(this),t=e.find("input.autocorrect-key").val(),i=Utils.removeUnWantedUnicodes(e.find("input.autocorrect-val").val()),n=e.find('input[type="checkbox"]').prop("checked")?1:0;t&&i&&(s[t]={value:i,tobeEnabled:n})});var t=J("div#defdiv div");t.each(function(){var e=J(this),t=e.find("input.autocorrect-key").val(),i=e.find("input.autocorrect-val").val(),n=e.find('input[type="checkbox"]').prop("checked")?1:0;"1"!=n&&"0"!=n||(s[t]={value:i,tobeEnabled:n})})}}function n(e){var t=J("."+e),i=t.length;if(0==i)return!1;for(var n=0;n<i;n++){var o=J(t[n]).prop("checked");if(0==o)return!1}return!0}function o(e){return function(t){c(e,t)}}function r(e,t){Mousetrap.bind(t,o(e),"keypress")}function a(){var e={"( c )":"(c)","( r )":"(r)","( t m )":"(tm)","1 / 4":"1/4","1 / 2":"1/2","3 / 4":"3/4","- - >":"-->","< - -":"<--","< - >":"<->","= = >":"==>","< = =":"<==","< = >":"<=>"};U.each(e,r)}var s={},l=0,d={"custom-autocorrect-selectall":"js-custom-autocorrect-checkbox","default-autocorrect-selectall":"js-def-autocorrect-checkbox"},c=function(e,t){if(w_usersettings[ATTR_BODY.DS_PREF]&&1==w_usersettings[ATTR_BODY.DS_PREF]){var i=w_usersettings[ATTR_BODY.DS_AUTOCORRECTS]||{};if(i[e]&&1==i[e].tobeEnabled){var n=i[e].value||null,o=editor.doc.createElement(NODE_TYPE.TEXT,e),r=editor.doc.getSelection().getStart()-e.length,a=editor.doc.getSelection().getStart(),s=editor.doc.getSelection().textFormat,l=editor.doc.getRawFormatAt(r)||{};if(l&&"OFF"==l[ATTR_TEXT.TS_AUTO_COREECT])return delete l[ATTR_TEXT.TS_AUTO_COREECT],delete s[ATTR_TEXT.TS_AUTO_COREECT],void editor.doc.setFormatAt(r,l);o.setStart(r),o.setEnd(a);var d=editor.doc.createElement(NODE_TYPE.TEXT,n);d.setStart(r),d.setEnd(r+n.length);var c=DocUtil.copyStyle(s);return c[ATTR_TEXT.TS_AUTO_COREECT]="ON",delete s[ATTR_TEXT.TS_AUTO_COREECT],editor.doc.getSelection().replace(o,d),Op.sendMsg(),editor.doc.setFormatAt(r,c),DomUtil.stopEvent(t),!1}}},u=function(e){if(parseInt(w_usersettings[ATTR_BODY.DS_AUTOCAPSDAYS])){var t=editor.doc.getSelection().getWord(),i=t.getStart(),n=t.getEnd();if(n-i===e.length&&editor.doc.getCharAt(i)!==e.indexOf(0)){var o=editor.doc.createElement(NODE_TYPE.TEXT,editor.doc.getCharAt(0)),r=editor.doc.getSelection().textFormat,a=editor.doc.getRawFormatAt(i)||{};if(a&&"OFF"==a[ATTR_TEXT.TS_AUTO_COREECT])return delete a[ATTR_TEXT.TS_AUTO_COREECT],delete r[ATTR_TEXT.TS_AUTO_COREECT],void editor.doc.setFormatAt(i,a);o.setStart(i),o.setEnd(i+1);var s=editor.doc.createElement(NODE_TYPE.TEXT,e.charAt(0));s.setStart(i),s.setEnd(i+1);var l=DocUtil.copyStyle(r);l[ATTR_TEXT.TS_AUTO_COREECT]="ON",delete r[ATTR_TEXT.TS_AUTO_COREECT],editor.doc.getSelection().replace(o,s),Op.sendMsg(),editor.doc.setFormatAt(i,l)}}};window.AutoCorrect={addCorrect:function(){var i=J("#autoCorrect_Key_Id").val().trim(),o=J("#autoCorrect_Value_Id").val();if(""!=i&&""!=o){var r=t();if("--"===i&&"—"===o.trim()||"-"===i&&"–"===o.trim())return void MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,null,editorProps.deployment.writer,J.i18n("writer.common.KEY_ALREADY_AVAILABLE"));for(var a in r){var s=r[a].tobeEnabled,d=editorProps.deployment.writer;if(i==a&&"1"==s)return void MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,null,d,J.i18n("writer.common.KEY_ALREADY_AVAILABLE"))}l++;var c=e(i.trim(),o,l);J("#custom-autocorrect-div").after(c),J("div#prefMainDiv").find(".autocorrect-key-"+l).val(i.trim()),J("div#prefMainDiv").find(".autocorrect-val-"+l).val(o),J("#autoCorrect_Key_Id").val(null),J("#autoCorrect_Value_Id").val(null);var u=n("js-custom-autocorrect-checkbox");J("#custom-autocorrect-selectall").prop("checked",u)}},deleteCorrect:function(e){J(e).parents("div:first").remove();var t=n("js-custom-autocorrect-checkbox");J("#custom-autocorrect-selectall").prop("checked",t)},getUserCorrects:function(e){return e&&i(),t()},showCorrects:function(){var i="",o=t();l++;for(var r in o){l++;var a=o[r];i=e(r,a.value,l),J("div#prefMainDiv").append(i),J("div#prefMainDiv").find(".autocorrect-key-"+l).val(r),J("div#prefMainDiv").find(".autocorrect-val-"+l).val(a.value),J("div#defdiv div").each(function(){var e=J(this),t=e.find("input.autocorrect-key").val(),i=e.find("input.autocorrect-val").val();r==t&&a.value==i&&"1"==o[r].tobeEnabled&&e.find('input[type="checkbox"]').attr("checked",!0)})}"0"==w_usersettings[ATTR_BODY.DS_PREF]&&J("div#prefdiv, div#defaultprefdiv").find(":input").attr("disabled",!0);for(var r in d){var s=n(d[r]);J("#"+r).prop("checked",s)}},toggleSelectAllCorrects:function(e){var t=J(e).prop("checked"),i=d[e.id];J("."+i).prop("checked",t)},resetSelectAll:function(e){var t,i,o=J(e),r=o.prop("checked");for(var a in d)o.hasClass(d[a])&&(i=a,t=d[a]);if(t&&i)if(0==r)J("#"+i).prop("checked",!1);else{var s=n(t);J("#"+i).prop("checked",s)}},correctDayAndMonths:u,addAutoCorrects:a}}(),BookmarkDialog.prototype={name:"",selectedId:"",isGetLinkDialogueOpened:!1,hideBookmark:!1,openBookmarkPopup:function(){var e=editor.doc.getSelection();if(e.isCollapsed()){var t=e.getWord();t.select()}J.dialogutil.open("bookmarkdialog",J("#ins_bookmark"),this.info)},validation:function(){return!0},isSelectionContainsHR:function(){var e=editor.doc.getSelection().getLastRange();return!!e&&e.getContent().indexOf(UNICODE.HR)!=-1},info:{get:function(e){"bookmarkdiv"==e.action&&BookmarkDialog.update()},set:function(e,t,i){t=Utils.removeUnWantedUnicodes(t),"bookmarkname"==e.action&&(BookmarkDialog.name=t)}},insert:function(){var e=J("#bookmark_popup"),t=e.zvalidation("validateAllFields",e);if(t){var i;i=editor.doc.createElement(NODE_TYPE.BOOKMARK,{id:Utils.randomString(),name:Utils.removeUnWantedUnicodes(J("#bMarkText").val())}),editor.doc.execCmd("bookmark",i),J("#bMarkText").attr("value",""),BookmarkDialog.update(),J.dialogutil.close("bookmarkdialog")}},toggleBookmark:function(e,t){BookmarkDialog.hideBookmark=!BookmarkDialog.hideBookmark,t&&!t.fromUI||(BookmarkDialog.saveBookMarkVisibility(!UIUtils.isShowBookmark()),JbookMarkDivs=J(".bMark"),UIUtils.isShowBookmark()?JbookMarkDivs.show():(JbookMarkDivs.hide(),ZWLogger.addToStatistics("HideBookmark")))},remove:function(e){if(BookmarkDialog.selectedId||e){var t=e?e:BookmarkDialog.selectedId;delete editor.bookmarks[t];var i=editor.doc.getElement("bookmark",t)[0];editor.doc.execCmd("delete",i),editor.jeditorPane.children("div.markingDiv").remove(),BookmarkDialog.selectedId="",BookmarkDialog.update(),J.dialogutil.isDialogOpened("bookmarkdialog")||(EventHandler.isDialogOpened=!1)}},removeAll:function(){editor.doc.execCmd("deleteAllBookMarks"),editor.bookmarks={},this.update()},optionSelect:function(e){BookmarkDialog.selectedId=e.id,J("p.ui-insert-bookmark-selected").removeClass("ui-insert-bookmark-selected").addClass("ui-insert-bookmark-normal"),J(e).removeAttr("class").addClass("ui-insert-bookmark-selected")},update:function(){var e=J("#bookmarkList"),t=editor.doc.getElement("bookmark");if(e.empty(),t.length){for(var i,n=0;i=t[n++];)i.id.indexOf("toc_")==-1&&i.name&&(editor.bookmarks[i.id]={name:i.name},e.append(J("<p></p>").attr("id",i.id).addClass("ui-insert-bookmark-normal").click(function(){BookmarkDialog.optionSelect(this)}).text(i.name)));BookmarkDialog.selectedId?e.find("p#"+BookmarkDialog.selectedId).addClass("ui-insert-bookmark-normal"):(J("p#"+t[0].id).addClass("ui-insert-bookmark-normal"),BookmarkDialog.selectedId=t[0].id),J("#bMarkGoTo,#bMarkDelete,#bAllDelete").enable()}else e.empty(),J("#bMarkGoTo,#bMarkDelete,#bAllDelete").disable();EventHandler.isDialogOpened&&CurUtil.stopBlinking(),J("#bMarkText").focus()},constructMenu:function(e){for(var t,i,n=DocLayoutManager.getLineAtIndex(DomViewManager.getStartIndex(e.parentElement)).bookMarks,o=[],r=n.length,a=0;a<r;a++)i=n[a].id,i.indexOf("toc")==-1&&(t={label:n[a].name,customAttributes:{data:'{"appData":{"action":"Utils.moveToBookmark","params":["'+i+'"]}}'}},o.push(t),editor.getRole().permissions.can("document.edit")&&(t={label:J.i18n("writer.common.REMOVE"),customAttributes:{data:'{"appData":{"action":"BookmarkDialog.remove","params":["'+i+'"]}}'}},o.push(t)),t={label:J.i18n("writer.common.GET_LINK"),customAttributes:{data:'{"appData":{"action":"BookmarkDialog.showLink","params":["'+i+'"]}}',"zui-hide":"editor.isWiki"}},o.push(t),a!=r-1&&o.push({itemType:"separator"}));return o},showLink:function(e){var t,i;this.isGetLinkDialogueOpened=!0;var i=0,t=0;if(!e){var n=editor.doc.getSelection(),o=editor.doc.getRawFormatAt(n[0].start);if(o&&o.type==NODE_TYPE.IMAGE)var r=editor.doc.getParents(NODE_TYPE.IMAGE,n[0].start),a=r.attr().linkData.url;else var r=editor.doc.getParents(NODE_TYPE.LINK,n[0].start),a=r.attr(ATTR_LINK.LINK_URL);var s=editor.doc.getElement(NODE_TYPE.BOOKMARK,a);s&&s.length>0&&(e=s[0].id);var l=r.getStart(),d=editor.doc.getRawFormatAt(l).id,c=J("#"+d).offset();i=c.top,t=c.left}var u=J("#"+e);if(u.length){var p=u.offset();0==i&&0==t&&(i=p.top,t=p.left);var g=editor.base_url+"/open/"+editor.doc.rid+"/bookmarks/"+e;Utils.contextMenuSupportedBrowser()&&BookmarkDialog.copyLink(g),Utils.showLink(g,i,t)}else e&&e[0].indexOf("toc")!==-1?PubSub.publish("Document/Warning",WARNING_MSG.HEADING_REMOVED):PubSub.publish("Document/Warning",WARNING_MSG.BOOKMARK_REMOVED);J("#ui-link-bubble-div").hide()},getAndCopyLink:function(){BookmarkDialog.copyLink(Z("go-to-link").text())},copyLink:function(e){var t=document.createElement("span");t.textContent=e,e?(CopyEventHandler.triggerCopyEvent({html:t.outerHTML,text:e}),UIUtils.showLinkCopiedBanner()):UIUtils.showLinkCopyFailedBanner(),J("#ui-link-bubble-div").hide()},getLink:function(e){var t=editor.doc.getElement(NODE_TYPE.BOOKMARK,e),i=t&&t[0]&&t[0].id;return i?editor.base_url+"/open/"+editor.doc.rid+"/bookmarks/"+i:""},getHeadingLink:function(){var e=editor.doc.getSelection(),t=DocTreeManager.getTreeNodeAtIndex(e[0].start),i=t.getIndex(),n=t.getEndIndex(),o=editor.doc.getRawFormatAt(i);if(o.type===NODE_TYPE.BOOKMARK&&o.id)BookmarkDialog.showLink(o.id);else{var r=Utils.randomString(),a={},s={};id="toc_"+Utils.randomString(),a[ATTR_COMMON.TYPE]=NODE_TYPE.BOOKMARK,a[ATTR_COMMON.ID]=id,a[ATTR_COMMON.NAME]=r,s[ATTR_COMMON.TYPE]=NODE_TYPE.BOOKMARK,s[ATTR_COMMON.ID]=id;var l=Utils.randomString(),d=Utils.randomString();Op.processMsg([{r:i},{as:{start:a,id:l}},{is:UNICODE.RANGE_START},{as:{end:ZWJSONUtils.getKeys(a),id:l}},{r:n-i},{as:{start:s,id:d}},{is:UNICODE.RANGE_END},{as:{end:ZWJSONUtils.getKeys(s),id:d}}]),Op.sendMsg(),BookmarkDialog.showLink(id)}},showAdvance:function(){var e=J("fieldset#manageBookmark"),t=J("#bookmark_popup");e.is(":hidden")?(e.show(),t.find(".ui-icon-triangle-1a-e").removeClass("ui-icon-triangle-1a-e").addClass("ui-icon-triangle-1a-s")):(e.hide(),t.find(".ui-icon-triangle-1a-s").removeClass("ui-icon-triangle-1a-s").addClass("ui-icon-triangle-1a-e"))},saveBookMarkVisibility:function(e){if(editor.isOffline()||Macros.isRemote())return void(editor.doc.userData[editor.zuid].bookmarkVisibility=e);var t=editor.doc.docInfo,i={};i.rid=t.RID,i.bookmarkVisibility=e,editor.doc.userData[editor.zuid].bookmarkVisibility=e,J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/bookmarkvisibility"),data:i,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){},error:function(t){editor.doc.userData[editor.zuid].bookmarkVisibility=!e,UIUtils.isShowBookmark()?JbookMarkDivs.show():(JbookMarkDivs.hide(),ZWLogger.addToStatistics("HideBookmark"))}})}};var BookmarkDialog=new BookmarkDialog;CollabPanelHandler.unreadChatCount=0,CollabPanelHandler.contactServer,CollabPanelHandler.collabPanel,CollabPanelHandler.isInitialised=!1,CollabPanelHandler.collabPanelUserList={},CollabPanelHandler.chatContent=!1,CollabPanelHandler.unreadNotificationContainer,CollabPanelHandler.getTranscript=function(e){J.ajax({type:"GET",url:ZWNetworkUtils.getUrl("chat/history"),success:function(e){e&&"SUCCESS"===e.RESPONSE&&(CollabPanelHandler.chatContent=e.transcript,J(".ui-zcollaborator-content").last().html(CollabPanelHandler.chatContent))},error:function(e,t,i){}})},CollabPanelHandler.init=function(){CollabPanelHandler.contactServer=contactServer,CollabPanelHandler.collabPanel=J("#collabdialog"),CollabPanelHandler.collabPanel.zcollaborator(),CollabPanelHandler.unreadNotificationContainer=J("#chat-notify-cont"),CollabPanelHandler.initPanel(),CollabPanelHandler.updateCollabCount(),CollabPanelHandler.isInitialised=!0},CollabPanelHandler.initPanel=function(){CollabPanelHandler.collabPanel.off("zcollaboratorchatentered"),CollabPanelHandler.collabPanel.off("zcollaboratorusernameclicked"),CollabPanelHandler.collabPanel.parents(".ui-statusbar-collab-dialog").css({top:"",bottom:26}),CollabPanelHandler.collabPanel.parent(".zdialog__content").css({overflow:"hidden"}),CollabPanelHandler.collabPanel.zdialog("setAttribute","title",J.i18n("writer.common.QUICK_CHAT")),CollabPanelHandler.bindPanelEvents(),CollabPanelHandler.getTranscript()},CollabPanelHandler.bindPanelEvents=function(){CollabPanelHandler.collabPanel.zcollaborator({statusBarKeys:{messageKeys:{editing:"ui-icon ui-components-icon ui-icon-zdocedit",viewing:"ui-icon ui-components-icon ui-icon-zview"},statusKeys:["offline"]}}),CollabPanelHandler.collabPanel.on("zcollaboratorchatentered",function(e,t){currentUsername=Macros.getCurrentUserName(),CollabPanelHandler.collabPanel.zcollaborator("addChatMessage",currentUsername,t),CollabPanelHandler.sendMessage(t)}),CollabPanelHandler.collabPanel.on("zcollaboratorusernameclicked",function(e,t){"false"===w_usersettings.showchatbar&&UIUtils.changeChatBarView(),WebMessanger.chat(t.uid)}),CollabPanelHandler.collabPanel.on("zcollaboratorclose",function(e,t){EventHandler.isDialogOpened=!1,J("#collaboratorPanelDiv").removeClass("visible")});var e=J("#collaboratorPanelDiv");e.on("click",function(t){J(this).hasClass("visible")?CollabPanelHandler.collabPanel.zcollaborator("close"):zw.require({css:[cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_collaborator_customize.css"]]},[],function(){J("#collabdialog").zcollaborator("open"),CollabPanelHandler.unreadChatCount=0,CollabPanelHandler.unreadNotificationContainer.hide(),J("#collaboratorPanelDiv").removeClass("ui-yellow-bg"),e.addClass("visible"),setTimeout(function(){J("div#collabdialog").unbind("mousedown").bind("mousedown",function(){EventHandler.isDialogOpened=!0})},500)})})},CollabPanelHandler.escapeSelectorId=function(e){return e.replace(/(!|"|#|\$|%|\'|\(|\)|\*|\+|\,|\.|\/|\:|\;|<|=|>|\?|@|&|\[|\]|\^|`|\{|\||\}|~|\s)/g,function(e,t){return"\\"+t})},CollabPanelHandler.addCollaborator=function(e,t){var i=t.fname,n=t.color;if(e!==editor.zuid&&!CollabPanelHandler.isExistingCollaborator(e)&&editor.zuid!=t.unique_userid){var o={zuid:e,dname:i,box:{color:n},image:ZWNetworkUtils.getUserImageURL(e),status:"active",encrypted_userid:t.unique_userid};if(CollabPanelHandler.collabPanel)try{CollabPanelHandler.collabPanelUserList[e]=o,CollabPanelHandler.collabPanel.zcollaborator("addUser",o),J("div[uid="+CollabPanelHandler.escapeSelectorId(e)+"]").click(function(){var t=editor.doc.userData[e].uuids;if(t){var i=t.split(",")[0];if(i){var n=editor.doc.getCursorPortionNode(i,"start");if(n){var o=DomUtil.scrollElementIntoView(n,500);o&&o.promise().then(function(){PubSub.publish("Cursor/showCollbUserName",i)})}}}return!1}),CollabPanelHandler.updateCollabCount()}catch(e){e.stack()}}},CollabPanelHandler.removeCollaborator=function(e,t){e!==editor.zuid&&CollabPanelHandler.isExistingCollaborator(e)&&(delete CollabPanelHandler.collabPanelUserList[e],CollabPanelHandler.updateCollabCount(),CollabPanelHandler.collabPanel.zcollaborator("removeUser",e),UIUtils.toggleCollabActionButtons())},CollabPanelHandler.addChatMessage=function(e,t,i){"undefined"!=typeof RemoteEditor&&RemoteEditor.options.wms_annnonuser_id==e||editor.zuid==e||(J("#collaboratorPanelDiv").hasClass("visible")||(CollabPanelHandler.unreadChatCount++,CollabPanelHandler.unreadNotificationContainer.find("#chat-notify-text").text(CollabPanelHandler.unreadChatCount),J("#collaboratorPanelDiv").addClass("ui-yellow-bg"),CollabPanelHandler.unreadNotificationContainer.show()),CollabPanelHandler.collabPanel.zcollaborator("addChatMessage",t,i),CollabPanelHandler.chatContent=J(".ui-zcollaborator-content").last().html(),"undefined"!=typeof w_usersettings.AUDIO&&"1"===w_usersettings.AUDIO&&Macros.initSoundAndPlay())},CollabPanelHandler.sendMessage=function(e){editor.doc.docInfo;CollabPanelHandler.chatContent=J(".ui-zcollaborator-content").last().html();var t={html:J(".ui-zcollaborator-content").last().html(),msg:e};J.ajax({type:"post",url:ZWNetworkUtils.getUrl("chat"),data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){},error:function(e,t,i){}})},CollabPanelHandler.updateCollabCount=function(){var e=Object.keys(CollabPanelHandler.collabPanelUserList).length;"true"==editor.doc.docInfo.ISSHARED||e>0||CollabPanelHandler.chatContent&&CollabPanelHandler.chatContent.length>0?(J("#collaboratorPanelDiv").addClass("ui-collaborators-userinside").removeClass("ui-collaborators-userediting").show(),J("#Collaborators_btn,#notifyCollaborators").prop("enable",!0),J("#bbar-collabcnt").html(e)):J("#collaboratorPanelDiv").hide()},CollabPanelHandler.isExistingCollaborator=function(e){var t=Object.keys(CollabPanelHandler.collabPanelUserList);return!!t.contains(e)},CollabPanelHandler.handleComponentReady=function(){CollabPanelHandler.init();var e,t=editor.doc.getUserData(),i=DocUtil.copyJSON(t);for(var n in t)"undefined"==typeof RemoteEditor||RemoteEditor.options.wms_annnonuser_id!=n&&editor.zuid!=n||delete i[n],e=t[n],e.unique_userid&&(delete i[e.unique_userid],editor.zuid==e.unique_userid&&delete i[n]);for(var o in i){var r=i[o];ZWCollaboration.addCollaborator(o,r)}},PubSub.subscribe("Document/ComponentInitialized",CollabPanelHandler.handleComponentReady);var FontLibrary=function(){var e=function(e,t){var i=t.fontAction,n=t.fontName;"add"==i?(FontComboUtil.addFont(n),editor.addFonts([n],frames.metricsFrame,null,{defaultVarients:!0})):"remove"!=i&&"removeall"!=i||FontComboUtil.removeFonts(t.fonts)},t=function(){var e=jsCdnZWStaticPath+fingerPrintObj["js/fcomponents_fontlibrary.js"],t=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_fontlibrary.css"],n=jsCdnZWStaticPath+fingerPrintObj["js/fcomponents_fontlibrary_editor.js"],o=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_fontlibrary_customize.css"],r=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_common.css"];zw.require({js:[n,e],css:[r,t,o]},[],function(){i()})},i=function(){ZFontLibrary.open({previewText:"The quick brown fox jumps over a lazy dog",type:"modal"}),J("body").off("zfontlibraryupdate",e).on("zfontlibraryupdate",e)};return{openFontLibraryDlg:t}}();DocRoll.insertDRDlg=function(){J.dialogutil.open("drdialog",J("#share_btn_docroll"),DocRoll.info)},DocRoll.info={set:function(e,t,i){},get:function(e,t){if("SHOWSCRIPT"==e.action)return DocRoll.showDocrollScript(editor.zuid)}},DocRoll.showDocrollScript=function(e){var t='<script language="javascript" type="text/javascript" ';return t+='src="',t+=editor.scheme+"://"+editor.writerPublicURL+"/writer",t+="/docroll/",t+=e,t+='/10">',t+="</script>"};var Template=function(){"use strict";var e=function(e){n.type=e,J.dialogutil.open("templatedialog",J("#expTemp"),n)},t=function(){var e=J("#templateDialog").zvalidation("validateAllFields",J("#templateDialog"));if(e){var t=Utils.removeUnWantedUnicodes(J("#templateName").val()),i=J("#okButton"),o=J("#savingButton");i.hide(),o.show();var r={};r.name=t,r.save_as="template",("orgOnly"==n.type||J("#temp-sv-dlg-orgtemp").is(":checked"))&&(r.type="organization"),J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getContextUrl("api/v1/templates/"+editor.doc.docInfo.RID+"/copy"),data:r,async:!0,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e,t,i){J.dialogutil.close("templatedialog"),Utils.safeWindowOpen(e.open_url,{},"_self")},error:function(e,t,i){401==e.status?MsgDialog.showMessage([J.i18n("writer.common.GOT_IT")],CONST.SEVERITY_WARNING,J.i18n("writer.common.RESTRICTED_FEATURE"),J.i18n("writer.common.ORG_TEMPLATES_AUTHORIZATION_ERROR_MSG")):UIUtils.showMessagePopup(J.i18n("writer.common.TEMPLATE.SAVEDFAILURE"),J.i18n("error","OOPS"),"error"),J.dialogutil.close("templatedialog")}})}},i=function(){var e=(docProps.info.custom_domain?docProps.info.custom_domain+"/writer":editor.writerServerURL)+"/public-templates?from=menu";Utils.safeWindowOpen(decodeURI(e),{},"_blank")},n={type:"both",init:function(e){J("#savingButton").hide(),"both"==this.type?J("#temp-sv-dlg-options").show():(J("#temp-sv-dlg-options").hide(),"orgOnly"==this.type&&J("#templatedialogzdialog").zdialog("setAttribute","title",J.i18n("writer.common.SAVE_AS_ORG_TEMPLATE"))),UIUtils.enterKey(J("input#templateName"),t),setTimeout(function(){J(e).find("input:first").select().focus()},1)},get:function(e){if(J("#savingButton").button({icons:{primary:"ui-icon-loader-small-1"}}).addClass("ui-state-disabled"),"templateSave"==e)return editor.doc.docInfo.DOCUMENT_NAME}},o=function(){J("#template-startwith,#publicTemplateUsebtn").addClass("is-disabled").find("span").text(J.i18n("writer.common.LOADING_TEMPLATE"));var e=editor.doc.docInfo.RID,t={success:function(e){var t=e.open_url;t||(t=editor.getBaseURL()+"/open/"+(e.id||e.document_id)),Utils.safeWindowOpen(t,null,"_self")},error:function(e){var t={};t.type="error",t.close=!0,t.timeOut=4e3,t.translatedMessage=!0,t.message=J.i18n("writer.template.COPY_TEMPLATE_ERROR_MSG"),Notification.show(t),J("#template-startwith,#publicTemplateUsebtn").removeClass("is-disabled").find("span").text(J.i18n("writer.dashboard.USE_THIS_TEMPLATE"))}},i=ZWNetworkUtils.getContextUrl("api/v1/templates/"+e+"/copy"),n={save_as:"document"},o={};o.data=n,o.url=i,o.type="post",o.success=t.success,o.error=t.error,o.beforeSend=function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},ZWNetworkUtils.ajax(o)},r=function(){var e={docType:"template"};e.rid=editor.doc.docInfo.RID,zwritersignup.openSignupDialog(e)};return{openSaveAsTemplatePopup:e,openTemplatesGallery:i,useThisTemplate:o,openSignUpDlg:r,saveAsTemplate:t}}();!function(){var e={init:function(e){setTimeout(function(){J(e).find("input:first").select().focus()},1)},set:function(e,t,i){if("marknewversion"==e.action){var n=function(){FileMenu.markNewVersion()};UIUtils.enterKey(J("#marknewversion_input"),n)}}},t={get:function(e){return"rename"==e.action?editor.doc.docInfo.DOCUMENT_NAME:"saveas"==e.action?J.i18n("writer.common.COPYOF",[editor.doc.docInfo.DOCUMENT_NAME]):documentUtil.docInfo[e]},set:function(e,t,i){if("rename"==e.action){var n=function(){FileMenu.renameFile()};UIUtils.enterKey(J("#renamefilename"),n)}else if("saveas"==e.action){var n=function(){FileMenu.saveAsFile()};UIUtils.enterKey(J("#saveasfilename"),n)}},init:function(e){J.i18n("writer.common.AT");todayAtStr=J.i18n("writer.common.TODAYAT"),yesterdayAtStr=J.i18n("writer.common.YESTERDAYAT"),config={calendar:{sameDay:todayAtStr+" LT",lastDay:yesterdayAtStr+" LT",lastWeek:"LLL",sameElse:"LLL"}},locale=window.navigator.userLanguage||window.navigator.language,moment.locale(locale,config),setTimeout(function(){J(e).find("input:first").select().focus()},1)}};window.FileMenu={recentDocList:[],lastRecentDocListFetchTime:0,isGetDocListReqSent:!1,newFile:function(e){ZWLogger.addToStatistics("Fm_newFile"),Macros.createNewFile(e)},saveFile:function(){ZWLogger.addToStatistics("Fm_saveFile"),Macros.saveDoc()},openMarkNewVersion:function(){ZWLogger.addToStatistics("Fm_mkNewVer"),J.dialogutil.open("marknewversion",J("#filemenu-marknewversion"),e)},docProperties:function(){return ZWLogger.addToStatistics("Fm_prp"),J.dialogutil.open("documentpropertiesdlg",void 0,t),!1},openDocs:function(){var e=Macros.getDocsUrl();!UIUtils.docsWindow||UIUtils.docsWindow.closed?UIUtils.docsWindow=window.open(e):UIUtils.docsWindow.focus()},openRecentDocumentsList:function(){var e=(new Date).getTime(),t=e-FileMenu.lastRecentDocListFetchTime;if(t<6e4)FileMenu.showRecentDocListMenu();else{if(FileMenu.isGetDocListReqSent)return;FileMenu.showRecentDocListLoading();var i={onsuccess:function(e){FileMenu.recentDocList=e.documents,FileMenu.showRecentDocListMenu()},onerror:function(){}};FileMenu.fetchRecentDocuments(i)}},beforeOpenMenu:function(){ZWLogger.addToStatistics("File_Button");editor.doc.docInfo;if(!editor.isOffline()){var e=editorProps.permissionsInfo.appInfo.NAME;"WRITER"!=e&&Z("view-all-documents").hide(),Z("filemenu-newdoc")[0]&&UIStateHandler.build(Z("filemenu-newdoc")[0])}},fetchRecentDocuments:function(e){var t={};t.rid=editor.doc.docInfo.RID,t.category="recent",FileMenu.isGetDocListReqSent=!0,J.ajax({type:"GET",data:t,global:!1,dataType:"json",url:ZWNetworkUtils.getContextUrl("api/v1/documents?from=editor"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(t){FileMenu.showErrorMsg(t),e.onerror()},success:function(t){FileMenu.isGetDocListReqSent=!1,FileMenu.lastRecentDocListFetchTime=(new Date).getTime(),e.onsuccess(t)}})},showRecentDocListLoading:function(){var e=[],t=J("#recentDocument"),i={itemType:"custom",innerHTML:'<div class="ui-loading-cont ui-recent-doc-list-loading"><div>'+J.i18n("writer.common.LOADING")+'</div><div class="ui-loading-gif"> </div></div>'};return e.push(i),t.zmenu("removeAllMenuItems"),t.zmenu("addMenuItems",e),!0},showErrorMsg:function(e){FileMenu.isGetDocListReqSent=!1;var t=[],i=J("#recentDocument");e?e.responseJSON.ERRORCODE:400;return loadingMenuItem={itemType:"custom",innerHTML:'<div class="ui-loading-cont ui-recent-doc-list-loading"><div>'+J.i18n("writer.common.UNABLE_TO_LOAD_RECENT_DOCUMENTS")+"</div></div>"},t.push(loadingMenuItem),i.zmenu("removeAllMenuItems"),i.zmenu("addMenuItems",t),!0},showRecentDocListMenu:function(){for(var e,t,i=FileMenu.recentDocList.length,n=i?[]:[{label:J.i18n("writer.common.NO_RECENT_DOCUMENTS"),width:"50px"}],o=J("#recentDocument"),r=0;r<i;r++)e={},t=FileMenu.recentDocList[r],e.label=t.document_name,e.customAttributes={data:{appData:{action:"FileOpen.loadContent",params:t.document_id}}},e.width="50px",n.push(e);o.zmenu("removeAllMenuItems"),o.zmenu("addMenuItems",n)},markNewVersion:function(){var e=J("#marknewversion_ui").zvalidation("validateAllFields",J("#marknewversion_ui"));if(e){var t=HistoryUI.addVersionDescription(J("#marknewversion_input").val());t.done(function(){UIUtils.showMessage("info",J.i18n("common","CREATE_VERSION"),"showclose","normalfont",5e3)}),t.fail(function(){UIUtils.showMessage("error",J.i18n("common","UNABLE_TO_CREATE_VERSION"),"","normalfont",5e3)}),J.dialogutil.close("marknewversion")}},openPublishDialog:function(){J.dialogutil.close("documentpropertiesdlg"),Utils.loadRTE(!0,function(){PubSub.publish("Publish/Init")})},beforeOpenFileMenu:function(){var e=editor.doc.docInfo;U.isEmpty(CollabListHandler.userStatus)&&CollabListHandler.getSharedUserStatus(!1,CollablistHandler.sharedUserStatusCallback);var t=CollabListHandler.userStatus[e.CREATOR_ZUID],i=t.WMSSTATUS,n=J(".ui-badge");"1"==i?n.removeClass("ui-doc-user-offline"):n.addClass("ui-doc-user-offline")},goToWriterHomePage:function(){var e=editor.writerServerURL+"/documents";Utils.safeWindowOpen(decodeURI(e),{},"_blank")},handleSaveAsTemplateDialog:function(){var e=editor.doc.docInfo;"draft"==e.state?UIUtils.handDraftPopup("FileMenu.openSaveAsTemplateDialog"):FileMenu.openSaveAsTemplateDialog()},openSaveAsTemplateDialog:function(){var e=1==docProps.productInfo.default_product_type||1==docProps.productInfo.default_product_type&&editorProps.permissionsInfo.permissions.indexOf("document.create")!=-1;Template.openSaveAsTemplatePopup(e?"both":"myOnly")}}}(),function(){function e(){var e="_blank";return 1==editor.doc.docInfo.VERSION&&0==editor.doc.docInfo.REVISION&&editor.doc.docInfo.newDoc&&(e="_self"),e}window.FileOpen={fileOpenDialog:function(){ZWLogger.addToStatistics("Fm_FileOpen"),WDHandler.showOpenFileDialog("zw",e(),!0,!0)},closeFileOpenDialog:function(){J.dialogutil.close("fileopenDialog")},openWriterDocument:function(e,t){if("templates"==e||"shared"==e)FileOpen.openDocument(t);else if("userdocument"==e){var i={};ZWNetworkUtils.setCsrfParam(i),J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/util/doctype"),async:!1,data:i,dataType:"json",error:function(e,i,n){FileOpen.openDocument(t)},success:function(e){"SUCCESS"==e.STATUS?"WRITER2"==e.VERSION?FileOpen.openDocument(t):"WRITER3"==e.VERSION&&FileOpen.loadContent(t):FileOpen.openDocument(t)}})}},openDocument:function(t,i){var n,o=i||e();t=t||editor.doc.docInfo.RID,n=editor.getBaseURL()+"/open/"+t,window.open(n,o)},loadContent:function(e){FileOpen.openDocument(e,"_blank")}}}();var PositionPreset=function(){"use strict";var e=JSON.parse('{"preset-tl":{"positionH":{"type":"align","alignVal":"left"},"positionV":{"type":"align","alignVal":"top"}},"preset-t":{"positionH":{"type":"align","alignVal":"center"},"positionV":{"type":"align","alignVal":"top"}},"preset-tr":{"positionH":{"type":"align","alignVal":"right"},"positionV":{"type":"align","alignVal":"top"}},"preset-l":{"positionH":{"type":"align","alignVal":"left"},"positionV":{"type":"align","alignVal":"center"}},"preset-c":{"positionH":{"type":"align","alignVal":"center"},"positionV":{"type":"align","alignVal":"center"}},"preset-r":{"positionH":{"type":"align","alignVal":"right"},"positionV":{"type":"align","alignVal":"center"}},"preset-bl":{"positionH":{"type":"align","alignVal":"left"},"positionV":{"type":"align","alignVal":"bottom"}},"preset-b":{"positionH":{"type":"align","alignVal":"center"},"positionV":{"type":"align","alignVal":"bottom"}},"preset-br":{"positionH":{"type":"align","alignVal":"right"},"positionV":{"type":"align","alignVal":"bottom"}}}'),t=JSON.parse('{"preset-l":{"positionH":{"type":"align","alignVal":"left"}},"preset-c":{"positionH":{"type":"align","alignVal":"center"}},"preset-r":{"positionH":{"type":"align","alignVal":"right"}}}'),i=JSON.parse('{"preset-t":{"positionV":{"type":"align","alignVal":"top"}},"preset-c":{"positionV":{"type":"align","alignVal":"center"}},"preset-b":{"positionV":{"type":"align","alignVal":"bottom"}}}'),n=function(e){var t=new RegExp("[a-z0-9]+","mg"),i=t.exec(e)[0],n=i.length,o=e.substring(n+1);return{className:i,presetType:o}},o=function(e,t){return e[ATTR_IMAGE.I_ALIGN_VAL]==t[ATTR_IMAGE.I_ALIGN_VAL]&&e[ATTR_IMAGE.I_POSITION_TYPE]==t[ATTR_IMAGE.I_POSITION_TYPE]},r=function(e,t){var i=t.positionH,n=t.positionV;return i&&(i[ATTR_IMAGE.I_POSITION_FROM]=e,i[ATTR_IMAGE.I_LEFT]=""),n&&(n[ATTR_IMAGE.I_POSITION_FROM]=e,n[ATTR_IMAGE.I_TOP]=""),ZWJSONUtils.clone(t)},a=function(o){var a,s=n(o),l=s.className,d=s.presetType;switch(l){case"page":case"margin":a=e[d];break;case"column":a=t[d];break;case"line":a=i[d]}return a&&r(l,a),a},s=function(n){var r=n[ATTR_IMAGE.I_H_POSITION],a=n[ATTR_IMAGE.I_V_POSITION];if(n.wrapType){var s,l=r[ATTR_IMAGE.I_POSITION_FROM]==a[ATTR_IMAGE.I_POSITION_FROM];if(l){for(var d in e)if(o(r,e[d].positionH)&&o(a,e[d].positionV)){s=d,s=r[ATTR_IMAGE.I_POSITION_FROM]+"-"+s;break}}else{for(var d in t)if(o(r,t[d].positionH)){s=d,s=r[ATTR_IMAGE.I_POSITION_FROM]+"-"+s;break}for(var d in i)if(!s&&o(a,i[d].positionV)){s=d,s=a[ATTR_IMAGE.I_POSITION_FROM]+"-"+s;break}}return s||"custom"}};return{getClassAndPresetType:n,getPositionFromPreset:a,getPresetFromPosition:s}}(),ImagePanel=function(e){"use strict";var t={},i=!1,n={type:"solid",color:"zwdark1",width:"1px",space:"0px"},o=[ATTR_BORDERS.BORDER_TOP,ATTR_BORDERS.BORDER_LEFT,ATTR_BORDERS.BORDER_RIGHT,ATTR_BORDERS.BORDER_BOTTOM],r=(ATTR_BORDERS.WIDTH,ATTR_BORDERS.COLOR,ATTR_BORDERS.TYPE,{IMG_HEIGHT:"customheight",IMG_WIDTH:"customwidth",IMG_KEEPASPECT_RATIO:"img-keepaspect-ratio",IMG_WRAP_TYPE:"img-wrap-type",IMAGE_CUSTOM_MARGIN:"img-custom-margin",BDR_WIDTH_MENU:"img-bdr-width-menu",BDR_STYLE_MENU:"img-bdr-style-menu",BDR_WIDTH_MENU_ITEM:"img-bwidth-",BDR_STYLE_MENU_ITEM:"img-bstyle-",BDR_COLOR:"img-bdr-color",IMAGE_ROTATE_DEGREE:"img-pnl-rot-deg",IMG_CUSTOM_CROP:"img-custom-crop",IMG_CROP_ASPECT_RATIO:"crop-aspect-",IMG_CROP_MENU:"img-crop-menu",IMG_ALIGN_BTN:"img-pnl-align-btn",IMG_ALIGN_PRESET_MENU:"img-align-preset-menu",IMG_PRESET_CUSTOM:"imgpreset-custom",IMG_PRESET_CONTAINER:"img-align-preset-container"}),a={left:"writer.common.LEFT",front:"writer.image.INFRONT_OF_TEXT",right:"writer.common.RIGHT",inline:"writer.image.INLINE",behind:"writer.image.BEHIND_TEXT",square:"writer.image.SQUARE"},s={margin:"writer.image.DOCUMENT_MARGIN",page:"writer.common.PAGE",line:"writer.image.LINE",column:"writer.sort.COLUMN",custom:"writer.common.CUSTOM"},l={IMG_ORIGINALSIZE:{get:function(e,i){return t.isOrgSize?"on":"off"},set:function(e,i,n){t.isOrgSize=!0;var o=t.naturalHeight,a=t.naturalWidth,s={};return s.ht=o,s.wid=a,s.htUnit="px",s.widUnit="px",Z(r.IMG_HEIGHT).zlabelednumberfield("setAttributes",{suffix:"px",disabled:!1}),Z(r.IMG_HEIGHT).zlabelednumberfield("setValue",o),Z(r.IMG_WIDTH).zlabelednumberfield("setAttributes",{suffix:"px",disabled:!1}),Z(r.IMG_WIDTH).zlabelednumberfield("setValue",a),Z("keepaspect").zbutton("setAttributes",{disabled:!1}),s}},IMG_FITWIDTH:{get:function(e,i){return t.isFitWid?(Z(r.IMG_HEIGHT).zlabelednumberfield("setAttributes",{suffix:"px",disabled:"true"}),Z(r.IMG_WIDTH).zlabelednumberfield("setAttributes",{suffix:"px",disabled:"true"}),Z("keepaspect").zbutton("setAttributes",{disabled:"true"})):(Z(r.IMG_HEIGHT).zlabelednumberfield("setAttributes",{suffix:"px",disabled:!1}),Z(r.IMG_WIDTH).zlabelednumberfield("setAttributes",{suffix:"px",disabled:!1}),Z("keepaspect").zbutton("setAttributes",{disabled:!1})),t.isFitWid?"on":"off"},set:function(e,i,n){t.isFitWid=!0;var o=editor.doc.getSelection(),a={},s=DocLayoutManager.getColumnWidthAtIdx(o.getStart()),l=o.getParents(NODE_TYPE.PARAGRAPH).parentNode().dtNode;return l&&l.type===NODE_TYPE.CELL&&(s=DocLayoutManager.getViews(l)[0].width),a.ht=t.naturalHeight*s/t.naturalWidth,a.wid=s,Z(r.IMG_HEIGHT).zlabelednumberfield("setAttributes",{suffix:"px",disabled:"true"}),Z(r.IMG_HEIGHT).zlabelednumberfield("setValue",a.ht),Z(r.IMG_WIDTH).zlabelednumberfield("setAttributes",{suffix:"px",disabled:"true"}),Z(r.IMG_WIDTH).zlabelednumberfield("setValue",a.wid),Z("keepaspect").zbutton("setAttributes",{disabled:"true"}),a}},IMG_HEIGHT:{get:function(e,i){return TransformHandler.getCurrentObjectInfo().isCropActive?t.originalHeight:t.ht},set:function(e,i,n){var o={};if(o.ht=i,o.htUnit="px",J("#keepaspect").zbutton("getAttribute","checked")){var a=i*t.naturalWidth/t.naturalHeight;Z(r.IMG_WIDTH).zlabelednumberfield("setAttributes",{suffix:"px"}),Z(r.IMG_WIDTH).zlabelednumberfield("setValue",a),o.wid=a}if(TransformHandler.getCurrentObjectInfo().isCropActive){var s=o.wid?o.wid:panleData.originalWidth,l=o.ht;o={};var d=editor.doc.getRawFormat(editor.doc.getSelection().getStart()),c=d[ATTR_IMAGE.I_WID],u=d[ATTR_IMAGE.I_HT],p=J("#mainRect").offset(),g=J("#resizeGridSVG")[0],f=g.querySelector("rect"),E=J(f).offset(),T={};T.cropLeft=p.left-E.left,T.cropTop=p.top-E.top,T.cropRight=s-(T.cropLeft+c),T.cropBottom=l-(T.cropTop+u),o.cropRect=T}return o}},IMG_WIDTH:{get:function(e,i){return TransformHandler.getCurrentObjectInfo().isCropActive?t.originalWidth:t.wid},set:function(e,i,n){var o={};if(o.wid=i,o.widUnit="px",J("#keepaspect").zbutton("getAttribute","checked")){var a=i*t.naturalHeight/t.naturalWidth;Z(r.IMG_HEIGHT).zlabelednumberfield("setAttributes",{suffix:"px"}),Z(r.IMG_HEIGHT).zlabelednumberfield("setValue",a),o.ht=a}if(TransformHandler.getCurrentObjectInfo().isCropActive){var s=o.wid?o.wid:panleData.originalWidth,l=o.ht;o={};var d=editor.doc.getRawFormat(editor.doc.getSelection().getStart()),c=d[ATTR_IMAGE.I_WID],u=d[ATTR_IMAGE.I_HT],p=J("#mainRect").offset(),g=J("#resizeGridSVG")[0],f=g.querySelector("rect"),E=J(f).offset(),T={};T.cropLeft=p.left-E.left,T.cropTop=p.top-E.top,T.cropRight=s-(T.cropLeft+c),T.cropBottom=l-(T.cropTop+u),o.cropRect=T}return o}},IMG_CROP:{set:function(e,t,i){TransformHandler.showCrop()}},IMG_CROP_ASPECT_RATIO:{get:function(e,i){for(var n=t.wid/t.ht,o=!1,a=[1,2/3,.75,.6,.8,1.5,4/3,5/3,5/4,16/9,1.6],s=0;s<a.length;s++){var l=a[s];if(l==n){o=!0,Z(r.IMG_CUSTOM_CROP).hide(),Z(r.IMG_CROP_MENU).zmenu("check",r.IMG_CROP_ASPECT_RATIO+(s+1));break}}o||t.cropRect?o||(Z(r.IMG_CROP_MENU).zmenu("checkAllItems",!1),TransformHandler.getCurrentObjectInfo().isCropActive?Z(r.IMG_CUSTOM_CROP).show():Z(r.IMG_CUSTOM_CROP).hide()):(Z(r.IMG_CROP_MENU).zmenu("checkAllItems",!1),Z(r.IMG_CUSTOM_CROP).hide())},set:function(e,i,n){var o=i.getAttribute("data-label");if("-1"==o.indexOf("Custom")){var a={};Z(r.IMG_CUSTOM_CROP).hide();var s=parseInt(o.split(":")[0]),l=parseInt(o.split(":")[1]),a=C(s,l,t.wid,t.ht,t.originalWidth,t.originalHeight);return a}Z(r.IMG_CUSTOM_CROP).show()}},IMG_CROP_HEIGHT:{get:function(e,i){return t.ht},set:function(e,i,n){var o={},r=parseFloat(i);if(J("#keepaspectforcrop").zbutton("getAttribute","checked")){var a=r*t.wid/t.ht;o=y(a,r,t.originalWidth,t.originalHeight)}else o=y(t.wid,r,t.originalWidth,t.originalHeight);return o}},IMG_CROP_WIDTH:{get:function(e,i){return t.wid},set:function(e,i,n){var o={},r=parseFloat(i);if(J("#keepaspectforcrop").zbutton("getAttribute","checked")){var a=r*t.ht/t.wid;o=y(r,a,t.originalWidth,t.originalHeight)}else o=y(r,t.ht,t.originalWidth,t.originalHeight);return o}},IMG_REMOVE_BG:{set:function(){ImageHandler.removeBackground()}},IMG_OPACITY:{get:function(e,i){return parseInt(t.opacity)},set:function(e,t,i){var n={};return n.opacity=t,n}},IMG_BORDER_COLOR:{get:function(e,i){var n=!!t[ATTR_BORDERS.COLOR]&&t[ATTR_BORDERS.COLOR];return v(n,!0),n},set:function(e,t,i){if(arguments[4].fromUI){var n=Utils.getColorReference(arguments[4]);v(ZWColorUtils.rgbToHex(n),!0);var r={};return r.border={key:"color",value:n,sides:o},r}}},IMG_BORDER_WIDTH:{get:function(e,i){0==t[ATTR_BORDERS.WIDTH]?Z(r.BDR_WIDTH_MENU).zmenu("checkAllItems",!1):Z(r.BDR_WIDTH_MENU).zmenu("check",r.BDR_WIDTH_MENU_ITEM+t[ATTR_BORDERS.WIDTH])},set:function(e,t,i){var n=$(t).attr("value"),r={};return r.border={key:"width",value:n,sides:o},r}},IMG_BORDER_TYPE:{get:function(e,i){0==t[ATTR_BORDERS.TYPE]?Z(r.BDR_WIDTH_MENU).zmenu("checkAllItems",!1):Z(r.BDR_STYLE_MENU).zmenu("check",r.BDR_STYLE_MENU_ITEM+t[ATTR_BORDERS.TYPE])},set:function(e,i,n){t[ATTR_BORDERS.TYPE]=i;var r=$(i).attr("value"),a={};return a.border={key:"type",value:r,sides:o},a}},IMAGE_WRAP:{get:function(e,i){return"square"==t[ATTR_IMAGE.I_WRAP_TYPE]&&"align"==t.positionH[ATTR_IMAGE.I_POSITION_TYPE]?(Z(r.IMG_WRAP_TYPE).text(J.i18n(a[t.positionH[ATTR_IMAGE.I_ALIGN_VAL]])),t.positionH[ATTR_IMAGE.I_ALIGN_VAL]):t[ATTR_IMAGE.I_WRAP_TYPE]?(Z(r.IMG_WRAP_TYPE).text(J.i18n(a[t[ATTR_IMAGE.I_WRAP_TYPE]])),t[ATTR_IMAGE.I_WRAP_TYPE]):(Z(r.IMG_WRAP_TYPE).text(J.i18n(a.inline)),"inline")},set:function(e,i,n){var o={};return o[ATTR_IMAGE.I_WRAP_TYPE]=e.params,"inline"==e.params&&(o[ATTR_IMAGE.I_WRAP_TYPE]="",o[ATTR_IMAGE.I_H_POSITION]="",o[ATTR_IMAGE.I_V_POSITION]=""),"custom"!=t.marginType?Z(r.IMAGE_CUSTOM_MARGIN).hide():Z(r.IMAGE_CUSTOM_MARGIN).show(),o}},IMG_MARGIN_TYPE:{get:function(e,i){var n=t.marginType;return t.isFloatImg?(J(i).zlabeledselectbox("setAttribute","disabled",!1),"custom"==t.marginType?Z(r.IMAGE_CUSTOM_MARGIN).show():Z(r.IMAGE_CUSTOM_MARGIN).hide()):(J(i).zlabeledselectbox("setAttribute","disabled",!0),Z(r.IMAGE_CUSTOM_MARGIN).hide()),n},set:function(e,t,i){var n={};if("custom"==t)return void Z(r.IMAGE_CUSTOM_MARGIN).show();var o=Conversions.toGlobalUnit(parseFloat(t)+"in");return o="mm"==Conversions.globalUnit?parseInt(o):o,o+=Conversions.globalUnit,n.marginTop=n.marginLeft=n.marginRight=n.marginBottom=o,Z(r.IMAGE_CUSTOM_MARGIN).hide(),n}},IMG_MARGIN_TOP:{get:function(e,i){return parseFloat(Conversions.toGlobalValue(t.marginTop))},set:function(e,t,i){var n={};return n.marginTop=t+Conversions.globalUnit,n}},IMG_MARGIN_BOTTOM:{get:function(e,i){return parseFloat(Conversions.toGlobalValue(t.marginBottom))},set:function(e,t,i){var n={};return n.marginBottom=t+Conversions.globalUnit,n}},IMG_MARGIN_LEFT:{get:function(e,i){return parseFloat(Conversions.toGlobalValue(t.marginLeft))},set:function(e,t,i){var n={};return n.marginLeft=t+Conversions.globalUnit,n}},IMG_MARGIN_RIGHT:{get:function(e,i){return parseFloat(Conversions.toGlobalValue(t.marginRight))},set:function(e,t,i){var n={};return n.marginRight=t+Conversions.globalUnit,n}},IMG_ALIGN:{get:function(e,i){var n=Z(r.IMG_ALIGN_BTN);if("front"==t[ATTR_IMAGE.I_WRAP_TYPE]||"behind"==t[ATTR_IMAGE.I_WRAP_TYPE]){n.zlabeledmenubutton("setAttribute","disabled",!1);var o,a=PositionPreset.getPresetFromPosition(t);"custom"!=a?(o=PositionPreset.getClassAndPresetType(a).className,ZWArrayUtils.arrayContains(Object.keys(s),o)?(a="img-"+a,Z(r.IMG_PRESET_CUSTOM).removeClass("is-selected"),Z(r.IMG_ALIGN_PRESET_MENU).zmenu("setMenuItemsAttribute",[Z(a)],"checked",!0)):(Z(r.IMG_PRESET_CUSTOM).addClass("is-selected"),Z(r.IMG_ALIGN_PRESET_MENU).zmenu("setMenuItemsAttribute",[J(".img-align-preset-item")],"checked",!1),o="custom")):(Z(r.IMG_PRESET_CUSTOM).addClass("is-selected"),Z(r.IMG_ALIGN_PRESET_MENU).zmenu("setMenuItemsAttribute",[J(".img-align-preset-item")],"checked",!1),o="custom"),n.find(".ui-zlblbtn-desc").text(J.i18n(s[o]))}else n.zlabeledmenubutton("setAttribute","disabled",!0)},set:function(e,t,i){var n=t.getAttribute("id"),o={},r=n.indexOf("-");return n=n.substring(r+1),o.imgAlign=PositionPreset.getPositionFromPreset(n),o}},IMG_ROTATE_CW:{get:function(e,i){Z(r.IMAGE_ROTATE_DEGREE).html(t.rotation)},set:function(e,i,n){var o=t.rotation+90;o>360&&(o%=360);var r={};return r.rotation=o,r}},IMG_ROTATE_ACW:{get:function(e,i){Z(r.IMAGE_ROTATE_DEGREE).html(t.rotation)},set:function(e,i,n){var o=t.rotation-90;o<0&&(o=270);var r={};return r.rotation=o,r}},IMG_ALTTXT:{get:function(e,i){return t.altTxt?t.altTxt:""},set:function(e,t,i){var n={};return n.altTxt=t,n}},IMG_TOOLTIPTXT:{get:function(e,i){return t.tooltipText?t.tooltipText:""},set:function(e,t,i){var n={};return n.tooltipText=t,n}},IMG_REMOVE_BORDER:{set:function(){ImagePanel.removeBorder()}}},d={beforeFillValues:function(){t={isOrgSize:!1,isFitWid:!1,ht:null,wid:null,opacity:null,width:!1,type:!1,color:!1,al:null,marginTop:null,marginLeft:null,marginRight:null,marginBottom:null,marginType:null,rotation:null,altTxt:null,tooltipText:null,borders:{},naturalHeight:null,naturalWidth:null,cropRect:null},t=c(t)},init:function(){R()},get:function(e,t){var i=l[e.action].get;if(i)return i(e,t)},set:function(e,i,n,o,r){if(e){arguments[5]&&arguments[5].keyCode==KEYS.TAB?EventHandler.isDialogFocused=!0:EventHandler.isDialogFocused=!1;var a=l[e.action].set,s=a&&a.apply(null,arguments);if(null!=s){for(var d in s)t[d]=s[d];u(s)}}}},c=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE),i=t.attr(),n=i[ATTR_COMMON.BORDERS];e[ATTR_COMMON.BORDERS]=n?n:{},BorderUtils.convertZWColorToRGB(e[ATTR_COMMON.BORDERS]);var o={};for(var r in e[ATTR_COMMON.BORDERS])"0px"!=e[ATTR_COMMON.BORDERS][r][ATTR_BORDERS.WIDTH]&&(o[r]=e[ATTR_COMMON.BORDERS][r]);e.isOrgSize=i.ht==i.orginalHt&&i.wid==i.orginalWid,e.isFitWid=i.wid==DocLayoutManager.getColumnWidthAtIdx(editor.doc.getSelection().getStart()),e.ht=i.ht,e.wid=i.wid,e.opacity=i.op?i.op:"100",e[ATTR_IMAGE.I_WRAP_TYPE]=i[ATTR_IMAGE.I_WRAP_TYPE],e.marginTop=i.mt,e.marginLeft=i.ml,e.marginRight=i.mr,e.marginBottom=i.mb,e.marginType=ImagePanel.getMarginType(i),e.rotation=i.rotation?i.rotation:0,e.tooltipText=i.tooltip,e.altTxt=i.alt,e.naturalHeight=i.orginalHt,e.naturalWidth=i.orginalWid,e.isFloatImg=DTUtils.isWrappingFloatImage(i),e.positionH=i[ATTR_IMAGE.I_H_POSITION],e.positionV=i[ATTR_IMAGE.I_V_POSITION];var a=ZWImageUtils.getOrginalHeighWidthOfImage(i);return e.originalWidth=parseFloat(a.wid),e.originalHeight=parseFloat(a.ht),i.cropRect&&(e.cropRect=i.cropRect),jQuery.isEmptyObject(e[ATTR_COMMON.BORDERS])||(e[ATTR_BORDERS.COLOR]=e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.COLOR]||!1,e[ATTR_BORDERS.WIDTH]=e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]||!1,e[ATTR_BORDERS.TYPE]=e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.TYPE]||!1),e},u=function(e){var t=[],i=[],n={};e.border&&(e.borders=b(e.border),delete e.border);for(var o in e)p[o](n,e[o]);var r=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);editor.doc.getRawFormatAt(editor.doc.getSelection()[0].start).type===NODE_TYPE.CHART&&(r=editor.doc.getSelection().getParents(NODE_TYPE.CHART)),t.push(r),i.push(n),0!=t.length&&0!=i.length&&(i[0]&&!ZWJSONUtils.isEmptyObject(i[0])&&editor.doc.execCmd("applyStyle",[t,i,"updateImageStyle"]),(TransformHandler.getCurrentObjectInfo().isCropActive||i[0].cropRect)&&TransformHandler.showCrop(),(i[0].borders||i[0].positionH||i[0].positionV||i[0][ATTR_IMAGE.I_WRAP_TYPE]||i[0].cropRect||i[0].mt&&i[0].ml&&i[0].mr&&i[0].mb)&&_())},p={ht:function(e,t){e[ATTR_IMAGE.I_HT]=t},wid:function(e,t){e[ATTR_IMAGE.I_WID]=t},htUnit:function(e,t){e[ATTR_IMAGE.I_HT_UN]=t},widUnit:function(e,t){e[ATTR_IMAGE.I_WID_UN]=t},opacity:function(e,t){e[ATTR_IMAGE.I_OP]=t},marginTop:function(e,t){e[ATTR_IMAGE.I_MT]=t},marginLeft:function(e,t){e[ATTR_IMAGE.I_ML]=t},marginRight:function(e,t){e[ATTR_IMAGE.I_MR]=t},marginBottom:function(e,t){e[ATTR_IMAGE.I_MB]=t},rotation:function(e,t){e[ATTR_IMAGE.I_ROTATE]=t,Z(r.IMAGE_ROTATE_DEGREE).html(t)},altTxt:function(e,t){e[ATTR_IMAGE.I_ALT]=t},tooltipText:function(e,t){e[ATTR_IMAGE.I_TOOLTIP]=t},wrapType:function(e,t){if(""!=t){var i=editor.doc.getSelection().getStart(),n=ZWJSONUtils.clone(editor.doc.getRawFormatAt(i));n[ATTR_IMAGE.I_WRAP_TYPE]=t;var o=F(n);n[ATTR_IMAGE.I_H_POSITION]=o[ATTR_IMAGE.I_H_POSITION],n[ATTR_IMAGE.I_V_POSITION]=o[ATTR_IMAGE.I_V_POSITION],"left"==t||"right"==t?(n[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="align",n[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_ALIGN_VAL]=t,n[ATTR_IMAGE.I_WRAP_TYPE]="square"):(n[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",n[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_FROM]="column");var r=Conversions.isInInches?"0.125in":"3mm";DTUtils.isNonWrappingFloatImage(n)&&(r=Conversions.isInInches?"0in":"0mm"),n.ml=n.mr=n.mt=n.mb=r;var a=J(".imgsvgrect").offset();n.top&&n.left&&(n.shapeData.props.transform.pos.top=n.top,n.shapeData.props.transform.pos.left=n.left),ImageActions.moveFloatingImage(a,i,n)}else e[ATTR_IMAGE.I_WRAP_TYPE]=t},borders:function(e,t){e.borders=t},cropRect:function(e,t){e.cropRect=t},positionH:function(e,t){e[ATTR_IMAGE.I_H_POSITION]=t},positionV:function(e,t){e[ATTR_IMAGE.I_V_POSITION]=t},imgAlign:function(e,t){if(t){var i=J(".imgsvgrect").offset(),n=editor.doc.getSelection().getStart(),o=editor.doc.getRawFormatAt(n),r=extend({},o,t);ImageActions.moveFloatingImage(i,n,r,!0)}}},g=function(){editor.getRole().permissions.can("document.edit")&&PubSub.subscribe(["Document/ImageStructureModified","Document/UndoRedo","Document/CursorPositionChanged","ZWSelection/ImageDeleted"],f,{async:!0,timeout:500})},f=function(){var e="image"==editor.doc.getElementAt(editor.doc.getSelection().getStart()).type||!1,t=editor.doc.getSelection().getStart();if(e&&"image"==TransformHandler.getCurrentObjectInfo().type){var i=editor.doc.getRawFormatAt(t);i.type===NODE_TYPE.CHART||"widget"==i.subType||i.subType==ATTR_CHART.CHART||i[MAILMERGE.MMINFO]||i[ATTR_FILLABLEFIELD.FF_INFO]||i.subType==NODE_TYPE.QRCODE||i.subType==NODE_TYPE.BARCODE||i[ATTR_COMMON.CLS]==NODE_TYPE.SIGNERFIELD||i.shapeData?T():E()}else T()},E=function(){if(i){editor.doc.getSelection();ImagePanel.refreshValues()}else Z("menu-img-parent").show(),LayoutManager.isRichEditActive()?ImagePanel.open():I();i=!0},T=function(){i&&(i=!1,Z("menu-img-parent").hide(),PubSub.publish("Imagepanel/Closed"),ImagePanel.close())},m=function(){Z(e.IMAGEOPTIONSPANEL)[0]&&(LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(e.IMAGEOPTIONSPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",e.IMAGEOPTIONSPANEL),I())},h=function(){LeftPanel.closeDynamicPanel(e.IMAGEOPTIONSPANEL)},I=function(){_()},_=function(){var t=Z(e.IMAGEOPTIONSPANEL);t.data("ZCtrackObjects")?t.ZCtrackObjects("refreshValues"):(t.ZCtrackObjects({callbacks:ImagePanel.panelInfo,fillVisible:!1}),g())},A=function(){LeftPanel.findPanelObj(e.IMAGEOPTIONSPANEL)>=0?ImagePanel.close():ImagePanel.open()},S=function(e){var t=parseFloat(e[ATTR_IMAGE.I_ML]),i=parseFloat(e[ATTR_IMAGE.I_MR]),n=parseFloat(e[ATTR_IMAGE.I_MT]),o=parseFloat(e[ATTR_IMAGE.I_MB]);return isNaN(t)||isNaN(i)||isNaN(n)||isNaN(o)?"none":t!=i||n!=o||n!=i?"custom":t==1/8||.25==t||t==3/8||.5==t||0==t?t:3!=t&&6!=t&&9!=t&&12!=t||"mm"!=Conversions.globalUnit?"custom":3==t?1/8:6==t?.25:9==t?3/8:12==t?.5:void 0},R=function(){var e=editor.doc.getSelection(),t=DocLayoutManager.getPageWidthAtIdx(e.getStart()),i=t/Conversions.globalUnitInPx*.4,n=Conversions.step;i-=i%n;var o=0,r=J("#img-margin-right, #img-margin-left, #img-margin-bottom, #img-margin-top");ImagePanel.setMinMaxValue(r,o,i,n)},O=function(e,t,i,n){var o="mm"==Conversions.globalUnit?"0":"3";e.zlabelednumberfield("setAttributes",{min:t,max:i,step:n,suffix:Conversions.showUnit,decimalPlaces:o})},b=function(e){for(var i=e.key,o=e.value,a=e.sides,s=(editor.doc.getParents(NODE_TYPE.IMAGE,editor.doc.getSelection().getStart()),t[ATTR_COMMON.BORDERS]?DocUtil.copyStyle(t[ATTR_COMMON.BORDERS]):{}),l=!1,d=0,c=a.length;d<c;d++){var u=a[d];if(s&&s[u])("0px"==s[u].width||"width"==i&&"0px"==o)&&(s[u].width="1px",s[u].color="rgb(0,0,0)",s[u].type="solid"),"type"!=i&&"none"==s[u].type&&(s[u].type="solid"),"color"!=i&&"none"==s[u].color&&(s[u].color="rgb(0,0,0)"),s[u][i]=o;else{var e=DocUtil.copyStyle(n);e[i]=o,s[u]=e,l=!0}i==ATTR_BORDERS.TYPE&&"double"==o&&parseInt(s[u][ATTR_BORDERS.WIDTH])<3&&(s[u][ATTR_BORDERS.WIDTH]="3px");}return l&&(Z(r.BDR_WIDTH).zselectbox("setValue",s[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]),Z(r.BDR_STYLE).zselectbox("setValue",s[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.TYPE])),s},v=function(e){Z(r.BDR_WIDTH_MENU).find(".zmenu__icon").css({"border-top-color":e}),Z(r.BDR_STYLE_MENU).find(".zmenu__icon").css({"border-top-color":e}),Z(r.BDR_COLOR).zcolorselectbox("setValue",e)},D=function(e){var t,i;"string"==typeof e?t=e:(t=e[0],i=e[1]);var n={},o=editor.doc.getRawFormatAt(editor.doc.getSelection().getStart());if("square"==t||"left"==t||"right"==t||"front"==t||"behind"==t){n[ATTR_IMAGE.I_WRAP_TYPE]=t;var r=Conversions.isInInches?"0.125in":"3mm";DTUtils.isNonWrappingFloatImage(n)&&(r=Conversions.isInInches?"0in":"0mm"),n.marginTop=n.marginLeft=n.marginRight=n.marginBottom=r}else if("inline"==t)n[ATTR_IMAGE.I_WRAP_TYPE]="",n[ATTR_IMAGE.I_H_POSITION]="",n[ATTR_IMAGE.I_V_POSITION]="";else if("margin"==t){var a=Conversions.toGlobalUnit(parseFloat(i)+"in");a="mm"==Conversions.globalUnit?parseInt(a):a,a+=Conversions.globalUnit,n.marginTop=n.marginLeft=n.marginRight=n.marginBottom=a}PubSub.publish("Document/"+(o.shapeData?"ShapeStructureModified":"ImageStructureModified")),u(n)};PubSub.subscribe("TransformableObject/Created",function(){editor.getRole().permissions.can("document.edit")&&setTimeout(function(){f()},100)});var L=function(){var e={};e.border={key:"width",value:"0px",sides:o},N(),u(e)},N=function(){var e="rgb(0,0,0)";v(e,!0),Z(r.BDR_WIDTH_MENU).zmenu("checkAllItems",!1),Z(r.BDR_STYLE_MENU).zmenu("checkAllItems",!1)},P=function(){var e=W.get("#"+r.IMG_PRESET_CONTAINER)[0],t=e.querySelectorAll("[checked=checked]")[0],i=0;if(t){var n=t.getAttribute("id"),o=n.lastIndexOf("-"),a=n.substring(0,o),s=e.querySelectorAll("#"+a)[0];i=J(s).offset().top-J(e).offset().top}e.scrollTop=i},C=function(e,t,i,n,o,r){var a,s;a=n/t*e,a>i?(s=i/e*t,a=i):s=n;var l=y(a,s,o,r);return l},y=function(e,t,i,n){var o=(i-e)/2,r=(n-t)/2,a={cropTop:r,cropBottom:r,cropLeft:o,cropRight:o};return a=ZWImageUtils.convertCropDataToPercentage(a,n,i),{cropRect:a,ht:t,wid:e,htUnit:"px",widUnit:"px"}},F=function(e){var t={};return e&&e[ATTR_IMAGE.I_H_POSITION]?t[ATTR_IMAGE.I_H_POSITION]=e[ATTR_IMAGE.I_H_POSITION]:(t[ATTR_IMAGE.I_H_POSITION]={},t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_FROM]="column",t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=0),e&&e[ATTR_IMAGE.I_V_POSITION]?t[ATTR_IMAGE.I_V_POSITION]=e[ATTR_IMAGE.I_V_POSITION]:(t[ATTR_IMAGE.I_V_POSITION]={},t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_FROM]="paragraph",t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=0),t};return{refreshValues:_,open:m,close:h,panelInfo:d,handleImagePropWrapper:A,toggleImageOptions:f,panelData:t,getMarginType:S,setMinMaxValue:O,applyStyleInContextMenu:D,updateBorderUIbasedOnColor:v,removeBorder:L,setScrollTopForPresets:P,getDefaultImagePostionJson:F}}(ELEM_ID),DropcapPanel=function(e){"use strict";var t={},i="mm"==Conversions.globalUnit?"0":"3",n={beforeFillValues:function(){t={POSITION:null,LINES_TO_DROP:null,FILL_COLOR:null,STROKE_COLOR:null,FONTFAMILY:null,FONTSIZE:null,BOLD:!1,ITALIC:null,UNDERLINE:null,SRIKETHROUGH:null,MARGIN_RIGHT:null,MARGIN_BOTTOM:null,REFLECTION:null,SHADOW:null,STROKE_WIDTH:null,STROKE_STYLE:null},t=c(t),g()},get:function(e,t){var i=l[e.action]&&l[e.action].get;if(i)return i(e,t)},set:function(e,i,n,o,r){arguments[5]&&arguments[5].keyCode==KEYS.TAB?EventHandler.isDialogFocused=!0:EventHandler.isDialogFocused=!1;var a=l[e.action]&&l[e.action].set,s=a&&a(e,i,n,r);if(null!=s){for(var d in s)t[d]=s[d];u(s)}}},o=function(){d()},r=function(){},a=function(){if(!LeftPanel.isPanelVisible(e.DROPCAPPANEL)){var t=ANIMATIONS.FLIPIN;LeftPanel.isPanelVisible(e.SHAPESPANEL)&&(InsertShape.closeShapeToolbar(),t=ANIMATIONS.FADEIN),LeftPanel.showSubPanel(e.DROPCAPPANEL,t)}o()},s=function(){var t=editor.doc.getSelection().getStart(),i=editor.doc.getRawFormatAt(t);i&&i.shapeData&&i.shapeData.dropcapData&&(LeftPanel.closeDynamicPanel(e.DROPCAPPANEL),r())},l={POSITION:{get:function(e,i){if(t.POSITION==e.params){var n="#"+J("input:radio[name='Position'][value='"+e.params+"']").attr("id");return J("#dctypescontainer").zlabeledbuttonset("setButtonsAttribute",[n],"checked",!0),!0}},set:function(e,t,i){var n={};return n.POSITION={value:t,params:e.params},n}},LINES_TO_DROP:{get:function(e,i){return t.LINES_TO_DROP},set:function(e,t,i){var n={};return n.LINES_TO_DROP={value:t},n}},FILL_COLOR:{get:function(e,i){return t.FILL_COLOR},set:function(e,t,i,n){InsertShape.changeShapeFillColor(e,n)}},STROKE_COLOR:{get:function(e,i,n){return t.STROKE_COLOR},set:function(e,t,i,n){InsertShape.changeStrokeColor(e,n)}},FONTFAMILY:{get:function(e,i){FontComboUtil.updateFontFamily(t.FONTFAMILY,t.FONTWEIGHT,"dropcap-fontfamily")},set:function(e,t,i){var n={};return n.FONTFAMILY={value:t},n}},FONTSIZE:{get:function(e,i){Toolbar.updateFontSize(parseInt(t.FONTSIZE),Z("dropcap-fontsize"))},set:function(e,t,i){var n={};return n.FONTSIZE={value:t},n}},BOLD:{get:function(e,i){return Z("dc-bold").zbuttonset(t.BOLD?"check":"uncheck"),t.BOLD},set:function(e,t,i){var n={};return n.BOLD={value:"bold"},n}},ITALIC:{get:function(e,i){return Z("dc-italic").zbuttonset(t.ITALIC?"check":"uncheck"),t.ITALIC},set:function(e,t,i){var n={};return n.ITALIC={value:"italic"},n}},UNDERLINE:{get:function(e,i){return Z("dc-underline").zbuttonset(t.UNDERLINE?"check":"uncheck"),t.UNDERLINE},set:function(e,t,i){var n={};return n.UNDERLINE={value:"underline"},n}},SRIKETHROUGH:{get:function(e,i){return Z("dc-strikethrough").zbuttonset(t.SRIKETHROUGH?"check":"uncheck"),t.SRIKETHROUGH},set:function(e,t,i){var n={};return n.SRIKETHROUGH={value:"strikethrough"},n}},MARGIN_RIGHT:{get:function(e,n){var o=t.MARGIN_RIGHT||"0.000";return J(n).zlabelednumberfield("setAttribute","max",parseFloat(Conversions.toGlobalValue("2in"))),J(n).zlabelednumberfield("setAttribute","min",parseFloat(Conversions.toGlobalValue("0in"))),J(n).zlabelednumberfield("setAttribute","suffix",Conversions.showUnit),J(n).zlabelednumberfield("setAttribute","step",Conversions.step),J(n).zlabelednumberfield("setAttribute","decimalPlaces",i),parseFloat(Conversions.toGlobalValue(o))},set:function(e,t,i){var n={};return n.MARGIN_RIGHT={value:t},n}},MARGIN_BOTTOM:{get:function(e,n){var o=t.MARGIN_BOTTOM||"0.000";return J(n).zlabelednumberfield("setAttribute","max",parseFloat(Conversions.toGlobalValue("2in"))),J(n).zlabelednumberfield("setAttribute","min",parseFloat(Conversions.toGlobalValue("0in"))),J(n).zlabelednumberfield("setAttribute","suffix",Conversions.showUnit),J(n).zlabelednumberfield("setAttribute","step",Conversions.step),J(n).zlabelednumberfield("setAttribute","decimalPlaces",i),parseFloat(Conversions.toGlobalValue(o))},set:function(e,t,i){var n={};return n.MARGIN_BOTTOM={value:t},n}}},d=function(){var t=Z(e.DROPCAPPANEL);t.data("ZCtrackObjects")&&LeftPanel.isPanelVisible(e.DROPCAPPANEL)?t.ZCtrackObjects("refreshValues"):(t.ZCtrackObjects({callbacks:n,fillVisible:!1}),J("#dropcap-lpnl-fgcolor").zcolorselectbox("setValue",Doc.curForeGrdColor))},c=function(e){var t=editor.doc.getSelection().getStart(),i=editor.doc.getRawFormatAt(t),n=i.shapeData,o=n.dropcapData;if(!o)return{length:0};var r="shadowNone",a="preset0";n.props.effects&&(n.props.effects.reflection&&(a=n.props.effects.reflection.preset&&n.props.effects.reflection.preset.toLowerCase()),n.props.effects.shadow&&(r=n.props.effects.shadow.distance&&"shadow"+n.props.effects.shadow.distance.angle)),e.POSITION=o.type,e.LINES_TO_DROP=o.linestodrop,"SOLID"==n.props.fill.type?e.FILL_COLOR="rgb("+n.props.fill.solid.color.rgb.toString()+")":e.FILL_COLOR="transparent","SOLID"==n.props.stroke.fill.type?e.STROKE_COLOR="rgb("+n.props.stroke.fill.solid.color.rgb.toString()+")":e.STROKE_COLOR="transparent";var s=n.textBody.paras[0].portions[0].props;if(e.BOLD=!1,e.FONTWEIGHT=null,s.fontweight){var l=s.fontweight;"BOLD"!=l&&"HEAVY"!=l&&"BLACK"!=l||(e.BOLD=!0),e.FONTWEIGHT=WRITER_FONT_WEIGHT_MAP[l]}s.bold&&(e.BOLD=!0),e.FONTFAMILY=s.font.fontFamily.name,e.FONTSIZE=s.size,e.ITALIC=!!s.italic,e.UNDERLINE="SINGLE"==s.underline,e.SRIKETHROUGH="SINGLE"==s.strike,e.MARGIN_RIGHT=n[ATTR_IMAGE.I_MR]||0,e.MARGIN_BOTTOM=n[ATTR_IMAGE.I_MB]||0,e.SHADOW=r,e.REFLECTION=a,e.STROKE_WIDTH=n.props.stroke.width,e.STROKE_STYLE=n.props.stroke.type,e.STROKE_COLOR="NONE"!=n.props.stroke.fill.type?"rgb("+n.props.stroke.fill.solid.color.rgb.toString()+")":"rgb(255,255,255)",e.FILL_COLOR=InsertShape.getRGBFillColor(n);var d="transparent";return"SOLID"==s.fill.type&&(d="rgb("+s.fill.solid.color.rgb.toString()+")"),e.FONT_COLOR=d,e},u=function(e){for(key in e){var t=p[key];t&&t(e[key])}},p={POSITION:function(e){DropCap.modifyDropcapProperty("POSITION",e.params)},LINES_TO_DROP:function(e){DropCap.modifyDropcapProperty("LINESTODROP",e.value)},BOLD:function(e){InsertShape.processTxtFormat(["bold"])},ITALIC:function(e){InsertShape.processTxtFormat(["italic"])},UNDERLINE:function(e){InsertShape.processTxtFormat(["underline"])},SRIKETHROUGH:function(e){InsertShape.processTxtFormat(["strikethrough"])},MARGIN_RIGHT:function(e){DropCap.modifyDropcapProperty("DISTANCEFROMRIGHT",e.value+Conversions.globalUnit)},MARGIN_BOTTOM:function(e){DropCap.modifyDropcapProperty("DISTANCEFROMBOTTOM",e.value+Conversions.globalUnit)},FONTFAMILY:function(e){if(InsertShape.processTxtFormat(["FontName",e.value]),e.value.length>1){var t=e.value[1];t>=700?Z("dc-bold").zbutton("check"):Z("dc-bold").zbutton("uncheck")}},FONTSIZE:function(e){InsertShape.processTxtFormat(["fontsize",e.value])}},g=function(){t&&(Z("shadowpresetmenu").zmenu("check",t.SHADOW),Z("reflectionpresetmenu").zmenu("check",t.REFLECTION),Z("strokewidthmenu").zmenu("check","strokewidth"+t.STROKE_WIDTH),Z("strokestylemenu").zmenu("check","strokestyle_"+t.STROKE_STYLE))},f=function(e){InsertShape.processTxtFormat(e);var t=editor.doc.getSelection().getStart(),i=editor.doc.getRawFormatAt(t),n=i.shapeData,o=n.textBody.paras[0].portions[0].props;Toolbar.updateFontSize(parseInt(o.size),Z("dropcap-fontsize"))};return PubSub.subscribe("TransformableObject/destroyed",s),{refreshValues:d,open:a,close:s,incDecFontSize:f}}(ELEM_ID);Imagelibrary.prototype={replaceImageAction:!1,openInsertImgDlg:function(e){if(editor.isOffline()&&ZWOffline.isOfflineOperationsAllowed())OfflineImpl.insertImageOffline();else{this.isTableBackground=!1,this.isCellBackground=!1,this.isImageList=!1,"list"===e?this.isImageList=!0:"cell"==e?this.isCellBackground=!0:"table"==e&&(this.isTableBackground=!0);var t={insertFrom:"uploadFromLocal",noOfImagesToBeSelected:IMAGELIBRARY_MAXCOUNT_TOBEUPLOAD,gadgetsURL:"//"+editorProps.urls.gadgetServerURL};0!=Object.keys(Imagelibrary.getAppData()).length?t=J.extend({},t,Imagelibrary.getAppData()):0!=Object.keys(Macros.getImageLibRemoteOptions()).length&&(t=J.extend({},t,Macros.getImageLibRemoteOptions()));var i=editorProps.deployment.customername;"baihui"!==i&&"fuji"!==i||(t.enableGadgets=!1);var n=editorProps.permissionsInfo.appInfo.NAME;"wiki"!==n&&"CONTRACT_MGMT"!==n||(t.enableGooglePhotos=!1,t.enableFlickr=!1,t.enableWebSearch=!1),FCImageLibrary.open(t),J("#imagelibrary").on("imageinsert",function(e,t){var i=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);i&&"image"==TransformHandler.getCurrentObjectInfo().type&&!InsertShape.getSelectedShape()&&(Imagelibrary.replaceImageAction=!0),Imagelibrary.newattr={};var n={},o=[],r=[];if(o=t.info,o[0].hasOwnProperty("RESOURCE_ID")){for(var a=0,s=o.length;a<s;a++){var l={};l.IMAGE_EXTENSION=o[a].IMAGE_EXTENSION,l.RESOURCE_ID=o[a].RESOURCE_ID,l.IMAGE_NAME=o[a].IMAGE_NAME,r.push(l)}n.fcimagesinfo=JSON.stringify(r),n.rid=editor.doc.docInfo.RID,J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getUrl("fcompImageUpload"),data:n,async:!0,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(){UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_INSERT_IMAGE"),"showclose","normalfont",3e3)},success:function(e){if("SUCCESS"===e.STATUS){var t=[];t=e.IMAGELIST;for(var i=0,n=t.length;i<n;i++){var o=t[i];if(Imagelibrary.replaceImageAction)Imagelibrary.replaceImage(o.IMAGE_URL);else{var r=Imagelibrary.checkImgWidHeight(o.IMAGE_WIDTH,o.IMAGE_HEIGHT);Imagelibrary.newattr[ATTR_IMAGE.I_HT]=r.IMAGE_HEIGHT,Imagelibrary.newattr[ATTR_IMAGE.I_WID]=r.IMAGE_WIDTH,Imagelibrary.newattr[ATTR_IMAGE.I_ORGINALHT]=r.IMAGE_HEIGHT,Imagelibrary.newattr[ATTR_IMAGE.I_ORGINALWID]=r.IMAGE_WIDTH,Imagelibrary.newattr[ATTR_IMAGE.I_SRC]=o.IMAGE_URL,InsertShape.getSelectedShape()?InsertShape.changeShapeProperty(["fillimage",[o.IMAGE_URL,r.IMAGE_WIDTH,r.IMAGE_HEIGHT]]):Imagelibrary.isImageList?ListOperation.applyUserImageList(Imagelibrary.newattr):Imagelibrary.isCellBackground?CellBorders.uploadCellBackGroundImage(Imagelibrary.newattr):Imagelibrary.isTableBackground?TableBorders.uploadTableBackGroundImage(Imagelibrary.newattr):editor.doc.execCmd("insimg",[Imagelibrary.newattr])}}}else"FAILED"===e.STATUS&&UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_INSERT_IMAGE"),"showclose","normalfont",3e3)}})}else if(o[0].hasOwnProperty("IMAGE_URL"))Imagelibrary.insertWebImage(o);else if(o[0].hasOwnProperty("uploadedFileUrl"))if(Imagelibrary.replaceImageAction)Imagelibrary.replaceImage(o[0].uploadedFileUrl);else{var d=Imagelibrary.checkImgWidHeight(o[0].IMAGE_WIDTH,o[0].IMAGE_HEIGHT);Imagelibrary.newattr[ATTR_IMAGE.I_HT]=d.IMAGE_HEIGHT,Imagelibrary.newattr[ATTR_IMAGE.I_WID]=d.IMAGE_WIDTH,Imagelibrary.newattr[ATTR_IMAGE.I_ORGINALHT]=d.IMAGE_HEIGHT,Imagelibrary.newattr[ATTR_IMAGE.I_ORGINALWID]=d.IMAGE_WIDTH,Imagelibrary.newattr[ATTR_IMAGE.I_SRC]=o[0].uploadedFileUrl,InsertShape.selectedShape()?InsertShape.changeShapeProperty(["fillimage",[o[0].uploadedFileUrl,d.IMAGE_WIDTH,d.IMAGE_HEIGHT]]):Imagelibrary.isImageList?ListOperation.applyUserImageList(Imagelibrary.newattr):Imagelibrary.isCellBackground?CellBorders.uploadCellBackGroundImage(Imagelibrary.newattr):Imagelibrary.isTableBackground?TableBorders.uploadTableBackGroundImage(Imagelibrary.newattr):editor.doc.execCmd("insimg",[Imagelibrary.newattr])}FCImageLibrary.close()})}}},Imagelibrary.prototype.insertWebImage=function(e){if(Imagelibrary.replaceImageAction)Imagelibrary.replaceImage(e[0].IMAGE_URL);else for(var t=0,i=e.length;t<i;t++){var n=e[t],o=Imagelibrary.checkImgWidHeight(n.IMAGE_WIDTH,n.IMAGE_HEIGHT);Imagelibrary.newattr[ATTR_IMAGE.I_HT]=o.IMAGE_HEIGHT,Imagelibrary.newattr[ATTR_IMAGE.I_WID]=o.IMAGE_WIDTH,Imagelibrary.newattr[ATTR_IMAGE.I_ORGINALHT]=o.IMAGE_HEIGHT,Imagelibrary.newattr[ATTR_IMAGE.I_ORGINALWID]=o.IMAGE_WIDTH,Imagelibrary.newattr[ATTR_IMAGE.I_SRC]=n.IMAGE_URL,InsertShape.getSelectedShape()?InsertShape.changeShapeProperty(["fillimage",[n.IMAGE_URL,o.IMAGE_WIDTH,o.IMAGE_HEIGHT]]):Imagelibrary.isImageList?ListOperation.applyUserImageList(Imagelibrary.newattr):Imagelibrary.isCellBackground?CellBorders.uploadCellBackGroundImage(Imagelibrary.newattr):Imagelibrary.isTableBackground?TableBorders.uploadTableBackGroundImage(Imagelibrary.newattr):editor.doc.execCmd("insimg",[Imagelibrary.newattr])}},Imagelibrary.prototype.replaceImage=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);Imagelibrary.newattr=DocUtil.copyStyle(t.attr()),Imagelibrary.newattr&&Imagelibrary.newattr.cropRect&&(Imagelibrary.newattr.cropRect=null),Imagelibrary.newattr[ATTR_IMAGE.I_SRC]=e,Imagelibrary.newattr[ATTR_IMAGE.I_ID]="",editor.doc.execCmd("applyStyle",[t,Imagelibrary.newattr,"replaceImage"]),Imagelibrary.replaceImageAction=!1},Imagelibrary.prototype.checkImgWidHeight=function(e,t){var i=editor.doc.getSelection(),n=DocLayoutManager.getContentWidthAtIndex(i.getStart()),o=DocLayoutManager.getContentHeightAtIndex(i.getStart()),r=editor.doc.getParents(NODE_TYPE.CELL,i.getStart());if(r){var a=r.attr(),s=TableUtil.getCellWidth(r).convertor().pixels,l=a[ATTR_CELL.TDS_PL]?a[ATTR_CELL.TDS_PL].convertor().pixels:Conversions.defaultCellPadding.convertor().pixels,d=a[ATTR_CELL.TDS_PR]?a[ATTR_CELL.TDS_PR].convertor().pixels:Conversions.defaultCellPadding.convertor().pixels;n=s-l-d}return e>n&&(t=t/e*n,e=n),t>o&&(e=e/t*o,t=o),{IMAGE_WIDTH:e,IMAGE_HEIGHT:t}},Imagelibrary.replaceImageAction=!0,Imagelibrary.prototype.getAppData=function(){return RemoteEditor.imgLibAppData},Imagelibrary=new Imagelibrary;var ZWImgLibDialog=function(){var e={UNKNOWN:"UNKNOWN",UPLOAD:"UPLOAD",WEB_URL:"WEB_URL",REMOTE:"REMOTE"},t={WIDTH:"WIDTH",HEIGHT:"HEIGHT",ORIG_HEIGHT:"ORIG_HEIGHT",ORIG_WIDTH:"ORIG_WIDTH",URL:"URL",IMAGE_NAME:"IMAGE_NAME"},i=function(e,t,i,n){if(!e||0===e.length)return[];for(var o={},r=0,a=e.length;r<a;r++){e[r];o.img_url=e[r].IMAGE_URL}o.tp_name=t,ZWNetworkUtils.setCsrfParam(o),J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getUrl("tpImageUpload"),data:o,async:!0,error:n,success:i})},n=function(e,t,i){if(!e||0===e.length)return[];for(var n=[],o=0,r=e.length;o<r;o++){var a=(e[o],{});a.IMAGE_EXTENSION=e[o].IMAGE_EXTENSION,a.RESOURCE_ID=e[o].RESOURCE_ID,a.IMAGE_NAME=e[o].IMAGE_NAME,n.push(a)}var s={};s.fcimagesinfo=JSON.stringify(n),s.rid=editor.doc.docInfo.RID,ZWNetworkUtils.setCsrfParam(s),J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getUrl("fcompImageUpload"),data:s,async:!0,error:i,success:t})},o=function(t){return t?t.hasOwnProperty("RESOURCE_ID")?e.UPLOAD:t.hasOwnProperty("IMAGE_URL")?e.WEB_URL:t.hasOwnProperty("uploadedFileUrl")?e.REMOTE:void 0:e.UNKNOWN},r=function(e){return e.uploadedFileUrl||e.IMAGE_URL.trim()},a=function(e){var t={};t.insertFrom=e.insertFrom?e.insertFrom:"uploadFromLocal",t.noOfImagesToBeSelected=IMAGELIBRARY_MAXCOUNT_TOBEUPLOAD,t.gadgetsURL="//"+editorProps.urls.gadgetServerURL,t.product_type=docProps.productInfo.product_type,t.owner_id=docProps.productInfo.owner_id,t.fileId=editor.doc.docInfo.RID,e.onBeforeInsert&&(t.onBeforeInsert=e.onBeforeInsert),0!=Object.keys(ImageHandler.getAppData()).length?t=J.extend({},t,ImageHandler.getAppData()):0!=Object.keys(Macros.getImageLibRemoteOptions()).length&&(t=J.extend({},t,Macros.getImageLibRemoteOptions()));var i=editorProps.deployment.customername;"baihui"!==i&&"fuji"!==i||(t.enableGadgets=!1);var n=editorProps.permissionsInfo.appInfo.NAME;return"wiki"!==n&&"CONTRACT_MGMT"!==n||(t.enableGooglePhotos=!1,t.enableFlickr=!1,t.enableWebSearch=!1),t},s=function(e){var i=[];if(!e||!e.length)return i;for(var n=0,o=e.length;n<o;n++){var a=e[n],s={};s[t.WIDTH]=a.IMAGE_WIDTH,s[t.HEIGHT]=a.IMAGE_HEIGHT,s[t.ORIG_WIDTH]=a.IMAGE_WIDTH,s[t.ORIG_HEIGHT]=a.IMAGE_HEIGHT,s[t.URL]=r(a),i.push(s)}return i},l=function(e,t,i,n){var o=jsCdnZWStaticPath+fingerPrintObj["js/fcomponents_imagelibrary.js"],r=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_imagelibrary.css"],a=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_common.css"],s=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_imagelibrary_customize.css"];zw.require({js:[o],css:[a,r,s]},[],function(){e(t,i,n)})},d=function(e,t,i){l(u,e,t,i)},c=function(t,r,a){var l=a.info,d=a.insertFrom;(!l||l.length<=0)&&r&&r("INSERT_IMG_FAILED");var c={},u=l[0];c.URL_TYPE=o(u);var p=function(e){c.DATA=s(e.IMAGELIST),t&&t(c)},g=function(){r&&r("INSERT_IMG_FAILED")};o(u)==e.UPLOAD?n(l,p,g):"Picasa"===d||"Flickr"===d?i(l,d,p,g):(c.DATA=s(a.info),t&&t(c))},u=function(e,t,i){var n=a(e);n.onInsert=c.bind(null,t,i),FCImageLibrary.open(n),e.multiselect&&J("#imagelibrary").zimagehandler("option","multiselect",!1),J("#library").on("zdialogbeforeclose",ImageHandler.beforeDialogClose)},p=function(){l(g)},g=function(){FCImageLibrary.close()};return{open:d,close:p,onImageInsert:c,loadImageLibraryResources:l,getOptions:a}}(),ImportDialog=function(){"use strict";var e="importdialog",t=!1,i=null,n={fillable:".docx, .doc, .docm, .dot, .dotm, .dotx, .rtf, .odt, .txt, .html, .htm, .tex, .pdf",fillablePDF:".pdf",merge:".docx, .doc, .docm, .dot, .dotm, .dotx, .rtf, .odt, .txt, .html, .htm, .tex, .pdf",mergePDF:".pdf",label:".docx, .lbt, .lbl",writer:".docx, .doc, .docm, .dot, .dotm, .dotx, .rtf, .odt, .txt, .html, .htm, .tex",sign:".docx, .doc, .docm, .dot, .dotm, .dotx, .rtf, .odt, .txt, .html, .htm, .tex, .pdf",signPDF:".pdf"},o=void 0,r=void 0,a=void 0,s=void 0,l=void 0,d=!1,c={init:function(e){f(),J("#imp-dlg-import-btn").addClass("ui-state-disabled"),J(".ds-imp-progress-icon,#imp-dlg-later-btn,#imp-dlg-opennw-btn").hide(),J("#imp-dlg-close-btn").show(),J("#output-format-selection-area").show(),s=void 0==s?"writer":s,u(),o.resolve()},get:function(e){"import_doc"==e.action&&b()},set:function(e,t,i){if("import_doc"==e.action&&UIUtils.enterKey(JrenameInput,b),"update-output-Resource-Type"==e.action){l=n[t],"writer"===t&&editorProps.userInfo.isZohoCorpUser&&(l+=", .pdf"),document.getElementById("importformat").innerHTML=": "+l;var o=document.getElementById("importbrowse");l+=", .zdoc, .zfdoc, .zmdoc",o.setAttribute("accept",l)}}},u=function(){switch(s){case"writer":l=n[s],editorProps.userInfo.isZohoCorpUser&&(l+=", .pdf"),J("#"+e+"zdialog").zdialog("setAttribute","title",J.i18n("writer.common.UPLOAD_DOCUMENT")),J("#importfilesize").text(J.i18n("writer.import.MAXIMUM_FILE_SIZE_ALLOWED_IN_WRITER",["50 MB","10 MB"]));break;case"label":case"fillable":case"merge":case"screenplayDoc":case"sign":l=n[s],J("#"+e+"zdialog").zdialog("setAttribute","title",J.i18n("writer.common.UPLOAD_DOCUMENT")),J("#importfilesize").text(J.i18n("writer.import.MAXIMUM_FILE_SIZE_ALLOWED_IN_WRITER",["50 MB","10 MB"]));break;case"fillablePDF":l=n[s],s="fillable",J("#output-format-selection-area").hide(),J("#importformatsinfo").hide(),J("#"+e+"zdialog").zdialog("setAttribute","title",J.i18n("writer.common.UPLOAD_PDF_FORM")),J("#importfilesize").text(J.i18n("writer.import.MAXIMUM_FILE_SIZE_ALLOWED_IN_DOC_FILLER",["10 MB"]));break;case"mergePDF":l=n[s],s="merge",J("#output-format-selection-area").hide(),J("#importformatsinfo").hide(),J("#"+e+"zdialog").zdialog("setAttribute","title",J.i18n("writer.common.UPLOAD_PDF_FORM")),J("#importfilesize").text(J.i18n("writer.import.MAXIMUM_FILE_SIZE_ALLOWED_IN_DOC_FILLER",["10 MB"]));break;case"signPDF":l=n[s],s="sign",J("#output-format-selection-area").hide(),J("#importformatsinfo").hide(),J("#"+e+"zdialog").zdialog("setAttribute","title",J.i18n("writer.common.UPLOAD_PDF_FORM")),J("#importfilesize").text(J.i18n("writer.import.MAXIMUM_FILE_SIZE_ALLOWED_IN_DOC_FILLER",["10 MB"]))}J("#output-format-selection").zselectbox("setValue","native"===s?"writer":s),document.getElementById("importformat").innerHTML=": "+l;var t=document.getElementById("importbrowse");l+=", .zdoc, .zfdoc, .zmdoc",t.setAttribute("accept",l)},p=function(e){loadImportComponentResource(g,e)},g=function(e){FCImport.updateImportStatus(e)},f=function(){var e=J("#imp-dlg-drop-area");e.off("dragenter").on("dragenter",function(e){e.preventDefault()}),e.off("dragover").on("dragover",function(e){e.preventDefault()}),e.off("drop").on("drop",function(e){var t=e.originalEvent.dataTransfer.files[0];t&&R(e.originalEvent.dataTransfer),e.preventDefault()}),J("#imp_desktop,#imp_url").on("change",function(e){"imp_url"==e.target.id?(J("#ds-imp-url-progress-cont").show(),J("#dashboard-import-url-progress").removeAttr("readonly","readonly"),J("#imp-dlg-drop-area").css("top","-228px"),J("#imp-dlg-browse-msg").css("opacity","0")):(J("#imp-dlg-drop-area").css("top","-61px"),J("#imp-dlg-browse-msg").css("opacity","1"))}),J("#ds-imp-another-doc").on("click",function(){A()}),J("#dashboard-import-url-progress").off("paste").on("paste",function(e){var t=E(e);b(t),e.stopPropagation(),e.preventDefault()}).off("keydown").on("keydown",function(e){var t=e.keyCode||e.which;if(91!=t&&!e.metaKey&&!e.ctrlKey){13==t&&b();var i=J(this).val();!i||i.length<=4?J("#imp-dlg-import-btn").addClass("ui-state-disabled"):J("#imp-dlg-import-btn").removeClass("ui-state-disabled")}}),J("#dashboard-import-pwd-input").on("keyup",function(e){var t=e.keyCode||e.which;t==KEYS.ENTER&&this.value.length>0?D():J("#imp-dlg-import-btn")[this.value.length>0?"removeClass":"addClass"]("ui-state-disabled")})},E=function(e){var t="";return t=window.clipboardData?window.clipboardData.getData("Text"):e.originalEvent.clipboardData.getData("text")},T=function(){return o=J.Deferred(),J.dialogutil.isDialogOpened("importdialog")?o.resolve():(PubSub.subscribe("Dialog/BeforeClose",L),J.dialogutil.open("importdialog",null,c)),o.promise()},m=function(){J.dialogutil.close("importdialog")},h=function(e,t){J(".ui-lp-radio-btn").hide(),J(".ds-imp-progress-icon").show(),J("#imp-dlg-browse-msg").css("opacity","0"),J("#ds-imp-pwd-req-cont").hide(),J("#import-drop-cont").hide(),J("#output-format-selection-area").hide(),"file"==e?(J("#ds-pc-imp-doc-name").text(t),J("#ds-imp-url-progress-cont").hide(),J("#ds-imp-pc-progress").show(),J("#imp-dlg-drop-area").css("top","-228px")):(J("#dashboard-import-url-progress").attr("readonly","readonly"),J(".ds-imp-progress-icon").show()),J("#imp-dlg-import-btn").text(J.i18n("writer.image.UPLOADING_MSG")).addClass("ui-state-disabled")},I=function(e){J(".ds-imp-progress-icon").hide(),J("#imp-dlg-import-btn").text(J.i18n("writer.common.UPLOAD"));var t={container:"#imp-dlg-error-notification-cont",translatedMessage:!0,setTimer:!1,type:"error",close:!1};if("passwordProtected"==e){if(t.type="warning",t.message=J.i18n("writer.import.PASSWORD_MSG"),J("#imp-dlg-import-btn").text(J.i18n("writer.common.UPLOAD")).addClass("ui-state-disabled"),null!=i&&i.pwd)return void I("passwordIncorrect");J("#ds-imp-pwd-req-cont").show(),J("#ds-imp-pc-progress").hide(),J("#ds-imp-url-progress-cont").hide(),J("#dashboard-import-pwd-input").val("").focus()}else"passwordIncorrect"==e?(t.message=J.i18n("writer.import.INCORRECT_PWD_MSG"),J("#imp-dlg-import-btn").text(J.i18n("writer.common.UPLOAD")).addClass("ui-state-disabled"),J("#ds-imp-pwd-req-cont").show(),J("#ds-imp-pc-progress").hide(),J("#ds-imp-url-progress-cont").hide(),J("#dashboard-import-pwd-input").val("").focus()):(J("#dashboard-import-url-progress").removeAttr("readonly","readonly"),"unsupportedFile"==e?t.message=J.i18n("writer.common.UNSUPPORTED_FILE_FORMAT_MSG"):("largeFileSize"==e?t.message=J.i18n("writer.import.FILE_SIZE_EXCEEDED"):"largeFileContentSize"==e?t.message=J.i18n("writer.import.FILE_CONTENT_SIZE_EXCEEDED",["1 million"]):t.message=J.i18n("writer.import.UNABLE_TO_IMPORT_DOCUMENT"),t.btnTextTranslated=!0,t.btnText=J.i18n("writer.common.GO_BACK"),t.callback=function(){Notification.hide(),A()}));Notification.show(t)},_=function(e,t){J("#ds-imp-pc-progress").hide(),J("#ds-browse-cont").hide(),J("#imp-success-cont").show(),J("#imported-document-name").text(t.fileName),J("#imp-dlg-opennw-btn").off("click").on("click",function(){m(),Utils.safeWindowOpen(editor.getBaseURL()+"/open/"+e)}),J("#imp-dlg-later-btn,#imp-dlg-opennw-btn").show(),J("#imp-dlg-import-btn,#imp-dlg-close-btn").hide(),r&&r.success&&r.success(e,t.fileName&&t.fileName.split(".")[0]||"")},A=function(){J("#imp_desktop").prop("checked",!0),d?J("#output-format-selection-area").hide():"writer"!=s&&s in n||J("#output-format-selection-area").show(),J(".ui-lp-radio-btn,#import-drop-cont,#ds-browse-cont,#imp-dlg-close-btn").show(),J(".ds-imp-progress-icon,#imp-success-cont,#ds-imp-ivalid-url-error").hide(),J("#imp-dlg-drop-area").css("top","-61px"),J("#imp-dlg-browse-msg").css("opacity","1"),J("#imp-dlg-import-btn").text(J.i18n("writer.common.UPLOAD")).addClass("ui-state-disabled").show(),J("#ds-imp-pc-progress").hide(),J("#imp-dlg-later-btn,#imp-dlg-opennw-btn").hide(),J("#dashboard-import-url-progress,#importbrowse").val("")},S=function(e,t,i){t&&0==t.length&&(t=void 0),r=e,a=t,R(null,r,i)},R=function(e,t,i){t&&(r=t),i in n&&(s=i);var o=void 0;if(e&&e.files)o=e.files;else if(e&&"drop"==e.type){o=(e.originalEvent.dataTransfer||e.originalEvent.fileDataTransfer).files,d=!0;var a=o[0];a.name.endsWith(".pdf")||a.name.endsWith(".zfdoc")?s="fillable":a.name.endsWith(".zsdoc")?s="sign":a.name.endsWith(".zmdoc")&&(s="merge")}var l=function(){this&&("object"==typeof this?O:b)(this)}.bind(o);T().then(l)},O=function(e){var t=e[0].name,i=t.split(".").pop().toLowerCase(),n=(editorProps.deployment.zohowriter,J("#importbrowse")),o={};o.fileName=t,o.pwd="",o.extn=i,0==n.val().length&&(n[0].files=e),o.filePath=n,o.impType="file",v(o)},b=function(e){if(e||(e=J("#dashboard-import-url-progress").val()),J("#dashboard-import-url-progress").val(e),!(e.length<1)){var t=e.substring(e.lastIndexOf("/")+1),i=t.split(".")[0],n=t.split(".")[1]||"docx",o={};o.fileName=i+"."+n,o.pwd="",o.extn=n,o.filePath=e,o.impType="url",v(o),ZWLogger.addToStatistics("import_Frome_url")}},v=function(e){if(l.indexOf(e.extn)==-1)return void I("unsupportedFile");i=e,Notification.hide(),h(e.impType,e.fileName);var n={success:function(i){if(i="string"==typeof i?JSON.parse(i):i,1==i.status||"active"==i.status){var o=i.document_id;_(o,e)}else n.fail(i);t=!1},fail:function(e){e="string"==typeof e?JSON.parse(e):e;var t=e.error.errorcode;I(void 0!=t&&"R1014"==t?"passwordProtected":void 0!=t&&"R1015"==t?"passwordIncorrect":void 0!=t&&"R1007"==t?"largeFileSize":void 0!=t&&"R1018"==t?"largeFileContentSize":"error")},setHeaders:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}};({name:e.fileName,password:e.pwd});t=!0;var o="/writer/api/v1/documents",r={};r.password=e.pwd,r["file"==e.impType?"content":"url"]=e.filePath,a?r.team_id=a:"undefined"==typeof isDashboard&&editor.doc.docInfo.RID&&(r.rid=editor.doc.docInfo.RID);var s=J("#output-format-selection").zselectbox("getAttribute","selectedValue");"writer"===s&&e.fileName.endsWith(".pdf")&&(s="writer_pdf"),"writer"!=s&&(r.resource_type=s),J.ajaxUpload(o,r,n,"json"),ZWLogger.addToStatistics("Fm_Import")},D=function(){Notification.hide(),J("#ds-imp-pwd-req-cont").is(":visible")?(i.pwd=J("#dashboard-import-pwd-input").val(),v(i)):J("#ds-imp-url-progress-cont").is(":visible")&&b()},L=function(t){t&&t.target&&t.target[0]&&t.target[0].id==e+"zdialog"&&(PubSub.unsubscribe("Dialog/BeforeClose",L),r=a=s=void 0,d=!1,J("#output-format-selection-area").show(),J("#output-format-selection").zselectbox("setAttribute","selectedIndex",0))};return{close:m,importDoc:R,openDlg:S,continueImport:D,updateImportStatus:p}}();InsertSpl.splCharDivBottom=0,InsertSpl.splCharDivRight=0,InsertSpl.hoverSymbolsHt=0,InsertSpl.hoverSymbolsWid=0,InsertSpl.frequentlyUsed=[],InsertSpl.isSymbolsList=!1,InsertSpl.isNoteSymbol=!1,InsertSpl.open=function(e){"note"==e?(InsertSpl.isNoteSymbol=!0,ZWLogger.addToStatistics("NoteSymbol")):"list"===e?(InsertSpl.isSymbolsList=!0,InsertSpl.isNoteSymbol=!1,ZWLogger.addToStatistics("ListSymbol")):(InsertSpl.isNoteSymbol=!1,InsertSpl.isSymbolsList=!1,ZWLogger.addToStatistics("Symbol")),J('span[class*="ui-splcharacter-iconbox"]').removeClass("ui-splcharacter-iconbox-select"),InsertSpl.addFrequentlyUsed(),J.dialogutil.open("insertsplchar",J("#ins-lpnl-splchars"),InsertSpl.dialogInfo),J("#spl_char").focus()},InsertSpl.hideSearchResult=function(){var e=J("#vtabs ul.menutabs li.ui-state-active").find("a"),t=J(e).attr("href");$(e).bind("click",function(){J(t).css("display","block")})},InsertSpl.constructHTML=function(e,t){for(var i=e.length,n=document.getElementById(t),o=document.createElement("div"),r=0;r<i;r++){var a=(e[r].length,InsertSpl.constructSymbolSpan(e[r][2],e[r][1],e[r][0]));o.append(a[0])}n.append(o)},InsertSpl.constructSymbolDlg=function(){J(".ui-splcharacter-div").removeClass("ui-symbol-loading");for(var e=J("#vtabs li"),t=0;t<e.length;t++)e[t].addEventListener("click",InsertSpl.hideSearchResult,!0);var i=JSON.parse(punctuation),n=JSON.parse(symbol),o=JSON.parse(arrows),r=JSON.parse(mathalpha),a=JSON.parse(emojis),s=JSON.parse(maths),l=JSON.parse(stars),d=JSON.parse(subsup),c=JSON.parse(currency),u=JSON.parse(shapes),p=JSON.parse(games),g=JSON.parse(zodiac),f=JSON.parse(braille),E=JSON.parse(numberforms),T=JSON.parse(latin);InsertSpl.constructHTML(i,"tabs_1"),InsertSpl.constructHTML(n,"tabs_2"),InsertSpl.constructHTML(o,"tabs_3"),InsertSpl.constructHTML(r,"tabs_4"),InsertSpl.constructHTML(a,"tabs_5"),InsertSpl.constructHTML(s,"tabs_6"),InsertSpl.constructHTML(l,"tabs_7"),InsertSpl.constructHTML(d,"tabs_8"),InsertSpl.constructHTML(c,"tabs_9"),InsertSpl.constructHTML(u,"tabs_10"),InsertSpl.constructHTML(p,"tabs_11"),InsertSpl.constructHTML(g,"tabs_12"),InsertSpl.constructHTML(f,"tabs_13"),InsertSpl.constructHTML(E,"tabs_14"),InsertSpl.constructHTML(T,"tabs_15"),InsertSpl.splCharDivBottom=J(".ui-splcharacter-div").offset().top+J(".ui-splcharacter-div").height(),InsertSpl.splCharDivRight=J(".ui-splcharacter-div").offset().left+J(".ui-splcharacter-div").width(),InsertSpl.hoverSymbolsHt=parseInt(J("#hoversymbols").css("height")),InsertSpl.hoverSymbolsWid=parseInt(J("#hoversymbols").css("width"))},InsertSpl.dialogInfo={init:function(){J("#hoversymbols").css("display","none"),J("#dlgbutton0").disable(),J("#dlgbutton0").disable(),J("script#symbolJson")[0]?InsertSpl.constructSymbolDlg():(J(".ui-splcharacter-div").addClass("ui-symbol-loading"),J.ajax({type:"GET",dataType:"text",global:!1,url:cdnZWStaticPath+fingerPrintObj["js/symbols.json"],success:function(e){var t=J("<script>",{id:"symbolJson"});t.html(e),Jbody.append(t),InsertSpl.constructSymbolDlg()}}))},set:function(e,t,i){},get:function(e,t){}},InsertSpl.initAddNewCharField=function(){J("#splChar_unicodeVal").css("color","#8F8F8F"),J("#splChar_unicodeVal").val("Enter Unicode...")},InsertSpl.unicodeTextFocus=function(){var e=J("#splChar_unicodeVal"),t=e.val(),i=document.getElementById("splChar_unicodeVal");if("Enter Unicode..."==t)if(i.createTextRange){var n=i.createTextRange();n.move("character",0),n.select()}else i.setSelectionRange&&i.setSelectionRange(0,0);i.focus()},InsertSpl.unicodeTextBlur=function(){var e=J("#splChar_unicodeVal"),t=e.val();"Enter Unicode..."!=t&&""!=t||(e.css({color:"#8F8F8F"}),e.val("Enter Unicode..."),J("#addNewButton").disable())},InsertSpl.showEmptyValue=function(){J("#previewSymbol").html(""),J("#previewText").html("")},InsertSpl.constructUnicodeSpan=function(e){var t=InsertSpl.getASCIIVal(e),i='<span class="ui-splcharacter-iconbox" onclick="javascript:InsertSpl.insertChar(\''+e+'\',this);"><a class="ui-splcharacter-inside" style="cursor:pointer;">'+(160==t?"__":"&#"+t+";")+"</a></span>";return i},InsertSpl.constructSymbolSpan=function(e,t,i){e.length>6&&(e="",i="");var n='<span class="ui-splcharacter-iconbox"onmouseover="InsertSpl.previewChar(\''+e+"','"+t+"',this);\"onclick=\"javascript:InsertSpl.insertChar('"+e+'\',this);" onmouseout="InsertSpl.hidePreview();" ><a class="ui-splcharacter-inside" style="cursor:pointer;"></a></span>';return n=J(n),J(n).find("a").text(i),n},InsertSpl.addFrequentlyUsed=function(){var e=InsertSpl.frequentlyUsed.length;if(0==e)return void J("#frequentlyUsedCont").hide();J("#frequentlyUsedCont").show();var t=J("#freqUsedView");for(t.empty(),i=0;i<e;i++){if(12==i)return;var n=InsertSpl.frequentlyUsed[i];t.append(InsertSpl.constructUnicodeSpan(n))}},InsertSpl.search=function(e){var t=!1;J("#vtabs ul.menutabs li.is-selected").find("a").attr("href");J("#tabs_0").empty();var i=J("#vtabs li");J(i[0]).show(),J("#vtabs").ztabpanel("openTab",0),J("#splChar_search").focus();e.length;J("#hoversymbols").css("display","none"),J(".ui-splcharacter-div").addClass("ui-symbol-loading"),e.startsWith("u+")?(t=!0,e=e.replace("u+","")):(/ +/.test(e)&&(e=e.replaceAll(" | +g","* ")),e=e.concat("*"));var n={};n.query=e,J.ajax({type:"GET",data:n,global:!1,dataType:"json",url:ZWNetworkUtils.getContextUrl("searchsymbols"),error:function(e){J(".ui-splcharacter-div").removeClass("ui-symbol-loading")},success:function(i){InsertSpl.constructSearchResults(i,t,e)}})},InsertSpl.constructSearchResults=function(e,t,i){var n=e[SYMBOL_SEARCH_KEYS.JSON_RESPONSE][SYMBOL_SEARCH_KEYS.NO_OF_RESULTS];0!==n?InsertSpl.constructSearchResultsHTML(e[SYMBOL_SEARCH_KEYS.JSON_RESPONSE][SYMBOL_SEARCH_KEYS.SEARCH_RESULTS]):t&&InsertSpl.addNewCharView(i),J(".ui-splcharacter-div").removeClass("ui-symbol-loading")},InsertSpl.constructSearchResultsHTML=function(e){for(var t=e.length,i=document.getElementById("tabs_0"),n=document.createElement("div"),o="",r=0;r<t;r++){var a=e[r],s=a[SYMBOL_SEARCH_KEYS.SYMBOL_VALUE],l=a[SYMBOL_SEARCH_KEYS.SYMBOL_NAME],d=a[SYMBOL_SEARCH_KEYS.SYMBOL_UNICODE];o=InsertSpl.constructSymbolSpan(d,l,s),n.append(o[0])}i.append(n)},InsertSpl.searchTimeout,InsertSpl.searchKeyUp=function(e){clearTimeout(InsertSpl.searchTimeout);var t=J("#splChar_search").val().toLowerCase().trim(),i=t.length;return i<3?void(0==i&&(J(J("#vtabs li")[0]).hide(),J("#vtabs").ztabpanel("openTab",1),J("#splChar_search").focus())):void(InsertSpl.searchTimeout=setTimeout(function(){InsertSpl.search(t)},500))},InsertSpl.hidePreview=function(){J("#hoversymbols").css("display","none"),clearTimeout(InsertSpl.previewTimeout)},InsertSpl.previewTimeout,InsertSpl.previewChar=function(e,t,i){clearTimeout(InsertSpl.previewTimeout),InsertSpl.previewTimeout=setTimeout(function(){InsertSpl.preview(e,t,i)},500)},InsertSpl.preview=function(e,t,i){if(null!=i){J("#hoversymbols").css({display:"block"});var n=J(i).offset().top+(J(i).height()+1),o=J(i).offset().left+(J(i).width()+2)/2;n>InsertSpl.splCharDivBottom-20&&(n=J(i).offset().top-InsertSpl.hoverSymbolsHt),o>InsertSpl.splCharDivRight-80&&(o=J(i).offset().left+J(i).width()/2-InsertSpl.hoverSymbolsWid),J("#hoversymbols").offset({top:n,left:o})}e=e||"00A9",t=t||"";var r=InsertSpl.getASCIIVal(e);if(r!=-1){r=160==r?"__":"&#"+r+";";var a=String.fromCharCode(r);1==a.length?(J("#previewSymbol").html(r),J("#previewText").text(t),J("#previewUnicodeValue").text("U+"+e)):InsertSpl.showEmptyValue()}else InsertSpl.showEmptyValue()},InsertSpl.addNewCharView=function(e){var t=InsertSpl.getASCIIVal(e),i=document.getElementById("tabs_0");if(t!=-1){var n=String.fromCharCode(t);1==n.length&&i.insertAdjacentHTML("beforeend",InsertSpl.constructUnicodeSpan(e))}},InsertSpl.getASCIIVal=function(e){var t=parseInt(e,16);return isNaN(t)?-1:t},InsertSpl.fixedFromCharCode=function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e))):String.fromCharCode(e)},InsertSpl.insertChar=function(e,t){if(e){J("#dlgbutton0").enable(),InsertSpl.val=e,J('span[class*="ui-splcharacter-iconbox"]').removeClass("ui-splcharacter-iconbox-select"),J(t).addClass("ui-splcharacter-iconbox-select");var i=InsertSpl.fixedFromCharCode("0x"+e);""!=i&&(J("#spl_char").val(i),J("#spl_char").focus())}},InsertSpl.insert=function(){var e=["»","«","↵"],t=Utils.removeUnWantedUnicodes(J("#spl_char").val().toString(),e);if(InsertSpl.isNoteSymbol)editor.doc.execCmd("insertnotesymbol",{referenceChar:t});else if(InsertSpl.isSymbolsList)ListOperation.applySymbolList(t);else{var i=editor.doc.createElement(NODE_TYPE.TEXT,t);editor.doc.execCmd("insert",i)}InsertSpl.isNoteSymbol=!1,InsertSpl.isSymbolsList=!1,J.dialogutil.close("insertsplchar"),J.inArray(InsertSpl.val,InsertSpl.frequentlyUsed)==-1&&InsertSpl.frequentlyUsed.unshift(InsertSpl.val)},InsertSpl.showAuthorDlg=function(){J.dialogutil.open("insertauthor",J("#ins-lpnl-author"),InsertSpl.AFDialogInfo),setTimeout(function(){J("#authorname").select().focus()},200)},InsertSpl.insertAuthor=function(){var e=J("#insertauthor_ui").zvalidation("validateAllFields",J("#insertauthor_ui"));e&&(editor.doc.execCmd("autofield",["autoauthor",authorName]),J.dialogutil.close("insertauthor"))};var authorName="";InsertSpl.AFDialogInfo={set:function(e,t,i){"author"==e.action&&(authorName=t)},get:function(e,t){if("author"==e)return authorName=Macros.getAuthorName()}},LinkDialog=function(){var e,t,i,n,o,r,a,s,l,d,c,u,p,g,f,E,T,m,h,I,_,A,S,R,O,b,v,D,L=!1,N=!1,P=!1,C=!1,y=!1,F=!1,M=!1,w="",U="",x={},B=[],H=!1,G=!1,k=function(){G=!0,Utils.WriterCallbacks.register("onmenuhide",Ee),e=J("#link-popup"),t=J("#link-url"),i=J("#link-text"),n=J("#link-value-icon-close"),o=J("span.ui-link-apply-btn"),r=J("#linkErrorMsg"),a=J("#link-recentdocs-maincont"),s=J("#link-recentdocs-loading-gif"),l=J("#link-recentdocs-listgrp-cont"),d=J("#link-recentdocs-list-cont"),c=J("#link-toc-maincont"),u=J("#link-toc-listgrp-cont"),p=J("#link-toc-list-cont"),g=J("#link-bookmark-maincont"),f=J("#link-bookmark-listgrp-cont"),E=J("#link-bookmark-list-cont"),T=J("#link-mmfield-maincont"),m=J("#link-mmfield-listgrp-cont"),h=J("#link-mmfield-search"),I=J("#link-mmfield-list-cont"),_=Z("bookmark-heading-label"),A=Z("link-info-msg"),S=Z("go-to-link"),R=Z("ui-link-bubble-div"),O=Z("ui-link-get-link"),b=Z("ui-link-copy-link"),v=J("#link-notify"),JlinkTarget=Z("link-open-location")},Y=function(){var e,i,n,o={},r=!1;if(e=t.val(),n=1==JlinkTarget.prop("checked")?"_blank":"_self",!e||M&&e===x.attr(ATTR_LINK.LINK_URL)&&w===U&&n===x.attr(ATTR_LINK.LINK_TARGET))return void V();i=Q(e);var a=t.attr("data-link-info");if(a&&Utils.isRelativeLink(a)&&(i=LINK_TYPES.WEBURL,e=a),i!==LINK_TYPES.WEBURL||e.indexOf("http")!==-1||Utils.isRelativeLink(e)||(e=editor.scheme+"://"+e),i===LINK_TYPES.WEBURL){var s=encodeURI(e.trim());if(r=Utils.isRelativeLink(s)?linkRelativeRegex.test(s):linkRegex.test(s),!r)return void J("#linkErrorMsg").show()}if(i===LINK_TYPES.MAILTO&&e.indexOf("mailto:")===-1&&(e="mailto:"+e),i===LINK_TYPES.BOOKMARK&&(e=t.attr("data-link-info")),i===LINK_TYPES.MMFIELD){var l=x&&(x.attr("mminfo")||{}).mapping,d=MailMergeUtil.getFieldMappingFromObject(e,{includeRlFields:!0,mapping:l}),c={};c[MAILMERGE.MAPPING]=d,o[MAILMERGE.MMINFO]=c,e=MailMergeUtil.changeObjectToStore(e,{includeRlFields:!0,mapping:l})}o.url=e,o.type=i,i!=LINK_TYPES.WEBURL&&(n="_blank"),w!==U&&(o.text=w),M?(o.linkObj=x,o.id=x.attr(ATTR_COMMON.ID),editor.doc.execCmd("ModifyLink",o)):editor.doc.execCmd("CreateLink",o),V()},z=function(){r.hide(),t.attr({"data-link-info":""}),P=N=EventHandler.isMenuOpened=F=y=M=!1,w=U="",x={}},V=function(){z(),L=!1,pe(),t.val("").enable(),i.val("").enable(),h.val(""),e.hide(),u.hide(),f.hide(),n.hide(),EditorUtil.focusMultiByteSpan(),CurUtil.blinkCursor(),v.addClass("ui-hide")},j=function(e){var t;D=editor.doc.getElement("bookmark");for(var i=0,n=D.length;i<n;i++)if(e===D[i].name&&D[i].id.indexOf("toc")!==-1){var o=editor.doc.getParents(NODE_TYPE.PARAGRAPH,D[i].getStart()),r=(o.text()||"").replace(UNICODE.PARA,"");t=r,_.text(J.i18n("writer.common.LINKED_TO_HEADING"))}t||(_.text(J.i18n("writer.common.LINKED_TO_BOOKMARK")),t=e),t=t||"",_.show(),S.text(t),S.show()},X=function(){var e=editor.doc.getParents(NODE_TYPE.IMAGE,editor.doc.getSelection().getStart()),t=editor.doc.getRawFormatAt(e.getStart()),i=0|t[ATTR_IMAGE.I_ROTATE],n=TransformHandler.getCurrentObjectInfo();if(n.type){var o=n.offset,r=o.y,a=o.x;if(O.hide(),b.hide(),A.hide(),S.hide(),t.linkData.type===LINK_TYPES.BOOKMARK)LinkDialog.updateBookMarkName(t.linkData.url),O.show();else if(t.linkData.type===LINK_TYPES.WEBURL||t.linkData.type===LINK_TYPES.MAILTO){var s=t.linkData.url;Utils.isRelativeLink(s)&&(s=Utils.getAbsoluteLink(s)),Z("go-to-link").text(s),Z("go-to-link").show(),_.hide(),Utils.contextMenuSupportedBrowser()&&b.show()}else t.linkData.type==LINK_TYPES.MMFIELD&&de(t.linkData);var l=parseFloat(t.ht),d=parseFloat(t.wid),c=function(e,t,i){var n=e*Math.PI/180,o=i*Math.abs(Math.sin(n))+t*Math.abs(Math.cos(n)),r=i*Math.abs(Math.cos(n))+t*Math.abs(Math.sin(n));return{width:o,height:r}},u=c(i,d,l),p=r+u.height*editor.zoomFactor;i>=150&&i<=210&&(p+=20),R[0].style.top=p+5+"px",R[0].style.left=a+"px",R.show()}},K=function(e,t,i,n,o,r,a){var s=W.get("#ui-link-embed-link");if(s.hide(),(editor.getRole().permissions.can("document.edit")||"PUBLIC"!==editor.doc.getRole())&&G){if(e){var l,d=r.attr(ATTR_LINK.LINK_TYPE);if(O=Z("ui-link-get-link"),b=Z("ui-link-copy-link"),b.hide(),O.hide(),A.hide(),S.hide(),d==LINK_TYPES.BOOKMARK)j(r.attr(ATTR_LINK.LINK_URL)),O.show();else if(d==LINK_TYPES.WEBURL){l=r.attr(ATTR_LINK.LINK_URL)||"",Utils.isRelativeLink(l)&&(l=Utils.getAbsoluteLink(l));var c=DocUtil.getFloatElementRange(NODE_TYPE.LINK,editor.doc.getSelection().getStart()-1);if(void 0!==c&&null!==c){var u=editor.doc.getContent(c.start,c.end);u=u.replaceAll(new RegExp("["+CONT_REGEX_REDACT_EXCLUDE+"]","g"),""),u.startsWith("http")&&s.show()}_.hide(),S.text(l),S.show()}else d==LINK_TYPES.MAILTO?(l=r.attr(ATTR_LINK.LINK_URL)||"",_.hide(),S.text(l),S.show()):d==LINK_TYPES.MMFIELD&&de(r.attr());var p=editor.jeditorPane.offset(),g=R.outerWidth();i-=p.left,n>g&&(i+=(n-g)/2);var f=editor.doc.getSelection(),E=DocLayoutManager.getPageWidthAtIdx(f.getStart()),T=parseInt(R.css("width"));if(T+i>=E){var m=5;i=i-(T+i-E)-m,R.css({left:i+"px"})}else R.css({left:i+"px",right:"auto"});var h=t-p.top+o*editor.zoomFactor;a&&Z("ui-link-modify-link").hide(),R.css("top",h+"px"),R.show()}else X();if(d!=LINK_TYPES.WEBURL&&d!=LINK_TYPES.MAILTO||!Utils.contextMenuSupportedBrowser())d!=LINK_TYPES.WEBURL&&d!=LINK_TYPES.MAILTO||editor.getRole().permissions.can("document.edit")||Z("ui-link-changes").hide();else if(Utils.isRelativeLink(l)&&(l=Utils.getAbsoluteLink(l)),b.attr("url",l),b.show(),!editor.getRole().permissions.can("document.edit")){if(!l)return void R.hide();Z("ui-link-changes").hide()}editor.getRole().permissions.can("document.edit")?Z("ui-link-changes").show():Z("ui-link-changes").hide()}},q=function(e){var t,i,n,o=(e.attr(ATTR_LINK.LINK_TYPE),[]),r=J.i18n("writer.common.GOTO_HEADING");return t=e.attr(ATTR_LINK.LINK_URL),i=editor.doc.getElement(NODE_TYPE.BOOKMARK,t),r=i?r:J.i18n("writer.common.BOOKMARK_REMOVED_MSG"),n={label:r,customAttributes:{data:'{"appData":{"action":"Utils.goToLink", "params":true}}'}},o.push(n),editor.getRole().permissions.can("document.edit")&&(r=J.i18n("writer.common.REMOVELINK"),n={label:r,customAttributes:{data:'{"appData":{"action":"LinkDialog.removeLink"}}'}},o.push(n)),i&&i.length>0&&(n={label:J.i18n("writer.common.GET_LINK"),customAttributes:{data:'{"appData":{"action":"BookmarkDialog.showLink","params":["'+i[0].id+'"]}}'}},o.push(n)),o},Q=function(e){var t=LINK_TYPES.WEBURL;return N?t=LINK_TYPES.BOOKMARK:e.indexOf(UNICODE.MERGEFIELD_START)!=-1&&e.indexOf(UNICODE.MERGEFIELD_END)!=-1?t=LINK_TYPES.MMFIELD:/^((mailto:)?[a-zA-Z0-9]+([\w\.\-\+\'])*@\w+([\-]?\w)*(\.\w{1,24})+)$/.test(e)&&(t=LINK_TYPES.MAILTO),t},$=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE);t?ImageLink.removeLink():editor.doc.execCmd("Unlink"),R.hide()},ee=function(){if(G){ZWComponentUtil.init("link-popup"),ZWLogger.addToStatistics("Link");var o=editor.doc.getSelection();if(Z("imageLink").hide(),Z("insertLink").show(),!o.isTableSelected()&&!o.canEditLockRange()){l.hide();var r=CurUtil.offset.start.top*editor.zoomFactor,a=CurUtil.offset.start.left*editor.zoomFactor;PopupHandler.closePopup("smartToolbar");var s=editor.editorPaneContainer;(r<=s.scrollTop()||r>=s.scrollTop()+s.height())&&(H=!0,DomUtil.scrollElementIntoView(editor.doc.getDomCursorNode()[0]));var d,m,h,I,_,o=editor.doc.getSelection(),A=DocLayoutManager.getPageWidthAtIdx(o.getStart())*editor.zoomFactor,S=DocLayoutManager.getPageAtIndex(o.getStart()),O=J(DomViewManager.getDOMElem(S));t.enable(),D=editor.doc.getElement("bookmark"),D.length?(g.show(),oe()):g.hide(),Z("ui-link-text-field").show(),JlinkTarget.prop("checked",!0),U=w=editor.doc.getContent(o.getStart(),o.getEnd());var b=/^http(s)?:\/\/.*\..*/i,v=/^www\..*\..*/i,C=/^([a-zA-Z0-9]+([\w\.\-\+\'])*@\w+([\-]?\w)*(\.\w{1,24})+)$/,y=U.trim();if(b.test(y)||v.test(y)||C.test(y)){var _=LINK_TYPES.WEBURL,h=y;v.test(y)?h="https://"+y:C.test(y)&&(_=LINK_TYPES.MAILTO,h="mailto:"+y);var F=(editor.doc.createElement(NODE_TYPE.TEXT,y),{type:_,url:h});return void editor.doc.execCmd("CreateLink",F)}var B=o.getStart(),k=o.getParents(NODE_TYPE.IMAGE);if(k){var d=0,W=e.height(),m=0;Z("insertLink").hide(),Z("imageLink").show();var Y=k.attr();if(Y.linkData){var F=Y.linkData,z=F.url;if(F.type==LINK_TYPES.MMFIELD){var V=F[MAILMERGE.MMINFO][MAILMERGE.MAPPING]||{};z=MailMergeUtil.changeObjectToDisplay(z,V)}Z("link-url").val(z),R.hide();var j=Y.linkData.target;if(JlinkTarget.prop("checked","_self"!=j),Utils.isRelativeLink(z)){var X=Utils.getAbsoluteLink(z);t.val(X),t.disable()}t.attr("data-link-info",z)}Z("ui-link-text-field").hide();var K=DomUtil.getDomImage(B,Y);if(Y.subType==NODE_TYPE.TEXTBOX){var q=DocLayoutManager.getSectionViews(Y.id)[0],Q=DomViewManager.getDOMObj(q.getPage());K=Q.getRenderedDOM(q)}var $=J(K),ee=$.offset();d=$.offset().top+parseFloat(Y.ht),m=ee.left+parseFloat(Y.wid/2)-e.width()/2}else{if(o.isCollapsed()&&(B-=1),x=editor.doc.getParents(NODE_TYPE.LINK,B)){if(x.attr(ATTR_LINK.LINK_TYPE)!==LINK_TYPE.WEBURL?JlinkTarget.disable():JlinkTarget.enable(),M=!0,o.isCollapsed()){var te=editor.doc.createRange(x.getStart(),x.getEnd());o.removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(te)}var ie=x.attr(ATTR_LINK.LINK_TARGET);if(JlinkTarget.prop("checked","_self"!=ie),h=x.attr(ATTR_LINK.LINK_URL),U=w=editor.doc.getContent(x.getStart()+1,x.getEnd()-1),x.attr(ATTR_LINK.LINK_TYPE)==LINK_TYPES.MMFIELD){var V=x.attr(MAILMERGE.MMINFO)[MAILMERGE.MAPPING]||{};h=MailMergeUtil.changeObjectToDisplay(h,V)}if(t.val(h),_=x.attr(ATTR_LINK.LINK_TYPE),_===LINK_TYPES.BOOKMARK){var ne=editor.doc.getElement("bookmark",h)[0];if(ne&&ne.id.indexOf("toc_")!=-1){var re=editor.doc.getParents(NODE_TYPE.PARAGRAPH,ne.getStart()),se=editor.doc.getContent(re.getStart(),re.getEnd()-1);se=Utils.removeUnWantedUnicodes(se),t.val(se)}t.disable(),n.show(),N=!0}else if(_==LINK_TYPES.WEBURL&&Utils.isRelativeLink(h)){var X=Utils.getAbsoluteLink(h);t.val(X),t.disable()}}var le=0,de="20px",ce=0,pe=o.getRangeAt(0),ge=pe.getStartPortionNode();if(ge){var fe=ge.getClientRects();fe.length&&(ce=fe[0].height)}if(d=r+s.offset().top+ce+le-s.scrollTop(),m=a+s.scrollLeft()-le,o.isCollapsed()){var Ee="undefined"!=typeof LeftPanel?LeftPanel.getPanelWidth():0;m+=Ee}var Te=O.offset().left+A-s.scrollLeft(),me=s.offset().top+s.height();Te>s.width()&&(Te=s.offset().left+s.width());var he=e.width(),W=e.height(),Ie=m+he,_e=d+W,Ae=".ui-link-arrow-up",Se=".ui-link-arrow-down";Ie>Te&&(m=m-(Ie-Te)-10,de=a-m,de+="px"),_e>me&&(d-=W+ce+le,Ae=".ui-link-arrow-down",Se=".ui-link-arrow-up")}var Re=(CurUtil.offset.start.rects.top,DocLayoutManager.getCurrentLine()),Oe=DomViewManager.getDomFromCurrentPage(Re),be=J(Oe).offset().top;be<=editor.editorPaneContainerOffset.top&&(d=editor.editorPaneContainerOffset.top,m=editor.editorPaneContainerOffset.left+CurUtil.offset.start.rects.left),e.show().css({top:d,left:m}),P=!!w;var ve=Utils.removeUnWantedUnicodes(w);if(i.val(ve),I=new RegExp(UNICODE.PARA+"|"+UNICODE.TAB+"|"+UNICODE.BR+"|"+UNICODE.SECTION_START+"|"+UNICODE.TABLE+"|"+UNICODE.TABLEEND+"|"+UNICODE.ROW+"|"+UNICODE.CELL+"|"+UNICODE.RANGE_START+"|"+UNICODE.RANGE_END,"g"),I.test(w)&&i.disable(),p.children().length<1?c.hide():(oe({isToc:!0}),c.show()),E.children().length<1?g.hide():D.length>0&&g.show(),L=!0,!t.attr("data-link-info")){var z=editor.doc.getParents(NODE_TYPE.LINK,editor.doc.getSelection().getStart()+1);if(z){var De=editor.doc.getRawFormatAt(z.getStart());t.attr("data-link-info",De.url)}}""!=t.val()&&n.show(),R.hide(),f.hide(),u.hide(),CurUtil.stopBlinking(),ue(),t.focus(),T.hide(),window.MailMergeFieldUtil&&MailMergeFieldUtil.isFieldsAvailable()&&(ae(),T.show())}}},te=function(){if(C)ie();else{var e={onsuccess:function(e){LinkDialog.recentDocList=e.documents,ie(B)},onerror:function(){}};FileMenu.fetchRecentDocuments(e)}},ie=function(){for(var e,t,i=LinkDialog.recentDocList.length,n=i?[]:[{label:J.i18n("writer.common.NO_RECENT_DOCUMENTS"),width:"50px"}],o=d,r=0;r<i;r++)e={},t=LinkDialog.recentDocList[r],e.label=t.document_name,e.customAttributes={data:{appData:{action:"LinkDialog.handleRecentDocClickEvent",params:t.document_id}}},e.width="50px",n.push(e);o.zmenu("removeAllMenuItems"),o.zmenu("addMenuItems",n),C=!0},ne=function(e){var r=e,a=ATTR_LINK.RELATIVE_LINK_CONST_VAL+r;t.attr({"data-link-info":a}),a=Utils.getAbsoluteLink(a),t.val(a).disable(),""===i.val()&&ce(),n.show(),o.focus(),JlinkTarget.enable()},oe=function(e){e=e||{};var i,n,o=(e.isToc,0);N=!1,t.attr({"data-link-info":""});var r=p,a=E,s=[],l=[];p.html(""),E.html("");var d=[];for(o=0,i=D.length;o<i;o++)if(n=D[o],n.name)if(n.id.indexOf("toc_")!==-1){var c=editor.doc.getParents(NODE_TYPE.PARAGRAPH,n.getStart());if(!d.contains(c.dtNode.id)){d.push(c.dtNode.id);var u=(c.text()||"").replace(UNICODE.PARA,""),g=Utils.encodeHTMLString(u);g&&(y=!0,tocOptions={},tocOptions.label=g,tocOptions.customAttributes={"data-link-info":n.name,"data-cont":u},tocOptions.width="50px",s.push(tocOptions))}}else F=!0,bookMarkOptions={},bookMarkOptions.label=Utils.encodeHTMLString(n.name),bookMarkOptions.customAttributes={"data-link-info":n.name,"data-cont":n.name},bookMarkOptions.width="50px",l.push(bookMarkOptions);y&&(r.zmenu("removeAllMenuItems"),r.zmenu("addMenuItems",s)),F&&(a.zmenu("removeAllMenuItems"),a.zmenu("addMenuItems",l))},re=function(e,r){N=!0;var a=r.data.customAttributes,s=Utils.removeUnWantedUnicodes(a["data-cont"]);t.val(s).disable();var l=a["data-link-info"];t.attr({"data-link-info":l}),""===i.val()&&ce(),n.show(),o.focus(),JlinkTarget.disable()},ae=function(e){MailMergeUiUtils.listFields({container:J("#link-mmfield-data-list-cont"),getFieldElem:se,listRepeatFields:!0})},se=function(e,t,i){var n=MailMergeUiUtils.getFieldElem(e,t,i);return le(n,e),n},le=function(e,i){e.off("click").on("click",function(e){MailMergeUiUtils.insertFieldInText({element:t[0],fieldInfo:i})})},de=function(e){_.text(J.i18n("writer.common.LINKED_TO_MERGEFIELD")),_.show();var t=e[MAILMERGE.MMINFO][MAILMERGE.MAPPING]||{},i=MailMergeUtil.changeObjectToDisplay(e.url,t);JlinkTarget.enable(),A.text(i),A.show(),S.hide(),JlinkTarget.enable()},ce=function(){P||(w=Utils.removeUnWantedUnicodes(t.val()),i.val(w))},ue=function(){e.on("keydown",function(e){var t=e.keyCode;t===KEYS.ESC?V():t===KEYS.ENTER&&(J("#imageLink").is(":visible")?ImageLink.insert():Y())}),t.on("input",function(){J("#linkErrorMsg").hide(),t.val().length>0||ge(),(p.find(".ui-link-list-item").length>0||E.find(".ui-link-list-item").length>0)&&t.val().length>0&&n.show(),ce()}),i.bind("input",function(){P=!0,w=Utils.removeUnWantedUnicodes(i.val())}),o.focus(function(){o.addClass("ui-link-apply-button-focus")}),o.focusout(function(){o.removeClass("ui-link-apply-button-focus")}),J("#linkdialog_focusdiv2").on("focus",function(){var t=e.find(":enabled");t=t.length?t[0]:o,t.focus()}),J("#linkdialog_focusdiv1").on("focus",function(){o.focus()})},pe=function(){e.off("keydown")},ge=function(){t.val(""),n.hide(),t.attr({"data-link-info":""}),N=!1,fe()},fe=function(){t.enable(),t.removeClass("ui-state-disabled")},Ee=function(){return e.is(":hidden")},Te=function(){H===!0?H=!1:L&&V()},me=function(){return L},he=function(){var e=R.detach();J("#popup-menu-container").append(e)},Ie=function(){var e=editor.doc.getParents(NODE_TYPE.LINK,editor.doc.getSelection().getStart()-1),t=DocLayoutManager.getPageAtPageNumber(editor.currentPageIndex+1),i=t?t.id:null,n=editor.doc.getPortionData(editor.doc.getSelection()[0].start,i).node;if(e&&!J(n).parents("#toc")[0]){var o=J(n).offset(),r=o.top,a=o.left,s=J(n).width(),l=n.offsetHeight;K(!0,r,a,s,l,e,!1)}else{var d=editor.doc.getRawFormatAt(editor.doc.getSelection()[0].start);if(d&&d.type===NODE_TYPE.IMAGE&&d.linkData)LinkDialog.displayLinkVisualCue(!1);else{if(!G)return;R.hide()}}},_e=function(e){var r=e.callbackDataFromWorkDrive.fileModel[0].name,a=e.callbackDataFromWorkDrive.fileModel[0].id,s=editor.getBaseURL()+"/open/"+a;t.attr({"data-link-info":""}),t.val(s).disable(),""===i.val()&&(P||(w=r,i.val(r))),v.removeClass("ui-hide"),Notification.show({container:"#link-notify",message:"writer.common.LINK_COLLABORATORS_NOTIFICATION_MSG",setTimer:!1,type:"warning",close:!1}),n.show(),o.focus()},Ae=function(){var e={service:"zw",resId:editor.doc.rid,WDDomainURL:window.location.protocol+"//"+editorProps.urls.teamdriveURL,height:"70%",width:"50%",primaryButtonName:J.i18n("writer.common.GET_LINK"),denyButtonName:"cancel",filesQueryOptions:{queryType:"type",queryValue:"documents"},filesQueryFilterOptions:[{queryType:"type",queryValue:"folder,documents"}],countToSelectMaxFiles:1,showSelectedFilesAsTag:!0,canUpload:!0,showSearch:!0,showPrimaryButton:!0,showDenyButton:!0,canShare:!0,shareOptions:{showshareDialog:!0,shareAndReturnData:!0,shareFields:{externalShare:!0},defaultShare:"externalShare"},loadAsDialog:!0,disableFolderSelection:!0,primaryActionCallBack:function(e){LinkDialog.handleWDResourceLinkCallback(e)}};WDHandler.showResourcePicker(e)},Se=function(e){return!1};return PubSub.subscribe("Document/CursorPositionChanged",Ie,{async:!0,timeout:100}),PubSub.subscribe("Cursor/LineChanged",Ie),PubSub.subscribe("Document/ComponentInitialized",he),PubSub.subscribe("Document/ScrollEvent",Te),{getMenuObj:q,updateBookMarkName:j,displayLinkVisualCue:K,openLinkPopup:ee,createLink:Y,removeLink:$,init:k,removeLinkValue:ge,toggleRecentDocsMenu:te,constructBookMarkMenu:oe,closeLinkPopup:V,isDialogOpened:me,isLinkDialogHidden:Ee,handleScroll:Te,getLinkType:Q,openWDLinkDialaog:Ae,handleWDResourceLinkCallback:_e,handleRecentDocClickEvent:ne,handleBookMarkClickEvent:re,beforeMergeFieldMenuClose:Se,getLinkType:Q}}();var PageLayoutUtil=function(){var e={b5:{label:"B5",inches:'(7.17" X 10.12")',mm:"(182.1 mm X  257 mm )"},b4:{label:"B4",inches:'(10.12" X 14.33")',mm:"(257 mm X  363.9 mm )"},a5:{label:"A5",inches:'(5.83" X 8.27")',mm:"(148 mm X 210 mm )"},a3:{label:"A3",inches:'(11.69" X 16.54")',mm:"(296.9 mm X 420.1 mm )"},folio:{label:"Folio",inches:'(8" X 13")',mm:"(203.2 mm X 330.2 mm )"},statement:{label:"Statement",inches:'(5.5" X 8.5")',mm:"(139.7 mm X 215.9 mm )"},tabloid:{label:"Tabloid",inches:'(11" X 17")',mm:"(279.4 mm X 431.8 mm )"},envelope:{label:"Envelope_10",inches:'(4.13" X 9.5")',mm:"(104.9 mm X 241.3 mm )"},executive:{label:"Executive",inches:'(7.25" X 10.5")',mm:"(184.15 mm X 266.7 mm )"},legal:{label:"Legal",inches:'(8.5" X 14")',mm:"(215.9 mm X 355.6 mm )"},letter:{label:"Letter",inches:'(8.5" X 11")',mm:"(215.9 mm X 279.4 mm )"},a4:{label:"A4",inches:'(8.27" X 11.69")',mm:"(209.9 mm X 297 mm )"}},t={none:{value:"0.00in/0.00in",label:"None",top:{inches:"0.00in",mm:"0.00mm"},left:{inches:"0.00in",mm:"0.00mm"},bottom:{inches:"0.00in",mm:"0.00mm"},right:{inches:"0.00in",mm:"0.00mm"}},wide:{value:"2.28in/1.0in",label:"Wide",top:{inches:"1.00in",mm:"25.4mm"},left:{inches:"2.28in",mm:"57.9mm"},bottom:{inches:"1.00in",mm:"25.4mm"},right:{inches:"2.28in",mm:"57.9mm"}},moderate:{value:"0.75in/1.0in",label:"Moderate",top:{inches:"1.00in",mm:"25.4mm"},left:{inches:"0.75in",mm:"19.0mm"},bottom:{inches:"1.00in",mm:"25.4mm"},right:{inches:"0.75in",mm:"19.0mm"}},narrow:{value:"0.5in/0.5in",label:"Narrow",top:{inches:"0.50in",mm:"12.7mm"},left:{inches:"0.50in",mm:"12.7mm"},bottom:{inches:"0.50in",mm:"12.7mm"},right:{inches:"0.50in",mm:"12.7mm"}},normal:{value:"1.0in/1.0in",label:"Normal",top:{inches:"1.00in",mm:"25.4mm"},left:{inches:"1.00in",mm:"25.4mm"},bottom:{inches:"1.00in",mm:"25.4mm"},right:{inches:"1.00in",mm:"25.4mm"}}},i=function(t,i){var n="<span>"+e[t].label+"</span><span id="+e[t].label+" class='ui-clr-gray3 ui-left-margin-small'>"+e[t][i]+"</span>";return{innerHtml:n,label:n,value:e[t].label}},n=function(e,i){var n="";switch(e){case"normal":n="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-normal-lg";break;case"moderate":n="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-moderate-lg";break;case"narrow":n="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-narrow-lg";break;case"wide":n="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-wide-lg";break;case"none":n="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-none-lg"}var o="<div class='ui-combo-opt clearfix'><span class='"+n+"'></span><div class='ui-combo-opt-cont'><div class='ui-combo-opt-title'>"+t[e].label+"</div><div class='ui-combo-opt-pos'><div><span>Top</span><span id='normal_top'>: "+t[e].top[i]+",</span><span>Left</span><span id='normal_left'>:"+t[e].left[i]+"</span></div><div><span>Bottom</span><span id='normal_bottom'>:"+t[e].bottom[i]+",</span><span>Right</span><span id='normal_right'>:"+t[e].right[i]+"</span></div></div></div></div>",r={innerHtml:o,label:t[e].label,value:t[e].value};return r},o=function(){var e=DocLayoutManager.getCurrentSection(),t=e.getMargin(),i=parseFloat(Conversions.toGlobalValue(t.left+"px")),n=parseFloat(Conversions.toGlobalValue(t.right+"px")),o=parseFloat(Conversions.toGlobalValue(t.top+"px")),r=parseFloat(Conversions.toGlobalValue(t.bottom+"px"));return i===n&&o===r?.5===i&&.5===o||12.7===i&&12.7===o?"narrow":1===i&&1===o||25.4===i&&25.4===o?"normal":.75===i&&1===o||19.05===i&&25.4===o?"moderate":2.28===i&&1===o||57.912===i&&25.4===o?"wide":0===i&&0===o||0===i&&0===o?"none":"custom":"custom"},r=function(o,r){var a;if(Conversions.globalUnit===UNITS.INCHES)a="inches";else{if(Conversions.globalUnit!==UNITS.MILLIMETERS)return;a="mm"}r.find(".manual-marginsize-option").remove();for(var s in t){var l=n(s,a),d={};d.innerHTML=l.innerHtml,d.replaceWithText=!0,d.label=l.label;var c=document.createElement("option");J(c).addClass("manual-marginsize-option"),r.prepend(c),J(c).attr({data:JSON.stringify(d),value:l.value})}r.zlabeledselectbox("refresh"),o.find(".manual-pagesize-option").remove();for(var u in e){var p=i(u,a),d={};d.innerHTML=p.innerHtml,d.replaceWithText=!0,d.label=p.label;var c=document.createElement("option");J(c).addClass("manual-pagesize-option"),o.prepend(c),J(c).attr({data:JSON.stringify(d),value:p.value})}o.zlabeledselectbox("refresh");var g=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),f=g.getFirstSectionFormat();o.zselectbox("setValue",f[ATTR_BODY.DS_PS])},a=function(e){var t=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),i=t.getFirstSectionFormat();if(e=e?e:i.borders){var n=e[ATTR_BORDERS.BORDER_LEFT]?parseInt(e[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]):0,o=e[ATTR_BORDERS.BORDER_RIGHT]?parseInt(e[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]):0,r=e[ATTR_BORDERS.BORDER_TOP]?parseInt(e[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.SPACE]):0,a=e[ATTR_BORDERS.BORDER_BOTTOM]?parseInt(e[ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.SPACE]):0;return n===o&&r===a?5===n&&5===r||5===n&&5===r?"narrow":15===n&&15===r||15===n&&15===r?"normal":17===n&&17===r||17===n&&17===r?"moderate":25===n&&25===r||25===n&&25===r?"wide":0===n&&0===r?"none":"custom":"custom"}return"none"},s=function(){var e=editor.doc.getSelection(),t=DocLayoutManager.getColumnFormatAtIdx(e.getStart()),i=t.count,n=t.iseqwidth;if(2==i&&!n){var o=parseInt(t.width[0]),r=parseInt(t.width[1]);if(2*o==r)return"100";if(o==2*r)return"101"}return i.toString()};return{updatePageMarginCombo:r,getMarginType:o,getPageBorderMarginType:a,getColumnCount:s}}(),PageLayoutPanel=function(e){"use strict";var t,i={},n={},o={CURRENT_SECTION:1,WHOLE_DOCUMENT:4,THIS_POINT_FORWARD:2,SELECTED_TEXT:3},r={widthEle:J("#pWidth"),heightEle:J("#pHeight"),marginsEle:J(".page-margin-spinner")},a=o.CURRENT_SECTION,s=o.CURRENT_SECTION,l={type:"solid",color:"zwdark1",width:"1px",space:"15px"},d={border1:{type:{"b-svg":"","b-img":""},width:"20px",color:"transparent",space:"0px"},border2:{type:{"b-svg":"","b-img":""},width:"20px",color:"transparent",space:"0px"},border3:{type:{"b-svg":"","b-img":""},width:"30px",color:"transparent",space:"0px"},border4:{type:{"b-svg":"","b-img":""},width:"30px",color:"transparent",space:"0px"},border5:{type:{"b-svg":"","b-img":""},width:"30px",color:"transparent",space:"0px"},border6:{type:{"b-svg":"","b-img":""},width:"30px",color:"transparent",space:"0px"},border7:{type:{"b-svg":"","b-img":""},width:"35px",color:"transparent",space:"0px"},border8:{type:{"b-svg":"","b-img":""},width:"30px",color:"transparent",space:"0px"},border9:{type:{"b-svg":"","b-img":""},width:"30px",color:"transparent",space:"0px"},border10:{type:{"b-svg":"","b-img":""},width:"20px",color:"transparent",space:"0px"}},c=!1,u={},p={b5:{label:"B5",inches:'(7.17" X 10.12")',mm:"(182.1 mm X  257 mm )"},b4:{label:"B4",inches:'(10.12" X 14.33")',mm:"(257 mm X  363.9 mm )"},a5:{label:"A5",inches:'(5.83" X 8.27")',mm:"(148 mm X 210 mm )"},a3:{label:"A3",inches:'(11.69" X 16.54")',mm:"(296.9 mm X 420.1 mm )"},folio:{label:"Folio",inches:'(8" X 13")',mm:"(203.2 mm X 330.2 mm )"},statement:{label:"Statement",inches:'(5.5" X 8.5")',mm:"(139.7 mm X 215.9 mm )"},tabloid:{label:"Tabloid",inches:'(11" X 17")',mm:"(279.4 mm X 431.8 mm )"},envelope:{label:"Envelope_10",inches:'(4.13" X 9.5")',mm:"(104.9 mm X 241.3 mm )"},executive:{label:"Executive",inches:'(7.25" X 10.5")',mm:"(184.15 mm X 266.7 mm )"},legal:{label:"Legal",inches:'(8.5" X 14")',mm:"(215.9 mm X 355.6 mm )"},letter:{label:"Letter",inches:'(8.5" X 11")',mm:"(215.9 mm X 279.4 mm )"},a4:{label:"A4",inches:'(8.27" X 11.69")',mm:"(209.9 mm X 297 mm )"}},g={none:{value:"0.00in/0.00in",label:"None",top:{inches:"0.00in",mm:"0.00mm"},left:{inches:"0.00in",mm:"0.00mm"},bottom:{inches:"0.00in",mm:"0.00mm"},right:{inches:"0.00in",mm:"0.00mm"}},wide:{value:"2.28in/1.0in",label:"Wide",top:{inches:"1.00in",mm:"25.4mm"},left:{inches:"2.28in",mm:"57.9mm"},bottom:{inches:"1.00in",mm:"25.4mm"},right:{inches:"2.28in",mm:"57.9mm"}},moderate:{value:"0.75in/1.0in",label:"Moderate",top:{inches:"1.00in",mm:"25.4mm"},left:{inches:"0.75in",mm:"19.0mm"},bottom:{inches:"1.00in",mm:"25.4mm"},right:{inches:"0.75in",mm:"19.0mm"}},narrow:{value:"0.5in/0.5in",label:"Narrow",top:{inches:"0.50in",mm:"12.7mm"},left:{inches:"0.50in",mm:"12.7mm"},bottom:{inches:"0.50in",mm:"12.7mm"},right:{inches:"0.50in",mm:"12.7mm"}},normal:{value:"1.0in/1.0in",label:"Normal",top:{inches:"1.00in",mm:"25.4mm"},left:{inches:"1.00in",mm:"25.4mm"},bottom:{inches:"1.00in",mm:"25.4mm"},right:{inches:"1.00in",mm:"25.4mm"}}},f={BDR_OUTSIDE:"page-bdr-outside",BDR_TOP:"page-bdr-top",BDR_LEFT:"page-bdr-left",BDR_RIGHT:"page-bdr-right",BDR_BOTTOM:"page-bdr-bottom",BDR_NONE:"page-bdr-none",BDR_WIDTH:"page-bdr-width",BDR_STYLE:"page-bdr-style",BDR_WIDTH_MENU:"page-bdr-width-menu",BDR_STYLE_MENU:"page-bdr-style-menu",BDR_WIDTH_MENU_ITEM:"page-bwidth-",BDR_STYLE_MENU_ITEM:"page-bstyle-",BDR_COLOR:"page-bdr-color",BG_COLOR:"page-bg-color",BG_IMG:"page-bg-img",BG_COLOR_CODE:"page-bg-color-cont",BG_IMG_FILE:"page-localimg-file",BG_IMG_FILE_PATH:"page-localimg-file-path",BG_IMG_SELECTED:"page-bgimg-selected",BG_COLOR_VALUE:"page-bg-clr-value",PAGE_BORDER_CUSTOM_MARGIN:"page-lpnl-customBradius",WATERMARK_PANEL:"watermark-panel"},E={beforeFillValues:function(){i={PAPERSIZE:null,PWIDTH:null,PHEIGHT:null,ORIENTATION:null,DEFAULTMARGINS:null,PMARGINTOP:null,PMARGINRIGHT:null,PMARGINBOTTOM:null,PMARGINLEFT:null,HEADERTOP:null,FOOTERBOTTOM:null,PAGEBGCOLOR:null,COLUMNCOUNT:null,COLUMNFORMAT:null,PAGE_BORDER_TYPE_IMAGE:!1},i=b(i)},get:function(e,t){if(O[e.action]){var i=O[e.action].get;return i?i(e,t):void 0}},set:function(e,t,n){arguments[5]&&arguments[5].keyCode==KEYS.TAB?EventHandler.isDialogFocused=!0:EventHandler.isDialogFocused=!1;var o=O[e.action].set,r=o&&o.apply(null,arguments);if(null!=r){for(var a in r)i[a]=r[a];var s=editor.getDocument();N(r,s,!0),s.sync()}}},T=function(){pe(o.CURRENT_SECTION),ge(o.CURRENT_SECTION),t=Conversions.globalUnit,r={widthEle:J("#pWidth"),heightEle:J("#pHeight"),marginsEle:J(".page-margin-spinner")},H(),I(),Y(),_(),LeftPanel.bindCloseBtn(e.PAGELAYOUTPANEL)},m=function(e,t){var i="<span>"+p[e].label+"</span><span id="+p[e].label+" class='ui-clr-gray3 ui-left-margin-small'>"+p[e][t]+"</span>";return{innerHtml:i,label:i,value:p[e].label}},h=function(e,t){var i="";switch(e){case"normal":i="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-normal-lg";break;case"moderate":i="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-moderate-lg";break;case"narrow":i="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-narrow-lg";break;case"wide":i="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-wide-lg";break;case"none":i="ui-fl zbutton__icon ui-sprit-crazy ui-icon-po-none-lg"}var n="<div class='ui-combo-opt clearfix'><span class='"+i+"'></span><div class='ui-combo-opt-cont'><div class='ui-combo-opt-title'>"+g[e].label+"</div><div class='ui-combo-opt-pos'><div><span>Top</span><span id='normal_top'>: "+g[e].top[t]+",</span><span>Left</span><span id='normal_left'>:"+g[e].left[t]+"</span></div><div><span>Bottom</span><span id='normal_bottom'>:"+g[e].bottom[t]+",</span><span>Right</span><span id='normal_right'>:"+g[e].right[t]+"</span></div></div></div></div>",o={innerHtml:n,label:g[e].label,value:g[e].value};return o},I=function(){var e,t;if(Conversions.globalUnit===UNITS.INCHES)e="inches",t="inches";else{if(Conversions.globalUnit!==UNITS.MILLIMETERS)return;e="mm",t="millimeters"}var i=J("#page-lpnl-marginlist"),n=J("#page-lpnl-pagesizelist");i.find(".manual-marginsize-option").remove();for(var o in g){var r=h(o,e),a={};a.innerHTML=r.innerHtml,a.replaceWithText=!0,a.label=r.label;var s=document.createElement("option");J(s).addClass("manual-marginsize-option"),i.prepend(s),J(s).attr({data:JSON.stringify(a),value:r.value})}i.zlabeledselectbox("refresh"),n.find(".manual-pagesize-option").remove();for(var l in p){var d=m(l,e),a={};a.innerHTML=d.innerHtml,a.replaceWithText=!0,a.label=d.label;var s=document.createElement("option");J(s).addClass("manual-pagesize-option"),n.prepend(s),J(s).attr({data:JSON.stringify(a),value:d.value})}n.zlabeledselectbox("refresh");var c=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),u=c.getFirstSectionFormat();n.zselectbox("setValue",u[ATTR_BODY.DS_PS])},_=function(){var t=Z(e.PAGELAYOUTPANEL);c?(LeftPanel.isPanelVisible(e.PAGELAYOUTPANEL)||LeftPanel.isPanelVisible(e.PAGEBORDERSPANEL))&&t.ZCtrackObjects("refreshValues"):(UIUtils.initComponent(e.PAGELAYOUTPANEL),c=!0,Z("page-sub-pnl-options").ztabpanel("openTab",0),t.ZCtrackObjects({callbacks:E,fillVisible:!1})),a=o.CURRENT_SECTION},A=function(){},S=function(){T()},R=function(){LeftPanel.closeDynamicPanel(e.PAGELAYOUTPANEL),A()},O={PAGE_SIZE:{get:function(e,t){return"Custom"==i.PAPERSIZE?J("#page-lpnl-custom").show():J("#page-lpnl-custom").hide(),i.PAPERSIZE},set:function(e,n,o){if("Custom"==n)return void J("#page-lpnl-custom").show();J("#page-lpnl-custom").hide();var r={},a=F(n,t,i.ORIENTATION),s=M(a.width);return s?(r.PAPERSIZE=n,J("#pHeight").zlabelednumberfield("setValue",a.height),J("#pWidth").zlabelednumberfield("setValue",a.width),r.PHEIGHT=a.height+t,r.PWIDTH=a.width+t,r):(J("#page-lpnl-pagesizelist").zlabeledselectbox("setValue",i.PAPERSIZE),void PubSub.publish("Document/Warning",WARNING_MSG.COLUMN_WIDTH_IS_LESS,3))}},PAGE_WIDTH:{get:function(e,t){return i.PWIDTH},set:function(e,n,o){var r=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),a=r.getFirstSectionFormat(),s=a[ATTR_BODY.DS_OR],l={};return l.PAPERSIZE=PageLayout.getPaperSize(n,parseFloat(i.PHEIGHT),t,s),l.ORIENTATION=PAGE_ORIENTATION.PORTRAIT,parseFloat(i.PHEIGHT)<n&&(l.ORIENTATION=PAGE_ORIENTATION.LANDSCAPE),l.PWIDTH=n+t,l.PHEIGHT=parseFloat(i.PHEIGHT)+t,J("input[value="+l.ORIENTATION+"]").attr("checked","true"),l}},PAGE_HEIGHT:{get:function(e,t){return i.PHEIGHT},set:function(e,n,o){var r=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),a=r.getFirstSectionFormat(),s=a[ATTR_BODY.DS_OR],l={};return l.PAPERSIZE=PageLayout.getPaperSize(parseFloat(i.PWIDTH),n,t,s),l.ORIENTATION=PAGE_ORIENTATION.PORTRAIT,n<parseFloat(i.PWIDTH)&&(l.ORIENTATION=PAGE_ORIENTATION.LANDSCAPE),l.PHEIGHT=n+t,l.PWIDTH=parseFloat(i.PWIDTH)+t,J("input[value="+l.ORIENTATION+"]").attr("checked","true"),l}},PAGE_ORIENTATION:{get:function(e,t){var n=i.ORIENTATION==PAGE_ORIENTATION.LANDSCAPE?J.i18n("writer.common.LANDSCAPE"):J.i18n("writer.common.PORTRAIT");return J("#page-lpnl-orientationbtn").text(n),J("input:radio[name='Orientation'][value='"+i.ORIENTATION+"']").zstatebutton("checked",!0),i.ORIENTATION},set:function(e,n,r){if(a==o.WHOLE_DOCUMENT)return void x(n);var s={};if(n=J(r).attr("value"),s.ORIENTATION=n,n==i.ORIENTATION)return{};var l={};"Custom"==i.PAPERSIZE?(l.height=i.PWIDTH+t,l.width=i.PHEIGHT+t):l=F(i.PAPERSIZE,t,s.ORIENTATION),s.PHEIGHT=l.height+t,s.PWIDTH=l.width+t;var d=M(l.width);return d?s:(J("input:radio[name='Orientation'][value='"+n+"']").zstatebutton("checked",!0),PubSub.publish("Document/Warning",WARNING_MSG.COLUMN_WIDTH_IS_LESS),{})}},PAGE_COLUMNCOUNT:{get:function(e,t){t.zbutton("option","checked",!1);var n=editor.doc.getSelection();return n.isCollapsed()?i.COLUMNCOUNT:void 0},set:function(e,t,i){var n={};ZWLogger.addToStatistics("Multi_Column");var t=J(i).attr("value"),o=parseInt(t),r=[],a=[],s=!0,l=Conversions.toGlobalValue("0.5in"),d="";if(100==o?(o=2,d="left",s=!1):101==o&&(o=2,d="right",s=!1),!s){var c=DocLayoutManager.getCurrentSection(),u=c.getWidth(),p=u-(o-1)*l.convertor().pixels;p/=o+1,"left"==d?(r[0]=Conversions.toGlobalValue(p+"px"),r[1]=Conversions.toGlobalValue(2*p+"px")):"right"==d&&(r[0]=Conversions.toGlobalValue(2*p+"px"),r[1]=Conversions.toGlobalValue(p+"px")),a.push(l)}return n.COLUMNFORMAT={},n.COLUMNFORMAT[ATTR_BODY.DS_COLCOUNT]=o,n.COLUMNFORMAT[ATTR_BODY.DS_COLWID]=r,n.COLUMNFORMAT[ATTR_BODY.DS_COLSPACE]=a,n.COLUMNFORMAT[ATTR_BODY.DS_COLSEP]="0",n.COLUMNFORMAT[ATTR_BODY.DS_DEFAULTSPACE]=l,n.COLUMNFORMAT[ATTR_BODY.DS_COLISEQWID]=s,n}},PAGE_DEFAULT_MARGINS:{get:function(e,t){var n=i.DEFAULTMARGINS;if("custom"!=n){var o=["narrow","normal","moderate","wide","none"],r=["0.5in/0.5in","1.0in/1.0in","0.75in/1.0in","2.28in/1.0in","0.00in/0.00in"];n=r[o.indexOf(n)]}else J("#page-lpnl-custommargin").show();return n},set:function(e,t,i){if("custom"==t)return void J("#page-lpnl-custommargin").show();J("#page-lpnl-custommargin").hide();var n={},o=t.split("/"),r=o[1].convertor().inches,a=o[1].convertor().inches,s=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),l=s.getFirstSectionFormat();return y(r,a,l.ph)?(n.PMARGINLEFT=n.PMARGINRIGHT=o[0],n.PMARGINTOP=n.PMARGINBOTTOM=o[1],n):void setTimeout(function(){UIUtils.showMessagePopup(J.i18n("writer.common.PAGE_SIZE_SMALL_MSG"),J.i18n("writer.common.PAGE_SIZE_TOO_SMALL"),"info")},50)}},PAGE_MARGIN_TOP:{get:function(e,t){return i.PMARGINTOP},set:function(e,i,n){var o={};o.PMARGINTOP=i+t;var r=(J("#headerTop"),DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup()),a=r.getFirstSectionFormat();return y((i+t).convertor().inches,a.mb.convertor().inches,a.ph)?o:void setTimeout(function(){UIUtils.showMessagePopup(J.i18n("writer.common.PAGE_SIZE_SMALL_MSG"),J.i18n("writer.common.PAGE_SIZE_TOO_SMALL"),"info")},50)}},PAGE_MARGIN_LEFT:{get:function(e,t){return i.PMARGINLEFT},set:function(e,i,n){var o={};return o.PMARGINLEFT=i+t,o}},PAGE_MARGIN_BOTTOM:{get:function(e,t){return i.PMARGINBOTTOM},set:function(e,i,n){var o={},r=(J("#footerBottom"),DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup()),a=r.getFirstSectionFormat();return y(a.mt.convertor().inches,(i+t).convertor().inches,a.ph)?(o.PMARGINBOTTOM=i+t,o):void setTimeout(function(){UIUtils.showMessagePopup(J.i18n("writer.common.PAGE_SIZE_SMALL_MSG"),J.i18n("writer.common.PAGE_SIZE_TOO_SMALL"),"info")},50)}},PAGE_MARGIN_RIGHT:{get:function(e,t){return i.PMARGINRIGHT},set:function(e,i,n){var o={};return o.PMARGINRIGHT=i+t,o}},PAGE_HEADERTOP:{get:function(e,t){return i.HEADERTOP=parseFloat(Conversions.toGlobalValue(U(t)+"px")),i.HEADERTOP},set:function(e,i,n){var o={};return i=U(n,"header",i+t),B(J("#footerBottom"),"header",i+"px"),o.HEADERTOP=Conversions.toGlobalValue(i+"px"),o}},PAGE_FOOTERBOTTOM:{get:function(e,t){return i.FOOTERBOTTOM=parseFloat(Conversions.toGlobalValue(B(t)+"px")),i.FOOTERBOTTOM},set:function(e,i,n){var o={};return i=B(n,"footer",i+t),U(J("#headerTop"),"footer",i+"px"),o.FOOTERBOTTOM=Conversions.toGlobalValue(i+"px"),o}},PAGEBGCOLOR:{get:function(e,t){return J("#pgformat_clrfld").one("colorfieldcolorselected",function(e,t){return i.PAGEBGCOLOR}),Utils.getColorValFromRefString(i.PAGEBGCOLOR)},set:function(e,t,i,n){var o={};return"none"==t&&(t=arguments[4].color="rgb(255, 255, 255)",arguments[4].color="rgb(255,255,255)"),document.getElementById("pagebgcolorhelper").innerHTML=zoho.color.rgbToHex(t),o.PAGEBGCOLOR=Utils.getColorReference(arguments[4]),o}},PAGESETASDEFAULT:{get:function(e,t){"REMOTE"==editor.getEditorType()||"TEMPLATEUSER"==editor.doc.getRole()?J("#pl_makedefault").hide():"EXTERNAL_SHAREDREADWRITE"!==editor.doc.getRole()&&"ANYONELINK_SHAREDREADWRITE"!==editor.doc.getRole()||J("#pl_makedefault").hide(),v()?J("#pl_makedefault").disable():J("#pl_makedefault").enable()},set:function(e,t,i){D()}},PAGE_BORDER_OUTSIDE:{get:function(){if(J("#page-bdr-selection .ui-sbdr-cont").hasClass("ui-icon-ball-out-sm")){J("#page-bdr-selection .ui-sbdr-cont").removeClass("ui-icon-ball-out-sm");BorderUtils.getSelectedSides("page")}},set:function(e,t,i){Z(f.BDR_TOP).zstatebutton("checked",t),Z(f.BDR_RIGHT).zstatebutton("checked",t),Z(f.BDR_BOTTOM).zstatebutton("checked",t),Z(f.BDR_LEFT).zstatebutton("checked",t),Z(f.BDR_NONE).zstatebutton("checked",!1),z(e,i),BorderUtils.selectSide(f,"page-bdr-selection")}},PAGE_BORDER_TOP:{set:function(e,t,i){z(e,i),BorderUtils.selectSide(f,"page-bdr-selection")}},PAGE_BORDER_BOTTOM:{set:function(e,t,i){z(e,i),BorderUtils.selectSide(f,"page-bdr-selection")}},PAGE_BORDER_LEFT:{set:function(e,t,i){z(e,i),BorderUtils.selectSide(f,"page-bdr-selection")}},PAGE_BORDER_RIGHT:{set:function(e,t,i){z(e,i),BorderUtils.selectSide(f,"page-bdr-selection")}},PAGE_BORDER_NONE:{set:function(e,t,i){ie(),z(e,i)}},PAGE_BORDER:{get:function(e,t){if(Macros.isRemote())return J("#pageborders-border1").parent().zmenu().hide(),i.PAGE_BORDERS||ce(),void J("#page-border-options").show();if(i.PAGE_BORDERS&&"normal"==i.PAGE_BORDERS[ATTR_BORDERS.BORDER_TYPE])de(),J("#page-border-options").show(),Z("page-border-menu").zmenu("check","pageborders-style1");else if(J("#page-border-options").hide(),i.PAGE_BORDERS){var n=i.PAGE_BORDERS[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.TYPE][ATTR_BORDERS.B_SVG];Z("page-border-menu").zmenu("check","pageborders-"+n)}else ce(),Z("page-border-menu").zmenu("check","pageborders-none")},set:function(e,t,n){if("pageborders-style1"==t.id){i.PAGE_BORDER_TYPE_IMAGE=!1,J("#page-border-options").show(),de();var o=["border-top","border-left","border-bottom","border-right"],r=ee(i.PAGE_BORDER_TYPE_IMAGE,o,"width","5px",!0);return r}if("pageborders-none"==t.id){i.PAGE_BORDERS=null;var r={};return J("#page-border-options").hide(),ce(),r.resetBorder="resetBorder",r}return"pageborders-more"==t.id?void q():(de(),J("#page-border-options").hide(),i.PAGE_BORDER_TYPE_IMAGE=!0,void oe(t.getAttribute("value")).then(function(e){if(null!=e){for(var t in e)i[t]=e[t];var n=editor.getDocument();N(e,n),n.sync()}}))}},PAGE_BORDER_COLOR:{get:function(e,t){return i.border&&0!=i.border[ATTR_BORDERS.COLOR]?(V(i.border[ATTR_BORDERS.COLOR],!0),i.border[ATTR_BORDERS.COLOR]):(V("rgb(0, 0, 0)",!0),"rgb(0, 0, 0)")},set:function(e,t,n){if(arguments[4].color&&arguments[4].fromUI){de(),V(ZWColorUtils.rgbToHex(arguments[4].color),!0);var o=Utils.getColorReference(arguments[4]),r=se("page"),a=ee(i.PAGE_BORDER_TYPE_IMAGE,r,"color",o);return a}}},PAGE_BORDER_RESET:{get:function(e,t){},set:function(e,t,n){var o={};return V("rgb(0,0,0)"),ce(),i.PAGE_BORDERS=null,o.resetBorder="resetBorder",o}},PAGE_BORDER_WIDTH:{get:function(e,t){i.border&&!i.PAGE_BORDER_TYPE_IMAGE&&Z(f.BDR_WIDTH_MENU).zmenu("check",f.BDR_WIDTH_MENU_ITEM+i.border.width)},set:function(e,t,n){de();var o=se("page"),r=$(t).attr("value"),o=se("page"),a=ee(i.PAGE_BORDER_TYPE_IMAGE,o,"width",parseFloat(r)+UNITS.PIXELS);return a}},PAGE_BORDER_RADIUS:{get:function(e,t){return!i.PAGE_BORDER_TYPE_IMAGE&&i.PAGE_BORDERS&&i.PAGE_BORDERS[ATTR_BORDERS.BORDER_RADIUS]?i.PAGE_BORDERS[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_TOPLEFT]:"0px"},set:function(e,t,n){var o={};if(i.PAGE_BORDERS)return o.PAGE_BORDERS=DocUtil.copyStyle(i.PAGE_BORDERS),o.PAGE_BORDERS[ATTR_BORDERS.BORDER_RADIUS]={},o.PAGE_BORDERS[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_TOPLEFT]=t,o.PAGE_BORDERS[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_TOPRIGHT]=t,o.PAGE_BORDERS[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_BOTTOMLEFT]=t,o.PAGE_BORDERS[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_BOTTOMRIGHT]=t,o}},PAGE_BORDER_TYPE:{get:function(e,t){i.border&&!i.PAGE_BORDER_TYPE_IMAGE&&Z(f.BDR_STYLE_MENU).zmenu("check",f.BDR_STYLE_MENU_ITEM+i.border.type)},set:function(e,t,n){de();var o=se("page"),r=$(t).attr("value"),a=ee(i.PAGE_BORDER_TYPE_IMAGE,o,"type",r);return a}},PAGE_BORDER_DISPLAY_NONE:{set:function(e,t,n){if(i.PAGE_BORDERS){var o=se("page"),o=BorderUtils.getSelectedSides("page"),r=ee(i.PAGE_BORDER_TYPE_IMAGE,o,"width","0px");return r}}},PAGE_BORDER_MARGIN:{get:function(e,t){var n=i.PAGE_BORDER_MARGIN;if("custom"!=n){var o=["narrow","normal","moderate","wide","none"],r=["5px/5px","15px/15px","17px/17px","25px/25px","0px/0px"];n=r[o.indexOf(n)],J("#page-lpnl-customBradius").hide()}else J("#page-lpnl-customBradius").show();return n},set:function(e,t,n){if("custom"==t)return void Z(f.PAGE_BORDER_CUSTOM_MARGIN).show();if(Z(f.PAGE_BORDER_CUSTOM_MARGIN).hide(),i.PAGE_BORDERS){var o=t.split("/"),r=["border-left","border-right"],a=ee(i.PAGE_BORDER_TYPE_IMAGE,r,"space",o[0]);r=["border-top","border-bottom"];var s=ee(i.PAGE_BORDER_TYPE_IMAGE,r,"space",o[1]);return s.PAGE_BORDERS["border-left"]=a.PAGE_BORDERS["border-left"],s.PAGE_BORDERS["border-right"]=a.PAGE_BORDERS["border-right"],s}}},PAGE_BORDER_MARGIN_TOP:{get:function(e,t){if(i.borderStyles&&i.borderStyles.paddingTop)return i.borderStyles.paddingTop+"px"},set:function(e,t,n){var o={},r=[];if(i.PAGE_BORDERS){J("#keepaspectformargin").zbutton("getAttribute","checked")?(r=["border-top","border-right","border-left","border-bottom"],P(["pageBorderMarginRight","pageBorderMarginBottom","pageBorderMarginLeft"],t)):r=["border-top"];var o=ee(i.PAGE_BORDER_TYPE_IMAGE,r,"space",parseFloat(t)+"px");return o}}},PAGE_BORDER_MARGIN_BOTTOM:{get:function(e,t){if(i.borderStyles&&i.borderStyles.paddingBottom)return i.borderStyles.paddingBottom+"px"},set:function(e,t,n){var o={},r=[];if(i.PAGE_BORDERS){J("#keepaspectformargin").zbutton("getAttribute","checked")?(r=["border-top","border-right","border-left","border-bottom"],P(["pageBorderMarginTop","pageBorderMarginRight","pageBorderMarginLeft"],t)):r=["border-bottom"];var o=ee(i.PAGE_BORDER_TYPE_IMAGE,r,"space",parseFloat(t)+"px");return o}}},PAGE_BORDER_MARGIN_LEFT:{get:function(e,t){if(i.borderStyles&&i.borderStyles.paddingLeft)return i.borderStyles.paddingLeft+"px"},set:function(e,t,n){var o={},r=[];if(i.PAGE_BORDERS){J("#keepaspectformargin").zbutton("getAttribute","checked")?(r=["border-top","border-right","border-left","border-bottom"],P(["pageBorderMarginTop","pageBorderMarginBottom","pageBorderMarginRight"],t)):r=["border-left"];var o=ee(i.PAGE_BORDER_TYPE_IMAGE,r,"space",parseFloat(t)+"px");return o}}},PAGE_BORDER_MARGIN_RIGHT:{get:function(e,t){if(i.borderStyles&&i.borderStyles.paddingRight)return i.borderStyles.paddingRight+"px"},set:function(e,t,n){var o={},r=[];if(i.PAGE_BORDERS){J("#keepaspectformargin").zbutton("getAttribute","checked")?(r=["border-top","border-right","border-left","border-bottom"],P(["pageBorderMarginTop","pageBorderMarginBottom","pageBorderMarginLeft"],t)):r=["border-right"];var o=ee(i.PAGE_BORDER_TYPE_IMAGE,r,"space",parseFloat(t)+"px");return o}}},PAGE_BORDER_DISPLAY:{get:function(e,t){return i.PAGE_BORDERS?i.PAGE_BORDERS[ATTR_BORDERS.BORDER_DISPLAY]:ATTR_PAGEBORDERS.ALL_PAGES},set:function(e,t,n){if(i.PAGE_BORDERS){var o=se("page"),r=ee(i.PAGE_BORDER_TYPE_IMAGE,o,ATTR_BORDERS.BORDER_DISPLAY,t);return r}}},PAGE_BG_COLOR:{get:function(e,t){return j(),!0},set:function(e,t,i){j()}},PAGE_BG_COLOR_PICKER:{get:function(e,t){return i.PAGEBGCOLOR?(le(Utils.getColorValFromRefString(i.PAGEBGCOLOR)),Utils.getColorValFromRefString(i.PAGEBGCOLOR)):void le(null)},set:function(e,t,i){var n=ZWColorUtils.rgbToHex(t);"transparent"===t?Z(f.BG_COLOR_VALUE).text(""):Z(f.BG_COLOR_VALUE).text(n);var o={};return"transparent"==t&&(t=arguments[4].color="rgb(255, 255, 255)",arguments[4].color="rgb(255,255,255)"),le(Utils.getColorReference(arguments[4])),o.PAGEBGCOLOR=Utils.getColorReference(arguments[4]),o}},PAGE_BACKGROUND_RESET:{set:function(e,t,i){le(),Z("page-bg-none").zstatebutton("checked",!0);var n={};return n.resetBackground="resetBackground",n}},PAGE_BG_IMG:{get:function(e,t){i.bgimg?(Z(f.BG_IMG).zstatebutton("checked",!0),K()):Z(f.BG_IMG_FILE).hide()},set:function(e,t,n){i.bgimg?K():X()}},PAGE_BG_IMG_UPLOAD:{set:function(e,t,n){i.bgimg?K():X();var o={},r=Z(f.BG_IMG_FILE_PATH).val();return o.bgimg=r,o}},PAGE_BG_NONE:{get:function(e,t){},set:function(e,t,i){le(null);var n={};return n.PAGEBGCOLOR="rgb(255,255,255)",n}},OPEN_COLUMN_DIALOG:{set:function(e,t,i){PubSub.publish("PageLayout/ShowAdvancedPanel",{tabToBeOpened:"column",isSectionLevel:!0})}},ADVANCEDPANEL:{set:function(e,t,i){var n=t.getAttribute("value"),o="section"==n;PubSub.publish("PageLayout/ShowAdvancedPanel",{isSectionLevel:o})}},BORDER_PROPERTIES:{set:function(e,t,i){PubSub.publish("PageLayout/ShowAdvancedPanel",{tabToBeOpened:"borders",isSectionLevel:!0})}}},b=function(e){var i=DocLayoutManager.getCurrentSection();if(i){var o=i.getColumnFormat(),r=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),a=DocLayoutManager.getCurrentSection(),s=ZWJSONUtils.clone(a.getFormats()),l=r.getFirstSectionFormat();i.getSectionType()!=SECTION_TYPES.CONTENT&&(s=l),e.PWIDTH=Conversions.toGlobalUnit(l[ATTR_BODY.DS_PW]),e.PHEIGHT=Conversions.toGlobalUnit(l[ATTR_BODY.DS_PH]);var d=PAGE_ORIENTATION.PORTRAIT;if(e.PWIDTH>e.PHEIGHT&&(d=PAGE_ORIENTATION.LANDSCAPE),e.ORIENTATION=d,e.PAPERSIZE=PageLayout.getPaperSize(e.PWIDTH,e.PHEIGHT,t,e.ORIENTATION),e.DEFAULTMARGINS=PageLayoutUtil.getMarginType(),e.PMARGINTOP=Conversions.toGlobalUnit(l[ATTR_BODY.DS_MT]),e.PMARGINRIGHT=Conversions.toGlobalUnit(s[ATTR_BODY.DS_MR]),e.PMARGINLEFT=Conversions.toGlobalUnit(s[ATTR_BODY.DS_ML]),e.PMARGINBOTTOM=Conversions.toGlobalUnit(l[ATTR_BODY.DS_MB]),e.HEADERTOP=Conversions.toGlobalUnit(l[ATTR_BODY.DS_HT]),e.FOOTERBOTTOM=Conversions.toGlobalUnit(l[ATTR_BODY.DS_FB]),e.PAGEBGCOLOR=s[ATTR_BODY.DS_BGC],e.COLUMNCOUNT=w(),e.COLUMNFORMAT=o,e.PAGE_BORDER_MARGIN=C(),e.PAGE_BORDERS=l[ATTR_COMMON.BORDERS],e.PAGE_BORDER_TYPE_IMAGE=e.PAGE_BORDERS&&"image"==e.PAGE_BORDERS[ATTR_BORDERS.BORDER_TYPE],e.PAGE_BORDERS&&(e.borderStyles=DomUtil.getBorderStyles({borders:e.PAGE_BORDERS})),!e.PAGE_BORDER_TYPE_IMAGE){var c=se("page"),u={};if(e.PAGE_BORDERS)for(var p=0;p<c.length;p++)u[c[p]]=e.PAGE_BORDERS[c[p]]?e.PAGE_BORDERS[c[p]]:{};var g=BorderUtils.getBorderValuesForUpdateUI(u);g.color=Utils.getColorValFromRefString(g.color),e.border=g?g:{}}return n={PAPERSIZE:ATTR_BODY.DS_PS,PWIDTH:ATTR_BODY.DS_PW,PHEIGHT:ATTR_BODY.DS_PH,ORIENTATION:ATTR_BODY.DS_OR,PMARGINTOP:ATTR_BODY.DS_MT,PMARGINRIGHT:ATTR_BODY.DS_MR,PMARGINBOTTOM:ATTR_BODY.DS_MB,PMARGINLEFT:ATTR_BODY.DS_ML,HEADERTOP:ATTR_BODY.DS_HT,FOOTERBOTTOM:ATTR_BODY.DS_FB,PAGEBGCOLOR:ATTR_BODY.DS_BGC,COLUMNFORMAT:ATTR_BODY.DS_COLCOLS,PAGESETASDEFAULT:"PAGESETASDEFAULT",PAGE_BORDERS:ATTR_COMMON.BORDERS,cols:"cols",GUTTER:"gutter",specialMargins:"specialMargins"},e}},v=function(e){e||(e={},e[ATTR_BODY.DS_PH]=parseFloat(i.PHEIGHT)+t,e[ATTR_BODY.DS_PW]=parseFloat(i.PWIDTH)+t,e[ATTR_BODY.DS_ML]=parseFloat(i.PMARGINLEFT)+t,e[ATTR_BODY.DS_MR]=parseFloat(i.PMARGINRIGHT)+t,e[ATTR_BODY.DS_MT]=parseFloat(i.PMARGINTOP)+t,e[ATTR_BODY.DS_MB]=parseFloat(i.PMARGINBOTTOM)+t,e[ATTR_BODY.DS_HT]=parseFloat(i.HEADERTOP)+t,e[ATTR_BODY.DS_FB]=parseFloat(i.FOOTERBOTTOM)+t);var n=!0;for(var o in w_usersettings)if(n&&"undefined"!=typeof e[o]){var r=o!=ATTR_BODY.DS_PS?parseInt(e[o].convertor().pixels):e[o],a=o!=ATTR_BODY.DS_PS?parseInt(w_usersettings[o].convertor().pixels):w_usersettings[o];r!=a&&(n=!1)}else if(!n)break;return n},D=function(){var e={};e[ATTR_BODY.DS_PH]=parseFloat(i.PHEIGHT)+t,e[ATTR_BODY.DS_PW]=parseFloat(i.PWIDTH)+t,e[ATTR_BODY.DS_PS]=i.PAPERSIZE,e[ATTR_BODY.DS_ML]=parseFloat(i.PMARGINLEFT)+t,e[ATTR_BODY.DS_MR]=parseFloat(i.PMARGINRIGHT)+t,e[ATTR_BODY.DS_MT]=parseFloat(i.PMARGINTOP)+t,e[ATTR_BODY.DS_MB]=parseFloat(i.PMARGINBOTTOM)+t,e[ATTR_BODY.DS_HT]=parseFloat(i.HEADERTOP)+t,e[ATTR_BODY.DS_FB]=parseFloat(i.FOOTERBOTTOM)+t,v(e)||(Settings.updateUserSettings(e),J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/pagelayout"),data:e,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(){UIUtils.showMessage("info",J.i18n("writer.common.SET_DEFAULT_DOCUMENT_STYLE_SUCCESS_MSG"),"showclose","normalfont",8e3),_(),J.dialogutil.close("pagelayout")},error:function(e){}}))},L=[ATTR_BODY.DS_MT,ATTR_BODY.DS_MB,ATTR_BODY.DS_HT,ATTR_BODY.DS_FB],N=function(e,t,i){try{var r={},s={},l=DocLayoutManager.getCurrentGutter();e.layoutApplyType&&(a=e.layoutApplyType);for(var d in e)n[d]&&(r[n[d]]=e[d]);if(e.resetBorder&&(r.borders=null),e.resetBackground?s.resetBackground=!0:r.bgc&&(s.bgc=r.bgc,delete r.bgc),e.resetSpecialMargins?s.resetSpecialMargins=!0:r.specialMargins&&(s.specialMargins=r.specialMargins,delete r.specialMargins),!ZWJSONUtils.isEmptyObject(s)){var c=editor.doc.getSelection().getParents(NODE_TYPE.BODY);Command.exec("applyStyle",[c,s,"updatePageLayout"])}var u=r.gutter;if(a!=o.WHOLE_DOCUMENT&&u&&("top"==u.position||l&&"top"==l.position)){for(var p=DocTreeManager.getAllSectionsByType(SECTION_TYPES.CONTENT),g=[],f=p.length,E=DocLayoutManager.getCurrentSection(),T=0;T<f;T++){var m=p[T],h=m.format,I={};if(I.gutter=ZWJSONUtils.clone(r.gutter),m!=E.getNode()){h.gutter&&h.gutter.value?I.gutter.value=h.gutter.value:I.gutter.value="0.00"+Conversions.globalUnit;var A={sectionNodes:[p[T]],styles:I};g.push(A)}}Command.exec("applySectionsStyles",[g,t])}var E=DocLayoutManager.getCurrentSection();if(E.getBreakType()==BREAK_TYPES.CONTINUOUS&&a==o.CURRENT_SECTION){var S=!(!r.hasOwnProperty(ATTR_SECTION.GUTTER)||"left"!=r[ATTR_SECTION.GUTTER].position&&"right"!=r[ATTR_SECTION.GUTTER].position);if(r.hasOwnProperty(ATTR_BODY.DS_ML)||r.hasOwnProperty(ATTR_BODY.DS_MR)||S){var R={};r.hasOwnProperty(ATTR_BODY.DS_ML)&&(R[ATTR_BODY.DS_ML]=r[ATTR_BODY.DS_ML]),r.hasOwnProperty(ATTR_BODY.DS_MR)&&(R[ATTR_BODY.DS_MR]=r[ATTR_BODY.DS_MR]),S&&(R[ATTR_SECTION.GUTTER]=ZWJSONUtils.clone(r[ATTR_SECTION.GUTTER]));var O=[E.getNode()];Command.exec("updatesectionstyle",[{sectionNodes:O,styles:R},t]),delete r[ATTR_BODY.DS_ML],delete r[ATTR_BODY.DS_MR],i||(S&&delete r[ATTR_SECTION.GUTTER],delete r[ATTR_BODY.DS_MT],delete r[ATTR_BODY.DS_MB],delete r[ATTR_BODY.DS_HT],delete r[ATTR_BODY.DS_FB])}}if(!ZWJSONUtils.isEmptyObject(r)){var O;if(a==o.WHOLE_DOCUMENT)O=DocTreeManager.getAllSectionsByType(SECTION_TYPES.CONTENT);else if(a==o.THIS_POINT_FORWARD){var b=DocLayoutManager.getCurrentGroup(),v=b.getFirstContentDTView();O=v.next?DocTreeManager.getAllSectionsByTypeFromIndex(SECTION_TYPES.CONTENT,v.next.start):[]}else{for(var D=!1,T=0;T<L.length;T++){var N=L[T];if(r[N]){D=!0;break}}var P=!!r.hasOwnProperty(ATTR_COMMON.BORDERS),C=!!(r.hasOwnProperty(ATTR_SECTION.GUTTER)&&"top"==r[ATTR_SECTION.GUTTER].position||l&&"top"==l.position),E=DocLayoutManager.getCurrentSection();if((E.getSectionType()!=SECTION_TYPES.CONTENT||D||P)&&a!=o.SELECTED_TEXT){var b=DocLayoutManager.getCurrentGroup(),v=b.getFirstContentDTView();O=[v.getNode()]}else{for(var y=!1,T=0;T<LAYOUT_STYLE_PROPS.length;T++){var N=LAYOUT_STYLE_PROPS[T];if(r[N]){y=!0;break}}if(y||C)O=[E.getNode()];else{var F=editor.doc.getSelection();O=F.isCollapsed()?[E.getNode()]:[]}}}var M={};if(i?M[ATTR_SECTION.BREAK_TYPE]=BREAK_TYPES.CONTINUOUS:M[ATTR_SECTION.BREAK_TYPE]=BREAK_TYPES.NEXT_PAGE,a==o.THIS_POINT_FORWARD||a==o.SELECTED_TEXT){if(te()){var w=ZWJSONUtils.clone(r);w[ATTR_SECTION.BREAK_TYPE]=BREAK_TYPES.NEXT_PAGE,Command.exec("insertsectionbreak",w,M)}Command.exec("updatesectionstyle",[{sectionNodes:O,styles:r},t])}else O.length>0?Command.exec("updatesectionstyle",[{sectionNodes:O,styles:r},t]):te()&&Command.exec("insertsectionbreak",r,M)}H(),(r.borders||r.resetBorder)&&_()}catch(e){ZWCollaboration.clientInfo+="Catch Exception in Pageloyout apply values"+e}},P=function(e,t){for(var i=e.length,n=0;n<i;n++)Z(e[n]).zlabelednumberfield("setAttributes",{suffix:"px"}),Z(e[n]).zlabelednumberfield("setValue",t)},C=function(){ZWLogger.addToStatistics("pg_margin");var e=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),t=e.getFirstSectionFormat(),i=t.borders;if(i){var n=i[ATTR_BORDERS.BORDER_LEFT]?parseInt(i[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]):0,o=i[ATTR_BORDERS.BORDER_RIGHT]?parseInt(i[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]):0,r=i[ATTR_BORDERS.BORDER_TOP]?parseInt(i[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.SPACE]):0,a=i[ATTR_BORDERS.BORDER_BOTTOM]?parseInt(i[ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.SPACE]):0;return n===o&&r===a?5===n&&5===r||5===n&&5===r?"narrow":15===n&&15===r||15===n&&15===r?"normal":17===n&&17===r||17===n&&17===r?"moderate":25===n&&25===r||25===n&&25===r?"wide":0===n&&0===r?"none":"custom":"custom"}return"none"},y=function(e,t,i){return!(e+t+CONST.MIN_PAPER_HEIGHT.convertor().inches>i.convertor().inches)},F=function(e,t,i){"in"==t&&(t="inch");var n=PageLayout.Paper[e][i].height[t],o=PageLayout.Paper[e][i].width[t];return{height:n,width:o}},M=function(e){"string"==typeof e&&(e=e.convertor().pixels);var t=DocLayoutManager.getCurrentSection();if(!t)return!1;var i=t.isEqualColumnWidth(),n=t.getColumnCount();if(!i||n<=1)return!0;var o=t.getLeft(),r=t.getRight(),a=CONST.MIN_COLUMN_WIDTH.convertor().pixels*n,s=t.getColumnSpace(0),l=s*(n-1),d=a+l+o+r;return d<=e},w=function(){var e=editor.doc.getSelection(),t=DocLayoutManager.getColumnFormatAtIdx(e.getStart()),i=t.count,n=t.iseqwidth;if(2==i&&!n){var o=parseInt(t.width[0]),r=parseInt(t.width[1]);if(2*o==r)return"100";if(o==2*r)return"101"}return i.toString()},U=function(e,t,i){e&&e[0]||(e=J("#headerTop"));var n=Conversions.step,o=editor.currentPageIndex+1,r=DocLayoutManager.getPageAtPageNumber(o);if(null==r)return i;var a,s,l,d=r.getHeight(),c=r&&r.getHeader()?r.getHeader().getHeight():0,u=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),p=u.getFirstSectionFormat(),g=(p[ATTR_BODY.DS_HT]||"0in").convertor().pixels,f=(p[ATTR_BODY.DS_FB]||"0in").convertor().pixels,E=p.mt.convertor().pixels,T=p.mb.convertor().pixels,m=CONST.MIN_PAPER_HEIGHT.convertor().pixels;i?(i=i.convertor().pixels,"header"===t?g=i:"footer"===t&&(f=i)):i=0,l=Math.max(f,T),a=d-(g+m+l),s=g+a,i=Math.min(g,s),s=Math.max(s,E-c),s=parseFloat(Conversions.toGlobalValue(s+"px"));var h="mm"===Conversions.globalUnit?"0":"3",I=J(e).data().componentName;return J(e)[I]("setAttributes",{min:0,max:s,step:n,suffix:Conversions.showUnit,decimalPlaces:h}),i},x=function(e){for(var i=DocTreeManager.getAllSectionsByType(SECTION_TYPES.CONTENT),o=[],r=i.length,a=0;a<r;a++){var s=i[a].format,l=Conversions.toGlobalUnit(s[ATTR_BODY.DS_PW]),d=Conversions.toGlobalUnit(s[ATTR_BODY.DS_PH]),c=PAGE_ORIENTATION.PORTRAIT;if(l>d&&(c=PAGE_ORIENTATION.LANDSCAPE),e!=c){var u=PageLayout.getPaperSize(l,d,t,c),p={};p.ORIENTATION=e;var g={};"Custom"==u?(g.height=l+t,g.width=d+t):g=F(u,t,p.ORIENTATION),p.PHEIGHT=g.height+t,p.PWIDTH=g.width+t;var f={};for(var E in p)n[E]&&(f[n[E]]=p[E]);var p={sectionNodes:[i[a]],styles:f};o.push(p)}}editor.doc.execCmd("applySectionsStyles",o),H()},B=function(e,t,i){e&&e[0]||(e=J("#footerBottom"));var n=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),o=n.getFirstSectionFormat(),r=Conversions.step,a=editor.currentPageIndex+1,s=(o[ATTR_BODY.DS_HT]||"0in").convertor().pixels,l=(o[ATTR_BODY.DS_FB]||"0in").convertor().pixels,d=DocLayoutManager.getPageAtPageNumber(a);if(null==d)return i;var c,u,p,g=d.getHeight(),f=d&&d.getFooter()?d.getFooter().getHeight():0,E=(o[ATTR_BODY.DS_MT]||"0in").convertor().pixels,T=(o[ATTR_BODY.DS_MB]||"0in").convertor().pixels,m=CONST.MIN_PAPER_HEIGHT.convertor().pixels;i?(i=i.convertor().pixels,"header"===t?s=i:"footer"===t&&(l=i)):i=0,p=Math.max(s,E),c=g-(p+m+l),u=l+c,i=Math.min(l,u),u=Math.max(u,T-f),u=parseFloat(Conversions.toGlobalValue(u+"px"));var h="mm"===Conversions.globalUnit?"0":"3",I=J(e).data().componentName;return J(e)[I]("setAttributes",{min:0,max:u,step:r,suffix:Conversions.showUnit,decimalPlaces:h}),i},H=function(e,t){e||(e=r);var i=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),n=i.getFirstSectionFormat(),o=n.mt.convertor().inches,a=n.mb.convertor().inches,s=n.mr.convertor().inches,l=n.ml.convertor().inches,d=(n[ATTR_BODY.DS_HT]||"0in").convertor().inches,c=(n[ATTR_BODY.DS_FB]||"0in").convertor().inches;o=d>o?d:o,a=c>a?c:a;var u=(parseFloat(CONST.MIN_PAPER_HEIGHT)+o+a)*Conversions.factor,p=(parseFloat(CONST.MIN_PAPER_WIDTH)+s+l)*Conversions.factor,g=parseInt(CONST.MAX_PAPER_SIZE)*Conversions.factor,f=Conversions.step,E=e.widthEle,T=e.heightEle;G(E,p,g,f,t),G(T,u,g,f,t);var m=editor.doc.getSelection(),h=DocLayoutManager.getPageAtIndex(m.getStart());if(h){g=h.getWidth()/Conversions.globalUnitInPx*.4;var I=0,_=h.getHeader();_.isEmptyView()||(I=24/Conversions.globalUnitInPx),g-=g%f,I-=I%f;var A=e.marginsEle;G(A,I,g,f,t),e.gutterEle&&G(e.gutterEle,I,g,f,t)}},G=function(e,t,i,n,o){var r="mm"==Conversions.globalUnit?"0":"3";o||(o="zlabelednumberfield"),J(e)[o]("setAttributes",{min:t,max:i,step:n,suffix:Conversions.showUnit,decimalPlaces:r})},k=function(){var e=i.ORIENTATION==PAGE_ORIENTATION.LANDSCAPE?J.i18n("writer.common.LANDSCAPE"):J.i18n("writer.common.PORTRAIT");J("#page-lpnl-orientationbtn").text(e)},Y=function(){PubSub.subscribe("Document/UndoRedo",_),PubSub.subscribe("Settings/UnitsChanged",T),PubSub.subscribe("Document/pageBorder/resized",_),PubSub.subscribe(["header/changed","footer/changed"],U),PubSub.subscribe(["header/changed","footer/changed"],B),PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected"],_,{async:!0,timeout:300})},z=function(e,t){if(Z(f.BDR_TOP).prop("checked")&&Z(f.BDR_RIGHT).prop("checked")&&Z(f.BDR_BOTTOM).prop("checked")&&Z(f.BDR_LEFT).prop("checked")?(Z(f.BDR_OUTSIDE).zstatebutton("checked",!0),Z(f.BDR_NONE).zstatebutton("checked",!1)):Z(f.BDR_OUTSIDE).zstatebutton("checked",!1),Z(f.BDR_TOP).prop("checked")||Z(f.BDR_RIGHT).prop("checked")||Z(f.BDR_BOTTOM).prop("checked")||Z(f.BDR_LEFT).prop("checked")){var n=se("page"),o={};if(i.PAGE_BORDERS)for(var r=0;r<n.length;r++)o[n[r]]=i.PAGE_BORDERS[n[r]]?i.PAGE_BORDERS[n[r]]:{};var a=BorderUtils.getBorderValuesForUpdateUI(o),s=a[ATTR_BORDERS.WIDTH],l=a[ATTR_BORDERS.TYPE],d=a[ATTR_BORDERS.COLOR];s?Z(f.BDR_WIDTH_MENU).zmenu("check",f.BDR_WIDTH_MENU_ITEM+s):Z(f.BDR_WIDTH_MENU).zmenu("checkAllItems",!1),l?Z(f.BDR_STYLE_MENU).zmenu("check",f.BDR_STYLE_MENU_ITEM+l):Z(f.BDR_STYLE_MENU).zmenu("checkAllItems",!1),d?V(d,!0):V("rgb(0, 0, 0)",!0)}},V=function(e,t){var e=Utils.getColorValFromRefString(e);Z(f.BDR_WIDTH_MENU).find(".zmenu__icon").css({"border-top-color":e}),Z(f.BDR_STYLE_MENU).find(".zmenu__icon").css({"border-top-color":e}),Z(f.BDR_COLOR).zcolorselectbox("setValue",e)},j=function(){Z(f.BG_IMG_SELECTED).hide(),Z(f.BG_IMG_FILE).hide(),Z(f.BG_COLOR_CODE).show()},X=function(){Z(f.BG_COLOR_CODE).hide(),Z(f.BG_IMG_SELECTED).hide(),Z(f.BG_IMG_FILE).show()},K=function(){Z(f.BG_COLOR_CODE).hide(),Z(f.BG_IMG_SELECTED).show(),Z(f.BG_IMG_FILE).hide()},q=function(){var t={panelId:e.PAGEBORDERSPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[e.PAGELAYOUTPANEL]};LeftPanel.showAdvancedPanel(t)},Q=function(e,t){var i=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),n=i.getFirstSectionFormat(),o=J("#page-lpnl-pagesizelist");o.zmenu(),"Custom"!=n[ATTR_BODY.DS_PS]?o.zmenu("check","#ps_"+n[ATTR_BODY.DS_PS]):o.zmenu("checkAllItems",!1)},ee=function(e,t,i,n,o,r){var a=DocLayoutManager.getCurrentGroup()||DocLayoutManager.getFirstGroup(),s=a.getFirstSectionFormat(),c=s.borders?DocUtil.copyStyle(s.borders):{};r&&(c=r);var u={};if(u.PAGE_BORDERS={},e){if(t.length<4&&!c[ATTR_BORDERS.BORDER_LEFT]&&!c[ATTR_BORDERS.BORDER_RIGHT]&&!c[ATTR_BORDERS.BORDER_TOP]&&!c[ATTR_BORDERS.BORDER_BOTTOM])return!1;(c&&"normal"==c[ATTR_BORDERS.BORDER_TYPE]||!ZWJSONUtils.getKeys(c).length)&&(c[ATTR_BORDERS.BORDER_TYPE]="image",delete c[ATTR_BORDERS.BORDER_RADIUS],c[ATTR_BORDERS.BORDER_DATA]={},c[ATTR_BORDERS.BORDER_DATA].slice="40",c[ATTR_BORDERS.BORDER_DATA].repeat="repeat")}else(c&&"image"==c[ATTR_BORDERS.BORDER_TYPE]||!ZWJSONUtils.getKeys(c).length)&&(c[ATTR_BORDERS.BORDER_TYPE]="normal",delete c[ATTR_BORDERS.BORDER_DATA]);if(c[ATTR_BORDERS.BORDER_DISPLAY]||(c[ATTR_BORDERS.BORDER_DISPLAY]=ATTR_PAGEBORDERS.ALL_PAGES),i==ATTR_BORDERS.BORDER_DISPLAY)return c[ATTR_BORDERS.BORDER_DISPLAY]=n,u.PAGE_BORDERS=c,u;for(var p=0;p<t.length;p++)if(c&&c[t[p]]&&!o){if(c[t[p]][i]=n,e){var g=c[t[p]][ATTR_BORDERS.TYPE][ATTR_BORDERS.B_SVG];c[t[p]][ATTR_BORDERS.WIDTH]=d[g].width,c[t[p]][ATTR_BORDERS.COLOR]="transparent"}}else{var f={};f=e?DocUtil.copyStyle(d[n[ATTR_BORDERS.B_SVG]]):DocUtil.copyStyle(l),f[i]=n,c[t[p]]=f}return u.PAGE_BORDERS=c,u},te=function(){var e=!1,t=DocLayoutManager.getCurrentSection();return t.getSectionType()==SECTION_TYPE.CONTENT&&(e=!0),!(!e||CURSOR_CONTEXT_DEFINITIONS.isTable()||CURSOR_CONTEXT_DEFINITIONS.isCursorInsideTOC())},k=function(){var e=i.ORIENTATION==PAGE_ORIENTATION.LANDSCAPE?J.i18n("writer.common.LANDSCAPE"):J.i18n("writer.common.PORTRAIT");J("#page-lpnl-orientationbtn").text(e)},ie=function(){J("#page-bdr-selection .ui-sbdr-cont").addClass("ui-icon-bnone"),J("#page-bdr-selection .ui-sbdr-cont").removeClass("ui-icon-ball-sm"),J("#page-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-top"),J("#page-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-left"),J("#page-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-right"),J("#page-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-bottom"),Z(f.BDR_OUTSIDE).zstatebutton("checked",!1),Z(f.BDR_TOP).zstatebutton("checked",!1),Z(f.BDR_RIGHT).zstatebutton("checked",!1),Z(f.BDR_BOTTOM).zstatebutton("checked",!1),Z(f.BDR_LEFT).zstatebutton("checked",!1),Z(f.BDR_NONE).zstatebutton("checked",!1)},ne=function(){var e=se("page");i.PAGE_BORDER_TYPE_IMAGE&&(e=["border-top","border-left","border-bottom","border-right"]);var t=ee(i.PAGE_BORDER_TYPE_IMAGE,e,"width","0px");if(null!=t){for(var n in t)i[n]=t[n];N(t)}},oe=function(e,t){var i=null,n=new Deferred;if(u[e]){i=u[e];var o=re(i,e,t);n.resolve(o)}else{var r=imgCdnZWStaticPath+fingerPrintObj["images/common/pageborder/png/"+e+".png"],a=document.createElement("img");a.setAttribute("crossorigin","anonymous"),J(a).on("error",function(){n.reject()}),J(a).on("load",function(){var i=ZWImageUtils.getImageBytes(a),o=HTMLUtil.storeImageInFileStore(i),r=ZWNetworkUtils.getContextUrl(o),s=re(r,e,t);u[e]=r,n.resolve(s)}),a.src=r}return n.promise()},re=function(e,t,i){var n=["border-top","border-left","border-bottom","border-right"],o={"b-svg":t,"b-img":e},r=ee(!0,n,"type",o,!1,i);return r},ae=function(e){var t={};if("flip-pageborders-none"==e){var t={};t.resetBorder="resetBorder"}else{if("pageborders-style1"!=e)return i.PAGE_BORDER_TYPE_IMAGE=!0,void oe(e);i.PAGE_BORDER_TYPE_IMAGE=!1;var n=["border-top","border-left","border-bottom","border-right"];t=ee(i.PAGE_BORDER_TYPE_IMAGE,n,"width","5px",!0)}if(null!=t){for(var o in t)i[o]=t[o];N(t)}},se=function(e){for(var t=[],i=["top","left","right","bottom"],n=0,o=i.length;n<o;n++){var r=i[n];Z(e+"-bdr-"+r).prop("checked")&&t.push("border-"+r)}return 0==t.length&&(t=["border-top","border-right","border-left","border-bottom"]),t},le=function(e){null==e?(Z("page_clrfldBGColor").zcolorselectbox("setValue","white"),Z("page_clrfldBGColor").zcolorselectbox("getElement").removeClass("ui-bg-active"),Z("page-bg-none").addClass("ui-bg-active")):(Z("page_clrfldBGColor").zcolorselectbox("getElement").addClass("ui-bg-active"),Z("page-bg-none").removeClass("ui-bg-active"))},de=function(){J("#page-bdr-radius").enable(),J("#page-bdr-display").enable(),J("#pagebordermargins").enable(),J("#keepaspectformargin").zbutton("setAttributes",{disabled:!1}),J(".page-bdr-margin-spinner").enable()},ce=function(){J("#page-bdr-radius").disable(),J("#page-bdr-display").disable(),J("#pagebordermargins").disable(),J("#keepaspectformargin").zbutton("setAttributes",{disabled:!0}),J(".page-bdr-margin-spinner").disable()},ue=function(){BorderUtils.getSelectedSides("page")},pe=function(e){switch(a=e,e){case o.CURRENT_SECTION:W.get("#page_lyt_apply_section,#page_lyt_note_apply_Document").hide(),W.get("#page_lyt_apply_document").show(),W.get("#page_lyt_note_apply_section").css({display:"inline"});break;case o.WHOLE_DOCUMENT:W.get("#page_lyt_apply_section").show(),W.get("#page_lyt_apply_document,#page_lyt_note_apply_section").hide(),W.get("#page_lyt_note_apply_Document").css({display:"inline"})}},ge=function(e){switch(s=e,e){case o.CURRENT_SECTION:W.get("#page_dsn_apply_section,#page_dsn_note_apply_Document").hide(),W.get("#page_dsn_apply_document").show(),W.get("#page_dsn_note_apply_section").css({display:"inline"});break;case o.WHOLE_DOCUMENT:W.get("#page_dsn_apply_section").show(),W.get("#page_dsn_apply_document,#page_dsn_note_apply_section").hide(),W.get("#page_dsn_note_apply_Document").css({display:"inline"})}},fe=function(){PubSub.publish("PageLayout/ShowAdvancedPanel",{tabToBeOpened:"watermark"})};return{openPageBordersPanel:q,refreshValues:_,updatePageSizeMenu:Q,updatePgOrientationLabel:k,open:S,clearPageBorder:ne,setPageBorder:ae,constructBorderData:ee,updateFooterMaxValue:B,updateHeaderMaxValue:U,unSelectAllSides:ie,handleBeforeClose:ue,close:R,getDimension:F,setLayoutApplyType:pe,setDesignApplyType:ge,showWatermarkDialog:fe,isColumnFitToSize:M,isMarginAllowed:y,getSelectedSides:se,setMinMaxValueForSpinners:H,applyValues:N,setImagePageBorder:oe}}(ELEM_ID);QuickStyle=function(){"use strict";var e={},t="",i="",n=[],o={},r=!1,a=[ATTR_TEXT.TS_BGC,ATTR_TEXT.TS_CS,ATTR_TEXT.TS_FF,ATTR_TEXT.TS_FGC,ATTR_TEXT.TS_FS,ATTR_TEXT.TS_FV,ATTR_TEXT.TS_FW,ATTR_TEXT.TS_SIZE,ATTR_TEXT.TS_TD],s=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.BODY);if(e.hasOwnProperty(ATTR_BODY.DS_STYLES))for(var i=e[ATTR_BODY.DS_STYLES][ATTR_BODY.DS_PARA],o=DocUtil.getRenderingFormat(i),r=n.length?n:U.range(7);r.length;){var a=r.pop();b(a,o)}t.attr(e)},l=function(e){var t=DocumentDesign.getStyles().para,i=DocumentDesign.getStyleUIInfo();for(var n in t)if(!i.para[n].hasOwnProperty("deleted")||1!=i.para[n].deleted){var o=t[n].info.cs_name;if(o==e||"undefined"==typeof o&&StyleUI.PARA_NAME_MAPPING[n.substr(1)]&&J.i18n(StyleUI.PARA_NAME_MAPPING[n.substr(1)])==e)return n}},d=function(e){for(var t in SavedStyles.para)if(SavedStyles.para[t].style.info.cs_name==e)return t},c=function(e){for(var t in SavedStyles.para)if(t==e)return SavedStyles.para[t].style.info.cs_name},u=function(e,t){for(var i=DocTreeManager.doc.getAllSections(),n=[],o=0;o<i.length;o++){var r=i[o].headings;r&&r[e.substr(1)]&&(n=n.concat(r[e.substr(1)]))}for(var o=0;o<i.length;o++)for(var a=i[o].children,s=0;s<a.length;s++)if(a[s].type==NODE_TYPE.PARA&&n.indexOf(a[s].id)!=-1){var l=ZWJSONUtils.clone(a[s].format),d=editor.doc.createElement(NODE_TYPE.PARAGRAPH);l[ATTR_PARAGRAPH.PS_HD]=t.substr(1),d.setStart(a[s].getEndIndex()),d.setEnd(a[s].getEndIndex()+1),d.attr(l)}},p=function(e){for(var t=DocTreeManager.doc.getAllSections(),i=[],n=(DocumentDesign.getStyleUIInfo(),0);n<t.length;n++){var o=t[n].headings;o&&o[e.substr(1)]&&(i=i.concat(o[e.substr(1)]))}U.isEmpty(i)?(editor.doc.snapShotManager.setSkipSnapShot(!0),editor.doc.execCmd("deleteDocHeadingStyle",e),editor.doc.snapShotManager.setSkipSnapShot(!1)):MsgDialog.showMessage(CONST.MSG_TYPE_DELETECANCEL,"info",J.i18n("writer.styles.DELETE_PARA_STYLE"),J.i18n("writer.styles.DELETE_DOC_PARA_STYLE_MSG"),null,function(t){1==t&&(editor.doc.snapShotManager.setSkipSnapShot(!0),editor.doc.execCmd("convertHeadingStyle",[e,ATTR_PARAGRAPH.PS_H0]),editor.doc.execCmd("deleteDocHeadingStyle",e),editor.doc.snapShotManager.setSkipSnapShot(!1))},null)},g=function(e){var t=StyleUI.getDocumentParaMapping(),i=DocumentDesign.getStyleUIInfo().para;for(var n in t){var o=i["h"+n];o&&o.hasOwnProperty("deleted")&&delete t[n]}for(var r=U.invert(t),a=Object.keys(r),s=e.info.cs_name,l="";a.indexOf(s+l)!=-1;)""===l&&(l=0),l++;e.info.cs_name=s+l},f=function(e){var t="h"+Utils.getRandomNumber(),i=DocumentDesign.getStyleUIInfo(),n=DocumentDesign.getStyles(),o=ZWJSONUtils.clone(DesignUtil.getSavedParaStyles()[e]);i.para[t]={},i.para[t].status="visible",g(o.style),n.para[t]=o.style,editor.doc.getSelection().getParents(NODE_TYPE.BODY).attr({styles:n}),Op.sendMsg(),editor.doc.snapShotManager.setSkipSnapShot(!0),editor.doc.getSelection().getParents(NODE_TYPE.BODY).attr({styleUIInfo:i}),Op.sendMsg(),editor.doc.snapShotManager.setSkipSnapShot(!1),editor.doc.execCmd("FormatBlock",parseInt(t.substr(1)))},E=function(e){SavedStyles[e.type]?void 0:SavedStyles[e.type]={},SavedStyles[e.type][e.id]={style:e.style,description:e.description},e.isStyleFromCursor&&QuickStyle.applyUserHeadingStyle(e.id)},T=function(e,t){var i;if("number"==typeof e&&t){var n="h"+(t.hd?t.hd:0),o=DocumentDesign.getComputedParaStyle(n),r=editor.doc.getSelection(),a=ZWJSONUtils.clone(r.paraFormat),s=r.getComputedTextFormat(),l=StyleUtil.isParaFormatModified(o,a),d=StyleUtil.isTextFormatModified(o.textFormat,s);i=l||d}return i},m=function(){var e=DocUtil.copyStyle(editor.doc.getSelection().getParaFormat()),t=e[ATTR_PARAGRAPH.PS_HD]||0;QuickStyle.onBeforeUpdateHeadingStyle([t.toString()])},h=function(e){var t={};t.StyleOperation=JSON.stringify(e),J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/styleoperation"),data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){var i=Utils.encodeHTMLString(e.cs_name);"SUCCESS"==t.RESPONSE?"add"==t.OPERATION?(UIUtils.showMessage("info",J.i18n("writer.styles.SAVED_MSG",[i]),!0,"normalfont",1e3),E(e),PubSub.publish("HeadingStyleLibrary/Add",e)):"delete"==t.OPERATION&&(UIUtils.showMessage("info",J.i18n("writer.styles.DELETED_MSG",[i]),!0,"normalfont",1e3),PubSub.publish("HeadingStyleLibrary/Delete",e)):UIUtils.showMessage("error",J.i18n("writer.styles.SERVER_ERROR",[i]),!0,"normalfont",1e3)},error:function(t){var i=Utils.encodeHTMLString(e.cs_name);"FAILED"==t.RESPONSE?"delete"==t.OPERATION&&UIUtils.showMessage("error",J.i18n("writer.styles.UNABLE_TO_DELETE"),!0,"normalfont",1e3):UIUtils.showMessage("error",J.i18n("writer.styles.SERVER_ERROR",[i]),!0,"normalfont",1e3)}})},I=function(){var e=editor.doc.getSelection();if(!DocLayoutManager.getLineAtIndex(e.getStart()))return!1;for(var t,i=e.getParents(NODE_TYPE.PARAGRAPH).dtNode,n=i.format.hd,o=i.children,r=a.length,s="h"+(n?n:0),l=DocumentDesign.getComputedParaStyle(s),d=ZWJSONUtils.clone(e.paraFormat),c=e.getComputedTextFormat(),u=0;u<o.length;u++)if("text"==o[u].type){if(!t){t=editor.doc.getRawComputedTextFormatAt(o[u].start+o[u].parent.getIndex()),t=DocUtil.getRenderingFormat(t);continue}var p=editor.doc.getRawComputedTextFormatAt(o[u].start+o[u].parent.getIndex());p=DocUtil.getRenderingFormat(p);for(var g=0;g<r;g++){var f=a[g],E=p[f],T=t[f];if(StyleUtil.compareTextStyleForModification(f,E,T))return!1}t=ZWJSONUtils.clone(p)}if(t){if(StyleUtil.isTextFormatModified(l.textFormat,c)||StyleUtil.isParaFormatModified(l,d)){var m=ZWJSONUtils.clone(i.format)||{};return m.textFormat=c,m}return!1}},_=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),t=editor.doc.getRawFormatAt(e.getEnd()-1),i=t[ATTR_PARAGRAPH.PS_HD],i="undefined"==typeof i?0:i;return t=DocUtil.mergeObjs([DocumentDesign.getStyles().para["h"+i],t]),shouldNotCarryParaStyle.forEach(function(e){e==ATTR_PARAGRAPH.LS_DATA&&t.hasOwnProperty(e)&&t[e][ATTR_COMMON.ID]==editor.doc.getHeadingListId()||delete t[e]}),t},A=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),t=e.attr(ATTR_PARAGRAPH.PS_HD),t="undefined"==typeof t?0:t,i=DocUtil.copyStyle(editor.doc.getSelection().textFormat);return shouldNotCarryTextStyle.filter(function(e){delete i[e]}),i=DocUtil.mergeObjs([DocumentDesign.getStyles().para["h"+t].textFormat,i])},S=function(e){var t,i,n=e[0],o=e[1],r=[];o&&(t=DesignSets[o].styles.para["h"+n],i=t.textFormat,r=FontUtils.stringToFonts(i[ATTR_TEXT.TS_FF])||[]),UIUtils.showLoadingMsg(J.i18n("common","LOADING")),ZWLogger.log("@onBeforeUpdateHeadingStyle-->addFonts"),editor.addFonts(r,frames.metricsFrame,function(){UIUtils.hideLoadingMsg(),editor.doc.execCmd("updateHeadingStyle",[n,o])})},R=function(e,t){var i;t&&(i={},i=DocUtil.copyStyle(DesignSets[t].styles.para["h"+e]),i=DocUtil.getRenderingFormat(i,DesignSets[t].theme)),O(e,i)},O=function(e,t){var i,o;t&&(i=t,o=i.textFormat);var t={paraStyle:i||_(),textStyle:o||A()},a=DocumentDesign.getStyles(),l=a[ATTR_BODY.DS_PARA],d={};if("undefined"==typeof e){var c=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH);e=c.attr(ATTR_PARAGRAPH.PS_HD)||0}if(DocUtil.applyHeadingForSelection(e),!U.isEmpty(t.paraStyle))for(var u in t.paraStyle)"info"!=u&&(l["h"+e][u]=t.paraStyle[u]);U.isEmpty(t.textStyle)||(l["h"+e].textFormat=t.textStyle),n.push(e),a[ATTR_BODY.DS_PARA]=l,a.name="",d[ATTR_BODY.DS_STYLES]=a,s(d),r&&(d[ATTR_BODY.DS_THEME]=DocumentDesign.getTheme(),d[ATTR_BODY.DS_STYLE_UI_INFO]=DocumentDesign.getStyleUIInfo(),N(d)),J.dialogutil.close("savenormaltemplate")},b=function(e,t){if(U.isUndefined(e))return null;var i=t.h0;0!=e&&(i=DocUtil.mergeObjs([i,t["h"+e]]));var n=(i.textFormat,function(t){var i=editor.doc.getRawFormatAt(t.getEnd()-1),n=parseInt(i[ATTR_PARAGRAPH.PS_HD]),o=i[ATTR_PARAGRAPH.LS_DATA],n=n?n:0;if(n==e){var r={ps_null:!0,hd:n};o&&(r[ATTR_PARAGRAPH.LS_DATA]=o,i.hasOwnProperty(ATTR_PARAGRAPH.PS_ML)&&(r[ATTR_PARAGRAPH.PS_ML]=i[ATTR_PARAGRAPH.PS_ML]),i.hasOwnProperty(ATTR_PARAGRAPH.PS_TI)&&(r[ATTR_PARAGRAPH.PS_TI]=i[ATTR_PARAGRAPH.PS_TI]),r[ATTR_PARAGRAPH.PS_TYPE]=i[ATTR_PARAGRAPH.PS_TYPE]),t.attr(r);var a=editor.doc.getTextNodesInSelection(t.getStart(),t.getEnd()-1);U.each(a,function(e){n?e.attr({ts_null:!0}):e.attr({ff:"",size:""})},this)}});U.each(DocTreeManager.doc.getAllSections(),function(e){var t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH,e.getIndex(),e.getEndIndex());U.each(t,n,this)},this)},v=function(){var e={};e[ATTR_BODY.DS_STYLES]=DocUtil.copyStyle(DesignSets[DefaultDesignName][ATTR_BODY.DS_STYLES]),s(e)},D=function(){editor.doc.execCmd("resetStyle")},L=function(){return e.saveToCustom&&""===t.trim(),!(isThemeNameExist(t)&&!confirm(J.i18n("writer.styles.NAMEALREADYEXIST")))&&(M(),void applyDocumentStyle())},N=function(e){e=e?e:{};for(var t in e)w_usersettings[t]=ZWJSONUtils.clone(e[t]),e[t]=JSON.stringify(e[t]);csrfParamName&&(e[csrfParamName]=getcsrf()),delete e.computed,J.post(ZWNetworkUtils.getNiceUrlPrefix("user/settings/defthemeandstyles"),e)},P=function(){S([0])},C=function(){J.dialogutil.open("savenormaltemplate",J("#savenormaltemplate"),y)},y={set:function(e,t,i){"makeDef"==e.action&&(r=t)},init:function(){r=!1;var e=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),t=e.attr(ATTR_PARAGRAPH.PS_HD);t=t?t:0;var i=J.i18n("writer.styles.DO_YOU_WANT_THE_FOLLOWING_STYLE_SET")+" "+J.i18n("writer.styles.TO")+" "+J.i18n("writer.styles.NORMALTEXT")+" ?";J(".ui-template-imfo").text(i);var n=(DocumentDesign.getParaStyle("h"+t),editor.doc.getSelection().computedTextFormat),o=editor.doc.getSelection().paraFormat;n=DocUtil.getRenderingFormat(n);var a={};a[ATTR_TEXT.TS_FF]=J.i18n("writer.format.FONT"),a[ATTR_TEXT.TS_FW]=J.i18n("writer.format.BOLD"),a[ATTR_TEXT.TS_FW_I]=J.i18n("writer.format.BOLD"),a[ATTR_TEXT.TS_CS]=J.i18n("writer.format.CHARACTER_SPACING"),a[ATTR_TEXT.TS_FS]=J.i18n("writer.format.ITALIC"),a[ATTR_TEXT.TS_SIZE]=J.i18n("writer.format.FONT_SIZE"),a[ATTR_TEXT.TS_VA]=J.i18n("writer.format.VERTICAL_ALIGN"),a[ATTR_TEXT.TS_TD]=J.i18n("writer.format.TEXT_DECORATION");var s=J(".textstyleinfo"),l=n.fw_i;for(var d in n){var c=document.createElement("div"),u=n[d];if(u){var p,g="",f="";if(U.has(a,d)){if("ff"==d&&(u=u.substr(0,u.indexOf(",")!=-1?u.indexOf(","):u.length).capitalize(),!l||400==l&&700==l||(u=u+" - "+FONT_WEIGHT[l])),"fs"==d&&(u=u.indexOf("none")!=-1?J.i18n("writer.common.NONE"):J.i18n("writer.common.YES")),"fw"===d||"fw_i"===d){if(p)continue;l=Math.max("bold"===n.fw?700:0,parseInt(n.fw_i||400)),l>=700&&(d=ATTR_TEXT.TS_FW,u=J.i18n("writer.common.YES")),p=!0}"va"==d&&(u=u.replaceAll("super",J.i18n("writer.format.SUPERSCRIPT")),u=u.replaceAll("sub",J.i18n("writer.format.SUBSCRIPT"))),g='<span class="ui-def-style-prop">'+a[d]+" : </span>",f='<span class="ui-def-style-val">'+u+"</span>"}else if(d==ATTR_TEXT.TS_TD)u.indexOf("line-through")==-1&&u.indexOf("underline")==-1||(u=u.replaceAll("line-through",J.i18n("writer.format.STRIKETHROUGH")),u=u.replaceAll("underline",J.i18n("writer.format.UNDERLINE")),u=u.replaceAll("none",J.i18n("writer.common.NONE")),g='<span class="ui-def-style-prop">'+a[d]+" : </span>",f='<span class="ui-def-style-val">'+u+"</span>");else{if(d!=ATTR_TEXT.TS_FGC&&d!=ATTR_TEXT.TS_BGC)continue;g='<span class="ui-def-style-prop">'+(d==ATTR_TEXT.TS_FGC?J.i18n("writer.format.FONT_COLOR")+" : ":J.i18n("writer.format.BACKGROUND_COLOR")+" : ")+"</span>",f='<span class="ui-def-style-val">'+u+'<div style="margin-left: 5px;vertical-align: middle;display:inline-block;height:10px;width:10px;background-color:'+u+';"><div></span>'}var E=J(g),T=J(f);J(c).append(E,T),J(c).appendTo(s)}}var m={bw:J.i18n("writer.format.BORDER_WIDTH"),dir:J.i18n("writer.format.DIRECTION"),sa:J.i18n("writer.format.SPACE_AFTER"),sb:J.i18n("writer.format.SPACE_BEFORE"),ml:J.i18n("writer.format.MARGIN_LEFT"),mr:J.i18n("writer.format.MARGIN_RIGHT"),pl:J.i18n("writer.format.PADDING_LEFT"),pr:J.i18n("writer.format.PADDING_RIGHT"),ti:J.i18n("writer.format.TEXT_INDENT"),ls:J.i18n("writer.format.LINE_SPACING"),ri:J.i18n("writer.common.RULER.RIGHTINDENT"),al:J.i18n("writer.format.ALIGNMENT")},h=J(".parastyleinfo");for(var d in o){var c=document.createElement("div"),u=o[d],I=parseInt(u);if(u&&(isNaN(I)||0!=I)){var g="",f="";if(U.has(m,d))"ls"==d&&(u=parseFloat(u).toFixed(2)),g='<span class="ui-def-style-prop">'+m[d]+" : </span>",f='<span class="ui-def-style-val">'+u+"</span>";else if(d==ATTR_PARAGRAPH.PS_BS)g='<span class="ui-def-style-prop">'+J.i18n("writer.format.BORDER_STYLE")+" : </span>",f='<span class="ui-def-style-val">'+u+"</span>";else{if(d!=ATTR_PARAGRAPH.PS_BGC&&d!=ATTR_PARAGRAPH.PS_BC)continue;g='<span class="ui-def-style-prop">'+(d==ATTR_PARAGRAPH.PS_BC?J.i18n("writer.format.BORDER_COLOR")+" : ":J.i18n("writer.format.BACKGROUND_COLOR")+" : ")+"</span>",f='<span class="ui-def-style-val">'+u+'<div style="margin-left: 5px;vertical-align: middle;display:inline-block;height:10px;width:10px;background-color:'+u+';"><div></span>'}var E=J(g),T=J(f);J(c).append(E,T),J(c).appendTo(h)}}}},F=function(){return!(isThemeNameExist(t)&&!confirm(J.i18n("writer.styles.NAMEALREADYEXIST")))&&void validateSaveDocStyle()},M=function(){U.isEmpty(o)||(e[ATTR_BODY.DS_STYLES][ATTR_BODY.DS_PARA][i]=DocUtil.copyStyle(o),o={},i="")};return{getDocStyleIdForName:l,getParaStyleIdForName:d,getParaStyleNameForId:c,convertAppliedStylesToDefault:u,removeUserHeadingStyle:p,applyUserHeadingStyle:f,isHeadingStyleModified:T,updateParaHeadingStyle:m,updateUserHeadingStyles:h,isCompleteHeadingModified:I,getParaFormatWithoutRendering:_,getTextFormatWithoutRendering:A,onBeforeUpdateHeadingStyle:S,updateHeadingStyle:O,applyResetDocumentStyle:D,resetDocumentStyle:v,initApplyDocumentStyle:L,initValidateSaveDocStyle:F,updateDefaultStyleandTheme:N,showSaveNormalTempDlg:C,initUpdateOfParaTemplate:P,updateQuoteStyle:R}}(),function(){function e(){ee="",Q=null,$=Y=1,Y=z=0,X=!1,J("#pdf_container").scrollTop(0),J("#pdf_sidebar").scrollTop(0)}function t(){e(),editor.setView(EDITOR_VIEWS.EDITOR),DocumentMap.togglePane(),q=!1,J("#topband-hamburger").show(),J("#topband-file").show(),J("#remote-topband-print").show(),J("div#toolbarContainer").removeClass("ui-history-printview-height"),J("#printPreviewPrint").show(),J("#rev-name, #printpreviewtoolbar, #docprintpreview").hide(),J("#commonicondiv, #components, #ui-editor-outer-div, #topband-savestatus-msg,#bottombar, #statusbar").show(),ae&&(ae=!1),UIUtils.enableDocumentShortcuts(),editor.rebindEvents(),editor.jMbSpan_editableSpan.attr("contenteditable","true"),J(".ui-top-mailid-sep").show(),DomUtil.setEditorHht();var t=J(".ui-ztab-custom-right.ui-ztab-expand");t.hasClass("ui-icon-collapse")&&J(".ui-ztab-custom-right.ui-ztab-expand").trigger("click"),editor.editorOffset=editor.jeditorPane.offset(),InsertShape.shapeCache={},LayoutManager.loadLayout(LayoutManager.getLayoutType())}function i(e,t){var i=document.createElement(NODE_NAME.SCRIPT);i.src=e,i.type="text/javascript",t.appendChild(i)}function n(e,t){var i=document.createElement(NODE_NAME.LINK);i.href=e,i.rel="stylesheet",i.type="text/css",t.appendChild(i)}function o(e,t){var i=document.createElement(NODE_NAME.STYLE);i.type="text/css",t.appendChild(i),J(i).text(e)}function r(e){UIUtils.addFontFaceCSSInHTML(e)}function a(){var e={body:{"-webkit-print-color-adjust":"exact",margin:"0in",outline:"0in none"},p:{margin:"0in",padding:"0in",outline:"0in none"},span:{}};return e+=document.getElementById("styleforeditor").textContent}function s(e){var t=editor.jeditorPane.width();de(e),e.find("img").each(function(){var e=J(this);!j&&t<=e.width()&&e.width(t);var i=e.attr("src");i&&(i.indexOf("image.do?imgurl=")>=0||i.indexOf("remoteImage.do?imgurl=")>=0?(0===i.indexOf("/writer/")&&(i=i.substring("8")),e.attr("src",editor.getBaseURL()+"/"+i)):0===i.indexOf("images/")?e.attr("src",imgStaticURL+i):0===i.indexOf("/images/")?e.attr("src",imgStaticURL+i.substring("/".length)):0!=i.indexOf(editor.getBaseURL())&&editor.orgPolicyData&&"undefined"!=typeof editor.orgPolicyData.exportExternalImages&&!editor.orgPolicyData.exportExternalImages&&0===i.indexOf("http")&&e.replaceWith("<a href='javascript:void(0);' style='background-color: #F1F1F1;'>&lt;&lt;"+i+"&gt;&gt;</a>"))})}function l(){var e=editor.doc.getBodyFormat(),t={};return t["background-color"]=e[ATTR_BODY.DS_BGC],!editor.browserInfo.isWebkit&&e.hasOwnProperty(ATTR_BODY.WM_URL)&&(t["background-image"]="url("+editor.getBaseURL()+"/"+e[ATTR_BODY.WM_URL]+")",t["background-repeat"]="no-repeat repeat-y",t["background-position"]="0% 0%"),t["margin-bottom"]="0px",t["margin-top"]="0px",t["margin-left"]="auto",t.border="0px",t["box-shadow"]="",t["min-height"]="",t}function d(e){e.find("span.autopcnt,span.autopno,span.autopno_toc,span.autodocname,span.autoauthor,span.autoformula,span.footnote,span.endnote,span.autodocversion").each(function(){var e=J(this).find("span."+CONST.FIELD_TEXT_NODE);e[0]&&(this.innerHTML=e.html())})}function c(e){for(var t=e.find("div.zw-contentpane").find("iframe"),i=0,n=t.length;i<n;i++){var o=J(t[i]);if(!o.hasClass("zmap-iframe")){var r=document.createElement("image");J(r).attr("src",imgCdnZWStaticPath+fingerPrintObj["images/shape-obj.png"]).css({width:"100%",height:"400px"}),o.replaceWith(r)}}}function u(e){e.find("#tocClose").parents("div").first().remove()}function p(e){if(e){var t=e.getElementsByClassName("zw-float");oe=0,floatCropImageLoadCount=0;var i=function(e){callBack=function(){floatCropImageLoadCount++},e.addEventListener("load",callBack),e.addEventListener("error",callBack)},n=[];try{for(var o=0,r=t.length;o<r;o++){var a=J(t[o]),s=a.find("svg"),l=a.find(".fgImgOuterDiv"),d=s.children()[0];if(d){var c=d&&JSON.parse(d.getAttribute("data-fmt"));if(c&&DocUtils.isImage(c)&&!c.linkData){a.before(s);var u=parseInt(a.css("left")),p=parseInt(a.css("top"));if(n.contains(t[o])||n.push(t[o]),DomUtil.isCropImge(c)&&!isHeadlessPDF){var g=DomUtil.processImgSrc(c.src),f=J("img[src*='"+g+"']")[0];if(!f){var E=c.id||Utils.randomString();f=DomUtil.addDummyImageForCrop(g,E),d.setAttribute("id",E),i(f),oe++}d.setAttribute("data-fmt",JSON.stringify(c))}else if(c.cropRect&&!DomUtil.isCropImge(c)){var T=parseFloat(s.css("margin-top")),m=parseFloat(s.css("margin-left"));T<0?d.setAttribute("y",T+"px"):(d.setAttribute("y","0px"),p+=T,s.css("height",c.ht-T+"px")),m<0?d.setAttribute("x",m+"px"):(d.setAttribute("x","0px"),u+=m,s.css("width",c.wid-m+"px"))}c.rotation>0&&(u+=parseInt(l.css("left")),p+=parseInt(l.css("top")),l[0]&&(s[0].style.transform=l[0].style.transform));var h=t[o].style["z-index"];""!=h&&(s[0].style["z-index"]=h),s.css({border:l.css("border-top")});var I=DTUtils.isWrappingFloatImage(c),_=c.ml&&I?c.ml:"",A=c.mt&&I?c.mt:"",S=c.mb&&I?c.mb:"",R=c.mf&&I?c.mr:"";s.css({position:"absolute",left:u+"px",top:p+"px","margin-left":_,"margin-right":R,"margin-top":A,"margin-bottom":S})}}}for(var r=n.length,o=0;o<r;o++){var O=n[o];O.parentNode.removeChild(O)}}catch(e){}}}function g(e){for(var t=e.getElementsByClassName("zw-portion signerfield"),i=0,n=t.length;i<n;i++){var o=t[i],r=o.getAttribute("data-field-type"),a=r&&(r===SIGNERFIELD_TYPE.IMAGE||r===SIGNERFIELD_TYPE.STAMP);if(a){for(var s=o.classList.length-1;s>=0;s++){var l=o.classList[s];if(l.indexOf("signerfield-recipient")!==-1){o.classList.remove(l);break}}for(;o.childElementCount;)o.firstElementChild.remove()}else for(var d,c=o.querySelectorAll(".zw-text-portion"),s=0;s<c.length;s++){d=c[s],d.style.removeProperty("color");var u=d.getAttribute("data-fgc")||"";d.style.color=u}}}function f(e,t){k=document.createElement(NODE_NAME.HTML),G=document.createElement(NODE_NAME.HEAD),B=document.createElement(NODE_NAME.BODY),H=J(B),q=!0,k.appendChild(G);var i=document.createElement(NODE_NAME.META);i.content="text/html; charset=UTF-8",i.httpEquiv="Content-Type",G.appendChild(i),k.appendChild(B);var f=a();n(cssCdnZWStaticPath+fingerPrintObj["styles/common/writer_common_min_all.css"],G),n(cssCdnZWStaticPath+fingerPrintObj["styles/writer_min_all.css"],G),r(G),o(f,G);var T=!1;DomViewManager.renderAllPages();var m=DocumentView.getViewType(),h=DocLayoutManager.hasRotatedPageInDocument();U(H,G,e),se(G),le(G),DocLayoutManager.isFixedView()&&(DocLayoutManager.toggleFixedView(),PubSub.publish("header/updateAutoFields"),PubSub.publish("footer/updateAutoFields"),e.css({"border-top":""}));var I=J("<div>",{id:"editorpane"});H.append(I);DocLayoutManager.getFirstPageWidth(),DocLayoutManager.getFirstPageHeight();e.each(function(){var e,t,i,n=this.getElementsByClassName("zw-ifr-div"),o=0;for(n.length;o<n.length;o++)e=n[o].parentElement,t=CurUtil.getCursorLineOffset(e)+CurUtil.getCursorPortionOffset(e),i=editor.doc.getRawFormatAt(t),!i||!i.widgetSrc||WIDGET.VIDEO_REGEX.YOUTUBE.test(i.widgetSrc)||WIDGET.VIDEO_REGEX.VIMEO.test(i.widgetSrc)||WIDGET.VIDEO_REGEX.DAILYMOTION.test(i.widgetSrc)||(te++,iframeIdx.push(t));var r=this.getElementsByClassName("zmap-iframe"),o=0;for(r.length;o<r.length;o++)ne++;for(var a=this.cloneNode(!0),s=a.getElementsByClassName("zw-portion footnote"),o=0;o<s.length;o++)s[o].style.display="inline";for(var l=a.getElementsByClassName("zw-portion endnote"),o=0,d=l.length;o<d;o++)l[o].style.display="inline";g(a),h&&E(a),I.append(a)}),ce(t)||I.find(".ui-comment-indication-new").removeClass("ui-comment-indication-new"),d(H);var _=l();H.find("div.zw-page").css(_);var A=editor.doc.getBodyFormat()[ATTR_BODY.DS_BGC]||"rgb(255, 255, 255)";A&&(H[0].style.cssText+="background-color:"+A+" !important"),H.find("div.zw-contentpane").show(),s(H),x(H),c(H),p(H[0]);for(var S=H[0].querySelectorAll(".zw-chart-canvas"),R=0;R<S.length;R++){var O=S[R].id,b=document.createElement("img"),v=document.getElementById(O);v&&(b.src=v.toDataURL(),b.style.height=v.style.height,b.style.width=v.style.width),S[R].parentNode.replaceChild(b,S[R])}return u(H),HiddenMarkers.isEnabled()&&H.find("span.zw-space").html("&nbsp;"),q=!1,T&&(DocLayoutManager.isFixedView()||DocLayoutManager.toggleFixedView()),h&&DocumentView.changeView(m),DomViewManager.isMultiplePagesInRow()&&H.find("div.zw-page").css({position:"relative",top:"",left:""}),H.find('div[id^="z-cursor"]').remove(),"<!DOCTYPE html><html>"+k.innerHTML+"</html>"}function E(e){var t=DomViewManager.getViewData(e),i=DocLayoutManager.getPageWithId(t.docViewId),n=i.getGroup(),o="ui-"+parseInt(n.getPageHeight())+"-"+parseInt(n.getPageWidth())+"-"+n.getPageOrientation().toLowerCase();J(e).addClass(o)}function T(e){var t=J("#mailmergeIFrame").contents().find("#editorpane").children(".zw-page");return f(t,e)}function m(e){return f(editor.jeditorPane.find("div.zw-page"),e)}function h(e,t){e=e||{};var p=editor.doc.docInfo;if(!p||!p.VERSION)return"";K=e.hasOwnProperty("DigiSign")&&e.DigiSign||!1,V=e.hasOwnProperty("isEmail")&&e.isEmail||!1,j=e.hasOwnProperty("MailMerge")&&e.MailMerge||!1,q=e.hasOwnProperty("PrintPreview")&&e.PrintPreview||!1,j&&(q=!0),k=document.createElement(NODE_NAME.HTML),G=document.createElement(NODE_NAME.HEAD),B=document.createElement(NODE_NAME.BODY),H=J(B),k.appendChild(G);var g=document.createElement(NODE_NAME.META);g.content="text/html; charset=UTF-8",g.httpEquiv="Content-Type",G.appendChild(g),k.appendChild(B);var f=a();n(cssCdnZWStaticPath+fingerPrintObj["styles/common/writer_common_min_all.css"],G),n(cssCdnZWStaticPath+fingerPrintObj["styles/writer_min_all.css"],G),r(G),se(G),o(f,G);var E=!1;DocLayoutManager.isFixedView()&&q&&(E=!0,DocLayoutManager.reset(),PubSub.publish("header/updateAutoFields"),PubSub.publish("footer/updateAutoFields"),editor.jeditorPane.find("div.zw-page").css({"border-top":""}));var T=J("<div>",{id:"editorpane"});H.append(T);var m=editor.jeditorPane.find("div.zw-page");if(m.each(function(){var e=this;T.append(e.cloneNode(!0))}),K){H.find("div.zw-page").css({"border-top":"",height:"","page-break-after":"auto"}).removeClass("zw-paginated"),H.find("div.zw-contentpane").css({height:""}),H.find("div.zw-line-content").removeClass("zw-line-content-div-justify");var h=H.find("div.header_primary").hide(),I=H.find("div.footer_primary").hide();H.find("div.zw-hr").show(),h.first().show(),I.last().show(),H.find("table").width("100%"),H.find("td, div.zw-cell-container").width(""),H.find("div.overlay, div#ResizeGrid").remove()}if(j||K)for(var _=B.getElementsByClassName("link"),A=0;A<_.length;A++){var S=J(_[A]),R=S.attr("data-href");Utils.isRelativeLink(R)&&(R=Utils.getAbsoluteLink(R));var O=S.text();S[0].innerHTML="<a href="+R+">"+O+"</a>"}d(H);var b=l();H.find("div.zw-page").css(b);var v=editor.doc.getBodyFormat()[ATTR_BODY.DS_BGC]||"rgb(255, 255, 255)";v&&(H[0].style.cssText+="background-color:"+v+" !important"),H.find("div.zw-contentpane").show(),s(H),c(H),u(H);for(var D=H[0].querySelectorAll(".zw-chart-canvas"),A=0;A<D.length;A++){var L=D[A].id,N=document.createElement("img");N.src=document.getElementById(L).toDataURL(),D[A].parentNode.replaceChild(N,D[A])}if(HiddenMarkers.isEnabled()&&H.find("span.zw-space").html("&nbsp;"),q=!1,E&&(DocLayoutManager.reset(),editor.doc.getSelection().select()),j&&V){var P=H.find("div.zw-page");P.css({"border-top":"",height:"","page-break-after":"auto"}).removeClass("zw-paginated"),H.find("div.zw-contentpane").css({height:""});var C=P.length;P.each(function(e){var t=J(this);t.css("margin-left",""),0!=e&&t.find("div.header_primary").hide(),e!=C-1&&t.find("div.footer_primary").hide(),t.find("div.overlay,div.replace-overlay,div.ui-hf-dbl-clk,.js-hfedit").remove(),t.find("span.ui-comment-indication,span.ui-comment-resolved").removeClass("ui-comment-indication ui-comment-resolved"),t.find("div.spell-error, div.grammar-error").remove()}),H.find('span[class^="EOP"]').remove(),H.find("span.autopcnt,span.autopno,span.autopno_toc,span.autodocname,span.autoauthor,span.autodate,span.autoformula").each(function(){J(this).removeClass("autopcnt autopno autopno_toc autodocname autoauthor autodate autoformula")});var y=H.find('span[class^="zw-portion zeroSize tab"]');H.find('span[class^="zw-portion zeroSize"]').not(y).remove(),n(cssCdnZWStaticPath+fingerPrintObj["styles/writer_min_all.css"],G),i(cssCdnZWStaticPath+fingerPrintObj["js/jquery_min_all.js"],G)}return H.find('div[id^="z-cursor"]').remove(),"<!DOCTYPE html><html>"+k.innerHTML+"</html>"}function I(e,t){var i=parseFloat(e),n=parseFloat(t),o="in";o=e.indexOf("mm")!=-1?"mm":e.indexOf("in")!=-1?"inch":"pixel";var r="";return r=i>n?"Landscape":"Portrait",PageLayout.getPaperSize(i,n,o,r)}function _(){var e={orientation:"portrait",papersize:"letter",paperheight:"11in",paperwidth:"8.5in"},t=DocLayoutManager.getFirstSection(),i=t.getFormats(),n=I(i.pw,i.ph),o=DocLayoutManager.getPageOrientationAtIndex(1),r=PageLayout.Paper[n]&&PageLayout.Paper[n][o];e.orientation=o.toLowerCase()||e.orientation,e.papersize=n.toLowerCase()||e.papersize,e.margin={};var a=t.getMargin();if(e.margin.top=(a.top+"px").convertor().inches,e.margin.right=(a.right+"px").convertor().inches,e.margin.bottom=(a.bottom+"px").convertor().inches,e.margin.left=(a.left+"px").convertor().inches,r&&"Custom"!=n)e.paperheight=r.height.inch,e.paperwidth=r.width.inch;else{var s=DocLayoutManager.getPageHeightAtIdx(1)+"px"||e.paperheight,l=DocLayoutManager.getPageWidthAtIdx(1)+"px"||e.paperwidth;e.paperheight=s.convertUnitTo("in"),e.paperwidth=l.convertUnitTo("in")}return e}function A(e){var t,i=e.length;return 1===i?t=e[0]:i>3?(t=e.slice(0,2).join(", "),t+=", and "+e[3]):(t=e.slice(0,i-1).join(", "),t+=", and "+e[i-1]),t}function S(){var e=Utils.getUnsupportedFonts();e.length>0&&L(e),ExportDialog.exportAs("pdf","preview")}function R(e){M(e);var t=editor.base_url,i=(editor.doc.docInfo,Macros.getPreviewURL(t));i+="?v=-1",e.versionid&&(i+="&versionid="+e.versionid,delete e.versionid);var n={};n.include_changes=e.include_changes,n.include_comments=e.include_comments,i+="&options="+encodeURIComponent(JSON.stringify(n)),UIUtils.initComponent("previewToolbar_container"),J("div#toolbarContainer").addClass("ui-history-printview-height"),J("#docprintpreview").css("display","block"),J("#topband-hamburger").hide(),LayoutManager.loadLayout(LAYOUTS.PRINTPREVIEW),DocumentMap.togglePane(),PopupHandler.closeAllPopup(),editor.browserInfo.is_edge&&J("#preview-toolbar-print").remove(),"REMOTE"==editor.type?(J("#topband-default").show(),J("#topband-file").hide(),J("#topband-printpreview").hide(),J("#remote-topband-print").hide()):(J("#topband-printpreview").show(),J("#previewToolbar_container").show()),J("#topband-printpreview-docname").text(editor.doc.docInfo.DOCUMENT_NAME),J("#file, #commonicondiv, #components, #top,#ui-editor-outer-div, #topband-savestatus-msg,#bottombar,#statusbar, #previewpagination").hide(),UIUtils.disableDocumentShortcuts();var o=document.getElementById("pdf_container"),r=DomUtil.getBottombarHeight(),a=document.documentElement.clientHeight-J(o).position().top-r;J(o).height(a),r>0&&J(o).css("margin-bottom",r),J("#closePreviewButton").zbutton("option","label",J.i18n("writer.common.CLOSE_PREVIEW")),J("#closePreview").css("border-right","1px solid #DDD"),J(".ui-top-mailid-sep").hide(),DomUtil.setEditorHht();var s=J("#pdf_container").empty();s.empty(),J("<iframe>",{src:i,frameborder:"0",width:"100%",height:"100%"}).appendTo(s)}function O(){var e=editor.getBaseURL(),t=F(),e=Macros.getPrintPreviewURL(e),i={};i.include_changes=t.include_changes,i.include_comments=t.include_comments,e+="options="+encodeURIComponent(JSON.stringify(i)),Utils.safeWindowOpen(e)}function b(e,t){if("lwriter"!=Macros.getContextName()){var i=editor.browserInfo.is_chrome||editor.browserInfo.is_firefox||editor.browserInfo.is_opera;!i||t||Ie()||_e()?v(e,t):ExportDialog.exportAs("print","print")}}function v(e,t){var i={PrintPreview:!1};if(Ae())i.PrintPreview=!0;else{var n=confirm(J.i18n("writer.common.PRINT_CONFIRM_MSG"));if(!n)return}UIUtils.showLoadingMsg(J.i18n("writer.common.INITIATING_PRINT")),Ae()?fe().done(function(i){he(e).done(function(){if(ge(e)){EditorUtil.focusMultiByteSpan();var n=me(e)}else var n=t?T(e):m(e);i&&DocLayoutManager.toggleWebView(),D(n)})}):D(h(i,e))}function D(e){te=0,ne=0,ie=0,iframeIdx=[],ZWLogger.addToStatistics("Print");var t=J("#browserPrint");t[0]||(t=J(document.createElement("iframe")).attr({id:"browserPrint",frameBorder:0,scrolling:"no",src:""}).css({border:"0px none",height:0,width:0}).appendTo(document.body));var i=t[0].contentWindow,n=i.document;n.open();var o=[],r=0,a=0;if(Ae()){n.write(e),o=J(n).find("image.zw-image");for(var s=function(){r++},l=0,d=o.length;l<d;l++)J(o[l]).on("load",s).on("error",s);for(var c=n.getElementsByClassName("zw-ifr-div"),u=function(){a++},l=0,d=iframeIdx.length;l<d;l++){var p=WidgetView.createWidgetContainer(editor.doc.getRawFormatAt(iframeIdx[l]));J(p.firstChild).load(u),c[l].innerHTML="",c[l].appendChild(p.firstChild)}var g=n.querySelectorAll(".zmap-iframe"),f=g.length;if(f){t.css({height:100,width:100}),ie=0;var E=0,T=setInterval(function(){g[E].parentNode.scrollIntoView(),E++,E==f&&clearInterval(T),setTimeout(function(){ie++},2e3)},3e3)}}else n.write(e);return n.close(),Ae()&&(q=!1),!re&&void(re=setInterval(function(){"complete"===t[0].contentWindow.document.readyState&&o.length==r&&a==te&&floatCropImageLoadCount==oe&&ne==ie&&(PdfEventHandler.upadteCropImageSrc(J(n).find("body")[0]),clearInterval(re),re=void 0,setTimeout(function(){i.print()},1e3),t.css({height:0,width:0}),UIUtils.hideLoadingMsg())},0))}function L(e){var t=A(e),i=J.i18n("common","PDF_WITH_UNSUPPORTEDFONTS_ALERT_MSG",[t]);UIUtils.showMessage("error",i,"showclose","normalfont")}function N(e,t,i,n){var o=Utils.getUnsupportedFonts();o.length>0&&L(o);var r=e||"true",a=t||"false",s="zw-export-"+editor.uuid;i=i||"_self",n=n||{};var l=n.format,d=n.versionid;delete n.versionid,delete n.format;var c=Macros.getAction(),u=!!n&&n.isFillableFieldMerge;if(u){c="publicExport";var p={};Macros.getRIdInParams(p),p.format=l,p.IS_ATTACHMENT=r,p.IS_PRINT=a,n.applyFillConditions=!0,p.options=JSON.stringify(n),p.fillableFieldData=JSON.stringify(n.fillableFieldData),p.cookietoken=s,p.action=c,void 0!==d&&(p.versionid=d),P(p,i)}else{var g=Macros.getPDFDownloadURL(r,a,s,i,l);void 0!==d&&(g+="&versionid="+d),g+="&options="+encodeURIComponent(JSON.stringify(n)),g+=Macros.getRIdString(),g+="&ACTION="+c,UIUtils.showLoadingMsg(J.i18n("writer.common.GENERATING_PDF")),Export.loadUrl(g)}Se=0,window.pdfprocessTimer=setInterval(function(){C(s)},1e3)}function P(e,t){var i=document.createElement("form");i.action="/writer/fillExport.do",i.name="exportform",i.method="post",i.target=t,i.acceptCharset="UTF-8";for(var n in e){var o=document.createElement("input");o.type="hidden",o.name=n,o.value=e[n],i.appendChild(o)}UIUtils.showLoadingMsg(J.i18n("writer.common.GENERATING_PDF"));var r=Export.createIframe(),a=r.contentWindow.document.body;a.appendChild(i),i.submit(),a.removeChild(i)}function C(e){var t=document.cookie.split(e+"="),i=t.pop().split(";").shift();Se++,"PDFGenerationCompleted"==i||"PDFGenerationFailed"==i?(UIUtils.hideLoadingMsg(),document.cookie=encodeURIComponent(e)+"=; Path=/; Expires="+new Date(0).toUTCString()+";",clearInterval(window.pdfprocessTimer),"PDFGenerationFailed"==i&&(UIUtils.showLoadingMsg(J.i18n("writer.common.GENERATING_PDF_FAILURE")),setTimeout(function(){UIUtils.hideLoadingMsg()},2e3))):Se>900&&(UIUtils.hideLoadingMsg(),clearInterval(window.pdfprocessTimer))}function y(){return q}function F(){return Z}function M(e){Z=e}function w(e,t,i){var n=0;return"a4"==e&&t>i?n=2:"executive"==e||"a5"==e?i>t&&(n=1):"b5"==e&&t>i?n=1:"a3"==e?n=1:"custom"==e&&(n=2),n}function U(e,t,i){var n=_(),o=(n.paperheight+"in").convertor().pixels,r=(n.paperwidth+"in").convertor().pixels,a=n.papersize,i=i?i:e.find(".zw-page"),s=w(a,r,o),l=o;l=Math.ceil(l-s),o=l>o?l:o,"custom"==a&&(o=Math.ceil(o));var d=r+"px "+o+"px",c="@media print{div.zw-page{overflow:hidden !important;box-shadow:0;margin-top:0px;margin-bottom:0px;padding:0px; width:"+r+"px !important;height:"+l+"px !important} @page { size: "+d+"; margin:0;-webkit-print-color-adjust:exact}div.zw-pagecontainer{height:"+l+"px !important}}";if(DocLayoutManager.hasRotatedPageInDocument()){var u=DocLayoutManager.getFirstGroup(),p=parseInt(u.getPageWidth()),g=parseInt(u.getPageHeight()),f="Portrait"==u.getPageOrientation()?"landscape":"portrait",E="ui-"+p+"-"+g+"-"+f,T=g-p,m="@media print{ div."+E+" {transform: rotate(270deg) translate(-100%, "+T/2+"px); transform-origin: 0 0;width:"+l+"px !important;height:"+r+"px !important }}";c+=m,DomViewManager.changeGridLayout(p,g,1)}var h=document.createElement("style");h.id="page-media-style",h.type="text/css",t?t.appendChild(h):document.head.appendChild(h),J(h).text(c)}function x(e){var t=e.find("span.link");t.each(function(){if(this.dataset.href&&""!==this.dataset.href.trim())if(this.dataset.type==LINK_TYPES.WEBURL||this.dataset.type==LINK_TYPES.MAILTO){var t=this.dataset.href;Utils.isRelativeLink(t)&&(t=Utils.getAbsoluteLink(t));var i=document.createElement("a");i.href=t,i.target="_blank",this.parentElement.insertBefore(i,this),i.appendChild(this)}else if(this.dataset.type==LINK_TYPES.BOOKMARK){var t=this.dataset.href,i=document.createElement("a");i.href="#"+t,this.parentElement.insertBefore(i,this),i.appendChild(this),J(i).css("text-decoration","none");var n=DocUtil.getFloatElementIdx(null,t);if(n!=-1){var o=DocUtil.getParaFormat(n).id,r=e.find("#"+o);if(void 0!=r){var a=r[0].parentElement;if(void 0!=a){var s=document.createElement("a");s.name=t;var l=a.nextSibling;if(void 0!=l){var d=l.nextSibling;l=void 0!=d?d:l}else l=a;a.parentElement.insertBefore(s,l)}}}}})}var B,H,G,k,Y,z,Z={},V=!1,j=!1,X=!1,K=!1,q=!1,Q=null,$=1,ee="",te=0,ie=0,ne=0,oe=0;floatCropImageLoadCount=0,iframeIdx=[],e();var re,ae=!1,se=function(e){var t=document.getElementsByClassName("table-theme-style");t.length&&e&&J(t).each(function(){e.appendChild(this.cloneNode(!0))})},le=function(e){var t=document.querySelector("#history-dynamic-css");t&&e.appendChild(t.cloneNode(!0))},de=function(e){for(var t=e.find("image"),i=0,n=t.length;i<n;i++){var o=t[i].parentElement,r=document.createElement("a"),a=JSON.parse(t[i].getAttribute("linkdata")||"{}")["data-link-url"];a&&(r.setAttribute("href",a),r.setAttribute("style","display:inline-block"),r.setAttribute("target","_blank"),o.parentNode.insertBefore(r,o),r.appendChild(o))}for(var s=e.find(".zw-textbox-content"),i=0,n=s.length;i<n;i++){var o=s[i],r=document.createElement("a"),l=JSON.parse(s[i].getAttribute("linkdata")||"{}")["data-link-url"];if(l){r.setAttribute("href",l),r.setAttribute("target","_blank");var d={position:"absolute",width:"100%",height:"100%"};W(r).css(d),o.insertBefore(r,o.firstChild)}}},ce=function(e){return!!e&&"all"==e.include_comments},ue=function(){var e=F();Export.exportAs(e)},pe=function(e){var t=editor.doc.getTrackChangeDetails().getDisplayMode();return t===TCConstants.ALL_MARKUP_VIEW?"as_markups"==e.include_changes:t===TCConstants.NO_MARKUP_VIEW?"all"===e.include_changes:t===TCConstants.ORIGINAL_VIEW&&"none"===e.include_changes},ge=function(e){return!!e&&(!Ie()&&(!e.isMailMerge&&!e.applyFillConditions&&("none"!=e.include_comments||!pe(e))))},fe=function(){var e=new Deferred;return DocLayoutManager.isWebView()?(PubSub.subscribe("Document/Pagination/Complete",function t(){PubSub.unsubscribe("Document/Pagination/Complete",t),e.resolve(!0)}),DocLayoutManager.toggleWebView()):e.resolve(!1),e},Ee=function(e){var t={include_changes:e.include_changes,include_comments:e.include_comments},i="?printoptions="+encodeURIComponent(JSON.stringify(t)),n=HistoryUI.getSelectedVersionId();n&&(i=i+"&versionid="+n);var o=ZWNetworkUtils.getNiceUrlPrefix(Macros.getType()+"/review/"+Macros.getRId()+"/print");return o+i},Te=function(e){var t=Ee(e),i=J("#review-print-iframe");i.length||(i=J("<iframe>"),i.attr("id","review-print-iframe"),i.css({width:0,height:0,position:"absolute",top:"-1000px"}),Jbody.append(i)),i.attr("src",t)},me=function(e){var t=J("#review-print-iframe").contents().find("#editorpane").children(".zw-page");return PrintPreview.getHTMLForPrint(t,e)},he=function(e){var t=new Deferred;return ge(e)?(PubSub.subscribeOnce("Document/ReviewPrintIframe/Ready",function(){t.resolve()}),Te(e)):t.resolve(),t},Ie=function(){return Macros.isRemote()&&!editor.getRole().permissions.can("review.comment.view")},_e=function(){return"cmwriter"==Macros.getContextName()},Ae=function(){return editor.browserInfo.is_chrome||editor.browserInfo.is_firefox||editor.browserInfo.is_opera},Se=0;window.PrintPreview={backToEditor:t,getHTML:h,getChromePrintHTML:m,getPageLayout:_,isPrintPreview:y,startPdfProcesstimer:C,addAnchorTagToImages:de,openPreview:S,loadPreview:R,downloadPDFFromPreview:ue,downloadUsingPDF:N,printUsingBrowser:b,processFloatImagesForPrint:p,printFromPreview:O,processAnchorTagToLinks:x,signerFieldPrintProcessing:g,addDifferentPageSizeStylesForPDF:U,initiatePrint:v,getHTMLForPrint:f}}(),ReplaceDialog.openrofind=function(){J.dialogutil.open("find",void 0,ReplaceDialog.dialogInfo)},ReplaceDialog.open=function(){J("#findToolbar").hide(),Replace.searchFor&&Replace.find(editor.doc.getSelection().getStart()),J.dialogutil.open("findandreplace",J("#rt_btn_findreplace"),ReplaceDialog.dialogInfo)},ReplaceDialog.handleEnter=function(e){if(e){var t=J("div#errormsg");t&&t.hide(),Replace.searchFor=e,Replace.find(),Replace.updateCurrentPosition()}},ReplaceDialog.handleClose=function(){Replace.searchFor="",editor.jeditorPane.find("div.replace-overlay").remove(),editor.jeditorPane.find("div.overlay").removeClass("animated"),PubSub.publish("QuickSeek/hideBarWithID","Replace"),J.dialogutil.close("findandreplace")},ReplaceDialog.find=function(){Replace.find(),Replace.updateCurrentPosition(),ZWLogger.addToStatistics("replace_findNext")},ReplaceDialog.replace=function(){Replace.replace(),Replace.updateCurrentPosition(),ZWLogger.addToStatistics("replace_replace")},ReplaceDialog.replaceAll=function(){Replace.replaceAll(),Replace.updateCurrentPosition(),ZWLogger.addToStatistics("replace_replaceAll")},ReplaceDialog.dialogInfo={init:function(){Replace.replaceAllVal=!1,Replace.searchIn=editor.doc.getDocumentContent(),Replace.replaceCount=0,Replace.replaceStr="",Replace.backwards=!1,Replace.navigator=J(".js_fnavigator"),Replace.pos=editor.doc.getSelection().getStart(),J("input#findTxt").unbind("input, focusin, focusout").bind({input:function(){Replace.findAllTexts(J(this))},focusin:function(){J(this).parents(".ui-find-replace").addClass("ui-find-replace-focus")},focusout:function(){J(this).parents(".ui-find-replace").removeClass("ui-find-replace-focus")}}).unbind("keyup").bind("keyup",function(e){var t=e.keyCode;if(t===KEYS.ENTER){var i=this.value;ReplaceDialog.handleEnter(i)}}),Replace.updateCurrentPosition()},set:function(e,t,i){"Find"==e.action?(Replace.searchFor=Utils.removeUnWantedUnicodes(t),Replace.pos=editor.doc.getSelection().getStart()):"Replace"==e.action?Replace.replaceStr=Utils.removeUnWantedUnicodes(t):"casesensitive"==e.action?Replace.casesensitive=t:"searchType"==e.action&&("up"==J(i).attr("value")?(Replace.pos=editor.doc.getSelection().getEnd(),Replace.backwards=!0,Replace.replaceCount=0):(Replace.pos=editor.doc.getSelection().getEnd(),Replace.backwards=!1,Replace.replaceCount=0))},get:function(e,t){if("Find"==e.action){if(t.focus(),Replace.searchFor)n=Replace.searchFor;else var i=editor.doc.getSelection(),n=i.getSelectedText(i.getStart(),i.getEnd());if(n)return n}else{if("searchType"==e.action)return backwards=!1,"down";if("casesensitive"==e.action)return Replace.casesensitive=!1,!1}}};var TocDialog=function(){var e=!0,t=function(e){e==ELEM_ID.TOCPANEL&&(EventHandler.isDialogOpened=!1)},i=function(e){TocDialog.isHeadingChanged||e.isHeading()&&(TocDialog.isHeadingChanged=!0)};return PubSub.subscribe("BeforePanelClose",t),PubSub.subscribe("Para/Create",i),PubSub.subscribe("Para/Update",i),PubSub.subscribe("Para/Modify",i),PubSub.subscribe("Para/Remove",i),{isHeadingChanged:e}}();TocDialog.openTocSettingsDlg=function(){TocDialog.newAttr={},TocDialog.attr={};var e={theme:"classic",level:3,leader:1,showNo:!0,al_right:!0};TocDialog.attr=DocUtil.copyStyle(e),TocDialog.newAttr=DocUtil.copyStyle(e);var t=editor.doc.findNextIndexOf(UNICODE.TOCSTART,0);if(TocDialog.documentHeadingParas=editor.doc.getSelection().getAllHeadings(),TocDialog.isTocExist=!1,t>0){TocDialog.isTocExist=!0;var i=editor.doc.getRawFormatAt(t),n=Toc.getTocParas(DocTreeManager.getTreeNodeAtIndex(t)).tocParas,o=n[0],r=o?o.getParaStyles().tps:null;r=r&&r.length?r[r.length-1]:null;var a=!(!r||2!=r.align);void 0!==i.theme&&(TocDialog.attr=DocUtil.copyStyle(i),TocDialog.attr.al_right=a,TocDialog.newAttr=DocUtil.copyStyle(i),TocDialog.newAttr.al_right=a)}FetchHTML.get({requestName:"tocsettings",target:"#subpanel-toc",callback:function(){var e=J("#subpanel-toc");document.getElementById("tableader")||(TocDialog.attr.leader=0,TocDialog.newAttr.leader=0),document.getElementById("toc-settings-show-pg-no")||(TocDialog.attr.showNo=!1,TocDialog.newAttr.showNo=!1),e.data("ZCtrackObjects")?e.ZCtrackObjects("refreshValues"):e.ZCtrackObjects({callbacks:TocDialog.dialogInfo,fillVisible:!1}),EventHandler.isDialogOpened=!0;var t={panelId:ELEM_ID.TOCPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[ELEM_ID.INSERTPANEL]};LeftPanel.showAdvancedPanel(t)}})},TocDialog.updatePreview=function(){var e=TocDialog.newAttr[ATTR_TOC.theme],t=WebUtil.TocMenuHTML[e];t[ATTR_TOC.showNo]=TocDialog.newAttr[ATTR_TOC.showNo],t[ATTR_TOC.level]=TocDialog.newAttr[ATTR_TOC.level],t[ATTR_TOC.leader]=TocDialog.newAttr[ATTR_TOC.leader],t[ATTR_TOC.al_right]=TocDialog.newAttr[ATTR_TOC.al_right];var i=Z("toc-theme-"+e),n=i.find(".js-toc-pgno");1==t.showNo&&t.al_right?Z("tableaderContainer").enable():Z("tableaderContainer").disable(),t.showNo?n.show():n.hide();var o="0px dotted";1==t.leader?o="1px dotted":2==t.leader?o="1px dashed":3==t.leader&&(o="1px solid"),t.leader>0&&!t.showNo&&(o="0px dotted"),i.find(".ui-toc-leader").css("border-bottom",o+" #000"),t.al_right?(i.find(".ui-toc-leader").css("display","inline-block"),J('*[class^="ui-toc-head"]').css("text-align","center")):(i.find(".ui-toc-leader").css("display","none"),J('*[class^="ui-toc-head"]').css("text-align","left"));var r,a,s=["simple","classic","contemporary","modern","formal"];for(r=1;r<=6;r++)for(a=0;a<s.length;a++){var l=Z("toc-theme-"+s[a]).find(".ui-toc-head"+r.toString());r>t.level?l.hide():l.show()}},TocDialog.updateTheme=function(e){var t=J("select#tableader");"modern"===e||"formal"===e||"classic"===e?(TocDialog.newAttr[ATTR_TOC.leader]=1,t.zlabeledselectbox("setValue","1")):(TocDialog.newAttr[ATTR_TOC.leader]=0,t.zlabeledselectbox("setValue","0")),TocDialog.newAttr[ATTR_TOC.showNo]||(TocDialog.newAttr[ATTR_TOC.leader]=0,t.zlabeledselectbox("setValue","0")),TocDialog.newAttr[ATTR_TOC.theme]=e},TocDialog.bindEvents=!0,TocDialog.dialogInfo={init:function(){TocDialog.updatePreview();var e=TocDialog.attr.theme||"classic";TocDialog.isTocExist?(J("#toc-update").show(),J("#toc-insert").hide()):(J("#toc-update").hide(),J("#toc-insert").show()),carousel.move(e),TocDialog.bindEvents&&(TocDialog.bindEvents=!1,carousel.init(),carousel.move(e),J("#toc-carousel-next").click(function(){setTimeout(function(){var e=J("#carousel-parent ul").children("li").eq(1).attr("id");e=e.replace("toc-theme-",""),TocDialog.updateTheme(e),TocDialog.updatePreview()},300)}),J("#toc-carousel-prev").click(function(){setTimeout(function(){var e=J("#carousel-parent ul").children("li").eq(1).attr("id");e=e.replace("toc-theme-",""),TocDialog.updateTheme(e),TocDialog.updatePreview()},300)}))},get:function(e,t){return e=e.action,"strokeType"===e?TocDialog.attr[ATTR_TOC.leader]:"level"===e?TocDialog.attr[ATTR_TOC.level]:"showNo"===e?TocDialog.attr[ATTR_TOC.showNo]:"alignRight"===e?TocDialog.attr[ATTR_TOC.al_right]:void 0},set:function(e,t,i){"strokeType"===e.action?TocDialog.newAttr[ATTR_TOC.leader]=parseInt(t):"level"===e.action?TocDialog.newAttr[ATTR_TOC.level]=parseInt(t):"showNo"===e.action?TocDialog.newAttr[ATTR_TOC.showNo]=t:"alignRight"===e.action&&(TocDialog.newAttr[ATTR_TOC.al_right]=t),TocDialog.updatePreview()}},TocDialog.applyValues=function(){var e=editor.doc.findNextIndexOf(UNICODE.TOCSTART,0);EventHandler.isDialogOpened=!1,e>0&&(!ZWJSONUtils.compareJSON(TocDialog.newAttr,TocDialog.attr)||TocDialog.isHeadingChanged)?(editor.lastOperation="regeneratetoc",Toc.regenerateTOC(TocDialog.newAttr,!0),TocDialog.isHeadingChanged&&(TocDialog.isHeadingChanged=!1)):(e<0||TocDialog.isHeadingChanged)&&(editor.lastOperation="inserttoc",Toc.generate(TocDialog.newAttr),TocDialog.isHeadingChanged&&(TocDialog.isHeadingChanged=!1)),LeftPanel.closeSubPanel()},Settings.prototype={pageInfo:{init:function(){if(ProofingAdaptor.isGrammarSupportedSetup()&&ProofingAdaptor.isGrammarSupportedUser()?J("#proofing_settings_tab").show():(J("#settings-dlg-proofing-cont").hide(),J("#spellcheck_settings_tab").show()),"ui_preferences"===Settings.toBeOpenedTab)J("#settings_ui #menutabs").ztabpanel("openTab","1");else if("autocorrect"===Settings.toBeOpenedTab){J("#settings_ui #menutabs").ztabpanel("openTab","2");var e=J("#spl_char").val();J("#autoCorrect_Value_Id").val(e)}else"spellcheck"===Settings.toBeOpenedTab?ProofingAdaptor.isGrammarSupportedSetup()&&ProofingAdaptor.isGrammarSupportedUser()?J("#settings_ui #menutabs").ztabpanel("openTab","#proofing_settings_tab"):J("#settings_ui #menutabs").ztabpanel("openTab","#spellcheck_settings_tab"):"language"===Settings.toBeOpenedTab?J("#settings_ui #menutabs").ztabpanel("openTab","#settings-lang-and-region"):J("#settings_ui #menutabs").ztabpanel("openTab","0");var t=JSON.parse(w_usersettings[ATTR_BODY.PROOFING]||"{}"),i=!1,n=!1,o=!1;i=w_usersettings[ATTR_BODY.PROOFING_SP]?"true"===w_usersettings[ATTR_BODY.PROOFING_SP].toString():t.hasOwnProperty(ATTR_BODY.PROOFING_SP)?"true"===t[ATTR_BODY.PROOFING_SP].toString():w_usersettings[ATTR_BODY.DS_INSPL]&&"true"===w_usersettings[ATTR_BODY.DS_INSPL].toString(),w_usersettings[ATTR_BODY.PROOFING_GRAMMAR]?n="true"===w_usersettings[ATTR_BODY.PROOFING_GRAMMAR].toString():t.hasOwnProperty(ATTR_BODY.PROOFING_GRAMMAR)&&(n="true"===t[ATTR_BODY.PROOFING_GRAMMAR].toString());var r={};r.ignoreUppercase="true"===(w_usersettings[ATTR_BODY.SP_IGNOREUPPERCASE]||!1).toString(),r.ignoreNumbered="true"===(w_usersettings[ATTR_BODY.SP_IGNORENUMBERED]||!1).toString(),r.ignoreMixedcase="true"===(w_usersettings[ATTR_BODY.SP_IGNOREMIXEDCASE]||!1).toString();var a={};if(a.wordyPhrases="true"===(w_usersettings[ATTR_BODY.WQ_WORDYPHRASES]||!1).toString(),a.rephrasableSentences="true"===(w_usersettings[ATTR_BODY.WQ_REPHRASABLESENTENCES]||!1).toString(),a.improperWordChoices="true"===(w_usersettings[ATTR_BODY.WQ_IMPROPERWORDCHOICES]||!1).toString(),a.informalWriting="true"===(w_usersettings[ATTR_BODY.WQ_INFORMALWRITING]||!1).toString(),a.nonInclusive="true"===(w_usersettings[ATTR_BODY.WQ_NONINCLUSIVELANGUAGE]||!1).toString(),o=isAnyWqConfEnabled(),Settings.updateProofingOptions({sp:i,grm:n,wq:o},r,a),Settings.updateDisplayLanguage(),"undefined"!=typeof DocLocaleDlg){var s=DocLocaleDlg.getLanguageOptions(),l=J("#settings-langmenu");l.zcombobox("addOption",s);var d=w_usersettings[ATTR_BODY.DS_LANGUAGE]||w_usersettings[ATTR_BODY.DS_SPLANG];Settings.onLanguageChange(d);var c=w_usersettings.timezone||"-";document.getElementById("settings-timezone")&&(document.getElementById("settings-timezone").innerHTML=c)}delete Settings.toBeOpenedTab},get:function(e){if(Settings.soundMap||"undefined"!=typeof Settings.soundMap||(Settings.soundMap={}),Settings.vc_info={},"viewType"==e.action)return Settings.ViewType=w_usersettings[ATTR_BODY.DS_VIEW],"Normal View"===Settings.ViewType&&(Settings.ViewType="Fixed View"),Settings.ViewType;if("pasteOptions"===e.action)return Settings.PasteOptions=w_usersettings[ATTR_BODY.DS_PASTEOPTIONS]+"",Settings.PasteOptions;if("getsoundpref"==e.action)return Settings.soundMap.PREF=w_usersettings.SOUNDPREF,Settings.soundMap.AUDIO=w_usersettings.AUDIO,"1"===Settings.soundMap.AUDIO?J("#enableaudio")[0].checked=!0:J("#enableaudio")[0].checked=!1,Settings.soundMap.PREF;if("units"==e.action)return Settings.Unit=w_usersettings[ATTR_BODY.DS_UN],Settings.Unit;if("allowcomments"==e.action)return Settings.AllowComments=w_usersettings[ATTR_BODY.DS_COMM],Settings.AllowComments;if("setlanguage"==e.action)return Settings.language=w_usersettings[ATTR_BODY.DS_LANGUAGE]||w_usersettings[ATTR_BODY.DS_SPLANG],Settings.language;if("ignoreuppercase"==e.action){var t=w_usersettings[ATTR_BODY.SP_IGNOREUPPERCASE];return Settings.ignoreUppercase=!!t&&"true"===t.toString(),Settings.ignoreUppercase}if("ignorenumbered"==e.action){var i=w_usersettings[ATTR_BODY.SP_IGNORENUMBERED];return Settings.ignoreNumbered=!!i&&"true"===i.toString(),Settings.ignoreNumbered}if("ignoremixedcase"==e.action){var n=w_usersettings[ATTR_BODY.SP_IGNOREMIXEDCASE];return Settings.ignoreMixedcase=!!n&&"true"===n.toString(),Settings.ignoreMixedcase}if("wordyphrases"==e.action){var o=w_usersettings[ATTR_BODY.WQ_WORDYPHRASES];return Settings.wordyPhrases=!!o&&"true"===o.toString(),Settings.wordyPhrases}if("rephrasablesentences"==e.action){var r=w_usersettings[ATTR_BODY.WQ_REPHRASABLESENTENCES];return Settings.rephrasableSentences=!!r&&"true"===r.toString(),Settings.rephrasableSentences}if("improperwordchoices"==e.action){var a=w_usersettings[ATTR_BODY.WQ_IMPROPERWORDCHOICES];return Settings.improperWordChoices=!!a&&"true"===a.toString(),Settings.improperWordChoices}if("informalwriting"==e.action){var s=w_usersettings[ATTR_BODY.WQ_INFORMALWRITING];return Settings.informalWriting=!!s&&"true"===s.toString(),Settings.informalWriting}if("noninclusive"==e.action){var l=w_usersettings[ATTR_BODY.WQ_NONINCLUSIVELANGUAGE];return Settings.nonInclusive=!!l&&"true"===l.toString(),Settings.nonInclusive}if("enablesp"==e.action){var d=JSON.parse(w_usersettings[ATTR_BODY.PROOFING]||"{}");return w_usersettings[ATTR_BODY.PROOFING_SP]?Settings.enableSp="true"===w_usersettings[ATTR_BODY.PROOFING_SP].toString():d.hasOwnProperty(ATTR_BODY.PROOFING_SP)?Settings.enableSp="true"===d[ATTR_BODY.PROOFING_SP].toString():Settings.enableSp=w_usersettings[ATTR_BODY.DS_INSPL]&&"true"===w_usersettings[ATTR_BODY.DS_INSPL].toString(),Settings.enableSp}if("enablegrm"==e.action){var d=JSON.parse(w_usersettings[ATTR_BODY.PROOFING]||"{}");return w_usersettings[ATTR_BODY.PROOFING_GRAMMAR]?Settings.enableGrm="true"===w_usersettings[ATTR_BODY.PROOFING_GRAMMAR].toString():d.hasOwnProperty(ATTR_BODY.PROOFING_GRAMMAR)&&(Settings.enableGrm="true"===d[ATTR_BODY.PROOFING_GRAMMAR].toString()),!!Settings.enableSp&&Settings.enableGrm}if("enablewq"==e.action)return Settings.enableWq=isAnyWqConfEnabled(),Settings.enableWq;if("autolink"==e.action)return Settings.AutoLink=w_usersettings[ATTR_BODY.DS_AUTOLINK],"1"==Settings.AutoLink;if("autolist"==e.action)return Settings.AutoList=w_usersettings[ATTR_BODY.DS_AUTOLIST],"1"==Settings.AutoList;if("autoembed"==e.action)return Settings.AutoEmbed=w_usersettings[ATTR_BODY.DS_AUTOEMBED],void 0==Settings.AutoEmbed&&(Settings.AutoEmbed="1"),"1"==Settings.AutoEmbed;if("autocaps"==e.action)return Settings.AutoCaps=w_usersettings[ATTR_BODY.DS_AUTOCAPS],"1"==Settings.AutoCaps;if(e.action===ATTR_BODY.DS_DARK_MODE)return Settings.DarkMode=w_usersettings[ATTR_BODY.DS_DARK_MODE],"1"===Settings.DarkMode;if(e.action===ATTR_BODY.DS_FOCUS_TYPING)return Settings.FocusTyping=w_usersettings[ATTR_BODY.DS_FOCUS_TYPING],"1"===Settings.FocusTyping;if(e.action===ATTR_BODY.DS_TYPEWRITER_SOUND)return Settings.TypewriterSound=w_usersettings[ATTR_BODY.DS_TYPEWRITER_SOUND],"1"===Settings.TypewriterSound;if("autocaps_correct"==e.action)return Settings.AutoCapsLock=w_usersettings[ATTR_BODY.DS_AUTOCORRECTCAPSLOCK],"1"==Settings.AutoCapsLock;if("autocaps_days"==e.action)return Settings.AutoCapsDays=w_usersettings[ATTR_BODY.DS_AUTOCAPSDAYS],"1"==Settings.AutoCapsDays;if("autocomplete"===e.action)return Settings.AutoComplete=w_usersettings[ATTR_BODY.DS_AUTOCOMPLETE],"1"==Settings.AutoComplete;if("autosmartquotes"===e.action)return Settings.AutoSmartQuotes=w_usersettings[ATTR_BODY.DS_AUTOSMARTQUOTES],"1"==Settings.AutoSmartQuotes;if("autoendash"===e.action)return Settings.AutoEnDash="true"===w_usersettings[ATTR_BODY.DS_AUTOENDASH].toString(),Settings.AutoEnDash;if("autoemdash"===e.action)return Settings.AutoEmDash="true"===w_usersettings[ATTR_BODY.DS_AUTOEMDASH].toString(),Settings.AutoEmDash;if("datefmt"===e.action){Settings.DateFmt=ZWDateTime.migrateMomentToIntlFormat(w_usersettings[ATTR_BODY.DS_DATEFORMAT]||w_usersettings[ATTR_BODY.DS_AUTODATEFORMAT],w_usersettings[ATTR_BODY.DS_LANGUAGE]||w_usersettings[ATTR_BODY.DS_SPLANG]);var c=ZWDate.getLocaleSupportedFormats(w_usersettings[ATTR_BODY.DS_LANGUAGE]||w_usersettings[ATTR_BODY.DS_SPLANG]);return Settings.DateFmt||(Settings.DateFmt="MM/DD/YYYY"),Settings.DateFmt=c&&c.contains(Settings.DateFmt)?Settings.DateFmt:c[0],Settings.DateFmt}return"smarttoolbar"==e.action?(Settings.vc_info.smarttoolbar=UserPreferences.isPrefered(e.action),"1"==Settings.vc_info.smarttoolbar):"para_microtoolbar"==e.action?(Settings.vc_info.para_microtoolbar=UserPreferences.isPrefered(e.action),"1"==Settings.vc_info.para_microtoolbar):"ruler"==e.action?(Settings.vc_info.ruler=UserPreferences.isPrefered(e.action),"1"==Settings.vc_info.ruler):"pref"==e.action?(AutoCorrect.showCorrects(),Settings.Pref=w_usersettings[ATTR_BODY.DS_PREF],isNaN(Settings.Pref)&&(Settings.Pref="1"==Settings.Pref?1:0),1==Settings.Pref?(J("#inline")[0].checked=!1,J("div#prefdiv, div#defaultprefdiv").find(":input").removeAttr("disabled")):setTimeout(function(){J("#inline")[0].checked=!0,J("div#prefdiv, div#defaultprefdiv").find(":input").attr("disabled",!0)},100),!Settings.Pref):"mm-initiate-email"===e.action?(Settings.MM_INITIATE_EMAIL="true"===w_usersettings[ATTR_BODY.MM_INITIATE_EMAIL].toString(),Settings.MM_INITIATE_EMAIL):"mm-complete-email"===e.action?(Settings.MM_COMPLETE_EMAIL="true"===w_usersettings[ATTR_BODY.MM_COMPLETE_EMAIL].toString(),Settings.MM_COMPLETE_EMAIL):e.action==ATTR_BODY.USER_IN?(Settings.USER_IN=w_usersettings[ATTR_BODY.USER_IN],Settings.USER_IN):e.action==ATTR_BODY.IMG_COMPRESSION?(w_usersettings.hasOwnProperty(ATTR_BODY.IMG_COMPRESSION)?Settings.IMG_COMPRESSION="true"===w_usersettings[ATTR_BODY.IMG_COMPRESSION].toString():Settings.IMG_COMPRESSION=!0,Settings.IMG_COMPRESSION):void 0},set:function(e,t,i){"viewType"==e.action?Settings.ViewType=J(i).attr("value"):"pasteOptions"===e.action?Settings.PasteOptions=J(i).attr("value"):"getaudio"==e.action?t?Settings.soundMap.AUDIO="1":Settings.soundMap.AUDIO="0":"getsoundpref"==e.action?Settings.soundMap.PREF=J("#sound_list option:selected").val():"pagebreak"==e.action?t?Settings.PageBreak=1:Settings.PageBreak=0:"setlanguage"==e.action?(Settings.language=J("#settings-langmenu option:selected").val(),Settings.onLanguageChange(Settings.language)):"ignoreuppercase"==e.action?Settings.ignoreUppercase=t:"ignorenumbered"==e.action?Settings.ignoreNumbered=t:"ignoremixedcase"==e.action?Settings.ignoreMixedcase=t:"wordyphrases"==e.action?(Settings.wordyPhrases=t,canCheckWritingQuality()):"rephrasablesentences"==e.action?(Settings.rephrasableSentences=t,canCheckWritingQuality()):"improperwordchoices"==e.action?(Settings.improperWordChoices=t,canCheckWritingQuality()):"informalwriting"==e.action?(Settings.informalWriting=t,canCheckWritingQuality()):"noninclusive"==e.action?(Settings.nonInclusive=t,canCheckWritingQuality()):"enablesp"==e.action?(Settings.enableSp=t,Settings.updateProofingOptions()):"enablegrm"==e.action?(Settings.enableGrm=t,Settings.updateWritingQualitySettings()):"enablewq"==e.action?(Settings.enableWq=t,Settings.enableWq=changeWritingQualityTypesValue(t)):"units"==e.action?Settings.Unit=t:"datefmt"==e.action?(Settings.DateFmt=t,Settings.updateFormatPreview(Settings.language,t)):"allowcomments"==e.action?Settings.AllowComments=t?1:0:"autolink"==e.action?Settings.AutoLink=t?1:0:"autolist"==e.action?Settings.AutoList=t?1:0:"autoembed"==e.action?Settings.AutoEmbed=t?1:0:"autocaps"==e.action?Settings.AutoCaps=t?1:0:e.action===ATTR_BODY.DS_DARK_MODE?Settings.DarkMode=t?1:0:e.action===ATTR_BODY.DS_FOCUS_TYPING?Settings.FocusTyping=t?1:0:e.action===ATTR_BODY.DS_TYPEWRITER_SOUND?Settings.TypewriterSound=t?1:0:"autocaps_correct"==e.action?Settings.AutoCapsLock=t?1:0:"autocaps_days"==e.action?Settings.AutoCapsDays=t?1:0:"autocomplete"===e.action?Settings.AutoComplete=t?1:0:"autosmartquotes"===e.action?Settings.AutoSmartQuotes=t?1:0:"autoendash"===e.action?Settings.AutoEnDash=t:"autoemdash"===e.action?Settings.AutoEmDash=t:"smarttoolbar"==e.action?Settings.vc_info.smarttoolbar=t:"para_microtoolbar"==e.action?Settings.vc_info.para_microtoolbar=t:"ruler"==e.action?Settings.vc_info.ruler=t:"pref"==e.action?(t?J("div#prefdiv, div#defaultprefdiv").find(":input").attr("disabled",!0):J("div#prefdiv, div#defaultprefdiv").find(":input").removeAttr("disabled"),Settings.Pref=t?0:1):"mm-initiate-email"===e.action?Settings.MM_INITIATE_EMAIL=t.toString():"mm-complete-email"===e.action?Settings.MM_COMPLETE_EMAIL=t.toString():e.action==ATTR_BODY.USER_IN?Settings.USER_IN=t:e.action==ATTR_BODY.IMG_COMPRESSION&&(Settings.IMG_COMPRESSION=t)}},apply:function(){var e=!1,t=UserPreferences.handleUserPrefChange(Settings.vc_info),i={};i[ATTR_BODY.DS_VIEW]=Settings.ViewType,i[ATTR_BODY.DS_UN]=Settings.Unit,i[ATTR_BODY.DS_DATEFORMAT]=Settings.DateFmt,i[ATTR_BODY.DS_COMM]=Settings.AllowComments,i[ATTR_BODY.DS_AUTOLINK]=Settings.AutoLink,i[ATTR_BODY.DS_AUTOLIST]=Settings.AutoList,i[ATTR_BODY.DS_AUTOEMBED]=Settings.AutoEmbed,i[ATTR_BODY.DS_AUTOCAPS]=Settings.AutoCaps,i[ATTR_BODY.DS_DARK_MODE]=Settings.DarkMode,i[ATTR_BODY.DS_FOCUS_TYPING]=Settings.FocusTyping,i[ATTR_BODY.DS_TYPEWRITER_SOUND]=Settings.TypewriterSound,i[ATTR_BODY.DS_AUTOCORRECTCAPSLOCK]=Settings.AutoCapsLock,i[ATTR_BODY.DS_AUTOCAPSDAYS]=Settings.AutoCapsDays,i[ATTR_BODY.DS_AUTOCOMPLETE]=Settings.AutoComplete,i[ATTR_BODY.DS_AUTOSMARTQUOTES]=Settings.AutoSmartQuotes,i[ATTR_BODY.DS_AUTOENDASH]=Settings.AutoEnDash,i[ATTR_BODY.DS_AUTOEMDASH]=Settings.AutoEmDash,i[ATTR_BODY.DS_PASTEOPTIONS]=Settings.PasteOptions,i.disabled_tools=t,i[ATTR_BODY.DS_PREF]=Settings.Pref,i[ATTR_BODY.DS_LANGUAGE]=Settings.language,i[ATTR_BODY.PROOFING_SP]=Settings.enableSp,i[ATTR_BODY.PROOFING_GRAMMAR]=Settings.enableGrm,i[ATTR_BODY.SP_IGNOREUPPERCASE]=Settings.ignoreUppercase,i[ATTR_BODY.SP_IGNORENUMBERED]=Settings.ignoreNumbered,i[ATTR_BODY.SP_IGNOREMIXEDCASE]=Settings.ignoreMixedcase,i[ATTR_BODY.WQ_WORDYPHRASES]=Settings.wordyPhrases,i[ATTR_BODY.WQ_REPHRASABLESENTENCES]=Settings.rephrasableSentences,i[ATTR_BODY.WQ_IMPROPERWORDCHOICES]=Settings.improperWordChoices,i[ATTR_BODY.WQ_NONINCLUSIVELANGUAGE]=Settings.nonInclusive,i[ATTR_BODY.WQ_INFORMALWRITING]=Settings.informalWriting,i[ATTR_BODY.MM_INITIATE_EMAIL]=Settings.MM_INITIATE_EMAIL,i[ATTR_BODY.MM_COMPLETE_EMAIL]=Settings.MM_COMPLETE_EMAIL,i[ATTR_BODY.IMG_COMPRESSION]=Settings.IMG_COMPRESSION,i.AUDIO=Settings.soundMap.AUDIO,i.SOUNDPREF=Settings.soundMap.PREF,i[ATTR_BODY.DS_AUTOCORRECTS]=AutoCorrect.getUserCorrects(!0);var n=w_usersettings[ATTR_BODY.DS_UN];for(var o in w_usersettings)if(e||"undefined"==typeof i[o]||i[o]==w_usersettings[o]){if(e)break}else e=!0;if(e){var r={},a={},s={},l=(JSON.parse(w_usersettings[ATTR_BODY.PROOFING]||"{}"),(w_usersettings[ATTR_BODY.SP_IGNOREUPPERCASE]||!1).toString()),d=(w_usersettings[ATTR_BODY.SP_IGNORENUMBERED]||!1).toString(),c=(w_usersettings[ATTR_BODY.SP_IGNOREMIXEDCASE]||!1).toString(),u=(w_usersettings[ATTR_BODY.WQ_WORDYPHRASES]||!1).toString(),p=(w_usersettings[ATTR_BODY.WQ_REPHRASABLESENTENCES]||!1).toString(),g=(w_usersettings[ATTR_BODY.WQ_IMPROPERWORDCHOICES]||!1).toString(),f=(w_usersettings[ATTR_BODY.WQ_INFORMALWRITING]||!1).toString(),E=(w_usersettings[ATTR_BODY.WQ_NONINCLUSIVELANGUAGE]||!1).toString();Settings.ignoreUppercase.toString()!=l&&(r[ATTR_BODY.SP_IGNOREUPPERCASE]=Settings.ignoreUppercase),Settings.ignoreNumbered.toString()!=d&&(r[ATTR_BODY.SP_IGNORENUMBERED]=Settings.ignoreNumbered),Settings.ignoreMixedcase.toString()!=c&&(r[ATTR_BODY.SP_IGNOREMIXEDCASE]=Settings.ignoreMixedcase),Settings.wordyPhrases.toString()!=u&&(a[ATTR_BODY.WQ_WORDYPHRASES]=Settings.wordyPhrases),Settings.rephrasableSentences.toString()!=p&&(a[ATTR_BODY.WQ_REPHRASABLESENTENCES]=Settings.rephrasableSentences),Settings.improperWordChoices.toString()!=g&&(a[ATTR_BODY.WQ_IMPROPERWORDCHOICES]=Settings.improperWordChoices),Settings.informalWriting.toString()!=f&&(a[ATTR_BODY.WQ_INFORMALWRITING]=Settings.informalWriting),Settings.nonInclusive.toString()!=E&&(a[ATTR_BODY.WQ_NONINCLUSIVELANGUAGE]=Settings.nonInclusive),w_usersettings.hasOwnProperty(ATTR_BODY.PROOFING_SP)&&w_usersettings[ATTR_BODY.PROOFING_SP]!=Settings.enableSp&&(s[ATTR_BODY.PROOFING_SP]=Settings.enableSp),w_usersettings.hasOwnProperty(ATTR_BODY.PROOFING_GRAMMAR)&&w_usersettings[ATTR_BODY.PROOFING_GRAMMAR]!=Settings.enableGrm&&(s[ATTR_BODY.PROOFING_GRAMMAR]=Settings.enableGrm),Settings.updateUserSettings(i),i[ATTR_BODY.DS_AUTOCORRECTS]=JSON.stringify(AutoCorrect.getUserCorrects(!0)),J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/options"),data:i,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}}),Settings.Unit!=n&&(Conversions.init(w_usersettings[ATTR_BODY.DS_UN]),PubSub.publish("Settings/UnitsChanged")),PubSub.publish("Settings/Saved"),"undefined"!=typeof Proofing&&(ZWJSONUtils.isEmptyObject(s)&&ZWJSONUtils.isEmptyObject(r)&&ZWJSONUtils.isEmptyObject(a)||PubSub.publish("Settings/Proofing/SettingsUpdated",s,r,a));var T={};"locale"!=Settings.language&&Settings.language!==DocLocaleHandler.getLanguage()&&(T[ATTR_BODY.DS_LANGUAGE]=Settings.language,ActivityTracker.track("Locale","ChangeLanguage","Settings")),Settings.DateFmt!==DocLocaleHandler.getDateFormat()&&(T[ATTR_BODY.DS_DATEFORMAT]=Settings.DateFmt,ActivityTracker.track("Locale","ChangeDateFmt","Settings")),!ZWJSONUtils.isEmptyObject(T)&&DocLocaleHandler.setDocumentProperty(T)}J.dialogutil.close("settings")},showSettingsDlg:function(e){UIUtils.hideControllers(e),Settings.toBeOpenedTab="",J.dialogutil.open("settings",void 0,Settings.pageInfo)},notification:{init:function(){var e=J("#follow_ui");NotificationSettingsView.init(e),NotificationSettingsView.bindEvents()},apply:function(){NotificationSettingsView.done()}}},PubSub.subscribe("Settings/Saved",function(){"Page View"===w_usersettings.view?editor.doc.execCmd(["changeView","Page View"]):"Web View"===w_usersettings.view&&editor.doc.execCmd(["changeView","Web View"])}),Settings.prototype.updateUserSettings=function(e){for(var t in e)w_usersettings[t]=e[t]},Settings.prototype.showNotificationDialog=function(){ZWLogger.addToStatistics("ShowNotify"),J.dialogutil.open("notification",void 0,Settings.notification)},Settings.prototype.showAutoCorrectDlg=function(){Settings.toBeOpenedTab="autocorrect",J.dialogutil.open("settings",void 0,Settings.pageInfo)},Settings.prototype.showUIPreferencesDlg=function(){Settings.toBeOpenedTab="ui_preferences",J.dialogutil.open("settings",void 0,Settings.pageInfo)},Settings.prototype.openManageExtensionDialog=function(){var e=jsCdnZWStaticPath+fingerPrintObj["js/writer_extension_min_all.js"];zw.require({js:[e]},[],function(){J.dialogutil.open("manageextensionsdialog",void 0,MarketplaceHandler.managepanelinit)})},Settings.prototype.showLanguageDlg=function(){Settings.toBeOpenedTab="language",J.dialogutil.open("settings",void 0,Settings.pageInfo)},Settings.prototype.openProofingSettings=function(){Settings.toBeOpenedTab="spellcheck",J.dialogutil.open("settings",void 0,Settings.pageInfo)},Settings.prototype.playsound=function(){"undefined"==typeof window.sound&&(window.sound={},sound.alert=new Audio(cdnZWStaticPath+fingerPrintObj["sound/alert.wav"]),sound.ascending=new Audio(cdnZWStaticPath+fingerPrintObj["sound/ascending.wav"]),sound.beep=new Audio(cdnZWStaticPath+fingerPrintObj["sound/beep.wav"]),sound.cuckoo=new Audio(cdnZWStaticPath+fingerPrintObj["sound/cuckoo.wav"]),sound.doorbell=new Audio(cdnZWStaticPath+fingerPrintObj["sound/doorbell.wav"]),sound.event=new Audio(cdnZWStaticPath+fingerPrintObj["sound/event.wav"]),sound.phonering=new Audio(cdnZWStaticPath+fingerPrintObj["sound/phonering.wav"]),sound.shaker=new Audio(cdnZWStaticPath+fingerPrintObj["sound/shaker.wav"]),sound.techno=new Audio(cdnZWStaticPath+fingerPrintObj["sound/techno.wav"]),sound.xylo=new Audio(cdnZWStaticPath+fingerPrintObj["sound/xylo.wav"]));var e=J("#sound_list option:selected").val();window.sound[e].play()},Settings.prototype.getLanguageFullString=function(e){return this.LANG_CODE_TO_FULLSTR[e]||""},Settings.prototype.isSupportedLanguage=function(e){return this.LANG_CODE_TO_FULLSTR.hasOwnProperty(e)},Settings.prototype.getAllSupportedLanguages=function(){var e=[];for(var t in this.LANG_CODE_TO_FULLSTR)e.push(this.LANG_CODE_TO_FULLSTR[t]);return e},Settings.prototype.changeLanguage=function(){var e=editor.iamServerURL+"/u/h#profile/personal";Utils.safeWindowOpen(e)},Settings.prototype.updateDisplayLanguage=function(){var e,t=Settings.isSupportedLanguage(editor.lang);t?(e=editor.lang,J("#set-display-lang-infomsg").hide()):(e=this.DEFAULT_LANGUAGE,J("#set-display-lang-infomsg").show());var i=Settings.getLanguageFullString(e);J("#set-display-lang").text(i),null==Settings.supportedLangStr&&(Settings.supportedLangStr=Settings.getAllSupportedLanguages().join(", ")),J("#set-supt-display-lang").text(Settings.supportedLangStr)},Settings.prototype.onLanguageChange=function(e){var t="MM/DD/YYYY";"locale"===e?J("#setting_date_comboContainer").disable():J("#setting_date_comboContainer").enable();var i=ZWDate.getLocaleSupportedFormats(e);Settings.updateDateFmtOptions(e,i);var n=ZWDateTime.migrateMomentToIntlFormat(w_usersettings[ATTR_BODY.DS_DATEFORMAT]||w_usersettings[ATTR_BODY.DS_AUTODATEFORMAT],e),o=i.contains(n||"")?n:i.contains(t)?t:i[0];Settings.DateFmt=o,J("#setting_date_combo").zselectbox("setValue",o),Settings.updateFormatPreview(e,o)},Settings.prototype.updateDateFmtOptions=function(e,t){var i=DocLocaleHandler.getLanguageDetails(e),n=i.timezones&&i.timezones.length?i.timezones[0]:ZWDateTime.CONSTANTS.DEFAULT_TIMEZONE,o={input:{locale:e,timezone:n}};DomUtil.populateFormatOptions(J("#setting_date_combo"),o,"input")},Settings.prototype.updateFormatPreview=function(e,t){var i=DocLocaleHandler.getCurrencyCode(e),n=Formula.getSymbolAndFormat({code:e,currencyCode:i})||{};document.getElementById("settings-dlg-time").innerHTML=ZWDate.getLocaleValue(e,t),document.getElementById("settings-dlg-number").innerHTML=n.format||"-",document.getElementById("settings-dlg-currency").innerHTML=n.symbol||"-"};var isAnyWqConfEnabled=function(){return"true"===w_usersettings[ATTR_BODY.WQ_WORDYPHRASES].toString()||"true"===w_usersettings[ATTR_BODY.WQ_REPHRASABLESENTENCES].toString()||"true"===w_usersettings[ATTR_BODY.WQ_IMPROPERWORDCHOICES].toString()||"true"===w_usersettings[ATTR_BODY.WQ_INFORMALWRITING].toString()||"true"===w_usersettings[ATTR_BODY.WQ_NONINCLUSIVELANGUAGE].toString()},changeWritingQualityTypesValue=function(e){J("#settings-wq-wordyphrases").zstatebutton("checked",e),J("#settings-wq-rephrasablesentences").zstatebutton("checked",e),J("#settings-wq-improperwordchoices").zstatebutton("checked",e),J("#settings-wq-informalwriting").zstatebutton("checked",e),J("#settings-wq-noninclusive").zstatebutton("checked",e),Settings.wordyPhrases=e,Settings.rephrasableSentences=e,Settings.improperWordChoices=e,Settings.informalWriting=e,Settings.nonInclusive=e},canCheckWritingQuality=function(){Settings.wordyPhrases||Settings.rephrasableSentences||Settings.improperWordChoices||Settings.informalWriting||Settings.nonInclusive?(Settings.enableWq=!0,J("#settings-wq").zstatebutton("checked",!0)):(Settings.enableWq=!1,J("#settings-wq").zstatebutton("checked",!1))};Settings.prototype.updateSpellcheckOptions=function(e,t){var i=["#settings-sp-upper","#settings-sp-mixedcase","#settings-sp-numbered"],n=t||Settings,o=e?"enable":"disable";J("#settings-sp-upper").zstatebutton("checked",n.ignoreUppercase),J("#settings-sp-numbered").zstatebutton("checked",n.ignoreNumbered),J("#settings-sp-mixedcase").zstatebutton("checked",n.ignoreMixedcase);for(var r=0,a=i.length;r<a;r++)J(i[r]).zstatebutton(o)},Settings.prototype.updateWritingQualityOptions=function(e,t){var i=["#settings-wq-wordyphrases","#settings-wq-rephrasablesentences","#settings-wq-improperwordchoices","#settings-wq-informalwriting","#settings-wq-noninclusive"],n=t||Settings,o=e?"enable":"disable";J("#settings-wq-wordyphrases").zstatebutton("checked",n.wordyPhrases),J("#settings-wq-rephrasablesentences").zstatebutton("checked",n.rephrasableSentences),J("#settings-wq-improperwordchoices").zstatebutton("checked",n.improperWordChoices),J("#settings-wq-informalwriting").zstatebutton("checked",n.informalWriting),J("#settings-wq-noninclusive").zstatebutton("checked",n.nonInclusive);for(var r=0,a=i.length;r<a;r++)J(i[r]).zstatebutton(o)},Settings.prototype.updateProofingOptions=function(e,t,i){var n=e?e.sp:Settings.enableSp,o=e?e.grm:Settings.enableGrm;e?e.wq:Settings.enableWq;n?(J("#settings-grm").zstatebutton("enable"),J("#settings-grm").zstatebutton("checked",o)):(o&&J("#settings-grm").zstatebutton("checked",!1),J("#settings-grm").zstatebutton("disable")),this.updateSpellcheckOptions(n,t),this.updateWritingQualitySettings(e,i)},Settings.prototype.updateWritingQualitySettings=function(e,t){var i=e?e.sp:Settings.enableSp,n=e?e.grm:Settings.enableGrm,o=isAnyWqConfEnabled();i&&n?(J("#settings-wq").zstatebutton("enable"),J("#settings-wq").zstatebutton("checked",o)):(J("#settings-wq").zstatebutton("checked",!1),J("#settings-wq").zstatebutton("disable")),this.updateWritingQualityOptions(i&&n,t)},Settings=new Settings,Settings.supportedLangStr=null,Settings.DEFAULT_LANGUAGE="en",Settings.LANG_CODE_TO_FULLSTR={en:"English",fr:"Français",ja:"日本語",zh:"中文",de:"Deutsch",nl:"Nederlands",it:"italiano",sv:"svenska",es:"español",pt:"português",da:"dansk",tr:"Türkçe",pl:"polski",ru:"русский",hu:"magyar",hr:"hrvatski",cs:"čeština",et:"eesti keel",fi:"suomen kieli",el:"Ελληνικά",ko:"한국어",lt:"lietuvių kalba",no:"Norsk",ro:"limba română",sk:"slovenčina",th:"ไทย",uk:"Українська",vi:"Tiếng Việt",ta:"தமிழ்"},ShowInfo.isExtensionInstalled=!1,ShowInfo.attentionMsg=function(e){var t,i;e instanceof Array?(t=e[1],i=e[0]):i=e;var n=Utils.contextMenuSupportedBrowser(),o=UIUtils.extensionSupportedBrowser();if((window.self!==window.top||Macros.isRemote()||editorProps.options.CNAME_ENABLED)&&"paste"==i){var r=editor.browserInfo.is_mac?"Cmd":"Ctrl";return void UIUtils.showMessagePopup(J.i18n("writer.common.CUT_COPY_PASTE",[r,"V",J.i18n("writer.common.PASTE")]),J.i18n("writer.common.JUST_LETTING_YOU_KNOW_TITLE_MSG"),"warning")}if("paste"==i&&o&&n)document.dispatchEvent(new CustomEvent("zwextension/isinstalled")),ShowInfo.isExtensionInstalled?(PasteEventHandler.prePasteProcess(!1,t),document.dispatchEvent(new CustomEvent("zwextension/paste"))):UIUtils.showZohoWriterWebAppInstalDlg();else if(!n||!o&&"paste"==i){var r=editor.browserInfo.is_mac?"Cmd":"Ctrl";return void("cut"==i?UIUtils.showMessagePopup(J.i18n("writer.common.CUT_COPY_PASTE",[r,"X",J.i18n("writer.common.CUT")]),J.i18n("writer.common.JUST_LETTING_YOU_KNOW_TITLE_MSG"),"warning"):"copy"==i?UIUtils.showMessagePopup(J.i18n("writer.common.CUT_COPY_PASTE",[r,"C",J.i18n("writer.common.COPY")]),J.i18n("writer.common.JUST_LETTING_YOU_KNOW_TITLE_MSG"),"warning"):"paste"==i&&UIUtils.showMessagePopup(J.i18n("writer.common.CUT_COPY_PASTE",[r,"V",J.i18n("writer.common.PASTE")]),J.i18n("writer.common.JUST_LETTING_YOU_KNOW_TITLE_MSG"),"warning"))}"cut"==i&&CopyEventHandler.triggerCutEvent(),"copy"==i&&CopyEventHandler.triggerCopyEvent()},document.addEventListener("isWriterExtensionInstalled",function(){ShowInfo.isExtensionInstalled=!0});var isParaResize,mouseDownPos={},isLeftSpaceResize=!1,isRightSpaceResize=!1,isTopSpaceResize=!1,isBottomSpaceResize=!1,Jpara;ParagraphPanel.init=function(){var e=J("#subpanel-para");e.find(":checkbox").on("click",function(e,t){var i=J(e.target);ToolbarHandler.handleUIEvents(i,t)})},ParagraphPanel.open=function(e){var t=e&&e.tabToSelect?1:0;ParagraphPanel.attr={},ParagraphPanel.newAttr={},ZWLogger.addToStatistics("ParaOptions");var i=J("#fmt-sub-pnl-layout"),n=J("#fmt-lpnl-borderoptions");i.data("ZCtrackObjects")?(i.ZCtrackObjects("refreshValues"),n.ZCtrackObjects("refreshValues")):(i.ZCtrackObjects({callbacks:ParagraphPanel.info,fillVisible:!1,eventNameMapping:{zlabeledselectbox:"zlabeledselectboxchange"}}),n.ZCtrackObjects({callbacks:ParaBorders.panelInfo,fillVisible:!1})),J("#fmt-sub-pnl-paraoptions").ztabpanel("openTab",t);var o=editor.doc.getSelection(),r=DocLayoutManager.getPageWidthAtIdx(o.getStart());ParagraphPanel.delta=r/(J(".ui-spacingind-preview").outerWidth()-10),ParagraphPanel.updatePreview();var a={panelId:ELEM_ID.PARAGRAPHOPTIONPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[ELEM_ID.FORMATPANEL]};LeftPanel.showAdvancedPanel(a),PubSub.subscribe("BeforePanelClose",ParagraphPanel.handleClose),PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected"],ParagraphPanel.refreshValues,{async:!0,timeout:300}),PubSub.subscribe(["Cursor/ParaChanged","Cursor/Selected"],ParagraphPanel.handleCursorParaChange,{async:!0,timeout:100}),PubSub.subscribe("Document/UndoRedo",ParagraphPanel.refreshBorderValues,{async:!0,timeout:300})},ParagraphPanel.handleCursorParaChange=function(){PanelUtil.activeLeftPanelSpinner=null;var e=editor.doc.getSelection();e.selectionType!==SEL_AUTO_GEN&&e.selectionType!==SEL_OP_GEN&&ParagraphPanel.refreshBorderValues()},ParagraphPanel.refreshValues=function(){if((!PanelUtil.activeLeftPanelSpinner||!/BEF_PARA|AF_PARA|LINE_SP|LEFT|RIGHT|FIRST_HANG|FIRSTLINE|HANGING/.test(PanelUtil.activeLeftPanelSpinner))&&LeftPanel.isPanelVisible(ELEM_ID.PARAGRAPHOPTIONPANEL)){var e=J(Z("fmt-sub-pnl-paraoptions").ztabpanel("getAttribute","activeTab")).children().attr("href");"#fmt-sub-pnl-layout"==e&&J("#fmt-sub-pnl-layout").ZCtrackObjects("refreshValues")}},ParagraphPanel.refreshBorderValues=function(){J("#fmt-lpnl-borderoptions").ZCtrackObjects("refreshValues")},ParagraphPanel.handleClose=function(e){"subpanel-para"==e&&(PubSub.unsubscribe("BeforePanelClose",ParagraphPanel.handleClose),PubSub.unsubscribe(["Cursor/Collapsed","Cursor/Selected"],ParagraphPanel.refreshValues,{async:!0,timeout:500}),PubSub.unsubscribe("Cursor/ParaChanged",ParagraphPanel.refreshBorderValues,{async:!0,timeout:100}),PubSub.unsubscribe("Document/UndoRedo",ParagraphPanel.refreshBorderValues,{async:!0,timeout:800}))},ParagraphPanel.info={set:function(e,t,i){arguments[5].keyCode&&arguments[5].keyCode==KEYS.TAB?EventHandler.isDialogFocused=!0:EventHandler.isDialogFocused=!1,e.action&&/BEF_PARA|AF_PARA|LINE_SP|LEFT|RIGHT|FIRST_HANG|FIRSTLINE|HANGING/.test(e.action)&&PanelUtil.setActiveLeftPanelSpinner(e.action);var n=Conversions.step;if("WID_ORPHAN"==e.action||"PARA_BREAK"==e.action||"PAGE_BREAK"==e.action?(J("#line_space_prev").hide(),J("#page_break_prev").show()):(J("#line_space_prev").show(),J("#page_break_prev").hide()),"BEF_PARA"==e.action)ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_SB]=parseFloat(t);else if("WID_ORPHAN"===e.action)ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_WO]=t;else if("KEEP_NEXT"===e.action)ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_KN]=t;else if("PARA_BREAK"===e.action)ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_BL]=t;else if("PAGE_BREAK"===e.action)ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_PB]=t;else if("AF_PARA"==e.action)ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_SA]=parseFloat(t);else if("WORD_SP"==e.action)ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_WS]=parseFloat(t);else if("LINE_SP"==e.action)"Multiple"===t?J("#custom_line_space").znumberfield("enable"):(ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LS]=parseFloat(t),ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LINE_RULE]="auto",J("#custom_line_space").znumberfield("disable"));else if("CUSTOM_LINE_SPACE"===e.action){ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LINE_RULE]="auto";var o=Z("custom_linespace_input"),r=3;if("atLeast"==t||"exact"==t){ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LINE_RULE]=t,J(o).zlabelednumberfield("setValue","12");var a=DocLayoutManager.getLineAtIndex(editor.doc.getSelection().getStart()),s=a?a.height+"px":"16px";r=s.convertor().points,J(o).zlabelednumberfield("setAttributes",{decimals:"2",min:0,max:1584,step:"1",suffix:"pt"}),J("#custom_linespace_input").zlabelednumberfield("getElement").find("input").focus(),ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LS]=r}else"multiple"==t?(r=r.toFixed(3),J(o).zlabelednumberfield("setValue","3"),J(o).zlabelednumberfield("setAttributes",{decimals:"2",min:0,max:132,step:"0.1",suffix:""}),J("#custom_linespace_input").zlabelednumberfield("getElement").find("input").focus(),ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LS]=r):(J(o).zlabelednumberfield("setAttributes",{decimals:"0",min:0,max:132,step:"0.1",suffix:""}),r=parseFloat(t).toFixed(3),ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LS]=r)}else if("CUSTOM_LINE_SPACE_INPUT"===e.action){var l=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LINE_RULE];l&&"auto"!=l||(t=t.toFixed(3)),ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LS]=t}else{if("CHAR_SPACE"===e.action)return void editor.doc.execCmd("CharSpacing",t);if("LEFT"==e.action)J(i).zlabelednumberfield("setAttribute","step",n),ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_ML]=parseFloat(t);else if("RIGHT"==e.action)J(i).zlabelednumberfield("setAttribute","step",n),ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_MR]=parseFloat(t);else if("FIRST_HANG"==e.action||"FIRSTLINE"==e.action||"HANGING"==e.action){"FIRST_HANG"!=e.action&&(ParagraphPanel.newAttr.type="FIRSTLINE"==e.action?"1":"2");var t=Z("spinner4").znumberfield("getAttribute","value");if(("FIRSTLINE"==e.action||"HANGING"==e.action)&&0==t)return;Z("spinner4").znumberfield("setAttribute","step",n),ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_TI]=parseFloat(t);var d=ParagraphPanel.newAttr.type;"2"==d?(ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_PL]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_TI],ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_TI]=-ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_TI]):"1"==d&&(ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_TI]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_TI],ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_PL]=0)}}ParagraphPanel.applyValues()},get:function(e,t){e=e.action;var i=editor.doc.getSelection(),n=DocLayoutManager.getCurrentSection(),o=i.getNodesInSelection(NODE_TYPE.PARAGRAPH)[0],r=J(editor.clientActiveSection),a=r.hasClass("header_primary"),s=r.hasClass("footer_primary");(a||s)&&(J("#linesAndBreaking").attr("disabled","disabled").css("opacity",".22"),J("#preview").css("opacity",".22"));var l,d,c,u,p=DocUtil.getParaFormat(o.getEnd()-1);if("BEF_PARA"==e){var g=0;return p[ATTR_PARAGRAPH.PS_SB]&&(g=parseFloat(p[ATTR_PARAGRAPH.PS_SB])),ParagraphPanel.attr[ATTR_PARAGRAPH.PS_SB]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_SB]=g,g}if("WID_ORPHAN"===e){var f=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_WO]=p[ATTR_PARAGRAPH.EN_WO];return f=f||!1,ParagraphPanel.updatePreview(),f}if("KEEP_NEXT"===e){var f=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_KN]=p[ATTR_PARAGRAPH.EN_KN];return f=f||!1,ParagraphPanel.updatePreview(),f}if("PARA_BREAK"===e){var f=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_BL]=p[ATTR_PARAGRAPH.EN_BL];return f=f||!1,ParagraphPanel.updatePreview(),f}if("PAGE_BREAK"===e){var f=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_PB]=p[ATTR_PARAGRAPH.EN_PB];return f=f||!1,ParagraphPanel.updatePreview(),f}if("AF_PARA"==e){var E=0;return p[ATTR_PARAGRAPH.PS_SA]&&(E=parseFloat(p[ATTR_PARAGRAPH.PS_SA])),ParagraphPanel.attr[ATTR_PARAGRAPH.PS_SA]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_SA]=E,E}if("WORD_SP"==e){var T=0;return p[ATTR_PARAGRAPH.PS_WS]&&(T=parseFloat(p[ATTR_PARAGRAPH.PS_WS])),ParagraphPanel.attr[ATTR_PARAGRAPH.PS_WS]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_WS]=T,T}if("LINE_SP"==e){var m=1.2;return p[ATTR_PARAGRAPH.PS_LS]&&(m=parseFloat(p[ATTR_PARAGRAPH.PS_LS])),ParagraphPanel.attr[ATTR_PARAGRAPH.PS_LS]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LS]=m,1!==m&&1.2!==m&&1.5!==m&&2!==m&&(J("#custom_line_space").znumberfield("enable"),m="Multiple"),m}if("CUSTOM_LINE_SPACE"===e){var h=m=1.2;p[ATTR_PARAGRAPH.PS_LS]&&(m=h=parseFloat(p[ATTR_PARAGRAPH.PS_LS]));var I=p[ATTR_PARAGRAPH.PS_LINE_RULE]?p[ATTR_PARAGRAPH.PS_LINE_RULE]:"auto",_=[1,1.2,1.5,2];return"atLeast"==I||"exact"==I?h=I:"auto"!=I||_.contains(m)||(h="multiple"),ParagraphPanel.attr[ATTR_PARAGRAPH.PS_LINE_RULE]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LINE_RULE]=I,ParagraphPanel.attr[ATTR_PARAGRAPH.PS_LS]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LS]=m,h}if("CUSTOM_LINE_SPACE_INPUT"===e){p[ATTR_PARAGRAPH.PS_LS]&&(m=h=parseFloat(p[ATTR_PARAGRAPH.PS_LS]));var _=[1,1.2,1.5,2],I=p[ATTR_PARAGRAPH.PS_LINE_RULE]?p[ATTR_PARAGRAPH.PS_LINE_RULE]:"auto",A=Z("custom_linespace_input");return"auto"==I?J(A).zlabelednumberfield("setAttributes",{decimals:"2",min:0,max:132,step:"0.1",suffix:""}):J(A).zlabelednumberfield("setAttributes",{decimals:"0",min:0,max:1584,step:"1",suffix:"pt"}),m}if("CHAR_SPACE"==e){var S=editor.doc.getSelection().getTextFormat();return S[ATTR_TEXT.TS_CS]||"none"}if("LEFT"==e){l=-parseFloat(Conversions.toGlobalValue(n.getLeft()+"px")).toFixed(3);var R,O,b,v=DocLayoutManager.getContentWidthAtIndex(i.getStart());R=Conversions.toPixels(p[ATTR_PARAGRAPH.PS_MR]),void 0==R&&(R=0),O=Conversions.globalUnitInPx,b=Conversions.toGlobalValue(v-R-O+"px"),d=Conversions.toGlobalUnit(b),u=Conversions.step,l-=l%u,d-=d%u,c=Conversions.showUnit;var D=0;p[ATTR_PARAGRAPH.PS_ML]&&(D=Conversions.toGlobalUnit(p[ATTR_PARAGRAPH.PS_ML]),0==D&&(D="0")),ParagraphPanel.attr[ATTR_PARAGRAPH.PS_ML]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_ML]=D;var L="mm"==Conversions.globalUnit?"0":"3";return J(t).zlabelednumberfield("setAttribute","min",l),J(t).zlabelednumberfield("setAttribute","max",d),J(t).zlabelednumberfield("setAttribute","step",u),J(t).zlabelednumberfield("setAttribute","suffix",c),J(t).zlabelednumberfield("setAttribute","decimalPlaces",L),D}if("RIGHT"==e){l=-parseFloat(Conversions.toGlobalValue(n.getRight()+"px")).toFixed(3);var N=Conversions.toGlobalUnit(Conversions.toGlobalValue(DocLayoutManager.getContentWidthAtIndex(i.getStart())+"px")),P=Conversions.toGlobalUnit(p[ATTR_PARAGRAPH.PS_ML])||0;p[ATTR_PARAGRAPH.PS_PL]&&(P+=Conversions.toGlobalUnit(p[ATTR_PARAGRAPH.PS_PL])),p[ATTR_PARAGRAPH.PS_TI]&&(P+=Conversions.toGlobalUnit(p[ATTR_PARAGRAPH.PS_TI])),d=N-P-Conversions.toGlobalUnit("1in"),u=Conversions.step,l-=l%u,c=Conversions.showUnit;var C=0;p[ATTR_PARAGRAPH.PS_MR]&&(C=Conversions.toGlobalUnit(p[ATTR_PARAGRAPH.PS_MR]),0==C&&(C="0"));var L="mm"==Conversions.globalUnit?"0":"3";return J(t).zlabelednumberfield("setAttribute","step",u),J(t).zlabelednumberfield("setAttribute","min",l),J(t).zlabelednumberfield("setAttribute","max",d),J(t).zlabelednumberfield("setAttribute","suffix",c),J(t).zlabelednumberfield("setAttribute","decimalPlaces",L),ParagraphPanel.attr[ATTR_PARAGRAPH.PS_MR]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_MR]=C,C}if("FIRSTLINE"==e){var y=0;return p[ATTR_PARAGRAPH.PS_TI]?(y=parseFloat(p[ATTR_PARAGRAPH.PS_TI]),0==y.toString().indexOf("-")||0==y&&J("#para_hanging").prop("checked")?(ParagraphPanel.attr.type=ParagraphPanel.newAttr.type="2","off"):(ParagraphPanel.attr.type=ParagraphPanel.newAttr.type="1","on")):"on"}if("HANGING"==e){var y=0;return p[ATTR_PARAGRAPH.PS_TI]?(y=parseFloat(p[ATTR_PARAGRAPH.PS_TI]),0==y.toString().indexOf("-")||0==y&&!J("#para_firstline").prop("checked")?(ParagraphPanel.attr.type=ParagraphPanel.newAttr.type="2","on"):(ParagraphPanel.attr.type=ParagraphPanel.newAttr.type="1","off")):"off"}if("FIRST_HANG"==e){var y="0";l=0;var R,O,v,b;v=DocLayoutManager.getContentWidthAtIndex(i.getStart()),R=Conversions.toPixels(p[ATTR_PARAGRAPH.PS_MR]),void 0==R&&(R=0),O=Conversions.globalUnitInPx,b=Conversions.toGlobalValue(v-R-O+"px"),d=Conversions.toGlobalUnit(b),u=Conversions.step,d-=d%u,c=Conversions.showUnit,p[ATTR_PARAGRAPH.PS_TI]&&(y=Conversions.toGlobalUnit(p[ATTR_PARAGRAPH.PS_TI]),0==y&&(y="0")),ParagraphPanel.attr[ATTR_PARAGRAPH.PS_TI]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_TI]=y,0==y.toString().indexOf("-")&&(y=y.toString().substring(1));var L="mm"==Conversions.globalUnit?"0":"3";return J(t).znumberfield("setAttribute","min",l),J(t).znumberfield("setAttribute","max",d),J(t).znumberfield("setAttribute","step",u),J(t).znumberfield("setAttribute","suffix",c),J(t).znumberfield("setAttribute","decimalPlaces",L),y}return e}},ParagraphPanel.updatePreview=function(e){var t=DocUtil.copyStyle(ParagraphPanel.newAttr);for(var i in t)if(i==ATTR_PARAGRAPH.PS_ML||i==ATTR_PARAGRAPH.PS_MR){var n=parseFloat(t[i])/ParagraphPanel.delta+Conversions.globalUnit;t[i]=n}else if(i==ATTR_PARAGRAPH.PS_TI){var o=parseFloat(t[ATTR_PARAGRAPH.PS_TI])/ParagraphPanel.delta;o+=Conversions.globalUnit,t[i]=o}else i!=ATTR_PARAGRAPH.PS_SB&&i!=ATTR_PARAGRAPH.PS_SA&&i!=ATTR_PARAGRAPH.PS_WS||(t[i]=parseFloat(t[i])/2);ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_WO]&&(J(".wopara,.pbpara").show(),J(".normal,.nbpara").hide()),ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_BL]&&(J(".pbpara,.nbpara").show(),J(".normal,.wopara").hide()),ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_PB]&&(J(".nbpara,.pbpara").show(),J(".normal,.wopara").hide()),ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_WO]||ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_BL]||ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_PB]||(J(".normal,.pbpara").show(),J(".wopara,.bpara,.nbpara").hide()),DomUtil.setParaStyle(J("#previewpara")[0],t)},ParagraphPanel.applyValues=function(){if(!ZWJSONUtils.compareJSON(ParagraphPanel.attr,ParagraphPanel.newAttr)){var e={};e[ATTR_PARAGRAPH.PS_SB]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_SB]+"pt",e[ATTR_PARAGRAPH.PS_SA]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_SA]+"pt",e[ATTR_PARAGRAPH.PS_LS]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LS],e[ATTR_PARAGRAPH.PS_LINE_RULE]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_LINE_RULE],e[ATTR_PARAGRAPH.PS_ML]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_ML]+Conversions.globalUnit,e[ATTR_PARAGRAPH.PS_MR]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_MR]+Conversions.globalUnit,e[ATTR_PARAGRAPH.PS_TI]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_TI]+Conversions.globalUnit,void 0!=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_PB]?e[ATTR_PARAGRAPH.EN_PB]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_PB]:void 0==J("#enPageBreak").attr("checked")?e[ATTR_PARAGRAPH.EN_PB]=!1:e[ATTR_PARAGRAPH.EN_PB]=!0,void 0!=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_BL]?e[ATTR_PARAGRAPH.EN_BL]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_BL]:void 0==J("#enKeepLines").attr("checked")?e[ATTR_PARAGRAPH.EN_BL]=!1:e[ATTR_PARAGRAPH.EN_BL]=!0,void 0!=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_WO]?e[ATTR_PARAGRAPH.EN_WO]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_WO]:void 0==J("#enablewidoworphan").attr("checked")?e[ATTR_PARAGRAPH.EN_WO]=!1:e[ATTR_PARAGRAPH.EN_WO]=!0,void 0!=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_KN]?e[ATTR_PARAGRAPH.EN_KN]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.EN_KN]:void 0==J("#enKeepNext").attr("checked")?e[ATTR_PARAGRAPH.EN_KN]=!1:e[ATTR_PARAGRAPH.EN_KN]=!0,void 0!=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_PL]&&(e[ATTR_PARAGRAPH.PS_PL]=ParagraphPanel.newAttr[ATTR_PARAGRAPH.PS_PL]+Conversions.globalUnit),editor.doc.execCmd("applyLineSpacing",e)}},ParagraphPanel.updateMenu=function(e,t){var i=J("#fmt-lpnl-linespacemenu"),n=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH)[0],o=DocUtil.getParaFormat(n.getEnd()-1),r=o[ATTR_PARAGRAPH.PS_SA],a=o[ATTR_PARAGRAPH.PS_SB],s="1.2",l=[],d=[],c=DocumentDesign.getStyles().para;if(J("#lnSpcustom_linespacing").hide(),parseInt(r)?(l.push("fmt-lpnl-addspace-after-para"),d.push("fmt-lpnl-removespace-after-para")):(l.push("fmt-lpnl-removespace-after-para"),d.push("fmt-lpnl-addspace-after-para")),parseInt(a)?(l.push("fmt-lpnl-addspace-before-para"),d.push("fmt-lpnl-removespace-before-para")):(l.push("fmt-lpnl-removespace-before-para"),d.push("fmt-lpnl-addspace-before-para")),i.zmenu("hideMenuItems",l),i.zmenu("showMenuItems",d),c=DocUtil.getComputedParaStyles(n.getEnd()-1,c),i.zmenu("setMenuItemsAttribute",[J("#lnSpcustom_linespacing")],"hidden",!0),o&&o[ATTR_PARAGRAPH.PS_LS]?s=parseFloat(o[ATTR_PARAGRAPH.PS_LS]):c.h0[ATTR_BODY.DS_LS]&&(s=parseFloat(c.h0[ATTR_BODY.DS_LS])),1.2==s)s="1_2";else if(1.5==s)s="1_5";else if(1==s||2==s)s=parseInt(s);else{var u=o[ATTR_PARAGRAPH.PS_LINE_RULE]?o[ATTR_PARAGRAPH.PS_LINE_RULE]:"auto";u="exact"==u?"pt ("+J.i18n("writer.common.EXACT")+")":"atLeast"==u?"pt ("+J.i18n("writer.common.ATLEAST")+")":" ("+J.i18n("writer.common.CUSTOM")+")",i.zmenu("setMenuItemsAttribute",[J("#lnSpcustom_linespacing")],"hidden",!1),i.zmenu("setMenuItemsAttribute",[J("#lnSpcustom_linespacing")],"label",s+u),s="custom_linespacing"}i.zmenu("check","lnSp"+s);var p="charspace",g=editor.doc.getSelection().getTextFormat();g&&g[ATTR_TEXT.TS_CS]&&(p=parseFloat(g[ATTR_TEXT.TS_CS]));var f="charspace"+p,E=J("#"+f);i.zmenu("setMenuItemsAttribute",[E[0]?E:J("#charspace")],"checked",!0)},ParagraphPanel.mouseDown=function(e){if(mouseDownPos.x=e.clientX,mouseDownPos.y=e.clientY,isParaResize&&(ParagraphPanel.isParaSpaceInProgress=!0),ParagraphPanel.isParaSpaceInProgress){var t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,editor.doc.getSelection().getStart());return Jpara=DomViewManager.getAllDomForNode(t.dtNode),isLeftSpaceResize?J(document.createElement("div")).attr("id","paraReLine").css({height:J(Jpara[0]).height(),position:"absolute",width:"2px","border-left":"1px solid #5fabf2","z-index":10,top:PUtil.offsetTop(Jpara[0]),left:PUtil.offsetLeft(Jpara[0]),"pointer-events":"none","-moz-user-select":"none"}).appendTo(J("#editorpane")[0]):isRightSpaceResize?J(document.createElement("div")).attr("id","paraReLine").css({height:J(Jpara[0]).height(),position:"absolute",width:"2px","border-left":"1px solid #5fabf2","z-index":10,top:PUtil.offsetTop(Jpara[0]),left:PUtil.offsetLeft(Jpara[0])+J(Jpara).width(),"pointer-events":"none","-moz-user-select":"none"}).appendTo(J("#editorpane")[0]):isTopSpaceResize?J(document.createElement("div")).attr("id","paraReLine").css({height:"2px",position:"absolute",width:J(Jpara[0]).width(),"border-top":"1px solid #5fabf2","z-index":10,top:PUtil.offsetTop(Jpara[0]),left:PUtil.offsetLeft(Jpara[0]),"pointer-events":"none","-moz-user-select":"none"}).appendTo(J("#editorpane")[0]):isBottomSpaceResize&&J(document.createElement("div")).attr("id","paraReLine").css({height:"2px",position:"absolute",width:J(Jpara[0]).width(),"border-top":"1px solid #5fabf2","z-index":10,top:PUtil.offsetTop(Jpara[0])+J(Jpara).height(),left:PUtil.offsetLeft(Jpara[0]),"pointer-events":"none","-moz-user-select":"none"}).appendTo(J("#editorpane")[0]),!1}},ParagraphPanel.mouseMove=function(e){var t=e.target,i=e.clientX,n=e.clientY,o=editor.jeditorPane,r=o.offset().left,a=o.offset().top;J(t).is(".zw-paragraph")?para=t:para=J(t).parents(".zw-paragraph").get(0);var s=J(para).offset();if(para&&i>s.left-10&&i<s.left+10?(J(para).css("cursor","col-resize"),isParaResize=!0,isLeftSpaceResize=!0,isRightSpaceResize=!1):para&&i>s.left+J(para).width()-10&&para&&i<s.left+J(para).width()+10?(J(para).css("cursor","col-resize"),isParaResize=!0,isRightSpaceResize=!0,isLeftSpaceResize=!1):para&&n<s.top+5&&n>s.top-5?(J(para).css("cursor","row-resize"),isParaResize=!0,isTopSpaceResize=!0,isBottomSpaceResize=!1,isRightSpaceResize=!1,isLeftSpaceResize=!1):para&&n<s.top+J(para).height()+5&&n>s.top+J(para).height()-5?(J(para).css("cursor","row-resize"),isParaResize=!0,isBottomSpaceResize=!0,isTopSpaceResize=!1,isRightSpaceResize=!1,isLeftSpaceResize=!1):(J(para).css("cursor","auto"),isParaResize=!1),ParagraphPanel.isParaSpaceInProgress){var l=J(Jpara).find(".zw-line-content").offset();isLeftSpaceResize&&i<l.left?J("#paraReLine").css("left",e.clientX-r):isRightSpaceResize&&i>l.left?J("#paraReLine").css("left",e.clientX-r):isTopSpaceResize&&n<l.top?J("#paraReLine").css("top",e.clientY-a):isBottomSpaceResize&&n>l.top&&J("#paraReLine").css("top",e.clientY-a)}return!1},ParagraphPanel.mouseUp=function(e){if(ParagraphPanel.isParaSpaceInProgress){ParagraphPanel.isParaSpaceInProgress=!1;var t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,editor.doc.getSelection().getStart()),i=t.attr().borders;if(isLeftSpaceResize){var n=mouseDownPos.x-e.clientX;i["border-left"].space=parseInt(i["border-left"].space)+n+"px"}if(isRightSpaceResize){var n=e.clientX-mouseDownPos.x;i["border-right"].space=parseInt(i["border-right"].space)+n+"px"}if(isTopSpaceResize){var n=mouseDownPos.y-e.clientY;i["border-top"].space=parseInt(i["border-top"].space)+n+"px"}if(isBottomSpaceResize){var n=e.clientY-mouseDownPos.y;i["border-bottom"].space=parseInt(i["border-bottom"].space)+n+"px"}J("#editorpane").find("#paraReLine").remove(),editor.doc.execCmd("applyStyle",[t,{borders:i},"applyParaStyle"]);var o=editor.doc.getSelection(),r=o.getStart(),a=o.getEnd(),s=editor.doc.createRange(r,a).setFocus(!1);o.removeAllRanges().addRange(s)}return!1},ConvertTextToTable=function(){var e={get:function(e,t){return"COLUMNS"==e.action?ConvertTextToTable.noOfCols:"ROWS"==e.action?ConvertTextToTable.noOfRows:"DELIMITER"==e.action?ConvertTextToTable.getCurrentDelimStr():"OTHER_DELIM"==e.action?"-":void 0},set:function(e,t,o){if("COLUMNS"==e.action){var r=63,a=1;t>r||t<a?(J("#errmsg_table").show().html(UIUtils.getErrorMsg("error",J.i18n("writer.table.ENTER_PROPER_VAL"))),J("#convertTextToTableBtn").disable()):(J("#errmsg_table").hide(),J("#convertTextToTableBtn").enable(),ConvertTextToTable.noOfCols=t,ConvertTextToTable.noOfRows=ConvertTextToTable.getRowCountFromColsCount(ConvertTextToTable.noOfCols),J("#rowCount").val(ConvertTextToTable.noOfRows))}else"DELIMITER"==e.action?(t=J(o).attr("value"),ConvertTextToTable.delim=n(t),""!=ConvertTextToTable.delim&&i(ConvertTextToTable.delim)):"OTHER_DELIM"==e.action&&J("#delim_other").attr("checked")&&""!=t&&(ConvertTextToTable.delim=t,i(ConvertTextToTable.delim))}},t=function(){ConvertTextToTable.initialRows=1,ConvertTextToTable.initialCols=1,ConvertTextToTable.noOfRows=ConvertTextToTable.noOfCols=1,ConvertTextToTable.delim=UNICODE.PARA,ConvertTextToTable.tableValuesOpsArr=[],ConvertTextToTable.selectedTxt="";var e=editor.doc.getCharAt(editor.doc.getSelection().getEnd()-1)==UNICODE.PARA?editor.doc.getSelection().getEnd()-1:editor.doc.getSelection().getEnd();if(ConvertTextToTable.selectedTxt=editor.doc.getContent(editor.doc.getSelection().getStart(),e),""==ConvertTextToTable.selectedTxt)return void MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,null,J.i18n("writer.table.CONVERT_TO_TABLE_TITLE_MSG"),J.i18n("writer.table.CONVERT_TO_TABLE_MSG"));var t=ConvertTextToTable.initCellCounts(ConvertTextToTable.selectedTxt,ConvertTextToTable.delim);ConvertTextToTable.noOfRows=ConvertTextToTable.initialRows=t.rows,ConvertTextToTable.noOfCols=ConvertTextToTable.initialCols=t.cols,J.dialogutil.open("converttexttotabledlg",J("#ins-lpnl-img"),this.dialogInfo),ZWLogger.addToStatistics("TextToTable")},i=function(e){if(e||(e=J("#delim_other_value").val()),""!=e){ConvertTextToTable.delim=e,J("#convertTextToTablePopup_demlimiter").attr("checked",!0);var t=ConvertTextToTable.initCellCounts(ConvertTextToTable.selectedTxt,e);ConvertTextToTable.noOfRows=ConvertTextToTable.initialRows=t.rows,ConvertTextToTable.noOfCols=ConvertTextToTable.initialCols=t.cols,J("#columnCount").znumberfield("setValue",ConvertTextToTable.noOfCols),J("#rowCount").val(ConvertTextToTable.noOfRows)}},n=function(e){return"PARAGRAPH"==e?UNICODE.PARA:"COMMA"==e?",":"TAB"==e?UNICODE.TAB:"OTHER"==e?J("#delim_other_value").val():void 0},o=function(){return J("#delim_other").attr("checked")&&""==J("#delim_other_value").val()?(UIUtils.showMessagePopup(J.i18n("writer.table.MUST_TYPE_SEPARATOR"),J.i18n("table","MUST_TYPE_SEPARATOR_TITLE_MSG"),"info"),!1):(ConvertTextToTable.tableValuesOpsArr=ConvertTextToTable.getCellValuesOps(ConvertTextToTable.selectedTxt,ConvertTextToTable.noOfRows,ConvertTextToTable.noOfCols,ConvertTextToTable.delim),editor.doc.execCmd("convertTextToTable",[ConvertTextToTable.noOfRows,ConvertTextToTable.noOfCols,ConvertTextToTable.tableValuesOpsArr]),void J.dialogutil.close("converttexttotabledlg"))},r=function(e){var t=ConvertTextToTable.initialRows;if(e<ConvertTextToTable.initialCols){t=0;for(var i=ConvertTextToTable.selectedTxt.split(UNICODE.PARA),n=i.length,o=0;o<n;o++){var r=i[o],a=r.split(ConvertTextToTable.delim),s=a.length;t+=Math.floor(s/e),s%e>0&&t++}}else ConvertTextToTable.delim==UNICODE.PARA&&e>ConvertTextToTable.initialCols&&(t=Math.ceil(ConvertTextToTable.initialRows/e));return t},a=function(){return ConvertTextToTable.delim==UNICODE.PARA?"PARAGRAPH":","==ConvertTextToTable.delim?"COMMA":ConvertTextToTable.delim==UNICODE.TAB?"TAB":"OTHER"},s=function(e,t){var i,n=1,o=e.splitWithIndex(UNICODE.PARA);if(t==UNICODE.PARA)i=o.length;else{i=o.length;for(var r=0;r<o.length;r++){var a=o[r][1],s=a.splitWithIndex(t);s.length>n&&(n=s.length)}}return{rows:i,cols:n}},l=function(e,t,i){if(e!=t){var n=editor.doc.createRange(e,t),o=OpUtil.getInsertionOps(n),r=o.ops;r.shift(),TableUtil.handleSectionOpsArr(o.sectionOps),i.push(r)}else i.push(void 0)},d=function(e,t,i,n,o,r){var a=i.length,s={};s.paraFormat=o;for(var c=0,u=[];c<t;c++)if(i[c]){var p=n+i[c][0],g=p+i[c][1].length;l(p,g,u)}s.cellValuesOpsArr=u,r.push(s),a>t&&d(e,t,i.slice(c),n,o,r)},c=function(e,t,i,n){var o=[],r=e.splitWithIndex(UNICODE.PARA),a=r.length,s={};if(s[ATTR_COMMON.TYPE]=NODE_TYPE.PARAGRAPH,s[ATTR_PARAGRAPH.PS_TS]={},s[ATTR_PARAGRAPH.PS_TS][ATTR_COMMON.TYPE]=NODE_TYPE.TEXT,n==UNICODE.PARA)for(var c=0,u=0;u<t;u++){var p={};p.paraFormat=s;for(var g=[],f=0;f<i&&!(c>=a);f++){var E=editor.doc.getSelection().getStart()+r[c][0],T=E+r[c][1].length;l(E,T,g),c++}p.cellValuesOpsArr=g,o.push(p)}else for(var m=0;m<a;m++){var p={};p.paraFormat=s;var h=r[m][1],I=editor.doc.getSelection().getStart()+r[m][0],_=h.splitWithIndex(n);d(t,i,_,I,s,o)}return o},u=function(){var e=UNICODE.TABLE+"|"+UNICODE.HR+"|"+UNICODE.CELL+"|"+UNICODE.ROW+"|"+UNICODE.TABLEEND+"|"+UNICODE.SECTION_START+"|"+UNICODE.TOCSTART+"|"+UNICODE.TOCEND,t=editor.doc.findNextIndexOf(e,editor.doc.getSelection().getStart());return t!=-1&&t<editor.doc.getSelection().getEnd()};return{canConvert:function(){var e=DocTreeManager.getSectionAtIndex(editor.doc.getSelection().getStart()).getSectionType()||"";return!(editor.doc.getSelection().isCollapsed()||u()||NOTE_SECTIONS.contains(e))},getRowCountFromColsCount:r,initCellCounts:s,getCellValuesOps:c,getCurrentDelimStr:a,convert:o,getDelim:n,updateCellCountsFromDelim:i,init:t,dialogInfo:e}}(),ConvertTableToText=function(){var e=function(){ConvertTableToText.delimiter=UNICODE.PARA,J.dialogutil.open("converttabletotextdlg",void 0,this.dialogInfo)},t={get:function(e,t){return"DELIMITER"==e.action?ConvertTableToText.getCurrentDelimStr():"OTHER_DELIM"==e.action?"-":"CONVERT_NESTED_TABLES"==e.action?(ConvertTableToText.convertNestedTables=!0,!0):void 0},set:function(e,t,i){"DELIMITER"==e.action?(t=J(i).attr("value"),"PARAGRAPH"==t?ConvertTableToText.enableConvertNestedTable():ConvertTableToText.disableConvertNestedTable(),ConvertTableToText.delimiter=ConvertTableToText.getDelim(t)):"OTHER_DELIM"==e.action?(ConvertTableToText.disableConvertNestedTable(),J("#tabletotext_delim_other").prop("checked")&&""!=t&&(ConvertTableToText.delimiter=t)):"CONVERT_NESTED_TABLES"==e.action&&(J("#convertNestedTables").prop("checked")?ConvertTableToText.convertNestedTables=!0:ConvertTableToText.convertNestedTables=!1)}},i=function(){return ConvertTableToText.delimiter==UNICODE.PARA?"PARAGRAPH":","==ConvertTableToText.delimiter?"COMMA":ConvertTableToText.delimiter==UNICODE.TAB?"TAB":"OTHER"},n=function(){J("#convertNestedTables").zstatebutton("checked",!0),J("#convertNestedTables").zstatebutton("disable"),ConvertTableToText.convertNestedTables=!0},o=function(){J("#convertNestedTables").zstatebutton("enable")},r=function(e){return"PARAGRAPH"==e?UNICODE.PARA:"COMMA"==e?",":"TAB"==e?UNICODE.TAB:"OTHER"==e?J("#tabletotext_delim_other_value").val():void 0},a=function(){var e=J("#tabletotext_delim_other_value").val();J("#tabletotext_delim_other").prop("checked")&&""!=e&&(ConvertTableToText.delimiter=e)},s=function(){return J("#tabletotext_delim_other").attr("checked")&&""==J("#tabletotext_delim_other_value").val()?(UIUtils.showMessagePopup(J.i18n("writer.table.MUST_TYPE_MERGER"),J.i18n("table","MUST_TYPE_MERGER_TITLE_MSG"),"info"),!1):(editor.doc.execCmd("convertTableToText",[ConvertTableToText.delimiter]),void J.dialogutil.close("converttabletotextdlg"))},l=function(e){var t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.TABLE),n=i.getStart(),o=[];o.push({r:n-1});var r=OpUtil.getInsertionOps(editor.doc.createRange(i.getStart()-1,i.getStart()));TableUtil.handleSectionOpsArr(r.sectionOps);for(var a=r.ops.slice(1),s=0;s<a.length;s++)o.push(a[s]);d(i,o,e,!1),Op.processMsg(o),t.deleteContents(i.getStart(),i.getEnd())},d=function(e,t,i,n){var o,r,a=function(e){e.push({as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}})},s=function(e,t){for(var i=[],n=0;n<t.length-1;n++){var o={point:t[n],align:"0",leader:"0"};i.push(o)}e.push({as:{start:{tps:i,type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["tps","type"]}})},l=e.children(),c=l.length,u=DocLayoutManager.getColumnWidthAtIdx(e.getStart()),p=parseFloat(Conversions.toGlobalValue(u+"px"));Conversions.isInMM&&(p/=Conversions.oneInchInMM);for(var g=0;g<c;g++)for(var f=[],E=l[g].children(),T=E.length,m=TableUtil.getCols(e),h=0;h<T;h++){if(i==UNICODE.TAB){var I=m[h].wt;if("%"==I.slice(-1)){var _=parseFloat(I);I=_*p/100+"in"}if(0==f.length)f.push(Conversions.toGlobalValue(I));else{var A=parseFloat(f[f.length-1]);f.push(A+Conversions.toGlobalUnit(I)+Conversions.globalUnit)}}for(var S=E[h],R=S.children(),O=R.length,b=0;b<O;b++){var v=R[b];if(v.type==NODE_TYPE.TABLE){var D=v;if(ConvertTableToText.convertNestedTables)d(D,t,i,!0);else{o=OpUtil.getInsertionOps(editor.doc.createRange(D.getStart(),D.getEnd())),r=o.ops.slice(1),TableUtil.handleSectionOpsArr(o.sectionOps);for(var L=0;L<r.length;L++)t.push(r[L])}}else{var r,N=v;b==O-1?g==c-1&&h==T-1?(o=OpUtil.getInsertionOps(editor.doc.createRange(N.getStart(),N.getEnd())),r=o.ops.slice(1),r=r.slice(-r.length,-3),TableUtil.handleSectionOpsArr(o.sectionOps),i!=UNICODE.TAB?a(r):s(r,f),n&&(i==UNICODE.TAB?s(r,f):(r=r.slice(-r.length,-3),a(r)))):(o=OpUtil.getInsertionOps(editor.doc.createRange(N.getStart(),N.getEnd())),r=o.ops.slice(1),r=r.slice(-r.length,-3),TableUtil.handleSectionOpsArr(o.sectionOps),h==E.length-1?i==UNICODE.TAB?s(r,f):a(r):i==UNICODE.PARA?a(r):r.push({is:i})):(o=OpUtil.getInsertionOps(editor.doc.createRange(N.getStart(),N.getEnd())),r=o.ops.slice(1),TableUtil.handleSectionOpsArr(o.sectionOps),0==b&&i==UNICODE.TAB&&(r=r.slice(-r.length,-3),a(r)));for(var L=0;L<r.length;L++)t.push(r[L])}}}},c=function(){return!0};return{init:e,dialogInfo:t,getCurrentDelimStr:i,disableConvertNestedTable:n,enableConvertNestedTable:o,getDelim:r,updateOtherDelimValue:a,convert:s,convertTableToText:l,canConvert:c}}(),TransposeTable=function(){var e=function(){for(var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE),i=t.children(),n=i.length,o=i[0].children().length,r=o,a=n,s=[],l=[],d=[],c=DocLayoutManager.getViews(t.dtNode),u=c.length,p=[],g=0;g<u;g++)for(var f=c[g],E=f.getRowsHeight(),T=E.length,m=0;m<T;m++)p.push(E[m]);for(var h=[],I=0,_=p.length,g=0;g<_;g++){var A=p[g].ht,S=(A+"px").convertor(),R='"'==Conversions.showUnit?S.inches:S.millimeters;I+=R,h.push(R)}for(var O,b=[],g=0;g<a;g++)if(t.dtNode.isTableWidthInPercentage){var v=h[g]/I*100+"%";b.push({wt:v})}else{O=Conversions.toGlobalValue(t.attr().wid);var v=h[g]/I*parseFloat(O)+('"'==Conversions.showUnit?"in":"mm");b.push({wt:Conversions.toGlobalValue(v)})}var D=Utils.randomString(),L=[{as:{start:{theme:t.attr().theme,type:"table",wid:O||"100%",cols:b,ver:t.attr().ver},id:D}},{is:UNICODE.TABLE},{as:{end:["theme","type","wid","cols","ver"],id:D}}],N=L.length;D=Utils.randomString();for(var P=[{as:{start:{type:"tableend"},id:D}},{is:UNICODE.TABLEEND},{as:{end:["type"],id:D}}],C=P.length,g=0;g<n;g++){s.push([]);for(var y=i[g].children(),m=0;m<o;m++)s[g][m]=y[m]}for(var g=0;g<r;g++){l.push([]),d.push([]);for(var m=0;m<a;m++)l[g][m]={},d[g][m]={}}for(var g=0;g<n;g++)for(var m=0;m<o;m++)l[m][g]=s[g][m];var F=[{r:t.getStart()-1}],M=OpUtil.getInsertionOps(editor.doc.createRange(t.getStart()-1,t.getStart()));TableUtil.handleSectionOpsArr(M.sectionOps);for(var w=M.ops.slice(1),U=w.length,g=0;g<U;g++)F.push(w[g]);for(var g=0;g<N;g++)F.push(L[g]);for(var g=0;g<r;g++)for(var m=0;m<a;m++){var x=l[g][m],B=OpUtil.getInsertionOps(editor.doc.createRange(x.getStart(),x.getEnd()));TableUtil.handleSectionOpsArr(B.sectionOps);var H=B.ops.slice(1);delete H[0].as.start.ht;var J=H[0].as.start.merge;if(J)if("fc"==J){var G=H[0].as.start.rspan;H[0].as.start.rspan=H[0].as.start.cspan,H[0].as.start.cspan=G}else if("hmp"==J){for(var k=!1,W=g-1;W>=0;W--){var Y=l[W][m],z=OpUtil.getInsertionOps(editor.doc.createRange(Y.getStart(),Y.getEnd())),Z=z.ops.slice(1);TableUtil.handleSectionOpsArr(z.sectionOps);var V=Z[0].as.start.merge;if(!V)break;if("hmp"!=V){if("vmp"==V)break;if("fc"==V){k=!0;break}}}k&&(H[0].as.start.merge="vmp")}var j=H[0].as.start.borders;if(void 0!=j){for(var X=Object.keys(j),K={},q=0;q<X.length;q++)"border-top"==X[q]?K["border-left"]=j["border-top"]:"border-right"==X[q]?K["border-bottom"]=j["border-right"]:"border-bottom"==X[q]?K["border-right"]=j["border-bottom"]:"border-left"==X[q]&&(K["border-top"]=j["border-left"]);H[0].as.start.borders=K}d[g][m]=H}for(var g=0;g<r;g++){D=Utils.randomString();for(var Q=[{as:{start:{ht:"auto",type:"row"},id:D}},{is:UNICODE.ROW},{as:{end:["ht","type"],id:D}}],$=Q.length,ee=0;ee<$;ee++)F.push(Q[ee]);for(var te=!1,ie=0,m=0;m<a;m++){var x=l[g][m],H=d[g][m],ne=H.length,J=x.attr().merge;J&&("fc"==J?(te=!0,ie=H[0].as.start.cspan-1):"vmp"==J&&te&&ie>0&&(ie--,H[0].as.start.merge="hmp",0==ie&&(te=!1)));for(var ee=0;ee<ne;ee++)F.push(H[ee])}}for(var g=0;g<C;g++)F.push(P[g]);Op.processMsg(F),e.deleteContents(t.getStart(),t.getEnd())},t=function(e){var t=e.children().length;if(t>30)return!1;for(var i=DocLayoutManager.getViews(e.dtNode),n=i.length,o=0;o<n;o++)for(var r=i[o],a=r.getRowsHeight(),s=a.length,l=0;l<s;l++)if(0==a[l].ht)return!1;return!0};return{transpose:e,canAllowTransposeTable:t}}(),SplitTable=function(){var e=function(e,t){if(e.dtNode.children[0].id!=t.dtNode.id){var i=OpUtil.getInsertionOps(editor.doc.createRange(e.getStart(),e.getEnd()));TableUtil.handleSectionOpsArr(i.sectionOps);for(var n=i.ops,o=n.slice(1,4),r=Utils.randomString(),a=[{as:{start:{type:"tableend"},id:r}},{is:UNICODE.TABLEEND},{as:{end:["type"],id:r}}],s=[t];void 0!=t.nextSibling();)t=t.nextSibling(),s.push(t);for(var l=[],d=0;d<s.length;d++){var c=OpUtil.getInsertionOps(editor.doc.createRange(s[d].getStart(),s[d].getEnd())),u=c.ops.slice(1);TableUtil.handleSectionOpsArr(c.sectionOps);for(var p=0;p<u.length;p++)l.push(u[p])}t=s[0],editor.doc.getSelection().deleteContents(t.getStart(),e.getEnd()-1),r=Utils.randomString();var g=[{r:e.getEnd()}];g=g.concat(Op.getCursor()),g.push({as:{start:{type:"paragraph"},id:r}},{is:UNICODE.PARA},{as:{end:["type"],id:r}});for(var d=0;d<o.length;d++)g.push(o[d]);for(var d=0;d<l.length;d++)g.push(l[d]);for(var d=0;d<a.length;d++)g.push(a[d]);Op.processMsg(g),Op.resetCursorPos(),Op.cursorProcessed()}},t=function(e,t){if(e.dtNode.children[0].id==t.dtNode.id)return!1;for(var i=t.children(),n=i.length,o=0;o<n;o++)if("vmp"==i[o].attr().merge)return!1;return!0};return{split:e,canAllowSplitTable:t}}();var Watermark=function(){var e=[191,191,191],t={},i={},n=JSON.parse('{"content":"DRAFT","type":"text","ff":"Arimo","fw_i":400,"size":70,"fgc":"rgb(191,191,191)"}'),o={SCALE:"watermark-scale",WASHOUT:"watermark-washout",TEXT:"text-watermark-input",URL_PREVIEW:"watermark-imageurl-preview",PICT_TAB_CONT:"picturecomponent",TEXT_TAB_CONT:"textcomponent",TEXT_RADIO:"watermark-text-component",PICT_RADIO:"watermark-picture-component",PICT_FORMAT_CONT:"wm-picture-format-options-cont",PICT_REMOVE_BTN:"wm-pict-remove-btn",TEXT_REMOVE_BTN:"wm-text-remove-btn",FIT_TO_PAGE:"wm-fit-to-page",WM_TEXT_INPUT:"text-watermark-input",TEXT_FONT_COMBO:"watermark_fontFamily",TEXT_FONT_SIZE:"watermark-fontSize",TEXT_COLOR:"watermark-fmt-lpnl-fgcolor",PANEL:"watermark-panel"},r=function(){editor.getRole().permissions.can("document.edit")&&a()},a=function(){J("#watermark-text-component,#watermark-picture-component").on("zstatebuttonchange",function(e,t){J(e.currentTarget).is("#watermark-picture-component")?B.show():H.show()}),J("#watermark-fmt-lpnl-fgcolor").on("zcolorsplitbuttonclick zcolorsplitbuttonchange",function(t,i){var n=Shapes.getRGBArray(i.color);e=n,PageLayoutAdvancedDialogue.updatePreview()}),Z(o.FIT_TO_PAGE).change(function(){var e=this.checked;if(e){var t=R(),i=100;T("scale",i,t),Z(o.SCALE).zspinnerslider("setValue","100")}}),Z(o.WM_TEXT_INPUT).on("keyup",function(e){PageLayoutAdvancedDialogue.updatePreview()})},s=function(){var e=Z(o.WM_TEXT_INPUT).val();return""!=e||(MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_INFO,null,J.i18n("writer.common.WATERMARK_INVALID_TEXT"),null,null),!1)},l=function(e){var t=ZWImageUtils.getNewDimensionBasedOnContainer(e.WIDTH,e.HEIGHT);e.WIDTH="undefined"!=typeof t.width?t.width:e.WIDTH,e.HEIGHT="undefined"!=typeof t.height?t.height:e.HEIGHT;var i=ImageHandler.getImageAttributes(e);return i[ATTR_IMAGE.I_WRAP_TYPE]="behind",i[ATTR_IMAGE.WM_INFO]={},i[ATTR_IMAGE.WM_INFO][ATTR_COMMON.TYPE]="picture",i.op=e.op||50,i},d=function(){var e={},t={};return e[ATTR_IMAGE.I_WRAP_TYPE]="behind",e[ATTR_IMAGE.WM_INFO]={},e[ATTR_IMAGE.WM_INFO][ATTR_COMMON.TYPE]="text",e.va="middle",e[ATTR_COMMON.BORDERS]={"border-top":{color:"rgb(0,0,0)",width:"0px",type:"dashed",space:"0px"},"border-right":{color:"rgb(0,0,0)",width:"0px",type:"dashed",space:"0px"},"border-left":{color:"rgb(0,0,0)",width:"0px",type:"dashed",space:"0px"},"border-bottom":{color:"rgb(0,0,0)",width:"0px",type:"dashed",space:"0px"}},e.z_tb_bgc="none",e.pb="0in",e.pr="0in",e.pl="0in",e.pt="0in",t.image=e,t.text={},t},c=function(){var e=(Utils.getCursorSectionName(),N());try{var o;if(o="TEXT"==e?d():ZWJSONUtils.isEmptyObject(t)?R():l(t)){if(P(o),"TEXT"!=e&&ZWJSONUtils.compareJSON(o,i.image))return;if("TEXT"==e&&!ZWJSONUtils.compareJSON(o.text,n)&&ZWJSONUtils.compareJSON(o.text,i.text))return;p(o)}}catch(e){u()}},u=function(){MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,J.i18n("writer.common.SOMETHINGS_WRONG"),J.i18n("writer.common.WATERMARK_ERROR_MESSAGE"),null,null),UIUtils.hideLoadingMsg()},p=function(e){w(e),v(e)},g=function(){var e=editor.doc.getSelection().getStart(),t=editor.doc.getBodyFormat();if(h(t))I();else for(var i=DocTreeManager.getSectionsByType("header"),n=(i.length,i.first);n;)D(n),L(n),n=n.next;EditorUtil.moveToIndex(e)},f=function(e){var t=e.props.fill?e.props.fill.type:"NONE",i=100;if("PICT"!=t){i=e.props.transform.dim.height;var n=parseInt(60*i/100),o=e.textBody.paras[0].portions[0];InsertShape.getTextFromShape(e).length*n;o.props.size=n,o.unmerged&&(o.unmerged.props.size=n)}return e},E=function(e,t){PageLayoutAdvancedDialogue.updatePreview()},T=function(e,t,i){if("scale"==e)m(t,i);else if("washout"==e){var n=Z(o.WASHOUT).zspinnerslider("getValue")/100;i.op=100*(1-n)}else"rotation"==e&&(i.rotation=t)},m=function(e,t){var i=t[ATTR_IMAGE.I_ORGINALHT],n=t[ATTR_IMAGE.I_ORGINALWID],o=M(e,n,i);t[ATTR_IMAGE.I_HT]=o.height,t[ATTR_IMAGE.I_WID]=o.width},h=function(e){return!!e[ATTR_BODY.WM_TYPE]},I=function(){var e=editor.doc.createElement(NODE_TYPE.BODY),t={};t[ATTR_BODY.WM_TYPE]="",t[ATTR_BODY.WM_FS]="",t[ATTR_BODY.WM_FF]="",t[ATTR_BODY.WM_TXT]="",t[ATTR_BODY.WM_AN]="",t[ATTR_BODY.WM_FGC]="",t[ATTR_BODY.WM_PURL]="",t[ATTR_BODY.WM_OURL]="",t[ATTR_BODY.WM_URL]="",t[ATTR_BODY.WM_OP]="",t[ATTR_BODY.WM_SIZE]="",e.attr(t)},_=function(){var e=editor.doc.getBodyFormat();h(e)&&I()},A=function(e){return Shapes.getWatermarkId(e)},S=function(e){var t=Shapes.getShapeFromCache(e);return t&&t[0]&&JSON.parse(t[0])},R=function(){var e=Utils.getCursorSectionName(),t=A(e.toLowerCase());if(!t||!J("#"+t)[0]){for(var i,n=Utils.getSectionByHfType("HEADER",e),o=editor.doc.findNextIndexOf(UNICODE.IMAGE,n.start);o!=-1&&o<n.end;){if(i=DocUtil.copyStyle(editor.doc.getRawFormatAt(o)),i.hasOwnProperty(ATTR_IMAGE.WM_INFO)){if("text"==i[ATTR_IMAGE.WM_INFO][ATTR_COMMON.TYPE]){var r={};r.image=i;var a=DocTreeManager.getSectionWithSid(i.id),s=a.getIndex()+1,l=editor.doc.getCharAt(s);return l==UNICODE.RANGE_START&&(s+=1),r.text=editor.doc.getRawFormatAt(s),r}return i}o=editor.doc.findNextIndexOf(UNICODE.IMAGE,o+1)}return null}return S(t)},O=function(e){"header"==e&&b()},b=function(e){e||(e=Utils.getCursorSectionName()),delete Shapes.deleteWatermarId(e.toLowerCase())},v=function(e,t){t=t||N();for(var i,n=editor.doc.getSelection().getStart(),o=DocUtil.getWatermarkOps(e,t),r=0;r<o.length;r++)i=o[r],Op.processMsg(i);Op.sendMsg(),EditorUtil.moveToIndex(n),_()},D=function(e,t){for(var i,n=e.start,o=editor.doc.findNextIndexOf(UNICODE.IMAGE,n);o!=-1&&o<e.end;){if(i=editor.doc.getRawFormatAt(o),i.hasOwnProperty(ATTR_IMAGE.WM_INFO)){var r=[{r:o},{ds:editor.doc.getCharAt(o)}];if(t?t.push(r):Op.processMsg(r),"text"==i[ATTR_IMAGE.WM_INFO][ATTR_COMMON.TYPE]){var a=DocTreeManager.getSectionWithSid(i.id),s=editor.doc.getContent(a.getIndex(),a.getEndIndex()+1);r=[{r:a.getIndex()},{ds:s}],t?t.push(r):Op.processMsg(r)}break}o=editor.doc.findNextIndexOf(UNICODE.IMAGE,o+1)}},L=function(e,t){for(var i,n=e.start,o=editor.doc.findNextIndexOf(UNICODE.IMAGE,n);o!=-1&&o<e.end;){i=editor.doc.getRawFormatAt(o);var r=i.shapeData;if(r&&"WATERMARK"==r.shapetype){var a=[{r:o},{ds:editor.doc.getCharAt(o)}];t?t.push(a):Op.processMsg(a);break}o=editor.doc.findNextIndexOf(UNICODE.IMAGE,o+1)}},N=function(){return Z(o.PICT_TAB_CONT).is(":visible")?"PICTURE":"TEXT"},P=function(e){var t=N();try{"TEXT"==t?y(e):C(e)}catch(e){u()}return e},C=function(e){var t=Z(o.SCALE).zspinnerslider("getValue");m(t,e);var i=Z(o.WASHOUT).zspinnerslider("getValue")/100;return e.op=100*(1-i),e},y=function(t,i){if(s()){var n="",r="";i&&(n=i[0],r=i[1]||"");var a=t.image,l=t.text,d=Z(o.TEXT_FONT_COMBO).zfontcombo("getValue"),c=Z(o.WM_TEXT_INPUT).val(),u=d[0],p=d[1];fontSize=Z(o.TEXT_FONT_SIZE).zcombobox().val()||72,fontMetrics=InsertShape.calculateDimensionOnFonts(c,u,fontSize,p),c.length>=50&&(c=c.substring(0,50)),InsertShape.mergeWithFormats||(InsertShape.mergeWithFormats={}),a.ht=fontMetrics.height+50,a.wid=fontMetrics.width+20,a.rotation="diagonal"==document.querySelector('input[name="watermarkAngle"]:checked').value?320:0,l.content=c;var g=DocUtil.formatGenerator.getTextFormat({},"FontName",d);extend(l,g),l.size=parseInt(fontSize),l.fgc="rgb("+e.toString()+")"}},F=function(e){var t=R();t&&"PICTURE"!=Y(t)&&!W(t)||(t=d()),y(t,e),w(t),U.update(t)},M=function(e,t,i){var n,o;if(e==-1)n=pageHt,o=pageWid;else if(i>t){var r=i*e/100;o=r*t/i,n=r}else{var a=t*e/100;n=a*i/t,o=a}return{height:n,width:o}},w=function(e){var t=N(),i=e;"TEXT"==t&&(i=e.image),i[ATTR_IMAGE.I_H_POSITION]={};var n=i[ATTR_IMAGE.I_H_POSITION];n[ATTR_IMAGE.I_POSITION_FROM]="margin",n[ATTR_IMAGE.I_POSITION_TYPE]="align",n[ATTR_IMAGE.I_ALIGN_VAL]="center",i[ATTR_IMAGE.I_V_POSITION]={};var o=i[ATTR_IMAGE.I_V_POSITION];return o[ATTR_IMAGE.I_POSITION_FROM]="margin",o[ATTR_IMAGE.I_POSITION_TYPE]="align",o[ATTR_IMAGE.I_ALIGN_VAL]="center",e},U={update:function(e){if(e||(e=R()),!e){H.reset(),B.reset();var t=editor.doc.getBodyFormat();return void(h(t)&&G(t))}var i=Y(e);"TEXT"==i?(H.update(e),B.reset()):(B.update(e),H.reset())},reset:function(){B.reset(),H.reset()},initPanel:function(e){FontSizeCombo.addDefaultFontSizesInWMCombo(),U.update(),x(),Z(o.WM_TEXT_INPUT).focus().select()},closePanel:function(){LeftPanel.closeSubPanel(o.PANEL,ANIMATIONS.FADEOUT),PubSub.unsubscribe("Cursor/PageChanged",k)}},x=function(){var e=N();"TEXT"==e&&(i=d(),y(i))},B={show:function(){Z(o.TEXT_TAB_CONT).hide(),Z(o.PICT_TAB_CONT).show(),PageLayoutAdvancedDialogue.updatePreview()},update:function(e){this.show();var t,i;if(W(e)){var n=e.props.fill.pict,r=e.props.transform.dim,a=r.height,s=r.width,l=e.zwpictProps.dim;t=0,t=a>s?a/l.height*100:s/l.width*100,i=50,n.props&&null!=n.props.alpha&&(i=100*n.props.alpha)}else{var a=e.ht,s=e.wid,d=e[ATTR_IMAGE.I_ORGINALWID],c=e[ATTR_IMAGE.I_ORGINALHT];t=0,t=a>s?a/c*100:s/d*100,i=50,e.op&&(i=100-e.op)}Z(o.PICT_RADIO).prop("checked",!0),J("#watermark-image-btn").zbutton("setAttribute","label",J.i18n("writer.common.REPLACE")),Z(o.URL_PREVIEW).text(J.i18n("writer.common.CHOOSE_ANOTHER_IMAGE")),Z(o.SCALE).zspinnerslider("setValue",t),Z(o.PICT_FORMAT_CONT).removeClass("ui-zwdisabled"),Z(o.WASHOUT).zspinnerslider("setValue",i),Z(o.PICT_REMOVE_BTN).enable()},reset:function(){Z(o.URL_PREVIEW).text(J.i18n("common","NO_FILE_CHOSEN")),Z(o.SCALE).zspinnerslider("setValue",80),Z(o.WASHOUT).zspinnerslider("setValue",50),Z(o.PICT_FORMAT_CONT).addClass("ui-zwdisabled"),J("#watermark-image-btn").zbutton("setAttribute","label",J.i18n("writer.common.CHOOSE")),Z(o.PICT_REMOVE_BTN).disable()}},H={show:function(){Z(o.PICT_TAB_CONT).hide(),Z(o.TEXT_TAB_CONT).show(),PageLayoutAdvancedDialogue.updatePreview()},update:function(t){this.show();var i,n,r,a,s,l=[0,0,0];if(W(t)){a=InsertShape.getTextFromShape(t);var d=t.textBody.paras[0].portions[0].props;i=parseFloat(d.size||70),d.fontWeight&&(s=WRITER_FONT_WEIGHT_MAP[d.fontWeight]),n=d.font.fontFamily.name,"SOLID"==d.fill.type&&(e=d.fill.solid.color.rgb,l="rgb("+e.toString()+")"),r=0==t.props.transform.rotate?"horizontal":"diagonal"}else{var c=t.text,u=t.image;u.id?(a=DTUtils.getTextBoxContent(u.id),a=a.replaceAll(UNICODE.RANGE_START,""),a=a.replaceAll(UNICODE.RANGE_END,"")):a=c.content,i=c.size,s=c.fontweight,n=c.ff,l=c.fgc,e=JSON.parse(l.replace("rgb(","[").replace(")","]")),r=u.hasOwnProperty("rotation")&&0!=u.rotation?"diagonal":"horizontal"}V(i,Z(o.TEXT_FONT_SIZE)),FontComboUtil.updateFontFamily(n,s,o.TEXT_FONT_COMBO),Z("wmangle-"+r).prop("checked",!0),Z(o.TEXT_RADIO).prop("checked",!0),Z(o.WM_TEXT_INPUT).val(a),Z(o.TEXT_REMOVE_BTN).enable()},reset:function(){FontComboUtil.updateFontFamily("arimo",null,o.TEXT_FONT_COMBO),Z(o.WM_TEXT_INPUT).val(J.i18n("common","DRAFT_UPPER")).focus().select(),V(70,Z(o.TEXT_FONT_SIZE)),Z(o.TEXT_REMOVE_BTN).disable()}},G=function(t){var i=t[ATTR_BODY.WM_TYPE];if("wmtxt"==i){H.show();var n=t[ATTR_BODY.WM_FGC],r=t[ATTR_BODY.WM_TXT];V(t[ATTR_BODY.WM_FS]),FontComboUtil.updateFontFamily(t[ATTR_BODY.WM_FF],null,o.TEXT_FONT_COMBO);var a=t[ATTR_BODY.WM_AN];Z("wmangle-"+a).prop("checked",!0),e=JSON.parse(n.replace("rgb(","[").replace(")","]")),Z(o.TEXT_RADIO).prop("checked",!0),Z(o.WM_TEXT_INPUT).val(r),Z(o.TEXT_REMOVE_BTN).enable()}else{B.show();var s=t[ATTR_BODY.WM_SIZE],l=100*t[ATTR_BODY.WM_OP]||50;Z(o.PICT_RADIO).prop("checked",!0),Z(o.URL_PREVIEW).text(J.i18n("writer.common.CHOOSE_ANOTHER_IMAGE")),Z(o.SCALE).zspinnerslider("setValue",s),Z(o.WASHOUT).zspinnerslider("setValue",l),Z(o.PICT_FORMAT_CONT).removeClass("ui-zwdisabled"),Z(o.PICT_REMOVE_BTN).enable()}},k=function(){if(LayoutManager.isRichEditActive()){var e=R();null!=e?U.update(e):U.reset()}},W=function(e){var t=e.hasOwnProperty("shapetype");return t},Y=function(e){var t=e.hasOwnProperty(ATTR_IMAGE.WM_INFO)&&"picture"==e[ATTR_IMAGE.WM_INFO][ATTR_COMMON.TYPE],i=e.props&&"PICT"==e.props.fill.type;return t||i?"PICTURE":"TEXT"},z=function(){var e={success:function(e){t=e.DATA[0];var i=ZWJSONUtils.clone(t),n=l(i);P(n),w(n),U.update(n),ZWImgLibDialog.close()},failure:function(){}};ZWImgLibDialog.open({},e.success,e.failure)},V=function(e){if(e){var t=FontSizeCombo.getWMFontSizeList(),i=t.indexOf(e);i==-1&&FontSizeCombo.addFontSizeInWMCombo(e),Z("watermark-fontSize").zcombobox("setValue",e)}},j=function(){ShapesUtil.beforeShapeDelete()},X=function(){var e=(Utils.getCursorSectionName(),N());try{var i;return i="TEXT"==e?d():ZWJSONUtils.isEmptyObject(t)?R():l(t),i&&(P(i),w(i),i.type=e),{data:i,type:e}}catch(e){}},K=function(){t={}};return PubSub.subscribe("ZWSelection/ImageDelete",j),PubSub.subscribe("ZWSelection/BeforeClearSection",O),PubSub.subscribe("Watermark/Deleted",b),{insert:c,remove:g,modify:f,uiEventHandler:E,updateTextFormat:F,initPanel:U.initPanel,closePanel:U.closePanel,checkAndRemoveImageWaterMark:D,checkAndRemoveShapeWaterMark:L,checkForOldWatermarkAndRemove:_,fillImage:z,getWaterMarkDilogueData:X,getCurrentSectionWatermark:R,reset:K,bindEvents:r}}(),WordCountDlg=function(){var e=function(){ZWLogger.addToStatistics("wordCnt");var e=WC.getWordCountDetails();J.dialogutil.open("wcdialog",J("#rt_btn_wordcount"),{get:function(t,i){"SHOWWORDCOUNT"==t.action&&(J("span#w_words").html(e.wordcount),J("span#w_chars_spaces").html(e.charCountWithSpaces),J("span#w_chars_out_spaces").html(e.charCountWithoutSpaces),J("span#w_sel_words").html(e.sel_wordcount),J("span#w_sel_chars_spaces").html(e.sel_charcount_withspaces),J("span#w_sel_chars_out_spaces").html(e.sel_charcount_withoutspaces))}})},t=function(){var e=WC.getWordCountDetails();J("span.wordCnt").html((e.sel_wordcount?e.sel_wordcount+"/":"")+e.wordcount),J("span.charCnt").html((e.sel_charcount_withspaces?e.sel_charcount_withspaces+"/":"")+e.charCountWithSpaces)};return PubSub.subscribe("Para/Modify",t,{async:!0,timeout:3e3}),Array.prototype.forEach.call(["Cursor/Collapsed","Cursor/Selected"],function(e){PubSub.subscribe(e,t,{async:!0,timeout:500})}),{insertWCDlg:e,updateWordCountInBottomPannel:t}}();!function(e){e.fcomponents=e.extend(!0,e.fcomponents,{getCurrentDocStatus:function(){return"0"==editor.doc.docInfo.REVISION||window.isMacNative?0:1}})}(jQuery),TabKeyHandler=function(){},TabKeyHandler.getNextVisibleCell=function(e,t){for(;e&&!TableUtil.isVisibleCell(e.getStart());){var i=e;if(e=t?e.previousSibling():e.nextSibling(),!e){var n=i.parentNode();n=t?n.previousSibling():n.nextSibling(),n&&(e=t?n.lastChild():n.firstChild())}}return e},TabKeyHandler.tabKeyHandling=function(e){var t=editor.doc.getSelection();t.isTableSelected()&&t.removeTableSelection();var i,n,o,r=t.getParents(NODE_TYPE.CELL),a=t.getNodesInSelection(NODE_TYPE.PARAGRAPH,t.getStart(),t.getEnd());if(r)if(TableUtil.isCellRepeatTable(r.dtNode))var s=editor.doc.getParents(NODE_TYPE.PARAGRAPH,r.parentNode().parentNode().getEnd()),t=editor.doc.getSelection().removeAllRanges().moveTo(s,!0);else{var l=e?r.previousSibling():r.nextSibling();if(l=TabKeyHandler.getNextVisibleCell(l,e))if(l.getEnd()-l.getStart()==2){var s=l.firstChild();t.removeAllRanges().moveTo(s,!0)}else i=l.getStart()+1,n=l.getEnd()-1,o=editor.doc.createRange(i,n),t.removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(o);else{var r,d=t.getParents(NODE_TYPE.ROW),c=e?d.previousSibling():d.nextSibling();if(c&&(r=e?c.lastChild():c.firstChild(),r=TabKeyHandler.getNextVisibleCell(r,e)),c&&r)if(r.getEnd()-r.getStart()==2){var s=r.firstChild();t.removeAllRanges().moveTo(s,!0)}else i=r.getStart()+1,n=r.getEnd()-1,o=editor.doc.createRange(i,n),t.removeAllRanges().addRange(o);else if(e){var r=t.getParents(NODE_TYPE.CELL);if(r){var u=r.previousSibling();u&&t.removeAllRanges().moveTo(u,!1)}}else editor.doc.execCmd("insrowafter")}}else if(a.length)if(1==a.length){var s=a[0],p=s.attr(ATTR_PARAGRAPH.PS_TPS),g=Conversions.toGlobalUnit(editor.doc.getBodyFormat()[ATTR_BODY.DS_TPS]),f=[],E=[],T=t.getLastRange(),m=T.start==a[0].getStart(),h=DocUtil.isEmpty(s);if(a[0].dtNode.isCode()||!(ListUtils.isList(s.attr("*"))&&m||m&&!h)||p&&(!p||0!=p.length)&&t.isCollapsed())TabKeyHandler.insertTab();else{var I=J(editor.doc.getCursorPortionNode()).parents("div.zw-paragraph"),_=I.attr("data-listids"),a=J(editor.clientActiveSection).find("[data-listids="+_+"]");if(a[0]==I[0]){for(var A=DocLayoutManager.getContentWidthAtIndex(t.getStart()),S=Conversions.toGlobalUnit(A/96+"in"),R=0;R<a.length;R++){var s=DocUtil.getDocElement(a[R]),O={};if(s){var b=s.attr(ATTR_PARAGRAPH.PS_ML);if(b)if(b=Conversions.toGlobalUnit(b),e){if(!(b&&b>g))break;b=b-g+Conversions.globalUnit}else{if(S==b&&0==R)break;b=b+g+Conversions.globalUnit}O[ATTR_PARAGRAPH.PS_ML]=b,f.push(s),E.push(O)}}editor.doc.execCmd("applyStyle",[f,E,"updateParaMarginLeft"])}else{var v=s.attr(ATTR_PARAGRAPH.PS_TI),O=(s.attr(ATTR_PARAGRAPH.PS_ML),{});v&&0!=parseFloat(v)||ListUtils.isList(s.attr("*"))||e||m&&!t.isCollapsed()?!e||ListUtils.isList(s.attr("*"))||!v||0==parseFloat(v)||m&&!t.isCollapsed()?editor.doc.execCmd(e?"outdent":"indent"):(O[ATTR_PARAGRAPH.PS_TI]=0,f.push(s),E.push(O),editor.doc.execCmd("applyStyle",[f,E,"updateParaTextIndent"])):(O[ATTR_PARAGRAPH.PS_TI]=g+Conversions.globalUnit,f.push(s),E.push(O),editor.doc.execCmd("applyStyle",[f,E,"updateParaTextIndent"]))}}}else ZWCode.isOnlyCodeParas(a)?TabKeyHandler.insertTabs(a):editor.doc.execCmd(e?"outdent":"indent")},TabKeyHandler.insertTab=function(){var e=editor.doc.createElement(NODE_TYPE.TEXT,UNICODE.TAB);e.css={st:"tab",type:"text"},editor.doc.execCmd("insert",e)},TabKeyHandler.insertTabs=function(e){editor.doc.execCmd("inserttab",e)};var AutoText=function(){"use strict";var e=null,t=function(e,t){J("#insertautotxt").zmenu("hide"),J.ZContextMenu.hideMenu();var n,o={autoTxtName:e,deleteSingleAutoTxt:function(){i(this.autoTxtName)}};n=t?AutoText.deleteall:o.deleteSingleAutoTxt.bind(o),UIUtils.showMessagePopup(J.i18n("writer.common.DELETE_AUTOTEX_MSG"),J.i18n("writer.common.DELETE_AUTOTEX_TITLE_MSG"),"warning",n,!1,!0,null,null)},i=function(t){var i={};i.AUTOTXT_NAME=t;var n={id:t,success:function(){delete e[t]}};J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix("autotext/delete"),data:i,async:!0,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(e){},success:function(e){n.success()}})},n=function(){var e=editor.doc.getSelection();if(e.getEnd()-e.getStart()>1e3)return void MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ALERT,J.i18n("writer.error.OOPS"),J.i18n("writer.quicktext.MAX_CHAR_EXCEDDED_MSG"),null,null);var t={init:function(){J("#insertautotxt").zmenu("hide");var e=o();J("#previewSelCont").html(e?e.html:"")},open:function(){}};J("#insertautotxt").zmenu("hide"),J.dialogutil.open("insertautotxtdlg",J("#autoTxt"),t),Z("qt-error-message").hide()},o=function(){var e=editor.doc.getSelection().getLastRange(),t=e&&CopyEventHandler.getCopiedInfo(e)||"";if(""==t&&TransformHandler.getCurrentObjectInfo().type){var i=editor.doc.getSelection().getLastRange();t=CopyEventHandler.getCopiedInfo(editor.doc.createRange(i.start,i.start+1))}return t},r=function(){var e=J("#insertautotxtdlg"),t=e.zvalidation("validateAllFields",e);if(t){var i=J("#insertTxt");i.text(J.i18n("common","SAVING")),i.addClass("ui-italic"),i.disable(),p()}},a=function(t,i){var n=new FormData;n.append("content",i),n.append("image",t.imageFile),n.append("name",J("#autoTxtBox").val()),J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix("autotext/insert"),data:n,enctype:"multipart/form-data; "+t.type,contentType:!1,processData:!1,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){e=t,g()},error:function(e,t,i){Z("qt-error-message").show()}})},s=function(t){PasteUtil.preparePasteDiv(!1);var i=J(t).attr("qtid"),n=e[i].content,o=(document.getElementById("_zohoPaste"),{isWriterDocument:!0}),r=[],a=J("<div>"+n+"</div>"),s=a.find("img");s.each(function(e,t){var i=t.getAttribute("src");if(i.indexOf("/autotext/image/")!=-1){var n=function(t){var n=new Deferred,o=document.createElement("img");return o.onload=function(){var t=ZWImageUtils.getImageBytes(this);t.startsWith("data:")&&(s[e].setAttribute("src",t),n.resolve())},o.setAttribute("src",i),n.promise()}(this);r.push(n)}});var l=Deferred.when.apply(null,r);l.then(function(e){a=a.find("img").each(function(){var e=J(this),t=e.attr("src");if(t.startsWith("data:")){var i=HTMLUtil.storeImageInFileStore(t);e.attr("src",i)}else if(Utils.isWebImage(t)){var i=HTMLUtil.storeImageInFileStoreByURL(t);e.attr("src",i)}}).end(),PasteUtil.insertCustomContent(a[0],null,o),InsertShape.clearSelection(),J("#insertautotxt").zmenu("hide"),UIUtils.hidePasteToolbar()})},l=function(){if(e)c(e);else{var t={};ZWLogger.addToStatistics("Quicktext"),J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix("autotext/view"),data:t,async:!1,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(e){},success:function(t){e=t,c(e)}})}},d=function(e){var t=e.target;t&&(J(t.nextElementSibling).addClass("ui-hide"),t.style.height=t.naturalHeight/2+"px",t.style.width=t.naturalWidth/2+"px",t.style.display="block")},c=function(e){var t=J("#autoTxtDiv");t.find(".autoTxtBox").remove();var i=Object.keys(e),n=i.length;if(0==n)return void t.hide();t.show();for(var o=Handlebars.compile(J("#autotext-view-card").html()),r=0;r<n;r++){var a=i[r],l=e[a];l.id=a;var c=J(o(l));t.append(c),c.find("img").load(d)}J(".autoTxtBox").hover(function(){J(this).find("#autoTxtDel").show(),J(this).append(J("#autoTxtApply").show())},function(){J(this).find("#autoTxtDel").hide()}),J(".autoTxtBox").click(function(e){s(this),J.ZContextMenu.hideMenu(),J.ZContextMenu._isMenuShowing=!1}),J("div#autoTxtDel").click(function(e){e.stopPropagation(),J("#insertautotxt").zmenu("hide");var t=J(this).parents(".autoTxtBox"),i=t.attr("qtid");AutoText.deleteConformation(i)})},u=function(e,t){var i=editor.doc.getSelection()[0].collapsed;J("#insertautotxt").zmenu(i?"disableMenuItem":"enableMenuItem","savetxttogallerybtn"),AutoText.view()},p=function(){var e=J("#previewSelCont"),t=e.html(),i="",n=[];if(t.indexOf("base64,")!=-1){var i=J("<div>"+t+"</div>"),o=i.find("img");o.each(function(e,t){var i=J(this),r=i.attr("src");if(r&&r.startsWith("data:image/png;base64,")){var a=f(r);a.then(function(t){J(o[e]).attr("src","/writer/v1/web/autotext/image/"+t)}),n.push(a)}})}else i=t;var r={html:"",success:function(e){a(e,this.html)},onpreloaded:function(e){var t=e.elements.parent();t.attr("style","overflow:visible !important; height:auto !important;"),e.elements.attr("style","overflow:visible !important; height:auto !important;");var i=e.elements.height();e.elements.width()+3;t.attr("style","overflow:visible !important; height:"+i+"px !important;"),e.elements.attr("style","overflow:visible !important; height:"+i+"px !important;")},onparsed:function(e){e.elements.parent().attr("style","")}},s=Deferred.when.apply(null,n);s.then(function(t){r.html="object"==typeof i?i.html():i,UIUtils.convertHTMLToBlob(e,r)})},g=function(){J.dialogutil.close("insertautotxtdlg")},f=function(e){var t=new Deferred,i=UIUtils.dataURItoBlob(e),n=new FormData;n.append("image",i.imageFile);var o=ZWNetworkUtils.getNiceUrlPrefix("autotext/storeimage");return J.ajax({type:"POST",dataType:"json",url:o,data:n,enctype:"multipart/form-data; "+i.type,contentType:!1,processData:!1,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){"success"==e.result?t.resolve(e.imageId):this.error()},error:function(e,i,n){t.reject()},setHeaders:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}}),t.promise()};return{deleteConformation:t,getTextnamePopup:n,beforeShow:u,saveSelection:r,view:l}}(),FormulaHandler=function(e,t){"use strict";var i,n,o=function(){n||(i=editor.doc,n=i.getSelection())},r=function(e){return{value:0,langCountryCode:e,decimalPlaces:0,integerPlaces:0,isCurrency:!1}},a=function(e,i){var n,o,a,s=r(e);return s.decimalPlaces=2,s.integerPlaces=5,s.isCurrency=!0,s.currencyCode=i,n=Numeral.applyThousandAndDecimalSeperator(s),n=n.replace("0",""),n=t.replaceDigitsWithHash(n,3),o=Numeral.applyThousandAndDecimalSeperator(s),o=o.replace("0",""),o=t.replaceDigitsWithHash(o,3),n=n+";("+o+")",a="currencyFormat",{value:n,valueStr:a}},s=function(e){var i,n,o=[],a=r(e);return i="0",n="numWithOutDcml",o.push({value:i,valueStr:n}),i="0%",n="prcntWithOutDcml",o.push({value:i,valueStr:n}),a.decimalPlaces=2,a.integerPlaces=1,i=Numeral.applyThousandAndDecimalSeperator(a),n="numWithDcml",o.push({value:i,valueStr:n}),i+="%",n="prcntWithDcml",o.push({value:i,valueStr:n}),a.decimalPlaces=0,a.integerPlaces=5,i=Numeral.applyThousandAndDecimalSeperator(a),i=i.replace("0",""),i=t.replaceDigitsWithHash(i,3),n="cmaSeptWithoutDcml",o.push({value:i,valueStr:n}),a.decimalPlaces=2,a.integerPlaces=5,i=Numeral.applyThousandAndDecimalSeperator(a),i=i.replace("0",""),i=t.replaceDigitsWithHash(i,3),n="cmaSeptWithDcml",o.push({value:i,valueStr:n}),o},l=function(e,n){var o,r,a,s,l,d,c,u,p,g,f=e.formula,E=t.getFormulaFormat(f),T=e.fieldInfos,m=e.fields,h=m.length;n=T?n:"";for(var I,_,u,A=0;A<h;A++)_=[],I=m[A],o=I.start,r=I.end,a=ZWJSONUtils.clone(i.getRawFormatAt(o)),a.formula=f,a.label=n,a.fieldInfos=T,s=i.getRawFormatAt(r-1),l=i.getRawFormatAt(o+1),d=i.getContent(o,r),c=a.id,u=DocTreeManager.getTreeNodeAtIndex(o),p=t.calculate(E,u),g=p.formattedVal,"Formula_Output"==g&&n&&(g=n),_.push({r:o}),_.push({ds:d}),c=Utils.randomString(),_.push({as:{start:a,id:c}}),_.push({is:UNICODE.RANGE_START}),_.push({as:{end:Object.keys(a),id:c}}),c=Utils.randomString(),_.push({as:{start:l,id:c}}),_.push({is:g}),_.push({as:{end:Object.keys(l),id:c}}),c=Utils.randomString(),_.push({as:{start:s,id:c}}),_.push({is:UNICODE.RANGE_END}),_.push({as:{end:Object.keys(s),id:c}}),Op.processMsg(_);Op.sendMsg()},d=function(e,t,i,n){e=e.trim()+" ",i=U.escape(i),n=U.escape(n);var o=i+t+n;o&&(e+='\\# "'+o+'"'),e=e.trim(),editor.doc.execCmd("updateFormula",["autoformula",e])},c=function(e){o(),e||(e=n.getStart());var t=g(e);return t.index!=-1},u=function(e){o(),e||(e=n.getStart());for(var t=i.getParents(NODE_TYPE.TABLE,e),r=t.children(),a=r.length,s=0;s<a;s++)for(var l=r[s].children(),d=l.length,u=0;u<d;u++){var p=l[u];if(c(p.getStart()+1))return!0}return!1},p=function(){o();var t,i;if(n.isCollapsed()){var r=n.getParents(NODE_TYPE.CELL);r?(t=r.getStart(),i=r.getEnd()):(t=n.getStart(),i=e.getRangeEnd(t))}else t=n.getStart(),i=n.getEnd();var a=e.getAllFieldsRanges("autoformula",t,i);return a.length>0},g=function(e){var t=DocTreeManager.doc.getTreeNodeAtIndex(e).parent;if(t.type!=NODE_TYPE.CELL)return DocTreeManager.doc.getTreeNodeAtIndex(e).getFormula();var i=t.getChildrenWithFormula();return i?i.getFormula():{text:"",index:-1}},f=function(i,n,o){var r,a,s,l,d,c,d,u,p,g,f,E,T,m,h,I=e.getAllFieldsRanges("autoformula",i,n),_=I.length,A=[],S=[],R=b();o||(o={});for(var O=0;O<_;O++){r=I[O].start,a=I[O].end,s=editor.doc.getRawFormatAt(r),l=editor.doc.getRawFormatAt(a-1),c=editor.doc.getRawFormatAt(r+1),d=s.id,f=DocTreeManager.getTreeNodeAtIndex(r),m=f.viewProperties.fields[d].formula,h=m.text;var v=new ZWFieldParser(h);v.isFillableField()&&R&&(m.text=v.replaceFillableFieldsInFormula()),v.destroy(),E=t.calculate(m,f,o),E.updatedFormulaField&&(s.formula=E.updatedFormulaField),T=E.formattedVal,"Formula_Output"==T&&s.label&&(T=s.label),o[f.id]=T,p=editor.doc.getContent(r,a),u=Utils.randomString(),g=[],g.push({r:r}),g.push({ds:p}),d=Utils.randomString(),g.push({as:{start:s,id:d}}),g.push({is:UNICODE.RANGE_START}),g.push({as:{end:Object.keys(s),id:d}}),d=Utils.randomString(),g.push({as:{start:c,id:d}}),g.push({is:T}),g.push({as:{end:Object.keys(c),id:d}}),d=Utils.randomString(),g.push({as:{start:l,id:d}}),g.push({is:UNICODE.RANGE_END}),g.push({as:{end:Object.keys(l),id:d}}),A.push(g),S.push(f)}return{ops:A,dtParas:S,formulaValsObj:o}},E=function(e){o(),e||(e=DocTreeManager.getTreeNodeAtIndex(editor.doc.getSelection().getStart()));for(var t=e;"table"!=t.type&&t.parent;)t=t.parent;"table"==t.type&&(T(t.start,t.end),Op.sendMsg())},T=function(e,t,i){var n,o=[];i||(i={}),n=f(e,t,i),n.ops&&n.ops.length>0&&(o=n.ops);for(var r,a=o.length,s=0;s<a;s++)r=o[s],Op.processMsg(r)},m=function(){o();var t,r,a,s={},d=v();if(n.isCollapsed()){if(t=n.getParents(NODE_TYPE.CELL),!t){r=n.getStart(),a=e.getRangeEnd(r);var c=i.getComputedFormatAt(r,"text"),u={formula:c.formula,fieldInfos:c.fieldInfos,fields:e.getAllFieldsRanges("autoformula",r,a)};return void(d?S(r,a):l(u,c.label))}d?S(t.getStart(),t.getEnd()-1):T(t.getStart(),t.getEnd()-1)}else d?S(n.getStart(),n.getEnd()):n.applyOnSelection(T,s);!d&&Op.sendMsg()},h=function(){for(var e,t,i,n=new DocOpBuilder,o=DocTreeManager.doc.getAllSections(),r=o.length,a=0;a<r;a++){var s=o[a],l=s.getSectionType();if(l===SECTION_TYPES.CONTENT||l===SECTION_TYPES.HEADER||l===SECTION_TYPES.FOOTER||l===SECTION_TYPES.TEXTBOX||l===SECTION_TYPES.ENDNOTE||l===SECTION_TYPES.FOOTNOTE)for(var d=f(s.start,s.end),c=d.ops,u=c.length,p=0;p<u;p++)e=c[p],t=DocOpBuilder.build(e),0===a&&0===p?n=t:(i=DocOpBuilder.xform(n,t),n=DocOpBuilder.compose(n,i.second),n=DocOpBuilder.concise(n))}return n},I=function(t){for(var n,o,r=e.getAllFieldsRanges("autoformula",1,editor.doc.getDocumentLength()),a=0,s=r.length;a<s;a++)if(n=r[a],o=i.getRawFormatAt(n.start),o.id==t)return n;return null},_=function(t,i){for(var n,o,r=editor.doc,a=0,s=r.getDocumentLength(),l=[],d=[],c=e.getAllFieldsRanges("autoformula",a,s),u=0,p=c.length;u<p;u++)if(o=c[u],n=r.getRawFormatAt(o.start),n.label)if(t){if(!i||n.label!=i)continue;l.push(o)}else d.contains(n.label)||(d.push(n.label),l.push(o));return l},A=function(t){for(var i,n,o,r=editor.doc,a=0,s=r.getDocumentLength(),l=[],d=[],c=(TableCollectionInstance.getAllTableNames(),e.getAllFieldsRanges("autoformula",a,s)),u=0,p=c.length;u<p;u++){n=c[u],i=r.getRawFormatAt(n.start),o=i.formula;var g=new ZWFieldParser(o);if(g.isTableReferenceField()){if(d=g.getAllTableNamesInFormula(),!t||!d.contains(t))continue;l.push(n)}g.destroy()}return l},S=function(e,t){var i=R(e,t);i.applyTo()},R=function(e,t){var i=editor.doc.getDocumentContent();e=e||0,t=t||i.length;for(var n=DocOpBuilder.build([]),o=f(e,t).ops,r=0,a=o.length;r<a;r++){o[r];n.applyOp(DocOpBuilder.build(o[r]))}return n},O=function(e){var t=e&&e.getFillableFieldType();e&&!FILLABLE_FIELDS_TYPES_SUPPORTED_IN_FORMULA.contains(t)||S()},b=function(){return Utils.canEvaluateFillableFields(!0)||!(editorProps.options&&editorProps.options.isMailMerge)&&editorProps.isHeadlessPDF},v=function(){return editor.getView()==EDITOR_VIEWS.FILLABLEFIELDS_PREVIEW},D=function(){Utils.canEvaluateFillableFields(!0)?(S(),PubSub.subscribe("FillableFieldUpdated",O)):PubSub.unsubscribe("FillableFieldUpdated",O)};return PubSub.subscribe("Document/LoadingComplete",D),{testFormula:d,updateAllFormulaInTable:E,isFormulaInCell:c,isFormulaInTable:u,isFormulaInSelection:p,getFormulaAtIndex:g,getCurrencyFormat:a,getFormats:s,updateFormulasInSelection:m,updateAllFormulaForMailMerge:h,getAllFormulaFieldsWithLabel:_,getFieldById:I,getUpdateFormulaOpsForFillable:R,handleUpdateFlow:l,getAllFormulaFieldsWithTableName:A}}(DocUtil,Formula),FormulaUIUtil=function(e,t,i,n,o){"use strict";var r,a,s,l,d,c,u,p,g,f,E,T,m=!1,h={"merge-prep-formula-menuContainer":{menuId:"merge-prep-formulamenu",elemId:"merge-prep-formula-menu"},"mfp-formula-menuContainer":{menuId:"mfp-formulamenu",elemId:"mfp-formula-menu"},"ins-lpnl-formula-menuContainer":{menuId:"ins-lpnl-formulamenu",elemId:"ins-lpnl-formula-menu"},"mm-formula-menuContainer":{menuId:"mm-formulamenu",elemId:"mm-formula-menu"},formula_btnContainer:{menuId:"formula-btnmenu",elemId:"formula_btn"},"fillable-formula-menuContainer":{menuId:"fillable-formulamenu",elemId:"fillable-formula-menu"}},I=["numWithDcml","prcntWithDcml","cmaSeptWithoutDcml","cmaSeptWithDcml"],_=function(){var e={none:"None",numWithOutDcml:"0",prcntWithOutDcml:"0%",currencyFormat:"currencyFormat"};g=n.clone(e)},A=function(){var e={None:"none",0:"numWithOutDcml","0%":"prcntWithOutDcml",currencyFormat:"currencyFormat"};f=n.clone(e)},S=function(){c={numWithOutDcml:"tbl-numfmt-numWithOutDcml",prcntWithOutDcml:"tbl-numfmt-prcntWithOutDcml",numWithDcml:"tbl-numfmt-numWithDcml",prcntWithDcml:"tbl-numfmt-prcntWithDcml",cmaSeptWithoutDcml:"tbl-numfmt-thousandSeptWithoutDcml",cmaSeptWithDcml:"tbl-numfmt-thousandSeptWithDcml",currencyFormat:"tbl-numFmt-currencyFormat"}},R=function(e){return g[e]},O=function(e){return f[e]},b=function(e,t){g[e]=t},v=function(e,t){f[e]=t},D=function(e){return c[e]},L=function(e){return I.contains(e)},N=function(){var e,i,o={},r=123456.12345;o.none=r;for(var a=0;a<l.length;a++)i=l[a],e="currencyFormat"==i.valueStr?t.applyNumberFormat(r,"currencyFormat",i.value):t.applyNumberFormat(r,i.value),o[i.value]=e;E=n.clone(o)},P=function(e){return E[e]},C=function(e){var i,o,r={};r.none=t.applyNumberFormat(e,"");for(var a=0;a<l.length;a++)o=l[a],i="currencyFormat"==o.valueStr?t.applyNumberFormat(e,"currencyFormat",o.value):t.applyNumberFormat(e,o.value),r[o.value]=i;T=n.clone(r)},y=function(e){return T[e]},F=function(){d=t.getUserLangCountryCode()},M=function(){l=e.getFormats(d);var i=e.getCurrencyFormat(d,t.getCurrencyCode());p=i.value,l.push(i)},w=function(){return p},U=function(){F(),M(),_(),A(),N()},x=function(e,i,n){for(var o,r,a,s,d=l.length,c=n?t.localeParseFloat(e):void 0,u=[],g=0;g<d;g++)o={},r=l[g],a=r.valueStr,s=r.value,L(a)?(b(a,s),v(s,a)):"currencyFormat"==a&&(p=s),o={label:s,id:D(a),value:a},n&&(o.itemType="radio",o.appData={action:"FormulaUIUtil.updateNumberFormat",params:a},!i||s!=i.numberFormat&&a!=i.numberFormat||(o.checked="checked"),i&&isNaN(e)||isNaN(c)?s=P(s):(s=y(s),s=i&&i.prefix?i.prefix+s:s,s=i&&i.suffix?s+i.suffix:s),o.description=s),u.push(o);return u},B=function(e){var t;if("custom"===e){var i=J("#tbl-numFmt-custom");if(t=i&&i.text(),/\[custom-currency\]/.test(t)){var n=J("#tbl-numFmt-currencyFormat");t=n&&(n.attr("data-label")||n.text())||p}else t=t.replace(/\[custom\]/,"")}else if("currencyFormat"===e){var n=J("#tbl-numFmt-currencyFormat");t=n&&(n.attr("data-label")||n.text())||p}else t=e&&"none"!=e&&"novalue"!=e?R(e):"";return t},H=function(){var t=e.getAllFormulaFieldsWithLabel(!1),i=["ins-lpnl-formula-menu","mfp-formula-menu","merge-prep-formula-menu","mm-formula-menu","formula_btn","fillable-formula-menu"];i.forEach(function(e){G(e,t)})},G=function(e,t){var i=J("#"+e);i&&(t.length?i.removeClass("ui-zwdisabled-split-btn"):i.addClass("ui-zwdisabled-split-btn"))},k=function(n){r=o.doc,a=r.getSelection();var s,l=a.getStart(),d={},c=r.getRawFormatAt(l);d=c&&c.formula?t.getFormulaFormat(c.formula):{},n=B(n);var u=n&&d.prefix?d.prefix:"",p=n&&d.suffix?d.suffix:"";if(c&&c.label){var g=[J.i18n("writer.common.UPDATE_ALL"),J.i18n("writer.formula.UPDATE_CURRENT_INSTANCE"),J.i18n("writer.common.CANCEL")],f=J.i18n("writer.formula.FORMULA_IN_MULTIPLE_PLACES"),E=J.i18n("writer.formula.FORMULA_IN_MULTIPLE_PLACES_MSG"),T=CONST.SEVERITY_INFO,m={container:".ui-wdialog",className:"ui-zw-alert-dialog-modify"};MsgDialog.showMessage(g,T,f,E,null,function(o){switch(o){case CONST.BUTTON_YES_CLICKED:d=e.getFormulaAtIndex(l);var r={formula:t.createFormulaFieldString(d.text,n,u,p),fieldInfos:c.fieldInfos,fields:e.getAllFormulaFieldsWithLabel(!0,c.label)};e.handleUpdateFlow(r,c.label);break;case CONST.BUTTON_NO_CLICKED:d=e.getFormulaAtIndex(l);var r={formula:t.createFormulaFieldString(d.text,n,u,p),fieldInfos:c.fieldInfos,fields:i.getAllFieldsRanges("autoformula",a.getStart(),a.getEnd()+1)};e.handleUpdateFlow(r,""),H()}},null,!1,!0,m)}else{if(c&&c.type==NODE_TYPE.AUTOFIELD&&"autoformula"==c.ftype)d=e.getFormulaAtIndex(l),s=i.getRangeEnd(l),s+=1;else{if(a.isCollapsed()){var h=a.getWord();l=h.getStart(),s=h.getEnd()}else l=a.getStart(),s=a.getEnd();d.text="="+t.localeParseFloat(r.getContent(l,s))}var I=[{r:l},{ds:r.getContent(l,s)}];Op.processMsg(I),d=t.createFormulaFieldString(d.text,n,u,p);var _=c&&c.fieldInfos,A=c&&c.label;o.doc.execCmd("updateFormula",["autoformula",d,"",_,A])}},W=function(){s=arguments[1].currentTarget[0].id;var t=h[s],i=e.getAllFormulaFieldsWithLabel(!1);u||(u=Handlebars.compile(J("#formula-name-items").html()));var n=J("#"+t.menuId);n.zmenu("removeMenuItems");var r=[];if(!i.length)return G(h[s].elemId,i),!1;for(var a,l,d,c=0,p=i.length;c<p;c++)a=i[c],d=o.doc.getRawFormatAt(a.start),l=u({label:d.label,fieldId:d.id}),r.push({itemType:"custom",innerHTML:l});n.zmenu("addMenuItems",r)},Y=function(t){var i=e.getFieldById(t),n=o.doc,r=n.getComputedFormatAt(i.start,"text");n.execCmd("updateFormula",["autoformula",r.formula,"",r.fieldInfos,r.label])},z=function(t){var i=e.getFieldById(t),n=o.doc.getComputedFormatAt(i.start,"text");FormulaDialog.show({formula:n.formula,label:n.label,isUpdateFormula:!0,fieldId:t,fieldInfos:n.fieldInfos})},V=function(t){var i=e.getFieldById(t);r=o.doc;var n=r.getRawFormatAt(i.start),a=n&&n.label;if(a)for(var l,d,c,u,p=e.getAllFormulaFieldsWithLabel(!0,a),g=0,f=p.length;g<f;g++)u=p[g],l=u.start,d=u.end,c=r.getContent(l,d),Op.processMsg([{r:l},{ds:c}]);else Op.processMsg([{r:i.start},{ds:r.getContent(i.start,i.end)}]);Op.sendMsg(),G(h[s].elemId,e.getAllFormulaFieldsWithLabel(!1))},j=function(){var e=Z("rclkFormulaNumberFormat");e.zmenu("removeAllMenuItems");var s,l,d,c=[];r=o.doc,a=r.getSelection();var u,p=a.getStart(),g=r.getRawFormatAt(p);if(g&&g.type==NODE_TYPE.AUTOFIELD&&"autoformula"==g.ftype){s=t.getFormulaFormat(g.formula),l=i.getRangeEnd(p);var f=n.clone(s);f.numberFormat="",d=t.calculate(f,DocTreeManager.getTreeNodeAtIndex(p)).formattedVal,d=d.replace(s.prefix,""),d=d.replace(s.suffix,"")}else{if(a.isCollapsed()){var E=a.getWord();p=E.getStart(),l=E.getEnd()}else l=a.getEnd();d=r.getContent(p,l)}FormulaUIUtil.getNumFormat(t.localeParseFloat(d));var T={itemType:"radio",label:"None",id:"tbl-numfmt-none",value:"none",appData:{action:"FormulaUIUtil.updateNumberFormat",params:""}};u=s&&isNaN(d)||isNaN(t.localeParseFloat(d))?P("none"):y("none"),T.description=u,(s&&!s.numberFormat||!s&&y("none")==d)&&(T.checked="checked"),c.push(T),c=c.concat(x(d,s,!0)),e.zmenu("addMenuItems",c)},X=function(){m||(S(),U(),m=!0)};return PubSub.subscribe("Document/ComponentInitialized",X),PubSub.subscribe("Document/LanguageChanged",U),{initFormulaSplitButtons:H,initFormula:G,updateNumberFormat:k,updateFormulaFieldsMenu:W,constructNumberFormatMenu:j,deleteFormulaField:V,editFormulaField:z,insertFormulaFieldWithLabel:Y,getNumberFormat:B,getNumberFormatConstant:R,getInverseNumberFormatConstant:O,setNumberFormatConstant:b,setInverseNumberFormatConstant:v,getNumFormat:C,initConstants:X,getOptionsArr:x,getDefFormulaCurrency:w}}(FormulaHandler,Formula,DocUtil,ZWJSONUtils,editor),FormulaDialog=function(e,t,i,n,o,r,a,s){"use strict";var l,d,c,u,p,g,f,E,T,m,h,I,_,A,S,R,O,b,v,D,L,N,P,C,y,F,M,w,x=null,B=null,H=!1,G=!1,k=function(){C={id:"noFieldsMsgItem",itemType:"custom",innerHTML:"<div class='ui-clr-note text-center ui-pad-large fs-11' style='max-width:170px'>"+J.i18n("writer.formula.NO_FILLABLE_FIELDS")+"</div>",className:"ui-custom-menuitem"},y={id:"noLabelledMsgItem",itemType:"custom",innerHTML:"<div class='ui-clr-note text-center ui-pad-large fs-11' style='max-width:170px'>"+J.i18n("writer.formula.NO_LABEL_FILLABLE_FIELDS")+"</div>",className:"ui-custom-menuitem"},M={id:"noTablesMsgItem",itemType:"custom",innerHTML:"<div class='ui-clr-note text-center ui-pad-large fs-11' style='max-width:170px'>"+J.i18n("writer.formula.NO_TABLES")+"</div>",className:"ui-custom-menuitem"},F="<div style='max-width:200px' class='text-center'>"+J.i18n("writer.formula.ONLY_ONE_FIELD_AT_ONCE")+"</div>"},W=function(){O||(R=i.doc,O=R.getSelection())},Y=function(){u[0]&&u.zselectbox("addOption",t.getOptionsArr(),"append")},z=function(){l=J("#formulaDialog"),d=J("#mailmerge-formula"),u=J("#formulaNumberFormat"),c=J("#formula-name"),p=J("#formulaPrefix"),g=J("#formulaSuffix"),f=J("#pasteFunction"),m=J("#formula-fmt-info"),h=J("#formulaPrefix,#formulaSuffix"),E=J("#formula-name-div"),T=J("#formula-insert"),W(),d.on("focus",function(){se(this)}),b||v||J("#formula-name").on("input",function(){de(this)})},Z=function(){G||(k(),t.initConstants(),I="none",_="",A="",L="",G=!0,H=H())},H=function(){return n.isSignTemplate()||n.isFillableTemplate()},V=function(e){var t,i={};for(var n in e)t=e[n],t.getName()&&(i[n]=t);return i},j=function(){x=o.getFieldMapForFormula(NODE_TYPE.FILLABLEFIELD),B=V(x),0==Object.keys(x).length?(N=!0,P=!0):0==Object.keys(B).length?(N=!1,P=!0):(N=!1,P=!1)},X={init:function(){z(),S=t.getDefFormulaCurrency(),Y(),j(),w&&w.title&&J("#formulazdialog").zdialog("setAttributes",{title:w.title});var e=R.getComputedFormatAt(O.getStart(),"text");e.fieldInfos&&e.label||w&&w.fieldInfos?(J("#formulazdialog").zdialog("setAttributes",{buttons:[{id:"current-formula-update",text:J.i18n("writer.formula.UPDATE_CURRENT_INSTANCE"),action:"FormulaDialog.unlinkAndUpdate"},{id:"formula-insert",appearance:"primary",text:J.i18n("writer.common.UPDATE_ALL"),action:"FormulaDialog.updateAll"},{text:J.i18n("writer.common.CANCEL"),action:"CLOSE"}],title:J.i18n("writer.formula.EDIT_FORMULA")}),b&&J("#current-formula-update").hide()):((b||v)&&J("#formulazdialog").zdialog("setAttributes",{buttons:[{id:"current-formula-update"},{id:"formula-insert",appearance:"primary",text:J.i18n("writer.common.UPDATE"),action:"FormulaDialog.updateAll"},{text:J.i18n("writer.common.CANCEL"),action:"CLOSE"}],title:J.i18n("writer.formula.EDIT_FORMULA")}),J("#current-formula-update").hide())},get:function(e,n){var o=O.getStart(),a={};if(w&&w.formula)a=Formula.getFormulaFormat(w.formula);else{var s=i.doc.getComputedFormatAt(o,"text");a=s&&Formula.getFormulaFormat(s.formula)||{}}a.index>=0&&(o=a.index);var l=i.doc.getRawFormatAt(o)||{},d=l.fieldInfos;switch(d&&(a.text=MailMergeUtil.changeObjectToDisplay(a.text,d)),e.action){case"formula":var c;if(a.text)c=a.text;else{c="=";var p=R.getParents(NODE_TYPE.CELL,o);if(p){var g=p.dtNode.matrixPosition,f=r.getTableAsMatrix(p.parentNode().parentNode()),T=g[0],m=g[1];re(f,T,m)?c+="SUM(ABOVE)":ae(f,T,m)&&(c+="SUM(LEFT)")}}return c;case"formulaNumberFormat":if("currencyFormat"===a.numberFormat&&S===a.currencyPositive+";"+a.currencyNegative)return"currencyFormat";if(a.numberFormat)if(t.getInverseNumberFormatConstant(a.numberFormat)&&"currencyFormat"!==a.numberFormat)I=t.getInverseNumberFormatConstant(a.numberFormat);else{"currencyFormat"===a.numberFormat?value=a.currencyPositive+";"+a.currencyNegative+"[custom-currency]":value=a.numberFormat+"[custom]";var h="custom",b=[{label:value,id:"tbl-numFmt-custom",value:h}];t.setNumberFormatConstant(h,value),t.setInverseNumberFormatConstant(value,h),u.zselectbox("addOption",b,"append"),I=h}else(a.prefix||a.suffix)&&(I="novalue",ee("disable"),te("show"));return"none"===I&&ie("disable"),I;case"formulaPrefix":return a.prefix?U.unescape(a.prefix):_;case"formulaSuffix":return a.suffix?U.unescape(a.suffix):A;case"formulaName":return w&&w.label?(E.removeClass("ui-hide"),U.unescape(w.label)):l.label?(E.removeClass("ui-hide"),U.unescape(l.label)):""}},set:function(e,i,n){if("chooseFn"==e.action){var o=d[0],r=ne(o),a=r.end+i.length-1,s=d.val();d.val(s.substr(0,r.end)+i+s.substr(r.end)),oe(o,a,a),f.zselectbox("setAttribute","selectedValue","none"),d.focus()}if("formulaNumberFormat"===e.action&&("none"===i?(ie("disable"),h.val(""),m.attr("hidden",!1)):"disabled"===h.attr("disabled")&&ie("enable")),"formulaPrefix"==e.action||"formulaSuffix"==e.action){var l;l="formulaPrefix"===e.action?g:p;var c=t.getNumberFormatConstant(u.val());0!==i.length||0!==l.val().length?("none"===c&&(te("show"),u.zselectbox("setValue","novalue")),ee("disable")):(document.getElementById("tbl-numfmt-none").disabled&&ee("enable"),"novalue"===c&&(te("hide"),u.zselectbox("setValue","none")))}}},K=function(e){var t=[];if(N)t.push(C);else if(P)t.push(y);else for(var i in B){var n=B[i],o=n.getName();t.push({id:i,appData:{action:"FormulaDialog.insertFieldInText",params:[e,o]},label:o,name:o,icon:FillableFieldsHandler.getFieldIconClass(n.getFillableFieldType())})}return t},q=function(e){var t=TableCollectionInstance.getAllTableNames(!0),i=[];if(0==t.length)i.push(M);else for(var n=0,o=t.length;n<o;n++){var r=t[n],a=FIELD_PARENTHESIS.TABLE_REF_START+r+FIELD_PARENTHESIS.OPEN_PARENTHESIS+"cell"+FIELD_PARENTHESIS.CLOSE_PARENTHESIS+FIELD_PARENTHESIS.TABLE_REF_END;i.push({id:r,appData:{action:"FormulaDialog.insertFieldInText",params:[e,a,!0]},customAttributes:{title:a},label:a,name:a,SVGIconId:"zw-ins-tbl zmenu__svg"})}return i},Q=function(e,t){var i=J(e.target);i.zmenu(),i.zmenu("removeAllMenuItems");var n="fillable-fieldmenu"==i[0].id,o=n?t.forElement.attr("fillable-zmenu-data"):t.forElement.attr("tableref-zmenu-data"),r=JSON.parse(o),s=r.target,l=n?K(s):q(s);i.zmenu("addMenuItems",l),i.unbind("zmenuitemclick").bind("zmenuitemclick",function(e,t){a._itemClicked(e,t)}),i.unbind("zmenusubmenuitemclick").bind("zmenusubmenuitemclick",function(e,t){a._itemClicked(e,t)})},$=function(e){var t,i=e[0],n=J(i),o=n[0].selectionStart,r=n[0].selectionEnd,a=n.val(),s=!!e[2]&&e[2];t=s?e[1]:FIELD_PARENTHESIS.FILLABLE_START+e[1]+FIELD_PARENTHESIS.FILLABLE_END;var l=a.slice(0,o)+t+a.slice(r),d=n.attr("max");d&&l.length>d||(n.val(l),n.focus())},ee=function(e){"disable"===e?u.zselectbox("setOptionAttributes","#tbl-numfmt-none","disabled",!0):"enable"===e&&u.zselectbox("setOptionAttributes","#tbl-numfmt-none","disabled",!1)},te=function(e){"hide"===e?u.zselectbox("setOptionAttributes",["#tbl-numfmt-novalue","#tbl-numfmt-novalue-sep"],"hidden",!0):"show"===e&&u.zselectbox("setOptionAttributes",["#tbl-numfmt-novalue","#tbl-numfmt-novalue-sep"],"hidden",!1)},ie=function(e){"disable"===e?(h.attr("disabled",!0),h.addClass("is-disabled"),m.attr("hidden",!1)):"enable"===e&&(h.attr("disabled",!1),h.removeClass("is-disabled"),m.attr("hidden",!0))},ne=function(e){if(document.selection){e.focus();var t=document.selection.createRange(),i=t.text.length;t.moveStart("character",-e.value.length);var n=t.text.length-i;return{start:n,end:n+i}}return e.selectionStart||"0"==e.selectionStart?{start:e.selectionStart,end:e.selectionEnd}:{start:0,end:0}},oe=function(e,t,i){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,i);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",t),n.select()}},re=function(e,t,i){if(t>0){for(var n=t-1;n>=0;n--){var o=e[n][i],r=R.getContent(o.getStart()+1,o.getEnd());if(r=r.replace(/(\n)/g,""),""!=r)return!0}return!1}},ae=function(e,t,i){if(i>0){for(var n=i-1;n>=0;n--){var o=e[t][n],r=R.getContent(o.getStart()+1,o.getEnd());if(r=r.replace(/(\n)/g,""),""!=r)return!0}return!1}},se=function(e){var t=new ZWFieldParser(e.value);t.isMergeField()||t.isFillableField()?E.removeClass("ui-hide"):E.addClass("ui-hide"),t.destroy()},le=function(){var e=new ZWFieldParser(d.val()),t=J("#merge-fields"),i=J("#fillable-fields");H&&t.hide(),e.isMergeField()?(t.removeClass("is-disabled"),i.addClass("is-disabled"),t[0].removeAttribute("title"),t[0].removeAttribute("data-title-innerhtml"),i[0].setAttribute("data-title-innerhtml",F),i[0].setAttribute("title"," ")):e.isFillableField()?(t.addClass("is-disabled"),i.removeClass("is-disabled"),t[0].setAttribute("title"," "),t[0].setAttribute("data-title-innerhtml",F),i[0].removeAttribute("title"),i[0].removeAttribute("data-title-innerhtml")):(t.removeClass("is-disabled"),i.removeClass("is-disabled"),t[0].removeAttribute("title"),i[0].removeAttribute("title"),t[0].removeAttribute("data-title-innerhtml"),i[0].removeAttribute("data-title-innerhtml")),e.destroy()},de=function(e){var t;t=e.value?J.i18n("writer.formula.SAVE_AND_INSERT"):J.i18n("writer.common.INSERT"),T.text(t)},ce=function(e){w=e,b=!(!e||!e.isUpdateFormula),v=!(!e||!e.isEditFlow),L=e&&e.fieldId,R=i.doc,O=R.getSelection(),v&&!L&&(L=R.getComputedFormatAt(O.getStart(),"text").id),Z(),PubSub.publish("MailMerge/LoadLazyFiles"),J.dialogutil.open("formula",null,X,null,{onLoad:this.setFocus}),setTimeout(function(){J("#mailmerge-formula").focus()},200)},ue=function(){D=!0,ge()},pe=function(){b=!0,ge()},ge=function(){var n=l.zvalidation("validateAllFields",l);if(n){var o,r,a=d.val();L?(r=e.getFieldById(L),o=r.start):o=i.doc.getSelection().getStart();var u=new ZWFieldParser(a),p=u.checkFormula(DocTreeManager.getTreeNodeAtIndex(o));if(!p.isValid){var g=J("#formula-error-label");return g.text(p.message),g.removeClass("ui-hide"),void d.on("focus",function(){g.addClass("ui-hide")})}var f=u.getAllTableNamesInFormula(),E=TableCollectionInstance.getUnmappedTableNames();if(f.length>0&&E.length>0){for(var T,m=DocOpBuilder.build([]),h=0,I=f.length;h<I;h++){var _=f[h];if(E.contains(_)){var A=TableCollectionInstance.getTableIdFromName(_),S=DocTreeManager.getTableById(A);S&&(T=TableRenameDialog.getRenameOp(_,S.start),m.applyOp(DocOpBuilder.build(T)))}}Op.processMsg(m.toJson())}u.destroy();var p=Ee(a),v=c.val(),N=!1;if(p.fieldInfos&&v){var P=!1;if(r){var C=R.getRawFormatAt(r.start);C&&C.label!=v&&(N=!0)}else N=!0;if(N){for(var y=e.getAllFormulaFieldsWithLabel(!1),h=0,I=y.length;h<I;h++)if(R.getRawFormatAt(y[h].start).label==v){P=!0;break}if(P){var F=J("#formula-name-error-label"),M=J("#formula-name-label");return M.addClass("ui-hide"),F.removeClass("ui-hide"),void J("#formula-name").on("focus",function(){F.addClass("ui-hide"),M.removeClass("ui-hide")})}}}if(w&&w.callback)w.callback({formula:p.formula});else{if(v=p.fieldInfos?v:"",D){O=i.doc.getSelection();var U;U=O.isCollapsed()?O.getEnd()+1:O.getEnd(),v=N?v:"",p.fields=s.getAllFieldsRanges("autoformula",O.getStart(),U),e.handleUpdateFlow(p,v)}else if(b){var r=e.getFieldById(L),x=R.getComputedFormatAt(r.start,"text");r&&x.fieldInfos&&x.label?p.fields=e.getAllFormulaFieldsWithLabel(!0,R.getRawFormatAt(r.start).label):p.fields=[r],e.handleUpdateFlow(p,v)}else R.execCmd("updateFormula",["autoformula",p.formula,"",p.fieldInfos,v,p.tableInfos]);t.initFormulaSplitButtons()}J.dialogutil.close("formula")}},fe=function(){b=!1,v=!1,D=!1,L="",I="none",_="",A="",S=""},Ee=function(e){e=e&&e.trim();var n,o,r=u.val(),a=d.val(),s=new ZWFieldParser(a);if(s.isMergeField()){var l={},c=DocTreeManager.getTreeNodeAtIndex(i.doc.getSelection().getStart());if(c.isContainsFormula()){var f=c.getFormula(),E=f.index||0,T=i.doc.getRawFormatAt(E)||{};l=T.fieldInfos||{}}o=MailMergeUtil.getFieldMappingFromObject(a,{includeRlFields:!0,mapping:l}),a=MailMergeUtil.changeObjectToStore(a,{includeRlFields:!0,mapping:o}),e=a}else s.isFillableField()&&(o=s.getFieldInfosForFillable(a));s.destroy(),n=t.getNumberFormat(r);var m=Formula.removeLeadingWhiteSpace(U.escape(p.val()))||_,h=Formula.removeTrailingWhiteSpace(U.escape(g.val()))||A;return e=Formula.createFormulaFieldString(e,n,m,h),{formula:e,fieldInfos:o}},Te=function(){fe();var e=J("#mm-field-catmenu");e&&e.remove()};return{show:ce,beforeClosePopup:Te,enterFormula:ge,unlinkAndUpdate:ue,updateAll:pe,onFormulaMenuBeforeShow:le,insertFieldInText:$,populateFillableOrTableList:Q,onInput:se}}(FormulaHandler,FormulaUIUtil,editor,Macros,Utils,TableUtil,UIUtils,DocUtil),FormulaVisualCueHandler=function(){var e={editFormula:{label:J.i18n("writer.formula.EDIT_FORMULA"),icon:"ui-sprit-lazy ui-icon-edit-sm",appData:{action:"FormulaVisualCueHandler.editFormulaField()"}},goToTableLabel:{itemType:"custom",innerHTML:"<div class='zmenu__text'>"+J.i18n("writer.formula.GO_TO_TABLE")+"</div>",className:"ui-custom-menuitem zmenu-ttl-with-line",isHeader:!0}},t=function(){var e=editor.doc.getSelection();if((e.selectionType===SEL_MOUSE||e.selectionType===SEL_OP_GEN)&&(!editor.doc.getSelection().selectionType!=SEL_MOUSE||Lock.isIdxInLockArea(dateField.getStart().start,editorProps.userInfo.zuid))){var t=editor.getDocument().getSelection().getRangeAt(0),n=t.getStartNode()||{},o=n.rawFormat||{};if("autoformula"==o.ftype){var r=Formula.getFormulaFormat(o.formula),a=new ZWFieldParser(r.text),s=a.checkFormula(DocTreeManager.getTreeNodeAtIndex(e.getStart())),l=J("#formula-cue-error-label");if(s.isValid){var d=J("#formula-more-options-btn");if(editor.getRole().permissions.can("document.edit")){var c=J("#formula-edit-btn");a.isTableReferenceField()?(d.zmenubutton(),d.removeClass("ui-hide"),c.addClass("ui-hide")):(d.addClass("ui-hide"),c.removeClass("ui-hide")),l.addClass("ui-hide")}else d.addClass("ui-hide")}else l.text(s.message),l.removeClass("ui-hide");a.destroy(),i()}}},i=function(){var e,t=editor.getDocument().getSelection().getRangeAt(0),i=t.getStartNode()||{},o=i.rawFormat||{};if("autoformula"==o.ftype){e=J(editor.doc.getPortionData(t.start+1).node),e.hasClass("zeroSize")&&(e=e.next());var r=e.offset(),a=editor.jeditorPane.offset(),s=document.getElementById("formula-vc-popup"),l=J("#formula-vc-popup-value"),d=Formula.getFormulaFormat(o.formula).text;o.fieldInfos&&(d=MailMergeUtil.changeObjectToDisplay(d,o.fieldInfos)),l.text(d),s.style.display="block",s.style.top=r.top-a.top-s.offsetHeight-7+"px",s.style.left=r.left-a.left-s.offsetWidth/2+e.width()/2+"px",s.style.zIndex=20,n(t.start)}},n=function(e){var t=editor.doc.getPortionData(e+2).node;J(t).addClass("ui-active-bg-clr")},o=function(){Z("formula-vc-popup").hide(),editor.jeditorPane.find(".autoformula.ui-active-bg-clr").removeClass("ui-active-bg-clr")},r=function(){var e=editor.doc,t=e.getSelection(),i=e.getRawFormatAt(t.getStart());i&&"autofield"==i.type&&"autoformula"==i.ftype&&FormulaDialog.show({formula:i.formula,label:i.label,isEditFlow:!0,fieldId:i.id})},a=function(e){var t=editor.doc,i=t.getSelection(),n=t.getRawFormatAt(i.getStart()),o=i.getStart();if(n&&"autofield"==n.type&&"autoformula"==n.ftype){var r=n.formula,a=new ZWFieldParser(r);if(a.isTableReferenceField()){var s=TableCollectionInstance.getTableIdFromName(e),l=DocTreeManager.getTableById(s);if(l){var d=l.getFirstChildNodeOfGivenType(NODE_TYPE.PARA);o=d&&d.getIndex()}}a.destroy()}EditorUtil.moveToIndex(o),EditorUtil.focusMultiByteSpan()};PubSub.subscribeOnce("Cursor/Collapsed",function(){editor.doc.getSelection().bind(NODE_TYPE.AUTOFIELD,{onSelect:FormulaVisualCueHandler.init,onDeselect:FormulaVisualCueHandler.hide})});var s=function(t){var i=[];if(1==t.length){var n={itemType:"custom",innerHTML:"<div class='zmenu__iconcontainer'><svg class='zmenu__icon'><use xlink:href='#zw-ins-tbl'></use></svg></div><span class='zmenu__text' title='"+t[0]+"'><span>"+J.i18n("writer.formula.GO_TO_TABLE")+"</span><span class='ui-left-margin-verysmall'>'"+t[0]+"'</span></span>",appData:{action:"FormulaVisualCueHandler.goToTable",params:[t[0]]}};i.push(n)}else{i.push(e.goToTableLabel);for(var o=0,r=t.length;o<r;o++)i.push({appData:{action:"FormulaVisualCueHandler.goToTable",params:[t[o]]},customAttributes:{title:t[o]},label:t[o],name:t[o],SVGIconId:"zw-ins-tbl zmenu__svg"})}return i},l=function(){var t=J("#formula-viewmenu-opt");t.zmenu(),t.zmenu("removeAllMenuItems");var i=[];i.push(e.editFormula);var n=editor.doc,o=n.getSelection(),r=n.getRawFormatAt(o.getStart());o.getStart();if(r&&"autofield"==r.type&&"autoformula"==r.ftype){var a=r.formula,l=new ZWFieldParser(a);if(l.isTableReferenceField()){var d=l.getAllTableNamesInFormula(!1);i=i.concat(s(d))}l.destroy()}t.zmenu("addMenuItems",i),t.unbind("zmenuitemclick").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)})};return{init:t,hide:o,editFormulaField:r,goToTable:a,beforeMenuShow:l}}(),ChartDlg=function(){function e(){var e=s.xAxis.labels.value[0],t=MailMergeUtil.getFieldIdsListUsedInObject(e),i=!1;return t&&t.length>0&&s.aggregate.enabled&&(i=!0),i?u.groupByDiv.show("flex"):u.groupByDiv.hide(),i}var t,i,n,o,r,a,s,l,d,c={xAxisInput:"#mailmerge-chart-xaxis",xAxisErrorlbl:"#xaxis-error-display",seriesInput:"#chart-multiseries-field",seriesErrorlbl:"#series-error-display",xAxisFieldIcon:"#xaxis-field-icon",chartSeriesDiv:"#chart-series-div",onlyForMainField:".only-for-mainfield",seriesTitle:"#series-title",singleSeriesRBtn:"#singleseries_rbtnLabel",aggregateDiv:"#chart-aggregate-div",aggregateOperation:"#aggregate-operationContainer",groupByDiv:"#chart-groupby-div",groupByField:"#chartdlg-groupby-fieldContainer"},u={},p={DLG:"chartconfigurationdialog",PIE_DOUGHNUT:["Pie","Doughnut"],SPIDER_PIE_DOUGHNUT:["Spider Web","Pie","Doughnut"],DEFAULT_LABEL_LENGTH:4},g={type:"chart_type",width:"chartWidth",height:"chartHeight",legend:{enabled:"chartLegendEnable"},title:{text:"chartTitle"},xAxis:{labels:{enabled:"x-axis-label-display",value:"add-label-x-axis"},serieslabel:"add-multiseries-field",title:"horizontal-axis-title"},yAxis:{labels:{enabled:"y-axis-label-display",value:"add-label-y-axis"},title:"vertical-axis-title"},advancedOptions:{color:"colorName"},ts:{fw:"fontBold",fs:"fontItalic",fc:"fontColor"},aggregate:{enabled:"aggregateEnabled",operation:"aggregateOperation"},groupBy:{enabled:"groupByEnabled",field:"groupByField"}},f=[g.xAxis.labels.enabled,g.yAxis.labels.enabled,g.legend.enabled,g.title.text,g.xAxis.title,g.yAxis.title,g.advancedOptions.color,g.ts.fw,g.ts.fs,g.ts.fc,"all"],E={Column:"#zw-chart1","Stacked Column":"#zw-chart2",Bar:"#zw-chart5","Stacked Bar":"#zw-chart6",Line:"#zw-chart9",Spline:"#zw-chart10",Pie:"#zw-chart13",Doughnut:"#zw-chart15","Spider Web":"#zw-chart29"},T=[],m=[],h={init:function(){for(key in c)u[key]=W.get(c[key]);if(t&&t.chartId?(s=t,s.xAxis.labels.value[0]=MailMergeUtil.changeObjectToDisplay(t.xAxis.labels.value[0],a.mminfo.mapping),s.xAxis.serieslabel[0]=MailMergeUtil.changeObjectToDisplay(t.xAxis.serieslabel[0],a.mminfo.mapping),s.title.text=MailMergeUtil.changeObjectToDisplay(t.title.text,a.mminfo.mapping),s.groupBy.field=MailMergeUtil.changeObjectToDisplay(t.groupBy.field,a.mminfo.mapping),J("#saveChartOptions").text(J.i18n("writer.common.UPDATE"))):(s=ChartUtils.getDefaultChartValue(),s.chartId="chart_"+Math.floor(123456789*Math.random())),J("#chartFieldMenu").off("zmenuitemclick").on("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),s.series=t.chartId?t.series:"singleseries",t&&n&&n.id){s.series="multiseries",n=MailMergeFieldUtil.getRLNameInfo(n.id)||n,u.singleSeriesRBtn.addClass("ui-zwdisabled"),u.singleSeriesRBtn.parent().attr({title:J.i18n("writer.chart.NO_SUBFORM_SUPPORT")});for(var e=[J("#xaxis-field-icon"),J("#series-field-icon")],o=0;o<e.length;o++){var r=JSON.parse(e[o].attr("mm-zmenu-data"));r.isRLChart=!0,r.listRepeatFields=!0,r.repeatInfo={info:n},e[o].attr("mm-zmenu-data",JSON.stringify(r))}}var l=MailMergeUtil.getFieldIdsListUsedInObject(s.xAxis.labels.value[0]);"multiseries"===s.series&&l&&l.length>0&&u.xAxisFieldIcon.addClass("ui-state-disabled"),J("#chartconfigurationdialogzdialog").parent().on("remove",function(){t=i="",O()}),I(!0),A([s.type]);for(var d=[],p=J("#chartdlg-groupby-field"),g=MMFieldSettingsDlgHandler.getFieldsToListInValue(),o=0;o<g.length;o++){var f=g[o].display_name;d.push({label:f,value:UNICODE.MERGEFIELD_START+f+UNICODE.MERGEFIELD_END})}p.zselectbox("addOption",d);var E=d[0];""===s.groupBy.field&&E&&(E&&p.zselectbox("setValue",E.value),s.groupBy.field=E.value)},get:function(e,t,i){switch(N(e.action),e.action){case g.advancedOptions.color:return s.advancedOptions.color;case g.xAxis.serieslabel:return s.xAxis.serieslabel[0];case g.title.text:return s.title.text;case g.type:return s.type;case g.xAxis.labels.value:return s.xAxis.labels.value[0];case g.xAxis.title:return s.xAxis.title.text;case g.yAxis.title:return s.yAxis.title.text;case g.xAxis.labels.enabled:return s.xAxis.labels.enabled;case g.yAxis.labels.enabled:return s.yAxis.labels.enabled;case g.legend.enabled:return s.legend.enabled;case g.aggregate.enabled:return s.aggregate.enabled?u.aggregateOperation.removeClass("is-disabled"):u.aggregateOperation.addClass("is-disabled"),s.aggregate.enabled;case g.aggregate.operation:return s.aggregate.operation;case g.groupBy.enabled:return s.groupBy.enabled?u.groupByField.removeClass("is-disabled"):u.groupByField.addClass("is-disabled"),s.groupBy.enabled;case g.groupBy.field:return s.groupBy.field;case"multiseries":case"singleseries":return s.series===e.action}},set:function(t,i){var n="";switch(t.action){case g.xAxis.serieslabel:n=s.xAxis.serieslabel[0],s.xAxis.serieslabel[0]=i;break;case g.advancedOptions.color:n=s.advancedOptions.color,s.advancedOptions.color=i;break;case g.title.text:n=s.title.text,s.title.text=i;break;case g.type:s.type=i;break;case g.xAxis.labels.value:n=s.xAxis.labels.value[0];var o=MailMergeUtil.getFieldIdsListUsedInObject(i);if("singleseries"===s.series||!o||o.length<1)u.xAxisFieldIcon.removeClass("ui-state-disabled");else if(u.xAxisFieldIcon.addClass("ui-state-disabled"),o.length>1)return S(u.xAxisInput,u.xAxisErrorlbl,J.i18n("writer.chart.MULTISERIES_CATEGORY_ERR")),void J("#mailmerge-chart-xaxis").val(n);s.xAxis.labels.value[0]=i;break;case g.xAxis.title:n=s.xAxis.title.text,s.xAxis.title.text=i;break;case g.yAxis.title:n=s.yAxis.title.text,s.yAxis.title.text=i;break;case g.xAxis.labels.enabled:s.xAxis.labels.enabled=i;break;case g.yAxis.labels.enabled:s.yAxis.labels.enabled=i;break;case g.legend.enabled:s.legend.enabled=i;break;case g.aggregate.enabled:s.aggregate.enabled=i,s.aggregate.enabled?u.aggregateOperation.removeClass("is-disabled"):u.aggregateOperation.addClass("is-disabled");break;case g.aggregate.operation:s.aggregate.operation=i;break;case g.groupBy.enabled:s.groupBy.enabled=i,s.groupBy.enabled?u.groupByField.removeClass("is-disabled"):u.groupByField.addClass("is-disabled");break;case g.groupBy.field:s.groupBy.field=i;break;case"multiseries":case"singleseries":s.series!==t.action&&(s.series=t.action,I());break;case g.ts.fw:i="normal"===s.ts.fw?"bold":"normal",s.ts.fw=i;break;case g.ts.fs:i="normal"===s.ts.fs?"italic":"normal",s.ts.fs=i}"string"==typeof i&&n.trim()===i.trim()||N(t.action),e()}},I=function(t){var i=s.advancedOptions.color,o=ChartUtils.getVariation(i);if(null!=o){var r=i.indexOf(o);if(ChartUtils.isSingleSeriesWithSameColor(s))i[r].indexOf("/")===-1&&(i[r]+="/1");else{var a=o.match(/\d+/)[0];a<=ChartUtils.getRandomVariationCount()?i[r]=i[r].split("/")[0]:i[r]="v1"}}t||(J(".toggle-series").val(" "),s.xAxis.labels.value[0]=s.xAxis.serieslabel[0]=s.title.text="",u.xAxisFieldIcon.removeClass("ui-state-disabled")),"multiseries"===s.series?(J(".only-for-singleseries").hide(),J(".only-for-multipleseries").show()):(J(".only-for-multipleseries").hide(),J(".only-for-singleseries").show()),s.type.startsWith("Stacked")||p.PIE_DOUGHNUT.indexOf(s.type)!==-1||"multiseries"===s.series?J("#chart-display-legend-Label").show():J("#chart-display-legend-Label").hide(),n.id||"multiseries"!==s.series?J("#chart-tile-field-addBtn").show():J("#chart-tile-field-addBtn").hide(),J("#chart-field-series-info").text(),l&&l.canvas&&l.destroy(),e(),l=m=[],N("init"),N("all")},_=function(e,t){var i=ZWColorUtils.rgbToHex(t.color).toUpperCase();i!==s.ts.fc&&(s.ts.fc=i,N(g.ts.fc))},A=function(e){var t=e[0];s.type=t,J(J("#chart_type_btn").find("use")[0]).attr("xlink:href",E[t]),J("#chart_type_btn").find("[class=zbutton__text]").text(e[0]),I(!0),["Spider Web","Pie","Doughnut"].indexOf(t)!==-1?(J("#chart-xAxis-label-displayLabel").hide(),J("#chart-yAxis-label-displayLabel").hide()):(J("#chart-xAxis-label-displayLabel").show(),J("#chart-yAxis-label-displayLabel").show())},S=function(e,t,i){t.text(i),t.removeClass("ui-hide"),e.addClass("ui-validation-error"),setTimeout(function(){t.addClass("ui-hide"),e.removeClass("ui-validation-error")},3e3)},R=function(){var i=MailMergeUtil.getFieldIdsListUsedInObject(s.xAxis.serieslabel[0]),l=MailMergeUtil.getFieldIdsListUsedInObject(s.xAxis.labels.value[0]);if(!(s.aggregate.enabled&&"singleseries"!==s.series||l&&!(l.length<1)))return void S(u.xAxisInput,u.xAxisErrorlbl,J.i18n("writer.chart.CATEGORY_MINIMUM_FIELD_ERR"));if("multiseries"===s.series&&(!i||i.length<1))return void S(u.seriesInput,u.seriesErrorlbl,J.i18n("writer.chart.SERIES_MINIMUM_FIELD_ERR"));e()||(s.groupBy.enabled=!1);var d=MailMergeUtil.getFieldMappingFromObject(s.xAxis.labels.value[0]+s.title.text+s.xAxis.serieslabel[0]+s.groupBy.field,{includeRlFields:!0,mapping:a.type===NODE_TYPE.CHART&&a.mminfo?a.mminfo.mapping:void 0}),c={mapping:d,subFormInfo:n};if(s.xAxis.labels.value[0]=MailMergeUtil.changeObjectToStore(s.xAxis.labels.value[0],{includeRlFields:!0,mapping:d}),s.xAxis.serieslabel[0]=MailMergeUtil.changeObjectToStore(s.xAxis.serieslabel[0],{includeRlFields:!0,mapping:d}),s.title.text=MailMergeUtil.changeObjectToStore(s.title.text,{includeRlFields:!0,mapping:d}),s.groupBy.field=MailMergeUtil.changeObjectToStore(s.groupBy.field,{includeRlFields:!0,mapping:d}),s.height+=.001,s.width+=.001,t.chartId){a.chartDetails=s,a.mminfo=c;var p=[{r:o},{as:{start:a,id:r}},{r:1},{as:{end:ZWJSONUtils.getKeys(a),id:r}}];Op.processMsg(p),Op.sendMsg(p)}else editor.doc.execCmd("insertChart",{chartDetails:s,mminfo:c,ht:s.height,wid:s.width});ActivityTracker.trackChartStats(s.type.replace(/\s/g,""),s.series.replace(/\s/g,""),s.aggregate.enabled?s.aggregate.operation.replace(/\s/g,""):"none"),O()},O=function(){l&&l.canvas&&l.destroy(),l=m=[],J.dialogutil.close(p.DLG)},b=function(e,t,i){e.data.labels=t;for(var n=(e.data.datasets,0);n<m.length;n++)m[n].data=i;e.update()},v=function(e,t,i){e.data.labels=t;for(var n=0;n<i.length;n++)e.data.datasets.push(i[n]);e.update()},D=function(e){e.data.labels=[],e.data.datasets=[],e.update()},L=function(e,t){return Array.apply(null,Array(e)).map(function(){for(var e=0;e<40;)e=Math.round(Math.random()*t);return e})},N=function(e){var t,i=[],n=ZWJSONUtils.clone(s.advancedOptions.color);if(ChartUtils.replaceChartDefaultColors(n),"singleseries"!==s.series||p.PIE_DOUGHNUT.indexOf(s.type)!==-1||s.type.startsWith("Stacked")||(n=[n[0]]),[g.xAxis.labels.value,g.xAxis.serieslabel,g.groupBy.enabled,g.groupBy.field,"all"].indexOf(e)===-1){if(e!==g.xAxis.labels.enabled&&"all"!==e||(d.scales.x.display=p.SPIDER_PIE_DOUGHNUT.indexOf(s.type)===-1&&s.xAxis.labels.enabled),e!==g.yAxis.labels.enabled&&"all"!==e||(d.scales.y.display=p.SPIDER_PIE_DOUGHNUT.indexOf(s.type)===-1&&s.yAxis.labels.enabled),e!==g.legend.enabled&&"all"!==e||(d.plugins.legend.display=s.legend.enabled&&(p.PIE_DOUGHNUT.indexOf(s.type)!==-1||"multiseries"===s.series||s.type.startsWith("Stacked"))),e!==g.title.text&&"all"!==e||(d.plugins.title.text=s.title.text,d.plugins.title.display=!!s.title.text),e!==g.xAxis.title&&"all"!==e||(d.scales.x.title.text=s.xAxis.title.text,d.scales.x.title.display=!!s.xAxis.title.text),e!==g.yAxis.title&&"all"!==e||(d.scales.y.title.text=s.yAxis.title.text,d.scales.y.title.display=!!s.yAxis.title.text),e===g.ts.fw||"all"===e){var o=s.ts.fw;d.plugins.title.font.weight=d.plugins.legend.labels.font.weight=d.scales.x.ticks.font.weight=d.scales.y.ticks.font.weight=d.scales.x.title.font.weight=d.scales.y.title.font.weight=o}if(e===g.ts.fs||"all"===e){var r=s.ts.fs;d.plugins.title.font.style=d.plugins.legend.labels.font.style=d.scales.x.ticks.font.style=d.scales.y.ticks.font.style=d.scales.x.title.font.style=d.scales.y.title.font.style=r}if(e===g.ts.fc||"all"===e){var a=s.ts.fc;d.plugins.title.color=d.plugins.legend.labels.color=d.scales.x.ticks.color=d.scales.y.ticks.color=d.scales.x.title.color=d.scales.y.title.color=a}if(e===g.advancedOptions.color||"all"===e){if("singleseries"===s.series||p.PIE_DOUGHNUT.indexOf(s.type)!==-1)l.data.datasets[0].backgroundColor="Spider Web"===s.type?n[0].replace("rgb","rgba").replace(")",", 0.2)"):n,l.data.datasets[0].borderColor=p.PIE_DOUGHNUT.indexOf(s.type)===-1?n:"#FFFFFF";else{var c=0;l.data.datasets.forEach(function(e){e.backgroundColor="Spider Web"===s.type?n[c].replace("rgb","rgba").replace(")",", 0.2)"):n[c],e.borderColor=n[c++]})}l.update()}if("init"===e){T=[];for(var c=1;c<=p.DEFAULT_LABEL_LENGTH;c++)T.push(J.i18n("writer.common.LABEL")+" "+c);if(t=L(T.length,100),"singleseries"===s.series||p.PIE_DOUGHNUT.indexOf(s.type)!==-1)if(s.type.startsWith("Stacked")){m=[];for(var c=0;c<T.length;c++)m.push({data:t[c],label:"Series "+(c+1),backgroundColor:n[c],borderColor:n})}else m.push({data:t,backgroundColor:"Spider Web"===s.type?n[0].replace("rgb","rgba").replace(")",", 0.2)"):n,borderColor:p.PIE_DOUGHNUT.indexOf(s.type)===-1?n[0]:"#FFFFFF",tension:"Spline"===s.type?.5:0});else for(c=0;c<T.length;c++)t=L(T.length,100),m.push({label:"Series "+(c+1),backgroundColor:"Spider Web"===s.type?n[c].replace("rgb","rgba").replace(")",", 0.2)"):n[c],borderColor:n[c],data:t,tension:"Spline"===s.type?.5:0});var u={labels:"singleseries"===s.series&&s.type.startsWith("Stacked")?[" "]:T,datasets:m};d={aspectRatio:1,plugins:{title:{display:!!s.title.text,text:s.title.text,color:s.ts.fc,font:{style:s.ts.fs,weight:s.ts.fw}},legend:{display:("multiseries"===s.series||s.type.startsWith("Stacked")||p.PIE_DOUGHNUT.indexOf(s.type)!==-1)&&s.legend.enabled,labels:{usePointStyle:!0,pointStyle:"circle",color:s.ts.fc,font:{style:s.ts.fs,weight:s.ts.fw}}}},scales:{x:{display:p.SPIDER_PIE_DOUGHNUT.indexOf(s.type)===-1&&s.xAxis.labels.enabled,grid:{display:s.type.indexOf("Bar")!==-1},ticks:{color:s.ts.fc,font:{style:s.ts.fs,weight:s.ts.fw}},title:{display:!!s.xAxis.title.text,text:s.xAxis.title.text,color:s.ts.fc,font:{style:s.ts.fs,weight:s.ts.fw}}},y:{display:p.SPIDER_PIE_DOUGHNUT.indexOf(s.type)===-1&&s.yAxis.labels.enabled,grid:{display:s.type.indexOf("Bar")===-1},ticks:{color:s.ts.fc,font:{style:s.ts.fs,weight:s.ts.fw}},title:{display:!!s.yAxis.title.text,text:s.yAxis.title.text,color:s.ts.fc,font:{style:s.ts.fs,weight:s.ts.fw}}}}};var E=s.type;switch(E){case"Column":E="bar";break;case"Spline":E="line",d.elements={tension:0};break;case"Bar":E="bar",d.indexAxis="y";break;case"Stacked Bar":d.indexAxis="y";case"Stacked Column":E="bar",d.scales.x.stacked=!0,d.scales.y.stacked=!0;break;case"Spider Web":d.scales.x.display=d.scales.y.display=!1,E="radar";break;case"Pie":case"Doughnut":d.scales.x.display=d.scales.y.display=!1;case"Line":E=E.toLowerCase()}l=new Chart(document.getElementById("chart-canvas"),{type:E,data:u,options:d})}f.indexOf(e)!=-1&&(l.options=d,l.update())}else{for(var h=Object.values(MailMergeUtil.getFieldMappingFromObject(s.xAxis.labels.value[0])),c=0;c<h.length;c++)i.push(h[c].display_name);if("singleseries"===s.series)if(i=i[0]?i:T,t=L(i.length,100),s.type.startsWith("Stacked")){D(l),m=[];for(var c=0;c<i.length;c++)m.push({data:[t[c]],label:i[c],backgroundColor:n[c],borderColor:n});v(l,[" "],m)}else l.data.labels=[],b(l,i,t);else{if(i)for(var c=1;c<p.DEFAULT_LABEL_LENGTH;c++)i.push(i[0]);i=i[0]?i:T;var I=[];if([g.xAxis.serieslabel,g.groupBy.enabled,g.groupBy.field,"all"].indexOf(e)!==-1&&p.PIE_DOUGHNUT.indexOf(s.type)===-1){c=0;var _;if(s.groupBy.enabled){var _=Object.values(MailMergeUtil.getFieldMappingFromObject(s.groupBy.field));_&&_.push(_[0])}else _=Object.values(MailMergeUtil.getFieldMappingFromObject(s.xAxis.serieslabel[0]));_.forEach(function(e){t=L(p.DEFAULT_LABEL_LENGTH,100),I.push({label:e.display_name,backgroundColor:"Spider Web"===s.type?n[c].replace("rgb","rgba").replace(")",", 0.2)"):n[c],borderColor:n[c],data:t,tension:"Spline"===s.type?.5:0}),c++})}else I=l.data.datasets;I=I.length>0?I:m,D(l),v(l,i,I)}}},P=function(e){o=editor.doc.getSelection()[0].start,r=editor.doc.getRawFormatAt(o),a=DocUtil.copyStyle(editor.doc.getRawFormatAt(o)),a.chartDetails&&a.hasOwnProperty(MAILMERGE.MMINFO)&&"UpdateChart"===e?(e=a.chartDetails,n=a.mminfo.subFormInfo||{},J("#saveChartOptions").text(J.i18n("writer.common.UPDATE"))):(e=JSON.parse(e||"{}"),n=e.subFormInfo||{type:"main_fields"}),t=e,e&&n&&n.id?MMFieldSettingsDlgHandler.setFieldsToListInValue(void 0,!0,n):MMFieldSettingsDlgHandler.setFieldsToListInValue(void 0,!0),J.dialogutil.open(p.DLG,null,h)};return{openDlg:P,saveChartOptions:R,saveChartType:A,saveFontColor:_,chartPreview:N,closeDlg:O}}();TableSortDialog=function(){var e,t,i,n,o,r,a,s,l,d,c,u,p,g,f,E,T,m,h,I,_,A,S,R,O,b,v,D,L,N,P,C,y,F,M,w,U,x,B,H,G,k,W,Y,z=!1,Z=0,V=0,j=0,X=!1,K=null,q=!1,Q=!1,$=!1,ee=!1,te=!1,ie=!1,ne=!1,oe=null,re=null,ae=null,se=null,le={},de={},ce={},ue={},pe=function(){var n=g.attr("*"),o=n.cols?n.cols:g.dtNode.cols,r=[];e.zselectbox("removeOption"),t.zselectbox("removeOption"),i.zselectbox("removeOption");var a=ae?ae:1;for(se=se?se:o.length,r.push({label:"None",id:"",value:"none"});a<=se;){if(X||q){var s=fe(f.children[a-1].getContent());""===s&&(s=J.i18n("writer.sort.COLUMN")+" "+String.fromCharCode(64+a)),r.push({label:s,id:"sort-by-column-"+a,value:a})}else r.push({label:J.i18n("writer.sort.COLUMN")+" "+String.fromCharCode(64+a),id:"sort-by-column-"+a,value:a});a++}if(q&&z)e.zselectbox("addOption",r,"append");else{var l=ZWJSONUtils.clone(r);e.zselectbox("addOption",l.splice(1),"append")}1!==o.length&&(JthenBy1Container.removeClass("ui-disabled-elem"),JthenBy1Label.removeClass("ui-disabled-elem"));var d;X?(d=J.i18n("writer.sort.CHOOSE_HEADER"),e.zselectbox("setAttribute","placeholder",d),t.zselectbox("setAttribute","placeholder",d),i.zselectbox("setAttribute","placeholder",d)):(d=J.i18n("writer.sort.CHOOSE_COLUMN"),e.zselectbox("setAttribute","placeholder",d),t.zselectbox("setAttribute","placeholder",d),i.zselectbox("setAttribute","placeholder",d)),t.zselectbox("addOption",r,"append"),i.zselectbox("addOption",r,"append")},ge=function(e,t){var i,n=e.zselectbox("getValue");if("none"!==n&&!t){var o=oe?oe:X?2:1;for(re=re?re:H.length;o<=re;){var r=H[o-1],a=r.children()[n-1];if(i=fe(editor.doc.getContent(a.getStart(),a.getEnd())))break;o++}return parseFloat(i)==i?1:0}},fe=function(e){return e=e.trimEnd(),e=e.replaceAll("",""),e=e.replaceAll(UNICODE.RANGE_START,""),e=e.replaceAll(UNICODE.RANGE_END,""),e=e.trimStart()},Ee=function(){f=g.firstChild().dtNode,X=f.isHeaderRow(),(X||q||oe)&&(!X||1!=oe&&null!=oe||JheaderRow.zstatebutton("checked",!0),JheaderRow.zstatebutton("disable"))},Te=function(){e=J("#sort-by-column"),n=J("#sort-by-columnContainer"),o=J("#sort-by-column-error-label"),s=J("#sort-by-type"),c=J("#sort-by-order"),t=J("#then-by1-column"),l=J("#then-by1-type"),u=J("#then-by1-order"),i=J("#then-by2-column"),d=J("#then-by2-type"),p=J("#then-by2-order"),JthenBy1Container=J("#then-by1-container"),JthenBy1Label=J("#then-by1-label"),r=J("#then-by2-container"),a=J("#then-by2-label"),G=J("#tablesortdialog"),k=J("#header-options-value"),JheaderRow=J("#include-header-row"),E=J("#sort-by-timezone"),T=J("#then-by1-timezone"),m=J("#then-by2-timezone"),h=J("#sort-by-time-div"),I=J("#then-by1-time-div"),_=J("#then-by2-time-div"),A=J("#sort-by-locale"),S=J("#then-by1-locale"),R=J("#then-by2-locale"),O=J("#sort-by-format"),b=J("#then-by1-format"),v=J("#then-by2-format"),D=J("#sort-by-zone"),L=J("#then-by1-zone"),N=J("#then-by2-zone"),P=J("#sort-by-custom-date-format"),C=J("#then-by1-custom-date-format"),y=J("#then-by2-custom-date-format"),F=J("#sort-by-custon-date-format-error-label"),M=J("#then-by1-custon-date-format-error-label"),w=J("#then-by2-custon-date-format-error-label"),U=J("#sort-by-custom-date-div"),x=J("#then-by1-custom-date-div"),B=J("#then-by2-custom-date-div"),Z=0,V=0,j=0,oe=null,re=null,ae=null,se=null,X=!1,q=!1,z=!1,Q=!1,$=!1,ee=!1,te=!1,ie=!1,ne=!1,ue={timeZone:DocLocaleHandler.getTimezone(),lang:DocLocaleHandler.getLanguage(),dateFormat:DocLocaleHandler.getDateFormat()},le={},de={},ce={};for(var g=0,f=H.length;g<f;g++){var W=H[g],Y=W.getStart(),pe=editor.doc.getRawFormatAt(Y);pe&&pe.format&&pe.format.sortinfo&&Array.isArray(pe.format.sortinfo)&&(z=!0,K=g)}},me=function(){e.bind("zselectboxchange",function(){var t=ge(e,Q);void 0!=t&&t!=TABLE_SORT_TYPE.DATE&&Se(!1,E,h),n.removeClass("ui-validation-error"),o.addClass("ui-hide"),s.zselectbox("setValue",t)}),t.bind("zselectboxchange",function(){var e=t.zselectbox("getValue");if("none"==e)r.addClass("ui-disabled-elem"),a.addClass("ui-disabled-elem");else{var i=ge(t,$);void 0!=i&&i!=TABLE_SORT_TYPE.DATE&&Se(!1,T,I),l.zselectbox("setValue",i),r.removeClass("ui-disabled-elem"),a.removeClass("ui-disabled-elem")}}),i.bind("zselectboxchange",function(){var e=ge(i,ee);void 0!=e&&e!=TABLE_SORT_TYPE.DATE&&Se(!1,m,_),d.zselectbox("setValue",e)})},he={init:function(){H=g.children(),Te(),me(),MailMergeRepeatUtil.isRowRepeatPresent(g.dtNode)?(q=!0,W=J.i18n("writer.sort.SORT_RL_TABLE"),Notification.show({container:"#rlsort-notify-cont",message:"writer.sort.RL_TABLE_SORTING_MSG",close:!1,setTimer:!1,type:"warning"})):W=J.i18n("writer.sort.SORT_TABLE"),J("#tablesortdialogzdialog").zdialog("setAttributes",{title:W});var e=Y.getSelectedRows(),t=Y.getSelectedColumns();e.length>0&&(oe=e[0]+1,re=e[e.length-1]+1),t.length>0&&(ae=t[0]+1,se=t[t.length-1]+1),k.on("zstatebuttonchange",function(e,t){X=t.checked,pe()}),Ee(),pe()},get:function(n,o){if(q&&z){var s,l,d=H[K],c=d.getStart(),u=editor.doc.getRawFormatAt(c),p=ZWJSONUtils.clone(u.format.sortinfo);if("sortBy"==n.action){if(p[0])return s=p[0].colIndex,l=p[0].descend?"1":"0",e.zselectbox("setValue",s),p[0].type==TABLE_SORT_TYPE.DATE&&(le=p[0].date_info,te?Re(E,le):(Pe(A,D,O,E,le),te=!0),Se(!0,E,h)),l}else if("thenBy1"==n.action){if(p[1])return s=p[1].colIndex,l=p[1].descend?"1":"0",t.zselectbox("setValue",s),p[1].type==TABLE_SORT_TYPE.DATE&&(de=p[1].date_info,te?Re(T,de):(Pe(S,L,b,T,de),ie=!0),Se(!0,T,I)),l}else if("thenBy2"==n.action){if(p[2])return s=p[2].colIndex,l=p[2].descend?"1":"0",r.removeClass("ui-disabled-elem"),a.removeClass("ui-disabled-elem"),i.zselectbox("setValue",s),p[2].type==TABLE_SORT_TYPE.DATE&&(ce=p[2].date_info,ne?Re(m,ce):(Pe(R,N,v,m,ce),ne=!0),Se(!0,m,_)),l}else if("sortByType"==n.action){if(p[0])return p[0].type}else if("thenBy1Type"==n.action){if(p[1])return p[1].type}else if("thenBy2Type"==n.action){if(p[2])return p[2].type}else if("sortByLocale"==n.action){if(!ZWJSONUtils.isEmptyObject(le))return le.lang}else if("thenBy1Locale"==n.action){if(!ZWJSONUtils.isEmptyObject(de))return de.lang}else if("thenBy2Locale"==n.action){if(!ZWJSONUtils.isEmptyObject(ce))return ce.lang}else if("sortByFormat"==n.action){if(!ZWJSONUtils.isEmptyObject(le))return Ne(O,le),le.isCustom?(U.removeClass("ui-hide"),P.val(le.dateFormat),Ae(P,E,F,le),"custom"):le.dateFormat}else if("thenBy1Format"==n.action){if(!ZWJSONUtils.isEmptyObject(de))return Ne(b,de),de.isCustom?(x.removeClass("ui-hide"),C.val(de.dateFormat),Ae(C,T,M,de),"custom"):de.dateFormat}else if("thenBy2Format"==n.action){if(!ZWJSONUtils.isEmptyObject(ce))return Ne(v,ce),ce.isCustom?(B.removeClass("ui-hide"),y.val(ce.dateFormat),Ae(y,m,w,ce),"custom"):ce.dateFormat}else if("sortByZone"==n.action){if(!ZWJSONUtils.isEmptyObject(le))return DomUtil.populateTimezoneOptions(D,le.lang),be(O,dateInfo),le.timeZone}else if("thenBy1Zone"==n.action){if(!ZWJSONUtils.isEmptyObject(de))return DomUtil.populateTimezoneOptions(L,de.lang),be(b,dateInfo),de.timeZone}else if("thenBy2Zone"==n.action&&!ZWJSONUtils.isEmptyObject(ce))return DomUtil.populateTimezoneOptions(N,ce.lang),be(v,dateInfo),ce.timeZone}},set:function(e,t,i){switch(e.action){case"sortBy":Z=parseInt(i.value);break;case"thenBy1":V=parseInt(i.value);break;case"thenBy2":j=parseInt(i.value);break;case"sortByType":t==TABLE_SORT_TYPE.DATE?(te?Re(E,le):(Pe(A,D,O,E,le),te=!0),Se(!0,E,h)):Se(!1,E,h),Q=!0;break;case"thenBy1Type":t==TABLE_SORT_TYPE.DATE?(ie?Re(T,de):(Pe(S,L,b,T,de),ie=!0),Se(!0,T,I)):Se(!1,T,I),$=!0;break;case"thenBy2Type":t==TABLE_SORT_TYPE.DATE?(ne?Re(m,ce):(Pe(R,N,v,m,ce),ne=!0),Se(!0,m,_)):Se(!1,m,_),ee=!0;break;case"sortByLocale":le.lang=t,Pe(null,D,O,E,le);break;case"sortByFormat":"custom"==t?(le.isCustom=!0,U.removeClass("ui-hide"),Ae(P,E,F,le)):(le.isCustom&&(le.isCustom=!1,U.addClass("ui-hide"),F.addClass("ui-hide")),le.dateFormat=t,Re(E,le));break;case"sortByZone":le.timeZone=t,Re(E,le);break;case"thenBy1Locale":de.lang=t,Pe(null,L,b,T,de);break;case"thenBy1Format":"custom"==t?(de.isCustom=!0,x.removeClass("ui-hide"),Ae(C,T,M,de)):(de.isCustom&&(de.isCustom=!1,x.addClass("ui-hide"),M.addClass("ui-hide")),de.dateFormat=t,Re(T,de));break;case"thenBy1Zone":de.timeZone=t,Re(T,de);break;case"thenBy2Locale":ce.lang=t,Pe(null,N,v,m,ce);break;case"thenBy2Format":"custom"==t?(ce.isCustom=!0,B.removeClass("ui-hide"),Ae(y,m,w,ce)):(ce.isCustom&&(ce.isCustom=!1,B.addClass("ui-hide"),w.addClass("ui-hide")),ce.dateFormat=t,Re(m,ce));break;case"thenBy2Zone":ce.timeZone=t,Re(m,ce)}}},Ie=function(e){var t="EEEE|EEE|DD|D|MMMM|MMM|MM|M|YYYY|YY|HH|hh|mm|ss|zz|z",i=new RegExp('^[^~*?()#%<>"&apos;|0-9]*$');return e=e.replaceAll(new RegExp(t),""),e=e.trim(),!(!e.match(i)||e.match(new RegExp("[a-z]+|[A-Z]+")))},_e=function(e,t){t.removeClass("ui-hide"),e.addClass("ui-validation-error"),e.unbind("focus"),e.on("focus",function(){t.addClass("ui-hide"),e.removeClass("ui-validation-error")})},Ae=function(e,t,i,n){e.unbind("focusout"),e.focusout(function(){Ie(e.val())?(n.dateFormat=e.val(),Re(t,n)):(n.dateFormat=e.val(),_e(e,i))})},Se=function(e,t,i){e?(G.parents(".zdialog__content").parent().addClass("ui-date-format-adj-width"),t.removeClass("ui-hide"),i.removeClass("ui-hide")):(s.zselectbox("getValue")!=TABLE_SORT_TYPE.DATE&&l.zselectbox("getValue")!=TABLE_SORT_TYPE.DATE&&d.zselectbox("getValue")!=TABLE_SORT_TYPE.DATE&&G.parents(".zdialog__content").parent().removeClass("ui-date-format-adj-width"),t.addClass("ui-hide"),i.addClass("ui-hide"))},Re=function(e,t){try{var i=t.timeZone?t.timeZone:ue.timeZone,n=t.lang?t.lang:ue.lang,o=t.dateFormat?t.dateFormat:ue.dateFormat;o=t.isCustom?t.dateFormat:ZWDateTime.intlToNormalFormatConverter(o,n,i);var r=i+" - "+DocLocaleHandler.getLanguageDetails(n).nativeLangName+" - "+o;e.text(r)}catch(e){}},Oe=function(e){var t=[3,4,5,6,20];return t.contains(e)},be=function(e,t){var i,n,o,r,a=ZWDateTime.SUPPORTED_DATE_FORMATS,s=new ZWDateTime(new Date);e.zselectbox("removeOption");var l=[],d=t.lang||ue.lang,c=t.timeZone||ue.timeZone;for(var u in a)if(a.hasOwnProperty(u)){datefmt=a[u];var p=!1;r=s.format(datefmt,d,c);for(var g=0,f=r.length;g<f;g++)if(characterType=DTUtils.getCharacterType(r[g]),Oe(characterType)){p=!0;break}i=p?"<div class='clearfix'><span class='ui-fl ui-right-margin-small' dir='rtl'>#label#</span><span class='ui-fl zmenu__hint' dir='rtl'>(#preview#)</span></span></div>":"<div class='clearfix'><span class='ui-fl ui-right-margin-small'>#label#</span><span class='ui-fl zmenu__hint'>(#preview#)</span></span></div>",o=ZWDateTime.intlToNormalFormatConverter(datefmt,d,c),n={innerHTML:i,replaceWithText:!0,label:o,preview:r,value:datefmt},l.push(n)}l.push({separator:!0}),l.push({label:"Custom",value:"custom"}),e.zselectbox("addOption",l)},ve=function(e,t){var i=DocLocaleDlg.getLanguageOptions();e.zselectbox("removeAllOptions"),e.zselectbox("addOption",i),e.zselectbox("setValue",t)},De=function(e,t,i){e&&ve(e,i.lang||ue.lang),t&&DomUtil.populateTimezoneOptions(t,i.lang||ue.lang)},Le=function(e,t){var i=DocLocaleHandler.getLanguageDetails(t.lang||ue.lang),n=i&&i.timezones;n&&n.length&&(t.timeZone=n[0]),e.zselectbox("setValue",t.timeZone)},Ne=function(e,t){var i="MM/DD/YYYY",n=ZWDateTime.SUPPORTED_DATE_FORMATS,o=t.dateFormat?t.dateFormat:ue.dateFormat,r=t.isCustom?t.dateFormat:n.contains(o)?o:n.contains(i)?i:n[0];t.dateFormat=r,t.isCustom?e.zselectbox("setValue","custom"):e.zselectbox("setValue",r)},Pe=function(e,t,i,n,o){De(e,t,o),Le(t,ZWJSONUtils.isEmptyObject(o)?ue:o),i&&be(i,o),Ne(i,ZWJSONUtils.isEmptyObject(o)?ue:o),Re(n,o)},Ce=function(){return Y=editor.doc.getSelection(),g=Y.getParents(NODE_TYPE.TABLE),g.dtNode.isVerticalMergePresent()?void PubSub.publish("Document/Warning",WARNING_MSG.MERGE_CELLS_FOUND):void J.dialogutil.open("tablesortdialog",null,he)},ye=function(){J.dialogutil.close("tablesortdialog")},Fe=function(e){return e.lang=e.lang?e.lang:ue.lang,e.timeZone=e.timeZone?e.timeZone:ue.timeZone,e.dateFormat=e.dateFormat?e.dateFormat:ue.dateFormat,e},Me=function(){var r,a=[],c=e.zselectbox("getValue");if("none"==c||""==c)return q&&z?(editor.doc.execCmd("sortRelatedListTable",""),void J.dialogutil.close("tablesortdialog")):(n.addClass("ui-validation-error"),void o.removeClass("ui-hide"));var u={colIndex:c,type:s.zselectbox("getValue"),descend:Z};if(u.type==TABLE_SORT_TYPE.DATE){if(r=Fe(le),!Ie(r.dateFormat))return Se(!0,E,h),_e(P,F),void h.children().zcollapsiblepanel("expandPanel");u.date_info=r}a.push(u);var p=t.zselectbox("getValue");if("none"!==p&&""!==p){var g={colIndex:p,type:l.zselectbox("getValue"),descend:V};if(g.type==TABLE_SORT_TYPE.DATE){if(r=Fe(de),!Ie(r.dateFormat))return Se(!0,T,I),_e(C,M),void I.children().zcollapsiblepanel("expandPanel");g.date_info=r}a.push(g);var f=i.zselectbox("getValue");if("none"!==f&&""!==f){var A={colIndex:f,type:d.zselectbox("getValue"),descend:j};if(A.type==TABLE_SORT_TYPE.DATE){if(r=Fe(ce),!Ie(r.dateFormat))return Se(!0,m,_),_e(y,w),void _.children().zcollapsiblepanel("expandPanel");A.date_info=r}a.push(A)}}oe=1!=oe&&oe?oe:X?2:1,q?editor.doc.execCmd("sortRelatedListTable",a):re-oe!=0&&(ZWLogger.addToStatistics("Table sort"),TableSort.sortCurrentColumn(a,oe,re)),J.dialogutil.close("tablesortdialog")};return{open:Ce,close:ye,apply:Me}}();var TableRenameDialog=function(){"use strict";var e,t,i,n,o,r,a=new RegExp("^[^:*?\\[\\]{}()#%^&<>\";'|\\\\/]*$"),s=function(){i=J("#rename-dlg-rename"),n=J("#tableNameInput"),o=J("#edit-tbl-name"),r=J("#table-name-error-label")},l={init:function(e){s(),n.removeClass("ui-validation-error"),r.addClass("ui-hide"),i.disable(),setTimeout(function(){n.select()},10)},get:function(e){if("table_name"==e.action&&t){var i=t.getStart(),n=editor.doc.getRawFormatAt(i);return n.name||""}},set:function(e,t,i){if("table_name"==e.action){var o=function(){TableRenameDialog.rename()};UIUtils.enterKey(n,o)}}},d=function(e){e?(r.text(J.i18n("writer.error.SPECIAL_CHARS_NOT_ALLOWED",[a])),n.addClass("ui-validation-error"),r.removeClass("ui-hide"),r.show()):(r.addClass("ui-hide"),n.removeClass("ui-validation-error"),r.hide())},c=function(t){var i=t.value.trim();i=i.replaceAll(REGEX.allUnicodes,""),i&&i!=e?a.test(i)?(d(!1),u(!0),n.removeClass("ui-validation-error")):(d(!0),u(!1)):u(!1)},u=function(e){e?i.enable():i.disable()},p=function(e,i){var n=editor.doc,o=Utils.randomString(),r=i||t.getStart(),a=ZWJSONUtils.clone(n.getRawFormatAt(r));a.name=e;var s=[];return s.push({r:r}),s.push({as:{start:a},id:o}),s.push({r:1}),s.push({as:{end:Object.keys(a),id:o}}),s},g=function(e){var t=Utils.findNextIndexOf("\\(",0,e);return{name:e.substring(0,t),cellIdx:t}},f=function(e,t,i){var n,o,r,a,s,l,d,c,u=[],p=editor.doc,f=e.start,E=e.end;n=ZWJSONUtils.clone(p.getRawFormatAt(f));var T=n.formula,m=T,h=new ZWFieldParser(T);if(h.isTableReferenceField())for(var I=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_START_REGEX,0,T),_=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_END_REGEX,I,T);I!=-1&&_!=-1;){var A=T.substring(I+1,_),S=g(A),R=S.name;R==t&&(T=T.substring(0,I+1)+i+T.substring(I+S.cellIdx+1)),I=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_START_REGEX,I+1,T),_=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_END_REGEX,I,T)}h.destroy(),n.formula=T;var O=Formula.getFormulaFormat(m);return o=p.getRawFormatAt(E-1),r=p.getRawFormatAt(f+1),a=p.getContent(f,E),s=n.id,l=DocTreeManager.getTreeNodeAtIndex(f),d=Formula.calculate(O,l),c=d.formattedVal,"Formula_Output"==c&&label&&(c=label),u.push({r:f}),u.push({ds:a}),s=Utils.randomString(),u.push({as:{start:n,id:s}}),u.push({is:UNICODE.RANGE_START}),u.push({as:{end:Object.keys(n),id:s}}),s=Utils.randomString(),u.push({as:{start:r,id:s}}),u.push({is:c}),u.push({as:{end:Object.keys(r),id:s}}),s=Utils.randomString(),u.push({as:{start:o,id:s}}),u.push({is:UNICODE.RANGE_END}),u.push({as:{end:Object.keys(o),id:s}}),u},E=function(){if(!editor.doc.isEditableMode())return void I();var t=n.val();if(t=t.replaceAll(REGEX.allUnicodes,""),a.test(t)){var i=TableCollectionInstance.getAllTableNames(!0);if(t&&t!=e)if(i.contains(t))n.addClass("ui-validation-error"),r.removeClass("ui-hide"),r.text(J.i18n("writer.table.TABLE_NAME_EXISTS")),r.show(),n.off("focus").on("focus",function(){r.addClass("ui-hide"),n.removeClass("ui-validation-error")});else{for(var o=p(t),s=DocOpBuilder.build(o),l=FormulaHandler.getAllFormulaFieldsWithTableName(e),d=0,c=l.length;d<c;d++)s.applyOp(DocOpBuilder.build(f(l[d],e,t)));Op.processMsg(s.toJson()),Op.sendMsg(),TableVisualCueHandler.constructTableNameBtn(),I()}}},T=function(){e="",t=null},m=function(){var i=editor.doc;t=i.getParents(NODE_TYPE.TABLE,i.getSelection().getStart()),e=i.getRawFormatAt(t.getStart()).name||"",J.dialogutil.open("edittablenamedialog",null,l),PubSub.subscribe("Dialog/BeforeClose",h)},h=function(){PubSub.unsubscribe("Dialog/BeforeClose",h),I()},I=function(){T(),J.dialogutil.close("edittablenamedialog")};return{open:m,close:I,rename:E,onInput:c,getRenameOp:p}}();!function(){var e={timeOut:5e3,timerId:void 0,close:!1,container:"body",type:"info"},t=function(t){U.each(U.keys(t),function(i){U.has(e,i)&&(e[i]=t[i])})},i=function(t){o(),t=t||{},U.defaults(t,{setTimer:!0,close:!0,type:"success",container:e.container,className:t.container?"":"ui-notify-globe-container"}),"string"==typeof t.message?t.translatedMessage||(t.message=J.i18n(t.message)):t.message=J.i18n(t.message.key,t.message.args),t.btnText=!!t.btnText&&(t.btnTextTranslated?t.btnText:J.i18n(t.btnText)),t.title&&(t.title=J.i18n(t.title)),t.url&&(t.linkText=J.i18n(t.linkText||"writer.common.CLICK_HERE")),n(t),t.btnText&&J("#js-btn-callback").bind("click",t.callback),t.setTimer&&r(t.timeOut)},n=function(e){var t=Handlebars.compile($("#notification-template").html()),i=$.parseHTML(t(e).trim());J("#js-notify").remove(),J(e.container).append(i)},o=function(){e.timerId&&(clearTimeout(e.timerId),e.timerId=void 0)},r=function(t){e.timerId||(e.timerId=setTimeout(a,t||e.timeOut))},a=function(){J("#js-notify").remove(),o()};window.Notification={show:i,hide:a,configure:t}}();var DocNotificationManager=function(){var e=function(){var e=[],t={},i=0,n=function(){e=[],i=0,Z("notification-dropdown").find(".ui-comment-notify-list").remove(),Z("ui-docnotification").find(".ui-colab-user-count").hide()},o=function(n){var o="notification_"+("x"+Math.random()).replace(/\D/g,"");n.id=o,e.splice(0,0,n),i++;var r=a(n.id,n.zuid,n.text,n.time,n.click),l=J(r);return l.css("background-color","rgba(243, 243, 243, 0.48)"),Z("notification-dropdown").find(".ui-comment-notify-inner-div").prepend(r),i&&Z("topband-review-noti").znotificationbutton("setAttribute","badgeText",i),t[o]=l,s(),o},r=function(n){for(var o=-1,r=0,a=e.length;r<a;r++){var s=e[r];if(s.id===n){o=r;break}}o!==-1&&(e.splice(o,1),t[n].remove()),i--,i>0?Z("topband-review-noti").znotificationbutton("setAttribute","badgeText",i):Z("topband-review-noti").znotificationbutton("hideBadge")},a=function(e,t,i,n,o){var r=J("<div class='ui-comment-notify-list'>  <div class='ui-fr ui-comment-notify-list-content'> <div class='content'> </div> <div class='ui-comment-notify-list-time' style='width:50%'> </div> </div>  <div class='ui-fl ui-right-margin-medium'> <img width='30' id='topband-userimg' height='30'> </div>  </div>");r.find(".content").html(i);var a=r.find(".ui-comment-notify-list-time"),s=new ZWDateTime(n,null,editorProps.userInfo.language).format("YYYY MMM DD h mm");a.attr("data-dynamic-time",n),a.addClass("dynamic-time"),a.attr("title",s),a.text(Utils.getTimeFromNow(n)),r.find(".ui-comment-notify-list-time");var l=ZWNetworkUtils.getUserImageURL(t);return r.find("#topband-userimg").attr("src",l),r.unbind().bind({click:function(e){return o(),DocNotificationManager.close(),DomUtil.stopEvent(e),!1}}),r},s=function(){e.length?Z("notification-dropdown").find(".ui-no-notifications").hide():Z("notification-dropdown").find(".ui-no-notifications").show()},l=function(){return e.length},d=function(){i&&(i=0,Z("topband-review-noti").znotificationbutton("hideBadge"),Z("notification-dropdown").find(".ui-comment-notify-list").css("background-color","#fff"))},c=function(){var t,i,n,o=[];for(t=0,i=e.length;t<i;t++)n=nodes[t],o.push(n);return o};return{init:n,add:o,remove:r,displayNoNotificationMsg:s,length:l,makeAllRead:d,toJson:c}}(),t=function(){e.init(),Z("topband-review-noti").on("click",function(e){DocNotificationManager.toggle(e)})},i=function(t){return e.add(t)},n=function(t){e.remove(t)},o=function(e){e&&e>0?(Z("notification-total-count").show().find(".js-comments-count-anchor").show(),Z("notification-dropdown").find(".comments-count").text(e)):Z("notification-total-count").find(".js-comments-count-anchor").hide()},r=function(e){e&&e>0?(Z("notification-total-count").show().find(".js-changes-count-anchor").show(),Z("notification-dropdown").find(".changes-count").text(e)):Z("notification-total-count").find(".js-changes-count-anchor").hide()},a=function(){var t=$.ZContextMenu.currentMenu;t&&t.zmenu&&t.zmenu("hide"),Z("ui-docnotification").find("button").addClass("ui-state-highlight"),Z("notification-dropdown").show(),e.displayNoNotificationMsg(),Z("notification-total-count").hide();var i=CommentAdapter.getCount("nosAll");o(i);var n=TcManager.getCollection().getVisibleNodesCountDetails().all;r(),i&&i>0&&n&&n>0?Z("notification-total-count").find(".js-comments-count-anchor").css("border-color","#e8e8e8"):Z("notification-total-count").find(".js-comments-count-anchor").css("border-color","transparent")},s=function(){Z("ui-docnotification").find("button").removeClass("ui-state-highlight"),e.makeAllRead(),Z("notification-dropdown").hide()},l=function(e){return Z("notification-dropdown").is(":visible")?(s(),e.stopPropagation(),e.preventDefault(),!1):(a(),e.stopPropagation(),e.preventDefault(),!1)};return PubSub.subscribe("Document/ComponentInitialized",function(){DocNotificationManager.init()}),J(document).bind("click",function(){Z("notification-dropdown").is(":visible")&&DocNotificationManager.close()}),{init:t,add:i,remove:n,toggle:l,close:s}}();!function(){var e={},t={},i=void 0,n=void 0,o=void 0,r=function(t){U.each(t,function(t,i){e[t.email]=t})},a=function(e){return e=e||[],U.map(e,function(e,t){var i=U.clone(e);return i.id=e.zuid,i.type="user",i.name=e.fullName,i.encodeName=e.fullName,i.label=e.fullName+e.email,i.image=ZWNetworkUtils.getUserImageURL(e.zuid),i})},s=function(t){var i;if(U.isEmpty(e))i=l(t);else{var n=new Deferred;i=n.promise(),n.resolve(a(e))}return i},l=function(e){if(i)return i.promise();i=new Deferred;var t={};return e=e||{},t.limit=e.limit,t.startsFrom=e.startsFrom,J.ajax({url:ZWNetworkUtils.getContextUrl("v1/web/user/contacts"),dataType:"json",type:"GET",success:function(e){r(e.contactsList),i.resolve(a(e.contactsList)),i=void 0},error:function(){i.reject([]),i=void 0}}),i.promise()},d=function(e){var t={},i=e.callback;t.limit=e.limit,t.queryStr=e.queryStr,t.startsFrom=e.startsFrom,t.from=e.from||"";var n=e.success,o=e.error;J.ajax({data:t,type:"POST",dataType:"json",url:ZWNetworkUtils.getContextUrl("v1/web/user/contacts/search"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){r(e.contactsList),n&&n(e),i&&i(a(e.contactsList))},error:function(e,t,n){o&&o(e,t,n),i&&i([])}})},c=function(e){var i=U.filter(t,function(t){return e.includes(t.zuid)});return i},u=function(e){var t=e.zuid_list||[],i=c(t);if(i.length==t.length){var n=new Deferred;return n.resolve(a(i)),n.promise()}return p(e)},p=function(e){if(o)return o.promise();var t={},i=ZWNetworkUtils.getContextUrl("v1/web/user/contacts/org/"+e.zid);return e=e||{},t.limit=e.limit||100,t.startsFrom=e.startsFrom||0,t.zuid_list=JSON.stringify(e.zuid_list),i+="?"+J.param(t),o=new Deferred,J.ajax({url:i,dataType:"json",type:"GET",success:function(e){g(e.contactsList),o.resolve(a(e.contactsList)),o=void 0},error:function(){o.reject(),o=void 0}}),o.promise()},g=function(e){U.each(e,function(e,i){t[e.email]=e})},f=function(e){if(n)return n.promise();n=new Deferred;var t=ZWNetworkUtils.getContextUrl("api/v1/license/org/"+docProps.info.ZID+"/admins");return J.ajax({url:t,dataType:"json",type:"GET",success:function(e){docProps.info.ZID_ADMIN_ZUIDS=e.ZID_ADMIN_ZUIDS,n.resolve(e.ZID_ADMIN_ZUIDS),n=void 0},error:function(e){n.reject([]),n=void 0}}),n.promise()},E=function(){var e,t=docProps.info.ZID_ADMIN_ZUIDS||[];if(!U.isEmpty(t)||Macros.isRemote()){var i=new Deferred;e=i.promise(),i.resolve(t)}else e=f();return e};window.Contacts={getContacts:s,searchContacts:d,fetchOrgMembers:u,fetchAdminZuids:E}}(),TabStopDlg=function(){},TabStopDlg.insertTabDlg=function(){J.dialogutil.open("tabdialog",J("#tabsettingbutton"),TabStopDlg.info)},TabStopDlg.info={set:function(e,t,i){},beforeFillValues:function(e){var t,i,n,o,r,a,s,l,d,c,u=Conversions.toGlobalUnit(editor.doc.getBodyFormat()[ATTR_BODY.DS_TPS]),p=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH);a=Conversions.step;var g=editor.jeditorPane.width();s=parseFloat(g)/Conversions.globalUnitInPx,l=parseFloat(g)/2/Conversions.globalUnitInPx,c=Conversions.step,a-=a%c,s-=s%c,d=Conversions.showUnit,J("input#defaulttab").znumberfield("setAttributes",{min:a,max:l,step:c,suffix:d,value:u});var f=p.attr(ATTR_PARAGRAPH.PS_TPS);if(f)for(t=f,i=t.length,n=0;n<i;n++){for(o=i-1;o>n;o--)t[o]&&parseFloat(t[o-1].point)>parseFloat(t[o].point)&&(r=t[o-1],t[o-1]=t[o],t[o]=r);if(t[n+1]&&parseFloat(t[n+1].point)==parseFloat(t[n].point)&&t.splice(n,1),t[n]&&isNaN(parseFloat(t[n].point))&&t.splice(n,1),t[n]){var E=Conversions.toGlobalUnit(t[n].point),T=t[n].align,m=t[n].leader;newManualPtRow=TabStopDlg.newRow(n,E),J("div#manualPts").append(newManualPtRow),J("select#pos_"+n).zselectbox(),J("select#pos_"+n).zselectbox("setValue",T),J("select#leader_"+n).zselectbox(),J("select#leader_"+n).zselectbox("setValue",m),J("input#percent_"+n).znumberfield(),J("input#percent_"+n).znumberfield("setAttributes",{min:a,max:s,step:c,suffix:d,decimalPlaces:3,value:E})}p.attr(ATTR_PARAGRAPH.PS_TPS)[n]=t[n]}else TabStopDlg.newRow(1,""),TabStopDlg.addManualPtRow()}},TabStopDlg.applyTabs=function(){editor.doc.execCmd("applyTab","")},TabStopDlg.applyValues=function(e){var t,i,n,o,r,a,s,l,d,c,u,p,g,f=[];for(t=0;t<=20;t++)0!=J("div#manualtabrow_"+t).length&&(i="percent_"+t,n="pos_"+t,o="leader_"+t,r=parseFloat(J("#"+i).znumberfield("getValue")),0!=r.length&&0!=r&&(isNaN(r)||(a=J("#"+n).zselectbox("getValue"),s=J("#"+o).zselectbox("getValue"),l=t<10?"0"+t:t,d={id:l,point:r+Conversions.globalUnit,align:a,leader:s},f.push(d))));for(c=0;c<e.length;c++){u=e[c];var E={};E[ATTR_PARAGRAPH.PS_TPS]=f,u.attr(E)}p=Conversions.toGlobalUnit(J("#defaulttab").znumberfield("getValue")+Conversions.globalUnit),g=editor.doc.getSelection().getParents(NODE_TYPE.BODY),p!==Conversions.toGlobalUnit(g.attr(ATTR_BODY.DS_TPS))&&(E={},E[ATTR_BODY.DS_TPS]=p+Conversions.globalUnit,g.attr(E)),J.dialogutil.close("tabdialog")},TabStopDlg.newRow=function(e,t){var i="manualtabrow_"+e,n="pos_"+e,o="percent_"+e,r="leader_"+e,a="del_"+e,s="<div id='"+i+'\' class="ui-bottom-margin-medium ui-pop-2c-variable ui-tabset-spinner"><span class="tkHeadDistance ui-fl"><input  id=\''+o+"'ctype='znumberfield' data=\"{min:0,max:1000,step:1,appData:{action:'props.stroke.width'},width:'105px'}\"/></span><span class=\"tkHeadalignLeader1 ui-fl\"><select id='"+n+"'ctype='zselectbox' data=\"{width:'100',appData:{action : 'props.transform.pos.left',associatedUIData: ['#horizontposValue'],associatedActions: ['props.transform.pos.left']}}\"><option value='0'  type=\"localweb\" data=\"{'icon': 'ui-icon-script'}\">"+J.i18n("writer.common.LEFT")+"</option><%--No I18N--%><%--No I18N--%><option value='1' type=\"localweb\" data=\"{'icon': 'ui-icon-home'}\">"+J.i18n("writer.common.CENTER")+"</option><%--No I18N--%><%--No I18N--%><option value='2' type=\"localweb\" data=\"{'icon': 'ui-icon-home'}\">"+J.i18n("writer.common.RIGHT")+'</option><%--No I18N--%><%--No I18N--%></select></span><span class="tkHeadalignLeader2 ui-fl"><select id=\''+r+"'ctype='zselectbox' data=\"{width: '100', appData:{action:'props.stroke.type'}}\" ><option value='0' data=\"{'icon': 'ui-zlinestyle-stroketype ui-zstroketype-solid'}\">"+J.i18n("writer.common.NONE")+"</option><%--No I18N--%><option noattri18n=\"true\" value='1' data=\"{'icon': 'ui-zlinestyle-stroketype ui-zstroketype-solid'}\">....................</option><%--No I18N--%><option noattri18n=\"true\" value='2' data=\"{'icon': 'ui-zlinestyle-stroketype ui-zstroketype-squaredot'}\">---------------</option><%--No I18N--%><option noattri18n=\"true\" value='3' data=\"{'icon': 'ui-zlinestyle-stroketype ui-zstroketype-dash'}\">________</option><%--No I18N--%></select></span><span class=\"tkclose\"><span class=\"ui-icon-delete-sm ui-ms-pointer\"  onclick=\"TabStopDlg.removeManualPtRow(event);\" id='"+a+"'></span></span></div>";return s},TabStopDlg.addManualPtRow=function(){var e,t,i,n,o,r="";t=Conversions.step,i=parseFloat(editor.jeditorPane.width())/Conversions.globalUnitInPx,n=Conversions.step,o=Conversions.showUnit,t-=t%n,i-=i%n;var a=new Array;if(a=J('[id^="manualtabrow"]'),0==a.length)e=1;else{var s=a.length;e=s+1}var l=Conversions.toGlobalUnit(editor.doc.getBodyFormat()[ATTR_BODY.DS_TPS]);r=TabStopDlg.newRow(e,l),J("div#manualPts").append(r),J("select#pos_"+e).zselectbox(),J("select#leader_"+e).zselectbox(),J("input#percent_"+e).znumberfield(),J("input#percent_"+e).znumberfield("setAttributes",{min:t,max:i,step:n,suffix:o,decimalPlaces:3,value:l})},TabStopDlg.removeAllRow=function(){J("span#errmsg").hide(),J('[id^="manualtabrow"]').remove()},TabStopDlg.removeManualPtRow=function(e){var t=e.target,i=t.id;i="manualtabrow_"+parseInt(i.substring(i.indexOf("_")+1,i.length)),J('[id^="'+i+'"]').remove(),J("#"+i).remove()};var ColumnDialog=function(){function e(){}var t=function(){this.deleteRow()};return extend(e.prototype,{init:function(){var e=DocLayoutManager.getCurrentSection(),t=e.getColumnFormat();this.columnCount=t.count,this.colSpace=t.defaultSpace,this.columnWidth=t.width,this.columnSpace=t.space,this.columnSeperator=t.separator,this.colIsEqWid=t.isEqualWidth,this.globalUnit=Conversions.globalUnit,this.setMaxValueForColCount(),this.removeAllColRow(),this.addManualColRow()},get:function(e){var t=this.handlers[e]&&this.handlers[e].get;if(t)return t.bind(this)()},set:function(e,t,i){var n=this.handlers[e]&&this.handlers[e].set;if(n)return n.bind(this)(t,i)},handlers:{PAGE_COLUMNCOUNT:{get:function(){if(2==this.columnCount&&!this.colIsEqWid){var e=this.columnWidth[0],t=this.columnWidth[1];if(2*e==t)return 100;if(e==2*t)return 101}return this.columnCount},set:function(e,t){var i=parseInt(t[0].value,10),n="0.5in".convertor().pixels;this.columnWidth=[],this.columnSpace=[],this.removeAllColRow();var o=DocLayoutManager.getCurrentSection(),r=o.getWidth();if(100==i||101==i)this.columnCount=2,r-=(this.columnCount-1)*n,r/=this.columnCount+1,100==i&&(this.columnWidth.push(r),this.columnWidth.push(2*r)),101==i&&(this.columnWidth.push(2*r),this.columnWidth.push(r)),this.columnSpace.push(n),this.colIsEqWid=!1,J("#isEqWid").zstatebutton("checked",!1);else if(1==i||2==i||3==i){r-=(i-1)*n,r/=i;for(var a=0;a<i;a++)this.columnWidth.push(r),a<i-1&&this.columnSpace.push(n);1==i?(J("#isEqWid").disable(),J("#columnSeperator").disable()):(J("#isEqWid").enable(),J("#isEqWid").zstatebutton("checked",!0),J("#columnSeperator").enable()),this.columnCount=i,this.colSpace=n,this.colIsEqWid=!0}J("input#columnCount").znumberfield("setValue",this.columnCount),this.addManualColRow()}},columnSeperator:{get:function(){return 1==this.columnSeperator},set:function(e,t){var i=this.columnCount;if(i>1)return e?(this.columnSeperator="1",!0):(this.columnSeperator="0",!1)}},columnWidth:{get:function(){for(var e,t=0;t<this.columnCount;t++)e=Conversions.toGlobalValue(this.columnWidth[t]+"px"),J("input#colWidth_"+(t+1)).znumberfield("setValue",e)},set:function(e,t){var i,n=DocLayoutManager.getCurrentSection(),o=n.getWidth(),r=this.colIsEqWid,a=this.columnCount,s=t.id.split("colWidth_")[1]-1,l=this.columnWidth[s],d=(e+this.globalUnit).convertor().pixels,c=d-l,u=c/(a-(s+1));if(r){var p=a*d;i=(o-p)/(a-1),i<0&&(d=l+u+i,i=0,this.updatePreview(!0)),this.enableAllColRow();for(var g=1;g<=a;g++)J("input#colWidth_"+g).znumberfield("setValue",Conversions.toGlobalValue(d+"px")),this.columnWidth[g-1]=d,g<a&&(J("input#colSpace_"+g).znumberfield("setValue",Conversions.toGlobalValue(i+"px")),this.columnSpace[g-1]=i);this.colSpace=i,this.disableAllColRow()}else{for(var g=s+1;g<a;g++){var f=this.columnWidth[g]-u;(f+"px").convertor().centimeters>1.27&&(this.columnWidth[g]=f,J("input#colWidth_"+(g+1)).znumberfield("setValue",Conversions.toGlobalValue(f+"px")),this.columnWidth[s]=this.columnWidth[s]+u,c-=u)}if(0!=c&&0!=s){u=c/s;for(var g=s-1;g>=0;g--){var f=this.columnWidth[g]-u;(f+"px").convertor().centimeters>1.27&&(this.columnWidth[g]=f,J("input#colWidth_"+(g+1)).znumberfield("setValue",Conversions.toGlobalValue(f+"px")),this.columnWidth[s]=this.columnWidth[s]+u,c-=u)}}if(0!=c){u=c/(a-1);for(var g=0;g<a;g++){var i=this.columnSpace[g]-u;if(!((i+"px").convertor().millimeters>0))return!1;this.columnSpace[g]=i,J("input#colSpace_"+(g+1)).znumberfield("setValue",Conversions.toGlobalValue(i+"px")),this.columnWidth[s]=this.columnWidth[s]+u,c-=u}}}return!0}},columnSpace:{get:function(){var e;if(this.columnCount>1)for(var t=0;t<this.columnCount-1;t++)e=this.colIsEqWid?Conversions.toGlobalValue(this.colSpace+"px"):Conversions.toGlobalValue(this.columnSpace[t]+"px"),J("input#colSpace_"+(t+1)).znumberfield("setValue",e)},set:function(e,t){var i=this.colIsEqWid,n=this.columnCount,o=DocLayoutManager.getCurrentSection(),r=o.getWidth();if(e<0)return!1;var a=t.id.split("colSpace_")[1]-1,s=this.columnSpace[a],l=(e+this.globalUnit).convertor().pixels,d=l-s,c=d/(n-(a+1));if(i){var u=(n-1)*l,p=(r-u)/n;if(l<0)return this.updatePreview(!0),!1;this.enableAllColRow();for(var g=1;g<=n&&(p+"px").convertor().centimeters>1.27;g++)J("input#colWidth_"+g).znumberfield("setValue",Conversions.toGlobalValue(p+"px")),this.columnWidth[g-1]=p,g!=n&&(J("input#colSpace_"+g).znumberfield("setValue",Conversions.toGlobalValue(l+"px")),this.columnSpace[g-1]=l);this.colSpace=l,this.disableAllColRow()}else{for(var g=a+1;g<n;g++){var p=this.columnWidth[g]-c;(p+"px").convertor().centimeters>1.27&&(this.columnWidth[g]=p,J("input#colWidth_"+(g+1)).znumberfield("setValue",Conversions.toGlobalValue(p+"px")),this.columnSpace[a]=this.columnSpace[a]+c,d-=c)}if(d>0){c=d/(a+1);for(var g=a;g>=0;g--){var p=this.columnWidth[g]-c;(p+"px").convertor().centimeters>1.27&&(this.columnWidth[g]=p,J("input#colWidth_"+(g+1)).znumberfield("setValue",Conversions.toGlobalValue(p+"px")),this.columnSpace[a]=this.columnSpace[a]+c,d-=c)}}if(0!=d){c=d/(n-2);for(var g=0;g<n;g++)if(g!=a){var f=this.columnSpace[g]-c;if(!((f+"px").convertor().millimeters>0))return!1;this.columnSpace[g]=f,J("input#colSpace_"+(g+1)).znumberfield("setValue",Conversions.toGlobalValue(f+"px")),this.columnSpace[a]=this.columnSpace[a]+c,d-=c}}}return!0}},colIsEqWid:{get:function(){return!!this.colIsEqWid&&(this.disableAllColRow(),!0)},set:function(e,t){return e?(this.colIsEqWid=!0,this.addEqualColumn()):(this.enableAllColRow(),this.colIsEqWid=!1),this.updatePreview(),this.colIsEqWid}},colCount:{set:function(e,t){var i=J("#columnSeperator"),n=J("#isEqWid"),o=this.getMaxColCount();J("#columnsOptions").zbuttonset("uncheck",[J("#adv-pl_column_preset_1"),J("#adv-pl_column_preset_2"),J("#adv-pl_column_preset_3")]),e>o&&(e=o),i.enable(),n.enable(),this.columnCount=parseInt(e),1==e&&this.colIsEqWid?(i.disable(),n.disable(),J("#columnsOptions").zbuttonset("check",[J("#adv-pl_column_preset_1")])):2==e&&this.colIsEqWid?J("#columnsOptions").zbuttonset("check",[J("#adv-pl_column_preset_2")]):3==e&&this.colIsEqWid&&J("#columnsOptions").zbuttonset("check",[J("#adv-pl_column_preset_3")]),this.addEqualColumn()}}},addEqualColumn:function(){var e,t=DocLayoutManager.getCurrentSection(),i=t.getWidth(),n=this.colSpace?this.colSpace:48;e=i-(this.columnCount-1)*n,e/=this.columnCount,this.columnCount>1&&e<48&&n>0&&(e=48,n=i-this.columnCount*e,n/=this.columnCount-1),this.removeAllColRow(),this.columnWidth=[],this.columnSpace=[];for(var o=0;o<this.columnCount;o++)this.columnWidth[o]=e,o<this.columnCount-1&&(this.columnSpace[o]=n);this.addManualColRow()},getApplyValues:function(){var e=!1,t={};if(t.cols={},t[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLCOUNT]=this.columnCount,t[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLWID]=[],t[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLSPACE]=[],!this.colIsEqWid)for(var i=0,n=this.columnWidth.length;i<n;i++)t[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLWID].push(Conversions.toGlobalValue(this.columnWidth[i]+"px")),i<n-1&&t[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLSPACE].push(Conversions.toGlobalValue(this.columnSpace[i]+"px"));t[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLSEP]=this.columnSeperator,t[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_DEFAULTSPACE]=Conversions.toGlobalValue(this.colSpace+"px"),t[ATTR_BODY.DS_COLCOLS][ATTR_BODY.DS_COLISEQWID]=this.colIsEqWid;var o=editor.doc.getSelection(),r=DocLayoutManager.getColumnFormatAtIdx(o.getStart());for(var a in r)if(e||"undefined"==typeof t[ATTR_BODY.DS_COLCOLS][a]||t[ATTR_BODY.DS_COLCOLS][a]==r[a]){if(e)break}else e=!0;return e||(t={}),t},openColDlg:function(){J.dialogutil.open("columndialog",void 0,this.colInfo)},newColRow:function(e,t){var i="manualcolrow_"+e,n="col_"+e,o="colWidth_"+e,r="colSpace_"+e,a="del_"+e,s="<div id='"+i+"' class='ui-multicol-table-row'><div id='"+n+'\' class="ui-multicol-table-cell"><div class="ui-with-space-numberspan">'+e+'</div></div><div class="ui-multicol-table-cell"><div class="ui-pop-2c-variable"><input ctype=\'znumberfield\' id=\''+o+"' data=\"{'appData':{'action':'columnWidth'}}\" style=\"width:110px;\"/></div></div><div class=\"ui-multicol-table-cell\"><div class=\"ui-pop-2c-variable\"><input ctype='znumberfield' id='"+r+'\' data="{appData:{action:\'columnSpace\'}}" style="width:110px;"/></div></div>';return t&&(s+="<span class='ui-icon-delete-sm ui-ms-pointer' id='"+a+"'></span>"),s+="</div>"},bindEvents:function(){J("#advance-page-add-newcol").bind("click",function(){var e=this.columnCount+1;this.set("colCount",e),this.updatePreview()}.bind(this))},deleteRow:function(){var e=this.columnCount-1;this.set("colCount",e),this.updatePreview()},getMaxGapAndWidth:function(){var e=(this.globalUnit,DocLayoutManager.getCurrentSection()),t=e.getWidth(),i=(J('#columnCount li [class $="_selected"]'),this.columnCount),n="12.7mm".convertor().pixels,o=t-n*(i-1),r=o/Conversions.globalUnitInPx,a=(t-n*(i-1))/Conversions.globalUnitInPx;return{maxGap:r,maxWid:a}},addManualColRow:function(){for(var e="",i=this.columnCount,n=Conversions.step,o=this.colIsEqWid,r=this.getMaxGapAndWidth(),a=i>1,s=1;s<=i;s++)e=this.newColRow(s,a),J("div#advance-pagelayout-column-widspace").append(e),a&&J("#del_"+s).bind("click",t.bind(this)),J("input#colWidth_"+s).znumberfield(),J("input#colWidth_"+s).znumberfield("setAttributes",{suffix:this.globalUnit,decimalPlaces:3,min:Conversions.toGlobalUnit("12.7mm"),max:r.maxWid,value:Conversions.toGlobalValue(this.columnWidth[s-1]+"px"),step:n}),J("input#colSpace_"+s).znumberfield(),J("input#colSpace_"+s).znumberfield("setAttributes",{suffix:this.globalUnit,decimalPlaces:3,min:Conversions.toGlobalUnit("0.01in"),max:r.maxGap,step:n}),s<i&&J("input#colSpace_"+s).znumberfield("setValue",Conversions.toGlobalValue(this.columnSpace[s-1]+"px")),J("#advancedpagesetupdialogzdialog").ZCtrackObjects("initEvents",J("div#advance-pagelayout-column-widspace"),void 0,!0);o?(this.disableAllColRow(),this.colIsEqWid=!0):(this.enableAllColRow(),this.colIsEqWid=!1)},removeAllColRow:function(){J('[id^="manualcolrow"]').remove()},setMaxValueForColCount:function(){J("input#columnCount").znumberfield("setAttribute","max",this.getMaxColCount())},getMaxColCount:function(){var e=DocLayoutManager.getCurrentSection(),t=e.getWidth(),i=1,n="0.5in".convertor().pixels;return i=parseInt(t/n)-1},enableAllColRow:function(){J('[id^="manualcolrow"]').enable(),J('[id^="colWidth_"]').znumberfield("setAttribute","disabled",!1),J('[id^="colSpace_"]').znumberfield("setAttribute","disabled",!1)},disableAllColRow:function(){J('[id^="manualcolrow"]').disable(),J('[id^="manualcolrow_1"]').enable(),J('[id^="colWidth_"]').znumberfield("setAttribute","disabled",!0),J('[id^="colWidth_1"]').znumberfield("setAttribute","disabled",!1),J('[id^="colSpace_"]').znumberfield("setAttribute","disabled",!0),J('[id^="colSpace_1"]').znumberfield("setAttribute","disabled",!1)},updatePreview:function(){PageLayoutAdvancedDialogue.updatePreview()}}),e}(),StickerUI=function(){var e,t={gap:0,top:0,bottom:0},i={},n=null,o=null;return{init:function(r,a,s){i=$.extend({},t,s),n=r,o=$(r),e=a,this.changePosition(i)},changePosition:function(e){i.top=e.top,i.left=e.left,i.bottom=e.bottom,i.gap=e.gap,o.css({position:"absolute",top:i.top+"px",left:i.left})},handleScroll:function(t){var n=t,r=o.outerHeight(),a=e.offsetLeft;n>=i.top&&n+r<=i.bottom?o.css({position:"fixed",top:i.gap+"px",left:i.left+a}):n<i.top?o.css({position:"absolute",top:i.top+"px",left:i.left}):n+r>i.bottom?o.css({position:"absolute",top:i.bottom-r+"px",left:i.left}):o.css({position:"absolute",top:i.top+"px",left:i.left})}}};LockDlg=function(){var e,t,i,n=[],o=!1,r={},a=/([\w\.\+-]+)@([\w-]+)\.([a-z]{2,6}(\.[a-z]{2})?)/g,s=function(){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),o=!1;var e,t,n,a=editor.doc.getSelection();if(oldAttr={},r={},i=Lock.getLock(a.getStart()+1)){var s=i.getDocOps();e=s[0].length(),t=e+s[1].length(),n=editor.doc.createRange(e,t),a.removeAllRanges().addRange(n)}else a.isCollapsed()&&a.selectWord();var c=Contacts.getContacts(),u=d();Deferred.when(c,u).done(l)},l=function(e,t){for(var i,n,o,a=t.length,s=[],l=0;l<a;l++)s[l]={},i=t[l].emailid,n=t[l].fullname,o=t[l].user_zuid,s[l].email=i?i:"",s[l].encodeName=n,s[l].id=parseInt(o),s[l].label=n+(i?i:""),s[l].name=n,s[l].type="user",s[l].image=ZWNetworkUtils.getUserImageURL(o);t=s,e=e.concat(t),u(e),UIUtils.hideLoadingMsg(),J.dialogutil.open("lockdialog",null,g),r=DocUtil.copyStyle(oldAttr)},d=function(){var e=new Deferred,t=null;if("OWNER"==editor.doc.getRole()){var i={};J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/util/sharedusers"),data:i,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(){e.reject([])},success:function(i){"FAILED"!==i.RESPONSE&&(t=i),t?(U.each(t,function(e){e.val=e.emailid,e.fullname=e.fullname?e.fullname:e.emailid}),e.resolve(t.users)):e.resolve([])}})}else e.resolve([]);return e.promise()},c=function(e){var t=J("#text-area");t.ztokenfield("setAttribute","dataSource",e||[])},u=function(t){e=t},p=function(){o=!0;var e=editor.doc,t=e.getSelection(),i=t.getStart(),n=t.getEnd(),r=e.getSectionStart(i),a=e.getSectionEnd(i),s=Lock.getLockRanges(i,n);Lock.isOtherUsersLockPresent(r+1,i)||Lock.isOtherUsersLockPresent(n,a-1)?J("#lock-unselect-cont").zstatebutton("disable"):(t.isUnlockAllowed()||s&&s.length>0)&&(J("#lock-select-cont").zstatebutton("disable"),J("#lock-unselect-cont").zstatebutton("checked",!0),J("#lock-select-cont").zstatebutton("checked",!1))},g={init:function(){c(e),J("#lockDialog").find("#text-areaztokenfield-input").off("focus.writer"),n=[]},get:function(e,t){if(o||p(),e=e.action,"LOCK-SELECT-CONT"==e)return"selection";if("REDACT"==e){if(i){var a,s=i.getDocOps(),a=s[1].lock_data.data.allowed_zuids;return a=a?a.split(","):[],J("#lockDialog").find("#allowed_lock").val(T(a)),oldAttr.redact=r.redact=s[1].lock_data.data.redact,s[1].lock_data.data.redact}}else if("recipients"==e&&i){var a,s=i.getDocOps(),a=s[1].lock_data.data.allowed_zuids;a=a?a.split(","):[];var l=T(a);return n=l,oldAttr.recipients=r.recipients=n,n}},set:function(e,t,i){"LOCK-SELECT-CONT"==e.action?(r["apply-lock"]=t,r["apply-lock-rev"]=!1):"LOCK-UNSELECT-CONT"==e.action?(r["apply-lock-rev"]=t,r["apply-lock"]=!1):"REDACT"==e.action?r.redact=1==i.is(":checked"):"recipients"==e.action&&(r.recipients=t,n=t)}},f=function(){J.dialogutil.close("lockdialog")},E=function(e){return e.sort(function(e,t){return e-t}),e},T=function(t){var i,n,o,r,a=[];t=t||[];var s=-1;for(s=t.indexOf(editor.zuid),s>-1&&t.splice(s,1),i=0,n=t.length;i<n;i++)for(o=0,r=e.length;o<r;o++)t[i]==e[o].zuid&&a.push(e[o].email);return a.join(",")},m=function(){var t,i,n,o,r,a=[],s=[],l=[],d=Z("text-area").ztokenfield("getAllValues");for(i=0,emailLength=d.length;i<emailLength;i++)t=d[i].email,t&&a.push(U.uniq(t.match(LockDlg.emailRegEx)));for(i=0,n=a.length;i<n;i++)for(o=0,r=e.length;o<r;o++)a[i]==e[o].email&&(e[o].id?s.push(e[o].id):l.push(a[i]));return s=E(s)},h=function(){var e={},t=m();e=DocUtil.copyStyle(r),e.allowed_zuids=editor.zuid+",",e.allowed_zuids+=t.join(","),jQuery.isEmptyObject(e)||1==e["apply-lock-rev"]?e["apply-lock-rev"]&&editor.doc.execCmd("lock_nonselction",e):editor.doc.execCmd("lock",e),editor.rebindEvents(),f(),editor.rebindEvents(LOCK_PERMISSION)},I=function(){return t},_=function(e,t){var i=editor.doc,n=i.getSelection(),o=n.getStart(),r=n.getEnd(),a=i.getSectionStart(o),s=i.getSectionEnd(o),l=n.isUnlockAllowed(),d=Lock.getLockRanges(o,r);J("#lockmenu").zmenu(l?"showMenuItems":"hideMenuItems",["menu-unlock-selection"]),J("#lockmenu").zmenu(l||d&&d.length>0?"hideMenuItems":"showMenuItems",["menu-lock-selection"]),J("#lockmenu").zmenu(l||Lock.isOtherUsersLockPresent(a+1,o)||Lock.isOtherUsersLockPresent(r,s-1)?"hideMenuItems":"showMenuItems",["menu-lock-nonselection"])};return{applyLock:h,emailRegEx:a,openLockDlg:s,getList:I,closeLockDlg:f,updateMenu:_}}();var PdfEventHandler=function(){"use strict";var e=function(){if(!ZWJSONUtils.isEmptyObject(editor.PDFStats)){for(var e,t=window.location.search.split("&"),i=0,n=t.length;i<n;i++)t[i].indexOf("iscsignature=")!=-1&&(e=t[i].replace("iscsignature=",""));t={};var o={};for(var r in editor.PDFStats)o[r]=editor.PDFStats[r];o.map_mailmerge&&delete o.map_mailmerge,t.pdfstats=JSON.stringify(o),J.ajax({type:"POST",global:!1,async:!0,url:ZWNetworkUtils.getContextUrl("internal/pdfstats"),data:t,error:function(){},success:function(){}})}},t=function(){try{var e=DocLayoutManager.getLastPage();if(1==e.getAbsolutePageNumber())return!1;if(e.endnote.length>0||e.footnote.length>0||1!=e.content.length)return!1;var t=e.content.first.columns.first;if(!t)return!1;for(var i;t;)return i=t.childViews,!(1!=i.length||!i.first||i.first.getType()!=VIEW.PARA||!i.first.getNode().isEmpty()||t.next);return!0}catch(e){return!1}},i=function(){try{var e=DocLayoutManager.getLastPage(),t=e.content;if(t.length>0){var i=t.first.columns;if(i.length>0){var n=i.first.childViews;if(n.length>0){var o=n.first.getDTView().prev;if(o&&o.getType()==VIEW.HR&&o.isPageBreak())return!0}}}return!1}catch(e){return!0}},n=function(e){if(t()&&!i()){var n=DocLayoutManager.getLastPage();if(n){var o=n.getId();e[0].querySelector("[doc-id="+o+"]").remove()}}},o=function(t,i){e(),t=t||J("body"),i=i||J("head"),PrintPreview.processFloatImagesForPrint(t[0]),PrintPreview.addAnchorTagToImages(t),PrintPreview.processAnchorTagToLinks(t),t.find(".endnotenum").addClass("zw-portion");var o=t.find("#editorpane");t.find("#ui-editor-outer-div").append(o),o.find("input[type=text]").removeAttr("placeholder"),t.find("#drawcontainer").remove(),r(t),n(t);var a=t.find("td.zw-td");a.each(function(){var e=J(this);parseFloat(e.css("border-top-width"))||e.css("border-top","none"),parseFloat(e.css("border-bottom-width"))||e.css("border-bottom","none"),parseFloat(e.css("border-left-width"))||e.css("border-left","none"),parseFloat(e.css("border-right-width"))||e.css("border-right","none")});var s=t.find("table.zw-table");s.each(function(){var e=J(this);parseFloat(e.css("border-top-width"))||e.css("border-top","none"),parseFloat(e.css("border-bottom-width"))||e.css("border-bottom","none"),parseFloat(e.css("border-left-width"))||e.css("border-left","none"),parseFloat(e.css("border-right-width"))||e.css("border-right","none")});var l=t.find(".zw-paragraph");l.each(function(){for(var e=this.getAttribute("class").split(" "),t=e.length,i=0;i<t;i++)if(e[i].indexOf("heading")!=-1){var n=e[i].replace("heading","");if(n>0&&n<=6){var o=document.createElement("h"+n);J(o).css({margin:"0px","line-height":"inherit"}).insertAfter(this),o.appendChild(this)}break}});for(var d=t[0].getElementsByTagName("path"),c=d.length-1;c>=0;c--){var u=d[c],p=u.getAttribute("stroke-opacity");null!=p&&p<.2&&u.parentNode.removeChild(u)}t.find("span.autopcnt,span.autopno,span.autopno_toc,span.autodocname,span.autoauthor,span.autodate,span.autoformula,span.endnote,span.footnote,span.autodocversion").each(function(){var e=J(this).find("div.field_text_node").html();e&&(this.innerHTML=e)});var g=editor.doc.getBodyFormat(),f=g[ATTR_BODY.DS_BGC];if(f=Utils.getColorValFromRefString(f)){var E=t.find("#pdf-bg"),T="body { background-color:"+f+" !important";E[0]||(E=J('<style id="pdf-bg" type="text/css"></style>'),t.append(E)),E.text(T)}for(var m=t.find(".zw-page"),h=m.length,c=0;c<h;c++)m[c].style.overflow="hidden",PrintPreview.signerFieldPrintProcessing(m[c]);isHeadlessPDF&&PrintPreview.addDifferentPageSizeStylesForPDF(t,i[0]),t.find("#ui-editor-outer-div")[0].style.height=""},r=function(e){var t=e.find(".header_primary,.footer_primary");t.each(function(e,t){var i=J(t),n=i.find(".shape_box");0!=n.length&&J.each(n,function(e,t){var i=J(t);if(i.hasClass("watermark_cont")){var n=a(J(t).find("div:first-child"));i.html("").append(n)}else{var o=J(document.createElement("DIV")),n=a(i);o.append(n),i.html("").append(o)}})})},a=function(e,t){var i=J(document.createElement("DIV")),n=Shapes.getShapeData(e.attr("id"));Shapes.renewShape(n);var o=Shapes.createShape(n,i);return o},s=function(){var e=editorProps.options&&editorProps.options.conversiondatabean?JSON.parse(editorProps.options.conversiondatabean):null,t=!!editorProps.options&&editorProps.options.isMailMerge,i=c(e),n=d(e)&&l(e),r=e&&e.apply_fill_conditions;t||!isHeadlessPDF||i||n||r||(DomViewManager.updatePDFVisibilityStatus(!0),DomViewManager.renderAllPages(),setTimeout(function(){try{o()}catch(e){}PubSub.publish("Documnent/UpdateWindowsStatus")},500))},l=function(e){var t=editor.signerInfo||e.signer_info;"string"==typeof t&&(t=JSON.parse(t));var i=!!Utils.getRecipientsWithoutSignerFields(t).length;return i},d=function(e){var t=editor.signerInfo&&editor.signerInfo.length;return t=t||!!editor.signerInfo||!(!e||!e.signer_info),!!t},c=function(e){var t=!!e&&e.isFillableFieldMerge;return t=t||!!editor.fillableFieldData||!(!e||!e.fillable_field_data),!!t},u=function(){var e=function(e){for(var t in e)return"object"!=typeof e[t]},t=function(e){ZWLogger.addToStatistics("PDF Generated From "+(e?"Fill and Merge API":"Published Fillable Document"))},i=function(e,t,i,o){var r,a,s=o.getFillableFieldType(),l=o.isFillableImageField(),d=o.rawFormat;if(o&&(l?d[ATTR_FILLABLEFIELD.FF_INFO][e]:o[e])&&i.hasOwnProperty(l?d[ATTR_FILLABLEFIELD.FF_INFO][e]:o[e]))if(r=i[l?d[ATTR_FILLABLEFIELD.FF_INFO][e]:o[e]],a=t?Utils.getValueFromResult(o,r):r.hasOwnProperty("value")?r.value:r[1],s===FILLABLEFIELD_TYPE.SELECTBOX){r=o.getSelectedIndex();var c=r[7];null!=a&&r!==a&&o.setSelectedIndex(a),null!=c&&c!==o.getList()&&o.setList(c)}else if(s===FILLABLEFIELD_TYPE.CHECKBOX||s==FILLABLEFIELD_TYPE.RADIO||s==FILLABLEFIELD_TYPE.MULTIPLECHOICE)r=o.isChecked(),null!=a&&r!==a&&o.setChecked(a);else if(l&&o.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE){var u=r[4],p=r[3];r=o.getValue(),null!=a&&r!==a&&o.setValue(a),p&&o.setFormats({ht:p.ht,wid:p.wid}),u&&(o.style.cropRect=u)}else if(r=o.getValue(),null!=a&&r!==a&&o.setValue(a),!t&&" "==a&&" "==r&&!o[ATTR_FILLABLEFIELD.FF_NAME]){var g=o.getStart();n.push(g.start+2)}},n=[];return function(o,r){var a=editor.fillableFieldData||r.fillable_field_data;"string"==typeof a&&(a=JSON.parse(a));var s=a.is_test_submission;delete a.is_test_submission;var l=a.sequence_number_info;l&&!ZWJSONUtils.isEmptyObject(l)&&(delete a.sequence_number_info,editor.getDocument().replaceSequenceNumbersInDocument(l)),editor.getDocument().regenerateQRCodeAndBarcodeWithFilledValues(a);var d=editor.getDocument(),c=e(a),u=c?ATTR_FILLABLEFIELD.FF_NAME:ATTR_COMMON.ID;return JSON.stringify(a).length>2&&d.visitAllFields(NODE_TYPE.FILLABLEFIELD,i.bind(null,u,c,a)),t(c),s&&d.addWatermark("text",{content:"SAMPLE"}),o&&d.applyChanges(),n.forEach(function(e){var t=J(editor.doc.getPortionData(e).node);t.css({"border-bottom":"2px groove rgb(0, 0, 0)"})}),!o&&d.getChanges()}}(),p=editorProps.options&&editorProps.options.conversiondatabean?JSON.parse(editorProps.options.conversiondatabean):null;window.FillableFieldHeadlessMerge=function(){return{mergeFieldData:function(e){return c(p)&&u(e,p)}}}();var g,f=function(){var e,t,i,n,o,r,a=function(){if(!e&&(e=editorProps.options&&editorProps.options.conversiondatabean?JSON.parse(editorProps.options.conversiondatabean):null,c(e)&&(t=!0),e&&e.apply_fill_conditions&&(n=!0),d(e)&&(i=!0),isHeadlessPDF&&e&&e.isSignerFieldJSONRequired)){var r="@media print{span.signerfield .zw-text-portion{color:transparent !important}}",a=document.createElement("style");a.id="signerfield-media-style",a.type="text/css",document.head.appendChild(a),J(a).text(r)}o=!("undefined"==typeof editorProps||!editorProps.options)&&editorProps.options.isMailMerge},s=function(e,t,i){(e||t||i)&&PubSub.subscribe("Document/LoadingComplete",f)},p=function(){if(PubSub.unsubscribe("DocOperation/CommandComplete",p),n){i?PubSub.subscribe("DocOperation/CommandComplete",E):PubSub.subscribeOnce("Document/Pagination/Complete/ProcessDocument",T),n=!1;var e=ConditionsEvaluator.evaluateFillableFields(),t=FormulaHandler.getUpdateFormulaOpsForFillable(0,editor.doc.getContent().length);e.isEmpty()&&t.isEmpty()&&(i?E():r&&T()),e.applyOp(t),e.applyTo()}},E=function(){if(PubSub.unsubscribe("DocOperation/CommandComplete",E),i){PubSub.subscribeOnce("Document/Pagination/Complete/ProcessDocument",T),i=!1;var t=editor.signerInfo||e.signer_info;"string"==typeof t&&(t=JSON.parse(t));var n=Utils.appendDigisignFields(t);ZWLogger.addToStatistics("Digisign Fields appended to document"),!n&&r&&T()}},T=function(){o||t||i||n||!e||(e&&(PubSub.publish("Document/beforePDFStart"),PubSub.publish("Documnent/UpdateWindowsStatus")),e=null)};return a(),g=s.bind(null,t,i,n),PubSub.subscribeOnce("Document/Pagination/Complete/ProcessDocument",function(){r=!0}),function(){isHeadlessPDF&&(t&&(n&&!i&&PubSub.subscribe("DocOperation/CommandComplete",p),!n&&i&&PubSub.subscribe("DocOperation/CommandComplete",E),!n&&!i&&PubSub.subscribeOnce("Document/Pagination/Complete/ProcessDocument",T),t=!1,u(!0,e)),n&&!t&&p(),!i||n||t||l(e)&&E())}}();g();var E=function(e){var t,i,n,o,r,a,s,l,d,c,u,p,r,g,f,E=e?e.getElementsByClassName("zw-image"):document.getElementsByClassName("zw-image");a=document.createElement("canvas"),document.body.appendChild(a),s=document.createElement("canvas"),document.body.appendChild(s);for(var T=[],m=0,h=E.length;m<h;m++)try{if(t=E[m],i=JSON.parse(t.getAttribute("data-fmt")),t.removeAttribute("data-fmt"),!i)continue;if(l=i[ATTR_IMAGE.I_CROPRECT],DomUtil.isCropImge(i)){var I=!1;for(var _ in l)if(isNaN(parseFloat(l[_]))){I=!0;break}if(I)continue;if("%"==i[ATTR_IMAGE.I_WID_UN])p=DocLayoutManager.getCurrentColumn().getWidth(),r=i[ATTR_IMAGE.I_ORGINALHT]*DocLayoutManager.getCurrentColumn().getWidth()/i[ATTR_IMAGE.I_ORGINALWID];else{var A=ZWImageUtils.getOrginalHeighWidthOfImage(i);p=A.wid,r=A.ht}d=J("[data-id="+t.getAttribute("id")+"]")[0],d||isHeadlessPDF?T.contains(d)||T.push(d):d=J("img[src*='"+DomUtil.processImgSrc(i.src)+"']")[0];var S=ZWImageUtils.convertCropDataToPixel(l,r,p);a.width=d.naturalWidth,a.height=d.naturalHeight,g=a.getContext("2d"),c=d.naturalWidth/p*i.wid,u=d.naturalHeight/r*i.ht,g.drawImage(d,d.naturalWidth/p*S.cropLeft,d.naturalHeight/r*S.cropTop,c,u,0,0,c,u),o="",n=i.src||"",n.indexOf("localhost:8080/writer/zdoc")==-1&&n.indexOf("/writer/pdfimages/")==-1||(o=n.substring(n.lastIndexOf(".")+1)),o||(o="png"),s.width=c,s.height=u,f=s.getContext("2d"),f.drawImage(a,0,0,c,u,0,0,c,u);var R="http";t.setAttributeNS(R+"://www.w3.org/1999/xlink","xlink:href",s.toDataURL("image/"+o)),t.setAttribute("width",i.wid+"px"),t.setAttribute("height",i.ht+"px"),DTUtils.isFloatingImage(i)||J(t).parent().css({"margin-left":"","margin-top":"",width:i.wid,height:i.ht}).parent().css("overflow","")}}catch(e){}for(var h=T.length,m=0;m<h;m++){var d=T[m];document.body.removeChild(d)}document.body.removeChild(a),document.body.removeChild(s)},T=function(){for(var e,t,i,n,o,r,a,s={},l=editor.getDocument(),d=document.body.getElementsByClassName("zw-page"),c=[],u={},p=0;p<d.length;p++){var g=d[p];e=g.getElementsByClassName("fillablefield"),e.length&&(s["Page"+(p+1)]=u),u.pageHeight=g.offsetHeight,u.pageWidth=g.offsetWidth;for(var f=0,E=e.length;f<E;f++)if(t=e[f].getAttribute("data-field-id")){a={},i=e[f].getBoundingClientRect(),n=PUtil.offset(e[f],g),o=l.getFieldById(t),a.style=o.rawFormat;var T;T=o.hasOwnProperty("start")?o.start:o.getStart().getIndex(),a.fieldStartFormat=DocUtil.getRenderingFormat(editor.doc.getRawComputedTextFormatAt(T)),a.fieldContentFormat=DocUtil.getRenderingFormat(editor.doc.getRawComputedTextFormatAt(T+1)),r={},a.rect=r,a.value=o.getFillableFieldResult(),r.width=e[f].offsetWidth,r.height=i.height,r.top=n.top,r.left=n.left,c.push(a)}u.rects=c,c=[],u={}}return s},m=function(){for(var e,t,i,n,o,r,a,s={},l=editor.getDocument(),d=document.body.getElementsByClassName("zw-page"),c=[],u={},p=0;p<d.length;p++){var g=d[p];e=g.getElementsByClassName("signerfield"),e.length&&(s["Page"+(p+1)]=u),u.pageHeight=g.offsetHeight,u.pageWidth=g.offsetWidth;for(var f=0,E=e.length;f<E;f++)if(t=e[f].getAttribute("data-field-id")){a={},i=e[f].getBoundingClientRect(),n=PUtil.offset(e[f],g),o=l.getFieldById(t),a.style=o.rawFormat;var T;T=o.hasOwnProperty("start")?o.start:o.getStart().getIndex(),a.fieldStartFormat=DocUtil.getRenderingFormat(editor.doc.getRawComputedTextFormatAt(T)),a.fieldContentFormat=DocUtil.getRenderingFormat(editor.doc.getRawComputedTextFormatAt(T+1)),r={},a.rect=r,a.value=o.getValue(),r.width=e[f].offsetWidth,r.height=i.height,r.top=n.top,r.left=n.left,c.push(a)}u.rects=c,c=[],u={}}return s},h=function(){try{PubSub.publish("Document/SendPDFStats","Completed")}catch(e){}window.status="PaginationCompleted"},I=function(e){if(isHeadlessPDF||isHeadlessHTML){var t,i="Doc";isHeadlessPDF?t="PDF":isHeadlessHTML&&(t="HTML");var n;n=editor.PDFStats.formula_mailmerge?"FormulaMailmerge":editor.PDFStats.table_sort_mailmerge?"TableSortMailmerge":editor.PDFStats.map_mailmerge?"MapMailmerge":editor.PDFStats.mailmerge_recordrange?"Mailmerge":editor.PDFStats.if_else?"ConditionalField":"";var o=n+e;ActivityTracker.trackWriterStats(t,o,i),PubSub.unsubscribe("Document/SendPDFStats",I)}},_=function(){var e="Document/Pagination/Complete";return editor.isDeferredDocLoading&&(e="BuildChanges/Completed"),e},A=function(){var e="Document/Pagination/Complete/ProcessDocument";return editor.isDeferredDocLoading&&(e="Document/BuildChanges/Complete/ProcessDocument"),e},S=function(){var e=_(),t=A();PubSub.subscribe(e,function(){PubSub.publish(t)}),PubSub.publish(t)},R=function(){if(isHeadlessPDF){var e=Toc.getPageNumberOps();if(e&&e.length){PubSub.subscribeOnce("Document/Pagination/Complete",function(){isHeadlessPDF&&DomViewManager.updatePDFVisibilityStatus(!0),DomViewManager.renderAllPages(),setTimeout(function(){S()},500)});var t=DocOpBuilder.build(e);t.applyTo()}else S()}else S()},O=function(){var e=_();PubSub.unsubscribe(e,O,{async:!0,timeout:500});var t=editorProps.options&&editorProps.options.conversionoptionsbean&&JSON.parse(editorProps.options.conversionoptionsbean).test_mode;if(t){PubSub.subscribeOnce(e,R);var i=editor.getDocument();i.addWatermark("text",{content:"SAMPLE"}),i.applyChanges()}else R()},b=function(){PubSub.subscribe(_(),O,{async:!0,timeout:500})};return PubSub.subscribe("Document/SendPDFStats",I),PubSub.subscribe("Documnent/UpdateWindowsStatus",h),PubSub.subscribe("Document/beforePDFStart",o),PubSub.subscribe("Document/BeforeLoading",b),PubSub.subscribe("Document/Pagination/Complete/ProcessDocument",s),{getFillableFieldsRect:T,upadteCropImageSrc:E,updateWindowStatus:h,getSignerFieldsRect:m}}(),ConditionsEvaluator=function(){"use strict";var e=function(e,t){if(e.condition[0].lhs.type===NODE_TYPE.FILLABLEFIELD){for(var i,n,o=e.condition,a=0;a<o.length;a++){var s=o[a],l=editor.getDocument().getFieldById(s.lhs.fieldId);switch(l&&l.getFillableFieldType()){case FILLABLEFIELD_TYPE.CHECKBOX:i=l.isChecked().toString()||"";break;case FILLABLEFIELD_TYPE.SELECTBOX:i=l.getFillableFieldResult()||"";break;case FILLABLEFIELD_TYPE.CURRENCY:i=Utils.getFillableFieldResult(l.rawFormat);break;case FILLABLEFIELD_TYPE.MULTIPLECHOICE:case FILLABLEFIELD_TYPE.RADIO:i=Utils.getRadioOrMultipleChoiceValue(l)||"";break;default:i=l?l.getValue():""}if(t[s.lhs.fieldId]=i,n=s.rhs.value,n&&isNaN(n)&&n.indexOf("{")!=-1&&n.indexOf("}")!=-1){var d=n.indexOf("{"),c=n.indexOf("}"),u=n.substring(d+1,c);if(s.rhs.fieldInfo){var p,u=editor.getDocument().getFieldById(s.rhs.fieldInfo[0].fieldId);switch(u&&u.getFillableFieldType()){case FILLABLEFIELD_TYPE.CHECKBOX:p=u.isChecked();break;case FILLABLEFIELD_TYPE.SELECTBOX:p=u.getFillableFieldResult();break;case FILLABLEFIELD_TYPE.CURRENCY:p=Utils.getFillableFieldResult(u.rawFormat);break;case FILLABLEFIELD_TYPE.MULTIPLECHOICE:case FILLABLEFIELD_TYPE.RADIO:p=Utils.getRadioOrMultipleChoiceValue(u)||"";break;default:p=u?u.getValue():""}n=n.substring(0,d)+p+n.substring(c+1,n.length)}s.rhs.value=n}if(l&&!RESTRICTED_DATE_OPERATORS.contains(s.operator)&&l.getFillableFieldType()==FILLABLEFIELD_TYPE.DATE&&(n=r(s.operator,s.rhs,{format:l.getFormat()}),"Invalid Date"==n))return!1;s.rhs.value=n}e.condition=o}},t=function(t,n,o){o=o||!1;var r,a,l=t.content,d=t.styles,c={},u=[],p=ZWJSONUtils.clone(d[n]);if(p){editor.PDFStats.if_else=!0,e(p,c);var g={fieldValue:c,pattern:p.pattern,conditions:p.condition,locale:DocLocaleHandler.getLanguage()};if(!JSONEvaluator.checkPattern(p.pattern))return!1;for(var f=JSONEvaluator.evaluate(g),E=l.indexOf(UNICODE.RANGE_START,n),T=l.indexOf(UNICODE.FIELD_SEPARATOR,E+1);d[T].id!=p.id;)T=l.indexOf(UNICODE.FIELD_SEPARATOR,T+1);var m=Utils.getRangeEnd(t,E);u.push({r:E},{ds:UNICODE.RANGE_START});var h=new DocOpBuilder;if(f){r=E,a=T;var I=l.substring(T,m+1);u.push({r:T-E-1},{ds:I});for(var _=l.indexOf(UNICODE.IMAGE,T);_!=-1&&_<=m;){var A=[],S=d[_];if(S&&S[ATTR_COMMON.SUBTYPE]==NODE_TYPE.TEXTBOX){var R=i(S.id,l,d),O=l.substring(R.start,R.end);A.push({r:R.start},{ds:O}),A=DocOpBuilder.xform(h,DocOpBuilder.build(A)).second,h=DocOpBuilder.concise(DocOpBuilder.compose(h,A))}_=l.indexOf(UNICODE.IMAGE,_+1)}}else{r=T,a=m;var I=l.substring(E+1,T+1);u.push({ds:I}),u.push({r:m-T-1},{ds:UNICODE.RANGE_END});for(var _=l.indexOf(UNICODE.IMAGE,E+1);_!=-1&&_<=T;){var A=[],S=d[_];if(S&&S[ATTR_COMMON.SUBTYPE]==NODE_TYPE.TEXTBOX){var R=i(S.id,l,d),O=l.substring(R.start,R.end);A.push({r:R.start},{ds:O}),A=DocOpBuilder.xform(h,DocOpBuilder.build(A)).second,h=DocOpBuilder.concise(DocOpBuilder.compose(h,A))}_=l.indexOf(UNICODE.IMAGE,_+1)}}h=DocOpBuilder.xform(DocOpBuilder.build(u),h).second,u=DocOpBuilder.concise(DocOpBuilder.compose(DocOpBuilder.build(u),h)).toJson();var b=s(t,r+1,a);return b=DocOpBuilder.xform(DocOpBuilder.build(u),b).second,u=DocOpBuilder.concise(DocOpBuilder.compose(DocOpBuilder.build(u),b)).toJson(),{opMsg:u,ifEndIndex:m}}},i=function(e,t,i){for(var n=t.indexOf(UNICODE.SECTION_START);n!=-1;){var o=i[n]||{},r=o.sid;if(e==r)break;n=t.indexOf(UNICODE.SECTION_START,n+1)}if(n==-1)return null;var a=t.indexOf(UNICODE.SECTION_START,n+1);a==-1&&(a=t.length);var s={};return s.start=n,s.end=a,s},n=function(e,t,i){for(var n=e.content,r=e.styles,a=DocUtil.copyStyle(r[t]),s=o(a,i),l=n.indexOf(UNICODE.RANGE_START,t),d=n.indexOf(UNICODE.FIELD_SEPARATOR,l+1);r[d].id!=a.id;)d=n.indexOf(UNICODE.FIELD_SEPARATOR,d+1);var c=Utils.getRangeEnd(e,l),u={},p=[],g=[];if(s.result){var f={from:l,to:l};p.push(f);var E={from:d,to:c};p.push(E);var T={from:l+1,to:d-1};g.push(T)}else{var m={from:l,to:d};p.push(m);var h={from:c,to:c};p.push(h);var I={from:d+1,to:c-1};g.push(I)}return u.insertInfo=g,u.deleteInfo=p,u},o=function(e,t){var i=e.pattern,n=!1;if(!JSONEvaluator.checkPattern(i))return!1;for(var o=e.fieldInfos||{},a={},s=e.condition,l=0;l<s.length;l++){var d=s[l],c=d.rhs,u=c.value;if(isNaN(u)){if(u=t.replaceFieldsInObject(u,o),!TEXT_DATE_FILTER_OPERATORS.contains(d.operator)&&!RESTRICTED_DATE_OPERATORS.contains(d.operator)&&c.fieldInfo&&"date"==o[c.fieldInfo[0].fieldId].type){var p=o[c.fieldInfo[0].fieldId].date_info||{},g=p.output;if("Invalid Date"==u)n=!0;else if(g&&!ZWJSONUtils.isEmptyObject(g)&&g.format&&g.locale&&g.timezone)try{u=new ZWDateTime(u,"custom"==g.format?g.custom_format:g.format,g.locale,g.timezone,"custom"==g.format)._originalUTC}catch(e){throw e}}c.value=u}var f=d.lhs,E=f.fieldId;if(u=o[E]&&o[E].type==MAILMERGE.FIELD_TYPE.DATE?t.getFieldValue(o[E]):t.replaceFieldsInObject(UNICODE.MERGEFIELD_START+E+UNICODE.MERGEFIELD_END,o,{type:MAILMERGE.FIELD_TYPE.TEXT}),a[E]=u,!TEXT_DATE_FILTER_OPERATORS.contains(d.operator)&&!RESTRICTED_DATE_OPERATORS.contains(d.operator)&&o[E]&&o[E].type==MAILMERGE.FIELD_TYPE.DATE){var p=o[E].date_info||{},T=p.output,m=a[E];if("Invalid Date"!=m){if(T&&!ZWJSONUtils.isEmptyObject(T)&&T.format&&T.timezone&&T.locale)try{var h="custom"==T.format,I=new ZWDateTime(m,h?T.custom_format:T.format,T.locale,T.timezone,h);a[E]=I._originalUTC;var _=r(d.operator,c,T);"Invalid Date"==_?n=!0:d.rhs.value=_}catch(e){throw e}}else n=!0}}if(n)return{result:!1};var A={fieldValue:a,pattern:i,conditions:s,locale:DocLocaleHandler.getLanguage()},S=JSONEvaluator.evaluate(A),R={result:S};return R},r=function(e,t,i){var n=t.value,o=parseInt(t.value);try{var r={days:0,months:0,years:0};if(e.startsWith("Less than N")?(r.mode="subtract",r[e.substring(e.lastIndexOf(" ")+1).toLowerCase()]=!isNaN(o)&&o||0):e.startsWith("Greater than N")&&(r.mode="add",r[e.substring(e.lastIndexOf(" ")+1).toLowerCase()]=!isNaN(o)&&o||0),r.mode||t.isauto){var a="",s="custom"==i.format,l=new ZWDateTime(a,s?i.custom_format:i.format,i.locale,i.timezone,s);l.adjustDate(r);var d;d=s?l.customFormat(i.custom_format,i.locale,i.timezone):l.format(i.format,i.locale,i.timezone),l=new ZWDateTime(d,s?i.custom_format:i.format,i.locale,i.timezone,s),n=l._originalUTC}return n}catch(e){return"Invalid Date"}},a=function(t){for(var i,n,o,r=editor.doc.getFormats(),a=t&&t.length?t:RangeCollection.getRangesBasedOnType(NODE_TYPE.FILLABLEFIELD),s=a.length-1;s>=0;s--){o={},i=a[s],n=ZWJSONUtils.clone(r[i.start]),e(n,o);var l={fieldValue:o,pattern:n.pattern,conditions:n.condition,locale:DocLocaleHandler.getLanguage()};if(JSONEvaluator.checkPattern(n.pattern)){var d=JSONEvaluator.evaluate(l),c=DocUtil.getFieldSeparatorIndex(i.start);c!=-1&&(d?ConditionalUIHandler.hideRange(i.id,[{start:i.start,end:i.start+1,isIfConditionShown:!0},{start:c,end:i.end,isIfConditionShown:!0}]):ConditionalUIHandler.hideRange(i.id,[{start:i.start,end:c+1,isIfConditionShown:!1},{start:i.end-1,end:i.end,isIfConditionShown:!1}]))}}},s=function(e,i,n){var o=editor.doc.getDocumentContent();e=e||{},i=i||0,n=n||o.length;var r=editor.doc.getFormats();e.content=o,e.styles=r;var a=new DocOpBuilder,s=RegExp(UNICODE.RANGE_START,"gi");s.lastIndex=i;for(var l=s.exec(o);l&&l.index<n;){var d=[],c=l.index,u=DocUtil.copyStyle(r[c])||{};if(u.type===NODE_TYPE.CONDITIONAL_IF_START&&u.condition[0].lhs&&u.condition[0].lhs.type===NODE_TYPE.FILLABLEFIELD){var p=t(e,c,!0);if(d.push(),!p){l=s.exec(o);continue}d=d.concat(p.opMsg),s.lastIndex=p.ifEndIndex}d=DocOpBuilder.xform(a,DocOpBuilder.build(d)).second,a=DocOpBuilder.concise(DocOpBuilder.compose(a,d)),l=s.exec(o)}return a},l=function(e){if(!e.oldCondition&&e.fieldInfos)return e.fieldInfos;for(var t={},i=e.condition,n=0,o=i.length;n<o;n++){var r=i[n],a=r.lhs||{},s=a.type||NODE_TYPE.MAILMERGEFIELD;if(a.fieldId&&s==NODE_TYPE.MAILMERGEFIELD&&!t.hasOwnProperty(a.fieldId)){var l=a.fieldId,d=MailMergeFieldUtil.getFieldInfo(l);d||(d=MailMergeFieldUtil.getNewFieldInfo(l)),t[l]=d}if(r.rhs&&r.rhs.fieldInfo&&r.rhs.fieldInfo[0].type===NODE_TYPE.MAILMERGEFIELD&&!t.hasOwnProperty(r.rhs.fieldInfo[0].fieldId)){var l=r.rhs.fieldInfo[0].fieldId,d=MailMergeFieldUtil.getFieldInfo(l);d||(d=MailMergeFieldUtil.getNewFieldInfo(l)),t[l]=d}}return t};return PubSub.subscribe(["Document/LoadingComplete","Document/AfterInit"],function(){editor.doc.applyConditionsForFillableFields()&&ConditionsEvaluator.evaluateFillableFieldsInPreviewMode()}),{evaluate:t,evaluateMailMergeParaCondition:n,evaluateForMailMerge:o,evaluateFillableFields:s,getMergeFieldsUsedInConditions:l,evaluateFillableFieldsInPreviewMode:a}}(),DateUtil=function(){var e=function(e){return!!(e.timezone&&e.locale&&e.format)&&("custom"!=e.format||!!e.custom_format)},t=function(t){return!(ZWJSONUtils.isEmptyObject(t)||!e(t.input)||!e(t.output))};return{isValidDateInfo:t}}(),DateFormatConfigDlg=function(){var e,t,i={},n=null,o=function(){Jlocale=J("#filter-date-locale"),t=J("#filter-date-timezone"),e=J("#filter-date-format"),JFormatErrorLabel=J("#filter-date-format-error-label"),JFilterTooltipMonthShort=J("#filter-tooltip_month_short"),JFilterTooltipMonthLong=J("#filter-tooltip_month_long"),JDateFormatLabel=J("#date-format-label"),JCalculatedDateFormatLabel=J("#calculated-date-format-label")},r=function(e){var t="EEEE|EEE|DD|D|MMMM|MMM|MM|M|YYYY|YY|HH|hh|mm|ss|zz|z",i=new RegExp('^[^~*?()#%<>"&apos;|0-9]*$');return e=e.replaceAll(new RegExp(t),""),e=e.trim(),!(!e.match(i)||e.match(new RegExp("[a-z]+|[A-Z]+")))},a=function(t){t?(JFormatErrorLabel.removeClass("ui-hide"),e.addClass("ui-validation-error")):(JFormatErrorLabel.addClass("ui-hide"),e.removeClass("ui-validation-error"))},s=function(){DomUtil.populateTimezoneOptions(t,i.output.locale);var e=DocLocaleHandler.getLanguageDetails(i.output.locale),n=e&&e.timezones;n&&n.length&&(n.includes(i.output.timezone)||(i.input.timezone=n[0],i.output.timezone=n[0])),t.zselectbox("setValue",i.output.timezone)},l=function(){var e=DocLocaleDlg.getLanguageOptions();Jlocale.zcombobox("removeAllOptions"),Jlocale.zcombobox("addOption",e)},d={init:function(){o(),l(),p(),J("#date-format-config-save").off("click").on("click",function(){var t=e.val();i.output.custom_format=t,i.input.custom_format=t,r(t)&&(n&&n(i),f())})},get:function(e,t){switch(e.action){case"input_locale":if(i.output.locale)return s(),u(),i.output.locale;case"input_timezone":if(i.output.timezone)return i.output.timezone;case"custom_input_format":if(i.output.custom_format){var n=i.output.custom_format;return r(n)?(c(!0),a(!1)):a(!0),n}}},set:function(e,t,n){switch(e.action){case"input_locale":i.output.locale=t,i.input.locale=t,s(),u();break;case"input_timezone":i.output.timezone=t,i.input.timezone=t}}},c=function(e){var t=i.output.custom_format;if(t&&e){var n=new ZWDateTime(new Date,null,i.output.locale,i.output.timezone),o=n.customFormat(i.output.custom_format,i.output.locale,i.output.timezone);JDateFormatLabel.text(i.output.custom_format),JCalculatedDateFormatLabel.text(o)}},u=function(){var t=new ZWDateTime;t.setLocale(i.output.locale),t.setTimezone(i.output.timezone);var n=t.getDateObj();n.setMonth(11),t.setDateObj(n),JFilterTooltipMonthShort.text("("+t.getMonth("short")+")"),JFilterTooltipMonthLong.text("("+t.getMonth("long")+")"),c(r(e.val()))},p=function(){e.unbind("focusout"),e.focusout(function(){var t=e.val();i.input.custom_format=t,i.output.custom_format=t,r(t)?(c(!0),a(!1)):a(!0)})},g=function(e){if(n=e.callback||null,!e||ZWJSONUtils.isEmptyObject(e))i={output:{format:"custom"},input:{format:"custom"}};else{var t=ZWJSONUtils.clone(e),o=t.output||{},r=t.input||{};i={output:{format:"custom",custom_format:"custom"==o.format?o.custom_format:"",timezone:o.timezone,locale:o.locale},input:{format:"custom",custom_format:"custom"==r.format?r.custom_format:"",timezone:r.timezone,locale:r.locale}}}i=i||{},J.dialogutil.open("dateformatconfigdialog",null,d)},f=function(){J.dialogutil.close("dateformatconfigdialog")};return{openPopup:g,closePopup:f}}(),ConditionsDlg=function(){"use strict";var e,t,i,n,o,r,a,s,l,d,c,u="{content to be shown if the condition is true}",p="{content to be shown otherwise}",g=null,f=!1,E=null,T=!1,m=!1,h=!1,I=!1,_="",A={},S={},R={},O={},b={},v={Contains:J.i18n("writer.common.CONTAINS"),"Contains-IC":J.i18n("writer.common.CONTAINS_IGNORECASE"),"Does not Contain":J.i18n("writer.common.DOES_NOT_CONTAIN"),"Does not Contain-IC":J.i18n("writer.common.DOES_NOT_CONTAIN_IGNORECASE"),"Begins With":J.i18n("writer.common.BEGINS_WITH",[""]),"Begins With-IC":J.i18n("writer.common.BEGINS_WITH_IGNORECASE"),"Ends With":J.i18n("writer.common.ENDS_WITH",[""]),"Ends With-IC":J.i18n("writer.common.ENDS_WITH_IGNORECASE"),Is:J.i18n("writer.common.IS"),"Is-IC":J.i18n("writer.common.IS_IGNORECASE"),"Is Empty":J.i18n("writer.common.IS_EMPTY"),"Is Not Empty":J.i18n("writer.common.IS_NOT_EMPTY"),"Is not":J.i18n("writer.common.IS_NOT"),"Is not-IC":J.i18n("writer.common.IS_NOT_IGNORECASE"),"Greater Than":J.i18n("writer.common.IS_GREATER_THAN"),"Less Than":J.i18n("writer.common.IS_LESS_THAN")},D={Is:J.i18n("writer.common.IS"),"Is Empty":J.i18n("writer.common.IS_EMPTY"),"Is not":J.i18n("writer.common.IS_NOT"),"Is Not Empty":J.i18n("writer.common.IS_NOT_EMPTY"),"Greater Than":J.i18n("writer.date.IS_GREATER_THAN_SPECIFIC_DATE"),"Greater than N Days":J.i18n("writer.date.IS_GREATER_THAN_N_DAYS"),"Greater than N Months":J.i18n("writer.date.IS_GREATER_THAN_N_MONTHS"),"Greater than N Years":J.i18n("writer.date.IS_GREATER_THAN_N_YEARS"),"Less Than":J.i18n("writer.date.IS_LESS_THAN_SPECIFIC_DATE"),"Less than N Days":J.i18n("writer.date.IS_LESS_THAN_N_DAYS"),"Less than N Months":J.i18n("writer.date.IS_LESS_THAN_N_MONTHS"),"Less than N Years":J.i18n("writer.date.IS_LESS_THAN_N_YEARS")},L=function(e){r=J("#conditions_body_datepicker-container"),a=J("#conditions-DatePicker"),s=J("#conditionsPopup"),m=!1,h=!1,b={},O={},A={},S={},R={},_="",l=e&&e.rowDiv||J("div#manualPts"),d=e&&e.patternId||"displayId",c=e&&e.conjunctionMenuId||"ui-condtn-menu"},N=function(e){L(e),0==r.length&&(r=J("<div>").attr({id:"conditions_body_datepicker-container",style:"display: none"}).appendTo("body"))},P={init:function(){g=document.getElementById("conditionsPopup"),L(),e==NODE_TYPE.FILLABLEFIELD?s.parents(".zdialog__content").parent().removeClass("ui-conditions-adj-width"):s.parents(".zdialog__content").parent().addClass("ui-conditions-adj-width"),0==r.length&&(r=J("<div>").attr({id:"conditions_body_datepicker-container",style:"display: none"}).appendTo("body"))},beforeFillValues:function(){var r=editor.doc.getSelection().getStart(),a=editor.doc.getRawFormatAt(r),s=J("#table-row-condtion");if(o=J("#row-condition"),n=editor.doc.getSelection().getParents(NODE_TYPE.ROW),e==NODE_TYPE.FILLABLEFIELD||!n||n.attr("*")&&n.attr("condition")||f||n.dtNode.isVerticalMergedRow()||a&&"conditional_if_start"===a.type?(o.zstatebutton("checked",!1),s.hide()):s.show(),n&&n.attr("*")&&n.attr("condition")&&f)J("#conditionspopupzdialog").zdialog("setAttributes",{title:J.i18n("writer.mailmergepopup.EDIT_CONDITIONS")}),z(n.attr("*")),J("#applyCondition").hide(),J("#updateCondition").show();else if(a&&"conditional_if_start"==a.type&&a.condition[0].lhs.type===e)J("#conditionspopupzdialog").zdialog("setAttributes",{title:J.i18n("writer.mailmergepopup.EDIT_CONDITIONS")}),z(a),J("#applyCondition").hide(),J("#updateCondition").show();else{var l=Utils.randomString();ConditionsDlg.addManualPtRow(l)}e===NODE_TYPE.FILLABLEFIELD&&Object.keys(t).length>Object.keys(i).length&&Notification.show({container:"#condition-notify-cont",message:"writer.common.UNLABELLED_FIELDS_MISSING_MSG",close:!1,setTimer:!1,type:"info"}),J("#conditionspopupzdialog").zdialog("reposition"),J("#conditionspopupzdialog").find(".js-dlg-helplink").attr("href",editorProps.urls.kbPageURL+"/user-guide/working-with-merge-templates/articles/conditions-in-writer-mail-merge")}},C=function(t){e=t},y=function(e,t){var i=J("select#condition_"+e);i.zselectbox("removeAllOptions");var n=[];for(var o in t){var r=document.createElement("option");r.setAttribute("value",o),r.setAttribute("label",t[o]),n.push({value:o,label:t[o]})}i.zselectbox("addOption",n,"append"),i.zselectbox("setValue",ZWJSONUtils.getKeys(t)[0])},F=function(e){return A[e]||S[e]||M(e)||{}},M=function(e){var t=ZWJSONUtils.clone(MailMergeFieldUtil.getFieldInfo(e));if(!t){t=ZWJSONUtils.clone(MailMergeFieldUtil.getRLFieldInfo(e)),t.isRL=!0;var i=MailMergeFieldUIUtil.getRepeatRangeInfo(editor.doc.getSelection().getStart());t.rlId=i&&i.info.id}return t},w=function(t){J("select#field_"+t).bind("zselectboxchange",function(){var i=J("#field_"+t).zselectbox("getValue"),n=F(i);if(J("select#fieldType_"+t).zselectbox("setValue",n&&n.type||""),n&&n.type){if(n.type==MAILMERGE.FIELD_TYPE.DATE){if(R[t]!=MAILMERGE.FIELD_TYPE.DATE&&Q(t,!0),U(n.date_info)){q(t,!0);var o=J("#value_"+t),r=o.val();r="undefined"!=typeof r.trim?r.trim():r;var a=new ZWFieldParser(r);if(R[t]==MAILMERGE.FIELD_TYPE.DATE&&r&&!NaN(r)&&!a.isMergeField()){var s=b[t],l=F(s),d=l.date_info||{},c=d.output||{},u="custom"==c.format,p=new ZWDateTime(r,u?c.custom_format:c.format,c.locale,c.timezone,u),g=n.date_info.output,f="custom"==g.format;r=f?p.customFormat(g.custom_format,g.locale,g.timezone):p.format(g.format,g.locale,g.timezone),o.val(r)}a.destroy()}else q(t,!1);R[t]=n.type}else R[t]==MAILMERGE.FIELD_TYPE.DATE&&Q(t,!1),R[t]=n.type;b[t]=n.id}var E=J("#condition_"+t).zselectbox("getValue");if("Is Empty"==E||"Is Not Empty"==E){var T=n&&n.type==MAILMERGE.FIELD_TYPE.DATE||!1;T?J("[data-menu-id^=dateFieldHTML_"+t+"]").addClass("ui-state-disabled"):J("[data-menu-id^=dateFieldHTML_"+t+"]").addClass("ui-hide").removeClass("ui-state-disabled"),e==NODE_TYPE.FILLABLEFIELD?J("[data-menu-id^=mmfieldmenu_"+t+"]").addClass("ui-state-disabled"):J("#mm-fieldmenu"+t).addClass("ui-state-disabled"),J("#dateConfigureRhs_"+t).addClass("ui-hide"),J("#value_"+t).val(" ").disable()}})},U=function(e){if(!e||!e.input||!e.output)return!1;var t=e.input,i=e.output;if(I){if(!(t.custom_format&&t.locale&&t.timezone&&i.custom_format&&i.timezone&&i.locale))return!1}else if(!(t.format&&t.locale&&t.timezone&&i.format&&i.timezone&&i.locale))return!1;return!0},x=function(e,t){var i=J("#dateConfigure_"+e);t?i.removeClass("ui-hide"):i.addClass("ui-hide")},B=function(e){J("select#fieldType_"+e).bind("zselectboxchange",function(){var t=J("#field_"+e).zselectbox("getValue"),i=ZWJSONUtils.clone(M(t)||{});if(i&&i.type){var n=arguments[1].value;i.type==n?delete A[t]:(n==MAILMERGE.FIELD_TYPE.DATE?x(e,!0):x(e,!1),i.type=n,A[t]=i),n==MAILMERGE.FIELD_TYPE.DATE?(R[e]!=MAILMERGE.FIELD_TYPE.DATE&&Q(e,!0),U(i.date_info)?q(e,!0):q(e,!1)):R[e]==MAILMERGE.FIELD_TYPE.DATE&&Q(e,!1),R[e]=n,b[e]=i.id}})},H=function(e){J("select#field_"+e).bind("zselectboxchange",function(){var t=editor.getDocument().getFieldsByName(J("#field_"+e+"Container")[0].innerText);if(t&&t.getFillableFieldType()===FILLABLEFIELD_TYPE.DATE){if(R[e]!=FILLABLEFIELD_TYPE.DATE)Q(e,!0);else{var i=J("#value_"+e),n=i.val();n="undefined"!=typeof n.trim?n.trim():n;var o=new ZWFieldParser(n);if(R[e]==FILLABLEFIELD_TYPE.DATE&&n&&isNaN(n)&&!o.isFillableField()){var r=b[e],a=editor.getDocument().getFieldById(r),s=new ZWDateTime(n,a.getFormat());n=s.format(t.getFormat()),i.val(n)}o.destroy()}J("#mmfieldmenu_"+e).off("zmenubeforeshow").on("zmenubeforeshow",function(e){ConditionsDlg.populateFillableFields(e,FILLABLEFIELD_TYPE.DATE)})}else R[e]==FILLABLEFIELD_TYPE.DATE&&Q(e,!1),J("#mmfieldmenu_"+e).off("zmenubeforeshow").on("zmenubeforeshow",function(e){ConditionsDlg.populateFillableFields(e)});R[e]=t.getFillableFieldType(),b[e]=t.id})},G=function(e,t,i,n){var o=J("#dateSuffix_"+i);o.text(e),J("#dateInputDiv_"+i).removeClass("ui-hide"),J("#inputBoxParentDiv_"+i).addClass("ui-hide");var r=J("#dateInput_"+i),a=n||r.val();a=K(t,a);a.length;r.val(a),r[0].style.width=a.length+"ch",o[0].style.left=a.length+2+"ch"},k=function(t){J("select#condition_"+t).bind("zselectboxchange",function(){var i,n=J("#value_"+t),o=J("#mm-fieldmenu"+t),r=J("[data-menu-id^=dateFieldHTML_"+t+"]"),a=J(this).zselectbox("getValue"),s=!1;if(e==NODE_TYPE.FILLABLEFIELD)i=editor.getDocument().getFieldsByName(J("#field_"+t+"Container")[0].innerText),i&&i.getFillableFieldType()===FILLABLEFIELD_TYPE.DATE&&(s=!0);else{var l=J("#field_"+t).zselectbox("getValue");i=F(l),i&&i.type==MAILMERGE.FIELD_TYPE.DATE&&(s=!0)}"Is Empty"==a||"Is Not Empty"==a?(s?r.addClass("ui-state-disabled"):r.addClass("ui-hide").removeClass("ui-state-disabled"),e==NODE_TYPE.FILLABLEFIELD?J("[data-menu-id^=mmfieldmenu_"+t+"]").addClass("ui-state-disabled"):o.addClass("ui-state-disabled"),n.val(" ").disable()):a.endsWith("Days")?G(J.i18n("writer.date.DAYS"),a,t):a.endsWith("Months")?G(J.i18n("writer.date.MONTHS"),a,t):a.endsWith("Years")?G(J.i18n("writer.date.YEARS"),a,t):(o.removeClass("ui-state-disabled"),r.removeClass("ui-state-disabled"),J("#inputBoxParentDiv_"+t).removeClass("ui-hide"),J("#dateInputDiv_"+t).addClass("ui-hide"),s&&e!=NODE_TYPE.FILLABLEFIELD?U(i.date_info)?q(t,!0):q(t,!1):q(t,!0))})},W=function(e,t,i){var n=i.value;t.endsWith("Days")?G(J.i18n("writer.date.DAYS"),t,e,n):t.endsWith("Months")?G(J.i18n("writer.date.MONTHS"),t,e,n):t.endsWith("Years")&&G(J.i18n("writer.date.YEARS"),t,e,n),J("select#condition_"+e).zselectbox("setValue",t)},Y=function(e,t){J("#mmfieldmenu_"+e).on("zmenubeforeshow",function(e){ConditionsDlg.populateFillableFields(e,t)})},z=function(e){var t=e.pattern;t=t.split(" ");var i=e.fieldInfos;i&&(S=ZWJSONUtils.clone(i));for(var n,o,r,a=e.oldCondition||!i,s=e.condition,l=0,c=s.length;l<c;l++){r=t.pop(),t.pop(),o=s[l],n=Utils.randomString(),ConditionsDlg.addManualPtRow(n),J("select#field_"+n).zselectbox("setValue",o.lhs.fieldId),J("select#condition_"+n).zselectbox("setValue",o.operator);var u=o.rhs,p=u.value;if(o.lhs.type===NODE_TYPE.FILLABLEFIELD){var g=editor.getDocument().getFieldById(o.lhs.fieldId);if(R[n]=g.getFillableFieldType(),b[n]=g.getId(),g&&g.getFillableFieldType()===FILLABLEFIELD_TYPE.DATE?Q(n,!0):Q(n,!1),J("select#condition_"+n).zselectbox("setValue",o.operator),"Is Empty"==o.operator||"Is Not Empty"==o.operator){var f=J("#value_"+n),E=J("#mmfieldmenu_"+n);f.val(" ").disable(),E.addClass("ui-state-disabled"),J("[data-menu-id^=dateFieldHTML_"+n+"]").continue}if(g&&g.getFillableFieldType()===FILLABLEFIELD_TYPE.DATE){J("select#condition_"+n).zselectbox("setValue",o.operator);var r=o.operator;if(Y(n,FILLABLEFIELD_TYPE.DATE),r.endsWith("Days")||r.endsWith("Months")||r.endsWith("Years")){W(n,r,u);continue}if(p)if(u.isauto)p=new ZWDateTime(new Date,fieldInfo.getFormat()).format(g.getFormat());else{var T=new ZWFieldParser(u.value);isNaN(u.value)&&T.isFillableField()||(p=Utils.convertMsToDate(parseFloat(p),g.getFormat())),T.destroy()}}else Y(n)}else{J("#dateConfigureRhs_"+n).addClass("ui-hide");var g=i[o.lhs.fieldId];R[n]=g&&g.type||MAILMERGE.FIELD_TYPE.TEXT,b[n]=g&&g.id;var m;if(J("select#fieldType_"+n).zselectbox("setValue",g&&g.type||MAILMERGE.FIELD_TYPE.TEXT),g&&g.type==MAILMERGE.FIELD_TYPE.DATE?(m=U(g.date_info),Q(n,!0),m?q(n,!0):q(n,!1)):Q(n,!1),J("select#condition_"+n).zselectbox("setValue",o.operator),"Is Empty"==o.operator||"Is Not Empty"==o.operator){var f=J("#value_"+n),E=J("#mm-fieldmenu"+n);f.val(" ").disable(),E.addClass("ui-state-disabled");continue}if(a||(p=MailMergeUtil.changeObjectToDisplay(p,i)),g&&"date"==g.type&&m){J("select#condition_"+n).zselectbox("setValue",o.operator);var r=o.operator;if(r.endsWith("Days")||r.endsWith("Months")||r.endsWith("Years")){W(n,r,u);continue}if(p){var h,I=g.date_info.output,_="custom"==I.format;if(u.isauto)h=new ZWDateTime(new Date,_?I.custom_format:I.format,I.locale,I.timezone,_),p=_?h.customFormat(I.custom_format,I.locale,I.timezone):h.format(I.format,I.locale,I.timezone);else{var T=new ZWFieldParser(u.value);isNaN(u.value)&&T.isMergeField()?T.isMergeField()&&J("#dateConfigureRhs_"+n).removeClass("ui-hide"):(h=new ZWDateTime(new Date(parseInt(p)),_?I.custom_format:I.format,I.locale,I.timezone,_),p=_?h.customFormat(I.custom_format,I.locale,I.timezone):h.format(I.format,I.locale,I.timezone)),T.destroy()}}}}J("select#condition_"+n).zselectbox("setValue",o.operator),J("input#value_"+n).val(p)}t=e.pattern;for(var A=J('[id^="conjunction_"]'),l=0,c=A.length;l<c&&(t.indexOf("AND")!=-1||t.indexOf("OR")!=-1);l++)t.indexOf("AND")!=-1&&(t.indexOf("AND")<t.indexOf("OR")||t.indexOf("OR")==-1)?(J(A[l]).zmenubutton("setAttributes",{text:"AND"}),t=t.replace("AND","")):(J(A[l]).zmenubutton("setAttributes",{text:"OR"}),t=t.replace("OR",""));J("#"+d).val(e.pattern)},Z=function(e,t){for(var i in t){var n="object"!=typeof t[i]?t[i]:JSON.stringify(t[i]);e.setAttribute(i,n)}},V=function(t,n,o){var r="mmfieldmenu_"+n,a="dateNumberMenu_"+n,s="dateInput_"+n,l="manualtabrow_"+n,d="field_"+n,c="cond_"+n,u="condition_"+n,p="addnewcond_"+n,g="value_"+n,f="fieldType_"+n,E={},T=document.createElement("div");E={id:l,class:"ui-condtn-item"},Z(T,E);var m=document.createElement("div");m.setAttribute("id",c),m.setAttribute("class","ui-fld-col ui-condtn-no");var h=document.createElement("SELECT");if(E={},E={id:d,ctype:"zselectbox",data:{contentType:"text",dropdownList:{contentType:"icon-text"},className:"ui-fld-col ui-fld-col-field-w ui-bdr-no-rds",width:"140px"}},Z(h,E),e===NODE_TYPE.FILLABLEFIELD)for(var I in i){E={};var _="fillable_"+I,A=editor.getDocument().getFieldById(I),S=A&&A.getFillableFieldType(),R=document.createElement("option");E={id:_,value:I,data:{label:i[I],icon:FillableFieldsHandler.getFieldIconClass(S)}},Z(R,E),h.appendChild(R)}var O=document.createElement("DIV");O.setAttribute("class","ui-flex-column ui-pos-rel"),O.setAttribute("id","fieldTypeParentDiv_"+n);var b=document.createElement("DIV");if(b.setAttribute("id","fieldTypeDiv_"+n),b.setAttribute("class","ui-flex-container ui-flex-jus-space-btwn ui-flex-vcenter ui-fld-col ui-fld-col-type-w ui-no-pad"),e!==NODE_TYPE.FILLABLEFIELD){var D=document.createElement("SELECT");E={},E={id:f,ctype:"zselectbox",data:{contentType:"text",dropdownList:{contentType:"icon-text"},className:"ui-flex-1 ui-fld-col ui-bdr-no-rds ui-no-margin-right"}},Z(D,E);var L=MailMergeUiUtils.FIELD_INFOS;for(var I in L){E={};var R=document.createElement("OPTION");E={value:I,data:{icon:L[I].icon,label:L[I].text}},Z(R,E),D.appendChild(R)}var N=document.createElement("SPAN");N.setAttribute("class","ui-text-blue fs-11 ui-zwbutton-bg zselectbox-with-configtxt ui-pos-rel"),E={},E={id:"dateConfigure_"+n,onclick:"ConditionsDlg.onConfigureDateSelect('"+n+"')",label:J.i18n("writer.common.CONFIGURE")},Z(N,E),N.textContent=J.i18n("writer.common.CONFIGURE"),b.appendChild(D),b.appendChild(N),O.appendChild(b);var P=document.createElement("LABEL"),E={};E={id:"fieldTypeErrorLabel_"+n,class:"ui-validation-error-message ui-no-bottom-margin ui-hide",label:J.i18n("writer.date.CONFIGURE_DATE_FORMAT"),data:{width:"170px"}},Z(P,E),P.textContent=J.i18n("writer.date.CONFIGURE_DATE_FORMAT"),O.appendChild(P)}var C=document.createElement("SELECT");E={},E={id:u,ctype:"zselectbox",data:{className:"ui-fld-col ui-fld-col-opr-w ui-bdr-no-rds",width:"180px"}},Z(C,E);for(var I in v){var R=document.createElement("option");R.setAttribute("value",I),R.setAttribute("label",v[I]),C.appendChild(R)}var y=document.createElement("DIV");if(y.setAttribute("class","ui-condtn-input-icon-container ui-flex-container"),e!=NODE_TYPE.FILLABLEFIELD){var F=document.createElement("SPAN");F.setAttribute("class","ui-text-blue fs-11 ui-left-margin-medium ui-right-margin-medium ui-hide"),E={},E={id:"dateConfigureRhs_"+n,onclick:"ConditionsDlg.onConfigureDateSelect('"+n+"',true)",label:J.i18n("writer.common.CONFIGURE")},Z(F,E),F.textContent=J.i18n("writer.common.CONFIGURE"),y.appendChild(F)}var M=document.createElement("div"),w=document.createElement("ul");E={},E={"data-menu-id":"dateFieldHTML_"+n,class:"zbutton__icon ui-sprit-lazy ui-icon-insert-date-sm ui-top-margin-1 ui-no-margin-right"},Z(M,E),E={},E={id:"dateFieldHTML_"+n,target_element:g,ctype:"zmenu",data:{skipHighlightTarget:!0},style:"display: none"},Z(w,E),y.appendChild(M);var U=document.createElement("DIV");E={},E={id:"verticalSeparator_"+n,class:"ui-separator-vt ui-hide"},Z(U,E),y.appendChild(U);var x=document.createElement("div"),B=document.createElement("ul");if(E={},e===NODE_TYPE.FILLABLEFIELD)E={"data-menu-id":r,title:J.i18n("writer.mailmergepopup.ADD_FILLABLE_FIELD"),class:"ui-email_field_icon"},Z(x,E),E={},E={id:r,targe_element:g,ctype:"zmenu",data:{skipHighlightTarget:!0},style:"display: none;"},Z(B,E);else{var H={target:"#"+g,getFields:"ConditionsDlg.getFieldsForSubMenu",insertCallback:"ConditionsDlg.mailmergeFieldInserted",options:"option7"};H.callback="ConditionsDlg.mailmergeFieldInserted",e?H.listRepeatFields=!0:H.dataSourceFieldsOnly=!0,E={id:"mm-fieldmenu"+n,"data-menu-id":"mm-fieldmenu",title:J.i18n("writer.mailmergepopup.ADD_MERGE_FIELD"),class:"ui-email_field_icon js-mm-field-choose","mm-zmenu-data":H},Z(x,E),J(B).empty()}var G=document.createElement("DIV");G.setAttribute("class","ui-flex-column ui-pos-rel ui-condtn-input"),G.setAttribute("id","inputBoxParentDiv_"+n);var k=document.createElement("div");k.setAttribute("id","inputBox_"+n),k.setAttribute("class","ui-pos-rel ui-right-mar-ng-1");var W=document.createElement("input");E={},E={id:g,class:"ztextbox ui-bdr-no-rds",type:"text",data:{validateOptions:{type:"nonEmpty",required:!0,message:""}}},Z(W,E);var Y="http",z=document.createElementNS(Y+"://www.w3.org/2000/svg","svg"),E={};E={width:"16px",height:"16px",viewBox:"0 0 38 38",fill:"#2476DE"},Z(z,E);var V=document.createElementNS(Y+"://www.w3.org/2000/svg","use");V.setAttributeNS(Y+"://www.w3.org/1999/xlink","xlink:href","#zw-plus-menu"),z.appendChild(V);var j=z.cloneNode(!0);x.appendChild(z),y.appendChild(x);var X=document.createElement("div");E={},E={id:"dateInputDiv_"+n,class:"ui-flex-container ui-flex-jus-space-btwn ui-flex-vcenter ui-fld-col ui-condtn-input ui-pos-rel ui-no-pad ui-hide",onclick:"ConditionsDlg.focusNumberCount('"+n+"')"},Z(X,E);var K=document.createElement("input");E={},E={id:s,type:"text",class:"ztextbox ui-input-count-div ui-bdr-no-rds"},Z(K,E);var q=document.createElement("div");q.setAttribute("class","ui-flex-grow-1 ui-pos-abs ui-input-count-txt"),q.setAttribute("id","dateSuffix_"+n),q.style.left="2ch",X.appendChild(K),X.appendChild(q);var Q=document.createElement("div"),$=document.createElement("ul");if(E={},e==NODE_TYPE.FILLABLEFIELD)E={"data-menu-id":a,title:J.i18n("writer.mailmergepopup.ADD_FILLABLE_FIELD"),class:"ui-email_field_icon"},Z(Q,E),E={},E={id:a,targe_element:s,ctype:"zmenu",data:{skipHighlightTarget:!0},style:"display: none;"},Z($,E);else{var H={target:"#"+s,fieldTypes:MAILMERGE.FIELD_TYPE.NUMBER,getFields:"ConditionsDlg.getFieldsForSubMenu",insertCallback:"ConditionsDlg.mailmergeFieldInserted",options:"option7"};e?H.listRepeatFields=!0:H.dataSourceFieldsOnly=!0,E={id:"mm-dateNumberMenuField_"+n,"data-menu-id":"mm-fieldmenu",title:J.i18n("writer.mailmergepopup.ADD_MERGE_FIELD"),class:"ui-email_field_icon js-mm-field-choose","mm-zmenu-data":H},Z(Q,E),J($).empty()}Q.appendChild(j),X.appendChild(Q),X.appendChild($),k.appendChild(W),k.appendChild(y),k.appendChild(w),k.appendChild(B);var ee=document.createElement("BUTTON");if(E={},E={onclick:"ConditionsDlg.addManualPtRow(Utils.randomString())",ctype:"zbutton",title:J.i18n("writer.common.ADD_CONDITION"),id:p,data:{icon:"ui-insert-icon-css",className:"ui-flex-container ui-flex-center ui-insert-icon-btn"}},Z(ee,E),G.appendChild(k),e!=NODE_TYPE.FILLABLEFIELD){var te=document.createElement("label"),E={};E={id:"inputBoxErrorLabel_"+n,class:"ui-validation-error-message ui-no-bottom-margin ui-hide",label:J.i18n("writer.date.CONFIGURE_DATE_FORMAT")},Z(te,E),te.textContent=J.i18n("writer.date.CONFIGURE_DATE_FORMAT"),G.appendChild(te)}if(T.append(m),T.append(h),e!=NODE_TYPE.FILLABLEFIELD&&T.append(O),T.append(C),T.append(G),T.append(X),T.append(),t>1){var ie=document.createElement("BUTTON"),ne="removecond_"+n;E={},E={onclick:"ConditionsDlg.removeManualPtRow(event)",ctype:"zbutton",title:J.i18n("writer.common.REMOVE_CONDITION"),id:ne,data:{icon:"ui-delete-icon-css",className:"ui-fl ui-right-mar-ng-1"}},Z(ie,E),T.append(ie)}return T.append(ee),T},j=function(e,t){var i,n;t.id;e.originalTarget.innerText.indexOf("AND")!=-1?i="AND":e.originalTarget.innerText.indexOf("OR")!=-1&&(i="OR"),n=t.forElement[0],J(n).zmenubutton("setAttributes",{text:i}),ConditionsDlg.updatePattern()},X=function(t){var i=J('[id^="manualtabrow"]'),n=editor.doc,o=n.getSelection()[0].start,r=ZWJSONUtils.clone(n.getRawFormatAt(o)),a=r&&r.pattern?r.pattern:"",s=i.length?i.length+1:1;if(1==s){var d=document.createElement("DIV");d.setAttribute("class","ui-fld-table-head ui-w-100");var u=document.createElement("DIV");u.setAttribute("class","ui-fld-col"),d.appendChild(u);var p=document.createElement("DIV");if(p.setAttribute("class","ui-fld-col ui-fld-col-field-w"),p.innerHTML+=J.i18n("writer.common.FIELD"),d.appendChild(p),e!=NODE_TYPE.FILLABLEFIELD){var g=document.createElement("DIV");g.setAttribute("class","ui-fld-col ui-fld-col-type-w"),g.innerHTML+=J.i18n("writer.common.TYPE"),d.appendChild(g)}var f=document.createElement("DIV");f.setAttribute("class","ui-fld-col ui-fld-col-opr-w"),f.innerHTML+=J.i18n("writer.conditions.OPERATOR"),d.appendChild(f);var E=document.createElement("DIV");E.setAttribute("class","ui-fld-col ui-fld-col-val-w"),E.innerHTML+=J.i18n("writer.common.VALUE"),d.appendChild(E);var T=document.createElement("DIV");T.setAttribute("class","ui-fld-col"),d.appendChild(T),l.append(d)}var m=this.newRow(s,t,a);if(l.append(m),s>1){var h="conjunction_"+t,I="<div class='text-center clearfix'><button noi18n=true ctype='zmenubutton' id='"+h+"' data=\"{ appearance : 'primary', className: 'ui-condtn-btn', label: 'AND', menuId:'"+c+"'}\"></button></div>";document.getElementById("manualtabrow_"+t).insertAdjacentHTML("beforebegin",I),J("#"+h).zmenubutton();var _=J("#"+c);_.zmenu(),_.bind("zmenuitemclick",ConditionsDlg.toggleState),J("#removecond_"+t).zbutton()}if(J("select#field_"+t).zselectbox(),J("select#condition_"+t).zselectbox(),J("select#fieldType_"+t).zselectbox(),J("select#type_"+t).zselectbox(),J("#addnewcond_"+t).zbutton(),J("#conditionsPopup").ZCtrackObjects("initEvents",null,void 0,!0),this.updatePattern(),J("#dateFieldHTML_"+t).off("zmenuitemclick").on("zmenuitemclick",function(i,n){J("#value_"+t)[0].value="",UIUtils._itemClicked(i,n),e!=NODE_TYPE.FILLABLEFIELD&&J("#dateConfigureRhs_"+t).addClass("ui-hide")}),J("#mmfieldmenu_"+t).off("zmenuitemclick zmenusubmenuitemclick").on("zmenuitemclick zmenusubmenuitemclick",function(e,i){J("#value_"+t)[0].value="",UIUtils._itemClicked(e,i)}),J("#dateNumberMenu_"+t).off("zmenuitemclick zmenusubmenuitemclick").on("zmenuitemclick zmenusubmenuitemclick",function(e,i){J("#dateInput_"+t)[0].value="",UIUtils._itemClicked(e,i)}),J("#dateFieldHTML_"+t).on("zmenubeforeshow",function(e,t){ConditionsDlg.populateDateOptions(e,t.element[0].id.split("_")[1])}),J("#dateInput_"+t).off("focus input").on("focus input",function(e){var t=this.value,i=e.target.id.split("_")[1],n=J("#condition_"+i).zselectbox("getValue");t=K(n,t),this.value=t;var o=t.length;this.style.width=o+"ch",J("#dateSuffix_"+i)[0].style.left=o+2+"ch"}),k(t),e===NODE_TYPE.FILLABLEFIELD){J("#datefield_"+t).zdatetimefield();var A=editor.getDocument().getFieldsByName(J("#field_"+t+"Container")[0].innerText);A&&A.getFillableFieldType()===FILLABLEFIELD_TYPE.DATE?(Q(t,!0),J("#mmfieldmenu_"+t).on("zmenubeforeshow",function(e){ConditionsDlg.populateFillableFields(e,FILLABLEFIELD_TYPE.DATE)})):(Q(t,!1),J("#mmfieldmenu_"+t).on("zmenubeforeshow",function(e){ConditionsDlg.populateFillableFields(e)})),b[t]=A.id,J("#dateNumberMenu_"+t).on("zmenubeforeshow",function(e){ConditionsDlg.populateFillableFields(e,FILLABLEFIELD_TYPE.NUMBER)}),R[t]=A.getFillableFieldType(),H(t)}else{w(t),B(t);var S={element:J("#field_"+t)};e?S.listRepeatFields=!0:S.dataSourceFieldsOnly=!0,S.isIconRequired=!0,MailMergeUiUtils.populateFieldsInDropdown(S);var O=J("#field_"+t).zselectbox("getValue"),A=F(O);R[t]=A&&A.type||MAILMERGE.FIELD_TYPE.TEXT,b[t]=A&&A.id,A&&A.type&&(J("select#fieldType_"+t).zselectbox("setValue",A.type),A.type==MAILMERGE.FIELD_TYPE.DATE?(Q(t,!0),U(A.date_info)||q(t,!1)):Q(t,!1))}},K=function(t,i){var n=!1,o=new ZWFieldParser(i);if(e==NODE_TYPE.FILLABLEFIELD?isNaN(i)&&o.isFillableField()?i=i.substring(i.indexOf("{"),i.indexOf("}")+1):n=!0:isNaN(i)&&o.isMergeField()?i=i.substring(i.indexOf(UNICODE.MERGEFIELD_START),i.indexOf(UNICODE.MERGEFIELD_END)+1):n=!0,o.destroy(),n){i=i.replace(/[^0-9]/g,"");var r=i.length;t.indexOf("Days")!=-1?i=i>36500?i.substring(0,r-1):i:t.indexOf("Months")!=-1?i=i>5200?i>9999?i.substring(0,r-2):i.substring(0,r-1):i:t.indexOf(!0)&&(i=i>100?i>999?i>9999?i.substring(0,r-3):i.substring(0,r-2):i.substring(0,r-1):i)}return i},q=function(t,i,n){n?e!=NODE_TYPE.FILLABLEFIELD&&(i?(J("#inputBoxErrorLabel_"+t).addClass("ui-hide"),J("#value_"+t).removeClass("ui-validation-error")):(J("#inputBoxErrorLabel_"+t).removeClass("ui-hide"),J("#value_"+t).addClass("ui-validation-error"))):(i?(J("#value_"+t).enable(),J("[data-menu-id^=dateFieldHTML_"+t+"]").removeClass("ui-state-disabled"),J("#dateInput_"+t).enable(),J("#mm-dateNumberMenuField_"+t).enable()):(J("#value_"+t).val("").disable(),J("[data-menu-id^=dateFieldHTML_"+t+"]").addClass("ui-state-disabled"),J("#dateInput_"+t).disable(),J("#mm-dateNumberMenuField_"+t).disable()),e!=NODE_TYPE.FILLABLEFIELD?i?(J("#mm-fieldmenu"+t).enable(),J("#fieldTypeErrorLabel_"+t).addClass("ui-hide"),J("#fieldTypeDiv_"+t).removeClass("ui-validation-error")):(J("#mm-fieldmenu"+t).disable(),J("#fieldTypeErrorLabel_"+t).removeClass("ui-hide"),J("#fieldTypeDiv_"+t).addClass("ui-validation-error")):J("[data-menu-id^=mmfieldmenu_"+t+"]").removeClass("ui-state-disabled"))},Q=function(t,i){var n=J("[data-menu-id^=dateFieldHTML_"+t+"]"),o=J("#value_"+t);if(i?(y(t,D),n.removeClass("ui-hide"),o[0].setAttribute("readonly","readonly"),J("#verticalSeparator_"+t).removeClass("ui-hide")):(y(t,v),n.addClass("ui-hide"),o[0].removeAttribute("readonly"),J("#verticalSeparator_"+t).addClass("ui-hide")),o.val(""),o.enable(),J("#inputBoxParentDiv_"+t).removeClass("ui-hide"),J("#dateInputDiv_"+t).addClass("ui-hide"),e!=NODE_TYPE.FILLABLEFIELD){var r=J("#mm-fieldmenu"+t),a=r[0].getAttribute("mm-zmenu-data")||{};a=JSON.parse(a),i?(x(t,!0),a.fieldTypes=MAILMERGE.FIELD_TYPE.DATE):(r.enable(),x(t,!1),J("#dateConfigureRhs_"+t).addClass("ui-hide"),delete a.fieldTypes,J("#fieldTypeErrorLabel_"+t).addClass("ui-hide"),J("#inputBoxErrorLabel_"+t).addClass("ui-hide"),J("#value_"+t).removeClass("ui-validation-error"),J("#fieldTypeDiv_"+t).removeClass("ui-validation-error")),r[0].setAttribute("mm-zmenu-data",JSON.stringify(a))}},$=function(e,t){var i=t.input||{},n=t.output||{},o=(i[MAILMERGE.DATE_FORMAT],i[MAILMERGE.DATE_LOCALE]),r=i[MAILMERGE.DATE_TIMEZONE],a=n[MAILMERGE.DATE_FORMAT],s=n[MAILMERGE.DATE_LOCALE],l=n[MAILMERGE.DATE_TIMEZONE],d="";if("currentDate"==e||"dynamicDate"==e){var c=new ZWDateTime(new Date,"",o,r);d="custom"==a?c.customFormat(n.custom_format,s,l):c.format(a,s,l)}else if("docCreatedDate"==e){var u=new ZWDateTime(new Date(editor.doc.docInfo.CREATED_DATE_LONG),"",o,r);d="custom"==a?u.customFormat(n.custom_format,s,l):u.format(a,s,l)}return d},ee={currentDate:"writer.date.CURRENT_DATE",dynamicDate:"writer.date.DYNAMIC_DATE_TODAY",docCreatedDate:"writer.date.DATE_CREATED",separator:{},pickADate:"writer.date.PICK_A_DATE"},te=function(t,i){E||(E=Handlebars.compile(J("#conditions_date_menu").html()));var n,o={},r=J(t.target);if(e==NODE_TYPE.FILLABLEFIELD)n=editor.getDocument().getFieldsByName(J("#field_"+i+"Container")[0].innerText),o.input={format:n.getFormat()},o.output={format:n.getFormat()};else{var a=J("#field_"+i).zselectbox("getValue");if(n=F(a),o=n&&n.date_info,!U(o)){var s=J("#value_"+i);return s.disable(),s.val(""),J("[data-menu-id^=dateFieldHTML_"+i+"]").addClass("ui-state-disabled"),!1}J("#value_"+i).enable(),J("[data-menu-id^=dateFieldHTML_"+i+"]").removeClass("ui-state-disabled")}r.zmenu(),r.zmenu("removeAllMenuItems");var l,d=t.target.attr("target_element"),c=[];for(var u in ee)"separator"==u?c.push({itemType:"separator"}):"pickADate"==u?c.push({id:"date-menu_"+i,itemType:"submenu",label:J.i18n(ee[u]),menuId:"conditions-DatePickerMenu"}):(l=E({targetObject:d,label:J.i18n(ee[u]),description:$(u,o),type:u}),c.push({itemType:"custom",innerHTML:l}));r.zmenu("addMenuItems",c)},ie=function(t,i,n){var o=J("#"+t),r=(P[1],t.split("value_")[1]);if(e!=NODE_TYPE.FILLABLEFIELD&&(J("#dateConfigureRhs_"+r).addClass("ui-hide"),i)){var a,s=J("#field_"+r).zselectbox("getValue"),l=F(s),d=l.date_info.output,c=l.date_info.input,u="custom"==d.format;"currentDate"==i||"dynamicDate"==i?a=new ZWDateTime(new Date,"",c.locale,c.timezone):"docCreatedDate"==i&&(a=new ZWDateTime(new Date(editor.doc.docInfo.CREATED_DATE_LONG),"",c.locale,c.timezone)),n=u?a.customFormat(d.custom_format,d.locale,d.timezone):a.format(d.format,d.locale,d.timezone)}if(i){var d,c,s=J("#field_"+r).zselectbox("getValue"),u=!1;if(e!=NODE_TYPE.FILLABLEFIELD){var l=F(s);d=l.date_info.output||{},c=l.date_info.input||{},u="custom"==d.format}else{var p=editor.getDocument().getFieldById(s);d={format:p.getFormat()},c={format:p.getFormat()}}var a;"currentDate"==i||"dynamicDate"==i?a=new ZWDateTime(new Date,"",c.locale,c.timezone):"docCreatedDate"==i&&(a=new ZWDateTime(new Date(editor.doc.docInfo.CREATED_DATE_LONG),"",c.locale,c.timezone)),n=u?a.customFormat(d.custom_format,d.locale,d.timezone):a.format(d.format,d.locale,d.timezone)}O[r]="dynamicDate"==i,o.val(n),o.focus()},ne=function(e){var t=e.currentTarget,i=t.id,n=i.substring(i.indexOf("_")+1,i.length);i="manualtabrow_"+n,J('[id^="'+i+'"]').remove(),J("#"+i).remove(),J("#conjunction_"+n).remove(),ConditionsDlg.updatePattern()},oe=function(e,t,i){var n={};return n.includeRlFields=e||!1,n.fieldNameReplaced=t||!1,n.mapping=i,n.mapping={},n},re=function(){for(var t=J('[id^="manualtabrow"]'),i=(J('[id^="conjunction_"]'),[]),n="",o=0,r=t.length;o<r;o++){var a={},s={};s.type=e,s.fieldId=J(t[o].querySelectorAll("select[id^=field_]")[0]).zselectbox("getValue"),a.lhs=s,n=J(t[o].querySelectorAll("select[id^=condition_]")[0]).zselectbox("getValue"),a.operator=n;var l={};l.value=t[o].querySelectorAll("input[id^=value_]")[0].value,l.value="undefined"!=typeof l.value.trim?l.value.trim():l.value;var d=new ZWFieldParser(l.value);if("Is Not Empty"==a.operator||"Is Empty"==a.operator)l.value=" ";else{l.isauto=0;var c=t[o].id.substring(t[o].id.indexOf("_")+1);if(e==NODE_TYPE.FILLABLEFIELD){var u=editor.getDocument().getFieldsByName(J("#field_"+c+"Container")[0].innerText);u&&u.getFillableFieldType()===FILLABLEFIELD_TYPE.DATE&&(n.endsWith("Days")||n.endsWith("Months")||n.endsWith("Years")?l.value=J(t[o].querySelectorAll("input[id^=dateInput_")[0]).val():l.value&&(O[t[c]]?l.isauto=1:isNaN(l.value)&&d.isFillableField()||(l.value=Date.parse(l.value))))}else{var p=J("#field_"+c).zselectbox("getValue"),u=F(p);if(u&&u.type==MAILMERGE.FIELD_TYPE.DATE)if(n.endsWith("Days")||n.endsWith("Months")||n.endsWith("Years"))l.value=J(t[o].querySelectorAll("input[id^=dateInput_")[0]).val();else if(l.value)if(O[c])l.isauto=1;else if(!isNaN(l.value)||!d.isMergeField()){var g=u.date_info.output,f="custom"==g.format;l.value=new ZWDateTime(l.value,f?g.custom_format:g.format,g.locale,g.timezone,f)._originalUTC}}if(isNaN(l.value)&&d.isMergeField()){l.value=MailMergeUtil.changeObjectToStore(l.value,oe(!0)),l.fieldInfo=[];var E=l.value.substring(l.value.indexOf(UNICODE.MERGEFIELD_START)+1,l.value.indexOf(UNICODE.MERGEFIELD_END)),T={};T.fieldId=E,T.type=NODE_TYPE.MAILMERGEFIELD,l.fieldInfo.push(T)}else if(isNaN(l.value)&&d.isFillableField()){l.fieldInfo=[];var E=l.value.substring(l.value.indexOf("{")+1,l.value.lastIndexOf("}")),T={};T.fieldId=editor.getDocument().getFieldsByName(E).id,T.type=NODE_TYPE.FILLABLEFIELD,l.fieldInfo.push(T)}}d.destroy(),a.rhs=l,a.criteriaId=o+1,i[o]=a}return i},ae=function(){for(var e=J('[id^="manualtabrow"]'),t=!0,i=0,n=e.length;i<n;i++){var o=J(e[i].querySelectorAll("select[id^=field_]")[0]).zselectbox("getValue"),r=F(o);if("date"==r.type){var a=e[i].id.substring(e[i].id.indexOf("_")+1);U(r.date_info)?(J("#fieldTypeDiv_"+a).removeClass("ui-validation-error"),J("#fieldTypeErrorLabel_"+a).addClass("ui-hide")):(t=!1,J("#fieldTypeDiv_"+a).addClass("ui-validation-error"),J("#fieldTypeErrorLabel_"+a).removeClass("ui-hide"));var s=J(e[i].querySelectorAll("select[id^=condition_]")[0]).zselectbox("getValue"),l=s.indexOf("Days")!=-1||s.indexOf("Months")!=-1||s.indexOf("Years")!=-1;if(!l){var d=e[i].querySelectorAll("input[id^=value_]")[0].value,c=new ZWFieldParser(d);if(isNaN(d)&&c.isMergeField()){var u=MailMergeUtil.changeObjectToStore(d,oe(!0));o=u.substring(u.indexOf(UNICODE.MERGEFIELD_START)+1,u.indexOf(UNICODE.MERGEFIELD_END)),r=F(o),"date"==r.type&&(U(r.date_info)?(J("#value_"+a).removeClass("ui-validation-error"),J("#inputBoxErrorLabel_"+a).addClass("ui-hide")):(t=!1,J("#value_"+a).addClass("ui-validation-error"),J("#inputBoxErrorLabel_"+a).removeClass("ui-hide")))}c.destroy()}}}return t},se=function(){if(ConditionsDlg.updatePattern(),e==NODE_TYPE.FILLABLEFIELD||ae()){var t=document.getElementById(d).value,i=u,r=p,a=re(),s=editor.doc.getSelection()[0].start,l=Utils.randomString(),c=Utils.randomString(),g=Utils.randomString(),f=Utils.randomString(),E=Utils.randomString(),T=Utils.randomString(),m=Utils.randomString(),h=Utils.randomString(),I="";if(e===NODE_TYPE.MAILMERGEFIELD&&(I=de(a,null,!0)),e==NODE_TYPE.FILLABLEFIELD||ZWJSONUtils.isEmptyObject(A)||fe(I),n&&o.prop("checked"))var _=[{r:n.getStart()},{as:{start:{type:"row",id:c,ftype:"conditional_if_start",condition:a,pattern:t,fieldInfos:I},id:l}},{r:1},{as:{end:["type","id","ftype","isauto","val"],id:l}}];else var _=[{r:s},{as:{start:{type:"conditional_if_start",id:c,ftype:"conditional_if_start",condition:a,pattern:t,fieldInfos:I},id:l}},{is:""},{as:{end:["type","id","ftype","isauto","val"],id:l}},{as:{start:{id:T,type:"placeholder"},id:m}},{is:""},{as:{end:["id","type"],id:m}},{as:{start:{cls:"placeholder",type:"text"},id:g}},{is:i},{as:{end:["type","cls"],id:g}},{as:{start:{id:T,type:"placeholder"},id:h}},{is:""},{as:{end:["id","type"],id:h}},{as:{start:{type:"conditional_else_seperator",id:c},id:f}},{is:UNICODE.FIELD_SEPARATOR},{as:{end:["type","id"],id:f}},{as:{start:{id:T,type:"placeholder"},id:m}},{is:""},{as:{end:["id","type"],id:m}},{as:{start:{type:"text",cls:"placeholder"},id:E}},{is:r},{as:{end:["type","cls"],id:E}},{as:{start:{id:T,type:"placeholder"},id:h}},{is:""},{as:{end:["id","type"],id:h}},{as:{start:{type:"conditional_if_end",id:c},id:f}},{is:""},{as:{end:["type","id"],id:f}}];Op.processMsg(_),Op.sendMsg(),J.dialogutil.close("conditionspopup"),Oe(),n&&o.prop("checked")&&(TableVisualCueHandler.constructRowContainer(),TableVisualCueHandler.bindEvents())}},le=function(){if(ConditionsDlg.updatePattern(),e==NODE_TYPE.FILLABLEFIELD||ae()){for(var t=re(),i=!1,o=0,r=t.length;o<r;o++)if(t[o].lhs&&!t[o].lhs.fieldId)return void J.dialogutil.close("conditionspopup");var a=editor.doc.getSelection()[0].start,s=editor.doc.getRawFormatAt(a),l=DocUtil.copyStyle(editor.doc.getRawFormatAt(a));if(n&&f&&(i=!0,l=DocUtil.copyStyle(editor.doc.getRawFormatAt(n.getStart()))),l.condition=t,e===NODE_TYPE.MAILMERGEFIELD){var c;l.oldCondition||(c=l.fieldInfos),l.fieldInfos=de(t,c,!0)}if(l.pattern=document.getElementById(d).value,e==NODE_TYPE.FILLABLEFIELD||ZWJSONUtils.isEmptyObject(A)||fe(l.fieldInfos),n&&f)var u=[{r:n.getStart()},{as:{start:l,id:s}},{r:1},{as:{end:ZWJSONUtils.getKeys(l),id:s}}];else var u=[{r:a},{as:{start:l,id:s}},{r:1},{as:{end:ZWJSONUtils.getKeys(l),id:s}}];Op.processMsg(u),Op.sendMsg(),J.dialogutil.close("conditionspopup"),Oe(),n&&i&&(TableVisualCueHandler.constructRowContainer(),TableVisualCueHandler.bindEvents())}},de=function(e,t,i){for(var n={},o=0,r=e.length;o<r;o++){var a=e[o],s=a.lhs,l=UNICODE.MERGEFIELD_START+s.fieldId+UNICODE.MERGEFIELD_END,d=s.fieldId,c=ZWJSONUtils.clone(A[d]||S[d]||{});delete c.isRL,delete c.rlId;var u={};u[d]=c;var p=ZWJSONUtils.isEmptyObject(c)?MailMergeUtil.getFieldMappingFromObject(l,oe(i,!0,t)):u;ZWJSONUtils.mergeJsonObjs(n,p);var g,f=a.rhs,E=f.value,T=new ZWFieldParser(E);E&&isNaN(parseFloat(E))&&T.isMergeField()&&(d=f.fieldInfo[0].fieldId,g=ZWJSONUtils.clone(A[d]||S[d]||{}),delete g.isRL,delete g.rlId,u[d]=g),T.destroy();var p=ZWJSONUtils.isEmptyObject(g)?MailMergeUtil.getFieldMappingFromObject(E,oe(i,!0,t)):u;ZWJSONUtils.mergeJsonObjs(n,p)}return n},ce=function(){var e,t,i,n,o=J('[id^="manualtabrow"]'),r=J('[id^="conjunction_"]'),a=o.length,s=0,l=[];for(l.push("("),t=0;t<a;t++)if(n=t+1,t<a-1)i=r[t].innerText,e&&e!=i&&(s++,l.push("(")),l.push(n),l.push(r[t].innerText),e=i;else if(t==a-1)for(l.push(n);s>0;)l.push(")"),s--;l.push(")"),l=l.join(" "),document.getElementById(d).value=l},ue=function(){var e=document.getElementById(d).value,t=[];if(t=e.toUpperCase(),t.split("(").length!=t.split(")").length)return void ConditionsDlg.updatePattern();if(t.indexOf("AND")===-1&&t.indexOf("OR")===-1)return void ConditionsDlg.updatePattern();if(t.split("AND").length-1+t.split("OR").length-1!=t.match(/\d+/g,"").length-1)return void ConditionsDlg.updatePattern();t=t.split(" ");for(var i,n=0,o=[],r=0;r<t.length;r++)if("AND"===t[r]||"OR"===t[r]){if(0==r||"AND"===t[r+1]||"OR"===t[r+1])break;o[n]=t[r],i=J('[id^="conjunction_"]'),i[n]?J(i[n]).zmenubutton("setAttributes",{text:o[n]}):(ConditionsDlg.addManualPtRow(Utils.randomString()),i=J('[id^="conjunction_"]')[n],J(i).zmenubutton("setAttributes",{text:o[n]})),n++}ConditionsDlg.updatePattern()},pe=function(){ConditionsDlg.updatePattern();var e=document.getElementById(d).value;return e},ge=function(e,t){var i,n,o,r={};for(var a in A)i=A[a],"date"!=i.type&&delete i.date_info,e&&!i.isRL&&t[a]?r[i.id]=i:!e&&i.isRL&&t[a]&&(n=i.id,o=i.rlId,delete i.isRL,delete i.rlId,r[o]={},r[o].field_settings={},r[o].field_settings[n]=i);return r},fe=function(e){var t=MailMergeFieldUtil.getFieldSettings(),i=ge(!0,e);ZWJSONUtils.isEmptyObject(i)||ZWJSONUtils.deepMerge(t,i);var n=ge(!1,e);ZWJSONUtils.isEmptyObject(n)||ZWJSONUtils.deepMerge(t,n),MailMerge.saveFieldSettings(null,null,t,null)},Ee=function(e){for(var t,i={},n=0,o=e.length;n<o;n++)t=e[n],i[t.id]=t;return i},Te=function(n){if(I=!1,editor.getRole().permissions.can("document.edit"))return e=n,e===NODE_TYPE.FILLABLEFIELD&&(t=Utils.getFieldMap(NODE_TYPE.FILLABLEFIELD),i=Utils.getFieldMapWithLabel(NODE_TYPE.FILLABLEFIELD),0==Object.keys(i).length)?(UIUtils.showMessagePopup(J.i18n("writer.common.FIELDS_WITHOUT_LABEL_MSG"),J.i18n("writer.common.NO_FIELDS_INSERTED"),"warning"),void setTimeout(function(){J("#messagedlgbtn_1").addClass("zbutton--primary").text(J.i18n("writer.common.GOT_IT")).blur()},100)):void J.dialogutil.open("conditionspopup",null,P)},me=function(e,t){var i;i=t?Utils.getFieldMapWithLabel(NODE_TYPE.FILLABLEFIELD,!1,t):Utils.getFieldMapWithoutDate(NODE_TYPE.FILLABLEFIELD);var n=J(e.target);n.zmenu(),n.zmenu("removeAllMenuItems");var o=J("#"+e.target.attr("targe_element"))[0],r=[];for(var a in i)r.push({id:a,appData:{action:"ConditionsDlg.insertFieldInText",params:[o,i[a]]},label:i[a],name:i[a]});n.zmenu("addMenuItems",r)},he=function(e){var t=e.fieldTypes,i=ZWJSONUtils.clone(A),n=MailMergeFieldUtil.getDataSourceFields(),o=editor.doc.getSelection().getStart(),r=MailMergeFieldUIUtil.getRepeatRangeInfo(o);if(r&&"main_fields"!=(r.info||{}).type){var a=MailMergeFieldUtil.getRLFields(),s=a[r.info.id];n=n.concat(s)}var l=ZWJSONUtils.clone(Ee(n));ZWJSONUtils.mergeJsonObjs(i,ZWJSONUtils.clone(S)),ZWJSONUtils.mergeJsonObjs(l,i);var d,c=[];for(var u in l)d=l[u],t?d.type==t&&c.push(d):c.push(d);return c},Ie=function(e){var t=e[0],i=J(t),n="{"+e[1]+"}";i.val(n),i.focus()},_e=function(e){var t=CurUtil.getCursorLineOffset(e.srcElement)+CurUtil.getCursorPortionOffset(e.srcElement.parentElement),i=editor.doc.getRawFormatAt(t);if(i&&i.type==NODE_TYPE.CONDITIONAL_IF_START){for(var n=DocUtil.getRangeEndAcrossSection(t),o=editor.doc.findNextIndexOf(UNICODE.FIELD_SEPARATOR,t);editor.doc.getRawFormatAt(o).id!=editor.doc.getRawFormatAt(t).id;)o=editor.doc.findNextIndexOf(UNICODE.FIELD_SEPARATOR,o+1);Ae(t+1);var r=editor.doc.getContent(o-1,o);r==UNICODE.BR&&r==UNICODE.PARAGRAPH||Ae(o);var a=editor.doc.getContent(o+1,o+2);a==UNICODE.BR&&a==UNICODE.PARAGRAPH||Ae(o+1);var s=editor.doc.getContent(n-1,n);s==UNICODE.BR&&s==UNICODE.PARAGRAPH||Ae(n),Op.sendMsg(),editor.doc.getSelection().getStart()===t&&Oe(),J("#conditional-field-div").removeClass("conditional-block-clone"),J("#conditional-field-div").hide()}},Ae=function(e){var t=Utils.randomString(),i=[{r:e},{as:{start:{type:"br"},id:t}},{is:"\v"},{as:{end:["type"],id:t}}];Op.processMsg(i)},Se=function(e){var t=CurUtil.getCursorLineOffset(e.srcElement)+CurUtil.getCursorPortionOffset(e.srcElement.parentElement),i=editor.doc.getRawFormatAt(t);if(i&&i.type==NODE_TYPE.CONDITIONAL_IF_START){for(var n=DocUtil.getRangeEndAcrossSection(t),o=editor.doc.findNextIndexOf(UNICODE.FIELD_SEPARATOR,t);editor.doc.getRawFormatAt(o).id!=editor.doc.getRawFormatAt(t).id;)o=editor.doc.findNextIndexOf(UNICODE.FIELD_SEPARATOR,o+1);var r=editor.doc.getContent(t+1,t+2),a=[],s=editor.doc.getRawFormatAt(t+2);if(r!==UNICODE.PARAGRAPH||s.type!==NODE_TYPE.TABLE&&s.type!==NODE_TYPE.TOC&&s.type!==NODE_TYPE.HR){r!==UNICODE.BR&&r!==UNICODE.PARAGRAPH||a.push(Re(t+1,r));var l=editor.doc.getContent(o-1,o);l!==UNICODE.BR&&l!==UNICODE.PARAGRAPH||a.push(Re(o-1,l));var d=editor.doc.getContent(o+1,o+2);d!==UNICODE.BR&&d!==UNICODE.PARAGRAPH||a.push(Re(o+1,d));var c=editor.doc.getContent(n-1,n);c!==UNICODE.BR&&c!==UNICODE.PARAGRAPH||a.push(Re(n-1,c)),a.length>0&&Op.sendMsg(),editor.doc.getSelection().getStart()===t&&Oe(),J("#conditional-field-div").removeClass("conditional-block-clone"),J("#conditional-field-div").hide()}}},Re=function(e,t){var i=[{r:e},{ds:t}];return Op.processMsg(i),i},Oe=function(){var e=editor.doc.getSelection(),t=editor.doc.createRange(e.getTargetRange().start+1);e.removeAllRanges().addRange(t)},be=function(){if(f=!0,n=editor.doc.getSelection().getParents(NODE_TYPE.ROW),n&&n.attr()){var e=n.attr("condition");if(e){var t=e[0].lhs&&e[0].lhs.type;Te(t)}else Te()}},ve=function(){n=editor.doc.getSelection().getParents(NODE_TYPE.ROW);var e=ZWJSONUtils.clone(n.attr("*")),t=Utils.randomString();e.condition="",e.pattern="",e.ftype="";var i=[{r:n.getStart()},{as:{start:e,id:t}},{r:1},{as:{end:ZWJSONUtils.getKeys(e),id:t}}];Op.processMsg(i)},De=function(){f=!1},Le=function(e){var t="EEEE|EEE|DD|D|MMMM|MMM|MM|M|YYYY|YY|HH|hh|mm|ss|zz|z",i=new RegExp('^[^~*?()#%<>"&apos;|0-9]*$');return e=e.replaceAll(new RegExp(t),""),e=e.trim(),!(!e.match(i)||e.match(new RegExp("[a-z]+|[A-Z]+")))},Ne=function(e){var t,i,n;t=e.output.locale,n=e.output.timezone,i=e.output.format,Le("custom"==i?e.output.custom_format:i)||(i="DD-MM-YYYY");var o=new ZWDateTime(new Date);return i="custom"==i?e.output.custom_format:o.getLocaleFormattedFormat(i,t,n)},Pe=function(){var t,i=arguments[0].currentTarget.id.split("_")[1],n={};if(e==NODE_TYPE.FILLABLEFIELD)t=editor.getDocument().getFieldsByName(J("#field_"+i+"Container")[0].innerText),n.output={format:t.getFormat()},n.input={format:t.getFormat()};else{var o=J("#field_"+i).zselectbox("getValue");t=F(o),n=t.date_info}var r,s="dd MM yyyy hh mm";NODE_TYPE.FILLABLEFIELD!=e?(r=Ne(n),r.indexOf("am")!=-1||r.indexOf("pm")!=-1?s+=" tt":s=s.replaceAll("hh","HH")):(r=t.getFormat(),r.indexOf("A")!=-1?s+=" tt":s=s.replaceAll("h","HH")),m=!1,T?a.zdatetimepicker("setAttributes",{dataId:i,dataInfo:n,format:s,localeFormattedFormat:r}):(a.zdatetimepicker({type:"inline",title:J.i18n("writer.date.PICK_A_DATE_TITLE"),closeButton:!0,changeMonth:!0,clearButton:!0,dataId:i,dataInfo:n,minuteStep:1,hourStep:1,changeYear:!0,timeFieldType:"multiple-select-box",format:s,localeFormattedFormat:r,hideCancelButton:!0,immediateCommit:!1,change:function(t,i){m=!0;var n=i.options.dataInfo.output,o="custom"==n.format;if(e==NODE_TYPE.FILLABLEFIELD)r=Utils.convertDate(i.value,n.format.replaceAll("y","Y").replaceAll("d ","D "));else{var r,a=new ZWDateTime(i.value).customFormat(i.options.localeFormattedFormat),s=new ZWDateTime(a,o?n.custom_format:n.format,n.locale,n.timezone,o);r="custom"==n.format?s.customFormat(n.custom_format,n.locale,n.timezone):s.format(n.format,n.locale,n.timezone)}ConditionsDlg.insertDate("value_"+i.options.dataId,null,r),Ce(),J("#dateFieldHTML_"+i.options.dataId).hide()},clear:function(e,t){m=!0,ConditionsDlg.insertDate("value_"+t.options.dataId,null,"")}}),T=!0),a.zdatetimepicker("open")},Ce=function(e){return!!m&&void a.zdatetimepicker("close")},ye=function(e){var t=J("#dateInput_"+e);t.focus(),t.select()},Fe=function(e,t){h=t||!1;var i;if(t){var n=J("#value_"+e).val();n=MailMergeUtil.changeObjectToStore(n,oe(!0)),i=n.substring(n.indexOf(UNICODE.MERGEFIELD_START)+1,n.indexOf(UNICODE.MERGEFIELD_END))}else i=J("#field_"+e).zselectbox("getValue");var o=F(i),r=o.date_info||{};_=e,r.callback=ConditionsDlg.onDateConfigured,I?DateFormatConfigDlg.openPopup(ZWJSONUtils.clone(r)):DateFormatDlg.openPopup(ZWJSONUtils.clone(r))},Me=function(e){var t=e.fieldInfo.id,i=F(t),n=e.element.id.split("value_")[1];J("#value_"+n).val(""),J("#value_"+n).val(UNICODE.MERGEFIELD_START+e.fieldInfo.display_name+UNICODE.MERGEFIELD_END),"date"==i.type?(J("#dateConfigureRhs_"+n).removeClass("ui-hide"),U(i.date_info)?q(n,!0,!0):q(n,!1,!0)):(J("#dateConfigureRhs_"+n).addClass("ui-hide"),q(n,!0,!0)),O[n]=!1},we=function(t){if(t){delete t.callback,delete t.sameFormatCheckbox,"custom"!=t.input.format&&delete t.input.custom_format,"custom"!=t.output.format&&delete t.output.custom_format;var i;if(h){var n=J("#value_"+_).val();n=MailMergeUtil.changeObjectToStore(n,oe(!0)),i=n.substring(n.indexOf(UNICODE.MERGEFIELD_START)+1,n.indexOf(UNICODE.MERGEFIELD_END))}else i=J("#field_"+_).zselectbox("getValue");if(A[i]||(A[i]=S[i]||M(i)||{}),U(t)){for(var o=J('[id^="manualtabrow"]'),r=F(i),a=r.date_info||{},s=a.output||{},l="custom"==s.format,d=oe(!0),c=0,u=o.length;c<u;c++){var p=J(o[c].querySelectorAll("select[id^=field_]")[0]).zselectbox("getValue"),g=o[c].id.substring(o[c].id.indexOf("_")+1),f=J("#value_"+g),E=f.val();if(p==i){q(g,!0),E="undefined"!=typeof E.trim?E.trim():E;var T=J(o[c].querySelectorAll("select[id^=condition_]")[0]).zselectbox("getValue");if("Is Empty"!=T&&"Is Not Empty"!=T){if(E&&isNaN(E)&&E.indexOf(UNICODE.MERGEFIELD_START)==-1&&E.indexOf(UNICODE.MERGEFIELD_END)==-1){var m=new ZWDateTime(E,l?s.custom_format:s.format,s.locale,s.timezone,l),I=t.output,R="custom"==I.format;E=R?m.customFormat(I.custom_format,I.locale,I.timezone):m.format(I.format,I.locale,I.timezone),f.val(E)}}else J("[data-menu-id^=dateFieldHTML_"+g+"]").addClass("ui-state-disabled"),e==NODE_TYPE.FILLABLEFIELD?J("[data-menu-id^=mmfieldmenu_"+g+"]").addClass("ui-state-disabled"):J("#mm-fieldmenu"+g).addClass("ui-state-disabled"),J("#fieldTypeDiv_"+g).removeClass("ui-validation-error"),J("#fieldTypeErrorLabel_"+g).addClass("ui-hide");if(E&&isNaN(E)&&E.indexOf(UNICODE.MERGEFIELD_START)>-1&&E.indexOf(UNICODE.MERGEFIELD_END)>-1){E=MailMergeUtil.changeObjectToStore(E,d);var O=E.substring(E.indexOf(UNICODE.MERGEFIELD_START)+1,E.indexOf(UNICODE.MERGEFIELD_END));O==i&&q(g,!0,!0)}}}A[i].date_info=t}else for(var o=J('[id^="manualtabrow"]'),d=oe(!0),c=0,u=o.length;c<u;c++){var p=J(o[c].querySelectorAll("select[id^=field_]")[0]).zselectbox("getValue"),g=o[c].id.substring(o[c].id.indexOf("_")+1);p==i&&q(g,!1);var E=J("#value_"+g).val();if(E&&isNaN(E)&&E.indexOf(UNICODE.MERGEFIELD_START)>-1&&E.indexOf(UNICODE.MERGEFIELD_END)>-1){E=MailMergeUtil.changeObjectToStore(E,d);var O=E.substring(E.indexOf(UNICODE.MERGEFIELD_START)+1,E.indexOf(UNICODE.MERGEFIELD_END));O==i&&q(g,!1,!0)}}}},Ue=function(e){I=e};return{openPopup:Te,closePopup:De,setFieldType:C,displayConditions:z,newRow:V,info:P,updatePattern:ce,addManualPtRow:X,toggleState:j,newPattern:ue,removeManualPtRow:ne,applyConditions:se,getPattern:pe,getFieldInfos:de,updateCondition:le,populateFillableFields:me,insertFieldInText:Ie,getCondition:re,expandCondition:_e,collapseCondition:Se,editRowCondition:be,removeRowCondition:ve,populateDateOptions:te,insertDate:ie,focusNumberCount:ye,datePickerShow:Pe,datePickerHide:Ce,onConfigureDateSelect:Fe,onDateConfigured:we,mailmergeFieldInserted:Me,updateFieldSettings:fe,isAllDateConfiguredProperly:ae,getFieldsForSubMenu:he,setFilterDidlog:Ue,initForDynamicConditionPopup:N}}(),JSONEvaluator=function(){var e={},t=[],i=function(e){var t=/\(/g,i=e.match(t).length,n=/\)/g,o=e.match(n).length;return i==o},n=function(i,n,o){var r,a,s,l,d,c=0,u=i.length;for(o=o?o:"en-US",c=0;c<u;c++){switch(l=i[c],a=n.hasOwnProperty(l.lhs.fieldId)&&null!==n[l.lhs.fieldId]&&void 0!==n[l.lhs.fieldId]?n[l.lhs.fieldId].toString():"",s=l.rhs.hasOwnProperty("value")?l.rhs.value.toString():"",r=l.operator,d=!1,t.push(l.criteriaId),r){case"Is":d=a==s;break;case"Is-IC":d=a.toLowerCase()==s.toLowerCase();break;case"Is not":d=a!=s;break;case"Is not-IC":d=a.toLowerCase()!=s.toLowerCase();break;case"Is Empty":d=!a;break;case"Is Not Empty":d=!!a;break;case"Contains":d=a&&a.indexOf(s)!=-1;break;case"Contains-IC":d=a&&a.toLowerCase().indexOf(s.toLowerCase())!=-1;break;case"Does not Contain":d=a&&a.indexOf(s)==-1;break;case"Does not Contain-IC":d=a&&a.toLowerCase().indexOf(s.toLowerCase())==-1;break;case"Begins With":d=a&&a.startsWith(s);break;case"Begins With-IC":d=a&&a.toLowerCase().startsWith(s.toLowerCase());break;case"Ends With":d=a&&a.endsWith(s);break;case"Ends With-IC":d=a&&a.toLowerCase().endsWith(s.toLowerCase());break;case"Greater Than":case"Greater than N Days":case"Greater than N Months":case"Greater than N years":d=!isNaN(Numeral.getNumber(a,o))&&Numeral.getNumber(a,o)>Numeral.getNumber(s,o);break;case"Less Than":case"Less than N Days":case"Less than N Months":case"Less than N Years":d=!isNaN(Numeral.getNumber(a,o))&&Numeral.getNumber(a,o)<Numeral.getNumber(s,o)}e[l.criteriaId]=d,l.result=d}},o=function(t){for(var i,n,o,r=(t.length,t.split(" ")),a=!1,s=0,l=r.length;s<l;s++)i=r[s],"OR"==i||"AND"==i?n=i:(e.hasOwnProperty(i)||"true"==i||"false"==i)&&(o=e[i]||"true"==i,n?"OR"==n?a=a||o:"AND"==n&&(a=a&&o):a=o);return a},r=function(e){var t=e.pattern,i=e.conditions,r=e.fieldValue,a=e.locale;n(i,r,a);var s,l,d=!1,c=[],u=[];c=t.split(" ");for(var p=0,g=c.length;p<g;p++)if(s=c[p],")"==s){for(var f=[];;){if(l=u.pop(),"("==l)break;f.splice(0,0,l)}d=o(f.join(" ")),u.push(d)}else u.push(s);return u[0]};return{checkPattern:i,evaluate:r}}(),ConditionalUIHandler=function(){"use strict";var e={},t=[],i=function(t){delete e[t.id],e[t.id]=o(ZWJSONUtils.clone(t))},n=function(t){return i(t),e[t.id]},o=function(e){for(var t=e.pattern,i=e.condition,n="",o=e.fieldInfos,a=e.oldCondition||!o,s="font-family:"+DocumentDesign.getComputedParaStyle("h0").textFormat.ff,l=0;l<i.length;l++){l>0&&(t.indexOf("AND")!=-1||t.indexOf("OR"))!=-1&&(t.indexOf("AND")!=-1&&(t.indexOf("AND")<t.indexOf("OR")||t.indexOf("OR")==-1)?(n+=" AND ",t=t.replace("AND","")):(n+=" OR ",t=t.replace("OR","")));var d,c,u="",p=i[l].rhs.value;if(i[l].lhs.type===NODE_TYPE.FILLABLEFIELD){if(d=editor.getDocument().getFieldById(i[l].lhs.fieldId),d&&d.getFillableFieldType()===FILLABLEFIELD_TYPE.DATE){var g=i[l].operator;g.endsWith("Days")?p=p+" "+J.i18n("writer.date.DAYS"):g.endsWith("Months")?p=p+" "+J.i18n("writer.date.MONTHS"):g.endsWith("Years")?p=p+" "+J.i18n("writer.date.YEARS"):"Is Empty"!=g&&"Is Not Empty"!=g&&!RESTRICTED_DATE_OPERATORS.contains(g)&&p&&(i[l].rhs.isauto?p=new ZWDateTime(new Date,d.getFormat()).format(d.getFormat()):isNaN(p)&&p.indexOf("{")!=-1&&p.indexOf("}")!=-1||(p=Utils.convertMsToDate(parseFloat(p),d.getFormat())))}u=d.name,n+="{"+u+"} "+r(i[l].operator)+" ",c="<span style='"+s+"'>"+p+"</span>"}else{var f=i[l].lhs.fieldId;if(d=a?MailMergeFieldUtil.getFieldInfo(f):o[f],u=d?MailMergeFieldUtil.getFieldName(d):"",n+=UNICODE.MERGEFIELD_START+u+UNICODE.MERGEFIELD_END+" "+r(i[l].operator)+" ",a||(p=MailMergeUtil.changeObjectToDisplay(p,o)),d&&"date"==d.type){var g=i[l].operator,E=d.date_info||{},T=E.output,m="custom"==(T&&T.format);if(g.endsWith("Days"))p=p+" "+J.i18n("writer.date.DAYS");else if(g.endsWith("Months"))p=p+" "+J.i18n("writer.date.MONTHS");else if(g.endsWith("Years"))p=p+" "+J.i18n("writer.date.YEARS");else if("Is Empty"!=g&&"Is Not Empty"!=g&&!RESTRICTED_DATE_OPERATORS.contains(g)&&p&&(!isNaN(p)||p.indexOf(UNICODE.MERGEFIELD_START)==-1||p.indexOf(UNICODE.MERGEFIELD_END)==-1)){var h;if(T&&!ZWJSONUtils.isEmptyObject(T)&&T.format&&T.locale&&T.timezone)try{i[l].rhs.isauto?(h=new ZWDateTime(new Date,m?T.custom_format:T.format,T.locale,T.timezone,m),p=m?h.customFormat(T.custom_format,T.locale,T.timezone):h.format(T.format,T.locale,T.timezone)):isNaN(p)&&p.indexOf(UNICODE.MERGEFIELD_START)!=-1&&p.indexOf(UNICODE.MERGEFIELD_END)!=-1||(h=new ZWDateTime(new Date(parseFloat(p)),m?T.custom_format:T.format,T.locale,T.timezone,m),p=m?h.customFormat(T.custom_format,T.locale,T.timezone):h.format(T.format,T.locale,T.timezone))}catch(e){}}}c="<span style='"+s+"'>"+p+"</span>"}n+='"'+c+'"'}n="<span>if("+n+"){</span>";for(var I=(new DOMParser).parseFromString(n,"text/html").body.children[0],_=I.firstChild,A=document.createElement("span");_;){var S;if(_.innerHTML){S=document.createTextNode(_.innerHTML);var R=_.cloneNode();R.innerHTML="",R.appendChild(S),A.appendChild(R)}else S=document.createTextNode(_.textContent),A.appendChild(S);_=_.nextSibling}return A},r=function(e){var t=e;switch(e){case"Is-IC":t=J.i18n("writer.common.IS_IGNORECASE");break;case"Is not-IC":t=J.i18n("writer.common.IS_NOT_IGNORECASE");break;case"Contains-IC":t=J.i18n("writer.common.CONTAINS_IGNORECASE");break;case"Does not Contain-IC":t=J.i18n("writer.common.DOES_NOT_CONTAIN_IGNORECASE");break;case"Begins With-IC":t=J.i18n("writer.common.BEGINS_WITH_IGNORECASE");break;case"Ends With-IC":t=J.i18n("writer.common.ENDS_WITH_IGNORECASE");break;case"Greater than N Days":t=J.i18n("writer.date.IS_GREATER_THAN_N_DAYS");break;case"Greater than N Months":t=J.i18n("writer.date.IS_GREATER_THAN_N_MONTHS");break;case"Greater than N Years":replacdeOpName=J.i18n("writer.date.IS_GREATER_THAN_N_YEARS");break;case"Less than N Days":t=J.i18n("writer.date.IS_LESS_THAN_N_DAYS");break;case"Less than N Months":t=J.i18n("writer.date.IS_LESS_THAN_N_MONTHS");break;case"Less than N Years":t=J.i18n("writer.date.IS_LESS_THAN_N_YEARS")}return t},a=function(){var e=Z("conditional-field-div").detach();Z("popup-menu-container").append(e)},s=function(){for(var e=editor.doc.getSelection()[0].start,t=0,i=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,e);i!=-1&&t!=-1&&(t=DocUtil.getRangeEnd(i),!(editor.doc.getRawFormatAt(i).type===NODE_TYPE.CONDITIONAL_IF_START&&i<=e&&e<=t));)i=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,i);return{ifStart:i,ifEnd:t}},l=function(){var e=editor.doc.getSelection();if(e&&e[0]&&editor.doc.findNextIndexOf(UNICODE.FIELD_SEPARATOR,0)!=-1){var i=s(),n=i.ifStart,o=i.ifEnd;if(n==-1||o==-1)return void d();for(var r=editor.doc.findNextIndexOf(UNICODE.FIELD_SEPARATOR,n);r!=-1&&editor.doc.getRawFormatAt(r).id!=editor.doc.getRawFormatAt(n).id;)r=editor.doc.findNextIndexOf(UNICODE.FIELD_SEPARATOR,r+1);if(r!=-1)try{var a=editor.doc.getPortionData(n+1).node,l=editor.doc.getPortionData(r+1).node,c=editor.doc.getPortionData(o+1).node;d(),a&&l&&c&&(a.classList.add("conditional-color-change"),l.classList.add("conditional-color-change"),c.classList.add("conditional-color-change"),J("#conditional-field-div").addClass("conditional-color-change"),t.push(a,l,c))}catch(e){d()}}},d=function(){if(t.length>0){for(var e=0;e<t.length;e++)J("#conditional-field-div").removeClass("conditional-color-change"),t[e].classList.remove("conditional-color-change");t=[]}},c=function(t){var n=DomViewManager.getDOMElem(t);if(n){var o=n.querySelectorAll(".conditional-block");o.length>0&&(J(o).unbind("mouseover"),J(o).mouseover(function(t){var n=Z("conditional-field-div"),o=EventHandler.getIndex(t.originalEvent),r=editor.doc.getRawFormatAt(o),a=J(this).height()+4;if(r&&"conditional_if_start"===r.type){e[r.id]||i(r),n.show();var l=(DocUtil.getRangeEnd(o),editor.doc.getSelection()[0].start),d=s();l<=d.ifEnd&&l>=d.ifStart&&d.ifStart==o?n.addClass("conditional-color-change"):n.removeClass("conditional-color-change"),n.addClass("conditional-block-clone"),n.empty(),n.append(e[r.id]);var c=DocLayoutManager.getColumnAtIndex(o).left||0,u=0,p=DocLayoutManager.getSectionLeftAtIndex(o),g=DocLayoutManager.getPageWidthAtIdx(o),f=TableUtil.getTableStart(o);f!=-1&&(u+=TableUtil.getAbsoluteCellLeft(o));var E=13,T=DocLayoutManager.getLineAtIndex(o).view,m=0;T&&T.borderProperties&&(m=T.borderProperties["padding-left"]);var h=c+u+DocLayoutManager.getLeftAtIndex(o)-m+p+PAGE.LEFT;if(editor.getRole().permissions.can("document.edit")&&(h+=E),n[0].style.left=h+"px",n[0].style.top=J(this).offset().top-editor.editorOffset.top+"px",n[0].style["min-height"]=a+"px",n[0].style.right="auto",n.height()>n.width()){n[0].style.left="auto";var I=DocLayoutManager.getBlocksBetween(o,o+1)[0],_=g-(c+I.width+I.left+p+u)-PAGE.RIGHT;n[0].style.right=_+"px"}}}),J(o).unbind("mouseout"),J(o).mouseout(function(){var e=Z("conditional-field-div");e.removeClass("conditional-block-clone"),e.hide()}))}},u=function(t){for(var i=t.segments,n=0,o=i.length;n<o;n++)i[n].format&&i[n].format.type===NODE_TYPE.CONDITIONAL_IF_START&&delete e[i[n].format.id]},p=function(e){if(e){var t=e.querySelectorAll(".conditional-block.ui-ms-pointer");if(t.length>0){J(t).unbind("mouseover"),J(t).unbind("mouseout");var i=e.querySelectorAll(".ui-condt-expand-icon");i&&i.length>0&&J(i).unbind("onclick")}}},g=function(e){if(editor.getRole().permissions.can("document.edit")){var t=0,i=DomViewManager.getDOMElem(e);if(i)for(var n=i.querySelectorAll(".conditional-block.ui-ms-pointer"),o=e.blocks,r=0;r<o.length;r++)for(var a=e.view.getNode().getIndex(),s=o[r],l=s.start+a,d=s.end+a,c=editor.doc.findNextIndexOf(UNICODE.RANGE_START,l);c!==-1&&c<=d;){var u=editor.doc.getRawFormatAt(c);if(u&&u.type===NODE_TYPE.CONDITIONAL_IF_START)for(var p=t;p<n.length;p++){var g=n[p];if(0==g.querySelectorAll(".ui-condt-expand-icon").length){var f=document.createElement("span");f.classList.add("ui-condt-expand-icon"),J(g).prepend(f);var E=editor.doc.getContent(c+1,c+2);E===UNICODE.BR||E===UNICODE.PARAGRAPH?(g.classList.add("conditional-block-expanded"),f.addEventListener("click",ConditionsDlg.collapseCondition)):f.addEventListener("click",ConditionsDlg.expandCondition)}t+=1;break}c=editor.doc.findNextIndexOf(UNICODE.RANGE_START,c+1)}}},f=function(){for(var e=DocLayoutManager.getAllRenderedLines(),t=0;t<e.length;t++)c(e[t]),g(e[t]);PubSub.subscribe(DOMVIEW.LINE_UPDATED,function(e){c(e),g(e)}),PubSub.subscribe(DOMVIEW.LINE_ADDED,function(e){c(e),g(e)}),PubSub.subscribe("DOM/line/before/remove",function(e,t){var i=t.el;p(i),u(e)}),PubSub.subscribe(DOMVIEW.PARAVIEW_BEFORE_REMOVE,function(e,t){var i=DomViewManager.getDOMElem(t);p(i);for(var n=0,o=t.nodeLines.length;n<o;n++)u(t.nodeLines[n])}),PubSub.subscribe("Document/ComponentInitialized",a),PubSub.subscribe("Document/lineview/before/update",function(e){var t=DomViewManager.getDOMElem(e);p(t),u(e)})},E=function(e){RangeCollection.isConditionVisible(e)||(RangeCollection.changeVisibility(e,!0),HiddenRangesHandler.showRanges("condition_"+e))},T=function(e,t){RangeCollection.changeVisibility(e,!1),HiddenRangesHandler.hideRanges("condition_"+e,t)},m=function(){var e=editor.doc.getSelection().getStart(),t=RangeCollection.getClosestCondition(e);if(t){var i=DocUtil.getFieldSeparatorIndex(t.start);i!=-1?T(t.id,[{start:t.start,end:t.start+1,isIfConditionShown:!0},{start:i,end:t.end,isIfConditionShown:!0}]):E(t.id)}},h=function(){var e,t=RangeCollection.getAllConditionRanges();for(var i in t)e=t[i],!e.isVisible&&E(t[i].id)},I=function(){var e,t,i=[],n=RangeCollection.getAllConditionRanges();for(var o in n)t=n[o],e=DocUtil.getFieldSeparatorIndex(t.start),e!=-1&&(i=[],i.push({start:t.start,end:t.start+1,isIfConditionShown:!0}),i.push({start:e,end:t.end,isIfConditionShown:!0}),T(t.id,i))},_=function(e){var t=e?RangeCollection.getConditionRanges(FillableFieldsHandler.getAllLinkedFields(e)):RangeCollection.getRangesBasedOnType(NODE_TYPE.FILLABLEFIELD);if(t.length){var i=RangeCollection.getInnerConditions(t);t=t.concat(i),t=t.sort(DocUtil.sortFn);for(var n=t.length-1;n>=0;n--)E(t[n].id);ConditionsEvaluator.evaluateFillableFieldsInPreviewMode(t)}};return PubSub.subscribe("Document/ComponentInitialized",f),PubSub.subscribe("Document/CursorPositionChanged",l,{async:!0,timeout:100}),PubSub.subscribe(DOMVIEW.LINE_UPDATED,l,{async:!0,timeout:500}),{constructTooltip:i,getTooltip:n,toggleCondition:m,expandAllConditions:h,collapseAllConditions:I,hideRange:T,onFillableFieldUpdate:_}}();GoToDialogue.Headings=[],GoToDialogue.currentHeadingIdx=-1,GoToDialogue.selectedItem="page",GoToDialogue.setSelectedElement=function(e){GoToDialogue.selectedItem=e,GoToDialogue.toggleUI()},GoToDialogue.closeDialogue=function(){J(".ui-widget-overlay").show(),GoToDialogue.currentHeadingIdx=-1,J.dialogutil.close("gotodialog")},GoToDialogue.findElement=function(e,t){var i=-1,n=UNICODE.RANGE_START,o=GoToDialogue.selectedItem,r="pre"==e?-1:1,t=t+r;if("table"==GoToDialogue.selectedItem)return t="pre"==e?editor.doc.findPreviousIndexOf(UNICODE.TABLE,t):editor.doc.findNextIndexOf(UNICODE.TABLE,t),t=t!=-1?t+1:t;if("heading"==GoToDialogue.selectedItem){var a=GoToDialogue.currentHeadingIdx;if(a>=0)return GoToDialogue.Headings[a+r]?(GoToDialogue.currentHeadingIdx=a+r,GoToDialogue.Headings[a+r].getStart()):-1;for(var s=GoToDialogue.Headings.length,l=0;l<s;l++){var d=GoToDialogue.Headings[l].getStart();if("pre"==e){if(d<t)return GoToDialogue.currentHeadingIdx=l,d}else if(d>t)return GoToDialogue.currentHeadingIdx=l,d}return-1}return"pre"==e?newEle=editor.doc.getSelection().findPrevious(n,"",null,t,o):newEle=editor.doc.getSelection().findNext(n,"",null,t,o),null!=newEle&&(i=newEle.getStart()),i},GoToDialogue.toggleUI=function(){var e=J("#goToInputBox"),t=J("#goToSelectBox"),i=J("#goToElementLabel");if(J("#invalid-page-error-box , #elment-not-found-error-box").html("").hide(),"bookmark"==GoToDialogue.selectedItem){e.hide(),J("#goPrevious").zbutton("setAttribute","disabled",!0),J("#goNext").zbutton("setAttribute","text",J.i18n("writer.common.GOTO")),i.text(J.i18n("writer.common.GOTOBOOKMARK"));var n=editor.doc.getElement("bookmark"),o=J("#goToCombo");o.empty();for(var r=n.length,a=0;a<r;a++)n[a].id.indexOf("toc_")==-1&&o.append(J("<option></option>").attr("value",n[a].id).text(n[a].name)).zselectbox("refresh");J("#tabs_page").hide(),J("#tabs_gotoelement").hide(),t.show(),J("#tabs_bookmark").show()}else"page"==GoToDialogue.selectedItem?(setTimeout(function(){J("#goToIndex").focus()},100),t.hide(),e.show(),J("#goPrevious").zbutton("setAttribute","disabled",!0),J("#goNext").zbutton("setAttribute","text",J.i18n("writer.common.GOTO")),J("#tabs_gotoelement").hide(),J("#tabs_bookmark").hide(),J("#tabs_page").show(),e.css("top","70px"),i.text(J.i18n("writer.common.GOTOGIVENPAGE"))):(J("#goToIncrementVal").val("1").focus(),i.text(J.i18n("writer.common.GOTOGIVENELEMENT")),t.hide(),e.show(),e.css("top","95px"),J("#goNext").zbutton("setAttribute","text",J.i18n("writer.common.NEXT")),J("#goPrevious").zbutton("setAttribute","disabled",!1),J("#tabs_bookmark").hide(),J("#tabs_page").hide(),J("#tabs_gotoelement").show())},GoToDialogue.selectPage=function(e){e||(e=editor.currentPageIndex+1);var t=DocLayoutManager.getPageRange(e),i=editor.doc.getSelection(),n=editor.doc.createRange(t.start,t.end);i.removeAllRanges().addRange(n)},GoToDialogue.goToElement=function(e){var t,n,o,r=J("#goToIndex"),a=RegExp(/^[0-9]{1,}$/),s=editor.doc.getSelection().getStart();if("page"==GoToDialogue.selectedItem)if(n=r.val(),"\\page"===n)GoToDialogue.selectPage();else{if(o=a.test(n),!o)return void J("#invalid-page-error-box").html(J.i18n("writer.gotodialogue.INVALID_PAGE_NO")).show();J("#invalid-page-error-box").html("").hide(),t=""!=n?parseInt(n):1,GoToDialogue.moveToElement("page",t)}else if("bookmark"==GoToDialogue.selectedItem)n=J("#goToCombo").val(),GoToDialogue.moveToElement("bookmark",n);else{if(n=J("#goToIncrementVal").val(),o=a.test(n),!o)return;for(t=parseInt(n),delta="pre"==e?-1:1,i=0;i<t;i++){if("table"==GoToDialogue.selectedItem){var l=TableUtil.getTableStart(s)!=-1;l&&(s="pre"==e?TableUtil.getTableStart(s)-1:TableUtil.getTableEnd(s)+1),s=GoToDialogue.findElement(e,s)}else s=GoToDialogue.findElement(e,s+delta);if(s==-1){J("#elment-not-found-error-box").html("No "+GoToDialogue.selectedItem+" Found").show();break}J("#elment-not-found-error-box").html("").hide()}GoToDialogue.moveToElement(GoToDialogue.selectedItem,s)}},GoToDialogue.openGoToDialogue=function(){J.dialogutil.open("gotodialog",void 0,GoToDialogue.dialogInfo),ZWLogger.addToStatistics("gotopage")},GoToDialogue.dialogInfo={init:function(){J(".ui-widget-overlay").hide(),J("#tabs_page").parent().css("border","none"),J("#goToDialogueCombo").bind("zselectboxchange",function(e,t){GoToDialogue.setSelectedElement(t.value)}),GoToDialogue.selectedItem="page",GoToDialogue.toggleUI(),GoToDialogue.Headings=editor.doc.getSelection().getAllHeadings()}},GoToDialogue.handleKeyDown=function(e,t){13==e.keyCode&&t&&(e.shiftKey?GoToDialogue.goToElement("pre"):GoToDialogue.goToElement("next"))},GoToDialogue.goToPreviousElement=function(){GoToDialogue.goToElement("pre")},GoToDialogue.goToNextElement=function(){GoToDialogue.goToElement("next")},GoToDialogue.moveToElement=function(e,t){if("page"==e)UIUtils.gotoPage(t,!1);else if("bookmark"==e)t!=-1&&Utils.moveToBookmark(t);else if(t!=-1){var i=editor.doc.createRange(t);editor.doc.getSelection().removeAllRanges().addRange(i),DomUtil.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0])}},CustomHdrFtr=function(){"use strict";var e={All:0,Odd:1,Even:2},t=function(e,t){var i={};i.themeName="theme1",i.themeObj={tblPr:{cell:{borders:{"border-top":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-left":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-bottom":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-right":{type:"solid",width:"1px",color:"rgb(0,0,0)"}}}}};var n=editor.doc.getSelection(),o=DocLayoutManager.getContentWidthAtIndex(n.getStart()),r=Utils.randomString(),a=editor.doc.docInfo.DOCUMENT_NAME,a=a.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),""),s=editor.doc.docInfo.CREATOR,l=Utils.randomString(),d=o/Conversions.globalUnitInPx,c=(d/3).toFixed(3)+Conversions.globalUnit,u=(d/2).toFixed(3)+Conversions.globalUnit,p=d.toFixed(3)+Conversions.globalUnit,g={1:[[{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}}],[{as:{start:{type:"paragraph",ps_null:!0}}},{r:1},{as:{end:["type"]}}]],2:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:c},{wt:c},{wt:c}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"}}}},{is:UNICODE.PARA},{as:{end:["type","ts"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",va:"middle",txtal:"center",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","va","txtal","border"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"},al:"1"}}},{is:UNICODE.PARA},{as:{end:["type","ts","al"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",va:"middle",txtal:"right",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","va","txtal","border"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"},al:"2"}}},{is:UNICODE.PARA},{as:{end:["type","ts","al"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{type:"paragraph",ps_null:!0}}},{r:1},{as:{end:["type"]}}]],3:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:c},{wt:c},{wt:c}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",z_td_bgc:"zwdark2",va:"middle",txtal:"center",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","z_td_bgc","va","txtal","border"]}},{as:{start:{type:"autofield",id:r,ftype:"autodocname",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autodocname",fieldinfo:r,fgc:"zwlight1"}}},{is:a},{as:{end:["type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"},al:"1"}}},{is:UNICODE.PARA},{as:{end:["type","ts","al"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"}}}},{is:UNICODE.PARA},{as:{end:["type","ts"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"}}}},{is:UNICODE.PARA},{as:{end:["type","ts"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{type:"paragraph",ps_null:!0}}},{r:1},{as:{end:["type"]}}]],4:[[{as:{start:{type:"autofield",id:r,ftype:"autodocname",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto"]}},{as:{start:{type:"text",cls:"autodocname",fieldinfo:r}}},{is:a},{as:{end:["type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}}],[{as:{start:{type:"paragraph",ps_null:!0,ts:{type:"text"},al:2}}},{r:1},{as:{end:["type","ts","al"]}}]],5:[[{as:{start:{type:"autofield",id:r,ftype:"autodocname",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto"]}},{as:{start:{type:"text",cls:"autodocname",fieldinfo:r,fgc:"rgb(255, 255, 255)"}}},{is:a},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}}],[{as:{start:{type:"paragraph",ps_null:!0,ts:{type:"text"},bgc:"zwaccent2/60",al:2}}},{r:1},{as:{end:["type","ts","bgc","al"]}}]],6:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:d.toFixed(3)-1+Conversions.globalUnit},{wt:1+Conversions.globalUnit}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:d.toFixed(3)-1+Conversions.globalUnit,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"}}}},{is:UNICODE.PARA},{as:{end:["type","ts"]}},{as:{start:{wid:"1in",pl:"0.070in",pt:"0.250in",pr:"0.03in",pb:"0.100in",type:"cell",z_td_bgc:"zwaccent3",va:"middle",txtal:"center",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","z_td_bgc","va","txtal","border"]}},{as:{start:{type:"text"}}},{is:"Page No : "},{as:{end:["type"]}},{as:{start:{type:"autofield",id:r,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:r,fgc:"zwlight1"}}},{is:"#"},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"},al:"1"}}},{is:UNICODE.PARA},{as:{end:["type","ts","al"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{type:"paragraph",ps_null:!0}}},{r:1},{as:{end:["type"]}}]],7:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:c},{wt:c},{wt:c}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",z_td_bgc:"zwdark2",va:"middle",txtal:"center",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(255,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(255,0,0)",space:"0px"},"border-bottom":{width:"1px",type:"solid",color:"rgb(255,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","z_td_bgc","va","txtal","border"]}},{as:{start:{type:"text",fgc:"zwlight1"}}},{is:"[TYPE HERE]"},{as:{end:["type","fgc"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text",fgc:"Theme.color.light1"},al:"1"}}},{is:UNICODE.PARA},{as:{end:["type","ts","al"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(255,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(255,0,0)",space:"0px"},"border-bottom":{width:"1px",type:"solid",color:"rgb(255,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"}}}},{is:UNICODE.PARA},{as:{end:["type","ts"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(255,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(255,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(255,0,0)",space:"0px"},"border-bottom":{width:"1px",type:"solid",color:"rgb(255,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"}}}},{is:UNICODE.PARA},{as:{end:["type","ts"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{type:"paragraph",ps_null:!0}}},{r:1},{as:{end:["type"]}}]],8:[[{as:{start:{type:"autofield",id:r,ftype:"autodocname",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto"]}},{as:{start:{type:"text",cls:"autodocname",fieldinfo:r}}},{is:a},{as:{end:["type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}}],[{as:{start:{type:"paragraph",ps_null:!0,ts:{type:"text"},al:1}}},{r:1},{as:{end:["type","ts","al"]}}]],9:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:u},{wt:u}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:u,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",z_td_bgc:"zwaccent6",borders:{"border-top":{width:"0px",type:"solid",color:"zwaccent6*50",space:"0px"},"border-right":{width:"0px",type:"solid",color:"zwaccent6*50",space:"0px"},"border-left":{width:"0px",type:"solid",color:"zwaccent6*50",space:"0px"},"border-bottom":{width:"3px",type:"solid",color:"zwaccent6*50",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","z_td_bgc","border"]}},{as:{start:{type:"autofield",id:r,ftype:"autodocname",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto"]}},{as:{start:{type:"text",cls:"autodocname",fieldinfo:r,fgc:"zwlight1"}}},{is:a},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}},{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{wid:u,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",va:"middle",txtal:"right",z_td_bgc:"zwaccent6",borders:{"border-top":{width:"0px",type:"solid",color:"zwaccent6*50",space:"0px"},"border-right":{width:"0px",type:"solid",color:"zwaccent6*50",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"3px",type:"solid",color:"zwaccent6*50",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","va","txtal","z_td_bgc","border"]}},{as:{start:{type:"autofield",id:l,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:l,fgc:"zwlight1"}}},{is:"#"},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:l}}},{is:""},{as:{end:["type","id"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",al:"2"}}},{is:UNICODE.PARA},{as:{end:["type","al"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",ts:{type:"text"}}}},{r:1},{as:{end:["type","ts"]}}]],10:[[{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}}],[{as:{start:{type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",al:1,ts:{}}}},{r:1},{as:{end:["type","al","ts"]}}]],11:[[{as:{start:{type:"autofield",id:r,ftype:"autodocname",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto"]}},{as:{start:{type:"text",cls:"autodocname",fieldinfo:r,fgc:"zwaccent3/60"}}},{is:a},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",al:"0",ts:{type:"text"}}}},{is:UNICODE.PARA},{as:{end:["type","al","ts"]}},{as:{start:{type:"autofield",id:l,ftype:"autoauthor",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto"]}},{as:{start:{type:"text",cls:"autoauthor",fieldinfo:l}}},{is:s},{as:{end:["type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:l}}},{is:""},{as:{end:["type","id"]}}],[{as:{start:{type:"paragraph",ps_null:!0}}},{r:1},{as:{end:["type"]}}]],12:[[{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}}],[{as:{start:{type:"paragraph",ps_null:!0,ts:{type:"text"},al:2}}},{r:1},{as:{end:["type","ts","al"]}}]],16:[null,[{as:{start:{type:"paragraph",ps_null:!0}}},{r:1},{as:{end:["type"]}}]]},f={1:[[{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}}],[{as:{start:{type:"paragraph",ps_null:!0}}},{r:1},{as:{end:["type"]}}]],2:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:c},{wt:c},{wt:c}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"}}}},{is:UNICODE.PARA},{as:{end:["type","ts"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",va:"middle",txtal:"center",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","va","txtal","border"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"},al:"1"}}},{is:UNICODE.PARA},{as:{end:["type","ts","al"]}},{as:{start:{wid:c,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",va:"middle",txtal:"right",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","va","txtal","border"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{cls:"placeholder",type:"text"}}},{is:"[TYPE HERE]"},{as:{end:["cls","type"]}},{as:{start:{id:r,type:"placeholder"}}},{is:""},{as:{end:["id","type"]}},{as:{start:{type:"paragraph",sb:"0pt",sa:"0pt",ts:{type:"text"},al:"2"}}},{is:UNICODE.PARA},{as:{end:["type","ts","al"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",ts:{type:"text"}}}},{r:1},{as:{end:["type","ts"]}}]],3:[[{as:{start:{type:"text",fgc:"zwdark2"}}},{is:"Page No : "},{as:{end:["type","fgc"]}},{as:{start:{type:"autofield",id:r,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:r,fgc:"zwdark2"}}},{is:"#"},{as:{end:["fgc","type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}}],[{as:{start:{ts:{type:"text"},type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",al:2}}},{r:1},{as:{end:["ts","type","al"]}}]],4:[[{as:{start:{type:"autofield",id:r,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:r}}},{is:"#"},{as:{end:["type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}}],[{as:{start:{type:"paragraph",ps_null:!0,ts:{type:"text"}}}},{r:1},{as:{end:["type","ts"]}}]],5:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:"1.042in"},{wt:"5.458in"}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:"1.042in",pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",z_td_bgc:"rgb(255, 192, 0)",va:"middle",txtal:"center",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","z_td_bgc","va","txtal","border"]}},{as:{start:{type:"autofield",id:r,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:r,fgc:"zwlight1"}}},{is:"#"},{as:{end:["fgc","type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"1"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{wid:"5.458in",pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"0"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{ts:{type:"text"},type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",al:"0"}}},{r:1},{as:{end:["ts","type","al"]}}]],6:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:u},{wt:u}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:u,pl:"0.010in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",ht:"0.2708333333333333in",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(85,142,213)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(85,142,213)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(85,142,213)",space:"0px"},"border-bottom":{width:"3px",type:"solid",color:"rgb(85,142,213)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","ht","border"]}},{as:{start:{type:"autofield",id:r,ftype:"autodocname",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto"]}},{as:{start:{type:"text",cls:"autodocname",fieldinfo:r}}},{is:a},{as:{end:["type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"0"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{wid:u,pl:"0.070in",pt:"0.03in",pr:"0.000in",pb:"0.03in",type:"cell",va:"middle",txtal:"right",ht:"0.2708333333333333in",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(85,142,213)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(85,142,213)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"3px",type:"solid",color:"rgb(85,142,213)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","va","txtal","ht","border"]}},{as:{start:{type:"autofield",id:l,ftype:"autoauthor",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto"]}},{as:{start:{type:"text",cls:"autoauthor",fieldinfo:l,fgc:"#zwaccent3/40"}}},{is:s},{as:{end:["fgc","type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:l}}},{is:""},{as:{end:["type","id"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"2"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"0"}}},{r:1},{as:{end:["ts","type","al"]}}]],7:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:"5.521in"},{wt:"0.979in"}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:"5.521in",pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"0"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{wid:"0.979in",pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",z_td_bgc:"rgb(255, 0, 0)",va:"middle",txtal:"center",borders:{"border-top":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-right":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","z_td_bgc","va","txtal","border"]}},{as:{start:{type:"autofield",id:r,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:r,fgc:"zwlight1"}}},{is:"#"},{as:{end:["fgc","type","cls","fieldinfo"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"1"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{ts:{type:"text"},type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",al:"0"}}},{r:1},{as:{end:["ts","type","al"]}}]],8:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:u},{wt:u}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:u,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"1px",type:"solid",color:"zwaccent5",space:"0px"},"border-right":{width:"0px",type:"solid",color:"zwaccent5",space:"0px"},"border-left":{width:"0px",type:"solid",color:"zwaccent5",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"zwaccent5",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{type:"autofield",id:r,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:r,fgc:"zwaccent5"}}},{is:"#"},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"0"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{wid:u,pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",va:"middle",txtal:"right",borders:{"border-top":{width:"1px",type:"solid",color:"zwaccent5",space:"0px"},"border-right":{width:"0px",type:"solid",color:"zwaccent5",space:"0px"},"border-left":{width:"0px",type:"solid",color:"rgb(0,0,0)",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"rgb(255,0,0)",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","va","txtal","border"]}},{as:{start:{type:"autofield",id:l,ftype:"autoauthor",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto"]}},{as:{start:{type:"text",cls:"autoauthor",fieldinfo:l,fgc:"zwaccent5"}}},{is:s},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:l}}},{is:""},{as:{end:["type","id"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"2"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{ts:{type:"text"},type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",al:"0"}}},{r:1},{as:{end:["ts","type","al"]}}]],9:[[{as:{start:{type:"paragraph"}}},{is:UNICODE.PARA},{as:{end:["type"]}},{as:{start:{theme:i,type:"table",wid:p,cols:[{wt:"5.490in"},{wt:"1.010in"}]}}},{is:""},{as:{end:["theme","type","wid","cols"]}},{as:{start:{ht:"auto",type:"row"}}},{is:""},{as:{end:["ht","type"]}},{as:{start:{wid:"5.490in",pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",borders:{"border-top":{width:"0px",type:"solid",color:"zwdark1",space:"0px"},"border-right":{width:"0px",type:"solid",color:"zwdark1",space:"0px"},"border-left":{width:"0px",type:"solid",color:"zwdark1",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"zwdark1",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","border"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"0"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{wid:"1.010in",pl:"0.07in",pt:"0.03in",pr:"0.03in",pb:"0.03in",type:"cell",z_td_bgc:"zwlight2/75",va:"middle",txtal:"center",borders:{"border-top":{width:"0px",type:"solid",color:"zwlight2/75",space:"0px"},"border-right":{width:"0px",type:"solid",color:"zwlight2/75",space:"0px"},"border-left":{width:"0px",type:"solid",color:"zwlight2/75",space:"0px"},"border-bottom":{width:"0px",type:"solid",color:"zwlight2/75",space:"0px"}}}}},{is:""},{as:{end:["wid","pl","pt","pr","pb","type","z_td_bgc","va","txtal","border"]}},{as:{start:{type:"autofield",id:r,ftype:"autodate",isauto:0,datefmt:"M/d/yy",val:1530253889529}}},{is:""},{as:{end:["type","id","ftype","isauto","datefmt","val"]}},{as:{start:{type:"text",cls:"autodate",fieldinfo:r,fgc:"zwlight1"}}},{is:"#"},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}},{as:{start:{ts:{type:"text"},type:"paragraph",sb:"0pt",sa:"0pt",al:"1"}}},{is:UNICODE.PARA},{as:{end:["ts","type","al"]}},{as:{start:{type:"tableend"}}},{is:""},{as:{end:["type"]}}],[{as:{start:{ts:{type:"text"},type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",al:"0"}}},{r:1},{as:{end:["ts","type","al"]}}]],10:[[{as:{start:{type:"autofield",id:r,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:r,fgc:"zwaccent3"}}},{is:"#"},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}}],[{as:{start:{ts:{type:"text"},type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",al:2}}},{r:1},{as:{end:["ts","type","al"]}}]],11:[[{as:{start:{type:"autofield",id:r,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:r,fgc:"zwaccent2"}}},{is:"#"},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}}],[{as:{start:{ts:{type:"text"},type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",al:0}}},{r:1},{as:{end:["ts","type","al"]}}]],12:[[{as:{start:{type:"autofield",id:r,ftype:"autopno",isauto:0}}},{is:""},{as:{end:["type","id","ftype","isauto","val"]}},{as:{start:{type:"text",cls:"autopno",fieldinfo:r,fgc:"zwaccent2"}}},{is:"#"},{as:{end:["type","cls","fieldinfo","fgc"]}},{as:{start:{type:"autofield",id:r}}},{is:""},{as:{end:["type","id"]}}],[{as:{start:{ts:{type:"text"},type:"paragraph",ps_null:!0,sb:"0pt",sa:"0pt",al:1}}},{r:1},{as:{end:["ts","type","al"]}}]],16:[null,[{as:{start:{type:"paragraph",ps_null:!0}}},{r:1},{as:{end:["type"]}}]]};return"HEADER"===e?g[t]:f[t]},i=function(e){var t=e.start,i=e.end;t+UNICODE.SECTION_START.length!=i-1&&editor.doc.getSelection().deleteContents(t+1,i-1)},n=function(e,n){var o=DocLayoutManager.getCurrentPage(),r="HEADER"===e?SECTION_TYPES.HEADER:SECTION_TYPES.FOOTER,a=o.getHFSection(r),s=a.getNode();if(s&&HF_SECTIONS.contains(s.getSectionType())){Op.processMsg(Op.getCursor(s.start+1,s.start+1)),Op.cursorProcessed(),i(s);for(var l,d=t(e,n.styleId),c=0,u=d.length;c<u;c++)if(d[c])for(var p=0,g=d[c].length;p<g;p++)d[c][p].hasOwnProperty("as")&&d[c][p].as.hasOwnProperty("start")?(l=Utils.randomString(12),d[c][p].as.id=l):d[c][p].hasOwnProperty("as")&&d[c][p].as.hasOwnProperty("end")&&(d[c][p].as.id=l);Op.processMsg([{r:s.end-1}].concat(d[1])),d[0]&&(Op.sendMsg(),Op.processMsg([{r:s.start+1}].concat(d[0])))}},o=function(t,i){var n={hf_type:e.All,styleId:i,type:t};r(n),EventHandler.toggleSection(),PanelUtil.openHeaderFooter()},r=function(e){var t=DocLayoutManager.getCurrentGroup(),i=t.getFirstSection().getNode(),o=(parseFloat(i.getAttr(ATTR_BODY.DS_MT)),e.type);if(0===parseFloat(i.getAttr(ATTR_BODY.DS_MT))&&"HEADER"===o||0===parseFloat(i.getAttr(ATTR_BODY.DS_MB))&&"FOOTER"===o){var r={};r["HEADER"===o&&0===parseFloat(i.getAttr(ATTR_BODY.DS_MT))?ATTR_BODY.DS_MT:ATTR_BODY.DS_MB]="1in";var a=editor.getDocument();editor.doc.execCmd("updatesectionstyle",[{sectionNodes:[i],styles:r},a]),a.sync()}n(o,e),Op.sendMsg()},a=function(){var e=DocLayoutManager.getCurrentSection(),t=e.getSectionType();if(HF_SECTIONS.contains(t)&&LeftPanel.isPanelVisible(ELEM_ID.HEADEROPTIONSPANEL)){var i=J("#hTop"),n=J("#fBot"),o=DocLayoutManager.getCurrentGroup(),r=o.getHFType(),a=o.getFirstSection().getNode();PageLayoutPanel.updateHeaderMaxValue(i),PageLayoutPanel.updateFooterMaxValue(n);var s=Conversions.toGlobalUnit(a.getAttr(ATTR_BODY.DS_HT)),l=Conversions.toGlobalUnit(a.getAttr(ATTR_BODY.DS_FB));if(i.zlabelednumberfield("setValue",s),n.zlabelednumberfield("setValue",l),r="undefined"==typeof r?HEADER_FOOTER_TYPE.PRIMARY:r,J("#menu_firstpage,#menu_evenodd").zstatebutton("checked",!1),r!=HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE&&r!=HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE||J("#menu_firstpage").zstatebutton("checked",!0),r!=HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE&&r!=HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE||J("#menu_evenodd").zstatebutton("checked",!0),DocTreeManager.isMultiSectionDocument())if(Z("hdrftr_link_prev_sectionLabel").show(),o.prev){J("#hdrftr_link_prev_section").enable();var d=o.getHFIds(t);d.contains(e.getNodeId())?J("#hdrftr_link_prev_section").zstatebutton("checked",!1):J("#hdrftr_link_prev_section").zstatebutton("checked",!0)}else J("#hdrftr_link_prev_section").disable();else Z("hdrftr_link_prev_sectionLabel").hide()}},s=function(){var e=DocLayoutManager.getCurrentGroup(),t=e.getFirstSection().getNode(),i=parseFloat(t.getAttr(ATTR_BODY.DS_FB)),n=parseFloat(J("#fBot").zlabelednumberfield("getValue"));if(i!=n){var o={};o[ATTR_BODY.DS_FB]=n+Conversions.globalUnit;var r=editor.getDocument();editor.doc.execCmd("updatesectionstyle",[{sectionNodes:[t],styles:o},r]),r.sync()}},l=function(){var e=DocLayoutManager.getCurrentGroup(),t=e.getFirstSection().getNode(),i=parseFloat(t.getAttr(ATTR_BODY.DS_HT)),n=parseFloat(J("#hTop").zlabelednumberfield("getValue"));if(i!=n){var o={};o[ATTR_BODY.DS_HT]=n+Conversions.globalUnit;var r=editor.getDocument();editor.doc.execCmd("updatesectionstyle",[{sectionNodes:[t],styles:o},r]),r.sync()}},d=function(){var e=DocLayoutManager.getCurrentGroup(),t=e.getHFType();t="undefined"==typeof t?HEADER_FOOTER_TYPE.PRIMARY:t;var i=J("#menu_firstpage").is(":checked"),n=J("#menu_evenodd").is(":checked"),o=HEADER_FOOTER_TYPE.PRIMARY;i&&!n?o=HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE:!i&&n?o=HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE:i&&n&&(o=HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE),editor.doc.execCmd("changeHdrFtr",o)},c=function(){var e=DocLayoutManager.getCurrentSection();if(HF_SECTIONS.contains(e.getSectionType())){var t=J("#hdrftr_link_prev_section").is(":checked");if(t){var i=[J.i18n("writer.common.PROCEED"),J.i18n("writer.common.CANCEL")],n=J.i18n("writer.common.LINK_TO_PREVIOUS_SECTION_WARNING_TITLE_MSG"),o=J.i18n("writer.common.LINK_TO_PREVIOUS_SECTION_WARNING_MSG");MsgDialog.showMessage(i,CONST.SEVERITY_INFO,n,o,null,function(e){e==CONST.BUTTON_YES_CLICKED?editor.doc.execCmd("linkHdrFtr"):e==CONST.BUTTON_NO_CLICKED&&J("#hdrftr_link_prev_section").zstatebutton("checked",!1)})}else editor.doc.execCmd("unlinkHdrFtr")}};return PubSub.subscribe("Document/CursorPositionChanged",a,{async:!0,timeout:100}),{changeHeaderFooterType:d,changeHeaderMargin:l,changeFooterMargin:s,applyPreHeaderFooterStyle:o,updateHeaderFooterPanel:a,toggleSectionLink:c}}(),carousel.init=function(){function e(){J("#carousel-parent ul").animate({left:+n},200,function(){J("#carousel-parent ul li:last-child").prependTo("#carousel-parent ul"),J("#carousel-parent ul").css("left","")})}function t(){J("#carousel-parent ul").animate({left:-n},200,function(){J("#carousel-parent ul li:first-child").appendTo("#carousel-parent ul"),J("#carousel-parent ul").css("left","")})}var i=J("#carousel-parent ul li").length,n=J("#carousel-parent ul li").width(),o=J("#carousel-parent ul li").height(),r=i*n;J("#carousel-parent").css({width:n,height:o}),J("#carousel-parent ul").css({width:r,marginLeft:-n}),J("#carousel-parent ul li:last-child").prependTo("#carousel-parent ul"),J("a.carousel-ctrl-prev").click(function(){e()}),J("a.carousel-ctrl-next").click(function(){t()})},carousel.move=function(e){for(;J("#carousel-parent ul ")[0].children[1].id.indexOf(e)<0;)J("#carousel-parent ul li:first-child").appendTo("#carousel-parent ul")},CollabListHandler={},CollabListHandler.userStatus={},CollabListHandler.maxUserCountInMenu=7,CollabListHandler.updateAddedUserStatus=function(e,t){var i=CollabListHandler.userStatus[e];i||(i=CollabListHandler.userStatus[e]={}),i.color||(CollabListHandler.userStatus[e]=DocUtil.mergeObjs([t,i])),i.WMSSTATUS="1",i.LASTACCESSTIME="0",i.isListedInMenu&&CollabListHandler.updateCollabMenu(e)},CollabListHandler.updateRemovedUserStatus=function(e){var t=CollabListHandler.userStatus[e];t||(t=CollabListHandler.userStatus[e]={}),t.WMSSTATUS="0",t.isListedInMenu&&CollabListHandler.updateCollabMenu(e)},CollabListHandler.sharedUserStatusCallback=function(e){if(e&&(e.USER_DETAILS||"SUCCESS"===e.RESPONSE))for(var t=e.USER_DETAILS,i=0;i<t.length;i++){var n=t[i];CollabListHandler.userStatus[n.ZUID]=n,CollabListHandler.userStatus[n.ZUID]=DocUtil.mergeObjs([editor.doc.getUserData()[n.ZUID],n])}},CollabListHandler.getSharedUserStatus=function(e,t){var i={};J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/util/users"),data:i,async:e,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(e,t,i){ZWLogger.log("UNABLE TO GET SHARED USERS LIST"+(t||""))},success:function(e){t&&t(e)}})},CollabListHandler.updateCollabMenu=function(e){var t=J("#collablistmenu");if(t[0]){var i=t.find("li#collablist-menuid-"+ReviewUtil.removeSplCharsInZuid(e)),n=CollabListHandler.userStatus[e];if(i){var o=J.i18n("writer.collaboratorpanel.status.YET_TO_VIEW"),r=i.find(".ui-access-status"),a=i.find(".js-collab-view-status"),s=i.find(".js-user-img"),l=i.find(".js-live-cursor");n.color&&s.css("border-color",n.color),r.removeClass("ui-icon-read-sm ui-icon-read-sm"),"-1"===n.LASTACCESSTIME?r.addClass("ui-icon-unread-sm"):r.addClass("ui-icon-read-sm"),a.removeClass("ui-collab-view-status-offline"),"0"===n.WMSSTATUS&&a.addClass("ui-collab-view-status-offline"),l[0]&&(l.removeClass("ui-state-disabled"),"1"===n.WMSSTATUS&&CollabListHandler.isCursorInDocument(e)||l.addClass("ui-state-disabled")),"1"===n.WMSSTATUS?o=J.i18n("writer.collaboratorpanel.status.VIEWING_NOW"):"-1"===n.LASTACCESSTIME?o=J.i18n("writer.collaboratorpanel.status.YET_TO_VIEW"):n.last_closed_time!=-1?o=J.i18n("writer.collaboratorpanel.status.LAST_VIEWED")+" "+Utils.getTimeFromNow(n.last_closed_time):"0"===n.WMSSTATUS&&(o=J.i18n("writer.collaboratorpanel.status.VIEWED")),e===editor.doc.docInfo.CREATOR_ZUID?(o='<span class="ui-collab-owner-label">'+J.i18n("writer.collaboratorpanel.DOCUMENT_OWNER")+" -</span>"+o,a.html(o)):a.text(o)}else t.empty(),CollabListHandler.openCollabMenu()}},CollabListHandler.getListByStatus=function(){var e={"On&Ac":[],"Off&Ac":[],"Off&NA":[]};for(var t in CollabListHandler.userStatus){var i=CollabListHandler.userStatus[t];editor.zuid!=editor.doc.docInfo.CREATOR_ZUID&&editor.zuid==i.ZUID||("1"==i.WMSSTATUS?e["On&Ac"].push(i):"0"==i.WMSSTATUS&&"-1"!=i.LASTACCESSTIME?e["Off&Ac"].push(i):"0"==i.WMSSTATUS&&"-1"==i.LASTACCESSTIME&&e["Off&NA"].push(i))}return e},CollabListHandler.getDialogContent=function(){var e=CollabListHandler.getListByStatus(),t=0,i=editor.doc.docInfo,n=e["On&Ac"].concat(e["Off&Ac"].concat(e["Off&NA"]));if(U.find(n,function(e){return t++,e.ZUID==i.CREATOR_ZUID}),t-=1,0!=t&&t!=n.length){var o=n[t];n[t]=n[0],n[0]=o}var r=function(e){var t=e.last_closed_time==-1?J.i18n("writer.collaboratorpanel.status.VIEWED"):J.i18n("writer.collaboratorpanel.status.LAST_VIEWED")+" "+Utils.getTimeFromNow(e.last_closed_time),n='<div class="ui-collab-listitem clearfix'+(e.ZUID==i.CREATOR_ZUID?" ui-collab-doc-owner":"")+' "><img class="ui-collab-listitem-img ui-ms-pointer"  data-user-zuid="'+e.ZUID+'" onclick = "UIUtils.showProfileInfoEvent(event)" style="border-color: '+(e.color?e.color:"#888")+'" src='+ZWNetworkUtils.getUserImageURL(e.ZUID)+' loading="lazy">'+(e.ZUID!=i.CREATOR_ZUID?'<em class="ui-fr ui-right-margin-small ui-top-margin-small ui-access-status '+("-1"===e.LASTACCESSTIME?"ui-icon ui-sprit-lazy ui-icon-unread-sm":"ui-icon ui-sprit-lazy ui-icon-read-sm")+'"></em>'+(editor.getRole().permissions.can("document.edit")||editor.getRole().permissions.can("review.comment.add")?'<span title="'+J.i18n("writer.collaboratorpanel.LOCATE_USER_CURSOR")+'" data-zuid="'+e.ZUID+'" onClick="CollabListHandler.navigateFromDialog(this.getAttribute(\'data-zuid\'))" data-title-position="top" class="ui-livecursor-icon ui-icon ui-fr ui-right-margin-small ui-top-margin-small ui-ms-pointer'+("1"===e.WMSSTATUS&&CollabListHandler.isCursorInDocument(e.ZUID)?"":" ui-state-disabled")+'"><svg class="zbutton__svg" width="16px" height="16px"><use xlink:href="#zw-livecursor-icon"></use></svg></span>':""):"")+'<span class="ui-collab-name">'+Utils.encodeHTMLString(e.FULLNAME)+'<br><span class="ui-collab-view-status '+("0"===e.WMSSTATUS?"ui-collab-view-status-offline":"")+'">'+(e.ZUID==i.CREATOR_ZUID?'<span class="ui-collab-owner-label">'+J.i18n("writer.collaboratorpanel.DOCUMENT_OWNER")+"</span>":"")+(e.ZUID==i.CREATOR_ZUID&&"0"!=e.WMSSTATUS?'<span class="ui-collab-owner-label">-</span>':"")+("-1"===e.LASTACCESSTIME?J.i18n("writer.collaboratorpanel.status.YET_TO_VIEW"):"0"===e.WMSSTATUS?e.ZUID!=i.CREATOR_ZUID?t:"":J.i18n("writer.collaboratorpanel.status.VIEWING_NOW"))+"</span></span></div>";return n},a="";for(t=0;t<n.length;t++){var e=n[t];e.FULLNAME&&(a+=r(e))}return a},CollabListHandler.openCollabDialog=function(){var e={init:function(){J("#collablist-dlg-cont").empty();var e=CollabListHandler.getDialogContent(),t=J(e);t.appendTo(J("#collablist-dlg-cont"))}};J.dialogutil.open("collablistdialog",null,e)},CollabListHandler.addUserInCollabMenu=function(e,t){var i=J("#collablistmenu"),n=editor.doc.docInfo,o=e.last_closed_time==-1?J.i18n("writer.collaboratorpanel.status.VIEWED"):J.i18n("writer.collaboratorpanel.status.LAST_VIEWED")+" "+Utils.getTimeFromNow(e.last_closed_time),r='<img class="js-user-img ui-collab-listitem-img ui-ms-pointer" data-user-zuid="'+e.ZUID+'"  onclick = "UIUtils.showProfileInfoEvent(event)" style="border-color: '+(e.color?e.color:"#888")+'" src='+ZWNetworkUtils.getUserImageURL(e.ZUID)+">"+(e.ZUID!=n.CREATOR_ZUID?'<em class="ui-fr ui-right-margin-small ui-top-margin-small ui-access-status ui-left-margin-medium '+("-1"===e.LASTACCESSTIME?"ui-icon ui-sprit-lazy ui-icon-unread-sm":"ui-icon ui-sprit-lazy ui-icon-read-sm")+'"></em>'+(editor.getRole().permissions.can("document.edit")||editor.getRole().permissions.can("review.comment.add")?'<span title="'+J.i18n("writer.collaboratorpanel.LOCATE_USER_CURSOR")+'" data-zuid="'+e.ZUID+'" onClick="CollabListHandler.navigateToCursor(this.getAttribute(\'data-zuid\'))"  data-title-position="top" class="js-live-cursor ui-livecursor-icon ui-icon ui-fr ui-right-margin-small ui-top-margin-small ui-ms-pointer'+("1"===e.WMSSTATUS&&CollabListHandler.isCursorInDocument(e.ZUID)?"":" ui-state-disabled")+'"><svg class="zbutton__svg" width="16px" height="16px"><use xlink:href="#zw-livecursor-icon"></use></svg></span>':""):"")+'<span class="ui-collab-name">'+Utils.encodeHTMLString(e.FULLNAME)+'<br><span class="js-collab-view-status ui-collab-view-status '+("0"===e.WMSSTATUS?"ui-collab-view-status-offline":"")+'">'+(e.ZUID==n.CREATOR_ZUID?'<span class="ui-collab-owner-label">'+J.i18n("writer.collaboratorpanel.DOCUMENT_OWNER")+"</span>":"")+(e.ZUID==n.CREATOR_ZUID&&"0"!=e.WMSSTATUS?'<span class="ui-collab-owner-label">-</span>':"")+("-1"===e.LASTACCESSTIME?J.i18n("writer.collaboratorpanel.status.YET_TO_VIEW"):"0"===e.WMSSTATUS?e.ZUID!=n.CREATOR_ZUID?o:"- "+o:J.i18n("writer.collaboratorpanel.status.VIEWING_NOW"))+"</span></span>",a={itemType:"custom",itemValue:e.ZUID,id:"collablist-menuid-"+ReviewUtil.removeSplCharsInZuid(e.ZUID),className:"ui-collab-listitem clearfix"+(e.ZUID==n.CREATOR_ZUID?" ui-collab-doc-owner":""),innerHTML:r};t&&(a.index=t),i.zmenu("addMenuItem",a)},CollabListHandler.isCursorInDocument=function(e){var t,i,n;if(editor.doc.userData[e]&&(t=editor.doc.userData[e].uuids)){i=t.split(",");for(var o=0,r=i.length;o<r;o++)if(n=i[o],n&&editor.doc.getCursorPortionNode(n,"start"))return!0}return!1},CollabListHandler.scrollCursorIntoView=function(e,t){var i=DomUtil.scrollElementIntoView(e,500);i&&i.promise().then(function(){CurUtil.showCollbUserName(t)})},CollabListHandler.navigateToCursor=function(e){var t,i,n,o;if(e&&CollabListHandler.userStatus[e]&&"1"===CollabListHandler.userStatus[e].WMSSTATUS&&editor.doc.userData[e]&&(t=editor.doc.userData[e].uuids)){i=t.split(",");for(var r=0,a=i.length;r<a;r++)if(n=i[r],n&&(o=editor.doc.getCursorPortionNode(n,"start"))){CollabListHandler.scrollCursorIntoView(o,n);break}}},CollabListHandler.navigateFromDialog=function(e){J.dialogutil.close("collablistdialog"),CollabListHandler.navigateToCursor(e)},CollabListHandler.removeUserInCollabMenu=function(e){J("#collablistmenu").zmenu("removeMenuItem","#collablist-menuid-"+ReviewUtil.removeSplCharsInZuid(e))},CollabListHandler.addViewMoreInCollabMenu=function(e,t){var i=J("#collablistmenu"),n=i.find("#collablist-viewmore");if(n[0])n.text(e-CollabListHandler.maxUserCountInMenu);else{var o='<span id="collablist-viewmore" class="ui-collab-user-total">+'+(e-CollabListHandler.maxUserCountInMenu)+'</span><a class="ui-collab-view-all" href="#">'+J.i18n("writer.common.VIEW_All")+"</a>",r={itemType:"custom",id:"collablist-viewall",className:"clearfix",appData:{action:"CollabListHandler.openCollabDialog"},innerHTML:o};t&&(r.index=t),i.zmenu("addMenuItem",r)}},CollabListHandler.removeViewAllInCollabMenu=function(){J("#collablistmenu").zmenu("removeMenuItem","#collablist-viewall")},CollabListHandler.isEventBinded=!1,CollabListHandler.openCollabMenu=function(e){var t=J("#collablistmenu"),i=0,n=editor.doc.docInfo;if(e="undefined"==typeof e||e,0==t.find("li").length){e&&CollabListHandler.getSharedUserStatus(!1,CollabListHandler.sharedUserStatusCallback);var o=CollabListHandler.getListByStatus(),r=o["On&Ac"].concat(o["Off&Ac"].concat(o["Off&NA"]));if(U.find(r,function(e){return i++,e.ZUID==n.CREATOR_ZUID}),i-=1,0!=i&&i!=r.length){var a=r[i];r[i]=r[0],r[0]=a}for(i=0;i<r.length&&i<CollabListHandler.maxUserCountInMenu;i++){var o=r[i];o&&!o.FULLNAME||(CollabListHandler.addUserInCollabMenu(o),o.isListedInMenu=!0)}r.length>CollabListHandler.maxUserCountInMenu&&CollabListHandler.addViewMoreInCollabMenu(r.length),r.length>1&&t.zmenu("addMenuItem",{itemType:"separator"});var s='<span class="ui-fl zbutton__icon ui-sprit-lazy ui-icon-live-cursor-sm"></span><span class="ui-fl">'+J.i18n("writer.common.VIEW_LIVE_CURSORS")+'</span><div id="view-live-cursors-switch" ctype="ztoggleswitch" class="ui-fr" data="{change:\'CollabListHandler.toggleCollabCursors\'}"></div>',l='<span class="ui-fl zbutton__icon ui-sprit-lazy ui-icon-insights-sm"></span><span class="ui-fl ui-ms-pointer">'+J.i18n("writer.common.ENGAGEMENT_INSIGHTS")+"</span>";t.zmenu("addMenuItem",{label:J.i18n("writer.common.NOTIFY_COLLABORATORS"),icon:"ui-sprit-fast ui-icon-mail-sm",action:"WebUtil.notifyCollaborators"}),t.zmenu("addMenuItem",{label:J.i18n("writer.common.EMAIL_NOTIFICATION_SETTINGS"),icon:"ui-sprit-fast ui-icon-follow-sm",action:"Settings.showNotificationDialog"}),t.zmenu("addMenuItem",{className:"ui-custom-menuitem clearfix",innerHTML:s,itemType:"custom"}),t.zmenu("addMenuItem",{itemType:"separator"}),t.zmenu("addMenuItem",{className:"clearfix ui-zw-nw-tag-hover",innerHTML:l,itemType:"custom",customAttributes:{module:"ReaderInsights",id:"reader-insights-link"}}),UIUtils.initComponent("reader-insights-link"),Utils.applyExcludes(t[0]),UIUtils.initComponent("view-live-cursors-switch"),J("#view-live-cursors-switch").ztoggleswitch(ZWSelection.isCollabCursorShown()?"switchOn":"switchOff")}else{var d=CollabListHandler.userStatus;for(var c in d)d.hasOwnProperty(c)&&d[c].isListedInMenu&&CollabListHandler.updateCollabMenu(c)}CollabListHandler.isEventBinded||(CollabListHandler.isEventBinded=!0,PubSub.subscribe("Collaboration/ResourceShared",CollabListHandler.addUser),PubSub.subscribe("Collaboration/ResourceUnshared",CollabListHandler.removeUsers)),PubSub.publish("CollabListMenu/Opened")},CollabListHandler.getRenderedCollabListCount=function(){var e=CollabListHandler.userStatus,t=0;for(var i in e)e.hasOwnProperty(i)&&e[i].isListedInMenu&&t++;return t},CollabListHandler.addUser=function(e){var t={};t.userid=e,ZWNetworkUtils.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/util/getParticipantDetails"),data:t,dataType:"json",success:function(t){if(t.COLLABUSERSINFO){CollabListHandler.userStatus[e]=t.COLLABUSERSINFO,CollabListHandler.userStatus[e].last_closed_time=-1;var i=ZWJSONUtils.getKeys(CollabListHandler.userStatus).length,n=CollabListHandler.getRenderedCollabListCount();n<CollabListHandler.maxUserCountInMenu?(CollabListHandler.addUserInCollabMenu(CollabListHandler.userStatus[e],n),CollabListHandler.userStatus[e].isListedInMenu=!0):CollabListHandler.addViewMoreInCollabMenu(i,CollabListHandler.maxUserCountInMenu)}else ZWLogger.log("GET PARTICIPANTS DETAILS REQUEST FAILED FOR ZUID: "+e)},error:function(t,i,n){ZWLogger.log("GET PARTICIPANTS DETAILS REQUEST FAILED FOR ZUID: "+e)},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})},CollabListHandler.removeUsers=function(e){for(var t,i,n=!1,o=J("#collablistmenu"),r=0,a=e.length;r<a;r++)t=e[r],o[0]&&(i=o.find("li#collablist-menuid-"+ReviewUtil.removeSplCharsInZuid(t)),i&&i[0]&&(n=!0)),CollabListHandler.removeUserInCollabMenu(t),delete CollabListHandler.userStatus[t];var s=ZWJSONUtils.getKeys(CollabListHandler.userStatus).length;n&&o[0]?(o.empty(),CollabListHandler.openCollabMenu(!1)):s<=CollabListHandler.maxUserCountInMenu?CollabListHandler.removeViewAllInCollabMenu():CollabListHandler.addViewMoreInCollabMenu(s,CollabListHandler.maxUserCountInMenu)},CollabListHandler.toggleCollabCursors=function(e,t){t&&t.state?ZWSelection.showCollabCursors():ZWSelection.hideCollabCursors()},CollabListHandler.openReaderInsights=function(){ZWComponentUtil.init("documentinsightspanel"),Z("documentinsightspanel").zpopover("open")},CollabListHandler.beforeReaderInsightsOpen=function(){ZWAnimation.animate("documentinsightspanel",ANIMATIONS.RIGHT_PANEL_SLIDEIN)},CollabListHandler.addSubscribers=function(){Macros.isShareListAvailable()&&(PubSub.subscribe("Collaboration/UserAdded",CollabListHandler.updateAddedUserStatus),PubSub.subscribe("Collaboration/UserRemoved",CollabListHandler.updateRemovedUserStatus))},CollabListHandler.init=function(){CollabListHandler.addSubscribers(),J("#collablistmenu").on("zmenuitemclick",function(e,t){if($(e.originalTarget).hasClass("ui-collab-listitem-img"))return!1})},PubSub.subscribe("Document/ComponentInitialized",CollabListHandler.init);var QuickSearch=function(){"use strict";var e,t,n,o,r,a,s={},l={},d={},c={},u={},p={},g={},f={},E=[],T="",m="",h=J("input#quicksearchinput"),I=J("ul#quicksearchmenu"),_=J("#quicksearchcontainer").height(),A={1:u,2:p,3:g,shape:l,table:d,image:c},S=function(){e=f,R(J("#bottombar,#topband-default,#topband-printpreview"),["li","input","button"]),e=u;var t=J("#subpanel-container").children();t.each(function(e){R(J(t[e]),["li","input","button"])}),R(J("#pagelayout-container"),["li","input","button"]),QuickSearch.restrictDuplicated=[],e=p,R(J("#review-tb"),["li","input","button"]),QuickSearch.restrictDuplicated=[],e=g,R(J("#complete-tb"),["li","input","button"]),QuickSearch.restrictDuplicated=[],e=d,R(J("#subpanel-table"),["li","button","input"]),e=c,R(J("#subpanel-img"),["li","button","input"]),b()},R=function(e,t,i){for(var n=0;n<t.length;n++){var o=e.find(t[n]),r=o.length;if(1==t.length&&!o.length)return!1;for(var a=0;a<r;a++)y(o[a],i)}return!0},O=function(e,t,i,n,o,r,a){var s={menuId:e,elementId:i,modeType:n,parentId:t},l={navigateDatas:s,executeAppdatas:o},d={label:J.i18n(r),skipshortcutregister:!0,customAttributes:l};u[J.i18n(a)]=d},b=function(){O("review-tb","","review-tb-tcswitch-outer",2,{action:"TCAdaptor.toggleStateFromFeatureFinder"},"writer.quicksearch.TRACKCHANGES_ONOFF","writer.quicksearch.TAGS_TRACKCHANGES"),O("review-tb","","review-tb-pausecollab",2,{action:"WebUtil.checkOutDocument"},"writer.quicksearch.TAGS_PAUSECOLLAB","quicksearch","TAGS_PAUSECOLLAB"),O("menuFormat","","fmt-lpnl-designmenubtn",1,{action:"DesignUI.openDesignDialog"},"writer.quicksearch.DOCUMENTTHEMES","writer.quicksearch.TAGS_DOCUMENTTHEMES"),O("menuInsert","","ins-lpnl-table",1,{action:"TableInsertDlg.openTablePopup"},"writer.quicksearch.TABLE","writer.quicksearch.TAGS_TABLE"),O("menuFormat","","hruler-container",1,{action:"LeftPanel.toggleLeftPanel"},"writer.common.RULER.RULER","writer.quicksearch.TAGS_RULER")},v=function(e){var t=e.label;if(!t||t.length<1)return!1;var t=t.toLowerCase().trim().replace(" ","").replace("insert ","").replace("add ","").replace("as ","");return QuickSearch.restrictDuplicated.indexOf(t)!=-1||(QuickSearch.restrictDuplicated.push(t),!1)},D=function(e,t){var i=t.menuitem,n=J(i).metadata(),o=n.customAttributes.executeAppdatas;if(ZWLogger.addToStatistics("qs_"+m),U(),!J(e.originalEvent.target).is(".ui-locate-button")&&o){var r=o.action;if(r){var a=o.params,s=Utils.getAsFunction(r);s.callable(a)}}else{var l=n.customAttributes.navigateDatas;L(l)}},L=function(e){var t=e.elementId;e.modeType&&LayoutManager.getCurrentLayout()!=e.modeType&&LayoutManager.loadLayout(e.modeType),1==e.modeType&&(LayoutManager.isRichEditActive()||LeftPanel.toggleLeftPanel(),LeftPanel.isContainerVisible(ELEM_ID.MAINPANELCONTAINER)&&LeftPanel.showSubPanel(e.menuId,ANIMATIONS.FADEIN)),e.tabId&&J("a[href="+e.tabId+"]").click(),N(t,e)},N=function(e,t){J("#helpDiv").css({top:-1e3,left:-1e3});var i=J("#"+e).attr("data")&&JSON.parse(J("#"+e).attr("data")).label||J.i18n("quicksearch","HERE");J("#helpTxt").text(i),setTimeout(function(){P(t)},1e3)},P=function(e){if(e.parentMenuId&&e.parentId){var t=jQuery.Event("mousedown");t.originalEvent=!0;var i="",n=J("#"+e.parentId);"zsplitbutton"==n.attr("ctype")&&(i="DropDown"),J("#"+e.parentId+i).trigger(t)}var o=J("#"+e.elementId),r=0,a=o.offset();if(0==a.top&&0==a.left&&"INPUT"==o[0].nodeName){var s=J("label[for='"+e.elementId+"']");if(s&&(a=s.offset()),!a){var l=J("#"+e.elementId+"Label");l[0]&&(a=l.offset())}}else 0==a.top&&"LABEL"==o.parent()[0].nodeName&&(a=o.parent().offset());r=a.left+o.width()/2-J("#helpDiv").width()/2,r>0&&(J("#helpDiv").css({top:a.top+o.height()+12,left:r}),J("#helpDiv").show(),J("#helpTxt").effect("bounce",500),setTimeout(function(){e.cmenuType&&J("#"+e.parentMenuId)[e.cmenuType]("hide"),C()},3e3))},C=function(){J("#helpDiv").hide(),J.ZContextMenu.hideMenu(),J.ZContextMenu._isMenuShowing=!1},y=function(t,n){try{var o=t.getAttribute("data")?JSON.parse(t.getAttribute("data")):void 0;if(!o||"More"==o.label)return;a="";var r={},s={},l="",d="",c=J(t),u=t.id,p="",g=t.nodeName,f=o.quicksearch,E=void 0;if(!n&&c.parent("ul")[0]&&n&&"LI"==n[0].nodeName)return;if(f&&f.skipLoading)return;if(o.label&&(d+=o.label),c.attr("title")){var T=c.attr("title");try{var m=J(T);null!=m[0]&&m.find(".ui-ztooltip-header")[0]&&(T=m.find(".ui-ztooltip-header").text())}catch(e){}d+=T,o.label||(o.label=T)}if("INPUT"===g&&u){var h=J("label[for="+u+"]");if(h&&h.attr("title")){var T=h.attr("title");d+=T,o.label||(o.label=T)}}if(v(o))return!0;if(o.icon){var I=o.icon;I.indexOf("-lg")!=-1&&(o.icon=I.replace("-lg","-sm"))}if(o.menuId&&R(J("#"+o.menuId),["li"],c),j(J(t),s),t.getAttribute("onclick")){var _=t.getAttribute("onclick");if(_=_.replace(/[()]/g," ").trim().split(" "),o.appData={action:_},_.length>0){var A=_[1].replace(/[""]/g,"").split(",");o.appData.params=A}}if(c.parents(".ui-tabs-panel")[0]){var S=c.parents("div.ui-vertical-sub-nav").find("a");for(i=0;i<S.length;i++){var O=J(S[i]).attr("href"),b=J(O).find("#"+u);if(b[0]){s.tabId=O;break}}}if("LI"===g&&n){if(o.appData&&o.appData.shapeObjType)return;p=F(n),E=c;var D=J("#"+p);if(!D.attr("id"))return;j(D,s);var L=c.parent("ul");L&&L.attr("ctype")&&(s.cmenuType=L.attr("ctype"),s.parentMenuId=L.attr("id"),l=L.attr("id"))}o.tags&&(d+=o.tags),!o.label&&o.icon&&(o.label=J("#"+u).text(),d+=o.label),s.elementId=u,s.parentId=p,s.childNode=E,r.navigateDatas=s,r.toolbarName=a,r.executeAppdatas=o.appData||void 0,J.each(r,function(e,t){!t&&delete r[e]}),delete o.className,o.customAttributes=r,o.skipshortcutregister=!0,e[d.replace(/[&\/\\#,+()$~%.'":*?<>{} ]/g,"").toLowerCase()]=o}catch(e){}},F=function(e){var t=e;if(t.length){var i=t.parents("div.ui-vertical-sub-nav").attr("id");return i&&(i.toLowerCase().indexOf("table")!=-1?a="table":i.toLowerCase().indexOf("shape")!=-1?a="shape":i.toLowerCase().indexOf("digisign")!=-1&&(a="digisign")),t.attr("id")}},M=function(){h.focus()},w=function(e){e&&(e.preventDefault(),e.stopPropagation()),PopupHandler.closeAllPopup(),CurUtil.stopBlinking(),ZWLogger.addToStatistics("FeatureFinder"),J(".ui-qs-placeholder,#helpDiv").hide(),J(".ui-qs-overlay,#quicksearchcontainer").fadeIn(100,function(){h.focus()}),h.val("")},U=function(){J(".ui-qs-overlay,#quicksearchcontainer").fadeOut(100),J.ZContextMenu.hideMenu(),J.ZContextMenu._isMenuShowing=!1,CurUtil.blinkCursor(),EditorUtil.focusMultiByteSpan()},x=function(){I.zmenu(),h[0].addEventListener("keydown",function(e){var t=e.keyCode;if(t==KEYS.ESC)return J.ZContextMenu._isMenuShowing?(H(),h.val("")):(h.val("").focusout(),U()),e.preventDefault(),void e.stopPropagation()},!1),J("div.ui-qs-overlay").bind("click",function(e){U()}),I.bind("click",function(e){ZWLogger.addToStatistics("slsearch"),J("#quicksearchinput").val("")}),h.on("focusin",function(i){r=editor.doc.getSelection();var o=r.isTableSelected();t=r.isCollapsed()&&!!J(editor.doc.getCursorPortionNode(editor.uuid,"start")).parents("td:first")[0]||o,n=InsertShape.getSelectedShape();var a=ModeManager.getCurrentMode();t?a="table":n&&(a="shape"),e=A[a]}).bind("click",function(e){CurUtil.stopBlinking(),e.preventDefault()}).bind("keyup",function(e){var t=e.keyCode;if(t==KEYS.NAV_DOWN)return void J.ZContextMenu.currentMenu.zmenu("hoverNextMenuItem");if(t==KEYS.NAV_UP)return void J.ZContextMenu.currentMenu.zmenu("hoverPreviousMenuItem");if(t==KEYS.SPACE||t==KEYS.ESC)return void e.preventDefault();if(t==KEYS.ENTER)return h.val(""),void(J.ZContextMenu.currentMenu&&J.ZContextMenu.currentMenu.zmenu("handleKeyCode",t,e));var i=h.val().toString().replace(/[&\/\\#,+()$~%.'":*?<>{} ]/g,"").toLowerCase();return i.length<=1?void H():(J(".ui-qs-placeholder").show(),clearTimeout(o),o=setTimeout(function(){z(e)},300),void 0)}),I.unbind("zmenuitemclick").bind("zmenuitemclick",QuickSearch.executeActions),I.unbind("zmenusubmenuitemclick").bind("zmenusubmenuitemclick",function(){H(),U()}),J("#writer-gsearch").on("click",B)},B=function(){var e=Z("quicksearchinput").val()||"";zgssearch.helpSearch(e)},H=function(){clearTimeout(o),J.ZContextMenu.hideMenu(),J.ZContextMenu._isMenuShowing=!1,h.focus(),J(".ui-qs-placeholder").hide()},G=function(e,t){var i=[],n={},o={};return J(e).each(function(i){var r=e[i];if(r){var a=r.label&&r.label.toLowerCase()||"",s=a.indexOf(t);s=s!=-1?s:"extra",o[a]=r,s!=-1&&(void 0!=n[s]?n[s].push(a):n[s]=[a])}}),J.each(n,function(e,t){J.each(t,function(e,t){i.push(o[t])})}),i},k=function(){var i=[],o={};return m=h.val().toString().replace(/[&\/\\#,+()$~%.'":*?<>{} ]/g,"").toLowerCase(),m.length<1?i:(QuickSearch.restrictDuplicated=[],i=Y(m,i,e),i=Y(m,i,f),editor.isFinalDocument()||n||t||(J.extend(o,u),i=Y(m,i,o),J.extend(o,p),i=Y(m,i,o),J.extend(o,g),i=Y(m,i,o)),G(i,m))},W=function(e){var t;if(e.customAttributes.navigateDatas.elementId)return t=J("#"+e.customAttributes.navigateDatas.elementId).parent("ul")[0]?e.customAttributes.navigateDatas&&e.customAttributes.navigateDatas.parentId&&J("#"+e.customAttributes.navigateDatas.parentId):J("#"+e.customAttributes.navigateDatas.elementId),!!t&&(!(!r||!r.isListItemSelection||"menuInsert"!=J(t).parents("div.ui-vertical-sub-nav").attr("id"))||!!(t.attr("disabled")||t.hasClass("ui-zwdisabled")||t.hasClass("is-disabled")||"disabled"==e.disabled))},Y=function(e,i,o){var r;for(var a in o){var s=a.toLowerCase();if(r=s.indexOf(e),r!=-1){var l=o[a];if(10==i.length)break;if(v(l)||!l.label)continue;if(W(l))continue;if(l.toolbarName){var d=l.toolbarName;if(d.indexOf("table")!=-1&&!t||d.indexOf("shape")!=-1&&!n)continue}l.customAttributes.navigateDatas.elementId&&(l.itemType="custom",l.innerHTML='<span class="zbutton__icon '+l.icon+'"></span><span class="ui-fl">'+l.label+'</span><div class="ui-locate-button">'+J.i18n("writer.quicksearch.LOCATE")+"</div></div>",l.replaceWithText=!0),i.push(l)}}return i},z=function(e){J.ZContextMenu.currentMenu=I;var t=k();t.length>0?(I.empty(),I.css({top:h.offset().top+_,left:h.offset().left-1,width:J("input#quicksearchinput").css("width")}).show().zmenu("addMenuItems",t),J.ZContextMenu.currentMenu.zmenu("hoverNextMenuItem"),J.ZContextMenu._isMenuShowing=!0):(clearTimeout(o),h.focus())},V=function(){var e="writer.quicksearch.PLACEHOLDER",t=["\t\t\t(Ctrl+Option+Space)"],i='⌘ <span class="ui-italic">command</span>';editor.browserInfo.is_mac||(i='<span class="ui-italic">Ctrl</span>',t=["\t\t\t(Ctrl+Alt+Space)"]),document.getElementById("quicksearchinput").placeholder=J.i18n(e,t),document.getElementById("qs-command-container").innerHTML=i,QuickSearch._generateMenus(),x()},j=function(e,t){var i=e.parents("div.ui-vertical-sub-nav").attr("id");i?(t.menuId=i,t.modeType=1,i.toLowerCase().indexOf("table")!=-1?a="table":i.toLowerCase().indexOf("shape")!=-1?a="shape":i.toLowerCase().indexOf("digisign")!=-1&&(a="digisign")):e.parents("#complete-tb").length?(t.menuId="#complete-tb",t.modeType=3):e.parents("#review-tb").length?(t.menuId="#review-tb",t.modeType=2):e.parents("#topband").length?t.menuId="#topband":e.parents("#bottombar").length&&(t.menuId="#bottombar")};J("input#quicksearchinput").one("focus",function(){V()}),PubSub.subscribe("Document/ComponentInitialized",function(){var e="⌃ <i>ctrl </i>",t="⌥ <i> options </i>",i="␣ <i>space</i>";editor.browserInfo.is_mac||(e="<i>ctrl</i>",t="<i>alt</i>",i="<i>space</i>");var n="<br>"+e+"+"+t+" +"+i,o={"topband-spotlightsearch":{title:"writer.quicksearch.colon.SPOTLIGHT_SEARCH",content:"writer.quicksearch.SEARCH_TOOLTIP_CONTENT",contentParams:n}};UIUtils.addHTMLTooltips(o)});var X=function(t,i,n){e=i?A[i]:A[n],R(t,["li","button","input"])};return{_generateMenus:S,_constructMenus:y,_createMenu:R,takeMeTo:L,menus:s,restrictDuplicated:E,executeActions:D,showMenu:w,currentElementId:T,focusInput:M,_showNavigator:N,searchCase:m,hideSearchBar:U,initMenus:X}}();!function(){var e="docx",t={},i={init:function(){$("<iframe>",{id:"cloudUploadIframe",src:s(),frameborder:"0",width:"100%",height:"82%"}).appendTo("#cloudUploadIframeContainer")}},n=function(n){e=n.format,t=n.info||{},J.dialogutil.open("cloudupload","",i)},o=function(){J.dialogutil.close("cloudupload")},r=function(){var e=editor.cloudUploadServices,t=e.split(","),i=w_usersettings.cloudupload_recent;if("STOREAGE_SERVICE_WRITER"!=editor.doc.getRole()){var n=t.indexOf("zohodocs");n!=-1&&t.splice(n,1)}var o=t.indexOf(i);return o!=-1&&(t.splice(o,1),t.unshift(i)),t},a=function(){var e=window.location!=window.parent.location?window.parent.location.origin:document.location.origin,t=window.location.protocol+"//"+editorProps.urls.servername;return(e!==t?e+",":"")+t},s=function(){var i;return i="//"+editorProps.urls.gadgetServerURL+"/CloudUploader?zservice=writer",i+="&sources="+r(),i+="&fileName="+l(),i+="&customCss="+cssCdnZWStaticPath+fingerPrintObj["styles/cloudupload.css"],i+="&serURL="+editorProps.urls.base_url+"/v1/web/cloudupload/format/"+e+"/callback",i+="&frameorigin="+(t.frame_origins||a())},l=function(){var e=editor.doc.docInfo.DOCUMENT_NAME;e=e.replace(/[\*\:\/\\\|\"\']/g,"_");var t=encodeURIComponent(e);return t},d=function(e){o(),UIUtils.showMessage("info",J.i18n("writer.image.UPLOADING_MSG"),!1,"normalfont");var t={};t.fileName=e.fileName,t.folderId=e.folderId,t.source=e.source,e.password&&(t.password=e.password),"dropbox"===e.source&&e.accountId&&(t.accountId=e.accountId),"skydrive"===e.source&&e.onedrive_email&&(t.onedrive_email=e.onedrive_email),"googleTD"===e.source?(t.teamDriveId=e.teamDriveId,w_usersettings.cloudupload_recent="gdrive"):"office365"===e.source?w_usersettings.cloudupload_recent="skydrive":w_usersettings.cloudupload_recent=e.source,J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix("cloudupload")+"/"+editor.doc.docInfo.RID+"/format/"+e.format+"/upload",data:t,async:!0,success:function(e){UIUtils.hideMessage(),"SUCCESS"===e.STATUS?UIUtils.showMessage("info",J.i18n("writer.cloudupload.DOCUMENT_UPLOAD_SUCCESS_MESSAGE"),"showclose","normalfont",5e3):UIUtils.showMessage("error",J.i18n("writer.cloudupload.DOCUMENT_UPLOAD_FAILED_MESSAGE"),"showclose","normalfont",5e3)},error:function(e,t,i){UIUtils.showMessage("error",J.i18n("writer.cloudupload.DOCUMENT_UPLOAD_FAILED_MESSAGE"),"showclose","normalfont",5e3)},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})},c=function(e,t){var i=editor.doc.docInfo,n={};n.format=e,n.info=t,"draft"==i.state?UIUtils.handDraftPopup("cloudUpload.openCloudUploadDialog",n):cloudUpload.openCloudUploadDialog(n)};window.cloudUpload={uploadDocToCloud:d,openCloudUploadDialog:n,closeCloudUploadDialog:o,handleCloudUploadDialog:c}}();var CloudPicker=function(){"use strict";var e,t={},i=void 0,n={init:function(){$("<iframe>",{id:"cloudPickerIframe",src:l(),frameborder:"0",width:"100%",height:"82%"}).appendTo("#cloudPickerIframeContainer")}},o=function(e,o){i=o,t=e||{},J.dialogutil.open("cloudpicker","",n)},r=function(){J.dialogutil.close("cloudpicker")},a=function(){var e=Macros.getCloudPickerServices(),t=e.split(","),i=w_usersettings.cloudupload_recent,n=t.indexOf("zohodocs");n!=-1&&t.splice(n,1);var o=t.indexOf("workdrive");o!=-1&&t.splice(o,1);var r=t.indexOf(i);return r!=-1&&(t.splice(r,1),t.unshift(i)),t},s=function(){var e=window.location!=window.parent.location?window.parent.location.origin:document.location.origin,t=window.location.protocol+"//"+editorProps.urls.servername;return(e!==t?e+",":"")+t},l=function(){var e;return e="//"+editorProps.urls.gadgetServerURL+"/CloudPicker?zservice=writer",e+="&sources="+(t.services||a()),e+="&fileExtensions="+(t.extn||"docx,doc,txt,html,rtf,odt"),e+="&fileMimeTypes=googleDocs,"+(t.extn||"docx,doc,txt,html,rtf,odt"),e+="&attachLimit="+(t.limit||"1"),e+="&customCss="+cssCdnZWStaticPath+fingerPrintObj["styles/cloudupload.css"],e+="&serURL="+(t.callback_url||editorProps.urls.base_url+"/v1/web/cloudpicker/callback")+"?frameorigin="+(t.frame_origins||s()),e+="&frameorigin="+(t.frame_origins||s()),Macros.getCloudPickerServices().indexOf("workdrive")!=-1&&void 0!==t.services&&(e+="&zsoid="+editor.doc.docInfo.OWNER_ZUID),e},d=function(e){var t=document.createElement("span");return t.id="docTextSpan",t.innerText=e,t.style.color="#000",t.outerHTML},c=function(e,t,n,o){J("#cldresponse").hide(),J("#cldimportstatus1,#cldimportstatus2").empty();var r=d(e);J("#cldprogressloading").removeClass("ui-progress-loading").addClass("ui-import-notify-failure");var a=J.i18n("writer.cloudpicker.DOCUMENT_IMPORT_FAILURE_MESSAGE",[r]);if("success"===t){J("#cldprogressloading").removeClass("ui-import-notify-failure").addClass("ui-import-notify-success"),a=J.i18n("writer.cloudpicker.DOCUMENT_IMPORT_SUCCESS_MESSAGE",[r]);var s=window.location.protocol+"//"+editorProps.urls.serverurl+"/open/"+o;J("#cldopen").attr("data-document-url",s),J("#cldresponse").show(),i&&i.success&&i.success(o,e)}J("#cldimportstatus2").html(a),i=void 0},u=function(t){r(),e=t,FetchHTML.get({requestName:"cloudpickernotify",target:"#document-wrapper",callback:function(){J("#cldimportstatus2").empty(),J("#cldresponse").hide();var t=d(e.cloudpicker_docname);J("#cldimportstatus1").html(J.i18n("writer.cloudpicker.IMPORTING",[t])),J("#cldimportstatus2").text(" ..."),J("#cldprogressloading").removeClass("ui-progress-loading ui-import-notify-success ui-import-notify-failure").addClass("ui-progress-loading"),J("#cldprogressloading, #cloudpickernotify").show()}});var i={};i.cloudpicker_document=JSON.stringify(t),i.rid=editor.doc.docInfo.RID,i.from=Macros.getAppType(),"googleTD"===t.cloudpicker_service?w_usersettings.cloudupload_recent="gdrive":"office365"===t.cloudpicker_service?w_usersettings.cloudupload_recent="skydrive":w_usersettings.cloudupload_recent=t.cloudpicker_service,J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix("cloudpicker")+"/download",data:i,async:!0,success:function(e){UIUtils.hideMessage(),c(e.cloudpicker_docname,e.status,e.cloudpicker_service,e.cloudpicker_resourceid)},error:function(e){c(e.responseJSON.cloudpicker_docname,e.responseJSON.status,e.responseJSON.cloudpicker_service,null)},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})};return{downloadDocFromCloud:u,openCloudPickerDialog:o,closeCloudPickerDialog:r}}();!function(){var e=!1,t=!1,i=function(i,n){var o,r={};if(t=!!i,!e){o=ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/meta?from=editor"),J("#draft-btn").addClass("ui-disabled-elem");var a={state:"mark_as_complete"};r.operations=JSON.stringify(a),e=!0,J.ajax({url:o,data:r,type:"POST",dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t,o,r){if(e=!1,i){var a=Utils.getAsFunction(i);a.callable(n)}DocInfo.setProperty({state:"active"}),MarkAsReady.wmsMsgHandler(),ZWLogger.addToStatistics("MarkAsReady"),PubSub.publish("Document/Workflow/MarkedReady",t.workflow)},error:function(t){var i=t.responseJSON||{},n=(i.error||{}).errorcode;"R3035"===n?(DocInfo.setProperty({state:"active"}),PubSub.publish("Document/MarkedReady")):(MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,J.i18n("writer.error.OOPS"),J.i18n("writer.common.MARK_AS_READY_FAILURE_MSG")),e=!1,J("#draft-btn").removeClass("ui-disabled-elem"))}})}},n=function(e){var i=e||{};editor.doc.docInfo.state;"CREATE"===i.OPERATION&&"4"==i.STATUS?DocInfo.setProperty({state:"draft"}):"MARK_AS_COMPLETE"===i.OPERATION&&(DocInfo.setProperty({state:"active"}),PubSub.publish("Document/Update/Permission"),J(".ui.dimmer").is(":visible")||J("#wd-loading-div").is(":visible")||t||MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_SUCCESS,J.i18n("writer.common.DOCUMENT_MARKED_AS_READY"),J.i18n("writer.common.MARK_AS_READY_SUCCESS_MSG"),null,!0))};window.MarkAsReady={markComplete:i,wmsMsgHandler:n}}(),function(){var e=!1,t=function(){var e,t={};if(TcManager.docHasTrackedChanges())return void MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_INFO,J.i18n("writer.common.FINAL_TRACK_CHNAGES_TITLE_MSG"),J.i18n("writer.common.FINAL_TRACK_CHNAGES_PENDING"));e="LOGIN"==editor.type?ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/meta?from=editor"):ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/meta/external?from=editor");var i={mark_as_final:!0};t.operations=JSON.stringify(i),t.sid=editor.uuid,J("#complete-tb-markasfinal").disable(),J.ajax({url:e,data:t,type:"POST",dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e,t,i){editor.doc.getSelection().collapseToStart(),PubSub.publish("QuickSeek/hideAllBar"),J("#complete-tb-markasfinal").enable(),ZWLogger.addToStatistics("MarkAsFinal"),o(e.FINAL_INFO),d(),MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_SUCCESS,J.i18n("writer.common.FINAL_SUCCESS_OWNER_TITLE_MSG"),J.i18n("writer.common.FINAL_SUCCESS_OWNER_MSG"))},error:function(e){var t=e.responseJSON||{},i=t.error.errorcode;"R5010"==i?MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,J.i18n("writer.error.OOPS"),J.i18n("writer.common.UNAUTHORIZED_MSG")):MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,J.i18n("writer.error.OOPS"),J.i18n("writer.common.MARK_AS_FINAL_FAILURE")),J("#complete-tb-markasfinal").enable()}})},i=function(){if(!e){var t=function(t,i,n){e=!1,CurUtil.blinkCursor(),o(t.FINAL_INFO),d(),Notification.hide(),MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_SUCCESS,J.i18n("writer.common.REVERT_FINAL_SUCCESS_TITLE_MSG"),J.i18n("writer.common.REVERT_FINAL_SUCCESS_OWNER_MSG"))},i=function(t){var i=t.responseJSON||{};e=!1,Notification.hide();var n=i.error.errorcode;"R5010"==n?MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,J.i18n("writer.error.OOPS"),J.i18n("writer.common.writer.common.UNAUTHORIZED_MSG")):MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,J.i18n("writer.error.OOPS"),J.i18n("writer.common.MARK_AS_FINAL_FAILURE"))};e=!0,n(t,i)}},n=function(e,t){var i,n={},o={mark_as_final:!1};n.operations=JSON.stringify(o),n.sid=editor.uuid,i="LOGIN"==editor.type?ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/meta?from=editor"):ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/meta/external?from=editor"),J.ajax({url:i,data:n,type:"POST",dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:e,error:t})},o=function(e,t){DocInfo.setProperty({FINAL_INFO:e}),PubSub.publish("Document/FinalStateUpdated",t)},r=function(){var e=editor.doc.docInfo.FINAL_INFO||{};if(!J.isEmptyObject(e)){if(e.STATUS)DomViewManager.renderAllPages(),CurUtil.setCursorVisiblity(!1),LayoutManager.isRichEditActive()&&LayoutManager.toggleRichEdit(),ModeManager.getCurrentMode()!=LAYOUTS.COMPLETE&&ModeManager.updateModeInUI(LAYOUTS.COMPLETE),f();else{var t=editor.doc.docInfo;(!t.CHECKEDOUT||t.CHECKEDOUT&&t.CHECKEDOUTBY_ZUID==editor.zuid)&&editor.rebindEvents()}a()}},a=function(){var e=editor.isFinalDocument(),t=J("#complete-tb");e&&(J("#btn-edit-container").attr({title:J.i18n("writer.common.MARK_AS_FINAL_TOOLTIP",[u()])}),s()?t.find("#txt-marked-final").removeClass("ui-top-margin-medium"):t.find("#txt-marked-final").addClass("ui-top-margin-medium"))},s=function(){return editor.getRole().permissions.can("document.markfinal")},l=function(e,t){var i,n,r,a=editor.doc.docInfo,s=a.FINAL_INFO||{};e.STATUS!=s.STATUS&&a.WRITE_PERMISSION&&(o(e,t),e.STATUS?editor.zuid==e.zuid?(r=CONST.SEVERITY_SUCCESS,i="writer.common.FINAL_SUCCESS_OWNER_TITLE_MSG",n=J.i18n("writer.common.FINAL_SUCCESS_OWNER_MSG")):(r=CONST.SEVERITY_INFO,i="writer.common.FINAL_SUCCESS_OWNER_TITLE_MSG",n=J.i18n("writer.common.FINAL_SUCCESS_WMS_MSG",[u()])):(r=CONST.SEVERITY_INFO,i="writer.common.REVERT_FINAL_SUCCESS_TITLE_MSG",n=editor.zuid==e.zuid?J.i18n("writer.common.REVERT_FINAL_SUCCESS_OWNER_MSG"):J.i18n("writer.common.REVERT_FINAL_SUCCESS_WMS_MSG",[u()])),Notification.hide(),d(),MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,r,J.i18n(i),n))},d=function(){if(r(),editor.isFinalDocument()){var e={},t=editor.doc.docInfo,i={close:!0,setTimer:!1},n=t.FINAL_INFO,o=n.display_name||u();e.key="writer.common.MARK_AS_FINALE_BANNER",e.args=[o],i.message=e,s()&&(i.callback=MarkAsFinal.revertFinal,i.btnText="writer.common.ENABLE_EDITING"),Notification.show(i)}},c=function(){var e=editor.doc.docInfo,t=editor.doc.getUserData()||{},i=e.FINAL_INFO||{},n=t[i.zuid]||{};return n},u=function(){var e=c();return e.fname?p(e.fname):"Guest"},p=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},g=function(e,t){if(!U.isEmpty(e)){l(e,t);var i=editor.doc.docInfo;PubSub.publish("Document/SaveStatus",!0,void 0,i.LASTMODIFIEDBY_ZUID,i.LAST_MODIFIED_TIME_LONG)}},f=function(){if(editor.isFinalDocument()){var e=ZWJSONUtils.clone(MARKASFINAL_PERMISSION);editor.getRole().permissions.can("document.markfinal")&&e.push("document.markfinal"),editor.rebindEvents(e)}};window.MarkAsFinal={makeFinal:t,revertFinal:i,checkForEdit:d,wmsMsgHandler:l,updateFinalState:r,isUserAllowedToEnableEditing:s,updateMarkAsFinalPermissions:f},PubSub.subscribe("Document/FinalStateModified",g)}(),ListSort=function(){return sortList=function(e,t,i,n){var o=ListUtils.getListSection(e),r=o.lists[e],a=editor.doc.getSelection(),s=a.getTargetRange().start,l=a.getParents(NODE_TYPE.PARAGRAPH),d=l.attr(ATTR_PARAGRAPH.LS_DATA),c=d.l,u=i||SORT_TYPES.TEXT,p=t?"ASC":"DESC";if(ZWLogger.addToStatistics("SORT_"+u+"_"+p),getListElemsToSort=function(){for(var e=U.findIndex(r,function(e){return e==l.dtNode}),t=[],i=e-1;i>=0;i--){var n=r[i],o=n.paraProperties.listData.listLevel;if(!(o>=c))break;t.push(n)}t.reverse();for(var a=[],i=e+1,s=r.length;i<s;i++){var n=r[i],o=n.paraProperties.listData.listLevel;if(!(o>=c))break;a.push(n)}t.push(l.dtNode),resultParas=t.concat(a);for(var i=0;resultParas.length>0;){var n=resultParas[i],o=n.paraProperties.listData.listLevel;if(!(o>c))break;resultParas.shift(),i++}return resultParas},resultParas=getListElemsToSort(),isListSortable=function(e){for(var t=!0,i=0,n=resultParas.length-1;i<n;i++)if(resultParas[i].next!=resultParas[i+1]){t=!1;break}return t},!isListSortable(e))return!1;var g=function(e){var t=[e[0]];group=[t];for(var i=1,n=e.length;i<n;i++){var o=e[i],r=o.paraProperties.listData.listLevel;r>c?t.push(o):(t=[o],group.push(t))}return group},f=function(e){return e[0].content().toLowerCase().replace("​","").trim()},E=function(e,t,i){var n=e[t];e[t]=e[i],e[i]=n},T=function(e,t,i,n){var o,r=segregateGroupBasedOnType(e,t,n),a=r.reqdParas,s=a.length;e=r.reqdParas.concat(r.otherParas);for(var l=0;l<s;l++){for(var o=l,d=l+1;d<s;d++){var c=f(e[d]),u=f(e[o]);if(t===SORT_TYPES.DATE){var p=new ZWDateTime(c,n,null,null,!0),g=new ZWDateTime(u,n,null,null,!0);i?p.diff(g)<0&&(o=d):p.diff(g)>0&&(o=d)}else t===SORT_TYPES.NUMBER?i?parseFloat(c)<parseFloat(u)&&(o=d):parseFloat(c)>parseFloat(u)&&(o=d):t===SORT_TYPES.TEXT&&(i?c.localeCompare(u)<0&&(o=d):c.localeCompare(u)>0&&(o=d))}l!=o&&E(e,l,o)}return e};segregateGroupBasedOnType=function(e,t,i){for(var n,o,r=[],a=[],s=0,l=e.length;s<l;s++)if(n=group[s],o=f(n),t===SORT_TYPES.DATE){var d=new ZWDateTime(o,i,null,null,!0);isNaN(o)&&isNaN(d._originalUTC)?r.push(n):a.push(n)}else if(t===SORT_TYPES.NUMBER)isNaN(o)?a.push(n):r.push(n);else if(t===SORT_TYPES.TEXT)isNaN(o)?r.push(n):a.push(n);else if(t===SORT_TYPES.CHECKED){var c=n[0].getParaStyles(),u=getCheckListState(c);"unchecked"===u?r.push(n):a.push(n)}return e=r.concat(a),{reqdParas:r,otherParas:a}},getCheckListState=function(e){var t;return PubSub.publish("CheckListOperations/getCheckListState",{style:e,callback:function(e){t=e}}),t};for(var m=g(resultParas),h=T(m,u,t,n),I=[],_=[],A=function(e){editor.doc.getParents(NODE_TYPE.PARAGRAPH,e.getIndex()).remove();var t=Op.msgBuffer[0];I.push(t),Op.msgBuffer=[];var i=editor.doc.snapShotManager.getReverseOp(t);i.shift(),_=_.concat(i)},S=0,R=h.length;S<R;S++)U.each(h[S],A);for(var O=function(e){editor.doc.getParents(NODE_TYPE.PARAGRAPH,e.getIndex()).remove()},S=0,R=m.length;S<R;S++)U.each(m[S],O);var b=resultParas[0].getIndex();_=[{r:b}].concat(_),Op.processMsg(_),a.removeAllRanges().showCaret(editor.doc.createRange(s))},updateMenu=function(){},{sortList:sortList,updateMenu:updateMenu}}(),ParaSort=function(){"use strict";var e,t,i,n={},o=function(n,o,r){t=editor.doc.getSelection(),i=t.getTargetRange().start;for(var a=s(o,n,r),l=[],d=function(e){var t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e.getIndex()),i=[{r:t.getStart()},{ds:editor.doc.getContent(t.getStart(),t.getEnd())}];i=DocOpBuilder.build(i);var n=editor.doc.snapShotManager.getReverseOp(i);n.shift(),l=l.concat(n)},c=0,u=a.length;c<u;c++)d(a[c]);for(var p=function(e){var t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e.getIndex()),i=[{r:t.getStart()},{ds:editor.doc.getContent(t.getStart(),t.getEnd())}];Op.processMsg(i)},c=0,u=e.length;c<u;c++)p(e[c]);var g=e[0].getIndex(),f=Utils.randomString();l=[{r:g},{as:{start:{type:"cursor",uuid:editor.uuid},id:f}},{r:0},{as:{end:["type","uuid"],id:f}}].concat(l),Op.processMsg(l),Op.cursorProcessed()},r=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.PARAGRAPH),i=t.attr(ATTR_PARAGRAPH.PS_HD)?t.attr(ATTR_PARAGRAPH.PS_HD):0,n=DocTreeManager.getSectionAtIndex(e.getStart()),o=DocTreeManager.getSectionAtIndex(e.getEnd()-1);return!(e.isMultipleSelection||e.isCollapsed()||DocTreeManager.doc.getNodesBetweenIndex(NODE_TYPE.TABLE,e.getStart(),e.getEnd()).length||ZWCode.isCodePara()||DocTreeManager.doc.getNodesBetweenIndex(NODE_TYPE.TOC,e.getStart(),e.getEnd()).length||DocTreeManager.doc.getNodesBetweenIndex(NODE_TYPE.HR,e.getStart(),e.getEnd()).length||103==i||n.id!=o.id)},a=function(e,t,i){var n=e[t];e[t]=e[i],e[i]=n},s=function(i,n,o){e=t.getNodesInSelection(NODE_TYPE.PARAGRAPH);var r=[];U.each(e,function(e){r.push(e.dtNode)}),e=r;for(var s=d(e,i,o),c=s.reqdParas.concat(s.otherParas),u=0,p=c.length;u<p;u++){for(var g=u,f=u+1;f<p;f++){var E=l(c[f]),T=l(c[g]);if(i===SORT_TYPES.DATE){var m=new ZWDateTime(E,o,null,null,!0),h=new ZWDateTime(T,o,null,null,!0);n?m.diff(h)<0&&(g=f):m.diff(h)>0&&(g=f)}else i===SORT_TYPES.NUMBER?n?parseFloat(E)<parseFloat(T)&&(g=f):parseFloat(E)>parseFloat(T)&&(g=f):i===SORT_TYPES.TEXT&&(n?E.localeCompare(T)<0&&(g=f):E.localeCompare(T)>0&&(g=f))}u!=g&&a(c,u,g)}return c},l=function(e){return e.content().toLowerCase().replace("​","").trim()},d=function(e,t,i){for(var n,o,r=[],a=[],s=0,d=e.length;s<d;s++)if(n=e[s],o=l(n),t===SORT_TYPES.DATE){var c=new ZWDateTime(o,i,null,null,!0);isNaN(o)&&isNaN(c._originalUTC)?r.push(n):a.push(n)}else if(t===SORT_TYPES.NUMBER)isNaN(o)?a.push(n):r.push(n);else if(t===SORT_TYPES.TEXT)isNaN(o)?r.push(n):a.push(n);else if(t===SORT_TYPES.CHECKED){var u=n[0].getParaStyles(),p=getCheckListState(u);"unchecked"===p?r.push(n):a.push(n)}return e=r.concat(a),{reqdParas:r,otherParas:a}},c={init:function(){J("#apply-sort").zbutton("disable")},get:function(){},set:function(e,t){"custom_input_format"==e.action&&(n.format=t),"string"==typeof n.format&&n.format.length>0?J("#apply-sort").zbutton("enable"):J("#apply-sort").zbutton("disable")}},u=function(e){n.type=e,J.dialogutil.open("listparasortdialog",null,c)},p=function(){n={},J.dialogutil.close("listparasortdialog")},g=function(){"Ascending"===n.type?editor.doc.execCmd("sortDatesAscendingly",n.format):editor.doc.execCmd("sortDatesDescendingly",n.format),p()},f=function(){var e=J("#list-para-sort-by-custom-date-format")[0].value;e.length?J("#apply-sort").zbutton("enable"):J("#apply-sort").zbutton("disable")};return{sort:o,isSortable:r,openPopup:u,apply:g,close:p,validateInput:f}}(),CheckListOperations=function(){"use strict";var e=function(e){var t=editor.doc.createElement(NODE_TYPE.PARAGRAPH,e);return t.setStart(e.getIndex()),t.setEnd(e.getEndIndex()+1),t},t=function(t,i){var n,o=e(t),r=o.attr();if(c({style:r,callback:function(e){n=e}}),i!==n){var a=d(),s=a[i];r[ATTR_PARAGRAPH.LS_DATA].bullet_id=s,o.attr(r)}},i=function(e,i){var n=DocTreeManager.doc.getSection(editor.doc.getSelection().getStart()).lists[e];U.each(n,function(e){t(e,i)})},n=function(){var e=s();if(e){var t=editor.doc.getSelection(),n=t.getTargetRange().start;ZWLogger.addToStatistics("check All"),i(e,CHECKLIST_STATES.CHECKED),t.removeAllRanges().showCaret(editor.doc.createRange(n))}},o=function(){var e=s();if(e){ZWLogger.addToStatistics("uncheck All");var t=editor.doc.getSelection(),n=t.getTargetRange().start;i(e,CHECKLIST_STATES.UNCHECKED),t.removeAllRanges().showCaret(editor.doc.createRange(n))}},r=function(e,i){if(l()){var n=editor.doc.getSelection(),o=n.getTargetRange().start;ZWLogger.addToStatistics("chkList Toggling");var r,a;c({callback:function(e){r=e}}),a=f(r);var n=(i[ATTR_PARAGRAPH.LS_DATA].l,editor.doc.getSelection()),s=(e||n.getParents(NODE_TYPE.PARAGRAPH).dtNode,_(i[ATTR_PARAGRAPH.LS_DATA].id));U.each(s,function(e){t(e,a)}),n.removeAllRanges().showCaret(editor.doc.createRange(o))}},a=function(){var e=s();if(e){ZWLogger.addToStatistics("remove Chkd");for(var t,i,n,o,r,a=editor.doc.getSelection(),l=a.getTargetRange().start,c=DocTreeManager.doc.getSection(a.getStart()).lists[e],g=c.length,f=0;f<g;f++)r=c[f],o=r.getParaStyles(),t=d(o),i=u(o),n=p(o),i===n&&editor.doc.getParents(NODE_TYPE.PARAGRAPH,r.start).remove();a.removeAllRanges().showCaret(editor.doc.createRange(l))}},s=function(e){var t=editor.doc.getSelection(),i=e||t.getParaFormat();return l()&&i.ls_data?i.ls_data.id:null},l=function(e){var t=editor.doc.getSelection(),i=e||t.getParaFormat(),n=i[ATTR_PARAGRAPH.LS_DATA],o=editor.doc.getListObj(n.id),r=o&&o["level"+n.l];return!(!n||editor.doc.getListType(n.id,n.l)!==LIST_TYPE.IMAGE&&n.t!==LIST_TYPE.IMAGE||!r.hasOwnProperty("data-custom_data"))},d=function(e){var t=editor.doc.getSelection(),i=e||t.getParaFormat();if(l(i)){var n=i[ATTR_PARAGRAPH.LS_DATA],o=n.id,r=n.l,a=(n.t||editor.doc.getListType(o,r),editor.doc.getListObj(o)),s=a["level"+r],d=s[ATTR_PARAGRAPH.CUST_DATA];return d}return null},c=function(e){var t=editor.doc.getSelection(),i=e&&e.style||t.getParaFormat(),n=-1;if(l(i)){var o=u(i),r=i[ATTR_PARAGRAPH.LS_DATA],a=r.id,s=r.l,d=editor.doc.getListObj(a),c=d["level"+s],p=c[ATTR_PARAGRAPH.CUST_DATA],g=U.invert(p);n=g&&g[o]||CHECKLIST_STATES.UNCHECKED}e.callback(n)},u=function(e){var t=editor.doc.getSelection(),i=e||t.getParaFormat();if(l(i)){var n=i[ATTR_PARAGRAPH.LS_DATA],o=n.id,r=n.l,a=(n.t||editor.doc.getListType(o,r),editor.doc.getListObj(o)),s=n.bullet_id;if(!s){var a=editor.doc.getListObj(n.id),d=a&&a["level"+n.l];s=d[ATTR_PARAGRAPH.CUST_DATA].unchecked}return s}return-1},p=function(e){var t=editor.doc.getSelection(),i=e||t.getParaFormat();if(l(i)){var n=d(i);return n&&n.checked||-1}return-1},g=function(e){var t=editor.doc.getSelection(),i=e&&e.style||t.getParaFormat(),n=-1;if(l(i)){var o=d(i);n=o&&o.unchecked||-1}e.callback(n)},f=function(e){return e===CHECKLIST_STATES.CHECKED?CHECKLIST_STATES.UNCHECKED:e===CHECKLIST_STATES.UNCHECKED?CHECKLIST_STATES.CHECKED:null},E=function(e){if(e){var t={};editor.doc.getSelection();ZWLogger.addToStatistics("CHK_LIST_"+e),t.checkedData=CHECKLIST_TYPE[e].checked,t.uncheckedData=CHECKLIST_TYPE[e].unchecked,h(t)}},T=function(e){h(e)},m=function(e){var t;return c({style:e,callback:function(e){t=e}}),t===CHECKLIST_STATES.CHECKED?"☑":t===CHECKLIST_STATES.UNCHECKED?"◻":void 0},h=function(e){if(!U.isEmpty(e)&&e&&e.uncheckedData&&e.checkedData&&!U.isEmpty(e.checkedData)&&!U.isEmpty(e.uncheckedData)){var t=LIST_TYPE.IMAGE,i={};ListUtils.fillListProps(i,{t:t,l:0,id:editor.doc.getNewListId()});var n,o,r=editor.doc.getSelection(),a=r.getParaFormat(),s=!1;if(a&&a.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)&&l(a)){o=a.ls_data.id,n=editor.doc.getListObj(o);var d;g({style:a,callback:function(e){d=e}});var c=editor.doc.getListBulletObj(d).svg_id;if(c===e.uncheckedData.svg_id)return;i=a,i.ls_data.l=0,s=!0}else o=i.ls_data.id;var u,p,f=(i.ls_data.l,ListUtils.getListCategory(t)),E=editor.doc.getNewDocumentBulletId();u=E,p=E+1;var T={chkListData:e,format:i,listObj:n,type:t,listCategory:f,isUpdateCheckList:s};if(e.checkedData.hasOwnProperty("svg_id")){var m=e.uncheckedData.svg_id,h=e.checkedData.svg_id,I=document.location.origin+"/writer/"+SVG_FOR_LISTS[m].png;"undefined"!=typeof ListUtils.getSVGImgIds(m)?(u=ListUtils.getSVGImgIds(m),"undefined"!=typeof ListUtils.getSVGImgIds(h)?(p=ListUtils.getSVGImgIds(h),T.unchkdBulletId=u,T.chkdBulletId=p,ListOperation.applyCheckList(T)):(T.unchkdBulletId=u,T.chkdBulletId=p,I=document.location.origin+"/writer/"+SVG_FOR_LISTS[h].png,ListUtils.loadContextualImgFromPng(I,e.checkedData,function(e){e?ListOperation.applyCheckList(T):UIUtils.showListFailedMsg()}))):(T.unchkdBulletId=u,T.chkdBulletId=p,ListUtils.loadContextualImgFromPng(I,e.uncheckedData,function(t){t?(I=document.location.origin+"/writer/"+SVG_FOR_LISTS[h].png,ListUtils.loadContextualImgFromPng(I,e.checkedData,function(e){e?ListOperation.applyCheckList(T):UIUtils.showListFailedMsg()})):UIUtils.showListFailedMsg()}))}else{var _={img:e.checkedData},A={img:e.uncheckedData};T.chkdBulletId=p,T.unchkdBulletId=u,e.checkedData=_,e.uncheckedData=A,ListOperation.applyCheckList(T)}}},I=function(t){for(var i=editor.doc.getSelection(),n=i.getTargetRange(),o=n.start,r=DocTreeManager.doc.getSection(o),a=r.lists[t],s=[],l=0,d=a.length;l<d;l++)s[l]=e(a[l]);return s},_=function(e){var t=ListUtils.getListSection(e),i=t.lists[e],n=editor.doc.getSelection(),o=n.getParents(NODE_TYPE.PARAGRAPH),r=o.attr(ATTR_PARAGRAPH.LS_DATA),a=r.l,s=U.findIndex(i,function(e){return e==o.dtNode}),l=A(i,a);return S(l,s)},A=function(e,t){var i=[e[0]],n=[i];t||(t=0);for(var o=1,r=e.length;o<r;o++){var a=e[o],s=a.paraProperties.listData.listLevel;s>t?i.push(a):(i=[a],n.push(i))}return n},S=function(e,t){for(var i,n=0,o=0,r=e.length;o<r;o++){if(i=e[o],n==t||t<n)return i;n+=i.length}};return PubSub.subscribe("CheckListOperations/checkAll",n),PubSub.subscribe("CheckListOperations/uncheckAll",o),PubSub.subscribe("CheckListOperations/toggleCurrentItem",r),PubSub.subscribe("CheckListOperations/removeChecked",a),PubSub.subscribe("CheckListOperations/getCheckedBulletId",p),PubSub.subscribe("CheckListOperations/getUnCheckedBulletId",g),PubSub.subscribe("CheckListOperations/makeCheckList",E),PubSub.subscribe("CheckListOperations/getCheckListState",c),PubSub.subscribe("CheckListOperations/makeCustomCheckList",T),{isCheckList:l,getCheckListChar:m,getCheckListState:c,getAllCheckListParasOfID:I}}(),Copy=function(){"use strict";var e=(editor.doc.getSelection(),function(e,t,i){for(var n=[],o=DocLayoutManager.getViews(e),r=e.start,a=0,s=o.length;a<s;a++){var l=o[a],d=l.nodeLines;if(!t)return n;for(var c=0,u=d.length;c<u;c++){var p=d[c].segments;if(!(t>r+p[p.length-1].end))if(i>r+p[p.length-1].end)n.push(d[c]);else if(i<=r+p[p.length-1].end){n.push(d[c]);break}}}return n}),t=function(e,t,i,n,o){var r=e.start,a=t.segments[i],s=DomViewManager.getDOMElem(t),l=s.children[0].children[i],d=l.cloneNode(!0);if(!n)return d;if(r+a.start>o||r+a.end<=n)return"";var c=d.textContent;return c.length>0&&(r+a.start>n||r+a.end<o)&&(c=c.substring(n-(r+a.start),o-(r+a.start)),d.textContent=c),d},i=function(e,t){var i=editor.doc.getRawFormatAt(t),n=i.type;J(e).attr("data-format",JSON.stringify()),n!=NODE_TYPE.PARAGRAPH&&n!=NODE_TYPE.TEXT||J(e).attr("data-computed-format",JSON.stringify(editor.doc.getComputedFormatAt(t,n)))},n=function(n,o,r){var a,s=(DocLayoutManager.getViews(n),e(n,o,r)),l=n.start,d=n.end;(d>=o||d<=r)&&(a=document.createElement("p"),i(a,l)),a||(a=document.createDocumentFragment());for(var c=0,u=s.length;c<u;c++)for(var p=s[c].segments,g=0,f=p.length;g<f;g++){var E=t(n,s[c],g,o,r);a.appendChild(E),i(E,l+p[g].start)}return a},o=function(e){var t=function(t){var i=DomUtil.createBR();e.insertBefore(i,t),J(t).remove()},i=function(e){J(e).removeClass("tab zeroSize").addClass("Apple-tab-span").removeAttr("style").empty()},n=function(e){var t=document.createElement("a"),i=J(e),n=i.attr("data-href"),o=parseInt(i.attr("data-type"));J(t).attr({href:o===LINK_TYPES.BOOKMARK?location.href+"#bookmark="+n:n,"data-href":n,"data-type":o}).append(e.children),J(e).remove()},o=function(e){var t=e.getAttribute(e);if(t&&(0===t.indexOf("image.do")||0===t.indexOf("remoteImage.do"))){var i=document.createElement("img");i.src=ZWNetworkUtils.getContextUrl(t);var n=document.getElementById("copyImage");n.width=i.naturalWidth,n.height=i.naturalHeight;var o=n.getContext("2d");o.drawImage(i,0,0);var r=n.toDataURL("image/png");e.src=r}},r=J(e),a=r.find("span.zw-br-portion");U.each(a,t);var s=r.find("span.tab");U.each(s,i);var l=r.find("span.link");U.each(l,n);var l=r.find("span.link");U.each(l,n);var d=r.find("img.zw-image");U.each(d,o)},r=function(e,t){if(e===t)return"";var i=DocTreeManager.doc.getNodesBetweenIndex("*",e,t),r=document.createDocumentFragment(),a=i[0],s=n(a,e,t);for(o(s),i.pop(),r.appendChild(s);i.length>1;){var s,l,d=i[0],c=d.type;switch(c){case"para":s=n(d),o(s),l=s;break;case"table":break;case"hr":}r.appendChild(l),i.pop()}if(1==i.length){var u=i[0],s=n(u,e,t);i.pop(),r.appendChild(s)}return r};return{getSelectedHTML:r}}(),HTMLUtil=function(){"use strict";var e=new RegExp("^("+CONT_REGEXP.AUTOFIELD+")$"),t=new RegExp("^("+CONT_REGEXP.AUTOFIELD_USER_FIELD+")$"),i=(new RegExp("^("+NODE_TYPE.BR+"|"+NODE_TYPE.TAB+"|"+NODE_TYPE.TEXT+"|"+NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR+"|"+NODE_TYPE.RUN+"|"+NODE_TYPE.FIELD_START+"|"+NODE_TYPE.FIELD_END+"|"+NODE_TYPE.IMAGE+")$"),["a","abbr","acronym","b","bdo","big","br","cite","code","dfn","em","i","input","kbd","label","q","samp","select","small","span","strong","sub","sup","textarea","tt","var","#text","img","map","object","font","aside","comment"]),n=["table","hr","p","div","center","li","ol","ul","blockquote","h1","h2","h3","h4","h5","h6","address","pre","dl","td","th","tr"],o={TOC_TYPE_1:128,NONE:255,DECIMAL:0,LOWER_ALPHA:4,UPPER_ALPHA:3,LOWER_ROMAN:2,UPPER_ROMAN:1,DISC:6,CIRCLE:7,BOX:8,SYMBOL:9,IMAGE:10,RECENT_ORDER:0,RECENT_UNORDER:6,CHECKLIST:256},r=function(){return window.getComputedStyle?function(e,t){for(var i,n=getComputedStyle(e,null),o={},r=0,a=t.length;r<a;r++)i=t[r],o[i]=n[i];return o}:function(e,t){for(var i,n={},o=0,r=t.length;o<r;o++)i=t[o],n[i]=e.currentStyle[i];return n}}(),a=function(t){var i=t&&t.match(e)||[];return i[0]},s=function(e){var i=e&&e.match(t)||[];return i[0]},l=function(e,t){for(var i=[],n=0,o=e.length;n<o;n++){var r=e[n];t.indexOf(r)!=-1&&i.push(r)}return i},d=function(e){if(i.indexOf(e.nodeName.toLowerCase())!=-1)return"inline";if(n.indexOf(e.nodeName.toLowerCase())!=-1)return"block";var t="inline";try{var o=document.createElement(e.nodeName.toLowerCase()),r="getComputedStyle"in window;document.body.appendChild(o),t=(r?window.getComputedStyle(o,""):o.currentStyle).display,document.body.removeChild(o),"block"==t?n.push(e.nodeName.toLowerCase()):i.push(e.nodeName.toLowerCase())}catch(e){}return t.toLowerCase()},c=function(e,t){var i,n={},o=(editor.doc.docInfo,editor.uuid.replace(/[\/\\_\-%]/gi,"")),r=o+Utils.randomString();n.sid=editor.uuid,n.imgid=r,n.imageURLValue=Macros.getImageURLValue(r),n.img_url=e,i=Macros.getImageSrc(n.imageURLValue);var a=ZWNetworkUtils.getUrl("copyImageFile");return J.ajax({type:"POST",dataType:"json",url:a,data:ZWNetworkUtils.setDefaultParams(n),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){if("object"==typeof t)"function"==typeof t.onSuccess?t.onSuccess(i):void 0;else{var n="success";"success"!=e.validation&&(n="error",UIUtils.showImageFailedMsg()),PubSub.publish("externalImage/uploadStatus",[i,n]),DomUtil.updateImageSrc(i)}},error:function(e,n,o){"object"==typeof t?"function"==typeof t.onError?t.onError(i):void 0:(PubSub.publish("externalImage/uploadStatus",[i,"error"]),DomUtil.updateImageSrc(i),UIUtils.showImageFailedMsg())}}),PubSub.publish("externalImage/uploadStatus",[i,"uploading"]),i},u=function(e,t){var i,n,o=UIUtils.dataURItoBlob(e),r=(editor.doc.docInfo,editor.uuid.replace(/[\/\\_\-%]/gi,"")),a=r+Utils.randomString(),s=new FormData;s.append("imagecontent",o.imageFile),s.append("sid",editor.uuid),s.append("imgid",a),n=Macros.getImageURLValue(a),i=Macros.getImageSrc(n),s.append("imageURLValue",n),t&&s.append("ref_url",t);var l=ZWNetworkUtils.getUrl("copyImageFile");return J.ajax({type:"POST",dataType:"json",url:l,data:s,enctype:"multipart/form-data; "+o.type,contentType:!1,processData:!1,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){var t="success";"success"!=e.validation&&(t="error",UIUtils.showImageFailedMsg()),PubSub.publish("externalImage/uploadStatus",[i,t]),DomUtil.updateImageSrc(i)},error:function(e,t,n){UIUtils.showImageFailedMsg(),PubSub.publish("externalImage/uploadStatus",[i,"error"]);var o=ImageCache.getURIForImgURL(i);if(o){var r=editor.editorPaneContainer.find("image");U.each(r,function(e){var t=e.getAttribute("xlink:href");t==o&&e.setAttribute("xlink:href",i)})}else DomUtil.updateImageSrc(i)}}),PubSub.publish("externalImage/uploadStatus",[i,"uploading",o,e]),i},p=function(e,t,i){var n,o,r=ZWNetworkUtils.getUrl("uploadImageFile"),a=UIUtils.dataURItoBlob(e),s=(editor.doc.docInfo,editor.uuid.replace(/[\/\\_\-%]/gi,""));t||(t=s+Utils.randomString());var l=new FormData;return l.append("imagefile",a.imageFile),l.append("sid",editor.uuid),l.append("imgid",t),o=Macros.getImageURLValue(t),n=Macros.getImageSrc(o),l.append("imageURLValue",o),J.ajax({type:"POST",dataType:"json",url:r,data:l,enctype:"multipart/form-data; "+a.type,contentType:!1,processData:!1,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){"success"!=e.validation?"object"==typeof i&&"function"==typeof i.onError?i.onError():void 0:"object"==typeof i&&"function"==typeof i.onSuccess?i.onSuccess():void 0,PubSub.publish("externalImage/uploadStatus",[n,"success"]),DomUtil.updateImageSrc(n)},error:function(e,t,o){"object"==typeof i&&"function"==typeof i.onError?i.onError():void 0,PubSub.publish("externalImage/uploadStatus",[n,"error"]),DomUtil.updateImageSrc(n)}}),PubSub.publish("externalImage/uploadStatus",[n,"uploading"]),n},g=function(e){return"block"==d(e)},f=function(e){return"inline"==d(e)},E=function(e){for(var t=e.dataset,i={},n=Object.keys(t),o=n.length,r=0;r<o;r++){var a=t[n[r]];i[n[r]]=ZWJSONUtils.isJSON(a)?JSON.parse(a):a}return i},T=function(e,t){if(t=Array.isArray(t)?t.join("|"):t,!e||!t)return!1;if(t.indexOf("*")!=-1)return!0;var i=t.split("|");return i.indexOf(e.nodeName.toLowerCase())!=-1},m=function(e,t){var i=e.parentNode,n=i.getAttribute("id");if(T(e,"body"))return null;do{if(T(i,"body"),n&&t.indexOf(n)!=-1)return n;i=i.parentNode,n=i.getAttribute("id")}while(i)},h=function(e,t){var i=[],n=e.parentNode;if(T(e,"body"))return i;do{if(T(n,"body"))break;T(n,t)&&i.push(n),n=n.parentNode}while(n);return i},I=function(e,t){var i=[],n=e.parentNode;if(DomUtil.nodeNameEquals(e,"body"))return i;do{if(DomUtil.nodeNameEquals(n,t)||DomUtil.nodeNameEquals(n,"body"))break;i.push(n),n=n.parentNode}while(n);return i},_=function(e){var t=e.parentNode;do{if(t&&g(t))break;t=t.parentNode}while(t);return t},A=function(e,t){t=Array.isArray(t)?t.join("|"):t;for(var i=e.parentNode,n=null;i;){if(DomUtil.nodeNameEquals(i,t)){n=i;break}i=i.parentNode}return n},S=function(e){return e.indexOf("image.do")!=-1||e.indexOf("remoteImage.do")!=-1},R=function(e){return e.indexOf("data:image")!=-1&&e.indexOf("base64")!=-1},O=function(e){var t=/^((http|https|www\.)(:\/\/|)[\w-]+(\.[\w-]+)+([\w.,@?^=\(\)%&amp;:\/~+#-]*[\w@?^\(\)=%&amp;\/~+#-])?)$/;return!!S(e)||!(!e||e.indexOf("data:,")!=-1||e.indexOf("file://")!=-1||null==e||!t.test(e))},b=function(e){var t=Array.prototype.slice.call(e.parentElement.children);return t.indexOf(e)},v=function(e){e.parentNode&&e.parentNode.removeChild(e)},D=function(e){for(;e.firstChild;)e.removeChild(e.lastChild)},L=function(e,t){for(var i in t)e.setAttribute(i,t[i])},N=function(e){var t=r(e,["borderLeftWidth","borderRightWidth"]),i=e.offsetWidth,n=t.borderLeftWidth.convertor().pixels,o=t.borderRightWidth.convertor().pixels;return isNaN(i-n-o)?i:i-n-o},P=function(e,t){(!t.nextSibling||t.nextSibling&&t.nextSibling!=e)&&t.parentNode.insertBefore(e,t.nextSibling)},C=function(e,t){(!t.previousSibling||t.previousSibling&&t.previousSibling!=e)&&t.parentNode.insertBefore(e,t)},y=function(e,t){t.insertBefore(e,t.firstChild)},F=function(e){var t,i,n,o,r;t=G(e,"td,th"),i=t.length;for(var a=0;a<i;a++)if(n=t[a],o=parseInt(n.getAttribute("colspan")||1),o>1)for(var s=0;s<o-1;s++)r=H("hmp"),P(r,n)},M=function(e){return JSON.parse(e.getAttribute("data-rowfix")||"[]")},w=function(e){e.removeAttribute("data-rowfix")},x=function(e,t){var i=M(e);i=i.concat(t),e.setAttribute("data-rowfix",JSON.stringify(i))},B=function(e){var t=M(e),i=t.length;if(0!=i){w(e),t.sort(function(e,t){return e.idx-t.idx});for(var n,o,r,a,s,l,d,c=0;c<i;c++){r=t[c],a=r.idx,s=r.vmp,l=r.hmp,n=G(e,"td,th"),o=n[a];for(var u=0;u<s;u++)d=H("vmp"),o?C(d,o):e.appendChild(d);for(var p=0;p<l;p++)d=H("hmp"),o?C(d,o):e.appendChild(d)}}},H=function(e){var t=HTMLPreProcessor.getDummyNode("td"),i=HTMLPreProcessor.getDummyNode("p");return i.appendChild(document.createElement("br")),t.appendChild(i),e&&(L(t,{merge:e}),t.style.display="none"),t},G=function(e,t){var i=new Array,n=T(e,"table")?e:A(e,"table");return e.querySelectorAll(t).forEach(function(e){A(e,"table")==n&&i.push(e)}),i},k=function(e){for(var t,i,n,o,r,a,s,l=G(e,"tr"),d=l.length,c=0;c<d;c++){t=l[c],F(t),B(t),i=G(t,"td,th"),n=i.length;for(var u=0;u<n;u++){if(o=i[u],r=parseInt(o.getAttribute("rowspan")||1),a=parseInt(o.getAttribute("colspan")||1),r>1){s={},s.idx=u,s.vmp=1,s.hmp=a-1;for(var p=1;p<r&&c+p<d;p++)x(l[c+p],[s])}(r>1||a>1)&&L(o,{merge:"fc"})}}},W=function(e){var t=HTMLUtil.getComputedStylesFromBrowser(e,["listStyleType"]),i=t.listStyleType;if("none"!=i)switch(i){case"decimal":i=o.DECIMAL;break;case"lower-alpha":i=o.LOWER_ALPHA;break;case"upper-alpha":i=o.UPPER_ALPHA;break;case"lower-roman":i=o.LOWER_ROMAN;break;case"upper-roman":i=o.UPPER_ROMAN;break;case"disc":i=o.DISC;break;case"circle":i=o.CIRCLE;break;case"square":i=o.BOX;break;default:i=1}else i=T(e,"ol")?o.DECIMAL:o.DISC;return i},Y=function(e){var t=e.trim().charCodeAt(0),i=o.DECIMAL;return 183==t?i=o.DISC:111==t?i=o.CIRCLE:167==t?i=o.BOX:t>=48&&t<=57?i=o.DECIMAL:t>=97&&t<=122?i=o.LOWER_ALPHA:t>=65&&t<=90&&(i=o.UPPER_ALPHA),i},z=function(e){e=Macros.getImageSrcWithRid(e);var t=e,i=ImageCache.getCopyImageData(e)?ImageCache.getCopyImageData(e):ImageCache.getCopyImageData(ZWNetworkUtils.getContextUrl(e));if(i)try{t=ZWImageUtils.getImageBytes(i)}catch(i){t=e}else ImageCache.getBytesForURL(e)?t=ImageCache.getBytesForURL(e):PubSub.publish("ImageCache/CacheNotAvaialable",e);return t},Z=function(e){if(e&&e.fieldInfo&&e.fieldInfo.type===NODE_TYPE.FILLABLEFIELD){var t,i=DomUtil.createSpan(e.styleInfo),n=e.fieldInfo;if(i.setAttribute("data-text-info",JSON.stringify({cls:NODE_TYPE.FILLABLEFIELD})),n.ffInfo.subType===FILLABLEFIELD_TYPE.IMAGE)i.setAttribute("data-fillablefield-style-info",JSON.stringify(e.styleInfo));else if(n.ffType===FILLABLEFIELD_TYPE.RADIO||n.ffType===FILLABLEFIELD_TYPE.MULTIPLECHOICE){var o="Option_"+Utils.randomString();n[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]=o,n[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CHECKED]=!1}return i.setAttribute("data-fillablefield-info",JSON.stringify(n)),(t=Utils.getFillableFieldResult(n))&&(t=" "===t&&n[ATTR_FILLABLEFIELD.FF_NAME]||t),n[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]==FILLABLEFIELD_TYPE.CURRENCY&&t===n[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CURRENCY_SYMBOL]&&(t=n[ATTR_FILLABLEFIELD.FF_NAME]||t),i.innerText=t,i}},V=function(e,t){if(t&&(t.type===NODE_TYPE.FILLABLEFIELD||t.cls===NODE_TYPE.FILLABLEFIELD)){var i=document.createElement("input"),n=t[ATTR_FILLABLEFIELD.FF_INFO],o=n[ATTR_FILLABLEFIELD.FF_MAX_LENGTH];if(t[ATTR_FILLABLEFIELD.FF_TYPE]===FILLABLEFIELD_TYPE.CHECKBOX)i.setAttribute("type","checkbox"),i.checked=n[ATTR_FILLABLEFIELD.FF_CHECKED];else if(t[ATTR_FILLABLEFIELD.FF_TYPE]===FILLABLEFIELD_TYPE.SELECTBOX)i.setAttribute("data-ff-subType",FILLABLEFIELD_TYPE.SELECTBOX);else if(t[ATTR_FILLABLEFIELD.FF_TYPE]===FILLABLEFIELD_TYPE.RADIO)i.setAttribute("type","radio"),i.checked=n[ATTR_FILLABLEFIELD.FF_CHECKED],i.setAttribute("name",t[ATTR_FILLABLEFIELD.FF_NAME]);else{var r=n[ATTR_FILLABLEFIELD.FF_VALUE],a=n[ATTR_FILLABLEFIELD.FF_SUBTYPE],s="";switch(a){case FILLABLEFIELD_TYPE.CURRENCY:s="text",r=n[ATTR_FILLABLEFIELD.FF_CURRENCY_SYMBOL]+r,i.setAttribute("data-ff-subType",FILLABLEFIELD_TYPE.CURRENCY);break;case FILLABLEFIELD_TYPE.PERCENT:s="text",r+="%",i.setAttribute("data-ff-subType",FILLABLEFIELD_TYPE.PERCENT);break;case FILLABLEFIELD_TYPE.DATE:s=s||"date",r=" "!=r?new Date(r).toLocaleDateString("en-CA"):"";break;case FILLABLEFIELD_TYPE.SINGLELINE:s="text";case FILLABLEFIELD_TYPE.EMAIL:s=s||"email";case FILLABLEFIELD_TYPE.PHONE:s=s||"tel";case FILLABLEFIELD_TYPE.NUMBER:s=s||"number";break;case FILLABLEFIELD_TYPE.IMAGE:case FILLABLEFIELD_TYPE.SIGNATURE:case FILLABLEFIELD_TYPE.INITIAL:s="file",i.setAttribute("accept","image/*"),i.setAttribute("data-ff-subType",a),i.setAttribute("data-ff-size-height",DTUtils.getFillableFieldHeight(e,t)),i.setAttribute("data-ff-size-width",DTUtils.getFillableFieldWidth(e,null,t)),o=100,e.src=n.value;break;default:s="text"}i.setAttribute("type",s),i.setAttribute("value",r),i.setAttribute("maxlength",o)}return delete e[ATTR_COMMON.FIELDINFO],delete e[ATTR_COMMON.CLS],i.setAttribute("id",Utils.randomString()),t[ATTR_FILLABLEFIELD.FF_NAME]&&i.setAttribute("placeholder",t[ATTR_FILLABLEFIELD.FF_NAME]),t[ATTR_FILLABLEFIELD.FF_HELP_TEXT]&&i.setAttribute("title",t[ATTR_FILLABLEFIELD.FF_HELP_TEXT]),t[ATTR_FILLABLEFIELD.FF_DISABLED]&&i.setAttribute("disabled",t[ATTR_FILLABLEFIELD.FF_DISABLED]),i.setAttribute("data-fillablefield-info",JSON.stringify(t)),i.setAttribute("data-fillablefield-style-info",JSON.stringify(e)),i}},j=function(e){var t={},i=e.nodeName.toLowerCase();if(e.hasAttribute("data-fillablefield-info")&&(t.fieldInfo=JSON.parse(e.getAttribute("data-fillablefield-info")),t.fieldInfo&&t.fieldInfo[ATTR_FILLABLEFIELD.FF_INFO]&&t.fieldInfo[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.CURRENCY)){var n=ZWUtils.getLocaleDetails();t.fieldInfo[ATTR_FILLABLEFIELD.FF_INFO].locale=n.code,t.fieldInfo[ATTR_FILLABLEFIELD.FF_INFO].currencyISOCode=n.currencyCode,t.fieldInfo[ATTR_FILLABLEFIELD.FF_INFO].currencySymbol=Numeral.getFormattedNumberAndCurrencySymbol(n.code,n.currencyCode).symbol}if(e.hasAttribute("data-fillablefield-style-info")&&(t.styleInfo=JSON.parse(e.getAttribute("data-fillablefield-style-info"))),t.fieldInfo||t.styleInfo||!/^(input|select|span)$/.test(i))return t;var o,r,a,s={};if(t.fieldInfo={type:NODE_TYPE.FILLABLEFIELD,id:Utils.randomString()},t.styleInfo={},t.fieldInfo[ATTR_FILLABLEFIELD.FF_TYPE]="textinput",(r=e.getAttribute("title"))&&(t.fieldInfo[ATTR_FILLABLEFIELD.FF_HELP_TEXT]=r),(a=e.getAttribute("placeholder"))&&(t.fieldInfo[ATTR_FILLABLEFIELD.FF_NAME]=a),e.disabled&&(t.fieldInfo[ATTR_FILLABLEFIELD.FF_DISABLED]=!!e.disabled),t.fieldInfo[ATTR_FILLABLEFIELD.FF_INFO]=s,"input"===i)switch(e.getAttribute("type")){case"text":o=o||e.getAttribute("data-ff-subType")||FILLABLEFIELD_TYPE.SINGLELINE;case"tel":o=o||FILLABLEFIELD_TYPE.PHONE;case"date":o=o||FILLABLEFIELD_TYPE.DATE;case"email":o=o||FILLABLEFIELD_TYPE.EMAIL;case"number":o=o||FILLABLEFIELD_TYPE.NUMBER,s[ATTR_FILLABLEFIELD.FF_SUBTYPE]=o;break;case"checkbox":t.fieldInfo[ATTR_FILLABLEFIELD.FF_TYPE]=FILLABLEFIELD_TYPE.CHECKBOX;break;case"file":s[ATTR_FILLABLEFIELD.FF_SUBTYPE]=e.getAttribute("data-ff-subType")||FILLABLEFIELD_TYPE.IMAGE,s[ATTR_FILLABLEFIELD.FF_SIZE]={height:e.getAttribute("data-ff-size-height")||100,width:e.getAttribute("data-ff-size-width")||100}}else"select"===i&&(t.fieldInfo[ATTR_FILLABLEFIELD.FF_TYPE]=FILLABLEFIELD_TYPE.SELECTBOX);return X(e,t.fieldInfo),t},X=function(e,t){var i=e.getAttribute("maxlength")||30,n=t[ATTR_FILLABLEFIELD.FF_TYPE],o=t[ATTR_FILLABLEFIELD.FF_INFO],r=o[ATTR_FILLABLEFIELD.FF_SUBTYPE],a=e.getAttribute("value");if((i=parseInt(i))&&(o[ATTR_FILLABLEFIELD.FF_MAX_LENGTH]=i),n===FILLABLEFIELD_TYPE.CHECKBOX)o[ATTR_FILLABLEFIELD.FF_CHECKED]=!!e.getAttribute("checked"),o[ATTR_FILLABLEFIELD.FF_SIZE]=20;else if(n===FILLABLEFIELD_TYPE.SELECTBOX){for(var s=[],l=e.options,d=0;d<l.length;d++){var c=l[d];s.push(c.value)}s.length&&(o[ATTR_FILLABLEFIELD.FF_LIST]=s),e.selectedIndex&&(o[ATTR_FILLABLEFIELD.FF_SELECTED_INDEX]=e.selectedIndex)}else r===FILLABLEFIELD_TYPE.PERCENT?a=a.replaceAll("%",""):r===FILLABLEFIELD_TYPE.CURRENCY?a=a.replaceAll(o.currencySymbol,""):r===FILLABLEFIELD_TYPE.DATE&&(o[ATTR_FILLABLEFIELD.FF_FORMAT]="MM/dd/yyyy"),o[ATTR_FILLABLEFIELD.FF_VALUE]=a||" "},K=function(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild};return{getAutoFieldClass:a,getUserFieldCls:s,storeImageInFileStore:u,uploadImageInFileStore:p,getDataSet:E,getParents:h,getParentsUntil:I,getParentById:m,getElementIdx:b,getDisplayType:d,removeElement:v,removeAllChild:D,setAttribute:L,fixMergeforTableEl:k,insertAfter:P,insertBefore:C,getBlockParent:_,getParentNode:A,getElementWidth:N,getComputedStylesFromBrowser:r,isBlockElement:g,isInlineElement:f,getImageData:z,getListTypeByCharCode:Y,getListType:W,findNodesInTable:G,storeImageInFileStoreByURL:c,isValidImageURL:O,isBase64Img:R,isWriterImage:S,nodeNameEquals:T,convertFillableFieldsToWriterHTML:Z,convertFillableFieldsToStdHTML:V,convertHTMLToFillableFields:j,getCommonKeys:l,htmlToElement:K,insertAsFirst:y}}();var TablePopupHandler=function(){var e,t,i,n,o=18,r=function(r){if(void 0===r.offsetX||void 0===r.offsetY){var s=r.target.getBoundingClientRect();r.offsetX=r.pageX-s.left,r.offsetY=r.pageY-s.top}e=r.offsetX+18,t=r.offsetY+18,e-=e<o?-o:e%o,t-=t<o?-o:t%o,Z("instbl-highlighted-cells").css({width:e,height:t}),i=parseInt(t/o),n=parseInt(e/o),i=i>15?15:i,n=n>15?15:n,a()},a=function(){Z("display_div_ins_table").text(i+" x "+n)},s=function(e){editor.doc.execCmd("instable",[i,n])},l=function(){Z("instbl-row").unbind("click").bind("click",s),Z("instbl-row").unbind("mousemove").bind("mousemove",r)},d=function(){Z("instbl-highlighted-cells").css({width:18,height:18}),Z("instbl-boundary-cells").css({width:0,height:0}),i=1,n=1,a()};return{handleBeforePopupShow:d,bindEvents:l}}();DesignUI=function(){"use strict";var e,t,i=!1,n=null,o=null,r=["Oswald","OSP DIN","Cabin","Source Sans Pro","Cabin Sketch","Roboto","League Gothic","Latin Modern Roman","TeX Gyre Heros","Alegreya","Quicksand","Colaborate","Droid Sans","Titillium Web","Unna","Rokkitt","Otama ep","Ubuntu","glegoo","open sans","roboto","lato","istok web","pt serif","pt sans","pontano sans","aclonica","oxygen"],a={"arial,helvetica,sans-serif":"Arial","arial black,avant garde":"Arial Black","courier new,courier,monospace":"Courier New","georgia,times new roman,times,serif":"Georgia","ms mincho,ipmincho,serif":"MSMincho","ms pmincho,ipapmincho,serif":"MSPMincho","tahoma,arial,helvetica,sans-serif":"Tahoma","times new roman,times,serif":"Times New Roman","trebuchet ms,geneva":"Trebuchet MS"},s=["arbutus slab","buenard","chunkfive","convergence","droid sans","droid serif","fira sans","francois one","glegoo","hammersmith one","heuristica","inder","istok web","judson","lora","pontano sans","pt sans","pt serif"];SavedDesign=J.isEmptyObject(SavedDesign)&&w_usersettings.SavedDesign?w_usersettings.SavedDesign:SavedDesign,SavedStyles=J.isEmptyObject(SavedStyles)&&w_usersettings.SavedStyles?w_usersettings.SavedStyles:SavedStyles;for(var l in SavedDesign)DesignUtil.isValidDesignData(SavedDesign[l])||delete SavedDesign[l];var d=function(){return t},c=function(){t=void 0},u=function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e<t?-1:e>t?1:0},p=function(e,t){var i,n=t;return n.sort(function(e,t){return u(e,t)}),i=n.indexOf(e),i!=-1?i:0},g=function(e,t,i){var n=U.keys(e),o=n.length;i?n.sort(function(e,t){return u(e,t)}):void 0;for(var r=0;r<o;r++){var a=n[r],s=DesignUI.getDesignPreview(a,e[a]),l={};l.innerHTML=s.innerHtml,l.replaceWithText=!0,l.label=s.label;var d=document.createElement("option");d.setAttribute("id","design-id-"+a.replace(/[^a-zA-Z0-9]/g,"-")),J(d).addClass("ui-doctheme-cont"),J(d).attr({data:JSON.stringify(l),value:a}),t.push(d)}},f=function(){var e=J("#doctheme-combo"),t=[],i=[],n={theme:DocumentDesign.getTheme(),styles:DocumentDesign.getComputedStyles()};g(DesignSets,t);var o=DesignUI.getDesignPreview("INUSE",n),r=document.createElement("option"),a={};a.innerHTML=o.innerHtml,a.replaceWithText=!0,a.label=o.label,r.setAttribute("id","custom-theme-preview"),J(r).addClass("ui-doctheme-cont"),J(r).attr({data:JSON.stringify(a)}),g(SavedDesign,i,!0),e.zselectbox("addOption",r,"append","#docthemes-inuse"),e.zselectbox("addOption",i,"append","#docthemes-custom"),e.zselectbox("addOption",t,"append","#docthemes-builtin"),DesignUI.selectDesingInSelectBox()},E=function(){return e?e:{theme:w_usersettings.theme,styles:w_usersettings.styles}},T=function(e,t){for(var i=["h0","h1","h2","h3","h4","h5","h6","h101","h102","h103"],n=([ATTR_PARAGRAPH.PS_SA,ATTR_PARAGRAPH.PS_SB,ATTR_PARAGRAPH.PS_ML,ATTR_PARAGRAPH.PS_MR,ATTR_PARAGRAPH.PS_TI,ATTR_PARAGRAPH.PS_PL],function(e,t){var i=DocUtil.copyStyle(s.styles);if(i.hasOwnProperty("font-size")&&(i["font-size"]=4*i["font-size"].convertor().points+"pt"),i.hasOwnProperty("font-family")){var n=i["font-family"];n=n.replace(/'/g,""),editor.addFonts([n],window,null,{defaultVarients:!0})}J(e.firstElementChild).css(i)}),o=0;o<i.length;o++){var r=J(e).find(".preview_fmt_pnl_"+i[o]+",.import_preview_"+i[o]);J(r).removeAttr("style");var a=t.para[i[o]],s=Utils.getStyle(a.textFormat),l=Utils.getStyle(a);l.styles.paddingTop&&(l.styles.paddingTop=l.styles.paddingTop+5),U.each(r,n),J(r).css(l.styles)}},m=function(e,t){var i=DocUtil.copyStyle(t.theme.color);e="INUSE"==e?"Custom*":0==e.indexOf("custom|")?e.substr("custom|".length):e;var n='<div class="ui-ellipsis ui-design-title" title="'+Utils.encodeHTMLString(e)+'">'+Utils.encodeHTMLString(e)+"</div>",o='<div class="ui-doctheme-colorset clearfix"><span style="background: '+i.dark2+';"></span><span style="background:'+i.light2+';"></span><span style="background:'+i.accent1+';"></span><span style="background: '+i.accent2+';"></span><span style="background:'+i.accent3+';"></span><span style="background:'+i.accent4+';"></span><span style="background:'+i.accent5+'"></span><span style="background:'+i.accent6+';"></span></div>';return{innerHtml:n,label:o}},h=function(){return"<div class='ui-design-preview-cont'><div class='ui-design-theme-temp'><div class='preview_fmt_pnl_h101'><span>Title</span></div><div class='preview_fmt_pnl_h102'><span>Sub Title</span></div><div class='preview_fmt_pnl_h1'><span>Heading 1</span></div><div class='preview_fmt_pnl_h0'><span>Lorem ipsum dolor sit amet adipiscing elit, fusce odio laoreet eleifend.</span></div><div class='preview_fmt_pnl_h2'><span>Heading 2</span></div><div class='preview_fmt_pnl_h0'><span>Nulla cursus nibh sed est tincidunt, feugiat pellentesque nulla mollis.</span></div><div class='preview_fmt_pnl_h3'><span>Heading 3</span></div><div class='preview_fmt_pnl_h0'><span>Sed quis dictum felis, ut tincidunt sapien. Nulla mattis egestas.</span></div><div class='preview_fmt_pnl_h4'><span>Heading 4</span></div><div class='preview_fmt_pnl_h0'><span>Suspendisse eros arcu, maximus at faucibus proin in scelerisque turpis.</span></div><div class='preview_fmt_pnl_h5'><span>Heading 5</span></div></div>"},I=function(e,t,i){var n=m(e,t),o=e,r=0==e.indexOf("custom|");e="INUSE"==e?"Custom*":r?e.substr("custom|".length):e;var a=r?"doctheme-design-card doctheme-custom-more":"doctheme-design-card",s="<div data-design-name='"+Utils.encodeHTMLString(o)+"' class='"+a+"'>"+h()+"</div>"+(i?"":"<div data-menu-id='design-more-options' data-show-arrow-icon='false' class='ui-doctheme-actbtn ui-doctheme-actbtn-more' title="+J.i18n("writer.common.MORE")+"><span class='ui-icon-moreoptions1-black-sm'></span></div>")+"<div class='ui-design-theme-label'>"+Utils.encodeHTMLString(e)+"</div></div>",l={innerHtml:s,label:n.innerHtml};return l},_=function(e,t,i){var n={fmtScheme:{}};return n.font=t,n.color=i,e=DocUtil.getRenderingFormat(e,n)},A=function(e,t,i,n){return e=_(e,t,i),"undefined"==typeof n&&(n=document.createElement("div"),n.innerHTML=h()),T(n,e),n},S=function(e,t,i){var n,o,r,a=e?e:designName,s=DocumentDesign.getComputedStyles(),n=DocUtil.copyStyle(t.theme.font),o=DocUtil.copyStyle(t.theme.color);r="INUSE"===a?s:a.indexOf("custom|")!=-1?DocUtil.copyStyle(SavedDesign[a].styles):DocUtil.copyStyle(t.styles);var l={color:o,font:n};r=DocUtil.getRenderingFormat(r,l);var d=I(a,t,i),c=document.createElement("div");return c.innerHTML=d.innerHtml,T(c,r),d.innerHtml=c.innerHTML,d},R=function(){var e,t={},i=L();return t[ATTR_BODY.DS_THEME]=i[ATTR_BODY.DS_THEME],t[ATTR_BODY.DS_STYLES]=i[ATTR_BODY.DS_STYLES],e=D(t),!e||!e.name},O=function(e){for(var t=e.para,i=1;i<=6;){var n=t["h"+i];n.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)&&(ListUtils.removeListProps(n),delete n[ATTR_PARAGRAPH.PS_ML]),i+=1}},b=function(e){var t=e.para;for(var i in t){var n=i.substr(1);n=parseInt(n),n>Macros.getDesignStylesLimit()&&delete t[i]}return e},v=function(e,t){var i=t.para,n=e.para;for(var o in n)i[o]&&i[o].deleted&&delete n[o]},D=function(e){if("undefined"==typeof DesignSets)return null;var t=L(),i=e?e[ATTR_BODY.DS_STYLES]:t[ATTR_BODY.DS_STYLES],n=e?e[ATTR_BODY.DS_THEME]:t[ATTR_BODY.DS_THEME],o=U.keys(DesignSets),r=U.keys(SavedDesign),a=DesignUtil.getOrgDesign(),s=null,l=null,d=null;O(i),v(i,DocumentDesign.getStyleUIInfo()),b(i);for(var c in a){var u=a[c].name,p=a[c].content,g=b(ZWJSONUtils.clone(p.styles));if(O(g),StyleUtil.compareStyleJson(g,i)&&U.isEqual(p.theme.font,n.font)&&U.isEqual(p.theme.color,n.color)){s=u,l="org",d=c;break}}if(!s){for(;r.length;){var f=r.shift(),E=b(ZWJSONUtils.clone(SavedDesign[f].styles));if(O(E),StyleUtil.compareStyleJson(E,i)&&U.isEqual(SavedDesign[f].theme.font,n.font)&&U.isEqual(SavedDesign[f].theme.color,n.color)){s=f,l="user";break}}if(!s&&StyleUtil.compareStyleJson(DesignSets[DefaultDesignName][ATTR_BODY.DS_STYLES].para,i.para)&&U.isEqual(DesignSets[DefaultDesignName][ATTR_BODY.DS_THEME].font,n.font)&&U.isEqual(DesignSets[DefaultDesignName][ATTR_BODY.DS_THEME].color,n.color)&&(s=DefaultDesignName,l="writer"),!s)for(;!s&&o.length;){var f=o.shift();if(StyleUtil.compareStyleJson(DesignSets[f].styles,i)&&U.isEqual(DesignSets[f].theme.font,n.font)&&U.isEqual(DesignSets[f].theme.color,n.color)){s=f,l="writer";break}}}return s?{name:s,type:l,id:d}:null},L=function(){var e={};return e.theme=DocumentDesign.getTheme(),e.styles=DocumentDesign.getStyles(),e.styleUIInfo=DocumentDesign.getStyleUIInfo(),e},N=function(){!i&&DesignTabUI.isDesignTabIntialized()&&(editor.addFonts(s,window,null,{defaultVarients:!0}),i=!0)},P=function(e){var t={},i=[];t[e.name]=e.design,t.cusomAttributes={},t.cusomAttributes.id=e.id,_pushOrgDesignsIntoPreview(t,i),J("#design-orgdesigns").zmenu("addMenuItems",i)},C=function(e){if(!i)return void N();var t=J("#doctheme-combo"),n=DesignUI.getDesignPreview(e,SavedDesign[e]),o={},r=1;o.innerHTML=n.innerHtml,o.replaceWithText=!0,o.label=n.label;var a=document.createElement("option");a.setAttribute("id","design-id-"+e.replace(/[^a-zA-Z0-9]/g,"-")),J(a).addClass("ui-doctheme-cont"),J(a).attr({data:JSON.stringify(o),value:e}),J("#doctheme-combo").zselectbox("setOptionAttributes","#docthemes-custom","hidden",!1),r=p(e,Object.keys(SavedDesign)),t.zselectbox("addOptionAt",a,r,"#docthemes-custom")},y=function(e){if(!i)return void N();var t=J("#doctheme-combo"),n="#design-id-"+e.replace(/[^a-zA-Z0-9]/g,"-");t.zselectbox("removeOption",n),DesignUI.selectDesingInSelectBox()},F=function(e){var t=e,i=DesignUI.getCurrentDesignSet();e||(t=DesignUI.getDesignName()),t=t?t:"INUSE";var n=DesignUI.getColorPallet(t,i),o=E(),r=document.createElement("div");if(r.innerHTML=n.innerHtml,"INUSE"!=t&&U.isEqual(i.styles,o.styles)&&U.isEqual(i.theme.font,o.theme.font)&&U.isEqual(i.theme.color,o.theme.color)){var a=J(r).find(".ui-design-title");a[0].innerHTML=a[0].innerText+" <i>("+J.i18n("writer.common.DEFAULT")+")</i>"}J("#doctheme-combo")[0]?J("#doctheme-combo").next(".zselectbox").find(".zselectbox__text")[0].innerHTML=r.innerHTML:void 0},M=function(e,t){"The Writer"==DesignUI.getDesignName()?J("#"+t.menu[0].id).zmenu("setMenuItemsAttribute",[".doctheme-reset-default"],"disabled",!0):J("#"+t.menu[0].id).zmenu("setMenuItemsAttribute",[".doctheme-reset-default"],"disabled",!1)},w=function(){i||N();var t=DesignUI.getDesignName(),n=[],o=[];t?0==t.indexOf("custom|")?(n.push("#design-menu-user-design-list"),o.push("#design-menu-writer-design-list")):(n.push("#design-menu-writer-design-list"),o.push("#design-menu-user-design-list")):o=["#design-menu-writer-design-list","#design-menu-user-design-list"],n.length&&J("#design-menu").zmenu("setMenuItemsAttribute",n,"checked",!0),o.length&&J("#design-menu").zmenu("setMenuItemsAttribute",o,"checked",!1),J("#design-menu").zmenu("setMenuItemsAttribute",["#design-menu-my-design-list"],"description",Object.keys(SavedDesign).length),J("#design-menu").zmenu("setMenuItemsAttribute",["#design-menu-org-design-list"],"description","empty"),_setDefaultTagAndSelect(e)},x=function(){if(i||N(),R()){var t=L(),n={theme:t.theme,styles:t.styles},o=DesignUI.getDesignPreview("INUSE",n),r=document.getElementById("zoption-custom-theme-preview");r.innerHTML=o.innerHtml,J("#doctheme-combo").zselectbox("setOptionAttributes","#docthemes-inuse","hidden",!1)}else J("#doctheme-combo").zselectbox("setOptionAttributes","#docthemes-inuse","hidden",!0);var a=document.getElementById("docthemes-custom");a.children.length>0?J("#doctheme-combo").zselectbox("setOptionAttributes","#docthemes-custom","hidden",!1):J("#doctheme-combo").zselectbox("setOptionAttributes","#docthemes-custom","hidden",!0),"The Writer"==DesignUI.getDesignName()?J("#doctheme-combo").zselectbox("setOptionAttributes","#docthemes-reset","disabled",!0):J("#doctheme-combo").zselectbox("setOptionAttributes","#docthemes-reset","disabled",!1),setDefaultTag(e)},B=function(e){if(e.originalEvent.originalEvent&&"focusout"==e.originalEvent.originalEvent.type&&J("#doc-theme-options").is(":focus"))return!1},H=function(e){J(".ui-doctheme-actbtn-more").removeClass("ui-selected")},G=function(){return!1},k=function(e,t){var i=e.originalEvent.originalEvent;if(i&&J(i.target).closest(".ui-doctheme-actbtn-more").length){var n=(J(i.target).closest(".ui-doctheme-actbtn-more")[0],J(i.target).closest(".ui-doctheme-cont")[0]),o=n.children[0],r=document.getElementById("design-actbtn-delete"),a=document.getElementById("design-actbtn-setasdefault"),s=document.getElementById("design-actbtn-copy-org"),l=document.getElementById("design-actbtn-edit-next-para-style"),d=n.getAttribute("designName"),c=n.getAttribute("designType");return J("#doc-theme-options").zmenu("show",{forElement:J(o)}),r.onclick=function(){J("#design-menu").zmenu("hide"),DesignUtil.deleteDocumentDesign(d,c)},s.onclick=function(){J("#design-menu").zmenu("hide"),DesignUtil.copyToOrgDesign(d,c)},l.onclick=function(){J("#design-menu").zmenu("hide");var e=null,t=!1;d.indexOf("custom|")!=-1&&(e=d,t=DesignUI.getDesignName()==d),StyleUI.openNextParaStyleDlg(d,t,c)},a&&(a.onclick=function(){J("#design-menu").zmenu("hide");var e={};"user"==c?(e[ATTR_BODY.DS_STYLES]=SavedDesign[d][ATTR_BODY.DS_STYLES],e[ATTR_BODY.DS_THEME]=SavedDesign[d][ATTR_BODY.DS_THEME],e[ATTR_BODY.DS_STYLE_UI_INFO]=SavedDesign[d][ATTR_BODY.DS_STYLE_UI_INFO]):"writer"==c?(e[ATTR_BODY.DS_STYLES]=DesignSets[d][ATTR_BODY.DS_STYLES],e[ATTR_BODY.DS_THEME]=DesignSets[d][ATTR_BODY.DS_THEME],e[ATTR_BODY.DS_STYLE_UI_INFO]=DesignSets[d][ATTR_BODY.DS_STYLE_UI_INFO]):e=DesignUI.getCurrentDesignSet(),DesignUtil.setAsDefault(e)}),!1}},W=function(e,t){var i=e.originalEvent.originalEvent;if(i&&J(i.target).closest(".ui-doctheme-actbtn-more").length){var n=J(i.target).closest(".ui-doctheme-actbtn-more")[0],o=document.getElementById("doctheme-actbtn-delete"),r=document.getElementById("doctheme-actbtn-setasdefault"),a=document.getElementById("doctheme-actbtn-edit-next-para-style"),s=J(i.target).closest(".doctheme-design-card")[0],l=(J(s).hasClass("doctheme-custom-more"),s.getAttribute("data-design-name"));return J("#doctheme-comboMenu .zmenu__list:first").on("scroll",function(){J("#doc-theme-options").zmenu("hide")}),J("#doc-theme-options").zmenu("show",{forElement:J(n)}),J(n).addClass("ui-selected"),o.onclick=function(){J("#doctheme-combo").zselectbox("close"),DesignUtil.deleteDocumentDesign(t.data.properties.value)},a.onclick=function(){J("#doctheme-combo").zselectbox("close");var e=null,t=!1;l.indexOf("custom|")!=-1&&(e=l,t=DesignUI.getDesignName()==l),StyleUI.openNextParaStyleDlg(e,t)},r&&(r.onclick=function(){J("#doctheme-combo").zselectbox("close");var e={};l.indexOf("custom|")!=-1?(e[ATTR_BODY.DS_STYLES]=SavedDesign[l][ATTR_BODY.DS_STYLES],e[ATTR_BODY.DS_THEME]=SavedDesign[l][ATTR_BODY.DS_THEME],e[ATTR_BODY.DS_STYLE_UI_INFO]=SavedDesign[l][ATTR_BODY.DS_STYLE_UI_INFO]):"INUSE"!=l?(e[ATTR_BODY.DS_STYLES]=DesignSets[l][ATTR_BODY.DS_STYLES],e[ATTR_BODY.DS_THEME]=DesignSets[l][ATTR_BODY.DS_THEME],e[ATTR_BODY.DS_STYLE_UI_INFO]=DesignSets[l][ATTR_BODY.DS_STYLE_UI_INFO]):e=DesignUI.getCurrentDesignSet(),DesignUtil.setAsDefault(e)}),!1}return i&&J(i.target).closest("#doctheme-actbtn-delete").length?(DesignUtil.deleteDocumentDesign(t.data.properties.value),!1):i&&J(i.target).closest("#zoption-docthemes-reset").length?(J("#doctheme-combo").zselectbox("close"),DesignUtil.resetDesign(),!1):!i||!J(i.target).closest("#zoption-import-style-button").length||(J("#doctheme-combo").zselectbox("close"),StyleImportUI.openStyleImportUI(),!1)},B=function(e){if(e.originalEvent.originalEvent&&"focusout"==e.originalEvent.originalEvent.type)return!1},Y=function(e,t){var i=t.menuitem[0].children[0].getAttribute("data-design-name");i&&DesignUtil.applyDesign(i)},z=function(e,t){t.value&&DesignUtil.applyDesign(t.value)},V=function(){ue(),PubSub.unsubscribe("Document/ComponentInitialized"),PubSub.unsubscribe("Document/LeftPanelOpen")},j=function(){return o},X=function(e,t){o&&o.sucessCallBack&&o.sucessCallBack(e,t),o=null},K=function(e,t){o&&o.failureCallBack&&o.failureCallBack(e,t),o=null},q=function(){ie()},Q=function(e){e&&(n.name=e.value);var t="rename-dlg-action-button",i="rename-design-msg-box",o=new RegExp("^(a-z|A-Z|0-9)*[^:*?()#%^&<>\";'|\\\\/]*$");n.name?DesignUtil.isDesignNameAlreadyExists(n.name,n.type)?(J("#"+t).zbutton("disable"),le(J.i18n("writer.design.DESIGN_NAME_EXIST"),i)):o.test(n.name)?(J("#"+t).zbutton("enable"),de(i)):(J("#"+t).zbutton("disable"),le(J.i18n("writer.design.SPECIAL_CHARS_NOT_ALLOWED"),i)):(J("#"+t).zbutton("disable"),le(J.i18n("writer.design.DESIGN_NAME_CANNOT_BE_EMPTY"),i))},$=function(e){var t=(new RegExp("^(a-z|A-Z|0-9)*[^:*?()#%^&<>\";'|\\\\/]*$"),{set:function(e,t){"design_name"==e.action&&(n.name=t),Q()},init:function(){n={},n=e?e:DesignUI.getDesignName(),n.oldName=n.name},get:function(e,t){if("design_name"==e.action)return"user"==n.type?n.name.replace("custom|",""):n.name}});J.dialogutil.open("renamedesigndialog",null,t)},ee=function(){var e=n,t=e.type,i=document.getElementById("rename-dlg-design-name").value;i="user"==t?"custom|"+i:i,"user"==t?DesignUtil.renameUserDesign(i,e.oldName):(t="org")&&DesignUtil.renameOrgDesign(i,e.oldName,e.id),J.dialogutil.close("renamedesigndialog")},te=function(e){e&&(o.name=e.value);var t="design-primary-btn",i="design-msg-box",n=new RegExp("^(a-z|A-Z|0-9)*[^:*?()#%^&<>\";'|\\\\/]*$");o.name?DesignUtil.isDesignNameAlreadyExists(o.name,o.type)?(J("#"+t).zbutton("disable"),le(J.i18n("writer.design.DESIGN_NAME_EXIST"),i)):n.test(o.name)?(J("#"+t).zbutton("enable"),de(i)):(J("#"+t).zbutton("disable"),le(J.i18n("writer.design.SPECIAL_CHARS_NOT_ALLOWED"),i)):(J("#"+t).zbutton("disable"),le(J.i18n("writer.design.DESIGN_NAME_CANNOT_BE_EMPTY"),i))},ie=function(e,t,i){var n=null,a={set:function(e,t){"name"===e.action&&(o.name=t),"designType"===e.action&&(o.type=t),te()},init:function(){n=null,o={};var a=e?e:L();o.sucessCallBack=t,o.failureCallBack=i,c(),J("#design-primary-btn").zbutton("disable"),r.length&&(ZWLogger.log("@initThemeDialog-->addFonts"),editor.addFonts(r,frames.metricsFrame),r=[]),document.getElementById("designPopup_design_type_container").style.display=DesignUtil.isOrgAdmin()?"block":"none",o.type="user",o.design=a,se(a);var s=a.theme.font,l=DesignTabUI.getThemeFontsHTML(s.major.latin,s.minor.latin),d=document.getElementById("design_dlg_font_container_text");d.outerHTML=l.innerHtml;var u=DesignTabUI.getThemeColorHTML(null,a.theme.color),p=document.getElementById("design_dlg_color_div");p.outerHTML=u.label;var g=document.getElementById("design_dlg_next_parastyle_div"),f=DesignTabUI.getNextStyleHTML(a.styles);g.outerHTML=f,e?J("#design-primary-btn .zbutton__text").text(J.i18n("writer.design.SAVE_AND_APPLY")):J("#design-primary-btn .zbutton__text").text(J.i18n("writer.common.SAVE"))}};J.dialogutil.open("designdialog",null,a)},ne=function(e){var t=J(e);t.hasClass("normal-preview")?(J(".ui-design-dialog-preview").show(),J(".ui-design-dialog-page-preview").hide(),t.addClass("active"),J(".page-preview").removeClass("active")):(J(".ui-design-dialog-preview").hide(),J(".ui-design-dialog-page-preview").show(),t.addClass("active"),J(".normal-preview").removeClass("active"))},oe=function(e){for(var t=Object.keys(DocumentDesign.getStyles().para),i=function(e,t){var i=DocUtil.copyStyle(a.styles);i.hasOwnProperty("font-size")&&(i["font-size"]=parseInt(.7*parseInt(i["font-size"]))),J(e).css(i)},n=0;n<t.length;n++){var o=J(".preview_"+t[n]);J(o).removeAttr("style");var r=e.para[t[n]],a=Utils.getStyle(r.textFormat);delete r[ATTR_PARAGRAPH.PS_LS],delete r[ATTR_PARAGRAPH.PS_SA],delete r[ATTR_PARAGRAPH.PS_SB],delete r[ATTR_PARAGRAPH.PS_ML],delete r[ATTR_PARAGRAPH.PS_MR],delete r[ATTR_PARAGRAPH.PS_TI],delete r[ATTR_PARAGRAPH.PS_PL];var s=Utils.getStyle(r);U.each(o,i),J(o).css(s.styles)}},re=function(e,t){return J('<div class="preview_'+e+'">'+Utils.encodeHTMLString(t)+"</div>")[0]},ae=function(e){var t=DocumentDesign.getStyles().para;for(var i in t){var n=parseInt(i.substr(1)),o=t[i].info.cs_name;n<=106||e.append(re(i,o))}},se=function(e){var t=DocUtil.getRenderingFormat(e?e.styles:DocumentDesign.getStyles(),DocumentDesign.getTheme());ae(J("#design-preview-paragraphs")[0]),oe(t)},le=function(e,t){var i=document.getElementById(t);i.style.display="block",i?i.innerText=e:void 0},de=function(e){var t=document.getElementById(e);t.style.display="none",t?t.innerText="":void 0},ce=function(){var e=function(e){return e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/)},t=DocumentDesign.getTheme(),i=[{color:e(t.color.light1),title:"Background1"},{color:e(t.color.dark1),title:"Text1"},{color:e(t.color.light2),title:"Background2"},{color:e(t.color.dark2),title:"Text2"},{color:e(t.color.accent1),title:"Accent1"},{color:e(t.color.accent2),title:"Accent2"},{color:e(t.color.accent3),title:"Accent3"},{color:e(t.color.accent4),title:"Accent4"},{color:e(t.color.accent5),title:"Accent5"},{color:e(t.color.accent6),title:"Accent6"}];for(var n in i)i.hasOwnProperty(n)&&(i[n].tones=DesignUtil.getTones(i[n].color));return{baseColors:i}},ue=function(){var e=ce(),t={id:"writer-colorpicker",defaultPaletteType:"custom",customPalette:{heading:"Theme Colors",hasTones:!0,colors:e.baseColors},advancedPickerOptions:{opacity:!1}},i=ZComponents.createColorPicker(t);i.zcolorpicker("setAttribute","defaultValue","#000000")},pe=function(){var e=DocumentDesign.getTheme(),t=(a[e.font.minor.latin]?a[e.font.minor.latin]:DesignUtil.getStrippedFontName(e.font.minor.latin))+" (Body)",i=(a[e.font.major.latin]?a[e.font.major.latin]:DesignUtil.getStrippedFontName(e.font.major.latin))+" (Headings)",n=J("#zfontcombo-menu").find("#minorFontOption").data(),o=n&&n.metadata.customAttributes||{};o.style="font-family:"+e.font.minor.latin,J("#zfontcombo-menu").zmenu("setMenuItemsAttribute",["#minorFontOption"],"customAttributes",o),J("#minorFontOption").attr({style:"font-family:"+e.font.minor.latin,"data-filter-label":t.toLowerCase(),"data-label":t}),J("#majorFontOption").attr({style:"font-family:"+e.font.major.latin,"data-filter-label":i.toLowerCase(),"data-label":i}),J("#minorFontOption .zmenu__text").text(t),J("#majorFontOption .zmenu__text").text(i),J("#minorFontOption").data()&&(J("#minorFontOption").data().metadata.label=t,J("#majorFontOption").data().metadata.label=i)},ge=function(){var e=ce();Z("writer-colorpicker").zcolorpicker("setAttribute","customPalette",{colors:e.baseColors}),Z("writer-colorpicker").zcolorpicker("setAttribute","defaultValue","#000000")},fe=function(e,t){t.forElement[0].classList.add("ui-selected")},Ee=function(e,t){var i=t.forElement[0],n=i.parentNode,o=[],r=[],a=n.getAttribute("designType");n.getAttribute("designName");if(parentNode.hasAttribute("data-design-name")){parentNode.getAttribute("data-design-name");"user"==a?(r.push(J("#design-actbtn-setasdefault")),r.push(J("#design-actbtn-delete")),r.push(J("#design-actbtn-copy-org")),r.push(J("#design-actbtn-edit-next-para-style"))):"writer"==a&&parentNode.parentNode.classList.contains("is-selected")?(r.push(J("#design-actbtn-setasdefault")),r.push(J("#design-actbtn-copy-org")),o.push(J("#design-actbtn-delete")),r.push(J("#design-actbtn-edit-next-para-style"))):"writer"==a?(r.push(J("#design-actbtn-setasdefault")),r.push(J("#design-actbtn-copy-org")),o.push(J("#design-actbtn-delete")),o.push(J("#design-actbtn-edit-next-para-style"))):"org"==a&&(r.push(J("#design-actbtn-setasdefault")),o.push(J("#design-actbtn-copy-org")),DesignUtil.isOrgAdmin?r.push(J("#design-actbtn-delete")):o.push(J("#design-actbtn-delete")),r.push(J("#design-actbtn-edit-next-para-style")))}J("#doc-theme-options").zmenu("setMenuItemsAttribute",o,"hidden",!0),J("#doc-theme-options").zmenu("setMenuItemsAttribute",r,"hidden",!1)},Te=function(){pe(),UIUtils.setHeadingDropdownStyle(),ge()};return PubSub.subscribe("Document/ComponentInitialized",V),PubSub.subscribe("Document/LeftPanelOpen",V),PubSub.subscribe("Design/UserDesign/Save/Success",X),PubSub.subscribe("Design/OrgDesign/Save/Success",X),PubSub.subscribe("Design/OrgDesign/Added",P),PubSub.subscribe("Design/OrgDesign/Save/Failure",K),PubSub.subscribeOnce("DesingnTab/FirstTime/Init",N),{getSavingDesignName:d,getDefaultDesign:E,compareStrings:u,getInsertPosition:p,addThemeOptionGroup:f,getRenderingStyleSet:_,getCustomDesignPreview:A,getDesignPreview:S,getColorPallet:m,getDocThemeHTML:I,setStyleForPreviewNode:T,initializeThemeOptionGroup:N,removeCustomStyles:b,getDesignName:D,getCurrentDesignSet:L,addNewDesign:C,renameDesign:ee,deleteSavedDesign:y,setDummyDesignLabel:F,beforeShow:x,beforeSubMenuShow:M,_beforeDesignSubMenuClick:k,_beforeDesignMenuClick:G,subMenuClickEvents:Y,beforeClose:B,beforeClick:W,_beforeShow:w,clickEvents:z,actmenuClose:H,beforeThemeDropDownShow:Ee,openDesignDialog:ie,validateDesignName:te,validateRenameDlgDesignName:Q,swapPreview:ne,updateFontCombo:pe,updateColorPalete:ge,updateDesignUI:Te,openDesignDialogForCurrentDesign:q,getDesignFromDialog:j,beforeStylesetDropDownShow:fe,setPreview:se,openRenameDesignDialog:$,getColorPaleteObj:ce}}(),DesignUI_=function(){"use strict";var e=["Design/Panel/init"],t=["Design/UserDesign/Save/Success","Design/UserDesign/Delete/Success","Design/OrgDesign/Save/Success","Design/OrgDesign/Delete/Success","Design/OrgDesign/Delete/Success","Design/OrgDesign/Retrieved","Document/themeChanged","Document/DefaultDesign/updated","Design/UserDesign/Rename/Success"],i=["Document/themeChanged","Document/StyleChanged","HeadingStyle/Add","HeadingStyle/Delete"],n=function(e,t){var i=DesignUI.getDesignName(),n=J("#design-menu-option"),o=i?i.type:null,r=(i?i.name:"Custom*",[]),a=[],s=[],l=[];i?o&&("writer"==o?(l=["#design-menu-actbtn-rename-design","#design-menu-actbtn-copy-org","#design-menu-actbtn-setasdefault"],r.push("#design-menu-actbtn-rename-design"),s.push("#design-menu-actbtn-copy-org"),s.push("#design-menu-actbtn-setasdefault")):"user"==o?(s=["#design-menu-actbtn-rename-design","#design-menu-actbtn-copy-org","#design-menu-actbtn-setasdefault"],l=s):"org"==o&&(s=["#design-menu-actbtn-setasdefault"],l.push("#design-menu-actbtn-setasdefault"),DesignUtil.isOrgAdmin()?(s.push("#design-menu-actbtn-rename-design"),l.push("#design-menu-actbtn-rename-design"),r.push("#design-menu-actbtn-copy-org")):(a.push("#design-menu-actbtn-rename-design"),a.push("#design-menu-actbtn-copy-org")))):(r=["#design-menu-actbtn-rename-design","#design-menu-actbtn-copy-org","#design-menu-actbtn-setasdefault"],l=r),r.length&&n.zmenu("setMenuItemsAttribute",r,"disabled",!0),s.length&&n.zmenu("setMenuItemsAttribute",s,"disabled",!1),l.length&&n.zmenu("setMenuItemsAttribute",l,"hidden",!1),a.length&&n.zmenu("setMenuItemsAttribute",a,"hidden",!0)},o=function(e,t){var i=e.originalEvent.target,n=i.closest("li");if(i.classList.contains("ui-design-carousel-span"))b(i);else if(i.parentNode.classList.contains("design-menu-save-as")||i.classList.contains("design-menu-save-as"))DesignUI.openDesignDialogForCurrentDesign(),J("#design-menu-option").zmenu("hide");else if(n.id&&"design-menu-actbtn-copy-org"==n.id){J("#design-menu-option").zmenu("hide");var o=DesignUI.getDesignName(),r=o?o.name:"",a=o?o.type:"";DesignUtil.copyToOrgDesign(r,a)}else if(n.id&&"design-menu-actbtn-setasdefault"==n.id){var s=DesignUI.getCurrentDesignSet();DesignUtil.setAsDefault(s),J("#design-menu-option").zmenu("hide")}else n.id&&"design-menu-actbtn-reset-default"==n.id?(DesignUtil.resetDesign(),J("#design-menu-option").zmenu("hide")):n.id&&"design-menu-actbtn-rename-design"==n.id&&(DesignUI.openRenameDesignDialog(),J("#design-menu-option").zmenu("hide"));return!1},r=function(){var e=DesignUI.getDesignName(),t=e?e.name:"Custom*",i=e?e.type:null;t="user"==i?t.replace("custom|",""):t;var n=document.body.querySelector("#design-manage-button .ui-zlblbtn-desc"),o=document.querySelector("#design-menu-option .ui-cdesign-menuitem .ui-style-set-cont-ttl");n&&(n.innerText=t),o.innerText=t},a=function(){var e=DesignUI.getDesignName(DesignUI.getDefaultDesign()),t=e?e.name:"",i=document.getElementById("default-tag"),n=document.body.querySelector("[data-design-name='"+t+"']"),o=DesignUI.getDesignName(),r=o?o.name:"",a=document.body.querySelector("[data-design-name='"+r+"']"),s=document.body.querySelector("#design-presetdesigns .is-selected"),l=document.body.querySelector("#design-orgdesigns .is-selected"),d=document.body.querySelector("#design-mydesigns .is-selected");if(s&&s.classList.remove("is-selected"),l&&l.classList.remove("is-selected"),d&&d.classList.remove("is-selected"),i||(i=document.createElement("div"),i.setAttribute("title",J.i18n("writer.common.DEFAULT")),i.setAttribute("id","default-tag"),i.className="ui-doctheme-preview-default-tag"),t&&n?n.parentNode.appendChild(i):i.style.display="none",r&&a){var a=document.body.querySelector("[data-design-name='"+r+"']");a.parentNode.classList.add("is-selected")}},s=function(e,t){var i=t.menuitem[0].getAttribute("designname"),n=t.menuitem[0].getAttribute("designtype"),o=t.menuitem[0].getAttribute("designid");i?DesignUtil.applyDesign(i,n,o):t.menuitem[0].classList.contains("doctheme-reset-default")&&DesignUtil.resetDesign()},l=function(e){var t=e.originalEvent.originalEvent;if(t&&J(t.target).closest(".ui-doctheme-actbtn-more").length){var i=J(t.target).closest(".ui-doctheme-actbtn-more"),n=J(t.target).closest(".ui-doctheme-cont")[0],o=document.getElementById("design-actbtn-delete"),r=document.getElementById("design-more-rename"),a=document.getElementById("design-actbtn-setasdefault"),s=document.getElementById("design-actbtn-copy-org"),l=document.getElementById("design-actbtn-edit-next-para-style"),d=n.getAttribute("designname"),c=n.getAttribute("designtype"),u=n.getAttribute("designid");return J("#design-more-options").zmenu("show",{forElement:J(i)}),J(i).addClass("ui-selected"),o.onclick=function(){J("#design-menu").zmenu("hide"),"user"==c?DesignUtil.deleteDocumentDesign(d,c):DesignUtil.deleteOrgDesign(u)},s.onclick=function(){J("#design-menu").zmenu("hide"),DesignUtil.copyToOrgDesign(d,c)},r.onclick=function(){J("#design-menu").zmenu("hide"),DesignUI.openRenameDesignDialog({name:d,type:c,id:u})},l.onclick=function(){J("#design-menu").zmenu("hide");var e=DesignUI.getDesignName(),t=!(!e||e.name!=d);StyleUI.openNextParaStyleDlg(c,d,u,t)},a&&(a.onclick=function(){J("#design-menu").zmenu("hide");var e={};if("user"==c?(e[ATTR_BODY.DS_STYLES]=SavedDesign[d][ATTR_BODY.DS_STYLES],e[ATTR_BODY.DS_THEME]=SavedDesign[d][ATTR_BODY.DS_THEME],e[ATTR_BODY.DS_STYLE_UI_INFO]=SavedDesign[d][ATTR_BODY.DS_STYLE_UI_INFO]):"writer"==c&&(e[ATTR_BODY.DS_STYLES]=DesignSets[d][ATTR_BODY.DS_STYLES],e[ATTR_BODY.DS_THEME]=DesignSets[d][ATTR_BODY.DS_THEME],e[ATTR_BODY.DS_STYLE_UI_INFO]=DesignSets[d][ATTR_BODY.DS_STYLE_UI_INFO]),"org"==c){var t=DesignUtil.getOrgDesign();e=ZWJSONUtils.clone(t[u].content)}else e=DesignUI.getCurrentDesignSet();DesignUtil.setAsDefault(e)}),!1}},d=function(){return!1},c=function(e,t){var i=DesignUI.getDesignName(),n=i?i.name:"",o=i?i.type:"";return"design-mydesigns"==t.menu[0].id&&0==Object.keys(SavedDesign).length?void t.menu.zmenu("setMenuItemsAttribute",[".doctheme-reset-default"],"hidden",!0):"design-orgdesigns"==t.menu[0].id&&0==Object.keys(DesignUtil.getOrgDesign()).length?void t.menu.zmenu("setMenuItemsAttribute",[".doctheme-reset-default"],"hidden",!0):(t.menu.zmenu("setMenuItemsAttribute",[".doctheme-reset-default"],"hidden",!1),void("writer"!=o||n!=DefaultDesignName?t.menu.zmenu("setMenuItemsAttribute",[".doctheme-reset-default"],"disabled",!1):t.menu.zmenu("setMenuItemsAttribute",[".doctheme-reset-default"],"disabled",!0)))},u=function(){var e=DesignUI.getDesignName(),t=e?e.name:"",i=e?e.type:"",n=[],o=[];i&&t?"user"==i?(n.push("#design-menu-my-design-list"),o.push("#design-menu-writer-design-list","#design-menu-org-design-list")):"writer"==i?(n.push("#design-menu-writer-design-list"),o.push("#design-menu-my-design-list","#design-menu-org-design-list")):(n.push("#design-menu-org-design-list"),o.push("#design-menu-my-design-list","#design-menu-writer-design-list")):o=["#design-menu-writer-design-list","#design-menu-my-design-list","#design-menu-org-design-list"],n.length&&J("#design-menu").zmenu("setMenuItemsAttribute",n,"checked",!0),o.length&&J("#design-menu").zmenu("setMenuItemsAttribute",o,"checked",!1),0==n.length?J("#design-menu").addClass("ui-menu-with-no-item-checked"):J("#design-menu").removeClass("ui-menu-with-no-item-checked"),J("#design-menu").zmenu("setMenuItemsAttribute",["#design-menu-my-design-list"],"description",Object.keys(SavedDesign).length+""),J("#design-menu").zmenu("setMenuItemsAttribute",["#design-menu-org-design-list"],"description",Object.keys(DesignUtil.getOrgDesign()).length+""),J("#design-menu").zmenu("setMenuItemsAttribute",["#design-menu-writer-design-list"],"description",Object.keys(DesignSets).length+"")},p=function(e,t){var i=t.forElement[0],n=i.parentNode,o=n.parentNode,r=[],a=[],s=o.getAttribute("designtype");n.hasAttribute("data-design-name")&&("user"==s?(a.push(J("#design-actbtn-setasdefault")),a.push(J("#design-actbtn-delete")),a.push(J("#design-more-rename")),DesignUtil.isOrgAdmin()?a.push(J("#design-actbtn-copy-org")):r.push(J("#design-actbtn-copy-org")),a.push(J("#design-actbtn-edit-next-para-style"))):"writer"==s&&o.classList.contains("is-selected")?(a.push(J("#design-actbtn-setasdefault")),DesignUtil.isOrgAdmin()?a.push(J("#design-actbtn-copy-org")):r.push(J("#design-actbtn-copy-org")),r.push(J("#design-actbtn-delete")),a.push(J("#design-actbtn-edit-next-para-style")),r.push(J("#design-more-rename"))):"writer"==s?(a.push(J("#design-actbtn-setasdefault")),DesignUtil.isOrgAdmin()?a.push(J("#design-actbtn-copy-org")):r.push(J("#design-actbtn-copy-org")),r.push(J("#design-actbtn-delete")),r.push(J("#design-actbtn-edit-next-para-style")),r.push(J("#design-more-rename"))):"org"==s&&(a.push(J("#design-actbtn-setasdefault")),r.push(J("#design-actbtn-copy-org")),DesignUtil.isOrgAdmin?(a.push(J("#design-actbtn-delete")),a.push(J("#design-actbtn-edit-next-para-style")),a.push(J("#design-more-rename"))):(r.push(J("#design-actbtn-delete")),r.push(J("#design-actbtn-edit-next-para-style")),r.push(J("#design-more-rename"))))),J("#design-more-options").zmenu("setMenuItemsAttribute",r,"hidden",!0),J("#design-more-options").zmenu("setMenuItemsAttribute",a,"hidden",!1)},g=function(){J(".ui-doctheme-actbtn-more").removeClass("ui-selected")},f=function(){var e=[];for(var t in DesignSets){var i=DesignSets[t];e.push(E(i,t,"writer"))}J("#design-presetdesigns").zmenu("addMenuItems",e),h(),r(),A(null,"design_menu_","design_menu_heading_preview")},E=function(e,t,i,n,o){var r=DesignUI.getDesignPreview(t,e,o),a={};return a.innerHTML=r.innerHtml,a.itemType="radio",a.custom=!0,a.customAttributes={class:"ui-doctheme-cont",name:"designtype",designType:i,designName:t,designid:n},a},T=function(e){J("#design-gallery-button").zmenubutton("setAttribute","disabled",!1),_()},m=function(e){J("#design-gallery-button").zmenubutton("setAttribute","disabled",!1)},h=function(e){var t=[],i=document.getElementById("design-mydesigns").querySelectorAll("[designtype='user']");i.forEach(function(e){e.parentNode.removeChild(e)});var n=Object.keys(SavedDesign);n.sort(function(e,t){return DesignUI.compareStrings(e,t)});for(var o=0,r=n.length;o<r;o++){var a=SavedDesign[n[o]];t.push(E(a,n[o],"user"))}t.length&&J("#design-mydesigns").zmenu("addMenuItems",t),J("#design-mydesigns").zmenu("setMenuItemsAttribute",["#design-user-empty"],"hidden",!!t.length)},I=function(){J("#design-gallery-button").zmenubutton("setAttribute","disabled",!0)},_=function(){var e=DesignUtil.getOrgDesign(),t=document.getElementById("design-orgdesigns").querySelectorAll("[designtype='org']");t.forEach(function(e){e.parentNode.removeChild(e)});var i=[];for(var n in e){var o=e[n].content,r=e[n].name;i.push(E(o,r,"org",n,!DesignUtil.isOrgAdmin()))}i.length&&J("#design-orgdesigns").zmenu("addMenuItems",i),J("#design-orgdesigns").zmenu("setMenuItemsAttribute",["#design-org-empty"],"hidden",!!i.length)},A=function(e,t,i){var n=DocUtil.getRenderingFormat(e?e.styles:DocumentDesign.getStyles(),DocumentDesign.getTheme());i&&O(document.getElementById(i),n,t),R(n,t)},S=function(e,t,i){return J('<div class="'+i+e+'">'+Utils.encodeHTMLString(t)+"</div>")[0]},R=function(e,t){for(var i=Object.keys(e.para),n=function(e){var t=DocUtil.copyStyle(s.styles);t.hasOwnProperty("font-size")&&(t["font-size"]=parseInt(.7*parseInt(t["font-size"]))),J(e).css(t)},o=0;o<i.length;o++){var r=J("."+t+i[o]);J(r).removeAttr("style");var a=e.para[i[o]],s=Utils.getStyle(a.textFormat);delete a[ATTR_PARAGRAPH.PS_LS],delete a[ATTR_PARAGRAPH.PS_SA],delete a[ATTR_PARAGRAPH.PS_SB],delete a[ATTR_PARAGRAPH.PS_ML],delete a[ATTR_PARAGRAPH.PS_MR],delete a[ATTR_PARAGRAPH.PS_TI],delete a[ATTR_PARAGRAPH.PS_PL];var l=Utils.getStyle(a);U.each(r,n),J(r).css(l.styles)}},O=function(e,t,i){var n=t.para;for(var o in n){var r=parseInt(o.substr(1)),a=n[o].info.cs_name;r<=106||e.append(S(o,a,i))}},b=function(e){var t=document.body.querySelector("#design-menu-option .ui-design-dialog-page-preview"),i=document.body.querySelector("#design-menu-option .ui-design-dialog-heading-preview");e.parentNode.querySelector(".active").classList.remove("active"),e.classList.contains("page-preview")?(t.style.display="block",e.classList.add("active"),i.style.display="none",i.classList.remove("active")):(t.style.display="none",t.classList.remove("active"),i.style.display="block",e.classList.add("active"))},v=function(){f(),D(),PubSub.subscribe(t,function(){a(),r()}),PubSub.subscribe(i,function(){A(null,"design_menu_","design_menu_heading_preview")}),PubSub.subscribe("Design/UserDesign/Save/Success",h),PubSub.subscribe("Design/UserDesign/Delete/Success",h),PubSub.subscribe("Design/UserDesign/Rename/Success",h),PubSub.subscribe("Design/OrgDesign/Save/Success",_),PubSub.subscribe("Design/OrgDesign/Delete/Success",_),PubSub.subscribe("Design/OrgDesign/Retrieved",T),PubSub.subscribe("Design/OrgDesign/Retrieve/Failed",m),PubSub.subscribe("Design/OrgDesign/RetrieveStarts",I)};e.forEach(function(e){PubSub.subscribeOnce(e,v)});var D=function(){PubSub.unsubscribe(e,v)};return{subMenuItemClickOfDesignMenu:s,beforeSubMenuItemClickOfDesignMenu:l,beforeDesignSubMenuShow:c,beforeDesignMenuClick:d,beforeDesignMenuShow:u,beforeDesignMoreMenuShow:p,beforeDesignMoreMenuClose:g,beforedesignMenuOptionShow:n,beforedesignMenuOptionClick:o,swapPreview:b}}(),function(){window.FormatPanel={bindEvents:function(){var e=J("#menuFormat");e.find(":checkbox").on("click",function(e,t){var i=J(e.target);ToolbarHandler.handleUIEvents(i,t)}),e.find("[ctype=zmenu], [ctype_lazy=zmenu], [zw-ctype=zmenu], [zw-ctype_lazy=zmenu]").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),J("#fmt-lpnl-designmenulist").bind("zmenusubmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)});var t=J("#fmt-lpnl-fontsize");t.bind("comboshow",function(e){e.currentTarget.selectedIndex=-1}),t.bind("zcomboboxchange",ToolbarHandler.fontComboChangeHandler),J("#fmt-lpnl-txtdir").bind("zselectboxchange",ToolbarHandler.fontComboChangeHandler),J("label[for=fmt-lpnl-painter]").bind("dblclick",function(e){editor.doc.paintFormat_dblClick=!0,PubSub.publish("Document/DocumentDblClick",e)}),J("#fmt-lpnl-charspacemenu,#fmt-lpnl-headingmenulist,#fmt-lpnl-linespacemenu,#fmt-lpnl-blockquote").bind("zmenuhide",function(){setTimeout(function(){EditorUtil.focusMultiByteSpan()},10)}),J("#fmt-lpnl-fgcolor,#fmt-lpnl-bgcolor").on("zcolorsplitbuttonbeforepickeropen",function(e,t){var i,n="fmt-lpnl-fgcolor"==this.id||"textforegroundcolorDropDown-smart"==this.id;i=n?editor.doc.getSelection().getComputedTextFormat().fgc:editor.doc.getSelection().getComputedTextFormat().bgc;var o=J("#writer-colorpicker");if(i&&"transparent"!=i){var r=ZWColorUtils.rgbToHex(Utils.getColorValFromRefString(i)).toUpperCase();o.find(".zcolorpicker__colorcode").text(r),o.find(".zcolorpicker__colorelem").css("background",r)}else o.zcolorpicker("options",{clrlbl:!1})})},init:function(){UIUtils.initComponent(ELEM_ID.FORMATPANEL),FormatPanel.bindEvents(),LeftPanel.bindCloseBtn(ELEM_ID.FORMATPANEL);var e=J("#menuFormat");UIUtils.uiFontStyle=UIUtils.jToolbarComp.find("#fmt-lpnl-headingmenubtn,#fmt-lpnl-sub-headingmenubtn,#smart-headingmenubtn,#paraPropformat_headingStyle"),UIUtils.defaultFontSize=J("#fmt-lpnl-fontsize,#smart_fontSize"),UIUtils.uiTextAlignment=UIUtils.jToolbarComp.find("#fmt-lpnl-textalign, #pcm-text-alignment, #fmt-lpnl-sub-textalign"),UIUtils.uiParaDir=e.find("#fmt-lpnl-sub-dircontainer"),FontSizeCombo.addAllDefaultFontSizeInCombo("fmt-lpnl-fontsize"),Toolbar.updateToolbar()}}}(),function(){window.InsertPanel={bindEvents:function(){var e=J("#menuInsert");e.find("[ctype=zmenu], [ctype_lazy=zmenu], [zw-ctype=zmenu], [zw-ctype_lazy=zmenu]").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),J("#chartsmenu,#headerstyles,#footerstyles").bind("zmenuhide",function(){setTimeout(function(){EditorUtil.focusMultiByteSpan()},10)})},init:function(){InsertPanel.bindEvents(),UIUtils.initComponent(ELEM_ID.INSERTPANEL),LeftPanel.bindCloseBtn(ELEM_ID.INSERTPANEL),TablePopupHandler.bindEvents(),ZSignController.fetchSignImages()}}}(),zw.define("WorkflowView",[],["MarkAsReady","PubSub","ReviewUtil","ZWJSONUtils"],function(e,t,i,n){var o=function(i,o){this.workflow=i,this.workflowConfig=o,this.popover=J("#workflow-popover"),this.flowMapData={tabs:[],lastActiveTab:null,activeTab:null,yetToTabs:{}},this.workflowStateInfo={activeStateId:null,lastActiveStateId:null,buttonsInfo:[]},this.trackOperations=function(e){var t="Workflow";if("popover-open"===e){var i=this.workflow.currentState.id;e=i[0].toUpperCase()+i.substr(1)+"PopoverOpen"}else if("state-open"===e){var n=this.flowMapData.activeTab;e=n[0].toUpperCase()+n.substr(1)+"StateOpen"}ActivityTracker.track(t,e,"TopBand")},this.renderPopElement=function(){this.resetPopover(),this.renderFlowmap(),this.setPopoverWidth(),this.renderFlowmapStateContent(this.workflow.currentState),this.trackOperations("popover-open")},this.resetPopover=function(){this.popover[0].style.width="auto",this.popover.html("")},this.setPopoverWidth=function(){var e=this.popover[0],t=e.getBoundingClientRect(),i=t.right-t.left;i<330&&(i=330),document.getElementById("workflow-popover").style.width=i+"px"},this.closePopover=function(){this.popover.zpopover("close")},t.subscribe("Workflow/PopoverOpened",this.renderPopElement.bind(this)),t.subscribe("Workflow/ClosePopover",this.closePopover.bind(this)),this.bindActionButtonEvents=function(){for(var e=this.workflowStateInfo.buttonsInfo,t=this,i=0;e&&i<e.length;i++){var n=e[i].element,o=e[i].event,r=e[i].callback,a=function(){r&&r(),t.closePopover()};J("#"+n).on(o,a)}},this.setFlowMapData=function(e,t,i,n){"preserve"!==e&&(this.flowMapData.tabs=e),this.flowMapData.lastActiveTab=t,this.flowMapData.activeTab=i,"preserve"!==n&&(this.flowMapData.yetToTabs=n)},this.setworkflowStateInfo=function(e,t){this.workflowStateInfo.lastActiveStateId=this.workflowStateInfo.activeStateId,this.workflowStateInfo.activeStateId=e,this.workflowStateInfo.buttonsInfo=t},this.refreshUI=function(e,t){this.updateWorkflow(e,t),this.renderLabelElement(),this.closePopover()},this.updateWorkflow=function(e,t){this.workflow=e,this.workflowConfig=t},this.renderLabelElement=function(){if(this.isSingleStateWorkflow())document.getElementById("workflow-btn").style.display="none";else{var e=this.getStateConfig(this.workflow.currentState.id);document.getElementById("workflow-btn").innerHTML=J.i18n(e.name),document.getElementById("workflow-btn").style.display="block";var t=document.getElementsByClassName("js-junior-workflow-container")[0];"draft"===this.workflow.currentState.id||t.classList.add("ui-wf-btn-with-pencil-ready")}},this.getStateConfig=function(e){for(var t=this.workflowConfig.states,i=0;i<t.length;i++)if(e===t[i].id)return t[i]},this.renderFlowmapStateContent=function(t){var i,n=this.getStateConfig(t.id);t.stateConfig=n;var o=[];switch(t.id){case"draft":if(t===this.workflow.currentState&&("teamdrive"===editorProps.permissionsInfo.appInfo.NAME||"screenplay"===editorProps.permissionsInfo.appInfo.NAME)){var r={};r.id="mark-ready",r.name=J.i18n("writer.common.MARK_AS_READY"),t.actions=[r];var a={};a.event="click",a.element="workflow-mark-ready-button",a.callback=e.markComplete,o.push(a)}i=this.getHTMLContentForDraftState(t);break;case"ready":i=this.getHTMLContentForReadyState(t);break;case"published":var s=this.customisePublishStateProperties(t);i=this.getHTMLContentForPublishedState(s);break;case"final":i=this.getHTMLContentForFinalState(t);break;case"signed":case"sign-pending":case"sign-expired":case"sign-declined":case"sign-recalled":if(this.workflow.currentState===t||"sign-recalled"===this.workflow.currentState.id)var l=this.customiseSignStateProperties(t);else{var s={};Object.assign(s,this.workflow.currentState),s.id=t.id;var l=this.customiseSignStateProperties(s)}l.stateConfig=n,i=this.getHTMLContentForSignState(l);break;case"blog-publish-in-progress":case"blog-publish-failed":case"published-in-blog":var s=this.customisePostToBlogProperties(t);i=this.getHTMLContentForBlogPublishState(s)}this.popover.append(i),this.setworkflowStateInfo(t.id,o),this.bindActionButtonEvents(),this.addTooltipForEllipsizedElements(),this.trackOperations("state-open")},this.renderFlowmap=function(){for(var e={},t=[],i=[],n=this.workflow.currentState,o=this.workflow.completedStates,r=o.length,a=0;a<r;a++){var s={};s=this.getStateConfig(o[a].id),t.push(s)}if("draft"===n.id){var l={};l=this.getStateConfig(n.id),l.isActive=!0;var d={};d=this.getStateConfig("ready"),d.inactive="true",i.push(d.id),t.push(l),t.push(d)}else{var s={};s=this.getStateConfig(n.id),t.push(s)}e.tabs=t,this.setFlowMapData(t,n.id,n.id,i);var c=this.getHTMLContentForFlowmap(e);this.popover.html(c),this.toggleToStateOnClick(t)},this.customisePublishStateProperties=function(e){var t=n.clone(e);return t.properties.published_url=DomUtil.getPublishURL(),"external"===t.properties.scope?t.properties.scope=J.i18n("writer.common.PUBLISHED_EXTERNALLY"):t.properties.scope=J.i18n("writer.common.PUBLISHED_WITHIN_ORG"),t},this.isSingleStateWorkflow=function(){var e=!1,t=this.workflowConfig.states.length;return 1===t&&(e=!0),e},this.customisePostToBlogProperties=function(e){var t=n.clone(e),i=e.id,o=t.properties.scheduledTime,r=t.properties.serviceName;if(o){var a=new ZWDateTime(o,null,editorProps.userInfo.language);t.properties.scheduledTime=a.format("MMM DD YYYY hh mm")}return"wordpress"===r?t.properties.serviceName=J.i18n("writer.common.WORD_PRESS"):t.properties.serviceName=J.i18n("writer.common.BLOGGER"),"published-in-blog"===i?t.properties.isPublished=!0:"blog-publish-in-progress"===i?t.properties.isScheduled=!0:"blog-publish-failed"===i&&(t.properties.failed=!0),t},this.customiseSignStateProperties=function(e){for(var t={},i=[],n=[],o=[],r=[],a={},s={},l={},d={},c=[],u=e.properties.recipients_status_info,p=0;u&&p<u.length;p++)if("EXPIRED"===u[p].action_status){var g={};g.recipientMail=u[p].recipient_email,g.image="",o.push(g)}else if("DECLINED"===u[p].action_status){var f={};f.recipientMail=u[p].recipient_email,f.image="",r.push(f)}else if("SIGNED"===u[p].action_status){var E={};E.recipientMail=u[p].recipient_email,E.image="",E.time=u[p].signed_time,n.push(E)}else{var T={};T.recipientMail=u[p].recipient_email,T.image="",i.push(T)}i.length&&(a.label=J.i18n("writer.common.SIGN_PENDING_MEMBERS"),a.recipientDetails=i,c.push(a)),o.length&&(l.label=J.i18n("writer.common.SIGN_EXPIRED_MEMBERS"),l.recipientDetails=o,c.push(l)),r.length&&(s.label=J.i18n("writer.common.SIGN_DECLINED_MEMBERS"),s.recipientDetails=r,c.push(s)),n.length&&(d.label=J.i18n("writer.common.SIGNED_MEMBERS"),d.recipientDetails=n,c.push(d));var m={};return m.properties=c,m.id=e.id,m.description=e.description,"sign-pending"!==e.id&&"sign-recalled"!==e.id||(m.startedBy=e.properties.started_by,m.startedAt=e.startTime,m.startedByLabel="sign-pending"===e.id?"writer.common.SIGN_INITIATED_BY":"writer.common.SIGN_RECALLED_BY"),editor.zuid===e.properties.started_by?m.isCurrentSignFlowInitiator=!0:m.isCurrentSignFlowInitiator=!1,t.state=m,t},this.isStateDone=function(e){for(var t=this.flowMapData.yetToTabs,i=0;i<t.length;i++)if(e===t[i])return!1;return!0},this.bindStateContent=function(){var e=event.target.id,t="-li"===e.slice(-3);if(t&&(e=e.slice(0,e.length-3)),this.isStateDone(e)){this.removeStateElementFromPopover();var i=this.flowMapData.activeTab;this.setFlowMapData("preserve",i,e,"preserve"),this.setActiveStatePointer();var n=this.getStateFromStateId(e);this.renderFlowmapStateContent(n)}},this.toggleToStateOnClick=function(e){for(var t=0;t<e.length;t++)J("#"+e[t].id+"-li").on("click",this.bindStateContent.bind(this))},this.setActiveStatePointer=function(){var e=this.flowMapData.activeTab,t=this.flowMapData.lastActiveTab;t&&J("#"+t+"-li").removeClass("is-active"),J("#"+e+"-li").addClass("is-active")},this.getStateFromStateId=function(e){var t=this.workflow.currentState;if(t.id===e)return t;for(var i=0;i<this.workflow.completedStates.length;i++){var n=this.workflow.completedStates[i];if(n.id===e)return n}return null},this.removeStateElementFromPopover=function(){var e=this.workflowStateInfo.activeStateId,t=J("#box-"+e);t.remove()},this.getHTMLContentForFlowmap=function(e){var t=document.getElementById("workflow-Flowmap").innerHTML,i=Handlebars.compile(t),n=i(e);return n},this.getHTMLContentForDraftState=function(e){var t=document.getElementById("workflow-draft-State").innerHTML,i=Handlebars.compile(t),n=i(e);return n},this.getHTMLContentForReadyState=function(e){var t=document.getElementById("workflow-ready-State").innerHTML,i=Handlebars.compile(t),n=i(e);return n},this.getHTMLContentForPublishedState=function(e){var t=document.getElementById("workflow-published-State").innerHTML,i=Handlebars.compile(t),n=i(e);return n},this.getHTMLContentForFinalState=function(e){var t=document.getElementById("workflow-final-State").innerHTML,i=Handlebars.compile(t),n=i(e);return n},this.getHTMLContentForSignState=function(e){var t=document.getElementById("workflow-sign-State").innerHTML,i=Handlebars.compile(t),n=i(e);return n},this.getHTMLContentForBlogPublishState=function(e){var t=document.getElementById("workflow-blog-publish-State").innerHTML,i=Handlebars.compile(t),n=i(e);return n},this.addTooltipForEllipsizedElements=function(){var e=document.getElementById("workflow-popover"),t=e.querySelectorAll(".ui-wflow-user-name"),i=e.querySelectorAll(".ui-wflow-user-time"),n=e.querySelectorAll(".ui-wflow-user-mailid");this.addTitleForElements(t),this.addTitleForElements(i),this.addTitleForElements(n)},this.addTitleForElements=function(e){e.forEach(function(e){e.clientWidth<e.scrollWidth&&e.setAttribute("title",e.innerText)})},this.renderLabelElement()};return o}),zw.define("WorkflowModel",[],["PubSub","ZWNetworkUtils"],function(e,t){var i={},n={},o=function(){var e=new Deferred;return t.ajax({url:t.getContextUrl("api/v1/workflows/"+editor.doc.docInfo.RID),dataType:"json",type:"GET",success:function(t){t.workflow?e.resolve(t):e.reject(t)},error:function(t){e.reject(t)}}),e.promise()},r=function(e){var i=new Deferred,n={};return n.wid=e,t.ajax({url:t.getContextUrl("api/v1/workflows/"+editor.doc.docInfo.RID+"/getconfiguration"),data:n,dataType:"json",type:"GET",success:function(e){i.resolve(e)},error:function(e){i.reject(e)}}),i.promise()},a=function(){var e=editor.doc.docInfo.newDoc;e||l()},s=function(t,o){o!=editor.uuid&&t&&(i=t,r(i.wid).done(function(t){n=t.workflowConfig,e.publish("Document/UpdateWorkflowView",i,n)}).fail(function(e){var t=J.i18n("writer.common.ERROR"),i=J.i18n("writer.common.WORKFLOW_FAILED_MSG");MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,t,i,null,null)}))},l=function(t){t!=editor.uuid&&o().done(function(t){i=t.workflow,r(i.wid).done(function(t){n=t.workflowConfig,e.publish("Document/UpdateWorkflowView",i,n)}).fail(function(e){var t=J.i18n("writer.common.ERROR"),i=J.i18n("writer.common.WORKFLOW_FAILED_MSG");MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,t,i,null,null)})}).fail(function(e){if(500==e.status){var t=J.i18n("writer.common.ERROR"),i=J.i18n("writer.common.WORKFLOW_FAILED_MSG");MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,t,i,null,null)}})},d=function(){return i},c=function(){return i.currentState&&"ready"===i.currentState.id};return{init:a,updateWorkflow:s,getWorkflow:d,fetchAndUpdateWorkflow:l,isWorkflowInReadyState:c}}),zw.define("Workflow",[],["PubSub","WorkflowModel","WorkflowView"],function(e,t,i){var n,o=editor.doc.docInfo.newDoc,r=function(){var e=editor.getRole().permissions.can("workflow.state.view");return e},a=function(){var e=!1,t=editorProps.permissionsInfo.appInfo.NAME;return"WRITER"!==t&&"teamdrive"!==t&&"MACAPP_WD"!=t&&"MACAPP_DOCS"!=t&&"screenplay"!==t||(e=!0),e},s=function(){var e=editor.doc.docInfo.CHECKEDOUT&&editor.doc.docInfo.CHECKEDOUTBY_ZUID!==editor.zuid;return e},l=function(){var e=new Deferred,i=t.getWorkflow();return"sign"===i.wid?e.resolve():e.reject(),e.promise()};r()&&a()&&!s()&&e.subscribeOnce("Document/ComponentInitialized",t.init);var d=function(){e.publish("Workflow/PopoverOpened")};createOrUpdateWorkflowView=function(e,t){r()&&("undefined"==typeof n?n=new i(e,t):n.refreshUI(e,t))};var c=function(){e.publish("Workflow/ClosePopover")},u=function(){o&&(e.publish("Document/firstVersionChange"),e.publish("Document/Update/Permission"))},p=function(){var e=t.getWorkflow();if(e&&r()&&"teamdrive"==editorProps.permissionsInfo.appInfo.NAME&&"draft"==e.currentState.id){var i={};i.action="mark-ready",i.sid=editor.uuid,ZWNetworkUtils.ajax({url:ZWNetworkUtils.getContextUrl("api/v1/workflows/"+editor.doc.docInfo.RID+"/invokeready"),data:i,dataType:"json",type:"POST",success:function(i){var n=i.workflow;n.currentState&&"draft"==e.currentState.id&&t.updateWorkflow(n)},error:function(e){},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})}};return r()&&a()&&!s()&&(e.subscribe("Document/UpdateWorkflowView",createOrUpdateWorkflowView),e.subscribe("Document/WorkflowUpdated",t.updateWorkflow),e.subscribe("Document/PublishInfoUpdated",t.fetchAndUpdateWorkflow),e.subscribe("Document/FinalStateUpdated",t.fetchAndUpdateWorkflow),e.subscribe("Document/SignWorkflowInitiated",t.fetchAndUpdateWorkflow),e.subscribeOnce("DocInfo/newDoc/modified",u),e.subscribe("Document/firstVersionChange",t.fetchAndUpdateWorkflow),e.subscribe("Document/PostBloggedorScheduled",t.fetchAndUpdateWorkflow),e.subscribe("Document/MarkedReady",p),e.subscribe("Document/Workflow/MarkedReady",t.updateWorkflow)),{allowDefaultSignFlowBehaviour:l,onPopoverOpen:d,closePopover:c,invokeReady:p}});var Events=function(){var e=function(e){return e.target||e.srcElement},t=function(){J("body").bind("mousemove",function(e){PubSub.publish("Document/MouseMove",e)}),J(document).bind("mouseup",function(e){PubSub.publish("Document/MouseUp",e)}),J(".header_primary").bind("mouseenter",function(e){PubSub.publish("Document/HeaderMouseEnter",e)}),J(".footer_primary").bind("mouseenter",function(e){PubSub.publish("Document/FooterMouseEnter",e)}),J(".header_primary").bind("mouseleave",function(e){PubSub.publish("Document/HeaderMouseLeave",e)}),J(".footer_primary").bind("mouseleave",function(e){PubSub.publish("Document/FooterMouseLeave",e)}),Z(ELEM_ID.EDITOROUTERDIV)[0].addEventListener(MouseWheelEvent,function(e){PubSub.publish("Editor/WheelEvent")},!1),document.addEventListener("keydown",function(e){27==e.keyCode&&PubSub.publish("DOM/ESCKeyPressed",e)},!1)};return{bindEvents:t,getTarget:e}}(),LeftPanel=function(){"use strict";function e(e,t){if(e.loadInIframe)c(t,Macros.getPanelUrl(e.src),e.name);else{var i=e.urls||{},n=e.modules||[];zw.require(i,n,u,l,{element:t})}}var t={HAMBURGERICON:"topband-hamburger",PANELCONTAINER:"panel-container",MAINPANELCONTAINER:"mainpanel-container",TAB_CONTAINER:"tab-container",SUBPANELCONTAINER:"subpanel-container",FORMATPANEL:"menuFormat",INSERTPANEL:"menuInsert",VIEWPANEL:"menuView",PAGELAYOUTPANEL:"subpanel-pagelayout",CHARTPANEL:"mergeChart-leftPanel",SCENEPANEL:"subpanel-scene",CHARACTERSPANEL:"subpanel-characters",REPORTSPANEL:"subpanel-reports",TOOLSPANEL:"menuTools",AUTOMATIONPANEL:"automationPanel",IMAGEOPTIONSPANEL:"subpanel-img",TABLEOPTIONSPANEL:"subpanel-table",HEADEROPTIONSPANEL:"menuHeaderFooter",IMPORTPANEL:"importtoolbar",MMPANEL:"mm-mainpanel",BARCODEQRCODEPANEL:"subpanel-barcodeqrcode",WORDPRESSPANEL:"wordpress-subpanel",PARAGRAPHOPTIONPANEL:"subpanel-para",EMBEDOPTIONPANEL:"embedOptions",TOCPANEL:"subpanel-toc",WATERMARKPANEL:"watermark-panel",POSTTOBLOG:"menuposttoblog",DROPCAPPANEL:"dropcap-panel",TABLETHEMEPANEL:"subpanel-tabletheme",PAGENUMBERPANEL:"subpanel-pagenumber",NOTEPANEL:"subpanel-note",PAGEBORDERSPANEL:"subpanel-pageborders",BLOGGERPANEL:"blogger-subpanel",FORMOPTIONSPANEL:"field-properties",INSERTFIELDSPANEL:"fillableFields",ESIGNPANEL:"subpanel-esign",DIGISIGNPANEL:"subpanel-digisign",POSTTOBLOGPANEL:"subpanel-posttoblog",INSERTFIELDPANEL:"subpanel-inserfield",MERGEFIELDPANEL:"subpanel-mergefield",FINISHMODETOOLBARCONTAINER:"complete-tb",LABELPANEL:"labelToolbar",TEXTBOXPANEL:"subpanel-textbox",MARKETPLACEPANEL:"marketplace-panel",IMAGEEDITALIGN:"imageeditalign",INSERTFILLABLEFIELDS:"subpanel-insertfillablefield",INSERTSIGNERFIELDS:"subpanel-insertsignerfield",FILLABLEFIELDSPANEL:"menu-fillable-field",CITATIONPANEL:"subpanel-citation"},i={menuFormat:"#menu-fmt",menuInsert:"#menu-insert","subpanel-inserfield":"#menu-field","subpanel-pagelayout":"#menu-pagelayout","subpanel-scene":"#menu-scene","subpanel-characters":"#menu-characters","subpanel-reports":"#menu-reports",menuTools:"#menu-tools",automationPanel:"#automation-menu","marketplace-panel":"#extension-menu","subpanel-img":"#menu-img","subpanel-barcodeqrcode":"#menu-imgfield,#menu-barcode,#menu-qrcode","subpanel-table":"#menu-table",menuHeaderFooter:"#menu-headerfooter",menuView:"#menu-view","field-properties":"#menu-form",designpanel:"#menu-design",menuLabel:"#menu-label","subpanel-textbox":"#menu-textbox","subpanel-insertfillablefield":"#menu-fillable-field","subpanel-insertsignerfield":"#menu-signer-field","mergeChart-leftPanel":"#menu-mergeChart","subpanel-citation-source":"#menu-citation-source","subpanel-citation-source-view":"#menu-citation-source-view"},n=function(e,t){i[e]=t},o=["subpanel-table","subpanel-tabletheme","subpanel-digisign","subpanel-inserfield","subpanel-mergefield","mm-mainpanel","dropcap-panel","imageeditalign","subpanel-insertfillablefield","subpanel-insertsignerfield","menuInsert","menuFormat","subpanel-pagelayout","watermark-panel"],r='.ui-tab-icon.##newIconClassName## { background-image: url("##bgurl##"); background-repeat:no-repeat;}.ui-tab-icon{width:25px;height:25px;display:inline-block;}',a=function(e){if(e.module)return'<a module="'+e.module+'" id='+e.id+'><div class="${tabObj.class}"></div><div class="ui-menu-text">'+e.label+"</div></a>";if(e.onclick)return'<a onclick="'+e.onclick+'" id="'+e.id+'"><div class="'+e.class+'"></div><div class="ui-menu-text">'+J.i18n(e.label)+"</div></a>";var t="LeftPanel.showSubPanel('"+e.associatedPanelID+"', 'FADEIN');";return'<a onclick="'+t+'" id="'+e.id+'"><div class="'+e.class+'"></div><div class="ui-menu-text">'+J.i18n(e.label)+"</div></a>"},s=function(e){var t=document.createElement("li"),n="ui-tab-icon";if("url"==e.icon.type){var o="ui-"+e.name+"-tab",s=document.createElement("style");s.innerHTML=r.replace("##newIconClassName##",o).replace("##bgurl##",e.icon.src),document.head.appendChild(s),n+=" "+o}else n+=" "+e.icon.className;e.class=n;var l=a(e);t.innerHTML=l,Z.insertAt.call(Z(ELEM_ID.TAB_CONTAINER)[0],e.position,t),i[e.associatedPanelID]="#"+e.id},l=function(){},d=function(t){var i=document.createElement("div");i.id=t.id,i.className="ui-vertical-sub-nav",e(t,i),Z(ELEM_ID.SUBPANELCONTAINER)[0].appendChild(i),t.loadInIframe&&PubSub.publish("LeftPanel/IframeAdded",t.name+"-frame")},c=function(e,t,i){var n=document.createElement("iframe");n.setAttribute("src",t),n.style.width="100%",n.style.height="100%",n.style.borderStyle="none",n.setAttribute("id",i+"-frame"),e.appendChild(n)},u=function(){var e,t=arguments.length-1,i=Array.prototype.splice.call(arguments,t)[0],n="";for(e in i)n+=i[e];n&&(this.element.innerHTML=n);for(var o=0;o<t;o++)arguments[o].init()},p=[],g=[],f=function(){for(var e=editorProps.viewInfo.view.tabs,t=editorProps.viewInfo.view.panels,i=editorProps.viewInfo.panels,n=editorProps.viewInfo.tabs,o=0,r=t.length;o<r;o++){var a=t[o],s=i[a];s.name=a,s.id="zw-"+a+"-panel",p.push(s)}for(var o=0,r=e.length;o<r;o++){var l=e[o],d=n[l];d.name=l,d.id="zw-"+l+"-tab",d.associatedPanelID="zw-"+l+"-panel",g.push(d)}},E={},T=[],m=function(){jQuery.extend(ELEM_ID,t),E[ELEM_ID.PANELCONTAINER]=E[ELEM_ID.MAINPANELCONTAINER]=E[ELEM_ID.SUBPANELCONTAINER]=!1,G(),ZWOffline.isOfflineSetupDone()&&editor.isOffline()||f();for(var e=0,i=p.length;e<i;e++)LeftPanel.addPanel(p[e]);for(var e=0,i=g.length;e<i;e++)LeftPanel.addTab(g[e])},h=function(e){var t=I(e);return t>=0?{index:t,panelObj:T[t]}:null},I=function(e){for(var t=0,i=S();t<i;t++)if(T[t].panelId==e)return t;return-1},_=function(e,t){t>=0?T.splice(t,0,e):T.push(e),PubSub.publish("BeforePanelOpen",e.panelId)},A=function(e){var t=I(e);T.splice(t,1),PubSub.publish("BeforePanelClose",e)},S=function(){return T.length},R=function(){var e=T.length;return e>0?T[e-1]:null},O=function(){for(var e=S(),t=0;t<e;t++){var i=R();V(i.panelId)}},b=function(){var e=0;return v(ELEM_ID.PANELCONTAINER)&&(e=Z(ELEM_ID.PANELCONTAINER)[0].offsetWidth),e},v=function(e){return E[e]},D=function(e,t){E[e]=t},L=function(e){return!!i[e]},N=function(){var e=R();return e?e.zIndex+1:101},P=function(e){var t=Z(e).find(".js-panel-close-btn");L(e)?t.hide():(t.show(),t.bind("click",LeftPanel.closeSubPanel))},C=function(e){var t=Z(e).find(".js-panel-close-btn");t.unbind("click",LeftPanel.closeSubPanel)},y=function(e){var t=i[e];t&&J(t).removeClass("ui-active-mnpanel")},F=function(e){var t=i[e];t&&J(t).addClass("ui-active-mnpanel")},M=function(e){var t=Z(ELEM_ID.HAMBURGERICON);"active"==e?t.addClass("ui-blue-bg"):t.removeClass("ui-blue-bg")},w=function(){if(LayoutManager.isRichEditActive())LayoutManager.toggleRichEdit("close");else{editor.doc.docInfo.newDoc&&J("#ins-lpnl-version").disable();var e=Macros.defaultLeftPanel();PubSub.publish(e+"/open",{operation:"leftPanelOpen"}),ZWLogger.addToStatistics("Hamburger")}},U={FADEOUT:function(e){W(e.target.id)},FADEIN:function(e){Z(ELEM_ID.SUBPANELCONTAINER).removeClass("ui-subpanel-bg")},FLIPOUT:function(e){W(e.target.id),!v(ELEM_ID.MAINPANELCONTAINER)&&S()<=0&&(ee(ELEM_ID.SUBPANELCONTAINER),ee(ELEM_ID.PANELCONTAINER))}},x={SLIDEOUT:function(e){O(),ee(ELEM_ID.MAINPANELCONTAINER),ee(ELEM_ID.SUBPANELCONTAINER),W(ELEM_ID.PANELCONTAINER),Z(ELEM_ID.SUBPANELCONTAINER)[0].style.marginTop=""}},B=function(){LayoutManager.isRichEditActive()||LeftPanel.closeSubPanel()},H=function(){var e=document.getElementById("wmstoolbar"),t=e&&e.offsetHeight,i=Z(ELEM_ID.PANELCONTAINER)[0],n=Z(ELEM_ID.SUBPANELCONTAINER)[0],o=window.innerHeight-(i.offsetTop+t);i.style.height=o+"px",LayoutManager.isRichEditActive()||(o+=i.offsetTop),n.style.height=o+"px"},G=function(){PubSub.subscribe("DOM/ESCKeyPressed",B),PubSub.subscribe("Document/Resize",H)},k=function(e){var t=Z(e);t.show()},W=function(e){var t=Z(e);t[0].style.zIndex="",t.hide()},Y=function(e,t){var i=e.index,n=e.panelObj;V(n.panelId),t!==ELEM_ID.TABLEOPTIONSPANEL&&t!==ELEM_ID.TABLETHEMEPANEL&&(UIUtils.initComponent(t),P(t)),F(t),n.panelId=t,Z(t)[0].style.zIndex=n.zIndex,_(n,i),k(t)},z=function(e,t,i){o.includes(e)||(UIUtils.initComponent(e),P(e)),F(e),i=i||N(),Z(e)[0]&&(Z(e)[0].style.zIndex=i,_({panelId:e,animationType:t,zIndex:i}),t?ZWAnimation.animate(e,t,U[t]):k(e))},V=function(e,t){y(e),A(e),C(e),t?ZWAnimation.animate(e,t,U[t]):W(e)},j=function(e,t){var i=R();i&&i.panelId==e||0==J("#"+e).length||(v(ELEM_ID.PANELCONTAINER)||$(ELEM_ID.PANELCONTAINER),!v(ELEM_ID.MAINPANELCONTAINER),v(ELEM_ID.SUBPANELCONTAINER)||$(ELEM_ID.SUBPANELCONTAINER),L(e)&&v(ELEM_ID.MAINPANELCONTAINER)&&(t&&(t=ANIMATIONS.FADEIN),O()),z(e,t))},X=function(){var e=R();e&&(L(e.panelId)&&v(ELEM_ID.MAINPANELCONTAINER)?Q(ANIMATIONS.SLIDEOUT):V(e.panelId,ANIMATIONS.FLIPOUT))},K=function(e){var t=h(e);if(t&&t.panelObj)if(t.index<S()-1)LeftPanel.isContainerVisible(ELEM_ID.MAINPANELCONTAINER)?Y(t,Macros.defaultLeftPanel()):V(e);else if(LeftPanel.isContainerVisible(ELEM_ID.MAINPANELCONTAINER)){var i=Macros.defaultLeftPanel();PubSub.publish(i+"/open",{operation:"leftPanelOpen"})}else LeftPanel.closeSubPanel()},q=function(e,t){M("active"),t=t||Macros.defaultLeftPanel(),F(t),z(t),$(ELEM_ID.MAINPANELCONTAINER),$(ELEM_ID.SUBPANELCONTAINER),$(ELEM_ID.PANELCONTAINER,e),PubSub.publish("LeftPanel/StateChange","open")},Q=function(e){v(ELEM_ID.PANELCONTAINER)&&(M("inactive"),ee(ELEM_ID.PANELCONTAINER,e),PubSub.publish("LeftPanel/StateChange","close"))},$=function(e,t){D(e,!0),t?ZWAnimation.animate(e,t):k(e)},ee=function(e,t){D(e,!1),t?ZWAnimation.animate(e,t,x[t]):W(e)},te=function(e){var t=R();if(!t||t.panelId!=e.panelId)if(v(ELEM_ID.PANELCONTAINER))LeftPanel.showSubPanel(e.panelId,e.animationType);else{for(var i=e.parentPanels||[],n=0,o=i.length;n<o;n++){var r=i[n];ne(r),z(r)}ne(e.panelId),LayoutManager.toggleRichEdit("open",e.panelId)}},ie=function(e){if(!e)return!1;var t=R()||{};return t.panelId==e},ne=function(e){L(e)&&O()};PubSub.subscribe("Document/ComponentInitialized",function(){Z("topband-hamburger").enable(!0)});var oe=function(e,t,i){var n=h(e);if(n&&n.panelObj)if(n.index<S()-1)LeftPanel.isContainerVisible(ELEM_ID.MAINPANELCONTAINER)?Y(n,t):V(e);else if(LeftPanel.isContainerVisible(ELEM_ID.MAINPANELCONTAINER)){S()>1?V(e):K(e);var o,r=T.length;r>0&&(o=T[0].panelId,F(o))}else LeftPanel.closeSubPanel()},re=function(e,t){var i=R();if(!i||!e||i.panelId!=e.panelId){if(!e&&t){K(i.panelId);for(var n=t.parentPanels||[],o=0,r=n.length;o<r;o++){var a=n[o];j(a)}return F(n[0]),void z(t.panelId)}if(v(ELEM_ID.PANELCONTAINER)){var s,r=T.length;r>0&&(s=T[0].panelId,y(s)),z(e.panelId)}else{for(var n=e.parentPanels||[],o=0,r=n.length;o<r;o++){var a=n[o];a==ELEM_ID.FORMATPANEL?PubSub.publish(ELEM_ID.FORMATPANEL+"/open"):LayoutManager.toggleRichEdit("open",a)}y(n[0]),re(e)}}};return{init:m,closeSubPanel:X,showSubPanel:j,closeDynamicPanel:K,findPanelObj:I,getPanelDetails:h,toggleLeftPanel:w,showPanelContainer:q,hidePanelContainer:Q,getCurrentPanel:R,isContainerVisible:v,getPanelWidth:b,showAdvancedPanel:te,isPanelVisible:ie,addTab:s,addPanel:d,addToMainPanel:n,closePropsPanel:oe,openPropsPanel:re,bindCloseBtn:P,unbindCloseBtn:C}}(),PanelUtil=function(){var e={"subpanel-para":["fmt-sub-pnl-layout","fmt-lpnl-borderoptions"],"subpanel-pagelayout":["subpanel-pagelayout"],"subpanel-img":["subpanel-img"],"subpanel-barcodeqrcode":["subpanel-barcodeqrcode"],"subpanel-table":["table_properties","tbl-prop-bdr-container"],"merge-field-chart-panel":["merge-field-chart-pane"]},t=function(){LayoutManager.isRichEditActive()&&(LeftPanel.showSubPanel(ELEM_ID.HEADEROPTIONSPANEL,ANIMATIONS.FADEIN),CustomHdrFtr.updateHeaderFooterPanel()),J("#menu-headerfooter-parent").css("display","block")},i=function(){if(!editor.isFinalDocument()){LeftPanel.getCurrentPanel();LeftPanel.findPanelObj(ELEM_ID.HEADEROPTIONSPANEL)>=0?LeftPanel.closeDynamicPanel(ELEM_ID.HEADEROPTIONSPANEL):(LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.HEADEROPTIONSPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.HEADEROPTIONSPANEL),CustomHdrFtr.updateHeaderFooterPanel())}},n=function(e,t){if(e){var i,n=t||window.event,o=J(n.srcElement||n.target),r=o.parents(".header_primary");r.length>0?(i=J(r.next()[0]),i.hasClass("zw-content-wrapper")&&(i=i.children().first())):(i=J(o.parents(".footer_primary").prev()[0]),i.hasClass("zw-footnote-wrapper")&&i.is(":hidden")&&(i=i.prev(),i.hasClass("zw-content-wrapper")&&(i=i.children().last(),i.hasClass("zw-endnote-wrapper")&&i.is(":hidden")&&(i=i.prev())))),EventHandler.setActivePageAndSection(i,n.x,n.y);var a=EventHandler.getIndex(n,editor.clientActiveSection,n.x,n.y),s=editor.doc.createRange(a);editor.doc.getSelection().removeAllRanges().addRange(s),EventHandler.toggleSection(),editor.prevClientActiveSection=editor.clientActiveSection,PubSub.publish("Document/SwitchSection")}LeftPanel.closeDynamicPanel(ELEM_ID.HEADEROPTIONSPANEL),J("#menu-headerfooter-parent").css("display","none")},o=function(){if(editor.getRole().permissions.can("document.edit")){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE),i=e.getParents(NODE_TYPE.IMAGE),n=t&&t.dtNode.theme,o=n&&n.themeName;n&&o&&0==o.indexOf("theme")&&"theme2"!=o?J("#micro-tool-theme-clr").show():J("#micro-tool-theme-clr").hide(),editor.getRole().permissions.can("document.edit")&&t&&!i||e.isTableSelected()?(J("#menu-table-parent, #tablePropWrapper").show(),r(),TableResize.updateTableResizeIcon(t)):(J("#menu-table-parent, #tablePropWrapper, #tableResizeIconDiv, #tableResizeGridDiv").hide(),PubSub.publish("TablePanel/Close"),LeftPanel.closeDynamicPanel(ELEM_ID.TABLETHEMEPANEL))}},r=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);if(t){var i=J(J(editor.doc.getCursorPortionNode()).parents("table.zw-table")[0]);if(editor.clientActiveSection&&editor.clientActiveSection.className.indexOf("zw-contentpane")==-1){var n=DocUtil.getDOMSourceIndex(e.getStart(),UNICODE.TABLE);i=J(DomUtil.getElementAt("table.zw-table",n,editor.clientActiveSection))}if(i){var o=J(i).offset()||ZERO_RECT,r=o.left-editor.editorOffset.left-Z("tablePropWrapper").width()-26,a=o.top-editor.editorOffset.top;Z("tablePropWrapper").css({left:r,top:a})}}},a=function(){LeftPanel.findPanelObj(ELEM_ID.TABLEOPTIONSPANEL)>=0?PubSub.publish("TablePanel/Close"):PubSub.publish("TablePanel/Show")},s=function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.TABLETHEMEPANEL,ANIMATIONS.FLIPIN):LayoutManager.toggleRichEdit("open",ELEM_ID.TABLETHEMEPANEL)},l=function(e,t){t&&t.fromDependsOn&&LeftPanel.findPanelObj(ELEM_ID.TABLEOPTIONSPANEL)!=-1||(LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.TABLEOPTIONSPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.TABLEOPTIONSPANEL))},d=function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.DIGISIGNPANEL,ANIMATIONS.FLIPIN):LayoutManager.toggleRichEdit("open",ELEM_ID.INSERTSIGNERFIELDS)},c=function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.TEXTBOXPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.TEXTBOXPANEL)},u=function(){return e},p=null,g=null,f=function(e){clearTimeout(g),p=e,g=setTimeout(function(){p=null},3e3)},E=function(){return editor.isFinalDocument()?(MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_WARNING,editorProps.deployment.zohowriter,J.i18n("writer.common.FINAL_REVERT_MSG")),!1):void(LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.INSERTFIELDPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.INSERTFIELDPANEL))},T=function(e){e&&e.forceOpen&&ImagePanel.open(),LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.IMAGEEDITALIGN,ANIMATIONS.FLIPIN):LayoutManager.toggleRichEdit("open",ELEM_ID.IMAGEEDITALIGN)},m=function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.INSERTPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.INSERTPANEL)},h=function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.FORMATPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.FORMATPANEL)},I=function(e){var t=(e||{}).operation;"leftPanelOpen"==t&&(LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.INSERTFILLABLEFIELDS,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.INSERTFILLABLEFIELDS))},_=function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.PAGELAYOUTPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.PAGELAYOUTPANEL)},A=function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.CHARTPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.CHARTPANEL)},S=function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.MARKETPLACEPANEL,ANIMATIONS.FADEIN):LayoutManager.toggleRichEdit("open",ELEM_ID.MARKETPLACEPANEL)},R=function(){LayoutManager.isRichEditActive()?LeftPanel.showSubPanel(ELEM_ID.CITATIONPANEL,ANIMATIONS.FLIPIN):LayoutManager.toggleRichEdit("open",ELEM_ID.CITATIONPANEL)};return{toggleHeaderFooter:i,openHeaderFooter:t,closeHeaderFooter:n,toggleTableOptions:o,handleTablePropWrapper:a,updateTablePropWrapperPos:r,getRefreshPanel:u,activeLeftPanelSpinner:p,setActiveLeftPanelSpinner:f,showMoreTableThemes:s,showTablePanel:l,showDigiSignPanel:d,showFieldPanel:E,showTextBoxPanel:c,showImageAlignPanel:T,openInsertPanel:m,openFormatPanel:h,openFillableFieldsPanel:I,openPageLayoutPanel:_,openExtensionsPanel:S,openChartPanel:A,openCitationPanel:R}}(),TopbandHandler=function(){"use strict";var e,t={},i={TOPBANDCONTAINER:"topband",DEFAULTTOPBANDCONTAINER:"topband-default",HISTORYTOPBANDCONTAINER:"topband-history",HISTORYDIFFTOPBANDCONTAINER:"topband-history-compare",MAILMERGETOPBANDCONTAINER:"topband-mailmerge",FILLABLEFIELDSTOPBANDCONTAINER:"topband-fillablefields",PRINTPREVIEWTOPBANDCONTAINER:"topband-printpreview",TOOLBARCONTAINER:"toolbar-container",REVIEWTOOLBARCONTAINER:"review-tb",PREVIEWTOOLBARCONTAINER:"previewToolbar_container",VERSIONHISTORYCONTAINER:"history-versionpane",MMPREVIEWCONTAINER:"mmpreview-toolbarcontainer",FFPREVIEWCONTAINER:"ffpreview-toolbarcontainer",READONLYTOOLBARCONTAINER:"readonly-tb",READFILLTOOLBARCONTAINER:"readfill-tb",READCOMMENTTOOLBARCONTAINER:"readcomment-tb",TOOLBARTOGGLEBTN:"toolbar-toggle-div",VERSIONVIEWTOOLBARCONTAINER:"toolbar-versionview"},n=function(){Z("documentpropertiespanel").zpopover(),jQuery.extend(ELEM_ID,i),o(),PubSub.publish("Document/ToolbarInitialized")},o=function(){if(editor.getRole().permissions.can("document.rename")){var e=document.getElementById("topband-file-name-cont");e&&(e.addEventListener("mouseenter",b),e.addEventListener("mouseleave",D))}else{var t=W.get("#topband-file-name");t.width()>230?t.attr({title:editor.doc.docInfo.DOCUMENT_NAME}):null}},r=function(){var e=document.getElementById("topband-file-name-cont");e.removeEventListener("mouseleave",D),e.removeEventListener("mouseenter",b)},a=function(e){var i=t[e];return i&&i.visible},s=function(e,i){t[e]||(t[e]={}),t[e].visible=i},l=function(e){var t=Z(ELEM_ID.TOPBANDWRAPPER)[0];a(ELEM_ID.TOPBANDWRAPPER)||(t.style.display="block",s(ELEM_ID.TOPBANDWRAPPER,!0)),Z(e).show(),s(e,!0),S(t.offsetHeight)},d=function(e){a(ELEM_ID.TOPBANDCONTAINER)||l(ELEM_ID.TOPBANDCONTAINER),UIUtils.initComponent(e),l(e)},c=function(e){a(ELEM_ID.TOOLBARCONTAINER)||l(ELEM_ID.TOOLBARCONTAINER),UIUtils.initComponent(e),l(e)},u=function(e){Z(e).css("display","none"),s(e,!1);var t=0;0!=Z(ELEM_ID.TOPBANDWRAPPER).length&&(t=Z(ELEM_ID.TOPBANDWRAPPER)[0].offsetHeight),S(t)},p=function(e){u(ELEM_ID.TOPBANDCONTAINER),u(e)},g=function(){var e=window.innerWidth,t=document.getElementById("topband-parent"),i=document.getElementById("topband-left-options"),n=document.getElementById("topband-default-rightoptions"),o=document.getElementById("topband-right-anyone"),r=document.getElementById("topband-hamburger"),a=document.getElementsByClassName("ui-tband-ccont"),s=0;n&&(s=n.offsetWidth);var l=0;if(r&&(l=r.offsetWidth),i){var d=e-(s+l);i.style.width=d+"px"}i&&n&&a.length>0&&(i.style.width=t.offsetWidth/3+"px",n.style.width=t.offsetWidth/3+"px"),i&&o&&a.length>0&&(i.style.width=t.offsetWidth/3+"px",o.style.width=t.offsetWidth/3+"px")},f=function(e){a(ELEM_ID.TOOLBARTOGGLEBTN)||Macros.isPDFDocument()||u(ELEM_ID.TOOLBARCONTAINER),u(e)},E=function(){a(ELEM_ID.TOOLBARCONTAINER)||l(ELEM_ID.TOOLBARCONTAINER),l(ELEM_ID.TOOLBARTOGGLEBTN)},T=function(){u(ELEM_ID.TOOLBARTOGGLEBTN)},m=function(e){e?Z(ELEM_ID.TOOLBARTOGGLEBTN).removeClass("ui-toolbarhide-btn-hide").addClass("ui-toolbarhide-btn-show"):Z(ELEM_ID.TOOLBARTOGGLEBTN).removeClass("ui-toolbarhide-btn-show").addClass("ui-toolbarhide-btn-hide")},h=function(e,i){t[e]||(t[e]={}),t[e].hiddenByUser=i,m(i)},I=function(e){var e=t[e];return e&&e.hiddenByUser},_=function(){var e=LayoutManager.getCurrentToolbar(),t=e&&I(e);t?c(e):f(e),h(e,!t),editor.onResize()},A=function(){return e},S=function(t){e=t},R=function(){var e=!0;e=!editorProps.userInfo.is_favourite,O(e)},O=function(e){var t={};t.operations=JSON.stringify({favourite:e}),J.ajax({type:"POST",data:t,dataType:"json",url:ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/meta"),success:function(e){editorProps.userInfo.is_favourite=e.is_favourite,UIUtils.handleFavouriteView()},error:function(e){Notification.show({message:e.message,close:!1,type:"error"})},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})},b=function(e){var t=J("#topband-file-name-ipt");if(!t.length){var i=document.createElement("INPUT");i.setAttribute("type","text"),i.setAttribute("oninput","setTimeout(TopbandHandler.documentIptKeyPressHandler(),400)"),i.setAttribute("onblur","TopbandHandler.docRenameHandler()"),i.setAttribute("onfocus","TopbandHandler.documentIptKeyPressHandler()"),i.setAttribute("onkeydown","TopbandHandler.applyDocNameOnEnter(event)"),i.setAttribute("id","topband-file-name-ipt"),i.setAttribute("class","ui-fl ui-hide"),i.setAttribute("autocomplete","off"),i.setAttribute("maxlength","255"),i.setAttribute("onclick","TopbandHandler.handleDocumentNameOnclickEvent(event)"),document.getElementById("topband-file-name-cont").appendChild(i),t=J("#topband-file-name-ipt")}t.val(editor.doc.docInfo.DOCUMENT_NAME);var n=J("#topband-file-name").width();t.width(n+"px"),t.removeClass("ui-hide"),J("#topband-file-name").addClass("ui-hide"),document.getElementById("topband-file-name-cont").removeEventListener("mouseenter",b)},v=function(e){document.getElementById("topband-file-name-cont").removeEventListener("mouseleave",D),e.preventDefault()},D=function(e){e.preventDefault(),L()},L=function(){r();var e=document.getElementById("topband-file-name-cont");Z("topband-file-name-ipt").addClass("ui-hide"),Z("topband-file-name").removeClass("ui-hide"),document.getElementById("topband-fname-loading-cont").style.display="none",e.addEventListener("mouseleave",D),e.addEventListener("mouseenter",b)},N=function(e){if(e.keyCode==KEYS.ENTER)P();else{var t=document.getElementById("topband-file-name-ipt"),i=t.value.length,n=document.getElementById("rename-limit-exceed-notify-cont");if(i>=255){var o=document.getElementById("topband-hamburger").clientWidth+document.getElementById("topband-filename-group").clientWidth;n.style.display="block";var r=n.offsetWidth;return n.style.left=o-r+"px",void setTimeout(function(){document.getElementById("rename-limit-exceed-notify-cont").style.display="none",J("#rename-limit-exceed-notify-cont").hide()},"4000")}n.style.display="none",C()}},P=function(){document.getElementById("rename-limit-exceed-notify-cont").style.display="none";var e=Z("topband-file-name-ipt").val().trim();if(e=e.substring(0,255),""==e||e==editor.doc.docInfo.DOCUMENT_NAME)return void L();document.getElementById("topband-fname-loading-cont").style.display="block";var t={};t.operations=JSON.stringify({name:e}),J.ajax({type:"POST",data:t,dataType:"json",url:ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/meta"),success:function(e){L(),PubSub.publish("Document/Renamed",e.name)},error:function(e){L(),Notification.show({message:e.message,close:!1,type:"error"})},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})},C=function(){var e=J("#topband-file-name-ipt"),t=J("#doc-name-span"),i="250";if(!t.length){var n=document.createElement("SPAN");n.setAttribute("id","doc-name-span"),document.body.appendChild(n),t=J("#doc-name-span"),t.css("fontSize",15),t.addClass("ui-hide")}t.text(e.val()),i=t.width()+40,i=i<"50"||"50"==i?"50":i,250==i?e.attr({title:editor.doc.docInfo.DOCUMENT_NAME}):e.removeAttr("title");var o=i+"px";e.width(o)};return PubSub.subscribe("Document/ComponentInitialized",function(){"-1"==editorProps.permissionsInfo.appInfo.MODULES.exclude.indexOf("office-api")&&"ANYONEWITHLINK"!=editor.type&&PubSub.publish("DocsComponent/Init")}),PubSub.subscribe("Document/Resize",g),{init:n,getBandHeight:A,showToolbar:c,hideToolbar:f,showTopband:d,hideTopband:p,isElemVisible:a,toggleToolbar:_,getToolbarState:I,updateHideBtnState:m,showToolbarHideBtn:E,hideToolbarHideBtn:T,docRenameHandler:P,docFavoriteHandler:O,handleFavBtnClicked:R,applyDocNameOnEnter:N,handleDocumentNameOnclickEvent:v,documentIptKeyPressHandler:C}}(),ModeManager=function(){var e="",t=!1,i=function(){return e},n=function(t){e=t},o=function(){var e=editor.doc.getUserData(),t=e[editor.zuid].editor_mode;n(t),ModeManager.updateModeActiveStatus(null,t),LayoutManager.loadLayout(LayoutManager.getLayoutType())},r=function(e,t){Z("topband-modes").zselectbox("setValue",t)},a=function(e){var n=i();e!=n&&t&&(s(e),l(e))},s=function(e){var t=i();e!=t&&(n(e),ModeManager.updateModeActiveStatus(t,e),LayoutManager.loadLayout(e))},l=function(e){Macros.saveUserMode(e)};return PubSub.subscribe("Document/ComponentInitialized",function(){t=!0}),{getCurrentMode:i,setCurrentMode:n,loadUserEditorMode:o,switchMode:a,updateModeInUI:s,updateModeActiveStatus:r}}();PopupHandler=function(){"use strict";var e={},t=function(e){for(var t=0,i=e.length;t<i;t++)n(e[t].elemId,e[t].obj)},i=function(t){t=t||e;var i;for(i in t)o(i)},n=function(t,i){t&&i&&(e[t]={open:i.open,close:i.close,beforeOpen:i.beforeOpen,togglePin:i.togglePin,openMoreOptions:i.openMoreOptions,visible:i.visible||!1,pinned:i.pinned||!1,timeDelay:i.timeDelay||1,popupTimer:null})},o=function(t){delete e[t]},r=function(){return Object.keys(e).length},a=function(t,i){e[t].visible=i},s=function(t,i){e[t].pinned=i,e[t].togglePin(i)},l=function(t){s(t,!e[t].pinned)},d=function(t){return e[t]&&e[t].visible},c=function(t){return e[t]&&e[t].pinned},u=function(t){e[t].popupTimer&&clearTimeout(e[t].popupTimer)},p=function(t,i){e[t]&&(e[t].visible?g(t):(clearTimeout(e[t].popupTimer),E(),e[t].beforeOpen(),e[t].popupTimer=setTimeout(function(){var n=e[t].open(i);a(t,n),"smartToolbar"!=t?ZWLogger.addToStatistics("4.0_tools_"+t):Toolbar.updateToolbar()},e[t].timeDelay)))},g=function(t){if(e[t])return!(!e[t].visible||e[t].pinned)&&(clearTimeout(e[t].popupTimer),e[t].close(),a(t,!1),!0)},f=function(t){e[t]&&e[t].visible&&(clearTimeout(e[t].popupTimer),s(t,!1),e[t].close(),a(t,!1))},E=function(){var t;for(t in e)g(t)},T=function(t){PopupHandler.closeAllPopup(),e[t].openMoreOptions(),ZWLogger.addToStatistics("4_0_"+t+"_moreoptions")};return{addPopup:n,removePopup:o,getNumberOfPopups:r,setVisibleStatus:a,setPinnedStatus:s,togglePinnedStatus:l,initialize:t,destroy:i,isVisible:d,isPinned:c,openPopup:p,closePopup:g,forceClosePopup:f,closeAllPopup:E,openMoreOptions:T,clearTimeOut:u}}();var SmartToolbar=function(){var e,t,i,n,o,r,a,s,l=!1,d="",c={SMARTTOOLBAR:"smartToolbar"},u={text:{hideList:["smartTableOption"],disableList:[]},table:{hideList:[],disableList:[]},list:{hideList:["smartTableOption","smart-cmt-link-set"],disableList:[]},tableCollaped:{hideList:[],disableList:["smart_cell_merge"]}},p=function(){return!editor.getRole().permissions.can("document.edit")||editor.subAction&&editor.subAction.version||(PopupHandler.addPopup(c.SMARTTOOLBAR,{open:E,close:m,destroy:g,beforeOpen:f,togglePin:h,openMoreOptions:I,visible:!1,pinned:!1,timeDelay:150,popupTimer:null}),s=!0,l=!0,e=Z(c.SMARTTOOLBAR),t=Z("smart_pin"),Toolbar.addToolsetToCollection(c.SMARTTOOLBAR,u),_(),x()),l},g=function(){return PopupHandler.forceClosePopup(c.SMARTTOOLBAR),Toolbar.removeToolsetFromCollection(c.SMARTTOOLBAR),A(),l=!1,PopupHandler.removePopup(c.SMARTTOOLBAR),l},f=function(){},E=function(e){var t=Z("smartToolbar");if(editor.getRole().permissions.can("document.edit")&&t[0]){var i=Macros.getEventMethodForSmarttoolbar(),n=editor.doc.getSelection();if(i["Cursor/Selected"]&&(n.isCollapsed()||J(".ui-vertical-sub-nav").hasClass("ui-show-menu")||EventHandler.isOnlyCtrlKeyPressed))return!1;var o=n.getTargetRange(),r=editor.doc.getRawFormatAt(o.start),a=editor.doc.getRawFormatAt(o.end-UNICODE.RANGE_END.length),s=r&&r.type,l=a&&a.type;return(s!=NODE_TYPE.PLACEHOLDER||l!=NODE_TYPE.PLACEHOLDER)&&(t.zpopover("open",SmartToolbar.getOffset(e)),SmartToolbar.setDoSmartness(n.selectionType!==SEL_KEYBOARD),t.css({opacity:"1.0"}),SmartToolbar.updateRect(),!0)}},T=function(e){s=e},m=function(){e.zpopover("close")},h=function(e){e?t.removeClass("ui-icon-context-pin-sm").addClass("ui-icon-context-unpin-sm"):t.removeClass("ui-icon-context-unpin-sm").addClass("ui-icon-context-pin-sm")},I=function(){FormatPanel.open()},_=function(){e.draggable({containment:"#mainOuterDiv",enable:"enable",start:function(e){s=!1},stop:function(e){s=!0,M()}});var t=Macros.getEventMethodForSmarttoolbar();for(var i in t){var n=t[i];PubSub.subscribe(i,n.method,n.param)}e.bind("click",N),e.bind("zpopoverbeforeclose",L),Z("smart_cell_merge").bind("click",P)},A=function(){e.draggable("destroy");var t=Macros.getEventMethodForSmarttoolbar();for(var i in t){var n=t[i];PubSub.unsubscribe(i,n.method,n.param)}e.unbind("click",N),e.unbind("zpopoverbeforeclose",L),Z("smart_cell_merge").unbind("click",P)},S=function(){PopupHandler.isVisible(c.SMARTTOOLBAR)&&(R(),v())},R=function(){var e=editor.doc.getSelection();if(e.selectionType===SEL_AUTO_GEN||e.selectionType===SEL_OP_GEN)return!0;var t="text";if(!e.isMultipleSelection)if(e.isListItemSelection)t="list";else if(e.isTableSelected()&&!e.isCellSelection)t="table";else{var i=e.getParents(NODE_TYPE.TABLE);i&&(t="tableCollaped")}Toolbar.updateToolset(c.SMARTTOOLBAR,d,t),d=t,O(t)},O=function(t){if(t||(t="text"),e){var i="434px";switch(t){case"list":i="382px";break;case"text":i="434px";break;case"table":i="497px";break;case"tableCollaped":i="497px"}e.css({"min-width":i})}},b=function(t,i){var n=parseFloat(e.css("left")),o=e.outerWidth(),r=n+o,a=J(window).width(),s=J("#"+i),l=s.outerWidth(!0),d=s.css("display");if("show"==t&&"none"==d){if(r+=l,r>a){var c=r-a;n-=c}Z(i).show()}else"hide"==t&&"block"==d&&(r==a&&(n+=l),Z(i).hide());var u=n+"px";e.css({left:u})},v=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.CELL);if(e){var t=e.attr(),i=t[ATTR_CELL.TDS_TXTAL];i=i?i:"left";var n=t[ATTR_CELL.TDS_VA];n=n?n:"middle";var o=n+i;Z("smart-table_cellalignment").zselectbox("setValue",o)}},D=function(){R()||PopupHandler.isVisible(c.SMARTTOOLBAR)||PopupHandler.openPopup(c.SMARTTOOLBAR)},L=function(e){return!PopupHandler.isPinned(c.SMARTTOOLBAR)},N=function(e){s=!1},P=function(e){PopupHandler.closePopup(c.SMARTTOOLBAR)},C=function(){PopupHandler.closePopup(c.SMARTTOOLBAR)},y=function(e){editor.getRole().permissions.can("document.edit")&&PopupHandler.isVisible(c.SMARTTOOLBAR)&&!PopupHandler.isPinned(c.SMARTTOOLBAR)&&SmartToolbar.addSmartness(e)},F=function(t){var i=0,n=0,o=e.outerWidth(),r=e.outerHeight(),a=65,s=20,l={},d={};t?(l.rects=t,d.rects=t):(l=CurUtil.offset.start,d=CurUtil.offset.end);var c=Z(ELEM_ID.EDITOROUTERDIV),u=c.offset(),p={};p.top=u.top,p.bottom=p.top+c.height(),p.bottom-d.rects.bottom>r+s&&d.rects.bottom>p.top?(n=d.rects.bottom+s,i=d.rects.right*editor.zoomFactor):l.rects.top-p.top>r+s&&l.rects.top<p.bottom?(n=l.rects.top*editor.zoomFactor-r-s,i=l.rects.left*editor.zoomFactor):(n=u.top,i=u.left);var g=window.innerWidth-(i+a);return g<o&&(i=window.innerWidth-(o+a)),{offset:{left:i,top:n},width:0,height:0}},M=function(){i=e[0].getBoundingClientRect(),n=i.left,o=i.right,r=i.top,a=i.bottom},w=function(t){if(s){var i=t.clientX,l=t.clientY;e.stop(),i>=n-40&&i<=o+40&&l>=r-40&&l<=a+40?e.css({opacity:"1.0"}):i>=n-200&&i<=o+200&&l>=r-200&&l<=a+200?e.animate({opacity:"0.5"},"speed"):i>=n-300&&i<=o+300&&l>=r-300&&l<=a+300&&e.animate({opacity:"0.0"},"speed",function(){PopupHandler.closePopup(c.SMARTTOOLBAR)})}},U=function(){UserPreferences.isPrefered("smarttoolbar")?l||p():l&&g()},x=function(){var e,t=(editor.getShapeWebFonts()||[]).concat(editorProps.userInfo.webFonts||[]).concat(editor.getUsedWebFonts()),i=editorProps.fonts;for(e in i)if(Utils.isWebFont(e))t.push(e);else{if(FontUtils.isFontAvailableInSystem(e))continue;e=i[e].fallback,e&&t.push(e)}t.length&&editor.addFonts(t,frames.metricsFrame,null,{defaultVarients:!0})};return PubSub.subscribe("UIEvents/UserPreferenceUpdated",U),{addSmartness:w,updateSmartToolbarPositionIfPinned:b,updateWidth:O,updateRect:M,updateToolset:R,handleSelection:D,handleCursorCollapse:S,handleWheelEvent:C,handleMouseMove:y,getOffset:F,setDoSmartness:T}}(),ParaPropertiesMenu=function(){var e=function(){PopupHandler.addPopup("paraPropMenu",{open:i,close:n,beforeOpen:o,togglePin:d,openMoreOptions:c,visible:!1,pinned:!1,timeDelay:1,popupTimer:null}),s()},t=function(){PopupHandler.forceClosePopup("paraPropMenu"),l(),PopupHandler.removePopup("paraPropMenu")},i=function(){ZWComponentUtil.init("paraPropMenu",function(){StyleUI.updateHeadingStyleButtons()}),Z("microandparaVCContainer").addClass("ui-paraoption-active");var e=Z("paraPropMenu").outerWidth(),t=Z("parapropbtndiv").outerWidth(),i=(Z("microandparaVCContainer").outerWidth(),editor.editorPaneContainer.outerHeight()+editor.editorPaneContainer.scrollTop()-(Z("microandparaVCContainer")[0].offsetTop+Z("paraPropMenu").outerHeight()+t)),n={left:t/2,top:t/2};return editor.widthVariant>e&&(n.left-=e),i<0&&(n.top=i),Z("paraPropMenu").css(n),!0},n=function(){Z("microandparaVCContainer").removeClass("ui-paraoption-active")},o=StyleUI.updateHeadingStyleButtons,r=function(){},a=function(){},s=function(){},l=function(){},d=function(e){},c=function(){PubSub.publish("ParagraphPanel/Open")};return{init:e,open:i,close:n,destroy:t,beforeOpen:o,togglePin:d,openMoreOptions:c,changePosition:r,handleScroll:a}}(),InlineInsertMenu=function(){var e,t,i=function(){PopupHandler.addPopup("inlineInsert",{open:n,close:o,beforeOpen:r,togglePin:d,openMoreOptions:p,visible:!1,pinned:!1,timeDelay:500,popupTimer:null}),e=document.getElementById("inlineInsert"),t=J(e),PubSub.subscribe("Document/CharInserted",Macros.handleCharInsert)},n=function(){ZWComponentUtil.init("inlineInsert");var i=s();return e.style.display="block",t.off("keydown.run").on("keydown.run",function(e){var i=e&&(e.target||e.srcElement),n=e.keyCode;n!=$.ui.keyCode.LEFT&&n!=$.ui.keyCode.UP&&n!=$.ui.keyCode.RIGHT&&n!=$.ui.keyCode.DOWN&&n!=$.ui.keyCode.ENTER||(t.zmenu("handleKeyCode",n,i),e.preventDefault(),e.stopPropagation())}),t.off("keypress").on("keypress",function(e){var t=(e&&(e.target||e.srcElement),e.keyCode);PopupHandler.closePopup("inlineInsert");var i=jQuery.Event("keypress");i.which=t,i.keyCode=t,J(editor.jMbSpan_editableSpan).trigger(i),e.preventDefault(),e.stopPropagation()}),e.style.top=i.top+"px",e.style.left=i.left+"px",t.focus(),!0},o=function(){e.style.display="none",EditorUtil.focusMultiByteSpan()},r=function(){},a=function(){ImageHandler.isDialogOpened()&&u()},s=function(){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),t=l(e);return t.top=t.top+t.height,t},l=function(e){var t=editor.jeditorPane.offset(),i=e.offset(),n=e.height(),o=i.left-t.left,r=i.top-t.top;return{left:o,top:r,height:n}},d=function(e){},c=function(e){u(),"image"==e?ImageHandler.openInsertImageDialogue():"table"==e?TableInsertDlg.openTablePopup():"link"==e?LinkDialog.openLinkPopup():"bookmark"==e?BookmarkDialog.openBookmarkPopup():"comment"==e?CommentManager.newComment():"code"==e?editor.doc.execCmd("code"):"textbox"==e?TextBoxHandler.insertTextBox():"fields"==e&&PubSub.publish("Fields/ShowPanel")},u=function(){var e=[{r:editor.doc.getSelection().getStart()-1},{ds:editor.doc.getCharAt(editor.doc.getSelection().getStart()-1)}];Op.processMsg(e),Op.sendMsg()},p=function(){u(),PubSub.publish("menuInsert/open")};return{init:i,open:n,close:o,beforeOpen:r,togglePin:d,openMoreOptions:p,handleInsert:c,beforeClose:a}}();TransLiterationHandler=function(){"use strict";var e,t,i,n="",o={},r={id:"transliterationOptions",style:{display:"none"},"max-length":10,"data-handle-access-key-navigation":!1,data:'{"className":"ui-translit-menu","height":"215","scroll":"default"}'},a=new CustomMenu(r,!0),s=function(e){for(var t=[],i={"zui-disable":"state.offline",appData:{action:"TransLiterationHandler.handleInsert",params:""}},n=0;n<e.length;n++){var o=JSON.parse(JSON.stringify(i));o.label=e[n],o.appData.params=e[n],t.push(o)}return t},l=function(){var e=J.i18n("writer.proofing.REPORTNOW_TOOLTIP"),n={id:"translitReport","zui-disable":"state.offline",appData:{action:"TransLiteration_EventHandler.reportTransliteration"},itemType:"custom",className:"ui-display-block",innerHTML:"<div class='ui-zia-report-txt clearfix' data-title-is-message-html-encoded='true' title='"+e+"'><div class='ui-fl'>"+J.i18n("writer.proofing.INAPPROPRIATE")+"</div><i id='proofpop-tlr-report-sugg' class='ui-left-margin-small ui-fl'>"+J.i18n("writer.proofing.REPORT_NOW")+"</i></div>"};a.setFooter(n);var o={translitinfoicon:{title:J.i18n("writer.common.TRANSLITERATION"),content:'<div style="width: 200px;">'+J.i18n("writer.common.TRANSLITERATION_BTN_TOOLTIP")+'<a href="'+editorProps.urls.helpPageURL+'document-tools.html#Transliteration" target="_blank" class="ui-tooltip-more-link"></div>'+J.i18n("writer.esign.LEARN_MORE")+"</a>"}};UIUtils.addHTMLTooltips(o,!0),t=document.getElementById("transliterationOptions"),i=J(t),i.on("zmenubeforehide",function(e){EventHandler.multiByteTyping&&TransLiteration_EventHandler.clearComposedData()}),J("#transliterationOptions")[0].onkeydown=function(e){var t=e.keyCode,n=(e.key||e.keyIdentifier,t>=37&&t<=40),o=i.find(".on-hover");if(t==$.ui.keyCode.RIGHT){var o=i.find(".on-hover");if(o[0]){var r=o[0].getAttribute("id"),a=parseInt(r[r.length-1]);0!=a&&(TransLiteration_EventHandler.setComposedDataByIndex(a-1),c([o[0].innerText]))}}else{if(!n){if(t==KEYS.ENTER&&o[0]){var r=o[0].getAttribute("id"),a=parseInt(r[r.length-1]),s={};s.keyCode=48+a,s.type=e.type,s.charCode=e.charCode,s.shiftKey=e.shiftKey,s.ctrlKey=e.ctrlKey,s.metaKey=e.metaKey,s.altKey=e.altKey,s.key=e.key,s.keyIdentifier=e.keyIdentifier,s.repeat=e.repeat,e=s}return EditorUtil.focusMultiByteSpan(),editor.keyEventHandler(e),e.stopPropagation&&e.stopPropagation(),!1}t!=$.ui.keyCode.UP&&t!=$.ui.keyCode.DOWN||(i.zmenu("handleKeyCode",t),e.preventDefault(),e.stopPropagation())}},TransLiteration_EventHandler.setTransliterationSettings(),PubSub.subscribe("Document/TransLiteration/CharacterOperation",g),PubSub.subscribe("Document/TransLiteration/closeMenu",f)},d=function(e){var t=[],i=e.word,n=i.replace(/[a-zA-Z'-]+/g,""),i=i.replace(/[^a-zA-Z'-]+/g,"");if(i.length>0&&(t=TransliterationWordSequencing.getWordSuggestion(i)),n.length>0)if(0==i.length)t=[n];else{var o="",r="";e.word.indexOf(n)>0?r=n:o=n;for(var a=0;a<t.length;a++)t[a]=o+t[a]+r}return t=U.uniq(t),e.arr=JSON.parse(JSON.stringify(t)),t.unshift(e.word),t},c=function(e){var t=s(e);a.constructMenu(t)},u=function(e){var t=d(e);c(t)},p=function(t){return e=void 0,""==t.word?void f():(u(t),void a.show())},g=function(t){e&&clearTimeout(e),e=setTimeout(p,10,t)},f=function(){a.hide(),i.zmenu("hoverMenuItem"),EditorUtil.focusMultiByteSpan()},E=function(e){var t=TransLiteration_EventHandler.getCompositionEndEvent({composedWord:e});t.data=t.detail.data,EventHandler.handleCompositionEnd(t),editor.jMbSpan_editableSpan.innerHTML="&nbsp;",f()};return{suggestWord:n,getSugesstions:d,sounds:o,init:l,handleInsert:E}}();var InlineInsertFieldMenu=function(){"use strict";var e,t,i,n,o,r,a,s="inlineInsertFieldPopover",l=!1,d="charInputList",c=function(){l||(PopupHandler.addPopup(s,{open:p,close:T,beforeOpen:function(){},togglePin:null,openMoreOptions:null,visible:!1,pinned:!1,timeDelay:300,popupTimer:null}),e=J("#inlineInsertFieldPopover"),n=J("#inlineInsertField"),o=J("#inlineInsertFieldSearch"),t=J("#mm-field-insert"),t.on("mouseover",function(){J(this).css({opacity:1})}).on("mouseout",function(){J(this).css({opacity:.4})}),i=J("#mm-repeat-vc-btn"),i.zbutton(),a=new FocusLine("mmrepeatvisualcue"),PubSub.subscribe("Document/CharInserted",u),y(),PubSub.subscribe("Document/PermissionUpdate",y),l=!0)},u=function(e){"#"==e&&(d="charInputList",PopupHandler.openPopup(s))},p=function(){var e=MailMergeFieldUIUtil.getFields(!0),t=e.fields;if(e.promise){var i=e.promise;g(J.i18n("writer.common.LOADING")),i.done(function(e){f(e)}),i.fail(function(e){n.zmenu(),n.zmenu("removeAllMenuItems"),g(e)})}else f(t);return!1},g=function(t){n.zmenu(),n.zmenu("removeAllMenuItems");var i={itemType:"custom",innerHTML:"<div>"+t+"</div>"};n.zmenu("addMenuItem",i),n.show(),ZWComponentUtil.init("inlineInsertFieldPopover"),e.zpopover("open",_()),o.val(""),o.focus(),CurUtil.stopBlinking()},f=function(t){if(n.zmenu(),n.zmenu("removeAllMenuItems"),t&&t.length){for(var i=0,r=t.length;i<r;i++){var a=t[i],s=MailMergeFieldUtil.getDisplayName(a),l=MailMergeFieldUtil.getFieldId(a),d=MailMergeFieldUtil.getGroupName(a),c={id:l,label:s,name:s,appData:{action:"InlineInsertFieldMenu.itemClickEvent",params:a}};c.itemType="custom",c.innerHTML=MailMergeUiUtils.getFieldElemWithoutEvent(a,{},{padding:0})[0].outerHTML;var u=n.zmenu("addMenuItem",c);if(d){u.attr("group-name",d);var p=n.find("[name='"+d+"']");if(!p.length){var g={id:d,label:d,name:d,itemType:"itemgroup"},f=n.zmenu("addMenuItem",g);f.attr("name",d),f.insertBefore(u)}}MailMergeUiUtils.addSearchPattern(u,a)}return n.show(),ZWComponentUtil.init("inlineInsertFieldPopover"),e.zpopover("open",_()),o.val(""),o.focus(),CurUtil.stopBlinking(),!0}},E=function(e){if("charInputList"==d){var t=editor.doc.getSelection(),i=[{r:t.getStart()-1},{ds:editor.doc.getCharAt(t.getStart()-1)}];Op.processMsg(i),Op.sendMsg()}MailMergeUtil.insertField(e),T()},T=function(){e.zpopover("close"),PopupHandler.setVisibleStatus(s,!1)},m=function(){EditorUtil.focusMultiByteSpan()},h=function(e){e?n.show():n.hide()},I=function(e){var t=(e&&(e.target||e.srcElement),e.keyCode);t!=$.ui.keyCode.UP&&t!=$.ui.keyCode.DOWN&&t!=$.ui.keyCode.ENTER||(n.zmenu("handleKeyCode",t),e.preventDefault(),e.stopPropagation(),t==$.ui.keyCode.ENTER&&T())},_=function(e){e=e||d;var t=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),i=S(t),n=i.top+i.height*editor.zoomFactor,o=i.left;if("charInputList"==e)return{offset:{top:n,left:o}};if("btnClickList"==e||"btn"==e){"btn"==e&&(n-=17);var r=J(DomViewManager.getDOMElem(DocLayoutManager.getCurrentLine())).find(".zw-line-content"),a=r.offset(),s=a.left-editor.jeditorPane.offset().left;o=s+A(r)*editor.zoomFactor}return{offset:{top:n,left:o}}},A=function(e){for(var t=e.children(),i=0,n=0;n<t.length;n++){var o=J(t[n]);o.hasClass("EOP")||(i+=o[0].offsetWidth)}return i+=2},S=function(e){var t=editor.jeditorPane.offset(),i=e.offset(),n=e.height(),o=i.left-t.left,r=i.top-t.top;return{left:o,top:r,height:n}},R=function(e){try{var t=_("btn").offset;e&&(t.top=UIUtils.getVisibleAreaTop()),O(t)}catch(e){}},O=function(e){t.css(e)},b=function(){t.show()},v=function(e){var t=e.start;e.end,e.id;if(e.type==NODE_TYPE.CELL)for(var i=DocTreeManager.getParents(NODE_TYPE.CELL,t),n=DocLayoutManager.getViews(i),o=0;o<n.length;o++){var r=J(DomViewManager.getDOMElem(n[o]));r.addClass("mmrepeatrange-bdr-highlight"),r.addClass("mmrepeatrange-bdr-highlight-bottom"),r.addClass("mmrepeatrange-bdr-highlight-right")}else for(var a=DocTreeManager.getParents(NODE_TYPE.TABLE,t),n=DocLayoutManager.getViews(a),o=0;o<n.length;o++){var s=J(DomViewManager.getDOMElem(n[o]));s.find(".mmrepeatrange-bdr").addClass("mmrepeatrange-bdr-highlight"),s.find(".mmrepeatrange-bdr-bottom").addClass("mmrepeatrange-bdr-highlight-bottom"),s.find(".mmrepeatrange-bdr-right").addClass("mmrepeatrange-bdr-highlight-right")}},D=function(){J(".mmrepeatrange-bdr-highlight").removeClass("mmrepeatrange-bdr-highlight"),J(".mmrepeatrange-bdr-highlight-bottom").removeClass("mmrepeatrange-bdr-highlight-bottom"),J(".mmrepeatrange-bdr-highlight-right").removeClass("mmrepeatrange-bdr-highlight-right")},L=!1,N=function(){try{if(!MailMergeRepeatView.isRepeatRendered())return;var e=editor.doc.getSelection().getStart();if(r=MailMergeFieldUIUtil.getRepeatRangeInfo(e))L=!0,D(),R(),b(),v(r),PubSub.subscribe(["UiEvents/EditorParentOffsetChanged","Document/view/changed"],R);else{if(!L)return;P(),L=!1}}catch(e){}},P=function(){C(),D()},C=function(){t.hide(),PubSub.unsubscribe(["UiEvents/EditorParentOffsetChanged","Document/view/changed"],R)},y=function(){editor.getRole().permissions.can("document.edit")?(PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected","Document/CursorPositionChanged","Cursor/LineChanged"],N),N()):(PubSub.unsubscribe(["Cursor/Collapsed","Cursor/Selected","Document/CursorPositionChanged","Cursor/LineChanged"],N),P())},F=function(){d="btnClickList",PopupHandler.openPopup("inlineInsertFieldPopover")};return PubSub.subscribe("MailMerge/Fields/inited",c),{init:c,open:p,close:T,afterPopupClose:m,searchCallBack:h,serachBoxKeyBoardEvent:I,itemClickEvent:E,insertBtnClick:F}}(),MicroToolbar=function(){var e,t=!1,i=function(){return editor.getRole().permissions.can("document.edit")&&(PopupHandler.addPopup("microtoolbardialog",{open:c,close:u,destroy:n,beforeOpen:p,togglePin:E,openMoreOptions:T,visible:!1,pinned:!1,timeDelay:1,popupTimer:null}),t=!0,Z("microandparaVCContainer").show(),Z("microandparaVCContainer").on("mouseover",function(){J(this).css({opacity:1})}).on("mouseout",function(){J(this).css({opacity:.4})}),f(),o(),ParaPropertiesMenu.init()),t},n=function(){return PopupHandler.forceClosePopup("microtoolbardialog"),Z("microandparaVCContainer").hide(),r(),t=!1,PopupHandler.removePopup("microtoolbardialog"),ParaPropertiesMenu.destroy(),t},o=function(){Z("microtoolbar").bind("zmenuitemclick",a),PubSub.subscribe("ImageDialog/Before/Show",a),PubSub.subscribe("Document/ScrollEvent",m),PubSub.subscribe("Cursor/LineChanged",l),PubSub.subscribe(["UiEvents/EditorParentOffsetChanged","Document/view/changed"],f),PubSub.subscribe("Cursor/Selected",d,{async:!0,timeout:100}),PubSub.subscribe("Document/EditPermissionChanged",s)},r=function(){Z("microtoolbar").unbind("zmenuitemclick",a),PubSub.unsubscribe("ImageDialog/Before/Show",a),PubSub.unsubscribe("Document/ScrollEvent",m),PubSub.unsubscribe("Cursor/LineChanged",l),PubSub.unsubscribe(["UiEvents/EditorParentOffsetChanged","Document/view/changed"],f),PubSub.unsubscribe("Cursor/Selected",d,{async:!0}),PubSub.unsubscribe("Document/EditPermissionChanged",s)},a=function(e){PopupHandler.closePopup("microtoolbardialog")},s=function(e){UIUtils.hideWrappers(!e)},l=function(){setTimeout(function(){f()},10)},d=function(){editor.doc.getSelection().selectionType&&!editor.doc.getSelection().isMultipleSelection&&f(!0)},c=function(){ZWComponentUtil.init("microtoolbar"),Z("microandparaVCContainer").addClass("ui-microtool-active");var e=Z("microtoolbar").outerWidth(),t=Z("microtoolbarbtndiv").outerWidth(),i=editor.editorPaneContainer.outerHeight()+editor.editorPaneContainer.scrollTop()-(Z("microandparaVCContainer")[0].offsetTop+Z("microtoolbar").outerHeight()+t),n={left:t/2,top:t/2};return editor.widthVariant>e&&(n.left-=e),i<0&&(n.top=i),Z("microtoolbardialog").css(n),!0},u=function(){Z("microandparaVCContainer").removeClass("ui-microtool-active")},p=function(){},g=function(){var e=editor.doc.getSelection(),t=DomViewManager.getCurrentSectionLeft()-4*Z("microtoolbarbtndiv").outerWidth(),i=CurUtil.offset.start.top*editor.zoomFactor;try{t=I(e,t)}catch(e){}return{top:i,left:t}},f=function(i){if(t){var n=g();i&&(n.top=UIUtils.getVisibleAreaTop()),clearTimeout(e),e=setTimeout(function(){Z("microandparaVCContainer").css(n)},500)}},E=function(e){},T=function(){PubSub.publish("menuInsert/open")},m=function(){},h=function(){UserPreferences.isPrefered("para_microtoolbar")?t||i():t&&n()},I=function(e,t){var i=e.getStart();return editor.doc.getParents(NODE_TYPE.IMAGE,i)?t-8:editor.doc.getParents(NODE_TYPE.TABLE,i)?t-Z("tablePropWrapper").width():t};return PubSub.subscribe("UIEvents/UserPreferenceUpdated",h),{init:i,open:c,close:u,destroy:n,beforeOpen:p,togglePin:E,openMoreOptions:T,changePosition:f}}(),UserPreferences=function(){var e,t={smarttoolbar:{val:1,isAllowed:!0,storeWhenDisabled:!0},para_microtoolbar:{val:2,isAllowed:!0,storeWhenDisabled:!0},ruler:{val:4,isAllowed:!1,storeWhenDisabled:!1}},i=function(){e=parseInt(w_usersettings.disabled_tools);for(var i in t){var n=t[i],o=e&n.val;n.isAllowed=n.storeWhenDisabled?!o:!!o}PubSub.publish("UIEvents/UserPreferenceUpdated")},n=function(){return t},o=function(){return e},r=function(e){return t[e].isAllowed},a=function(i,n){var o=t[i].storeWhenDisabled,r=t[i].val;o?1==n?e-=r:e+=r:1==n?e+=r:e-=r,t[i].isAllowed=n},s=function(e){for(var i in e){var n=e[i];if(t[i].isAllowed!=n){var r=n===!0?"_enabled":"_disabled";ZWLogger.addToStatistics(i+r),a(i,n)}}return o()};return PubSub.subscribe(["Document/ComponentInitialized","Settings/Saved"],i),{getDecodedPreferences:n,isPrefered:r,updateVCTools:a,handleUserPrefChange:s}}(),OBController=function(){"use strict";var e,t,i,n={},o={},r={},a=0,s=function(){e=Handlebars.compile(J("#onboard-help-event").html())},l=function(){var e=editorProps.userInfo.settings.tourInfo;if(e&&e.features&&e.features.length){var t={},i=ZWNetworkUtils.getContextUrl("jsp/help/onboardhelptemplates.jsp");J.ajax({type:"GET",url:i,data:t,success:function(e,t,i){var n=document.createElement("div");n.innerHTML=e.trim(),J("body").append(J(n)),d()},error:function(){}})}},d=function(){var e=editorProps.userInfo.settings.tourInfo;e&&e.features&&e.features.length&&(s(),i=J("#onboardoverlay"),J.each(editorProps.userInfo.settings.tourInfo.features,function(e,t){editorProps.tourInfo[t]&&(n[t]=editorProps.tourInfo[t])}),J.isEmptyObject(n)||(jQuery.extend(o,n),c(),i.show().css("background","rgba(0, 0, 0, 0)")))},c=function(){J.each(n,function(e,t){"hamburger_ripple"==this.name&&setTimeout(u,10)})},u=function(){J.each(n,function(e,t){"hamburger_ripple"==this.name&&p(e)}),a<1?i.hide():i.css("background","rgba(0, 0, 0, 0.4)")},p=function(i){r=editorProps.tourInfo[i];var o,a="select"==r.data.eleType?J("div[popup=combo_"+r.associatedEleId.parent+"Menu]"):"#"+r.associatedEleId.parent;if(r.type&&"otg-event"==r.type){t=e(r),o=J(t).data({id:i,closeEvent:r.callBacks.bind.close.event});var s=J(a);void 0==r.callBacks.bind.open?(s.append(o.css({position:"absolute","pointer-events":"none"})),o.position({of:a,at:r.position.parent,my:r.position.self})):J("#"+r.callBacks.bind.open.element).on(r.callBacks.bind.open.event,function(e){setTimeout(function(){var e=o.data("id");if(void 0!=n[e]){var t=editorProps.tourInfo[e];s.append(o.css({position:"absolute","pointer-events":"none"})),o.position({of:a,at:t.position.parent,my:t.position.self})}},1e3)}),s.on(r.callBacks.bind.close.event,function(e){var t=o.data("closeEvent");s.off(t),g(o)},this)}},g=function(e){var t=J(e),i=t.data().id;delete n[i],t.remove(),f(i)},f=function(e){var t={id:e};J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getContextUrl("tour/gotit"),data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e);},success:function(e,t,i){},error:function(e){}})};return{initialize:l}}(),FetchHTML=function(){"use strict";var e={},t=function(t){var n=t.requestName,o=t.requestURL,r=e[n];if(r){if(r.isRequestPending)return!1;r.isFetched?t.callback?t.callback():r.callback&&r.callback():i(n,o)}else e[n]={isFetched:!1,isRequestPending:!1,target:t.target||document,callback:t.callback,requestURL:o},i(n,o)},i=function(t,i){e[t].isRequestPending=!0,i=i||ZWNetworkUtils.getNiceUrlPrefix("popup/"+t),J.ajax({type:"get",url:i,data:UIUtils.getHTMLRequestParam(),error:function(){e[t].isRequestPending=!1},success:function(i){var n=J(e[t].target);n[0]||(n=J("body")),n.append(i),e[t].isRequestPending=!1,e[t].isFetched=!0,e[t].callback&&e[t].callback()}})},n=function(e){for(var i=0,n=e.length;i<n;i++)t(e[i])},o=function(t){var i=e[t];i&&J(e[t].target).html(""),r(t)},r=function(t){delete e[t]};return{get:t,prefetchHTMLs:n,remove:o,removeCache:r}}(),ZWAnimation=function(){"use strict";var e={},t={},i={};i[ANIMATIONS.SLIDEIN]="ui-panelslidein-anim",i[ANIMATIONS.SLIDEOUT]="ui-panelslideout-anim",i[ANIMATIONS.FLIPIN]="ui-panelflipin-anim",i[ANIMATIONS.FLIPOUT]="ui-panelflipout-anim",i[ANIMATIONS.FADEIN]="ui-panelfadein-anim",i[ANIMATIONS.FADEOUT]="ui-panelfadeout-anim",i[ANIMATIONS.RIGHT_PANEL_SLIDEIN]="ui-right-panelslidein-anim",i[ANIMATIONS.RIGHT_PANEL_SLIDEOUT]="ui-right-panelslideout-anim";var e={FADEIN:function(e){Z(ELEM_ID.SUBPANELCONTAINER).addClass("ui-subpanel-bg"),e.addClass("ui-panelfadein-anim"),e.show()},FADEOUT:function(e){e.addClass("ui-panelfadeout-anim")},FLIPIN:function(e){e.addClass("ui-panelflipin-anim"),e.show()},FLIPOUT:function(e){e.addClass("ui-panelflipout-anim")},SLIDEIN:function(e){e.addClass("ui-panelslidein-anim"),e.show()},SLIDEOUT:function(e){e.addClass("ui-panelslideout-anim")},RIGHT_PANEL_SLIDEIN:function(e){e.addClass("ui-right-panelslidein-anim")},RIGHT_PANEL_SLIDEOUT:function(e){e.addClass("ui-right-panelslideout-anim")}},n=function(e){return i[e]},o=function(e,i){t[e]=i},r=function(e){return t[e]},a=function(e){delete t[e]},s=function(t,i,s){var l=Z(t),d=r(t);d&&(l.unbind(AnimationEndEvent),l.removeClass(n(d)),a(t)),AnimationEndEvent&&l.bind(AnimationEndEvent,function(e){l.unbind(AnimationEndEvent),s&&s(e);var t=n(i);l.removeClass(t)}),o(t,i),e[i](l)};return{animate:s}}();!function(){"use strict";var e=function(e,t){var i={beforeInit:function(e){for(var i=J(e).find("ul"),n=0;n<i.length;n++){var o=J(i[n]),r=o.attr("id");if(r){var a="js-"+r+"-class",s=Jbody.find("."+a);s.length?o.remove():o.addClass(a)}}t.beforeInit&&t.beforeInit(e)},init:function(e){t.init&&t.init(e)},set:function(e,i,n){t.set&&t.set(e,i,n)},get:function(e,i){return t.get&&t.get(e,i)}};J.dialogutil.open(e,void 0,i)},t=function(e,t){J.dialogutil.close(e,t)},i=function(e){return J.dialogutil.isDialogOpened(e)},n=function(e){var i=J.dialogutil.dialogs;for(var n in i)t(n,e)};window.DialogHandler={open:e,close:t,isDialogOpened:i,closeAllDialogs:n}}();var EditorDropHandler=function(){"use strict";var e=!1,t=function(){if(!e){var t=J("#drag"),n=J("#dragdropDiv");n.on("dragleave",function(e){t.hasClass("ui-drop-container")||J(this).hide()}),n.on("drop",function(e){J(this).hide(),e.stopPropagation(),e.preventDefault()}),n.on("dragenter",function(e){e.preventDefault(),e.stopPropagation()}),n.on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),J("#importtoolbar").on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),i()}),t.on("dragenter",function(e){t.addClass("ui-drop-container"),e.stopPropagation(),e.preventDefault()}),t.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),t.on("dragleave",function(e){t.removeClass("ui-drop-container"),e.stopPropagation(),e.preventDefault()}),t.on("drop",function(e){e.preventDefault(),e.stopPropagation(),n.hide();var t=e.originalEvent.dataTransfer.files[0];if(t){if(ZWImageUtils.isImage(t))return EventHandler.dropImage(e),DomUtil.stopEvent(e),!1;J.dialogutil.isDialogOpened("importdocdesigndlg")?StyleImportUI.onDropStyleImport(e):editor.getRole().permissions.can("document.upload")&&ImportDialog.importDoc(e)}}),e=!0}},i=function(){t(),J("#dragdropDiv").fadeIn(function(){J("#dragDiv").effect("bounce",{times:2},1e3)})};return{showDropContainer:i}}();UIEventHandler=function(){var e=function(){PopupHandler.closeAllPopup(),PubSub.publish("UIEvent/PopupClosed")},t=function(){e(),EditorUtil.focusMultiByteSpan(),CurUtil.blinkCursor()},i=function(){LayoutManager.isRichEditActive()&&PubSub.publish("TablePanel/Show")},n=function(){var e=editor.doc.getRole();editor.getRole().permissions.can("document.edit")||editor.isFinalDocument()?(DesignUI.updateColorPalete(),LeftPanel.init(),InlineInsertMenu.init(),TransLiterationHandler.init(),MarkAsFinal.checkForEdit(),DesignUI.updateDesignUI()):LeftPanel.init(),TopbandHandler.init(),EditorLayout.init(),editor.subAction&&editor.subAction.version?(LayoutManager.loadLayout(LAYOUTS.VERSIONVIEW),HistoryUI.loadVersionView(editor.subAction.version)):editor.subAction&&editor.subAction.compare?HistoryUI.loadVersionDiffPage(editor.subAction.compare.source,editor.subAction.compare.target):editor.subAction&&editor.subAction.comments&&!editor.isFinalDocument()?(ModeManager.setCurrentMode(EDITOR_MODES.COLLABORATE),ModeManager.updateModeActiveStatus(null,EDITOR_MODES.COLLABORATE),LayoutManager.loadLayout(LayoutManager.getLayoutType())):ModeManager.loadUserEditorMode(),"WORKSPACE_CRMLIB_READER"!=e&&"WORKSPACE_CRMLIB_EDITOR"!=e&&"ANYONELINK_SHAREDREADWRITE"!=e&&"MAILMERGE_LIBRARY"!=e&&"CRM_VERTICAL_MAILMERGE_LIBRARY"!=e&&"ZFORMS_MAILMERGE"!=e&&"ANYONELINK_SHAREDREADCOMMENT"!=e&&"SHAREDREAD"!=e&&"SHAREDREADCOMMENT"!=e&&"REMOTEVIEW"!=e&&"REMOTECOLLABVIEW"!=e&&"TRYEDITOR_WRITER"!=e&&"TRYEDITOR_OFFICEAPI"!=e&&!editor.isOffline()&&Z("topband-hamburger")[0]&&OBController.initialize(),Events.bindEvents()},o=function(){EditorLayout.updateEditorParentOffset(),PageLayoutPanel.updatePgOrientationLabel()},r=function(){var e=PanelUtil.getRefreshPanel(),t=LeftPanel.getCurrentPanel(),i=t&&t.panelId;i&&e[i]&&J.each(e[i],function(e,t){jContainer=J("#"+t),jContainer.ZCtrackObjects("refreshValues")})},a=function(){PubSub.subscribe(DOCVIEW.CURRENT_GROUP_LAYOUT_CHANGED,o),PubSub.subscribe("Document/ModeClosed",e),editor.getRole().permissions.can("document.edit")&&(PubSub.subscribe("Editor/MouseDown",e),PubSub.subscribe("Editor/KeyDown",e),PubSub.subscribe("DOM/ESCKeyPressed",t),PubSub.subscribe("Document/BeforeMouseDown",e),PubSub.subscribe("Document/TableInserted",i),PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected"],PanelUtil.toggleTableOptions,{async:!0,timeout:100}),PubSub.subscribe("Settings/Saved",r,{async:!0,timeout:100}))};return PubSub.subscribe("Document/ComponentInitialized",n),{addSubscribers:a}}(),ImageLink=function(e){var t,i,n=function(){t=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE),i=t.attr();var n={},o=J("#link-url").val(),r=1==J("#link-open-location").prop("checked")?"_blank":"_self",a=e.getLinkType(o),s=J("#link-url").attr("data-link-info");if(s&&Utils.isRelativeLink(s)&&(a=LINK_TYPES.WEBURL,o=s),a!==LINK_TYPES.WEBURL||o.indexOf("http")!==-1||Utils.isRelativeLink(o)||(o=editor.scheme+"://"+o),a===LINK_TYPES.WEBURL){var l=encodeURI(o.trim());if(Utils.isRelativeLink(l)?valid=linkRelativeRegex.test(l):valid=linkRegex.test(l),!valid)return void J("#linkErrorMsg").show()}if(a===LINK_TYPES.MAILTO&&o.indexOf("mailto:")===-1&&(o="mailto:"+o),a===LINK_TYPES.BOOKMARK&&(o=J("#link-url").attr("data-link-info")),a!=LINK_TYPES.WEBURL&&(r="_blank"),a!=LINK_TYPES.BOOKMARK&&a!=LINK_TYPES.MAILTO&&a!=LINK_TYPES.WEBURL||(n.lnktype=a),a===LINK_TYPES.MMFIELD){var d=((i.linkData||{}).mminfo||{}).mapping,c=MailMergeUtil.getFieldMappingFromObject(o,{includeRlFields:!0,mapping:d}),u={};u[MAILMERGE.MAPPING]=c,n[MAILMERGE.MMINFO]=u,o=MailMergeUtil.changeObjectToStore(o,{includeRlFields:!0,mapping:d})}n.url=o,n.type=a,i.linkData=n,editor.doc.execCmd("applyStyle",[t,i,"applyImgLink"]),J("#link-popup").hide(),ImageActions.selectImage(),e.displayLinkVisualCue(!1)},o=function(){t=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE),i=t.attr(),i.linkData="",editor.doc.execCmd("applyStyle",[t,i,"removeImageLink"]);var e=editor.doc.createRange(t.getStart(),t.getEnd()),n=editor.doc.getSelection();n.removeAllRanges().addRange(e),ImageActions.selectImg()};return{insert:n,removeLink:o}}(LinkDialog),function(){function e(){var e=a.val().trim();e&&e!=J.i18n("writer.common.UNTITLED_DOCUMENT")?r.enable():r.disable()}function t(){function e(){J.dialogutil.close("renamedialog")}var t=J("#renamedlg").zvalidation("validateAllFields",J("#renamedlg"));if(t){var i=a.val().trim();i&&i!=J.i18n("writer.common.UNTITLED_DOCUMENT")&&Utils.renamedocument(i,e)}}function i(){J.dialogutil.close("renamedialog")}function n(){this.callback&&this.callback()}function o(e){this.callback=e,J.dialogutil.open("renamedialog",null,l),PubSub.subscribe("Dialog/BeforeClose",s)}var r,a,s=function(e){e&&e.target&&e.target[0]&&"renamedialogzdialog"==e.target[0].id&&(editor.doc.docInfo.newDoc&&editor.doc.docInfo.DOCUMENT_NAME==J.i18n("writer.common.UNTITLED_DOCUMENT")||RenameDialog.executecallback(),PubSub.unsubscribe("Dialog/BeforeClose",s))},l={init:function(t){r=J("#rename-dlg-rename"),a=J("#newDocumentNameInput"),editor.doc.docInfo.newDoc&&J("#rename-dlg-skip").hide(),r.disable(),a.off("keyup",e).on("keyup",e),setTimeout(function(){a.select()},10)},get:function(e){if("document_name"==e.action)return editor.doc.docInfo.DOCUMENT_NAME},set:function(e,t,i){if("document_name"==e.action){var n=function(){RenameDialog.rename()};UIUtils.enterKey(a,n)}}};window.RenameDialog={rename:t,skip:i,open:o,executecallback:n}}(),function(){var e=!1,t=!1,i=function(){ImageHandler.replaceImageAction=!0,m()},n=function(){var e=editor.doc.getSelection().getLastRange();e&&e.setEnd(e.start+1),CopyEventHandler.triggerCopyEvent()},o=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE),t=e.attr("src"),i=t&&0==t.indexOf("image.do?imgurl=");return t=Macros.getImageSrcWithRid(t),DomUtil.isDownloadSupported()&&editor.browserInfo.is_chrome?(i&&(t=editorProps.urls.base_url+"/"+t),void a(t)):(i&&(t=editorProps.urls.base_url+"/image/"+e.attr("src")+"/download",t=t+"?rid="+editor.doc.rid),void s(t))},r=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=t.attr("src"),i=i.split("&rid")[0];isWriterImage=i&&0==i.indexOf("image.do?imgurl=");var n=t.attr("id"),o=e.getStart();isWriterImage&&(i=editorProps.urls.base_url+"/image/"+i.replace("image.do?imgurl=","")+"/removebackground",i=i+"?rid="+editor.doc.rid);var r=new XFormMap,a=1;r.putOp(DocOpBuilder.build([{r:o},{as:{start:{type:"image"}}},{r:1},{as:{end:["type"]}}]),a);var s=function(e,t){r.applyOp(t)};UIUtils.showLoadingMsg(J.i18n("writer.mailmergepopup.PROCESSING")),PubSub.subscribe("DocOperation/CommandComplete",s);var l={};J.ajax({type:"POST",global:!1,async:!0,url:i,data:l,error:function(){PubSub.unsubscribe("DocOperation/CommandComplete",s),UIUtils.hideLoadingMsg(),UIUtils.showBackgroundRemoveFailedMsg()},success:function(e){PubSub.unsubscribe("DocOperation/CommandComplete",s),UIUtils.hideLoadingMsg();var t=e.new_url;if(!t)return void UIUtils.showBackgroundRemoveFailedMsg();var i=r.getOp(a).docOps[0].retain_count,o=editor.doc.getRawFormatAt(i);if(o&&o[ATTR_COMMON.TYPE]==NODE_TYPE.IMAGE&&o[ATTR_COMMON.ID]==n){var l=editor.doc.getParents(NODE_TYPE.IMAGE,i);ImageHandler.replaceImageAction=!0,ImageHandler.replaceImage(t,l)}}})},a=function(e){var t=J("<a>").attr({href:e,download:"",rel:"noreferrer",target:"_new"}).appendTo("body");t[0].click(),t[0].remove()},s=function(e){J("iframe#image-download-container").remove(),J("<iframe>",{src:e,id:"image-download-container",frameborder:"0",width:"100%",height:"100%"}).appendTo("body")},l=function(){var e,t,i={},n=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);if(n&&(e=n.attr().src,e.indexOf("image.do?imgurl=")!=-1)){var o=n.attr("tooltip");o&&(i.name=o),e=e.split("&rid")[0],t=ZWNetworkUtils.getContextUrl("image/"+e.replace("image.do?imgurl=","")+"/addtolibrary"),t=t+"?rid="+editor.doc.rid,J.ajax({url:t,data:i,type:"POST",dataType:"json",success:d,error:c,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})}},d=function(e,t,i){e.STATUS?Notification.show({message:"writer.image.ADD_TO_MY_LIBRARY_SUCCESS",close:!1,setTimer:!0,type:"success"}):c(reponse)},c=function(e,t,i){Notification.show({message:"writer.image.ADD_TO_MY_LIBRARY_FAILURE",close:!1,setTimer:!0,type:"error"})},u=function(){var e,t=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);t&&(e=t.attr().src,e&&(Macros.isWriterImage(e)&&(e=Macros.getImageSrcWithRid(e),e=editorProps.urls.base_url+"/"+e),Utils.safeWindowOpen(e)))},p=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);e&&(editor.doc.execCmd("delete",e),PubSub.publish("Document/ImageDeleted"))},g=function(){PubSub.publish("ImageDialog/Before/Show"),t=!0},f=function(){t=!1},E=function(){return t},T=function(){PubSub.publish("InsertWebImage/ShowPanel")},m=function(e){g();var t=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);t&&"image"==TransformHandler.getCurrentObjectInfo().type&&!InsertShape.getSelectedShape()&&(ImageHandler.replaceImageAction=!0);var i={success:function(e){var t=[];t=e.DATA,editor.doc.execCmd("insmultipleimg",t),f()},failure:function(e){e||(e=J.i18n("writer.common.UNABLE_TO_INSERT_IMAGE")),UIUtils.showMessage("error",e,"showclose","normalfont",3e3),f()}};if(editor.isOffline()&&ZWOffline.isOfflineOperationsAllowed()){var n=OfflineImpl.insertImageOffline();n.then(i.success,i.failure)}else{var o={};o.insertFrom=e;var r=function(){i.success.apply(null,arguments),ZWImgLibDialog.close()},a=function(){i.failure.apply(null,arguments),ZWImgLibDialog.close()};ZWImgLibDialog.open(o,r,a)}},h=function(e){var t={};return t[ATTR_IMAGE.I_HT]=e.HEIGHT,t[ATTR_IMAGE.I_WID]=e.WIDTH,t[ATTR_IMAGE.I_ORGINALHT]=e.HEIGHT,t[ATTR_IMAGE.I_ORGINALWID]=e.WIDTH,t[ATTR_IMAGE.I_SRC]=e.URL,t},I=function(e,t){t=t||editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);var i=DocUtil.copyStyle(t.attr());ImageHandler.newattr&&ImageHandler.newattr.cropRect&&(ImageHandler.newattr.cropRect=null),i[MAILMERGE.MMINFO]?i[ATTR_IMAGE.ALTSRC]=e:i[ATTR_IMAGE.I_SRC]=e,editor.doc.execCmd("applyStyle",[t,i,"replaceImage"]),ImageHandler.replaceImageAction=!1},_=function(){return Macros.getImgLibAppData()},A=function(e){var t=new Deferred,i=document.createElement("img");return i.src=e,i.onload=function(e){t.resolve({WIDTH:i.width,HEIGHT:i.height})},i.onerror=function(e){t.reject({status:"ERROR",reason:"IMAGE_LOAD_FAILED"})},t.promise()},S=function(e){var t=new Deferred,i=new FileReader;return i.onload=function(e){t.resolve(e.target.result)},i.onerror=function(e){t.resolve({status:"ERROR",reason:"READING_IMAGE_AS_DATA_URL_FAILED"})},i.readAsDataURL(e),t.promise()},R=function(e,t){var i=editor.uuid.replace(/[\/\\_\-%]/gi,""),n=i+Utils.randomString(),o=Macros.getImageURLValue(n),r={bytes:e,sid:t,imgid:n,imageURLValue:o};return r},O=function(e,t){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),ZWImgLibDialog.loadImageLibraryResources(function(){var i={},n=function(i){var n={};n.info=i,ZWImgLibDialog.onImageInsert(e,t,n)};i.success=n;var o=ZWImgLibDialog.getOptions({});FCImageLibrary.init(o),FCImageLibrary.uploadImage("#imagefilefrommenu",!0,i)})},b=function(){g();var t=W.get("#imagefilefrommenu")[0],i={success:function(e){var t=[];t=e.DATA,UIUtils.hideLoadingMsg(),editor.doc.execCmd("insmultipleimg",t),f()},failure:function(e){e||(e=J.i18n("writer.common.UNABLE_TO_INSERT_IMAGE")),UIUtils.hideLoadingMsg(),UIUtils.showMessage("error",e,"showclose","normalfont",3e3),f()}};e||(t.addEventListener("change",O.bind(null,i.success,i.failure)),t.addEventListener("click",function(){t.value=""}),e=!0);var n=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);if(n&&"image"==TransformHandler.getCurrentObjectInfo().type&&!InsertShape.getSelectedShape()&&(ImageHandler.replaceImageAction=!0),editor.isOffline()&&ZWOffline.isOfflineOperationsAllowed()){var o=OfflineImpl.insertImageOffline();o.then(i.success,i.failure)}else t.click()},v=function(e,t){var i=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);i&&"image"==TransformHandler.getCurrentObjectInfo().type&&!InsertShape.getSelectedShape()&&(ImageHandler.replaceImageAction=!0);var n={success:function(e){var t=[];t=e.DATA,editor.doc.execCmd("insmultipleimg",t)},failure:function(e){e||(e=J.i18n("writer.common.UNABLE_TO_INSERT_IMAGE")),UIUtils.showMessage("error",e,"showclose","normalfont",3e3)}};if(editor.isOffline()&&ZWOffline.isOfflineOperationsAllowed()){var o=OfflineImpl.insertImageOffline();o.then(n.success,n.failure)}else{var r={},a=function(){var t=e||n.success;t.apply(null,arguments)},s=function(){var e=t||n.failure;e.apply(null,arguments)};r.success=a,r.failure=s,D(r)}},D=function(e){var t={service:"zw",resId:editor.doc.rid,WDDomainURL:window.location.protocol+"//"+editorProps.urls.teamdriveURL,height:"70%",width:"50%",primaryButtonName:"Pick",denyButtonName:"cancel",filesQueryOptions:{queryType:"type",queryValue:"images"},filesQueryFilterOptions:[{queryType:"type",queryValue:"folder,images"},{queryType:"extension",queryValue:"gif,jpg,jpeg,bmp,png"}],countToSelectMaxFiles:10,showSelectedFilesAsTag:!0,canUpload:!0,showSearch:!0,showPrimaryButton:!0,showDenyButton:!0,canShare:!1,loadAsDialog:!0,disableFolderSelection:!0,primaryActionCallBack:function(t){ImageHandler.resourceChooserResp(e,t)}};WDHandler.showResourcePicker(t)},L=function(e,t){for(var i=t.callbackDataFromWorkDrive,n=i.fileModel,o=[],r=0;r<n.length;r++){var a={};a.IMAGE_NAME=n[r].name,a.IMAGE_EXTENSION=n[r].extn,a.RESOURCE_ID=n[r].id,o[r]=a}var s={};s.info=o,ZWImgLibDialog.onImageInsert(e.success,e.failure,s)},N=function(e){e=e||editor.doc.getSelection()[0].start;for(var t=parseInt(DocLayoutManager.getLeftAtIndex(e)),i=DocLayoutManager.getLineAtIndex(e),n=i.getTop(),o=i.view,r=o.getViews(),a=r.length,s=0;s<a;s++)r[s].start<o.start&&(n+=r[s].getHeight());return{top:n,left:t}};window.ImageHandler={changeImage:i,copyImage:n,downloadImage:o,addToImageLibrary:l,openInNewTab:u,removeImage:p,openInsertImageDialogue:m,getImageAttributes:h,replaceImage:I,getAppData:_,getImageDimension:A,readImageBytes:S,getImageObjForUpload:R,openInsertImageFromMachine:b,beforeDialogShow:g,beforeDialogClose:f,openWDImageInsert:v,resourceChooserResp:L,isDialogOpened:E,openWebImageDialog:T,getTopLeftForIndex:N,removeBackground:r}}(),function(e){var t,i,n,o,r,a="ZW_ANNOUNCEMNENT",s={INIT:0,SEEN:1,VISITED:2},l={THUMBNAIL_LOGO:"LOGO",THUMBNAIL_VIDEO:"VIDEO",THUMBNAIL_URL:"URL"},d=!1,c=!1,u=!1,p=void 0,g=void 0,f=void 0,E=void 0,T={TIPS:{background:"ui-nalert-icontype-tips",icon:"ui-icon-tips-lg"},COMMON:{background:"ui-nalert-icontype-common",icon:"ui-icon-tips-lg"},IMAGE:{background:"ui-nalert-icontype-dynamic-image",icon:"ui-menu-dynamic-image-wt-lg"},SHAPE:{background:"ui-nalert-icontype-dynamic-shapes",icon:"ui-menu-dynamic-shapes-wt-lg"},TABLE:{background:"ui-nalert-icontype-dynamic-table",icon:"ui-menu-dynamic-table-wt-lg"},HEADER_FOOTER:{background:"ui-nalert-icontype-dynamic-headerfooter",icon:"ui-menu-dynamic-headerfooter-wt-lg"}},m=function(){return U.once(function(){ZWAnnouncement.AnnouncementModel=t=e.Model.extend({defaults:{thumbnailType:"COMMON",icon:"ui-icon-tips-lg",background:"ui-nalert-icontype-common"},initialize:function(){var e=this.toJSON();e=U.extend(e,T[e.thumbnailType]),e.time=parseInt(e.time),e.isVideo=e.thumbnailType===l.THUMBNAIL_VIDEO,this.set(e)}}),i=e.Collection.extend({model:t,comparator:function(e,t){return e.get("time")>t.get("time")?-1:1}}),n=e.View.extend({tagName:"div",el:"#announcementmenu-innerdiv",compiledTemplate:Handlebars.compile(J("#announcement-container-template").html()),events:{"click #announcement-more-link":"handleClick"},handleClick:function(){Utils.safeWindowOpen(UIUtils.whatsNewURL,{})},initialize:function(){this.collection.on("add reset remove",this.render,this)},render:function(){E&&E.remove(),this.$el.html(this.compiledTemplate(this.collection));for(var e=0,t=this.collection.length;e<t&&e<5;e++){var i=new o({model:this.collection.models[e]});this.$el.find("#announcement-list-container").append(i.render().el)}return this}}),ZWAnnouncement.AnnouncementItemView=o=e.View.extend({tagName:"div",compiledTemplate:Handlebars.compile(J("#announcement-item-template").html()),initialize:function(){this.model.on("change",this.render,this)},events:{click:"onItemClick","click .js-announce-close":"onCloseClicked"},onItemClick:function(e){this.model.get("isHighlight")&&(this.model.set("isHighlight",!1),ZWLocalStore.setJSONValue(a,{id:this.model.get("id"),state:s.VISITED}),ZWAnnouncement.hideNotificationIcons(this.model),WebMessanger.closeAnnBanner()),Utils.safeWindowOpen(this.model.get("link"),{})},onCloseClicked:function(e){ZWLocalStore.setJSONValue(a,{id:this.model.get("id"),state:s.INIT}),this.remove(),e.stopPropagation()},handleImage:function(e){var t=this.model.toJSON(),i=J(e.target);i.parent().find(".ui-loading-gif").hide(),t.thumbnailType==l.THUMBNAIL_LOGO?i.width("90%"):t.thumbnailType!=l.THUMBNAIL_VIDEO&&t.thumbnailType!=l.THUMBNAIL_URL||(i.height()>i.width()?i.width("100%"):i.height("100%"),t.thumbnailType==l.THUMBNAIL_VIDEO&&J("#video-play-icon").show()),i.show()},handleImgLoadFailure:function(e){var t=J(e.target);t.attr("src",imgCdnZWStaticPath+fingerPrintObj["images/common/OfflineImage.png"])},handleRendering:function(e){return this.$el.html(this.compiledTemplate(e)),this.$el.find("img.js-img-announment").on("load",this.handleImage.bind(this)),this.$el.find("img.js-img-announment").on("error",this.handleImgLoadFailure.bind(this)),this},render:function(){return this.handleRendering(this.model.toJSON())}}),r=o.extend({tagName:"div",container:"#announcement-quick-view-container",className:"ui-nalert-imp-notifier",events:{click:"handleOnClick","click .js-announce-close":"onCloseClicked"},handleOnClick:function(e){this.onItemClick(e),this.remove()},render:function(){return this.handleRendering(U.extend(this.model.toJSON(),{isClose:!0,isNew:!1,isHighlight:!1}))}})}())},h=function(){if(f){var e=f.where({isNew:!0});U.forEach(e,function(e){ZWAnnouncement.hideNotificationIcons(e)})}},I=function(){return m(),f=new i,g=new n({collection:f})},_=function(){return g||I()},A=function(){return J("#announcementmenu-innerdiv")[0].innerHTML='<div class="ui-loading-cont"><div>'+J.i18n("writer.common.LOADING")+'</div><div class="ui-loading-gif"> </div></div>',S(),!0},S=function(){var e=O();J.when(e).done(R)},R=function(){var e=_(),t=f.where({isNew:!0});t.length>0&&(setTimeout(function(){ZWAnnouncement.hideNotificationIcons(t[0])},3e3),ZWLocalStore.setJSONValue(a,{id:t[0].get("id"),state:s.SEEN})),J("#announcementmenu-innerdiv").append(e.render().el)},O=function(){if(c)return p;if(!u)return c=!0,u=!0,p=J.ajax({type:"GET",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix("announcements"),success:function(e,t,i){var n=b(e.data)||[];g=void 0,c=!1,p=void 0,_(),f.add(n)},error:function(e,t,i){c=!1,u=!1,p=void 0}})},b=function(e){return U.filter(e,function(e){return v(e)})},v=function(e){var t=!e.allowedOrgZoids||e.allowedOrgZoids.split(",").indexOf(editor.zoid.toString())!=-1,i=!e.allowedRoles||e.allowedRoles.split(",").indexOf(editor.doc.role)!=-1;return t&&i},D=function(e){var t=J("#infomenu");t.is(":visible")?L():(t.off("menushow").on("menushow",L),t.zmenu("show",{forElement:J("#topband-info")})),e.preventDefault(),e.stopPropagation()},L=function(e,t){setTimeout(function(){var e=jQuery.Event("mouseover");e.originalEvent=!0,J("#infomenu").off("menushow")},20)},N=function(e,i){var n,o=J("#infomenu");if(editorProps.browserInfo.is_macApp||!v(e))return!0;if(e=F(e),_(),f.get(e.id)?(n=f.get(e.id),f.remove(n),n=new t(e),f.add(n)):(e=U.defaults(e,T[e.thumbnailType]),n=new t(e),f.add(n)),e.isNew&&C(),!e.isInit||e.isVisited)return!0;if(!o.is(":visible")){var a=J("#announcement-quick-view-container");if("high"==e.priority)E=new r({model:n}),a.empty().append(E.render().el).show(),P(a.find(".ui-nalert-imp-notifier"));else{var s=J("#announcement-quick-view-small").show();a.hide(),s.off("click").on("click",function(e){s.hide(),ZWAnnouncement.onNotifyIconClick(e)}),setTimeout(function(){s.fadeOut()},1e4),P(s)}}},P=function(e){try{var t=J("#topband-info-btn-container"),i=J(".js-notification-beak:visible"),n=$(window).width()-e.position().left-e.outerWidth(),o=$(window).width()-(t.position().left+t.outerWidth()+n)+7;i.css({right:o+"px"})}catch(e){}},C=function(){Z("topband-userinfo").znotificationbutton("showBadgeIcon"),Z("feature-articles-inside-announcement").show()},y=function(e){e.set({isNew:!1,isInit:!1}),Z("topband-userinfo").znotificationbutton("hideBadgeIcon"),Z("feature-articles-inside-announcement").hide()},F=function(e){var t=ZWLocalStore.getJSONValue(a)||{},i=t.id!=e.id;return i?(e.isNew=!0,e.isInit=!0,e.isHighlight=!0):t.state===s.INIT?(e.isNew=!0,e.isHighlight=!0):t.state===s.SEEN?e.isHighlight=!0:t.state===s.VISITED&&(e.isVisited=!0),e},M=function(){var e=J.ajax({type:"GET",url:"/writer/regionactivity",success:function(e){ZWAnnouncement.onMsgReceived(wmsData,type)},error:function(t){e={}}});return e},w=function(e,t){var i=!1;J.ajax({type:"GET",url:"/writer/regionactivity",success:function(n){var o=n,r=o.CName.toLowerCase(),a=o.Region.toLowerCase(),s=o.Timezone;if(e.regionfilter){var l=e.location,d=l.country;if(1==d.length){if(d.indexOf(r)!=-1){i=!0;var c=l.region;c.length>0&&(i=c.indexOf(a)!=-1)}}else if(0==d.length){var u=l.timezone;u.indexOf(s)!=-1&&(i=!0)}}i&&ZWAnnouncement.onMsgReceived(e,t)}})},x=function(e,t){d?N(e,t):PubSub.subscribeOnce("Document/ComponentInitialized",function(){return N(e,t)})},B=function(){d=!0},H=function(e){var t=(e||{}).operation||{},i=t.action;"open"==i&&UserProfilePanel.showFeaturedArticles(),PubSub.publish("Announcement/AfterInit")},G=function(e,t){e.hasOwnProperty("regionfilter")?ZWAnnouncement.isVaildRegion(e,t):ZWAnnouncement.onMsgReceived(e,t)};window.ZWAnnouncement={fetchData:O,onMsgReceived:x,formatSourceData:b,handleGetDataReq:S,handleBeforeShow:A,onNotifyIconClick:D,AnnouncementModel:t,getAnnouncementView:_,AnnouncementItemView:o,removeNewAnnouncement:h,hideNotificationIcons:y,getRegionData:M,isVaildRegion:w,handleAnnouncementhModuleConfiguration:H,processWMSHandling:G},PubSub.subscribe("Document/ComponentInitialized",B)}(Backbone),function(){var e=function(e,t){var i=!1;try{window.localStorage.setItem(e,JSON.stringify(t)),i=!0}catch(e){}return i},t=function(e,t){var i=!1;try{var n=getUserStats(e)||{};U.extend(n,t),window.localStorage.setItem(e,JSON.stringify(t)),i=!0}catch(e){}return i},i=function(e){var t={};try{var i=window.localStorage.getItem(e);t=i?JSON.parse(i):{}}catch(e){}return t};window.ZWLocalStore={setJSONValue:e,getJSONValue:i,updateJSONValue:t}}(),HistoryUtils=function(){var e={};e[UNICODE.BR]=NODE_TYPE.BR,e[UNICODE.HR]=NODE_TYPE.HR,e[UNICODE.TAB]=NODE_TYPE.TEXT,e[UNICODE.CELL]=NODE_TYPE.CELL,e[UNICODE.PARA]=NODE_TYPE.PARAGRAPH,e[UNICODE.TOCSTART]=NODE_TYPE.TOC,e[UNICODE.IMAGE]=NODE_TYPE.IMAGE,e[UNICODE.TABLE]=NODE_TYPE.TABLE,e[UNICODE.MERGEFIELD_START]=NODE_TYPE.MAILMERGEFIELD,e[UNICODE.MERGEFIELD_END]=NODE_TYPE.MAILMERGEFIELD;var t=UNICODE.BR+UNICODE.HR+UNICODE.TAB+UNICODE.TABLE+UNICODE.CELL+UNICODE.PARA+UNICODE.TOCSTART+UNICODE.IMAGE+UNICODE.MERGEFIELD_START+UNICODE.MERGEFIELD_END,i=UNICODE.RANGE_START+UNICODE.RANGE_END+UNICODE.SECTION_START+UNICODE.ROW+UNICODE.TABLEEND+UNICODE.TOCEND+UNICODE.MULTIBYTE_SPACE,n=new RegExp("["+t+"]"),o=t+i,r=new RegExp("([^"+o+"]+){1}|(["+o+"]+){1}","g"),a=function(e){return n.lastIndex=0,n.test(e)},s=function(t){return e[t]||NODE_TYPE.TEXT},l=function(e){var t=new ZWDateTime(e,null,editorProps.userInfo.language);return t.format("EEE MMM DD YYYY hh mm")},d=function(e){var t=editor.getBaseURL()+"/open/"+e;window.open(t,"_blank")},c=function(){d(editor.doc.docInfo.RID)},u=function(e){return e.docOps=e.docOps.map(function(e){return e.styles&&e.styles.begin&&e.styles.begin.cols&&e.styles.begin.type===NODE_TYPE.BODY&&(e.styles.begin.cols={count:1,space:[],width:[],iseqwidth:!0,col_space:Conversions.toGlobalValue("0.5in"),left_or_right:"",seperator:"0"}),e}),e},p=function(e){e.cols={count:1,space:[],width:[],iseqwidth:!0,col_space:Conversions.toGlobalValue("0.5in"),left_or_right:"",seperator:"0"}},g=function(e,t){var i={};i.versionid=e,J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/version/getversioncontent"),data:i,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){(e.RESPONSE="SUCCESS")?t&&t.success&&t.success(e):t&&t.failure&&t.failure()},error:function(e,i,n){t&&t.failure&&t.failure()}})},f=function(e){return"history-"+e+"-cell"},E=function(e){return"history-"+e+"-para"},T=function(e){return"history-"+e+"-image"},m=function(e){return"history-"+e+"-text"},h=function(e){return"ui-history-diff-del"},I=function(e){return"history-"+e+"-toc"},_=function(e,t,i){var n="";switch(i){case NODE_TYPE.CELL:n="history-"+e+" "+f(e);break;case NODE_TYPE.PARAGRAPH:n="history-"+e+" "+E(e)+" writer-glyphsend-of-paragraph";break;case NODE_TYPE.IMAGE:n="history-"+e+" "+T(e);break;case NODE_TYPE.TEXT:n="history-"+e+" "+m(e);break;case NODE_TYPE.TOC:n="history-"+e+" "+I(e)}return t==HISTORY_CONST.ACTION_DEL&&(n+=" "+h()),n},A=function(e,t){var i="";switch(e){case NODE_TYPE.PARAGRAPH:i=t===HISTORY_CONST.ACTION_INS?"writer-glyphs-end-of-paragraph ui-history-quickdiff-para-ins":"writer-glyphs-end-of-paragraph ui-history-quickdiff-para-del";break;case NODE_TYPE.IMAGE:i=t===HISTORY_CONST.ACTION_INS?"ui-history-quickdiff-img-ins":"ui-history-quickdiff-img-del";break;case NODE_TYPE.TOC:case NODE_TYPE.TEXT:case NODE_TYPE.TABLE:case NODE_TYPE.ROW:case NODE_TYPE.CELL:i=t===HISTORY_CONST.ACTION_INS?"ui-history-quickdiff-ins":"ui-history-quickdiff-del"}return i},S=function(e){var t="";return t=m(e)+"|",t+=T(e)+"|",t+=E(e)+" writer-glyphs-end-of-paragraph|",t+=I(e)+"|",t+=f(e)+"|",t+=h(),new RegExp(t,"g")},R=function(e){var t,i,n,o="";for(t=0,i=e.length;t<i;t++)n=e[t],o+="."+f(n)+", ."+I(n)+"{ background-color: "+ReviewUtil.getUserLightColour(n)+" !important; }\n",o+="."+E(n)+" { color: "+ReviewUtil.getUserColour(n)+" !important; }",o+="."+T(n)+"{ border:2px solid "+ReviewUtil.getUserColour(n)+" !important; }\n",o+="."+m(n)+"{ color: "+ReviewUtil.getUserColour(n)+" !important;  background-color: "+ReviewUtil.getUserLightColour(n)+" !important; }\n";return o},O=function(e){var t=document.getElementById("history-dynamic-css");t||(t=document.createElement("style"),t.id="history-dynamic-css",document.head.appendChild(t)),t.innerHTML=R(e)};return{DIFF_REGEX:r,isSupportedDataType:a,getDataType:s,getFormatedTime:l,getHistoryClassRegex:S,getQuickDiffClass:A,getHistoryClass:_,attachDiffStyleInDocument:O,openDocument:d,openCurrentDoc:c,makeSingleColumn:p,discardColumnChangeOps:u,getVersionContent:g}}();var HistoryDiffUI=function(e,t){var i=!1,n=!1,o={},r=!1,a={};changesIdxDetails={};var s={TOPBAND_DOCNAME:"topband-history-compare-docname",TOPBAND_BACKTOEDITOR:"topband-history-compare-backtoeditor",TOPBAND_CLOSE:"history-compare-topband-close",BULLETIN:"history-bulletindiv",BULLETINCONT:"history-bulletin-cont",DIFF_TOPBAND:"topband-history-compare",FILTER:"history-changesfilter",FILTER_CONTAINER:"history-changesfilter-cont",NAVIGATION_TXT:"history-changes-navtxt",NAVIGATION_PREV:"history-changes-nav-prev",NAVIGATION_NEXT:"history-changes-nav-next",NAVIGATION_CONT:"history-changes-nav-cont",CHANGES_BETWEEN_TXT:"history-changesbetween-txt",DETAIL_DIFF_LINK:"history-comapare-detaildiff"},l=function(){i=!1,n=!1,r=!1,a={},changesIdxDetails={},o={}},d=function(e){return"table"==e.type||"cell"==e.type||"toc"==e.type||"row"==e.type},c=function(e,t){return!(!e.history_action||e.history_action==t.history_action&&e.history_zuid==t.history_zuid)},u=function(e,t,i){var n={contStr:e.contStr.substring(t,i+1),styles:e.styles.slice(t,i+1)},o=t,r=n.styles[0],a=QuickDiff.getRows(n);U.each(a,function(e){var t={contStr:n.contStr.substring(e.start,e.end+2),styles:n.styles.slice(e.start,e.end+2)};e.cells=QuickDiff.getCells(t)});var s=[];U.each(a,function(i){var n=i.cells;U.each(n,function(n){s=s.concat(f(e,t+i.start+n.start+1,t+i.start+n.end+1))})});var l=[];return U.each(a,function(e){var t=e.styles[0];c(t,r)&&l.push({start:o+e.start,end:o+e.end+1,action:t.history_action,zuid:t.history_zuid,type:"row"}),U.each(e.cells,function(i){var n=i.styles[0];c(n,t.history_action?t:r)&&l.push({start:o+e.start+i.start,end:o+e.start+i.end+1,action:n.history_action,zuid:n.history_zuid,type:"cell"})})}),l.concat(s)},p=function(e,t,i){var n=t.styles[i],o=i,r=QuickDiff.getBlockEnd(t,i);if("table"===n.type||"row"===n.type)var a=u(t,o,r);else var a=f(t,o+1,r);var s={start:o,end:r,type:n.type,zuid:n.history_zuid,action:n.history_action};return n.history_action&&e.push(s),Array.prototype.push.apply(e,a),s},g=function(e,t,i,n,o,r){e.push({start:i,end:n,zuid:o,action:r})},f=function(e,t,i){t=t||0,i=i||e.contStr.length;for(var n,o,r,a=[],s=t;s<i;s++){var l=e.styles[s];if(l&&l.history_action)if(d(l)){n&&(g(a,l,n,s,o,r),n=null,r=null,o=null);var c=p(a,e,s);s=c.end}else n?o==l.history_zuid&&r==l.history_action||(g(a,l,n,s,o,r),n=s,o=l.history_zuid,r=l.history_action):(n=s,o=l.history_zuid,r=l.history_action);else if(l&&!l.history_action&&n&&(g(a,l,n,s,o,r),n=null,r=null,r=null,d(l))){var c=p(a,e,s);s=c.end}s==i-1&&n&&g(a,l,n,i,o,r)}return a},E=function(e){var n=Z(s.FILTER);n.zselectbox("removeAllOptions");var o={};i||U.each(e,function(e){o[e]=t.getUserName(e)}),n.zselectbox("addOption",{value:"all",label:J.i18n("writer.common.EVERYONE")}),U.each(o,function(e,i){var o={value:t.removeSplCharsInZuid(i),label:e};n.zselectbox("addOption",o)}),n.zselectbox("setValue","all")},T=function(){var e=-1,t="all";return{init:function(i){t=i,e=-1,this.updateTotalChange()},changeFocus:function(){H(changesIdxDetails[t][e])},canProceed:function(){return!(!changesIdxDetails[t]||changesIdxDetails[t].length<=0)},getActiveFilter:function(){return t},updateTotalChange:function(){var e,i=changesIdxDetails[t].length;e=i<=1?J.i18n("writer.common.CHANGE",[i]):J.i18n("writer.common.CHANGES",[i]),Z(s.NAVIGATION_TXT).text(e)},updateCount:function(){var i=changesIdxDetails[t].length,n=e+1+" of "+J.i18n("writer.common.CHANGES",[i]);Z(s.NAVIGATION_TXT).text(n)},prev:function(){if(this.canProceed()){if(e==-1)return e=0,this.changeFocus(),void this.updateCount();var i=changesIdxDetails[t].length;0!=e?e--:e=i-1,this.changeFocus(),this.updateCount()}},next:function(){if(this.canProceed()){if(e==-1)return e=0,this.changeFocus(),void this.updateCount();var i=changesIdxDetails[t].length;e!=i-1?e++:e=0,this.changeFocus(),this.updateCount()}}}}(),m=function(e){e=e[0],L(),T.init(e),N(),"all"==e?M():w()},h=function(e){return i?e.action:t.removeSplCharsInZuid(e.zuid)},I=function(e){changesIdxDetails.all=[],U.each(e,function(e){var t=h(e);changesIdxDetails[t]||(changesIdxDetails[t]=[]),changesIdxDetails[t].push(e),changesIdxDetails.all.push(e)})},_=function(e){U.each(e,function(e){e=t.removeSplCharsInZuid(e),a[e]=document.getElementsByClassName("history-"+e)})},A=function(e,t){return e.filter(function(e){return e.end-e.start!=1||!t.contStr[e.start].match(UNICODE.RANGE_START+"|"+UNICODE.RANGE_END)})},S=function(){var e={contStr:editor.doc.getDocumentContent(),styles:editor.doc.getFormats()},n=f(e);n=A(n,e);var o=[];if(!i){for(var r=0,a=n.length;r<a;r++)!o.contains(n[r].zuid)&&o.push(n[r].zuid);t.addUsersInUserListPanel(o),t.positionUserListPanel()}E(o),I(n),_(o),T.init("all"),Z(s.FILTER).enable(),Z(s.NAVIGATION_CONT).show(),B(n)},R=function(){var e={contStr:editor.doc.getDocumentContent(),styles:editor.doc.getFormats()},i=f(e);i=A(i,e);for(var n=[],o=0,r=i.length;o<r;o++)!n.contains(i[o].zuid)&&n.push(i[o].zuid);t.addUsersInUserListPanel(n),t.positionUserListPanel(),E(n),I(i),_(n),Z(s.FILTER).enable()},O=function(){T.prev()},b=function(){T.next()},v=function(t,i){for(var n,o,r=e.getHistoryClassRegex(i),a=0,s=t.length;a<s;a++)if(n=t[a],o=n.getAttribute("class")||"",n.getAttribute("data-history-class"))n.setAttribute("class",o.replace(n.getAttribute("data-history-class"),"").trim());else{var l="";r.lastIndex=0;var d=r.exec(o);if(d){for(;d;)l+=d[0]+" ",n.setAttribute("class",(n.getAttribute("class")||"").replace(d[0],"").trim()),d=r.exec(o);n.setAttribute("data-history-class",l)}}},D=function(e,t){for(var i=0,n=e.length;i<n;i++){var o=e[i];o.getAttribute("data-history-class")&&o.setAttribute("class",(o.getAttribute("class")||"")+" "+o.getAttribute("data-history-class"))}},L=function(){"all"==T.getActiveFilter()?U.each(a,function(e,t){v(e,t)}):v(a[T.getActiveFilter()],T.getActiveFilter())},N=function(){"all"==T.getActiveFilter()?U.each(a,function(e,t){D(e,t)}):D(a[T.getActiveFilter()],T.getActiveFilter())},P=function(){G(),l(),t.removeUsersInUserListPanel(),Z(s.TOPBAND_BACKTOEDITOR).hide(),Z(s.TOPBAND_CLOSE).hide(),Z(s.DETAIL_DIFF_LINK).hide(),Z(s.FILTER_CONTAINER).hide(),Z(s.NAVIGATION_CONT).hide()},C=function(e){Z(s.TOPBAND_DOCNAME).text(editor.doc.docInfo.DOCUMENT_NAME);var t;if(i)t=1==e.quickDiffType?J.i18n("history","DISPLAYING_TODAYS_CHANGES_MSG"):J.i18n("history","DISPLAYING_CHANGES_BY_TIME_MSG",[new ZWDateTime(e.source.time,null,editorProps.userInfo.language).format("YYYY MMM DD"),new ZWDateTime(e.target.time,null,editorProps.userInfo.language).format("YYYY MMM DD")]);else if(n)t=J.i18n("history","DISPLAYING_CHANGES_SINCE_VISIT_MSG");else{var o=e.source.docs_version,r=e.target.docs_version;parseFloat(o)>parseFloat(r)&&(o=e.target.docs_version,r=e.source.docs_version),t=J.i18n("history","DISPLAYING_CHANGES_BETWEEN_MSG",[o,r])}Z(s.CHANGES_BETWEEN_TXT).text(t),Z(s.FILTER).disable()},y=function(e){e.isQuickDiff?(i=e.isQuickDiff,e.showDetailDiffLink&&(o.source=e.source,o.target=e.target,Z(s.DETAIL_DIFF_LINK).show())):Z(s.FILTER_CONTAINER).show(),e.isShowChanges&&(n=e.isShowChanges),e.showCloseButton&&Z(s.TOPBAND_CLOSE).show(),e.showBackToEditor&&Z(s.TOPBAND_BACKTOEDITOR).show(),C(e),LayoutManager.loadLayout(LAYOUTS.HISTORYDIFFVIEW)},F=function(){HistoryUI.compareVersions(o.source,o.target),P(),Z(s.TOPBAND_CLOSE).show()},M=function(){Z(s.BULLETINCONT).find(".diff-bulletin").show()},w=function(){var e=Z(s.BULLETINCONT).find(".diff-bulletin"),t=T.getActiveFilter();U.each(e,function(e){t!=e.getAttribute("data_filter")?J(e).hide():J(e).show()})},x=function(e,t,i){for(var n=3,o=5,r=t;r<i;r=r+n+o)if(!e[r])return r;return t},B=function(e){var t={},i=DocLayoutManager.getLastPage(),n=DomViewManager.getDOMElem(i),o=(n.offsetTop+n.offsetHeight-editor.editorPaneContainer[0].offsetTop)*editor.zoomFactor,r=editor.editorPaneContainerHt,a=Z(s.BULLETIN);a.find(".diff-bulletin").remove(),a.css({height:r+"px"});var l=a.offset(),d=Math.ceil(l.top),c=(Math.ceil(l.left),DomUtil.createElement("span",{class:"diff-bulletin",style:"float:left;background-color: #FFF500; border:1px solid #FFAD00; width:10px; height:3px; cursor:pointer; "}));U.each(e,function(e,i){var n=editor.doc.getPortionData(e.start+1).node,a=PUtil.offset(n),l=c.cloneNode(!1),u=J(l);u.attr("id",i),u.attr("data_filter",h(e));var p=a.top/o*r,g=x(t,p,r);t[g]=!0,u.on("click",function(){H(e)}),Z(s.BULLETINCONT).append(l),u.css({top:Math.ceil(g+d+20),position:"absolute",left:"0px"})});var u=e.length||0,p="Total Changes: "+u;a.find("#history_bulletin_title").attr("title",p),a.show()},H=function(e){if(e.type){var t=DomViewManager.getDOMNodeAtIndex(e.start),i=(DomUtil.scrollElementIntoView(t,100),J(t));"table"!==e.type&&"row"!==e.type||(i=i.find("td")),i.removeClass("ui-vhistory-highlight-anim"),setTimeout(function(){i.addClass("ui-vhistory-highlight-anim")},100)}else{var n=editor.doc.createRange(e.start,e.end);n.class="ui-vhistory-highlight-anim",n.type=ZWRange.TYPE.HISTORY_HIGHLIGHT,editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(n)}},G=function(){Z(s.BULLETINCONT).empty(),Z(s.BULLETIN).hide()},k=function(){P(),LayoutManager.loadLayout(LAYOUTS.VERSIONHISTORY),HistoryUI.loadVersionListPage()},W=function(){P(),HistoryUI.backToEditor()};return{loadHistoryDiffPage:y,updateTopband:C,initChangesNavigation:S,moveToPreChange:O,moveToNextChange:b,filterChanges:m,getDetailDiff:F,backToEditor:W,closeTopband:k,initFilter:R,focusDiff:H,showBulletins:B,getChanges:f,getTableChanges:u,changesDetails:a,changesIdxDetails:changesIdxDetails}}(HistoryUtils,ReviewUtil),HistoryUI=function(e,t){var i,n,o,r,a=editorProps.deployment.writer,s={},l={},d={},c=!1,u={VERSIONS:1,DIFF:2,QUICKDIFF:3,SHOWCHANGES:4,VERSIONNICEURL:5},p={ALL:1,NAMED:2,TODAY:3,CURRENT_WEEK:4,CURRENT_MONTH:5},g={TODAY:1,THIS_WEEK:2,THIS_MONTH:3,CUSTOM:4},f={MAJOR:-1,REVERTED:1,UPLOADED:2,CHECKOUT:3,HIDDEN:101};s.versionDetails={},s.source,s.target,s.versionIdList=[],s.sourceVersionDetail,s.targetVersionDetail,s.activeNavigationPage=1,s.latestVersionId=0,s.totalVersion=0,s.activeVersionInfo,s.activeView=u.VERSIONS,s.activeFilter=p.ALL,s.excludeVersionIds,s.diffData={},s.compareBetween={fromDate:new Date,toDate:new Date},l.isCompareContVisible=!1,l.versionsElem={},l.visibleUserList,l.versionTimeIndicatorElm,l.notesCharLimit=35,d={TOPBAND:"topband-history",TOPBAND_VERSION_INFO:"topband-history-versionview",TOPBAND_DOCNAME:"topband-history-docname",VERSIONS_CONTAINER:"versionpane-versionlist",VERSION_RIGHTPANE:"history-versionpane",SOURCE_VERSION:"versionpane-source",TARGET_VERSION:"versionpane-target",COMPARE_BUTTON:"versionpane-compare",CLEAR_BUTTON:"versionpane-clear",REVERT:"history-revert",VERSION_PAGINATION:"versionpane-pagination",OVERLAY:"history-overlay",BACK_TO_EDITOR:"topband-history-backtoeditor",COMPARE_CONTAINER:"versionpane-compare-cont",COMPARE_CONT_CANCEL:"versionpane-cancel",SELECT_TO_COMPARE:"versionpane-select-tocompare",QUICKDIFF:"history-quickdiff",FILTER_BUTTON:"versionpane-filter",FILTER_UL:"version-filter",RIGHTPANE_TITLE:"versionpane-title",VERSIONPANE_HEADER:"versionpane-header",VERSIONPANE_FOOTER:"versionpane-footer",DATE_PICKER:"historycustomrange",VERSIONVIEW_DOCNAME:"topband-versionview-docname",VERSIONVIEW_VERSION:"topband-versionview-version",VERSIONVIEW_DOCLINK:"topband-versionview-doclink",VERSIONVIEW_NOTES:"topband-versionview-notes"};var E=function(){i||O(),He(),UIUtils.initComponent(d.TOPBAND),b(),editor.setView(EDITOR_VIEWS.HISTORY),LayoutManager.loadLayout(LAYOUTS.VERSIONHISTORY)},T=function(){s.versionDetails={},s.versionIdList=[],s.activeNavigationPage=1,s.latestVersionId=0,s.totalVersion=0,s.source=void 0,s.target=void 0,s.sourceVersionDetail=void 0,s.targetVersionDetail=void 0,s.diffData={},s.excludeVersionIds=void 0,s.activeVersionInfo=void 0,s.activeFilter=p.ALL,s.activeView=u.VERSIONS,l.isCompareContVisible=!1,l.versionsElem={},l.visibleUserList=void 0,l.versionTimeIndicatorElm=void 0},m=function(e){s.activeView=u.VERSIONNICEURL,s.activeVersionInfo=e,ae(d.VERSIONVIEW_DOCNAME),Z(d.VERSIONVIEW_VERSION).text(J.i18n("writer.common.VERSION")+" - "+e.docs_version).show(),editor.setView(EDITOR_VIEWS.VERSIONVIEW)},h=function(i,n){_(u.DIFF),editor.setView(EDITOR_VIEWS.HISTORY),b(),s.diffData={},s.diffData.source=i,s.diffData.target=n,t.loadHistoryDiffPage(s.diffData),Z("topband-history-compare-docname").show(),Z("history-changes-doclink-cont").show();var o=HistoryDiffManager.getDiff(i.version_id,n.version_id);o.done(function(t){try{e.makeSingleColumn(t.docContent.content.defaults);var i={};i.content=t.docContent.content,i.info=editor.doc.docInfo,editor.loadDocument(i),e.attachDiffStyleInDocument(t.participants),e.discardColumnChangeOps(t.diffOps),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),t.diffOps.applyTo(),PubSub.subscribe("DocOperation/CommandComplete",V),e.discardColumnChangeOps(t.diffStyleOps),t.diffStyleOps.applyTo(),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}catch(e){Ye(ZWCollaboration.HISTORY_COMPARE_ERROR,s.diffData.source.version_id,s.diffData.target.version_id,e),UIUtils.showMessage("warning",J.i18n("writer.history.UNABLE_TO_COMPARE_VERSION"),"showclose","normalfont")}}),o.fail(function(e){e||(e=J.i18n("writer.history.UNABLE_TO_COMPARE_VERSION")),UIUtils.showMessage("warning",e,"showclose","normalfont")})},I=function(){var e=new ZWDateTime(null,null,editorProps.userInfo.language),t=e.diff(new ZWDateTime(editor.doc.docInfo.CREATED_DATE_LONG,null,editorProps.userInfo.language),"months"),i=Math.abs(t)<=3;J("body").click(function(e){var t=J(e.target);t.parents("#historycustomrange").length||t.parents("#history-quickdiff-menu").length||t.parents(".ui-datepicker-header").length||Z(d.DATE_PICKER).hide()}),Z(d.DATE_PICKER).find("#historydatepicker-close").on("click",function(e){Z(d.DATE_PICKER).hide()}),Z(d.DATE_PICKER).find("#historydatepicker-from,#historydatepicker-to").datepicker({onSelect:function(e,t){if("historydatepicker-from"===t.id){var i=new Date(e);s.compareBetween.fromDate=i,Z(d.DATE_PICKER).find("#historydatepicker-to").datepicker("option",{minDate:i})}else{var n=new Date(e);s.compareBetween.toDate=n,Z(d.DATE_PICKER).find("#historydatepicker-from").datepicker("option",{maxDate:n})}},changeMonth:!1,changeYear:!1,minDate:i?new Date(editor.doc.docInfo.CREATED_DATE_LONG):"-3M",maxDate:new Date})},_=function(e){s.activeView=e},A=function(){return s.activeView===u.SHOWCHANGES},S=function(){return s.activeView===u.DIFF||s.activeView===u.QUICKDIFF||s.activeView===u.SHOWCHANGES},R=function(){return s.activeView===u.QUICKDIFF},O=function(){i=Handlebars.compile(J("#history-version-view").html()),n=Handlebars.compile(J("#history-miniband-view").html())},b=function(){if(EditorView.isFullView()&&EditorView.exitFullView(),EventHandler.isDialogOpened&&CollabPanelHandler.collabPanel&&CollabPanelHandler.collabPanel.is(":visible")){var e=J("#collaboratorPanelDiv, button#Collaborators_btn");J("#collabdialog").zcollaborator("close"),EventHandler.isDialogOpened=!1,e.removeClass("visible")}editor.rebindEvents(HISTORYVIEW_PERMISSION),o=DocumentView.getZoomFactor(),DocumentView.setZoomFactor(1),r=DocumentView.getViewType(),DocumentView.changeView(1),UIUtils.disableDocumentShortcuts(),editor.doc.getSelection().collapse(!0)},v=function(){if("TRYEDITOR_WRITER"==editor.doc.role)return void UIUtils.openSignupDialog();PubSub.publish("Document/History/BeforeLoad");var e=cdnZWStaticPath+fingerPrintObj["html/history/history_template.html"],t=function(){E(),be(),P(!0),PubSub.publish("Document/HistoryViewOpened")};c?t():(UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),zw.require({html:[e]},[],function(i){var n=document.createElement("div");n.id="history-tmpl",n.innerHTML=i[e],document.body.appendChild(n),c=!0,UIUtils.hideLoadingMsg(),t()}))},D=function(e){var t,i=[];for(var n in e)e.hasOwnProperty(n)&&(t=e[n].version_type,t!==f.REVERTED&&t!==f.UPLOADED&&t!==f.CHECKOUT||i.push(n));return i},L=function(e){s.latestVersionId=e.latest_version_id,s.totalVersion=e.total_version,s.versionDetails={},s.versionIdList=[],U.each(e.version_details,function(e){s.versionDetails[e.version_id]=e,s.versionIdList.push(e.version_id)}),s.excludeVersionIds=D(s.versionDetails)},N=function(e){s.activeFilter!==e&&(s.activeNavigationPage=1,P(!0,e))},P=function(e,t){de();var i=t?t:s.activeFilter,n=s.activeNavigationPage>0?20*s.activeNavigationPage-20:0,o=20,r={};r.sid=editor.uuid,r.chid=editor.doc.docInfo.COLLAB_ID,r.from=n,r.to=o,r.filter_by=i,void 0==s.excludeVersionIds&&(r.fill_exclude_versions=!0),J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/version/details"),data:r,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(n){"SUCCESS"==n.RESPONSE&&n.version_details&&n.version_details.length?(t&&(s.activeFilter=t),L(n),G(),be(),ce(),n.total_version>1?k():W(),e&&F(n.version_details[0].version_id)):(C(i),ce())},error:function(e,t,n){C(i),ce()}})},C=function(e){var t=J.i18n("writer.common.NO_VERSION_FOUND");switch(e){case p.NAMED:t=J.i18n("writer.common.NO_NAMED_VERSION_FOUND");break;case p.TODAY:t=J.i18n("writer.common.NO_VERSION_CREATED_IN_RANGE",[J.i18n("writer.common.TODAY")]);break;case p.CURRENT_WEEK:t=J.i18n("writer.common.NO_VERSION_CREATED_IN_RANGE",[J.i18n("writer.common.THIS_WEEK")]);break;case p.CURRENT_MONTH:t=J.i18n("writer.common.NO_VERSION_CREATED_IN_RANGE",[J.i18n("writer.common.THIS_MONTH")])}UIUtils.showMessage("error",t,"showclose","normalfont",3e3)},y=function(){ce(),ue(),ge(),l.isCompareContVisible||(ve(),we()),editor.editorPaneContainer[0].scrollTop=0,PubSub.unsubscribe("Document/LoadingStart",y)},F=function(t){PubSub.publish("Document/History/BeforeVersionLoad"),de(!0),t=t?t:s.latestVersionId,s.activeVersionInfo=s.versionDetails[t]?s.versionDetails[t]:s.activeVersionInfo,PubSub.subscribe("Document/LoadingStart",y);var i={success:function(e){var t={};t.content=e.docContent,t.info=editor.doc.docInfo,editor.loadDocument(t)},failure:function(){}};e.getVersionContent(s.activeVersionInfo.version_id,i)},M=function(e){var t=J(e),i=t.attr("class");i.indexOf("ui-vhistory-miniband")>-1&&(i.indexOf("ui-vhistory-miniband-selected")==-1?t.addClass("ui-vhistory-miniband-selected"):t.removeClass("ui-vhistory-miniband-selected"),t.parent().find("#version-miniband-more").slideToggle())},w=function(e){e.find("#version-miniband").on("click",function(){M(this)})},x=function(e,t){if(e.target.parentElement){var i=e.target.parentElement.id;if("version-moreoption"==i||"version-addnotes"==i)return}if(!t.getAttribute("data-disable")||"true"!=t.getAttribute("data-disable")){var n=t.getAttribute("data-versionid");if(l.isCompareContVisible){oe(n);var o=ne(n);q(n,o)}else s.activeVersionInfo.version_id!=n&&(De(),F(n))}},B=function(e){e.on("click",function(e){x(e,this)})},H=function(e){var t;return e.notes?(t=e.notes,e.notes.length>l.notesCharLimit&&(t=e.notes.substr(0,l.notesCharLimit)+"..."),t):(e.version_type==f.REVERTED?t=J.i18n("writer.history.REVERTED"):e.version_type==f.UPLOADED&&(t=J.i18n("writer.history.UPLOADED")),t)},G=function(){Z(d.VERSIONS_CONTAINER).empty(),l.versionsElem={};var e,t,o=!1;t=J(DomUtil.createElement("ul",{class:"ui-vhistory-nav"})),s.activeFilter==p.ALL&&(o=!0),U.each(s.versionDetails,function(r,a){for(var s=r.zuids,c=[],u=0;u<s.length;u++){var p=s[u],g={};g.name=ReviewUtil.getUserName(p,a),g.color=ReviewUtil.getUserColour(p,a),g.imgurl=ZWNetworkUtils.getUserImageURL(p),c[u]=g}var E={};E.version_id=r.version_id,E.docs_version=r.docs_version,c.length>2?(E.participants=[c[0]],c.shift(),E.view_more={count:c.length,participants:c}):E.participants=c;var T=new ZWDateTime(r.time,null,editorProps.userInfo.language);r.version_type==f.HIDDEN?E.time=T.format("hh mm"):E.time=T.format("EEE DD MMM YYYY hh mm"),E.tooltipTime=T.format("EEE DD MMM YYYY hh mm");var m=H(r);m?(E.notes=m,E.notesTitle="EDIT_DESCRIPTION"):E.notesTitle="ADD_DESCRIPTION";var h=J(i(E));r.notes&&r.notes.length>l.notesCharLimit&&h.find("#version-notes").attr("title",r.notes),o&&r.version_type==f.HIDDEN?(e||(Z(d.VERSIONS_CONTAINER).append(t),t=J(DomUtil.createElement("ul",{class:"ui-vhistory-nav"})),e=J(n())),B(h),e.find("ul#version-miniband-more").append(h)):(o&&e&&(w(e),Z(d.VERSIONS_CONTAINER).append(e),e=void 0),B(h),t.append(h)),l.versionsElem[a]=h}),t.find("li:first")&&Z(d.VERSIONS_CONTAINER).append(t),e&&w(e),Z(d.VERSIONS_CONTAINER).append(e);var r=Z(d.VERSIONS_CONTAINER).find(".ui-vhistory-changes-info"),a=Math.max.apply(null,r.find(".ui-vhistory-count").map(function(){return J(this).outerWidth()}));r.find(".ui-vhistory-count").css("width",a+"px"),ZWComponentUtil.initElem(Z(d.VERSION_RIGHTPANE)),UIStateHandler.build(Z(d.VERSION_RIGHTPANE)[0]),Z(d.VERSIONS_CONTAINER).find(".ui-vhistory-mini ul").addClass("ui-no-display"),s.activeVersionInfo&&!l.isCompareContVisible&&ve(),l.isCompareContVisible&&(U.each(l.versionsElem,function(e){e.find(".ui-vhistory-checkbox").show()}),s.source&&($(),l.versionsElem[s.source.version_id]&&oe(s.source.version_id),s.target&&l.versionsElem[s.target.version_id]&&oe(s.target.version_id)))},k=function(){l.isCompareContVisible||(Z(d.QUICKDIFF).show(),Z(d.SELECT_TO_COMPARE).show())},W=function(){l.isCompareContVisible||(s.activeFilter==p.ALL&&Z(d.QUICKDIFF).hide(),Z(d.SELECT_TO_COMPARE).hide())},Y=function(e){var t={};return t.versionid=e,J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/version/getversioncontent"),data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){if("SUCCESS"==e.RESPONSE)return e.docContent},error:function(e,t,i){}})},z=function(){_(u.QUICKDIFF);var e=s.source.version_id,t=s.target.version_id;Y(e).done(function(e){var i=JSON.parse(JSON.stringify(e.docContent));Y(t).done(function(e){var t=JSON.parse(JSON.stringify(e.docContent));i.versionInfo=s.source,t.versionInfo=s.target,Pe(i,t,!1,1)})})},V=function(){t.initChangesNavigation(),PubSub.unsubscribe("DocOperation/CommandComplete",V)},j=function(i,n){if(i&&n)s.diffData.source=i,s.diffData.target=n;else{s.diffData.source=s.source,s.diffData.target=s.target;var o=s.sourceVersionDetail,r=s.targetVersionDetail;o&&r&&(o.page===r.page&&r.index>o.index||r.page>o.page)&&(s.diffData.source=s.target,s.diffData.target=s.source)}var a=s.diffData.source.version_id,l=s.diffData.target.version_id;de();var d=HistoryDiffManager.getDiff(a,l);d.done(function(i){s.activeView!=u.SHOWCHANGES&&_(u.DIFF);var n={source:s.diffData.source,target:s.diffData.target};A()?(n.showBackToEditor=!0,n.isShowChanges=!0,b(),editor.setView(EDITOR_VIEWS.HISTORY)):n.showCloseButton=!0,e.attachDiffStyleInDocument(i.participants),t.loadHistoryDiffPage(n);try{e.makeSingleColumn(i.docContent.content.defaults);var o={};o.content=i.docContent.content,o.info=editor.doc.docInfo,editor.loadDocument(o),e.discardColumnChangeOps(i.diffOps),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),i.diffOps.applyTo(),PubSub.subscribe("DocOperation/CommandComplete",V),e.discardColumnChangeOps(i.diffStyleOps),i.diffStyleOps.applyTo(),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}catch(e){Ye(ZWCollaboration.HISTORY_COMPARE_ERROR,s.diffData.source.version_id,s.diffData.target.version_id,e);var r=A()?t.backToEditor:t.closeTopband;UIUtils.showMessagePopup(J.i18n("error","MSG_VERSION_COMPARE_ERROR"),J.i18n("error","TITLE_VERSION_COMPARE_ERROR"),"error",r,!1,!1)}ce(),s.diffData={}}),d.fail(function(e){ce(),s.diffData={},e||(e=J.i18n("writer.history.UNABLE_TO_COMPARE_VERSION")),A()&&_(u.VERSIONS),UIUtils.showMessage("warning",e,"showclose","normalfont",3e3)})},X=function(e,t){var i=J(e).find(".ui-vhistory-changes-grp-list");l.visibleUserList&&l.visibleUserList[0]==i[0]?(l.visibleUserList.fadeOut(),l.visibleUserList=void 0):(l.visibleUserList&&l.visibleUserList.fadeOut(),i.fadeIn(),l.visibleUserList=i),DomUtil.stopEvent(t)},K=function(e){return s.versionIdList.indexOf(e)},q=function(t,i){if(i)if(s.source){if(s.target)return MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_WARNING,a,J.i18n("writer.styles.CANT_SELECT_MORE_THAN_TWO_VERSIONS"),null,null),oe(t),!1;s.target=s.versionDetails[t],s.targetVersionDetail={page:HistoryUI.data.activeNavigationPage,index:K(t)},Z(d.TARGET_VERSION).text(e.getFormatedTime(s.target.time)),Z(d.COMPARE_BUTTON).enable()}else s.source=s.versionDetails[t],s.sourceVersionDetail={page:HistoryUI.data.activeNavigationPage,index:K(t)},Z(d.SOURCE_VERSION).text(e.getFormatedTime(s.source.time)),Z(d.TARGET_VERSION).text(J.i18n("history","SELECT_ANOTHER_VERSION")),Z(d.VERSION_RIGHTPANE).find(".ui-vhistory-compare-overlay").hide(),Z(d.CLEAR_BUTTON).enable(),$();else s.source&&s.target?(s.source.version_id==t&&(s.source=s.target,s.sourceVersionDetail=s.targetVersionDetail,Z(d.SOURCE_VERSION).text(Z(d.TARGET_VERSION).text())),Z(d.TARGET_VERSION).text(J.i18n("history","SELECT_ANOTHER_VERSION")),s.target=void 0,s.targetVersionDetail=void 0,Z(d.COMPARE_BUTTON).disable()):Q()},Q=function(){s.source&&(oe(s.source.version_id,!0),s.source=void 0,s.sourceVersionDetail=void 0),s.target&&(oe(s.target.version_id,!0),s.target=void 0,s.targetVersionDetail=void 0),Z(d.SOURCE_VERSION).text(""),Z(d.TARGET_VERSION).text(""),Z(d.CLEAR_BUTTON).disable(),Z(d.COMPARE_BUTTON).disable(),Z(d.VERSION_RIGHTPANE).find(".ui-vhistory-compare-overlay").show(),$()},$=function(){if(!s.source)return void U.each(s.versionDetails,function(e){ie(e.version_id)});var e,t=s.sourceVersionDetail.index,i=[];if(s.activeNavigationPage==s.sourceVersionDetail.page)for(var n=0,o=s.excludeVersionIds.length;n<o;n++)e=K(s.excludeVersionIds[n]),t<=e?(i=s.versionIdList.slice(e+1,s.versionIdList.length),s.sourceVersionDetail.isVersionsDisabledAtPageEnd=!0):t>e&&(i=s.versionIdList.slice(0,e+1),s.sourceVersionDetail.isVersionsDisabledAtPageStart=!0),ee(i);else if(s.activeNavigationPage<s.sourceVersionDetail.page&&s.sourceVersionDetail.isVersionsDisabledAtPageStart)ee(s.versionIdList);else if(s.activeNavigationPage>s.sourceVersionDetail.page&&s.sourceVersionDetail.isVersionsDisabledAtPageEnd)ee(s.versionIdList);else for(var n=0,o=s.excludeVersionIds.length;n<o;n++)e=K(s.excludeVersionIds[n]),ee(s.versionIdList.slice(0,e+1))},ee=function(e){U.each(e,function(e){te(e)})},te=function(e){l.versionsElem[e].attr("data-disable",!0).css("opacity","0.3")},ie=function(e){l.versionsElem[e].attr("data-disable",!1).css("opacity","1")},ne=function(e){var t=l.versionsElem[e].find(".unique-checkbox").attr("data-selected");return!(!t||"true"!=t)},oe=function(e,t){if(l.versionsElem[e]){var i=l.versionsElem[e].find(".unique-checkbox");return t?(i.attr("data-selected",!1).removeClass("ui-label-selected"),void l.versionsElem[e].find(".ui-vhistory-br").removeClass("ui-selected-version")):void(i.attr("data-selected")&&"false"!=i.attr("data-selected")?(i.attr("data-selected",!1).removeClass("ui-label-selected"),l.versionsElem[e].find(".ui-vhistory-br").removeClass("ui-selected-version")):(i.attr("data-selected",!0).addClass("ui-label-selected"),l.versionsElem[e].find(".ui-vhistory-br").addClass("ui-selected-version")))}},re=function(e){Z(d.RIGHTPANE_TITLE).text(e)},ae=function(e){var t=editor.doc.docInfo.DOCUMENT_NAME;Z(e).text(t).attr("title",t)},se=function(){var e=[Z(d.TOPBAND_VERSION_INFO),Z(d.SELECT_TO_COMPARE),Z(d.FILTER_BUTTON),Z(d.QUICKDIFF),Z(d.REVERT)];U.each(e,function(e){e.hide()}),U.each(l.versionsElem,function(e){e.find(".ui-vhistory-checkbox").show()}),De(),l.isCompareContVisible=!0;var t=Z(d.COMPARE_CONTAINER).outerHeight();Z(d.COMPARE_BUTTON).disable(),Z(d.CLEAR_BUTTON).disable(),Z(d.COMPARE_CONT_CANCEL).show(),Z(d.COMPARE_CONTAINER).slideDown(),re(J.i18n("history","COMPARE_VERSIONS")),Le(t)},le=function(){var e=[Z(d.TOPBAND_VERSION_INFO),Z(d.SELECT_TO_COMPARE),Z(d.QUICKDIFF),Z(d.FILTER_BUTTON)];U.each(e,function(e){e.show()}),U.each(l.versionsElem,function(e){e.find(".ui-vhistory-checkbox").hide()}),l.isCompareContVisible=!1,ge(),Q(),ve(),re(J.i18n("history","VERSIONS")),Z(d.COMPARE_CONT_CANCEL).hide(),Z(d.COMPARE_CONTAINER).slideUp(),Le()},de=function(e){if(A())return void UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING"));UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),Z(d.OVERLAY).show();var t=[Z(d.BACK_TO_EDITOR),Z(d.QUICKDIFF)];U.each(t,function(e){e.disable()}),Z(d.REVERT).hide(),editor.editorPaneContainer.scrollTop("0px"),e&&UIUtils.hideEditorRenderedContent()},ce=function(){if(A())return void UIUtils.hideLoadingMsg();UIUtils.hideLoadingMsg(),Z(d.OVERLAY).hide();var e=[Z(d.BACK_TO_EDITOR),Z(d.QUICKDIFF)];U.each(e,function(e){e.enable()})},ue=function(){DomUtil.removeCursorNode(editor.uuid,"start"),DomUtil.removeCursorNode(editor.uuid,"end")},pe=function(){var e="vfilter_"+s.activeFilter;Z(d.FILTER_UL).zmenu("check",e)},ge=function(){s.activeVersionInfo.version_id==s.latestVersionId||l.isCompareContVisible||l.isCompareContVisible?Z(d.REVERT).hide():Z(d.REVERT).show()},fe=function(){var e=s.activeVersionInfo.version_id;MsgDialog.showMessage(CONST.MSG_TYPE_YESNO,CONST.SEVERITY_WARNING,a,J.i18n("writer.common.SURE_WANT_TO_REVERT_VERSION"),null,function(t){switch(t){case CONST.BUTTON_YES_CLICKED:Ee(e)}})},Ee=function(e){de(!0);var t={};t.rid=editor.doc.docInfo.RID,t.versionid=e,t.sid=editor.uuid,t.docsFolderId=docsFolderId,t.tstamp=(new Date).getTime(),InsertShape.shapeCache={};var i=ZWNetworkUtils.getUrl("revert");J.ajax({type:"POST",global:!1,dataType:"json",url:i,data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){"SUCCESS"==e.RESPONSE?(Ae(),PubSub.publish("Document/Reverted")):MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,J.i18n("common","ERROR"),J.i18n("common","VERSION_REVERT_ERROR"),null,null)},error:function(e,t,i){ZWCollaboration.handleSendMutationError(e,t,i)}})},Te=function(e){s.activeVersionInfo.notes=e;var t=l.versionsElem[s.activeVersionInfo.version_id];if(t){var i=t.find("#version-notes");i.removeAttr("title"),s.activeVersionInfo.notes.length>l.notesCharLimit&&(e=s.activeVersionInfo.notes.substr(0,l.notesCharLimit)+"...",i.attr("title",s.activeVersionInfo.notes));var n=DomUtil.createElement("span",{class:"ui-vhistory-desc ui-more"},e);i.html(n),t.find("#version-addnotes").attr("title",J.i18n("writer.history.EDIT_DESCRIPTION"))}},me=function(){var e=J("#add_version_desc_input"),t=J("#add_version_desc_dlg").zvalidation("validateAllFields",J("#add_version_desc_dlg"));if(t){var i=Ie(e.val(),Re());i.done(function(e){UIUtils.showMessage("info",J.i18n("history","VERSION_DESCRIPTION_ADDED"),"showclose","normalfont",3e3),Te(e)}),i.fail(function(){UIUtils.showMessage("warning",J.i18n("history","UNABLE_TO_ADD_DESCRIPTION"),"showclose","normalfont",3e3)}),J.dialogutil.close("addversiondesc")}},he=function(e){var t={init:function(e){var t=J(e),i=t.find("#add_version_desc_input");s.activeVersionInfo.notes&&i.val(s.activeVersionInfo.notes),i.focus()}};J.dialogutil.open("addversiondesc",J("#add_version_desc_dlg"),t),e&&DomUtil.stopEvent(e)},Ie=function(e,t){var i=J.Deferred(),n={};return t&&(n.versionid=t),n.description=e,J.ajax({type:"POST",async:!1,dataType:"json",url:ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/versions/description?from=editor"),data:n,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){"success"===t.result||"SUCCESS"==t.RESPONSE?i.resolve(e):i.reject()},error:function(e,t,n){i.reject(),ZWCollaboration.handleSendMutationError(e,t,n)}}),i.promise()},_e=function(){ce(),J('div[id^="z-cursor"]').show(),UIUtils.enableDocumentShortcuts(),TransformEventHandler.deselectObjects(),InsertShape.shapeCache={},editor.initDocument();var e=editor.doc.getParents(NODE_TYPE.PARAGRAPH,1);editor.doc.getSelection().removeAllRanges().moveTo(e,!0),LayoutManager.loadLayout(LayoutManager.getLayoutType()),PubSub.unsubscribe("Document/LoadingStart",_e)},Ae=function(){PubSub.publish("Document/History/BackToEditor"),l.isCompareContVisible&&le(),de(!0),editor.rebindEvents(),Z(d.VERSIONS_CONTAINER).empty();var e=document.querySelector("#history-dynamic-css");e&&e.remove(),T(),Je(),DocumentView.setZoomFactor(o),DocumentView.changeView(r),editor.setView(EDITOR_VIEWS.EDITOR),PubSub.subscribe("Document/LoadingStart",_e),editor.fetchDocument(editor.doc.docInfo.RID,""),PubSub.publish("Document/HistoryViewClosed")},Se=function(){return s.activeVersionInfo&&s.activeVersionInfo.docs_version},Re=function(){return s.activeVersionInfo&&s.activeVersionInfo.version_id},Oe=function(e){s.activeNavigationPage=e,P()},be=function(){Z(d.VERSION_PAGINATION).off().on("zpaginationchange",function(e,t){Oe(t.value)}).zpagination("updateItems",s.totalVersion,s.activeNavigationPage)},ve=function(){if(l.versionsElem[s.activeVersionInfo.version_id]){var e=l.versionsElem[s.activeVersionInfo.version_id].find("div.ui-vhistory-br");e.addClass("ui-vhistory-br-selected")}},De=function(){if(l.versionsElem[s.activeVersionInfo.version_id]){var e=l.versionsElem[s.activeVersionInfo.version_id].find("div.ui-vhistory-br");e.removeClass("ui-vhistory-br-selected")}},Le=function(e){e=e||0;var t=e+Z(d.VERSIONPANE_HEADER).outerHeight()+Z(d.VERSIONPANE_FOOTER).outerHeight();l.isCompareContVisible&&(t+=Z(d.COMPARE_CONTAINER).outerHeight()),Z("wmstoolbar").is(":visible")&&(t+=Z("wmstoolbar").outerHeight()),t=window.innerHeight-t,Z(d.VERSIONS_CONTAINER).height(t+"px")},Ne=function(){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING"));var e={};J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/version/showchanges"),data:e,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){e&&"SUCCESS"===e.RESPONSE?(_(u.SHOWCHANGES),j(e.source_version_info,e.target_version_info)):(UIUtils.hideViewChangesLink(),UIUtils.showMessage("warning",J.i18n("writer.history.UNABLE_TO_COMPARE_VERSION"),"showclose","normalfont",5e3)),UIUtils.hideLoadingMsg()},error:function(e,t,i){UIUtils.hideLoadingMsg(),UIUtils.hideViewChangesLink(),UIUtils.showMessage("warning",J.i18n("writer.history.UNABLE_TO_COMPARE_VERSION"),"showclose","normalfont",5e3)}})},Pe=function(i,n,o,r){_(u.QUICKDIFF);var a=new QuickDiff;try{dv=a.quickdiff(i,n)}catch(e){return void ke(e,i.versionInfo.version_id,n.versionInfo.version_id)}e.makeSingleColumn(dv.defaults),a.renderDiff(dv,function(){ce();var e={};e.isQuickDiff=!0,e.showCloseButton=!0,e.source=i.versionInfo,e.target=n.versionInfo,1==r?e.quickDiffType=1:(e.source.time=s.compareBetween.fromDate.getTime(),e.target.time=s.compareBetween.toDate.getTime()),e.showDetailDiffLink=!o,t.loadHistoryDiffPage(e),t.initChangesNavigation()})},Ce=function(e){var t={};t.COMPARE_LIST_TYPE=e;var i=ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/version/quickcompare"),n=new ZWDateTime(null,null,editorProps.userInfo.language);switch(e){case g.CUSTOM:var o=s.compareBetween.fromDate,r=s.compareBetween.toDate;t.from=o.getTime();var a=new Date(r);a.addDays(1),t.to=a.getTime();break;case g.THIS_MONTH:var l=new Date((new Date).setDate(1));s.compareBetween.fromDate=l,s.compareBetween.toDate=new Date;break;case g.THIS_WEEK:s.compareBetween.fromDate=n.getFirstDateOfWeek().getDateObj(),s.compareBetween.toDate=new Date;break;case g.TODAY:s.compareBetween.fromDate=s.compareBetween.toDate=new Date}de(),J.ajax({type:"POST",dataType:"json",url:i,data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){t&&"SUCCESS"===t.RESPONSE&&"diff"==t.STATUS?(Z(d.DATE_PICKER).hide(),Pe(t.sourceVersion,t.targetVersion,t.isDiffExcludePresent,e)):(ce(),ye(e))},error:function(t,i,n){ce(),Z(d.DATE_PICKER).hide(),ye(e)}})},ye=function(e){var t=J.i18n("writer.history.VERSIONS_NOT_FOUND_IN_RANGE");switch(e){case g.TODAY:t=J.i18n("writer.history.QUICKDIFF_NOTHING_CHANGED_MSG",[J.i18n("writer.common.TODAY")]);break;case g.THIS_WEEK:t=J.i18n("writer.history.QUICKDIFF_NOTHING_CHANGED_MSG",[J.i18n("writer.common.THIS_WEEK")]);break;case g.THIS_MONTH:t=J.i18n("writer.history.QUICKDIFF_NOTHING_CHANGED_MSG",[J.i18n("writer.common.THIS_MONTH")])}UIUtils.showMessage("error",t,"showclose","normalfont",3e3)},Fe=function(){Z(d.DATE_PICKER).show()},Me=function(){var t=J("#cfv-open-doc").data("rid");e.openDocument(t)},we=function(){l.visibleUserList&&(l.visibleUserList.fadeOut(),l.visibleUserList=void 0)},Ue=function(){return l.versionsElem[s.activeVersionInfo.version_id]},xe=function(e){var t=ZWNetworkUtils.getHostURL()+ZWNetworkUtils.getContextUrl("open/"+editor.doc.rid+"/version/"+e),i=HistoryUI.getSelectedVersionItemDOM(),n=i.offset();Utils.showLink(t,n.top,n.left)},Be=function(){setTimeout(function(){xe(s.activeVersionInfo.versionid_encrypted)},50)},He=function(){Z(d.VERSIONS_CONTAINER).on("scroll",we),PubSub.subscribe("Document/Resize",Le)},Je=function(){Z(d.VERSIONS_CONTAINER).off("scroll",we),PubSub.unsubscribe("Document/Resize",Le)},Ge=function(){_(u.VERSIONS),F(s.activeVersionInfo.version_id)},ke=function(e,t,i){Ye(ZWCollaboration.HISTORY_QUICK_COMPARE_ERROR,t,i,e),UIUtils.showMessagePopup(J.i18n("error","MSG_VERSION_COMPARE_ERROR"),J.i18n("error","TITLE_QUICKDIFF_ERROR"),"error",Ge,!1,!1)},We=function(e){if(R()){var t=editor.doc.docInfo.SOURCE_VERSION,i=editor.doc.docInfo.TARGET_VERSION;ke(e,t,i)}else PubSub.publish("Document/Warning",WARNING_MSG.UNABLE_TO_LOAD_VERSION_IN_HISTORY)},Ye=function(e,t,i,n){ZWLogger.log("\nERROR CODE: "+e+"\nSTACK TRACE : "+n.stack),ZWLogger.sendErrorDetails(e+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+e+" DOC len ="+editor.doc.getDocumentLength()+" buildLabel::: "+buildLabel+"\nError Log End \n<ZWERROR>SOURCE_VERSION : "+t+"\nTARGET_VERSION : "+i+"\nSTACK TRACE : "+n.stack,{SOURCE_VERSION:t,TARGET_VERSION:i},e)},ze=function(){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING"))},Ze=function(){UIUtils.initComponent("toolbar-versionview"),J("#toolbar-versionview").on("click",ToolbarHandler.handleZButtonClick),TopbandHandler.showToolbar(ELEM_ID.VERSIONVIEWTOOLBARCONTAINER),(editor.browserInfo.is_chrome||editor.browserInfo.is_opera)&&J("#versionview-tb-print-chrome").show(),editor.onResize()},Ve=function(){UIUtils.hideLoadingMsg()};return PubSub.subscribe("Document/ComponentInitialized",I),PubSub.subscribe("Document/HistoryLoadError",We),{isChangesView:A,isDiffView:S,isQuickDiffView:R,loadHistoryPage:v,showCompareContainer:se,hideCompareContainer:le,compareVersions:j,compareWithQuickDiff:z,clearSelectedVersions:Q,getSelectedDocsVersion:Se,getSelectedVersionId:Re,listVersions:N,loadVersionListPage:Ge,openRevertIconConfirmMsg:fe,openAddVerDescriptionDlg:he,addDescription:me,selectVersionFilter:pe,backToEditor:Ae,toggleUserList:X,addVersionDescription:Ie,showChangesSinceLastVisit:Ne,showChangesSince:Ce,pickCustomDates:Fe,data:s,openForkedVersion:Me,loadVersionView:m,loadVersionDiffPage:h,getSelectedVersionItemDOM:Ue,displayVersionLink:Be,HISTORY_VIEWS:u,setView:_,onBeforeVersionViewLoad:ze,initVersionViewTopband:Ze,onVersionViewLoad:Ve,onQuickDiffError:ke}}(HistoryUtils,HistoryDiffUI),HistoryDiffManager=function(e){var t={};t.versionsOps={},t.versionsContent={};var i,n,o,r,a,s,l,d,c=5,u=function(e,t){i=e,n=t,d=J.Deferred(),s=[],l=[],r=new DocOpBuilder,a=new DocOpBuilder},p=function(e){var i=[],n=!1;U.each(o,function(e){var o=!!t.versionsOps[e],r=i.length;(n!=o&&0!=r||!o&&r===c)&&(s.push({isOpsFilled:n,versions:i}),i=[]),i.push(e),n=o}),0!=i.length&&s.push({isOpsFilled:n,versions:i})},g=function(){i=void 0,n=void 0,o=[],r=void 0,a=void 0,s=[],l=[],d=void 0},f=function(e){l.contains(e)||l.push(e)},E=function(e){for(var t=e.getDocOps(),i=new DocOpBuilder,n=0,o=t.length;n<o;n++){var r=t[n];if(r.isDelete()){var a=new DocOp;a.skipChars(r.delete_characters.length),i.push(a)}else i.push(r)}return i},T=function(e){for(var t=e.getDocOps(),i=new DocOpBuilder,n=0,o=t.length;n<o;n++){var r=t[n];if(r.isInsert()){var a=new DocOp;a.skipChars(r.characters.length),i.push(a)}else i.push(r)}return i},m=function(e,t,i,n){var o=Utils.randomString(),r=h(t,i,n),a=new DocOp;a.changeStyles([],r,o);var s=I(i,e);return s.integralStyles.push(a),s},h=function(t,i,n){var o={};o[HISTORY_CONST.ZUID]=t,o[HISTORY_CONST.ACTION]=i,o.type=n;var r=e.getHistoryClass(t,i,n);return""!=r&&(o.cls=r),o},I=function(e,t){var i=new DocOp;return e==HISTORY_CONST.ACTION_INS?i.newCharacters(t):i.deleteCharacters(t),i},_=function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t],o=A(n);if(!o)break}},A=function(i){try{var n,o,s,l,c,u,p,g,E,T,h,_,A,S,R=t.versionsOps[i];for(var O in R){if(n=R[O],!n)return d.resolve(),!1;for(o=n.op,"string"==typeof o&&(o=jQuery.parseJSON(n.op)),s=DocOpBuilder.build(o),l=new DocOpBuilder,c=s.docOps,u=[],p=[],E=0,T=c.length;E<T;E++)if(h=c[E],g=n.zuid,!h.isLock()){if(h.isInsert()||h.isDelete()){var b,v;for(h.isInsert()?(b=h.characters,v=HISTORY_CONST.ACTION_INS):(b=h.delete_characters,v=HISTORY_CONST.ACTION_DEL),e.DIFF_REGEX.lastIndex=0,_=e.DIFF_REGEX.exec(b);_;){if(A=_[1],S=_[2],A){var L=m(A,g,v,NODE_TYPE.TEXT);p.push(L),f(g)}if(S)for(var N=0,P=S.length;N<P;N++){var C=S.charAt(N);if(e.isSupportedDataType(C)){var L=m(C,g,v,e.getDataType(C));p.push(L),f(g)}else p.push(I(v,C))}_=e.DIFF_REGEX.exec(b)}}else if(h.isRetain())p.push(h);else if(h.isAnnotationStart()){var y=DocUtil.copyStyle(h.styles.begin),F=h.styles.id,M=y.type?y.type:NODE_TYPE.TEXT;y={},y.type=M;var w=new DocOp;w.changeStyles([],y,F),p.push(w)}else h.isAnnotationEnd()&&p.push(h);u.push(h)}l.docOps=p,a=DocOpBuilder.compose(a,l),a=DocOpBuilder.concise(a),s.docOps=u,r=DocOpBuilder.compose(r,s),r=DocOpBuilder.concise(r)}}catch(e){var U;return"Lock error in compose"===e?(d.reject(J.i18n("writer.history.UNABLE_TO_COMPARE_DUE_TO_LOCK")),U="Lock error in compose"):(d.reject(),U=e.stack),D("EXECPTION WHILE COMPOSING OPS IN HISTORY DIFF RID : "+editor.doc.rid+" VERSIONID : "+i+" EXECPTION : "+U),!1}return!0},S=function(){var e={};return e.diffOps=r,e.diffStyleOps=a,e.participants=l,e.diffStyleOps=e.diffStyleOps.convertIntegralStylesToNormalOPs(),e.diffStyleOps=E(e.diffStyleOps),e.diffStyleOps=T(e.diffStyleOps),e.diffOps=e.diffOps.convertIntegralStylesToNormalOPs(),e.diffOps=E(e.diffOps),e},R=function(i,n){var o=J.Deferred();if(u(i,n),d.done(function(){var e=S();e.docContent={content:t.versionsContent[i]},o.resolve(e),g()}),d.fail(function(e){g(),o.reject(e)}),t.versionsContent[i])O();else{var r={success:function(e){t.versionsContent[i]=e.docContent,O()},failure:function(){d.reject(),D("EXECPTION WHILE GETTING VERSION CONTENT IN HISTORY DIFF RID : "+editor.doc.rid+" VERSION : "+i)}};e.getVersionContent(i,r)}return o.promise()},O=function(){var e={};e.source_versionid=i,e.target_versionid=n,J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/version/getlistofversion"),data:e,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){(e.RESPONSE="SUCCESS")?(e.versionlist.push(n),o=e.versionlist,p(e.versionlist),v()):(d.reject(),D("UNABLE TO GET VERSION LIST BETWEEN VERSIONS RID : "+editor.doc.rid+"  SOURCE : "+i+" TARGET : "+n))},error:function(e,t,o){d.reject(),D("EXECPTION WHILE GETTING VERSIONS LIST BETWEEN VERSIONS IN HISTORY DIFF RID : "+editor.doc.rid+"  SOURCE :"+i+" TARGET : "+n)}})},b=function(e){var i={};i.versionidlist=e.join(","),J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/version/getversionops"),data:i,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(i){if(i.RESPONSE="SUCCESS"){for(var n=i.version_ops,o=0,r=e.length;o<r;o++){var a=e[o];n[a]&&(delete n[a].locks,delete n[a].redactops,t.versionsOps[a]=n[a])}if(n.FAILURE)return d.reject(),void D("UNABLE TO GET VERSION OPS RID :"+editor.doc.rid+" VERSIONLIST : "+e+" FAILURE_IDS : "+JSON.stringify(n.FAILURE));s[0].isOpsFilled=!0,v()}else d.reject(),D("EXECPTION WHILE GETTING VERSIONS OPS IN HISTORY DIFF RID : "+editor.doc.rid+" VERSIONLIST : "+e)},error:function(t,i,n){d.reject(),D("EXECPTION WHILE GETTING VERSIONS OPS IN HISTORY DIFF RID : "+editor.doc.rid+" VERSIONLIST : "+e)}})},v=function(){if(!s||!s.length)return void(d&&d.resolve());var e=s[0];e.isOpsFilled?(_(e.versions),s.shift(),v()):b(e.versions)},D=function(e){var t=ZWCollaboration.HISTORY_COMPARE_ERROR;ZWLogger.log(e),ZWLogger.sendErrorDetails(t+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+t+" DOC len ="+editor.doc.getDocumentLength()+" buildLabel::: "+buildLabel+"\n Error Log End \n<ZWERROR>Exception : \n"+e,null,t)};return{getDiff:R,data:t}}(HistoryUtils),TimeUpdater=function(){var e=["reviewpane","comment-list-container","popup-menu-container","comment-notify-cont"],t=function(){i()},i=function(){setTimeout(function(){var t=[];e.forEach(function(e){var i=Z(e);i&&t.push(i)}),o(t),i()},6e4)},n=function(t){ZWArrayUtils.arrayContains(t)||e.push[t]},o=function(e){e.forEach(function(e){e.find(".dynamic-time").each(function(e,t){Jelm=J(t),Jelm.text(Utils.getTimeFromNow(parseInt(Jelm.attr("data-dynamic-time"))))})})};return PubSub.subscribeOnce("Document/ComponentInitialized",t),{addContainer:n,updateTime:o}}(),TwoWayHashMap=function(){this.map={},this.revMap={}};extend(TwoWayHashMap.prototype,{set:function(e,t){if(void 0===e||void 0===t)throw"Invalid input: Key or Value can't be undefined";this.map[e]=t,this.revMap[t]=e},getVal:function(e){return this.map[e]},getKey:function(e){try{return JSON.parse(this.revMap[e])}catch(t){return this.revMap[e]}}});var QuickDiff=function(e){e=e||{};var t=44032,i={},n=new TwoWayHashMap,o=new RegExp(UNICODE.TABLE+"|"+UNICODE.TABLEEND,"g"),r=new RegExp(UNICODE.TOCSTART+"|"+UNICODE.TOCEND,"g"),a=(new RegExp(UNICODE.MERGEFIELD_START+"|"+UNICODE.MERGEFIELD_END,"g"),new RegExp(UNICODE.RANGE_START+"|"+UNICODE.RANGE_END,"g")),s=new RegExp(UNICODE.SECTION_START,"g"),l=0,d=-1,c=1,u={INS:"ins",DEL:"del"},p=e.cleanupSemantic||!0,g=e.takeFormattingFromSource||!1,f=e.processRetains||!1,E=e.skipBlockInteriors||!0,T=QuickDiff.getComputedFmt,m=function(e){e=JSON.stringify(e);var i=n.getVal(e);return i||(i=String.fromCharCode(t++),n.set(e,i)),i},h=function(){i={},n=new TwoWayHashMap},I=function(e,t){var i=v(e,t);return i=D(i,t),i=L(i,t),i=N(i,t)},_=function(e,t,i){var n=e.substring(0,t),o=e.substring(t+1,e.length);return n+i+o},A=function(e,t,i){var n=e.slice(0,t),o=e.slice(t+1);return n.concat(i).concat(o)},S=function(e,t,i){var n=e.filter(function(e){return e.start<=t&&e.end>t}),o=e.filter(function(e){return e.start<t&&e.end<=t}),r=e.filter(function(e){return e.start>t&&e.end>t});return n=n.map(function(e){return e.end+=i-1,e}),r=r.map(function(e){return e.start+=i-1,e.end+=i-1,e}),o.concat(n).concat(r)},R=function(e,t,i){var n=i.filter(function(e){return e[0]==c}),o=i.filter(function(e){return e[0]==d}),r=t[0]==c?o:n,a=r.filter(function(t,i){var n=t[1];return n.indexOf(e)>-1}).length;return a},O=function(e,t,n){U.each(t,function(t){i[t.hashKey]=i[t.hashKey]||{},i[t.hashKey][n]={contStr:e.contStr.substring(t.start,t.end+1),styles:e.styles.slice(t.start,t.end+1)}})},b=function(e,t,i){var n={contStr:"",styles:[]};if(!t.length)return JSON.parse(JSON.stringify(e));var o=0;return U.each(t,function(i,r){n.contStr+=e.contStr.substring(o,i.start),n.styles=n.styles.concat(e.styles.slice(o,i.start)),n.contStr+=i.hashKey,n.styles.push({chartype:i.type});var a=t[r+1]?t[r+1].start:e.contStr.length;n.contStr+=e.contStr.substring(i.end+1,a),n.styles=n.styles.concat(e.styles.slice(i.end+1,a)),o=a}),n},v=function(e,t){for(var i=[],n=[],r=o.exec(e.contStr);r;){var a=e.contStr[r.index];if(a==UNICODE.TABLE)n.push(r.index);else if(a==UNICODE.TABLEEND){var s=n.pop();if(!n.length){var l=e.styles[s].id||"auto"+Utils.randomString(),d=m({type:"table",id:l});e.styles[s].id=l,i.push({start:s,end:r.index,hashKey:d,type:"table"})}}r=o.exec(e.contStr)}return O(e,i,t),b(e,i,t)},D=function(e,t){for(var i=[],n=[],o=r.exec(e.contStr);o;){var a=e.contStr[o.index];if(a==UNICODE.TOCSTART)n.push(o.index);else if(a==UNICODE.TOCEND){var s=n.pop(),l=m({type:"toc"});i.push({start:s,end:o.index,hashKey:l,type:"toc"})}o=r.exec(e.contStr)}return O(e,i,t),b(e,i,t)},L=function(e,t){for(var i=[],n=a.exec(e.contStr);n;){var o=e.contStr[n.index];if(o==UNICODE.RANGE_START){var r=e.styles[n.index],s=m({type:"rangestart",id:r.id});i.push({start:n.index,end:n.index,hashKey:s,type:"rangestart"})}else if(o==UNICODE.RANGE_END){var r=e.styles[n.index],s=m({type:"rangeend",id:r.id});i.push({start:n.index,end:n.index,hashKey:s,type:"rangeend"})}n=a.exec(e.contStr)}return O(e,i,t),b(e,i,t)},N=function(e,t){for(var i=[],n=s.exec(e.contStr);n;){var o=e.contStr[n.index];if(o==UNICODE.SECTION_START){var r=e.styles[n.index],a=m({type:"section",id:r.sid});i.push({start:n.index,end:n.index,hashKey:a,type:"section"})}n=s.exec(e.contStr)}return O(e,i,t),b(e,i,t)},P=function(e,t){if(!t.length)return JSON.parse(JSON.stringify(e));for(var n,o=new RegExp(t.join("|"),"g");null!=(n=o.exec(e.contStr));){var r=n[0],a=i[r].source&&!i[r].target,s=a?"source":"target";e.contStr=_(e.contStr,n.index,i[r][s].contStr),e.styles=A(e.styles,n.index,i[r][s].styles),e.dels=S(e.dels,n.index,i[r][s].contStr.length),e.ins=S(e.ins,n.index,i[r][s].contStr.length)}return e},C=function(e){var t=U.keys(i),o=t.filter(function(e){return"rangestart"===n.getKey(e).type||"rangeend"===n.getKey(e).type});return P(e,o)},y=function(e){var t=U.keys(i),o=t.filter(function(e){return"section"===n.getKey(e).type});return P(e,o)},F=function(e){var t=U.keys(i),o=t.filter(function(e){return"mergefield"===n.getKey(e).type});return P(e,o)},M=function(e){var t=U.keys(i),o=t.filter(function(e){return"toc"===n.getKey(e).type});return P(e,o)},w=function(e,t){return"contents"==t?i[e]:new B(e)},x=function(e){var t=U.keys(i),o=t.filter(function(e){return"table"===n.getKey(e).type});return U.each(o,function(t){var n,o,r;switch(n=i[t].target&&!i[t].source,o=i[t].source&&!i[t].target,r=void 0!=(i[t].source&&i[t].target),!0){case n:var a=w(t,"contents"),s=e.contStr.indexOf(t);e.contStr=_(e.contStr,s,a.target.contStr),e.styles=A(e.styles,s,a.target.styles),e.dels=S(e.dels,s,a.target.contStr.length),e.ins=S(e.ins,s,a.target.contStr.length);break;case o:var a=w(t,"contents"),s=e.contStr.indexOf(t);e.contStr=_(e.contStr,s,a.source.contStr),e.styles=A(e.styles,s,a.source.styles),e.dels=S(e.dels,s,a.source.contStr.length),e.ins=S(e.ins,s,a.source.contStr.length);break;case r:var l=w(t,"structure"),a=l.decode(),s=e.contStr.indexOf(t);e.contStr=_(e.contStr,s,a.diffed.contStr),e.styles=A(e.styles,s,a.diffed.styles),e.dels=S(e.dels,s,a.target.contStr.length),e.ins=S(e.ins,s,a.target.contStr.length),U.each(a.diffed.ins,function(e){e.start+=s,e.end+=s}),U.each(a.diffed.dels,function(e){e.start+=s,e.end+=s}),e.ins=e.ins.concat(a.diffed.ins),e.dels=e.dels.concat(a.diffed.dels)}}),JSON.parse(JSON.stringify(e))},B=function(e){this.hashKey=e,this.source=i[e].source,this.target=i[e].target,this.diffed={},this.diffed.ins=[],this.diffed.dels=[],this._cellContentHash={},this._charHash=new TwoWayHashMap,this.rows={source:{},target:{},diffed:{}},this.cells={source:[],target:[]},this.init()};extend(B.prototype,{hash:function(e){e=JSON.stringify(e);var i=this._charHash.getVal(e);return i||(i=String.fromCharCode(t++),this._charHash.set(e,i)),i},init:function(){var e=this.cells,t=this._cellContentHash;if(this.source){e.source=QuickDiff.getCells(this.source),U.each(e.source,function(e){var i=e.styles[0].id=e.styles[0].id||Utils.randomString(),n=this.hash({type:"cell",id:i});e.hashKey=n,t[n]=t[n]||{},t[n].source={contStr:e.contStr,styles:e.styles}},this);var i=QuickDiff.getRows(this.source);U.each(i,function(e){var t=e.styles[0].id=e.styles[0].id||Utils.randomString();this.rows.source[t]=e},this)}if(this.target){e.target=QuickDiff.getCells(this.target),U.each(e.target,function(e){var i=e.styles[0].id=e.styles[0].id||Utils.randomString(),n=this.hash({type:"cell",id:i});e.hashKey=n,t[n]=t[n]||{},t[n].target={contStr:e.contStr,styles:e.styles}},this);var i=QuickDiff.getRows(this.target);U.each(i,function(e){var t=e.styles[0].id=e.styles[0].id||Utils.randomString();this.rows.target[t]=e},this)}extend(this.diffed,JSON.parse(JSON.stringify(this.target))),e.diffed=QuickDiff.getCells(this.diffed),U.each(e.diffed,function(e){var i=e.styles[0].id,n=this.hash({type:"cell",id:i});t[n]=t[n]||{},t[n].diffed={contStr:e.contStr,styles:e.styles}},this);var i=QuickDiff.getRows(this.diffed);U.each(i,function(e){var t=e.styles[0].id;this.rows.diffed[t]=e},this)},getCellDiff:function(e){var t=this.rows.source[e],i=QuickDiff.getCells(t).map(function(e){var t=e.styles[0].id=e.styles[0].id||Utils.randomString();return this.hash({type:"cell",id:t})},this).join(""),n=this.rows.target[e],o=QuickDiff.getCells(n).map(function(e){var t=e.styles[0].id=e.styles[0].id||Utils.randomString();return this.hash({type:"cell",id:t})},this).join(""),r=QuickDiff.dmp.diff_main(i,o);return r},getRowDiff:function(){var e=U.keys(this.rows.target).filter(function(e){return!this.rows.source[e]},this),t=U.keys(this.rows.source).filter(function(e){return!this.rows.target[e]},this),i=U.keys(this.rows.target).filter(function(e){return this.rows.source[e]},this);return{insertions:e,deletions:t,retains:i}},getCellIdx:function(e,t,i){for(var n=new RegExp(UNICODE.CELL,"g"),o=n.exec(this[i].contStr);null!=o;){var r=this[i].styles[o.index];if(this._charHash.getKey(t).id===r.id)return{start:e+o.index,end:e+o.index+this._cellContentHash[t][i].contStr.length};o=n.exec(this[i].contStr)}},getRowIdx:function(e,t){for(var i=new RegExp(UNICODE.ROW,"g"),n=i.exec(this[t].contStr);null!=n;){var o=this[t].styles[n.index];if(e===o.id)return{start:n.index,end:n.index+this.rows[t][e].contStr.length};n=i.exec(this[t].contStr)}},diffCell:function(e){var t=new QuickDiff;return t.diff({contStr:this._cellContentHash[e].source.contStr,styles:this._cellContentHash[e].source.styles},{contStr:this._cellContentHash[e].target.contStr,styles:this._cellContentHash[e].target.styles})},addDiffedCell:function(e,t){var i=this.diffed;if(t.ins.length||t.dels.length){var n=this.getCellIdx(0,e,"diffed");i.contStr=i.contStr.substring(0,n.start)+t.contStr+i.contStr.substring(n.end),i.styles=i.styles.slice(0,n.start).concat(t.styles).concat(i.styles.slice(n.end)),i.ins=i.ins.concat(t.ins.map(function(e){return{start:n.start+e.start,end:n.start+e.end,str:e.str}})),i.dels=i.dels.concat(t.dels.map(function(e){return{start:n.start+e.start,end:n.start+e.end,str:e.str}}))}},diff:function(){var e=this.getRowDiff();return U.each(e.insertions,function(e){var t=this.getRowIdx(e,"diffed");this.diffed.ins.push({start:t.start,end:t.end,str:this.rows.diffed[e].contStr})},this),U.each(e.retains,function(e){var t=this.getCellDiff(e);U.each(t,function(e){var t=e[1];e[0]===c?U.each(t,function(e){var t=this.getCellIdx(0,e,"diffed");this.diffed.ins.push({start:t.start,end:t.end,str:this._cellContentHash[e].target.contStr})},this):e[0]===l&&U.each(t,function(e){var t=this.diffCell(e);this.addDiffedCell(e,t)},this)},this)},this),this.diffed},decode:function(){return this.diffed=this.diff(),U.extend(i[this.hashKey],{diffed:{contStr:this.diffed.contStr,styles:this.diffed.styles,ins:this.diffed.ins,dels:this.diffed.dels}})}});var H=function(e,t,o){return U.filter(e,function(e,r){if(i[e]){var a=n.getKey(e);if("rangestart"==a.type||"rangeend"==a.type||"table"==a.type||"toc"==a.type||"section"==a.type)return R(e,t,o)}}).map(function(t){return{ch:t,index:e.indexOf(t)}})},J=function(e,t){return e.source.contStr===t.target.contStr?100:0},G=function(e){return U.reduce(e,function(e,t,i){var n=U.reduce(t,function(e,i,n){var o=e?t[e]:0;return i>o?n:e},0),n=n&&t[n]>99&&!U.contains(U.values(e),n)?n:0;return e[i]=n,e},{})},k=function(e,t,o){var r=U.keys(i),a=r.filter(function(e){var t=n.getKey(e);return"table"===t.type&&i[e].source&&!i[e].target&&t.id.startsWith("auto")}),s=r.filter(function(e){var t=n.getKey(e);return"table"===t.type&&!i[e].source&&i[e].target&&t.id.startsWith("auto")}),l=U.reduce(a,function(e,t){var i=n.getKey(t),o=w(t,"contents");return e[i.id]=U.reduce(s,function(e,t){var i=n.getKey(t),r=w(t,"contents");return e[i.id]=J(o,r),e},{}),e},{});l=G(l),U.each(l,function(e,n){if(e){var o=m({type:"table",id:n}),r=m({type:"table",id:e}),a=QuickDiff.getRows(i[o].source),s=QuickDiff.getCells(i[o].source);U.each(a,function(e){e.styles[0].id=Utils.randomString()}),U.each(s,function(e){e.styles[0].id=Utils.randomString()}),i[o].target={},i[o].target.contStr=i[o].source.contStr,i[o].target.styles=JSON.parse(JSON.stringify(i[o].source.styles));var l=t.contStr.indexOf(r);t.contStr=_(t.contStr,l,o),delete i[r]}})},W=function(e){var t=new RegExp(UNICODE.SECTION_START,"g");t.lastIndex=1;for(var i=t.exec(e.content),n=[],o=0;i;)n.push({contStr:e.content.substring(o,i.index),styles:e.styles.slice(o,i.index)}),o=i.index,i=t.exec(e.content);return n.push({contStr:e.content.substring(o),styles:e.styles.slice(o)}),n},Y=function(e){return X(e.filter(function(e){var t=e.styles[0];return"content"===t.st}))},z=function(e){return e.filter(function(e){return U.contains([CONST.HEADER_EVEN,CONST.HEADER_PRIMARY,CONST.HEADER_FIRST],parseInt(e.styles[0].hftype))})},Z=function(e){return e.filter(function(e){return U.contains([CONST.FOOTER_EVEN,CONST.FOOTER_PRIMARY,CONST.FOOTER_FIRST],parseInt(e.styles[0].hftype))})},V=function(e){return e.filter(function(e){var t=e.styles[0];return"endnote"===t.st||"footnote"===t.st})},j=function(e){return e.filter(function(e){var t=e.styles[0];return"textbox"===t.st})},X=function(e){return e.reduce(function(e,t){return e.contStr+=t.contStr,e.styles=e.styles.concat(t.styles),e},{contStr:"",styles:[]})},K=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if(e.sid===n.styles[0].sid)return!0}return!1},q=function(e,t){return e.filter(function(e){var i=e.styles[0];return K(i,t)})},Q=function(e,t){return t.filter(function(t){var i=t.styles[0];return!K(i,e)})},$=function(e,t){return e.filter(function(e){var i=e.styles[0];return!K(i,t)})},ee=function(e,t){return{additions:Q(e,t),deletions:$(e,t),retains:q(e,t)}},te=e.addDiffStyles||function(e,t){return e.history_zuid=editor.zuid,e.history_action=t,e},ie=e.dropDiffStyles||function(e){return delete e.history_zuid,delete e.history_action,e},ne=function(e,t,i){if(t.start!==t.end)for(var n=t.start;n<=t.end;n++){if(n==t.start){var o=T(e,n);o=te(o,i),e.styles[n]=o,n=E?QuickDiff.getBlockEnd(e,n):n}else if(n==t.end){var o=e.styles[n];o||(o=T(e,n),ie(o),e.styles[n]=o)}else{var o=e.styles[n];o&&(o=te(o,i)),e.styles[n]=o,n=E?QuickDiff.getBlockEnd(e,n):n}if(n<0)return}},oe=function(e,t,i){if(t.start!==t.end)for(var n=t.start;n<t.end;n++){var o=e.styles[n];if(o&&o.type&&o.history_action&&(o.cls=((o.cls||"")+" "+HistoryUtils.getQuickDiffClass(o.type,i)).trim(),e.styles[n]=o),n<0)return}},re=function(e){return U.each(e.ins,function(t){ne(e,t,u.INS)}),U.each(e.dels,function(t){ne(e,t,u.DEL)}),U.each(e.ins,function(t){oe(e,t,u.INS)}),U.each(e.dels,function(t){oe(e,t,u.DEL)}),e},ae=function(e){return shouldRecomputeFmt={ins:!!g||e[0]===d,del:!g||e[0]===c,retain:g?e[0]===c:e[0]===d}},se=function(e,t){var i=JSON.parse(JSON.stringify(t));i.contStr="",i.styles=[],i.ins=[],i.dels=[];var n=W(e),o=W(t),r=Y(n),a=Y(o);r.styles[0].sid=a.styles[0].sid;var s=X(z(o)),l=X(Z(o)),d=V(n),c=V(o),u=ee(d,c),p=X(u.additions),g=X(u.retains),f=X(u.deletions),E=j(n),T=j(o),m=ee(E,T),h=X(m.additions),I=X(m.retains),_=X(m.deletions),A=le(r,a);i.contStr+=A.contStr+s.contStr+l.contStr+g.contStr+p.contStr+f.contStr+I.contStr+h.contStr+_.contStr,i.styles=i.styles.concat(A.styles).concat(s.styles).concat(l.styles).concat(g.styles).concat(p.styles).concat(f.styles).concat(I.styles).concat(h.styles).concat(_.styles),i.ins=A.ins,i.dels=A.dels,i.SOURCE_VERSION=e.versionInfo&&e.versionInfo.writer_version,i.TARGET_VERSION=t.versionInfo&&t.versionInfo.writer_version,U.defaults(i.defaults,e.defaults),i.content=i.contStr;var S=JSON.parse(JSON.stringify(e.defaults));return ZWJSONUtils.deepMerge(S,i.defaults),i.defaults=S,i},le=function(t,i){h(),encodedSource=I({contStr:t.contStr,styles:t.styles},"source"),encodedTarget=I({contStr:i.contStr,styles:i.styles},"target"),t.contStr=encodedSource.contStr,t.styles=encodedSource.styles,i.contStr=encodedTarget.contStr,i.styles=encodedTarget.styles,k(t,i);var n=QuickDiff.dmp.diff_main(t.contStr,i.contStr);p&&QuickDiff.dmp.diff_cleanupSemantic(n);var o={};o.contStr="",o.styles=[],o.ins=[],o.dels=[];var r=0,a=0,s=0,u=o.ins,E=o.dels,m=[];formattingContent=g?t:i,U.each(n,function(p,h){var I=p[0],_=p[1],A=(ae(m),g?r:a);if(I==l){if(o.contStr+=_,shouldRecomputeFmt.retain){var S=T(formattingContent,A);formattingContent.styles[A]=S}var R=formattingContent.styles.slice(A,A+_.length);R=f?f(R,t,i,r,a,e):R,o.styles=o.styles.concat(R),r+=_.length,a+=_.length,s+=_.length}else if(I==c){if(shouldRecomputeFmt.ins){var S=T(i,a);i.styles[a]=S}o.contStr+=_,o.styles=o.styles.concat(i.styles.slice(a,a+_.length));var O=H(_,p,n),b=0;U.each(O,function(e){var t=_.substring(b,e.index);t.length&&u.push({start:s+b,end:s+e.index,str:t}),b=e.index+1});var v=_.substring(b);v&&u.push({start:s+b,end:s+b+_.substring(b).length,str:_.substring(b)}),a+=_.length,s+=_.length}else if(I==d){if(shouldRecomputeFmt.del){var S=T(t,r);t.styles[r]=S}var O=H(_,p,n),D="",L=[],b=0;U.each(O,function(e){var i=_.substring(b,e.index);D+=i,L=L.concat(t.styles.slice(r,r+i.length)),b=e.index+1,r=r+i.length+1});var N=_.substring(b);D+=N,L=L.concat(t.styles.slice(r,r+N.length)),r+=N.length,o.contStr+=D,o.styles=o.styles.concat(L),D.length&&E.push({start:s,end:s+D.length,str:D}),s+=D.length}m=p});var _=x(o);return _=M(_),_=F(_),_=C(_),_=y(_),o.contStr=_.contStr,o.styles=_.styles,o.ins=_.ins,o.dels=_.dels,o},de=function(e,t){var i=function(){t&&t(),PubSub.unsubscribe("Document/LoadingComplete",i)},n=function(){PubSub.unsubscribe("Document/LoadingComplete",i)};PubSub.subscribe("Document/LoadingComplete",i),PubSub.subscribe("Document/HistoryLoadError",n),re(e),editor.loadDocument({content:e,info:U.extend(editor.doc.docInfo,{SOURCE_VERSION:e.SOURCE_VERSION,TARGET_VERSION:e.TARGET_VERSION})})};return{quickdiff:se,diff:le,renderDiff:de,drawDiffMarkers:re}};QuickDiff.dmp=new diff_match_patch,QuickDiff.getTableEnd=function(e,t){var i=new RegExp(UNICODE.TABLE+"|"+UNICODE.TABLEEND,"g");t=e[t]===UNICODE.TABLE?t+1:t,i.lastIndex=t;for(var n=i.exec(e);null!=n;){var o=n[0];if(o!==UNICODE.TABLE)return n.index;i.lastIndex=QuickDiff.getTableEnd(e,n.index+1)+1,n=i.exec(e)}throw new Error("TABLE-END cannot be found for start: ",t)},QuickDiff.getTocEnd=function(e,t){var i=new RegExp(UNICODE.TOCSTART+"|"+UNICODE.TOCEND,"g");t=e[t]===UNICODE.TOCSTART?t+1:t,i.lastIndex=t;for(var n=i.exec(e);null!=n;){var o=n[0];if(o===UNICODE.TOCEND)return n.index}throw new Error("TOC-END cannot be found for start: ",t)},QuickDiff.getCellEnd=function(e,t){var i=new RegExp(UNICODE.CELL+"|"+UNICODE.ROW+"|"+UNICODE.TABLEEND+"|"+UNICODE.TABLE,"g");t=e[t]===UNICODE.CELL?t+1:t,i.lastIndex=t;for(var n=i.exec(e);null!=n;){var o=n[0];if(o!==UNICODE.TABLE)return n.index;i.lastIndex=QuickDiff.getTableEnd(e,n.index+1)+1}throw new Error("CELL-END cannot be found for start: ",t)},QuickDiff.getRowEnd=function(e,t){var i=new RegExp(UNICODE.ROW+"|"+UNICODE.TABLEEND+"|"+UNICODE.TABLE,"g");t=e[t]===UNICODE.ROW?t+1:t,i.lastIndex=t;for(var n=i.exec(e);null!=n;){var o=n[0];if(o!==UNICODE.TABLE)return n.index;i.lastIndex=QuickDiff.getTableEnd(e,n.index+1)+1}throw new Error("ROW-END cannot be found for start: ",t)},QuickDiff.getBlockEnd=function(e,t){var i=e.styles[t]||{};return"table"===i.type?QuickDiff.getTableEnd(e.contStr,t):"toc"==i.type?QuickDiff.getTocEnd(e.contStr,t):"cell"==i.type?QuickDiff.getCellEnd(e.contStr,t):"row"==i.type?QuickDiff.getRowEnd(e.contStr,t):t},QuickDiff.getRows=function(e){for(var t=[],i=null,n=1,o=e.contStr.length;n<o;){var r=e.contStr[n];if(r==UNICODE.ROW||r==UNICODE.TABLEEND){if(i){var a={};e.styles[i];a.contStr=e.contStr.substring(i,n),a.styles=e.styles.slice(i,n),a.start=i,a.end=n-1,t.push(a),i=null}r==UNICODE.ROW&&(i=n),n++}else r==UNICODE.TABLE?n=QuickDiff.getTableEnd(e.contStr,n+1)+1:n++}return t},QuickDiff.getCells=function(e){for(var t=[],i=null,n=1,o=e.contStr.length;n<o;){var r=e.contStr[n];if(r==UNICODE.CELL||r==UNICODE.ROW||r==UNICODE.TABLEEND||n==o-1){if(i){var a={};e.styles[i];a.contStr=e.contStr.substring(i,n),a.styles=e.styles.slice(i,n),a.start=i,a.end=n-1,t.push(a),i=null}r==UNICODE.CELL&&(i=n),n++}else r==UNICODE.TABLE?n=QuickDiff.getTableEnd(e.contStr,n+1)+1:n++}return t},QuickDiff.getRawFormatAt=function(e,t){return e.styles[t]?clone(e.styles[t]):e.styles[t]},QuickDiff.getTypeAt=function(){var e={};return e[UNICODE.HR]=NODE_TYPE.HR,e[UNICODE.TABLE]=NODE_TYPE.TABLE,e[UNICODE.ROW]=NODE_TYPE.ROW,e[UNICODE.CELL]=NODE_TYPE.CELL,e[UNICODE.TABLEEND]=NODE_TYPE.TABLEEND,e[UNICODE.BR]=NODE_TYPE.BR,e[UNICODE.PARA]=NODE_TYPE.PARAGRAPH,e[UNICODE.SECTION_START]=NODE_TYPE.HEADER,function(t,i){var n=QuickDiff.getRawFormatAt(t,i);return n&&n.type||e[t.contStr[i]]||NODE_TYPE.TEXT}}(),QuickDiff.getComputedFmt=function(e,t){for(var i=QuickDiff.getTypeAt(e,t);t>=0;){for(;null==QuickDiff.getRawFormatAt(e,t)&&t>0;)t--;if(i==QuickDiff.getTypeAt(e,t))break;t--}return t>=0?QuickDiff.getRawFormatAt(e,t):null},zw.define("CombineAdapter",[],[],function(){var e=function(){zw.require({js:[jsCdnZWStaticPath+fingerPrintObj["js/writer_combine_min_all.js"]]},["Combine"],function(e){e.doCombine()},function(e){Notification.show({message:"writer.common.COMBINE_JS_FETCH_FAILED_ERROR",type:"error"}),t(e,"COMBINE_JS_FETCH_FAILED")})},t=function(e,t){var i=e.stack;ZWLogger.log("\n"+i);var n=t+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\nError Log End \n<ZWERROR>";ZWLogger.sendErrorDetails(n,{error:i},t)};return{doCombine:e,sendError:t}}),function(){"use strict";var e={allBar:{}},t=function(e){this._={id:"QSB-"+e};var t;Object.defineProperties(this._,{JbarElem:{get:function(){return t&&t.length&&t.parent()||(t=J(document.createElement("div")).attr("id",this.id).html('<span class="quickSeekBarTitle" style="border-bottom:1px solid red; display:inline-block;"><span style="float:left; margin-top:2px; margin-bottom:2px; width:10px; height:10px;"> </span></span>'),J("#quickSeekBarDiv").append(t)),t}},JbulletinElems:{get:function(){return this.JbarElem.find(".quick-bulletin")}},JtitleElem:{get:function(){return this.JbarElem.find(".quickSeekBarTitle")}}})};t.prototype.addBulletins=function(){var e=this,t=0,i=[],n=DocLayoutManager.getLastPage(),o=DomViewManager.getDOMElem(n),r=o.getBoundingClientRect().height*DocLayoutManager.getPageCount();U.each(this.ranges,function(n,o){var a=J.Deferred();a.done(function(){var i,a,s=DocLayoutManager.getLineAtIndex(n.start),l=s&&DomViewManager.getDomFromCurrentPage(s);l&&(i=PUtil.offset(l),a=i.top);var d;if(!l||a<=0){var c=DocLayoutManager.getPageAtIndex(n.start),u=J(DomViewManager.getDOMElem(c)).position().top;d=u*editor.zoomFactor*editor.editorPaneContainerHt/r,d+=6*++t}else d=a*editor.zoomFactor*editor.editorPaneContainerHt/r;var p=e.createNewBulletinSpan(n);p.style.top=d+e._.JtitleElem.outerHeight()+"px",p.onclick=function(t){EditorUtil.focusMultiByteSpan(),e.spotSelection(n,o)},J(p).addClass(e.selectedBulletinIndex===o?"bulletin-selected":"").appendTo(e._.JbarElem)}),i.push(a)});var a=0;clearInterval(e.addBulletinInterval),e.addBulletinInterval=setInterval(function(){i[a++].resolve(),a>=i.length&&clearInterval(e.addBulletinInterval)},0),J.when.apply(J,i).then(function(){e.callback&&e.callback()})},t.prototype.createNewBulletinSpan=function(e){return DomUtil.createElement("span",{style:"background-color: "+(e&&e.buttonBGColor||this.buttonBGColor)+"; border: 1px solid "+(e&&e.buttonBRColor||this.buttonBRColor),class:"quick-bulletin"})},t.prototype.drawQuickSeekBar=function(e){return e&&!J.isEmptyObject(e)&&e.ranges&&e.ranges.length?(this.initQuickSeekBar(e),this.addBulletins(),void this.showQuickSeekBar()):this.hideQuickSeekBar()},t.prototype.hideQuickSeekBar=function(){this._.JbarElem.length&&(this.removeAllBulletins(),this._.JbarElem.hide())},t.prototype.initQuickSeekBar=function(e){extend(this,e),this.selectedBulletinIndex=-1,this.removeAllBulletins(),this.setBarHeight(),this.setBarTitle(J.i18n("writer.common.NUMBER_OF_RESULTS")+" "+this.ranges.length)},t.prototype.removeAllBulletins=function(){this._.JbulletinElems.remove()},t.prototype.setBarHeight=function(){this._.JbarElem.css({height:editor.editorPaneContainerHt})},t.prototype.setBarTitle=function(e){this._.JtitleElem.attr("title",e).find("span").css({"background-color":this.buttonBGColor,border:"1px solid "+this.buttonBRColor})},t.prototype.showQuickSeekBar=function(){this._.JbarElem.show()},t.prototype.spotSelection=function(e,t){var i=DocLayoutManager.getLineAtIndex(e.start);if(i){ZWLogger.addToStatistics("Selection Bulletin"),J(this.overlayToBeAnimated).removeClass(this.focusClass||""),this.selectedBulletinIndex=t;var n=DocLayoutManager.getPageAtIndex(e.start)||DocLayoutManager.getFirstPage();n&&DomViewManager.forceToRender(n),DomUtil.scrollElementIntoView(DomViewManager.getDomFromCurrentPage(i));var o=this;U.each(DocLayoutManager.linesBetween(e.start,e.end),function(e){o._.JbulletinElems.removeClass("bulletin-selected").eq(t).addClass("bulletin-selected");var i=DomViewManager.getDOMElem(e);J(i).children(o.overlayToBeAnimated).addClass(o.focusClass||"").addTimerClass("bounceIn",800)})}};var i=function(i){var n=new t(i);return e.allBar[i]=n,n},n=function(t){return e.allBar[t]};PubSub.subscribe("QuickSeek/showBarWithObj",function(e){if(e&&e.id){var t=n(e.id)||i(e.id);t.drawQuickSeekBar(e)}}),PubSub.subscribe("QuickSeek/hideBarWithID",function(e){var t=n(e);t&&t.hideQuickSeekBar()}),PubSub.subscribe(["Document/Model/InitStart","QuickSeek/hideAllBar"],function(){for(var t in e.allBar){var i=n(e.allBar[t]);i&&i.hideQuickSeekBar()}})}(),function(){var e=!1,t=!1,i="t4",n=/^\s*</,o="default-code",r="Source Code Pro",a={t0:{ml:"0.125in",mr:"0.125in",borders:{}},t1:{ml:"0.125in",mr:"0.125in",bgc:"rgb(32, 39, 70)",borders:{"border-left":{type:"solid",width:"5px",color:"rgb(187,166,69)",space:"0.2in"},"border-right":{type:"solid",width:"0px",color:"rgb(187,166,69)",space:"0.1in"},"border-top":{type:"solid",width:"0px",color:"rgb(187,166,69)",space:"0.1in"},"border-bottom":{type:"solid",width:"0px",color:"rgb(187,166,69)",space:"0.1in"}},t_fgc:"rgb(255, 255, 255)"},t2:{ml:"0.125in",mr:"0.125in",bgc:"rgb(245, 245, 245)",borders:{"border-left":{type:"solid",width:"5px",color:"rgb(255,143,104)",space:"0.2in"},"border-right":{type:"solid",width:"0px",color:"rgb(255,143,104)",space:"0.1in"},"border-top":{type:"solid",width:"0px",color:"rgb(255,143,104)",space:"0.1in"},"border-bottom":{type:"solid",width:"0px",color:"rgb(255,143,104)",space:"0.1in"}},t_fgc:"rgb(0, 0, 0)"},t3:{ml:"0.125in",mr:"0.125in",bgc:"rgb(255, 255, 255)",borders:{"border-left":{type:"solid",width:"5px",color:"rgb(55,174,243)",space:"0.2in"},"border-right":{type:"solid",width:"1px",color:"rgb(225,225,225)",space:"0.1in"},"border-top":{type:"solid",width:"1px",color:"rgb(225,225,225)",space:"0.1in"},"border-bottom":{type:"solid",width:"1px",color:"rgb(225,225,225)",space:"0.1in"}},t_fgc:"rgb(0, 0, 0)"},t4:{ml:"0.125in",mr:"0.125in",bgc:"rgb(29, 31, 33)",borders:{"border-left":{type:"solid",width:"5px",color:"rgb(179,199,70)",space:"0.2in"},"border-right":{type:"solid",width:"0px",color:"rgb(179,199,70)",space:"0.1in"},"border-top":{type:"solid",width:"0px",color:"rgb(179,199,70)",space:"0.1in"},"border-bottom":{type:"solid",width:"0px",color:"rgb(179,199,70)",space:"0.1in"}},t_fgc:"rgb(255, 255, 255)"}},s={neon:"t1",simple:"t2",frost:"t3","night-owl":"t4",nightowl:"t4"},l={coffee:"Coffee Script",ruby:"Ruby",bash:"BASH",perl:"PERL","default-code":"Auto","default-markup":"Auto",c:"C",cpp:"C++","c++":"C++",cs:"C#","c#":"C#",java:"Java",js:"JavaScript",python:"Python",html:"HTML",xml:"XML",css:"CSS",json:"JSON",swift:"Swift",go:"GO",sql:"SQL"},d={},c={type:"text"};c[ATTR_TEXT.TS_FF]="",c[ATTR_TEXT.TS_FGC]="",d[ATTR_COMMON.BORDERS]="",d[ATTR_PARAGRAPH.PS_CODE]="",d[ATTR_PARAGRAPH.PS_BGC]="",d[ATTR_PARAGRAPH.PS_ML]="",d[ATTR_PARAGRAPH.PS_MR]="",d[ATTR_COMMON.TYPE]=NODE_TYPE.PARAGRAPH,d[ATTR_PARAGRAPH.PS_TS]=c;var u=function(e){return n.test(e)?"default-markup":"default-code"},p=function(e){return e=e.toLowerCase().replace(/ /g,""),l[e]?e:o},g=function(e){return e=e.toLowerCase().replace(/ /g,""),s[e]||i},f=function(){if((e||(x(),e))&&(k(),t&&editor.doc.getSelection().selectionType!==SEL_AUTO_GEN)){var i=H();if(i&&i.isCode()&&!editor.isFinalDocument()){var n=h(i),o=n.getNode().getCodeLanguage(),r=E(n);"default-code"!=o&&"default-markup"!=o||(o="auto"),Z("code-menu-container").css(r).show(),Z("code-lang-dropdown").zselectbox("setValue",o),Z("code-theme-dropdown").zselectbox("setValue",n.getNode().getCodeTheme()),EditorUtil.focusMultiByteSpan(),CurUtil.blinkCursor()}}},E=function(e){var t,i=editor.currentPageIndex,n=(DocLayoutManager.getPageAtPageNumber(i+1),e.getNode().section.getSectionType());if(n==SECTION_TYPES.HEADER||n==SECTION_TYPES.FOOTER){var o=DocLayoutManager.getLineAtIndex(editor.doc.getSelection()[0].start).parent;t=PUtil.offset(DomViewManager.getAllDomFromCurrentPage(h(o).getNode())[0])}else{var r=DomViewManager.getDOMElem(e);t=PUtil.offset(r)}var a=(e.getNode().getParaStyles().ml||"0in",e.getNode().getParaStyles().mr||"0in"),s=a.convertUnitTo("px"),l=e.getNode().getParaStyles().borders||{},d=l[ATTR_BORDERS.BORDER_LEFT]?l[ATTR_BORDERS.BORDER_LEFT].space.convertor().pixels:0,c=(l[ATTR_BORDERS.BORDER_RIGHT]?l[ATTR_BORDERS.BORDER_RIGHT].space.convertor().pixels:0,editor.zoomFactor),u=J("#code-menu-container"),p=u.width(),g=u.height(),f=e.width/2-s+d-(editor.editorOffset.left+editor.editorPaneContainer.scrollLeft());return{top:t.top*c-(g+9),right:editor.jeditorPaneWrapper.width()-(t.left+f)*c-p/2}},T=function(e){var t=H(),i=t.getCodeLanguage(),n=t.getCodeTheme();n!=e&&editor.doc.execCmd("updatecode",[i,e])},m=function(e){e=e||{};var t=Y(),i=t.length;if(i){var n=t[0].getIndex(),o=t[i-1].getEndIndex()+1,r=editor.doc.getSelection(),a=r.getTargetRange().cloneRange(),s=editor.doc.createRange(n,o);r.removeAllRanges().addRange(s),e.increaseFontSize?DocUtil.increaseOrDecreaseFontSize(r,1):DocUtil.increaseOrDecreaseFontSize(r,-1),r.removeAllRanges().addRange(a)}},h=function(e){var t=I(e);if(t){for(var i=t.getPage().getAbsolutePageNumber(),n=t,o=n.prev,r=n.getNode().getCodeProperties(),a=n.getNode().format&&n.getNode().format.ls_data;o&&D(o.getNode())&&i==o.getPage().getAbsolutePageNumber()&&v(r,o.getNode().getCodeProperties());)if(a){if(!v(a,o.getNode().format.ls_data))break;n=o,o=n.prev}else{if(o.getNode().format.ls_data)break;n=o,o=n.prev}return n}},I=function(e){var t=DocLayoutManager.getViews(e);if(t){var i=t.length;if(1==i)return t[0];if(i>1)for(var n,o,r,a,s=editor.doc.getSelection(),l=s.getStart(),d=0;d<i;d++)if(n=t[d],a=n.nodeLines,o=n.getNode().start+a[0].start,r=n.getNode().start+a[a.length-1].end,l>=o&&l<=r)return n}},_=function(e,t){var i=b(),n=i.length;if(n){var o=i[0],r=i[0].getIndex(),a=i[n-1].getEndIndex()+1;"auto"==e&&(e=u(o.content())),t=t||o.getCodeTheme(),N(e,t,r,a);var s=i[0].getFormat().ls_data&&i[0].getFormat().ls_data.l||i[0].paraProperties.isList;if(s){var l=O(i[n-1]);ee(l);var d=R(i[0]);ee(d),ee(i,t)}}},A=function(e){var t=[];if(e.isCode()){var i=R(e),n=O(e);t=t.concat(i,[e],n)}return t},S=function(){var e=[],t=editor.doc.getSelection(),i=editor.doc.getNodesInSelection(NODE_TYPE.PARAGRAPH,t.getStart(),t.getEnd()),n=A(i[0].dtNode);for(e.push(n);n[n.length-1].getEndIndex()<t.getEnd();){var o=n[n.length-1].next;if(!o||o.type!=NODE_TYPE.PARA)break;n=A(o),e.push(n)}return e},R=function(e){var t=[],i=e,n=e.getCodeProperties(),o=e.format&&e.format.ls_data;if(e.isCode())for(;i.prev&&i.prev.type==NODE_TYPE.PARA&&v(n,i.prev.getCodeProperties());)if(o){if(!v(o,i.prev.format.ls_data))break;t.unshift(i.prev),i=i.prev}else{if(i.format.ls_data)break;t.unshift(i.prev),i=i.prev}return t},O=function(e){var t=[],i=e,n=e.getCodeProperties(),o=e.format&&e.format.ls_data;if(e.isCode())for(;i.next&&i.next.type==NODE_TYPE.PARA&&v(n,i.next.getCodeProperties());)if(o){if(!v(o,i.next.format.ls_data))break;t.push(i.next),i=i.next}else{if(i.format.ls_data)break;t.push(i.next),i=i.next}return t},b=function(){var e,t=[],i=editor.doc.getSelection(),n=i.getNodesInSelection(NODE_TYPE.PARAGRAPH),o=n.length;if(e=n[0].dtNode,i.isCollapsed())t=A(e);else for(var r=0;r<o;r++)t.push(n[r].dtNode);return t},v=function(e,t){return ZWJSONUtils.compareJSON(e,t)},D=function(e){return"para"==e.type&&e.isCode()},L=function(e,t){var n=editor.doc.getSelection(),o=n.getNodesInSelection(NODE_TYPE.PARAGRAPH),r=o.length,a=o[0];if("auto"==e&&(e=u(a.dtNode.content())),a.dtNode.isCode())return void Command.exec("uncode",!0);var s=o[0].getStart(),l=o[r-1].getEnd();t=t||i,e=e||u(a.dtNode.content()),N(e,t,s,l,o)},N=function(e,t,n,o,s){var l={},d=editor.doc.getSelection(),c=a[t||i],p=DocUtil.formatGenerator.getParaFormat("ParaBackColor",c.bgc),g=(ZWJSONUtils.getKeys(p),d.getTargetRange()),f=g.cloneRange();g.setStart(n),g.setEnd(o),l=DocUtil.formatGenerator.getTextFormat(p,"FontName",[r]),l[ATTR_TEXT.TS_FGC]="",l[ATTR_TEXT.TS_BGC]="",d.applyFormat(l),d=editor.doc.getSelection(),s=s||d.getNodesInSelection(NODE_TYPE.PARAGRAPH),p[ATTR_PARAGRAPH.PS_TS]=l,p[ATTR_PARAGRAPH.PS_ML]=c.ml,p[ATTR_PARAGRAPH.PS_MR]=c.mr,p[ATTR_COMMON.BORDERS]=c.borders,p[ATTR_PARAGRAPH.PS_CODE]={lg:e||u(s[0].dtNode.content()),theme:t,t_fgc:c.t_fgc,p_bgc:c.bgc};var E=s[0].attr()||{},T=E.code||{};if(E&&E.ls_data&&0==E.ls_data.l){var m=editor.doc.getListObj(E.ls_data.id),h=(T.theme,{st:"listFormat"}),I=!1;if(t&&(I=!0,m=y(m,t)),I){var _=d.getParents(NODE_TYPE.BODY);h[E.ls_data.id]=m,_.attr(h)}var A=d.getParaFormat();A&&A.ml&&A.mr&&(p[ATTR_PARAGRAPH.PS_ML]=A.ml,p[ATTR_PARAGRAPH.PS_MR]=A.mr)}else $(s,t,p),p[ATTR_PARAGRAPH.PS_ML]=P(p,s[0]);M(s,p),d.removeAllRanges().addRange(f)},P=function(e,t){var i=ListUtils.getTextIndent(t),n=t.attr(ATTR_PARAGRAPH.PS_ML)?t.attr(ATTR_PARAGRAPH.PS_ML):e.ml,o=parseFloat(n.convertor().inches)-parseFloat(i)+"in";return o},C=function(e,t){var i=ListUtils.getTextIndent(t),n=parseFloat(e.convertor().inches)+parseFloat(i)+"in";return n},y=function(e,t){return"t1"==t||"t4"==t?e.level0.paraFormat={textFormat:{fgc:"rgb(255, 255, 255)"}}:"t2"!=t&&"t3"!=t||(e.level0.paraFormat={textFormat:{fgc:"rgb(0, 0, 0)"}}),e},F=function(e,t){var i=editor.doc.getSelection(),n=i.getNodesInSelection(NODE_TYPE.PARAGRAPH,i.getStart(),i.getEnd()),o=n.length;if(o){Boolean(ListUtils.isList(n[0].attr("*")))&&te(t);var r;if(e){if(o=t.length,!o)return;var a=t[0].getIndex(),s=t[o-1].getEndIndex()+1;r=i.getTargetRange(),targetRangeClone=r.cloneRange(),r.setStart(a),r.setEnd(s),n=i.getNodesInSelection(NODE_TYPE.PARAGRAPH,a,s)}i.applyFormat(c);for(var l=0,o=n.length;l<o;l++)n[l].attr(DocUtil.copyStyle(d));e&&i.removeAllRanges().addRange(targetRangeClone)}},M=function(e,t){var i,n;for(i=0;i<e.length;i++)n=e[i],n.attr(t)},w=function(e){var t=e.text().replace("\n",""),i=RANDOM_CODE_BLOCK_INS_REGEX.exec(t)[1],n=i.split(","),o=n[0]||"",r=n[1]||"",a=g(r),s=p(o);editor.doc.execCmd("code",[s,a]),editor.doc.getSelection().deleteContents(e.getStart(),e.getEnd()-1)},U=function(){var e=H();if(e){var t=A(e),i=t.length;if(i){var n=t[0].getIndex(),o=t[i-1].getEndIndex()+1,r=editor.doc.createRange(n,o);editor.doc.getSelection().removeAllRanges().addRange(r)}}},x=function(){if(!G())return!1;UIUtils.initComponent("code-menu-container");var t=Z("code-menu-container");return t.on("comboshow",function(){t.addClass("ui-focused")}),t.on("combohide",function(){t.removeClass("ui-focused")}),t.find("#code-theme-dropdownContainer, #code-lang-dropdownContainer").ztooltip({displayType:"callout",pauseOnHover:!0,position:"top"}),e=!0,!0},B=function(){var e=H();return e&&e.isCode()},H=function(){var e=editor.doc.getSelection(),t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e[0].start);if(t)return t.dtNode},G=function(){return editor.getRole().permissions.can("document.edit")},k=function(){var e=Z("code-menu-container");e.hide()},W=function(e){if(e=e||[],!e.length)return!1;for(var t=0;t<e.length;t++)if(!e[t].dtNode.isCode())return!1;return!0},Y=function(){var e=H();return e?A(e):[]},z=function(){var e=Y(),t=e.length;if(t){var i=e[0],n=e[t-1],o=n.getNextSibling(),r=i.getIndex(),a=o&&o.getType()==NODE_TYPE.PARA,s=a?n.getEndIndex()+1:n.getEndIndex(),l=editor.doc.createRange(r,s);l.deleteContentsInRange(),a||F(!0,[n])}},V=function(){G()&&(t=!0,PubSub.subscribe("Document/Command/Code/Delete",z),PubSub.subscribe("Document/Command/Code/ChangeFontSize",m),PubSub.subscribe("Document/Command/Code/Insert",L),PubSub.subscribe("Document/Command/Code/Update",_),PubSub.subscribe("Document/Command/Code/Remove",q),PubSub.subscribe("Document/Command/Code/InsertRandomCode",w),PubSub.subscribe("Document/Command/Code/ApplyLineNumbering",X),PubSub.subscribe("Document/Command/Code/RemoveLineNumbering",K),PubSub.subscribe(["Cursor/Selected","Cursor/Collapsed"],f,{async:!0,timeout:500}),PubSub.subscribe("Document/Resize",f,{async:!0,timeout:30}))},j=function(){t=!1,k(),PubSub.unsubscribe("Document/Command/Code/Delete",z),PubSub.unsubscribe("Document/Command/Code/ChangeFontSize",m),PubSub.unsubscribe("Document/Command/Code/Insert",L),PubSub.unsubscribe("Document/Command/Code/Update",_),PubSub.unsubscribe("Document/Command/Code/Remove",q),PubSub.unsubscribe("Document/Command/Code/InsertRandomCode",w),PubSub.unsubscribe("Document/Command/Code/ApplyLineNumbering",X),PubSub.unsubscribe("Document/Command/Code/RemoveLineNumbering",K),PubSub.unsubscribe(["Cursor/Selected","Cursor/Collapsed"],f,{async:!0}),PubSub.unsubscribe("Document/Resize",f,{async:!0})},X=function(){for(var e=S(),t=e.length,i=0;i<t;i++){var n=e[i];ee(n)}},K=function(){for(var e=S(),t=e.length,i=0;i<t;i++){var n=e[i];te(n)}Q()},q=function(e){for(var t=S(),i=t.length,n=0;n<i;n++){var o=t[n];F(e,o)}},Q=function(){var e=editor.doc.getSelection();if(e.isListItemSelection){var t=e.getTargetRange();e.isListItemSelection=!1;var i=e.getStart();t.setStart(i),t.setEnd(i),e.removeAllRanges().addRange(t)}},$=function(e,t,i){var n=editor.doc.getSelection(),o=editor.doc.getNewListId(),r=DocUtil.copyStyle(LIST_STYLE_OBJECT[0]);r.level0.c="\0";var a=t?t:e[0].attr().code.theme;r=y(r,a);var s=n.getParents(NODE_TYPE.BODY),l={st:"listFormat"};l[o]=r,s.attr(l),ListOperation.applyListProperties(e,{t:0,l:0,id:o},function(e,t){return t.l=0,ZWCode.addTextIndent(i,e)})},ee=function(e,t){var i=editor.doc.getSelection(),n=e.length;if(n){var o=e[0].getIndex(),r=e[n-1].getEndIndex()+1,a=i.getNodesInSelection(NODE_TYPE.PARAGRAPH,o,r),s=DocUtil.getParaStyle(o);$(a,t,s)}},te=function(e){var t=editor.doc.getSelection(),i=e.length;if(i){var n=e[0].getIndex(),o=e[i-1].getEndIndex()+1,r=t.getNodesInSelection(NODE_TYPE.PARAGRAPH,n,o);ListOperation.removeListProperties(r)}},ie=function(e){var t=e.prev,i=e.next;if(ne(e)&&oe(e)){var n=t.format[ATTR_PARAGRAPH.LS_DATA].id,o=i.format[ATTR_PARAGRAPH.LS_DATA].id;if(o.id!=n)return!0}return!1},ne=function(e){var t=e.prev,i=e.next;return!!(t&&t.type==NODE_TYPE.PARA&&i&&i.type==NODE_TYPE.PARA&&t.isCode()&&i.isCode())},oe=function(e){var t=e.prev,i=e.next;return!!(t&&t.format&&t.format[ATTR_PARAGRAPH.LS_DATA]&&i&&i.format&&i.format[ATTR_PARAGRAPH.LS_DATA])};PubSub.subscribe("Document/readonlyview",j),PubSub.subscribe("Document/ComponentReady",V),window.ZWCode={isCodePara:B,selectCodeBlock:U,isOnlyCodeParas:W,handleSwitchThemeBtnClick:T,isContinueWithPreviousList:ie,isPrevAndNextCodeBlock:ne,addTextIndent:P,removeTextIndent:C,THEME_SYTLES:a}}();var TableVisualCueHandler=function(e){var t=null,n=null,o=null,r=null,a=!1,s=!1,l={},d=!1,c=null,u=null,p=null,g=null,f=null,E=0,T=!0,m={},h=void 0,I=!1,t=null,_=!0,A=1,S=null,R=null,O=null,b=null,v=null,D=!1,L=!1,N=null,P=null,C=!1,y=!1,F=!1,M=null,w=null,x=null,B=null,H={},G=15,k=15,Y=[],z=!1,V=!1,j=!1,X=function(e,t){if(clearTimeout(h),(!c||e!=v)&&J(e).parents(".selectableSection")[0])return c&&ce(),t?void K(e):void(h=setTimeout(function(){K(e)},300))},K=function(e){v=e;var i=DocUtil.getDocElement(v);o=i,t=o.getStart(),n=o.getEnd(),q(),v&&(r=o.dtNode,tableHeight=J(v).height(),m=J(v).offset(),Q(),fe())},q=function(){try{var e=DocLayoutManager.getCurrentLine(),t=DomViewManager.getDomFromCurrentPage(e);v=J(t).parents("table.zw-table")[0],v||ce()}catch(e){}},Q=function(){c=document.getElementById("table-visualcue"),u=c.children,P=u[0],N=u[1],$(),re(),le(),s=!0,1==A&&(A="0.5"),pe(A),C&&Ge()},$=function(){var e=editor.doc.getRawFormatAt(o.getStart()),t=TableUtil.getCols(o),i=[];if(e.wid.indexOf("%")!=-1)for(var n=DocLayoutManager.getViews(o.dtNode)[0].width,r=0;r<t.length;r++){var a=parseFloat(t[r].wt),s=a/100*n;i[r]={},i[r].wt=s}else{var n=e.wid.convertor().pixels;i=t}n*=editor.zoomFactor;var r,l=i.length,d=P.querySelectorAll(".ui-tbl-vc-tp-cell")[0].cloneNode("deep");J(P).children().remove();var c=o.attr(),u=o.dtNode.id.split("_")[1],p="style_"+u;u="counter_"+u;var g=document.getElementById(p);if(g||(g=document.createElement("style"),g.id=p,document.getElementsByTagName("head")[0].appendChild(g)),g.innerHTML="#"+u+"{ counter-reset: alphaIncreament "+(c.dir&&"rtl"===c.dir?t.length+1:0)+" ; }",P.setAttribute("id",u),c.dir&&"rtl"===c.dir){var f=d.querySelectorAll(".ui-tbl-vc-txt")[0];f.classList.remove("ui-tbl-cell-hz-content"),f.classList.add("ui-tbl-cell-hz-rtlcontent")}else{var f=d.querySelectorAll(".ui-tbl-vc-txt")[0];f.classList.remove("ui-tbl-cell-hz-rtlcontent"),f.classList.add("ui-tbl-cell-hz-content")}for(r=0;r<l;r++){var s=0;s=c.dir&&"rtl"==c.dir?i[l-1-r].wt.convertor().pixels*editor.zoomFactor:i[r].wt.convertor().pixels*editor.zoomFactor,d.style.width=s+"px",d.setAttribute("id","cell-column-"+(r+1));var E=d.querySelectorAll(".ui-tbl-hd-content")[0];E.style.width=s-1+"px",J(P).append(J(d)),d=d.cloneNode("deep")}var T=J(document.createElement("div"));T.addClass("clearfix"),P.style.width=n+15+"px",J(P).append(T)},ee=function(e,t){e.css({opacity:t})},te=function(){var e=0,t=0,i=0,n=J(window).width(),o=Z("editorpane").width();return Z("panel-container").is(":visible")&&(e=Z("panel-container")[0].offsetWidth),ie()&&(t=Z("documentmapzdialog")[0].offsetWidth),i=n-o-e-t,i/2>100},ie=function(){return!("undefined"==typeof DocumentMap||!DocumentMap.getPanelPinState()||!DocumentMap.isVisible())},ne=function(){var e=editor.doc.getSelection(),t=(e.getStart(),e.getParents(NODE_TYPE.TABLE)),i=t&&editor.doc.getRawFormatAt(t.getStart()),n=J("#visual-queue-tablebtn");if(i&&i.type==NODE_TYPE.TABLE){n.show();var o=i.name;i.name||(o=TableCollectionInstance.getUnnamedTableNameFromId(i.id)),n.zbutton(),n[0].setAttribute("title",o),n.text(o);var r=1,a=1;!Z(ELEM_ID.EDITORRIGHTPANEL).is(":visible")&&te()||(r=1,a=.5),n.off("mouseover").on("mouseover",ee.bind(null,n,r)),n.off("mouseout").on("mouseout",ee.bind(null,n,a)),ee(n,a),n.css(oe())}else n.hide();editor.doc.isEditableMode()?n.off("click").on("click",TableRenameDialog.open):n.off("click")},oe=function(){var e=DocLayoutManager.getCurrentLine(),t=DomViewManager.getDomFromCurrentPage(e),i=J(t).parents("table.zw-table")[0],n=J(i).offset(),o=editor.jeditorPane.offset(),r=n.top-o.top-17;return Z(ELEM_ID.EDITORRIGHTPANEL).is(":visible")||!te()?{"max-width":"25px",top:r,left:"auto",right:editor.jeditorPaneWrapper.width()-(editor.jeditorPane.width()-10)*editor.zoomFactor+"px"}:{"max-width":"80px",top:r,right:"auto",left:(editor.jeditorPane.width()+10)*editor.zoomFactor+"px"}},re=function(e,t){for(var i=DomViewManager.getDocView(v),n=(i.getNode(),0),o=[],r=i.childViews.first;r;)DomViewManager.getDOMElem(r)&&r.getHeight()>0&&o.push(r),r=r.next;o[0]&&(n=o[0].getNode().getChildIndex()),N.style["counter-reset"]="numberIncreament "+n;var a=N.querySelectorAll(".ui-tbl-vc-lt-cell")[0].cloneNode("deep");J(a).find(".ui-tbl-cell-vt-content").first().show(),J(N).children().remove();for(var s,l,d=o.length,c=0;c<d;c++){l=o[c],s=DomViewManager.getDOMElem(l);var u=J(s).height()*editor.zoomFactor;a.setAttribute("id","cell-row-"+(l.getNode().getChildIndex()+1));var p=a.querySelectorAll(".ui-tbl-vc-lt-content")[0];if(l.getNode().format.condition){var g;c==e&&t?J(a).find(".ui-tbl-vc-lt-content").removeClass("ui-tbl-condtn-cell ui-tbl-condtn-cell-selected ui-active").removeAttr("title"):(g=ConditionalUIHandler.getTooltip(l.getNode().format).innerText,g=g.substring(0,g.length-1),J(a).find(".ui-tbl-vc-lt-content").addClass("ui-tbl-condtn-cell").removeClass("ui-active").attr("title",g),J(a).ztooltip({displayType:"callout",pauseOnHover:!0,position:"top",isMessageHTMLEncoded:!1,title:g,className:"ui-tooltip-width"}))}else J(a).find(".ui-tbl-vc-lt-content").removeClass("ui-tbl-condtn-cell ui-tbl-condtn-cell-selected ui-active").removeAttr("title");p.style.height=u-1+"px",n+c+1>99?k=25:n+c+1>9&&(k=20),J(N).append(J(a)),a=a.cloneNode("deep"),J(a).find(".ui-tbl-vc-lt-content").removeClass("ui-tbl-condtn-cell").attr("title","")}var f=o[0]&&DomViewManager.getDOMElem(o[0]);f&&f.className&&f.className.indexOf("ui-state-disabled")!=-1&&J(N).find(".ui-tbl-cell-vt-content").first().hide(),J(N).find(".ui-tbl-vc-lt-content").css("width",k+"px")},ae=function(){if(v){var e=J(v).offset();editor.jeditorPane.offset();l.top=e.top-G,l.left=e.left-k,l.right=e.left+k+J(v).width()*editor.zoomFactor,l.bottom=e.top+G+J(v).height()*editor.zoomFactor}},se=function(e,t,i){t=t||"",i=i||"",J(e).css({"-ms-transform":t,"-moz-transform":t,"-webkit-transform":t,"-o-transform":t,transform:t,"-ms-transform-origin":i,"-moz-transform-origin":i,"-webkit-transform-origin":i,"-o-transform-origin":i,"transform-origin":i})},le=function(){Z("popup-menu-container");ae();var t=J(v).offset(),i=DomViewManager.getDocView(v),n=editor.jeditorPane.offset(),o=t.top-n.top,r=t.left-n.left,a=2;u[0].style.top=o-G-a+"px",u[0].style.left=r+"px",u[1].style.top=o+"px",u[1].style.left=r-k-a+"px",O.style.top=o-G-a+"px",O.style.left=r-k-a+"px";var s=J(v),l=s.parents(".zw-textbox-div")[0],d=!!l,p=d?TextBoxHandler.getRotation(l):0,g=d?"rotate("+p+"deg)":"",f="";if(d){var E=e.rotateElement(s[0],p,editor.zoomFactor);o=e.distanceBetween(E.y,n.top,editor.zoomFactor),u[1].style.top=o+"px",o=e.distanceBetween(E.y-G-a,n.top,editor.zoomFactor),u[0].style.top=o+"px",O.style.top=o+"px",r=e.distanceBetween(E.x,n.left,editor.zoomFactor),u[0].style.left=r+"px",r=e.distanceBetween(E.x-k-a,n.left,editor.zoomFactor),u[1].style.left=r+"px",O.style.left=r+"px";var T=s.height()/2+G+a+"px",m=s.width()/2+"px";f=m+" "+T,se(u[0],g,f),T=s.height()/2+"px",m=s.width()/2+k+a+"px",f=m+" "+T,se(u[1],g,f),T=s.height()/2+G+a+"px",m=s.width()/2+k+a+"px",f=m+" "+T,se(O,g,f),W(Array.prototype.slice.call(u)).css({zIndex:5})}else se(u[1],g,f),se(u[0],g,f),se(O,g,f);Tt([P,N,c]),0!=i.rowStart||d||Tt(O)},de=function(t,i){var n=J(v),o=n.parents(".zw-textbox-div")[0],r=!!o,a=0;r&&(a=r?TextBoxHandler.getRotation(o):0);var s=e.rotateElement(v,a,editor.zoomFactor),l={x:t,y:i},d=e.rotateWRToEl(l,a,v,editor.zoomFactor);return d.x>=s.x-30&&d.y<=s.y+30&&d.y>=s.y-30||d.x<=s.x+30&&d.y<=s.y+s.height+30&&d.x>editor.editorOffset.left},ce=function(e,i){if(e){var o=e.clientX,r=e.clientY,a=de(o,r);a?(pe("1",100),_=!0,T=!1):T&&pe("0.5")}else if(clearTimeout(h),s){s=!1,pt(["ui-active","drag-ui-tbl-hd-content"]);var l=c.querySelectorAll(".ui-tbl-vc-lt")[0],d=c.querySelectorAll(".ui-tbl-vc-tp")[0],u=l.children[0].cloneNode("deep"),p=d.children[0].cloneNode("deep");J(l).children().remove(),J(l).append(J(u)),J(d).children().remove(),J(d).append(J(p)),Et([c,O,O,S,R,b]),Y=[],t=n=0,J("#insert-dummy-container").hide(),J("#insert-dummy-div").hide(),J("#table-visual-cue-popups")[0].style.opacity="1",c=null,v=null,Ze(),L=!1,D=!1,j=!1,V=!1,H={}}},ue=function(e){if(1==e){if(v&&tableHeight!=J(v).height())return Ve(),void TableResize.updateTableResizeIcon(o);J(c.children[1]).children().show();var t={width:"0px",height:"0px","background-color":"none"};J(c.children[1]).css(t)}else if(!_){J(c.children[1]).children().hide();var t={width:k+"px",height:J(v).height()*editor.zoomFactor+"px","background-color":"#efefef"};J(c.children[1]).css(t)}},pe=function(e,t){s&&(e||(e=A),A=e,clearTimeout(h),t?h=setTimeout(function(){ge(e,c)},t):ge(e,c))},ge=function(e,t){if(t){0==e&&(T=!0),ue(e);var i=J("#tablePropWrapper")[0];i&&"0.1"!=i.style.opacity&&(i.style.opacity=e),J("#table-visual-cue-popups").children().css("opacity",e),J(t).children().css("opacity",e),Z("tableResizeIconDiv").css("opacity",e)}},fe=function(){a||(J("#table-bubble").unbind().on("click",function(e){return e.stopPropagation(),he(),!1}),PubSub.subscribe(["Document/TableDeleted"],ce),PubSub.subscribe(["Document/TableStructureModified","Document/Zoom","Document/UndoRedo"],Ve,!0),PubSub.subscribe(["Document/TableStructureModified"],function(e){try{e||(e=DocUtil.getDocElement(TableVisualCueHandler.getTargetElement())),PanelUtil.updateTablePropWrapperPos(),TableResize.updateTableResizeIcon(e)}catch(e){}}),PubSub.subscribe(["Document/Resize"],ae),J("#tableMove").on("mousedown",function(e){PubSub.publish("Document/Table/MouseDown",J(v))}),J("#tableMove").on("mousemove",function(e){EventHandler.isTableDrag&&(J("#tableMove").hide(),pe("0")),PubSub.publish("Document/Table/DragInProgress",null,J(v))}),J("#tableMove").on("mouseup",function(e){return e.stopPropagation(),PubSub.publish("Document/Table/DragStopped",e,r),Ve(),!1}),PubSub.subscribe("Document/BeforeKeyDown",ft),TableMoveHandler.bindEvents(),a=!0),J(".ui-tbl-vc-tp-cell").on("click",function(e){D=!1,z=!1,V=!1,j=!1,H={};var t=e.ctrlKey;return I=!e.altKey&&!e.shiftKey&&(editor.browserInfo.is_mac?!t&&e.metaKey:t),T=!1,Ie(this),e.stopPropagation(),!1}),J(".ui-tbl-vc-lt-cell").on("click",function(e){L=!1,z=!1,V=!1,j=!1,H={};var t=e.ctrlKey;return I=!e.altKey&&!e.shiftKey&&(editor.browserInfo.is_mac?!t&&e.metaKey:t),T=!1,Se(this),e.stopPropagation(),!1}),J(".ui-tbl-vc-tp-cell").on("mouseover",function(e){J(J(this).children()[1]).hasClass("ui-active")&&!z&&be(this)}),J(".ui-tbl-vc-lt-cell").on("mouseover",function(e){J(J(this).children()[1]).hasClass("ui-active")&&!z&&Oe(this);var t=J(this).find(".ui-tbl-vc-lt-content");t.hasClass("ui-tbl-condtn-cell")&&t.addClass("ui-tbl-condtn-cell-selected")}),J(".ui-tbl-vc-lt-cell").on("mouseout",function(e){var t=J(this).find(".ui-tbl-vc-lt-content");if(t.hasClass("ui-tbl-condtn-cell-selected")){var i=Te();t.parent().attr("id")!=="cell-row-"+i&&t.removeClass("ui-tbl-condtn-cell-selected")}}),J(".ui-tbl-vc-tp-cell").on("mousedown",function(e){return J(this).find("div.ui-tbl-hd-content").hasClass("drag-ui-tbl-hd-content")?Pe(e,this):(z=!0,V=!0,j=!1,D=!1),H.x=e.clientX,H.y=e.clientY,H.max={},H.max.x=e.clientX,H.max.y=e.clientY,H.min={},H.min.x=e.clientX,H.min.y=e.clientY,H.currentCell=p,H.currentColIndex=E,e.stopPropagation(),!1}),J(".ui-tbl-vc-tp-cell").on("mousemove",function(e){return Ce(e,this),e.stopPropagation(),!1}),J(".ui-tbl-vc-tp-cell").on("mouseup",function(e){z=!1,V=!1,j=!1,I=!1,D&&ye(e,this),D=!1,L=!1,H={}}),J(".ui-tbl-vc-lt-cell").on("mousedown",function(e){return J(this).find("div.ui-tbl-vc-lt-content").hasClass("drag-ui-tbl-hd-content")?ve(e,this):(z=!0,j=!0,V=!1,L=!1),H.x=e.clientX,H.y=e.clientY,H.max={},H.max.x=e.clientX,H.max.y=e.clientY,H.min={},H.min.x=e.clientX,H.min.y=e.clientY,H.currentCell=p,H.currentColIndex=E,e.stopPropagation(),!1}),J(".ui-tbl-vc-lt-cell").on("mousemove",function(e){return De(e,this),e.stopPropagation(),!1}),J(".ui-tbl-vc-lt-cell").on("mouseup",function(e){z=!1,V=!1,j=!1,I=!1,L&&Le(e,this),L=!1,D=!1,H={}})},Ee=function(){if(!editor.getRole().permissions.can("document.edit"))return!1;var e,i=editor.doc.getSelection(),n=(i.getStart(),i.getParents(NODE_TYPE.TABLE)),o=DocLayoutManager.getCurrentLine(),r=DomViewManager.getDomFromCurrentPage(o);if(e=J(r).parents("table.zw-table")[0],v&&e==v&&i._.SELECTION_TYPE!=SEL_AUTO_GEN&&i._.SELECTION_TYPE!=SEL_OP_GEN)return TableMoveHandler.setTableSelected(!1),i[0]._.isPartialTableSelected?void ce():(setTimeout(function(){q()},100),ze(),void(m&&J(e).offset().top!=m.top&&Ve()));if(e&&n&&!i[0]._.isPartialTableSelected)if(i._.SELECTION_TYPE!=SEL_AUTO_GEN&&i._.SELECTION_TYPE!=SEL_OP_GEN||n.getStart()!=t){if(!document.getElementById("table-visualcue-popup"))return void mt();X(e)}else Ze();else TableMoveHandler.setTableSelected(!1),ce()},Te=function(){for(var e=editor.doc.getSelection().getParents(NODE_TYPE.ROW).dtNode,t=1;e.prev;)e=e.prev,t++;return t},me=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.ROW);if(e&&e.dtNode){var t=e.dtNode;pos=Te(),J(N).find(".ui-tbl-condtn-cell-selected").removeClass("ui-tbl-condtn-cell-selected"),t.format.condition&&J(N).find(".ui-tbl-vc-lt-content").eq(pos-1).addClass("ui-tbl-condtn-cell-selected")}};PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected"],Ee),PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected"],me,{async:!0,timeout:1e3}),PubSub.subscribe(["Document/view/changed","DocumentMap/PinStateUpdate"],ne),PubSub.subscribe(["UiEvents/EditorParentOffsetChanged","Cursor/Collapsed","Cursor/Selected"],ne,{async:!0,timeout:100});var he=function(){var e=editor.doc.getSelection(),t=r?r.firstChild().firstChild().getIndex()+1:1,i=editor.doc.createRange(t,t);e.removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(i),b.getAttribute("class").indexOf("col-bubble")!=-1?Ke(p):Qe(p),Ve()},Ie=function(e,t){Je(e,!1);var i=editor.doc.getSelection();if(I&&0!=Y.length)pt(["drag-ui-tbl-hd-content"]);else{var n=p.getStart()+1,o=editor.doc.createRange(n,n);i.removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(o),pt(["ui-active","drag-ui-tbl-hd-content"]),Y=[]}i.selectColumn(g).setSelectionType(SEL_AUTO_GEN).setLastModifiedPosition("end").select(),editor.clientActiveSection&&editor.clientActiveSection.className.indexOf("zw-contentpane")!=-1&&_e(!1),t||be(e),setTimeout(function(){editor.clientActiveSection&&editor.clientActiveSection.className.indexOf("zw-contentpane")==-1&&(q(),We(J(e),!1),_e(!1))},100)},_e=function(e){var t=editor.doc.getSelection();Y=[];var n=t.length;for(i=0;i<n;i++){var o=t[i]._.selectedCells,r=o[0],a=o[o.length-1];if(r&&a){var s=r.getMatrixPosition(),l=a.getMatrixPosition();if(s&&l)if(e){for(var d=(r.parent.parent,DomViewManager.getDocView(v)),c=0,u=d.childViews.first;u;){if(DomViewManager.getDOMElem(u)&&u.getHeight()>0){c=u.getNode().getChildIndex();break}u=u.next}for(var p=s[0];p<=l[0];p++)f=J("#cell-row-"+(p+1))[0],f&&(Y.push(f),ct("ui-active"),We(J(f),!0),ke(f,!0))}else for(var g=t.getSelectedTable().dtNode,E="rtl"===g.format.dir,T=g.format.cols.length,p=s[1];p<=l[1];p++)f=J("#cell-column-"+(E?T-p:p+1))[0],f&&(Y.push(f),ct("ui-active"),We(J(f),!1),ke(f,!1))}}},Ae=function(e,t){var i=editor.doc.getSelection(),n=v.querySelectorAll("tbody.zw-tbody")[0].querySelectorAll("tr.zw-tr")[0].querySelectorAll("td.zw-td"),o=parseInt(e.id.split("cell-column-")[1]);if(t.clientX<H.max.x&&t.clientX>H.x){var r=J("#cell-column-"+(o+1));if(ZWArrayUtils.arrayContains(Y,r[0])){var a=n[o-1];i.selectColumn(a).setSelectionType(SEL_AUTO_GEN).select(),J(r.children()[1]).removeClass("ui-active"),J(r.children()[1]).removeClass("drag-ui-tbl-hd-content"),ut(r[0])}}else if(t.clientX<H.x&&t.clientX>H.min.x){var s=J("#cell-column-"+(o-1));if(ZWArrayUtils.arrayContains(Y,s[0])){var a=n[o-1];i.selectColumn(a).setSelectionType(SEL_AUTO_GEN).select(),J(s.children()[1]).removeClass("ui-active"),J(s.children()[1]).removeClass("drag-ui-tbl-hd-content"),ut(s[0])}}setTimeout(function(){editor.clientActiveSection&&editor.clientActiveSection.className.indexOf("zw-contentpane")==-1&&q()},100)},Se=function(e,t){if(Je(e,!0),p){var i=editor.doc.getSelection();if(!EventHandler.isOnlyCtrlKeyPressed&&!I||0==Y.length){i.isCtrlSelection=!1;var n=p.getStart()+1,o=editor.doc.createRange(n,n);i.removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(o),pt(["ui-active","drag-ui-tbl-hd-content"]),Y=[]}else{var n=p.getStart()+1,o=editor.doc.createRange(n,n);i.isCtrlSelection=!0,i.showCaret(o),pt(["drag-ui-tbl-hd-content"])}i.selectRow(J(g).parents("tr.zw-tr")[0]).setSelectionType(SEL_AUTO_GEN).setLastModifiedPosition("end");var r=i.toArray();r=U.unique(r),EventHandler.getUniqueRanges(r),i.removeAllRanges().addRanges(r).mapAllSelectionsToBulletin(),editor.clientActiveSection&&editor.clientActiveSection.className.indexOf("zw-contentpane")!=-1&&_e(!0),!t&&J(J(e).children()[1]).hasClass("ui-active")&&Oe(e),setTimeout(function(){editor.clientActiveSection&&editor.clientActiveSection.className.indexOf("zw-contentpane")==-1&&(q(),We(J(f),!0),_e(!0))},100)}},Re=function(e,t){var i=editor.doc.getSelection(),n=(v.querySelectorAll("tr.zw-tr")[0].querySelectorAll("td.zw-td"),parseInt(e.id.split("cell-row-")[1]));if(t.clientY<H.max.y&&t.clientY>H.y){var o=J("#cell-row-"+(n+1));if(ZWArrayUtils.arrayContains(Y,o[0])){var i=editor.doc.getSelection(),r=i.getLastRange();i.removeRange(r),J(o.children()[1]).removeClass("ui-active"),J(o.children()[1]).removeClass("drag-ui-tbl-hd-content"),ut(o[0])}}else if(t.clientY<H.y&&t.clientY>H.min.y){var a=J("#cell-row-"+(n-1));if(ZWArrayUtils.arrayContains(Y,a[0])){var i=editor.doc.getSelection(),r=i.getLastRange();i.removeRange(r),J(a.children()[1]).removeClass("ui-active"),J(a.children()[1]).removeClass("drag-ui-tbl-hd-content"),ut(a[0])}}setTimeout(function(){editor.clientActiveSection&&editor.clientActiveSection.className.indexOf("zw-contentpane")==-1&&q()},100)},Oe=function(e){if(!D&&!L){var t=Z("tbl-vcl-edit-row-condition");p.parentNode().attr("*").condition?(t.show(),R.style.height="167px"):(t.hide(),R.style.height="");var i=J(e).offset(),n=editor.jeditorPane.offset(),o=i.top-n.top-J(R).height()/2+J(e).height()/2,r=i.left-n.left-J(R).width()-10,a=J(R).find("#table-visual-cue-row-arrow");o<0?(o=0,a.addClass("ui-arrow-move-top")):a.removeClass("ui-arrow-move-top"),R.style.top=o+"px",R.style.left=r+"px",(R.parentNode||R.parentElement).style.opacity="1",Tt(R),J("#tablePropWrapper").css("opacity","0.1"),Z("microandparaVCContainer").css("opacity","0")}},be=function(e){if(!D&&!L){var t=J(e).offset(),i=editor.jeditorPane.offset(),n=t.top-i.top-J(S).height()-10,o=t.left-i.left-J(S).width()/2+J(e).width()/2,r=J(S).find("#table-visual-cue-column-arrow");n<0?(n=t.top-i.top+J(e).height()+10,r.addClass("ui-tbl-vc-bottom-popup-arrow")):r.removeClass("ui-tbl-vc-bottom-popup-arrow"),S.style.top=n+"px",S.style.left=o+"px",(S.parentNode||S.parentElement).style.opacity="1",J("#tablePropWrapper").css("opacity","0.1"),Tt(S)}},ve=function(e,t){var i=p,n=g,o=E;Ze(),We(J(t),!0);var r=p.parentNode();return TableUtil.isVerticalMergedRow(r)?(p=i,g=n,void(E=o)):void Et(x)},De=function(e,t){if(z)V||(0!=Y.length&&(I=!0),ZWArrayUtils.arrayContains(Y,t)?Re(t,e):Se(t,!0),H.max.y<e.clientY&&(H.max.x=e.clientX,H.max.y=e.clientY),H.min.y>e.clientY&&(H.min.x=e.clientX,H.min.y=e.clientY));else{if(H.x){if(D)return;L=!0}if(!L)return void(H={});"block"!=x.style.display?(Ze(),He(),x.style.display="block"):Ne(e)}},Le=function(e,t){if(L){var i=H.currentCell;H.currentColIndex,{x:e.clientX,y:e.clientY};if(t&&J(t).hasClass("ui-tbl-vc-lt-cell")?We(J(t),!0):Ye(e,!0),Et(x),L=!1,H={},i.getStart()==p.getStart())return selectcontainer=!0,selectrowcontainer=!0,void Ve(!0);currentRow=i.parentNode();var n=!1;moveToRow=p.parentNode(),moveToRow.nextSibling()||(n=!0),nt(currentRow,moveToRow,n)}C=!0,y=!0,Ve(!0),e.stopPropagation()},Ne=function(e){var t=e.clientY-H.y,i=J(x).offset();dummyDivLeft=i.left,x.style.top=t+H.element.y+"px";var n=J(g).offset(),o=J(g).height()*editor.zoomFactor;if(e.clientY>H.max.y){var n=J(g).parent().next().children().offset(),o=J(g).parent().next().children().height()*editor.zoomFactor,r=i.top+parseInt(x.style.height);if(n&&r>n.top+o/2){var a=J(e.target).parents(".ui-tbl-vc-lt-cell"),s=!1;a[0]?(s=!0,We(a,!0)):s=Ye(e,!0),s&&(xe(null,!0),H.max.x=e.clientX,H.max.y=e.clientY)}}else{var n=J(g).parent().prev().children().offset(),o=J(g).parent().prev().children().height()*editor.zoomFactor,r=i.top;if(n&&r<n.top+o/2){var a=J(e.target).parents(".ui-tbl-vc-lt-cell"),s=!1;a[0]?(s=!0,We(a,!0)):s=Ye(e,!0),s&&(xe("ins-row-before",!0),H.max.x=e.clientX,H.max.y=e.clientY)}}e.stopPropagation()},Pe=function(e,t){var i=p,n=g,o=E;return Ze(),We(J(t),!1),TableUtil.isHorizontalyMergedColumn(p)?(p=i,g=n,void(E=o)):void Et(B)},Ce=function(e,t){if(z)return void(j||(0!=Y.length&&(I=!0),ZWArrayUtils.arrayContains(Y,t)?Ae(t,e):Ie(t,!0),H.max.x<e.clientX&&(H.max.x=e.clientX,H.max.y=e.clientY),H.min.x>e.clientX&&(H.min.x=e.clientX,H.min.y=e.clientY)));if(H.x){if(L)return;D=!0}return D?void("block"!=B.style.display?(Ze(),Be(),B.style.display="block"):Fe(e)):void(H={})},ye=function(e,t){if(D){var i=H.currentCell,n=H.currentColIndex;({x:e.clientX,y:e.clientY});Et(B),D=!1;var o="ltr";e.clientX<H.x&&(o="rtl");var r=!1;"ltr"==o?r=!0:"rtl"==o&&(r=!1),H={};var a=editor.doc.getSelection().getParents(NODE_TYPE.TABLE),s=a.children()[0],l=s.children();i=l[n];var d=l[E];i.getStart()==d.getStart()&&(n==E+1&&r||n==E-1&&!r||!r)&&(p=i,E=n,e.stopPropagation(),C=!0,F=!0,Ve(!0)),it(d,n,i,r)}e.stopPropagation(),C=!0,F=!0,Ve(!0),setTimeout(function(){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");DomUtil.scrollElementIntoView(e[0])},200)},Fe=function(e){var t=B,i=e.clientX-H.x,n=J(t).offset();dummyDivLeft=n.left,t.style.left=i+H.element.x+"px";var o=J(g).offset(),r=J(g).width()*editor.zoomFactor;if(e.clientX>H.max.x){var o=J(g).next().offset(),r=J(g).next().width()*editor.zoomFactor,a=n.left+parseInt(t.style.width);if(o&&a>o.left+r/2){var s=Ye(e,!1);s&&(Ue(null,!0),H.max.x=e.clientX,H.max.y=e.clientY)}}else{var o=J(g).prev().offset(),r=J(g).prev().width()*editor.zoomFactor,a=n.left;if(o&&a<o.left+r/2){var s=Ye(e,!1);s&&(Ue("ins-col-before",!0),H.max.x=e.clientX,H.max.y=e.clientY)}}},Me=function(e){var t=(J(e),e.id);"del-col"==t||"del-row"==t?(J(".overlay").addClass("ui-tbl-red-overlay"),ct("ui-tbl-hd-content-red")):t.indexOf("ins-col")!=-1?Ue(t):t.indexOf("ins-row")!=-1&&xe(t)},we=function(e){var t=(J(e),e.id);"del-col"==t||"del-row"==t?(J(".overlay").removeClass("ui-tbl-red-overlay"),pt("ui-tbl-hd-content-red")):t.indexOf("ins-")!=-1&&Et([w,M])},Ue=function(t,i){var n=J(v).height()*editor.zoomFactor;w[0],M[0];w.style.height=n+"px",w.style.width="10px",M.style.width="10px",M.style.height=G+"px";var o=editor.jeditorPane.offset(),r=J(g).offset();tdLeft=r.left-o.left,tdTop=r.top-o.top;var a=J(v),s=a.parents(".zw-textbox-div")[0],l=!!s,d=l?TextBoxHandler.getRotation(s):0,c=l?"rotate("+d+"deg)":"",u="",p=2;if("ins-col-before"==t)if(l){var f=e.rotateElement(v,d,editor.zoomFactor),E=e.distanceBetween(f.y,o.top,editor.zoomFactor);w.style.top=E+"px",E=e.distanceBetween(f.y-G-p,o.top,editor.zoomFactor),M.style.top=E+"px";var T=e.getCenter(f.x,f.y,a.width(),a.height(),editor.zoomFactor),m=e.rotateElement(g,d,editor.zoomFactor,T),h=e.distanceBetween(m.x-4,o.left,editor.zoomFactor);w.style.left=h+"px",M.style.left=h+"px";var I=a.height()/2+"px",_=e.distanceBetween(f.x,o.left,editor.zoomFactor),A=_+a.width()/2-h+"px";u=A+" "+I,se(w,c,u),I=a.height()/2+G+p+"px",u=A+" "+I,se(M,c,u)}else w.style.top=tdTop+"px",w.style.left=tdLeft-4+"px",M.style.left=tdLeft-4+"px",M.style.top=tdTop-G-p+"px",se(w,c,u),se(M,c,u);else if(l){var f=e.rotateElement(v,d,editor.zoomFactor),E=e.distanceBetween(f.y,o.top,editor.zoomFactor);w.style.top=E+"px",E=e.distanceBetween(f.y-G-p,o.top,editor.zoomFactor),M.style.top=E+"px";var T=e.getCenter(f.x,f.y,a.width(),a.height(),editor.zoomFactor),m=e.rotateElement(g,d,editor.zoomFactor,T),S=J(g).width()*editor.zoomFactor,h=e.distanceBetween(m.x+S,o.left,editor.zoomFactor);w.style.left=h+"px",M.style.left=h+"px";var I=a.height()/2+"px",_=e.distanceBetween(f.x,o.left,editor.zoomFactor),A=_+a.width()/2-h+"px";u=A+" "+I,se(w,c,u),I=a.height()/2+G+p+"px",u=A+" "+I,se(M,c,u)}else w.style.top=tdTop+"px",w.style.left=tdLeft+J(g).width()*editor.zoomFactor+"px",M.style.left=tdLeft+J(g).width()*editor.zoomFactor+"px",M.style.top=tdTop-G-p+"px",se(w,c,u),se(M,c,u);Tt(w),i||Tt(M)},xe=function(t,i){var n=J(v).width()*editor.zoomFactor;w[0],M[0];w.style.width=n+"px",w.style.height="10px",M.style.width=k+"px",M.style.height="10px";var o=2,r=editor.jeditorPane.offset(),a=J(g).offset();tdLeft=a.left-r.left,tdTop=a.top-r.top;var s=J(v),l=s.parents(".zw-textbox-div")[0],d=!!l,c=d?TextBoxHandler.getRotation(l):0,u=d?"rotate("+c+"deg)":"",p="";if("ins-row-before"==t)if(d){var f=e.rotateElement(v,c,editor.zoomFactor),E=e.distanceBetween(f.x,r.left,editor.zoomFactor);w.style.left=E+"px",E=e.distanceBetween(f.x-k-o,r.left,editor.zoomFactor),M.style.left=E+"px";var T=e.getCenter(f.x,f.y,s.width(),s.height(),editor.zoomFactor),m=e.rotateElement(g,c,editor.zoomFactor,T),h=e.distanceBetween(m.y-5,r.top,editor.zoomFactor);w.style.top=h+"px";var I=s.width()/2+"px",_=e.distanceBetween(f.y,r.top,editor.zoomFactor),A=_+s.height()/2-h+"px";p=I+" "+A,se(w,u,p),h=e.distanceBetween(m.y-6,r.top,editor.zoomFactor),M.style.top=h+"px",I=s.width()/2+k+o+"px",A=_+s.height()/2-h+"px",p=I+" "+A,se(M,u,p)}else w.style.top=tdTop-5+"px",w.style.left=tdLeft+"px",M.style.left=tdLeft-k-o+"px",M.style.top=tdTop-6+"px",se(w,u,p),se(M,u,p);else if(d){var f=e.rotateElement(v,c,editor.zoomFactor),E=e.distanceBetween(f.x,r.left,editor.zoomFactor);w.style.left=E+"px",E=e.distanceBetween(f.x-k-o,r.left,editor.zoomFactor),M.style.left=E+"px";var T=e.getCenter(f.x,f.y,s.width(),s.height(),editor.zoomFactor),m=e.rotateElement(g,c,editor.zoomFactor,T),S=J(g).height()*editor.zoomFactor,h=e.distanceBetween(m.y+S,r.top,editor.zoomFactor);w.style.top=h+"px";var I=s.width()/2+"px",_=e.distanceBetween(f.y,r.top,editor.zoomFactor),A=_+s.height()/2-h+"px";p=I+" "+A,se(w,u,p),M.style.top=h+"px",I=s.width()/2+k+o+"px",p=I+" "+A,se(M,u,p)}else w.style.top=tdTop+J(g).height()*editor.zoomFactor+"px",w.style.left=tdLeft+"px",M.style.left=tdLeft-k-o+"px",M.style.top=tdTop+J(g).height()*editor.zoomFactor+"px",se(w,u,p),se(M,u,p);Tt(w),i||Tt(M)},Be=function(){var e=J(v).height()*editor.zoomFactor,t=J(g).width()*editor.zoomFactor,i=editor.jeditorPane.offset(),n=J(g).offset();B[0];B.style.width=t+"px",B.style.height=e+G+"px",B.style.top=n.top-i.top-G+"px",B.style.left=n.left-i.left+"px",B.style.border="1px solid grey",B.style.backgroundColor="#e9f3f8",B.style.opacity="0.5",B.style.position="absolute",B.style.display="none",B.style["z-index"]="101",B.style["pointer-events"]="none",H.element={},H.element.x=parseInt(B.style.left),H.element.y=parseInt(B.style.top)},He=function(){var e=J(v).width()*editor.zoomFactor,t=J(g).height()*editor.zoomFactor,i=editor.jeditorPane.offset(),n=J(g).offset();x.style.height=t+"px",x.style.width=e+k+"px",x.style.top=n.top-i.top+"px",x.style.left=n.left-i.left-k+"px",x.style.border="1px solid grey",x.style.backgroundColor="#e9f3f8",x.style.opacity="0.5",x.style.position="absolute",x.style.display="none",x.style["z-index"]="101",x.style["pointer-events"]="none",H.element={},H.element.x=parseInt(x.style.left),H.element.y=parseInt(x.style.top)},Je=function(e,t){We(J(e),t)},Ge=function(){var e=null;if(pt(["ui-active","drag-ui-tbl-hd-content"]),Y=[],y){var t=editor.doc.getSelection().getParents(NODE_TYPE.CELL);if(t&&"cell"==t.type){var i=t.parentNode(),n=J(DomViewManager.getDOMNodeAtIndex(i.getStart())).prevAll("tr.zw-tr").length;e=J("#cell-row-"+(n+1))[0]}e&&(Y.push(e),Je(e,!0),ke(e,!0),q(),We(J(e),!0))}else{var t=editor.doc.getSelection().getParents(NODE_TYPE.CELL);if(t&&"cell"==t.type){var i=t.parentNode(),o=i.nodeCountBefore(t);e=J("#cell-column-"+(o+1))[0]}e&&(Y.push(e),Je(e,!1),ke(e,!1),q())}},ke=function(e,t){if(ct("ui-active"),t){var i=p.parentNode();TableUtil.isVerticalMergedRow(i)||Y.length>1||TableUtil.isCollabsInTable(i.parentNode())||!i.previousSibling()&&!i.nextSibling()||J(J(f).children()[1]).addClass("drag-ui-tbl-hd-content")}else TableUtil.isHorizontalyMergedColumn(p)||Y.length>1||TableUtil.isCollabsInTable(p.parentNode().parentNode())||!p.previousSibling()&&!p.nextSibling()||TableUtil.isCellRepeatTable(p.dtNode)||J(J(f).children()[1]).addClass("drag-ui-tbl-hd-content")},We=function(e,t){if(t){var i=e[0].id.split("cell-row-")[1];i=parseInt(i);var n=0,r=o.attr();r.dir&&"rtl"==r.dir&&(n=r.cols.length-1-n);var a=DomViewManager.getDocView(v);a.childViews.first&&(i-=a.childViews.first.getNode().getChildIndex());var s=DomViewManager.getDOMElem(a.getRowAt(i-1).getCellViewAtIndex(n))}else{var l=e[0].id.split("cell-column-")[1];l=parseInt(l-1),E=l;var r=o.attr();r.dir&&"rtl"==r.dir&&(l=r.cols.length-1-l);var s=v.querySelectorAll("tbody.zw-tbody")[0].querySelectorAll("tr.zw-tr")[0].querySelectorAll("td.zw-td")[l]}var d=s&&s.parentElement,c=d&&d.classList.contains("ui-state-disabled");if(!c){var u=DocUtil.getDocElement(s);p=u,g=s,f=e[0]}},Ye=function(e,i){var n=(editor.jeditorPane.offset(),editor.doc.getSelection().getParents(NODE_TYPE.TABLE)),r=v;if(i){var a=EventHandler.getIndex(e);if(a!=-1){var s=editor.doc.getParents(NODE_TYPE.TABLE,a),l=DocLayoutManager.getLineAtIndex(a),d=DomViewManager.getDomFromCurrentPage(l),c=J(d).parents("table.zw-table")[0];if(n&&n.type==NODE_TYPE.TABLE&&v!=c){var u=TableUtil.getCols(n),f=u.length,T=TableUtil.getCols(s),m=T.length;if(f!=m)return!1;n=s,c&&(v=c,r=v)}}}var h=J(r).offset(),I=e.clientX-h.left,_=e.clientY-h.top;if(i){var A=DomViewManager.getDocView(r),S=(A.getRowsHeight(),A.childViews?A.childViews.first:null),R=(e.clientY-H.y,p.parentNode()),O=(R.parentNode().nodeCountBefore(R),0),b=J(x).offset();_=b.top-h.top,e.clientY>H.y&&(_+=parseInt(x.style.height));for(var D=0;S&&(O+=S.getHeight()*editor.zoomFactor,null!=S.next)&&!(O>_);)S=S.next,D++;var L=o.attr(),N=0;p=DocUtil.getDocElement(DomViewManager.getDOMElem(S.childViews.first)),L.dir&&"rtl"==L.dir&&(N=L.cols.length-1-N,p=DocUtil.getDocElement(DomViewManager.getDOMElem(S.childViews.last))),g=r.querySelectorAll("tbody.zw-tbody")[0].querySelectorAll("tr.zw-tr")[D].querySelectorAll("td.zw-td")[N]}else{var n=DocUtil.getDocElement(v),P=TableUtil.getCols(n),T=[],C=editor.doc.getRawFormatAt(t);if(TableUtil.isTableWidthInPercentage(C)){var y=0;if(TableUtil.isInnerTable(o)){var N=o.parentNode().getStart(),F=DomViewManager.getDOMNodeAtIndex(N+1),M=parseInt(getComputedStyle(F).width);y=parseFloat(C.wid)/100*M}else y=parseFloat(C.wid)/100*J(v).parent("div.zw-column").width();for(var D=0;D<P.length;D++){var w=parseFloat(P[D].wt),U=w/100*y;T[D]={},T[D].wt=U}}else T=P;var G=P.length,u=n.children()[0].children(),k=null,U=0,A=DomViewManager.getDocView(r),W=J(B).offset();I=W.left-h.left,e.clientX>H.x&&(I+=parseInt(B.style.width));var N=0,L=o.attr();if(L.dir&&"rtl"==L.dir){for(var D=G-1;D>=0&&(U+=T[D].wt.convertor().pixels*editor.zoomFactor,k=u[D],!(U>I));D--);var S=A.childViews?A.childViews.first:null;if(S){var Y=T.length-1;for(k=S.childViews.last;D==Y;)k=k.prev,Y--}}else{for(var D=0;D<G&&(U+=T[D].wt.convertor().pixels*editor.zoomFactor,k=u[D],!(U>I));D++);var S=A.childViews?A.childViews.first:null;if(S){var Y=1;for(k=S.childViews.first;D==Y;)k=k.next,Y++}}D==G&&(D-=1),p=DocUtil.getDocElement(DomViewManager.getDOMElem(k)),g=r.querySelectorAll("tbody.zw-tbody")[0].querySelectorAll("tr.zw-tr")[0].querySelectorAll("td.zw-td")[D],E=D}return!0},ze=function(){var e=editor.doc.getSelection();e.selectionType!=SEL_AUTO_GEN&&(pt(["ui-active","drag-ui-tbl-hd-content"]),Y=[],p=null,g=null,E=null,Ze(),z=!1,V=!1,j=!1,C=!1,F=!1,y=!1,I=!1)},Ze=function(){Et([R,S,b,B,x,M,w]),J("#tablePropWrapper").css("opacity",A),Z("microandparaVCContainer").css("opacity","0.2")},Ve=function(e){if(Xe()||e)try{var t=DocLayoutManager.getCurrentLine(),i=DomViewManager.getDomFromCurrentPage(t),n=J(i).parents("table.zw-table")[0];ce(),T=!0,n&&(e?X(n,!0):X(n))}catch(e){}},je=function(){return v},Xe=function(){return s},Ke=function(e){e?editor.doc.execCmd("inscolbefore",e):editor.doc.execCmd("inscolbefore"),Ve()},qe=function(){editor.doc.execCmd("inscolafter"),Ve()},Qe=function(e){e?editor.doc.execCmd("insrowbefore",e):editor.doc.execCmd("insrowbefore"),Ve()},$e=function(){editor.doc.execCmd("insrowafter"),Ve()},et=function(){editor.doc.execCmd("delcolumn"),Ve()},tt=function(){editor.doc.execCmd("delrow"),Ve()},it=function(e,t,i,n){editor.doc.execCmd("movecolumn",[e,n,1,t,i])},nt=function(e,t,i){editor.doc.execCmd("moverow",[e,t,i])},ot=function(){return D||L||z},rt=function(e){if(L)Ne(e);else if(D)Fe(e);else if(z)if(V){var t=lt(e);Ce(e,t)}else{var t=dt(e);De(e,t)}},at=function(e){var t=!1;return"mouseup"==e.type?ot()?(st(e),t=!0):EventHandler.isTableDrag&&(PubSub.publish("Document/Table/DragStopped",e),t=!0):"mousemove"==e.type&&(ot()?(rt(e),t=!0):EventHandler.isTableDrag?(PubSub.publish("Document/Table/DragInProgress",e),t=!0):ce(e)),t},st=function(e){L?Le(e):D?ye(e):(z=!1,V=!1,j=!1,L=!1,D=!1,H={},I=!1)},lt=function(e){for(var t=J(u[0]).children("div.ui-tbl-vc-tp-cell"),i=t.length,n=0;n<i;n++){var o=J(t[n]),r=o.offset(),a=o.width();if(e.clientX>r.left&&e.clientX<r.left+a)return o[0]}},dt=function(e){for(var t=J(u[1]).children("div.ui-tbl-vc-lt-cell"),i=t.length,n=0;n<i;n++){var o=J(t[n]),r=o.offset(),a=o.height();if(e.clientY>r.top&&e.clientY<r.top+a)return o[0]}},ct=function(e){for(var t=Y.length,i=0;i<t;i++){var n=Y[i],o=n.children[1],r=o.getAttribute("class");if("object"==typeof e)for(var a=0;a<e.length;a++)r.indexOf(e[a])==-1&&(o.setAttribute("class",r+" "+e),r=r+" "+e);else r.indexOf(e)==-1&&o.setAttribute("class",r+" "+e)}},ut=function(e){for(var t=0;t<Y.length;t++){var i=Y[t];if(e==i){Y.splice(t,1);break}}},pt=function(e){for(var t=Y.length,i=0;i<t;i++){var n=Y[i],o=n.children[1],r=o.getAttribute("class");if("object"==typeof e)for(var a=0;a<e.length;a++)r=r.replace(e[a],"");else r=r.replace(e,"");o.setAttribute("class",r)}},gt=function(e){var t=J("#"+e)[0].getBoundingClientRect();Ze(),PopupHandler.openPopup("smartToolbar",t)},ft=function(e){if(TableVisualCueHandler.isOpen()&&!EventHandler.isOnlyCtrlKeyPressed){if(parseFloat(c.style.opacity)<=.3)return void J(c.children[1]).css("height",J(v).height()*editor.zooFactor+"px");pe("0"),_=!1,setTimeout(function(){pe("0")},300)}},Et=function(e){e.length||(e=[e]);for(var t=0;t<e.length;t++){var i=e[t];i&&(i.style.display="none")}},Tt=function(e){e.length||(e=[e]);for(var t=0;t<e.length;t++){var i=e[t];i&&(i.style.display="block")}},mt=function(){if(!d){d=!0;var e=(editor.doc.docInfo,ZWNetworkUtils.getContextUrl("jsp/popups/tablevisualcues.jsp"));J.ajax({type:"GET",url:e,success:function(e){var t=document.createElement("fragment");t.innerHTML=e,J("#popup-menu-container").append(t.children),ZWComponentUtil.init("table-visualcue-popup"),S=document.getElementById("table-visualcue-col-popup"),R=document.getElementById("table-visualcue-row-popup"),O=document.getElementById("tableMove"),b=document.getElementById("table-bubble"),M=document.getElementById("insert-dummy-container"),w=document.getElementById("insert-dummy-div"),x=document.getElementById("dummyRowDiv"),B=document.getElementById("dummyColDiv"),J("#ins-col-before,#ins-col-after,#del-col,#ins-row-before,#ins-row-after,#del-row,#tbl-vcl-edit-row-condition,#row-show-smarttoolbar,#col-show-smarttoolbar,#sort-col-ascending,#sort-col-descending").on("click",function(e,t){var i=J(this).metadata().appData,n=i.action,o=i.params;if(n){var r=Utils.getAsFunction(n);r.callable(o)}}),J("#ins-col-before,#ins-col-after,#del-col,#ins-row-before,#ins-row-after,#del-row").on("mouseover",function(){TableVisualCueHandler.handlePopupsMouseOver(this)}),J("#ins-col-before,#ins-col-after,#del-col,#ins-row-before,#ins-row-after,#del-row").on("mouseout",function(){TableVisualCueHandler.handlePopupsMouseOut(this)}),J("#table-visualcue-popup").on("mouseleave",function(){this.style.opacity="0.2"}),J("#table-visualcue-popup").on("mouseenter",function(){this.style.opacity="1"}),Ee()}})}},ht=function(e,t,i){for(var n=i?1:0;n<e.length;){var o=e[n],r=o.children()[t-1],a=editor.doc.getContent(r.getStart(),r.getEnd());if(a=a.trimEnd(),a=a.replaceAll("",""),a=a.replaceAll(UNICODE.RANGE_START,""),a=a.replaceAll(UNICODE.RANGE_END,""))break;n++}return parseFloat(a)==a?1:0},It=function(e){var t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.TABLE);if(i.dtNode.isVerticalMergePresent())return void PubSub.publish("Document/Warning",WARNING_MSG.MERGE_CELLS_FOUND);var n=i.firstChild().dtNode.isHeaderRow(),o=i.children(),r=t.getSelectedCells()[0].dtNode.getChildIndex()+1,a=n?2:1,s=o.length,l=[{colIndex:r,type:ht(o,r,n),descend:parseInt(e)}];i.dtNode.getFormat().mminfo?editor.doc.execCmd("sortRelatedListTable",l):s-a!=0&&(ZWLogger.addToStatistics("Table sort"),TableSort.sortCurrentColumn(l,a,s))};return{init:X,isOpen:Xe,close:ce,reinit:Ve,getTargetElement:je,insertColumnBefore:Ke,insertColumnAfter:qe,insertRowBefore:Qe,insertRowAfter:$e,deleteColumn:et,deleteRow:tt,handlePopupsMouseOver:Me,handlePopupsMouseOut:we,handleMouseEvents:at,changeElementVisibility:pe,isColumOrRowDrag:ot,showSmartToolBar:gt,sortSelectedColumn:It,constructRowContainer:re,constructColumnContainer:$,bindEvents:fe,constructTableNameBtn:ne}}(TransformationUtils),TableMoveHandler=function(){var e=!1,t=null,i=null,n=!1,o=0,r=0,a=function(t){e=!0,o=editor.jeditorPane.offset(),r=J(TableVisualCueHandler.getTargetElement()).width()},s=function(t,i){1==e&&(EventHandler.isTableDrag||(EventHandler.isTableDrag=!0,addDummyTable(i)),t&&moveTableDummyDiv(t))},l=function(t,i){if(i&&e&&!EventHandler.isTableDrag)return c(t,i),!1;if(e&&EventHandler.isTableDrag){if(e=!1,n=!1,t){try{var r=EventHandler.getIndex(t)}catch(e){return removeDummyTable(),void(EventHandler.isTableDrag=!1)}EventHandler.isTableDrag=!1;var a=DocLayoutManager.getSectionLeftAtIndex(r),s=t.clientX-(o.left+a);s=Conversions.toGlobalValue(s+"px"),editor.doc.execCmd("tableDragDrop",{idx:r,jEl:J(TableVisualCueHandler.getTargetElement()),left:s})}removeDummyTable()}};removeDummyTable=function(){TableVisualCueHandler.close(),i&&J(i).remove()},moveTableDummyDiv=function(e){var t=editor.doc.getSelection(),n=DocLayoutManager.getPageWidthAtIdx(t.getStart());if(!(e.clientX>o.left+n-r)){var a=e.clientY,s=e.clientX;i.style.top=a+"px",i.style.left=s+"px",i.style.display="block"}},addDummyTable=function(e){i=document.createElement("div"),i.style.width=e.width()*editor.zoomFactor+"px",i.style.height=e.height()*editor.zoomFactor+"px",i.style.display="none",i.style.position="absolute",i.style.top=e.offset().top+"px",i.style.left=e.offset().left+"px",i.style.border="1px dotted black",i.style["pointer-events"]="none",J(document.body).append(i)},setTableSelected=function(e){n=e};var d=function(e,i,o){t=i,n=!1;var a=DomViewManager.getDocView(i[0]).getNode(),s=a.getIndex(),l=a.getEndIndex(),d=DocLayoutManager.getPageAtIndex(s),c=d.getWidth(),u=DocLayoutManager.getSectionLeftAtIndex(s);if(o.convertor().pixels+r>c-u&&(o=Conversions.toGlobalValue(c-u-r+"px")),!(!e||e<0||e<=editor.doc.getSectionStart(s)||e>=editor.doc.getSectionEnd(s))){if(e>s&&e<=l){var p=editor.doc.getElementAt(s),g={};return g.al="left",g.ml=o,void editor.doc.execCmd("applyStyle",[p,g,"tableMove"])}var f=(editor.doc.getRawFormatAt(s),editor.doc.getSelection()),E=OpUtil.getInsertionOps(editor.doc.createRange(s,l+1)),T=E.ops;TableUtil.handleSectionOpsArr(E.sectionOps),range=editor.doc.createRange(s,l),f.removeAllRanges().addRange(range),f.deleteContents(s,l+1);var m=editor.doc.getParents(NODE_TYPE.PARAGRAPH,e),h=e;m&&(h=m.getEnd()-1);var I=editor.doc.getRawFormatAt(h);I.hasOwnProperty(TCConstants.TC)&&delete I[TCConstants.TC],I[ATTR_PARAGRAPH.PS_TS]&&(I[ATTR_PARAGRAPH.PS_TS]=editor.doc.getSelection().textFormat,I[ATTR_PARAGRAPH.PS_TS].hasOwnProperty(TCConstants.TC)&&(I[ATTR_PARAGRAPH.PS_TS]=DocUtil.copyStyle(I[ATTR_PARAGRAPH.PS_TS]),delete I[ATTR_PARAGRAPH.PS_TS][TCConstants.TC]));for(var _,A,S=ZWJSONUtils.getKeys(I),R=DocUtil.copyStyle(I),O=Utils.randomString(),b=[],v=0;v<T.length;v++)if(_=T[v],_.as&&_.as.start&&_.as.start.type&&(A=_.as.start.type,A!=NODE_TYPE.TABLE&&A!=NODE_TYPE.ROW&&A!=NODE_TYPE.CELL)){var D=Utils.randomString();T.splice(v,0,{as:{start:{type:"cursor",uuid:editor.uuid},id:D}},{r:0},{as:{end:["type","uuid"],id:D}});break}b.push({r:e},{as:{start:R,id:O}},{is:UNICODE.PARA},{as:{end:S,id:O}}),T=T.slice(1,T.length),T[0].as.start.al="left",T[0].as.start.ml=o,b=b.concat(T),Op.resetCursorPos(),Op.cursorProcessed(),Op.processMsg(b),Op.sendMsg()}},c=function(e,t){n?(n=!1,p(e,t)):(n=!0,u(e,t))},u=function(t,i){e=!1,editor.doc.getSelection().setSelectionType(SEL_AUTO_GEN),editor.doc.execCmd("selectAllCells")},p=function(t,i){var n=editor.doc.getSelection();e=!1;var o=i?i.firstChild().firstChild().getIndex()+1:1,r=editor.doc.createRange(o,o);n.removeAllRanges().addRange(r)},g=function(){PubSub.subscribe("Document/Table/DragStopped",l),PubSub.subscribe("Document/Table/DragInProgress",s),PubSub.subscribe("Document/Table/MouseDown",a)};return{onMouseMove:s,onMouseDown:a,onMouseUp:l,bindEvents:g,moveTableToTheGivenIndex:d,setTableSelected:setTableSelected}}();!function(){var e=!1,t=function(t){if(!e){var n=t||{},o={},r={};o.type=n.docType,o.copy="published"===n.docType?n.copy:"true",o.onboard=n.onboard||"true",o.fromurl=encodeURIComponent(i()),"tryeditor"===n.docType?(o.rsid=n.rsid,r.titleTxt=n.titleText,r.descriptionTxt=n.descriptionText):o.rid=n.rid,r.action=n.action||"signup",r.refurl=JSON.stringify(o),e=!0;var a=ZWNetworkUtils.getContextUrl("jsp/writersignup.jsp");J.ajax({type:"GET",url:a,data:r,success:function(t,i,n){var o=document.createElement("div");o.innerHTML=t.trim(),J("body").append(J(o)),UIUtils.preProcessForDialogOpen(),e=!0},error:function(){e=!1}})}},i=function(){var e=window.location.pathname+window.location.search;return e},n=function(){UIUtils.preProcessForDialogClose(),J("#writer-signup-container").remove(),e=!1};window.zwritersignup={openSignupDialog:t,closeSignupDialog:n}}();var Pagenumberdlg=function(){return this.pageNumberFormat={},this.alignMap={left:0,center:1,right:2,none:3},{pageNumberFormat:pageNumberFormat,alignMap:alignMap}}();Pagenumberdlg.dialogInfo={init:function(){var e=DocLayoutManager.getCurrentGroup(),t=e.getHFType(),i=e.getPageNumberInfo();pageNumberFormat.isContinuousFromPreviousSection=e.shouldContinuePageNumber(),pageNumberFormat.format=i[ATTR_BODY.DS_PAGENUMBER_FORMAT]||0,pageNumberFormat.startsAt=i.hasOwnProperty(ATTR_BODY.DS_PAGENUMBER_STARTS_AT)?i[ATTR_BODY.DS_PAGENUMBER_STARTS_AT]:1,pageNumberFormat.firstpage=t||0;var n=Pagenumberdlg.getHdrFtrPageNumberIndex("header");Pagenumberdlg.setStyle("header",n);var n=Pagenumberdlg.getHdrFtrPageNumberIndex("footer");Pagenumberdlg.setStyle("footer",n),Pagenumberdlg.currentSectionGroupId=e.getId()},get:function(e,t){e=e.action;var i=Z("pageno_start");if("headerStyle"===e){var n;return n=pageNumberFormat&&pageNumberFormat.headerStyle?pageNumberFormat.headerStyle:"none"}if("footerStyle"===e){var o;return o=pageNumberFormat&&pageNumberFormat.footerStyle?pageNumberFormat.footerStyle:"none"}if("format"===e){var r=0;return pageNumberFormat&&"undefined"!=typeof pageNumberFormat.format&&!isNaN(pageNumberFormat.format)&&(r=pageNumberFormat.format),0!=r||1!=pageNumberFormat.firstpage&&3!=pageNumberFormat.firstpage?i.zlabelednumberfield("setAttribute","min",1):i.zlabelednumberfield("setAttribute","min",0),r}if("start_type"===e){if(DocTreeManager.isMultiSectionDocument()){Z("pageno_start_typeContainer").show();var a=DocLayoutManager.getCurrentGroup();a.prev?Z("pageno_start_type").enable():Z("pageno_start_type").disable()}else Z("pageno_start_typeContainer").hide();var s;return pageNumberFormat.isContinuousFromPreviousSection?(s=1,Z("pageno_start").disable()):(s=2,Z("pageno_start").enable()),s}if("startsat"===e){var l=1;return pageNumberFormat&&pageNumberFormat.hasOwnProperty("startsAt")&&(l=pageNumberFormat.startsAt),l}if("firstpage"===e){var a=DocLayoutManager.getCurrentGroup(),d=a.getHFType();return d!=HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE&&d!=HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE}},set:function(e,t,i){var n=Z("pageno_start");if("headerStyle"===e.action)pageNumberFormat.position="header",pageNumberFormat.headerStyle="none",ZWArrayUtils.arrayContains(["left","center","right"],t)&&(pageNumberFormat.headerStyle=t);else if("footerStyle"===e.action)pageNumberFormat.position="footer",pageNumberFormat.footerStyle="none",ZWArrayUtils.arrayContains(["left","center","right"],t)&&(pageNumberFormat.footerStyle=t);else if("format"===e.action)if(pageNumberFormat.format=0,t>-1&&t<5&&(pageNumberFormat.format=t),0!=pageNumberFormat.format||1!=pageNumberFormat.firstpage&&3!=pageNumberFormat.firstpage){n.zlabelednumberfield("setAttribute","min",1);var o=n.zlabelednumberfield("getAttribute","value");o<1&&(n.zlabelednumberfield("setAttribute","value",1),pageNumberFormat.startsAt=1)}else n.zlabelednumberfield("setAttribute","min",0);else if("start_type"===e.action)2==t?(pageNumberFormat.isContinuousFromPreviousSection=!1,Z("pageno_start").enable()):(pageNumberFormat.isContinuousFromPreviousSection=!0,Z("pageno_start").disable());else if("startsat"==e.action)t>-1?(0!=t||0==pageNumberFormat.format&&(0!=pageNumberFormat.format||0!=pageNumberFormat.firstpage&&2!=pageNumberFormat.firstpage)||(t=1,n.zlabelednumberfield("setAttribute","value",t)),pageNumberFormat.startsAt=t):(pageNumberFormat.startsAt=1,n.zlabelednumberfield("setAttribute","value",1));else if("firstpage"==e.action){var r=DocLayoutManager.getCurrentGroup(),a=r.getHFType();t?a==HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE?pageNumberFormat.firstpage=HEADER_FOOTER_TYPE.PRIMARY:pageNumberFormat.firstpage=HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE:a==HEADER_FOOTER_TYPE.PRIMARY?pageNumberFormat.firstpage=HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE:pageNumberFormat.firstpage=HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE,0==pageNumberFormat.format&&(0==pageNumberFormat.firstpage||2==pageNumberFormat.firstpage?(n.zlabelednumberfield("setAttribute","min",1),pageNumberFormat.startsAt<1&&(pageNumberFormat.startsAt=1,n.zlabelednumberfield("setAttribute","value",1))):n.zlabelednumberfield("setAttribute","min",0))}Pagenumberdlg.applyValues()}},Pagenumberdlg.applyValues=function(){var e=DocLayoutManager.getCurrentGroup(),t=e.getFirstSectionFormat()[ATTR_BODY.DS_PAGENUMBER]||{},i={};i[ATTR_BODY.DS_PAGENUMBER]={},pageNumberFormat.isContinuousFromPreviousSection||(i[ATTR_BODY.DS_PAGENUMBER][ATTR_BODY.DS_PAGENUMBER_STARTS_AT]=pageNumberFormat.startsAt),i[ATTR_BODY.DS_PAGENUMBER][ATTR_BODY.DS_PAGENUMBER_FORMAT]=parseInt(pageNumberFormat.format),U.each(i,function(e,n){"object"==typeof e?ZWJSONUtils.compareJSON(e,t)&&delete i[n]:e&&e!==t||delete i[n]});var n,o,r;if(n=pageNumberFormat.headerStyle,o=pageNumberFormat.footerStyle,r=pageNumberFormat.position,!U.isEmpty(i)){var a=e.getFirstSection().getNode(),s=editor.getDocument();editor.doc.execCmd("updatesectionstyle",[{sectionNodes:[a],styles:i},s]),s.sync()}var l=e.getHFType();if(l!=pageNumberFormat.firstpage)editor.doc.execCmd("changeHdrFtr",pageNumberFormat.firstpage);else{var d="header"===r?alignMap[n]:alignMap[o],c=Pagenumberdlg.getSectionsToUpdate(r);c.forEach(function(e){Pagenumberdlg.sendOpForSection(e,d)})}},Pagenumberdlg.getSectionsToUpdate=function(e,t){var i=DocLayoutManager.getCurrentPage(),n=DocLayoutManager.getCurrentGroup(),o=n.getHFType(),r=[];if(o===HEADER_FOOTER_TYPE.PRIMARY)"header"===e?r.push(n.getHeader(CONST.HEADER_PRIMARY).getNode()):r.push(n.getFooter(CONST.FOOTER_PRIMARY).getNode());else{var a=t||i.getRelativePageNumber();o===HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE?1===a?"header"===e?r.push(n.getHeader(CONST.HEADER_FIRST).getNode()):r.push(n.getFooter(CONST.FOOTER_FIRST).getNode()):"header"===e?r.push(n.getHeader(CONST.HEADER_PRIMARY).getNode()):r.push(n.getFooter(CONST.FOOTER_PRIMARY).getNode()):o===HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE?"header"===e?(r.push(n.getHeader(CONST.HEADER_PRIMARY).getNode()),r.push(n.getHeader(CONST.HEADER_EVEN).getNode())):(r.push(n.getFooter(CONST.FOOTER_PRIMARY).getNode()),r.push(n.getFooter(CONST.FOOTER_EVEN).getNode())):o===HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE&&(1===a?"header"===e?r.push(n.getHeader(CONST.HEADER_FIRST).getNode()):r.push(n.getFooter(CONST.FOOTER_FIRST).getNode()):"header"===e?(r.push(n.getHeader(CONST.HEADER_PRIMARY).getNode()),r.push(n.getHeader(CONST.HEADER_EVEN).getNode())):(r.push(n.getFooter(CONST.FOOTER_PRIMARY).getNode()),r.push(n.getFooter(CONST.FOOTER_EVEN).getNode())))}return r},Pagenumberdlg.sendOpForSection=function(e,t){var i,n,o=Pagenumberdlg.findPagenoFieldInSection(e);if(o==-1){if(3==t)return;var r=editor.doc.getSelection()[0].start;if(e&&(o=r>=e.start&&r<=e.end?r:e.end-1),o!=-1){i="autofield";var a=Pagenumberdlg.getParaAlignAtIndex(o),s=editor.doc.getParents(NODE_TYPE.PARAGRAPH,o);n=t!=a?["autopno",o,s,{al:t}]:["autopno",o]}}else if(3==t)i="removeAutoField",n=[o-1];else{var a=Pagenumberdlg.getParaAlignAtIndex(o),s=editor.doc.getParents(NODE_TYPE.PARAGRAPH,o);t!=a&&(i="formatAutoField",n=[s,{al:t}])}i&&n&&editor.doc.execCmd(i,n)},Pagenumberdlg.openPagenumberDlg=function(e){if(e){var t=e[0],i=e[1];t&&(pageNumberFormat.position=t,"header"===t?pageNumberFormat.headerStyle=i||"none":"footer"===t&&(pageNumberFormat.footerStyle=i||"none")),Pagenumberdlg.applyValues()}FetchHTML.get({requestName:"pagenumber",target:"#subpanel-pagenumber",callback:function(){var e=Z("subpanel-pagenumber");e.data("ZCtrackObjects")?e.ZCtrackObjects("refreshValues"):e.ZCtrackObjects({callbacks:Pagenumberdlg.dialogInfo,fillVisible:!1,eventNameMapping:{zlabeledselectbox:"zlabeledselectboxitemclick",zstatebutton:"zstatebuttonchange"}});var t={panelId:ELEM_ID.PAGENUMBERPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[ELEM_ID.INSERTPANEL]};LeftPanel.showAdvancedPanel(t)}}),e&&Pagenumberdlg.applyValues()},Pagenumberdlg.findSection=function(e){for(var t=DocTreeManager.doc.getAllSections(),i=0,n=t.length;i<n;i++)if(t[i].getSectionType()===e)return t[i];return null},Pagenumberdlg.findPagenoFieldInSection=function(e){return e?Pagenumberdlg.findPagenoFieldInBetweenIndex(e.start+1,e.end-1):-1},Pagenumberdlg.findPagenoFieldInBetweenIndex=function(e,t){for(var i,n=e;n<t;n++)if(i=editor.doc.getRawFormatAt(n),i&&"autopno"==i.cls)return n;return-1},Pagenumberdlg.getHdrFtrSectionNameFromPageNumber=function(e){var t=DocLayoutManager.getCurrentGroup(),i=t.getHFType();if(i==HEADER_FOOTER_TYPE.PRIMARY)return{headerName:"header",footerName:"footer"};if(i==HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE)return 1==e?{headerName:"header_first",footerName:"footer_first"}:{headerName:"header",footerName:"footer"};if(i==HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE){if(1==e)return{headerName:"header_odd",footerName:"footer_odd"};var n=e%2;return 0==n?{headerName:"header_even",footerName:"footer_even"}:{headerName:"header_odd",footerName:"footer_odd"}}if(i==HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE){if(1==e)return{headerName:"header_first",footerName:"footer_first"};var n=e%2;return 0==n?{headerName:"header_even",footerName:"footer_even"}:{headerName:"header_odd",footerName:"footer_odd"}}},Pagenumberdlg.getHdrFtrPageNumberIndex=function(e){var t=DocLayoutManager.getCurrentPage()||DocLayoutManager.getFirstPage();return pageNumberFormat.pageNumber=t.getAbsolutePageNumber(),"header"===e?Pagenumberdlg.findPagenoFieldInSection(t.getHeader().getNode()):"footer"===e?Pagenumberdlg.findPagenoFieldInSection(t.getFooter().getNode()):void 0},Pagenumberdlg.setStyle=function(e,t){if(t===-1)pageNumberFormat[e+"Style"]="none";else{var i=DocLayoutManager.getLineAtIndex(t),n=0;if(i){var o=i.parent;n=o&&o.paraProperties&&o.paraProperties.align||0}n>=3?pageNumberFormat[e+"Style"]="left":pageNumberFormat[e+"Style"]=TEXT_ALIGN[n]}},Pagenumberdlg.initSubMenu=function(){Pagenumberdlg.dialogInfo.init(),pageNumberFormat.headerStyle?Z("pagenumbers-submenu").zmenu("setMenuItemsAttribute",Z("pagenumbers-submenu-header-"+pageNumberFormat.headerStyle),"checked",!0):Z("pagenumbers-submenu").zmenu("setMenuItemsAttribute",Z("pagenumbers-submenu-header-none"),"checked",!0),pageNumberFormat.footerStyle?Z("pagenumbers-submenu").zmenu("setMenuItemsAttribute",Z("pagenumbers-submenu-footer-"+pageNumberFormat.footerStyle),"checked",!0):Z("pagenumbers-submenu").zmenu("setMenuItemsAttribute",Z("pagenumbers-submenu-footer-none"),"checked",!0)},Pagenumberdlg.removePageNumbers=function(e){var t=[];if(e)t=Pagenumberdlg.getSectionsToUpdate(e);else{var i=DocLayoutManager.getCurrentPage(),n=i.getGroup();n.getHFType();t.push(i.getHeader().getNode()),t.push(i.getFooter().getNode())}var o=3;for(var r in t)Pagenumberdlg.sendOpForSection(t[r],o);pageNumberFormat.headerStyle="none",pageNumberFormat.footerStyle="none"},Pagenumberdlg.getParaAlignAtIndex=function(e){var t=DocLayoutManager.getLineAtIndex(e),i=editor.doc.getRawFormatAt(t.parent.getEndIndex());return i&&i[ATTR_PARAGRAPH.PS_AL]?i[ATTR_PARAGRAPH.PS_AL]:0},Pagenumberdlg.refreshValues=function(){var e=Z(ELEM_ID.PAGENUMBERPANEL),t=DocLayoutManager.getCurrentGroup();e.data("ZCtrackObjects")&&LeftPanel.isPanelVisible(ELEM_ID.PAGENUMBERPANEL)&&Pagenumberdlg.currentSectionGroupId!==t.getId()&&e.ZCtrackObjects("refreshValues")},Pagenumberdlg.handlePanelClose=function(e){e===ELEM_ID.PAGENUMBERPANEL&&PubSub.unsubscribe("Document/CursorPositionChanged",Pagenumberdlg.refreshValues)},Pagenumberdlg.handlePanelOpen=function(e){e===ELEM_ID.PAGENUMBERPANEL&&PubSub.subscribe("Document/CursorPositionChanged",Pagenumberdlg.refreshValues)},Pagenumberdlg.addSubscribers=function(){PubSub.subscribe("BeforePanelOpen",Pagenumberdlg.handlePanelOpen),PubSub.subscribe("BeforePanelClose",Pagenumberdlg.handlePanelClose)}();var ParaBorders=function(e){"use strict";var t={},i=([ATTR_BORDERS.BORDER_TOP,ATTR_BORDERS.BORDER_LEFT,ATTR_BORDERS.BORDER_RIGHT,ATTR_BORDERS.BORDER_BOTTOM],ATTR_BORDERS.WIDTH,ATTR_BORDERS.COLOR,ATTR_BORDERS.TYPE,{type:"solid",color:"zwdark1",width:"1px",space:"0px"}),n=["border-top","border-left","border-right","border-bottom"],o={BDR_ALL:"para-bdr-all",BDR_INSIDE:"para-bdr-inside",BDR_OUTSIDE:"para-bdr-outside",BDR_TOP:"para-bdr-top",BDR_LEFT:"para-bdr-left",BDR_RIGHT:"para-bdr-right",BDR_BOTTOM:"para-bdr-bottom",BDR_VR:"para-bdr-vr",BDR_HR:"para-bdr-hr",BDR_WIDTH:"para-bdr-width",BDR_STYLE:"para-bdr-style",BDR_WIDTH_MENU:"para-bdr-width-menu",BDR_STYLE_MENU:"para-bdr-style-menu",BDR_WIDTH_MENU_ITEM:"para-bwidth-",BDR_STYLE_MENU_ITEM:"para-bstyle-",BDR_COLOR:"para-bdr-color",BG_COLOR_PICKER:"para_clrfldBGColor",BG_COLOR:"para-bg-color",BG_IMG:"para-bg-img",BG_COLOR_CODE:"para-bg-color-cont",BG_IMG_FILE:"para-localimg-file",BG_IMG_FILE_PATH:"para-localimg-file-path",BG_IMG_SELECTED:"para-bgimg-selected",BG_COLOR_VALUE:"para-bg-clr-value",PARA_CUSTOM_SPACE:"para-custom-margins",BDR_RADIUS:"border-radius",BG_IMG_NONE:"para-bg-none"},r={PARA_BORDER_INSIDE:{set:function(e,t,i){Z(o.BDR_INSIDE).zstatebutton("checked",t),Z(o.BDR_VR).zstatebutton("checked",t),Z(o.BDR_HR).zstatebutton("checked",t),u(e,i)}},PARA_BORDER_OUTSIDE:{get:function(e,t){m(!0)},set:function(e,t,i){Z(o.BDR_TOP).zstatebutton("checked",t),Z(o.BDR_RIGHT).zstatebutton("checked",t),Z(o.BDR_BOTTOM).zstatebutton("checked",t),Z(o.BDR_LEFT).zstatebutton("checked",t),u(e,i)}},PARA_BORDER_TOP:{set:function(e,t,i){u(e,i),BorderUtils.selectSide(o,"para-bdr-selection")}},PARA_BORDER_HR:{set:function(e,t,i){u(e,i),BorderUtils.selectSide(o,"para-bdr-selection")}},PARA_BORDER_BOTTOM:{set:function(e,t,i){u(e,i),BorderUtils.selectSide(o,"para-bdr-selection")}},PARA_BORDER_LEFT:{set:function(e,t,i){u(e,i),BorderUtils.selectSide(o,"para-bdr-selection")}},PARA_BORDER_VR:{set:function(e,t,i){u(e,i)}},PARA_BORDER_RIGHT:{set:function(e,t,i){u(e,i),BorderUtils.selectSide(o,"para-bdr-selection")}},PARA_BORDER_COLOR:{get:function(e,i){0!=t[ATTR_BORDERS.COLOR]?p(t[ATTR_BORDERS.COLOR],!0):p("rgb(0, 0, 0)",!0)},set:function(e,t,i){if(arguments[4].fromUI){p(ZWColorUtils.rgbToHex(arguments[4].color),!0);var n=BorderUtils.getSelectedSides("para"),o={};return o.border={key:"color",value:Utils.getColorReference(arguments[4]),sides:n},o}}},PARA_BORDER_WIDTH:{get:function(e,i){0==t.width?Z(o.BDR_WIDTH_MENU).zmenu("checkAllItems",!1):Z(o.BDR_WIDTH_MENU).zmenu("check",o.BDR_WIDTH_MENU_ITEM+t.width)},set:function(e,t,i){var n=BorderUtils.getSelectedSides("para"),o=$(t).attr("value"),r={};return r.border={key:"width",value:o,sides:n},r}},PARA_BORDER_TYPE:{get:function(e,i){0==t.type?Z(o.BDR_STYLE_MENU).zmenu("checkAllItems",!1):Z(o.BDR_STYLE_MENU).zmenu("check",o.BDR_STYLE_MENU_ITEM+t.type)},set:function(e,t,i){var n=BorderUtils.getSelectedSides("para"),o=$(t).attr("value"),r={};return r.border={key:"type",value:o,sides:n},r}},PARA_BORDER_RADIUS:{get:function(e,i){return 0==Object.keys(t.borders).length?J(i).disable():J(i).enable(),t.bdr_radius},set:function(e,t,i){var n={};return n[ATTR_BORDERS.BORDER_RADIUS]={},n[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_TOPLEFT]=t,n[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_TOPRIGHT]=t,n[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_BOTTOMLEFT]=t,n[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_BOTTOMRIGHT]=t,n}},PARA_BG_COLOR:{get:function(e,i){if(t.bgc&&"none"!=t.bgc){Z(o.BG_COLOR).zstatebutton("checked",!0),g();var n=Utils.getColorValFromRefString(t.bgc);O(n)}else Z(o.BG_COLOR).zstatebutton("checked",!1),O(null)},set:function(e,t,i){g()}},PARA_BG_COLOR_PICKER:{get:function(e,i){if(t.bgc&&"none"!=t.bgc){Z(o.BG_COLOR).zstatebutton("checked",!0),g();var n=Utils.getColorValFromRefString(t.bgc);O(n)}else Z(o.BG_COLOR).zstatebutton("checked",!1),O(null)},set:function(e,t,i){if(arguments[4].fromUI){O(t);var n={};return n.bgc=Utils.getColorReference(arguments[4]),n}}},PARA_BG_IMG:{get:function(e,i){t.bgimg?(Z(o.BG_IMG).zstatebutton("checked",!0),E()):Z(o.BG_IMG_FILE).hide()},set:function(e,i,n){t.bgimg?E():f()}},PARA_BG_IMG_UPLOAD:{set:function(e,i,n){t.bgimg?E():f();var r={},a=Z(o.BG_IMG_FILE_PATH).val();return r.bgimg=a,r}},PARA_BG_NONE:{get:function(e,i){t.bgc||(O(null),Z(o.BG_IMG_NONE).zstatebutton("checked",!0),T())},set:function(e,t,i){R();var n={};return n.bgc="none",n}},PARA_BORDER_SPACE:{get:function(e,i){var n=t.bdr_space;return"custom"==n?Z(o.PARA_CUSTOM_SPACE).show():Z(o.PARA_CUSTOM_SPACE).hide(),0==Object.keys(t.borders).length?J(i).disable():J(i).enable(),n},set:function(e,t,i){var n={};return"custom"!=t?(n.border={key:"space",value:t,sides:["border-top","border-left","border-bottom","border-right"]},Z("paraBorderMarginTop").zlabelednumberfield("setValue",t),Z("paraBorderMarginBottom").zlabelednumberfield("setValue",t),Z("paraBorderMarginLeft").zlabelednumberfield("setValue",t),Z("paraBorderMarginRight").zlabelednumberfield("setValue",t),n):(Z(o.PARA_CUSTOM_SPACE).show(),void(n.bdr_space="custom"))}},PARA_SPACE_TOP:{get:function(e,i){return J(i).zlabelednumberfield("setAttribute","max",41),J(i).zlabelednumberfield("setAttribute","min",0),J(i).zlabelednumberfield("setAttribute","step",1),J(i).zlabelednumberfield("setAttribute","suffix","px"),t.bdr_space_top},set:function(e,t,i){var o={};t+="px";var r=["border-top"];return Z("keepaspectformargin").prop("checked")&&(r=n,Z("paraBorderMarginBottom").zlabelednumberfield("setValue",t),Z("paraBorderMarginLeft").zlabelednumberfield("setValue",t),Z("paraBorderMarginRight").zlabelednumberfield("setValue",t)),o.border={key:"space",value:t,sides:r},o}},PARA_SPACE_BOTTOM:{get:function(e,i){return J(i).zlabelednumberfield("setAttribute","max",41),J(i).zlabelednumberfield("setAttribute","min",0),J(i).zlabelednumberfield("setAttribute","step",1),J(i).zlabelednumberfield("setAttribute","suffix","px"),t.bdr_space_bottom},set:function(e,t,i){var o={};t+="px";var r=["border-bottom"];return Z("keepaspectformargin").prop("checked")&&(r=n,Z("paraBorderMarginTop").zlabelednumberfield("setValue",t),Z("paraBorderMarginLeft").zlabelednumberfield("setValue",t),Z("paraBorderMarginRight").zlabelednumberfield("setValue",t)),o.border={key:"space",value:t,sides:r},o}},PARA_SPACE_LEFT:{get:function(e,i){return J(i).zlabelednumberfield("setAttribute","max",41),J(i).zlabelednumberfield("setAttribute","min",0),J(i).zlabelednumberfield("setAttribute","step",1),J(i).zlabelednumberfield("setAttribute","suffix","px"),t.bdr_space_left},set:function(e,t,i){var o={};t+="px";var r=["border-left"];return Z("keepaspectformargin").prop("checked")&&(r=n,Z("paraBorderMarginBottom").zlabelednumberfield("setValue",t),Z("paraBorderMarginTop").zlabelednumberfield("setValue",t),Z("paraBorderMarginRight").zlabelednumberfield("setValue",t)),o.border={key:"space",value:t,sides:r},o}},PARA_SPACE_RIGHT:{get:function(e,i){return J(i).zlabelednumberfield("setAttribute","max",41),J(i).zlabelednumberfield("setAttribute","min",0),J(i).zlabelednumberfield("setAttribute","step",1),J(i).zlabelednumberfield("setAttribute","suffix","px"),t.bdr_space_right},set:function(e,t,i){var o={};t+="px";var r=["border-right"];return Z("keepaspectformargin").prop("checked")&&(r=n,Z("paraBorderMarginBottom").zlabelednumberfield("setValue",t),Z("paraBorderMarginLeft").zlabelednumberfield("setValue",t),Z("paraBorderMarginTop").zlabelednumberfield("setValue",t)),o.border={key:"space",value:t,sides:r},o}},PARA_BORDER_RESET:{set:function(){I()}},PARA_BORDER_NONE:{set:function(){A()}},PARA_BACKGROUND_RESET:{set:function(){_()}}},a={beforeFillValues:function(){t={borders:null,bgc:null,width:null,type:null,color:null,sides:[],bdr_radius:null,bdr_space:null,bdr_space_top:null,bdr_space_bottom:null,bdr_space_left:null,bdr_space_right:null},t=d(t)},get:function(e,t){var i=r[e.action]&&r[e.action].get;if(i)return i(e,t)},set:function(e,i,n,o,a){arguments[5]&&arguments[5].keyCode==KEYS.TAB?EventHandler.isDialogFocused=!0:EventHandler.isDialogFocused=!1;var s=r[e.action].set,l=s&&s.apply(null,arguments);if(null!=l){for(var d in l)t[d]=l[d];c(l)}}},s=function(e){for(var t=e.key,n=e.value,r=e.sides,a=editor.doc.getParents(NODE_TYPE.PARAGRAPH,editor.doc.getSelection().getStart()),s=a.attr()[ATTR_COMMON.BORDERS]||{},l=!1,d=0,c=r.length;d<c;d++){var u=r[d];if(u="border-hr"==u?"border-between":u,s&&s[u])"width"!=t&&"0px"==s[u].width&&(s[u].width="1px",s[u].color="rgb(0,0,0)",s[u].type="solid"),"type"!=t&&"none"==s[u].type&&(s[u].type="solid"),"color"!=t&&"none"==s[u].color&&(s[u].color="rgb(0,0,0)"),s[u][t]=n;else{var e=DocUtil.copyStyle(i);"space"!=t&&(e[t]=n,s[u]=e),l=!0}!s[u]||s[u][ATTR_BORDERS.SPACE]&&"0px"!=s[u][ATTR_BORDERS.SPACE]||("border-left"==u||"border-right"==u?s[u][ATTR_BORDERS.SPACE]="5px":"border-top"!=u&&"border-bottom"!=u||(s[u][ATTR_BORDERS.SPACE]="1px")),t==ATTR_BORDERS.TYPE&&"double"==n&&parseInt(s[u][ATTR_BORDERS.WIDTH])<3&&(s[u][ATTR_BORDERS.WIDTH]="3px"),l&&(Z("paraBorderMarginTop").zlabelednumberfield("setValue",s[ATTR_BORDERS.BORDER_TOP]&&s[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.SPACE]||"0px"),Z("paraBorderMarginBottom").zlabelednumberfield("setValue",s[ATTR_BORDERS.BORDER_BOTTOM]&&s[ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.SPACE]||"0px"),Z("paraBorderMarginLeft").zlabelednumberfield("setValue",s[ATTR_BORDERS.BORDER_LEFT]&&s[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]||"0px"),Z("paraBorderMarginRight").zlabelednumberfield("setValue",s[ATTR_BORDERS.BORDER_RIGHT]&&s[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]||"0px"),Z("parabordermargins").zlabeledselectbox("setValue","custom"),Z(o.PARA_CUSTOM_SPACE).show());var g=BorderUtils.getBorderValuesForUpdateUI(s);Z(o.BDR_WIDTH).zselectbox("setValue",g[ATTR_BORDERS.WIDTH]),Z(o.BDR_STYLE).zselectbox("setValue",g[ATTR_BORDERS.TYPE]),Z(o.BDR_COLOR).zcolorfield("setColor",p(Utils.getColorValFromRefString(g.color),!0)),s["border-radius"]&&Z(o.BDR_RADIUS).zlabelednumberfield("setValue",s["border-radius"]["br-topRight"])}return s},l={bgc:function(e,t,i){return e[ATTR_PARAGRAPH.PS_BGC]},width:function(e,t,i){return i[ATTR_BORDERS.WIDTH]},type:function(e,t,i){return i[ATTR_BORDERS.TYPE]},color:function(e,t,i){return i[ATTR_BORDERS.COLOR]},sides:function(e,t,i){return i.sides},bdr_radius:function(e,t,i,n){return n&&n[ATTR_BORDERS.BORDER_RADIUS]?n[ATTR_BORDERS.BORDER_RADIUS][ATTR_BORDERS.RADIUS_TOPLEFT]:"0px"},bdr_space:function(e,t,i,n){return b(n)},bdr_space_top:function(e,t,i,n){return n&&n["border-top"]&&n["border-top"].space||"0"+Conversions.globalUnit},bdr_space_left:function(e,t,i,n){return n&&n["border-left"]&&n["border-left"].space||"0"+Conversions.globalUnit},bdr_space_right:function(e,t,i,n){return n&&n["border-right"]&&n["border-right"].space||"0"+Conversions.globalUnit},bdr_space_bottom:function(e,t,i,n){return n&&n["border-bottom"]&&n["border-bottom"].space||"0"+Conversions.globalUnit}},d=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),i=t.attr(),n=i[ATTR_COMMON.BORDERS]?i[ATTR_COMMON.BORDERS]:{};BorderUtils.convertZWColorToRGB(n),e[ATTR_COMMON.BORDERS]=n;var o=e[ATTR_COMMON.BORDERS],r=BorderUtils.getBorderValuesForUpdateUI(o);for(key in e)key!=ATTR_COMMON.BORDERS&&(e[key]=l[key](i,t,r,n));return e},c=function(e){var i={bgc:ATTR_PARAGRAPH.PS_BGC,borders:ATTR_COMMON.BORDERS,resetBorder:"resetBorder",resetBackground:"resetBackground","border-radius":ATTR_BORDERS.BORDER_RADIUS};e.border&&(e.borders=s(e.border),delete e.border,t.borders=e.borders);var n=editor.doc.getSelection(),r=n.getNodesInSelection(NODE_TYPE.PARAGRAPH);for(var a in e){var l={};if(a==ATTR_BORDERS.BORDER_RADIUS?r[0].attr().borders&&(l[i.borders]=r[0].attr().borders||{},l[i.borders][a]=e[a],l.borders&&delete l.borders["border-all"],l.borders&&delete l.borders["border-hr"],l.borders&&delete l.borders["border-inside"],l.borders&&delete l.borders["border-outside"],l.borders&&delete l.borders["border-vr"],n.isCollapsed()&&(D(l[ATTR_COMMON.BORDERS]),r.length>1&&Op.sendMsg())):(l[i[a]]=e[a],a==ATTR_COMMON.BORDERS?((l[ATTR_COMMON.BORDERS]["border-top"]||l[ATTR_COMMON.BORDERS]["border-between"]||l[ATTR_COMMON.BORDERS]["border-bottom"])&&(l.borders&&delete l.borders["border-all"],l.borders&&delete l.borders["border-hr"],l.borders&&delete l.borders["border-inside"],l.borders&&delete l.borders["border-outside"],l.borders&&delete l.borders["border-vr"],n.isCollapsed()&&(D(l[ATTR_COMMON.BORDERS]),r.length>1&&Op.sendMsg())),Z(o.BDR_RADIUS).enable(),Z("parabordermargins").enable()):"resetBorder"==a&&(t.borders={})),l.borders&&delete l.borders["border-all"],l.borders&&delete l.borders["border-hr"],l.borders&&delete l.borders["border-inside"],l.borders&&delete l.borders["border-outside"],l.borders&&delete l.borders["border-vr"],!jQuery.isEmptyObject(l)){if(l.borders&&0==Object.keys(l.borders).length)return void Op.sendMsg();editor.doc.execCmd("applyStyle",[r,l,"applyParaStyle"])}}},u=function(e,i){if(Z(o.BDR_TOP).prop("checked")&&Z(o.BDR_RIGHT).prop("checked")&&Z(o.BDR_BOTTOM).prop("checked")&&Z(o.BDR_LEFT).prop("checked")?(Z(o.BDR_OUTSIDE).zstatebutton("checked",!0),J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-all")):(Z(o.BDR_OUTSIDE).zstatebutton("checked",!1),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-top"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-left"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-right"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-bottom"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-all")),Z(o.BDR_VR).prop("checked")&&Z(o.BDR_HR).prop("checked")?(Z(o.BDR_INSIDE).zstatebutton("checked",!0),J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-icon-ball-in-sm"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-icon-bnone")):(Z(o.BDR_INSIDE).zstatebutton("checked",!1),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-icon-ball-in-sm"),J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-icon-bnone")),Z(o.BDR_INSIDE).prop("checked")&&Z(o.BDR_OUTSIDE).prop("checked")&&(J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-icon-ball-in-sm"),J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-all"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-icon-bnone")),Z(o.BDR_TOP).prop("checked")||Z(o.BDR_RIGHT).prop("checked")||Z(o.BDR_BOTTOM).prop("checked")||Z(o.BDR_LEFT).prop("checked")||Z(o.BDR_VR).prop("checked")||Z(o.BDR_HR).prop("checked")||Z(o.BDR_INSIDE).prop("checked")||Z(o.BDR_OUTSIDE).prop("checked")){var n=BorderUtils.getSelectedSides("para"),r={};if(t[ATTR_COMMON.BORDERS])for(var a=0;a<n.length;a++)r[n[a]]=t[ATTR_COMMON.BORDERS][n[a]]?t[ATTR_COMMON.BORDERS][n[a]]:{};var s=BorderUtils.getBorderValuesForUpdateUI(r),l=s[ATTR_BORDERS.WIDTH],d=s[ATTR_BORDERS.TYPE],c=s[ATTR_BORDERS.COLOR];l?Z(o.BDR_WIDTH_MENU).zmenu("check",o.BDR_WIDTH_MENU_ITEM+l):Z(o.BDR_WIDTH_MENU).zmenu("checkAllItems",!1),d?Z(o.BDR_STYLE_MENU).zmenu("check",o.BDR_STYLE_MENU_ITEM+d):Z(o.BDR_STYLE_MENU).zmenu("checkAllItems",!1),c?p(c,!0):p("rgb(0, 0, 0)",!0)}},p=function(e,t){Z(o.BDR_WIDTH_MENU).find(".zmenu__icon").css({"border-top-color":e}),Z(o.BDR_STYLE_MENU).find(".zmenu__icon").css({"border-top-color":e}),Z(o.BDR_COLOR).zcolorselectbox("setValue",e)},g=function(){Z(o.BG_IMG_SELECTED).hide(),Z(o.BG_IMG_FILE).hide(),Z(o.BG_COLOR_CODE).show()},f=function(){Z(o.BG_COLOR_CODE).hide(),Z(o.BG_IMG_SELECTED).hide(),Z(o.BG_IMG_FILE).show()},E=function(){Z(o.BG_COLOR_CODE).hide(),Z(o.BG_IMG_SELECTED).show(),Z(o.BG_IMG_FILE).hide()},T=function(){Z(o.BG_COLOR_CODE).hide(),Z(o.BG_IMG_SELECTED).hide(),Z(o.BG_IMG_FILE).hide()},m=function(e){Z(o.BDR_INSIDE).zstatebutton("checked",!1),Z(o.BDR_OUTSIDE).zstatebutton("checked",!1),Z(o.BDR_TOP).zstatebutton("checked",!1),Z(o.BDR_RIGHT).zstatebutton("checked",!1),Z(o.BDR_BOTTOM).zstatebutton("checked",!1),Z(o.BDR_LEFT).zstatebutton("checked",!1),Z(o.BDR_VR).zstatebutton("checked",!1),Z(o.BDR_HR).zstatebutton("checked",!1);var t=editor.doc.getSelection(),i=t.getNodesInSelection(NODE_TYPE.PARAGRAPH),n=L(i[0].dtNode);n.isBoxPara&&"0px"!=n.width||i.length>1?Z(o.BDR_HR).zstatebutton("enable"):Z(o.BDR_HR).zstatebutton("disable"),J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-icon-bnone"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-icon-ball-sm"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-all"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-top"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-left"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-right"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-sbdr-bottom"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-icon-bin-vert-sm"),J("#para-bdr-selection .ui-sbdr-cont").removeClass("ui-icon-bin-hori-sm"),J("#para-bdr-selection .ui-sbdr-cont").css("border-color","rgba(177, 198, 200, 0.5)"),1==e&&(J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-top"),J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-left"),J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-right"),J("#para-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-bottom"))},h=function(){BorderUtils.getSelectedSides("para")},I=function(){var e={};e.resetBorder=!0,c(e),S(!0)},_=function(){var e={};e.resetBackground=!0,t[ATTR_PARAGRAPH.PS_BGC]=null,c(e),R()},A=function(){var e=BorderUtils.getSelectedSides("para"),t={};t.border={key:"width",value:"0px",sides:e},c(t),S()},S=function(e){e&&p("rgb(0,0,0)",!0),Z(o.BDR_WIDTH_MENU).zmenu("checkAllItems",!1),Z(o.BDR_STYLE_MENU).zmenu("checkAllItems",!1),e&&Z(o.BDR_RADIUS).zlabelednumberfield("setValue","0px"),e&&Z("parabordermargins").zlabeledselectbox("setValue","0px"),Z("para-custom-margins").hide(),h(),m(!0),Z(o.BDR_RADIUS).disable(),Z("parabordermargins").disable()},R=function(){T(),O(null)},O=function(e){null==e?(Z(o.BG_COLOR_PICKER).zcolorselectbox("setValue","white"),Z(o.BG_COLOR_PICKER).zcolorselectbox("getElement").removeClass("ui-bg-active"),Z(o.BG_IMG_NONE).addClass("ui-bg-active")):(Z(o.BG_COLOR_PICKER).zcolorselectbox("setValue",e),Z(o.BG_COLOR_PICKER).zcolorselectbox("getElement").addClass("ui-bg-active"),Z(o.BG_IMG_NONE).removeClass("ui-bg-active"))},b=function(e){if(!e||0==Object.keys(e).length)return"0px";var t=e["border-left"]&&e["border-left"].space,i=e["border-right"]&&e["border-right"].space,n=e["border-top"]&&e["border-top"].space,o=e["border-bottom"]&&e["border-bottom"].space;return t==i&&n==o&&n==i&&("15px"==t||"5px"==t||"17px"==t||"25px"==t||"0px"==t)?t:"custom"},v=function(e){var t={};e||(e="rgb(255,0,0)"),t[ATTR_COMMON.BORDERS]=s({key:"color",value:e,sides:[ATTR_BORDERS.BORDER_TOP,ATTR_BORDERS.BORDER_RIGHT,ATTR_BORDERS.BORDER_BOTTOM,ATTR_BORDERS.BORDER_LEFT]}),c(t),Z(o.BDR_COLOR).zcolorselectbox("setValue",Utils.getColorValFromRefString(e))},D=function(e){var t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,editor.doc.getSelection().getStart()).dtNode,i=t.format.borders,n=L(t);if("0px"!=n.width){for(;t;){var o=t.prev;if(!i||!o)break;var r=o.format.borders;if(!U.isEqual(i,r))break;var a=editor.doc.getParents(NODE_TYPE.PARAGRAPH,o.start);e["border-top"]&&(r=e),e["border-bottom"]&&(r=e),a.attr({borders:r}),t=o}for(t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,editor.doc.getSelection().getStart()).dtNode;t;){var s=t.next;if(!i||!s)break;var l=s.format.borders;if(!U.isEqual(i,l))break;var d=editor.doc.getParents(NODE_TYPE.PARAGRAPH,s.start);e["border-top"]&&(l=e),e["border-bottom"]&&(l=e),d.attr({borders:l}),t=s}}},L=function(e){var t=e.format.borders,i=!1;if(!t||0==Object.keys(t).length)return{isBoxPara:i};for(var n=t&&(t["border-top"]||t["border-left"]||t["border-right"]||t["border-bottom"]),i=!1;e;){var o=e.prev;if(t&&o){var r=o.format.borders;if(U.isEqual(t,r)){i=!0;break}i=!1;break}i=!1;break}if(i)return{isBoxPara:i,width:n.width};for(;e;){var a=e.next;if(t&&a){var s=a.format.borders;if(U.isEqual(t,s)){i=!0;break}i=!1;break}i=!1;break}return{isBoxPara:i,width:n.width}};return{panelInfo:a,sidesSelection:m,resetBorder:I,resetBackground:_,updateColor:v,removeBorder:A,handleBeforeClose:h}}(ELEM_ID),BorderUtils=function(){var e=["all","outside","inside","top","vr","right","left","between","bottom","hr"],t={type:"solid",color:"zwdark1",width:"1px",space:"0px"},n=function(e,t){var i={"border-left":ATTR_BORDERS.BORDER_RIGHT,"border-top":ATTR_BORDERS.BORDER_BOTTOM,"border-right":ATTR_BORDERS.BORDER_LEFT,"border-bottom":ATTR_BORDERS.BORDER_TOP},n=TableUtil.getSurroundingCells(t),o={};for(var r in e){var a=e[r];if(o[r]=a,"0px"==a[ATTR_BORDERS.WIDTH]){var s=r.split("-"),l=n[s[1]+"Cell"],d=l&&O(l,[i[r]])[i[r]];d&&"0px"!=d[ATTR_BORDERS.WIDTH]&&(o[r]=d)}}return o},o=function(e){var t=[],i=0,n=e.length,o=TableUtil.findRowIdx(e[0].parentNode()),r=TableUtil.findRowIdx(e[n-1].parentNode()),a=TableUtil.findColIdx(e[0]),s=TableUtil.findColIdx(e[n-1]);for(i=0;i<n;i++){var l=e[i],d={fc:!1,fr:!1,lc:!1,lr:!1},c=TableUtil.findRowIdx(l.parentNode()),u=TableUtil.findColIdx(l);c===o&&(d.fr=!0),c===r&&(d.lr=!0),u===a&&(d.fc=!0),u===s&&(d.lc=!0),t.push(d)}return t},r=function(e,t){var i,n,o,r,a=e.parentNode(),s=TableUtil.findRowIdx(a)-1,l=TableUtil.findRowIdx(t.parentNode())-1,d=TableUtil.findColIdx(e)-1,c=TableUtil.findColIdx(t)-1,u=[],p=[],g=[],f=[],E=0,T=a.parentNode().children(),m=T.length,h=a.children().length;for(i=s>=1?s-1:s,n=l<m-1?l+1:l,o=d>=1?d-1:d,r=c<h-1?c+1:c,E=i;E<=n;E++){var I,_=o,A=r,S=T[E].children();for(I=_;I<=A;I++)if(!(E===s-1&&I===d-1||E===s-1&&I===c+1||E===l+1&&I===d-1||E===l+1&&I===c+1)){var R=S[I];E==s-1&&i!=s&&u.push(R),E>=s&&E<=l&&(I===d-1&&g.push(R),I===c+1&&f.push(R)),E===l+1&&n!=l&&p.push(R)}}return{topBoundaryCells:u,rightBoundaryCells:f,bottomBoundaryCells:p,leftBoundaryCells:g}},a=function(e){var t={},i=[ATTR_BORDERS.BORDER_TOP,ATTR_BORDERS.BORDER_BOTTOM,ATTR_BORDERS.BORDER_RIGHT,ATTR_BORDERS.BORDER_LEFT],n={};return n[ATTR_COMMON.BORDERS]=O(e,i),t=DomUtil.getBorderStyles(n),t["background-color"]=m(e),t},s=function(e,t,n,o){var r=e.length,a=BorderUtils.getSorroundingCellsForSelection(),s=BorderUtils.getSelectedSides("cell");if(s.indexOf("border-all")==-1){if(s.indexOf("border-outside")!=-1&&(BorderUtils.applyOutSideBorders(n[ATTR_COMMON.BORDERS],a,!0,o.border),Op.sendMsg()),s.indexOf("border-top")!=-1||s.indexOf("border-left")!=-1||s.indexOf("border-right")!=-1||s.indexOf("border-bottom")!=-1){var l={};s.indexOf("border-top")!=-1&&(l["border-top"]=n[ATTR_COMMON.BORDERS]["border-top"]),s.indexOf("border-left")!=-1&&(l["border-left"]=n[ATTR_COMMON.BORDERS]["border-left"]),s.indexOf("border-right")!=-1&&(l["border-right"]=n[ATTR_COMMON.BORDERS]["border-right"]),s.indexOf("border-bottom")!=-1&&(l["border-bottom"]=n[ATTR_COMMON.BORDERS]["border-bottom"]),BorderUtils.applyOutSideBorders(l,a,!0,o.border),Op.sendMsg()}return void(s.indexOf("border-inside")!=-1?BorderUtils.setInsideH_InsideV(o.border,!0,!0,e,t):s.indexOf("border-hr")!=-1?BorderUtils.setInsideH_InsideV(o.border,!0,!1,e,t):s.indexOf("border-vr")!=-1&&BorderUtils.setInsideH_InsideV(o.border,!1,!0,e,t))}var d=[],c=BorderUtils.getSelectedCellsInfo(e);for(i=0;i<r;i++){var u=c[i],p={};n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]&&(p[ATTR_BORDERS.BORDER_TOP]=n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP],u.lr||(p[ATTR_BORDERS.BORDER_BOTTOM]=p[ATTR_BORDERS.BORDER_TOP])),n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]&&(p[ATTR_BORDERS.BORDER_BOTTOM]=n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM],u.fr||(p[ATTR_BORDERS.BORDER_TOP]=p[ATTR_BORDERS.BORDER_BOTTOM])),n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]&&(p[ATTR_BORDERS.BORDER_LEFT]=n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT],u.lc||(p[ATTR_BORDERS.BORDER_RIGHT]=p[ATTR_BORDERS.BORDER_LEFT])),n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]&&(p[ATTR_BORDERS.BORDER_RIGHT]=n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT],u.fc||(p[ATTR_BORDERS.BORDER_LEFT]=p[ATTR_BORDERS.BORDER_RIGHT])),d.push({borders:p})}var g=BorderUtils.getBoundaryCellsOfSelection(e[0],e[r-1]);if(n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]){var f,E=g.topBoundaryCells,T=E.length;for(f=0;f<T;f++){e.push(E[f]);var m;m=E[f].attr()[ATTR_COMMON.BORDERS]?E[f].attr()[ATTR_COMMON.BORDERS]:{},m[ATTR_BORDERS.BORDER_BOTTOM]=n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP],d.push({borders:m})}}if(n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]){var f,h=g.rightBoundaryCells,I=h.length;for(f=0;f<I;f++){e.push(h[f]);var m;m=h[f].attr()[ATTR_COMMON.BORDERS]?h[f].attr()[ATTR_COMMON.BORDERS]:{},m[ATTR_BORDERS.BORDER_LEFT]=n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT],d.push({borders:m})}}if(n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]){var f,_=g.bottomBoundaryCells,A=_.length;for(f=0;f<A;f++){e.push(_[f]);var m;m=_[f].attr()[ATTR_COMMON.BORDERS]?_[f].attr()[ATTR_COMMON.BORDERS]:{},m[ATTR_BORDERS.BORDER_TOP]=n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM],d.push({borders:m})}}if(n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]){var f,S=g.leftBoundaryCells,R=S.length;for(f=0;f<R;f++){i+=1,e.push(S[f]);var m;m=S[f].attr()[ATTR_COMMON.BORDERS]?S[f].attr()[ATTR_COMMON.BORDERS]:{},m[ATTR_BORDERS.BORDER_RIGHT]=n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT],d.push({borders:m})}}return n=d,n.borders&&delete n.borders["border-all"],n.borders&&delete n.borders["border-hr"],n.borders&&delete n.borders["border-inside"],n.borders&&delete n.borders["border-outside"],n.borders&&delete n.borders["border-vr"],n.borders&&delete n.borders["border-between"],n},l=function(e,t){var i=TableUtil.findColIdx(e)-1,n=e.parentNode().children(),o=n[i-1]?n[i-1]:void 0,r=n[i+1]?n[i+1]:void 0,a=e.parentNode().previousSibling(),s=a?a.children():[],l=s[i]?s[i]:void 0,d=e.parentNode().nextSibling(),c=d?d.children():[],u=c[i]?c[i]:void 0;if(t[ATTR_BORDERS.BORDER_TOP]&&l){var p=l.attr()[ATTR_COMMON.BORDERS]||{};p[ATTR_BORDERS.BORDER_BOTTOM]=t[ATTR_BORDERS.BORDER_TOP],l.attr({borders:p})}if(t[ATTR_BORDERS.BORDER_RIGHT]&&r){var p=r.attr()[ATTR_COMMON.BORDERS]||{};p[ATTR_BORDERS.BORDER_LEFT]=t[ATTR_BORDERS.BORDER_RIGHT],r.attr({borders:p})}if(t[ATTR_BORDERS.BORDER_BOTTOM]&&u){var p=u.attr()[ATTR_COMMON.BORDERS]||{};p[ATTR_BORDERS.BORDER_TOP]=t[ATTR_BORDERS.BORDER_BOTTOM],u.attr({borders:p})}if(t[ATTR_BORDERS.BORDER_LEFT]&&o){var p=o.attr()[ATTR_COMMON.BORDERS]||{};p[ATTR_BORDERS.BORDER_RIGHT]=t[ATTR_BORDERS.BORDER_LEFT],o.attr({borders:p})}},d=function(e){var t=TableUtil.findColIdx(e)-1,i=e.parentNode().children(),n=i[t-1]?i[t-1]:void 0,o=i[t+1]?i[t+1]:void 0,r=e.parentNode().previousSibling(),a=r?r.children():[],s=a[t]?a[t]:void 0,l=e.parentNode().nextSibling(),d=l?l.children():[],c=d[t]?d[t]:void 0;if(s&&s.attr()[ATTR_COMMON.BORDERS]){var u=s.attr()[ATTR_COMMON.BORDERS];delete u[ATTR_BORDERS.BORDER_BOTTOM],s.attr({borders:u})}if(o&&o.attr()[ATTR_COMMON.BORDERS]){var u=o.attr()[ATTR_COMMON.BORDERS]||{};delete u[ATTR_BORDERS.BORDER_LEFT],o.attr({borders:u})}if(c&&c.attr()[ATTR_COMMON.BORDERS]){var u=c.attr()[ATTR_COMMON.BORDERS]||{};delete u[ATTR_BORDERS.BORDER_TOP],c.attr({borders:u})}if(n&&n.attr()[ATTR_COMMON.BORDERS]){var u=n.attr()[ATTR_COMMON.BORDERS]||{};delete u[ATTR_BORDERS.BORDER_RIGHT],n.attr({borders:u})}},c=function(e){var t,i=e.children(),n=i.length,o=i[0].children(),r=i[n-1].children(),a=[],s=[],l=o.length-1;for(t=0;t<n;t++)a.push(i[t].children()[0]),s.push(i[t].children()[l]);return{firstRowCells:o,firstColCells:a,lastRowCells:r,lastColCells:s}},u=function(t){for(var i=[],n=0,o=e.length;n<o;n++){var r=e[n];Z(t+"-bdr-"+r).prop("checked")&&i.push("border-"+r)}return 0==i.length&&(i=["border-top","border-right","border-left","border-bottom","border-outside"],J("#"+t+"-bdr-selection .ui-sbdr-cont").addClass("ui-icon-bnone"),J("#"+t+"-bdr-selection .ui-sbdr-cont").removeClass("ui-icon-ball-in-sm"),J("#"+t+"-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-top"),J("#"+t+"-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-left"),J("#"+t+"-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-right"),J("#"+t+"-bdr-selection .ui-sbdr-cont").addClass("ui-sbdr-bottom")),i},p=function(e){var t={},i=[];for(var n in e)if(n!=ATTR_BORDERS.BORDER_RADIUS&&"border-outside"!=n&&"border-all"!=n&&"border-inside"!=n){var o=e[n];"0px"!=o[ATTR_BORDERS.WIDTH]&&i.push(n),"undefined"==typeof o[ATTR_BORDERS.TYPE]||"undefined"!=typeof t[ATTR_BORDERS.TYPE]&&t[ATTR_BORDERS.TYPE]!==o[ATTR_BORDERS.TYPE]?t[ATTR_BORDERS.TYPE]=null:t[ATTR_BORDERS.TYPE]=o[ATTR_BORDERS.TYPE],"undefined"==typeof o[ATTR_BORDERS.WIDTH]||"undefined"!=typeof t[ATTR_BORDERS.WIDTH]&&t[ATTR_BORDERS.WIDTH]!==o[ATTR_BORDERS.WIDTH]?t[ATTR_BORDERS.WIDTH]=null:t[ATTR_BORDERS.WIDTH]=o[ATTR_BORDERS.WIDTH],"undefined"==typeof o[ATTR_BORDERS.COLOR]||"undefined"!=typeof t[ATTR_BORDERS.COLOR]&&t[ATTR_BORDERS.COLOR]!==o[ATTR_BORDERS.COLOR]?t[ATTR_BORDERS.COLOR]=null:t[ATTR_BORDERS.COLOR]=o[ATTR_BORDERS.COLOR]}return t[ATTR_BORDERS.WIDTH]=t[ATTR_BORDERS.WIDTH]||!1,t[ATTR_BORDERS.COLOR]=t[ATTR_BORDERS.COLOR]||!1,t[ATTR_BORDERS.TYPE]=t[ATTR_BORDERS.TYPE]||!1,t.sides=i,t},g=function(e){if(0!=Object.keys(e).length)for(var t in e)if(t!=ATTR_BORDERS.BORDER_RADIUS){var i=Utils.getColorValFromRefString(e[t][ATTR_BORDERS.COLOR]);i&&(e[t][ATTR_BORDERS.COLOR]=i.replace(/ /g,""))}},f=function(e,i,n,o,r){for(var a=r.length,s=o.length/a,l=0,d=0;d<a;d++)for(var c=0;c<s;c++){var u=o[l];l++;var p=u.attr()[ATTR_COMMON.BORDERS]?u.attr()[ATTR_COMMON.BORDERS]:{};i&&(0!=d&&(p["border-top"]||(p["border-top"]=DocUtil.copyStyle(t)),p["border-top"][e.key]=e.value),d!=a-1&&(p["border-bottom"]||(p["border-bottom"]=DocUtil.copyStyle(t)),p["border-bottom"][e.key]=e.value)),n&&(0!=c&&(p["border-left"]||(p["border-left"]=DocUtil.copyStyle(t)),p["border-left"][e.key]=e.value),c!=s-1&&(p["border-right"]||(p["border-right"]=DocUtil.copyStyle(t)),p["border-right"][e.key]=e.value)),u.attr({borders:p})}},E=function(){for(var e=[],t=editor.doc.getSelection(),i=editor.doc.getParents(NODE_TYPE.TABLE,editor.doc.getSelection().getStart()),n=0;n<=t.getSelectedRows().length-1;n++)e.push(i.children()[t.getSelectedRows()[n]]);for(var n,o=e.length,r=e[0].children(),a=e[o-1].children(),s=[],l=[],d=[],c=[],n=t.getSelectedColumns()[0];n<=t.getSelectedColumns()[t.getSelectedColumns().length-1];n++)d.push(r[n]),c.push(a[n]);for(var n=0;n<e.length;n++){s.push(e[n].children()[t.getSelectedColumns()[0]]);var u=t.getSelectedColumns()[t.getSelectedColumns().length-1];l.push(e[n].children()[u])}return{firstRowCells:d,firstColCells:s,lastRowCells:c,lastColCells:l}},T=function(e,t,i,n){e.borders&&delete e.borders["border-all"],e.borders&&delete e.borders["border-hr"],e.borders&&delete e.borders["border-inside"],e.borders&&delete e.borders["border-outside"],e.borders&&delete e.borders["border-vr"],e.borders&&delete e.borders["border-between"];var o,r=t.firstRowCells,a=t.firstColCells,s=t.lastRowCells,d=t.lastColCells;if(1==r.length&&1==a.length)o=[{elem:r[0],side1:"border-top",side2:"border-left",side3:"border-right",side4:"border-bottom"}];else if(1==r.length){o=[{elem:r[0],side1:"border-top",side2:"border-left",side3:"border-right"},{elem:s[s.length-1],side1:"border-bottom",side2:"border-right",side3:"border-left"}];for(var c=1;c<a.length-1;c++){var u={};u.elem=a[c],u.side1="border-left",u.side2="border-right",o.push(u)}}else if(1==a.length){o=[{elem:r[0],side1:"border-top",side2:"border-left",side3:"border-bottom"},{elem:r[r.length-1],side1:"border-bottom",side2:"border-right",side3:"border-top"}];for(var c=1;c<r.length-1;c++){var u={};u.elem=r[c],u.side1="border-top",u.side2="border-bottom",o.push(u)}}else o=[{elem:r[0],side1:"border-top",side2:"border-left"},{elem:r[r.length-1],side1:"border-top",side2:"border-right"},{elem:s[0],side1:"border-bottom",side2:"border-left"},{elem:s[s.length-1],side1:"border-bottom",side2:"border-right"}];if(r.length>1&&a.length>1){if(e&&e[ATTR_BORDERS.BORDER_TOP]){var p=r.length;for(c=1;c<p-1;c++){var g=r[c].attr();g[ATTR_COMMON.BORDERS]?(g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]?g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][n.key]=n.value:g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]=e[ATTR_BORDERS.BORDER_TOP],r[c].attr({borders:g[ATTR_COMMON.BORDERS]}),i&&l(r[c],{"border-top":g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]})):(r[c].attr({borders:{"border-top":e[ATTR_BORDERS.BORDER_TOP]}}),i&&l(r[c],{"border-top":e[ATTR_BORDERS.BORDER_TOP]}))}}if(e&&e[ATTR_BORDERS.BORDER_RIGHT]){var p=d.length;for(c=1;c<p-1;c++){var g=d[c].attr();g[ATTR_COMMON.BORDERS]?(g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]?g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT][n.key]=n.value:g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]=e[ATTR_BORDERS.BORDER_RIGHT],d[c].attr({borders:g[ATTR_COMMON.BORDERS]}),i&&l(d[c],{"border-right":g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]})):(d[c].attr({borders:{"border-right":e[ATTR_BORDERS.BORDER_RIGHT]}}),i&&l(d[c],{"border-right":e[ATTR_BORDERS.BORDER_RIGHT]}))}}if(e&&e[ATTR_BORDERS.BORDER_BOTTOM]){var p=s.length;for(c=1;c<p-1;c++){var g=s[c].attr();g[ATTR_COMMON.BORDERS]?(g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]?g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][n.key]=n.value:g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]=e[ATTR_BORDERS.BORDER_BOTTOM],s[c].attr({borders:g[ATTR_COMMON.BORDERS]}),i&&l(s[c],{"border-bottom":g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]})):(s[c].attr({borders:{"border-bottom":e[ATTR_BORDERS.BORDER_BOTTOM]}}),i&&l(s[c],{"border-bottom":e[ATTR_BORDERS.BORDER_BOTTOM]}))}}if(e&&e[ATTR_BORDERS.BORDER_LEFT]){var p=a.length;for(c=1;c<p-1;c++){var g=a[c].attr();g[ATTR_COMMON.BORDERS]?(g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]?g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT][n.key]=n.value:g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]=e[ATTR_BORDERS.BORDER_LEFT],a[c].attr({borders:g[ATTR_COMMON.BORDERS]}),i&&l(a[c],{"border-left":g[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]})):(a[c].attr({borders:{"border-left":e[ATTR_BORDERS.BORDER_LEFT]}}),i&&l(a[c],{"border-left":e[ATTR_BORDERS.BORDER_LEFT]}))}}}for(var c=0;c<=o.length-1;c++){var f={},E=o[c].elem.attr()[ATTR_COMMON.BORDERS]||{},T=i?BorderUtils.getSelectedSides("cell"):BorderUtils.getSelectedSides("tbl"),m=o[c].side1,h=o[c].side2,I=o[c].side3,_=o[c].side4;m&&T.indexOf(m)!=-1&&(E[m]?E[m][n.key]=n.value:E[m]=e[m],f[m]=E[m]),h&&T.indexOf(h)!=-1&&(E[h]?E[h][n.key]=n.value:E[h]=e[h],f[h]=E[h]),I&&T.indexOf(I)!=-1&&(E[I]?E[I][n.key]=n.value:E[I]=e[I],f[I]=E[I]),_&&T.indexOf(_)!=-1&&(E[_]?E[_][n.key]=n.value:E[_]=e[_],f[_]=E[_]),(E[m]||E[h]||E[I]||E[_])&&(o[c].elem.attr({borders:E}),i&&l(o[c].elem,f))}},m=function(e){var t=DomViewManager.getDOMnodeFromDTnode(e.dtNode);return t&&"rgba(0, 0, 0, 0)"!=getComputedStyle(t)["background-color"]?getComputedStyle(t)["background-color"]:null},h=function(e,t){Z(e.BDR_TOP).prop("checked")?J("#"+t+" .ui-sbdr-cont").addClass("ui-sbdr-top"):J("#"+t+" .ui-sbdr-cont").removeClass("ui-sbdr-top"),Z(e.BDR_LEFT).prop("checked")?J("#"+t+" .ui-sbdr-cont").addClass("ui-sbdr-left"):J("#"+t+" .ui-sbdr-cont").removeClass("ui-sbdr-left"),Z(e.BDR_RIGHT).prop("checked")?J("#"+t+" .ui-sbdr-cont").addClass("ui-sbdr-right"):J("#"+t+" .ui-sbdr-cont").removeClass("ui-sbdr-right"),Z(e.BDR_BOTTOM).prop("checked")?J("#"+t+" .ui-sbdr-cont").addClass("ui-sbdr-bottom"):J("#"+t+" .ui-sbdr-cont").removeClass("ui-sbdr-bottom"),Z(e.BDR_VR).prop("checked")?Z(e.BDR_HR).prop("checked")?(J("#"+t+" .ui-sbdr-cont").addClass("ui-icon-ball-in-sm"),J("#"+t+" .ui-sbdr-cont").removeClass("ui-icon-bin-hori-sm")):(J("#"+t+" .ui-sbdr-cont").addClass("ui-icon-bin-vert-sm"),J("#"+t+" .ui-sbdr-cont").removeClass("ui-icon-bnone")):(Z(e.BDR_INSIDE).prop("checked")&&(J("#"+t+" .ui-sbdr-cont").removeClass("ui-icon-ball-in-sm"),J("#"+t+" .ui-sbdr-cont").addClass("ui-icon-bin-hori-sm")),J("#"+t+" .ui-sbdr-cont").removeClass("ui-icon-bin-vert-sm")),Z(e.BDR_HR).prop("checked")?Z(e.BDR_VR).prop("checked")?(J("#"+t+" .ui-sbdr-cont").addClass("ui-icon-ball-in-sm"),J("#"+t+" .ui-sbdr-cont").removeClass("ui-icon-bin-vert-sm")):(J("#"+t+" .ui-sbdr-cont").addClass("ui-icon-bin-hori-sm"),J("#"+t+" .ui-sbdr-cont").removeClass("ui-icon-bnone")):(Z(e.BDR_INSIDE).prop("checked")&&(J("#"+t+" .ui-sbdr-cont").removeClass("ui-icon-ball-in-sm"),J("#"+t+" .ui-sbdr-cont").addClass("ui-icon-bin-vert-sm")),J("#"+t+" .ui-sbdr-cont").removeClass("ui-icon-bin-hori-sm"))},I=function(e,t){for(var i=TableUtil.getTableCells(e).allCells,n=0;n<i.length;n++){var o=i[n].attr();o.z_td_bgc&&i[n].attr({z_td_bgc:null})}},_=function(e){for(var t in e)if("0px"!=e[t].width)return!1;return!0},A=function(e,t){var i=!0;if(e==ATTR_BORDERS.BORDER_RADIUS){for(var n in t)if(i=0==parseFloat(t[n]),!i)return!1}else for(var n in t)if("type"!=n&&"color"!=n&&(i=0==parseFloat(t[n])),!i)return!1;return!0},S=function(e,t){var i=!0;0==parseFloat(e.width)&&0==parseFloat(t.width)&&(i=!1);for(var n in e)if(("type"!=n||i)&&(isValid=e[n]==t[n],!isValid))return!1;return!0},R=function(e,t){if("undefined"==typeof e&&_(t))return!0;if("undefined"==typeof t&&_(e))return!0;if(e&&t){var i=!0;for(var n in e)if(i=t[n]?S(e[n],t[n]):A(n,e[n]),!i)return!1;for(var n in t)if(i=e[n]?S(e[n],t[n]):A(n,t[n]),!i)return!1;return i}return!1},O=function(e,t){var i={"border-top":"top","border-left":"left","border-right":"right","border-bottom":"bottom"};e=DomViewManager.getDOMnodeFromDTnode(e.dtNode);for(var n={},o=0;o<t.length;o++){var r=t[o],a=J(e).css("border-"+i[r]+"-color"),s=J(e).css("border-"+i[r]+"-width"),l=J(e).css("border-"+i[r]+"-style");"none"==l&&(l="solid"),n[r]={},n[r][ATTR_BORDERS.WIDTH]=s,n[r][ATTR_BORDERS.TYPE]=l,n[r][ATTR_BORDERS.COLOR]=a}return n};return{getBorderSidesForCell:n,getSelectedCellsInfo:o,getBoundaryCellsOfSelection:r,getTdBdrDomStyle:a,applyBorderForMultipleCells:s,setBordersForSurroundingCells:l,resetBordersForSurroundingCells:d,getSorroundingCellsForTable:c,getSelectedSides:u,getBorderValuesForUpdateUI:p,convertZWColorToRGB:g,setInsideH_InsideV:f,getSorroundingCellsForSelection:E,applyOutSideBorders:T,getBackgroundColor:m,selectSide:h,applyBgcForCells:I,compareBorders:R,getBorderObj:O}}(),HRBorders=function(){"use strict";var e,t={},i={type:"solid",color:"rgb(0,0,0)",width:"1px"},n={HR_BORDER_COLOR:{get:function(e,i){var n=Utils.getColorValFromRefString(t.color);return u(n),n},set:function(e,t,i){var n={};return n.border={key:"color",val:t},u(Utils.getColorValFromRefString(t)),n}},HR_BORDER_WIDTH:{get:function(e,i){0==t.width?Z("hz-line-bdr-width-menu").zmenu("checkAllItems",!1):Z("hz-line-bdr-width-menu").zmenu("check","hz-line-bwidth-"+t.width)},set:function(e,t,i){var n={};return n.border={key:"width",val:$(t).attr("value")},n}},HR_BORDER_STYLE:{get:function(e,i){0==t.type?Z("hz-line-bdr-style-menu").zmenu("checkAllItems",!1):Z("hz-line-bdr-style-menu").zmenu("check","hz-line-bstyle-"+t.type)},set:function(e,t,i){var n={};return n.border={key:"type",val:t.getAttribute("value")},n}},HR_ALIGN:{get:function(e,i){return t.al},set:function(e,t,i){var n={};return n={key:"al",val:t}}}},o={beforeFillValues:function(){t={borders:null,width:"1px",type:"solid",color:null,al:null},t=r(t)},get:function(e,t){var i=n[e.action]&&n[e.action].get;if(i)return i(e,t)},set:function(e,i,o,r,s){arguments[5]&&arguments[5].keyCode==KEYS.TAB?EventHandler.isDialogFocused=!0:EventHandler.isDialogFocused=!1;var l=n[e.action].set,d=l&&l.apply(null,arguments);if(null!=d){for(var c in d)t[c]=d[c];a(d)}}},r=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.HR),i=t.attr(),n=i[ATTR_COMMON.BORDERS]||{"border-top":{color:"rgb(0,0,0)",width:"1px",type:"solid"}};return e.color=n["border-top"].color,e.type=n["border-top"].type,e.width=n["border-top"].width,e.al=i.al,e.borders=n,e},a=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.HR),i={};e.border?i.borders=s(e.border):i[e.key]=e.val,editor.doc.execCmd("applyStyle",[t,i,"applyHRStyle"])},s=function(e){var n=t.borders;if(n)n["border-top"][e.key]=e.val;else{var o=DocUtil.copyStyle(i);o[key]=val,n["border-top"]=o}return n},l=function(){var e=Z("horizandal-line-popup");e.data("ZCtrackObjects")?e.ZCtrackObjects("refreshValues"):e.ZCtrackObjects({callbacks:HRBorders.panelInfo,fillVisible:!1,eventNameMapping:{zspinner:"spinnerblur"}})},d=function(t){if(l(),t){e=t.getActualOffset();var i=e.y*editor.zoomFactor,n=e.x*editor.zoomFactor,o=document.getElementById("horizandal-line-popup");o.style.display="block";var r=o.offsetHeight,a=o.offsetWidth,s=t.getWidth();W.get("#horizandal-line-popup").css({top:i-r-10+"px",left:n+s/2-a/2+"px"})}},c=function(){W.get("#horizandal-line-popup").hide()},u=function(e,t){Z("hz-line-bdr-width-menu").find(".zmenu__icon").css({"border-top-color":e}),Z("hz-line-bdr-style-menu").find(".zmenu__icon").css({"border-top-color":e}),Z("hz-line-bdr-color").zcolorselectbox("setValue",e)},p=function(e){"hr"==e.getType()&&(f(),d(e))},g=function(){c(),E()},f=function(){PubSub.subscribe("TransformableObject/destroyed",g),PubSub.subscribe("TransformableObject/Resize/Active",d)},E=function(){PubSub.unsubscribe("TransformableObject/destroyed",g),PubSub.unsubscribe("TransformableObject/Resize/Active",d)};(function(){PubSub.subscribe("TransformableObject/Created",p)})();return{refreshValues:l,panelInfo:o,positionHROptions:d}}(),NotePanel=function(e){"use strict";var t={},i=!1,n={beforeFillValues:function(){t={TYPE:"",SID:"",START_NUM:1,NOTE_FORMAT:"num"},t=c(t)},get:function(e,t){var i=d[e.action].get;if(i)return i(e,t)},set:function(e,i,n){arguments[5]&&arguments[5].keyCode==KEYS.TAB?EventHandler.isDialogFocused=!0:EventHandler.isDialogFocused=!1;var o=d[e.action].set,r=o&&o(e,i,n);if(null!=r)for(var a in r)t[a]=r[a];l(r)}},o=function(){u(),"endnote"==t.TYPE?Z("note-lpnl-title")[0].innerText=J.i18n("writer.endnote.ENDNOTE_PROPERTIES"):"footnote"==t.TYPE&&(Z("note-lpnl-title")[0].innerText=J.i18n("writer.endnote.FOOTNOTE_PROPERTIES"))},r=function(){},a=function(){if(!LeftPanel.isPanelVisible(e.NOTEPANEL)){var t={panelId:e.NOTEPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[e.INSERTPANEL]};LeftPanel.showAdvancedPanel(t)}o()},s=function(){var t=LeftPanel.getCurrentPanel();t&&t.panelId===e.NOTEPANEL&&(LeftPanel.closeSubPanel(),r())},l=function(e){var t,i;for(t in e)i=p[t],i&&i(e[t])},d={START_NUM:{get:function(e,i){return t.START_NUM},set:function(e,t,i){return{START_NUM:t}}},NOTE_FORMAT:{get:function(e,i){"#note-lpnl-"+t.NOTE_FORMAT},set:function(e,t,i){return{NOTE_FORMAT:t.getAttribute("value")}}}},c=function(e){var t=editor.doc.getSelection(),i=DocTreeManager.doc.getSection(t.getStart()),n=i.getContainingSection(),o=i.getSectionType(),r=n.getNoteTypeInfo(o)||{};return e={TYPE:o,SID:i.getId(),START_NUM:r.stnum,NOTE_FORMAT:r.fmt}},u=function(){var t=Z(e.NOTEPANEL);i?LeftPanel.isPanelVisible(e.NOTEPANEL)&&t.ZCtrackObjects("refreshValues"):(i=!0,t.ZCtrackObjects({callbacks:n,fillVisible:!1,eventNameMapping:{zbutton:"zbuttonclick"}}))},p={START_NUM:function(e){editor.doc.execCmd("changenotestyle",[t.TYPE,{startNumber:e}])},NOTE_FORMAT:function(e){editor.doc.execCmd("changenotestyle",[t.TYPE,{format:e}])}},g=function(e){NOTE_SECTIONS.contains(e)&&LayoutManager.isRichEditActive()?a():s()};return PubSub.subscribe("Document/SectionChanged",g),{open:a,close:s}}(ELEM_ID),NoteUIHandler=function(){"use strict";var e=null,t=null,i=null,n=null,o=null,r=null,a=function(e){var t=DomViewManager.getDOMObj(e.getPage());if(t){var i=t.getContainerObj(e.getSectionType());return i.container}return null},s=function(){if(e){var t=e.getDTView(),i=t.getPreviousNoteView();i&&Note.moveToSection(i.getId())}},l=function(){if(e){var t=e.getDTView(),i=t.getNextNoteView();i&&Note.moveToSection(i.getId())}},d=function(){r=document.createElement("div"),r.className="ui-note-nav",t=document.createElement("span"),t.className="ui-wprev-icon ui-ms-pointer",t.onclick=s,i=document.createElement("span"),i.className="ui-wnext-icon ui-ms-pointer",i.onclick=l,n=document.createElement("span");var e=document.createElement("span");e.className="ui-left-margin-verysmall ui-right-margin-verysmall",e.innerText=J.i18n("writer.common.OF"),o=document.createElement("span"),r.appendChild(t),r.appendChild(n),r.appendChild(e),r.appendChild(o),r.appendChild(i),r.onclick=DomUtil.stopEvent,r.onmousedown=DomUtil.stopEvent,r.onmouseup=DomUtil.stopEvent},c=function(e){return"ui-note-highlight"},u=function(){r||d();var a=DocTreeViewManager.getNoteCount(e.getSectionType()),s=DocTreeViewManager.getNoteNumber(e.getDTView());n.innerText=s,o.innerText=a,1==s?t.className="ui-wprev-icon ui-zwdisabled":t.className="ui-wprev-icon ui-ms-pointer",s==a?i.className="ui-wnext-icon ui-zwdisabled":i.className="ui-wnext-icon ui-ms-pointer"},p=function(){if(e){u();var t=c(e),i=a(e);i&&(i.className=NOTE_CLASS[e.getSectionType()]+" "+t,i.appendChild(r))}},g=function(t){e&&e==t&&r.parentElement&&(r.parentElement.className=NOTE_CLASS[e.getSectionType()],r.parentElement.removeChild(r))},f=function(t){if(e&&(g(e),e=null),NOTE_SECTIONS.contains(t)){var i=editor.doc.getSelection(),n=DocLayoutManager.getViewAtIndex(i.getStart());e=n.getSection(),p()}},E=function(t){e==t?(g(e),e=null):p()};PubSub.subscribe(["noteview/added","noteview/attached"],p),PubSub.subscribe("noteview/removed",E),PubSub.subscribe("noteview/detached",g),PubSub.subscribe("Document/SectionChanged",f)}(),CONTENT_STATS_CONSTANTS={USER_STATS:"userStats",STATS_COLLECTED_FROM:"statsCollectedFrom",DOC_STATS:"docStats",PAGE_STATS:"pageStats",LINK_STATS:"linkStats",LAST_OPENED_TIME:"lastOpenedTime",LAST_CLOSED_TIME:"lastClosedTime",DOCUMENT_OPENS:"documentOpens",LAST_CURSOR_INDEX:"lastCursorIndex",LAST_LINK_VISITED:"lastLinkVisited",LAST_READ_PAGE:"lastReadPage",VISITS:"visits",LAST_ACCESSED_TIME:"lastAccessedTime",TIME_SPENT:"timeSpent",TIME_LEFT:"timeLeft",TIME_ENTERED:"timeEntered",LAST_PAGE_READ_TIME_START:"lastPageReadTimeStart",LAST_PAGE_READ_TIME_END:"lastPageReadTimeEnd",CURRENT_PAGE:"currentPage",RESET_TIME:"resetTime"},TextBoxHandler=function(){"use strict";var e=function(e){var t=editor.doc.getSection(NODE_TYPE.TEXTBOX,e);t.remove()},t=function(){var t=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);if(t){var i=t.attr().id;e(i),editor.doc.execCmd("delete",t),PubSub.publish("Document/ImageDeleted")}else{var n=editor.doc.getSelection().getStart(),o=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,n);if(null!=o){var r=o.getRangeIndex(),a=DocTreeManager.doc.getSection(r).getSectionType(),s=ZWJSONUtils.clone(editor.doc.getRawFormatAt(r));Op.processMsg(Op.getCursor(r,r)),Op.cursorProcessed();var l=[{r:r},{ds:editor.doc.getCharAt(r)}];e(s.id),Op.processMsg(l),Op.sendMsg(),PubSub.publish("Document/ImageDeleted"),PubSub.publish("Document/SectionChanged",a)}}},i=function(e){var t=DocTreeManager.getSectionWithSid(e),i=t.getRangeIndex(),n=editor.doc.getRawFormatAt(i),o=n.cls===NODE_TYPE.FILLABLEFIELD;return!o},n=function(){"undefined"!=typeof TextBoxPanel&&Z(ELEM_ID.TEXTBOXPANEL).children().length?TextBoxPanel.open():PubSub.publish("TextBox/ShowPanel",{forceOpen:!0})},o=function(){UIUtils.markVisitedFeature(11);var e=editor.doc.getSelection()[0].start;editor.doc.execCmd("textbox"),l(e);var t=editor.doc.getRawFormatAt(e);r(t.id)},r=function(e){var t=DocTreeManager.getSectionWithSid(e);TransformEventHandler.setContextInsideElement("textbox",e);var i=DocLayoutManager.getSectionViews(e)[0],n=DomViewManager.getDOMObj(i.getPage()),o=n.getActiveSectionElem(i);editor.clientActiveSection=o,editor.prevClientActiveSection=o;var r=DocTreeManager.doc.getSection(t.getRangeIndex()).getSectionType();PubSub.publish("Document/SectionChanged",r)},a=function(e){var t=e.getRangeIndex(),i=DocTreeManager.getTreeNodeAtIndex(t);return i.parent},s=function(e){var t=editor.doc.getRawFormatAt(e);return t&&t[ATTR_COMMON.SUBTYPE]==NODE_TYPE.TEXTBOX},l=function(e){var t=editor.doc.getRawFormatAt(e),i=t.id,n={idx:e};PubSub.publish("TextBox/Selected",i,n)},d=function(e,t){var i=DocLayoutManager.getSectionViews(e)[0],n=DomViewManager.getDOMObj(i,i.getPage().getId()),o=n.content,r=DomViewManager.getDOMObj(i),a=r.content;a.style.cursor=t,o.style.cursor=t},c=function(e,t,i){var n=DomViewManager.getViewData(e[0]).nodeId,o=DocTreeManager.getSectionWithSid(n).getRangeIndex(),r=editor.doc.getRawFormatAt(o).rotation||0,a=J(t),s=a.width()*editor.zoomFactor,l=a.height()*editor.zoomFactor,d=TransformationUtils.getTransformedSize(r,s,l),c=a.offset(),u={x:c.left+d.width/2,y:c.top+d.height/2},p=TransformationUtils.rotateElement(t,r,editor.zoomFactor,u),g=TransformationUtils.rotate(i,r,u);return g.x-p.x},u=function(e,t){var i=DomViewManager.getViewData(e).nodeId;e=e.children[0];var n=DocTreeManager.getSectionWithSid(i).getRangeIndex(),o=editor.doc.getRawFormatAt(n).rotation||0,r=J(e).width()*editor.zoomFactor,a=J(e).height()*editor.zoomFactor,s=TransformationUtils.getTransformedSize(o,r,a),l=J(e).offset(),d={x:l.left+s.width/2,y:l.top+s.height/2};return TransformationUtils.rotate(t,o,d)},p=function(e){var t=DomViewManager.getViewData(e).nodeId,i=DocTreeManager.getSectionWithSid(t).getRangeIndex();return editor.doc.getRawFormatAt(i).rotation||0},g=function(e,t){var i=(J(t),DomViewManager.getViewData(e).nodeId);e=e.children[0];var n=DocTreeManager.getSectionWithSid(i).getRangeIndex(),o=editor.doc.getRawFormatAt(n).rotation||0,r=J(e).width()*editor.zoomFactor,a=J(e).height()*editor.zoomFactor,s=TransformationUtils.getTransformedSize(o,r,a),l=J(e).offset(),d={x:l.left+s.width/2,y:l.top+s.height/2},c=TransformationUtils.rotateElement(t,o,editor.zoomFactor,d),u={left:c.x,top:c.y,width:c.width,height:c.height};return u},f=function(e){var t=0,i=e.sid,n=e.getRangeIndex(),o=editor.doc.getRawFormatAt(n),r=DocLayoutManager.getSectionViews(i)[0],a=DomViewManager.getDOMObj(r.getPage()),s=a.getRenderedDOM(r),l=o[ATTR_IMAGE.I_WID],d=o[ATTR_COMMON.BORDERS]?parseInt(o[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0,c=o[ATTR_IMAGE.I_HT],u=o[ATTR_IMAGE.I_ROTATE]||0,p=TransformationUtils.getTransformedSize(u,l,c),g=p.width,f=(g-l)/2;return f+=DTUtils.isWrappingFloatImage(o)&&o.hasOwnProperty(ATTR_IMAGE.I_ML)?o[ATTR_IMAGE.I_ML].convertor().pixels:0,t+=d+f+(J(s).offset().left-Z("editorpane").offset().left)/editor.zoomFactor},E=function(e){var t=0,i=e.sid,n=DocLayoutManager.getSectionViews(i)[0],o=DomViewManager.getDOMObj(n.getPage()),r=o.getRenderedDOM(n),a=J(r).parents(".zw-page"),s=e.getRangeIndex(),l=editor.doc.getRawFormatAt(s),d=l[ATTR_COMMON.BORDERS]?parseInt(l[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0,c=l[ATTR_IMAGE.I_HT],u=l[ATTR_IMAGE.I_WID],p=l[ATTR_IMAGE.I_ROTATE]||0,g=TransformationUtils.getTransformedSize(p,u,c),f=g.height,E=(f-c)/2;return E+=DTUtils.isWrappingFloatImage(l)&&l.hasOwnProperty(ATTR_IMAGE.I_MT)?l[ATTR_IMAGE.I_MT].convertor().pixels:0,t+=d+E+(J(r).offset().top-a.offset().top)/editor.zoomFactor},T=function(e,t){var i=(e.sid,e.getRangeIndex()),n=editor.doc.getRawFormatAt(i),o=n[ATTR_COMMON.BORDERS]?parseInt(n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0,r=0;return r+=n[ATTR_IMAGE.I_HT],t&&(r+=2*o),r},m=function(e,t){var i=(e.sid,e.getRangeIndex()),n=editor.doc.getRawFormatAt(i),o=n[ATTR_COMMON.BORDERS]?parseInt(n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0,r=0;return r+=n[ATTR_IMAGE.I_WID],t&&(r+=2*o),r},h=function(e,t){var i=DomViewManager.getDOMElem(t),n=DocLayoutManager.getSectionViews(e.id)[0],o=DomViewManager.getDOMObj(n.getPage()),r=o.getRenderedDOM(n),a=J(r).offset().left-J(i).offset().left;return a},I=function(e){var t=0;if(!e)return t;var i=e.getRangeIndex(),n=editor.doc.getRawFormatAt(i),o=n[ATTR_IMAGE.I_WID],r=n[ATTR_IMAGE.I_HT],a=n[ATTR_IMAGE.I_ROTATE]||0,s=TransformationUtils.getTransformedSize(a,o,r),l=n[ATTR_COMMON.BORDERS]?parseInt(n[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;if(t+=TableUtil.getAbsoluteCellLeft(i),t+=l,t+=(s.width-o)/2,t+=n.pl?n.pl.convertor().pixels:0,DTUtils.isFloatingImage(n)){var d=DocLayoutManager.getLineAtIndex(i).view;t+=DTUtils.isWrappingFloatImage(n)&&n.ml?n.ml.convertor().pixels:0,t+=h(n,d),t+=d.left||0}else{var c=DocLayoutManager.getLineAtIndex(i),u=c.getBlockAtIndex(i),p=u.getSubBlockAtIndex(i);t+=p.getDirectionalLeft(c),t+=c.left||0,t+=c.view.left||0}return t};return{removeTextBoxSection:e,removeTextBox:t,insertTextBox:o,isCursorAllowed:i,handleCursorInsideTextBox:r,getParent:a,getOffsetX:c,getPtBasedOnParent:u,getDataBasedOnParent:g,getTextBoxLeftPosition:f,getTextBoxTopPosition:E,getHeight:T,getWidth:m,getAbsoluteLeft:I,getRotation:p,isTextBoxAtIdx:s,selectTextBox:l,setCursorForTextBox:d,openPanel:n}}(),ContentStatsMeasure=function(){"use strict";var e,t="undefined"!=typeof navigator&&"undefined"!=typeof navigator.sendBeacon,i=!1,n=!1,o=function(e){0==Object.keys(s(e)).length?l(e,CONTENT_STATS_CONSTANTS.VISITS,1):l(e,CONTENT_STATS_CONSTANTS.VISITS,(s(e,CONTENT_STATS_CONSTANTS.VISITS)||0)+1),l(e,CONTENT_STATS_CONSTANTS.LAST_ACCESSED_TIME,Date.now()),a(CONTENT_STATS_CONSTANTS.LAST_LINK_VISITED,e)},r=function(e,t){if(!e)return null;var i=ContentStatsMeasure.stats[e];return i},a=function(e,t){e&&(ContentStatsMeasure.stats[e]=t)},s=function(e,t){if(e)return t?ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS][e][t]:(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS]&&ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS][e]||l(e),ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS][e])},l=function(e,t,i){e&&(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS]||(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS]={}),ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS][e]||(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS][e]={}),t&&void 0!=i&&(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS][e][t]=i))},d=function(e,t){if(e)return t?ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS][e][t]:(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS]&&ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS][e]||c(e),ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS][e])},c=function(e,t,i){e&&(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS]||(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS]={}),ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS][e]||(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS][e]={}),t&&void 0!=i&&(ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS][e][t]=i))},u=function(e,t){var i=d(e),n=Date.now();i&&0!==Object.keys(i).length?"close"===t?(c(e,CONTENT_STATS_CONSTANTS.TIME_LEFT,n),h(e,n)):"open"===t&&(c(e,CONTENT_STATS_CONSTANTS.TIME_ENTERED,n),c(e,CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_START,n),c(e,CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_END,0),c(e,CONTENT_STATS_CONSTANTS.VISITS,d(e,CONTENT_STATS_CONSTANTS.VISITS)+1)):(c(e,CONTENT_STATS_CONSTANTS.TIME_ENTERED,n),c(e,CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_START,n),c(e,CONTENT_STATS_CONSTANTS.TIME_LEFT,0),c(e,CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_END,0),c(e,CONTENT_STATS_CONSTANTS.VISITS,1),c(e,CONTENT_STATS_CONSTANTS.TIME_SPENT,0))},p=function(e){var t=e.getRelativePageNumber();if(editor.jeditorPane.height()+editor.editorOffset.top<=editor.editorPaneContainerHt+editor.editorPaneContainerOffset.top)i||(a(CONTENT_STATS_CONSTANTS.LAST_READ_PAGE,DocLayoutManager.getPageCount()),T(),i=!0);else{i=!1;var n=r(CONTENT_STATS_CONSTANTS.LAST_READ_PAGE);t!=n&&(a(CONTENT_STATS_CONSTANTS.LAST_READ_PAGE,t),T())}},g=function(t){e&&clearTimeout(e),e=setTimeout(p.bind(null,t),500)},f=function(){var e={},t={};t[CONTENT_STATS_CONSTANTS.LAST_OPENED_TIME]=ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LAST_OPENED_TIME],t[CONTENT_STATS_CONSTANTS.LAST_CLOSED_TIME]=ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LAST_CLOSED_TIME],t[CONTENT_STATS_CONSTANTS.LAST_READ_PAGE]=ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LAST_READ_PAGE],t[CONTENT_STATS_CONSTANTS.DOCUMENT_OPENS]=ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.DOCUMENT_OPENS],t[CONTENT_STATS_CONSTANTS.LAST_LINK_VISITED]=ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LAST_LINK_VISITED]||null,t[CONTENT_STATS_CONSTANTS.LAST_CURSOR_INDEX]=ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LAST_CURSOR_INDEX],e[CONTENT_STATS_CONSTANTS.DOC_STATS]=t,e[CONTENT_STATS_CONSTANTS.LINK_STATS]=ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS]||{},e[CONTENT_STATS_CONSTANTS.PAGE_STATS]=ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS];var i=e[CONTENT_STATS_CONSTANTS.PAGE_STATS];return E(i),e},E=function(e){for(var t in e){var i=e[t];delete i[CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_START],delete i[CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_END]}},T=function(e){m(e),A()},m=function(e){var t=Date.now();e&&(a(CONTENT_STATS_CONSTANTS.LAST_CLOSED_TIME,t),a(CONTENT_STATS_CONSTANTS.LAST_READ_PAGE,editor.currentPageIndex+1)),u(r(CONTENT_STATS_CONSTANTS.CURRENT_PAGE),"close"),a(CONTENT_STATS_CONSTANTS.LAST_CURSOR_INDEX,editor.doc.getSelection().getStart())},h=function(e,t){c(e,CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_END,t);var i=d(e,CONTENT_STATS_CONSTANTS.TIME_SPENT)+d(e,CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_END)-d(e,CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_START);c(e,CONTENT_STATS_CONSTANTS.TIME_SPENT,i)},I=function(e){DomUtil.stopEvent(e),MsgDialog.showMessage([J.i18n("writer.common.RESET_INSIGHTS"),J.i18n("writer.common.CANCEL")],CONST.SEVERITY_WARNING,J.i18n("writer.common.RESET_STATS_ALERT_TITLE"),J.i18n("writer.common.RESET_STATS_ALERT_MESSAGE"),null,function(e){e==CONST.BUTTON_YES_CLICKED&&_()})},_=function(){var e,i={};i[CONTENT_STATS_CONSTANTS.RESET_TIME]=Date.now();var n=ZWNetworkUtils.getUrl("resetreaderstats");if(t){var o=new FormData;ZWNetworkUtils.setCsrfParam(i);for(key in i)o.append(key,i[key]);if(e=navigator.sendBeacon(n,o)){S(editor.currentPageIndex+1);var r=Date.now();a(CONTENT_STATS_CONSTANTS.LAST_OPENED_TIME,r),ContentStatsHandler.onReset()}}else J.ajax({type:"POST",url:n,data:i,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){S(editor.currentPageIndex+1);var t=Date.now();a(CONTENT_STATS_CONSTANTS.LAST_OPENED_TIME,t),ContentStatsHandler.onReset()},error:function(e,t,i){}})},A=function(){var e,i={},n=ZWNetworkUtils.getUrl("stats"),o=Object.keys(r(CONTENT_STATS_CONSTANTS.PAGE_STATS));if(i.stats=JSON.stringify(f()),t){var a=new FormData;ZWNetworkUtils.setCsrfParam(i);for(key in i)a.append(key,i[key]);e=navigator.sendBeacon(n,a),e&&S(r(CONTENT_STATS_CONSTANTS.LAST_READ_PAGE),o)}else J.ajax({type:"POST",url:ZWNetworkUtils.getUrl("stats"),data:i,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){S(r(CONTENT_STATS_CONSTANTS.LAST_READ_PAGE),o)},error:function(e,t,i){}})},S=function(e,t){if(t){for(var i=0;i<t.length;i++)delete ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.PAGE_STATS][t[i]];ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LINK_STATS]={},ContentStatsMeasure.stats[CONTENT_STATS_CONSTANTS.LAST_LINK_VISITED]=null}else ContentStatsMeasure.stats={};Date.now();a(CONTENT_STATS_CONSTANTS.DOCUMENT_OPENS,1),a(CONTENT_STATS_CONSTANTS.CURRENT_PAGE,e),a(CONTENT_STATS_CONSTANTS.LAST_READ_PAGE,e),u(e)};return PubSub.subscribe(["Document/ComponentInitialized","Document/MarkedReady","HandleResourceShare/Done","Document/FinalStateUpdated"],function(){var e=editorProps.permissionsInfo.appInfo.NAME,t=!1;"teamdrive"===e&&(t=!0);var i="true"==String(editor.doc.docInfo.ISSHARED),s=i&&!t||t&&i&&"ready"==editorProps.teamdrive.state||editor.doc.docInfo.FINAL_INFO&&1==editor.doc.docInfo.FINAL_INFO.STATUS;if(s&&!n){n=!0,J(window).focus(function(){var e=Date.now();c(r(CONTENT_STATS_CONSTANTS.CURRENT_PAGE),CONTENT_STATS_CONSTANTS.LAST_PAGE_READ_TIME_START,e)}),J(window).blur(function(){var e=Date.now();h(r(CONTENT_STATS_CONSTANTS.CURRENT_PAGE),e)}),S(editor.currentPageIndex+1);var l=Date.now();a(CONTENT_STATS_CONSTANTS.LAST_OPENED_TIME,l),PubSub.subscribe("Document/ViewportChanged",g),PubSub.subscribe("Window/Unload",function(){T(!0)}),PubSub.subscribe("Link/Clicked",function(e){o(e.attr("id"))})}}),{resetMessageShow:I}}();!function(e,t){"use strict";var i,n,o=!1,r={},a="zsigndialog",s=!1,l=!1,d=!1,c={},u=USER_ROLE.PUBLIC===editorProps.userInfo.role&&editorProps.isPublishToFill||"ANYONELINK_SHAREDREADWRITE"===editorProps.userInfo.role||"function"==typeof editor.getView&&7===editor.getView()||"gdrive"===Macros.getAppType();r.signerDetails={},r.signature_src="",r.initial_src="";var p=function(e){i=e;var t;new XMLHttpRequest,editor.doc.docInfo.RID;if(/company|job_title|date_format|first_name|last_name/.test(e))if(r&&r.signerDetails&&r.signerDetails[e]){if("date_format"===e){var n=(new Date).getTime();t=new ZWDateTime(n).format(r.signerDetails[e].toUpperCase())}else t=r.signerDetails[e];UIUtils.insertZohoESign(e,t),ZWLogger.addToStatistics("MySignature: Information field inserted.")}else UIUtils.showMessage("error",J.i18n("writer.common.SIGN_CONFIGURE_ERROR",[editorProps.deployment.zohosign]),"showclose","normalfont",3e3);else{if(r[e+"_src"]){t="data:image/png;base64,"+r[e+"_src"],t=HTMLUtil.storeImageInFileStore(t);var o=esignpanel.getSignImgProps(e);return UIUtils.insertZohoESign(e,t,o),void ZWLogger.addToStatistics("MySignature: Signature field inserted.")}UIUtils.showMessage("error",J.i18n("writer.common.SIGN_CONFIGURE_ERROR",[editorProps.deployment.zohosign]),"showclose","normalfont",3e3)}},g=function(e){SignHandler.getProfileDetails(SignHandler.SIGN_SERVICE.ZOHOSIGN,ZSignController.handleSuccess.bind(null,e),ZSignController.handleFailure.bind(null,e))},f=function(e){if(UIUtils.hideLoadingMsg(),UIUtils.showMessage("error",J.i18n("writer.common.SIGN_FETCH_ERROR",[editorProps.deployment.zohosign]),"showclose","normalfont",3e3),e)e.callBack&&(e.signDetails=r,e.failure=!0,e.callBack(e));else{v(n.saveCallback.bind(null,n.zohoSignType,n.callBack,n.isTemporary),null,!1,!!n.isInsert)}},E=function(e,t){if(Object.keys(t).length){o=!1;var i={};i.first_name=t.first_name,i.last_name=t.last_name,i.job_title=t.job_title,i.company=t.company,i.date_format=t.date_format,r.signerDetails=i,r.zohoSignSrc="data:image/png;base64,"+t.signature,r.zohoInitialSrc="data:image/png;base64,"+t.initial,l?(L(n.zohoSignType,n.callBack,!!n.isInsert),l=!1):s&&(m(),s=!1),e&&e.callBack&&(e.signDetails=r,e.callBack(e))}else T(),l=!0},T=function(){o=A(),!o&&SignHandler.handleLogin(S()),UIUtils.hideLoadingMsg(),o=!0};PubSub.subscribe(["Esign/ZohoSign/Account/Added","Esign/ZohoSign/Profile/Updated"],function(e){J("#zsign-insert-btn").enable(),r={},r.signerDetails={},r.zohoSignSrc="",r.zohoInitialSrc="",g(),A()&&I(),s=!0});var n,m=function(){ZSign.updateService("Zoho_Sign",{name:J.i18n("writer.esign.ZOHOSIGN"),id:"Zoho_Sign",isAuthenticated:!0,signatureURL:r.zohoSignSrc,initialURL:r.zohoInitialSrc,editAction:function(){ZSignController.openSignCreateDlg()}})},h=function(){p(i)},I=function(){J.dialogutil.close(a),o=!1},_=function(e,t){r.signature_src?(editor.getDocument().visitAllFields(NODE_TYPE.SIGNER_FIELD,function(i){i.id==e.id&&(/signature|initial/.test(t)?i.setValue(r[t+"_src"]):i.setValue(r.signerDetails[t]))}),d=!1):(d=!0,c.field=e,c.signType=t,g())},A=function(){return J.dialogutil.isDialogOpened(a)},S=function(){return SignHandler.SIGN_SERVICE.ZOHOSIGN||1},R=function(e){return r.zohoSignSrc||r.zohoInitialSrc||g(e),r},O=[{label:"Mr De Haviland",name:"Mr De Haviland"},{label:"Qwigley",name:"Qwigley"},{label:"Sacramento",name:"Sacramento"},{label:"Dancing Script",name:"Dancing Script"},{label:"Montez",name:"Montez"}],b=function(t){editor.addFonts(["Mr De Haviland","Qwigley","Sacramento","Dancing Script","Montez"],e,t)},v=function(){var t,i=!0,n=function(){i=!0,PubSub.unsubscribe("DOM/ESCKeyPressed")},o=function(e,t){var i={};e&&(e.signature||e.initial||e.signatureURL||e.initialURL)?i=e:i.imageSrc=J("#zsign__container").find(".zsign__textRightSection").text(),t(i)},a=function(e,i){setTimeout(function(){J("#zsign__container").css("z-index",1e4),J(".zsign__overlay").css("z-index",9999),J(".zsign__drawsignaturecanvas").css("width","100%"),J(".zsign__drawinitialcanvas").css("width","100%")},1e3),ZComponents.draggable=$.zdraggable;var a={typeSignTab:!0,actionButtonLabel:t?p.INSERT:p.SAVE,signatureText:d||p.SIGNATURE,initialText:g||p.INITIALS,textSize:40,signatureTextSize:50,initialTextSize:50,fontsList:O,done:function(t){o&&o.call(null,t,e),n()},close:function(){i&&i(),n()}};u||Macros.isRemote()||"ANYONEWITHLINK"===editor.getEditorType()||(a.services=[{name:J.i18n("writer.esign.ZOHOSIGN"),id:"Zoho_Sign",isAuthenticated:!0,signatureURL:r.zohoSignSrc,initialURL:r.zohoInitialSrc,editAction:function(){n(),ZSignController.openSignCreateDlg()}}]),ZSign.init(a),UIUtils.hideLoadingMsg(),PubSub.subscribe("DOM/ESCKeyPressed",n)},s=function(t,i){var n=jsCdnZWStaticPath+fingerPrintObj["js/fcomponents_fontlibrary_editor.js"];zw.require({js:[n]},[],function(){a(t,i)},function(){},e)},l=!0,d=editorProps.userInfo.firstName,c=editorProps.userInfo.fullName?editorProps.userInfo.fullName.split(" ")[1]:"",p={SIGNATURE:J.i18n("writer.digisign.YOUR_SIGNATURE"),INITIALS:J.i18n("writer.digisign.YOUR_INITIAL"),SAVE:J.i18n("writer.common.SAVE"),INSERT:J.i18n("writer.common.INSERT")},g=(d?d[0]:"")+(c?c[0]:"");return function(e,n,o,r){i&&(l=!!o,t=!!r,i=!1,b(s.bind(null,e,n)))}}(),D=function(){var e=function(e,t){t=HTMLUtil.storeImageInFileStore(t);var i=editor.getDocument(),n=i.createNode(NODE_TYPE.IMAGE),o=event.currentTarget,r={};r.height=o.naturalHeight,r.width=o.naturalWidth,n.style.src=t,n.style.originalHeight=r.height,n.style.originalWidth=r.width,n.style.height=r.height,n.style.width=r.width,n.style.subType=e,n.style.id=Utils.getRandomNumber(),i.getSelection().getRangeAt(0).insertNode(n),i.sync(),ZWLogger.addToStatistics("MySignature: Signature field inserted.")};return function(t){var i=r[t+"_src"];if(!i)return void L.call(null,t,D.bind(null,t),!0);var n=new Image;n.onload=e.bind(null,t,i),n.src=i,EditorUtil.focusMultiByteSpan()}}(),L=function(){var e=function(e){e&&e.saveStatus?UIUtils.hideLoadingMsg():e&&(e.isVirusInSignContent||e.isVirusInInitialContent)&&UIUtils.showMessage("error",J.i18n("writer.common.SIGN_VIRUS_STATUS_MSG"),"showclose","normalfont",3e3)},t=function(t,i,n,o){var a=o[t]||o[t+"URL"],s={},l=UIUtils.dataURItoBlob(a);(o.signature||o.signatureURL)&&(r.signature_src=o.signature||o.signatureURL,s.signatureByte=o.signature||o.signatureURL),(o.initial||o.initialURL)&&(r.initial_src=o.initial||o.initialURL,s.initialByte=o.initial||o.initialURL),s.type=t,!n&&N("save",s,e,null,l.type),i&&i(o)};return function(e,i,o,a){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),u||"ANYONEWITHLINK"===editor.getEditorType()||Macros.isRemote()||r.zohoSignSrc&&r.zohoInitialSrc?(v(t.bind(null,e,i,a),null,!1,!!o),EditorUtil.focusMultiByteSpan()):(g(),n={callBack:i,zohoSignType:e,isInsert:o,saveCallback:t,isTemporary:a},l=!0)}}(),N=function(){var e=function(e){switch(e){case"get":return"GET";case"save":return"POST";case"delete":return"DELETE"}},t=function(e){var t=ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/util/esign");return t};return function(i,n,o,r,a){var s={type:e(i),data:n,async:!0,global:!1,url:t(i),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(e){r&&r(e)},success:function(e){o&&o(e)}};J.ajax(s)}}(),P=function(){var e=function(e){if(e){var t=e.signImages;r.signature_src=t.signature,r.initial_src=t.initial}};return function(){N("get",{},e)}}(),C=function(){var e=function(e,i){i&&i.deleteStatus?r[e+"_src"]="":t(e)},t=function(e,t){UIUtils.hideLoadingMsg(),UIUtils.showMessage("error","There was an error in deleting the {0} image. Please try again later.".replace("{0}",e),"showclose","normalfont",3e3)};return function(i){var n={};n["delete_"+i]=!0,N("delete",n,e.bind(null,i),t.bind(null,i))}}();e.ZSignController={openSignCreateDlg:T,closeZohoSignDialog:I,insertSignFromDialog:h,insertSign:p,getSignDetails:R,handleFailure:f,handleSuccess:E,updateSign:_,initSignComponent:v,insertSignFromPanel:D,editSignFromPanel:L,fetchSignImages:P,deleteSignImage:C}}(window,Handlebars),function(){"use strict";var e,t,i,n,o,r,a,s,l,d,c,u,p,g,f,E,T,m,h,I,_,A,S,R,O,b,v,D,L,N,P,C,y,F,M,w,x,B,H,G={},k={ONLY_OTHERS:1,ONLY_ME:2,ME_AND_OTHERS:3},W="signdlg",Y=[{code:"zh",nativeName:"中文",name:"Chinese"},{code:"nl",nativeName:"Nederlands",name:"Dutch"},{code:"en",nativeName:"English",name:"English"},{code:"fr",nativeName:"Français",name:"French"},{code:"de",nativeName:"Deutsch",name:"German"},{code:"it",nativeName:"italiano",name:"Italian"},{code:"ja",nativeName:"日本語",name:"Japanese"},{code:"pl",nativeName:"polski",name:"Polish"},{code:"pt",nativeName:"Português",name:"Portuguese"},{code:"ru",nativeName:"русский язык",name:"Russian"},{code:"es",nativeName:"español",name:"Spanish"},{code:"sv",nativeName:"svenska",name:"Swedish"}],z={DIALOG:"#signdlg",SIGN_TYPE:"#signdlg-type",SIGNER_LIST:"#sign-signer-list",ADD_SIGNER:"#signdlg-addsigner",SIGN_SEQUENTIALLY:"#signdlg-signinorder",SIGN_SEQUENTIALLY_CONT:"#signdlg-signorder-cont",ATTACHNAME:"#signdlg-attachname",SUBJECT:"#signdlg-subject",MESSAGE:"#signdlg-message",COMPLETE_TIME_OPT:"#signdlg-timetocomplete-opt",COMPLETE_TIME:"#signdlg-timetocomplete",REMAINDER_OPT:"#signdlg-reminder-opt",REMAINDER:"#signdlg-reminder",AFTERSIGN_STORE:"#signdlg-aftersign-store",AFTERSIGN_EMAIL:"#signdlg-aftersign-email",AFTERSIGN_TOADDRESS:"#signdlg-aftersign-toaddress",CCBCC_BTN:"#signdlg-ccbcc-btn",CCBCC_CONT:"#signdlg-ccbcc-cont",CC:"#signdlg-cc",BCC:"#signdlg-bcc",STATUS_CONT:"#sign-status-cont",STATUS_MSG:"#sign-status-msg",SUBMIT:"#signdlg-submitbtn",CANCEL:"#signdlg-cancelbtn",DRE_BTN:"#signdlg-dre-dialog-btn",SIGNER_SETTINGS_MENU:"#signersettingsmenu"},V={CONTAINER:"#signdlg-customfunc-container",CHECKBOX:"#signdlg-aftersign-customfunc",NAME:"#signdlg-custom-func-name",BTN:"#signdlg-dre-dialog-btn"},j={SIGNER_CONT:".js-sign-signer-cont",SIGNER_ERROR_CONT:".ui-validation-error-message",REMOVE_SIGNER:".js-sign-remove-signer",SIGN_TOKENFIELD:".js-sign-emailfield",HOST_TOKENFIELD:".js-signer-host-emailfield",FIELD_CHOOSE:".js-mm-field-choose",SIGNER_NO:".js-signer-no",HELP_LINK:".js-dlg-helplink",SIGNER_ACTION_SELECT:".signer-action-select",SIGNER_LANGUAGE:".signer-language",SIGNER_NAME:".js-signer-namefield",HOST_EMAIL:".js-signer-host-emailfield",HOST_NAME:".js-signer-host-namefield",SIGNER_EMAIL_ERROR:".js-signer-email-error",SIGNER_NAME_ERROR:".js-signer-name-error",INPERSON_EMAIL_ERROR:".js-inperson-email-error",INPERSON_NAME_ERROR:".js-inperson-name-error"},X={sign:"writer.sign.IN_PERSON_SIGNER_EMAIL",view:"writer.sign.VIEWERS_EMAIL",approve:"writer.sign.APPROVERS_EMAIL",in_person_sign:"writer.sign.IN_PERSON_SIGNER_EMAIL"},K={sign:"writer.sign.SIGNER_NAME",view:"writer.sign.VIEWER_NAME",approve:"writer.sign.APPROVER_NAME",in_person_sign:"writer.sign.SIGNER_NAME"},q={approver:J.i18n("writer.digisign.APPROVER_HELP_TXT"),in_person_sign:J.i18n("writer.digisign.INPERSON_HELP_TXT")},Q=function(t){e=t||{},e.isDigisign||e.isFillSubmit||e.isMergeOperation?Utils.loadRTE(!0,$):DialogHandler.open(W,Re)},$=function(){DialogHandler.open(W,Re)},ee=function(){t=ZWJSONUtils.clone(e.defaultValues||{}),e.blockDefaultSettings=!!t.expiration_days,n=J(z.DIALOG),a=n.find(z.SIGN_TYPE),s=n.find(z.SIGNER_LIST),l=n.find(z.ADD_SIGNER),d=n.find(z.SIGN_SEQUENTIALLY),c=n.find(z.SIGN_SEQUENTIALLY_CONT),u=n.find(z.ATTACHNAME),p=n.find(z.SUBJECT),g=n.find(z.MESSAGE),f=n.find(z.COMPLETE_TIME_OPT),E=n.find(z.COMPLETE_TIME),T=n.find(z.REMAINDER_OPT),m=n.find(z.REMAINDER),h=n.find(z.AFTERSIGN_STORE),I=n.find(z.AFTERSIGN_EMAIL),_=n.find(z.AFTERSIGN_TOADDRESS),A=n.find(z.CCBCC_BTN),S=n.find(z.CCBCC_CONT),b=n.find(z.CC),v=n.find(z.BCC),R=n.find(z.STATUS_CONT),O=R.find(z.STATUS_MSG),o=J(z.SUBMIT),r=J(z.CANCEL),N=J("#signdlg-resetbtn"),D=n.find("#signdlg-savevalues-cont"),L=D.find("#signdlg-savevalues"),P=n.find("#signdlg-custom-func-name"),C=n.find("#signdlg-aftersign-customfunc"),y=n.find(z.DRE_BTN),F=n.find(z.SIGNER_SETTINGS_MENU),M=1,w={}},te=function(){if(e.needFieldsList&&!e.isFillSubmit?(n.find("#other-attach-single").hide(),J("#"+W+"zdialog").find(j.HELP_LINK).attr("href",editorProps.urls.kbPageURL+"/user-guide/working-with-merge-templates/articles/configure-output-options#Merge_and_send_for_sign_collection")):(n.find("#other-attach-list").hide(),J("#"+W+"zdialog").find(j.HELP_LINK).attr("href",editorProps.urls.helpPageURL+"document-sign-automation.html#Setup_Sign_Workflow")),e.needFieldsList?n.find(j.FIELD_CHOOSE).show():n.find(j.FIELD_CHOOSE).hide(),e.saveOnly&&D.hide(),e.reset?N.off("click").on("click",function(){Le(),e.reset(MAILMERGE.ACTION.SIGN)}):N.hide(),e.isDigisign?L[0].nextElementSibling.innerText=J.i18n("writer.digisign.REMEMBER_SETTINGS_FOR_WORKFLOWS"):L[0].nextElementSibling.innerText=J.i18n("writer.mailmerge.REMEMBER_SETTINGS_FOR_MERGES"),e.isDigisign||e.showDREFunction?n.find("#signdlg-customfunc-container").show():n.find("#signdlg-customfunc-container").hide(),e.isFillSubmit?(n.find("#signdlg-after-signing").hide(),J("#"+W+"zdialog").find(j.HELP_LINK).hide(),n.find(j.FIELD_CHOOSE).hide(),n.find(".fillable-list-icon").css("display","")):n.find(".fillable-list-icon").hide(),e.isDigisign||e.isMergeOperation?(n.find("#signdlg-aftersign-email-cont").addClass("ui-flex-container ui-zw-nw-tag-hover ui-pos-rel"),n.find("#signdlg-aftersign-email-configure").removeClass("ui-hide"),n.find("#sign-emailopt-cont").addClass("ui-hide")):(n.find("#signdlg-aftersign-email-cont").removeClass("ui-flex-container ui-zw-nw-tag-hover ui-pos-rel"),n.find("#signdlg-aftersign-email-configure").addClass("ui-hide"),n.find("#sign-emailopt-cont").removeClass("ui-hide")),e.isFillSubmit){var t=MailMergeDataModel.isDataAvailable(),i=FieldPreFillHandler.getMergeMenuData(),o=FieldPreFillHandler.getFillMenuData();n.find(".js-mm-field-choose").each(function(e,n){var r=J(n),a=JSON.parse(r.attr("mm-zmenu-data"));r.attr("data-menu-id",t?"mm-fieldmenu":"ff-field-menu");var s=ZWJSONUtils.clone(t?i:o);s.target=a.target,s.fieldTypes=a.fieldTypes,s.listFillDocumentInfo=a.listFillDocumentInfo,r.attr("mm-zmenu-data",JSON.stringify(s))})}},ie=function(){e.title&&J("#"+W+"zdialog").zdialog("setAttributes",{title:e.title})},ne=function(){e.btns&&e.btns.length&&o.zbutton("setAttribute","text",e.btns[0]),r.zbutton("setAttribute","text",J.i18n("writer.common.CANCEL"))},oe=function(){var t=n.zvalidation("validateAllFields",n);if(!t)return!1;var i=s.children().eq(0);if(d.prop("checked")&&"view"===i.find(j.SIGNER_ACTION_SELECT).val())return ke(J.i18n("writer.sign.SEND_IN_ORDER_ERROR")),!1;var o=Ce();if(0==o.length)return ke(J.i18n("writer.sign.ENTER_EMAIL_ADDRESS")),!1;if(e.isFillSubmit&&o.contains("")&&(o=o.filter(function(e){return""!=e})),!MailMergeUtil.isProperEmails(o))return ke(J.i18n("writer.sign.EMAIL_INVALID")),!1;if(!Fe())return!1;var r=Me(),a=r.duplicateSignerIdx,l=r.lastDuplicateSignerIdx;if(a.length>0&&l.length>0){for(var c=0;c<a.length;c++){var p=s.children().eq(a[c]);p.find(".js-signer-namefield").addClass("ui-validation-error")}for(var g=0;g<l.length;g++){var p=s.children().eq(l[g]),f=p.find(j.SIGNER_NAME_ERROR);f.text(J.i18n("writer.sign.DUPLICATE_SIGNERS_FOUND")).show()}return!1}if(I.prop("checked")&&!e.isDigisign&&!e.isMergeOperation){var o=MailMergeUtil.getEmailsFromTokenField(_);if(0==o.length)return J("#signdlg-details-tab").ztabpanel("openTab","#signdlg-settings-btn"),ke(J.i18n("writer.sign.EMAIL_EMPTY")),!1;if(!MailMergeUtil.isProperEmails(o))return ke(J.i18n("writer.sign.EMAIL_INVALID")),!1}return!!u.val()||(J("#signdlg-details-tab").ztabpanel("openTab","#signdlg-details-btn"),ke(J.i18n("writer.sign.DOCUMENT_NAME_NOT_PRESENT")),u.focus(),!1)},re=function(){var t=function(){if(oe()){if(e.isFillSubmit&&editorProps.isPublishToFill)return void(e.callback?e.callback():Le());var t=SignHandler.SIGN_SERVICE.ZOHOSIGN,i=SignHandler.fetchAccountDetails(t);i.done(function(i){i&&i.linked?e.callback?e.callback():Le():SignHandler.handleLogin(t)})}};o.off("click").on("click",t),e.cancel_callback&&r.on("click",e.cancel_callback),A.off("click").on("click",function(){S.toggle()}),s.sortable({update:function(){ge(),ae()}}),s.disableSelection()},ae=function(){J(".js-sign-signer-cont").each(function(e){this.style.setProperty("--signerclr","var(--signerclr"+(e+1)+")")})},se=function(){MailMergeUiUtils.setDataSourceToTokenField(_),MailMergeUiUtils.setDataSourceToTokenField(b),MailMergeUiUtils.setDataSourceToTokenField(v)},le=function(){!editorProps.isPublishToFill&&Utils.initFolderChooser({container_id:"sign-folder-choose",calbackFn:ve,folderId:G.folderId,isWorkDrive:"workdrive"==G.service})},de=function(t){if(!(s.children().length>=10)){var i=Z("sign-signer-emailfield").html(),o=Handlebars.compile(i),r={},a=Utils.randomString(),d=a+"-fieldmenu";r.id=a,r.fid=d,r.no=t||J(".js-sign-signer-cont").length+1,r.showApprover=!0,r.showInPerson=!0;var u=SignHandler.getAccountDetails(SignHandler.SIGN_SERVICE.ZOHOSIGN);u&&u.available_features&&!u.available_features.in_person_signing&&(r.showInPerson=!1),u&&u.available_features&&!u.available_features.approver_role&&(r.showApprover=!1);var p=J(o(r));s.append(p[0]),ZWComponentUtil.initElem(p);var g=p.find(j.SIGN_TOKENFIELD),f=p.find(j.HOST_TOKENFIELD);return MailMergeUiUtils.setDataSourceToTokenField(g),MailMergeUiUtils.setDataSourceToTokenField(f),e.needFieldsList||(p.find(j.FIELD_CHOOSE).remove(),p.find(".js-signer-name-cont").addClass("ui-no-field-icon"),p.find(".js-signer-email-cont").addClass("ui-no-field-icon"),p.find(".js-signer-host-cont").addClass("ui-no-field-icon"),p.find(".js-signer-host-name-cont").addClass("ui-no-field-icon")),e.isFillSubmit?(n.find(j.FIELD_CHOOSE).hide(),n.find(".fillable-list-icon").css("display","")):e.isFillSubmit||n.find(".fillable-list-icon").hide(),s.children().length>=10?l.hide():s.children().length>1&&c.show(),ce(p.find(j.SIGNER_LANGUAGE)),J(p.find(j.SIGNER_LANGUAGE)[1]).ztooltip({displayType:"callout",pauseOnHover:!0,position:"top",isMessageHTMLEncoded:!0,innerHTML:'<div style="max-width: 175px;">'+J.i18n("writer.common.SIGNER_LANGUAGE_TOOLTIP")+"</div>"}),J(p.find(j.SIGNER_LANGUAGE)[3]).ztooltip({displayType:"callout",pauseOnHover:!0,position:"top",isMessageHTMLEncoded:!0,innerHTML:'<div style="max-width: 175px;">'+J.i18n("writer.common.SIGNER_LANGUAGE_TOOLTIP")+"</div>"}),ge(),p}},ce=function(e){var t=[];U.each(Y,function(e){var i=e.code.toUpperCase(),n={value:e.code,label:i,contentType:"custom",replaceWithText:!0,innerHTML:'<div class="zmenu__text">'+e.nativeName+'</div><div class="zmenu__hint">'+e.name+' <span class="ui-lang-settings-menu-lbl">('+i+")</span></div>",className:"ui-lang-selectbox"};t.push(n)}),e.zselectbox("addOption",t);var i=!1,n=SignHandler.isSignSupportedLanguage(editorProps.userInfo.language)?editorProps.userInfo.language:"en";J(J(j.SIGNER_LANGUAGE)[0]).zselectbox("getAttributes").disabled&&(i=!0),e.zselectbox("setAttributes",{disabled:i}),e.zselectbox("setValue",n)},ue=function(e,t){var i=de(t),n=i.find(j.SIGN_TOKENFIELD);"in_person_sign"==e.action_type&&(n=i.find(j.HOST_TOKENFIELD)),MailMergeUiUtils.addEmails(n,[e]);var o=i.find(j.SIGNER_LANGUAGE);if(e.language)o.zselectbox("setValue",e.language);else{var r=editorProps.userInfo.language;r=SignHandler.isSignSupportedLanguage(r)?r:"en",o.zselectbox("setValue",r)}var a=i.find(".js-signer-namefield");return a.val(e.recipient_name),"object"==typeof e&&(i.find("select.signer-action-select").zselectbox("setValue",e.action_type),"in_person_sign"==e.action_type?i.find(".js-signer-email-tokenfield").children()[0].placeholder=J.i18n(X[e.action_type],["("+J.i18n("writer.common.OPTIONAL").toLowerCase()+")"]):i.find(".js-signer-email-tokenfield").children()[0].placeholder=J.i18n(X[e.action_type],[""]),i.find(".js-signer-namefield")[0].placeholder=J.i18n(K[e.action_type])),i},pe=function(e){var t=J(e).parents(j.SIGNER_CONT);t.remove(),s.children().length<2&&c.hide(),ge(),ae()},ge=function(){var e=s.children(),t=e.length;J(e[0]).find(j.SIGNER_NO).text(1);for(var i=1;i<t;i++)J(e[i]).find(j.SIGNER_NO).text(i+1)},fe=function(){for(var e=Utils.getSignRecipientsCount()||1,t=0;t<e;t++)de(t+1)},Ee=function(e){var t=1==e.length,i=editorProps.userInfo.email,n=!1;return n="object"==typeof e[0]?t?i==e[0].recipient_1:e.find(function(e,t){return i==e["recipient_"+(t+1)]}):t?i==e[0]:e.contains(i),!!n},Te=function(i){var o=SignPassCodeDlgHandler.getVerificationInfo(),r=SignPvtMsgDlgHandler.getPrivateMessageInfo();if(i.signers||i.recipients){s.children().remove();for(var A=i.signers||i.recipients,R=0;R<A.length;R++){ue(A[R],R+1);var O=A[R],D=SignHandler.isSignSupportedLanguage(editorProps.userInfo.language)?editorProps.userInfo.language:"en";if(O.hasOwnProperty("language")?w[R+1]=O.language:w[R+1]=D,O.hasOwnProperty("verification_info")?(o[R+1]=JSON.parse(JSON.stringify(O.verification_info)),o[R+1].verify_recipient=!0):o[R+1]={verify_recipient:!1},O.private_notes){var L={message:O.private_notes};r[R+1]=JSON.parse(JSON.stringify(L))}else r[R+1]={message:""};if("in_person_sign"===A[R].action_type){lt(s.children().eq(R),!0);var N=A[R].in_person_signer_info.name,F=A[R].in_person_signer_info.email,M=s.children().eq(R).find(j.SIGN_TOKENFIELD);MailMergeUiUtils.addEmails(M,[F]),A[R].verification_info&&"email"===A[R].verification_info.type&&(o[R+1].email=F),s.children().eq(R).find(".js-signer-namefield").val(N);var U=A[R].recipient_name;s.children().eq(R).find(".js-signer-host-namefield").val(U)}}var G=editorProps.userInfo.email,W=Ee(A),Y=k.ONLY_OTHERS;1==A.length&&W&&"in_person_sign"!=A[0].action_type?Y=k.ONLY_ME:W&&(Y=k.ME_AND_OTHERS),a.zselectbox("setValue",Y),Y==k.ONLY_ME&&(l.hide(),c.hide(),J("#signdlg-signer-select-cont").hide(),J("#signdlg-signer-only-cont").show(),J("#signdlg-onlyme-info").text(J.i18n("writer.sign.SELECT_ONLY_ME",[G])))}if(i.signers||i.recipients||(o={},r={},w={}),SignPassCodeDlgHandler.updateVerificationInfo(o),SignPvtMsgDlgHandler.updatePrivateMessageInfo(r),i.is_sequential&&d.prop("checked",!0),i.subject){var z=i.subject;p.val(z)}if(i.title){var Z=i.title;u.val(Z)}if(i.message){var X=i.message;g.val(X)}var K=i.expiration_days||-1;f.prop("checked",K>0),K>0&&E.znumberfield("setValue",K);var q=i.reminder_period||-1;if(T.prop("checked",q>0),q>0&&m.znumberfield("setValue",q),J("#signdlg-aftersign-filename").val(editor.doc.docInfo.DOCUMENT_NAME),i.storeattachmentinfo){var Q=i.storeattachmentinfo;De(Q),h.prop("checked",!0);var $=Q.filename;J("#signdlg-aftersign-filename").val($||editor.doc.docInfo.DOCUMENT_NAME),J("#signdlg-aftersign-store-withname").prop("checked",$!=editor.doc.docInfo.DOCUMENT_NAME),je()}if(i.emailinfo){I.zstatebutton("checked",!0);var ee=i.emailinfo;if(ee.cc){var te=ee.cc;"string"==typeof te&&(te=te.split(",")),MailMergeUiUtils.addEmails(b,te),S.show()}if(ee.bcc){var te=ee.bcc;"string"==typeof te&&(te=te.split(",")),MailMergeUiUtils.addEmails(v,te),S.show()}if(ee.recipients){var te=ee.recipients;MailMergeUiUtils.addEmails(_,te)}Ke(),H=ee}else H=null;if(i.unique_attachments)for(var ie=i.unique_attachments,R=0;R<ie.length;R++){var ne=ie[R];MailMergeOtherAttachments.addUniqueAttachmentCont(ne,t.mf_mapping)}if(i.common_attachments){var oe=i.common_attachments;MailMergeOtherAttachments.addCommonAttachmentInfos(oe)}e.isMergeOperation?MailMergeDREHandler.initDreOption(V,i.customfunctioninfo,e.dreInfo):(C.off("click").on("click",Qe),P.off("click").on("click",$e),y.off("click").on("click",function(){x=void 0,B=void 0,P.text(J.i18n("writer.common.CONFIGURE")),n.find("#signdlg-customfunc-container").removeClass("ui-custom-func-cont-enable")}),i.customfunctioninfo?(P.text(i.customfunctioninfo.custom_function_name),x=i.customfunctioninfo.custom_function_id,B=i.customfunctioninfo.custom_function_name,C.prop("checked",!0).change(),n.find("#signdlg-customfunc-container").addClass("ui-custom-func-cont-enable")):(n.find("#signdlg-customfunc-container").removeClass("ui-custom-func-cont-enable"),P.hide(),B="",x=""))},me=function(){if(editorProps.isPublishToFill&&e.isFillSubmit){var t=!1;n.find(".js-sign-signer-cont").each(function(e,i){var n=J(i),o=J(i).find(".signer-action-select").zselectbox("getValue")==SIGNER_ROLE.APPROVE;o&&(n.find(".signer-action-select").disable(),n.find(".js-sign-emailfield").disable(),n.find(".zselectbox__arrowicon").hide(),n.find(".js-sign-remove-signer").css("visibility","hidden"),t=!0)})}},he=function(){if(!e.isFillSubmit||!editorProps.isPublishToFill){var t=SignHandler.SIGN_SERVICE.ZOHOSIGN,i=[],n=SignHandler.fetchAccountDetails(t);if(i.push(n),UIUtils.isPropackEnabled()&&e.isFillSubmit&&!editorProps.isPublishToFill){var r=ZWLicense.fetchLimit(SKU_CONST.FILL);i.push(r)}o.disable(),J.when.apply(null,i).done(function(t,i){o.enable(),i=i||{},t&&t.linked&&(e.blockDefaultSettings||Te(t),UIUtils.isPropackEnabled()&&e.isFillSubmit&&!editorProps.isPublishToFill&&FillAutomationHandler.showLimitBanner(i,"#sign-notify-cont",Le))}),UIUtils.isPropackEnabled()&&e.isMergeOperation&&e.showLimit&&Ie()}},Ie=function(t){MergeLimitUIHandler.showMergeLimitInfo({format:"pdf",container:J("#merge-limit-cont"),btn:o,operation:MAILMERGE.ACTION.SIGN,strictLimitValidation:!e.saveOnly})},_e=function(){if(e.isDigisign||e.isFillSubmit||e.isMergeOperation){var o=document.getElementById("signdlg-message-div"),r={};if(r.placeholder=J.i18n("writer.mailmerge.ENTER_A_MESSAGE")+" ("+J.i18n("writer.common.OPTIONAL")+")",r.className="ui-sign-msg-editor",e.isMergeOperation&&(r.includes=[{name:"mergefield",mount:!0}]),r.content=t.messageJSON||t.message,i=ZWRichTextEditor.init(o,r),e.isMergeOperation){var a=i.getMountedNode("mergefield");a.appendChild(n.find("#mm-insert-field")[0])}Ae()}},Ae=function(){i.getRTEElement().addEventListener("linkInputOpen",function(){document.getElementById("signdlg-submitbtn").classList.add("ui-zwdisabled")}),i.getRTEElement().addEventListener("linkInputClose",function(){document.getElementById("signdlg-submitbtn").classList.remove("ui-zwdisabled")})},Se=function(){(e.isDigisign||e.isFillSubmit||e.isMergeOperation)&&i&&Object.keys(i).length&&i.remove()},Re={beforeInit:function(){Z("sign-signer-emailfield").detach().appendTo(Z("mm-template-container")),ee(),fe()},init:function(){if(MailMergeOtherAttachments.initDlgVars({hideFolderComponent:!0,callback:Oe}),te(),ie(),ne(),re(),_e(),he(),Te(t),se(),e.checkFolderPermission&&G.folderId&&"-1"!=G.folderId){J("#sign-folder-choose").html(J.i18n("writer.common.LOADING"));var i=MailMerge.getPermissions({folderid:G.folderId});J.when(i).done(function(e){var t=e.folderid||{};t.canCreateFiles||(G.folderId="-1"),J("#sign-folder-choose").html(""),le()})}else le();me(),F.bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)})},set:function(e,t,i){var n=e.action;"sign-type"==n&&be()}},Oe=function(){J("#"+W+"zdialog").zdialog("reposition")},be=function(){J("#signdlg-signer-select-cont").show(),J("#signdlg-signer-only-cont").hide();var t=a.val();if(k.ONLY_OTHERS==t){e.isSelfSign&&o.zbutton("setAttribute","text",J.i18n("writer.common.SEND_FOR_SIGN")),l.show(),c.show();for(var i=s.children(),n=i.length,r=n-1;r>=0;r--){var d=He(r);d==editorProps.userInfo.email&&i[r].remove()}s.children().length||de(1)}else if(k.ONLY_ME==t){e.isSelfSign&&o.zbutton("setAttribute","text",J.i18n("writer.sign.START_SIGNING")),s.children().remove();var u={};u.recipient_1=editorProps.userInfo.email,u.recipient_name=editorProps.userInfo.fullName,ue(u,1),l.hide(),c.hide(),J("#signdlg-signer-select-cont").hide(),J("#signdlg-signer-only-cont").show(),J("#signdlg-onlyme-info").text(J.i18n("writer.sign.SELECT_ONLY_ME",[u.recipient_1]))}else{e.isSelfSign&&o.zbutton("setAttribute","text",J.i18n("writer.sign.INITIATE_SIGN"));var p=Ce(),u=editorProps.userInfo.email;if(!p.contains(u)){var g=ue(u,1);s.prepend(g[0]),ae()}l.show(),c.show()}ge()},ve=function(e){De(e)},De=function(e){G.folderId=e.folderId||e.folderid||"-1",G.service=e.service||("true"==(window.ZD_IS_NEW_UI_ENABLED||!1).toString()?"workdrive":"zohodocs")},Le=function(){DialogHandler.close(W)},Ne=function(){return DialogHandler.isDialogOpened(W)},Pe=function(){Se(),e.onClose&&e.onClose(MAILMERGE.ACTION.SIGN)},Ce=function(){for(var e=[],t=s.children().length,i=0;i<t;i++){var n=He(i);e.push(n)}return e},ye=function(){for(var e=[],t=s.children().length,i=0;i<t;i++){var n={},o=s.children().eq(i),r=o.find(j.SIGN_TOKENFIELD),a=MailMergeUtil.getEmailsFromTokenField(r)+"";n.signer_email=a;var l=o.find(j.SIGNER_NAME).val();n.signer_name=l,e.push(n)}return e},Fe=function(){for(var t=s.children().length,i=!1,n=0;n<t;n++){var o=Ge(n),r=Je(n),a=new RegExp(/^[a-z0-9 ]+$/i),l=s.children().eq(n).find(".signer-action-select ").val(),d=s.children().eq(n);"in_person_sign"==l?(o.startsWith("${")||o.startsWith(UNICODE.MERGEFIELD_START)?(d.find(j.INPERSON_NAME_ERROR).hide().text(""),d.find(".js-signer-host-namefield").removeClass("ui-validation-error")):""!==o.trim()||e.isFillSubmit?""==o.trim()||a.test(o)?(d.find(j.INPERSON_NAME_ERROR).hide().text(""),d.find(".js-signer-host-namefield").removeClass("ui-validation-error")):(d.find(j.INPERSON_NAME_ERROR).show().text(J.i18n("writer.fillablefields.CHAR_ERROR")),d.find(".js-signer-host-namefield").addClass("ui-validation-error"),i=!0):(s.children().eq(n).find(j.INPERSON_NAME_ERROR).show().text(J.i18n("writer.sign.SIGNER_NAME_NOT_CONFIGURED_ERROR",[""])),s.children().eq(n).find(".js-signer-host-namefield").addClass("ui-validation-error"),i=!0),r.startsWith("${")||r.startsWith(UNICODE.MERGEFIELD_START)?(d.find(j.SIGNER_NAME_ERROR).hide().text(""),d.find(".js-signer-namefield").removeClass("ui-validation-error")):e.isFillSubmit||""!==r.trim()?""==r.trim()||a.test(r)?(d.find(j.SIGNER_NAME_ERROR).hide().text(""),d.find(".js-signer-namefield").removeClass("ui-validation-error")):(d.find(j.SIGNER_NAME_ERROR).show().text(J.i18n("writer.fillablefields.CHAR_ERROR")),d.find(".js-signer-namefield").addClass("ui-validation-error"),i=!0):(d.find(j.SIGNER_NAME_ERROR).show().text(J.i18n("writer.sign.SIGNER_NAME_NOT_CONFIGURED_ERROR",["in-person "])),d.find(".js-signer-namefield").addClass("ui-validation-error"),i=!0)):r.startsWith("${")||r.startsWith(UNICODE.MERGEFIELD_START)?(d.find(j.SIGNER_NAME_ERROR).hide().text(""),d.find(".js-signer-namefield").removeClass("ui-validation-error")):e.isFillSubmit||""!==r.trim()?""==r.trim()||a.test(r)?(d.find(j.SIGNER_NAME_ERROR).hide().text(""),d.find(".js-signer-namefield").removeClass("ui-validation-error")):(d.find(j.SIGNER_NAME_ERROR).show().text(J.i18n("writer.fillablefields.CHAR_ERROR")),d.find(".js-signer-namefield").addClass("ui-validation-error"),i=!0):(d.find(j.SIGNER_NAME_ERROR).show().text(J.i18n("writer.sign.SIGNER_NAME_NOT_CONFIGURED_ERROR",["in-person "])),d.find(".js-signer-namefield").addClass("ui-validation-error"),i=!0)}return!i},Me=function(){for(var e=ye(),t={},i=[],n=0,o=-1,r=[],a=0;a<e.length;a++){for(var s=a+1;s<e.length;s++)""!=e[a].signer_email.trim()&&""!=e[s].signer_email.trim()&&e[a].signer_email===e[s].signer_email&&""!=e[a].signer_name.trim()&&""!=e[s].signer_name.trim()&&e[a].signer_name===e[s].signer_name&&(i.contains(a)||i.push(a),i.push(s),n==a?o=s:(n=a,o=s));o==-1||r.contains(o)||r.push(o)}return t.duplicateSignerIdx=i,t.lastDuplicateSignerIdx=r,t},we=function(){for(var t=[],i=s.children().length,n=SignPassCodeDlgHandler.getVerificationInfo(),o=SignPvtMsgDlgHandler.getPrivateMessageInfo(),r=0;r<i;r++){var a=He(r),l={};if(l.action_type=Ue(r),l.language=xe(r+1),"undefined"!=typeof o[r+1]&&(l.private_notes=o[r+1].message),"in_person_sign"===l.action_type){var d={};d.name=s.children().eq(r).find(".js-signer-namefield").val();var c=s.children().eq(r).find(j.SIGN_TOKENFIELD),u=MailMergeUtil.getEmailsFromTokenField(c)+"";d.email=u,l.in_person_signer_info=d}"undefined"!=typeof n[r+1]&&Object.keys(n[r+1]).length>0&&n[r+1].verify_recipient&&(l.verification_info=JSON.parse(JSON.stringify(n[r+1])),n[r+1].hasOwnProperty("email")&&(l.in_person_signer_info.email=n[r+1].email,delete l.verification_info.email),delete l.verification_info.verify_recipient);var p=s.children().eq(r).find(".js-signer-namefield").val();if("in_person_sign"===l.action_type&&(p=s.children().eq(r).find(".js-signer-host-namefield").val()),e.isDigisign||e.isFillSubmit){var g="recipient_"+(r+1);"${}"==a&&(a=""),l[g]=a}else l.email=a;l.recipient_name=p,t.push(l)}return t},Ue=function(e){var t=s.children().eq(e),i=t.find(".js-signer-type-select"),n=i.zselectbox("getValue");return n},xe=function(e){return w[e]},Be=function(){var t={title:u.val(),expiration_days:-1,is_sequential:d.prop("checked"),subject:p.val(),email_reminders:!1,service_no:SignHandler.SIGN_SERVICE.ZOHOSIGN};t[e.isMergeOperation?"signers":"recipients"]=we();var n=i.getJSON();if(t.message=i.getText(n),t.messageJSON=n,e.isDigisign||e.isFillSubmit?t.messageHTML=RichTextEditor.getHTML(n):e.isMergeOperation&&(t.messageHTML=ZWRichTextEditor.getHTMLforMergeField(n)),T.prop("checked")&&(t.email_reminders=!0,t.reminder_period=m.val()||1),f.prop("checked")&&(t.expiration_days=E.val()||1),h.prop("checked")){var o={folderid:G.folderId,service:G.service,format:"pdf"};J("#signdlg-aftersign-store-withname").prop("checked")&&(o.filename=J("#signdlg-aftersign-filename").val()||editor.doc.docInfo.DOCUMENT_NAME),t.storeattachmentinfo=o}e.saveOnly||(t.savevalues=L.prop("checked"));var r=I.prop("checked");if(r)if(e.isDigisign||e.isMergeOperation)H&&(H.attachment_name=u.val(),delete H.group_email,t.emailinfo=H);else{var a=MailMergeUtil.getEmailsFromTokenField(_),s={from_address:editorProps.userInfo.email,reply_to:editorProps.userInfo.email,recipients:a,subject:"",message:"",attachment_name:editor.doc.docInfo.DOCUMENT_NAME,format:"pdf"},l=MailMergeUtil.getEmailsFromTokenField(b),c=MailMergeUtil.getEmailsFromTokenField(v);l&&l.length&&(s.cc=l),c&&c.length&&(s.bcc=c),t.emailinfo=s}var g={},A=MailMergeOtherAttachments.getUniqueAttachmentsInfo();A.length&&(g.unique_attachments=JSON.stringify(A));var S=MailMergeOtherAttachments.getCommonCloudAttachmentsInfo();if(S.length&&(g.common_attachments=JSON.stringify(S)),MailMergeOtherAttachments.addCommonAttachmentFiles(g),(e.isDigisign||e.showDREFunction)&&B&&C.prop("checked")&&nt(t),e.showDREFunction){var R=MailMergeDREHandler.getDREFunctionInfo();R&&(t.customfunctioninfo=R)}return g.actioninfo=JSON.stringify(t),g},He=function(e){var t=J(s.children()[e]),i=t.find(j.SIGN_TOKENFIELD);"in_person_sign"===Ue(e)&&(i=t.find(j.HOST_EMAIL));var n=MailMergeUtil.getEmailsFromTokenField(i)+"";return n},Je=function(e){var t=J(s.children()[e]),i=t.find(".js-signer-namefield").val();return i},Ge=function(e){var t=J(s.children()[e]),i=t.find(".js-signer-host-namefield").val();return i},ke=function(e){Notification.show({container:"#sign-notify-cont",message:e,translatedMessage:!0,setTimer:!1,type:"error"}),R.hide(),o.enable(),r.enable()},We=function(){Notification.hide(),R.hide(),o.enable(),r.enable()},Ye=function(e){Notification.hide(),O.text(e),R.show(),o.disable(),r.disable()},ze=function(e,t){var i=e.target,n=i.parents(j.SIGNER_CONT),o=n.find(j.SIGNER_EMAIL_ERROR),r=n.find(".js-signer-email-tokenfield"),a=n.find(j.SIGNER_NAME_ERROR);i.hasClass("js-signer-host-emailfield")&&(o=n.find(j.INPERSON_EMAIL_ERROR),r=n.find(".js-signer-host-email-tokenfield"),a=n.find(j.INPERSON_NAME_ERROR));var l=MailMergeUtil.getEmailsFromTokenField(i);if(!MailMergeUtil.isProperEmails(l))return i.ztokenfield("removeAllTokens"),i.focus(),r.addClass("ui-validation-error"),void o.text(J.i18n("writer.sign.SIGNER_EMAIL_INVALID")).show();r.removeClass("ui-validation-error");for(var d=Ce(),c=s.children().length,u=0;u<c;u++){var p=s.children().eq(u),g=MailMergeUtil.getEmailsFromTokenField(p.find(".js-sign-emailfield"))+"",f=p.find(".js-signer-email-tokenfield");if(g&&d.indexOf(g)!=d.lastIndexOf(g)){f[0].setAttribute("title","sample");var E='<div style="max-width: 240px;">'+J.i18n("writer.sign.SIGNER_EMAIL_PRESENT")+"</div>";f.ztooltip({displayType:"callout",pauseOnHover:!0,position:"bottom",isMessageHTMLEncoded:!0,innerHTML:E})}else f.ztooltip("destroy")}d.indexOf(l+"")!=d.lastIndexOf(l+"")&&(r.ztooltip("setAttribute",{hideDelay:"5000"}),r.ztooltip("show")),l=l[0];var T,d=i.ztokenfield("getAllValues"),m=d[0].name!=l?d[0].name:"";i.hasClass("js-sign-emailfield")?T=n.find(".js-signer-namefield"):i.hasClass("js-signer-host-emailfield")&&(T=n.find(".js-signer-host-namefield")),""===T.val().trim()&&(T.val(m),T.removeClass("ui-validation-error")),o.hide(),a.hide(),t.element.parent().addClass("ui-single-sign-signer-cont")},Ze=function(e,t){t.element.parent().removeClass("ui-single-sign-signer-cont");var i=e.target,n=i.parents(j.SIGNER_CONT),o=n.find(".js-signer-type-select").val();"in_person_sign"==o?n.find(".js-signer-email-tokenfield").children()[0].placeholder=J.i18n(X[o],["("+J.i18n("writer.common.OPTIONAL").toLowerCase()+")"]):n.find(".js-signer-email-tokenfield").children()[0].placeholder=J.i18n(X[o],[""]),n.find(".js-signer-namefield")[0].placeholder=J.i18n(K[t.value])},Ve=function(e,t){var i=e.target,n=i.parents(j.SIGNER_CONT),o=n.find(j.SIGNER_EMAIL_ERROR);i.hasClass("js-signer-host-emailfield")&&(o=n.find(j.INPERSON_EMAIL_ERROR)),o.hide()},je=function(){h.prop("checked")?(J("#sign-folder-choose,#sign-filename-opt").removeClass("ui-disabled-elem"),Xe()):J("#sign-folder-choose,#sign-filename-opt,#sign-filename-cont").addClass("ui-disabled-elem")},Xe=function(){J("#signdlg-aftersign-store-withname").prop("checked")?J("#sign-filename-cont").removeClass("ui-disabled-elem"):J("#sign-filename-cont").addClass("ui-disabled-elem")},Ke=function(){I.prop("checked")?e.isDigisign||e.isMergeOperation?J("#signdlg-aftersign-email-configure").removeClass("ui-hide"):J("#sign-emailopt-cont").removeClass("ui-disabled-elem"):e.isDigisign||e.isMergeOperation?J("#signdlg-aftersign-email-configure").addClass("ui-hide"):J("#sign-emailopt-cont").addClass("ui-disabled-elem")},qe=function(){var t=function(){var e=MailMergeEmailDlgHandler.getEmailDetails(),t={};t.from_address=e.from_address,t.reply_to=e.reply_to,t.recipients=e.recipients,t.cc=e.cc,t.bcc=e.bcc,t.subject=e.subject,t.messageHTML=e.messageHTML,t.messageJSON=e.messageJSON,H=t,J.dialogutil.close("mailmerge_emaildlg")},i=function(){J.dialogutil.close("mailmerge_emaildlg"),e.defaultValues&&e.defaultValues.emailinfo||H||(I.prop("checked",!1),J("#signdlg-aftersign-email-configure").addClass("ui-hide"))},n={};H?n=H:e.defaultValues&&e.defaultValues.emailinfo&&(n=e.defaultValues.emailinfo),n.recipients||(n.recipients=[editorProps.userInfo.email]),n.format||(n.format="pdf");var o={saveOnly:!0,btns:[J.i18n("writer.common.SAVE")],title:J.i18n("writer.documentautomation.EMAIL_SETTINGS"),isSignJob:e.isDigisign,isSignCallBack:!0,isMergeOperation:e.isMergeOperation,defaultValues:n,callback:t,cancel_callback:i,reset:function(){H=null,I.prop("checked",!1),J("#signdlg-aftersign-email-configure").addClass("ui-hide")}};MailMergeEmailDlgHandler.open(o)},Qe=function(){C.prop("checked")?(P.show(),n.find("#signdlg-customfunc-container")[B?"addClass":"removeClass"]("ui-custom-func-cont-enable")):(P.hide(),n.find("#signdlg-customfunc-container").removeClass("ui-custom-func-cont-enable"))},$e=function(){var t=function(e){P.text(e.functionName).show(),tt(e.functionName,e.functionId),e.functionName&&n.find("#signdlg-customfunc-container").addClass("ui-custom-func-cont-enable")},i=Utils.encodeHTMLString(editor.doc.docInfo.DOCUMENT_NAME.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),"")),o=Utils.encodeHTMLString(editor.doc.docInfo.CREATOR.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),"")),r=e.dreFunctionInfo||{},a=r.defaultScript||'recipients = signInfo.get("recipient_info");\ninfo recipients;',s=r.editorparams||[{paramName:"signInfo",paramType:"Map"},{paramName:"docInfo",paramType:"Map"}],l={callback:t,btns:[J.i18n("writer.common.PROCEED")],title:J.i18n("writer.automation.CUSTOM_FUNCTIONS"),showGalleryFunctions:!0,defaultScript:a,editorParams:s,functionCategory:r.functionCategory||"document_sign",defaultFunctionId:x,functionReturnType:"void",defaultParamValues:r.defaultParamValues||{signInfo:{request_id:"1397293793974",request_name:"Untitled Document",request_status:"success",reminder_period:"1",signed_document_download_url:"https://"+editorProps.urls.servername+"/api/v1/fill/job/123455666322/attachment/download",recipient_info:[{recipient_1:"abc@example.com",recipient_name:"abc",action_type:"sign"}],signed_data:{"abc@example.com":{Name:"abc",Company:"Zylker","Job Title":"CEO"}}},docInfo:{open_url:"https://"+editorProps.urls.servername+"/writer/open/"+editor.doc.docInfo.RID,document_id:editor.doc.docInfo.RID,document_name:i,created_by:o,creator_id:editor.doc.docInfo.CREATOR_ZUID,download_url:"https://"+editorProps.urls.servername+"/api/v1/download/open/"+editor.doc.docInfo.RID,parent_folder_id:editor.doc.docInfo.PARENT_ID}},paramPopupsHTML:r.paramPopupsHTML||{signInfo:{title:"SignInfo",content:'<>{</p><p>"request_id": "1397293793974"</p><p>"request_name": "Untitled Document"</p><p>"request_status": "success"</p><p>"reminder_period": "1"</p><p>"signed_document_download_url": "https://'+editorProps.urls.servername+'/api/v1/fill/job/123455666322/attachment/download"</p><p>"recipient_info": [{<br>&nbsp&nbsp&nbsp"recipient_1": "abc@example.com",<br>&nbsp&nbsp&nbsp"recipient_name": "abc",<br>&nbsp&nbsp&nbsp"action_type": "sign"<br>}]</p><p>"signed_data": {<br>&nbsp&nbsp&nbsp"abc@example.com": {<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp"Name":"abc",<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp"Company": "Zylker",<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp"Job Title": "CEO"<br>&nbsp&nbsp&nbsp}<br>}</p><p>}</p>'},docInfo:{title:"DocInfo",content:'<p>{</p><p>"open_url": "https://'+editorProps.urls.servername+"/writer/open/"+editor.doc.docInfo.RID+'"</p><p>"document_id": "'+editor.doc.docInfo.RID+'"</p><p>"document_name":"'+i+'"</p><p>"created_by": "'+o+'"</p><p>"creator_id": "'+editor.doc.docInfo.CREATOR_ZUID+'"</p><p>"download_url": "https://'+editorProps.urls.servername+"/api/v1/download/open/"+editor.doc.docInfo.RID+'"</p><p>"parent_folder_id": "'+editor.doc.docInfo.PARENT_ID+'"</p><p>}</p>'}}};x&&(l.defaultFunctionId=x),DREDialogHandler.openDialog(l)},et=function(e,t,i,n){MsgDialog.showMessage([i,J.i18n("writer.common.CANCEL")],CONST.SEVERITY_WARNING,e,t,null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:n&&n()}})},tt=function(e,t){var i=DelugeHandler.getDelugeEditor().isEditorContentModified();i?et(J.i18n("writer.common.UNSAVED_CHANGES_FOUND"),J.i18n("writer.automation.UNSAVED_CHANGES_MSG"),J.i18n("writer.common.CONTINUE"),it.bind(this,e,t)):it(e,t)},it=function(e,t){B=e,x=t;var i=DREDialogHandler.getSelectedFunction(),t=DelugeHandler.getFunctionIdFromName(i);DREDialogHandler.closeDialog()},nt=function(e){e.customfunctioninfo={custom_function_id:x,custom_function_name:B}},ot=function(e){MailMergeUiUtils.insertFieldInRTE(i,e)},rt=function(){var t=s.children().eq(M-1).find(".signer-action-select").val(),i={};i.isMergeOperation=!!e.isMergeOperation,i.role=t,i.current_signer_index=M,SignPassCodeDlgHandler.open(i)},at=function(){var t=s.children().eq(M-1).find(".signer-action-select").val(),i={};i.isMergeOperation=!!e.isMergeOperation,i.role=t,i.current_signer_index=M,SignPvtMsgDlgHandler.open(i)},st=function(e,t){var i=e.target,n=i.parents(j.SIGNER_CONT);"in_person_sign"==t.value?n.find(".js-signer-email-tokenfield").children()[0].placeholder=J.i18n(X[t.value],["("+J.i18n("writer.common.OPTIONAL").toLowerCase()+")"]):n.find(".js-signer-email-tokenfield").children()[0].placeholder=J.i18n(X[t.value],[""]),n.find(".js-signer-namefield")[0].placeholder=J.i18n(K[t.value]),t.previousValue===t.value||"in_person_sign"!=t.value&&"in_person_sign"!=t.previousValue||("in_person_sign"===t.value?lt(n,!0):"in_person_sign"===t.previousValue&&lt(n,!1))},lt=function(t,i){i?t.addClass("ui-signer-inperson-cont"):(t.removeClass("ui-signer-inperson-cont"),e.isFillSubmit?(t.find("#ff-signer-email").show(),t.find("#ff-signer-name").hide()):e.isMergeOperation&&(t.find("#mm-signer-email").show(),t.find("#mm-signer-name").hide()))},dt=function(e){for(var t=e.parents(),i=0;i<t.length;i++)for(var n=0;n<s.children().length;n++)if(s.children()[n]==t[i])return n+1;return null},ct=function(e){M=dt(J(event.target.parentElement));var t=Ue(M-1),i=SignPassCodeDlgHandler.getVerificationInfo();if("in_person_sign"===t&&i[M]&&(!i[M].verify_recipient||"email"===i[M].type)){var n=s.children().eq(M-1).find(j.SIGN_TOKENFIELD),o=MailMergeUtil.getEmailsFromTokenField(n)+"";i[M].email=o}var r=SignHandler.isSignSupportedLanguage(editorProps.userInfo.language)?editorProps.userInfo.language:"en",a=w[M]||r,l=SignHandler.SIGN_SERVICE.ZOHOSIGN,d=SignHandler.getAccountDetails(l),c=d.license_type,u=!1;if(c&&"Free"===c&&(u=!0),0==J("#signerlanguagemenu").children().length){for(var p=[],g=0;g<Y.length;g++){var f=Y[g],E=f.code.toUpperCase(),T={value:f.code,label:f.nativeName,className:"signer-lang-"+f.code,description:f.name+" ("+E+")",itemType:"radio",disabled:u,name:"language"};p.push(T)}J("#signerlanguagemenu").zmenu("removeAllMenuItems"),J("#signerlanguagemenu").zmenu("addMenuItems",p),J("#signerlanguagemenu").on("zmenuitemclick",SignDlgHandler.handleSignLangClick)}"in_person_sign"===t&&J(e).hasClass("js-signer-signer-settings")?(J(".js-signer-settings-privateMsg").hide(),J(".js-signer-settings-passcodeDlg").hide(),J(".js-signer-settings-separator").hide(),J(".js-signer-language").hide(),J(".js-signer-settings-in-person-passCodeDlg").show()):"in_person_sign"===t&&J(e).hasClass("js-signer-host-settings")?(J(".js-signer-settings-privateMsg").show(),J(".js-signer-settings-passcodeDlg").hide(),J(".js-signer-settings-separator").show(),J(".js-signer-language").show(),J(".js-signer-settings-in-person-passCodeDlg").hide()):(J(".js-signer-settings-privateMsg").show(),J(".js-signer-settings-passcodeDlg").show(),J(".js-signer-settings-separator").show(),J(".js-signer-language").show(),J(".js-signer-settings-in-person-passCodeDlg").hide()),J("#signerlanguagemenu").zmenu("setMenuItemsAttribute",J(".signer-lang-"+a),"checked",!0)},ut=function(t){var i=J(t).parents(j.SIGNER_CONT),n=i.find(j.SIGNER_ACTION_SELECT).zselectbox("getValue"),o=i.find(j.SIGNER_NAME_ERROR),r=J.i18n("writer.sign.SIGNER_NAME_NOT_CONFIGURED_ERROR",[""]);"in_person_sign"===n&&(r=J.i18n("writer.sign.SIGNER_NAME_NOT_CONFIGURED_ERROR",["In-person "])),J(t).hasClass("js-signer-host-namefield")&&(o=i.find(j.INPERSON_NAME_ERROR)),""!==J(t).val().trim()||e.isFillSubmit?(o.hide().text(""),J(t).removeClass("ui-validation-error")):(o.show().text(r),J(t).addClass("ui-validation-error"))},pt=function(e,t){w[M]=t.data.value},gt=function(e,t){var i=t.target;M=dt(i);var n=Ue(M-1),o=SignPassCodeDlgHandler.getVerificationInfo();if("in_person_sign"===n&&o[M]&&(!o[M].verify_recipient||"email"===o[M].type)){var r=s.children().eq(M-1).find(j.SIGN_TOKENFIELD),a=MailMergeUtil.getEmailsFromTokenField(r)+"";o[M].email=a}var l=SignHandler.isSignSupportedLanguage(editorProps.userInfo.language)?editorProps.userInfo.language:"en",d=w[M]||l,c=SignHandler.SIGN_SERVICE.ZOHOSIGN,u=SignHandler.getAccountDetails(c),p=u.license_type,g=!1;if(p&&"Free"===p&&(g=!0),0==J("#signerlanguagemenu").children().length){for(var f=[],E=0;E<Y.length;E++){var T=Y[E],m=T.code.toUpperCase(),h={value:T.code,label:T.nativeName,className:"signer-lang-"+T.code,description:T.name+" ("+m+")",itemType:"radio",disabled:g,name:"language"};f.push(h)}J("#signerlanguagemenu").zmenu("removeAllMenuItems"),J("#signerlanguagemenu").zmenu("addMenuItems",f),J("#signerlanguagemenu").on("zmenuitemclick",SignDlgHandler.handleSignLangClick)}"in_person_sign"===n&&J(i).hasClass("js-signer-signer-settings")?(J(".js-signer-settings-privateMsg").hide(),J(".js-signer-settings-passcodeDlg").hide(),J(".js-signer-settings-separator").hide(),J(".js-signer-language").hide(),J(".js-signer-settings-in-person-passCodeDlg").show()):"in_person_sign"===n&&J(i).hasClass("js-signer-host-settings")?(J(".js-signer-settings-privateMsg").show(),J(".js-signer-settings-passcodeDlg").hide(),J(".js-signer-settings-separator").show(),J(".js-signer-language").show(),J(".js-signer-settings-in-person-passCodeDlg").hide()):(J(".js-signer-settings-privateMsg").show(),J(".js-signer-settings-passcodeDlg").show(),J(".js-signer-settings-separator").show(),J(".js-signer-language").show(),J(".js-signer-settings-in-person-passCodeDlg").hide()),J("#signerlanguagemenu").zmenu("setMenuItemsAttribute",J(".signer-lang-"+d),"checked",!0)},ft=function(){var t=function(e){e.hasClass("ui-anim-glow")&&e.removeClass("ui-anim-glow")},i=function(){for(var e=0;e<s.children().length;e++)t(s.children().eq(e).find(".js-signer-host-email-tokenfield")),t(s.children().eq(e).find(".js-signer-host-namefield")),t(s.children().eq(e).find(".js-signer-email-tokenfield")),t(s.children().eq(e).find(".js-signer-namefield"))};return function(){if(e.isFillSubmit){for(var t=Be(),n=JSON.parse(t.actioninfo),o=n.signers||n.recipients,r=s.children().length,a=0;a<r;a++){var l=s.children().eq(a),d=o[a];if("in_person_sign"===d.action_type){""===d["recipient_"+(a+1)].trim()&&l.find(".js-signer-host-email-tokenfield").addClass("ui-anim-glow"),""===d.recipient_name.trim()&&l.find(".js-signer-host-namefield").addClass("ui-anim-glow");var c=d.in_person_signer_info;""===c.name.trim()&&l.find(".js-signer-email-tokenfield").addClass("ui-anim-glow"),""===c.email.trim()&&l.find(".js-signer-namefield").addClass("ui-anim-glow")}""===d["recipient_"+(a+1)].trim()&&l.find(".js-signer-email-tokenfield").addClass("ui-anim-glow"),""===d.recipient_name.trim()&&l.find(".js-signer-namefield").addClass("ui-anim-glow")}setTimeout(i,3e3)}}}(),Et=function(e,t){var i=e.target[0].getAttribute("id").split("-"),n=i[i.length-1],o=document.getElementById("zoption-in_persion_sign-"+n),r=document.getElementById("zoption-digisign_approver-"+n);r.classList.remove("ui-mitem-disabled-hstate"),o.classList.remove("ui-mitem-disabled-hstate");var a=SignHandler.getAccountDetails(SignHandler.SIGN_SERVICE.ZOHOSIGN);a&&a.available_features&&!a.available_features.approver_role&&(r.setAttribute("title",q.approver),r.setAttribute("data-title-position","right"),r.setAttribute("data-title-pause-on-hover","true"),r.setAttribute("data-title-is-message-html-encoded","true"),r.setAttribute("data-title-innerHTML","<div style='max-width:140px;word-break:normal;'>"+q.approver+"</div>"),r.classList.add("ui-mitem-disabled-hstate")),a&&a.available_features&&!a.available_features.in_person_signing&&(o.setAttribute("title",q.in_person_sign),o.setAttribute("data-title-position","right"),o.setAttribute("data-title-pause-on-hover","true"),o.setAttribute("data-title-is-message-html-encoded","true"),o.setAttribute("data-title-innerHTML","<div style='max-width:160px;word-break:normal;'>"+q.in_person_sign+"</div>"),o.classList.add("ui-mitem-disabled-hstate"))};window.SignDlgHandler={open:Q,close:Le,isDialogOpened:Ne,addSignerField:de,removeSignerField:pe,getSignInfo:Be,showNotificationMsg:ke,showProgressLoadingMsg:Ye,hideProgressLoadingMsg:We,afterTokenAdd:ze,afterTokenRemove:Ze,beforeSearch:Ve,handleStoreOption:je,handleStoreFileNameOption:Xe,handleEmailOption:Ke,openEmailDialog:qe,handleDREOption:Qe,openDREDialog:$e,saveCustomFunction:tt,beforeClose:Pe,openWithRTE:$,insertFieldInRTE:ot,openPassCodeDlg:rt,openPrivateMsgDlg:at,handleInPersonSigning:st,handleSettingsClick:ct,handleSignerNameOnBlur:ut,handleSignLangClick:pt,handleSettingsMenuBeforeShow:gt,highlightEmptySigners:ft,beforeDropDownOpen:Et}}(),function(){"use strict";var e,t,i,n,o,r="signerpvtmsgdlg",a={},s={DIALOG:"#signerpvtmsgdlg",PRIVATE_MESSAGE_CONT:"#signdlg-message"},l=function(){t&&Object.keys(t).length&&t.remove()},d=function(){o=J(s.DIALOG),n=J(s.PRIVATE_MESSAGE_CONT),i=e.current_signer_index},c=function(){var e=document.getElementById("signdlg-message"),t=a[i]&&a[i].message||"";e.innerText=t},u={beforeInit:function(){d()},init:function(){p(),e.isMergeOperation?J("#add-mm-signer-pvt-msg").show():J("#add-mm-signer-pvt-msg").hide(),c(),J("#signerpvtdlg-submitbtn").off("click").on("click",E)}},p=function(){var t={in_person_sign:"FACILITATOR",sign:"SIGNER",approve:"APPROVER",view:"VIEWER"};if(e.role){var i=t[e.role];J("#"+r+"zdialog").zdialog("setAttributes",{title:J.i18n("writer.sign.PRIVATE_MESSAGE_DIALOG_TITLE",[i.toUpperCase()])})}},g=function(t){e=t||{},f()},f=function(){DialogHandler.open(r,u)},E=function(){var e=document.getElementById("signdlg-message").value;a[i]=a[i]?a[i]:{},a[i].message=e,DialogHandler.close(r)},T=function(){return a},m=function(){l()},h=function(e){MailMergeUiUtils.insertFieldInRTE(t,e)},I=function(e){MailMergeUiUtils.insertFieldInText(e)},_=function(e){a=JSON.parse(JSON.stringify(e))};window.SignPvtMsgDlgHandler={open:g,getPrivateMessageInfo:T,beforeClose:m,insertFieldInRTE:h,updatePrivateMessageInfo:_,insertField:I}}(),function(){"use strict";var e,t,i,n,o,r,a,s,l,d,c,u,p,g,i,f="signerpasscodedlg",E={OFFLINE:"offline",EMAIL:"email",SMS:"sms"},T=[],m={},h=new RegExp(/^[a-z0-9]+$/i),I=new RegExp(/[^0-9,-. +()]/),_={DIALOG:"#signerpasscodedlg",VERIFICATION_TYPE:"#signer-verification-type",VERIFICATION_TOGGLE:"#signdlg-toggle-switch",EMAIL_VERIFICATION_CONT:"#signer-email-verification-cont",OFFLINE_VERIFICATION_CONT:"#signer-offline-verification-cont",SMS_VERIFICATION_CONT:"#signer-sms-verification-cont",EMAIL:"#sign-in-person-email",PHONE_NUMBER:"#signdlg-phonenumber",COUNTRY_CODE_CONT:"#signdlg-countrycodeContainer",COUNTRY_CODE:"#signdlg-countrycode",OFFLINE_CODE:"#signdlg-password-cont",SUBMIT:"#signerpasscodedlg-submitbtn",EMAIL_CONT:"#sign-in-person-email-cont"},A=function(){t=e.current_signer_index,n=J(_.VERIFICATION_TYPE),o=J(_.VERIFICATION_TOGGLE),r=J(_.EMAIL_VERIFICATION_CONT),a=J(_.OFFLINE_VERIFICATION_CONT),s=J(_.SMS_VERIFICATION_CONT),l=J(_.EMAIL),d=J(_.PHONE_NUMBER),c=J(_.COUNTRY_CODE_CONT),u=J(_.COUNTRY_CODE),p=J(_.OFFLINE_CODE),g=J(_.SUBMIT),i=J(_.EMAIL_CONT)},S={beforeInit:function(){A(),b()},init:function(){v(),e.isMergeOperation?(J("#add-mm-sign-email").show(),J("#add-mm-sign-phonenumber").show()):(J(".js-signer-passcode-email-cont").addClass("ui-no-field-icon"),J(".js-signer-passcode-phone-cont").addClass("ui-no-field-icon"),J("#add-mm-sign-email").hide(),J("#add-mm-sign-phonenumber").hide()),m[t]&&0!=Object.keys(m[t]).length||(m[t]={verify_recipient:!1}),m[t].code||(p.val(Math.floor(9e4*Math.random())+1e5),p.keyup()),"in_person_sign"!=e.role?i.hide():(i.show(),m[t].type===E.EMAIL&&MailMergeUiUtils.addEmails(l,[m[t].email])),n.zselectbox("setValue",m[t].type),m[t].verify_recipient?o.ztoggleswitch("switchOn"):o.ztoggleswitch("switchOff"),m[t].type===E.SMS?(r.addClass("ui-hide"),a.addClass("ui-hide"),s.removeClass("ui-hide"),b(),u.zselectbox("setValue",m[t].country_code||"+91"),d.val(m[t].phonenumber||"")):m[t].type===E.OFFLINE&&(s.addClass("ui-hide"),r.addClass("ui-hide"),a.removeClass("ui-hide"),p.val(m[t].code||""),p.keyup()),m[t].verify_recipient?(n.enable(),l.enable(),d.enable(),u.enable(),p.enable()):(n.disable(),l.disable(),d.disable(),u.disable(),p.disable()),g.off("click").on("click",D)},set:function(e,i,n){if("verification-type"===e.action)switch(i){case"sms":b();var o=m[t].country_code||"+1";u.zselectbox("setValue",o),r.addClass("ui-hide"),a.addClass("ui-hide"),s.removeClass("ui-hide");break;case"offline":s.addClass("ui-hide"),r.addClass("ui-hide"),a.removeClass("ui-hide");break;default:s.addClass("ui-hide"),a.addClass("ui-hide"),r.removeClass("ui-hide")}else"password"===e.action?h.test(i)?(p.removeClass("ui-validation-error"),J("#signdlg-password-cont-error-message").hide()):(J("#signdlg-password-cont-error-message").html(J.i18n("writer.sign.VERIFICATION_CODE_ERROR_MESSAGE")),J("#signdlg-password-cont-error-message").show(),p.addClass("ui-validation-error")):"signdlg-phonenumber"===e.action&&(I.test(i)||""===i.trim()?(J("#signdlg-phonenumber-cont-error-message").html(J.i18n("writer.sign.INVALID_PHONE_NUMBER")),J("#signdlg-phonenumber-cont-error-message").show(),d.addClass("ui-validation-error")):(d.removeClass("ui-validation-error"),J("#signdlg-phonenumber-cont-error-message").hide()))}},R=function(t){e=t||{},DialogHandler.open(f,S)},O=function(){var e=e=ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID)+"/sign/countrycodes";J.ajax({type:"GET",dataType:"json",url:e,error:function(e){},success:function(e){T=e.country_codes}})},b=function(){var e=[];0==T.length&&O(),U.each(T,function(t){var i=t.country_name+" ("+t.dialing_code+")",n={value:t.dialing_code,label:i};e.push(n)}),u.zselectbox("addOption",e)},v=function(){var t={in_person_sign:"in-person signer",sign:"signer",approve:"approver",view:"viewer"};if(e.role){var i=t[e.role];J("#"+f+"zdialog").zdialog("setAttributes",{title:J.i18n("writer.sign.PASSCODE_DIALOG_TITLE",[i.toUpperCase()])})}J("#signer-passcode-email-desc").text(J.i18n("writer.sign.DELIVER_PASSCODE_VIA_EMAIL",[i])),J("#signer-passcode-sms-desc").text(J.i18n("writer.sign.DELIVER_PASSCODE_VIA_SMS",[i])),J("#signer-offline-desc").text(J.i18n("writer.sign.OFFLINE_VERIFICATION_DESC",[i]))},D=function(){var i=JSON.parse(JSON.stringify(m[t.toString()])),o=n.val();if(!m[t.toString()].verify_recipient||!L(o))return delete m[t.toString()],void DialogHandler.close(f);if(o===E.SMS?(i.countrycode=u.val(),i.phonenumber=d.val()):o===E.OFFLINE&&(i.code=p.val()),"in_person_sign"===e.role&&o===E.EMAIL){if(0==MailMergeUtil.getEmailsFromTokenField(l).length)return;i.email=MailMergeUtil.getEmailsFromTokenField(l)[0]}i.type=o,m[t.toString()]=i,DialogHandler.close(f)},L=function(t){var i=!1;switch(t){case E.SMS:I.test(d.val())||""===d.val().trim()?(J("#signdlg-phonenumber-cont-error-message").html(J.i18n("writer.sign.INVALID_PHONE_NUMBER")),J("#signdlg-phonenumber-cont-error-message").show(),d.addClass("ui-validation-error"),i=!0):(d.removeClass("ui-validation-error"),J("#signdlg-phonenumber-cont-error-message").hide());break;case E.OFFLINE:h.test(p.val())?(p.removeClass("ui-validation-error"),J("#signdlg-password-cont-error-message").hide()):(J("#signdlg-password-cont-error-message").html(J.i18n("writer.sign.VERIFICATION_CODE_ERROR_MESSAGE")),J("#signdlg-password-cont-error-message").show(),p.addClass("ui-validation-error"),i=!0);break;case E.EMAIL:"in_person_sign"===e.role&&0==MailMergeUtil.getEmailsFromTokenField(l).length?(J("#signdlg-in-person-email-cont-error-message").html(J.i18n("writer.sign.VERIFICATION_CODE_ERROR_MESSAGE")),J("#signdlg-in-person-email-cont-error-message").show(),l.addClass("ui-validation-error"),i=!0):(l.removeClass("ui-validation-error"),J("#signdlg-password-cont-error-message").hide())}return!i},N=function(e,i){i.state?(i.fromui&&(m[t]={verify_recipient:!0}),n.enable(),l.enable(),d.enable(),u.enable(),p.enable()):(i.fromui&&(m[t]={verify_recipient:!1}),n.disable(),l.disable(),d.disable(),u.disable(),p.disable())},P=function(){"password"===p[0].type?(p[0].type="text",J("#signdlg-password-show-cont").text(J.i18n("writer.common.HIDE")),J("#signdlg-password-copy-cont").removeClass("ui-state-disabled")):(p[0].type="password",J("#signdlg-password-show-cont").text(J.i18n("writer.common.SHOW")),J("#signdlg-password-copy-cont").addClass("ui-state-disabled"))},C=function(){DomUtil.isCopySupported()&&(p[0].select(),document.execCommand("copy"),J("#signdlg-password-copy-cont").text(J.i18n("writer.common.COPIED")),setTimeout(function(){J("#signdlg-password-copy-cont").text(J.i18n("writer.common.COPY"))},5e3))},y=function(){return m},F=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},M=function(e){for(var t=0;t<e.length;t++){var i=e[t];if(!i.startsWith("$")&&!i.startsWith(UNICODE.MERGEFIELD_START)&&!F(i))return!1}return!0},w=function(){J("#signdlg-in-person-email-cont-error-message").hide()},x=function(e,t){var i=e.target,n=J("#signdlg-in-person-email-cont-error-message"),o=MailMergeUtil.getEmailsFromTokenField(i);return M(o)?(n.hide(),t.element.parent().addClass("ui-single-sign-signer-cont"),void l.removeClass("ui-validation-error")):(i.ztokenfield("removeAllTokens"),i.focus(),n.text(J.i18n("writer.sign.SIGNER_EMAIL_INVALID")).show(),void l.addClass("ui-validation-error"))},B=function(e,t){t.element.parent().removeClass("ui-single-sign-signer-cont")},H=function(e){m=JSON.parse(JSON.stringify(e))};window.SignPassCodeDlgHandler={open:R,handleVerifyRecipientToggle:N,handePasswordEyeClick:P,copyOffineCode:C,getVerificationInfo:y,beforeSearch:w,afterTokenAdd:x,afterTokenRemove:B,updateVerificationInfo:H}}(),function(){"use strict";var e,t={ZOHOSIGN:1},i={},n=["en","es","ja","ru","pl","fr","it","de","nl","sv","zh","pt"],o=function(e){var t=new Deferred,n=t.promise(),o=ZWNetworkUtils.getUrl("sign/"+e+"/accountdetails");return J.ajax({type:"POST",global:!1,async:!0,url:o,data:ZWNetworkUtils.setDefaultParams(),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},dataType:"json",success:function(n){var o=n.settings||{};o.upgradeUrl=c(e);var a=o.total_limit;if(a!=-1){var s=o.used_count,l=a-s;o.available_limit=l}i[e]=o,r(o),t.resolve(o)},error:function(e,i,n){t.resolve(null)}}),n},r=function(e){J(".js-signer-type-select").zselectbox("setOptionAttributes","in_person_sign","disabled",!1),J(".js-signer-type-select").zselectbox("setOptionAttributes","approve","disabled",!1),e&&e.available_features&&(e.available_features.in_person_signing||J(".js-signer-type-select").zselectbox("setOptionAttributes","in_person_sign","disabled",!0),e.available_features.approver_role||J(".js-signer-type-select").zselectbox("setOptionAttributes","approve","disabled",!0))},a=function(e){return!!n.contains(e)},s=function(e){return i[e]||{}},l=function(e,t,i){var n=ZWNetworkUtils.getUrl("sign/"+e+"/profiledetails");J.ajax({type:"POST",global:!1,async:!0,url:n,data:ZWNetworkUtils.setDefaultParams(),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},dataType:"json",success:function(e){var i=e.profile||{};t&&t(i)},error:function(e,t,n){i&&i()}})},d=function(e,t){var n=i[e];n.used_count=n.used_count+t,i[e]=n},c=function(e){switch(e){case t.ZOHOSIGN:return editorProps.options.zohoSignLoginUrl+"/zs#/admin/license";default:return null}},u=function(){return window.location.href.split("/writer/")[0]},p=function(e){switch(e){case t.ZOHOSIGN:return editorProps.options.zohoSignLoginUrl+"/zs?frameorigin="+u()+"#/settings/profile?internal=true&service=ZohoWriter";default:return null}},g=function(e){var t=p(e),i={init:function(){J("#zsign-insert-btn").disable(),J("#sign-login-iframe").attr("src",t)}};J.dialogutil.open("zsigndialog",null,i)},f=function(){return function(){UIUtils.showLoadingMsg(J.i18n("writer.mailmergepopup.PROCESSING"));var e=SignHandler.SIGN_SERVICE.ZOHOSIGN,t=o(e);t.done(function(t){if(t&&t.linked){var i={},n={};n.recipients=[{action_type:"sign",language:"en",recipient_1:editorProps.userInfo.email,recipient_name:editorProps.userInfo.fullName,is_embedded:!0}],n.title=editor.doc.docInfo.DOCUMENT_NAME||"",n.email_reminders=!0,n.expiration_days="15",n.is_sequential=!1,n.message="",n.reminder_period="5",n.savevalues=!1,n.service_no=1,n.subject="",i.actioninfo=JSON.stringify(n),_(i)}else UIUtils.hideLoadingMsg(),SignHandler.handleLogin(e)})}}(),E=function(e){J("#sign-yourself-iframe").attr("src",e)},T=function(e){e&&""!==e&&(J.dialogutil.open("signyourselfdialog",null,{init:E.bind(null,e)}),PubSub.publish("Document/SignWorkflowInitiated"))},m=function(t){e=t},h=function(t){return e},I=function(){var e=h(),t=J("#sign-yourself-btn");if(t.length){var i=parseInt(t.find(".zbutton__badge")[0].innerText)||0;e===J("#sign-yourself-iframe")[0].src?t.znotificationmenubutton("setAttribute","badgeText",i+1):t.znotificationmenubutton(i?"showBadge":"hideBadge")}},_=function(){var e=function(e){if(UIUtils.hideLoadingMsg(),"string"==typeof e&&(e=JSON.parse(e)),DialogHandler.isDialogOpened("signdlg")){if(SignDlgHandler.hideProgressLoadingMsg(),SignDlgHandler.close(),e.signSettings){var t=JSON.parse(e.signSettings);t.common_attachments=t.cattachmentsInfo,PrepareDocumentHandler.setValues(t,PREPARE_DOCUMENT.OPERATION.SIGN)}var i=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.SIGN)||{};i.jobs_count=(i.jobs_count||0)+1,PrepareDocumentHandler.setValues(i,PREPARE_DOCUMENT.OPERATION.SIGN)}var n=e.sign_url;m(n),T(n)},t=function(e,t,i){if(UIUtils.hideLoadingMsg(),DialogHandler.isDialogOpened("signdlg")){SignDlgHandler.hideProgressLoadingMsg();var n=JSON.parse(e);if(n.signSettings){var o=JSON.parse(n.signSettings);o.common_attachments=o.cattachmentsInfo,PrepareDocumentHandler.setValues(o,PREPARE_DOCUMENT.OPERATION.SIGN)}n.error_msg?SignDlgHandler.showNotificationMsg(n.error_msg):SignDlgHandler.isDialogOpened()?SignDlgHandler.showNotificationMsg(J.i18n("writer.common.SIGN_INITIATION_FAILED")):UIUtils.showToast({message:J.i18n("writer.common.SIGN_INITIATION_FAILED"),hideDelay:3e3,type:"error"})}else UIUtils.showToast({message:J.i18n("writer.common.SIGN_INITIATION_FAILED"),hideDelay:3e3,type:"error"})};return function(i){var n=editor.doc.docInfo.RID,o=ZWNetworkUtils.getNiceUrlPrefix(n)+"/digisign/selfsign";if(!i){var i=SignDlgHandler.getSignInfo(),r=JSON.parse(i.actioninfo);r.recipients[0].recipient_1===editorProps.userInfo.email&&(r.recipients[0].is_embedded=!0),i.actioninfo=JSON.stringify(r)}DialogHandler.isDialogOpened("signdlg")&&SignDlgHandler.showProgressLoadingMsg(J.i18n("writer.mailmergepopup.PROCESSING")),J.ajax({type:"POST",url:o,data:i,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:e,error:t})}}();window.SignHandler={SIGN_SERVICE:t,fetchAccountDetails:o,getAccountDetails:s,getProfileDetails:l,decreaseLimit:d,handleLogin:g,isSignSupportedLanguage:a,handleInAppSigning:f,openSelfSign:T,closeSelfSigndlg:I}}(),InsertShape.modifiedOnKeys=!1,InsertShape.skipMoveCursor=!0,InsertShape.isChangeShape=!1,InsertShape.fontColor=[235,43,51],InsertShape.pastedShapes=[],InsertShape.mergeWithFormats={},InsertShape.groupShapeProps=["wraptype","fliph","flipv","rotateClk","rotateAntiClk"],InsertShape.currentTheme=null,InsertShape.isCtrlKeyPressed=!1,InsertShape.duplicateMode=!1,InsertShape.defaultData={TEXTBOX:'{"nvOProps":{"nvDProps":{"id":""}},"props":{"transform":{"fliph":false,"flipv":false,"dim":{"width":316,"height":117},"pos":{"left":252,"top":146,"zindex":0},"rotate":0},"geom":{"type":"PRESET","preset":{"type":"RECT"}},"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}}}},"themeRef":{"fillRef":{"ref":"THEME","color":{"type":"A1"}},"strokeRef":{"ref":"THEME","color":{"type":"A1","tweaks":{"shade":0.5}}},"fontRef":{"ref":"MINOR","color":{"type":"CUSTOM","rgb":[255,255,255]}}},"textBody":{"paras":[{"portions":[{"t":"","props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}},"unmerged":{"props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}}}}],"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}},"listStyle":{"bullet":{"type":"NONE","status":"disabled"}}},"unmerged":{"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}}}},"listNum":false}],"props":{"column":{"num":1,"gap":0},"valign":"TOP","inset":{"left":10,"right":10,"top":5,"bottom":5},"autoFit":{"type":"NONE"},"wrap":"NONE"},"element":"","id":"textcontainer"},"type":"SHAPE","editable":true,"textBox":true,"containerDim":{"width":"1000","height":"1000"}}',SHAPE:'{"nvOProps":{"nvDProps":{"id":""}},"props":{"transform":{"fliph":false,"flipv":false,"dim":{"width":88,"height":76},"pos":{"left":0,"top":0,"zindex":1},"rotate":0},"geom":{"type":"PRESET","preset":{"type":"RECT"}},"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[137,191,74]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE","solid":{"color":{"type":"A1","rgb":[112,154,63]}}}}},"themeRef":{"fillRef":{"ref":"THEME","color":{"type":"A1"}},"strokeRef":{"ref":"THEME","color":{"type":"A1","tweaks":{"shade":0.5}}},"fontRef":{"ref":"MINOR","color":{"type":"CUSTOM","rgb":[255,255,255]}}},"textBody":{"paras":[{"portions":[{"t":"","props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}},"unmerged":{"props":{"size":18,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}}}}],"style":{"halign":"CENTER","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}},"listStyle":{"bullet":{"type":"NONE","status":"disabled"}}},"unmerged":{"style":{"halign":"CENTER","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}}}},"listNum":false}],"props":{"column":{"num":1,"gap":0},"valign":"MIDDLE","inset":{"left":10,"right":10,"top":5,"bottom":5},"autoFit":{"type":"NONE"},"wrap":"NONE"},"element":"","id":"textcontainer"},"type":"SHAPE","editable":true,"containerDim":{"width":"1000","height":"1000"}}'},InsertShape.clearBbox=function(){},InsertShape.writerShowThemeMap={zwaccent1:"A1",zwaccent2:"A2",zwaccent3:"A3",zwaccent4:"A4",zwaccent5:"A5",zwaccent6:"A6",zwlight1:"BG1",zwlight2:"BG2",zwdark1:"TX1",zwdark2:"TX2"},InsertShape.initShapeMenu=function(){InsertShape.reinitShapeMenu("#duplicateshapebtn","#changeshape"),J("#menuShapes").is(":visible")?(InsertShape.reinitShapeMenu("#ins_shape","#insertshape"),InsertShape.isChangeShape?(J("#changeshape").zmenu("show"),J("#duplicateshapebtn").addClass("is-selected")):(J("#insertshape").zmenu("show"),J("#ins_shape").addClass("is-selected"))):(InsertShape.reinitShapeMenu("#ins-lpnl-shapes","#insertshape"),J("#insertshape").zmenu("show"),J("#ins-lpnl-shapes").addClass("is-selected"))},InsertShape.reinitShapeMenu=function(e,t){var i=J(t);i.zmenu("destroy"),i.zmenu({forElement:e}),i.zmenu("showAllMenuItems"),i.zmenu("removeMenuItems",[J("#textbox-template-loadingmsg")])},InsertShape.themeColors={red:{bg:[253,108,110],br:[202,84,86]},green:{bg:[137,191,74],br:[112,154,63]},orange:{bg:[248,150,40],br:[202,84,86]},blue:{bg:[164,205,255],br:[65,144,242]},darkred:{bg:[216,119,128],br:[167,104,107]},darkblue:{bg:[62,130,169],br:[28,92,145]},white:{bg:[255,255,255],br:[0,0,0],txtclr:[0,0,0]}},InsertShape.changeShape=function(){return InsertShape.isChangeShape=!0,J("#basicshapesmenu")[0]||InsertShape.showTextboxJSLoadingMsg("changeshape"),!0},InsertShape.insertShapeMenu=function(){return InsertShape.isChangeShape=!1,J("#basicshapesmenu")[0]||InsertShape.showTextboxJSLoadingMsg("insertshape"),!0},InsertShape.drawShape=function(e){var t=e[0],i=DocumentDesign.getTheme();if("text"!=t||"text"==t&&editor.doc.getSelection().isCollapsed()){InsertShape.updateShapeText(),InsertShape.clearSelection();var n=(e[1],{shapeObjType:"SHAPE",shapeGeoType:"PRESET",action:t,type:t,theme:{}});"text"!=t&&"SCRIBBLE"!=t&&"LINE"!=t&&"ELBOW_CONNECTOR3"!=t&&"CURVED_CONNECTOR3"!=t&&(n.theme.bg=InsertShape.getRGBArray(i.color.accent1)),"text"==t?(J(".ui-textbox").addClass("ui-state-highlight"),t="RECT",InsertShape.isTextBox=!0,EditorUtil.focusMultiByteSpan(),ZWLogger.addToStatistics("TextBox"),n.theme.bg=["255","255","255"],n.theme.br=["0","0","0"],n.theme.txtclr=["0","0","0"],n.action=t,n.type=t):(J(".ui-textbox").removeClass("ui-state-highlight"),InsertShape.isTextBox=!1,ZWLogger.addToStatistics("Shape"),n.theme.br=InsertShape.getRGBArray(Utils.getColorValFromRefString(SHAPE.THEME.BR_COLOR))),n.theme.fontFamily=Utils.getThemeFonts(i)[0].toLowerCase();var o=Z("inner_shape");Z("editorpane-container");"LINE"==t||"ELBOW_CONNECTOR3"==t||"CURVED_CONNECTOR3"==t?(n.subType=e[2],n.shapeObjType="CONNECTOR"):"SCRIBBLE"==t&&(n.shapeGeoType="CUSTOM",n.shapeObjType="SHAPE",n.theme.txtclr=[0,0,0]),J.ShapeData.setShapeDetails(n),InsertShape.isDrawingMode=!0,ShapeEditor.config.container=o,o.css({display:"block",cursor:"crosshair"})}else{var r=InsertShape.getDefaultShapeData("TEXTBOX");InsertShape.updateTransformPropWithOverlayOffset(r),InsertShape.pushSelectedTextToShape(r),r.wrapType="square",r[ATTR_IMAGE.I_MR]=r[ATTR_IMAGE.I_MT]=r[ATTR_IMAGE.I_ML]=r[ATTR_IMAGE.I_MB]=InsertShape.constant.DEFAULT_MARGIN_RIGHT_VAL,InsertShape.insertShape(r),InsertShape.select.shape(r)}},InsertShape.getCopyInfo=function(){var e={html:"",text:""};if(InsertShape.updateShapeText(null,!0),ShapeEditor.text.isEditable()){var t=ShapeEditor.text.editor.selectedText();if(t){var i=document.createElement("SPAN");i.innerText=t,e.html="<span>"+i.innerHTML+"</span>",e.text=t}}else e=InsertShape.getSelectedShapesCopyInfo();return e},InsertShape.getSelectedShapesCopyInfo=function(){var e="",t="";if(InsertShape.getSelectedShape())return InsertShape.getSelectedShapesArray().forEach(function(i){var n=i.data.nvOProps.nvDProps.id;if(i.shapetype!=InsertShape.constant.WATERMARK&&!i.dropcapData){var o=(J("#"+n).parents("div.zw-paragraph")[0],InsertShape.getShapeNodeData(n).shapenode);if(null!=o){var r=o.getStart(),a=editor.doc.createRange(r,r+1),s=CopyEventHandler.getCopiedInfo(a);e+=s.html,t+=s.text}}}),{html:e,text:t}},InsertShape.getShapeIdx=function(e){var t="string"==typeof e?e:e.parentIds&&e.parentIds[0]||(e.data||e).nvOProps.nvDProps.id,i=InsertShape.getShapeNodeData(t),n=i.index;return n},InsertShape.getShapeNodeData=function(e){for(var t={},i=InsertShape.getShapesInPara(e),n=i.length,o=null,r=-1,a={},s={},l=0;l<n;l++){var d=i[l].getStart(),a=DocUtil.copyStyle(editor.doc.getRawFormatAt(d)),c=a[ATTR_IMAGE.I_SHAPEDATA];if(c){var u=c.nvOProps.nvDProps.id;if(u==e){o=i[l],r=d,s=c;break}}}return t.shapenode=o,t.index=r,t.shapedata=s,t.format=a,t},InsertShape.addSubscribers=function(){PubSub.subscribe("Document/SwitchSection",InsertShape.clearSelection),PubSub.subscribe("Document/FinalStateModified",InsertShape.updateShapeEditableProperties),PubSub.subscribe("DocOperation/AfterPaste",InsertShape.processAfterPaste),PubSub.subscribe(["Document/ViewChanged",DOCVIEW.CURRENT_GROUP_LAYOUT_CHANGED,"Document/themeChanged"],InsertShape.clearCache),PubSub.subscribe(["Document/Resize","Document/Zoom"],InsertShape.editorResizeHandler),PubSub.subscribe("Cursor/Collapsed",InsertShape.handleCursorCollapsed),PubSub.subscribe("Document/Shape/RemoveWatermark",InsertShape.removeWatermarkDom),PubSub.subscribe("Shapes/OpenToolbar",InsertShape.openToolbar),PubSub.subscribe("Shapes/CloseToolbar",InsertShape.closeToolbar),PubSub.subscribe("TransformableObject/Resize/Active",ShapesVisualCueHandler.showContextMenu)},InsertShape.editorResizeHandler=function(){InsertShape.updateShapeText(),InsertShape.clearSelection(),InsertShape.closeToolbar()},InsertShape.shapeBindEvents=function(){if(editor.getRole().permissions.can("document.edit")){InsertShape.updateShapeEditableProperties();var e=J("#drawcontainer");e.on("mousedown",".shape_box.bbox",function(){J(this).attr("data-context","Rmenu")}),e.bind("keydown",function(e){e.keyCode==KEYS.ESC&&(InsertShape.updateShapeText(),InsertShape.closeToolbar(),InsertShape.showEditorCursor(),EditorUtil.focusMultiByteSpan())}),e.bind("shape_selected",function(e,t){var i=InsertShape.getSelectedShape();PubSub.publish("ZWShape/Selected"),i&&!i.data.dropcapData&&InsertShape.updateToolbar()}),e.bind("mouseup",function(e,t){"svg"!=e.target.nodeName&&"path"!=e.target.nodeName&&(InsertShape.isDrawingMode=!1),PubSub.publish("Gridlines/hide")}),e.bind("modified",function(e,t){InsertShape.shapeModified(e,t)}),e.bind("text_modified",function(e,t){InsertShape.textModified(e,t)}),e.bind("shape_created",function(e,t){InsertShape.shapeCreated(e,t)})}},InsertShape.textModified=function(e,t){InsertShape.textBoxData||(InsertShape.isTextModified=t.textData[0].shapeData.id)},InsertShape.shapeModified=function(e,t){var i=[],n=[];t.shapeData.forEach(function(e){var t=e.id;delete InsertShape.shapeCache[t];var o=e.data.data.props;if(o){var r=o.transform;InsertShape.modifiedOnKeys&&PubSub.publish("Gridlines/hide");var a=InsertShape.getShapeDom(t);if(a){var s=JSON.stringify(InsertShape.getShapeData(t)),l=JSON.parse(s),d=JSON.parse(s);o.geom&&(d.props.geom=o.geom,InsertShape.duplicateMode=!1);var c=InsertShape.getShapeParaDOMNode(t),u=InsertShape.getShapeNodeData(t),p=u.shapenode,g=null,f=null,E=null;if(null!=p){if(r){InsertShape.modifiedOnKeys&&(r.pos.top+=l.props.transform.pos.top,r.pos.left+=l.props.transform.pos.left,InsertShape.changeRelativeToContainer(c,r),InsertShape.modifiedOnKeys=!1);var T=InsertShape.getClosestParaOnOffset(r.pos,!0);if(E=DomViewManager.getDocView(T),f=DomViewManager.getDocView(c),E&&E.id!=f.id&&!d.lockAnchor?(c=DomViewManager.getDOMElem(E),g=E):g=f,r.pos){var m=d.props.transform;r.pos.zindex=m.pos.zindex,m.pos=r.pos,r.dim&&(m.dim=r.dim),void 0!=r.rotate&&(m.rotate=r.rotate),void 0!=r.fliph?m.fliph=r.fliph:"CONNECTOR"==d.type&&(m.fliph=!1),void 0!=r.flipv?m.flipv=r.flipv:"CONNECTOR"==d.type&&(m.flipv=!1),InsertShape.updateShapePosition(d,g,T),JSON.stringify(d.props.transform.dim)==JSON.stringify(l.props.transform.dim)&&d.props.transform.rotate==l.props.transform.rotate||(InsertShape.duplicateMode=!1)}if(InsertShape.isTextModified){var h=InsertShape.getSelectedShape().data.textBody;d.textBody=h,InsertShape.isTextModified=null}d.dropcapData?InsertShape.handleDropcapModified(d):d.shapetype==InsertShape.constant.WATERMARK&&(d=Watermark.modify(d))}var I=g?g.getNode():null,_=f?f.getNode().getIndex():p.getStart();if(I&&I.getIndex()!=_){if(n.length&&(InsertShape.applyStyle(n,!1),n=[]),InsertShape.duplicateMode)InsertShape.applyStyle(l,!1),InsertShape.moveCursorIdx(I.getIndex()),InsertShape.renewShape(d),InsertShape.insertShape(d);else{var A=u.index,S=editor.doc.createRange(A,A+1);S.setFocus(!1),editor.doc.getSelection().removeAllRanges().addRange(S).deleteSelectedContents(null,!0),InsertShape.removeFromCache(t),InsertShape.moveCursorIdx(I.getIndex()),InsertShape.insertShape(d)}i.push(d)}else InsertShape.duplicateMode?(n.push(l),n.length&&(InsertShape.applyStyle(n,!1),n=[]),InsertShape.moveCursorIdx(_),InsertShape.renewShape(d),InsertShape.insertShape(d)):n.push(d),i.push(d)}}}}),n.length&&(InsertShape.applyStyle(n,!1),n=[]),InsertShape.modifiedOnKeys=!1,InsertShape.select.shape(i),InsertShape.openToolbar(i[0]),J("#inner_shape").css({width:"0",height:"0px"})},InsertShape.handleDropcapModified=function(e){"MARGIN"==e.dropcapData.type&&InsertShape.updateDropcapPosition(e,"MARGIN",!0);var t=e.textBody.paras[0].portions[0],i=e.props.transform.dim.height,n="normal"==e.dropcapData.style?InsertShape.getProportionalSize(i):i/2;return t.props.size=n,t.unmerged&&(t.unmerged.props.size=n),e.props.transform.rotate=0,InsertShape.duplicateMode=!1,e},InsertShape.shapeCreated=function(e,t){InsertShape.isTextBox&&(t.textBox=!0),J(".ui-textbox").removeClass("ui-state-highlight"),t[ATTR_IMAGE.I_MR]=t[ATTR_IMAGE.I_MT]=t[ATTR_IMAGE.I_ML]=t[ATTR_IMAGE.I_MB]=InsertShape.constant.DEFAULT_MARGIN_RIGHT_VAL,InsertShape.processShape(t),PubSub.publish("Gridlines/hide")},InsertShape.processShape=function(e){e.data&&(e=e.data);var t=InsertShape.getClosestParaOnOffset(e.props.transform.pos),i=DomViewManager.getDocView(t),n=InsertShape.updateShapePosition(e,i,t),o=DocUtil.getDocElement(t);InsertShape.moveCursorIdx(o.getStart());var r=(editor.doc.getSelection().getStart(),editor.doc.getDomCursorNode(editor.uuid,"start"));r.css("border-left-style","");var a=e.nvOProps.nvDProps.id;e.props.transform.pos.top=n.top,e.props.transform.pos.left=n.left,e.textBody&&(e.textBody.element=""),e=InsertShape.updateToShapeThemeNames(e,InsertShape.isTextBox?"textboxcreation":null),J("#"+a).remove(),ShapeEditor.bbox.shape={bbox:{},handles:{crop:[],shape:[]}},e.props.transform.pos.zindex=InsertShape.getZindex(),e.containerDim={width:"1000",height:"1000"},InsertShape.insertShape(e),editor.editorPaneContainer.css("cursor",""),InsertShape.openToolbar(InsertShape.getShapeData(a)),InsertShape.select.shape(a),e.textBox&&InsertShape.editShape()},InsertShape.isPlaceHolderNeeded,InsertShape.placeHolderText,InsertShape.insertShape=function(e){e.data&&(e=e.data),InsertShape.isPlaceHolderNeeded&&(e.nvOProps.nvProps={placeHolder:{type:"TITLE",relId:Math.uuid()}},e.placeHolder={text:InsertShape.placeHolderText,doNotUpdate:!1});var t=InsertShape.copyShapedataToFormats(e);if(e.textBody)for(var i=e.textBody.paras,n=0;n<i.length;n++)for(var o=i[n].portions,r=0;r<o.length;r++){var a=o[r];if(a.mminfo){t.mminfos||(t.mminfos={}),t.mminfos[a.mminfo.id]=a.mminfo;break}}editor.doc.execCmd("insimg",[t]),editor.jeditorPane.children(".zw-page").css("cursor","")},InsertShape.updateShapePosition=function(e,t,i){e.props.transform.dim.height/=editor.zoomFactor,e.props.transform.dim.width/=editor.zoomFactor,e.props.transform.pos.top/=editor.zoomFactor;var n=PUtil.offset(i),o=e.props.transform.pos.top-n.top,r=(PUtil.offset(i).left-editor.jeditorPane.offset().left)*editor.zoomFactor,a=editor.jeditorPane.offset().left-Z("ui-editor-outer-div").offset().left,s=(e.props.transform.pos.left-(a+r))/editor.zoomFactor,l=DocLayoutManager.getViews(t.getNode());if(l.length>0)for(var d=0;d<l.length&&l[d].id!=t.id;d++)o+=l[d].height;var c=editor.jeditorPane.find(".zw-page").css("border"),u=0;return c&&(u=c.split(" ")[0].convertor().pixels),e.props.transform.pos.top=o-u,e.props.transform.pos.left=s-u,e.props.transform.pos},InsertShape.processParaFormat=function(e){for(var t=e[0],i=e[1]||"",n=[],o={at:"update",ut:"para",si:0,ei:0,value:{value:{}}},r=InsertShape.getSelectedShapesArray(),a=r.length,s=a>1,l=0;l<a;l++){var d=r[l];if(a>1&&(InsertShape.clearBbox(),InsertShape.select.shape(d),InsertShape.editShape(-1)),"Align"==t)"Left"==i?o.value.value={halign:"LEFT"}:"Right"==i?o.value.value={halign:"RIGHT"}:"Center"==i&&(o.value.value={halign:"CENTER"});else if("SetLineSpacing"==t){var c={line:{percent:i,type:"PERCENT"}};o.value.value={spacing:c}}else if(t.indexOf("dent")>-1){var u=ShapeEditor.text.editor._getFromTo(),p=u.from.num.para;p||(InsertShape.editShape(-1),p=ShapeEditor.text.editor._getFromTo().from.num.para);var g=InsertShape.getSelectedShape().data.textBody.paras[p].style,f=g.level;f?"indent"==t?(f+=1,o.value.value.margin={left:g.margin.left+10}):(f=f<0?0:f-1,o.value.value.margin={left:g.margin.left<0?0:g.margin.left-10}):(o.value.value.level=1,o.value.value.margin={left:0})}var E=ShapeEditor.text.editor.cursor.getIndex();E.si||(InsertShape.editShape(-1),E=ShapeEditor.text.editor.cursor.getIndex()),E.si&&(o.si=E.si),E.ei&&(o.ei=E.ei),n.push(o),ShapeEditor.text.editor.changeStyle(n),InsertShape.applyStyle(InsertShape.getSelectedShape(),!0),s||(d.parentIds[0]?InsertShape.select.shape(d.parentIds[0]):(InsertShape.select.shape(d.data.nvOProps.nvDProps.id),InsertShape.editShape(E.si,E.ei)))}},InsertShape.processTxtFormat=function(e){for(var t=e[0],i=e[1]||"",n=editor.doc.getSelection().getStart(),o=editor.doc.getRawFormatAt(n).shapeData,r=o.textBody.paras,a=0;a<r.length;a++)for(var s=r[0],l=s.portions,d=0;d<l.length;d++){var c=l[d];if("bold"==t){var u="BOLD"==c.props.fontweight,p="";p=u||"BOLD"==c.props.fontweight||"HEAVY"==c.props.fontweight||"BLACK"==c.props.fontweight?"NORMAL":"BOLD",c.props.fontweight=p}else if("italic"==t){var g=c.props.italic;c.props.italic=!g}else if("underline"==t){var f=c.props.underline;c.props.underline="SINGLE"==f?"NONE":"SINGLE"}else if("forecolor"==t){var E="selectedColor"==i?InsertShape.fontColor:i;InsertShape.fontColor=E,c.props.fill={type:"SOLID",solid:{color:{rgb:E}}}}else if("fontsize"==t){if("number"!=typeof i){c.props.size;"increasefontsize"==i?i=DocUtil.getNextFontSize(parseInt(c.props.size)):"decreasefontsize"==i&&(i=DocUtil.getPrevFontSize(parseInt(c.props.size)))}c.props.size=i}else if("FontName"==t){var T=i[0].split(",")[0];if("zwmajor"!=T&&"zwminor"!=T){var m,h=Utils.getCustomFont(T);T=h?h.name:T,(m=FontUtils.getWebFont(h?h.fallback:T))&&(T=(h?h.name+",":"")+m.getFontName())}var I="NORMAL";i.length>1&&(I=i[1],I=SHOW_FONT_WEIGHT_MAP[I]),c.props.font.fontFamily.name=T,c.props.fontweight=I}else"strikethrough"==t?c.props.strike="SINGLE"==c.props.strike?"NONE":"SINGLE":"superscript"==t?c.props.baseline=.3==c.props.baseline?0:.3:"subscript"==t&&(c.props.baseline=c.props.baseline==-.25?0:-.25);c.unmerged.props=c.props}InsertShape.applyStyle(o)},InsertShape.getShapeParaDOMNode=function(e){var t=null,i=Shapes.getShapeFromCache(e),n=JSON.parse(i[0]);if(n){var o=n.wrapType||"front";if("front"!=o&&"behind"!=o){var r=editor.clientActiveSection.className;t=(r.indexOf("header")!=-1||r.indexOf("footer")!=-1)&&J(editor.clientActiveSection).find("#"+e).length>0?J(editor.clientActiveSection).find("#"+e).parents("div.zw-paragraph")[0]:J("#"+e).parents("div.zw-paragraph")[0]}else{var a=J("#"+e).parents("div.fgImgOuterDiv")[0],s=a.getAttribute("pid"),l=J(a).parents("div.zw-paragraph")[0];if(!s&&l){var r=editor.clientActiveSection.className;t=(r.indexOf("header")!=-1||r.indexOf("footer")!=-1)&&J(editor.clientActiveSection).find("#"+e).length>0?J(editor.clientActiveSection).find("#"+e).parents("div.zw-paragraph")[0]:J("#"+e).parents("div.zw-paragraph")[0]}else{for(var d=DocTreeManager.getTreeNodeById(s),c=DocLayoutManager.getViews(d),u=n.props.transform.pos.top,p=0,g=0;c[p]&&(g+=c[p].getHeight(),!(u<=g)&&c[p+1]);)p++;var f=c[p];t=DomViewManager.getDomFromCurrentPage(f)}}return t}},InsertShape.modifyShapeProperty=function(e,t){var i=e[0],n=e[1];ZWLogger.addToStatistics("ShapeStyle_"+i);var o=t.nvOProps.nvDProps.id,r=t.props;if("borderstyle"==i)"NONE"==n?r.stroke.width=0:(0==r.stroke.width&&(r.stroke.width=2),r.stroke.type=n);else if("fillcolor"==i)InsertShape.updateFillInZWtheme(i,n,t);else if("strokecolor"==i)InsertShape.updateFillInZWtheme(i,n,t);else if("opacity"==i){var a=("CONNECTOR"==t.type?t.props.stroke.fill:t.props.fill)||{type:"NONE"};"PICT"==a.type?a.pict.props?a.pict.props.alpha=n:a.pict.props={alpha:n}:"NONE"!=a.type&&"PICT"!=a.type&&(a.solid.color.tweaks={alpha:n})}else if("borderwidth"==i)r.stroke.width=parseInt(n);else if("shadow"==i)if("NONE"!=n){var s={type:"OUTER",color:{type:"CUSTOM",rgb:[91,91,91],tweaks:{alpha:.6}},distance:{radius:10,angle:n},preset:"PRESET1",blur:{radius:4}};r.effects?r.effects.shadow=s:r.effects={shadow:s}}else delete r.effects.shadow;else if("reflection"==i)if("NONE"!=n){var l={distance:{radius:n[0]},pos:{end:n[1]},alpha:{st:n[2]},preset:n[3]};r.effects?r.effects.reflection=l:r.effects={reflection:l}}else delete r.effects.reflection;else if("changeshape"==i&&"SHAPE"==t.type)r.geom.preset.type=n,InsertShape.isChangeShape=!1;else if("resetshapeproperty"==i)t.textboxTemplate?t=TextBoxTemplates[t.textboxTemplate]:(r.effects={},r.effects.reflection={},r.stroke.width=1,r.stroke.type="SOLID",r.stroke.fill={type:"SOLID",solid:{color:{type:"A1",rgb:SHAPE.THEME.BR_COLOR}}},r.fill={type:"SOLID",solid:{color:{type:"A1",rgb:SHAPE.THEME.BGC_COLOR}}},r.transform.rotate=0);else if("fillimage"==i&&"SHAPE"==t.type){var d=n[0],c=Utils.isWebImage(d),u=c?d:editor.getBaseURL()+"/"+n[0],p=t.props.transform.dim.width,g=t.props.transform.dim.height,f='{"type":"PICT","pict":{"type":{"type":"FRAME"},"value":{"id":"'+o+'","type":"USERDEFINED","pictureName":"Image'+o+'.jpg","serverUrl":"'+u+'","url":"'+u+'","dim":{"width": '+p+',"height": '+g+'},"width":  '+p+' ,"height": '+g+"}}}";f=JSON.parse(f),r.fill=f,InsertShape.isShapeImage=!1,t.zwpictProps={dim:{width:n[1],height:n[2]}}}else"txtalign"==i&&t.textBody?t.textBody.props.valign=n[0]:"wraptype"==i?t.wrapType=n:"rotateClk"==i?r.transform.rotate+=90:"rotateAntiClk"==i?r.transform.rotate-=90:"rotation"==i?r.transform.rotate=n:"fliph"==i?r.transform.fliph=!r.transform.fliph:"flipv"==i?r.transform.flipv=!r.transform.flipv:"resetRotation"==i&&(r.transform.rotate=0);return t},InsertShape.changeShapeProperty=function(e){var t=ShapesUtil.getSelectedShapeFormat().shapeData,i=[];InsertShape.modifyShapeProperty(e,t),i.push(t),InsertShape.applyStyle(i,!0)},InsertShape.applyStyle=function(e,t,i,n){try{e.length||(e=[e]);for(var o=[],r=[],a=0;a<e.length;a++){var s=e[a],l=s.data||s,d=l.nvOProps.nvDProps.id;if(s.data&&s.parentIds[0]){for(var c=s.parentIds[0],u=InsertShape.getShapeData(c),p=u.shapes,a=0;a<p.length;a++){var g=p[a];if(g.nvOProps.nvDProps.id==d){p[a].textBody=InsertShape.getSelectedShape().data.textBody,p[a].textBody.element="";break}}l=u,d=c}var f=InsertShape.getShapeNodeData(d),E=f.shapenode,T=f.index;if(t){var T=f.index,m=editor.doc.getRawFormatAt(T).shapeData,h=l.props.transform.pos;h.top=m.props.transform.pos.top,h.left=m.props.transform.pos.left,l.props.transform.dim.height/=editor.zoomFactor,l.props.transform.dim.width/=editor.zoomFactor}l.textBody&&(l.textBody.element="");var I=InsertShape.copyShapedataToFormats(l,editor.doc.getRawFormatAt(T));f&&f.format[MAILMERGE.MMINFOS]&&(I[MAILMERGE.MMINFOS]=f.format[MAILMERGE.MMINFOS]),o.push(E),r.push(I)}InsertShape.mergeWithFormats={},InsertShape.isTextModified=null,editor.doc.execCmd("applyStyle",[o,r,i||"applyShapeFormat"])}catch(e){InsertShape.sendErrorMail(e)}},InsertShape.generateShapeMenu=function(e){var t=InsertShape.getDefaultShapeData("SHAPE"),i=["ARC","DOUBLE_BRACKET","DOUBLE_BRACE","LEFT_BRACKET","RIGHT_BRACKET","LEFT_BRACE","RIGHT_BRACE"],n=["RECTANGULAR_CALLOUT","ROUNDED_RECTANGULAR_CALLOUT","OVAL_CALLOUT","CLOUD_CALLOUT"],o={type:"SOLID",solid:{color:{type:"A1",rgb:[180,180,180]}}},r={type:"SOLID",captype:"FLAT",jointype:"ROUND",width:1.5,fill:{type:"SOLID",solid:{color:{type:"A1",rgb:[120,120,120]}}}},a={CURVE:{type:"CURVE",pathList:[{path:[{m:{x:33,y:15},type:"M"},{cc:[{x:33.1875,y:10.9375},{x:33.375,y:6.875},{x:32,y:5}],type:"CC"},{cc:[{x:30.625,y:3.125},{x:25.75,y:-.125},{x:22,y:0}],type:"CC"},{cc:[{x:20.25,y:.125},{x:12.28125,y:1.515625},{x:10,y:6}],type:"CC"},{cc:[{x:9.71875,y:10.484375},{x:12.21484375,y:32.185546875},{x:10,y:36}],type:"CC"},{cc:[{x:9.78515625,y:39.814453125},{x:4.892578125,y:40.4072265625},{x:0,y:41}],type:"CC"}],height:41,width:33}]},FREEFORM:{type:"FREEFORM",pathList:[{width:134.68661,height:91.70152,path:[{type:"M",m:{x:45.850815,y:1.4328609}},{type:"L",l:{x:116.05974,y:0}},{type:"L",l:{x:116.05974,y:20.059738}},{type:"L",l:{x:116.05974,y:20.059738}},{type:"CC",cc:[{x:112.238846,y:21.492598},{x:108.09627,y:22.258686},{x:104.59706,y:24.358215}]},{type:"CC",cc:[{x:103.12042,y:25.244198},{x:102.8338,y:27.333858},{x:101.73134,y:28.6568}]},{type:"CC",cc:[{x:100.43411,y:30.213438},{x:98.86572,y:31.522415},{x:97.43286,y:32.955276}]},{type:"CC",cc:[{x:96.14383,y:36.822258},{x:94.63412,y:38.786983},{x:97.43286,y:42.985092}]},{type:"CC",cc:[{x:98.38803,y:44.417953},{x:100.29848,y:44.89554},{x:101.73134,y:45.850815}]},{type:"CC",cc:[{x:102.686615,y:47.283676},{x:103.136795,y:49.23664},{x:104.59706,y:50.149292}]},{type:"CC",cc:[{x:107.15852,y:51.750237},{x:110.3284,y:52.05974},{x:113.194016,y:53.014908}]},{type:"CC",cc:[{x:122.92987,y:56.260155},{x:115.98195,y:54.44777},{x:134.68661,y:54.44777}]},{type:"L",l:{x:134.68661,y:78.805984}},{type:"L",l:{x:127.522415,y:90.26866}},{type:"L",l:{x:0,y:91.70152}},{type:"L",l:{x:0,y:34.388138}},{type:"L",l:{x:45.850815,y:1.4328609}},{type:"C",c:!0}]}]},SCRIBBLE:{type:"SCRIBBLE",pathList:[{width:180.51282,height:182.5641,path:[{type:"M",m:{x:143.58974,y:0}},{type:"L",l:{x:146.32478,y:0}},{type:"CC",cc:[{x:143.58974,y:0},{x:143.58974,y:0},{x:141.53847,y:0}]},{type:"CC",cc:[{x:137.4359,y:0},{x:135.38461,y:0},{x:133.33333,y:0}]},{type:"CC",cc:[{x:131.28206,y:0},{x:127.17949,y:0},{x:121.02564,y:0}]},{type:"CC",cc:[{x:118.97436,y:0},{x:116.92308,y:0},{x:114.871796,y:0}]},{type:"CC",cc:[{x:104.61539,y:0},{x:90.25641,y:0},{x:86.15385,y:0}]},{type:"CC",cc:[{x:84.10256,y:0},{x:82.051285,y:0},{x:80,y:0}]},{type:"CC",cc:[{x:77.948715,y:0},{x:69.74359,y:0},{x:61.53846,y:0}]},{type:"CC",cc:[{x:59.48718,y:0},{x:57.435898,y:0},{x:53.333332,y:0}]},{type:"CC",cc:[{x:43.076923,y:0},{x:38.974358,y:0},{x:38.974358,y:2.0512822}]},{type:"CC",cc:[{x:36.923077,y:2.0512822},{x:34.871796,y:2.0512822},{x:32.820515,y:2.0512822}]},{type:"CC",cc:[{x:30.76923,y:2.0512822},{x:28.717949,y:2.0512822},{x:28.717949,y:4.1025643}]},{type:"CC",cc:[{x:26.666666,y:4.1025643},{x:22.564102,y:6.1538463},{x:18.461538,y:10.256411}]},{type:"CC",cc:[{x:16.410257,y:10.256411},{x:16.410257,y:12.307693},{x:14.358974,y:12.307693}]},{type:"CC",cc:[{x:14.358974,y:14.358974},{x:12.307693,y:16.410257},{x:10.256411,y:16.410257}]},{type:"CC",cc:[{x:10.256411,y:18.461538},{x:8.205129,y:20.512821},{x:8.205129,y:22.564102}]},{type:"CC",cc:[{x:6.1538463,y:24.615385},{x:6.1538463,y:26.666666},{x:4.1025643,y:26.666666}]},{type:"CC",cc:[{x:4.1025643,y:28.717949},{x:4.1025643,y:30.76923},{x:2.0512822,y:30.76923}]},{type:"CC",cc:[{x:2.0512822,y:32.820515},{x:2.0512822,y:34.871796},{x:2.0512822,y:36.923077}]},{type:"CC",cc:[{x:0,y:36.923077},{x:0,y:38.974358},{x:0,y:41.025642}]},{type:"CC",cc:[{x:0,y:43.076923},{x:0,y:49.23077},{x:0,y:51.28205}]},{type:"CC",cc:[{x:0,y:53.333332},{x:0,y:55.384617},{x:0,y:57.435898}]},{type:"CC",cc:[{x:0,y:59.48718},{x:0,y:61.53846},{x:0,y:63.589745}]},{type:"CC",cc:[{x:0,y:65.64103},{x:0,y:67.69231},{x:0,y:69.74359}]},{type:"CC",cc:[{x:0,y:71.79487},{x:0,y:73.84615},{x:0,y:75.89744}]},{type:"CC",cc:[{x:2.0512822,y:75.89744},{x:2.0512822,y:77.948715},{x:4.1025643,y:80}]},{type:"CC",cc:[{x:6.1538463,y:82.051285},{x:6.1538463,y:84.10256},{x:8.205129,y:84.10256}]},{type:"CC",cc:[{x:8.205129,y:86.15385},{x:10.256411,y:86.15385},{x:10.256411,y:88.20513}]},{type:"CC",cc:[{x:12.307693,y:88.20513},{x:14.358974,y:88.20513},{x:16.410257,y:88.20513}]},{type:"CC",cc:[{x:18.461538,y:88.20513},{x:20.512821,y:88.20513},{x:22.564102,y:88.20513}]},{type:"CC",cc:[{x:26.666666,y:88.20513},{x:28.717949,y:88.20513},{x:34.871796,y:86.15385}]},{type:"CC",cc:[{x:36.923077,y:86.15385},{x:38.974358,y:86.15385},{x:41.025642,y:86.15385}]},{type:"CC",cc:[{x:41.025642,y:84.10256},{x:43.076923,y:84.10256},{x:45.128204,y:84.10256}]},{type:"CC",cc:[{x:47.179485,y:82.051285},{x:51.28205,y:80},{x:53.333332,y:80}]},{type:"CC",cc:[{x:55.384617,y:77.948715},{x:57.435898,y:77.948715},{x:59.48718,y:77.948715}]},{type:"CC",cc:[{x:59.48718,y:75.89744},{x:61.53846,y:75.89744},{x:61.53846,y:73.84615}]},{type:"CC",cc:[{x:63.589745,y:73.84615},{x:67.69231,y:71.79487},{x:69.74359,y:71.79487}]},{type:"CC",cc:[{x:71.79487,y:71.79487},{x:71.79487,y:69.74359},{x:73.84615,y:67.69231}]},{type:"CC",cc:[{x:75.89744,y:67.69231},{x:77.948715,y:65.64103},{x:80,y:65.64103}]},{type:"CC",cc:[{x:82.051285,y:65.64103},{x:82.051285,y:63.589745},{x:84.10256,y:61.53846}]},{type:"CC",cc:[{x:88.20513,y:61.53846},{x:92.30769,y:61.53846},{x:94.35897,y:61.53846}]},{type:"CC",cc:[{x:96.410255,y:61.53846},{x:96.410255,y:59.48718},{x:98.46154,y:59.48718}]},{type:"CC",cc:[{x:100.51282,y:59.48718},{x:106.666664,y:59.48718},{x:108.71795,y:59.48718}]},{type:"CC",cc:[{x:110.76923,y:57.435898},{x:114.871796,y:57.435898},{x:116.92308,y:57.435898}]},{type:"CC",cc:[{x:118.97436,y:57.435898},{x:121.02564,y:57.435898},{x:123.07692,y:57.435898}]},{type:"CC",cc:[{x:129.23077,y:57.435898},{x:131.28206,y:57.435898},{x:133.33333,y:57.435898}]},{type:"CC",cc:[{x:135.38461,y:57.435898},{x:137.4359,y:57.435898},{x:139.48718,y:57.435898}]},{type:"CC",cc:[{x:141.53847,y:57.435898},{x:145.64102,y:57.435898},{x:157.94872,y:59.48718}]},{type:"CC",cc:[{x:160,y:59.48718},{x:162.05128,y:59.48718},{x:164.10257,y:59.48718}]},{type:"CC",cc:[{x:166.15384,y:61.53846},{x:168.20512,y:61.53846},{x:170.25641,y:63.589745}]},{type:"CC",cc:[{x:174.35898,y:65.64103},{x:176.41026,y:67.69231},{x:176.41026,y:69.74359}]},{type:"CC",cc:[{x:178.46153,y:69.74359},{x:180.51282,y:69.74359},{x:180.51282,y:71.79487}]},{type:"CC",cc:[{x:180.51282,y:75.89744},{x:180.51282,y:77.948715},{x:180.51282,y:80}]},{type:"CC",cc:[{x:180.51282,y:82.051285},{x:180.51282,y:84.10256},{x:180.51282,y:86.15385}]},{type:"CC",cc:[{x:180.51282,y:88.20513},{x:180.51282,y:90.25641},{x:180.51282,y:92.30769}]},{type:"CC",cc:[{x:180.51282,y:94.35897},{x:178.46153,y:94.35897},{x:178.46153,y:96.410255}]},{type:"CC",cc:[{x:178.46153,y:98.46154},{x:176.41026,y:100.51282},{x:176.41026,y:102.5641}]},{type:"CC",cc:[{x:176.41026,y:104.61539},{x:174.35898,y:104.61539},{x:174.35898,y:106.666664}]},{type:"CC",cc:[{x:172.3077,y:106.666664},{x:170.25641,y:108.71795},{x:166.15384,y:108.71795}]},{type:"CC",cc:[{x:164.10257,y:110.76923},{x:160,y:110.76923},{x:157.94872,y:110.76923}]},{type:"CC",cc:[{x:157.94872,y:112.82051},{x:155.89743,y:112.82051},{x:153.84616,y:112.82051}]},{type:"CC",cc:[{x:151.79488,y:112.82051},{x:147.6923,y:114.871796},{x:145.64102,y:114.871796}]},{type:"CC",cc:[{x:143.58974,y:114.871796},{x:141.53847,y:114.871796},{x:139.48718,y:114.871796}]},{type:"CC",cc:[{x:135.38461,y:114.871796},{x:133.33333,y:114.871796},{x:129.23077,y:114.871796}]},{type:"CC",cc:[{x:127.17949,y:114.871796},{x:127.17949,y:116.92308},{x:123.07692,y:116.92308}]},{type:"CC",cc:[{x:108.71795,y:116.92308},{x:106.666664,y:116.92308},{x:104.61539,y:116.92308}]},{type:"CC",cc:[{x:102.5641,y:116.92308},{x:90.25641,y:116.92308},{x:88.20513,y:116.92308}]},{type:"CC",cc:[{x:84.10256,y:116.92308},{x:77.948715,y:116.92308},{x:67.69231,y:116.92308}]},{type:"CC",cc:[{x:63.589745,y:116.92308},{x:55.384617,y:116.92308},{x:51.28205,y:116.92308}]},{type:"CC",cc:[{x:49.23077,y:116.92308},{x:47.179485,y:116.92308},{x:41.025642,y:116.92308}]},{type:"CC",cc:[{x:38.974358,y:116.92308},{x:34.871796,y:116.92308},{x:32.820515,y:116.92308}]},{type:"CC",cc:[{x:30.76923,y:116.92308},{x:28.717949,y:116.92308},{x:24.615385,y:116.92308}]},{type:"CC",cc:[{x:24.615385,y:118.97436},{x:22.564102,y:121.02564},{x:22.564102,y:123.07692}]},{type:"CC",cc:[{x:22.564102,y:125.128204},{x:18.461538,y:129.23077},{x:18.461538,y:131.28206}]},{type:"CC",cc:[{x:18.461538,y:133.33333},{x:18.461538,y:135.38461},{x:16.410257,y:135.38461}]},{type:"CC",cc:[{x:16.410257,y:137.4359},{x:16.410257,y:139.48718},{x:16.410257,y:141.53847}]},{type:"CC",cc:[{x:16.410257,y:143.58974},{x:16.410257,y:145.64102},{x:16.410257,y:147.6923}]},{type:"CC",cc:[{x:16.410257,y:149.74359},{x:18.461538,y:149.74359},{x:20.512821,y:151.79488}]},{type:"CC",cc:[{x:22.564102,y:151.79488},{x:22.564102,y:153.84616},{x:22.564102,y:155.89743}]},{type:"CC",cc:[{x:24.615385,y:155.89743},{x:24.615385,y:157.94872},{x:24.615385,y:160}]},{type:"CC",cc:[{x:26.666666,y:160},{x:28.717949,y:160},{x:28.717949,y:162.05128}]},{type:"CC",cc:[{x:30.76923,y:162.05128},{x:30.76923,y:164.10257},{x:32.820515,y:164.10257}]},{type:"CC",cc:[{x:34.871796,y:164.10257},{x:34.871796,y:166.15384},{x:36.923077,y:166.15384}]},{type:"CC",cc:[{x:36.923077,y:168.20512},{x:38.974358,y:168.20512},{x:41.025642,y:168.20512}]},{type:"CC",cc:[{x:43.076923,y:168.20512},{x:43.076923,y:170.25641},{x:45.128204,y:170.25641}]},{type:"CC",cc:[{x:45.128204,y:172.3077},{x:47.179485,y:172.3077},{x:47.179485,y:174.35898}]},{type:"CC",cc:[{x:49.23077,y:174.35898},{x:51.28205,y:174.35898},{x:51.28205,y:176.41026}]},{type:"CC",cc:[{x:53.333332,y:176.41026},{x:55.384617,y:176.41026},{x:55.384617,y:178.46153}]},{type:"CC",cc:[{x:57.435898,y:178.46153},{x:59.48718,y:178.46153},{x:61.53846,y:178.46153}]},{type:"CC",cc:[{x:63.589745,y:180.51282},{x:65.64103,y:180.51282},{x:67.69231,y:180.51282}]},{type:"CC",cc:[{x:69.74359,y:180.51282},{x:73.84615,y:182.5641},{x:75.89744,y:182.5641}]},{type:"CC",cc:[{x:77.948715,y:182.5641},{x:80,y:182.5641},{x:88.20513,y:182.5641}]},{type:"CC",cc:[{x:90.25641,y:182.5641},{x:90.25641,y:180.51282},{x:92.30769,y:180.51282}]},{type:"CC",cc:[{x:94.35897,y:180.51282},{x:96.410255,y:178.46153},{x:98.46154,y:178.46153}]},{type:"CC",cc:[{x:100.51282,y:176.41026},{x:100.51282,y:174.35898},{x:102.5641,y:174.35898}]},{type:"CC",cc:[{x:104.61539,y:174.35898},{x:106.666664,y:172.3077},{x:108.71795,y:170.25641}]},{type:"CC",cc:[{x:110.76923,y:168.20512},{x:112.82051,y:166.15384},{x:112.82051,y:164.10257}]},{type:"CC",cc:[{x:114.871796,y:164.10257},{x:114.871796,y:162.05128},{x:114.871796,y:160}]},{type:"CC",cc:[{x:116.92308,y:160},{x:116.92308,y:157.94872},{x:118.97436,y:157.94872}]},{type:"CC",cc:[{x:118.97436,y:155.89743},{x:121.02564,y:155.89743},{x:121.02564,y:153.84616}]},{type:"CC",cc:[{x:123.07692,y:153.84616},{x:123.07692,y:151.79488},{x:125.128204,y:151.79488}]},{type:"CC",cc:[{x:125.128204,y:149.74359},{x:125.128204,y:147.6923},{x:127.17949,y:145.64102}]},{type:"L",l:{x:129.23077,y:145.64102}},{type:"L",l:{x:133.33333,y:143.58974}}]}]}};t.props.fill=o,t.props.stroke=r;var s=J(e.menu).find(".zmenu__item");delete t.textBody,J.each(s,function(e,o){var r=J.extend(!0,{},t),s=J(o).metadata(),l=s.appData,d=J(o);d.css({width:22,height:22}),r.props.geom={type:l.shapeGeoType,preset:{type:l.action}},r.type=l.shapeObjType;var c=s.width,u=s.height,p=s.left,g=s.top;J(o).is("[gname=callouts]")?(n.indexOf(l.action)!=-1&&(r.props.geom.preset.modifiers=[-.5,.9],c=18,u=15),r.props.transform={dim:{width:c?c:17,height:u?u:17},pos:{left:p?p:9,top:g?g:5,zindex:1}}):r.props.transform={dim:{width:c?c:22,height:u?u:22},pos:{left:p?p:3,top:g?g:3,zindex:1}},l.subType&&(r=J.extend(!0,{},InsertShape.mergeMarkerData(r,l))),"CUSTOM"==l.shapeGeoType&&(r.props.transform.dim={width:16,height:16},r.props.transform.pos={left:6,top:6},"FREEFORM"!=l.action&&(r.props.fill={type:"NONE"}),r.props.geom.custom=a[l.action]),i.indexOf(l.action)!=-1&&(r.props.fill={type:"NONE"}),Shape.create.draw(r,d)})},InsertShape.mergeMarkerData=function(e,t){var i={type:ShapeConstants.MarkerType.OPEN,width:ShapeConstants.Size.MEDIUM,height:ShapeConstants.Size.MEDIUM};if(t.subType&&"1marker"==t.subType){var n={props:{stroke:{tailend:i}}};e=J.extend(!0,e,n)}else if(t.subType&&"2marker"==t.subType){var o={props:{stroke:{tailend:i,headend:i}}};e=J.extend(!0,e,o)}return e},InsertShape.drawMenuShapes=function(e,t){var i=!t.menu.data("shapesdrawn");i&&(InsertShape.generateShapeMenu(t),t.menu.data("shapesdrawn",!0))},InsertShape.drawSelectedShapeFromMenu=function(e,t){var i=J(t.menuitem[0]).attr("data"),n=JSON.parse(i).appData,o=n.action;if(InsertShape.isChangeShape)InsertShape.changeShapeProperty(["changeshape",o]);else{var r=[o,"blue"];n.subType&&r.push(n.subType),InsertShape.drawShape(r)}},InsertShape.changeStrokeColor=function(e,t){var i=Utils.getColorReference(t);i.indexOf("rgb(")!=-1&&(i=t.color?t.color:t,i=InsertShape.getRGBArray(i)),InsertShape.changeShapeProperty(["strokecolor",i])},InsertShape.changeShapeFillColor=function(e,t){var i=Utils.getColorReference(t);i.indexOf("rgb(")!=-1&&(i=t.color?t.color:t,i=InsertShape.getRGBArray(i)),InsertShape.changeShapeProperty(["fillcolor",i])},InsertShape.changeShapeForegroundColor=function(e,t){var i=InsertShape.getRGBArray(t.color);InsertShape.processTxtFormat(["forecolor",i])},InsertShape.isEditorEditable=function(){return editor.getRole().permissions.can("document.edit")},InsertShape.updateShapeEditableProperties=function(){InsertShape.updateShapeText(),InsertShape.clearSelection(),InsertShape.clearCache();InsertShape.isEditorEditable()},InsertShape.updateShapeText=function(e,t){if(null==InsertShape.isTextModified||0==InsertShape.getSelectedShapesArray().length&&!e)return!1;var i=e||InsertShape.getSelectedShape(),n=ShapeEditor.text.editor._getFromTo().from.num.index,o=ShapeEditor.text.editor._getFromTo().to.num.index;return i?(ShapeEditor.config.container=Z("inner_shape"),InsertShape.isTextModified=null,InsertShape.applyStyle(i,!0),t&&(InsertShape.select.shape(i),InsertShape.editShape(n,o)),!0):void 0},InsertShape.deleteGroupShape=function(){try{var e=InsertShape.getSelectedShape(),t=e.data;if("SHAPE"==t.type){var i=e.parentIds[0];t=J.ShapeData.getShape(i)}InsertShape.clearSelection(),InsertShape.updateShapeText(),InsertShape.deleteSingleShape(t),Op.sendMsg(),EditorUtil.focusMultiByteSpan()}catch(e){InsertShape.sendErrorMail(e)}},InsertShape.deleteSingleShape=function(e){var t=e.nvOProps.nvDProps.id,i=InsertShape.getShapeParaDOMNode(t);if(e.dropcapData){var n=DocUtil.getDocElement(i),o=DocUtil.getParaFormat(n.getEnd()-1);o[ATTR_PARAGRAPH.PS_DROPCAP]=!1,n.attr(o)}var r=InsertShape.getShapeNodeData(t),a=editor.doc.createRange(r.index,r.index+1);editor.doc.getSelection().removeAllRanges().addRange(a).deleteSelectedContents(null,!0),InsertShape.removeFromCache(t)},InsertShape.deleteInGroupShape=function(e,t){var i=InsertShape.getShapeData(t),n=i.shapes;if(2==n.length){InsertShape.clearSelection(),InsertShape.select.shape(t);var o=InsertShape.getSelectedShape(),r=InsertShape.ungroupShape(o);r.forEach(function(t){t.nvOProps.nvDProps.id!=e&&InsertShape.processShape(t)})}else{var a=0;J.each(n,function(t,i){i.nvOProps.nvDProps.id==e&&(a=t)}),n.splice(a,1),InsertShape.applyStyle(i),InsertShape.select.shape(t)}},InsertShape.deleteShapes=function(e){try{var e=e||InsertShape.getSelectedShapesArray();InsertShape.updateShapeText(),PubSub.subscribe("ZWSelection/ImageDeleted",InsertShape.beforeShapeDelete),1==e.length&&e[0].parentIds&&e[0].parentIds[0]?(InsertShape.deleteInGroupShape(curShapeId,selShapeData.parentIds[0]),InsertShape.select.shape(selShapeData.parentIds[0])):(e.forEach(function(e){var t=e.data||e;InsertShape.deleteSingleShape(t),J("#inner_shape").css({width:"0",height:"0px"})}),Op.sendMsg(),EditorUtil.focusMultiByteSpan())}catch(e){InsertShape.sendErrorMail(e)}},InsertShape.arrange=function(e){e=e[0];var t=InsertShape.getSelectedShape().data,i=t.nvOProps.nvDProps.id,n=t.props.transform.pos.zindex,o=InsertShape.getShapeFromFloatImages(DocTreeManager.getTreeNodeAtIndex(editor.doc.getSelection().getStart()).viewProperties),r={},a=0;if("forward"==e){if(n==o.length)return;if(a=1e3,J.each(o,function(e,t){var i=t.shapeData.props.transform.pos.zindex;n<i&&i<a&&(a=i,r=t.shapeData)}),1e3==a)return}else if("backward"==e){if(1==n)return;if(a=-1,J.each(o,function(e,t){var i=t.shapeData.props.transform.pos.zindex;n>i&&i>a&&(a=i,r=t.shapeData)}),a==-1)return}r.props.transform.pos.zindex=n,t.props.transform.pos.zindex=a,InsertShape.applyStyle(t,!0),InsertShape.applyStyle(r,!0),InsertShape.select.shape(i)},InsertShape.cut=function(){ShapeEditor.isTextEditable()||InsertShape.deleteShapes()},InsertShape.paste=function(){editor.doc.execCmd("paste")},InsertShape.duplicateShapes=function(){var e=InsertShape.getSelectedShapesArray(),t=[];e.forEach(function(e){var i=e.data.nvOProps.nvDProps.id,n=InsertShape.getShapeNodeData(i);n.format[MAILMERGE.MMINFOS]&&(InsertShape.mergeWithFormats={mminfos:n.format[MAILMERGE.MMINFOS]});var o=n.format.shapeData,r=InsertShape.getZindex(e.data.nvOProps.nvDProps.id),a=o.props.transform.pos;InsertShape.renewShape(o),a.top+=30,a.left+=30,a.zindex=r,InsertShape.moveCursorIdx(n.index+1),InsertShape.insertShape(o),t.push(o.nvOProps.nvDProps.id)}),InsertShape.select.shape(t)},InsertShape.getZindex=function(e){try{var t=null;if(e){var i=DocUtil.getDocElement(InsertShape.getShapeParaDOMNode(e));t=InsertShape.getShapeFromFloatImages(i.dtNode.viewProperties)}else t=InsertShape.getShapeFromFloatImages(DocTreeManager.getTreeNodeAtIndex(editor.doc.getSelection().getStart()).viewProperties);var n=1;t.forEach(function(e){var t=JSON.parse(e.shapeData.props.transform.pos.zindex);t>n&&(n=t)}),n++}catch(e){}return n},InsertShape.startToolbarUpdation=function(){var e=InsertShape.getSelectedShapesArray();if(e[0]){var t=e[0].data,i=t.nvOProps.nvDProps.id;if(t=InsertShape.getShapeData(i),!t.dropcapData){var n,o=t.shapes,r=e.length>1;!(r||!e[0].parentIds[0]);if(e.forEach(function(e){var t=e.data;"CONNECTOR"==t.type&&(n=!0)}),!n&&!o){var a={para:0,portion:0,ch:0};ShapeEditor.text.isEditable()&&(a=ShapeEditor.text.getObject().from);var s=t.textBody,l=s.paras[a.para],d=l.portions[a.portion],c=d.props,u="transparent";"SOLID"==c.fill.type&&(u="rgb("+c.fill.solid.color.rgb.toString()+")"),Z("shpBold").zbutton(c.bold?"check":"uncheck"),Z("shpItalic").zbutton(c.italic?"check":"uncheck"),Z("shpStrikethrough").zbutton(c.strike&&"NONE"!=c.strike?"check":"uncheck"),Z("shpUnderline").zbutton(c.underline&&"NONE"!=c.underline?"check":"uncheck");var p=null;if(c.fontweight){var p=c.fontweight;"BOLD"!=p&&"HEAVY"!=p&&"BLACK"!=p||Z("shpBold").zbutton("check"),p=WRITER_FONT_WEIGHT_MAP[p]}Toolbar.updateFontSize(parseFloat(c.size||11),Z("shape_fontSize")),FontComboUtil.updateFontFamily(c.font.fontFamily.name,p,"shapepanel-fontFamily"),J("#shpSuperscript,#shpSubscript").zbutton("uncheck"),c.baseline&&(c.baseline<0?Z("shpSubscript").zbutton("check"):Z("shpSuperscript").zbutton("check"));var g=l.style,f=(g.spacing.line.percent+"").replace(".","_");Z("shp-lpnl-linespacemenu").zmenu("check","shp_lnSp"+f);var E="align"+(g.halign||"LEFT").toLowerCase();J("#alignleft,#alignright,#aligncenter").zbutton("uncheck"),Z(E).zbutton("check");var T=t.textBody.props.valign;t.textBox&&"left"==T?T="top":T&&(T=t.textBody.props.valign.toLowerCase()),Z("shapetextValign").zmenu("check","valign_"+T)}var m="0_0",h="shadowNone",I="preset0",_=InsertShape.getRGBFillColor(t),A=(InsertShape.getShapeFromFloatImages(DocTreeManager.getTreeNodeAtIndex(editor.doc.getSelection().getStart()).viewProperties),InsertShape.getStrokeFillColor(t)),S="wrap"+(t.wrapType||"front");t.props.effects&&(t.props.effects.reflection&&Object.keys(t.props.effects.reflection).length>1&&(I=t.props.effects.reflection.preset&&t.props.effects.reflection.preset.toLowerCase()),t.props.effects.shadow&&Object.keys(t.props.effects.shadow).length>1&&(h=t.props.effects.shadow.distance&&"shadow"+t.props.effects.shadow.distance.angle));var R=t.props.fill?t.props.fill.type:"NONE";if("NONE"!=R&&"PICT"!=R){var O=n?t.props.stroke.fill:t.props.fill;O&&(m=O.solid.color.tweaks?(O.solid.color.tweaks.alpha+"").replace(".","_"):"0_0")}J(".ui-shape-fill-color").find("canvas").css("background",_),J(".ui-shape-stroke-color").find("canvas").css("background",A),t.props.stroke&&(Z("strokewidthmenu").zmenu("check","strokewidth"+t.props.stroke.width),Z("strokestylemenu").zmenu("check","strokestyle_"+t.props.stroke.type)),Z("shapeopacitymenu").zmenu("check","opacity"+m),Z("shadowpresetmenu").zmenu("check",h),Z("reflectionpresetmenu").zmenu("check",I),Z("shapewraptypesmenu").zmenu("check",S)}}},InsertShape.updateToolbar=function(){clearTimeout(InsertShape.toolbarUpdationProgress),LayoutManager.isRichEditActive()&&ZWComponentUtil.getInitializedComponentList().indexOf("menuShapes")!=-1&&(InsertShape.toolbarUpdationProgress=setTimeout(function(){InsertShape.startToolbarUpdation()},300))},InsertShape.clearShapeCache=function(){InsertShape.shapeCache={}},InsertShape.beforeShapeDelete=function(e){if(e.shapeData){if(e&&e.shapeData.dropcapData){var t=e.shapeData.nvOProps.nvDProps.id,i=J("#"+t).parents("div.zw-paragraph");if(!i[0])return;var n=DocUtil.getDocElement(i[0]),e=DocUtil.getParaFormat(n.getEnd()-1);e[ATTR_PARAGRAPH.PS_DROPCAP]=!1,n.attr(e)}else e.shapeData.shapetype==InsertShape.constant.WATERMARK&&PubSub.publish("Watermark/Deleted");InsertShape.clearSelection(),InsertShape.closeToolbar(),EditorUtil.focusMultiByteSpan()}},InsertShape.processAfterPaste=function(){InsertShape.pastedShapes.length>0&&(InsertShape.clearSelection(),InsertShape.select.shape(InsertShape.pastedShapes),InsertShape.pastedShapes=[])},InsertShape.moveCursorIdx=function(e,t){if(e&&e!=-1){e="number"==typeof e?e:InsertShape.getShapeIdx(e);var i=editor.doc.createRange(e,t||e);return editor.doc.getSelection().removeAllRanges().addRange(i),i}},InsertShape.getShapesInPara=function(e){var t=e?InsertShape.getShapeParaDOMNode(e):DomViewManager.getDOMNodeAtIndex(editor.doc.getSelection().getStart()),i=DocUtil.getDocElement(t),n=i.getStart(),o=i.getEnd(),r=editor.doc.getNodesInSelection(NODE_TYPE.IMAGE,n,o);return r},InsertShape.clearCache=function(){},InsertShape.editShape=function(e,t){var i=InsertShape.getSelectedShape();if(i)if(ShapeEditor.text.editor.edit(InsertShape.getSelectedShape()),e>=0)ShapeEditor.text.editor.select.select(e,t||e);else if(e==-1)ShapeEditor.text.editor.select.all();else if(e==-2){ShapeEditor.text.editor.select.all();var n=ShapeEditor.text.editor.getCursorIndex().ei;ShapeEditor.text.editor.select.select(n,n)}},InsertShape.select={similar:function(){var e=InsertShape.getSelectedShape().data,t=e.props.geom.preset.type,i=JSON.stringify(e.props.fill),n=JSON.stringify(e.props.stroke),o=JSON.stringify(e.props.transform.dim),r=[],a=U.keys(J.ShapeData.shapes),s=J.ShapeData;U.each(a,function(e,a){var l=s.getShapeData(e);l&&l.props.geom.preset.type==t&&JSON.stringify(l.props.transform.dim)==o&&JSON.stringify(l.props.fill)==i&&JSON.stringify(l.props.stroke)==n&&r.push(e)}),r.length>0&&this.shape(r)},all:function(){var e=(J.ShapeData.shapes,U.keys(J.ShapeData.shapes));this.shape(e)},shape:function(e){if(InsertShape.positionScalespan(),e){var t=ShapeEditor.config.container;J(editor.clientActiveSection);if(t.is("#drawcontainer")||(ShapeEditor.config.container=J("#drawcontainer"),J("#ui-editor-outer-div").scrollTop()),"string"==typeof e){var i=InsertShape.getShapeDom(e);i&&ShapeEditor.selectShapes(e,!1,i)}else if(e.length)for(var n=0;n<e.length;n++){var o=e[n],r="string"==typeof o?o:o.id||(o.data||o).nvOProps.nvDProps.id,i=InsertShape.getShapeDom(r);i&&ShapeEditor.selectShapes(r,!1,i)}else{var r=(e.data||e).nvOProps.nvDProps.id,i=InsertShape.getShapeDom(r);i&&ShapeEditor.selectShapes(r,!1,i)}PubSub.subscribe("ZWSelection/ImageDeleted",InsertShape.beforeShapeDelete),InsertShape.hideEditorCursor()}}},InsertShape.lockanchor=function(){var e=InsertShape.getSelectedShapesArray();e.length&&U.each(InsertShape.getSelectedShapesArray(),function(e,t){e.data.lockAnchor=!e.data.lockAnchor,InsertShape.applyStyle(e.data,!0)})},InsertShape.clearCache=function(){},InsertShape.changeRelativeToContainer=function(e,t,i){if(e){if(i)for(var n,o=DomViewManager.getDocView(e),r=o.getFloatImages(),a=0;a<r.length;a++)if(r[a].isShape&&r[a].shapeData.nvOProps.nvDProps.id===i){n=r[a].splitTop;break}var s=PUtil.offset(e);n&&(s.top-=n);var l=J(e).offset().left+t.pos.left*editor.zoomFactor+Z("ui-editor-outer-div").scrollLeft(),d=(s.top+t.pos.top)*editor.zoomFactor;LayoutManager.isFullscreen()&&(d+=20),t.pos.top=d+1,t.pos.left=l-Z("ui-editor-outer-div").offset().left}return t},InsertShape.groupShapes=function(e){var t=e||ShapeEditor.select.shapes;InsertShape.getShapeParaDOMNode(t[0].data.nvOProps.nvDProps.id);if(!(t.length<=1)){var i=J.extend(!0,{},J.ShapeDefault.shape);delete i.textBody,i.type=ShapeConstants.ShapeNodeType.GROUPSHAPE,i.nvOProps.nvDProps.id=Math.uuid();var n=i.nvOProps.nvDProps.id,o=[],r=[],a=!1;J.each(t,function(e,t){var i=J.extend(!0,{},t.data);i=InsertShape.updatePosRelativeToPara(t.data),i.nvOProps.nvODProps&&i.nvOProps.nvODProps.locks.noAspectChange&&(a=!0);var n=i.props.transform.pos,s=i.props.transform.dim;o.push(i);var l={x:n.left,y:n.top},d={x:n.left+s.width,y:n.top+s.height};r.push(l),r.push(d)}),a&&(i.nvOProps.nvODProps={locks:{noAspectChange:!0}});var s=VectorUtil.getMinAndMax(r),l={},d={};l.left=s.small.x,l.top=s.small.y,d.width=s.big.x-s.small.x,d.height=s.big.y-s.small.y;var c=i.props.transform;c.chDim=d,c.chPos=l,c.dim=d,c.pos=l,c.rotate=0,i.shapes=o;var u={};u[ATTR_IMAGE.I_SHAPEDATA]=i,u[ATTR_COMMON.TYPE]="image",u[ATTR_IMAGE.I_WID]="0px",u[ATTR_IMAGE.I_HT]="0px",u[ATTR_IMAGE.I_TOP]=i.props.transform.pos.top,u[ATTR_IMAGE.I_LEFT]=i.props.transform.pos.left,J("#inner_shape").css({width:"0",height:"0px"}),editor.doc.execCmd("insimg",[u]),InsertShape.select.shape(n)}},InsertShape.updatePosRelativeToPara=function(e){var t=InsertShape.getShapeIdx(e),i=e.props.transform.pos,n=editor.doc.getRawFormatAt(t).shapeData;return i.top=n.props.transform.pos.top,i.left=n.props.transform.pos.left,e},InsertShape.ungroupAndInsert=function(e){var t=InsertShape.ungroupShape(e);t.forEach(function(e){InsertShape.processShape(e)}),InsertShape.select.shape(t)},InsertShape.ungroupShape=function(e){var t=e||InsertShape.getSelectedShape(),i=InsertShape.getShapeIdx(t),n=editor.doc.createRange(i,i+1);editor.doc.getSelection().removeAllRanges().addRange(n).deleteSelectedContents(null,!0);var o=t.data||t,r=J.each(o.shapes,function(e,t){J.GroupShape.updateInnerShapeData(J.GroupShape.props,o.props,t,!0)});return r},InsertShape.feedShapesFromZShowToZWriter=function(e){var t=e.shapes||e.data.shapes;J.each(t,function(e,t){var i=InsertShape.getDefaultShapeData();i.props=t.props,t.textBody?i.textBody=t.textBody:delete i.textBody,i.nvOProps.nvDProps.id=Math.uuid(),i.nvOProps.nvODProps={locks:{noAspectChange:!0}},InsertShape.processShape(i)}),InsertShape.clearSelection()},InsertShape.textboxFillImageMap={box4:"textbox-thumbpin.png",col1:"textbox-pink-bg.png",col3:"textbox-blue-bg.png",quotes1:"quotes-pink-bg.png",quotes2:"quotes-green-bg.png",quotes3:"quotes-orange-bg.png",quotes4:"quotes-violet-bg.png"},InsertShape.fillText=function(e){if(!e.textBody)return e;var t=editor.doc.getSelection(),i=t.getLastRange();t.removeAllRanges().addRange(i).deleteSelectedContents(null,!0);for(var n=editor.doc.getContent(t.getStart(),t.getEnd())||"",o=e.textBody.paras,r=0;r<o.length;r++){var a=o[r];if(a)for(var s=a.portions,l=0;l<s.length;l++){var d=a.portions[l];if(d){if(!d||!d.t)continue;var c=d.t;c.indexOf("CONTENT")!=-1?0==n.length?d.t=InsertShape.constant.CONTENT:d.t=n:c.indexOf("HEADING")!=-1&&(d.t=InsertShape.constant.HEADING)}}}return e},InsertShape.getTextboxTemplateData=function(e){var t=JSON.parse(JSON.stringify(TextBoxTemplates[e])),i=t.shapes;return i&&J.each(i,function(t,n){var o=InsertShape.getDefaultShapeData();if(o.props=n.props,n.textBody?o.textBody=n.textBody:delete o.textBody,"box9"==e&&e.indexOf("quotes")==-1||(n=InsertShape.fillText(o)),o.nvOProps.nvDProps.id=Math.uuid(),o.props.fill&&"PICT"==o.props.fill.type){var r=InsertShape.textboxFillImageMap[e];if(r){var a=o.props.transform.dim.height,s=o.props.transform.dim.width;InsertShape.modifyShapeProperty(["fillimage",[imgCdnZWStaticPath+fingerPrintObj["images/common/textbox/png/"+r],a,s]],o)}}i[t]=o}),t.nvOProps.nvDProps.id=Math.uuid(),t.props.transform.pos={top:0,left:0},t[ATTR_IMAGE.I_MT]=t[ATTR_IMAGE.I_MB]=t[ATTR_IMAGE.I_ML]=t[ATTR_IMAGE.I_MR]="0.125in",t.wrapType="square",t.textboxTemplate=e,t},InsertShape.insertTextboxTemplate=function(e){var t=0;if(("box5"==e||"box6"==e||"box7"==e)&&!editor.doc.getSelection().isCollapsed())return void InsertShape.convertSelectedTextToPullquote(e);var i=InsertShape.getTextboxTemplateData(e);if(i.maintainLayout){i.nvOProps.nvODProps&&delete i.nvOProps.nvODProps;var n=DocLayoutManager.getPageAtPageNumber(editor.currentPageIndex+1),o=i.props.transform,r=DomViewManager.getDOMElem(n);o.dim.height=3*J(r).height()/4,o.dim.width=J(r).width()/3,o.pos.left=-(n.getContentLeft()-5),t=n.content.first.columns.first.childViews.first.getNode().start}else t=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH)[0].getStart();InsertShape.moveCursorIdx(t),InsertShape.insertShape(i),InsertShape.select.shape(i.nvOProps.nvDProps.id),InsertShape.openToolbar(i)},InsertShape.openToolbar=function(e){if(!e){var t=InsertShape.getSelectedShape();if(!t)return;e=t.data}var i=e.dropcapData||!1,n=e.shapetype==InsertShape.constant.WATERMARK;if((i||!LeftPanel.isPanelVisible(ELEM_ID.SHAPESPANEL))&&LayoutManager.isRichEditActive()&&"undefined"!=typeof PanelUtil&&!editor.isOffline()){if(!i)return n?void Watermark.openPanel():void DropcapPanel.close();setTimeout(function(){PubSub.publish("DropcapPanel/Show")},100);J(".ui-nav.ui-navbar-nav.ui-side-menu").children();InsertShape.hideEditorCursor(),PubSub.subscribe("Document/UndoRedo",InsertShape.closeToolbar)}},InsertShape.initClickEvents=function(e){e.find("[ctype=zmenu]").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),e.find(":checkbox").on("click",function(e,t){var i=$(e.target);ToolbarHandler.handleUIEvents(i,t)})},InsertShape.initShapePanel=function(){ZWComponentUtil.init("menuShapes",function(){var e=J("#menuShapes");InsertShape.initClickEvents(e),QuickSearch.initMenus(e,"shape"),FontSizeCombo.addAllDefaultFontSizeInCombo("shape_fontSize"),J("#shape_fontSize").bind("zcomboboxchange",ToolbarHandler.fontComboChangeHandler),InsertShape.startToolbarUpdation()},"ctype")},InsertShape.initDropcapPanel=function(){ZWComponentUtil.init("dropcap-panel",function(){var e=J("#dropcap-panel");InsertShape.initClickEvents(e),DropcapPanel.refreshValues()},"ctype")},InsertShape.closeToolbar=function(){if("undefined"!=typeof PanelUtil&&!editor.isOffline()){DropcapPanel.close();J(".ui-nav.ui-navbar-nav.ui-side-menu").children();PubSub.unsubscribe("ZWSelection/ImageDeleted",InsertShape.beforeShapeDelete),PubSub.unsubscribe("Document/UndoRedo",InsertShape.closeToolbar)}},InsertShape.closeShapeToolbar=function(){LeftPanel.closeDynamicPanel(ELEM_ID.SHAPESPANEL)},InsertShape.getTextFromShape=function(e){var t="";e="string"==typeof e?J.ShapeData.getShape(e):e;var i=e.textBody.paras;return J.each(i,function(e,i){var n=i.portions;J.each(n,function(e,i){i.t&&(t+=i.t)})}),t},InsertShape.getClosestParaOnOffset=function(e){var t,i=Z("drawcontainer").offset(),n=e.top+i.top,o=e.left+i.left;if(J(editor.clientActiveSection).hasClass("ui-hf-container"))t=Utils.getClosestChild(editor.clientActiveSection,"span.zw-portion,span.EOP",o,n);else if(DomViewManager.isMultiplePagesInRow()){var r=function(e,t){return!!J(t).parents(".float-image-container")[0]};e.top-=editor.editorPaneContainer.scrollTop();var a=DomViewManager.getClosestPage(e);t=Utils.getClosestChild(J(a).find(".selectableSection").not(r)[0],"span.zw-portion,span.EOP",e.left,n)}else{t=Utils.getClosestChild(editor.editorPaneContainer[0],"span.zw-portion,span.EOP",o,n);var s=!!J(t).parents(".hf_content").length;s&&J(editor.clientActiveSection).hasClass("zw-contentpane")&&(t=Utils.getClosestChild(editor.clientActiveSection,"span.zw-portion,span.EOP",o,n))}return J(t).parents(".zw-paragraph")[0]},InsertShape.selectShapesInRange=function(){var e=editor.doc.getSelection(),t=editor.doc.getNodesInSelection(NODE_TYPE.IMAGE,e.getStart(),e.getEnd()),i=t.length;if(!i)return void InsertShape.removeShapeOverlay();for(var n=!1,o=!1,r=0;r<t.length;r++){var a=t[r].getStart(),s=DocUtil.copyStyle(editor.doc.getRawFormatAt(a)),l=s[ATTR_IMAGE.I_SHAPEDATA];if(l){var d=null,c=DocTreeManager.doc.getSection(a).getSectionType();if(c==SECTION_TYPES.HEADER?(n=!0,d=J(DomViewManager.getDOMNodeAtIndex(a)).find("#"+l.nvOProps.nvDProps.id)):c==SECTION_TYPES.FOOTER?(o=!0,d=J(DomViewManager.getDOMNodeAtIndex(a)).find("#"+l.nvOProps.nvDProps.id)):d=InsertShape.getShapeDom(l.nvOProps.nvDProps.id),d&&0==d.find(".shape_overlay").length){var u=document.createElement("div"),p=l.props.transform,g=InsertShape.constant.OVERLAY_BORDER_WIDTH,f=-(g/2),E=-(g/2),T={rotate:p.rotate,pos:{top:E,left:f},dim:{height:p.dim.height+g,width:p.dim.width+g}},m=InsertShape.getTransformedSize(T);J(u).css({height:m.dim.height,width:m.dim.width,top:m.pos.top+"px",left:m.pos.left+"px","background-color":"rgba(20, 119, 255,0.3)",border:"6px solid rgba(20, 119, 255,0.4)",position:"absolute","z-index":5}).addClass("shape_overlay"),d.prepend(u)}}}n?PubSub.publish("header/changed"):o&&PubSub.publish("footer/changed"),EditorUtil.focusMultiByteSpan(),PubSub.subscribe("Cursor/Collapsed",InsertShape.removeShapeOverlay),PubSub.subscribe("ZWSelection/ImageDeleted",InsertShape.beforeShapeDelete)},InsertShape.removeShapeOverlay=function(){editor.editorPaneContainer.find(".shape_overlay").remove(),PubSub.unsubscribe("Cursor/Collapsed",InsertShape.removeShapeOverlay)},InsertShape.getShapeDom=function(e){var t=J(editor.clientActiveSection).find("#"+e)[0]||editor.editorPaneContainer.find("#"+e)[0];return t?J(t):void 0},InsertShape.getDefaultShapeData=function(e){e||(e="SHAPE");var t=JSON.parse(InsertShape.defaultData[e]);return t.nvOProps.nvDProps.id=Math.uuid(),J.extend(!0,{},t)},InsertShape.getOverlayTransformProps=function(){var e=0,t=0,i=0,n=J(".overlay");if(!n.length)return{top:0,left:0,height:0,width:0};n.each(function(){var n=J(this),o=n.find(".zw-table");o.length?(e+=n.height()/n.parents("tr").find("td").length,i=n.width()/n.parents("tr").find("td").length,i>t&&(t=i)):(e+=n.height(),i=n.width(),i>t&&(t=i))});var o=0;1==n.length&&(o=parseInt(n.first().css("left"),10));var r=n.first().parents(".zw-paragraph").offset().top,a=n.first().offset().top-r;return{top:a,left:o,height:e,width:t}},InsertShape.updateTransformPropWithOverlayOffset=function(e){var t=InsertShape.getOverlayTransformProps();return e.props.transform.dim.height=t.height,e.props.transform.dim.width=t.width+20,e.props.transform.pos.top=t.top,e.props.transform.pos.left=t.left,e},InsertShape.convertSelectedTextToPullquote=function(e){var t=InsertShape.getTextboxTemplateData(e);return InsertShape.pushSelectedTextToShape(t),InsertShape.updateTransformPropWithOverlayOffset(t),t.wrapType="square",InsertShape.moveCursorIdx(editor.doc.getSelection().getStart()),InsertShape.insertShape(t),t},InsertShape.pushSelectedTextToShape=function(e){var t=editor.doc.getSelection(),i=t.getLastRange();t.removeAllRanges().addRange(i).deleteSelectedContents(null,!0);for(var n=editor.doc.getContent(t.getStart(),t.getEnd()),o=n.split("\n"),r=0;r<o.length;r++){var a=o[r],s=void 0;if(e.textBody.paras[r])s=e.textBody.paras[r];else{var l=JSON.stringify(e.textBody.paras[e.textBody.paras.length-1]);s=JSON.parse(l)}var d=s.portions.splice(0,1)[0];d.t=a.length>0?a:"",s.portions[0]=d,e.textBody.paras[r]=s;var l=JSON.stringify(e.textBody.paras[e.textBody.paras.length-1]);s=JSON.parse(l)}return e},InsertShape.convertSelectedTextToInsertPullquote=function(e){var t=InsertShape.getTextboxTemplateData();return t.textBody.paras[0].portions[0].t="",InsertShape.updateTransformPropWithOverlayOffset(t),InsertShape.pushSelectedTextToShape(t),t.wrapType="square",InsertShape.moveCursorIdx(editor.doc.getSelection().getStart()),InsertShape.insertShape(t),t},InsertShape.pushSelectedTextToInsertShape=function(e){var t=editor.doc.getSelection();t.getLastRange();t.deleteSelectedContents();var i=editor.doc.snapShotManager.getReverseOp(Op.msgBuffer[0]),n=[];n.push(i);var o=ShapePaste.convertPasteOp(n),r=e,a={Beforeparas:{},Aftereparas:{}},s=ShapeEditor.text.getObject();return a.Beforeparas=[r.textBody.paras[0]],a.Aftereparas=[r.textBody.paras[0]],s.from.para=0,s.from.ch=0,s.from.portion=0,s.to.para=0,s.to.ch=0,s.to.portion=0,processedPara=ShapePaste.fillParas(a,o,s),e.textBody.paras=processedPara.paras,e},InsertShape.convertParaToPullquote=function(){var e=InsertShape.getTextboxTemplateData("box5"),t=J(editor.doc.getCursorPortionNode(editor.uuid,"start")).parents("div.zw-paragraph"),i=DocUtil.getDocElement(t[0]).dtNode,n=editor.doc.getContent(i.start,i.end),o=editor.doc.getSelection(),r=editor.doc.createRange(i.start,i.end);o.removeAllRanges().addRange(r).deleteSelectedContents(null,!0),e.textBody.paras[0].portions[0].t=n,e.props.transform.dim.height=t.height()+30,e.props.transform.dim.width=t.width(),e.props.transform.pos.top=0,e.props.transform.pos.left=0,InsertShape.insertShape(e)},InsertShape.insertMergeFields=function(e){for(var t=e[1],i=MailMergeFieldUtil.getFieldName(t),n=InsertShape.getSelectedShapesArray(),o=[],r=0;r<n.length;r++){n.length>1&&(InsertShape.clearSelection(),InsertShape.select.shape(n[r]));var a=n[r].data,s=(a.nvOProps.nvDProps.id,DocUtil.copyStyle(editor.doc.getRawFormatAt(InsertShape.getShapeIdx(n[r])))),l=s[MAILMERGE.MMINFOS]||{};l[i]=t,o=InsertShape.insertFieldInShape(n[r],UNICODE.MERGEFIELD_START+i+UNICODE.MERGEFIELD_END,{mminfos:l},t)}InsertShape.applyStyle(o,!0,"shapePaste")},InsertShape.insertFieldInShape=function(e,t,i,n){InsertShape.mergeWithFormats=J.extend(!0,InsertShape.mergeWithFormats,i),ShapeEditor.text.isEditable()||InsertShape.editShape(-2);var o={text:t},r=!0,a=[];return a=InsertShape.getSelectedShapesArray().length>0?ShapePaste.init(o,n,r,InsertShape.getSelectedShapesArray()):ShapePaste.init(o,n,r,[e])},InsertShape.renewShape=function(e){e=e.data||e;var t=e.shapes;return t&&J.each(t,function(e,i){i.nvOProps.nvDProps.id=Math.uuid(),t[e]=i}),e.nvOProps.nvDProps.id=Math.uuid(),e},InsertShape.positionScalespan=function(){J("#scaleSpan").css({top:J("#ui-editor-outer-div").scrollTop()})},InsertShape.showEditorCursor=function(){CurUtil.blinkCursor(),CurUtil.setCursorVisiblity(!0)},InsertShape.getProportionalSize=function(e){return 3.6*e/4},InsertShape.getShapeData=function(e){var t=J.ShapeData.getShapeData(e);return t?J.extend(!0,{},t):null},InsertShape.calculateDimensionOnFonts=function(e,t,i,n){return e=J("<div/>").text(e).html(),FontUtils.getCharSize(e,"font-size:"+i+"pt;font-family:"+t+";font-weight:"+n+";")},InsertShape.removeWatermarkDom=function(e){e.find(".watermark_cont").remove()},InsertShape.getRGBFillColor=function(e){var t="rgb(255,255,255)";if("GROUPSHAPE"!=e.type){var i=e.props.fill?e.props.fill.type:"NONE";if("NONE"!=i&&"PICT"!=i){var n=e.props.fill.solid?e.props.fill.solid.color.rgb:"";t=n.indexOf("zw")!=-1?Utils.getColorValFromRefString(n):"rgb("+n.toString()+")"}}return t},InsertShape.getStrokeFillColor=function(e){var t="rgb(255,255,255)";if("GROUPSHAPE"!=e.type){var i=e.props.stroke&&e.props.stroke.fill?e.props.stroke.fill.type:"NONE";if("NONE"!=i){var n=e.props.stroke.fill?e.props.stroke.fill.solid.color.rgb:"";t=n.indexOf("zw")!=-1?Utils.getColorValFromRefString(n):"rgb("+n.toString()+")"}}return t},InsertShape.initTextboxMenu=function(){window.TextBoxTemplates||(InsertShape.showTextboxJSLoadingMsg("textboxmenu"),InsertShape.fetchTextboxTemplateJS(InsertShape.showTextBoxTemplatesIcons))},InsertShape.fetchTextboxTemplateJS=function(e){if(!window.TextBoxTemplates){var t={callback:e,src:jsCdnZWStaticPath+fingerPrintObj["js/templates/textboxtemplates.js"],async:!0,id:"symbolJson"};loadJS(t)}return!0},InsertShape.showTextBoxTemplatesIcons=function(){var e=J("#textboxmenu");e.zmenu("showAllMenuItems"),e.zmenu("hideMenuItems",["textbox-template-loadingmsg"])},InsertShape.showTextboxJSLoadingMsg=function(e){var t=[],i={customAttributes:{id:"textbox-template-loadingmsg"},itemType:"custom",innerHTML:'<div class="ui-loading-cont"><div>'+J.i18n("writer.common.LOADING")+'</div><div class="ui-loading-gif"> </div></div>'};e.indexOf("textbox")!=-1&&(i.customAttributes.class="ui-textbox-template-loadingmsg"),t.push(i);var n=J("#"+e);return n.zmenu("hideAllMenuItems"),n.zmenu("addMenuItems",t),!0},InsertShape.handleAfterInit=function(){PubSub.subscribe("Shapes/OpenToolbar",InsertShape.openToolbar),PubSub.subscribe("Shapes/CloseToolbar",InsertShape.closeToolbar),Utils.WriterCallbacks.register("onmenuhide",function(){return!InsertShape.getSelectedShape()&&!InsertShape.isDrawingMode})},InsertShape.handleMouseEvents=function(e,t){if("mouseup"==t&&InsertShape.isDrawingMode)return PubSub.publish("Gridlines/hide"),InsertShape.isDragMode=!1,InsertShape.isDrawingMode=!1,InsertShape.skipMoveCursor?InsertShape.skipMoveCursor=!1:InsertShape.hideEditorCursor(),!0;var i=J(e.target),n=InsertShape.getSelectedShape(),o=i.parents(".unselectableSection").length>0,r=i.parents(".shape_box ").length>0;if(n){if("mousemove"==t){var a=InsertShape.getSelectedShapesArray();return J.each(a,function(e,t){J("#clonebox_"+t.data.nvOProps.nvDProps.id).addClass("zw-shape-clone-box")}),!0}if("mouseup"==t)return!0}if(o&&("mouseup"==t||"mousedown"==t))return!1;if(r&&o?ShapeEditor.config.isSlideLocked=function(){return!0}:ShapeEditor.config.isSlideLocked=function(){return!1},"mousedown"==t&&r&&o)return!1;if("path"==i.prop("tagName")||r>0||"shape_box"==i.attr("class"))return!0;if("mousedown"==t&&"path"!=i.prop("tagName")&&0!=i.parents(".shape_box").length)return!0;if(InsertShape.isDrawingMode){if("mousedown"==t){EventHandler.moveCursor(e,0,0);var s=editor.doc.getDomCursorNode(editor.uuid,"start");s.css("border-left-style","")}return InsertShape.isTextBox&&J("#inner_shape").css("cursor",""),J(editor.clientActiveSection).css({"-moz-user-select":"none"}),editor.editorPaneContainer.css("cursor","crosshair"),!0}return J(editor.clientActiveSection).css({"-moz-user-select":""}),editor.editorPaneContainer.css("cursor",""),!("mousedown"==t&&"path"!=i.prop("tagName")&&"image"==i.prop("tagName")&&i.prop("href").baseVal!=ATTR_WIDGET.WIDGET_DEF_IMG&&!r)&&void 0},InsertShape.hideEditorCursor=function(){CurUtil.stopBlinking(),CurUtil.setCursorVisiblity(!1)},InsertShape.getSelectedShapesArray=function(){return ShapeEditor.getSelectedShapes()},PubSub.subscribe("Document/AfterInit",InsertShape.handleAfterInit),InsertShape.fillImage=function(){var e={success:function(e){InsertShape.changeShapeProperty(["fillimage",[e.DATA[0].URL,e.DATA[0].WIDTH,e.DATA[0].HEIGHT]]),ZWImgLibDialog.close()},failure:function(){}};ZWImgLibDialog.open({},e.success,e.failure)},InsertShape.updateToShapeThemeNames=function(e,t){try{t&&"textboxcreation"==t||("SCRIBBLE"!=e.props.geom.custom.type&&InsertShape.updateToZwthemeObj("fillcolor",SHAPE.THEME.BGC_COLOR,e),InsertShape.updateToZwthemeObj("strokecolor",SHAPE.THEME.BR_COLOR,e)),InsertShape.updateToZwthemeObj("fontname",SHAPE.THEME.FF_ZWMINOR,e)}catch(e){InsertShape.sendErrorMail(e)}return e},InsertShape.updateToZwthemeObj=function(e,t,i){if("fillcolor"==e||"strokecolor"==e)InsertShape.updateFillInZWtheme(e,t,i);else if("fontname"==e){var n=i.textBody;if(n)for(var o=n.paras||[],r=0;r<o.length;r++)for(var a=o[r].portions,s=0;s<a;s++){var l=a[s];l.props.font.fontFamily.zwtheme={fname:t}}}},InsertShape.updateToShowTheme=function(e,t){var i="zwaccent1",n=void 0,o=void 0;t.indexOf("*")>-1?(i=t.split("*")[0],n=parseInt(t.split("*")[1])):t.indexOf("/")>-1&&(i=t.split("/")[0],o=parseInt(t.split("/")[1]));var r=[];if(n)r[0]={mode:"MODIFY",value:n/100};else if(o){var a=o/100;r[0]={mode:"MODIFY",value:a},r[1]={mode:"OFFSET",value:1-a}}return e.type=InsertShape.writerShowThemeMap[i]||i,e.rgb=Shapes.getRGBArray(Utils.getColorValFromRefString(t)),e.tweaks={},e.tweaks.hsl={},e.tweaks.hsl.luminance=r,e},InsertShape.updateFillInZWtheme=function(e,t,i){if("NONE"==t||"transparent"==t)n={type:"NONE"},"fillcolor"==e?i.props.fill=n:i.props.stroke.fill=n;else{var n=InsertShape.getShapeFillObj(i,"fillcolor"==e?"fill":"stroke");n||(n={type:"NONE"}),"strokecolor"==e&&0==i.props.stroke.width&&(i.props.stroke.width=2),"NONE"!=n.type&&"PICT"!=n.type||(delete n.pict,n.type="SOLID",n.solid={color:{type:"A1",rgb:t}}),t.indexOf("zw")==-1?(delete n.solid.color.zwtheme,t.indexOf("rgb(")!=-1&&(t=InsertShape.getRGBArray(t)),n.solid.color.rgb=t,n.solid.color.type="CUSTOM"):(delete n.solid.color.zwtheme,InsertShape.updateToShowTheme(n.solid.color,t))}return i},InsertShape.isShapeSelected=function(){return InsertShape.getSelectedShapesArray().length>0},InsertShape.copyShapedataToFormats=function(e,t){var i={};return i[ATTR_COMMON.TYPE]="image",i[ATTR_IMAGE.I_SHAPEDATA]=e,i[ATTR_IMAGE.I_SRC]=ATTR_WIDGET.WIDGET_DEF_IMG,i[ATTR_IMAGE.I_H_POSITION]={},i[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",i[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_FROM]="column",i[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=e.props.transform.pos.left,i[ATTR_IMAGE.I_V_POSITION]={},i[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",i[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_FROM]="paragraph",i[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=e.props.transform.pos.top,i[ATTR_IMAGE.I_WID]=e.props.transform.dim.width,i[ATTR_IMAGE.I_HT]=e.props.transform.dim.height,i[ATTR_IMAGE.I_WRAP_TYPE]=e.wrapType||"front",i[ATTR_IMAGE.I_ROTATE]=e.props.transform.rotate,i.mr=e.mr||"0.0625in",i.mt=e.mt||"0.0625in",i.ml=e.ml||"0.0625in",i.mb=e.mb||"0.0625in",InsertShape.mergeWithFormats&&(t||(t={}),U.each(InsertShape.mergeWithFormats,function(e,n){if(t[n]){var o=t[n];"object"==typeof o?(void 0!=o.length?o=o.concat(InsertShape.mergeWithFormats[n]):J.extend(!0,o,InsertShape.mergeWithFormats[n]),i[n]=o):i[n]=e}else i[n]=e})),i},InsertShape.handleCursorCollapsed=function(){InsertShape.isShapeSelected()&&InsertShape.hideEditorCursor()},InsertShape.setLock=function(e){return(e.data||e).nvOProps.nvODProps={locks:{noModify:!0,lockers:[{prop:"MODIFY",locker:Math.uuid()}]}},e},InsertShape.tobeSkippedCmds=["cut","copy","paste"],InsertShape.shapeCache={},InsertShape.watermarkObj={},InsertShape.constant={CONTENT:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur lectus urna, aliquet nec lacinia at, tempus ut sapien. Cras condimentum ante justo, vel luctus felis facilisis ut. Pellentesque dapibus pellentesque diam, lacinia cursus odio rutrum eget.",HEADING:"Lorem ipsum dolor sit amet",DEFAULT_MARGIN_RIGHT_VAL:"0.0625in",OVERLAY_BORDER_WIDTH:12,DROPCAP_FONT_COLORS_MAP:{normal:[0,0,0],greenfill:[255,255,255],bluefill:[255,255,255],dropcap1:[0,0,0],dropcap2:[255,255,255],dropcap3:[255,255,255],dropcap4:[0,0,0],dropcap5:[0,0,0],dropcap6:[106,192,105],dropcap7:[0,0,0],dropcap8:[0,0,0],dropcap9:[0,0,0],dropcap10:[165,65,24],dropcap11:[0,0,0],dropcap12:[255,255,255],dropcap13:[255,255,255],dropcap14:[255,255,255],dropcap15:[0,0,0],dropcap16:[0,0,0],dropcap17:[0,169,165],dropcap18:[0,0,0],dropcap19:[0,0,0]},WATERMARK:"WATERMARK",BGSHAPE:"bgshape"},InsertShape.init=function(){},InsertShape.getShapeFromFloatImages=function(e){for(var t=e.floatImages,i=[],n=0;n<t.length;n++)t[n].shapeData&&i.push(t[n]);return!!i.length&&i},InsertShape.removeFromCache=function(e){var t=e;if("object"==typeof e&&e.length)for(var i=0;i<e.length;i++){var n=e[i];t="string"==typeof n?n:n.id||(n.data||n.shapeData||n).nvOProps.nvDProps.id}else"string"!=typeof e&&(t=(e.data||e).nvOProps.nvDProps.id);delete J.ShapeData.shapes[t],delete InsertShape.shapeCache[t]},InsertShape.drawShapeInPara=function(e,t,i,n){var o=J(e);o.parents(".zw-page");InsertShape.setStyles(e,t);var r=t[ATTR_IMAGE.I_SHAPEDATA],a=o;a.length>1&&(a=J(a[0]).hasClass("watermark_cont")?J(a[1]):J(a[0])),a.css("display","none");var s=J(document.createElement("div"));J(s).addClass("zw-image");try{var l=r.nvOProps.nvDProps.id;r.fitModeData&&delete r.fitModeData,r.textBody&&(r.textBody.element="");var d=InsertShape.getShapeFromCache(l);if(d&&d[0]==JSON.stringify(r)){var c=d[1],u=J(c).clone(!0);if(u.css({top:0,left:0}),r.shapetype==InsertShape.constant.WATERMARK){var p=InsertShape.createWatermarkContainer();o.append(p.append(u))}else s.append(u)}else{isHeadlessPDF&&r.props.stroke&&0==r.props.stroke.width&&(r.props.stroke.fill={type:"NONE"});var g=void 0,f=r.shapes;r=InsertShape.applyThemeToRGB(r),InsertShape.updateShapedata(r,i);var E=InsertShape.getShapeFrameProp(r);if(r.fitModeData=E,f)J.each(f,function(e,t){t.fitModeData=InsertShape.getShapeFrameProp(t,l),t=InsertShape.applyThemeToRGB(t),f[e]=t,InsertShape.updateShapedata(t,i)}),r.shapes=f,g=InsertShape.createShape(r,s);else if(r.shapetype==InsertShape.constant.WATERMARK){r.fitModeData.top=0;var p=InsertShape.createWatermarkContainer();g=InsertShape.createShape(r,p),J(s).append(p)}else g=InsertShape.createShape(r,s);InsertShape.setImgUrlInhrefAttr(g,r),InsertShape.cloneDefsObjects(r,g,i),InsertShape.cacheShape(r,g)}J(s).children().length&&a.append(s),a.css("display","block")}catch(e){ZWCollaboration.clientInfo+="Draw Shape in para log :: "+e.stack}},InsertShape.getRGBArray=function(e){return e.indexOf("rgba")!=-1&&(e=ZWColorUtils.rgbaToRgb(e)),e.replace(/[rgb() ]/g,"").split(",")},InsertShape.getShapeFromCache=function(e){return InsertShape.shapeCache[e]},InsertShape.createWatermarkContainer=function(){var e=document.createElement("div");return e.setAttribute("class","inner_shape watermark_cont"),e.style.zindex=0,J(e)},InsertShape.updateShapedata=function(e,t){J.ShapeData.updateShapes(J.extend(!0,{},e)),e.shapetype==InsertShape.constant.WATERMARK&&t&&InsertShape.updateWaterMarkObj(e,t)},InsertShape.updateWaterMarkObj=function(e,t){t=t.replace("header_",""),"header"!=t&&"odd"!=t||(t="primary"),InsertShape.watermarkObj[t]=e.nvOProps.nvDProps.id},InsertShape.getShapeFrameProp=function(e,t){var i=10;e.shapes||(i+=e.props.stroke&&e.props.stroke.width||10);var n=J.extend(!0,{},e.props.transform);if(t){var o=J.ShapeData.getShapeData(t).props.transform,r=n.dim.height,a=n.dim.width,s=o.dim.height-o.chDim.height,l=o.dim.width-o.chDim.width;r+=s,a+=l,n.dim.height=r,n.dim.width=a}if(n.pos.left=0,n.pos.top=0,e.props.effects&&(n.dim.height*=2,n.dim.width*=2),e.props.geom&&e.props.geom.preset&&e.props.geom.preset.type.indexOf("CALLOUT")!=-1){var d=n.dim.width/2;n.pos.left-=d,n.dim.width+=d}return n.rotate&&(n=InsertShape.getTransformedSize(n)),{top:n.pos.top-i/2,left:n.pos.left-i/2,width:n.dim.width+i,height:n.dim.height+i}},InsertShape.getTransformedSize=function(e){if(e.rotate){var t=TransformationUtils.getTransformedSize(e.rotate,e.dim.width,e.dim.height);e.pos.left-=(t.width-e.dim.width)/2,e.pos.top-=(t.height-e.dim.height)/2,e.dim.height=t.height,e.dim.width=t.width}return e},InsertShape.isCloningNeeded=function(e){var t=!1;return"PICT"==(e.props.fill&&e.props.fill.type)||"CONNECTOR"==e.type?t=!0:e.props.effects&&(e.props.effects.shadow||e.props.effects.reflection)&&(t=!0),t},InsertShape.cloneDefsObjects=function(e,t,i){var n="";if(e.shapes){var o=e.shapes;J.each(o,function(e,t){if(InsertShape.isCloningNeeded(t))return void(n=!0)})}else n=InsertShape.isCloningNeeded(e);isHeadlessPDF||isHeadlessHTML||!i||i.indexOf("header")==-1&&i.indexOf("footer")==-1||!n||InsertShape.cloneDefsNodeToContainer(t,e)},InsertShape.cloneDefsNodeToContainer=function(e,t){var i=InsertShape.getPatterContainer(),n=InsertShape.getShapeId(t);i.find("."+n).remove();var o=e.find("defs").children();J.each(o,function(e,t){var o=J(t).clone(!0),r=o.attr("class")||"";o.attr("class",r+" "+n),i.append(o)})},InsertShape.getPatterContainer=function(){var e=Z("zw-patterns-defs-container");return e.length||(e=InsertShape.createPatternContainer()),e},InsertShape.createPatternContainer=function(){var e="http",t=J('<div id="zw-defcontainer" style="overflow:hidden;width:1px;height:1px;position: absolute;"><span id="zw-svgcontainer" style="display:block;"><svg xmlns="'+e+'://www.w3.org/2000/svg" xmlns:xlink="'+e+'://www.w3.org/1999/xlink" overflow="auto" preserveAspectRatio="none" style="position: absolute; top: -1px; left: -1px;" id="root" class="base_root" version="1.1" viewBox="-1, -1, 962,542" width="962" height="542" z-index="0"><defs id="zw-patterns-defs-container"></defs></svg></span></div>');return J("body").prepend(t),t.find("#zw-patterns-defs-container")},InsertShape.getShapeId=function(e){return(e.data||e).nvOProps.nvDProps.id},InsertShape.cacheShape=function(e,t){if(delete e.fitModeData,"GROUPSHAPE"==e.type){var i=e.shapes;J.each(i,function(e,t){t.textBody&&(t.textBody.element="",i[e]=t)})}else e.textBody&&(e.textBody.element="");var n=t.clone(!0),o=[];o.push(JSON.stringify(e)),o.push(n),InsertShape.shapeCache[e.nvOProps.nvDProps.id]=o},InsertShape.createShapeDiv=function(e){var t=J(e.el),i=t.find("div.shape_box");if(i[0]&&!i.hasClass("watermark_cont"))return!0;var n=(e.node,document.createElement("div")),o=J(n),r=document.createElement("span"),a="zshape_"+(new Date).getMilliseconds(),s={},l={};s.class="inner_shape",s["data-context"]="Rmenu",s.id=a,s.fid=shapeProp.fid,s.pid=shapeProp.parentId,l.position="absolute",l.top="0",l.left="0",l[ATTR_SHAPE.ZINDEX]="5",o.attr(s).css(l);var d=J(r);return d.attr("class","shapeAnchor ui-components-toolbar-icon ui-icon-zinsertanchor"),d.css("display","none"),o.append(r),t.append(n),o},InsertShape.removeShapeNodes=function(e){InsertShape.clearSelection();for(var t=0;t<e.length;t++)J(e[t].el).find("div.shape_box").remove()},InsertShape.clearSelection=function(e,t){},InsertShape.getSelectedShape=function(){return ShapeEditor.getSelectedShapes()[0]},InsertShape.sendErrorMail=function(e){ZWCollaboration.clientInfo+="Catch Exception  "+e,ZWCollaboration.clientInfo+=" STACKTRACE :::  "+e.stack},InsertShape.getFontFamiliesInShape=function(e,t){if(t||(t=[]),!e)return t;if(e.shapes)for(var i=0;i<e.shapes.length;i++)InsertShape.getFontFamiliesInShape(e.shapes[i],t);else if(e.textBody){var n=e.textBody.paras;if(n)for(var i=0;i<n.length;i++){var o=n[i].portions;if(o)for(var r=0;r<o.length;r++)try{t.push(o[r].props.font.fontFamily.name)}catch(e){}}}return t},InsertShape.applyThemeToRGB=function(e){var t=e.shapes,i=DocumentDesign.getTheme();if(t){for(var n=0;n<t.length;n++)e.shapes[n]=InsertShape.applyThemeToRGB(t[n]);return e}var o=InsertShape.getShapeFillObj(e,"fill");if(o&&"SOLID"==o.type){var r=o.solid.color.zwtheme&&o.solid.color.zwtheme.fill||o.solid.color.rgb;r.indexOf("zw")!=-1&&(r=Utils.getColorValFromRefString(r),r=InsertShape.getRGBArray(r),o.solid.color.rgb=r)}var a=InsertShape.getShapeFillObj(e,"stroke");if(a&&"SOLID"==a.type){var s=a.solid.color.zwtheme&&a.solid.color.zwtheme.sfill||a.solid.color.rgb;s.indexOf("zw")!=-1&&(s=Utils.getColorValFromRefString(s),s=InsertShape.getRGBArray(s),a.solid.color.rgb=s)}var l=e.textBody;if(l)for(var d=l.paras||[],n=0;n<d.length;n++)for(var c=d[n].portions,u=0;u<c.length;u++){var p=c[u],g=p.props.font.fontFamily.zwtheme&&p.props.font.fontFamily.zwtheme.fname||p.props.font.fontFamily.name;g==SHAPE.THEME.FF_ZWMINOR?g=i.font.minor.latin:g==SHAPE.THEME.FF_ZWMAJOR&&(g=i.font.major.latin),p.props.font.fontFamily.name=g}return e},InsertShape.setImgUrlInhrefAttr=function(e,t){if("GROUPSHAPE"===t.type){var i=t.shapes,n=e.children();J.each(n,function(e,t){if(i[e].props.fill&&"PICT"==i[e].props.fill.type){var n=J(t).find("image")[0];J(n).attr("href",i[e].props.fill.pict.value.url)}})}else if(t.props.fill&&"PICT"==t.props.fill.type){var o=e.find("image")[0];J(o).attr("href",t.props.fill.pict.value.url)}},InsertShape.getShapeFillObj=function(e,t){if(e&&t){var i="stroke"==t?e.props.stroke.fill:e.props.fill;return i}},InsertShape.setStyles=function(e,t){J(e).removeAttr("style");var i={};"front"!=t[ATTR_IMAGE.I_WRAP_TYPE]&&"behind"!=t[ATTR_IMAGE.I_WRAP_TYPE]&&(t.ml&&(i["margin-left"]=t.ml),t.mr&&(i["margin-right"]=t.mr),t.mt&&(i["margin-top"]=t.mt),t.mb&&(i["margin-bottom"]=t.mb)),i.height=t.ht+"px",i.width=t.wid+"px",i.position="relative",J(e).css(i)},InsertShape.createShape=function(e,t){var i="";return i="GROUPSHAPE"===e.type?J.GroupShape.create.draw(e,t):Shape.create.draw(e,t),J(i).css({top:0,left:0}),J(i)},ShapePaste.defaultData={TEXTBOX:'{"nvOProps":{"nvDProps":{"id":""}},"props":{"transform":{"fliph":false,"flipv":false,"dim":{"width":316,"height":117},"pos":{"left":252,"top":146,"zindex":0},"rotate":0},"geom":{"type":"PRESET","preset":{"type":"RECT"}},"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}}}},"themeRef":{"fillRef":{"ref":"THEME","color":{"type":"A1"}},"strokeRef":{"ref":"THEME","color":{"type":"A1","tweaks":{"shade":0.5}}},"fontRef":{"ref":"MINOR","color":{"type":"CUSTOM","rgb":[255,255,255]}}},"textBody":{"paras":[{"portions":[{"t":"","props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}},"unmerged":{"props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}}}}],"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}},"listStyle":{"bullet":{"type":"NONE","status":"disabled"}}},"unmerged":{"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}}}},"listNum":false}],"props":{"column":{"num":1,"gap":0},"valign":"TOP","inset":{"left":10,"right":10,"top":5,"bottom":5},"autoFit":{"type":"NONE"},"wrap":"NONE"},"element":"","id":"textcontainer"},"type":"SHAPE","editable":true,"textBox":true,"containerDim":{"width":"1000","height":"1000"}}',SHAPE:'{"nvOProps":{"nvDProps":{"id":""}},"props":{"transform":{"fliph":false,"flipv":false,"dim":{"width":88,"height":76},"pos":{"left":0,"top":0,"zindex":1},"rotate":0},"geom":{"type":"PRESET","preset":{"type":"RECT"}},"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[137,191,74]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE","solid":{"color":{"type":"A1","rgb":[112,154,63]}}}}},"themeRef":{"fillRef":{"ref":"THEME","color":{"type":"A1"}},"strokeRef":{"ref":"THEME","color":{"type":"A1","tweaks":{"shade":0.5}}},"fontRef":{"ref":"MINOR","color":{"type":"CUSTOM","rgb":[255,255,255]}}},"textBody":{"paras":[{"portions":[{"t":"","props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}},"unmerged":{"props":{"size":18,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}}}}],"style":{"halign":"CENTER","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}},"listStyle":{"bullet":{"type":"NONE","status":"disabled"}}},"unmerged":{"style":{"halign":"CENTER","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}}}},"listNum":false}],"props":{"column":{"num":1,"gap":0},"valign":"MIDDLE","inset":{"left":10,"right":10,"top":5,"bottom":5},"autoFit":{"type":"NONE"},"wrap":"NONE"},"element":"","id":"textcontainer"},"type":"SHAPE","editable":true,"containerDim":{"width":"1000","height":"1000"}}'},ShapePaste.getDefaultShapeData=function(e){e||(e="SHAPE");var t=JSON.parse(ShapePaste.defaultData[e]);return t.nvOProps.nvDProps.id=Math.uuid(),J.extend(!0,{},t)};var defaultParaFmt=ShapePaste.getDefaultShapeData().textBody.paras[0],defaultPortionFmt=ShapePaste.getDefaultShapeData().textBody.paras[0].portions[0],emptydummyPara={portions:[],style:{halign:"LEFT",level:1,margin:{left:0},dir:"LTR",defPrProps:{font:{fontFamily:{name:"Arial"},ref:"MINOR"},fill:{type:"SOLID",solid:{color:{type:"TX1",rgb:{0:0,1:0,2:0}}}},size:18,stroke:{type:"SOLID",width:2.6666667,fill:{type:"SOLID",solid:{color:{type:"A1",tweaks:{shade:.5},rgb:[56,93,138]}}},captype:"FLAT"}},spacing:{line:{type:"PERCENT",percent:"1.2"}},listStyle:{bullet:{type:"NONE",status:"disabled"}}},unmerged:{style:{halign:"LEFT",level:1,margin:{left:0},dir:"LTR",defPrProps:{font:{fontFamily:{name:"Arial"},ref:"MINOR"},fill:{type:"SOLID",solid:{color:{type:"TX1",rgb:{0:0,1:0,2:0}}}},size:18,stroke:{type:"SOLID",width:2.6666667,fill:{type:"SOLID",solid:{color:{type:"A1",tweaks:{shade:.5},rgb:[56,93,138]}}},captype:"FLAT"}},spacing:{line:{type:"PERCENT",percent:"1.2"}}}},listNum:!1};ShapePaste.fontFamiliesInPaste=[];var from_Char,from_Portion,from_Para,textlength,portionslength,to_Char,to_Portion,to_Para;ShapePaste.init=function(e,t,i,n){var o=e.text,r=null;if(!n)var n=InsertShape.getSelectedShapesArray();var a,s,l=n.length>1,d=[];if(l)InsertShape.clearSelection();else if(ShapeEditor.text.isEditable()){var c=ShapeEditor.text.editor._getFromTo().from.num.index,u=ShapeEditor.text.editor._getFromTo().to.num.index;r=c,InsertShape.updateShapeText(n[0],!0),InsertShape.editShape(c,u)}if(!i){var p=[],g=document.getElementById("pasteFrame"),f=g.contentWindow.document.getElementsByTagName("body")[0],E=document.createElement("div");E.innerHTML=f.innerHTML;var T=DocOpBuilder.build(PasteUtil.getComposedOpForCustomContent(E)),m=T.toString();p.push(JSON.parse(m)),a=ShapePaste.convertWriterOpToShapeData(p)}1==n.length&&r!=-1&&(r+=o.length,a&&a.paras.length&&(r+=a.paras.length));for(var s=null,h=0;h<n.length;h++){var I=n[h],_=I.data||I;if(l&&(InsertShape.select.shape(_),InsertShape.editShape(-1)),!s){if(i||t){var A={paras:[],portions:[]},S=ShapePaste.getCursorProperty().from,R=_.textBody.paras[S.para].portions[S.portion],O=J.extend(!0,{},R);t&&(O.mminfo=t),O.t=o,A.portions.push(O),a=A}s=ShapePaste.processShape(a,_)}_.textBody.paras=s.paras,InsertShape.isTextModified=null,d.push(I)}return d},ShapePaste.convertWriterOpToShapeData=function(e){var t=0,n=0,o=e,r={paras:[],portions:[]};ShapePaste.fontFamiliesInPaste=[];var a,s,l,d=[];for(j=0;j<o.length;j++){var c=o[j];for(i=0;i<c.length;i++){if(c[i].as&&c[i].as.start){var u=c[i].as.start;if("listFormat"==u.st)l=u;else if("paragraph"==u.type){s=$.extend(!0,{},defaultPortionFmt);var p=DocUtil.getRenderingFormat(u);a=ShapePaste.fillParagraphFmt(p,l,d)}else{var g=DocUtil.getRenderingFormat(u);s=ShapePaste.fillPortionFmt(g)}}if(c[i].is){var f=c[i].is,E={TABLE:"",ROW:"",CELL:"",TABLEEND:"",IMAGE:"",IFRAME:"",RANGE_START:"",RANGE_END:"",MULTIBYTE_SPACE:"　",SECTION_START:"",HR:"\r",TOCEND:"",TOCSTART:"",MERGEFIELD_START:"«",MERGEFIELD_END:"»"};f=f.replace(new RegExp(E.RANGE_END+"|"+E.MULTIBYTE_SPACE+"|"+E.SECTION_START+"|"+E.HR+"|"+E.TOCEND+"|"+E.TOCSTART+"|"+E.MERGEFIELD_START+"|"+E.MERGEFIELD_END+"|"+E.IMAGE+"|"+E.IFRAME+"|"+E.RANGE_START+"|"+E.TABLE+"|"+E.ROW+"|"+E.CELL+"|"+E.TABLEEND,"g"),""),"\v"==f?(s.type="LINEBREAK",d[n]=s,n++):""!=f&&"\n"!=f?(s.t=f,d[n]=s,n++):"\n"==f&&(d.length>0&&(a.portions=d),d=[],r.paras[t]=a,n=0,t++,a=$.extend(!0,{},defaultParaFmt))}}}return d.length>0&&(r.portions=d),r},ShapePaste.fillPortionFmt=function(e){dummyPortionFmt=$.extend(!0,{},defaultPortionFmt);var t=DocumentDesign.getTheme();if(e.ff){var i=e.ff;i=i.split(",")[0],i==Utils.getThemeFonts(t)[0].toLowerCase()&&(i=SHAPE.THEME.FF_ZWMINOR),dummyPortionFmt.props.font.fontFamily.name=i,ShapePaste.fontFamiliesInPaste.indexOf(i)==-1&&ShapePaste.fontFamiliesInPaste.push(i)}if(e.fgc){var n=e.fgc,o=ShapePaste.getColor(n);dummyPortionFmt.props.fill.solid.color.rgb=o}else dummyPortionFmt.props.fill.solid.color.rgb=[0,0,0];if(e.size){var r=e.size;dummyPortionFmt.props.size=r}if("bold"==e.fw&&(dummyPortionFmt.props.bold=!0),"italic"==e.fs&&(dummyPortionFmt.props.italic=!0),e.td){var a=e.td;a.indexOf("underline")!=-1&&(dummyPortionFmt.props.underline="SINGLE"),a.indexOf("line-through")!=-1&&(dummyPortionFmt.props.strike="SINGLE")}"super"==e.va&&(dummyPortionFmt.props.baseline=.3),"sub"==e.va&&(dummyPortionFmt.props.baseline=-.25),dummyPortionFmt.unmerged={props:dummyPortionFmt.props};$.extend({},dummyPortionFmt.props);return dummyPortionFmt},ShapePaste.fillParagraphFmt=function(e,t,i){if(dummyParaFmt=$.extend(!0,{},defaultParaFmt),e.ml){var n=e.ml;if(/px$/i.test(n))n=parseFloat(n);else{var o=n.convertor();n=parseFloat(o.pixels.toFixed(3))}dummyParaFmt.style.margin.left=n}if(e.ti){var n=e.ti.replace("in","");n=parseFloat(n);var r=72*n;dummyParaFmt.style.indent=r}if(e.ls_data){if(dummyParaFmt.style.listStyle.bullet={number:{},character:{}},dummyParaFmt.style.listStyle.font={fontFamily:{name:"Arial"}},dummyParaFmt.style.listStyle.color={rgb:[255,255,255]},e.ml){var n=e.ml.replace("in","");n=parseFloat(n);var a=72*n;dummyParaFmt.style.margin.left=a}dummyParaFmt=ShapePaste.listStyle(e,dummyParaFmt,i);var s,l,d=e.ls_data.id,c=e.ls_data.l,u=ShapePaste.getListProperties();if(dummyParaFmt.listNum=1,dummyParaFmt.style.level=c+1,null!=editor.doc.getListType(d,c))l=editor.doc.getListType(d,c),s=u[l],dummyParaFmt.style.listStyle.bullet=s;else{var p=t[d],g="level";l=p[g+c]?p[g+c].type:p,8==l&&(dummyParaFmt.style.listStyle.font.fontFamily.name="Wingdings"),s=u[l],dummyParaFmt.style.listStyle.bullet=s}}if(e.al){var f=e.al;1==f?dummyParaFmt.style.halign="CENTER":2==f&&(dummyParaFmt.style.halign="RIGHT")}if(e.sa){var E=e.sa,T=E.convertor().pixels;dummyParaFmt.style.spacing.after={absolute:T,type:"ABSOLUTE"}}if(e.sb){dummyParaFmt.style.spacing.before={};var m=e.sb,h=m.convertor().pixels;dummyParaFmt.style.spacing.before={absolute:h,type:"ABSOLUTE"}}if(e.ls){var I=e.ls,_=parseFloat(I)||1;dummyParaFmt.style.spacing.line.percent=_}return dummyParaFmt.unmerged={style:dummyParaFmt.style},dummyParaFmt},ShapePaste.listStyle=function(e,t,i){var n={},o=12,r="Arial",a=[255,255,255],s=12,l=[255,255,255];return e.ts&&(n=e.ts),n.ff?(r=n.ff,r=r.split(",")[0],t.style.listStyle.font.fontFamily.name=r):(i.length>0&&i[0].props.font.fontFamily.name&&(r=i[0].props.font.fontFamily.name,r=r.split(",")[0],t.style.listStyle.font.fontFamily.name=r),t.style.listStyle.font.fontFamily.name=r),n.fgc?(a=n.fgc,l=ShapePaste.getColor(a),t.style.listStyle.color.rgb=l):(i.length>0&&i[0].props.fill.solid.color.rgb&&(a=i[0].props.fill.solid.color.rgb,l=ShapePaste.getColor(a)),t.style.listStyle.color.rgb=l),i.length>0&&i[0].props.size&&(o=i[0].props.size),n.size?(s=n.size,s=parseFloat(s/o),t.style.listStyle.size=s):(s=parseFloat(s/o),t.style.listStyle.size=s),t},ShapePaste.getColor=function(e){var t=[0,0,0];try{if(e.indexOf("#")!==-1){var i=hexToRgb(e);t[0]=i.r,t[1]=i.g,t[2]=i.b}else if(e.indexOf("rgb(")!==-1)t=e.replace(/rgb\(| |\)/g,"").split(",");else if(e.indexOf("rgba(")!=-1){var n=e.replace(/rgba\(| |\)/g,"").split(","),o=n[3],r=255,a=Math.round((1-o)*r+o*n[0]),s=Math.round((1-o)*r+o*n[1]),l=Math.round((1-o)*r+o*n[2]);t=[a,s,l]}}catch(e){}return t},ShapePaste.getListProperties=function(){var e={0:{number:{type:"NUMERIC",suffix:"."},status:"enabled",type:"NUMBER"},1:{number:{type:"LCROMAN",suffix:"."},status:"enabled",type:"CHARACTER",character:{ch:"8226"}},2:{number:{type:"LCROMAN",suffix:"."},status:"enabled",type:"NUMBER"},3:{number:{type:"UCALPHABET",suffix:"."},status:"enabled",type:"NUMBER",character:{ch:"8226"}},4:{number:{type:"LCALPHABET",suffix:"."},status:"enabled",type:"NUMBER"},5:{number:{type:"NUMERIC",suffix:"."},status:"enabled",type:"CHARACTER",character:{ch:"113"}},6:{number:{type:"NUMERIC",suffix:"."},status:"enabled",type:"CHARACTER",character:{ch:"8226"}},7:{number:{type:"NUMERIC",suffix:"."},status:"enabled",type:"CHARACTER",character:{ch:"111"}},8:{type:"CHARACTER",number:{type:"NUMERIC",suffix:"."},character:{ch:"167"},status:"enabled"}};return e},ShapePaste.getCursorProperty=function(){var e=ShapeEditor.text.getObject();return void 0==e.from.para&&void 0==e.to.para&&(e.from={para:0,ch:0,portion:0},e.to={para:0,ch:0,portion:0}),e},ShapePaste.processShape=function(e,t){var i,n=ShapeEditor.text.getObject(),o=$.extend({},t.textBody);return from_Char=n.from.ch,from_Portion=n.from.portion,from_Para=n.from.para,to_Char=n.to.ch,to_Portion=n.to.portion,to_Para=n.to.para,void 0!=from_Para&&(portionslength=o.paras[from_Para].portions.length,void 0!=o.paras[from_Para].portions[from_Portion].t?textlength=o.paras[from_Para].portions[from_Portion].t.length:o.paras[from_Para].portions[from_Portion].type&&"LINEBREAK"==o.paras[from_Para].portions[from_Portion].type&&(textlength=0)),1==o.paras.length&&1==o.paras[0].portions.length&&void 0==o.paras[0].portions[0].t?i=ShapePaste.processEmptyPara(e,o):0==from_Portion&&from_Char==-1||from_Portion==portionslength-1&&from_Char==textlength?i=ShapePaste.processParaStart(e,o):from_Para==to_Para&&from_Char==to_Char&&(from_Portion>0||from_Char>-1)?i=ShapePaste.processParaCenter(e,o):from_Char!=to_Char?i=ShapePaste.processSelectionPara(e,o):void 0==from_Para&&(i=ShapePaste.processNoCursor(e,o)),t.textBody.paras=i.paras,t.textBody},ShapePaste.processNoCursor=function(e,t){var i=[InsertShape.getDefaultShapeData().textBody.paras[0]];return 0==e.paras.length?(i[0].portions=e.portions,t.paras=i):e.paras.length>0&&(t.paras=e.paras,e.portions.length>0&&(i[0].portions=e.portions,t.paras=t.paras.concat(i))),t},ShapePaste.processSelectionPara=function(e,t){var i=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(t)),o=i.paras.slice(0,from_Para+1),r=o[from_Para].portions.slice(0,from_Portion+1),a=r[from_Portion].t.slice(0,from_Char);r[from_Portion].t=a,o[from_Para].portions=r;var s=n.paras.slice(to_Para),l=s[0].portions.slice(to_Portion),d=l[0].t.slice(to_Char+1);l[0].t=d,s[0].portions=l;var c;if(0==e.paras.length){var u=o[from_Para].portions.concat(e.portions);o[from_Para].portions=u,c=o.concat(e.paras);var p=c[c.length-1].portions.concat(s[0].portions);c[c.length-1].portions=p,s.splice(0,1)}else if(e.paras.length>0){var g=o[from_Para].portions.concat(e.paras[0].portions);o[from_Para].style=e.paras[0].style,o[from_Para].portions=g,e.paras.splice(0,1),c=o.concat(e.paras),e.portions.length>0&&(s[0].portions=e.portions.concat(s[0].portions))}var f=c.concat(s);return t.paras=f,t},ShapePaste.processParaCenter=function(e,t,i){var n=JSON.parse(JSON.stringify(t)),o=JSON.parse(JSON.stringify(t)),r=n.paras.slice(0,from_Para+1),a=r[from_Para].portions.slice(0,from_Portion+1),s=a[from_Portion].t.slice(0,from_Char+1);a[from_Portion].t=s,r[from_Para].portions=a;var l=o.paras.slice(to_Para),d=l[0].portions.slice(to_Portion),c=d[0].t.slice(to_Char+1);d[0].t=c,l[0].portions=d;var u;if(0==e.paras.length){u=r.concat(e.paras);var p=r[from_Para].portions.concat(e.portions);r[from_Para].portions=p;var g=u[u.length-1].portions.concat(l[0].portions);u[u.length-1].portions=g,l.splice(0,1)}else if(e.paras.length>0){var f=r[from_Para].portions.concat(e.paras[0].portions);r[from_Para].style=e.paras[0].style,r[from_Para].portions=f,e.paras.splice(0,1),u=r.concat(e.paras),e.portions.length>0&&(l[0].portions=e.portions.concat(l[0].portions))}var E=u.concat(l);return t.paras=E,t},ShapePaste.processParaStart=function(e,t,i){var n=[];if(1==t.paras.length){if(from_Portion==portionslength-1&&from_Char==textlength){var o=[t.paras[0]];if(0==e.paras.length){var r=e.portions,a=o[0].portions.concat(r);o[0].portions=a,t.paras=o}else if(e.paras.length>0){n=JSON.parse(JSON.stringify(o));var s=o[0].portions.concat(e.paras[0].portions);o[0].style=e.paras[0].style,o[0].portions=s,e.paras.splice(0,1);var l=e.paras,d=o.concat(l);t.paras=d,e.portions.length>0&&(n[0].portions=e.portions,t.paras=t.paras.concat(n))}}else if(0==from_Portion&&from_Char==-1){var o=[t.paras[0]];if(0==e.paras.length){var r=e.portions,a=r.concat(o[0].portions);o[0].portions=a,t.paras=o}else if(e.paras.length>0){var l=e.paras;e.portions.length>0&&(o[0].portions=e.portions.concat(o[0].portions));var d=l.concat(o);o=d,t.paras=o}}}else if(t.paras.length>0){var c=t.paras.slice(0,from_Para),u=[t.paras[from_Para]],p=t.paras.slice(to_Para+1);if(u[0].portions[0].t||(u[0].portions.length>0&&!e.portions.length>0?u.splice(0,1):u[0].portions.splice(0,1)),from_Portion==portionslength-1&&from_Char==textlength){if(0==e.paras.length){var r=e.portions,a=u[0].portions.concat(r);u[0].portions=a}else if(e.paras.length>0){n=[$.extend({},u[0])];var s=u[0].portions.concat(e.paras[0].portions);u[0].style=e.paras[0].style,u[0].portions=s,e.paras.splice(0,1),e.portions.length>0&&(n[0].portions=e.portions)}var g=e.paras,f=c.concat(u),E=f.concat(g),T=E.concat(n),m=T.concat(p);t.paras=m}else if(0==from_Portion&&from_Char==-1){if(0==e.paras.length){var r=e.portions,a=r.concat(u[0].portions);u[0].portions=a}else e.paras.length>0&&u.length>0&&(u[0].portions=e.portions.concat(u[0].portions));var g=e.paras,E=c.concat(g),f=E.concat(u),h=f.concat(p);t.paras=h}}return t},ShapePaste.processEmptyPara=function(e,t){if(0==e.paras.length)t.paras[0].portions=e.portions;else if(e.paras.length>0){var i=$.extend({},t);t.paras=e.paras,e.portions.length>0&&(i.paras[0].portions=e.portions,t.paras=t.paras.concat(i.paras))}return t},ShapePaste.drawPastedShape=function(e){var t=$("#drawcontainer");$(document).zshapeintegrator({container:t}),$(document).zshapeintegrator("draw",e,t);var i=$(".zw-paragraph"),n=i.find("div.shape_box");Shape.create.draw(e,n);$.ShapeData.updateShapes(e)},ShapePaste.processShapePaste=function(e,t,i){if(!i.pasteOpnInfo.imagePaste&&0==t.getElementsByTagName("img").length){var n,o=[];ShapeEditor.text.isEditable()&&(n=ShapeEditor.text.editor._getFromTo().from.num.index);var r=null;if(!r){var a=[],s=document.getElementById("pasteFrame"),l=s.contentWindow.document.getElementsByTagName("body")[0],d=document.createElement("div");d.innerHTML=l.innerHTML;var c=DocOpBuilder.build(PasteUtil.getComposedOpForCustomContent(d)),u=c.toString();a.push(JSON.parse(u));var p=ShapePaste.convertWriterOpToShapeData(a)}return 1==InsertShape.getSelectedShapesArray().length&&n!=-1&&(n+=i.content.text.length,p&&p.paras.length&&(n+=p.paras.length)),o=ShapePaste.init(i.content,r,i.pasteOpnInfo.textPaste),InsertShape.applyStyle(o,!0,"shapePaste",!0),void 0==n||o.length>1||o[0].parentIds[0]||InsertShape.editShape(n,n),!1}return!0},hexToRgb=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,n){return t+t+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null};var Widget=function(){"use strict";var e,t,i,n,o,r,a,s=!1,l={"ins-lpnl-embed":{title:"writer.common.EMBED",content:"writer.common.EMBED_TOOLTIP"}},d=/(<iframe.*)/g,c=/^((http|https|www\.)(:\/\/|)[\w-]+(\.[\w-]+)+([\w.,@?^=\(\)%&amp;:\/~+#-]*[\w@?^\(\)=%&amp;\/~+#-])?)$/,u=/(www\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/user\/\S+|\/ytscreeningroom\?v=))([\w-]{10,12})\b/,p=function(e){return c.lastIndex=0,c.test(e)},g=function(e){return d.lastIndex=0,d.exec(e)},f=function(e){return u.lastIndex=0,u.exec(e)},E=function(){return!!J(".zw-ifr-div.ui-actv")[0]},T=function(){return o},m=function(e){o=e},h=function(){o=void 0};ATTR_WIDGET.WIDGET_DEF_IMG=imgCdnZWStaticPath+fingerPrintObj[ATTR_WIDGET.WIDGET_DEF_IMG];var I=function(e){var t;return window.clipboardData?t=window.clipboardData.getData("Text"):void 0!=e.originalEvent.clipboardData&&(t=e.originalEvent.clipboardData.getData("text")),t},_=function(){J("#embed-optionspanel-url").on("keyup",function(e){var t=e.keyCode||e.which,i=e.ctrlKey||e.metaKey;if(i&&t==KEYS.V)return!0;var n=J("#embed-optionspanel-url").val();n&&0!==n.length?R(n,"embed-optionspanel-url"):Y()}),e=!0},A=function(){J("#embed-url").on("keyup",function(e){var t=e.keyCode||e.which,i=e.ctrlKey||e.metaKey;if(i&&t==KEYS.V)return!0;var n=J("#embed-url").val();n&&0!==n.length?R(n,"embed-url"):W()}),e=!0},S=function(e){var t=!1,i=g(e),n=p(e),o={};return e.length>0&&i&&(o=G(e)),i&&o[ATTR_WIDGET.SRC]&&o[ATTR_WIDGET.SRC].match(ATTR_WIDGET.URL_REGEX)?t=!0:n&&e.match(ATTR_WIDGET.URL_REGEX)&&(t=!0),t},R=function(e,t){if("embed-url"==t&&document.getElementById("embed_url_btn").disabled)J("#embed_url_options").removeClass("ui-zwdisabled"),J("#embed_url_btn").enable(),J("#embedobjecterrormsg").hide();else if("embed-optionspanel-url"==t&&document.getElementById("embed-options-insert-btn").disabled){J("#embed-dimension-options").zselectbox("enable"),f(e)?J("#embed-player-controls").zstatebutton("enable"):J("#embed-player-controls").zstatebutton("disable"),J("#embedoptionserrormsg").hide();var i=J("#embed-dimension-options").zselectbox("getAttribute","selectedValue");"fitcust"==i&&J("#custom-dimensions-selector").removeClass("ui-zwdisabled"),J("#embed-options-insert-btn").enable()}},O=function(e,t){if("embed-url"==t)J("#embed_url_btn").disable(),J("#embed_url_options").addClass("ui-zwdisabled"),J("#embedobjecterrormsg").show().text(J.i18n("writer.common.INVALID_CODE"));else if("embed-optionspanel-url"==t){J("#embed-dimension-options").zselectbox("disable"),J("#embed-player-controls").zstatebutton("disable"),J("#embedoptionserrormsg").show().text(J.i18n("writer.common.INVALID_CODE"));var i=J("#embed-dimension-options").zselectbox("getAttribute","selectedValue");"fitcust"==i&&J("#custom-dimensions-selector").addClass("ui-zwdisabled"),J("#embed-options-insert-btn").disable()}},b=function(){var e=J("#embed-url").val();S(e)?N(e):O(e,"embed-url")},v=function(){var e=J("#embed-optionspanel-url").val();if(S(e)){if(g(e)){var t=P(e),i=V(e,"width",t.iframeWidth);e=void 0!==i?i:e,i=V(e,"height",t.iframeHeight),e=void 0!==i?i:e,t.wrapType&&(e=L(e,t)),C()&&(e=D(e,"controls","false"))}N(e)}else O(e,"embed-optionspanel-url")},D=function(e,t,i){var n="<iframe",o=e.indexOf(n);if(o==-1)return e;var r=e.indexOf(">",o);return e=e.substring(0,r)+" "+t+'="'+i+'"'+e.substring(r)},L=function(e,t){if(t.wrapType){var i="<iframe",n=e.indexOf(i);if(n!=-1){var o=t.positionH,r=t.positionV,a=t.wrapType,s=e.indexOf(">",n);return e=e.substring(0,s)+" positionH="+JSON.stringify(o)+" positionV="+JSON.stringify(r)+" wrapType="+JSON.stringify(a)+" "+e.substring(s)}return e}return e},N=function(e){var t=g(e);p(e);if(t){var i=j(e,"src"),n=decodeURI(i);e=e.replace(i,n)}else e=decodeURI(e),e=y(e);if(e.length>0){var o={};o=G(e),ee(o)}Z("embedObject").zpopover("close"),J("#embedoptionsdialogzdialog").zdialog("close")},P=function(){var e,t,i,n={},o={},r=J("#embed-dimension-options").zselectbox("getAttribute","selectedValue");if("fitmargin"==r){var a=DocLayoutManager.getCurrentSection();null!=a&&(e=a.getDOMViewWidth(),t=2*e/3)}else if("fitedge"==r){var s=DocLayoutManager.getCurrentPage();null!=s&&(e=s.getDOMViewWidth(),t=2*e/3);var l=editor.doc.getSelection().getStart(),d=DocLayoutManager.getLineAtIndex(l),c=d.getAbsTop(VIEW.PARA);n.from="page",n.left=0,n.type="absolute",o.from="paragraph",o.top=c,o.type="absolute";var i="front"}else"fitcust"==r&&(e=J("#fitcustomwidth").zlabelednumberfield("getValue"),t=J("#fitcustomheight").zlabelednumberfield("getValue"));var u={};return u.iframeWidth=e,u.iframeHeight=t,i&&(u.positionH=n,u.positionV=o,u.wrapType=i),u},C=function(){var e=!1,t=J("#embed-player-controls")[0];return t&&!J("#embed-player-controls").prop("checked")&&(e=!0),e},y=function(e){var t,i='<iframe src="'+e+'" ';if(J("#embed-dimension-options")[0]){t=P();var n=t.iframeWidth,o=t.iframeHeight;if(t.wrapType){var r=t.positionH,a=t.positionV,s=t.wrapType;i+="positionH="+JSON.stringify(r)+" ",i+="positionV="+JSON.stringify(a)+" ",i+="wrapType="+JSON.stringify(s)+" "}}else{var l=DocLayoutManager.getCurrentSection();null!=l&&(n=l.getDOMViewWidth(),o=2*n/3)}return n&&(i+='width="'+n+'" '),o&&(i+='height="'+o+'" '),C()&&(i+='controls="false" '),i+='title="YouTube video player" frameborder="0" allowfullscreen></iframe>'},F=function(){var e=J("#embed-dimension-options").zselectbox("getAttribute","selectedValue");"fitcust"==e?(J("#custom-dimensions-selector").show(),J("#fitkeepaspect").zbutton("setAttribute","disabled",!1),w()):J("#custom-dimensions-selector").hide()},M=function(){var e=J("#embed-optionspanel-url").val();g(e)?(w(),J("#embed-dimension-options").zselectbox("setAttribute","selectedIndex",2)):(J("#embed-dimension-options").zselectbox("setAttribute","selectedIndex",0),J("#custom-dimensions-selector").hide())},w=function(){var e=J("#embed-optionspanel-url").val(),n=z(e),o=DocLayoutManager.getCurrentSection(),r=n[ATTR_WIDGET.HT],a=n[ATTR_WIDGET.WID];void 0==a&&null!=o&&(a=o.getDOMViewWidth()),void 0==r&&null!=o&&(r=o.getDOMViewHeight()),t=a,i=r,J("#fitcustomwidth").zlabelednumberfield("setValue",a),J("#fitcustomheight").zlabelednumberfield("setValue",r)},U=function(){var e={init:function(){if("leftPanel"==n){J("#embedObject").zpopover("close");var e=J("#embed-url").val();J("#embed-optionspanel-url").val(e).text(e),M()}else{var o=editor.doc.getSelection().getStart(),r=editor.doc.getRawFormatAt(o),e=r.widgetSrc;J("#embed-optionspanel-url").val(e).text(e),J("#embed-dimension-options").zselectbox("setAttribute","selectedIndex",2),J("#custom-dimensions-selector").show(),J("#fitcustomwidth").zlabelednumberfield("setValue",t),J("#fitcustomheight").zlabelednumberfield("setValue",i),r.hasOwnProperty("controls")&&"false"===r.controls?J("#embed-player-controls").prop("checked",!1):J("#embed-player-controls").prop("checked",!0),J("#embed-options-insert-btn").zbutton("setAttribute","text",J.i18n("writer.common.UPDATE"))}f(e)?J("#embed-player-controls").zstatebutton("enable"):J("#embed-player-controls").zstatebutton("disable"),_()},beforeopen:function(){},set:function(e,t,i){x(e,t,i)}};J.dialogutil.open("embedoptionsdialog",void 0,e)},x=function(e,n,o){if("updateDimensionOptions"==e.action){var n=J("#embed-dimension-options").zselectbox("getAttribute","selectedValue");"fitcust"==n?(J("#custom-dimensions-selector").removeClass("ui-zwdisabled"),J("#fitkeepaspect").zbutton("setAttribute","disabled",!1),J("#custom-dimensions-selector").show(),w()):J("#custom-dimensions-selector").hide()}else if("processWidgetDimensions"==e.action&&J("#fitkeepaspect").zbutton("getAttribute","checked")){var r=o.getAttribute("id");if("fitcustomheight"==r){var a=J("#fitcustomheight").zlabelednumberfield("getValue"),s=a*t/i;J("#fitcustomwidth").zlabelednumberfield("setValue",s)}else if("fitcustomwidth"==r){var s=J("#fitcustomwidth").zlabelednumberfield("getValue"),a=s*i/t;J("#fitcustomheight").zlabelednumberfield("setValue",a)}}},B=function(){Z("embedObject").zpopover("close");var e=J("#embed-url").text(),t=j(e,"src"),i=decodeURI(t);if(e=e.replace(t,i),e.length>0){var n={};n=G(e),ee(n)}},H=function(e){var t=editor.doc.getSelection(),i=DocLayoutManager.getContentWidthAtIndex(t.getStart()),n=2*i/3,o=DocLayoutManager.getPageWidthAtIdx(t.getStart()),r=(WidgetView.decodeHtml(e[ATTR_WIDGET.SRC].trim()),DocLayoutManager.getPageHeightAtIdx(t.getStart())),a=e[ATTR_WIDGET.HT]?e[ATTR_WIDGET.HT]:n,s=e[ATTR_WIDGET.WID]?e[ATTR_WIDGET.WID]:i;a>r&&(a=r),s>o&&(s=o),e[ATTR_WIDGET.SUBTYPE]=ATTR_WIDGET.WIDGET,e[ATTR_WIDGET.HT]=a,e[ATTR_WIDGET.WID]=s,e[ATTR_WIDGET.TYPE]=NODE_TYPE.IMAGE;var l=e[ATTR_IMAGE.I_SRC]?"true":"false";e[ATTR_WIDGET.THUMBNAIL]||(e[ATTR_WIDGET.THUMBNAIL]=l);var d=e[ATTR_IMAGE.I_SRC]?e[ATTR_IMAGE.I_SRC]:ATTR_WIDGET.WIDGET_DEF_IMG;return e[ATTR_IMAGE.I_SRC]=d,e},G=function(e){var t={};t[ATTR_WIDGET.SRC]=j(e,"src");var i=j(e,"width"),n=j(e,"height");if(i=void 0!=i&&i.includes("%")?DocLayoutManager.getCurrentSection().getWidth():i,t[ATTR_WIDGET.WID]=i,n=void 0!=n&&n.includes("%")?i/2:n,t[ATTR_WIDGET.HT]=n,0==t[ATTR_WIDGET.HT]||0==t[ATTR_WIDGET.WID]){var o=j(e,"style").split(";");o&&o.length>1&&o.forEach(function(e){e.indexOf("height")!=-1?t[ATTR_WIDGET.HT]=e.split(":")[1]:e.indexOf("width")!=-1&&(t[ATTR_WIDGET.WID]=e.split(":")[1])})}e.indexOf("positionH")!==-1&&(t[ATTR_IMAGE.I_H_POSITION]=JSON.parse(k(e,"positionH")),t[ATTR_IMAGE.I_V_POSITION]=JSON.parse(k(e,"positionV")),t[ATTR_IMAGE.I_WRAP_TYPE]=j(e,"wrapType"));var r=j(e,"controls");return void 0!==r&&"false"===r&&(t[ATTR_WIDGET.CONTROLS]="false"),t},k=function(e,t){var i=[" "];t=" "+t+"=";var n=e.indexOf(t);if(n!=-1){n+=t.length+1;for(var o="{",r=-1,a=0;a<i.length;a++){var s=e.indexOf("}"+i[a],n);if(s!=-1){r=s;break}}return o+e.substring(n,r)+"}"}},W=function(){J("#embedobjecterrormsg").hide(),J("#embed_url_btn").disable(),J("#embed_url_options").addClass("ui-zwdisabled")},Y=function(){J("#embed-dimension-options").zselectbox("disable"),J("#embed-player-controls").zstatebutton("disable"),J("#embedoptionserrormsg").hide(),J("#custom-dimensions-selector").addClass("ui-zwdisabled"),J("#embed-options-insert-btn").disable()},z=function(e){var t={},i=j(e,"width"),n=j(e,"height");if(i=void 0!=i&&i.includes("%")?DocLayoutManager.getCurrentSection().getWidth():i,t[ATTR_WIDGET.WID]=i,n=void 0!=n&&n.includes("%")?i/2:n,t[ATTR_WIDGET.HT]=n,0==t[ATTR_WIDGET.HT]||0==t[ATTR_WIDGET.WID]){var o=j(e,"style").split(";");o&&o.length>1&&o.forEach(function(e){e.indexOf("height")!=-1?t[ATTR_WIDGET.HT]=e.split(":")[1]:e.indexOf("width")!=-1&&(t[ATTR_WIDGET.WID]=e.split(":")[1])})}return t},V=function(e,t,i){var n=[" ",">"," >","/>"," />"];t=" "+t+"=";var o=e.indexOf(t);if(o!=-1){o+=t.length+1;var r="";e.indexOf("'",o)==o?(o+=1,r="'"):e.indexOf('"',o)==o&&(o+=1,r='"');for(var a=-1,s=0;s<n.length;s++){var l=e.indexOf(r+n[s],o);if(l!=-1){a=l;break}}return e.slice(0,o)+i+e.slice(l-1)}},j=function(e,t){var i=[" ",">"," >","/>"," />"];t=" "+t+"=";var n=e.indexOf(t);if(n!=-1){n+=t.length+1;var o="";e.indexOf("'",n)==n?(n+=1,o="'"):e.indexOf('"',n)==n&&(n+=1,o='"');for(var r=-1,a=0;a<i.length;a++){var s=e.indexOf(o+i[a],n);if(s!=-1){r=s;break}}return e.substring(n,r).replaceAll('"',"").replaceAll("'","")}},X=function(){var e=editor.doc.getSelection().getStart(),t=editor.doc.getRawFormatAt(e);if(t&&t.widgetSrc){var i=t.widgetSrc,n=/^((ht|f)tp(s?)\:\/\/){0,1}[-.\w]*(\/?)([a-zA-Z0-9\|\(\)~\-\.\!\?\,\:\'\/\\\+=&amp;%\$#_@\P{InBasicLatin}]*)?$/,o=encodeURI(i.trim()),r=n.test(o);if(r){var a=editor.doc.getSelection(),s=a.getRangeAt(0);a.deleteContents(s.start,s.end+1),Op.sendMsg();var l={},d=LinkDialog.getLinkType(i);l.text=i,l.url=o,l.type=d,editor.doc.execCmd("CreateLink",l)}}},K=function(){var e=editor.doc.getSelection(),t=e[0],i=editor.doc.getParents(NODE_TYPE.LINK,t.start-1);if(null!=i){var n=i.attr(ATTR_LINK.LINK_URL)||"",o=editor.doc.createRange(i.getStart(),i.getEnd());e.removeAllRanges().addRange(o),e.deleteContents(o.start,o.end),Op.sendMsg(),Widget.insertNewWidget(n)}},q=function(){var e=editor.doc.getSelection(),t=e.getRangeAt(0);e.deleteContents(t.start,t.end+1),Op.sendMsg()},Q=function(){var e=editor.doc.getSelection().getStart(),t=editor.doc.getRawFormatAt(e);if(t&&t.widgetSrc){var i=t.widgetSrc;window.open(i,"_blank")}},$=function(){var e=editor.doc.getSelection().getStart(),o=editor.doc.getRawFormatAt(e);o&&o.widgetSrc&&(t=o.wid,i=o.ht,n="menu",U())},ee=function(e){var t=H(e);editor.doc.execCmd("insobj",t),ZWLogger.addToStatistics("widgetInsrt")},te=function(e){var t=H(e);if(t.thumbnail||(t[ATTR_WIDGET.THUMBNAIL]=""),void 0!=t||null!=t){var i=editor.doc.getSelection().getStart(),n=(editor.doc.getFormats()[i],a.map[r]);n&&(editor.doc.execCmd("applyStyle",[n,t,"updateIframe"]),ZWLogger.addToStatistics("updateWidget"))}},ie=function(t,i){if(t&&J(t.target).is("#embedObject")){J("#embedobjecterrormsg").hide(),J("#embed_url_btn").disable(),J("#embed-url").val("");var o=J("#embed_url_options");n="leftPanel",o[0].addEventListener("click",U),o.show(),o.addClass("ui-zwdisabled")}e||(ZWComponentUtil.init("embedObject"),A()),setTimeout(function(){J("#embed-url").focus()},150)},ne=function(e,t){e.onmouseenter=function(e,t){this.parentElement.style.overflow="unset",e.classList.add("sheet-z-index")}.bind(e,t),e.onmouseout=function(e,t){J(t.toElement).parents("#ResizeGrid").length||(this.parentElement.style.overflow="hidden",e.classList.remove("sheet-z-index"))}.bind(e,t)},oe=function(e,t){J(e).addClass("ui-iframe-loading-gif");var i=editor.doc.getSelection().getStart(),n=DomViewManager.getDOMElem(DocLayoutManager.getLineAtIndex(i)),o=t?t:editor.doc.getFormats()[i];if(o[ATTR_WIDGET.SRC]||o.hasOwnProperty(ATTR_WIDGET.SHEET_INFO)&&null!=o[ATTR_WIDGET.SHEET_INFO]){var r=J(e);J(J(r).find(".wid-info-container")[0]).hide();var a=J(r).find(".widget-iframe")[0];if(a=WidgetView.createIframeWithProps(o),o.hasOwnProperty(ATTR_WIDGET.SHEET_INFO)){var s=J.Deferred();s.promise(),ne(a,n),s.done(function(){var t=J.Deferred();t.promise(),Widget.setActiveWidgetInfo({data:o,node:e,deferred:t})}),a.onload=function(){s.resolve()}}r.prepend(a),Widget.isIframeLoaded=!0,J(a).show(),PubSub.subscribe(["Cursor/Collapsed","Cursor/Selected"],Widget.closeIFrame)}},re=function(){var e=editor.doc.getSelection(),t=Widget.getActiveWidgetInfo();e.selectionType!=SEL_OP_GEN&&(PubSub.unsubscribe(["TransformableObject/destroyed","EventDiv/Up","TransformableObject/Reconstructed","Cursor/Collapsed","Cursor/Selected"],Widget.closeIFrame),t&&t.data&&t.data[ATTR_WIDGET.SHEET_INFO]?(SheetOperation.beforeSheetClose(t),J(".widget-iframe").parent("div ")[0].setAttribute("active-widget-sheet-rid",t.data[ATTR_WIDGET.SHEET_INFO].rid)):(J(".widget-iframe").remove(),Widget.clearActiveWidgetInfo(),J(".wid-info-container").show()),J(J(".ui-iframe-loading-gif")[0]).removeClass("ui-iframe-loading-gif"))},ae=function(e){PubSub.subscribe(["TransformableObject/destroyed","EventDiv/Up","TransformableObject/Reconstructed"],Widget.closeIFrame),oe(e)};return PubSub.subscribe("TransformableObject/Widget/Active",ae),UIUtils.addHTMLTooltips(l),{insertWidget:B,insert:ee,getActiveWidgetInfo:T,setActiveWidgetInfo:m,clearActiveWidgetInfo:h,update:te,isIframeLoaded:s,isTargetWidget:E,closeIFrame:re,loadWidgetInIFrame:oe,getClipBoardText:I,clearFields:ie,updateDimensionOptions:F,insertFromEmbedDialog:b,insertFromEmbedOptionsDialog:v,convertWidgetToHyperLink:X,openWidgetInNewTab:Q,deleteWidget:q,openEmbedOptionsPanel:$,resetEmbedOptionsDialog:Y,insertNewWidget:N,convertHyperLinkToWidget:K}}(),VideoEmbed=function(){"use strict";var e={},t={0:"all",1:"youtube",2:"vimeo",3:"dailymotion"},i="1",n=!1,o=function(){J("#searchSnippet").on("paste",function(e){var t=Widget.getClipBoardText(e);s(t)}),J("#searchSnippet").on("keyup",function(e){e.keyCode==KEYS.ENTER&&J(this).val().length>0&&s()}),J("#ytvidscontainer").on("click",".ui-videoitem",function(t){var i=J(t.target),n=J(t.currentTarget),o=n.attr("id"),a=e[o];i.hasClass("video-insert")?l(a):i.hasClass("video-play")&&r(a,n)}),J("#videoProviderCombobox").on("zselectboxchange",function(e,t){var i=t.selectedValue;p(i)}),n=!0},r=function(e,t){J(".ui-videoitem-vid").attr("src","").add(".ui-videoitem-insert").hide(),J(".ui-videoitem-img").show(),J(".ui-videoitem-play").css("display","");var i=WidgetView.getEmbedUrl(e.SRC,!0),n="<iframe class='ui-videoitem-vid ui-videoitem-cont' src='"+i+"'></iframe>",o=t.find(".ui-videoitem-vid");o.length>0?o.attr("src",i):t.find("#videoCont").append(n),t.find(".ui-videoitem-vid,.ui-videoitem-insert").show().end().find(".ui-videoitem-img,.ui-videoitem-play").hide()},a=function(e){J("#embedOptions").find(".ui-video-dummylistcont")[e?"removeClass":"addClass"]("ui-hide")},s=function(e){J("div.ui-video-listcont").empty();var n=(e||J("#searchSnippet").val()).trim();if(0!=n.length){a(!0);var o=!1,r=J.ZVideoLibrary.PublicVideos[t[i]],s={startIndex:0,limit:10,keyword:n,nextPageToken:"",contextPath:"/writer/fcomponents/"};r.load(void 0,s,function(e,t){try{o="string"==typeof t?JSON.parse(t):t,o&&o.TOTALCOUNT>0?(a(!1),d(o.VIDEOS),J("#yterrormsg").hide(),J("#ytvidscontainer").show()):(J("#ytvidscontainer").hide(),a(!1),J("#yterrormsg").fadeIn("fast",function(){J("#yterrormsg").text(J.i18n("writer.embed.NO_RESULT_FOR",[J("#searchSnippet").val()]))}))}catch(e){o=!1}})}},l=function(e){h();var t={src:e.THUMBNAIL_SRC,widgetSrc:e.SRC};Widget.insert(t),ZWLogger.addToStatistics("Insert_Youtube_Video")},d=function(e){for(var t=Handlebars.compile(J("#utube-container").html()),i="",n=0;n<e.length;n++){var o=c(e[n]);i+=t(o)}J("#ytvidscontainer").html(i)},c=function(t){var i={};return i.VIDEO_IMG_SRC=u(t.VIDEO_BIGIMAGE||t.VIDEO_PICTURE[0].link),i.VIDEO_NAME=t.VIDEO_NAME,i.VIDEO_DURATION=t.VIDEO_URL.indexOf("youtube")!=-1?m(t.VIDEO_DURATION):T(t.VIDEO_DURATION),i.VIDEO_URL=t.VIDEO_URL,u(i.VIDEO_URL),i.VIDEO_ID=Math.floor(1e3*Math.random()+1),e[i.VIDEO_ID]={SRC:i.VIDEO_URL,THUMBNAIL_SRC:i.VIDEO_IMG_SRC},i},u=function(e){return e.match("^http://")&&(e=e.replace("http:","https:")),e},p=function(e){var t=i!=e;i=e,t&&J("#searchSnippet").val().trim().length>0&&s()},g=function(e){for(var t=!1,i=WIDGET.VIDEO_REGEX,n=Object.keys(i),o=0;o<n.length;o++)if(i[n[o]].test(e)){t=!0;break}return t},f=function(e){var t=document.createElement("div"),i=document.createElement("iframe"),n=document.createElement("p"),o=J(i),r={},a=editor.doc.getSelection(),s=DocLayoutManager.getContentWidthAtIndex(a.getStart()),l=2*s/3;r[ATTR_IMAGE.I_SRC]=WidgetView.getEmbedUrl(e,!1),r["data-thumbnail-src"]=WidgetView.getThumbnailUrl(e),r["data-thumbnail"]=!!r["data-thumbnail-src"];var d={};return d[ATTR_WIDGET.WIDTH]=s,d[ATTR_WIDGET.HEIGHT]=l,o.css(d),o.attr(r),n.appendChild(i),t.appendChild(n),PubSub.publish("DocOperation/PasteCompleted"),t},E=function(e,t,i){var n="";return e&&(n+=e+"h "),t>0&&(n+=t+" min "),n+=i+" sec "},T=function(e){var t=Math.floor(e/3600),i=e%3600,n=Math.floor(i/60),o=i%60,r=Math.ceil(o);return E(t,n,r)},m=function(e){var t=new Date(e).getTime(),i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60),o=Math.floor(t-3600*i-60*n);return E(i,n,o)},h=function(){J("#searchSnippet").val(""),J("div.ui-video-listcont").empty(),J("#yterrormsg").hide(),LeftPanel.closeDynamicPanel(ELEM_ID.EMBEDOPTIONPANEL)},I=function(){var e=jsCdnZWStaticPath+fingerPrintObj["js/fcomponents_videolibrary.js"],t=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_videolibrary.css"],i=jsCdnZWStaticPath+fingerPrintObj["js/fcomponents_imagelibrary.js"],n=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_imagelibrary.css"],o=cssCdnZWStaticPath+fingerPrintObj["styles/fcomponents_common.css"];zw.require({js:[e,i],css:[o,t,n]},[],function(){_()})},_=function(){n||o();var e={panelId:ELEM_ID.EMBEDOPTIONPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[ELEM_ID.INSERTPANEL]};LeftPanel.showAdvancedPanel(e)};return{loadVideos:s,play:r,createPasteBody:f,isSupportedUrl:g,closeToolbar:h,showEmbedToolbar:I}}();ChartHandler=function(){"use strict";var e={normal:{1:["Category","Series 1","Series 2"],2:["Category 1",52,22],3:["Category 2",23,52],4:["Category 3",45,23],5:["Category 4",31,70]},pie:{1:["Category","value"],2:["Category 1",63],3:["Category 2",12],4:["Category 3",17],5:["Category 4",8]},timeseries:{1:["Date","Open","High","Low","Close"],2:["1/1/16","82829787","60292528","13161950","85647937"],3:["4/1/16","23267597","97476228","67111656","114750295"],4:["5/1/16","92482943","116472938","39088928","120275456"],5:["6/1/16","144487728","150068459","16019792","11979121"],6:["7/1/16","52362016","60268712","36366039","73176632"],7:["8/1/16","104898678","35667456","111622545","101389883"],8:["11/1/16","28094175","135390265","18941142","43844059"],9:["12/1/16","76812442","158229185","36659762","72565371"],10:["13/1/16","14670256","73009925","76153551","39231820"]},stock:{1:["Date","Open","High","Low","Close"],2:["5/30/07","500","565","499","545"],3:["5/31/07","695","750","555","710"],4:["6/1/07","766","864","764","810"],5:["6/2/07","919","1025","871","953"],6:["6/3/07","1052","1174","1003.5","1085"],7:["6/4/07","1185","1324","1136","1218"],8:["6/5/07","1318","1473","1268","1350"],9:["6-Jun-07","1451","1623","1401","1483"],10:["7-Jun-07","1584","1772","1533","1615"]},bullet:{1:["Category","Series 1","Series 2","Series 3","Series 4"],2:["Category 1","52","22","52","22"],3:["Category 2","23","52","23","52"],4:["Category 3","45","23","45","23"],5:["Category 4","31","70","31","70"]},bubble:{1:["X coordinate","Y coordinate","Population"],2:[10500,3500,132696e4],3:[7700,2e3,113996e4],4:[-9700,3800,30554e4],5:[12e3,-500,228582e3],6:[-5500,-1e3,187994e3],7:[7e3,3e3,164727e3],8:[9e3,2400,158665e3],9:[800,1e3,148093e3]}},t="BAR",i=function(e,t,i){var r=new XFormMap,a=Utils.randomString(),s=function(e){var t=[],i=r.map[a],n=i.docOps[4].styles.begin;n[ATTR_CHART.SHEET_ID]=e.sheetid,n[ATTR_CHART.CHART_ID]=e.chartid,n[ATTR_IMAGE.I_SRC]=e.imageurl,i.docOps[4].styles.begin=n,i.docOps[6].styles.end=Object.keys(n),t.push(i),Op.msgBuffer=Op.msgBuffer.concat(t),Op.sendMsg(),r.flushOp(),r=void 0,TableVisualCueHandler.close(),PanelUtil.toggleTableOptions()},l={success:function(e){Notification.hide(),i&&s(e)},failure:function(){Notification.show({message:"writer.chart.UNABLE_TO_INSERT_CHART",close:!1,setTimer:!0,type:"error"}),r.flushOp(),r=void 0}};Notification.show({message:"writer.chart.INSERT_CHART_MSG",close:!0,setTimer:!1,type:"info"});var d=editor.uuid.replace(/[\/\\_\-%]/gi,""),c=i?null:d+Utils.randomString();i&&n(l,e,t,c);var u,p,g=editor.getDocument(),f=g.getSelection(),E=f.getRangeAt(0);if(i){u=E.getStartNode(),p=u.getParents(NODE_TYPE.TABLE)[0];var T=p.getPreviousSibling();p.remove();var m=T.splitAt(T.length-1),h=o({}),I=g.createNode(NODE_TYPE.CHART);I.style.height=h.height,I.style.width=h.width,I.style.id=Utils.getRandomNumber(),m.append(I);var _=g.getChanges();r.putOp(_,a),r.enableAutoUpdate()}else{var h=o({}),I=g.createNode(NODE_TYPE.CHART,l);I.setChartType(e),t&&I.setChartData(t),I.style.height=h.height,I.style.width=h.width,I.style.id=Utils.getRandomNumber(),E.insertNode(I),g.sync()}},n=function(e,t,i,n){var r="/writer/v1/chart/"+Macros.getRId()+"/create",a={},s={};o(s),a.csv_data=i,a.chart_type=t,a.height=parseInt(s.height),a.width=parseInt(s.width);var l={success:function(t){var i=JSON.parse(t);e.success&&e.success(i)},fail:function(t,i,n){e.failure&&e.failure(t.responseJSON)},setHeaders:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}};J.ajaxUpload(r,a,l,"json")},o=function(e){var t=editor.doc.getSelection(),i=DocLayoutManager.getContentWidthAtIndex(t.getStart()),n=2*i/3,o=(DocLayoutManager.getPageHeightAtIdx(t.getStart()),DocLayoutManager.getCurrentPage()),r=o.getMaxContentHeight(),a=e[ATTR_WIDGET.HT]?e[ATTR_WIDGET.HT]:n,s=e[ATTR_WIDGET.WID]?e[ATTR_WIDGET.WID]:i;return a>r&&(a=r),s>i&&(s=i),e[ATTR_COMMON.SUBTYPE]=ATTR_CHART.CHART,e.height=parseInt(a),e.width=parseInt(s),e[ATTR_COMMON.TYPE]=NODE_TYPE.IMAGE,e[ATTR_IMAGE.I_SRC]=ATTR_WIDGET.WIDGET_DEF_IMG,e},r=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.TABLE),n=e.dtNode.getContent();n=n.replaceAll(UNICODE.TABLE+"|"+UNICODE.TABLEEND+"|"+UNICODE.PARA,""),n=n.replace(UNICODE.ROW+UNICODE.CELL,""),n=n.replaceAll(UNICODE.ROW+UNICODE.CELL,"\n"),n=n.replaceAll(UNICODE.CELL,",");var o=new Blob([n],{type:"text/csv"});i(t,o,!0)},a=function(t){var n=t[0],o=t[1];if("BAR"!=n&&"COL"!=n&&"PIE"!=n&&"XYAREA"!=n&&"XYLINE"!=n){var r;r=d(e[o]);var a=new Blob([r],{type:"text/csv"});i(n,a,!1)}else i(n)},s=function(e){var t=J(e.target).parents("div.chart-edit-cont"),i=t.attr("data-sheet_id"),n=editorProps.urls.zohoSheetURL+"/sheet/open/"+i;return Utils.safeWindowOpen(n),e&&e.stopPropagation(),!1},l=function(e){var t=J(e.target),i=t.parents("div.fgImgOuterDiv"),n=i.find(".zw-image")[0],o=n.getAttribute("xlink:href"),r={success:function(e){Notification.hide()},failure:function(e){if(e&&e.responseJSON&&e.responseJSON.sheet_errorCode){var i=e.responseJSON.sheet_errorCode;"401"==i?Notification.show({message:"writer.chart.PERMISSION_DENIED_TO_UPDATE_CHART",close:!1,setTimer:!0,type:"error"}):"404"==i?Notification.show({message:"writer.chart.CHART_NOT_FOUND",close:!1,setTimer:!0,type:"error"}):Notification.show({message:"writer.chart.UNABLE_TO_UPDATE_CHART",close:!1,setTimer:!0,type:"error"})}else Notification.show({message:"writer.chart.UNABLE_TO_UPDATE_CHART",close:!1,setTimer:!0,type:"error"});var n=J(t).parents("div.fgImgOuterDiv");n.removeClass("ui-abs-loading-gif"),n.find(".zw-image")[0].setAttribute("xlink:href",o)}};Notification.show({message:"writer.chart.UPDATE_CHART_MSG",close:!0,setTimer:!1,type:"info"});var a=editor.getDocument(),s=a.getSelection().getRangeAt(0),l=s.getStartNode();return l.type===NODE_TYPE.IMAGE&&l.isChart()&&(l.updateChart(r),a.sync()),i.addClass("ui-abs-loading-gif"),i.find(".zw-image")[0].setAttribute("xlink:href",""),e&&e.stopPropagation(),!1},d=function(e){for(var t=1,i="";e.hasOwnProperty(t);){1!=t&&(i=i.concat("\n"));for(var n=e[t],o=0;o<n.length;o++)i=i.concat(e[t][o]),o<=n.length-2&&(i=i.concat(","));t+=1}return i},c=function(e){if(!e)return!1;var t=document.createElement("html"),i=!1;t.innerHTML=e;var n=t.querySelectorAll("[source]");if(n.length){var o=n[0].getAttribute("source");i=o.indexOf("ZSHEET_CHART")!=-1}return i},u=function(e){if(!e)return!1;var t=document.createElement("html"),i=!1;t.innerHTML=e;var n=t.querySelectorAll("[source]");if(n.length){var o=n[0].getAttribute("source");i=o.indexOf("ZSHEET_RANGE")!=-1}return i},p=function(){T()},g=function(){0==J("#chartsmenu").children().length&&f()},f=function(){var e=[],t={customAttributes:{id:"chartmenu-template-loadingmsg"},itemType:"custom",innerHTML:'<div class="ui-loading-cont"><div>'+J.i18n("writer.common.LOADING")+'</div><div class="ui-loading-gif"> </div></div>'};e.push(t);var i=J("#chartsmenu");return i.zmenu("hideAllMenuItems"),i.zmenu("addMenuItems",e),!0},E=function(){if(Array.from(document.body.querySelectorAll("div[data-sheet_id]")).forEach(function(e){e.style.display="none"}),CURSOR_CONTEXT_DEFINITIONS.isChartFromSheet()){var e=editor.doc.getSelection(),t=e.getStart(),i=editor.doc.getRawFormatAt(t),n=i[ATTR_CHART.SHEET_ID],o=document.body.querySelector('div[data-sheet_id="'+n+'"]');o.style.display="block"}},T=function(){var e=J("#chartsmenu");e.zmenu("destroy"),e.zmenu("showAllMenuItems"),e.zmenu({forElement:"#ins-lpnl-chart-button"}),e.zmenu("removeMenuItems",[J("#chartmenu-template-loadingmsg")]),J("#chartsmenu").zmenu("show")};return PubSub.subscribe("Cursor/Collapsed",E),{insert:a,convertTableToChart:r,updateChart:l,editChart:s,isChartFromSheet:c,isTableFromSheet:u,onChartMenuInit:p,beforeMenuShow:g}}();var ZWActions=function(){"use strict";var e=function(){editor.doc.execCmd("undo")},t=function(){editor.doc.execCmd("redo")},i=function(){ShowInfo.attentionMsg("cut")},n=function(){ShowInfo.attentionMsg("copy")},o=function(){ShowInfo.attentionMsg("paste")},r=function(){editor.doc.execCmd("delete","prevchar")},a=function(){editor.doc.getSelection().selectAll()},s=function(){editor.doc.execCmd("Bold")},l=function(){editor.doc.execCmd("Italic")},d=function(){editor.doc.execCmd("Underline")},c=function(){editor.doc.execCmd("Strikethrough")},u=function(e){editor.doc.execCmd(e)},p=function(){editor.doc.execCmd("indent","DI")},g=function(){editor.doc.execCmd("outdent","DI")},f=function(){editor.doc.execCmd("FormatPainter")},E=function(){editor.doc.execCmd("RemoveFormat")},T=function(e){editor.doc.execCmd("changecase",e)},m=function(){editor.doc.execCmd("capitalizeword")},h=function(e){editor.doc.execCmd(e)},I=function(e){editor.doc.execCmd("direction",e)},_=function(){var e={theme:"classic",level:3,leader:1,showNo:!0,al_right:!0};editor.doc.execCmd("inserttoc",e)},A=function(){var e=[];e.push("inshr"),e.push({cls:"pgbrk",bid:"pgbrk"}),editor.doc.execCmd(e)},S=function(){editor.doc.execCmd("inshr")},R=function(){var e=[];e.push("autofield");var t=editor.doc.docInfo.DOCUMENT_NAME;t=t.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),""),e.push(["autodocname",t]),editor.doc.execCmd(e)},O=function(){var e=[];e.push("autofield"),e.push(["autoauthor",editor.doc.docInfo.CREATOR]),editor.doc.execCmd(e)},b=function(){var e=[];e.push("autofield"),e.push(["autopcnt","##"]),editor.doc.execCmd(e)},v=function(e){editor.doc.execCmd("changeView",e)},D=function(e){var t=PageLayout.getDimension(e),i={};i[ATTR_BODY.DS_OR]=e,i[ATTR_BODY.DS_PH]=t.height+Conversions.globalUnit,i[ATTR_BODY.DS_PW]=t.width+Conversions.globalUnit;var n=L(t.width);if(n){var o=DocLayoutManager.getCurrentSection(),r=o.getNode(),a=editor.getDocument();editor.doc.execCmd("updatesectionstyle",[{sectionNodes:[r],styles:i},a]),a.sync()}else PubSub.publish("Document/Warning",WARNING_MSG.COLUMN_WIDTH_IS_LESS)},L=function(e){var t=editor.doc.getSelection(),i=DocLayoutManager.getColumnFormatAtIdx(t.getStart()),n=DocLayoutManager.getCurrentSection(),o=i.iseqwidth,r=(i.width,i.space),a=i.count;if(o&&a>1){var e=e,s=Conversions.toGlobalUnit(n.getLeft()+"px"),l=Conversions.toGlobalUnit(n.getRight()+"px"),d=parseFloat(Conversions.toGlobalValue(CONST.MIN_COLUMN_WIDTH))*a,c=parseFloat(r[0])*(a-1),u=d+c+s+l;return!(u>e)}return!0},N=function(){return WC.getWordCountDetails()},P=function(){return DocLayoutManager.getPageCount()},C=function(){return DocLayoutManager.getVisiblePageNumbers()[0]},y=function(){UIUtils.switchToDarkMode(document.createElement("button"))},F=function(e){return UIUtils.setZoomFactor(e.zoomFactor),{result:1}},M=function(){return editor.zoomFactor};return{undo:e,redo:t,cut:i,copy:n,paste:o,deleteChar:r,selectAll:a,applyBold:s,applyItalic:l,applyUnderline:d,applyStrikethrough:c,changeParaAlign:u,increaseIndent:p,decreaseIndent:g,formatPainter:f,clearFormat:E,changeCase:T,capitalizeText:m,changeVerticalAlign:h,changeTextDirection:I,insertTOC:_,insertPageBreak:A,insertHorizontalLine:S,insertDocumentName:R,insertAuthorName:O,insertPageCount:b,changeView:v,changeOrientation:D,getCurrentPageNumber:C,getPageCount:P,getWordCountDetails:N,getZoomFactor:M,setZoomFactor:F,toggleDarkMode:y}}(),UIActions=function(){"use strict";var e=function(){UIUtils.loadDistributeFileResouces()},t=function(){Utils.loadRTE(!0,function(){PubSub.publish("Email/Init")})},i=function(){PubSub.publish("PageLayoutPanel/open")},n=function(){FileMenu.openMarkNewVersion()},o=function(){HistoryUI.loadHistoryPage()},r=function(){DocumentPropertiesPanel.openPanel()},a=function(){ZWActions.undo()},s=function(){ZWActions.redo()},l=function(){ZWActions.cut()},d=function(){ZWActions.copy()},c=function(){ZWActions.paste()},u=function(){ZWActions.deleteChar()},p=function(){ZWActions.selectAll()},g=function(){ZWActions.applyBold()},f=function(){ZWActions.applyItalic()},E=function(){ZWActions.applyUnderline()},T=function(){ZWActions.applyStrikethrough()},m=function(){ZWActions.changeParaAlign("JustifyLeft")},h=function(){ZWActions.changeParaAlign("JustifyCenter")},I=function(){ZWActions.changeParaAlign("JustifyRight")},A=function(){ZWActions.changeParaAlign("JustifyFull")},S=function(){ListOperation.manageListOption([2])},R=function(){ListOperation.manageListOption([1])},O=function(){ZWActions.increaseIndent()},b=function(){ZWActions.decreaseIndent()},v=function(){ZWActions.formatPainter()},D=function(){ZWActions.clearFormat()},L=function(){FindAdaptor.openFind()},N=function(){ZWActions.changeCase("upper")},P=function(){ZWActions.changeCase("lower")},C=function(){editor.doc.execCmd("sentencecase")},y=function(){editor.doc.execCmd("SmallCaps")},F=function(){ZWActions.capitalizeText()},M=function(){ZWActions.changeVerticalAlign("Superscript")},w=function(){ZWActions.changeVerticalAlign("Subscript")},U=function(){ZWActions.changeTextDirection("ltr")},x=function(){ZWActions.changeTextDirection("rtl")},B=function(){ImageHandler.openInsertImageDialogue()},H=function(){LinkDialog.openLinkPopup()},G=function(){BookmarkDialog.openBookmarkPopup()},k=function(){ZWActions.insertTOC()},W=function(){CommentAdapter.newComment()},Y=function(){ZWActions.insertPageBreak()},z=function(){ZWActions.insertHorizontalLine()},Z=function(){UIUtils.openLatexDialog()},V=function(){InsertSpl.open()},j=function(){ZWActions.insertDocumentName()},X=function(){ZWActions.insertAuthorName()},K=function(){ZDateField.insertCurrentDate()},q=function(){ZWActions.insertPageCount()},Q=function(){CustomDictionary.openDialog()},$=function(){Thesaurus.insertThDlg()},ee=function(){WordCountDlg.insertWCDlg()},te=function(){Settings.showSettingsDlg()},ie=function(){ZWActions.changeView("Page View")},ne=function(){UIUtils.handleBrowserFullscreen()},oe=function(){ZWActions.changeView("Web View")},re=function(){ZWActions.changeOrientation("Portrait")},ae=function(){ZWActions.changeOrientation("Landscape")},se=function(){FileMenu.newFile()},le=function(){ImportDialog.importDoc()},de=function(){PrintPreview.printUsingBrowser()},ce=function(e){ExportDialog.exportAs(e)},ue=function(){ExportDialog.open()},pe=function(){UIUtils.openShareDialog()},ge=function(){WDHandler.initialiseSaveAs(function(){PubSub.publish("MakeACopy/Open",{operation:["editor",!0]})})},fe=function(){Template.openSaveAsTemplatePopup()},pe=function(){UIUtils.openShareDialog()},Ee=function(){PubSub.publish("Trash/Init")},Te=function(){GoToDialogue.openGoToDialogue()},me=function(){PubSub.publish("ParagraphPanel/Open",{tabToSelect:1})},he=function(){DropCap.insertDropCap("normal")},Ie=function(){PubSub.publish("ParagraphPanel/Open")},_e=function(){TableInsertDlg.openTablePopup()},Ae=function(){ChartHandler.insert(["COL","normal"])},Se=function(){PubSub.publish("BarcodeQrcode/FetchJS",{operation:"insert-barcode"})},Re=function(){PubSub.publish("BarcodeQrcode/FetchJS",{operation:"insert-qrcode"})},Oe=function(){editor.doc.execCmd(["insertnote",{options:{focusElement:!0},type:"endnote"}])},be=function(){editor.doc.execCmd(["insertnote",{options:{focusElement:!0},type:"footnote"}])},ve=function(){editor.doc.execCmd(["insblankpage",{cls:"pgbrk",bid:"pgbrk"}])},De=function(){ZSignController.editSignFromPanel("signature")},Le=function(){PubSub.publish("digiSignpanel/showMenu",{operation:"sign-dlg"})},Ne=function(){PubSub.publish("MergeFields/ShowPanel")},Pe=function(){PubSub.publish("subpanel-insertfillablefield/open",{operation:"insert_fillable_fields"})},Ce=function(){LockDlg.openLockDlg()},ye=function(){editor.doc.execCmd("redact")},Fe=function(){TCAdaptor.toggleState()},Me=function(e){"allmarkup"==e?TrackChangeUI.changeDisplayMode(1):"nomarkup"==e?(TrackChangeUI.changeDisplayMode(2),_):"orginal"==e&&TrackChangeUI.changeDisplayMode(4)},we=function(){CombineAdapter.doCombine()},Ue=function(){WebUtil.checkOutDocument()},xe=function(){Proofing.toggleSp()},Be=function(){Proofing.toggleGrammar()},He=function(){DocLocaleDlg.openDialog()},Je=function(){ConvertTextToTable.init()},Ge=function(){PubSub.publish("ReaderView/Show")},ke=function(){J("#view-lpnl-hideshowbookmark").ztoggleswitch("switch"),BookmarkDialog.toggleBookmark()},We=function(){J("#view-lpnl-gridlines").ztoggleswitch("switch"),UIUtils.updateGridlinesStyle()},Ye=function(){DocumentMap.openPane()},ze=function(){UIUtils.setZoomFactor(""+100*(editor.zoomFactor+.25))},Ze=function(){UIUtils.setZoomFactor(""+100*(editor.zoomFactor-.25))},Ve=function(){PubSub.publish("Image/HandleImageCarousel",{operation:"imagePreview"})},je=function(){J("#view-lpnl-hideshowbookmark,#view-lpnl-gridlines,#bbar-sp-switch,#bbar-grammar-switch,#pausecollab,#bbar-tc-switch,#proofing-sp-toggleswitch,#proofing-grm-toggleswitch").bind("ztoggleswitchchange",function(e,t){PubSub.publish("Document/toggleSwitch",e,t)})};return{loadDistributeFileResouces:e,showEmailAsAttachment:t,showPageSetupPanel:i,showCreateNewVersionDialog:n,showDocumentHistory:o,showDocumentProperties:r,showDocumentImages:Ve,undo:a,redo:s,cut:l,copy:d,paste:c,deleteChar:u,selectAll:p,applyBold:g,applyItalic:f,applyUnderline:E,applyStrikethrough:T,alignLeft:m,alignCenter:h,alignRight:I,alignJustify:A,applyUnorderedList:S,applyOrderedList:R,increaseIndent:O,decreaseIndent:b,formatPainter:v,clearFormat:D,find:L,changeToUpperCase:N,changeToLowerCase:P,capitalizeText:F,sentenceCase:C,smallCaps:y,applySuperScript:M,applySubScript:w,changeDirectionToLTR:U,changeDirectionToRTL:x,showInsertImageDialog:B,showLinkPopup:H,showBookmarkDialog:G,insertTOC:k,addComment:W,insertPageBreak:Y,insertHorizontalLine:z,showEquationsDialog:Z,showSpecialCharactersDialog:V,insertDocumentName:j,insertAuthorName:X,insertCurrentDate:K,insertPageCount:q,showPersonalDictionary:Q,showThesaurus:$,showWordCount:ee,showSettingsDialog:te,changeToPageView:ie,changeToWebView:oe,changeToPortrait:re,changeToLandscape:ae,newFile:se,showImportDialog:le,print:de,exportDocument:ce,showExportDialog:ue,openShareDialog:pe,CopyDocument:ge,saveAsTemplate:fe,openShareDialog:pe,trashDocument:Ee,openGoToDialog:Te,openBordersAndShadingPanel:me,insertDropCap:he,showMoreParagraphOptionsPanel:Ie,showTableDialog:_e,insertChart:Ae,showBarCodeDialog:Se,showQRCodeDialog:Re,insertEndnote:Oe,insertFootNote:be,insertBlankPage:ve,showMySignaturePanel:De,showSignatureFiledsPanel:Le,showMergeFiledsPanel:Ne,showFillableFieldPanel:Pe,showLockDialog:Ce,redactContent:ye,toggleTrackChange:Fe,showMarkUP:Me,combineRevision:we,checkOutDocument:Ue,toggleSPellCheck:xe,showLanguageDialog:He,toggleGrammar:Be,convertTextToTable:Je,openReaderView:Ge,showHideBookMark:ke,showHideGridLines:We,openDocumentNavigation:Ye,changeToFullScreen:ne,zoomIn:ze,zoomOut:Ze,subscribeEvents:je}}();CURSOR_CONTEXT_DEFINITIONS={isCursorSelected:function(){return!editor.doc.getSelection().isCollapsed()},isCursorCollapsed:function(){return editor.doc.getSelection().isCollapsed()},isProofingAvailable:function(){if("undefined"!=typeof ProofingManager){var e=editor.doc.getSelection(),t=ProofingManager.getCollection().getWordDetailsAtIdx(e.getStart());if(!t||t.text.length>25||/\d/.test(t.text))return!1;if(t&&e.getStart()>=t.start&&e.getEnd()<=t.end&&t.status==ProofingConstants.STATUS.VALID)return!0}return!1},showTeachZia:function(){return ReviewUtil.isZohoCorpUser()&&Proofing.isEnglishLanguage(DocLocaleHandler.getLanguage())},isListItemSelection:function(){var e=editor.doc.getSelection(),t=editor.getRole().permissions.can("document.edit");return t&&e.isListItemSelection},isImage:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=editor.getRole().permissions.can("document.edit");if(i&&t&&(this.isHeader()||this.isFooter()||this.isBody())&&!t.attr("*").hasOwnProperty("widgetSrc")&&!t.attr("*").hasOwnProperty("shapeData"))return!0},isShape:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=editor.getRole().permissions.can("document.edit");if(i&&t&&t.attr("*").hasOwnProperty("shapeData")){var n=t.attr("*").shapeData;return!n.dropcapData&&"WATERMARK"!=n.shapetype}},isDropcap:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=editor.getRole().permissions.can("document.edit");if(i&&t&&t.attr("*").hasOwnProperty("shapeData")){var n=t.attr("*").shapeData;return!!n.dropcapData}},isCursorInsideTOC:function(){var e=editor.doc.getSelection(),t=editor.getRole().permissions.can("document.edit");return t&&e&&e.getParents(NODE_TYPE.TOC)},isTable:function(){var e=editor.getRole().permissions.can("document.edit"),t=editor.doc.getSelection();return e&&t.getParents(NODE_TYPE.CELL)},isSheetTable:function(){if(this.isTable()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE),i=t.attr("*");return i.hasOwnProperty(ATTR_TABLE.SHEET_RANGE_INFO)}return!1},isList:function(){var e=editor.getRole().permissions.can("document.edit"),t=editor.doc.getSelection(),i=t.getParaFormat();return e&&ListUtils.isList(i)},isSortable:function(){return this.isList()||ParaSort.isSortable()},isCode:function(){var e=editor.getRole().permissions.can("document.edit");return e&&ZWCode.isCodePara()},isQuote:function(){var e=editor.getRole().permissions.can("document.edit"),t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.PARAGRAPH),n=i.attr(ATTR_PARAGRAPH.PS_HD)?i.attr(ATTR_PARAGRAPH.PS_HD):0;return e&&103==n},isRefCharSection:function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.SECTION);return"undefined"!=typeof e.attr("refchar")},isEndnote:function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.SECTION);return"endnote"==e.subType},isFootnote:function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.SECTION);return"footnote"==e.subType},isCurrentLevelIsOrderList:function(){if(this.isList()){var e=editor.doc.getSelection(),t=e.getParaFormat(),i=t.ls_data.id,n=t.ls_data.l;return editor.doc.getListType(i,n)<=5}return!1},isCurrentLevelIsUnorderList:function(){if(this.isList()){var e=editor.doc.getSelection(),t=e.getParaFormat(),i=t.ls_data.id,n=t.ls_data.l;return editor.doc.getListType(i,n)>5}return!1},isUnOrderListSelection:function(){if(this.isCurrentLevelIsUnorderList()){var e=editor.doc.getSelection();return e.isListItemSelection}return!1},isCurrentLevelIsImageList:function(){if(this.isList()){var e=editor.doc.getSelection(),t=e.getParaFormat(),i=t.ls_data.id,n=t.ls_data.l;return 10==editor.doc.getListType(i,n)}return!1},isOrderList:function(){if(this.isList()){var e=editor.doc.getSelection(),t=e.getParaFormat(),i=t.ls_data.id,n=editor.doc.getBodyFormat().listFormat[i];if("number"==typeof n)return n<=5||11==n;for(var o in n)if(n[o].type>5)return!1;return!0}return!1},isHeadingList:function(){if(this.isList()){var e=editor.doc.getSelection(),t=e.getParaFormat(),i=t.ls_data.id;return this.isCurrentLevelIsOrderList()&&i==editor.doc.getHeadingListId()}return!1},isMultiLevelList:function(){if(this.isList())for(var e,t=editor.doc.getSelection(),i=t.getParaFormat(),n=i[ATTR_PARAGRAPH.LS_DATA],o=editor.doc.getListChar(n.id,n.l),r=0,a=0;e=ListLevelNo[a++];)if(o&&o.indexOf(e)>-1?r++:null,r>1)return!0;return!1},isHeading:function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH).attr(ATTR_PARAGRAPH.PS_HD);return!!(e&&e>=1&&e<=6)},isFirstListLevel:function(){if(this.isList()){var e=editor.doc.getSelection(),t=e.getParaFormat(),i=(t.ls_data.id,t.ls_data.l);return 0==i}return!1},isLastListLevel:function(){if(this.isList()){var e=editor.doc.getSelection(),t=e.getParaFormat(),i=(t.ls_data.id,t.ls_data.l);return 8==i}return!1},isCheckList:function(){var e=editor.doc.getSelection(),t=e.getParaFormat(),i=editor.getRole().permissions.can("document.edit");return i&&this.isList()&&CheckListOperations&&CheckListOperations.isCheckList(t)},isCheckedList:function(){if(this.isCheckList()){var e,t=editor.doc.getSelection(),i=t.getParaFormat(),n=function(t){e=t};return CheckListOperations.getCheckListState({format:i,callback:n}),e==CHECKLIST_STATES.CHECKED}},isPlainTextSelected:function(){return!this.isCursorCollapsed()&&!this.isImageSelected()&&!this.isCursorInsideTOC()},isUndoQueueEmpty:function(){var e=editor.getRole().permissions.can("document.edit");return e&&editor.doc.snapShotManager.isUndoQueueEmpty()},isRedoQueueEmpty:function(){var e=editor.getRole().permissions.can("document.edit");return e&&editor.doc.snapShotManager.isRedoQueueEmpty()},isLink:function(){var e=editor.doc.getSelection(),t=e.getTextFormat(),i=J(editor.doc.getCursorPortionNode(editor.uuid,"start"));return"link"==t.cls&&(!i.parents("#toc")[0]||1==t.lnktype)},isInLockRange:function(){var e=editor.doc.getSelection();if(e.isUnlockAllowed()){var t=Lock.getLock(e.getStart()+1);if(t||(t=Lock.getLock(e.getEnd()-1)),t){var i=t.getDocOps();if(!i[1].lock_data.data.redact)return!0}}return!1},isLockUnlockPermitted:function(){return!!Lock.isLockUnlockPermittedWithInSelection()&&(sel=editor.doc.getSelection(),!sel.isCollapsed()||sel.isUnlockAllowed())},isMask:function(){var e=editor.doc.getSelection();if(e.isUnlockAllowed()){var t=Lock.getLock(e.getStart()+1);if(t||(t=Lock.getLock(e.getEnd()-1)),t){var i=t.getDocOps();if(i[1].lock_data.data.redact)return!0}}return!1},isDropCapSelected:function(){for(var e=ShapeEditor.getSelectedShapes(),t=0;t<e.length;t++){var i=e[t].data;if(i.dropcapData)return!0}return!1},isWatermarkSelected:function(){for(var e=ShapeEditor.getSelectedShapes(),t=0;t<e.length;t++){var i=e[t].data;if(i.shapetype==Shapes.constant.WATERMARK)return!0}return!1},cursorInTC:function(){var e=editor.getRole().permissions.can("document.edit");if(e&&ModeManager.getCurrentMode()===EDITOR_MODES.COLLABORATE&&LayoutManager.getCurrentLayout()!=LAYOUTS.FULLSCREEN){var t=(editor.doc.docInfo,editor.doc.getSelection()),i=TcUtil.hasTCProperty(t.getStart()),n=editor.doc.getTrackChangeDetails().canReview();if(i&&n)return!0}return!1},isTcinSelection:function(){var e=editor.getRole().permissions.can("document.edit"),t=editor.doc.getSelection(),i=editor.doc.getTrackChangeDetails().canReview();return!!(e&&i&&TcManager.getCollection().isNodeInRange(t.getStart(),t.getEnd()-1))},isTrackChangeOn:function(){return editor.doc.getTrackChangeDetails().isEnabled()},isRowhaveCondition:function(){var e=!1,t=editor.doc.getSelection().getParents(NODE_TYPE.ROW);return t&&t.attr("condition")&&(e=!0),e},NonListParaSelected:function(){var e=editor.getRole().permissions.can("document.edit");return sel=editor.doc.getSelection(),cursorParaFmt=sel.getParaFormat(),!(!e||ListUtils.isList(cursorParaFmt)||CURSOR_CONTEXT_DEFINITIONS.isCursorCollapsed()||CURSOR_CONTEXT_DEFINITIONS.isTableSelected()||CURSOR_CONTEXT_DEFINITIONS.isLink())},HeadingListItemSelected:function(){return this.isListItemSelection()&&this.isHeadingList()},OrderListItemSelected:function(){return this.isListItemSelection()&&this.isCurrentLevelIsOrderList()},FirstListItemSelected:function(){return this.isListItemSelection()&&this.isFirstListLevel()},LastListItemSelected:function(){return this.isListItemSelection()&&this.isLastListLevel()},isRotatedShape:function(){if(this.isShape()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=t.attr("*").shapeData;if("CONNECTOR"!=i.type&&0!=i.props.transform.rotate)return!0}return!1},isConnectorShapeSelected:function(){if(this.isShape()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=t.attr("*").shapeData;if("CONNECTOR"==i.type)return!0}return!1},isGroupShapeSelected:function(){if(this.isShape()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=t.attr("*").shapeData;if("GROUPSHAPE"==i.type)return!0}return!1},isNonWriterImage:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=t.attr("src");return i&&i.indexOf("image.do?imgurl=")==-1}return!1},isDownloadableImage:function(){return this.isImage()&&this.isNonWriterImage()&&DomUtil.isDownloadSupported()&&editor.browserInfo.is_chrome},isImageWithoutLink:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=t.attr();if(!i.linkData)return!0}return!1},isLatexImage:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=t.attr();return i.hasOwnProperty("latexexp")}return!1},isSheetImage:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE);return t.attr("*").hasOwnProperty(ATTR_WIDGET.SHEET_INFO)}return!1},isTextBoxImage:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=t.attr();return i.subType==NODE_TYPE.TEXTBOX}return!1},isPageFloatingImage:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.IMAGE),i=t.attr();return"front"==i[ATTR_IMAGE.I_WRAP_TYPE]||"behind"==i[ATTR_IMAGE.I_WRAP_TYPE]}return!1},isHeader:function(){return!(!editor.clientActiveSection||editor.clientActiveSection.className.indexOf("header")==-1)},isFooter:function(){return!(!editor.clientActiveSection||editor.clientActiveSection.className.indexOf("footer")==-1)},isBody:function(){return!(!editor.clientActiveSection||editor.clientActiveSection.className.indexOf("zw-contentpane")==-1)},isSelectionAcrossSections:function(){return!DTContextUtils.isRangeInsideSingleSection()},isFormulaInSelection:function(){return FormulaHandler.isFormulaInSelection()},isTableSelected:function(){var e=editor.doc.getSelection();return e.isTableSelected()},isFormulaAtIndex:function(){var e=editor.doc,t=e.getSelection().getStart(),i=e.getRawFormatAt(t);return!(!i||"autoformula"!=i.ftype)},isMergeAllowed:function(){var e=editor.doc.getSelection(),t=e.isTableSelected();if(t){var i=(e.getSelectedRows(),e.getLastRange().getCells()),n=[],o=[],r=[],a=[];if(i.forEach(function(e){if("fc"===e.getMergeType())e.getMergeCells().forEach(function(e){if(!ZWArrayUtils.arrayContains(a,e.id)){r.push(e),a.push(e.id);var t=e.parent.getChildIndex(),i=e.getChildIndex();ZWArrayUtils.arrayContains(n,t)||n.push(t),ZWArrayUtils.arrayContains(o,i)||o.push(i)}});else if(!ZWArrayUtils.arrayContains(a,e.id)){r.push(e),a.push(e.id);var t=e.parent.getChildIndex(),i=e.getChildIndex();ZWArrayUtils.arrayContains(n,t)||n.push(t),ZWArrayUtils.arrayContains(o,i)||o.push(i)}}),r&&r[0]&&r[r.length-1]){for(var s=r[0].parent&&r[0].parent.parent,l=0;l<n.length;l++)if(s.children[n[l]].format.condition)return!1;return n.length*o.length===r.length}}return!1},isCollaboratorInsideTable:function(){if(this.isTable()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.CELL),i=t.parentNode().parentNode();return TableUtil.isCollabsInTable(i)}return!1},isPartialTableSelected:function(){var e=editor.doc.getSelection(),t=e.getLastRange();return t.isPartialTableSelected()},isCursorInMergedCell:function(){if(this.isTable()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.CELL);return t.attr("merge")&&"fc"==t.attr("merge")}return!1},isCursorInsideNonSplitableTable:function(){if(this.isTable()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.CELL),i=t.parentNode(),n=i.parentNode();return!SplitTable.canAllowSplitTable(n,i)}return!1},isCursorInsideNonTransposeTable:function(){if(this.isTable()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.CELL),i=t.parentNode(),n=i.parentNode();return!TransposeTable.canAllowTransposeTable(n)}return!1},isCursorInsideSplitableCell:function(){if(this.isTable()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.CELL),i=t.attr("cspan");return!i||i%2!=1||1==i}return!1},canEditLockRange:function(){return editor.doc.getSelection().canEditLockRange()},hasBookMark:function(){var e=ZWJSONUtils.getKeys(editor.bookmarks);return e.length>=1||0!=e.length&&void 0},isTableContainsMergedCell:function(){if(this.isTable()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE).dtNode;return DTTableUtils.isTableMerged(t)}},isTableContainsInnerTable:function(){if(this.isTable()){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE).dtNode;return DTTableUtils.isTableContainsInnerTable(t)}},canAnnotateImage:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=editor.doc.getRawFormatAt(e.getStart()),i=t[MAILMERGE.MMINFO]||t[ATTR_COMMON.FIELDINFO]||t.subType==ATTR_WIDGET.WIDGET||t.subType==ATTR_CHART.CHART||t.subType==NODE_TYPE.QRCODE||t.subType==NODE_TYPE.BARCODE||t[ATTR_IMAGE.I_LATEXEXP]||t[ATTR_IMAGE.I_SHAPEDATA]||!t.src||t.src.indexOf("http")!=-1;return!i}},canCropImage:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=editor.doc.getRawFormatAt(e.getStart()),i=t[MAILMERGE.MMINFO]||t[ATTR_COMMON.FIELDINFO]||t.subType==ATTR_WIDGET.WIDGET||t.subType==ATTR_CHART.CHART||t.subType==NODE_TYPE.QRCODE||t.subType==NODE_TYPE.BARCODE;return!i}},canChangeImageSrc:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=editor.doc.getRawFormatAt(e.getStart()),i=t[MAILMERGE.MMINFO]&&!t[ATTR_WIDGET.MAPDETAILS]||t.subType==NODE_TYPE.QRCODE||t.subType==NODE_TYPE.BARCODE;return i}},canChangeImage:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=editor.doc.getRawFormatAt(e.getStart()),i=t.subType==NODE_TYPE.QRCODE||t.subType==NODE_TYPE.BARCODE;return i}},canShowTableInsert:function(){return canEdit=editor.getRole().permissions.can("document.edit"),this.isCursorCollapsed()&&this.isTable()||canEdit&&this.isTableSelected()},isHeaderRowOnlySelected:function(){return TableUtil.isHeaderRowOnlySelected()},isHorizontalMergePresent:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);if(t&&t.dtNode)return t.dtNode.isHorizontalMergePresent()},isOnlyCodeParasSelected:function(){var e=editor.doc.getSelection(),t=editor.doc.getNodesInSelection(NODE_TYPE.PARAGRAPH,e.getStart(),e.getEnd());return ZWCode.isOnlyCodeParas(t)},isAutoFieldsPresentInSelection:function(){var e=!1,t=editor.doc.getSelection(),i=t.getStart(),n=editor.doc.findNextIndexOf(UNICODE.RANGE_END,i),o=editor.doc.getRawFormatAt(i),r=new RegExp(CONT_REGEXP.AUTOUPDATE_DOC_FIELDS);o&&"autofield"===o.type&&!Macros.isRemote()&&r.test(o.ftype)&&(t.isCollapsed()||n===t.getEnd()-1)&&(e=!0);var a=new RegExp(CONT_REGEXP.AUTOFIELD_USER_FIELD);return isUserField=o&&"autofield"===o.type&&!Macros.isRemote()&&a.test(o.ftype),isUserField&&o.zuid==editorProps.userInfo.zuid&&(t.isCollapsed()||n===t.getEnd()-1)&&(e=!0),e},isNamedRangeModificationAllowed:function(){var e=editor.doc.getSelection(),t=NamedRange.getEnclosedRanges(e.getStart(),e.getEnd());return t.length>0},isNamedRangePresent:function(){var e=editor.doc.getSelection(),t=NamedRange.getNamedRangesBetween(e.getStart(),e.getEnd());return t.length>0},isDocumentFieldSelected:function(){var e=!1,t=editor.doc.getSelection(),i=t.getStart(),n=editor.doc.findNextIndexOf(UNICODE.RANGE_END,i),o=editor.doc.getRawFormatAt(i),r=new RegExp(CONT_REGEXP.AUTOUPDATE_DOC_FIELDS);return o&&"autofield"===o.type&&!Macros.isRemote()&&r.test(o.ftype)&&(t.isCollapsed()||n===t.getEnd()-1)&&(e=!0),e},canConvertTextToTable:function(){return ConvertTextToTable.canConvert()},isImageHidden:function(){return DocLayoutManager.isImagePreviewEnabled()},isOnlyImage:function(){var e=editor.doc.getSelection(),t=editor.doc.getRawFormatAt(e.getStart());return DocUtils.isImage(t)},isTextBoxInContentSection:function(){var e=editor.doc.getSelection(),t=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,e.getStart());if(!t)return!0;var i=DocTreeManager.getRootSectionType(t.getRangeIndex()),n=!1;return i.indexOf("content")>-1&&(n=!0),n},isBarcode:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=editor.doc.getRawFormatAt(e.getStart());return t.subType==NODE_TYPE.BARCODE}return!1},isQRCode:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=editor.doc.getRawFormatAt(e.getStart());return t.subType==NODE_TYPE.QRCODE}return!1},isBarcodeMergeField:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=editor.doc.getRawFormatAt(e.getStart());return t.subType==NODE_TYPE.BARCODE&&!!t.mminfo}return!1},isQRCodeMergeField:function(){if(this.isImage()){var e=editor.doc.getSelection(),t=editor.doc.getRawFormatAt(e.getStart());return t.subType==NODE_TYPE.QRCODE&&!!t.mminfo}return!1},isNormalMergeField:function(){var e=editor.doc.getSelection(),t=e.getStart(),i=editor.doc.getRawFormatAt(t);return!(!i||i.ftype!=NODE_TYPE.MAILMERGEFIELD)},isImageMergeField:function(){var e=editor.doc.getSelection(),t=e.getStart(),i=editor.doc.getRawFormatAt(t);return!(!i||i.type!=NODE_TYPE.IMAGE||!i.mminfo||i.subType)},getCurrentFormat:function(){var e=editor.doc.getSelection(),t=e.getStart(),i=editor.doc.getRawFormatAt(t);return i},isTypeChart:function(){return format=this.getCurrentFormat(),!(!format||format.type!=NODE_TYPE.CHART)},isChartField:function(){return this.isTypeChart()&&this.getCurrentFormat().hasOwnProperty(MAILMERGE.MMINFO)},isEmbedMergeField:function(){var e=editor.doc.getSelection(),t=e.getStart(),i=editor.doc.getRawFormatAt(t);return!(!i||i.type!=NODE_TYPE.IMAGE||!i.mminfo||i.subType!=NODE_TYPE.WIDGET)},isParaRepeat:function(){var e=editor.doc.getSelection(),t=e.getStart();return MailMergeRepeatView.isRepeatPresentInPara(t)&&!!MailMergeRepeatUtil.getParaRangeInfo(t)},isRepeatTable:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);if(t){if(MailMergeRepeatUtil.isColumnRepeat(t.attr()))return!0;if(MailMergeRepeatUtil.isRowRepeatPresent(t.dtNode))return!0;if(MailMergeRepeatUtil.isCellRepeatPresent(t.dtNode))return!0}return!1},isRowRepeatTable:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);return t&&MailMergeRepeatUtil.isRowRepeatPresent(t.dtNode)},isRowRepeatCell:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.CELL);return MailMergeRepeatUtil.isRowRepeatCell(t)},isColumnRepeatTable:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);return t&&MailMergeRepeatUtil.isColumnRepeat(t.attr())},isColumnRepeatCell:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.CELL);return MailMergeRepeatUtil.isColumnRepeatCell(t)},isCellRepeatTable:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);return t&&MailMergeRepeatUtil.isCellRepeatPresent(t.dtNode)},isRepeatCellSelected:function(){for(var e=editor.doc.getSelection(),t=e.getSelectedCells()||[],i=0;i<t.length;i++)if(MailMergeRepeatUtil.isRepeatCell(t[i]))return!0;return!1},isRepeatFilterApplied:function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);if(t&&(MailMergeRepeatUtil.isColumnRepeat(t.attr())||MailMergeRepeatUtil.isRowRepeatPresent(t.dtNode)||MailMergeRepeatUtil.isCellRepeatPresent(t.dtNode))){var i=MailMergeFieldUIUtil.getRepeatRangeInfo(e.getStart());return i&&i.info&&i.info.hasOwnProperty(MAILMERGE.FILTER_DATA)}return!1},isParaRepeatFilterApplied:function(){var e=editor.doc.getSelection(),t=e.getStart();if(!MailMergeRepeatView.isRepeatPresentInPara(t))return!1;var i=MailMergeRepeatUtil.getParaRangeInfo(t);return i&&i.info&&i.info.hasOwnProperty(MAILMERGE.FILTER_DATA)},isApplyNumberFormatApplicable:function(){if(CURSOR_CONTEXT_DEFINITIONS.isFormulaAtIndex())return!0;var e,t,i,n=editor.doc,o=n.getSelection();if(o.isCollapsed()){var r=o.getWord();t=r.getStart(),i=r.getEnd()}else t=o.getStart(),i=o.getEnd();e=n.getContent(t,i);var a=e.match(REGEX.docUnicodes);if(a&&a.length>0)return!1;var s=Formula.localeParseFloat(e);return!isNaN(s)},isWidget:function(){var e=editor.doc.getSelection(),t=e.getStart(),i=editor.doc.getRawFormatAt(t);return!(!i||!i.subType||i.subType!=NODE_TYPE.WIDGET)&&(i.widgetSrc&&void 0!=i.widgetSrc&&!i[MAILMERGE.MMINFO])},isChartFromSheet:function(){var e=editor.doc.getSelection(),t=e.getStart(),i=editor.doc.getRawFormatAt(t);return!!(i&&i.subType&&i.subType==NODE_TYPE.CHART&&i.hasOwnProperty(ATTR_CHART.SHEET_ID))},isFillablePreview:function(){return editor.getView()==EDITOR_VIEWS.FILLABLEFIELDS_PREVIEW}},ContextMenu=function(){"use strict";var e=["redo_list","undo_list","rht_click_copy_list","rht_click_cut_list","rht_click_paste_smart","rht_click_copy_smart","rht_click_cut_smart","redo_smart","undo_smart","delete","sep_delete","rht_click_delete_smart"],t=function(e,t){PasteUtil.setContextItemClicked(e.originalEvent.target)},i=function(e,t){return"paste-option-split-button"==PasteUtil.getContextItemClicked()?(PasteUtil.clearContextItemClicked(),e.stopPropagation(),!1):void PasteUtil.clearContextItemClicked()},n=function(t,i){for(var n=J("#Rmenu"),o=n.find("[zui-id]"),r=JSON.parse(n.attr("callback").replace(/'/g,'"')),a=0,s=r.before,l=s.length-1;l>=0;l--)Utils.getAsFunction(s[l]).fn(t,i);PubSub.publish("Document/RightClickMenuOpened");var d=editor.getRole().permissions.can("document.edit");J("#rht_click_clipboardOperations,#rclk-clipboardSmartOperations").hide();for(var c=n.find(".uiframework-hide"),u=[],p=c.length-1;p>-1;p--)u.push(c[p].getAttribute("id"));var g=U.union(u,e);o.length-g.length-a>=8&&d?J("#rclk-clipboardSmartOperations").show():J("#rht_click_clipboardOperations").show();for(var s=r.after,l=s.length-1;l>=0;l--)Utils.getAsFunction(s[l]).fn();var f,E,T;f=TableUtil.getRowsToBeDeleted().length,E=TableUtil.getColumnsToBeDeleted().length,f=f>1?" "+f:"",E=E>1?" "+E:"",T=J("#Rmenu"),T.zmenu("setMenuItemsAttribute",J("#delRow"),"label",J.i18n("writer.table.DELETE_CUSTOM_ROW",[f])),T.zmenu("setMenuItemsAttribute",J("#delColumn"),"label",J.i18n("writer.table.DELETE_CUSTOM_COLUMN",[E]))};return{handleContext:n,handleBeforeClose:i,itemClick:t}}(),ActionJSON=function(){"use strict";var e={Bold:{module:"Formatting","data-fn":["document.edit"],disable:["!permission.document.edit"]},openDocs:{module:"FileMenu","data-fn":["document.edit"],disable:["state.offline"],action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"}},NavigateChange:{module:"Tc",track_activity:!0},ViewChange:{module:"Tc",track_activity:!0},ToggleTc:{module:"Tc",disable:["state.tcviews.original","!permission.document.edit","state.offline"],track_activity:!0,activity_data:{on:"Enable",off:"Disable"}},ToggleTcToAll:{module:"Tc",disable:["state.tcviews.original","!permission.document.edit","state.offline"],track_activity:!0,activity_data:{on:"EnableToAll",off:"DisableToAll"}},AcceptAll:{module:"Tc","data-fn":["document.edit"],track_activity:!0},RejectAll:{module:"Tc","data-fn":["document.edit"],track_activity:!0},AcceptSelectedChanges:{module:"Tc",hide:["RCT_Context.isCursorCollapsed","!permission.document.edit"],show:["RCT_Context.isTcinSelection"],track_activity:!0},RejectSelectedChanges:{module:"Tc",hide:["RCT_Context.isCursorCollapsed","!permission.document.edit"],show:["RCT_Context.isTcinSelection"],track_activity:!0},Accept:{module:"Tc",track_activity:!0},Reject:{module:"Tc",track_activity:!0},AllMarkupView:{module:"Tc",track_activity:!0},NoMarkupView:{module:"Tc",track_activity:!0},OriginalMarkupView:{module:"Tc",track_activity:!0},FilterByView:{module:"Tc",track_activity:!0},FilterByUser:{module:"Tc",track_activity:!0},ChangeColor:{module:"Tc",track_activity:!0},ChangeDefaultColor:{module:"Tc",track_activity:!0},AddComment:{module:"Comment",track_activity:!0},AddReply:{module:"Comment",track_activity:!0},EditComment:{module:"Comment",track_activity:!0,disable:["state.offline"]},EditReply:{module:"Comment",track_activity:!0},LikeComment:{module:"Comment",track_activity:!0},FollowComment:{module:"Comment",track_activity:!0,disable:["state.offline"]},Resolve:{module:"Comment",track_activity:!0},Reopen:{module:"Comment",track_activity:!0},DeleteComment:{module:"Comment",track_activity:!0},DeleteReply:{module:"Comment",track_activity:!0},ResolveAll:{module:"Comment",track_activity:!0,disable:["state.offline"],"data-fn":["review.comment.resolve"]},DeleteAll:{module:"Comment",track_activity:!0,disable:["state.offline"],"data-fn":["review.comment.deleteall"]},ShowReplies:{module:"Comment",track_activity:!0},HideReplies:{module:"Comment",track_activity:!0},VisibleToAll:{module:"Comment",track_activity:!0},SetAsPrivate:{module:"Comment",track_activity:!0},VisibleToSomeGroups:{module:"Comment",track_activity:!0},VisibleToDocOwner:{module:"Comment",track_activity:!0},VisibleToSomeRoles:{module:"Comment",track_activity:!0},VisibleToOrgUsers:{module:"Comment",track_activity:!0},GetCommentLink:{module:"Comment",track_activity:!0},SearchTextInComments:{module:"Comment",track_activity:!0},ViewFailed:{module:"Comment",track_activity:!0},PrintComments:{module:"Comment",track_activity:!0},ReviewComment:{module:"Comment",track_activity:!0},NavigateComment:{module:"Comment",track_activity:!0},Publish:{module:"Integration",disable:["state.offline","state.tcviews.original","state.checkedout","state.newDoc","state.freeze"],enable:["!state.offline"],hide:["SignTemplate"],action:{permission:"!state.canPublish",action:"UIUtils.hanldeActionChange",class:"ui-lock-icon-css"},track_activity:!0},Share:{module:"Share",show:["permission.document.share"],disable:["state.offline","state.tcviews.original","state.checkedout","state.newDoc","state.freeze"],track_activity:!0},PostToBlog:{module:"PostToBlog",hide:["FillableForm","SignTemplate","Bundle.zillum"],disable:["state.newDoc","state.offline","state.freeze","state.tcviews.original"],track_activity:!0},DocumentOpen:{module:"FileMenu",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},disable:["state.offline","state.tcviews.original","state.freeze"],track_activity:!0},Equation:{module:"Insert",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},disable:["state.offline","Section.endnote","Section.footnote","!permission.document.edit","context.canEditLockRange"],track_activity:!0},FontDefault:{module:"Format",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},disable:["state.offline","!permission.document.edit"],track_activity:!0},RemoteEditorSignUp:{module:"Remote",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},track_activity:!0},Automation:{module:"Automation",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},disable:["state.offline","state.newDoc"],track_activity:!0},PersonalDictionary:{module:"Tools",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},disable:["state.offline","!permission.document.edit","!module.proofing.loaded"],track_activity:!0},Feedback:{module:"Feedback",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},hide:["state.offline"],track_activity:!0},TopbandSearch:{module:"Topband",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},hide:["state.offline","state.tcviews.original"],diable:["state.finaldocument"],track_activity:!0},Zia:{module:"Zia",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},disable:["!module.proofing.loaded","state.offline","state.tcviews.original","!permission.document.edit"],track_activity:!0},MarkAsFinal:{module:"MarkAsFinal",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},disable:["state.offline","state.newDoc","state.freeze","state.tcviews.original","state.workflowAssigned"],hide:["state.finaldocument"],show:["permission.document.markfinal"],track_activity:!0},PrepareTemplate:{module:"Automation",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},hide:["FillableForm","SignTemplate"],track_activity:!0},SignPrepareTemplate:{module:"Automation",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},hide:["FillableForm"],track_activity:!0},PrepareMergeTemplate:{module:"Automation",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},hide:["FillableForm","SignTemplate"],track_activity:!0},PrepareSignTemplate:{module:"Automation",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},hide:["FillableForm"],track_activity:!0},FillablePrepareTemplate:{module:"Automation",action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},hide:["SignTemplate"],track_activity:!0},FinalStateBorder:{module:"MarkAsFinal",show:["state.finaldocument"],track_activity:!0},Export:{module:"Export",disable:["state.offline","state.newDoc","state.freeze","state.tcviews.original"],track_activity:!0},Email:{module:"Export","data-fn":["document.download"],disable:["state.offline","state.newDoc","state.freeze","state.tcviews.original"],track_activity:!0},RevertFinal:{module:"MarkAsFinal",show:["state.finaldocument"],hide:["!markasfinal.enableediting"],track_activity:!0},PrintChromeFF:{module:"Print","data-fn":["document.print"],show:["Browser.chrome","Browser.firefox"],disable:["state.newDoc","state.freeze","state.tcviews.original"],track_activity:!0},Print:{module:"Print","data-fn":["document.print"],hide:["Browser.chrome","Browser.firefox"],disable:["state.newDoc","state.freeze","state.tcviews.original"],track_activity:!0},MarkAsFinalEdit:{module:"MarkAsFinal",show:["state.finaldocument"],track_activity:!0},DocumentDownload:{module:"Export",hide:["PDFFiller"],track_activity:!0,"data-fn":["document.download"],track_activity:!0},FillableDownload:{module:"Export",show:["FillableForm"],"data-fn":["document.download"],track_activity:!0},OfflineDisable:{module:"Offline",disable:["state.offline"]},AnnoucementVisited:{module:"UserProfile",hide:["state.featureVisited"]},MacApp:{module:"UserProfile",hide:["!Browser.mac"]},ExtensionInUserProfile:{module:"UserProfile",hide:["Browser.opera"]},ChromeExtensionInUserProfile:{module:"UserProfile",hide:["!Browser.chrome"]},FFExtensionInUserProfile:{module:"UserProfile",hide:["!Browser.firefox"]},SafariExtensionInUserProfile:{module:"UserProfile",hide:["!Browser.safari"]},EdgeExtensionInUserProfile:{module:"UserProfile",hide:["!Browser.edge"]},EmailInFileMenu:{module:"FileMenu","data-fn":["document.download"],show:["!permission.document.share"],disable:["state.offline","state.freeze"],track_activity:!0},DocumentCopy:{module:"Integration",disable:["state.offline","state.tcviews.original","state.checkedout","state.newDoc"],track_activity:!0},SaveTemplate:{module:"Integration",disable:["state.offline","state.tcviews.original","state.newDoc"],hide:["PDFForm"],track_activity:!0},AddToCloud:{module:"Integration",disable:["state.offline","state.tcviews.original","state.newDoc","Bundle.zillum"],hide:["Browser.ie"],track_activity:!0},Delete:{module:"Integration",hide:["!permission.document.deleteforever","!document.state.draft"],disable:["state.offline","state.freeze"],track_activity:!0},Trash:{module:"Integration",hide:["!permission.document.trash","document.state.draft"],disable:["state.offline","state.freeze"],track_activity:!0},Insights:{module:"Tools",disable:["state.offline","!permission.document.edit","state.isNotShared"],action:{permission:"state.tryEditor",action:"UIUtils.openSignupDialog",class:"ui-lock-icon-css"},track_activity:!0},AssignWorkflow:{module:"Workflow",track_activity:!0},PerformTransition:{module:"Workflow",track_activity:!0},ViewWorkflowDropDown:{module:"Workflow",disable:["state.finaldocument"],track_activity:!0},ViewWorkflowDetailedHistory:{module:"Workflow",track_activity:!0},RemoveWorkflow:{module:"Workflow",track_activity:!0},OpenWorkflowAssignDialog:{module:"Workflow",track_activity:!0},OpenHistoryPage:{module:"Workflow",track_activity:!0},ViewPastWorkflows:{module:"Workflow",track_activity:!0},ViewBlueprint:{module:"Workflow",track_activity:!0},ReviewWorkflow:{module:"Workflow",track_activity:!0},ApprovalWorkflow:{module:"Workflow",track_activity:!0},EditorialReviewWorkflow:{module:"Workflow",track_activity:!0},ReviewApprovalWorkflow:{module:"Workflow",track_activity:!0},WorkflowManualStart:{module:"Workflow",track_activity:!0},WorkflowStartOnEvent:{module:"Workflow",track_activity:!0},CustomFunctionAtEndOfWorkflow:{module:"Workflow",track_activity:!0}},t=function(t){return ZWJSONUtils.clone(e[t])};return{getActionInfo:t}}(),UIFWUtil=function(){"use strict";var e={},t=["panel-container","bottombar","topband-wrapper","popup-menu-container","review-tb","review_Rightpane","Rmenu","zalertbanner_*"],i={},n=new RegExp("[0-9]+","g"),o=function(e,t){var i=J(e).zpopover("getAttribute","forElement");return i&&i[0]?a(i[0],t):null},r=function(e){return e?(n.lastIndex=0,e.replace(n,"*")):null},a=function(e,t){var i=e.parentNode,n=r(i.getAttribute("id")),a=i.getAttribute("ctype");do{if(HTMLUtil.nodeNameEquals(i,"body"))return null;if(n&&t.indexOf(n)!=-1)return n;if(a&&"zpopover"===a)return o(i,t);i=i.parentNode,n=r(i.getAttribute("id")),a=i.getAttribute("ctype")}while(i)},s=function(n){var o=n[0],r=n[1],s=n[2],l=n[3]||o.getAttribute("zui-id");!e.hasOwnProperty(l)&&i.hasOwnProperty(l)?e[l]=a(i[l],t):e.hasOwnProperty(l)||(e[l]=a(o,t)),PubSub.publish("UIFrameWork/ActionDetails",{eleInfo:o,parentId:e[l],action:r,actionInfo:s})},l=function(e){try{s(e)}catch(e){ZWLogger.log("Error while fetching element parent: "+(e.stack||e))}},d=function(e){try{var t=(e.ev,e.ui),n=e.menuitem[0],o=t.target[0],r=n.getAttribute("data-zw-action"),a=ActionJSON.getActionInfo(r);if(o&&o.hasAttribute("zui-id")){var l=o.getAttribute("zui-id");i[l]=o,s([n,r,a,l])}}catch(e){ZWLogger.log("Error while fetching Menu parent: "+(e.stack||e))}},c=function(e){try{var t=(e.ev,e.selectitem[0]),i=t.getAttribute("data-zw-action"),n=ActionJSON.getActionInfo(i);t&&t.hasAttribute("zui-id")&&s([t,i,n,t.getAttribute("zui-id")])}catch(e){ZWLogger.log("Error while fetching select option parent: "+(e.stack||e))}};return PubSub.subscribe("UIFrameWork/SelectOptionClick",c),PubSub.subscribe("UIFrameWork/ReportCapture",l),PubSub.subscribe("UIFrameWork/MenuItemClick",d),{getParentDetails:s}}();var FillableFieldsPanel=function(e,t,i,n,o,r,a,s){"use strict";var l=e.can("document.edit"),d=e.can("document.fill"),c=editorProps.userInfo&&editorProps.userInfo.role;if(l&&(d||"REMOTEEDIT"===c)){var u,p,g,f,E,T,m,h,I,_,A,S,R,O,b,v,D,L,N,P,C,y,F,M,w,U,x,B,H,G,k,Y,z,V,j,X,K,q,Q,$,ee,te,F,ie,ne,oe,re,ae,se,le,de=!1,ce=!1,ue=!1,pe={SLCT_CHOICE:".select-choice",SLCT_OPTION:".select-option",FIELD_SELECTED:"ffield-selected"},ge={DATE_VALUE:"dateValue",SIGN_VALUE:"signValue",IMAGE_VALUE:"imageValue",IMAGE_WRAP:"IMG_WRAP",IMAGE_FIT:"IMG_FIT",IMAGE_HEIGHT:"IMG_HEIGHT",IMAGE_WIDTH:"IMG_WIDTH",MARGIN_TYPE:"IMAGE_MARGIN_TYPE",MARGIN_TOP:"marginTop",MARGIN_BOTTOM:"marginBottom",MARGIN_LEFT:"marginLeft",MARGIN_RIGHT:"marginRight",ROTATE_CW:"IMAGE_ROTATE_CW",ROTATE_ACW:"IMAGE_ROTATE_ACW"},fe={left:J.i18n("writer.common.LEFT"),front:J.i18n("writer.image.INFRONT_OF_TEXT"),right:J.i18n("writer.common.RIGHT"),bottom:J.i18n("writer.image.INLINE"),behind:J.i18n("writer.image.BEHIND_TEXT"),square:J.i18n("writer.image.SQUARE")},Ee={ENTER_LABEL:J.i18n("writer.common.ENTER_LABEL"),DROPDOWN_EMPTY:J.i18n("writer.fillablefields.DROPDOWN_EMPTY_ERROR"),LOADING:J.i18n("writer.common.LOADING"),SELECT_REMOVE_ERROR:J.i18n("writer.common.SELECT_OPTION_DELETE_MSG"),LINK_FIELDS_HINT:J.i18n("writer.common.LINK_FIELDS_HINT"),INS_IMG_ERROR:J.i18n("writer.common.UNABLE_TO_INSERT_IMAGE"),MULTIPLE_CHOICE_SAME_OPTION_ERROR:J.i18n("writer.fillablefields.MULTIPLE_CHOICE_ERROR_MSG")},Te={NUMBER_NONE:" ",NUMBER:"0",NUMBER_WITH_DECIMAL:"0.00",NUMBER_WITH_THOUSAND:"#,##0",NUMBER_WITH_DECIMAL_AND_THOUSAND:"#,##0.00",PERCENT:"0%",PERCENT_WITH_DECIMAL:"0.00%"},me=function(e,t){var i=Numeral.getThousandAndDecimalSeperator(e),n=Te[t].split(".");return n[0].replaceAll(",",i.thousands)+(n[1]?i.decimal+n[1]:"")},he=function(e,t){var i=Numeral.getThousandAndDecimalSeperator(e),n=t.split(i.decimal);return n[0].replaceAll("["+i.thousands+"]",",")+(n[1]?"."+n[1]:"")},Ie=function(e,t){var i=Numeral.getThousandAndDecimalSeperator(e),n=t.split(i.decimal);return n[0].replaceAll("["+i.thousands+"]",",")+(n[1]?"."+n[1]:"")},_e=new RegExp("["+FILLABLEFIELD_TYPE.SELECTBOX+"|"+FILLABLEFIELD_TYPE.CHECKBOX+"|"+FILLABLEFIELD_TYPE.DATE+"|"+FILLABLEFIELD_TYPE.IMAGE+"|"+FILLABLEFIELD_TYPE.SIGNATURE+"|"+FILLABLEFIELD_TYPE.INITIAL+"]"),Ae=function(e){a.addToStatistics(e)},Se=function(e){var t,i,n=u.getFillableFieldType();switch(e){case ATTR_FILLABLEFIELD.FF_NAME:case ATTR_FILLABLEFIELD.FF_HELP_TEXT:case ATTR_FILLABLEFIELD.FF_DISABLED:return u.isFillableImageField()?u.style._.op[ATTR_FILLABLEFIELD.FF_INFO][e]||"":u[e];case ATTR_FILLABLEFIELD.FF_MAX_LENGTH:return _e.test(n)||h.attr("maxlength",t=u.getMaxLength()),t;case ATTR_FILLABLEFIELD.FF_VALUE:return ue?xt():u.getFillableFieldResult().trim();case ge.DATE_VALUE:return Utils.getFillableFieldResult(u.rawFormat);case ge.IMAGE_VALUE:return u.getValue();case ATTR_FILLABLEFIELD.FF_FORMAT:return n===FILLABLEFIELD_TYPE.DATE&&u.getFormat().replaceAll("Y","y").replaceAll("D","d");case"number_format":if(n!==FILLABLEFIELD_TYPE.NUMBER&&n!==FILLABLEFIELD_TYPE.PERCENT)return;var o=u.getNumberFormat(),r=he(u.getLocale(),o),a=n==FILLABLEFIELD_TYPE.NUMBER?"NUMBER":"PERCENT";for(var s in Te)Te[s]==r&&(a=s);return a;case ATTR_FILLABLEFIELD.FF_CURRENCY_CODE:return n===FILLABLEFIELD_TYPE.CURRENCY&&u.getCurrencyCode();case ATTR_FILLABLEFIELD.FF_DECIMAL_PLACES:return n===FILLABLEFIELD_TYPE.CURRENCY&&u.getDecimalPlaces();case ATTR_FILLABLEFIELD.FF_USE_CURRENCY_SYMBOL:if(n!==FILLABLEFIELD_TYPE.CURRENCY)return null;i=u.getCurrencyCode();var l=u._.op.ffInfo.locale,d=J("#symbol-select"),c=DocLocaleHandler.getLanguageDetails(l),g=Numeral.getFormattedNumberAndCurrencySymbol(l,i);return d.zlabeledselectbox("setOptionAttributes","#symbol",{label:g.symbol,value:g.symbol}),d.zlabeledselectbox("setOptionAttributes","#char",{label:c.currencyCode,value:c.currencyCode}),u.isCurrencySymbolAsCode()?c.symbol||g.symbol:i||c.currencyCode;case ATTR_FILLABLEFIELD.FF_MANDATORY:return u.isMandatory();case ATTR_FILLABLEFIELD.FF_CHECKED:return n===FILLABLEFIELD_TYPE.CHECKBOX&&u.isChecked();case ATTR_FILLABLEFIELD.FF_SELECTED_INDEX:if(n!==FILLABLEFIELD_TYPE.SELECTBOX)return null;var f=Ce(null,"get");return f.querySelector(pe.SLCT_CHOICE).value;case"locale":return n===FILLABLEFIELD_TYPE.CURRENCY&&(u.getLocale()||Utils.getLocaleOfCurrencyCode(u.getCurrencyCode()));case ge.IMAGE_WIDTH:return(u.isFillableImageField()||n==FILLABLEFIELD_TYPE.MULTILINE)&&u.getSize().wid;case ge.IMAGE_HEIGHT:return(u.isFillableImageField()||n==FILLABLEFIELD_TYPE.MULTILINE)&&u.getSize().ht;case ge.MARGIN_TOP:case ge.MARGIN_BOTTOM:case ge.MARGIN_LEFT:case ge.MARGIN_RIGHT:return p&&parseFloat(Conversions.toGlobalValue(p.style[e]||"0"+Conversions.globalUnit));case ge.MARGIN_TYPE:if(!p)return;return p.style.marginTop||p.style.marginBottom||p.style.marginLeft||p.style.marginRight?p.style.marginTop==p.style.marginBottom&&p.style.marginBottom==p.style.marginLeft&&p.style.marginLeft==p.style.marginRight?parseFloat(Conversions.toGlobalValue(p.style.marginRight)):"custom":0;case ge.IMAGE_WRAP:if(!p)return;return"square"==p.style[ATTR_IMAGE.I_WRAP_TYPE]&&"align"==p.style.positionH[ATTR_IMAGE.I_POSITION_TYPE]?(Z("ff-img-wrap-type").text(fe[p.style.positionH[ATTR_IMAGE.I_ALIGN_VAL]]||""),p.style.positionH[ATTR_IMAGE.I_ALIGN_VAL]):p.style[ATTR_IMAGE.I_WRAP_TYPE]?(Z("ff-img-wrap-type").text(fe[p.style[ATTR_IMAGE.I_WRAP_TYPE]]),p.style[ATTR_IMAGE.I_WRAP_TYPE]):(Z("ff-img-wrap-type").text(fe.bottom),"inline");case ge.IMAGE_FIT:return u.isFillableImageField()&&u.getFitType()||IMAGE_FIT_TYPE.FIXED}},Re=function(e,t,o){var r=u.getFillableFieldType(),s=editor.doc.getTrackChangeDetails();if(r!==FILLABLEFIELD_TYPE.SINGLELINE||!o||e!==ATTR_FILLABLEFIELD.FF_VALUE){switch(r!==FILLABLEFIELD_TYPE.MULTILINE&&r!==FILLABLEFIELD_TYPE.RADIO&&r!==FILLABLEFIELD_TYPE.MULTIPLECHOICE||s.setProcessingTC(!1),e){case ATTR_FILLABLEFIELD.FF_NAME:if(FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME].test(t)&&(t=t.replaceAll(FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME],"")),Ee.LINK_FIELDS_HINT==t)return;if(""==t&&ce)return void G.find("#ff-name-fieldContainer").find(".zselectbox__textbox").val(u.getName());Ne(t),Ae("Label Used");case ATTR_FILLABLEFIELD.FF_HELP_TEXT:FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME].test(t)&&(t=t.replaceAll(FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME],""));case ATTR_FILLABLEFIELD.FF_DISABLED:if(t===u.getName())return;if(ce){Lt(u,e,t);break}u[e]=t,ATTR_FILLABLEFIELD.FF_DISABLED==e&&!!t&&u.setMandatory(!1);break;case ATTR_FILLABLEFIELD.FF_MAX_LENGTH:if(r===FILLABLEFIELD_TYPE.CHECKBOX||r===FILLABLEFIELD_TYPE.SELECTBOX||r===FILLABLEFIELD_TYPE.DATE||t===u.getMaxLength())return;t>1e4&&(t=1e4),r===FILLABLEFIELD_TYPE.SINGLELINE?Y.attr("maxlength",t):h.attr("maxlength",t),u.setMaxLength(t),u.getValue().length>t&&u.setValue(u.getValue().substr(0,t));break;case ATTR_FILLABLEFIELD.FF_VALUE:if("string"==typeof t&&(t=t.trim()),""===t&&(t=" "),ue){if(!Bt(t))return}else if(!be(t))return;break;case ge.DATE_VALUE:if("string"==typeof t&&(t=t.trim()),""===t&&(t=" "),t==u.getFormat().toLowerCase()){if(" "==u.getValue())return;t=" "}if(ue){if(!Bt(t))return}else if(!be(t))return;break;case ge.IMAGE_VALUE:if(!be(t))return;break;case ge.SIGN_VALUE:if(!be(t))return;setTimeout(function(){var e=WRITER_BASE_URL+"/"+t.imageSrc;J("#ff-sign-preview")[0].innerHTML="",J("#ff-sign-preview").find("#ff-sprev").remove("#ff-sprev")&&J("#ff-sign-preview")[0].appendChild(esignpanel.createImageSpan(r,"","ff-sprev",e))},600);break;case ATTR_FILLABLEFIELD.FF_FORMAT:if(t.currentTarget&&(t=M.zlabeledselectbox("getValue")),r!==FILLABLEFIELD_TYPE.DATE||t===u.getFormat())return;u.setFormat(t);break;case"number_format":var l;if(l="NUMBER_NONE"==t?" ":me(u.getLocale(),t),r!==FILLABLEFIELD_TYPE.NUMBER&&r!==FILLABLEFIELD_TYPE.PERCENT||l===u.getNumberFormat())return;u.setNumberFormat(l);break;case ATTR_FILLABLEFIELD.FF_CURRENCY_CODE:if(r!==FILLABLEFIELD_TYPE.CURRENCY||t===u.getCurrencyCode())return;u.setCurrencyCode(t);break;case ATTR_FILLABLEFIELD.FF_DECIMAL_PLACES:if(r!==FILLABLEFIELD_TYPE.CURRENCY||t===u.getDecimalPlaces())return;u.setDecimalPlaces(t);break;case ATTR_FILLABLEFIELD.FF_USE_CURRENCY_SYMBOL:if(r!==FILLABLEFIELD_TYPE.CURRENCY)return;var d=u._.op.ffInfo.locale,c=u._.op.ffInfo.currencyISOCode,g=DocLocaleHandler.getLanguageDetails(d),f=(Numeral.getFormattedNumberAndCurrencySymbol(d,c),!1);g.currencyCode!=t&&(f=!0),f!==u.isCurrencySymbolAsCode()&&u.setCurrencySymbolAsCode(f);break;case ATTR_FILLABLEFIELD.FF_MANDATORY:if(r==FILLABLEFIELD_TYPE.CHECKBOX||u.isMandatory()==t)return;ce?Lt(u,e,t):u.setMandatory(!!t),!!t&&(u[ATTR_FILLABLEFIELD.FF_DISABLED]=!1);break;case ATTR_FILLABLEFIELD.FF_CHECKED:if(r!==FILLABLEFIELD_TYPE.CHECKBOX||!!t===u.isChecked())return;De(!!t);break;case"dynamiclist":if(ue&&!Gt(t))return;break;case ATTR_FILLABLEFIELD.FF_LIST:if("object"==typeof t){t=Pe(t),Le(t,e);break}if(ue){if(!Gt(t))return;break}for(var E=R[0].querySelectorAll(pe.SLCT_CHOICE),T=E.length,m=[],I=0;I<T;I++)if(E[I].value){if(m[I]=E[I].value,FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME].test(m[I]))return void j.show();j.hide()}if(ZWJSONUtils.compareJSON(m,u.getList()))return;if(m=Pe(m),!m.length||m.contains(""))return void i.showMessage("error",Ee.DROPDOWN_EMPTY,"showclose","normalfont",3e3);Le(m,e);break;case ATTR_FILLABLEFIELD.FF_SELECTED_INDEX:var _=t;if(_===u.getSelectedIndex()||_>=u.getList().length)return;Le(_,e);break;case"locale":if(u.getLocale()==t)return;return u.setLocale(t),void Re(ATTR_FILLABLEFIELD.FF_CURRENCY_CODE,Utils.getCurrencyCodeOfLocale(t));case ge.IMAGE_HEIGHT:var A=u.getSize();if(A.ht=t,p&&J("#ff-image-keepaspect").zbutton("getAttribute","checked")){var S=p.style.originalHeight||p.style.height,O=p.style.originalWidth||p.style.width;A.wid=t*(O/S)}(u.isFillableImageField()||r==FILLABLEFIELD_TYPE.MULTILINE)&&u.setFormats(A);break;case ge.IMAGE_WIDTH:var A=u.getSize();if(A.wid=t,p&&J("#ff-image-keepaspect").zbutton("getAttribute","checked")){var S=p.style.originalHeight||p.style.height,O=p.style.originalWidth||p.style.width;A.ht=t*(S/O)}(u.isFillableImageField()||r==FILLABLEFIELD_TYPE.MULTILINE)&&u.setFormats(A);break;case ge.IMAGE_WRAP:if(!p||t==p.style.wrapType)return;p.style[ATTR_IMAGE.I_WRAP_TYPE]=t,Z("ff-img-wrap-type").text(fe[t]||"");var b=p.start,v=ZWJSONUtils.clone(p.rawFormat);if(""!=t&&"inline"!=t){v[ATTR_IMAGE.I_WRAP_TYPE]=t;var D=ImagePanel.getDefaultImagePostionJson(v);v[ATTR_IMAGE.I_H_POSITION]=D[ATTR_IMAGE.I_H_POSITION],v[ATTR_IMAGE.I_V_POSITION]=D[ATTR_IMAGE.I_V_POSITION],"left"==t||"right"==t?(v[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="align",v[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_ALIGN_VAL]=t,v[ATTR_IMAGE.I_WRAP_TYPE]="square"):(v[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",v[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_FROM]="column");var L=Conversions.isInInches?"0.125in":"3mm";ViewManager.isPageFloatImage(v)&&(L=""),v.ml=v.mr=v.mt=v.mb=L;var N=J(".imgsvgrect").offset();ImageActions.moveFloatingImage(N,b,v),J("#ff-img-lpnl-marginlist").zlabeledselectbox("setAttribute","disabled",!1)}else p.style[ATTR_IMAGE.I_WRAP_TYPE]="",p.style[ATTR_IMAGE.I_H_POSITION]="",p.style[ATTR_IMAGE.I_V_POSITION]="",J("#ff-img-lpnl-marginlist").zlabeledselectbox("setAttribute","disabled",!0);break;case ge.IMAGE_FIT:if(t==u.getFitType())return;u.setFitType(t),nt(t);break;case ge.MARGIN_TYPE:if("custom"==t)return void Z("ff-img-custom-margin").show();var P=Conversions.toGlobalUnit(parseFloat(t)+"in");if(P="mm"==Conversions.globalUnit?parseInt(P):P,P+=Conversions.globalUnit,p.style.marginTop==p.style.marginBottom&&p.style.marginBottom==p.style.marginLeft&&p.style.marginLeft==p.style.marginRight&&p.style.marginRight==P)return;p.style.marginTop=p.style.marginBottom=p.style.marginLeft=p.style.marginRight=P;break;case ge.MARGIN_TOP:case ge.MARGIN_BOTTOM:case ge.MARGIN_LEFT:case ge.MARGIN_RIGHT:if(t==parseFloat(Conversions.toGlobalValue(p.style[e])))return;p.style[e]=t+Conversions.globalUnit;break;case ge.ROTATE_ACW:case ge.ROTATE_CW:if(t=(p.style.rotation||0)+(ge.ROTATE_CW==e?90:-90),t>=360?t%=360:t<0&&(t=270),e=ATTR_IMAGE.I_ROTATE,t==p.style[e])return;Z("ff-img-pnl-rot-deg").html(t),p.style[e]=t;break;case ATTR_FILLABLEFIELD.FF_OPTIONS:if(ue){if(!Jt(e,t))return;break}for(var C,E=ne[0].querySelectorAll(pe.SLCT_CHOICE),y=!1,T=E.length,m=[],F=Dt(u.getName()).options,I=0;I<T;I++)if(E[I].value){if(E[I].classList.remove("ui-validation-error"),m[I]=E[I].value,J(E[I]).data("val")!==J(E[I]).val()){if(F.contains(t))return E[I].classList.add("ui-validation-error"),oe[0].innerText=Ee.MULTIPLE_CHOICE_SAME_OPTION_ERROR,void oe.show();y=!0,C=J(E[I]).data("val"),J(E[I]).data("val",t),F.length!==T&&vt(t)}if(FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME].test(m[I]))return oe[0].innerText=Ee.MULTIPLE_CHOICE_SAME_OPTION_ERROR,void oe.show();yt()}if(m=Pe(m),!m.length||m.contains(""))return void i.showMessage("error",Ee.DROPDOWN_EMPTY,"showclose","normalfont",3e3);if(y){if(F.contains(t))return oe[0].innerText=Ee.MULTIPLE_CHOICE_SAME_OPTION_ERROR,void oe.show();var w=editor.getDocument(),r=u.getFillableFieldType(),U=u.getName();w.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){e&&e.getFillableFieldType()===FILLABLEFIELD_TYPE[r.toUpperCase()]&&e[ATTR_FILLABLEFIELD.FF_NAME]&&e[ATTR_FILLABLEFIELD.FF_NAME]===U&&e.getValue()===C&&e.setValue(t)})}break;case ATTR_FILLABLEFIELD.FF_CHECKED_VALUE:case ATTR_FILLABLEFIELD.FF_UNCHECKED_VALUE:if(ue){if(!Ht(e,t))return;break}if(r!==FILLABLEFIELD_TYPE.CHECKBOX||t===(e===ATTR_FILLABLEFIELD.FF_CHECKED_VALUE?u.getCheckedValue():u.getUncheckedValue()))return;FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME].test(t)&&(t=t.replaceAll(FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME],"")),Nt(t,e);break;case"prefill_value":if(!ue)return;if(u.getFillableFieldType()==FILLABLEFIELD_TYPE.SELECTBOX&&!Gt(t)||u.getFillableFieldType()==FILLABLEFIELD_TYPE.CHECKBOX&&!Ht(e,t)||ce&&!Jt(e,t))return;break;default:return}var x=u.getId();try{editor.getDocument().sync(function(){n.publish("FillableFieldUpdated",editor.getDocument().getFieldById(x))})}catch(e){var B=ZWCollaboration.FILLABLE_FIELD_SYNC_ERROR,H=u.getFillableFieldType(),k=u[ATTR_FILLABLEFIELD.FF_NAME];a.log("Exception in fillable field sync: Field Type:"+H+", Field Name:"+k+" "+e.stack);var W=a.getErrorParams(B+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>#\n Error Log Start \n"+ZWCollaboration.clientInfo+"\nException Stack: "+e.stack+"\n Error Log End \n",null,B);ZWBeacon.sendErrorLogs(W)}r!==FILLABLEFIELD_TYPE.MULTILINE&&r!==FILLABLEFIELD_TYPE.RADIO&&r!==FILLABLEFIELD_TYPE.MULTIPLECHOICE||s.setProcessingTC(!0)}},Oe=function(e,t){if(!t||""==t)return!0;var i=e.getFillableFieldType();if(i===FILLABLEFIELD_TYPE.CURRENCY&&" "!==t){var n=e.getCurrencyCode(),o=e._.op.ffInfo.locale,r=Numeral.getFormattedNumberAndCurrencySymbol(o,n);n=e.isCurrencySymbolAsCode()?r.symbol:n;var a=new RegExp("[ "+n+"]","g"),s=t.replace(a,""),l=new RegExp("[., "+n+"]","g"),d=t.replace(l,"");if(d&&!d.match(/^\d+$/))return!1}else if(i===FILLABLEFIELD_TYPE.NUMBER&&" "!==t){if(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.NUMBER].test(t))return!1}else if(i===FILLABLEFIELD_TYPE.PERCENT&&" "!==t){var s=t.replace(/[ \t\r%]+/g,""),c=new RegExp("^(?!-0?(\\.*\\,*0+)?$)-?(0|[1-9]\\d*)?(\\.*\\,*\\d+)?(?<=\\d)$");if(!s.match(c))return!1;if(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.NUMBER].test(t))return!1}else if(i===FILLABLEFIELD_TYPE.PHONE&&" "!==t){if(!t.match(/^\d+$/))return!1;if(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.PHONE].test(t))return!1}else if(i===FILLABLEFIELD_TYPE.EMAIL&&" "!==t&&!FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.EMAIL].test(t))return!1;return!0},be=function(e){var t,i=u.getFillableFieldType(),n=!1;if(i===FILLABLEFIELD_TYPE.CURRENCY&&" "!==e){var o=u.getCurrencyCode(),r=u._.op.ffInfo.locale,a=(DocLocaleHandler.getLanguageDetails(r),Numeral.getFormattedNumberAndCurrencySymbol(r,o));o=u.isCurrencySymbolAsCode()?a.symbol:o;var s=new RegExp("[ "+o+"]","g"),l=e.replace(s,""),d=new RegExp("[., "+o+"]","g"),c=e.replace(d,"");if(c&&!c.match(/^\d+$/))return B.show(),!1;B.hide(),e.startsWith(o)&&(e=e.replace(s,"")),e=e.replaceAll(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.CURRENCY],""),""===e&&(e=" ")}else if(i===FILLABLEFIELD_TYPE.NUMBER&&" "!==e)e=e.replaceAll(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.NUMBER],""),e=Ie(u.getLocale(),e),e=e.replaceAll(",","");else if(i===FILLABLEFIELD_TYPE.PERCENT&&" "!==e){var l=e.replace(/[ \t\r%]+/g,""),g=new RegExp("^(?!-0?(\\.*\\,*0+)?$)-?(0|[1-9]\\d*)?(\\.*\\,*\\d+)?(?<=\\d)$");if(!l.match(g))return B.show(),!1;B.hide(),e=e.replaceAll(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.NUMBER],""),e=Ie(u.getLocale(),e),e=e.replaceAll(",","")}else if(i===FILLABLEFIELD_TYPE.PHONE&&" "!==e){if(!e.match(/^\d+$/))return B.show(),!1;B.hide(),e=e.replaceAll(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.PHONE],"")}else if(i===FILLABLEFIELD_TYPE.DATE&&"number"!=typeof e&&" "!==e)e=k.zdatetimefield("getValue"),e=e.dateString!=FILLABLEFIELD_PROPS.DATE_FORMAT&&e.dateObject?e.dateObject.getTime():" ";else if(i===FILLABLEFIELD_TYPE.EMAIL&&" "!==e){if(!FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.EMAIL].test(e))return x.show(),!1;x.hide()}else if(i===FILLABLEFIELD_TYPE.IMAGE){var f=u.getSize();if(t={ht:f.ht,wid:f.wid,orginalHt:e.ORIG_HEIGHT,orginalWid:e.ORIG_WIDTH},p.setFormats(t),p&&"object"==typeof e&&(e=e.URL,p.getFitType()===IMAGE_FIT_TYPE.FIXED)){var E=ve(p.rawFormat);u.style.img_fit="cropFit",u.style.cropRect=E[ATTR_IMAGE.I_CROPRECT]}}else if(i===FILLABLEFIELD_TYPE.SIGNATURE||i===FILLABLEFIELD_TYPE.INITIAL){if(" "===e)e="";else if(p){var t,f=u.getSize(),T=e.height||"undefined"!=typeof e.height?e.height:f.ht,m=e.width||"undefined"!=typeof e.width?e.width:f.wid,h="undefined"!=typeof e.originalHeight?e.originalHeight:f.ht,I="undefined"!=typeof e.originalWidth?e.originalWidth:f.wid;m=f.ht*(m/T);var _,A=DocLayoutManager.getLineAtIndex(p.start);m=A&&(_=A.getMaxContentWidth())&&_<m?_:m,t={ht:f.ht,wid:m,orginalHt:h,orginalWid:I},p.setFormats(t),e=e.imageSrc}}else H.hide();e=u.isFillableImageField()||"string"!=typeof e?e:e.slice(0,u.getMaxLength());var S=e!==u.getValue();if(S){var R=u.getName(),O=u.getId();editor.getDocument();editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(o){if(o&&o.getFillableFieldType()===FILLABLEFIELD_TYPE[i.toUpperCase()]&&o.getName()&&o.getName()===R){if(o.setValue(e),o.isFillableImageField()&&o.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE){var r=o.getSize();if(t={ht:r.ht,wid:r.wid,orginalHt:t.orginalHt,orginalWid:t.orginalWid},t&&o.setFormats(t),o.getFitType()==IMAGE_FIT_TYPE.FIXED){var a=ve(o.rawFormat);o.style.cropRect=a[ATTR_IMAGE.I_CROPRECT],o.style.img_fit="cropFit"}}o.getId()===O&&(n=!0)}}),!n&&u.setValue(e)}return S},ve=function(e){var t=e.orginalHt||e.ht,i=e.orginalWid||e.wid,n=ZWImageUtils.calculateAspectRatio(i,t),o=0,r=0;if(n<0&&(n=ZWImageUtils.calculateAspectRatio(e.orginalHt,e.orginalWid)),e.wid>e.ht){var t=e.ht,i=t*n;i>e.wid&&(i=e.wid,t=i/n)}else{var i=e.wid,t=i/n;t>e.ht&&(t=e.ht,i=t*n)}o=(e.wid-i)/2,r=(e.ht-t)/2;var a=(ZWImageUtils.getOrginalHeighWidthOfImage(e),{cropTop:-r,cropBottom:-r,cropLeft:-o,cropRight:-o});return a=ZWImageUtils.convertCropDataToPercentage(a,t,i),e[ATTR_IMAGE.I_CROPRECT]=a,e.ht_un=e.wid_un="px",e},De=function(e){var t=u.getFillableFieldType(),i=!1,n=e!==u.isChecked();if(n){var o=u[ATTR_FILLABLEFIELD.FF_NAME],r=u.id,a=editor.getDocument();a.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(n){n&&n.getFillableFieldType()===FILLABLEFIELD_TYPE[t.toUpperCase()]&&n[ATTR_FILLABLEFIELD.FF_NAME]&&n[ATTR_FILLABLEFIELD.FF_NAME]===o&&(n.setChecked(e),n.id===r&&(i=!0))}),!i&&u.setChecked(e)}return n},Le=function(){var e=function(e,t,i){var n=e||u;i==ATTR_FILLABLEFIELD.FF_SELECTED_INDEX?n.setSelectedIndex(t):n.setList(t)&&n.getSelectedIndex()>=t.length&&n.setSelectedIndex(0)},t=function(e,t){return t==ATTR_FILLABLEFIELD.FF_SELECTED_INDEX?e!==u.getSelectedIndex():t==ATTR_FILLABLEFIELD.FF_LIST?!!e.length&&!ZWJSONUtils.compareJSON(e,u.getList()):void 0};return function(i,n){var o=t(i,n),r=!1,a=u.getFillableFieldType();if(o){var s=u[ATTR_FILLABLEFIELD.FF_NAME],l=u.id,d=editor.getDocument();d.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(t){t&&t.getFillableFieldType()===FILLABLEFIELD_TYPE[a.toUpperCase()]&&t[ATTR_FILLABLEFIELD.FF_NAME]&&t[ATTR_FILLABLEFIELD.FF_NAME]===s&&(e(t,i,n),t.id===l&&(r=!0))}),!r&&e(null,i,n)}return o}}(),Ne=function(e){var t=u.getFillableFieldType(),i=u.getId(),n=!1;editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(o){o.getFillableFieldType()===FILLABLEFIELD_TYPE[t.toUpperCase()]&&!n&&o&&o.getName()&&o.getName()===e&&o.getId()!==i&&(n=!0,t==FILLABLEFIELD_TYPE.CHECKBOX?u.setChecked(o.isChecked()):t==FILLABLEFIELD_TYPE.SELECTBOX?(u.setList(o.getList()),u.setSelectedIndex(o.getSelectedIndex())):u.setValue(o.getValue()),ue&&FieldPreFillHandler.updatePrefillForFieldName(u,o))}),ue&&FieldPreFillHandler.updateFillableFieldDetails(null,u,e)},Pe=function(e){for(var t=0,i=e.length;t<i;t++)e[t]?e[t]=e[t].replaceAll(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.SINGLELINE],"").trim():(e.splice(t,1),i--,t--);return e},Ce=function(e,t){var i=R[0].querySelectorAll(pe.SLCT_OPTION),n=0;if("set"===t){for(var o=0;o<i.length;o++)i[o].querySelector(pe.SLCT_CHOICE).value===e&&(n=o);return n}if("get"===t||"reorder"===t){for(var r="get"===t?u.getSelectedIndex():e,o=0;o<i.length;o++)o==r&&(n=o);return"get"===t?i[n]:e}},ye=function(e){if(R[0].querySelector(pe.SLCT_OPTION)){var t=R[0].querySelector(pe.SLCT_OPTION).cloneNode(!0);document.getElementById("select-container").appendChild(t);var i="select-choice-"+Utils.randomString();t.id="option"+Utils.randomId(),t.querySelector(pe.SLCT_CHOICE).value="",t.querySelector(pe.SLCT_CHOICE).id=i,J(t).find(".is-selected").removeClass("is-selected"),J("#field-properties").ZCtrackObjects("initEvents",J(t),void 0,!0),J("#"+i)[0].scrollIntoView()}},Fe=function(e,t){j.hide();var i,n=R[0].querySelectorAll(pe.SLCT_OPTION);if(1==n.length)return void ZAlertBanner.show({message:Ee.SELECT_REMOVE_ERROR,hideDelay:7e3,type:"error",icon:!0,closeButton:"true",target:"#notifyMessage",position:"top",align:"center"});if("updatePanel"!==t&&(i=e.parentNode.querySelector(pe.SLCT_CHOICE).value)){for(var o,n=R[0].querySelectorAll(pe.SLCT_CHOICE),r=u.getSelectedIndex()||0,a=!1,s=[],l=0,d=(u.getList()[r],0);d<n.length;d++)e.parentNode.querySelector(pe.SLCT_CHOICE)===n[d]&&(o=d),n[d].value&&d!==o?(s[l]=n[d].value,l++):o===r&&(r=0,a=!0);return e.parentNode?e.parentNode.remove():e.target.parentNode.remove(),null!=o&&o<r&&(r--,a=!0),a&&Re(ATTR_FILLABLEFIELD.FF_SELECTED_INDEX,r),void Re(ATTR_FILLABLEFIELD.FF_LIST,s)}e.parentNode?e.parentNode.remove():e.target.parentNode.remove()};Utils.highlightFillableFieldsOnClick();var Me={init:function(){J("#ff-name-fieldContainer").find(".zselectbox__textbox").on("blur",FillableFieldsPanel.setLabel)},beforeFillValues:function(){Be()},get:function(e,t){return Se(e.action)},set:function(e,t,i){if(e&&e.action){r.isDialogFocused=arguments[5]&&arguments[5].keyCode==KEYS.TAB;var n=arguments[5]&&arguments[5].keyCode==KEYS.ENTER;Re(e.action,t,n)}}},we=function(){o.isRichEditActive()?s.showSubPanel(t.FORMOPTIONSPANEL,ANIMATIONS.FLIPIN):o.toggleRichEdit("open",t.FORMOPTIONSPANEL),xe()},Ue=function(){s.closePropsPanel(t.FORMOPTIONSPANEL,t.INSERTFIELDSPANEL,[t.INSERTPANEL])},xe=function(){var e=Z(t.FORMOPTIONSPANEL);e.data("ZCtrackObjects")?e.ZCtrackObjects("refreshValues"):e.ZCtrackObjects({callbacks:Me,fillVisible:!1});var i=editor.doc.getSelection();i.selectionType!==SEL_KEYBOARD&&i.selectionType!==SEL_OP_GEN&&setTimeout(function(){CurUtil.stopBlinking(),h.focus()},150)},Be=function(){var e=u.isFillableImageField()?u.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_DISABLED]:u.disabled;D.enable(),C.enable(),D.ztoggleswitch(e?"switchOn":"switchOff"),C.ztoggleswitch(u.isMandatory()?"switchOn":"switchOff"),C[u[ATTR_FILLABLEFIELD.FF_DISABLED]?"disable":"enable"](),D[u.isMandatory()?"disable":"enable"](),G.find("#ff-name-fieldContainer").find(".zselectbox__textbox")[0].placeholder=u.getId(),C.attr("title",J.i18n("writer.common."+(u.type!==NODE_TYPE.IMAGE&&u.isMandatory()?"MANDATORY":"OPTIONAL")));var t=u.type===NODE_TYPE.IMAGE?u.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]:u.getFillableFieldType();switch(Xe(),yt(),t){case FILLABLEFIELD_TYPE.CHECKBOX:O.find(".zbutton").removeClass("is-selected");var i,n,o,r=!0;if(ue||E){var a=xt();i=a.checked_value||" ",n=a.unchecked_value||" ",o="true"==a.checked,re.val(a.value||"")[""==a.checked?"enable":"disable"](),r=""!=a.checked}else i=u.getCheckedValue()||"True",n=u.getUncheckedValue()||"False",o=u.isChecked();se.val(i),le.val(n);var s=o?se:le;r&&s[0].parentElement.querySelector(".zbutton").classList.add("is-selected");break;case FILLABLEFIELD_TYPE.SELECTBOX:var l=R.find("#select-container")[0].querySelectorAll(pe.SLCT_CHOICE);if(0===l.length)return;var d=u.getList()||[],c=J("#select-demo");c.zlabeledselectbox("removeOption");for(var g=0,T=d.length;g<T;g++)l[g].value=d[g],c.zlabeledselectbox("addOptionAt",{label:d[g],value:d[g]},g);var I=R.find("#select-container").find(".zbutton");I.removeClass("is-selected"),J(I[u.getSelectedIndex()]).addClass("is-selected");break;case FILLABLEFIELD_TYPE.IMAGE:L.show(),J("#ff-imageinput-field").val(u.getValue()).disable();case FILLABLEFIELD_TYPE.INITIAL:case FILLABLEFIELD_TYPE.SIGNATURE:p?Z("ff-image-keepaspect").enable():Z("ff-image-keepaspect").disable(),J("#ff-img-pnl-rot-deg").text(p.style.rotation||0),"square"==p.style[ATTR_IMAGE.I_WRAP_TYPE]&&"align"==p.style.positionH[ATTR_IMAGE.I_POSITION_TYPE]?(Z("ff-img-wrap-type").text(fe[p.style.positionH[ATTR_IMAGE.I_ALIGN_VAL]]||""),J("#ff-img-lpnl-marginlist").zlabeledselectbox("setAttribute","disabled",!1)):p.style[ATTR_IMAGE.I_WRAP_TYPE]?(Z("ff-img-wrap-type").text(fe[p.style[ATTR_IMAGE.I_WRAP_TYPE]]),J("#ff-img-lpnl-marginlist").zlabeledselectbox("setAttribute","disabled",!1)):(Z("ff-img-wrap-type").text(fe.bottom),J("#ff-img-lpnl-marginlist").zlabeledselectbox("setAttribute","disabled",!0)),J("#ff-sign-preview").text(J.i18n("writer.fillablefields.CLICK_TO_DRAW",[J.i18n("writer.digisign."+t.toUpperCase())])),"custom"==Se(ge.MARGIN_TYPE)?Z("ff-img-custom-margin").show():Z("ff-img-custom-margin").hide(),J("#ff-sign-preview")[0].innerHTML=" "==u.getValue()?"<span onclick='FillableFieldsPanel.insertSign();'>Click to Draw a Signature</span>":"";var _=WRITER_BASE_URL+"/"+u.getValue();" "!=u.getValue()&&J("#ff-sign-preview").find("#ff-sprev").remove("#ff-sprev")&&J("#ff-sign-preview")[0].appendChild(esignpanel.createImageSpan(u.getFillableFieldType(),"","ff-sprev",_))," "!=u.getValue()?Q.addClass("ui-sfield-draw-cont-opts-toggle"):Q.removeClass("ui-sfield-draw-cont-opts-toggle");break;case FILLABLEFIELD_TYPE.DATE:var S=u.getFormat(),b=DocLocaleHandler.getDateFormatsWithPreview(),v=ZWUtils.getLocaleDetails().code||"en-US",N=new ZWDateTime(" "!=u.getValue()?u.getValue():(new Date).getTime(),null,v);M.zlabeledselectbox("removeOption"),He({format:S,preview:N.format(S)}),b.slice(0,b.length-4).forEach(function(e){S!==e.format&&He(e)}),M.zlabeledselectbox("setValue",S),M.zlabeledselectbox("refresh"),M.off("zlabeledselectboxchange").on("zlabeledselectboxchange",Re.bind(null,ATTR_FILLABLEFIELD.FF_FORMAT)),J("#ff-date-formatContainer").find(".zmenu__hint").hide(),M.off("zlabeledselectboxblur").on("zlabeledselectboxblur",function(){J("#ff-date-formatContainer").find(".zmenu__hint").hide()});break;case FILLABLEFIELD_TYPE.MULTIPLECHOICE:case FILLABLEFIELD_TYPE.RADIO:var l=ne[0].querySelectorAll(pe.SLCT_CHOICE);if(0===l.length)return;var P,y=u.getName(),w=Dt(y),U=w.options,k=w.selectedOption,o=!1,W=[];if(ue){var z=FieldPreFillHandler.getPrefillModel(),V=xt();k=[],Object.keys(w.fieldList).forEach(function(e){var t=f.field_map[e]||{};W.push(z.replaceIdsWithNames(t.field_value||"")),o=o||"true"==t.checked,"true"==t.checked&&k.push(W[W.length-1])}),re.val(V.value||"")[o?"disable":"enable"]()}ne.find(".zbutton").removeClass("is-selected");for(var g=0,T=U.length;g<T;g++)l[g].parentElement.classList.remove("ui-active","on-hover"),l[g].value=ue?W[g]:U[g],J(l[g]).data("val",U[g]),U[g]===u.getValue()&&editor.doc.getSelection().selectionType!==SEL_OP_GEN&&l[g].parentElement.classList.add("ui-active","on-hover"),P=l[g].parentElement.querySelector(".zbutton"),k.contains(ue?W[g]:U[g])&&P&&P.classList.add("is-selected");break;case FILLABLEFIELD_TYPE.CURRENCY:var S=u.rawFormat;S[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_VALUE]="123456789",A.find("#ff-currency-preview").text(Utils.getFillableFieldResult(S));case FILLABLEFIELD_TYPE.PERCENT:case FILLABLEFIELD_TYPE.NUMBER:if(t!==FILLABLEFIELD_TYPE.CURRENCY&&t!==FILLABLEFIELD_TYPE.MULTILINE){F.zlabeledselectbox("removeOption");var j=[];for(var X in Te){var K;K="NUMBER_NONE"==X?"None":me(u.getLocale(),X),X.indexOf(t.toUpperCase())!=-1&&j.push({value:X,label:K})}F.zlabeledselectbox("addOption",j,"append")}case FILLABLEFIELD_TYPE.MULTILINE:var q=u.getMaxLength();q=ue&&q<150?150:q,Y.attr("maxlength",q),m.zlabelednumberfield("setValue",q);default:var $=u.getMaxLength();m.zlabelednumberfield("setValue",$),$=ue&&$<150?150:$,t===FILLABLEFIELD_TYPE.SINGLELINE?Y.attr("maxlength",$):h.attr("maxlength",$),x.hide(),H.hide(),B.hide(),L.hide()}},He=function(){var e="<div class='clearfix'><span class='ui-fl ui-right-margin-small'>#preview#</span><span class='ui-fl zmenu__hint'>(#label#)</span></span></div>";return function(t){var i={innerHTML:e,replaceWithText:!0,label:t.preview,preview:t.format},n=J(document.createElement("option"));n.attr({data:JSON.stringify(i),value:t.format}),M.append(n)}}(),Je=function(){u?Ge():ke()},Ge=function(){de?FillableFieldsPanel.refreshValues():(Z("menu-form-parent").show(),o.isRichEditActive()&&FillableFieldsPanel.open()),de=!0},ke=function(){de&&(de=!1),Z("menu-form-parent").hide(),FillableFieldsPanel.close()},We=function(){var e,t,i=function(t,i){var n=i.getFormat(),o=Utils.convertDate(t,n.replaceAll("y","Y").replaceAll("d ","D "));J("#ff-date-value").val(o);var r=Date.parse(t);Re(ATTR_FILLABLEFIELD.FF_VALUE,r),e.zdatetimepicker("close")},n=function(){e.zdatetimepicker({showAnim:"slideDown",changeMonth:!0,changeYear:!0,clearButton:!0,immediateCommit:!1,forElement:"#ff-date-picker",hideCancelButton:!0,format:"MM / dd / yyyy, hh: mm tt",value:t,dateselect:function(e,n){var o=(u.getFormat(),n.selectedDate);o!=t&&i(o,u)},change:function(e,n){var o=(u.getFormat(),n.valueString);o!=t&&i(o,u)},clear:function(e,t){Re(ATTR_FILLABLEFIELD.FF_VALUE," ")}})},o=function(e){var t=" "===e?new Date:new Date(e),i=t.getMinutes()+"";return 1==i.length&&(i="0"+i),t=t.dateFormat("m / d / Y, h: m a"),t=t.split(" "),t[6]=i,t=t.join(" ").toUpperCase()};return function(i){e=Z("zwdatetimepicker-"+i),t=o(u.getValue()).toUpperCase(),0===e.length?(e=J("<div>").attr({id:"zwdatetimepicker-"+i}).addClass("ui-ffpanel-datefield").appendTo("body"),J(document).on("click",function(){var e=J("#zwdatetimepicker-value");"none"!=e.css("display")&&(e[0].contains(event.target)||J("#ff-date-picker")[0].contains(event.target)||e.zdatetimepicker("close"))}),n()):e.zdatetimepicker("setAttribute","value",t),e.zdatetimepicker("open")}}(),Ye=function(){var e=D.ztoggleswitch("getState");Re(ATTR_FILLABLEFIELD.FF_DISABLED,e),Ae("Field Disabled")},ze=function(e){var t;t=J(event.target).closest(".select-option").attr("order-id"),t&&(parseInt(t)==u.getSelectedIndex()&&(t=-1),Re(ATTR_FILLABLEFIELD.FF_SELECTED_INDEX,parseInt(t)))},Ze=function(){var e=J(event.target).closest(".select-option")[0].querySelector("input"),t=u.isChecked(),i=t?u.getCheckedValue():u.getUncheckedValue();(ue||e.value!==i)&&(ue?Ht(ATTR_FILLABLEFIELD.FF_CHECKED,J(event.target).parent().hasClass("is-selected")?null:e.id.indexOf("unChecked")==-1):Re(ATTR_FILLABLEFIELD.FF_CHECKED,!t))},Ve=function(){var e=C.ztoggleswitch("getState");Re(ATTR_FILLABLEFIELD.FF_MANDATORY,e)},je=function(e,t,i,n){if("object"!=typeof e){var o=J("#select-demo");if("reorder"===n)o.zlabeledselectbox("removeOptionAt",t),o.zlabeledselectbox("addOptionAt",{label:e,value:e},i);else if("add"===n)o.zlabeledselectbox("addOption",[{label:e,value:e}],"after");else if("remove"===n)o.zlabeledselectbox("removeOption",e);else if("create"===n){for(var r=R[0].querySelectorAll(pe.SLCT_CHOICE),a=0,s=!1,l=[],d=0,c=0;c<r.length;c++)r[c].value&&(l[d]=r[c].value,d++);o.zlabeledselectbox("removeOption");for(var p=[],g=u.getList(),c=0;c<l.length;c++)o.zlabeledselectbox("addOptionAt",[{label:l[c],value:l[c]}],c),p[c]=l[c],s||l[c]!==g[u.getSelectedIndex()]||(s=!0,a=c);return Re(ATTR_FILLABLEFIELD.FF_SELECTED_INDEX,a),o.zlabeledselectbox("setValue",p[u.getSelectedIndex()]),p}}},Xe=function(){if(u){var e=u.getFillableFieldType().toUpperCase(),t=0,i=[];b.zcombobox("removeOption"),editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(n){if(n.getFillableFieldType()===FILLABLEFIELD_TYPE[e]){for(var o=0;o<t;o++)if(i[o]===n.getName())return;(i[t]=n.getName())&&(b.zcombobox("addOptionAt",{label:i[t],value:i[t]},t),t++)}}),i.join("").trim()&&b.zcombobox("addOption",{separator:!0}),b.zcombobox("addOption",{label:Ee.LINK_FIELDS_HINT,itemType:"custom",className:"ui-ff-link-menu-note"})}},Ke=function(){for(var e=R[0].querySelectorAll(pe.SLCT_CHOICE),t=-1,i=!1,n=[],o=0,r=0;r<e.length;r++)e[r].value&&(n[o]=e[r].value,o++);for(var a=[],s=u.getList(),r=0;r<n.length;r++)a[r]=n[r],i||n[r]!==s[u.getSelectedIndex()]||(i=!0,t=r);for(var l=R[0].querySelectorAll(pe.SLCT_OPTION),r=0;r<l.length;r++){var d=l[r];d.setAttribute("order-id",r)}Re(ATTR_FILLABLEFIELD.FF_SELECTED_INDEX,t),Re(ATTR_FILLABLEFIELD.FF_LIST,a)},qe=function(){var e=document.querySelectorAll(pe.SLCT_OPTION);return function(){e=R[0].querySelectorAll(pe.SLCT_OPTION);for(var t=0;t<e.length;t++){var i=e[t];i.setAttribute("order-id",t)}}}(),Qe=function(){var e={},t=function(e){var t=e.DATA[0];J("#ff-imageinput-field").val(t.URL);var i=ZWImageUtils.getNewDimensionBasedOnContainer(t.WIDTH,t.HEIGHT);t.WIDTH=i.width,t.HEIGHT=i.height,Re("imageValue",t)},n=function(){i.showMessage("error",Ee.INS_IMG_ERROR,"showclose","normalfont",3e3)},o=function(){t.apply(null,arguments),ZWImgLibDialog.close()},r=function(){n.apply(null,arguments),ZWImgLibDialog.close()};return function(){ZWImgLibDialog.open(e,o,r)}}(),$e=!0,et=(editorProps.userInfo.firstName,editorProps.userInfo.fullName?editorProps.userInfo.fullName.split(" ")[1]:"",USER_ROLE.PUBLIC===editorProps.userInfo.role&&editorProps.isPublishToFill||"function"==typeof editor.getView&&7===editor.getView()),tt=function(){var e=function(e){var t=event.currentTarget,i=ZWImageUtils.getNewDimensionBasedOnContainer(t.naturalWidth,t.naturalHeight);e.height=i.height,e.width=i.width,e.originalHeight=t.naturalHeight,e.originalWidth=t.naturalWidth,Re("signValue",e)},t=function(){var t=u.getFillableFieldType()==FILLABLEFIELD_TYPE.INITIAL?arguments[0].initial:arguments[0].signature,i={};if(t){i.imageSrc=et||!$e?t:HTMLUtil.storeImageInFileStore(t),i.imageBytes=t;var n=new Image;n.onload=e.bind(null,i),n.src=t}};return function(){ZSignController.editSignFromPanel(u.getFillableFieldType(),t,!0)}}(),it=function(){var e=u.getFillableFieldType();u.setFormats({wid:e===FILLABLEFIELD_TYPE.SIGNATURE?300:50,ht:50}),u.setValue(" "),editor.getDocument().sync()},nt=function(e){u.getSize();if(e==IMAGE_FIT_TYPE.FLUID)p.style.height=p.style.originalHeight||p.style.height,p.style.width=p.style.originalWidth||p.style.width,p.style.cropRect&&(p.style.cropRect={cropTop:"0.000%",cropBottom:"0.000%",cropLeft:"0.000%",cropRight:"0.000%"});else{var t=100,i=100;p.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]==FILLABLEFIELD_TYPE.SIGNATURE?(t=50,i=300):p.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]==FILLABLEFIELD_TYPE.INITIAL&&(t=50,i=50);var o=p.rawFormat;p.style.height=t||p.style.height,p.style.width=i||p.style.width;var r=ve({ht:t,wid:i,orginalHt:o.orginalHt||t,orginalWid:o.orginalWid||i});u.style.cropRect=r[ATTR_IMAGE.I_CROPRECT],u.style.img_fit="cropFit",n.publish("TransformableObject/Deselected","image",o[ATTR_COMMON.ID])}},ot=function(e,t){if(u&&u.isFillableField()&&!t&&!e.isPropagationStopped()){if(t=G.find("#ff-name-fieldContainer").find(".zselectbox__textbox").val(),u[ATTR_FILLABLEFIELD.FF_NAME]===t)return void e.stopPropagation();Re(ATTR_FILLABLEFIELD.FF_NAME,t),e.stopPropagation()}},rt=function(e){return G.find("#"+e)},at=function(){G=Z("field-properties"),G.length&&!_&&(m=G.find("#ff-maxlength-field"),h=G.find("#ff-value-field"),k=G.find("#ff-date-value"),I=rt("ff-value-cont"),_=G.find("#ff-prop-value,#ff-prop-chars-length,#ff-prop-field-name"),A=G.find("#ff-currency-properties,#ff-curr-props"),S=G.find("#ff-prop-date,#ff-format-options"),H=G.find("#ff-char-errortext,#ff-allowed-chars"),L=G.find("#ff-image-field"),R=G.find("#ff-box-properties"),O=G.find("#ff-prop-checkbox"),b=G.find("#ff-name-field"),P=G.find("#ff-image-props"),v=G.find("#ff-helptext-field"),x=G.find("#ff-email-errortext"),N=G.find("#ff-prop-field-name"),C=G.find("#ff-mandatory-field"),D=G.find("#ff-disabled-field"),M=G.find("#ff-date-format"),w=G.find("#ff-isChecked-field"),U=J("#ff-date-picker"),X=rt("ff-prop-signature"),K=rt("ff-image-fit"),q=rt("ff-image-field"),Y=rt("ff-text-area-field"),z=rt("ff-text-area-cont"),Q=rt("ff-sign-prev-cont"),$=rt("ff-size-cont"),ee=rt("ff-image-keepaspect"),B=G.find("#ff-number-errortext"),j=G.find("#ff-select-char-errortext"),te=G.find("#ff-prop-number-format"),F=G.find("#ff-number-format-select"),y=G.find("#ff-mandatory-cont"),F=G.find("#ff-number-format-select"),ie=G.find("#ff-prop-multiple-choices"),ne=ie.find("#multiple_choice_container"),oe=G.find("#multiple_choice_error_txt"),se=G.find("#ff-checkedValue-field"),le=G.find("#ff-unCheckedValue-field"),re=G.find("#ff-prefill-value-field"),ae=G.find("#ff-prefill-value-datasrc"),R.find("#select-container").sortable({axis:"Y",update:Ke,containment:"#ff-box-properties"}))},st=function(){Z("menu-form-parent").show(),J(".ff-props-container").hide(),z.hide(),I.show();var e=u.type===NODE_TYPE.IMAGE?u.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]:u.getFillableFieldType();switch(e){case FILLABLEFIELD_TYPE.CURRENCY:A.show();case FILLABLEFIELD_TYPE.PHONE:case FILLABLEFIELD_TYPE.PERCENT:_.show(),h.attr("type","text"),y.show(),m.zlabelednumberfield("setAttribute","max",50),u.getFillableFieldType()==FILLABLEFIELD_TYPE.PERCENT&&te.show();break;case FILLABLEFIELD_TYPE.NUMBER:_.show(),h.attr("type","text"),y.show(),m.zlabelednumberfield("setAttribute","max",50),te.show();break;case FILLABLEFIELD_TYPE.SINGLELINE:_.show(),z.show(),I.hide(),h.attr("type","text"),y.show(),m.zlabelednumberfield("setAttribute","max",1e4);break;case FILLABLEFIELD_TYPE.EMAIL:_.show(),h.attr("type",ue||E?"text":"email"),y.show(),m.zlabelednumberfield("setAttribute","max",100);break;case FILLABLEFIELD_TYPE.DATE:S.show(),J("#date-value").attr("type","text"),J("#ff-prop-field-name").show(),y.show(),k.attr("disabled",!(ue||E));break;case FILLABLEFIELD_TYPE.CHECKBOX:ae[ue||E?"show":"hide"](),O.show(),J("#ff-prop-field-name").show();break;case FILLABLEFIELD_TYPE.IMAGE:N.show(),P.show(),q.show(),X.hide(),K.show(),$.show(),ee.next().show(),J(".ff-title-"+e).text(Utils.getFillableFieldTooltip(e)),y.show();break;case FILLABLEFIELD_TYPE.INITIAL:case FILLABLEFIELD_TYPE.SIGNATURE:N.show(),P.show(),X.show(),q.hide(),K.hide(),$.show(),ee.next().show(),J(".ff-title-"+e).text(Utils.getFillableFieldTooltip(e)),y.show();break;case FILLABLEFIELD_TYPE.SELECTBOX:R.show(),J("#ff-prop-field-name").show(),ae[ue||E?"show":"hide"](),y.show();var i=u.getList(),o=i&&i.length,r=R[0].querySelectorAll(pe.SLCT_OPTION),a=o-r.length;if(a<=0)for(var l=Math.abs(a),d=o,c=R[0].querySelectorAll(pe.SLCT_OPTION);l;){var p=c[d].lastChild.previousSibling;FillableFieldsPanel.selectOptionRemove(p,"updatePanel"),d++,l--}else for(;a;){var g=R[0].querySelector(pe.SLCT_OPTION);FillableFieldsPanel.selectOptionAdd(g),a--}qe();break;case FILLABLEFIELD_TYPE.MULTILINE:y.show(),_.show(),z.show(),I.hide(),h.attr("type","text"),m.zlabelednumberfield("setAttribute","max",1e4);break;case FILLABLEFIELD_TYPE.MULTIPLECHOICE:case FILLABLEFIELD_TYPE.RADIO:N.show(),y.show(),ie.show(),ne.show(),ae[ue||E?"show":"hide"]();var p,i=Dt(u.getName()).options,o=i&&i.length,r=ne[0].querySelectorAll(pe.SLCT_OPTION),a=o-r.length,c=ne[0].querySelectorAll(pe.SLCT_OPTION);if(a<=0)for(var l=Math.abs(a),d=o;l;)p=c[d].lastChild.previousSibling,FillableFieldsPanel.selectOptionRemove(p,"updatePanel"),d++,l--;else for(;a;)Ot(!0),a--;for(var d=0;d<c.length;d++)c[d].setAttribute("order-id",d)}J(".ff-title-"+e).show(),s.openPropsPanel({panelId:t.FORMOPTIONSPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[t.FORMATPANEL]});var f=E;n.publish("Prefill/Datasource"+(f?"Added":"Removed")),FillableFieldsPanel.refreshValues()},lt=function(){J("#ff-submit-toggle").off("zstatebuttonchange").on("zstatebuttonchange",FillAutomationHandler.toggleSubmitAction)},dt=function(e){if(i.hideLoadingMsg(),ct(),!editorProps.isPublishToFill&&editorProps.isFillableForm&&n.publish("Require/ProPack"),!editorProps.isPublishToFill&&editorProps.isFillableForm&&n.publish("Require/FillAddon"),J("#ff-submit-addon-tag")[i.isPropackEnabled()?"hide":"show"](),"fillable_fields_properties"===e)return!(!Z(t.FORMOPTIONSPANEL).length||!Z(t.SUBPANELCONTAINER).length)&&(st(),!0);if("insertAnotherField"===e)return!!Z(t.INSERTFIELDSPANEL).length&&(s.openPropsPanel(null,{panelId:t.INSERTFIELDSPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[t.INSERTFIELDPANEL]}),Ae("Field Inserted From Properties Panel"),lt(),"REMOTEEDIT"!==c&&CollabListHandler.getSharedUserStatus(),FillAutomationHandler.updateSubmitSettings(),Z("ff-savesettings-cont,#ff-submit-container").hide(),Z("ff-preview-cont").show(),Z("ff-insert-title").show(),Z("ff-fields-btn").show(),Z("ff-automation-title").hide(),J("#fm-logs-cont,#fm-test-cont,#ff-on-submission-cont,#ff-responder-options").hide(),J("#fillable-fields-back-btn").show(),J("#fillable-fields-help-btn").css("right","36px"),Z("ff-datasrc-cont").hide(),!0);if(!Z(t.INSERTFIELDSPANEL).length)return!1;var o={panelId:t.INSERTFIELDSPANEL,animationType:ANIMATIONS.FLIPIN},r=!!editorProps.options.REMOTE&&Macros.isPDFDocument(),a=J("#fillableFields");Ae("Fillable Fields Feature Used"),lt(),"REMOTEEDIT"!==c&&CollabListHandler.getSharedUserStatus(),FillAutomationHandler.updateLinkTexts(),FillAutomationHandler.updateSubmitSettings();var l=editor.doc.docInfo.TEMPLATE_SETTINGS;if(editorProps.isFillableForm&&!(l&&l.fill)&&FillAutomationHandler.toggleSubmitAction(),"prepare_fillable_fields"==e){n.publish("MailMerge/LoadLazyFiles"),Z("ff-savesettings-cont,#ff-submit-container").show(),Z("ff-preview-cont").hide(),Z("ff-insert-title").hide(),Z("fm-test-cont").show(),Z("ff-automation-title,#ff-on-submission-cont,#ff-responder-options").show(),Z("ff-datasrc-cont").show();var d=E;d&&MailMergeDataModel.isDataAvailable()?(Z("ff-csvname").text(MailMergeDataModel.getFileName()||d.info.filename),Z("ff-source-text").show(),Z("ff-data-source-add-btn").hide(),Z("ff-data-filter-btn").show()[d.filter_data?"addClass":"removeClass"]("is-active"),Z("ff-data-source-option").show()):(Z("ff-csvname").text(J.i18n("writer.editor.MAILMERGE.NO_DATASOURCE_AVAILABLE")),Z("ff-data-source-add-btn").show(),Z("ff-source-text").hide(),Z("ff-data-filter-btn").hide(),Z("ff-data-source-option").hide()),FieldPreFillHandler.setSourceFileLink(Z("ff-csvname")),editorProps.isFillableForm&&(o.animationType=ANIMATIONS.FADEIN),l&&l.fill&&J("#fm-logs-cont").show(),J("#automationPanel").removeClass("ui-abs-loading-gif");var u=editorProps.urls.helpPageURL+"creating-fillable-documents.html";J("#fillable-fields-help-btn").attr("href",u),o.parentPanels=[t.AUTOMATIONPANEL]}else Z("ff-savesettings-cont,#ff-submit-container").hide(),Z("ff-preview-cont").show(),Z("ff-insert-title").show(),Z("ff-automation-title").hide(),J("#fm-logs-cont,#fm-test-cont,#ff-on-submission-cont,#ff-responder-options").hide(),J("#fillable-fields-back-btn").show(),J("#fillable-fields-help-btn").css("right","36px"),Z("ff-datasrc-cont").hide(),o.parentPanels=[t.INSERTFIELDPANEL];return"leftPanelOpen"===e&&(o.animationType=ANIMATIONS.FADEIN,s.showSubPanel(t.INSERTFILLABLEFIELDS,ANIMATIONS.FADEIN)),s.showAdvancedPanel(o),("fillable_fields_left_panel"==e||"leftPanelOpen"==e)&&Z("ff-fields-btn").show()&&TemplateUIHandler.showAutoInsertFieldsBtn(),Z("ff-on-submission-cont").removeClass("ui-top-margin-small"),T?(a.find("#ff-fields-btn")[T.hideFieldsList?"hide":"show"](),a.find("#ff-share-cont,#ff-prefill-share-btn")[T.hideShareBtn?"hide":"show"](),a.find("#fm-logs-btn")[T.hideLogsBtn?"hide":"show"](),a.find("#ff-done-cont")[T.showDoneBtn?"show":"hide"](),a.find("#ff-done-btn").off("click").on("click",T.doneCallback).zbutton("setAttributes",{text:T.doneBtnText}),a.find("#fillable-fields-back-btn")[T.showBackBtn?"show":"hide"]().off("click").on("click",T.backBtnCallback).removeAttr("module"),T.backBtnCallback&&a.find("#fillable-fields-back-btn").off("click").on("click",function(){T.backBtnCallback(),event.preventDefault()}).removeAttr("onclick"),a.find("#fillable-fields-help-btn")[T.hideHelpBtn?"hide":"show"](),Z("ff-datasrc-cont")[T.hideDatasrcCont?"hide":"show"](),!T.hideHelpBtn&&a.find("#fillable-fields-help-btn").css("right","12px"),T.panelTitle&&a.find("#ff-automation-title").text(T.panelTitle)):(("prepare_fillable_fields"==e||"fillable_fields_left_panel"==e||"leftPanelOpen"==e)&&(editorProps.isFillableForm||r||Macros.isSignTemplate())&&J("#fillable-fields-back-btn").hide()&&J("#fillable-fields-help-btn").show().css("right","12px"),a.find("#fillable-fields-back-btn").off("click").attr("module","FieldPanel"),a.find("#ff-fields-btn").show()),!0},ct=function(){editor.addFonts(["DejaVu Sans"],frames.metricsFrame,null,{usedWebFontWithVariants:["DejaVu Sans:n4"]})},ut=function(e){var t=e;"insertAnotherField"!==e&&"prepare_fillable_fields"!==e&&"leftPanelOpen"!==e||(t="insert_fillable_fields"),Z("subpanel-container").length&&FetchHTML.get({requestName:t,target:"#subpanel-container",requestURL:ZWNetworkUtils.getNiceUrlPrefix("toolbar/"+t),callback:function(){at(),dt(e)}})},pt=function(e){g=e=e||g,/fillable_fields_properties|insert_fillable_fields|leftPanelOpen|insertAnotherField|prepare_fillable_fields/.test(e)&&(i.showLoadingMsg(Ee.LOADING),dt(e)||ut(e))},gt=function(e,t){if(!(editor.getView()&&editor.getView()!==EDITOR_VIEWS.EDITOR||editor.isVersionView()||editor.isOfflineMode||editor.isFinalDocument()||o.isFullscreen())){var r=editor.getDocument().getSelection().getRangeAt(0),a=r.getStartNode();u=t&&editor.getDocument().getFieldById(t)||a&&a.type===NODE_TYPE.FIELD_START&&a.getField()||a.type===NODE_TYPE.IMAGE&&a.rawFormat.hasOwnProperty(ATTR_FILLABLEFIELD.FF_INFO)&&a||a.type===NODE_TYPE.TEXTBOX&&a.rawFormat.hasOwnProperty(ATTR_FILLABLEFIELD.FF_INFO)&&a;var s=editor.doc.getSelection();if(s.selectionType===SEL_KEYBOARD||s.selectionType===SEL_MOUSE||s.selectionType===SEL_OP_GEN){if((s.selectionType===SEL_KEYBOARD||s.selectionType===SEL_MOUSE)&&J(".ffield-selected").length>0&&J(".ffield-selected").trigger("dblclick"),s.selectionType===SEL_KEYBOARD||!u||u.type!==NODE_TYPE.FILLABLEFIELD&&!u.isFillableImageField()||a.getNextSibling()&&Lock.isIdxInLockArea(a.getNextSibling().start,editorProps.userInfo.zuid))return void ke();ce=u.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTIPLECHOICE||u.getFillableFieldType()===FILLABLEFIELD_TYPE.RADIO,p=u.type===NODE_TYPE.IMAGE?u:null;var l=J(editor.doc.getPortionData(p?r.start+1:r.start+2).node);s.selectionType===SEL_OP_GEN&&u.getFillableFieldType()!==FILLABLEFIELD_TYPE.CHECKBOX&&l.hasClass("fillablefield")&&l[0].classList.add(pe.FIELD_SELECTED),i.showFieldVisualCue(Tt,e),pt("fillable_fields_properties");var d={idx:e||s.getStart()};p?n.publish("Image/Selected",u.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID],d):u.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTILINE?n.publish("TextBox/Selected",u.rawFormat[ATTR_COMMON.ID],d):TransformHandler.getCurrentObjectInfo().type||n.publish("Field/Selected",u.rawFormat.id,d)}}},ft=function(){J("#fieldvc-menu-parent").hide()},Et=function(e){if(!(editor.getView()&&editor.getView()!==EDITOR_VIEWS.EDITOR||editor.isVersionView()||editor.isOfflineMode||editor.isFinalDocument()||o.isFullscreen())){var e=e||u&&u.getId(),t=editor.getDocument().getSelection().getRangeAt(0),i=t.getStartNode();u=i&&i.type===NODE_TYPE.IMAGE?i:i.type===NODE_TYPE.FIELD_START&&i.getField();var r=editor.doc.getSelection();if(r.selectionType===SEL_KEYBOARD||r.selectionType===SEL_MOUSE||r.selectionType===SEL_OP_GEN)return(r.selectionType===SEL_KEYBOARD||r.selectionType===SEL_MOUSE)&&J(".ffield-selected").length>0&&J(".ffield-selected").trigger("dblclick"),(!u||u.type!==NODE_TYPE.FILLABLEFIELD&&u.type!==NODE_TYPE.SIGNERFIELD)&&J("#fieldvc-menu-parent").hide(),FillableFieldsHandler.clearNavigationSelection(),e&&n.publish("TransformableObject/Deselected","image",e),r.selectionType===SEL_KEYBOARD||!u||u.type!==NODE_TYPE.FILLABLEFIELD||i.getNextSibling()&&Lock.isIdxInLockArea(i.getNextSibling().start,editorProps.userInfo.zuid)?void ke():void 0}},Tt=function(){V=J("#fieldvc-menu-parent")},mt=function(){s.showAdvancedPanel({panelId:t.INSERTPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[]}),pt("insert_fillable_fields")},ht=function(e){if(!(USER_ROLE.PUBLIC===editorProps.userInfo.role&&editorProps.isPublishToFill||"function"==typeof editor.getView&&7===editor.getView())){var t=editor.getDocument(),i=t.getSelection().getRangeAt(0),n=i.getStartNode(),o=n&&(n.type===NODE_TYPE.FIELD_START&&n.getField()||n.isFillableImageField()&&n),r=e.originalTop,a=e.originalLeft;if(delete e.originalTop,delete e.originalLeft,"signerfield"===o.type)Macros.isSignTemplate()&&!Macros.isPDFDocument()&&(delete e[ATTR_IMAGE.I_H_POSITION],delete e[ATTR_IMAGE.I_V_POSITION]),It(r,a,o,e);else if(o.isFillableImageField()){var s={top:r,left:a},l=o.style._.op;ImageActions.moveFloatingImage(s,o.start,l)}else It(r,a,o,e);t.sync()}},It=function(e,t,i,n){var o=editor.getDocument();if(!e||!t)return void i.setFieldFormat(n,!0);var r=DomViewManager.getClosestPage({left:t,top:e}),a=DocLayoutManager.getPageWithId(r.getAttribute("doc-id")),s=DocLayoutManager.getPageAtIndex(i.getStart().start);if(a==s)return void i.setFieldFormat(n,!0);var l=a.getFirstParaView().getNodeStartIndex(),d=a.getFirstParaView().getNodeEndIndex(),c=o.createRange();c.start=l,c.end=d;var u=JSON.parse(JSON.stringify(i._.op));extend(u,n),i.remove(),i._.op=u,c.insertField(i)},_t=function(e){var t=u.getFillableFieldType(),i=u[ATTR_FILLABLEFIELD.FF_NAME],n=(u.id,editor.getDocument());return n.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(n){n&&n.getFillableFieldType()===FILLABLEFIELD_TYPE[t.toUpperCase()]&&n[ATTR_FILLABLEFIELD.FF_NAME]&&n[ATTR_FILLABLEFIELD.FF_NAME]===i&&(n.getValue()===e?n.setChecked(!n.isChecked()):n.getFillableFieldType()===FILLABLEFIELD_TYPE.RADIO&&n.setChecked(!1))}),!0},At=function(e){var e=J(event.target).closest(".select-option")[0].querySelector("input");(ue?Jt(ATTR_FILLABLEFIELD.FF_CHECKED,J(e).data("val")):_t(e.value))&&editor.getDocument().sync(function(){var e=editor.getDocument().getSelection().getRangeAt(0).getStartNode();e.type===NODE_TYPE.FIELD_START&&n.publish("FillableFieldUpdated",u=e.getField())})},St=function(e){for(var t,i=ne[0].querySelectorAll(pe.SLCT_CHOICE),n=0;n<i.length;n++)e.parentNode.querySelector(pe.SLCT_CHOICE)===i[n]&&(t=i[n].value);e.parentNode?e.parentNode.remove():e.target.parentNode.remove(),t&&Rt(t)},Rt=function(e){var t=u.getName(),i=editor.getDocument(),o=u.getFillableFieldType();i.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(i){i&&i.getFillableFieldType()===FILLABLEFIELD_TYPE[o.toUpperCase()]&&i[ATTR_FILLABLEFIELD.FF_NAME]&&i[ATTR_FILLABLEFIELD.FF_NAME]===t&&i.getValue()===e&&i.remove()}),i.sync(function(){var e=editor.getDocument().getSelection().getRangeAt(0).getStartNode();e.type===NODE_TYPE.FIELD_START&&n.publish("FillableFieldUpdated",u=e.getField())})},Ot=function(e){var t=ne[0].querySelector(pe.SLCT_OPTION).cloneNode(!0);document.getElementById("multiple_choice_container").appendChild(t);var i="Opt"+Utils.randomId();t.id="multiple_choice_container-"+Utils.randomString(),t.querySelector(pe.SLCT_CHOICE).id=i,J(t).find(".is-selected").removeClass("is-selected");var o=JSON.parse(J(t).find(".js-mm-field-choose").attr("mm-zmenu-data"));o.target="#"+i,J(t).find(".js-mm-field-choose").attr("mm-zmenu-data",JSON.stringify(o));var r=bt(u.getFillableFieldType());ue?(J(t.querySelector(pe.SLCT_CHOICE)).data("prefillVal",r),t.querySelector(pe.SLCT_CHOICE).value=""):t.querySelector(pe.SLCT_CHOICE).value=r,!e&&vt(r),J("#field-properties").ZCtrackObjects("initEvents",J(t),void 0,!0);try{!e&&editor.getDocument().sync(function(){var e=editor.getDocument().getSelection().getRangeAt(0).getStartNode();e.type===NODE_TYPE.FIELD_START&&n.publish("FillableFieldUpdated",u=e.getField())})}catch(e){var s=ZWCollaboration.FILLABLE_FIELD_SYNC_ERROR,l=u.getFillableFieldType(),d=u[ATTR_FILLABLEFIELD.FF_NAME];a.log("Exception in fillable field sync: Field Type:"+l+", Field Name:"+d+" "+e.stack);var c=a.getErrorParams(s+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>#\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Error Log End \n<ZWERROR> Exception Stack: "+e.stack,null,s);ZWBeacon.sendErrorLogs(c)}},bt=function(e){var t,i,n=editor.getDocument(),o=0,r="Value ";return n.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(n){var a,s=n.getFillableFieldType();n&&s===e&&(a=n.getValue()).indexOf(r)!==-1&&(t=a.split(" "),i=parseInt(t[t.length-1]),o<i&&(o=i))}),r+(o+1)},vt=function(e){var t=u.getFillableFieldType();i.insertFillableField(t,[e])},Dt=function(e){var t=editor.getDocument(),i={},n=[],o=[];return t.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(t){t&&ce&&t[ATTR_FILLABLEFIELD.FF_NAME]&&t[ATTR_FILLABLEFIELD.FF_NAME]===e&&(i[t.getId()]=t,n.push(t.getValue()),t.isChecked()&&o.push(t.getValue()))}),{fieldList:i,options:n,selectedOption:o}},Lt=function(e,t,i){var n=editor.getDocument(),o=e.getName();n.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){e&&ce&&e[ATTR_FILLABLEFIELD.FF_NAME]&&e[ATTR_FILLABLEFIELD.FF_NAME]===o&&(t===ATTR_FILLABLEFIELD.FF_MANDATORY?e.setMandatory(i):e[t]=i)})},Nt=function(e,t){t=t===ATTR_FILLABLEFIELD.FF_CHECKED_VALUE?"setCheckedValue":"setUncheckedValue";var i=u.getFillableFieldType(),n=!1,o=e!==u.isChecked();if(o){var r=u[ATTR_FILLABLEFIELD.FF_NAME],a=u.id,s=editor.getDocument();s.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(o){o&&o.getFillableFieldType()===FILLABLEFIELD_TYPE[i.toUpperCase()]&&o[ATTR_FILLABLEFIELD.FF_NAME]&&o[ATTR_FILLABLEFIELD.FF_NAME]===r&&(o[t](e),o.id===a&&(n=!0))}),!n&&u[t](e)}return o},Pt=function(){s.showSubPanel(t.INSERTFILLABLEFIELDS,ANIMATIONS.FADEIN)},Ct=function(e){var i=(e||{}).operation;T=e.ui_options,"leftPanelOpen"===i&&s.showSubPanel(t.INSERTFILLABLEFIELDS,ANIMATIONS.FADEIN),FormulaUIUtil.initFormula("fillable-formula-menu",FormulaHandler.getAllFormulaFieldsWithLabel(!1)),pt(i)},yt=function(){oe.hide();var e=ne[0].querySelectorAll(".ui-validation-error");e.length&&e.forEach(function(e){e.classList.remove("ui-validation-error")})},Ft=function(e){if(e){var t=250,i=J.i18n("writer.common.MAXIMUM_CHARS_ALLOWED",[t]);e.classList.remove("ui-validation-error"),W.get("#ff-validation-error-msg").text(i).hide();var n=e.value,o=n.length;o===t&&(e.classList.add("ui-validation-error"),i=J.i18n("writer.common.MAXIMUM_CHARS_ALLOWED",[t]),W.get("#ff-validation-error-msg").text(i).show())}},Mt=function(e){if(e){var t=250,i=J.i18n("writer.common.MAXIMUM_CHARS_ALLOWED",[t]);e.classList.remove("ui-validation-error"),W.get("#ff-validation-error-msg").text(i).hide()}},wt=function(){n.publish("Fields/ShowPanel")},Ut=function(e){var t=u.getFillableFieldType();if(t!=FILLABLEFIELD_TYPE.CURRENCY&&t!=FILLABLEFIELD_TYPE.NUMBER&&t!=FILLABLEFIELD_TYPE.PERCENT&&t!=FILLABLEFIELD_TYPE.PHONE&&t!=FILLABLEFIELD_TYPE.EMAIL)return!0;var i=FieldPreFillHandler.getPrefillModel().replaceFieldsInString(e,""),n=Oe(u,i);return!!n||(B.hide(),x.hide(),t==FILLABLEFIELD_TYPE.EMAIL?x.show():B.show(),!1)},xt=function(){var e=editor.doc.docInfo.TEMPLATE_SETTINGS;if(e=e&&e.fill){f=e.onsubmit.prefill_info;var t=f&&f.field_map[u.getId()]||"",i=FieldPreFillHandler.getPrefillModel(),n=u.getFillableFieldType(),o=!1;return n==FILLABLEFIELD_TYPE.CHECKBOX?(t=""==t?{}:t,t.checked_value=i.replaceIdsWithNames(t.checked_value),t.unchecked_value=i.replaceIdsWithNames(t.unchecked_value),t.value=i.replaceIdsWithNames(t.value),o=!0):ce&&(t=""==t?{}:t,t.value=i.replaceIdsWithNames(t.value),t.field_value=i.replaceIdsWithNames(t.field_value),o=!0),n==FILLABLEFIELD_TYPE.SELECTBOX||o?t:i.replaceIdsWithNames(t)}},Bt=function(e,t){f||(f={},f.field_map={})," "==e&&(e="");var i=t||u,n=f.field_map[i.getId()],o="object"==typeof e?!ZWJSONUtils.compareJSON(e,n):e!==n;if(o&&Ut(e)){var r=i.getName(),a=editor.getDocument(),s=i.getFillableFieldType(),l=s==FILLABLEFIELD_TYPE.SELECTBOX,d=s==FILLABLEFIELD_TYPE.CHECKBOX;"object"!=typeof e&&(e=FieldPreFillHandler.getPrefillModel().replaceNamesWithIds(e));var c=editor.doc.docInfo.TEMPLATE_SETTINGS.fill;c||(c=FillAutomationHandler.getDefaultTemplateSettings()),c.onsubmit.prefill_info||(c.onsubmit.prefill_info={});var p=l?i.getSelectedIndex():d?i.isChecked():i.getValue();return a.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(t){if(t&&t.getFillableFieldType()===FILLABLEFIELD_TYPE[s.toUpperCase()]&&t.getName()&&t.getName()===r){if(ce&&t.getId()!=i.getId())return;f.field_map[t.getId()]=e,c.onsubmit.prefill_info.field_map=f.field_map;var n=0;l&&"fixed"==e.type&&(n=e.idx!=-1?0:-1),l?t.setSelectedIndex(n):d?t.setChecked(p):t.setValue(p)}}),c.onsubmit.prefill_info.field_map=f.field_map,FillAutomationHandler.storeFillSettings(c,{},function(){FieldPreFillHandler.updateFillableFieldDetails(null,u)}),!0}},Ht=function(e,t){var i=f&&f.field_map&&f.field_map[u.getId()]||{};return i=ZWJSONUtils.clone(i),e==ATTR_FILLABLEFIELD.FF_CHECKED?(null==t?(i.checked="",re.enable()):(i.checked=t?"true":"false",re.disable()),Bt(i)):("undefined"==typeof i.checked&&(i.checked="false"),t=FieldPreFillHandler.getPrefillModel().replaceNamesWithIds(t),e==ATTR_FILLABLEFIELD.FF_CHECKED_VALUE?i.checked_value=t:e==ATTR_FILLABLEFIELD.FF_UNCHECKED_VALUE&&(i.unchecked_value=t),i.value=re.val(),i.value&&(i.value=FieldPreFillHandler.getPrefillModel().replaceNamesWithIds(i.value)),Bt(i))},Jt=function(e,t){var i=f&&f.field_map||{};f||(f={},f.field_map={});var n,o,r={},a=!1;editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){e.getFillableFieldType()==u.getFillableFieldType()&&e.getName()==u.getName()&&(r[e.getValue()]=e)});var s=FieldPreFillHandler.getPrefillModel(),l=re.val();if(l&&(l=s.replaceNamesWithIds(l)),"prefill_value"==e)return Object.keys(r).forEach(function(e){var t=r[e];t.getName()==u.getName()&&t.getId()!=u.getId()&&(i[t.getId()].value=l)}),f.field_map=i,o=ZWJSONUtils.clone(i[u.getId()]||{}),o.checked=o.checked||"false",o.field_value=o.field_value||"",o.value=l,Bt(o);if(e==ATTR_FILLABLEFIELD.FF_CHECKED)return n=r[t],o=ZWJSONUtils.clone(i[n.getId()]||{}),o.checked="true"==o.checked?"false":"true",o.field_value=o.field_value||"",o.value=l,a="true"==o.checked,Object.keys(r).forEach(function(e){var t=r[e];t.getFillableFieldType()==FILLABLEFIELD_TYPE.RADIO&&t.getName()==n.getName()&&t.getId()!=n.getId()?i[t.getId()].checked="false":t.getFillableFieldType()==FILLABLEFIELD_TYPE.MULTIPLECHOICE&&(a=a||"true"==i[t.getId()].checked)}),f.field_map=i,re[a?"disable":"enable"](),Bt(o,n);for(var d=ne[0].querySelectorAll(pe.SLCT_CHOICE),c=d.length,p=[],g=0;g<c;g++)if(d[g].value){d[g].classList.remove("ui-validation-error"),p[g]=d[g].value;var E=J(d[g]).data("val");n=r[E],o=ZWJSONUtils.clone(i[n.getId()]||{});var T=o.field_value;if(p[g]=s.replaceNamesWithIds(p[g]),T!=p[g]){o.field_value=p[g];break}}return o.checked=o.checked||"false",o.value=l,Bt(o,n)},Gt=function(e){var t=f&&f.field_map&&f.field_map[u.getId()]||{};if(t=ZWJSONUtils.clone(t),t.type=G.find("#ff-select-datasrc-container").find(".ui-tab-with-radio.is-selected").is(".ui-tab-with-radio:first")?"fixed":"dynamic",t.idx=G.find("#fixed-list").find(".is-selected").eq(0).parents(".prefill-select-option").attr("order-id"),t.idx="undefined"==typeof t.idx?-1:parseInt(t.idx),t.list=[],"fixed"==t.type&&G.find("#fixed-list").find(".select-choice").each(function(e,i){var n=i.value;n&&(j.hide(),n=FieldPreFillHandler.getPrefillModel().replaceNamesWithIds(n),t.list.push(n))}),t.value=re.val(),t.value&&(t.value=FieldPreFillHandler.getPrefillModel().replaceNamesWithIds(t.value)),re["fixed"==t.type&&t.idx!=-1?"disable":"enable"](),"dynamic"==t.type){var i=G.find("#dynamic-list").find("#ff-select-dynamic-options").val();t.list=FieldPreFillHandler.getPrefillModel().replaceNamesWithIds(i)}return Bt(t)},kt=function(){xt();var e=f&&f.field_map&&f.field_map[u.getId()]?f.field_map[u.getId()]:FieldPreFillHandler.getDefaultDropdownInfo(u),t=G.find("#ff-datasrc-select-cont"),i=t.children().eq(0).detach();if(t.html(""),("fixed"==e.type?e.list:[""]).forEach(function(n,o){var r=i.clone(),a="ff-datasrc-option-"+o;n=FieldPreFillHandler.getPrefillModel().replaceIdsWithNames(n),r.find(".select-choice").attr("id",a).val(n),r.find(".js-prefill-sbox-remove")[1==e.list.length?"hide":"show"]();var s=JSON.parse(r.find(".js-mm-field-choose").attr("mm-zmenu-data"));s.target="#"+a,r.find(".js-mm-field-choose").attr("mm-zmenu-data",JSON.stringify(s)),r.attr("order-id",o),t.append(r)}),t.find(".zbutton").removeClass("is-selected"),e.idx>=0&&t.find(".zbutton").eq(e.idx).addClass("is-selected"),"string"==typeof e.list){var n=e.list;n=FieldPreFillHandler.getPrefillModel().replaceIdsWithNames(n),G.find("#ff-select-dynamic-options").val(n)}var o="";e.value&&(o=FieldPreFillHandler.getPrefillModel().replaceIdsWithNames(e.value)),re.val(o),G.find(".ui-tab-with-radio").eq("fixed"==e.type?0:1).click()},Wt=function(){var e=G.find("#ff-datasrc-select-cont"),t=e.children().eq(0),i=t.clone(),n=e.children().length,o="ff-datasrc-option-"+n;i.find(".select-choice").attr("id",o).val("");var r=JSON.parse(i.find(".js-mm-field-choose").attr("mm-zmenu-data"));r.target="#"+o,i.find(".js-mm-field-choose").attr("mm-zmenu-data",JSON.stringify(r)),i.attr("order-id",n),i.find(".zbutton").removeClass("is-selected"),e.append(i),e.find(".prefill-select-option").each(function(e,t){J(t).find(".js-prefill-sbox-remove").show()}),J("#field-properties").ZCtrackObjects("initEvents",J(i),void 0,!0),i[0].scrollIntoView()},Yt=function(e){var t=J(e),i=t.parents("#ff-datasrc-select-cont"),n=i.find(".prefill-select-option").length,o=[];1!=n&&(t.parents(".prefill-select-option").remove(),n=i.find(".prefill-select-option").length,i.find(".prefill-select-option").each(function(e,t){var i=J(t);i.attr("order-id",e);var r="ff-datasrc-option-"+e;i.find(".select-choice").attr("id",r);var a=JSON.parse(i.find(".js-mm-field-choose").attr("mm-zmenu-data"));a.target="#"+r,i.find(".js-mm-field-choose").attr("mm-zmenu-data",JSON.stringify(a)),i.find(".js-prefill-sbox-remove")[1==n?"hide":"show"](),o.push(i.find(".select-choice").val())}),o.join("").trim().length&&Re(ATTR_FILLABLEFIELD.FF_LIST,""))},zt=function(e){e||(e=event.target);var t=parseInt(J(e).parents(".prefill-select-option").attr("order-id"))||-1,i=f&&f.field_map&&f.field_map[u.getId()]||{};t==i.idx?J(e).parent().removeClass("is-selected"):J(e).parent().addClass("is-selected"),Re(ATTR_FILLABLEFIELD.FF_LIST)};return n.subscribe("Document/LanguageChanged",function(){gt()}),n.subscribeOnce("Cursor/Collapsed",function(){editor.doc.getSelection().bind(NODE_TYPE.FILLABLEFIELD,{onSelect:FillableFieldsPanel.showFillableFieldPopup,onDeselect:FillableFieldsPanel.hideFillableFieldPopUp}),n.subscribe("Cursor/SectionChanged",function(){if(Macros.isPDFDocument()){var e=editor.doc.getSelection().getLastRange(),t=DocTreeManager.doc.getSection(e.start).getSectionType();t===SECTION_TYPES.TEXTBOX?EditorUtil.allowTypingOnKeypress(!0):editor.getRole().permissions.can("document.edit")&&EditorUtil.allowTypingOnKeypress(!1)}})}),n.subscribe("FillableField/hideFillableFieldPopUp",Et),n.subscribe("FillableField/hideFillableFieldPopUp",ft),n.subscribe("Document/fillableResize",ht),n.subscribe("Prefill/DatasourceAdded",function(e){ue=!0;var t=e||E;t&&MailMergeDataModel.isDataAvailable()&&(Z("ff-csvname").text(MailMergeDataModel.getFileName()||t.info.filename),Z("ff-source-text").show(),Z("ff-data-source-add-btn").hide(),Z("ff-data-source-option").show(),Z("ff-data-filter-btn").show()[t.filter_data?"addClass":"removeClass"]("is-active"),FieldPreFillHandler.setSourceFileLink(Z("ff-csvname"))),E=t,G&&G.length&&(G.find(".js-mm-field-choose").show(),G.find("#ff-date-picker,#ff-insert-img-btn").hide(),u&&(u.getFillableFieldType()==FILLABLEFIELD_TYPE.SELECTBOX&&(G.find("#select-container,#ff-select-addoption,#ff-date-picker,#ff-insert-img-btn").hide(),G.find("#ff-select-datasrc-container").show(),kt()),FieldPreFillHandler.modifyFieldsMenu(G,u)))}),n.subscribe("Prefill/DatasourceRemoved",function(e){ue=!1,G&&G.length&&(G.find(".js-mm-field-choose").hide(),G.find("#select-container,#ff-select-addoption,#ff-date-picker,#ff-insert-img-btn").show(),G.find("#ff-select-datasrc-container").hide()),Z("ff-csvname").text(J.i18n("writer.editor.MAILMERGE.NO_DATASOURCE_AVAILABLE")),Z("ff-data-source-add-btn").show(),Z("ff-source-text").hide(),Z("ff-data-source-option").hide(),Z("ff-data-filter-btn").hide().removeClass("is-active"),FieldPreFillHandler.setSourceFileLink(Z("ff-csvname")),E=null}),E=docProps.MM_DETAILS,{refreshValues:xe,open:we,close:Ue,toggleFormsOptions:Je,reorderOptions:qe,openDateTimePicker:We,updateSelectDemo:je,toggleDisable:Ye,toggleChecked:Ze,toggleMandatory:Ve,setSelectedOption:ze,suggestTagNames:Xe,selectOptionAdd:ye,selectOptionRemove:Fe,showFieldPanel:st,showFillableFieldPopup:gt,hideFillableFieldPopUp:Et,insertImage:Qe,insertSign:tt,removeSign:it,setLabel:ot,fetchPanels:pt,openFromMicroToolbar:mt,leftPanelOnBeforeLoad:Pt,setOptionsForRadioFields:At,removeRadioFieldOptions:St,addRadioFieldOptions:Ot,fillableFieldPanelAfterLoad:Ct,handleFieldsBackBtn:wt,checkMaxCharCount:Ft,removeValidErrorMsg:Mt,addPrefillDropdownOption:Wt,removePrefillDropdownOption:Yt,setSelectedPrefillOption:zt,validateFilledValue:Oe}}}(editor.getRole().permissions,ELEM_ID,UIUtils,PubSub,window.LayoutManager,window.EventHandler,ZWLogger,LeftPanel),FillableFieldsHandler=function(e,t,n,o,r,a,s,l,d){"use strict";function c(){var e=encodeURIComponent(JSON.stringify(oe.allFillableFieldsInDoc));return editor.getBaseURL()+"/internal/generatepdf?DOCUMENT_ID="+editor.doc.docInfo.DOCUMENT_ID+"&rid="+editor.doc.rid+"&zuid="+editor.zuid+"&ownerZuid="+editor.doc.docInfo.OWNER_ZUID+"&fillableFieldData="+e}function u(){if(!f)return{};var e=f.getFillInfo(b);if(JSON.stringify(e).length>1e9)return r.addToStatistics("Fillable fields limit exceeded"),t.showMessage("error","Fillable Fields limit exceeded","showclose","normalfont",3e3),{};!b&&(editorProps.available_credits<1||_)&&(e.is_test_submission=!0);for(var i in e)D.contains(i);return D.length>10?(t.showMessage("error",J.i18n("writer.common.MAXIMUM_IMAGES_REACHED",[10]),"showclose","normalfont",3e3),{}):e}var p,g,f,E,T,m,h=!1,I=!1,_=!1,A=!1,S=!1,R=!1,O=!0,b=!1,v=!1,D=[],L=[],N=!1,P={},C={SELECT_OPTION:J.i18n("writer.common.SELECT"),ERROR_MSG:{NUMBER:J.i18n("writer.fillablefields.ONLY_NUMBERS_ALLOWED"),EMAIL:J.i18n("writer.common.PLEASE_ENTER_A_VALID_EMAIL_ADDRESS"),CHAR:J.i18n("writer.fillablefields.CHAR_ERROR")}},y={VALUE:1,NAME:2,SIZE:3,CROPRECT:4,CHECKED_VALUES:5,RESULT:6},F=function(){var e=editorProps.permissionsInfo.permissions;p=editorProps.userInfo.role,A=e.indexOf("document.edit")!==-1,S=e.indexOf("document.fill")!==-1,!A&&S&&(I=!0),b=!!editorProps.options.REMOTE&&editorProps.isPublishToFill,h=USER_ROLE.PUBLIC===p&&editorProps.isPublishToFill||("SHAREDREAD"===p||"ANYONELINK_SHAREDREAD"===p)&&editorProps.isFillableForm&&editorProps.isPublishToFill||"function"==typeof editor.getView&&editor.getView()===EDITOR_VIEWS.FILLABLEFIELDS_PREVIEW||b,R="function"==typeof editor.getView&&editor.getView()===EDITOR_VIEWS.FILLABLEFIELDS_PREVIEW,v=editorProps.isSelfSubmit};F();var g,f,E,M,w={ids:[],fieldNos:[],currentFieldIdx:0},U=J.i18n("writer.fillablefields.NO_CREDITS_MSG"),x=J.i18n("writer.fillablefields.MANDATORY_FIELDS_NOT_FILLED"),B=J.i18n("writer.fillablefields.SUBMIT_DISABLED_MSG",["<center>","</center>","<center>","</center>"]),H=function(){document.addEventListener("keydown",G,!1),J("#editorpane").on("click",".fillablefield",function(t,i){var n="ui-fillable-popover-invisible-anim";J(".ffield-selected").length>0&&(n="ui-fillable-popover-visible-anim")&&J(".ffield-selected").trigger("dblclick"),f||(f=new FillableFieldsModel),E=J(this);var o,r=E.attr("data-field-id"),a=f.getFieldById(r);r&&!a&&(a=editor.getDocument().getFieldById(r),f.addField(a));a.isFillableImageField()?a:a.getStart();if(g=a,a.isFillableImageField()&&a.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE&&(g=a=editor.getDocument().getFieldById(r)),pe=E,ee(),!i&&le&&le.find("#doc-nav-field-num").text()!=f.getFieldNo(r)&&te(),un(g),!(!a||a[ATTR_FILLABLEFIELD.FF_DISABLED]||a.isFillableImageField()&&a.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_DISABLED])){switch(Ee(),o=a.getFillableFieldType()){case FILLABLEFIELD_TYPE.MULTIPLECHOICE:case FILLABLEFIELD_TYPE.CHECKBOX:return;case FILLABLEFIELD_TYPE.SELECTBOX:z(a,E);break;case FILLABLEFIELD_TYPE.RADIO:E.addClass("fillablefield-checkbox-anim"),setTimeout(function(){E.removeClass("fillablefield-checkbox-anim")},150);break;case FILLABLEFIELD_TYPE.MULTILINE:case FILLABLEFIELD_TYPE.SINGLELINE:default:if(l.init("fill-popover_tooltip"),L.contains(g.getId()))return void fn(J("#ff-fill-input_1_"+g.getId())[0]);if(cn(a),o===FILLABLEFIELD_TYPE.MULTILINE){an(a,document.getElementById("fill-popover-elem"),E,!0),fe.hide(),ge.show();var s=E[0].offsetWidth,d=E[0].offsetHeight;ge.css("width",s),ge.css("height",d),ge[0].focus({preventScroll:!0}),Rn(ge[0],!0)}else if(o===FILLABLEFIELD_TYPE.SINGLELINE||o===FILLABLEFIELD_TYPE.NUMBER||o===FILLABLEFIELD_TYPE.PHONE||o===FILLABLEFIELD_TYPE.EMAIL||o===FILLABLEFIELD_TYPE.PERCENT||o===FILLABLEFIELD_TYPE.CURRENCY){an(a,document.getElementById("fill-popover-elem"),E,!0),ge.hide(),fe.show();var s=E[0].offsetWidth,d=E[0].offsetHeight;fe.css("width",s),fe.css("height",d),fe[0].focus({preventScroll:!0}),Rn(fe[0],!0)}else l.init("fill-popover"),l.init("fill-popover-cont"),Xi.zpopover("open",{target:E[0]});J(".ui-fillable-popover").css("z-index",1e3),o===FILLABLEFIELD_TYPE.SINGLELINE||o===FILLABLEFIELD_TYPE.MULTILINE||o===FILLABLEFIELD_TYPE.NUMBER||o===FILLABLEFIELD_TYPE.PHONE||o===FILLABLEFIELD_TYPE.EMAIL||o===FILLABLEFIELD_TYPE.PERCENT||o===FILLABLEFIELD_TYPE.CURRENCY?(sn(a,o,E),J("#fill-popover_tooltip").zpopover("open",{target:E[0]}),rn(a,o)):dt(a,o),J(".ui-fillable-popover").addClass(n),setTimeout(function(){J(".ui-fillable-popover").removeClass(n)},750)}if(g.isFillableImageField()&&g.getFitType()===IMAGE_FIT_TYPE.FLUID){var c={idx:g.start};c.ev=t,e.publish("Image/Selected",g.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID],c)}M=r}})},G=function(e){if(9===e.keyCode){var t=e.shiftKey;e.preventDefault&&(e.preventDefault(),e.stopImmediatePropagation()),J("#demoSelectBox1").zselectbox("close"),Qi(M);var i=k(t,M),o=i&&editor.jeditorPane.find("[data-field-id="+i+"]")[0]||document.querySelector(".fillablefield"),r=J(o);return n.scrollElementIntoView(o,0,!0),o.classList.contains("fillablefield")&&(r.hasClass("zw-fill-checkbox")?(r.addClass("fillablefield-checkbox-anim"),setTimeout(function(){r.removeClass("fillablefield-checkbox-anim")},150),M=i):setTimeout(function(){r[0].click()},0)),e.preventDefault?(e.preventDefault(),e.stopImmediatePropagation(),!1):void 0}},k=function(e,t){for(var i,n=editor.getDocument(),o=n.getDocumentContent(),r=t&&n.getFieldById(t),a=r&&(r.isFillableImageField()?r.getIndex():r.getStart().start),s=a+(e?0:1)||1;s<o.length&&s!=-1;)if(s=editor.doc[e?"findPreviousIndexOf":"findNextIndexOf"](UNICODE.RANGE_START+"|"+UNICODE.IMAGE,s),s!==-1){var l=n.getRawFormatAt(s);if(l&&(l.type===NODE_TYPE.FILLABLEFIELD||(l.cls||"").indexOf(NODE_TYPE.FILLABLEFIELD)!==-1)&&!l[ATTR_FILLABLEFIELD.FF_DISABLED]&&!l[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_DISABLED]){i=l.type===NODE_TYPE.IMAGE?l.ffInfo.id:l.id;break}s=e?s:s+1}else s=e?o.length-1:1;if(s!==-1)return i},Y=function(){J("#editorpane").on("click",".zw-fill-checkbox",function(e,t){E=J(this);var i={id:1};if(at.find("#fill-popover_1_"+i.id).length||gn(at,i,!0),E.attr("data-field-id")){if(E.addClass("fillablefield-checkbox-anim"),h){f||(f=new FillableFieldsModel),Ee();var n=E.attr("data-field-id"),o=f.getFieldById(n);n&&!o&&(o=editor.getDocument().getFieldById(n),f.addField(o));var r=o.isFillableImageField()?o:o.getStart();g=o,!t&&le&&le.find("#doc-nav-field-num").text()!=f.getFieldNo(n)&&te()}else var a=editor.getDocument().getSelection().getRangeAt(0),r=a.getStartNode(),o=r.type===NODE_TYPE.FIELD_START&&r.getField(),n=g.getId();var s=o.type===NODE_TYPE.FILLABLEFIELD&&o.getFillableFieldType();if(!(s!==FILLABLEFIELD_TYPE.CHECKBOX&&s!==FILLABLEFIELD_TYPE.MULTIPLECHOICE&&s!==FILLABLEFIELD_TYPE.RADIO||o[ATTR_FILLABLEFIELD.FF_DISABLED])){if(s===FILLABLEFIELD_TYPE.RADIO)return mn(o,E),void(M=n);var l=o.isChecked();setTimeout(function(){E.removeClass("fillablefield-checkbox-anim"),h?Mt(!l):ie(o,!l)},150),M=n}}})};(I||h)&&(Y(),e.subscribe("Document/LoadingComplete",function(){editor.doc.setApplyConditionsForFillableFields(!0),editor.jeditorPaneWrapper.append(Z("popup-menu-container")[0]),h&&yi(),!R&&h&&J("#fill_insert_image").off("zmenuitemclick").on("zmenuitemclick",function(e,i){t._itemClicked(e,i)}),J("#documentmapzdialog").detach().insertBefore("#ui-editor-outer-div")})),h&&(H(),J(document).on("click","div.zw-page",function(){!J(".ui-fillable-popover").is(":visible")&&J(".ffield-selected").length>0&&J(".ffield-selected").trigger("dblclick")}),e.subscribe("Document/LoadingComplete",function(){b||editorProps.isFillAddonPurchased&&!(editorProps.available_credits<1)||(v=!1);var e=/publish|resume/;v||!A||e.test(window.location.href)||(_=!0),!b&&editorProps.available_credits<1&&!_&&(ZAlertBanner.show({message:U,type:"error",isMessageHTMLEncoded:!1,closeButton:!0}),J("#ff-publish-submit-btn,#ff-submitactions-download,#ff-submitactions-email-attachment,#ff-submitactions-sign-send,#ff-publish-action-btn,#ff-publish-list-opt-download,#ff-publish-list-opt-email").disable(),O=!1),J("#ff_save_draft_btn,#ff-publish-list-save-draft")[editorProps.isFillAddonPurchased?"enable":"disable"](),!b&&J("#ff_save_draft_btn,#ff-publish-list-save-draft")[_?"hide":"show"](),J("#topband-test-mode")[_?"show":"hide"](),J("#ff-test-mode-cont")[editorProps.available_credits<1||!_?"hide":"show"](),editorProps.isFillAddonPurchased||_||b||(ZAlertBanner.show({message:B,type:"error",isMessageHTMLEncoded:!0,closeButton:!0}),J("#ff-publish-submit-btn,#ff-publish-action-btn,#ff-publish-list-opt-download,#ff-publish-list-opt-email").disable(),O=!1),r.addToStatistics("Published document with fillable fields accessed");var t=window.location.pathname;if(t.indexOf("resume/")!=-1&&ni(),Si(),_){var i=editor.getDocument();i.addWatermark("text",{content:"SAMPLE"}),i.applyChanges()}J("#fill-popover-elem")[0].style.display="block";var n=b?{}:PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),o=n&&n.ui_options;!editorProps.isEmbed&&!editorProps.browserInfo.is_handheld&&(!o||"show"==o.field_navigation_panel)&&FillableFieldsHandler.showFieldNavigation(),v&&J("#public-topband-info").hide()}));var z=function(e,t){var i,o=e.getList(),r=[];g=e,r.push({label:"--"+C.SELECT_OPTION+"--",value:"--"+C.SELECT_OPTION+"--"});for(var a=0,s=o.length;a<s;a++)r.push({label:o[a],value:o[a]});var l=J("#demoSelectBox1");l.length?(l.zselectbox("setAttribute","dataSource",r),l.zselectbox("setAttribute","selectedIndex",e.getSelectedIndex()+1)):(d.createSelectbox({appendTo:"body",id:"demoSelectBox1",className:"ui-editor-selectbox",dropdownList:{className:"ui-editor-selectbox-dropdown",appendTo:"#editorpane",height:"auto"},dataSource:r,selectedIndex:e.getSelectedIndex()+1,beforedropdownlistopen:function(e,t){J("#demoSelectBox1Menu").css({"min-width":(i||150)+"px",width:"auto","max-width":"400px"})},change:function(e,t){h?Mt(t.selectedIndex-1):ie(g,t.selectedIndex-1),n.stopEvent(e)}}),l=J("#demoSelectBox1"));var c=J("#demoSelectBox1Container");V("div#demoSelectBox1Container"),c.hide(),i=parseInt(c.css("width"))+15,l.zselectbox("open")},V=function(e){var t=E.offset(),i=E.height();J(e).css({"z-index":10,"min-width":150,display:"block",position:"absolute",top:t.top,left:t.left,height:i,width:E.width()})},j=function(){var e,t,i,o=function(t){if(!event.currentTarget||""==event.currentTarget.id&&J(event.currentTarget).parents("div#zwdatetimepicker").length||"zwdatetimepicker"===event.currentTarget.id){var o=i.getFormat(),r=Utils.convertDate(t,o.replaceAll("y","Y").replaceAll("d ","D "));Ce.val(r);var a=Date.parse(t);h?Mt(a):ie(i,a),n.stopEvent(event),e.hide()}},r=function(){e.zdatetimepicker({showAnim:"slideDown",changeMonth:!0,changeYear:!0,clearButton:!0,immediateCommit:!1,format:"MM / dd / yyyy, hh: mm tt",value:t,dateselect:function(e,t){var n=t.selectedDate;Date.parse(n)!=i.getValue()&&o(n)},change:function(e,i){var n=i.valueString;n!=t&&o(n)},clear:function(e,t){h?Mt(" "):ie(i," ")}}),e.bind("click",function(e){n.stopEvent(e)})},a=function(e){var t=" "===e?new Date:new Date(e),i=t.getMinutes()+"";return 1==i.length&&(i="0"+i),t=t.dateFormat("m / d / Y, h: m a"),t=t.split(" "),t[6]=i,t=t.join(" ").toUpperCase()};return function(n){e=Z("zwdatetimepicker"),t=a(n.getValue()).toUpperCase(),i=n,0===e.length?(e=J("<div>").attr({id:"zwdatetimepicker"}).addClass("ui-editor-datefield").appendTo("#ff-datepicker-cont"),r()):e.zdatetimepicker("setAttribute","value",t),e.show(),e.find(".cancelButton-zdatetimepicker").hide()}}(),X=function(e,t){var i=Numeral.getThousandAndDecimalSeperator(e),n=t.split(i.decimal);return n[0].replaceAll("["+i.thousands+"]",",")+(n[1]?"."+n[1]:"")},K=function(e,t){var i,n=e.getFillableFieldType(),o=!1,r=t!==e.getValue();if(r){var a=e.isFillableImageField()?e.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_NAME]:e[ATTR_FILLABLEFIELD.FF_NAME],s=e.id,l=editor.getDocument();!!a&&l.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){i=e.isFillableImageField()?e.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_NAME]:e[ATTR_FILLABLEFIELD.FF_NAME],e&&e.getFillableFieldType()===FILLABLEFIELD_TYPE[n.toUpperCase()]&&i&&i===a&&(e.setValue(t),e.id===s&&(o=!0))}),!o&&e.setValue(t)}return r},q=function(e,t){var i=e.getFillableFieldType(),n=!1,o=!0;if(o){var r=e.getName(),a=e.getId(),s=editor.getDocument();!!r&&s.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){if(e&&e.getFillableFieldType()===FILLABLEFIELD_TYPE[i.toUpperCase()]&&e.getName()&&e.getName()===r){e.setValue(t.src);var o=e.getSize();if(e.setFormats({wid:o.wid,ht:o.ht,orginalHt:t.originalHt,orginalWid:t.originalWid}),e.getFitType()==IMAGE_FIT_TYPE.FIXED){var s=pt(e.rawFormat);e.style.cropRect=s[ATTR_IMAGE.I_CROPRECT],e.style.img_fit="cropFit"}e.getId()===a&&(n=!0)}}),!n&&e.setValue(t.src)&&e.setFormats({wid:t.width,ht:t.height})}return o},Q=function(e,t){var i=e.getFillableFieldType(),n=!1,o=t!==e.isChecked();if(o){var r=e[ATTR_FILLABLEFIELD.FF_NAME],a=e.id,s=editor.getDocument();!!r&&s.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){e&&e.getFillableFieldType()===FILLABLEFIELD_TYPE[i.toUpperCase()]&&e[ATTR_FILLABLEFIELD.FF_NAME]&&e[ATTR_FILLABLEFIELD.FF_NAME]===r&&(e.setChecked(t),e.id===a&&(n=!0))}),!n&&e.setChecked(t)}return o},$=function(e,t,i){var n=function(n){var o=n||e;i==ATTR_FILLABLEFIELD.FF_SELECTED_INDEX?o.setSelectedIndex(t):o.setList(t)},o=function(){return i==ATTR_FILLABLEFIELD.FF_SELECTED_INDEX?t!==e.getSelectedIndex():i==ATTR_FILLABLEFIELD.FF_LIST?!ZWJSONUtils.compareJSON(t,e.getList()):void 0},r=o(),a=!1,s=e.getFillableFieldType();if(r){var l=e[ATTR_FILLABLEFIELD.FF_NAME],d=e.id,c=editor.getDocument();!!l&&c.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){e&&e.getFillableFieldType()===FILLABLEFIELD_TYPE[s.toUpperCase()]&&e[ATTR_FILLABLEFIELD.FF_NAME]&&e[ATTR_FILLABLEFIELD.FF_NAME]===l&&(n(e),e.id===d&&(a=!0))}),!a&&n()}return r};I&&Utils.highlightFillableFieldsOnClick();var ee=function(){J(".ui-editor-inputfield,.ui-editor-selectbox").hide(),Z("zwdatetimepicker").hide(),Z("fill-popover").zpopover("close"),J(".ffield-selected").length>0&&J(".ffield-selected").trigger("dblclick")},te=function(){if(ae&&se&&le){if("none"==se.css("display"))return;ae.removeClass("is-active ui-linked-field"),le.find("#doc-nav-field-num").text("0").hide(),le.find("#doc-nav-of").hide()}},ie=function(t,i){var n,o=!1,a=editor.getDocument();if(h&&t.getName())wt(t,i),f.updateAllFieldValues(t.getName(),t.getFillableFieldType(),i,n=t.getId()),o=!0;else switch(t.getFillableFieldType()){case FILLABLEFIELD_TYPE.SELECTBOX:h?(t.setSelectedIndex(i),o=!0):o=$(t,i,ATTR_FILLABLEFIELD.FF_SELECTED_INDEX);break;case FILLABLEFIELD_TYPE.CHECKBOX:o=!0,Q(t,i);break;case FILLABLEFIELD_TYPE.IMAGE:case FILLABLEFIELD_TYPE.SIGNATURE:case FILLABLEFIELD_TYPE.INITIAL:h?t.getName()&&i.src?o=q(t,i):(i.src&&t.setValue(i.src),i.height&&i.width&&t.setFormats({ht:i.height,wid:i.width,orginalHt:i.originalHt,orginalWid:i.originalWid}),t.getFillableFieldType()===FILLABLEFIELD_TYPE.IMAGE&&i.cropRect&&(t.style.cropRect=i.cropRect),o=!0):o=q(t,i);break;case FILLABLEFIELD_TYPE.MULTIPLECHOICE:case FILLABLEFIELD_TYPE.RADIO:o=hn(t,i);break;default:h?("object"!=typeof i?t.setValue(i):i.height&&i.width&&t.setFormats({ht:i.height,wid:i.width}),o=!0):o=K(t,i)}try{o&&(h?ne(function(){e.publish("FillableFieldUpdated",t)}):(a.sync(),e.publish("FillableFieldUpdated",t)))}catch(e){var s=ZWCollaboration.FILLABLE_FIELD_FILL_ERROR;r.log("Exception while filling fillable field: "+e.stack),r.sendErrorDetails(s+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>#\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Error Log End \n <ZWERROR>Exception Stack: "+e.stack,null,s)}ee()},ne=function(e){editor.getDocument().applyChanges(e),re(),Ee(),Tn()},oe={},re=function(){oe.allFillableFieldsInDoc={},oe[FILLABLEFIELD_TYPE.SINGLELINE]={},oe[FILLABLEFIELD_TYPE.MULTILINE]={},oe[FILLABLEFIELD_TYPE.EMAIL]={},oe[FILLABLEFIELD_TYPE.NUMBER]={},oe[FILLABLEFIELD_TYPE.PHONE]={},oe[FILLABLEFIELD_TYPE.PERCENT]={},oe[FILLABLEFIELD_TYPE.DATE]={},oe[FILLABLEFIELD_TYPE.CURRENCY]={},oe[FILLABLEFIELD_TYPE.CHECKBOX]={},oe[FILLABLEFIELD_TYPE.SELECTBOX]={},oe[FILLABLEFIELD_TYPE.IMAGE]={},oe[FILLABLEFIELD_TYPE.SIGNATURE]={},oe[FILLABLEFIELD_TYPE.INITIAL]={},oe[FILLABLEFIELD_TYPE.MULTIPLECHOICE]={},oe[FILLABLEFIELD_TYPE.RADIO]={},oe.fieldPositions={}};re();var ae,se,le,de,ce,ue,pe,ge,fe,Ee=function(){if(!Object.keys(oe.allFillableFieldsInDoc).length){var e=editor.getDocument(),t=1;e.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){if(e){var i=e.getFillableFieldType();oe.allFillableFieldsInDoc[e.getId()]={name:e.getName()||"",value:null,type:i,mandatory:e.isMandatory(),fieldValue:e.getFieldValue()},e.getName()&&oe[i]&&(oe[i][e.getName()]?oe[i][e.getName()].push(e):(oe[i][e.getName()]=[],oe[i][e.getName()].push(e))),oe.fieldPositions[t]=e.isFillableImageField()?e.start:e.getStart().start,t++}})}},Te=function(){if(!Object.keys(oe.allFillableFieldsInDoc).length)for(var e=editor.getDocument(),t=1,i=e.getDocumentContent(),n=Utils.findNextIndexOf(UNICODE.RANGE_START+"|"+UNICODE.IMAGE,1,i);n<i.length&&n!=-1;){var o=e.getRawFormatAt(n);if(o&&(o.type===NODE_TYPE.FILLABLEFIELD||(o.cls||"").indexOf(NODE_TYPE.FILLABLEFIELD)!==-1)){var r=ZWUtils.getDTNodeAt.call(e,n),a=ZWUtils.getZWNode.call(e,r),s=a.type===NODE_TYPE.IMAGE||a.type===NODE_TYPE.TEXTBOX,l=s&&a.isFillableImageField()?a:a.getField();if(l){var d=l.getFillableFieldType();oe.allFillableFieldsInDoc[l.getId()]={name:l.getName()||"",value:null,type:d,mandatory:l.isMandatory(),fieldValue:l.getFieldValue()},l.getName()&&oe[d]&&(oe[d][l.getName()]?oe[d][l.getName()].push(l):(oe[d][l.getName()]=[],oe[d][l.getName()].push(l))),oe.fieldPositions[t]=l.isFillableImageField()?l.start:l.getStart().start,t++}}n=Utils.findNextIndexOf(UNICODE.RANGE_START+"|"+UNICODE.IMAGE,n+1,i)}},me=function(e,t){return e&&oe[t][e].length||0},he=function(e,t){var i=0;return i=Object.keys(oe.allFillableFieldsInDoc).indexOf(e+""),i+1},Ie=function(e){if(e.name){var t=e.getFillableFieldType();oe[t][e.getName()]?oe[t][e.getName()].push(e):(oe[t][e.getName()]=[],oe[t][e.getName()].push(e)),oe.allFillableFieldsInDoc[e.getId()]={name:e.getName(),value:null,type:t,fieldValue:e.getFieldValue()}}},_e=function(e){return Ae.find("#"+e)},Ae=J("#fill-popover-cont"),Se=Ae.find("#ff-linked-count"),Re=Ae.find("#ff-progress-count"),Oe=J("#fillableFieldMap"),be=Ae.find("#ff-help-content"),ve=Ae.find("#ff-fill-enter"),De=Ae.find("#ff-placehldr-label"),Le=J("#headingMap"),Ne=Ae.find("#ff-fill-input"),Pe=Ae.find("#ff-finput-icon"),Ce=Ae.find("#ff-fill-date-input"),ye=Ae.find("#ff-char-count"),Fe=(Ae.find("#ff-datepicker-cont"),Ae.find("#ff-char-errortext-popup,#ff-allowed-chars-popup"),J.i18n("writer.common.CHARACTER")),Me=J.i18n("writer.documentproperty.CHARACTERS"),we=J.i18n("writer.common.LEFT"),Ue=J.i18n("writer.common.UNLABELLED_FIELD"),xe=Ae.find("#ff-image-field-beforefill"),Be=Ae.find("#ff-image-field-afterfill"),He=Ae.find("#ff-image-field-props"),Je=J.i18n("writer.common.DIGITS"),Ge=_e("ff-sign-field-props"),ke=_e("ff-sign-field-insert"),We=_e("ff-sign-field-afterfill"),Ye=_e("ff-fill-textarea"),ze=Ae.find(".js-fill-popup-cont,.ui-ff-desc-msg"),Ze=_e("ff-text-field-props"),Ve=Be.find("#ff-image-fit-options"),je=Ae.find("#ff-textArea-enter"),Xe=J("#ff-multiline-field-icon"),Ke=J("#ff-text-field-icon"),qe=J("#ff-field-icon"),Qe=new RegExp(FILLABLEFIELD_TYPE.NUMBER+"|"+FILLABLEFIELD_TYPE.PERCENT+"|"+FILLABLEFIELD_TYPE.PHONE),$e=Ae.find("#ff-chars-left"),et=Ae.find("#ff-digits-left"),tt=W.get("#ffill-label"),it=W.get("#ffill-tooltip"),nt=W.get("#ffill-maxchat-limit"),ot=W.get("#ffill-linked-count"),rt=W.get("#ffill-linked-count-icon"),at=(W.get("#ffill-error-Text"),W.get("#error-msg"),W.get("#ffill-error-popover"),W.get("#ffill-props")),st={LINKED_FIELDS:J.i18n("common","LINKED_FIELDS"),VALUE:J.i18n("common","VALUE")},lt=function(e,t){var i={};t=t||e.getFillableFieldType(),i.helpText=e[ATTR_FILLABLEFIELD.FF_HELP_TEXT]?e[ATTR_FILLABLEFIELD.FF_HELP_TEXT]+". ":"",i.linkedCount=me(e[ATTR_FILLABLEFIELD.FF_NAME],t)>1?me(e[ATTR_FILLABLEFIELD.FF_NAME],t):"",i.maxLength=e.isFillableImageField()&&e.type!==NODE_TYPE.TEXTBOX?1:e.getMaxLength(),i.progressCount=he(e.id,t)+" / "+Object.keys(oe.allFillableFieldsInDoc).length,i.label=e.getName()||st.VALUE,i.mandatory=e.isMandatory(),""===i.helpText&&(i.helpText=J.i18n("writer.common.VALUE_PLACEHOLDER"));var n=e.getFillableFieldResult().trim(),o="";if(t===FILLABLEFIELD_TYPE.CURRENCY){var r=e.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_CURRENCY_SYMBOL],a=new RegExp("[,"+r+"]","g");o=n.replace(a,"");var s=Utils.getCurrencyOptions(e.getLocale(),e.getCurrencyCode());i.helpText+=" "+J.i18n("writer.common.MAX_DECIMAL_PLACES",[s.decimalPlaces+""])+"."}else o=t===FILLABLEFIELD_TYPE.PERCENT?n.split("%")[0]:n;if(i.value=o,i.fieldIconClass=mt(t),FILLABLEFIELD_TYPE.IMAGE==t){var l=e.style;e.getSize();i.fitType=l.img_fit||"cropFit"}return i},dt=function(t,i){var n=lt(t,i);if(Se.eq(0).find("#ff-lcount-text")[0].innerText=n.linkedCount,n.linkedCount?Se.show():Se.hide(),Re.eq(0).find("#ff-pcount-text")[0].innerText=n.progressCount,be[0].innerText=n.helpText,De[0].innerText=n.label,qe.show(),Ke.hide(),Xe.hide(),W.get(".ui-fillable-popover").removeClass("ui-fillable-popover-imgcont"),ze.hide(),Ce.length&&de||(Ce=Ae.find("#ff-fill-date-input"),de=Ae.find("#ff-fill-date-input_zdatetimefield")),i==FILLABLEFIELD_TYPE.DATE)Ne.hide(),Ce.show(),be.hide(),ye.hide(),de.show(),ve.hide(),je.hide(),Ce.off("zdatetimefieldpickerclose").on("zdatetimefieldpickerclose",yt),Ce.zdatetimefield("setAttribute","format",t.getFormat()),Ce.zdatetimefield("setValue",n.value),j(t),Ce.val(t.getFillableFieldResult().trim());else if(i==FILLABLEFIELD_TYPE.IMAGE){if(He.show(),""===n.value)xe.show(),Be.hide();else if(xe.hide(),Be.show(),t.getFitType()==IMAGE_FIT_TYPE.FLUID)Ve.hide(),W.get(".ui-fillable-popover").addClass("ui-fillable-popover-imgcont");else if(Ve.show()&&J("input[name=imagefit][value="+n.fitType+"]").trigger("click",!0),"crop"===n.fitType){var o={idx:t.start};e.publish("Image/Selected",t.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID],o),TransformHandler.showCrop()}(!R&&h||b||"ANYONEWITHLINK"!==editor.getEditorType())&&(W.get("#fill-insertimage-external").hide(),W.get("#fill-img-insert-sep").hide())}else if(FILLABLEFIELD_TYPE.SIGNATURE==i||FILLABLEFIELD_TYPE.INITIAL==i)if(""===n.value)if(h)Ge.show(),ke.show(),We.hide();else{var r=ZSignController.getSignDetails({type:i,callBack:ct});ct(r.zohoSignSrc&&r.zohoInitialSrc?{type:i,signDetails:r}:{type:i,signDetails:r})}else Ge.show(),ke.hide(),We.show();else Ze.show(),ve.show(),Ce.hide(),ye.show(),de.hide(),FILLABLEFIELD_TYPE.SINGLELINE==i||i===FILLABLEFIELD_TYPE.MULTILINE?(Ne.hide(),Ye.show(),qe.hide(),i===FILLABLEFIELD_TYPE.MULTILINE?(je.show(),ve.hide(),Xe.show()):Ke.show(),Ye.val(n.value),en(Ye[0]),Ye.attr("maxlength",n.maxLength)[0].focus({preventScroll:!0}),At("tarea",n.maxLength)):(Ye.hide(),Ne.show(),Ne.val(n.value),Ne.attr("maxlength",n.maxLength)[0].focus({preventScroll:!0}),At(null,n.maxLength));h&&(be.hide(),Re.hide()),Pe[0].classList.remove("ui-sprit-fast","ui-sprit-lazy","ui-icon-fillablefield-stxt-sm","ui-icon-fillablefield-currency-sm","ui-icon-fillablefield-percentage-sm","ui-icon-fillablefield-phone-sm","ui-icon-fillablefield-number-sm","ui-icon-mail-sm","ui-icon-calendar-sm","ui-mouse-cursor","ui-icon-signerfield-sign-sm","ui-icon-signerfield-initial-sm","ui-icon-picture-sm","ui-icon-fillablefield-mline-sm"),n.fieldIconClass.split(" ").forEach(function(e){Pe[0].classList.add(e)}),$e[Qe.test(i)?"hide":"show"](),et[Qe.test(i)?"show":"hide"]()},ct=function(e){var t=e.signDetails,i=e.type;if(e.failure)return Ge.show(),ke.show(),void We.hide();if(t.zohoSignSrc&&t.zohoInitialSrc){ke.hide();var n=i==FILLABLEFIELD_TYPE.INITIAL?t.zohoInitialSrc:t.zohoSignSrc;Ri(i,{URL:n,WIDTH:i==FILLABLEFIELD_TYPE.INITIAL?50:300,HEIGHT:50}),Ni()}},ut=function(e){var t=e.orginalHt||e.ht,i=e.orginalWid||e.wid,n=ZWImageUtils.calculateAspectRatio(i,t),o=0,r=0;if(n<0&&(n=ZWImageUtils.calculateAspectRatio(e.orginalHt,e.orginalWid)),e.wid>e.ht){var i=e.wid,t=i/n;t<e.ht&&(t=e.ht,i=t*n)}else{var t=e.ht,i=t*n;i<=e.wid&&(i=e.wid,t=i/n)}o=(e.wid-i)/2,r=(e.ht-t)/2;var a=(ZWImageUtils.getOrginalHeighWidthOfImage(e),{cropTop:Math.abs(r),cropBottom:Math.abs(r),cropLeft:Math.abs(o),cropRight:Math.abs(o)});return a=ZWImageUtils.convertCropDataToPercentage(a,t,i),e[ATTR_IMAGE.I_CROPRECT]=a,e.ht_un=e.wid_un="px",e},pt=function(e){var t=e.orginalHt||e.ht,i=e.orginalWid||e.wid,n=ZWImageUtils.calculateAspectRatio(i,t),o=0,r=0;if(n<0&&(n=ZWImageUtils.calculateAspectRatio(e.orginalHt,e.orginalWid)),e.wid>e.ht){var t=e.ht,i=t*n;i>e.wid&&(i=e.wid,t=i/n)}else{var i=e.wid,t=i/n;t>e.ht&&(t=e.ht,i=t*n)}o=(e.wid-i)/2,r=(e.ht-t)/2;var a=(ZWImageUtils.getOrginalHeighWidthOfImage(e),{cropTop:-r,cropBottom:-r,cropLeft:-o,cropRight:-o});return a=ZWImageUtils.convertCropDataToPercentage(a,t,i),e[ATTR_IMAGE.I_CROPRECT]=a,e.ht_un=e.wid_un="px",e},gt=function(e,t,i,n){var o=Math.min(i/e,n/t);return{width:e*o,height:t*o}},ft=function(e){var t,i,n,o=g.getSize();if("cropFit"==e){t=g.style.originalHeight,i=g.style.originalWidth;var r=(gt(i,t,o.wid,o.ht),pt(g.rawFormat));n=r[ATTR_IMAGE.I_CROPRECT],t=r[ATTR_IMAGE.I_HT],i=r[ATTR_IMAGE.I_WID],g.style.img_fit="cropFit"}else if("crop"==e){var r=ut(g.rawFormat);n=r[ATTR_IMAGE.I_CROPRECT]}else"cropToFill"==e&&(t=o.ht,i=o.wid,n={cropTop:"0.000%",cropBottom:"0.000%",cropLeft:"0.000%",cropRight:"0.000%"},g.style.img_fit="cropToFill");return n},Et=function(t){if("crop"==t){var i={idx:g.start};return e.publish("Image/Selected",g.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID],i),TransformHandler.showCrop(),void(g.style.img_fit="crop")}e.publish("TransformableObject/Deselected","image",g.rawFormat.id);var n=ft(t);g.style.cropRect=n,h?Mt({cropRect:n}):editor.getDocument().sync()};J("input[name=imagefit]").on("click",function(e,t){!t&&Et(e.target.value)});var Tt,mt=function(e){switch(e){case FILLABLEFIELD_TYPE.CURRENCY:return"ui-sprit-lazy ui-icon-fillablefield-currency-sm";case FILLABLEFIELD_TYPE.PHONE:return"ui-sprit-lazy ui-icon-fillablefield-phone-sm";case FILLABLEFIELD_TYPE.PERCENT:return"ui-sprit-lazy ui-icon-fillablefield-percentage-sm";case FILLABLEFIELD_TYPE.NUMBER:return"ui-sprit-lazy ui-icon-fillablefield-number-sm";case FILLABLEFIELD_TYPE.MULTILINE:return"ui-sprit-lazy ui-icon-fillablefield-mline-sm";case FILLABLEFIELD_TYPE.SINGLELINE:return"ui-sprit-lazy ui-icon-fillablefield-stxt-sm";case FILLABLEFIELD_TYPE.EMAIL:return"ui-sprit-fast ui-icon-mail-sm";case FILLABLEFIELD_TYPE.IMAGE:return"ui-sprit-lazy ui-icon-picture-sm";case FILLABLEFIELD_TYPE.SIGNATURE:return"ui-sprit-lazy ui-icon-signerfield-sign-sm";case FILLABLEFIELD_TYPE.INITIAL:return"ui-sprit-lazy ui-icon-signerfield-initial-sm";case FILLABLEFIELD_TYPE.DATE:return"ui-sprit-lazy ui-icon-calendar-sm ui-mouse-cursor";case FILLABLEFIELD_TYPE.CHECKBOX:return"ui-sprit-lazy ui-icon-fillablefield-checkbox-sm";case FILLABLEFIELD_TYPE.SELECTBOX:return"ui-sprit-lazy ui-icon-fillablefield-selectbox-sm";case FILLABLEFIELD_TYPE.RADIO:return"ui-sprit-lazy ui-icon-fillablefield-radio-sm";case FILLABLEFIELD_TYPE.MULTIPLECHOICE:return"ui-sprit-lazy ui-icon-fillablefield-mcheckbox-sm"}},ht=function(e,t,i){var o=oe.fieldPositions["prev"==t?e-1:e+1],r=J(editor.doc.getPortionData(i?o+1:o+2).node),a=editor.doc.getRawFormatAt(o);if(a[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.MULTILINE?r=J(document.querySelector('div[data-field-id="'+a[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]+'"]')):a.hasOwnProperty("wrapType")?r=J(document.querySelector("span[data-field-id='"+a.id+"']")):r.hasClass("zeroSize")&&(r=J(editor.doc.getPortionData(o).node).next()),n.scrollElementIntoView(r[0],0,!0),!h){var s=editor.doc.getSelection(),l=editor.doc.createRange(o,o);s.setSelectionType(I?SEL_KEYBOARD:SEL_MOUSE).removeAllRanges().addRange(l)}r.hasClass("zw-fill-checkbox")?(r.addClass("fillablefield-checkbox-anim"),setTimeout(function(){r.removeClass("fillablefield-checkbox-anim")},150)):r.trigger("click",[!0])},It=function(e){1==e&&(e=Object.keys(oe.allFillableFieldsInDoc).length+1),ht(e,"prev")},_t=function(e,t){e==Object.keys(oe.allFillableFieldsInDoc).length&&(e=0),ht(e,"next",t)},At=function(e,t){var i=e&&"tarea"==e?Ye.val().length:Ne.val().length,n=g.getFillableFieldType(),o=Qe.test(n);if(o){var r=(e&&"tarea"==e?Ye.val():Ne.val()).replaceAll(/\D/,"").length;Ne.attr("maxLength",g.getMaxLength()+(i-r)),i=r}if(h){t||(t=g.getMaxLength()),i=parseInt(t-i);var a=o?Je:1==i?Fe:Me;return a+=" "+we,ye[0].innerText=i,void(i===t&&(E=J(document.querySelector('span[data-field-id="'+g.getId()+'"]')),J("#fill-popover_err_tooltip-"+g.getId()).zpopover("close"),J("#fill-popover_tooltip").zpopover("open",{target:E[0]})))}if(!(i>parseInt(e&&"tarea"==e?Ye.attr("maxLength"):Ne.attr("maxLength")))){var a=o?Je:1==i?Fe:Me;a=a.toLowerCase(),ye[0].innerText=i}},St=function(e){var t=J("#fFieldTemplate").html();if(t){var i=Handlebars.compile(t),n=J(i(e));n[0].setAttribute("id",e.id),n[0].setAttribute("data-ffNavInfo",JSON.stringify(e.fNavInfo)),Oe.append(n),l.initElem(n)}},Rt=function(e,t,i,n,o,r,a){var s={},l=Utils.getFillableFieldTooltip(t)+" "+i,d={};return s.fieldName=e||l||Ue,s.fieldType=t,t!==FILLABLEFIELD_TYPE.RADIO&&t!==FILLABLEFIELD_TYPE.MULTIPLECHOICE||(s.fieldName=a+" ( "+s.fieldName+" )"),s.linkedFieldsCount=me(e,t),s.fieldNo=n,s.isMandatory=r,s.fieldType=t,s.fieldTypeNumber=i,s.id=o,d.fName=e,d.fType=t,d.fieldNo=i,d.fieldCount=n,d.id=o,s.fNavInfo=d,s.iconClass=mt(t),s},Ot=function(){if(Oe.length&&le&&le.length||(Oe=J("#fillableFieldMap"),Le=J("#headingMap"),le=J(".ui-doc-nav-sbox"),se=J("#documentmapzdialog"),!le.find("#doc-nav-field-count").length&&le.find(".zselectbox__selected").append('<span id="doc-nav-fieldcount-cont" class="ui-doc-nav-fieldcount-cont ui-fr ui-right-margin-medium"><span id="doc-nav-field-num">0</span><span id="doc-nav-of" class="ui-doc-nav-sbox-count">'+J.i18n("writer.common.OF")+'</span><span id="doc-nav-field-count">0</span><span id="doc-nav-field-lbl" class="ui-doc-nav-sbox-count ui-txt-lowercase">'+J.i18n("writer.common.FIELDS")+"</span>")),!se||"none"!=se.css("display")){Oe.children().remove();var e={},t=0;for(var i in oe.allFillableFieldsInDoc){var n=oe.allFillableFieldsInDoc[i];null==e[n.type]?e[n.type]=1:n.name||e[n.type]++;var o=Rt(n.name,n.type,e[n.type],++t,i,n.mandatory,n.fieldValue);St(o)}ae=Oe.find(".ui-dov-nav-field");var t=Object.keys(oe.allFillableFieldsInDoc).length;le.find("#doc-nav-field-count").text(t),le.find("#doc-nav-field-num").text("0").hide(),le.find("#doc-nav-of").hide()}},bt=function(){editorProps.isPublishToFill&&a.setState("clean"),a.refreshMap(),J("#documentPaneCombo").zselectbox("setValue","fillablefield"),h&&J("#documentmapzdialog").addClass("ui-doc-nav-fillfields-cont"),ue&&ce||(ce=J("#nav-heading-doc"),ue=J("#nav-heading-field")),ue.show(),ce.hide(),Ee(),Ot(),Le.hide(),Oe.show()},vt=function(e,t){var i,n=Utils.getFillableFieldTooltip(e.classList[1]),o=e.classList.contains(FILLABLEFIELD_TYPE.IMAGE)||e.classList.contains(FILLABLEFIELD_TYPE.INITIAL)||e.classList.contains(FILLABLEFIELD_TYPE.SIGNATURE);ae.removeClass("is-active ui-linked-field"),J(e).addClass("is-active");for(var r=0,a=ae.length;r<a;r++)J(e).find(".fieldnavigation-name").text().indexOf(n)==-1&&ae.eq(r).find(".fieldnavigation-name").text()==J(e).find(".fieldnavigation-name").text()&&ae.eq(r).hasClass(e.classList[1])&&ae.eq(r).addClass("ui-linked-field"),e.id==ae[r].id&&(i=r+1);le.find("#doc-nav-field-num").text(i).show(),le.find("#doc-nav-of").show(),Ee(),!t&&_t(i-1,o)},Dt=function(e,t){if(e&&ae&&(!se||"none"!=se.css("display"))){var i=ae.eq(he(e.isFillableImageField()?e.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]:e.id,e.getFillableFieldType())-1)[0];vt(i,!t)}},Lt=function(){J("#documentPaneCombo").zselectbox("setValue","heading"),ue&&ce&&!le||(ce=J("#nav-heading-doc"),ue=J("#nav-heading-field"),le=J(".ui-doc-nav-sbox")),ue.hide(),ce.show(),le.find("#doc-nav-field-count,#doc-nav-field-lbl,#doc-nav-field-num").hide(),le.find("#doc-nav-of").hide(),h&&le.enable()},Nt=function(e){Ee();var t,i,n=J(e).data().fieldno,o=oe.fieldPositions[n];if(e.classList.contains(FILLABLEFIELD_TYPE.MULTILINE)){var r=editor.doc.getRawFormatAt(o),a=r[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID];t=J(document.querySelectorAll('div[data-field-id="'+a+'"]')[0])}else i=e.classList.contains(FILLABLEFIELD_TYPE.IMAGE)||e.classList.contains(FILLABLEFIELD_TYPE.INITIAL)||e.classList.contains(FILLABLEFIELD_TYPE.SIGNATURE),t=J(editor.doc.getPortionData(i?o+1:o+2).node);J(".ffield-selected").removeClass("ffield-selected"),t.addClass("ffield-selected"),t.attr("title")&&J(document).ztooltip("show",t[0]),t.hasClass("zw-fill-checkbox")&&!J("#ff-highlight-style")[0]&&(t.addClass("fillablefield-checkbox-anim"),setTimeout(function(){t.removeClass("fillablefield-checkbox-anim")},750))},Pt=function(e){!e.classList.contains("is-active")&&J(".ffield-selected").removeClass("ffield-selected")},Ct=function(){var e=Ce.zdatetimefield("getValue");return e=e.dateString!=FILLABLEFIELD_PROPS.DATE_FORMAT&&e.dateObject?e.dateObject.getTime():" "},yt=function(e){if(13===e.keyCode)N=!0;else if(N)return void(N=!1);h?Mt(null,null,N):Ft()},Ft=function(){var e,t=editor.getDocument().getSelection().getRangeAt(0),i=(t.getStartNode(),g),n=i.getFillableFieldType(),o=n==FILLABLEFIELD_TYPE.MULTILINE?ge.val().trim():(i.isFillableImageField()?fValue.src:fe&&fe.val().trim())+""||"";i.getFillableFieldType()===FILLABLEFIELD_TYPE.DATE&&(o=Ct()),o=""===o?" ":o;var r=ln(i,o);if(i.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE&&i.getFillableFieldType()!==FILLABLEFIELD_TYPE.RADIO&&i.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTIPLECHOICE||(e=editor.doc.getTrackChangeDetails(),e&&e.setProcessingTC(!1)),r){ie(i,r),on(i),Tn();var a=n==FILLABLEFIELD_TYPE.MULTILINE?ge[0]:(i.isFillableImageField()?"":fe&&fe[0])||"";Rn(a,!1)}i.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE&&i.getFillableFieldType()!==FILLABLEFIELD_TYPE.RADIO&&i.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTIPLECHOICE||e&&e.setProcessingTC(!0)},Mt=function(e,t,i){if(h||editor.getView()===EDITOR_VIEWS.MAILMERGE_PREVIEW){var n,o=g,r=o.getFillableFieldType(),a=r==FILLABLEFIELD_TYPE.MULTILINE?ge.val().trim():(o.isFillableImageField()?e.src:fe&&fe.val().trim())+""||"";a=""===a?" ":a;var s=ln(o,a,i);if(r===FILLABLEFIELD_TYPE.SELECTBOX||r===FILLABLEFIELD_TYPE.CHECKBOX||o.isFillableImageField()&&o.type!==NODE_TYPE.TEXTBOX||r===FILLABLEFIELD_TYPE.MULTIPLECHOICE||r===FILLABLEFIELD_TYPE.RADIO)s=e;else if(r===FILLABLEFIELD_TYPE.DATE)s=e;else if(r===FILLABLEFIELD_TYPE.RADIO)n=o.getId(),s=e;else if(s===!1)return;(s||r===FILLABLEFIELD_TYPE.CHECKBOX||r===FILLABLEFIELD_TYPE.SELECTBOX||r===FILLABLEFIELD_TYPE.MULTIPLECHOICE)&&(t?f.updateValue(o.getId(),s):ie(o,null!=e?e:s)),ai(!0),ee(),te(),0!=w.currentFieldIdx&&ui.call(w),on(o);var l=r==FILLABLEFIELD_TYPE.MULTILINE?ge[0]:(o.isFillableImageField()?"":fe&&fe[0])||"";Rn(l,!1)}},wt=function(e,t){if(h)for(var i in oe.allFillableFieldsInDoc)oe.allFillableFieldsInDoc[i].name===e.getName()&&(e.type===FILLABLEFIELD_TYPE.IMAGE?t.src&&(oe.allFillableFieldsInDoc[i].value=t.src):e.getFillableFieldType()===FILLABLEFIELD_TYPE.RADIO||e.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTIPLECHOICE?i===e.getId()&&(oe.allFillableFieldsInDoc[i].value=t):oe.allFillableFieldsInDoc[i].value=t)},Ut=function(e){if(O&&(editorProps.isFillAddonPurchased||_)){t.showLoadingMsg(J.i18n("writer.common.GENERATING_PDF"));var i="/writer/jsp/popups/fillmergedownload.jsp",n="?format=pdf",o=new ZWDateTime;Ci(e||"download");n+="&timezone="+ZWTimezone.getOffset(o.getTimezone()),n+="&cookietoken="+editor.uuid+Date.now(),n+="&tcmode="+editor.doc.getTrackChangeDetails().getDisplayMode(),n+="&version_id="+editor.doc.docInfo.VERSION_ID,n+="&operation="+(e||"download"),n+=Macros.getRIdString(),i+=n,Ht(i),t.hideLoadingMsg()}},xt=function(e){var t=Ci(e||"download"),i=new ZWDateTime;return{format:"pdf",timezone:ZWTimezone.getOffset(i.getTimezone()),cookietoken:editor.uuid+Date.now(),fill_merge_data:encodeURIComponent(JSON.stringify(t)),version_id:editor.doc.docInfo.VERSION_ID,tcmode:editor.doc.getTrackChangeDetails().getDisplayMode(),rid:Macros.getRId()}},Bt=function(){if(0==Object.keys(P)){var e=PrepareDocumentHandler.getSequenceNumbers(),t=Object.keys(e),i={};editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){if(e.name){var t=e.name;t=t.replaceAll(" ","_"),i[t]=e.getFillableFieldResult()}});for(var n=0;n<t.length;n++){for(var o=t[n],r=e[o],a=r.prefix||"",s=r.suffix||"",l=/[\$]{([^}]*)}/,d="",c="";a&&a.match(l);)d=a.match(l)[1],c=i[d]||"",a=a.replace("${"+d+"}",c);for(;s&&s.match(l);)d=s.match(l)[1],c=i[d]||"",s=s.replace("${"+d+"}",c);var u=r.value||0,p=r.start_with||"1",g=a+(parseInt(p)+u)+s;P[o]=g}}return P},Ht=function(e){var t=J("#fillmergeIFrame");t.length||(t=J("<iframe>"),t.attr("id","fillmergeIFrame"),t.css({width:0,height:0,position:"absolute",top:"-1000px"}),Jbody.append(t)),t.attr("src",e)},Jt=function(){var e={};h&&(e.isFillableFieldMerge=!0,e.fillableFieldData=u()),editor.doc.applyConditionsForFillableFields()&&(e.applyFillConditions=!0),s.initiatePrint(e)},Gt=function(){var e=function(e){t.showMessage("success","writer.esign.UPLOAD_SUCCESS","showclose","normalfont",3e3);e.requests&&respose.requests.request_id},i=function(e){e.error_msg&&e.error_msg.indexOf("UNKNOWN_USER")!=-1?ZAlertBanner.show({message:J.i18n("writer.common.ZOHO_SIGN_ACCOUNT_NEEDED_MSG",[J.i18n("writer.esign.ZOHOSIGN"),"<center>","</center>"]),type:"error",isMessageHTMLEncoded:!0,closeButton:!0}):t.showMessage("error","writer.esign.UPLOAD_FAILED","showclose","normalfont",3e3)};return function(){var t={},n=editor.doc.docInfo.RID,r=o.getNiceUrlPrefix(n)+"/fillmerge/upload";t.filled_data=JSON.stringify(u()),J.ajax({type:"POST",url:r,data:t,dataType:"json",beforeSend:function(e){o.setCsrfTokenInHeader(e)},success:e,error:i})}}(),kt=function(){var e=function(e){t.hideLoadingMsg(),t.showMessage("info",J.i18n("writer.common.SELF_SIGN_SUCCESS_MSG"),"showclose","normalfont",3e3);e.requests&&e.requests.request_id},i=function(e){t.hideLoadingMsg(),e.error_msg&&e.error_msg.indexOf("UNKNOWN_USER")!=-1?ZAlertBanner.show({message:J.i18n("writer.common.ZOHO_SIGN_ACCOUNT_NEEDED_MSG",[J.i18n("writer.esign.ZOHOSIGN"),"<center>","</center>"]),type:"error",isMessageHTMLEncoded:!0,closeButton:!0}):e.error_msg?ZAlertBanner.show({message:J.i18n("writer.esign.UPLOAD_FAILED")+"<center>"+e.error_msg+"</center>",type:"error",isMessageHTMLEncoded:!0,closeButton:!0}):t.showMessage("error",J.i18n("writer.esign.UPLOAD_FAILED"),"showclose","normalfont",3e3)};return function(n,r){t.showLoadingMsg(J.i18n("writer.common.LOADING"));var a={},s=editor.doc.docInfo.RID,l=o.getNiceUrlPrefix(s)+"/fillmerge/selfsign",d={};d.recipients=[{action_type:"sign",language:"en",recipient_1:r||editorProps.userInfo.email,recipient_name:n||editorProps.userInfo.fullName}],d.title=editor.doc.docInfo.DOCUMENT_NAME||"",d.email_reminders=!0,d.expiration_days="15",d.is_sequential=!1,d.message="",d.reminder_period="5",d.service_no=1,d.subject="",d.fillableFieldData=JSON.stringify(u()),T&&(d.image_file_path=T),a.actioninfo=JSON.stringify(d),J.ajax({type:"POST",url:l,data:a,dataType:"json",beforeSend:function(e){o.setCsrfTokenInHeader(e)},success:e,error:i})}}(),Wt=function(){var e,t,i,n,o,r,a={init:function(a){n=editorProps.userInfo.fullName,o=editorProps.userInfo.email,i=J("#fs-dlg-done"),e=J("#fs-name-input"),t=J("#fs-email-input"),i.off("click").on("click",function(){return o&&n?(r&&r(o,n),void zt()):void Notification.show({container:"#fillsign-notify-container",translatedMessage:!1,message:"writer.fillable.SUBMITTER_DETAILS_MISSING_MSG",setTimer:!1,type:"error",close:!1})}),setTimeout(function(){t.select(),e.select()},10)},get:function(e){return"recipient_name"==e.action?n||editorProps.userInfo.fullName:"recipient_email"==e.action?o||editorProps.userInfo.email:void 0},set:function(i,r,a){"recipient_name"==i.action&&(n=e.val()),"recipient_email"==i.action&&(o=t.val())}};return function(e){r=e,J.dialogutil.open("fillandsigndialog",null,a)}}(),Yt=function(){var e=function(e,t){var i=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),n=i.onsubmit.actions.contains("sign.configure"),o=jt(i.onsubmit.sign_info,e,t);n?SignDlgHandler.open({isFillSubmit:!0,callback:r,defaultValues:o,saveOnly:!0,title:J.i18n("writer.common.REVIEW_SIGNERS_BEFORE_SEND_FOR_SIGNING"),btns:[J.i18n("writer.common.SEND_FOR_SIGN")]}):r(o)},i=function(e){t.hideLoadingMsg(),SignDlgHandler.isDialogOpened()&&(SignDlgHandler.hideProgressLoadingMsg(),SignDlgHandler.close());var i=J.i18n("writer.common.SELF_SIGN_SUCCESS_MSG");e.requests&&respose.requests.request_id;if(e.hasOwnProperty("self_sign_response")&&e.self_sign_response.sign_url&&""!=e.self_sign_response.sign_url){var n=e.self_sign_response.sign_url,o={init:function(){J("#sign-yourself-iframe").attr("src",n)}};t.initComponent("signyourselfdialog"),J.dialogutil.open("signyourselfdialog",null,o)}Ei("off"),Ai(PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),!0,J.i18n("writer.common.CHECK_YOUR_INBOX"),i)},n=function(e){t.hideLoadingMsg(),SignDlgHandler.isDialogOpened()&&(SignDlgHandler.hideProgressLoadingMsg(),SignDlgHandler.close()),e.error_msg&&e.error_msg.indexOf("UNKNOWN_USER")!=-1?ZAlertBanner.show({message:J.i18n("writer.common.ZOHO_SIGN_ACCOUNT_NEEDED_MSG",[J.i18n("writer.esign.ZOHOSIGN"),"<center>","</center>"]),type:"error",isMessageHTMLEncoded:!0,closeButton:!0}):e.error_msg?ZAlertBanner.show({message:J.i18n("writer.common.SIGN_COLLECTION_FAILURE_MSG",["<center>","</center>"])+"<center>"+e.error_msg+"</center>",type:"error",isMessageHTMLEncoded:!0,closeButton:!0}):t.showMessage("error",J.i18n("writer.common.SIGN_COLLECTION_FAILURE_MSG",["",""]),"showclose","normalfont",5e3)},r=function(e){e?t.showLoadingMsg(J.i18n("writer.common.LOADING")):SignDlgHandler.showProgressLoadingMsg(J.i18n("writer.mailmergepopup.PROCESSING"));var r={},a=editor.doc.docInfo.RID,s=o.getNiceUrlPrefix(a)+"/fillmerge/submit";e=e||JSON.parse(SignDlgHandler.getSignInfo().actioninfo),r.actioninfo=JSON.stringify(e),r.filled_data=JSON.stringify(u()),T&&(r.file_path=T),null!=ri()&&(r.draftId=ri()),J.ajax({type:"POST",url:s,data:r,dataType:"json",beforeSend:function(e){o.setCsrfTokenInHeader(e)},success:i,error:n})};return function(){mi()&&Wt(e)}}(),zt=function(){J.dialogutil.close("fillandsigndialog")},Zt=function(){var e=function(e){t.hideLoadingMsg(),SignDlgHandler.isDialogOpened()&&(SignDlgHandler.hideProgressLoadingMsg(),SignDlgHandler.close());var i=J.i18n("writer.common.APPROVAL_SUCCESS_MSG");e.requests&&respose.requests.request_id;Ei("off"),Ai(PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),!0,J.i18n("writer.common.SENT_FOR_APPROVAL"),i)},i=function(e){t.hideLoadingMsg(),SignDlgHandler.isDialogOpened()&&(SignDlgHandler.hideProgressLoadingMsg(),SignDlgHandler.close()),e.error_msg&&e.error_msg.indexOf("UNKNOWN_USER")!=-1?ZAlertBanner.show({message:J.i18n("writer.common.ZOHO_SIGN_ACCOUNT_NEEDED_MSG",[J.i18n("writer.esign.ZOHOSIGN"),"<center>","</center>"]),type:"error",isMessageHTMLEncoded:!0,closeButton:!0}):e.error_msg?ZAlertBanner.show({message:J.i18n("writer.common.SIGN_COLLECTION_FAILURE_MSG",["<center>","</center>"])+"<center>"+e.error_msg+"</center>",type:"error",isMessageHTMLEncoded:!0,closeButton:!0}):t.showMessage("error",J.i18n("writer.common.SIGN_COLLECTION_FAILURE_MSG",["",""]),"showclose","normalfont",5e3)},n=function(n){n?t.showLoadingMsg(J.i18n("writer.common.LOADING")):SignDlgHandler.showProgressLoadingMsg(J.i18n("writer.mailmergepopup.PROCESSING"));var r={},a=editor.doc.docInfo.RID,s=o.getNiceUrlPrefix(a)+"/fillmerge/submit";n=n||JSON.parse(SignDlgHandler.getSignInfo().actioninfo),r.actioninfo=JSON.stringify(n),r.filled_data=JSON.stringify(u()),T&&(r.file_path=T),null!=ri()&&(r.draftId=ri()),J.ajax({type:"POST",url:s,data:r,dataType:"json",beforeSend:function(e){o.setCsrfTokenInHeader(e)},success:e,error:i})},r=function(e,t,i){var o=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),r=o.onsubmit.actions.contains("sign.configure"),a=jt(o.onsubmit.sign_info,t,i);r?SignDlgHandler.open({isFillSubmit:!0,callback:n,saveOnly:!0,defaultValues:a,title:J.i18n("writer.common.REVIEW_SIGNERS_BEFORE_SEND_FOR_APPROVAL"),btns:[J.i18n("writer.common.SEND_FOR_APPROVAL")]}):n(a)};return function(){if(mi()){var e=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL);FillAutomationHandler.isSelfSignPresent(e)?Wt(r.bind(null,!0)):r(!1)}}}(),Vt=function(e,t,i,n){MsgDialog.showMessage(e,CONST.SEVERITY_SUCCESS,t,i,null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:MsgDialog.close(),n&&n();break;case CONST.BUTTON_2_CLICKED:}},null,!0)},jt=function(e,t,i){return e.recipients=e.recipients.filter(function(n,o){var r=n["recipient_"+(o+1)];if("${Submitter's Email}"==r)n.recipient_name=i,n["recipient_"+(o+1)]=t;else if(r.indexOf("${")!=-1){var a=editor.getDocument().getFieldsByName(r.substring(2,r.length-1)),s=a&&a.getValue();if(!s||" "==s)return qt(e,!0),!1;n.recipient_name=s.split("@")[0],n["recipient_"+(o+1)]=s}return!0}),e},Xt=function(e){FillAutomationHandler.toggleFieldHighlight(null,{state:!1}),Ei(e)},Kt=function(){f&&(f.resetFieldValues(),En(),ne(function(){e.publish("FillableFieldUpdated"),f=null}))},qt=function(e,i){return!(!e.recipients.length||i)||(t.showMessage("error",J.i18n("writer.common.INVALID_SIGN_RECIPIENTS_MSG"),"showclose","normalfont",5e3),!1)},Qt=function(){var e,i=function(e){var t=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),i=t.onsubmit.actions.contains("sign.configure"),n=jt(t.onsubmit.sign_info);i&&qt(n,!1)&&SignDlgHandler.open({isFillSubmit:!0,callback:a,defaultValues:n,saveOnly:!0,title:J.i18n("writer.common.REVIEW_SIGNERS_BEFORE_SEND_FOR_SIGNING"),btns:[J.i18n("writer.common.SEND_FOR_SIGN")]})},n=function(i){t.hideLoadingMsg(),SignDlgHandler.isDialogOpened()&&(SignDlgHandler.hideProgressLoadingMsg(),SignDlgHandler.close());var n=J.i18n("writer.common.SIGN_COLLECTION_SUCCESS_MSG");i.requests&&respose.requests.request_id;if(i.hasOwnProperty("self_sign_response")&&i.self_sign_response.sign_url&&""!=i.self_sign_response.sign_url){var o=i.self_sign_response.sign_url,r={init:function(){J("#sign-yourself-iframe").attr("src",o)}};t.initComponent("signyourselfdialog"),J.dialogutil.open("signyourselfdialog",null,r)}Ei("off"),Ai(PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),!0,J.i18n("writer.common.SENT_FOR_SIGNING"),n,e)},r=function(e){t.hideLoadingMsg(),SignDlgHandler.isDialogOpened()&&(SignDlgHandler.hideProgressLoadingMsg(),SignDlgHandler.close()),e.error_msg&&e.error_msg.indexOf("UNKNOWN_USER")!=-1?ZAlertBanner.show({message:J.i18n("writer.common.ZOHO_SIGN_ACCOUNT_NEEDED_MSG",[J.i18n("writer.esign.ZOHOSIGN"),"<center>","</center>"]),type:"error",isMessageHTMLEncoded:!0,closeButton:!0}):e.error_msg?ZAlertBanner.show({message:J.i18n("writer.common.SIGN_COLLECTION_FAILURE_MSG",["<center>","</center>"])+"<center>"+e.error_msg+"</center>",type:"error",isMessageHTMLEncoded:!0,closeButton:!0}):t.showMessage("error",J.i18n("writer.common.SIGN_COLLECTION_FAILURE_MSG",["",""]),"showclose","normalfont",5e3)},a=function(e){e?t.showLoadingMsg(J.i18n("writer.common.LOADING")):SignDlgHandler.showProgressLoadingMsg(J.i18n("writer.mailmergepopup.PROCESSING"));var i={},a=editor.doc.docInfo.RID,s=o.getNiceUrlPrefix(a)+"/fillmerge/submit";e=e||JSON.parse(SignDlgHandler.getSignInfo().actioninfo),i.actioninfo=JSON.stringify(e),i.filled_data=JSON.stringify(u()),T&&(i.file_path=T),null!=ri()&&(i.draftId=ri()),J.ajax({type:"POST",url:s,data:i,dataType:"json",beforeSend:function(e){o.setCsrfTokenInHeader(e)},success:n,error:r})};return function(t){t&&(e=t),i()}}(),$t=function(){var e=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),t=0==e.onsubmit.actions.length||1==e.onsubmit.actions.length&&e.onsubmit.actions.contains("sign.configure");t||Qt()},ei={init:function(){var e=J("#pfill_drfted_dlg"),t=function(){window.location.href=m},i=new Date(Date.now()+2592e6).toDateString(),n=J("#pfill_expiry_date")[0],o=function(e){var t=J("#pFillEmail");t.ztokenfield("setAttribute","dataSource",e||[])};o([]),Contacts.getContacts().done(o),n.innerText=J.i18n("writer.fillablefields.DRAFT_LINK_EXPIRY",[30,i]),e.find("#resumeLink_send_email").bind("click",li),e.find("#resumeLink_copy_btn").bind("click",di),e.find("#pfill_close_btn").bind("click",t),J("#resume_fill_link").val(m)}},ti=function(){oi(f.getFillInfo())},ii=function(e){f||(f=new FillableFieldsModel);var t={id:1};if(at.find("#fill-popover_1_"+t.id).length||gn(at,t,!0),e){for(var i=Object.keys(e),n=0;n<i.length;n++){var o=f.getFieldById(i[n]);if(o){var r=e[i[n]],a=r[y.VALUE];if(o.isFillableImageField()&&o.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE){if(a=a||o.style.src,!a)continue;var s={src:a,size:r[y.SIZE]},l=r[y.CROPRECT];l&&(s.cropRect=l),null!=a&&(g=o)&&Mt(s,!0)}else null!=a&&(g=o)&&(o.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTILINE?ge.val(a):fe.val(a))&&Mt(a,!0)}}editor.getDocument().applyChanges(),re()}},ni=function(){var e=Macros.getRId(),t=o.getNiceUrlPrefix(e+"/fill/resume"),i={};i.encryptId=ri(),i.action="fetch";var n={},r={success:function(e){if(e=null!=e?JSON.parse(e):{},e.status){Ee();var t=e.filledData;n=t?JSON.parse(t):{},ii(n),ai(!1),ci(n)}else n={}},fail:function(e){n={}},setHeaders:function(e){o.setCsrfTokenInHeader(e)}};J.ajaxUpload(t,i,r,"json")},oi=function(e){if(O&&(editorProps.isFillAddonPurchased||_)){var i=Macros.getRId(),n=o.getNiceUrlPrefix(i+"/fill/resume"),r={};r.filledData=JSON.stringify(e),r.action="create",T&&(r.file_path=T),null!=ri()&&(r.action="save",r.encryptId=ri());var a={success:function(e){e=null!=e?JSON.parse(e):{};var i=e.status;if(!i)return void Notification.show({message:"writer.fillablefields.FIELD_STORAGE_FAILURE_NOTIFICATION",setTimer:!0,type:"warning"});var n=e.encryptId;if(null==ri()){var o=location.pathname;o.includes("/fill")||(o+="/fill"),m=location.protocol+"//"+location.host+o+"/resume/"+n+location.search,t.initComponent("publishfilldraftedinfodlg"),J.dialogutil.open("publishfilldraftedinfodlg",null,ei)}else{var o=location.pathname;o=o.substring(0,o.indexOf("resume/")),o.indexOf("/fill")==-1&&(o+="fill/"),m=location.protocol+"//"+location.host+o+"resume/"+n+location.search}ai(!1)},fail:function(e){Notification.show({message:"writer.fillablefields.FIELD_STORAGE_FAILURE_NOTIFICATION",setTimer:!0,type:"warning"})},setHeaders:function(e){o.setCsrfTokenInHeader(e)}};J.ajaxUpload(n,r,a,"json")}},ri=function(){var e=window.location.pathname,t=null;return e.indexOf("resume/")!=-1?t=e.split("resume/")[1]:null!=m&&m.indexOf("resume/")!=-1&&(t=m.split("resume/")[1]),t&&location.search&&(t=t.split(location.search)[0]),t},ai=function(e){var t="",i={};e?null!=ri()?(t=J.i18n("writer.common.SAVE"),i={"pointer-events":"auto"}):(t=J.i18n("writer.common.SAVE_AND_RESUME"),i={"pointer-events":"auto"}):(t=J.i18n("writer.mmjobhistory.SAVED"),i={"pointer-events":"none"}),J("#ff_save_draft_btn").text(t),J("#ff_save_draft_btn").css(i),J("#publishfillfootermoreoptions").zmenu("setMenuItemsAttribute",["#ff-publish-list-save-draft"],"label",t),J("#ff-publish-list-save-draft").css(i)},si=function(){var e=location.search.substr("?".length);if(!e)return"";for(var t=e.split("&"),i=0,n=t.length;i<n;i++){var o=t[i].split("=");if(o&&"authId"===o[0])return decodeURIComponent(o[1])}return""},li=function(){var e,t={},i=!1,n=J("#resumeLink_send_email"),r=[],a=J("#pFillEmail").ztokenfield("getAllValues");if(a.length)for(var s=0;s<a.length&&(i=EMAILID_REGEX.test(a[s].email),i);s++)r.push(a[s].email);if(!i||!r.length)return void Notification.show({container:"#pfill_drfted_dlg",message:"writer.common.ENTER_PROPER_EMAILID",close:!1,setTimer:!0,type:"warning"});n.disable(),n.text(J.i18n("writer.common.SENDING")),t.recipients=r.toString(),t.draftId=ri();var l=si();l&&(t.authId=l),t.domain=location.origin,e=o.getContextUrl("v1/web/"+Macros.getRId()+"/fill/email_fillable_draft_link"),J.ajax({url:e,data:t,type:"POST",dataType:"json",beforeSend:function(e){o.setCsrfTokenInHeader(e)},success:function(){n.enable(),n.text(J.i18n("writer.common.SEND")),r=[],J("#pFillEmail").ztokenfield("removeAllTokens"),Notification.show({container:"#pfill_drfted_dlg",message:"writer.common.PUBLISH_EMAIL_SUCCESS_MSG",close:!1,setTimer:!0,type:"success"})},error:function(){n.enable(),n.text(J.i18n("writer.common.SEND")),Notification.show({container:"#pfill_drfted_dlg",message:"writer.common.PUBLISH_EMAIL_FAILURE_MSG",close:!1,setTimer:!0,type:"error"})}})},di=function(){J("#resume_fill_link").select(),n.checkCopySupport("#resumeLink_copy_btn","#resume_fill_link","writer.common.COPIED")},ci=function(){var e,t=function(){e>=i.length||(g=editor.getDocument().getFieldById(i[e]),Ni(t),e++)},i=[];return function(n){e=0;for(var o in n){var r=n[o];r.hasOwnProperty(y.SIZE)&&!!r[y.VALUE].trim()&&i.push(o)}t()}}(),ui=function(){if(!this.fieldNos.length){var e=this;J(".fillablefield").each(function(t,i){(i=J(i))&&i.hasClass("ffield-mandatory")&&e.ids.push(i.data().fieldId)&&e.fieldNos.push(t)})}for(var t=this.currentFieldIdx;t<this.fieldNos.length;){if(!f.isFieldFilled(f.getFieldById(this.ids[this.currentFieldIdx]))){Ee(),_t(this.fieldNos[t++]);break}t++}this.currentFieldIdx=t},pi=function(){Ee(),f.clearFieldValues(),editor.getDocument().applyChanges(function(){e.publish("FillableFieldUpdated")}),re(),ai(!0)},gi=function(){_=!_,J("#topband-test-mode")[_?"show":"hide"]();var e=editor.getDocument();_?(e.addWatermark("text",{content:"SAMPLE"}),e.applyChanges()):(e.removeWatermark(),e.applyChanges())},fi=function(){var e=function(e,n,o){if(t.hideLoadingMsg(),o.hasOwnProperty("sequence_number_info")&&0!=Object.keys(o.sequence_number_info).length&&(P=o.sequence_number_info,editor.getDocument().replaceSequenceNumbersInDocument(o.sequence_number_info),editor.getDocument().applyChanges()),o&&(o.submitStatus||o.save)){o.jobId;if(o.hasOwnProperty("self_sign_response")&&o.self_sign_response.sign_url&&""!=o.self_sign_response.sign_url){var r=o.self_sign_response.sign_url,a={init:function(){J("#sign-yourself-iframe").attr("src",r)}};t.initComponent("signyourselfdialog"),J.dialogutil.open("signyourselfdialog",null,a)}editorProps.isEmbed||(J("#ff-publish-beforesubmit").addClass("ui-hide"),J("#ff-publish-aftersubmit").removeClass("ui-hide"),J("#ff-submit-successmsg").removeClass("ui-hide")),Ei("off");var s={};if(b){s=editorProps.options.REMOTE.fillable_data.submit_settings||editorProps.submit_settings||{};var l={show_success_msg_info:{message:s.onsubmit_message},redirect_info:{url:s.redirect_url}};s.onsubmit=l}else s=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL);if(ZWJSONUtils.isEmptyObject(s))return;Ai(s,!!n,n?J.i18n("writer.common.SENT_FOR_SIGNING"):null,n?J.i18n("writer.common.SIGN_COLLECTION_SUCCESS_MSG"):null,e)}else i(o)},i=function(e){if(t.hideLoadingMsg(),e.responseJSON&&(e=e.responseJSON),!e||"no_credits_available"!=e.error_msg&&"daily_limit_reached"!=e.error_msg)if(e&&"addon_not_purchased"==e.error_msg)ZAlertBanner.show({message:B,type:"error",isMessageHTMLEncoded:!0,closeButton:!0});else if(e&&"sign_limit_reached"==e.error_msg){var i=J.i18n("writer.automation.REACHED_MONTHLY_SIGN_LIMIT_MSG_USER",[editorProps.deployment.zohosign,a("learnMoreForSign"),"</span>"]);ZAlertBanner.show({message:i,type:"error",isMessageHTMLEncoded:!0,closeButton:!0})}else if(e&&"mail_limit_reached"==e.error_msg){var i=J.i18n("writer.automation.REACHED_DAILY_MAIL_CAP_MSG_USER",[a("openPropacKB"),"</span>"]);ZAlertBanner.show({message:i,type:"error",isMessageHTMLEncoded:!0,closeButton:!0})}else e&&e.message?ZAlertBanner.show({message:e.message,type:"error",isMessageHTMLEncoded:!1,closeButton:!0}):ZAlertBanner.show({message:s,type:"error",isMessageHTMLEncoded:!0,closeButton:!0});else ZAlertBanner.show({message:U,type:"error",isMessageHTMLEncoded:!1,closeButton:!0})},n=function(){var e="";if(b){var t=window.location.pathname.split("/")[5];e=o.getHostURL()+"/writer/officeapi/v1/fillabletemplates/"+t+"/fill/submit"}else{var i=editor.doc.docInfo.RID;e=o.getNiceUrlPrefix(i)+"/fillmerge/submit"}return e},r=function(){var e=u();if(!b)return{filled_data:JSON.stringify(e)};var t=new FormData;for(var i in e){var n=e[i][1];if("string"==typeof n&&n.indexOf("data:image")!=-1){var o=n.split(/[:;,]/,4),r=(new Blob([Utils.convertBase64ToArrayBuffer(o[3])],{type:o[1]}),new File([Utils.convertBase64ToArrayBuffer(o[3])],i,{type:o[1]}));t.append("image",r),e[i][1]=""}}return t.append("submit_data",JSON.stringify(e)),t},a=function(e){return"<span class='ui-text-blue' onclick='FillAutomationHandler."+e+"()'>"},s=J.i18n("writer.fillablefields.SUBMIT_FAILURE_MSG",["<center>","</center>","<center>","</center>"]);return function(a,s){if(L.length){var l=L[0],d=editor.getDocument().getFieldById(l);return Dt(d,!0),ln(d,J("#ff-fill-input_1_"+l).val()),void J("#ff-fill-input_1_"+l).select()}if(f||(f=new FillableFieldsModel),!(editorProps.available_credits<1)||_){if(!f.areMandatoryFieldsFilled())return Notification.show({message:x,setTimer:!0,timeOut:1e4,translatedMessage:!0,type:"error"}),Oe&&Oe.addClass("ui-doc-ff-list-cont-mandatory"),void ui.call(w);if(O&&(editorProps.isFillAddonPurchased||_)){TransformEventHandler.deselectObjects(),Oe&&Oe.removeClass("ui-doc-ff-list-cont-mandatory"),t.showLoadingMsg(J.i18n("writer.common.LOADING"));var c=r(),u=n();T&&(c.file_path=T),null!=ri()&&(c.draftId=ri());var p=(editor.getDocument().getAllFields(),PrepareDocumentHandler.getSequenceNumbers());Object.keys(p).length>0&&(c.sequence_number_info=JSON.stringify(p)),editorProps.prefill_id&&(c.prefill_id=editorProps.prefill_id);var g={type:"POST",url:u,data:c,success:e.bind(null,a,s),error:i};b?(g.contentType=!1,g.processData=!1):(g.dataType="json",g.beforeSend=function(e){o.setCsrfTokenInHeader(e)},g.data=c),J.ajax(g)}}}}(),Ei=function(e){var t="off"==e;t?J("#editorpane").off("click",".fillablefield"):H(),t?J("#editorpane").off("click",".zw-fill-checkbox"):Y(),t?a.closePane():FillableFieldsHandler.showFieldNavigation(),J("#ff-publish-preview-btn").text(t?J.i18n("writer.automation.BACK_TO_FILLING"):J.i18n("writer.common.PREVIEW")),J("#ff-publish-preview-btn").removeAttr("onclick").attr("onclick",'FillableFieldsHandler.handlePreviewDocument("'+(t?"on":"off")+'");')},Ti=function(){var e=editor.writerServerURL;Utils.safeWindowOpen(decodeURI(e),{},"_blank")},mi=function(){return f||(f=new FillableFieldsModel),!(editorProps.available_credits<1&&!_)&&(f.areMandatoryFieldsFilled()?!(!O||!editorProps.isFillAddonPurchased&&!_)&&(TransformEventHandler.deselectObjects(),Oe&&Oe.removeClass("ui-doc-ff-list-cont-mandatory"),!0):(Notification.show({message:x,setTimer:!0,timeOut:1e4,translatedMessage:!0,type:"error"}),Oe&&Oe.addClass("ui-doc-ff-list-cont-mandatory"),ui.call(w),!1))},hi=function(e,t){var i=PUBLISH_TYPE.EXTERNAL==editor.doc.docInfo.PUBLISH_SCOPE;!e||!t.length||i&&!t.contains("document.download")||editorProps.orgInfo&&!editorProps.orgInfo.export_document||(J("#ff-submit-successmsg").addClass("ui-hide"),J("#ff-publish-submitactions").removeClass("ui-hide"))},Ii=function(e){e&&window.location.replace(e)},_i=function(){J("#ff-publish-topband-more-options").show(),J("#ff-test-mode-cont,#ff-publish-topband-field-nav").hide();var e=J("#ff-highlight-style")[0];e||FillAutomationHandler.toggleFieldHighlight(null,{state:!1}),J("#bottombar-publishfill").hide(),editor.onResize()},Ai=function(e,t,i,n,o){var r=3e3,a=e.onsubmit,s=a.submitter_permissions||[],l=a.actions||[],d=a.show_success_msg_info.messageHTML||a.show_success_msg_info.message,c=(l.contains("show_success_msg")||b)&&(Tt?Tt.sanitize(d):"");c?J("#ff-submit-content").html(c):r=0;var u=(l.contains("redirect")||b)&&a.redirect_info.url;u?editorProps.isEmbed&&setTimeout(Ii.bind(null,a.redirect_info.url),r):!b&&setTimeout(hi.bind(null,e,s),r),editorProps.isEmbed&&c&&ZAlertBanner.show({message:c,hideDelay:3e3,type:"success",isMessageHTMLEncoded:!0,closeButton:!0}),editorProps.isEmbed?J("#ff-publish-embed-cont").hide():Vt([J.i18n("writer.common.DONE")],t?i:J.i18n("writer.common.THANK_YOU"),c||(t?n:J.i18n("writer.automation.SUBMIT_SUCCESS_MSG")),function(){o?o(u&&Ii.bind(null,a.redirect_info.url)):u&&Ii.call(null,a.redirect_info.url)}),!editorProps.isEmbed&&_i()},Si=function(){var e=function(){var e=["colspan","rowspan","cellpadding","src","href","target","align","width"];Tt="undefined"!=typeof ZSEC&&new ZSEC.HTMLPurifier({ALLOWED_STYLE:"ALL",STYLE_VALIDATION:!1,GLOBAL_ATTRIBUTES:e,GLOBAL_TAGS:["#comment","iframe"],WHOLE_DOCUMENT:!0,TAG_RULES:{iframe:{NAME:"iframe",ATTRIBUTE_RULES:{sandbox:{NAME:"sandbox",NOT_CONTAINS:["allow-top-navigation","allow-popups-to-escape-sandbox"],DEFAULT_VALUE:"allow-popups allow-forms allow-scripts allow-same-origin allow-presentation"}},APPEND_ATTRIBUTES:[{NAME:"sandbox",VALUE:"allow-popups allow-forms allow-scripts allow-same-origin allow-presentation"}]}}})};return function(){zw.require({js:[pasteHtmlSanitizerJs]},[],e)}}(),Ri=function(e,t,i){var n=g.getSize();if(g.getFitType()==IMAGE_FIT_TYPE.FLUID){if(" "===t.URL?(g.style.originalWidth=g.style.width=t.WIDTH,g.style.originalHeight=g.style.height=t.HEIGHT):(g.style.originalWidth=t.ORIG_WIDTH||t.WIDTH,g.style.originalHeight=t.ORIG_HEIGHT||t.HEIGHT,g.style.height=(FILLABLEFIELD_TYPE.IMAGE==e?t.HEIGHT=n.ht:t.HEIGHT)||n.ht,g.style.width=(FILLABLEFIELD_TYPE.IMAGE==e?t.WIDTH=n.wid:t.WIDTH)||n.wid),FILLABLEFIELD_TYPE.SIGNATURE==e||FILLABLEFIELD_TYPE.INITIAL==e){t.WIDTH=n.ht*(t.WIDTH/t.HEIGHT),t.HEIGHT=n.ht;var o,r=DocLayoutManager.getLineAtIndex(g.start);t.WIDTH=r&&(o=r.getMaxContentWidth())&&o<t.WIDTH?o:t.WIDTH}}else g.style.originalWidth=t.ORIG_WIDTH||t.WIDTH,g.style.originalHeight=t.ORIG_HEIGHT||t.HEIGHT,g.style.height=t.HEIGHT=n.ht||100,g.style.width=t.WIDTH=n.wid||100,g.style.img_fit="cropFit";var a=pt({ht:parseInt(t.HEIGHT||n.ht),wid:parseInt(t.WIDTH||n.wid),orginalHt:parseInt(t.ORIG_HEIGHT||t.HEIGHT),orginalWid:parseInt(t.ORIG_WIDTH||t.WIDTH)}),s=a[ATTR_IMAGE.I_CROPRECT],l=h||" "===t.URL?t.URL:i?t.URL:HTMLUtil.storeImageInFileStore(t.URL);g.style.src=l," "!==l&&g.getFitType()!=IMAGE_FIT_TYPE.FLUID||(s={cropTop:"0.000%",cropBottom:"0.000%",cropLeft:"0.000%",cropRight:"0.000%"}),f&&(f.fields[g.getId()]=g);var d={src:l,width:t.WIDTH,originalWid:t.ORIG_WIDTH,height:t.HEIGHT,originalHt:t.ORIG_HEIGHT,cropRect:s};h?Mt(d):(g.setValue(l),ie(g,d))},Oi=function(e){if(!h)return!0;var i=e.substr(e.indexOf(",")+1),n=atob(i).length;return!(n>1e7)||(t.showMessage("error",J.i18n("writer.common.IMAGE_SIZE_EXCEED_ERROR",["10 MB"]),"showclose","normalfont",5e3),!1)},bi=function(){var e={},i={},n=function(e){i=e.DATA[0],i.HEIGHT=100,i.WIDTH=100,Oi(i.URL)&&(Ri(FILLABLEFIELD_TYPE.IMAGE,i,!0),Ni()),ZWImgLibDialog.close()},o=function(){t.showMessage("error",J.i18n("writer.common.UNABLE_TO_INSERT_IMAGE"),"showclose","normalfont",3e3)},r=function(){n.apply(null,arguments),ZWImgLibDialog.close()},a=function(){o.apply(null,arguments),ZWImgLibDialog.close()},s=function(e){var t=e.images[0],n=t.IMAGE_URL;i={URL:n,WIDTH:100,HEIGHT:100,ORIG_WIDTH:t.IMAGE_WIDTH,ORIG_HEIGHT:t.IMAGE_HEIGHT}};return function(t){t&&(e.insertFrom=t),editorProps.isPublishToFill&&!window.RemoteEditor&&(window.RemoteEditor={},window.RemoteEditor.imgLibAppData={}),h&&(e.isRemoteMode=h,e.onBeforeInsert=s),ZWImgLibDialog.open(e,r,a)}}(),vi=function(){Ri(FILLABLEFIELD_TYPE.IMAGE,{URL:" ",WIDTH:100,HEIGHT:100})},Di=function(){var e=function(e,t,i){var n=event.currentTarget,o=ZWImageUtils.getNewDimensionBasedOnContainer(n.naturalWidth,n.naturalHeight,i.start);Ri(e,{URL:t,WIDTH:o.width,HEIGHT:o.height}),Ni()},t=function(t){var i=t.getFillableFieldType(),n=i==FILLABLEFIELD_TYPE.INITIAL?arguments[1].initial:arguments[1].signature;if(n&&Oi(n)){var o=new Image;o.onload=e.bind(null,i,n,t),o.src=n}};J.i18n("writer.common.ENTER_YOUR_SIGNATURE"),J.i18n("writer.common.ENTER_YOUR_INITIALS");return function(){ZSignController.editSignFromPanel(g.getFillableFieldType(),t.bind(null,g),!1,!0)}}(),Li=function(){Ri(g.getFillableFieldType(),{URL:" ",WIDTH:g.getFillableFieldType()==FILLABLEFIELD_TYPE.INITIAL?50:300,HEIGHT:50})},Ni=function(){var e,i,n={},r=function(){T&&(n.file_path=T),n.img_id=e,n.imageByte=i;var t=(editor.doc.docInfo.RID,o.getUrl("fillUploadImage")),r={success:a,failure:s,setHeaders:function(e){o.setCsrfTokenInHeader(e)}};J.ajaxUpload(t,n,r,"json")},a=function(e){if(e&&(e=JSON.parse(e))){if(!e.saveStatus)return;T=e.file_path}},s=function(e){e&&(e=JSON.parse(e))&&D.splice(D.length-e.image_ids.length,e.image_ids.length),t.showMessage("error",l,"showclose","normalfont",3e3)},l=J.i18n("writer.common.SAVING_ERROR_MSG",[J.i18n("writer.mailmergepopup.IMAGE")]);return function(){if(editorProps.isPublishToFill&&O&&!b){var t=g.isFillableImageField()?g:null;e=Pi(),i=t&&t.style.src,D=D.concat(e.split(",")),r()}}}(),Pi=function(){var e="";if(g[ATTR_FILLABLEFIELD.FF_NAME]){var t=f.getAllLinkedFields(g);t.forEach(function(t){e+=t.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]+","}),e=e.substr(0,e.length-1)}else e+=g.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID];return e},Ci=function(e){var t={};return t.fillable_field_data=u(),t.format="pdf",t.operation=e||"download",T&&(t.file_path=T),t},yi=function(){var e,t={CHECKED:/true|1|yes|y/,UNCHECKED:/false|0|no|n/},i=function(){if(window.location.hash)try{e=JSON.parse(decodeURIComponent(window.location.hash.substr(1)))}catch(i){var t=window.location.hash.substr(1).replaceAll("'",'"');e=JSON.parse(decodeURIComponent(t))}else b?e=editorProps.options.REMOTE.fillable_data.prefill_data||editorProps.prefill_data:editorProps.prefill_data&&(e=editorProps.prefill_data,l=!0)},n=function(e){var t=PrepareDocumentHandler.getValues(TEMPLATE.FILLABLE_SETTINGS).onsubmit.prefill_info,i=t.field_map[e.getId()],n=MailMergeUtil.getFieldMappingFromObject(i,{includeRLFields:!0,mapping:t.mf_mapping}),o=e.getFillableFieldType(),r={};return Object.keys(n).forEach(function(e){var t=n[e].type;o==FILLABLEFIELD_TYPE.DATE&&t==MAILMERGE.FIELD_TYPE.DATE&&(r=n[e]),o==FILLABLEFIELD_TYPE.CURRENCY&&t==MAILMERGE.FIELD_TYPE.NUMBER&&(r=n[e])}),r},o=function(t){var i=f.getFieldById(t),n=!1;return f.getAllLinkedFields(i).forEach(function(t){var i=e[t.getId()];n=n||!!i&&"true"==i.checked}),n},a=function(i){var r=i.isFillableImageField()?i.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_NAME]:i[ATTR_FILLABLEFIELD.FF_NAME],a=i.isFillableImageField()?i.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]:i[ATTR_COMMON.ID];switch(value=e[l?a:r],l&&e.hasOwnProperty(a)&&(null==value||""==value)&&(value=" "),value&&" "!=value&&i.getFillableFieldType()){case FILLABLEFIELD_TYPE.CHECKBOX:if(l){var s=f.getFieldById(a);!!value.checked_value&&s.setCheckedValue(value.checked_value),!!value.unchecked_value&&s.setUncheckedValue(value.unchecked_value),value=value.checked||value.value,"string"==typeof value&&(value=value.toLowerCase())}value=!!t.CHECKED.test(value)||!t.UNCHECKED.test(value)&&null;break;case FILLABLEFIELD_TYPE.SELECTBOX:l?(value.list&&value.list.length&&"object"==typeof value.list&&f.getFieldById(a).setList(value.list),value.idx=value.list&&value.list.length?value.idx>=value.list.length?0:value.idx:-1,"fixed"==value.type&&value.idx!=-1||null==value.value||""===value.value?value=value.idx:value=f.getFieldById(a).getList().indexOf(value.value)):value=i.getList().indexOf(value),value=value==-1?null:value;break;case FILLABLEFIELD_TYPE.NUMBER:case FILLABLEFIELD_TYPE.PERCENT:if(l){var d=Numeral.getNumber(value,i.getLocale());value=d+""}value+="",value=value.replaceAll(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.NUMBER],"");break;case FILLABLEFIELD_TYPE.EMAIL:value=FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.EMAIL].test(value)?value:null;break;case FILLABLEFIELD_TYPE.CURRENCY:case FILLABLEFIELD_TYPE.PHONE:if(l){var d=Numeral.getNumber(value,i.getLocale());value=d+""}value+="",value=value.replaceAll(FILLABLEFIELD_REGEX[i.getFillableFieldType()],"");break;case FILLABLEFIELD_TYPE.DATE:if(l){var c=n(i).date_info.output,u="custom"==c.format,p=u?c.custom_format:c.format,g=new ZWDateTime(value,p,c.locale,c.timezone,u),d=g.getOriginalUTC();value=d}value="string"==typeof value||value.toString().length<13?null:value;break;case FILLABLEFIELD_TYPE.MULTIPLECHOICE:if(l){!!value.field_value&&f.getFieldById(a).setValue(value.field_value);var E=o(a);value="true"==value.checked||!E&&!!value.value.length&&value.value.split(",").contains(value.field_value)}else{var T=value.split(",");value=T.contains(i.getValue())}break;case FILLABLEFIELD_TYPE.RADIO:if(l){!!value.field_value&&f.getFieldById(a).setValue(value.field_value);var E=o(a);value="true"==value.checked||!E&&value.value==value.field_value}else{var m=value.split(",")[0];value=m===i.getValue()}}return""===value?null:value},s=[],l=!1,d=function(e){e[ATTR_FILLABLEFIELD.FF_DISABLED]||s.push(e)},c=function(e){s.forEach(function(e){var t=a(e);if(e.isFillableImageField()&&e.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE){var i={src:t};null!=t&&(g=e)&&Mt(i,!0)}else null!=t&&(g=e)&&(e.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTILINE?ge.val(t):fe.val(t))&&Mt(t,!0);f.addToPrefilledFields(e,t)}),e||(editor.getDocument().applyChanges(),re(),f=null)};return function(t,n){try{if((!e||n)&&i(),!e)return;f||(f=new FillableFieldsModel),Ee();var o={id:1};at.find("#fill-popover_1_"+o.id).length||gn(at,o,!0),n?(s=n,c(t)):editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,d)&&c(t),!t&&r.addToStatistics("Prefill URL accessed")}catch(e){ZWCollaboration.FILLABLE_FIELD_SYNC_ERROR;r.log("Exception in prefilling fillable fields. "+e.stack);var a=r.getErrorParams(ZWCollaboration.FILLABLE_FIELD_SYNC_ERROR+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>#\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Error Log End \n <ZWERROR> Exception Stack: "+e.stack,null,ZWCollaboration.FILLABLE_FIELD_SYNC_ERROR);ZWBeacon.sendErrorLogs(a)}}}(),Fi=function(){var e=function(t,i,n){return Object.keys(t).forEach(function(o){var r=t[o],a=r;"object"==typeof r?a=e(r,i,n):"string"==typeof r&&(a=MailMergeRecordUtil.replaceFieldInText(r,i,{record:n})),t[o]=a}),t};return function(t,i){var n=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL);if(n){var o,r=n.onsubmit.prefill_info,a=ZWJSONUtils.clone(r.field_map),s={};if(i){var l={};l[i]=a[i],l=e(l,r.mf_mapping,t),a[i]=l[i],s=a,o=[];var d=editor.getDocument().getFieldById(i);!d[ATTR_FILLABLEFIELD.FF_DISABLED]&&o.push(d)}else s=e(a,r.mf_mapping,t);return editorProps.prefill_data=s,yi(!0,o),editor.getDocument().getChanges()}}}(),Mi=function(){var i=editor.doc.getParents(NODE_TYPE.PARAGRAPH,1),o=editor.doc.getSelection().removeAllRanges().moveTo(i,!0);editor.rebindEvents(),LayoutManager.loadLayout(LayoutManager.getLayoutType()),editor.setView(EDITOR_VIEWS.EDITOR),e.publish("subpanel-insertfillablefield/open",{operation:"insert_fillable_fields"}),e.publish("QuickSeek/hideBarWithID","mergeField"),Lt(),t.showLoadingMsg(J.i18n("writer.common.LOADING"));var r=function(){t.hideLoadingMsg(),t.showDocStatusIcon(),J("#ff-highlight-style").remove(),Z("docufiller-tb").show(),J("#bbar-tc-switch").ztoggleswitch("enable"),setTimeout(function(){n.scrollElementIntoView(o.getTargetRange().getStartPortionNode())},10),J("#fill-popover-elem")[0].style.display="block",En()};editor.doc.setApplyConditionsForFillableFields(!1),e.publish("Document/FillableFieldsPreview"),e.subscribeOnce("Document/LoadingStart",r),editor.fetchDocument(Utils.getDocumentId(),"")},wi=function(){FetchHTML.get({requestName:"fillablefieldspreview",target:"#ffpreview-toolbarcontainer",requestURL:o.getNiceUrlPrefix("toolbar/fillablefieldspreview"),callback:function(){t.initComponent("ffpreview-toolbarcontainer"),Z("docufiller-tb").hide(),editor.setView(EDITOR_VIEWS.FILLABLEFIELDS_PREVIEW),LayoutManager.loadLayout(LAYOUTS.FILLABLEFIELDSPREVIEW),e.publish("Document/ViewChanged","","");var i=editor.doc.docInfo;Z("topband-ff-docname").text(i.DOCUMENT_NAME),t.showLoadingMsg(J.i18n("editor","MAILMERGE.PREVIEW_LOADING_MSG")),editor.clientActiveSection=J("div.zw-contentpane")[0],EventHandler.toggleSection(),editor.getView()==EDITOR_VIEWS.FILLABLEFIELDS_PREVIEW&&editor.doc.setApplyConditionsForFillableFields(!0),e.publish("Document/FillableFieldsPreview"),e.subscribeOnce("Document/LoadingComplete",function(){Z("ffpreview-toolbarcontainer").find("[ctype=zmenu]").off("zmenuitemclick").on("zmenuitemclick",function(e,i){t._itemClicked(e,i)}),F(),H(),Y(),f=new FillableFieldsModel,re(),Ee(),t.hideLoadingMsg(),Z("fieldvc-menu-parent").hide(),J("#toggle-highlight-field").ztoggleswitch("switchOn"),J("#bbar-tc-switch").ztoggleswitch("disable"),e.publish("Esign/Init")}),editor.fetchDocument(Utils.getDocumentId(),"")}})},Ui=function(e){Ni()},xi=function(e,t){var i,n,o=J("#uploadImgFile")[0].files;if(o){var r=new FileReader;r.onload=function(){var e=new Image;e.onload=function(e){n={URL:e.currentTarget.src,WIDTH:100,HEIGHT:100,ORIG_WIDTH:e.currentTarget.width,ORIG_HEIGHT:e.currentTarget.height},Oi(this.src)&&(Ri(FILLABLEFIELD_TYPE.IMAGE,n),Ui(n))},e.src=this.result,i=this.result},r.readAsDataURL(o[0])}},Bi=!1,Hi=function(){var e=W.get("#uploadImgFile")[0],i=function(e){Ri(FILLABLEFIELD_TYPE.IMAGE,e.imgData)},n=function(){t.showMessage("error",J.i18n("writer.common.UNABLE_TO_INSERT_IMAGE"),"showclose","normalfont",3e3)},o=function(){i.apply(null,arguments),ZWImgLibDialog.close()},r=function(){n.apply(null,arguments),ZWImgLibDialog.close()};if(Bi||(e.addEventListener("change",xi.bind(null,o,r)),e.addEventListener("click",function(){e.value=""}),Bi=!0),editor.isOffline()&&ZWOffline.isOfflineOperationsAllowed()){var a=OfflineImpl.insertImageOffline();a.then(i,n)}else e.click()},Ji=function(e,t){var i=J("span[data-field-id|='"+t+"']");"mouseup"==e&&(i[0].style.cursor="pointer"),"mousedown"==e&&(i[0].style.cursor="move")},Gi=function(){J("#auto_insert_field_popup").zpopover("close"),t.detectFieldsUsingZLabsApi(ki,Wi)},ki=function(t){if(Macros.isMergeTemplate())return void e.publish("MailMerge/FieldDetected",t);var i=Yi(t);0==i.length?Vi("empty"):(zi(i),Vi("success",i.length))},Wi=function(){Vi("failure")},Yi=function(e){for(var t=[],i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++){var o=e[i][n],r={},a={},s={},l=o.top,d=o.left,c=o.width,u=o.height,p=o.type,g="singleline";switch("line"==p&&(p="textbox",u=18.933,l-=u),r.type="fillablefield",r.disabled=!1,p){case"checkbox":c=20,u=20,g="checkbox",s.checked=!1,s.size=20,r.helpText="Checkbox Field",r.ffType="checkbox";break;case"textbox":s.subType="singleline",s.value=" ",s.format="",s.maxLength=30,r.helpText="Text Field",r.ffType="textinput",g="singleline"}var f={},E={};f.left=d,f.from="page",f.type="absolute",E.top=l,E.from="page",E.type="absolute",r.positionH=f,r.positionV=E,r.wrapType="front",r.wid=c,r.ht=u,r.ffInfo=s,a.type=g,a.format=r,a.pageCount=i+1,t.push(a)}return t},zi=function(e){for(var t=editor.doc.getFormats(),i=editor.getDocument(),n=0;n<t.length;n++)t[n]&&"fillablefield"===t[n].type&&t[n].ffInfo&&i.getFieldById(t[n].id).remove();i.sync(),i=editor.getDocument();for(var o=i.getSelection().getRangeAt(0),n=0;n<e.length;n++){var o=editor.getDocument().createRange(),r=DocLayoutManager.getPageAtPageNumber(e[n].pageCount).getFirstParaView().getNodeEndIndex(),a=DocLayoutManager.getPageAtPageNumber(e[n].pageCount).getFirstParaView().getNodeStartIndex();o.start=a,o.end=r;var s=i.createFillableField(e[n].type);s.setFieldFormat(e[n].format),o.insertField(s)}i.sync()},Zi={merge:{FIELD_INSERT:"writer.mailmergepopup.AUTO_INSERT_MERGE_FIELDS",FIELD_INSERT_MSG:"writer.mailmergepopup.AUTO_INSERT_FIELDS_DESC",FIELD_INSERTED:"writer.mailmergepopup.MERGE_FIELDS_INSERTED",FIELD_INSERTED_MSG:"writer.mailmergepopup.MERGE_FIELDS_INSERTED_COUNT_INFO",FIELD_INSERT_ERROR:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR",FIELD_INSERT_ERROR_MSG:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR_MSG",FIELD_NOT_FOUND:"writer.mailmergepopup.MERGE_FIELDS_NOT_FOUND",FIELD_NOT_FOUND_MSG:"writer.fillablefields.FILLABLE_FIELDS_NOT_FOUND_MSG"},fillable:{FIELD_INSERT:"writer.fillablefields.AUTO_INSERT_FILLABLE_FIELDS",FIELD_INSERT_MSG:"writer.fillablefields.AUTO_INSERT_FIELDS_DESC",FIELD_INSERTED:"writer.fillablefields.FILLABLE_FIELDS_INSERTED",FIELD_INSERTED_MSG:"writer.fillablefields.FILLABLE_FIELDS_INSERTED_COUNT_INFO",FIELD_INSERT_ERROR:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR",FIELD_INSERT_ERROR_MSG:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR_MSG",FIELD_NOT_FOUND:"writer.fillablefields.FILLABLE_FIELDS_NOT_FOUND",FIELD_NOT_FOUND_MSG:"writer.fillablefields.FILLABLE_FIELDS_NOT_FOUND_MSG"}},Vi=function(e,t){l.init("auto_insert_field_popup");var i=J("#auto_insert_field_popup");i.zpopover("open");var n=Zi[Macros.isMergeTemplate()?"merge":"fillable"];"success"===e?(Z("ff-auto-insert-detect-div").hide(),Z("ff-auto-insert-message-div").show(),Z("ff-auto-insert-icon").removeClass("ui-wdialog-error"),Z("ff-auto-insert-icon").addClass("ui-wdialog-success"),J("#ff-auto-insert-heading")[0].innerText=J.i18n(n.FIELD_INSERTED),J("#ff-message-span")[0].innerText=J.i18n(n.FIELD_INSERTED_MSG,[t]),Z("ff-auto-insert-try-again-btn").hide(),Z("ff-auto-insert-done-btn").show()):"failure"===e?(Z("ff-auto-insert-detect-div").hide(),Z("ff-auto-insert-message-div").show(),Z("ff-auto-insert-icon").removeClass("ui-wdialog-success"),Z("ff-auto-insert-icon").addClass("ui-wdialog-error"),J("#ff-auto-insert-heading")[0].innerText=J.i18n(n.FIELD_INSERT_ERROR),J("#ff-message-span")[0].innerText=J.i18n(n.FIELD_INSERT_ERROR_MSG),Z("ff-auto-insert-done-btn").hide(),Z("ff-auto-insert-try-again-btn").show()):"empty"===e?(Z("ff-auto-insert-detect-div").hide(),Z("ff-auto-insert-message-div").show(),Z("ff-auto-insert-icon").removeClass("ui-wdialog-success"),Z("ff-auto-insert-icon").addClass("ui-wdialog-error"),J("#ff-auto-insert-heading")[0].innerText=J.i18n(n.FIELD_NOT_FOUND),J("#ff-message-span")[0].innerText=J.i18n(n.FIELD_NOT_FOUND_MSG),Z("ff-auto-insert-try-again-btn").hide(),Z("ff-auto-insert-done-btn").show()):(Z("ff-auto-insert-detect-div").show(),Z("ff-auto-insert-message-div").hide(),J("#ff-detect-heading")[0].innerText=J.i18n(n.FIELD_INSERT),J("#ff-detect-message")[0].innerText=J.i18n(n.FIELD_INSERT_MSG))},ji=function(e){if(9===e.keyCode){var t=e.shiftKey;e.preventDefault&&e.preventDefault();var i,o=k(t,M),r=editor.getDocument(),a=editor.doc.getSelection(),s=r.getFieldById(o),l=r.getFieldRange(s);s.isFillableImageField()&&(l.start=s.start,l.end=s.end),i=editor.doc.createRange(l.start,l.start),a.setSelectionType(I?SEL_KEYBOARD:SEL_MOUSE).removeAllRanges().addRange(i),n.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0]),M=o}},Xi=Z("fill-popover");!h&&I&&(document.addEventListener("keydown",ji,!1),editor.doc.setApplyConditionsForFillableFields(!0),e.subscribe("Document/BeforeModelUpdation",function(){re(),e.subscribeOnce("Document/AfterModelUpdation",function(){Ee(),Ot(),Dt(g)})}),e.subscribe("Cursor/Collapsed",function(){var t,i=editor.getDocument().getSelection().getRangeAt(0),n=i.getStartNode(),o=n.type===NODE_TYPE.FIELD_START&&n.getField()||n.rawFormat.cls===NODE_TYPE.FILLABLEFIELD&&(n.type===NODE_TYPE.IMAGE||n.type===NODE_TYPE.TEXTBOX)&&n;if(J(".ffield-selected").length>0&&J(".ffield-selected").trigger("dblclick"),Xi[0]||(Xi=Z("fill-popover")),ee(),!o||!o.isFillableField()||o.disabled||o.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_DISABLED]||editor.isOfflineMode||editor.isFinalDocument()||n.getNextSibling()&&Lock.isIdxInLockArea(n.getNextSibling().start,editorProps.userInfo.zuid))return ee(),void te();var r=editor.doc.getSelection();if(r.selectionType!==SEL_KEYBOARD&&r.selectionType!==SEL_MOUSE)return ee(),void te();switch(Ee(),g=o,E=J(editor.doc.getPortionData(g.isFillableImageField()?i.start+1:i.start+2).node),E.hasClass("tc-deletion")&&(E=In(g)),t=o.getFillableFieldType()){case FILLABLEFIELD_TYPE.RADIO:E.addClass("fillablefield-checkbox-anim"),setTimeout(function(){E.removeClass("fillablefield-checkbox-anim")},150);case FILLABLEFIELD_TYPE.MULTIPLECHOICE:case FILLABLEFIELD_TYPE.CHECKBOX:return;case FILLABLEFIELD_TYPE.SELECTBOX:z(o,E);break;case FILLABLEFIELD_TYPE.MULTILINE:case FILLABLEFIELD_TYPE.SINGLELINE:default:if(l.init("fill-popover_tooltip"),L.contains(g.getId()))return void fn(J("#ff-fill-input_1_"+g.getId())[0]);if(cn(o),t===FILLABLEFIELD_TYPE.MULTILINE){an(o,document.getElementById("fill-popover-elem"),E,!0),fe.hide(),ge.show();var a=E[0].offsetWidth,s=E[0].offsetHeight;ge.css("width",a),ge.css("height",s),setTimeout(function(){ge[0].focus({preventScroll:!0})},0),Rn(ge[0],!0)}else if(t===FILLABLEFIELD_TYPE.SINGLELINE||t===FILLABLEFIELD_TYPE.NUMBER||t===FILLABLEFIELD_TYPE.PHONE||t===FILLABLEFIELD_TYPE.EMAIL||t===FILLABLEFIELD_TYPE.PERCENT||t===FILLABLEFIELD_TYPE.CURRENCY){an(o,document.getElementById("fill-popover-elem"),E,!0),ge.hide(),fe.show();var a=E[0].offsetWidth,s=E[0].offsetHeight;fe.css("width",a),fe.css("height",s),setTimeout(function(){fe[0].focus({preventScroll:!0})},0),Rn(fe[0],!0)}else l.init("fill-popover"),l.init("fill-popover-cont"),Xi.zpopover("open",{target:E[0]});J(".ui-fillable-popover").css("z-index",1e3),t===FILLABLEFIELD_TYPE.SINGLELINE||t===FILLABLEFIELD_TYPE.MULTILINE||t===FILLABLEFIELD_TYPE.NUMBER||t===FILLABLEFIELD_TYPE.PHONE||t===FILLABLEFIELD_TYPE.EMAIL||t===FILLABLEFIELD_TYPE.PERCENT||t===FILLABLEFIELD_TYPE.CURRENCY?(sn(o,t,E),J("#fill-popover_tooltip").zpopover("open",{target:E[0]}),rn(o,t)):dt(o,t)}if(o.isFillableImageField()&&o.getFitType()===IMAGE_FIT_TYPE.FLUID){var d={idx:o.start};d.ev=event,e.publish("Image/Selected",o.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID],d)}M=g.getId()}));var Ki=function(e){g&&g.isFillableImageField()&&(g.getFitType()===IMAGE_FIT_TYPE.FLUID||g.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTILINE?(g.setFormats(e),Mt({width:e.wid,height:e.ht})):(g.style.cropRect=e.cropRect,Mt({cropRect:e.cropRect})),h?ne():editor.getDocument().sync())},qi=function(e){var t={URL:e.IMAGE_URL,WIDTH:event.currentTarget.width,HEIGHT:event.currentTarget.height,ORIG_WIDTH:e.IMAGE_WIDTH,ORIG_HEIGHT:e.IMAGE_HEIGHT};Ri(FILLABLEFIELD_TYPE.IMAGE,t),J("#insertimagedialog")&&J("#insertimagedialog").zdialog("close")},Qi=function(t){h&&g&&g.isFillableImageField()&&(g.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.SIGNATURE||g.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.INITIAL)&&e.publish("TransformableObject/Deselected","image",g.rawFormat.id)};e.subscribe("Document/fillableResize",Ki);var $i=function(t,i){var n=t.id,o=t.idx;FillableFieldsPanel.showFillableFieldPopup(o,n),i===FILLABLEFIELD_TYPE.IMAGE||i==FILLABLEFIELD_TYPE.SIGNATURE||i===FILLABLEFIELD_TYPE.INITIAL?e.publish("Image/Selected",n,{idx:o}):e.publish("Field/Selected",n,{idx:o})},en=function(e){var t=g.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTILINE,n=t?5:2,o=e.value,r=e.cols,a=o.split("\n"),s=a.length;for(i=0;i<a.length;i++)s+=parseInt(a[i].length/r);e.rows=s>n||t?n:s},tn=function(){J("#ff-highlight-toggleswitch").ztoggleswitch("getState");FillAutomationHandler.toggleFieldHighlight(null,{state:!1})},nn=function(e,t,i){var n=e||editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),o=editor.jeditorPane.offset(),r=n.offset(),a=n.height(),s=r.left-o.left-(t?J("#fill-popover-elem").width()/2:0),l=r.top-o.top;return i&&(l+=a),{offset:{top:l,left:s}}},on=function(e){if(e){Z("fill-popover_1_1").zpopover("close"),J("#fill-popover_1_"+e.getId()).zpopover("close"),fe&&fe.hide(),ge&&ge.hide(),J("#fill-popover_err_tooltip-"+e.getId()).zpopover("close");var t;(t=L.indexOf(e.getId()))>-1&&L.splice(t,1),Z("fill-popover_tooltip").zpopover("close"),fe&&fe[0].classList.remove("ui-ffefill-errfld")}},rn=function(e,t){var i,n=t===FILLABLEFIELD_TYPE.MULTILINE?e.start+1:e.getStart().start+1,o=editor.doc.getComputedFormatAt(n,NODE_TYPE.TEXT),r=editor.doc.getComputedFormatAt(n,NODE_TYPE.PARAGRAPH);for(var a in TEXT_ATTR){var s=TEXT_ATTR[a];o.hasOwnProperty(s)&&(i="font-size"===a?o[s]+"pt":o[s],t===FILLABLEFIELD_TYPE.MULTILINE?ge.css(a,i):t!==FILLABLEFIELD_TYPE.SINGLELINE&&t!==FILLABLEFIELD_TYPE.NUMBER&&t!==FILLABLEFIELD_TYPE.PHONE&&t!==FILLABLEFIELD_TYPE.EMAIL&&t!==FILLABLEFIELD_TYPE.PERCENT&&t!==FILLABLEFIELD_TYPE.CURRENCY||fe.css(a,i))}var l=r.hasOwnProperty(ATTR_PARAGRAPH.PS_DIR)?r[ATTR_PARAGRAPH.PS_DIR]:r[ATTR_PARAGRAPH.PS_DIR];t===FILLABLEFIELD_TYPE.MULTILINE?ge.css("direction",l):t!==FILLABLEFIELD_TYPE.SINGLELINE&&t!==FILLABLEFIELD_TYPE.NUMBER&&t!==FILLABLEFIELD_TYPE.PHONE&&t!==FILLABLEFIELD_TYPE.EMAIL&&t!==FILLABLEFIELD_TYPE.PERCENT&&t!==FILLABLEFIELD_TYPE.CURRENCY||fe.css("direction",l)},an=function(e,t,i,n,o){Z("fill-popover_1_1").zpopover("close");var r={id:1};i=i||pe;var a=(e.type===NODE_TYPE.TEXTBOX?e.start:e.getStart().start,nn(i));at.find("#fill-popover_1_"+r.id).length?i=e.getFillableFieldType()===FILLABLEFIELD_TYPE.MULTILINE?i:J(document.querySelector('span[data-field-id="'+e.getId()+'"]')):gn(at,r,!0),Z("fill-popover_1_1").zpopover("open",a),ge=J("#ff-fill-textarea_1_1"),fe=J("#ff-fill-input_1_1")},sn=function(e,t,i){var n=lt(e,t),o=n.mandatory;t===FILLABLEFIELD_TYPE.MULTILINE?(ge.val(n.value),ge.attr("maxlength",n.maxLength)):(""===n.value&&(n.value=editor.getDocument().getFieldById(e.getId()).rawFormat.ffInfo.value.trim()),fe.val(n.value),fe.attr("maxlength",n.maxLength)),J("#fill-popover_1_1_zpopover")[0].classList[o?"add":"remove"]("is-mandatory-field"),tt[0].innerText=n.label,it[0].innerText=n.helpText,nt[0].innerHTML="max <b>"+n.maxLength+" char</b>",""!==n.linkedCount?rt.show()&&(ot[0].innerText=n.linkedCount):rt.hide()},ln=function(e,t,i){if(" "==t)return t;switch(e.getFillableFieldType()){case FILLABLEFIELD_TYPE.CURRENCY:if(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.CURRENCY].test(t)&&" "!==t)return dn(e,C.ERROR_MSG.CHAR,i),!1;break;case FILLABLEFIELD_TYPE.DATE:break;case FILLABLEFIELD_TYPE.NUMBER:case FILLABLEFIELD_TYPE.PERCENT:if(t=X(e.getLocale(),t),t=t.replaceAll(",",""),FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.NUMBER].test(t)&&" "!==t)return dn(e,C.ERROR_MSG.NUMBER,i),!1;break;case FILLABLEFIELD_TYPE.PHONE:if(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.PHONE].test(t)&&" "!==t)return dn(e,C.ERROR_MSG.NUMBER,i),!1;break;case FILLABLEFIELD_TYPE.EMAIL:if(" "!==t&&!FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.EMAIL].test(t)&&" "!==t)return dn(e,C.ERROR_MSG.EMAIL,i),!1}return t},dn=function(e,t,i){cn(e),pn(e),Z("fill-popover_tooltip").zpopover("close");var n=J("#ffill-error-popover"),o={id:e.getId()};if(n.find("#fill-popover_err_tooltip-"+e.getId()).length)E=J(document.querySelector('span[data-field-id="'+o.id+'"]'));else{var r=Z("inline-fill-err-tooltip").html(),a=Handlebars.compile(r),s=J(a(o));n.append(s[0]),r=Z("inline-fill-err-msg").html(),a=Handlebars.compile(r);var d=J(a(o));s.append(d[0]),l.initElem(s)}fe[0].classList.add("ui-ffefill-errfld"),L.contains(e.getId())||L.push(o.id),i||(J("#error-msg-"+o.id)[0].innerText=t,J("#fill-popover_err_tooltip-"+e.getId()).zpopover("open",{target:E[0]}))},cn=function(e){J("#fill-popover_err_tooltip-"+e.getId()).zpopover("close")},un=function(e){if(ae){var t=ae.eq(he(e.isFillableImageField()?e.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]:e.id,e.getFillableFieldType())-1)[0];J(t).addClass("is-active")}},pn=function(e){var t=e.getFillableFieldType();if(t===FILLABLEFIELD_TYPE.SINGLELINE||t===FILLABLEFIELD_TYPE.NUMBER||t===FILLABLEFIELD_TYPE.PHONE||t===FILLABLEFIELD_TYPE.EMAIL||t===FILLABLEFIELD_TYPE.PERCENT||t===FILLABLEFIELD_TYPE.CURRENCY){var i={id:e.getId()},n=at.find("#fill-popover_1_"+i.id),o=fe.val()||W.get("#ff-fill-input_1_"+e.getId())[0].value;if(n.length)Z("fill-popover_1_1").zpopover("close"),E=J(document.querySelector('span[data-field-id="'+i.id+'"]'));else{Z("fill-popover_1_1").zpopover("close");var r=J(document.getElementById("ffill-props"));gn(r,i)}var a=nn(E),s=W.get("#ff-fill-input_1_"+i.id);J("#fill-popover_1_"+i.id).zpopover("open",a),J("#fill-popover_1_"+i.id+"_zpopover")[0].classList[e.isMandatory()?"add":"remove"]("is-mandatory-field"),Rn(s[0],!1),s.show(),J("#ff-fill-textarea_1_"+i.id).hide(),J("#fill-popover_1_1").zpopover("close");var l=E[0].offsetWidth,d=E[0].offsetHeight;s.css({width:l+"px",height:d+"px"}),fe=J("#ff-fill-input_1_"+i.id),ge=J("#ff-fill-textarea_1_"+i.id),fe.val(o),Rn(fe[0],!0),rn(e,t),M=i.id}},gn=function(e,t,i){var n=Z("inline-fill-popover").html(),o=Handlebars.compile(n),r=J(o(t));r.appendTo(e);var n=Z("inline-fill-popover-cont").html(),o=Handlebars.compile(n),a=J(o(t));r.append(a[0]),l.initElem(r),fe=J("#ff-fill-input_1_"+t.id),ge=J("#ff-fill-textarea_1_"+t.id)},fn=function(e){var t=e.getAttribute("id"),i=t.split("_")[2];1!==parseInt(i)&&(J("#fill-popover_1_1").zpopover("close"),fe=J(e),E=J(document.querySelector('span[data-field-id="'+i+'"]')),g=editor.getDocument().getFieldById(i),ln(g,fe.val()),fe.select())},En=function(){for(var e,t,i=editor.getDocument(),n=L.slice(),o=0;o<n.length;o++)t=n[o],e=i.getFieldById(t),fe=J("#ff-fill-input_1_"+t),ge=J("#ff-fill-textarea_1_"+t),on(e),fe[0].classList.remove("ui-ffefill-errfld")},Tn=function(){for(var e,t,i,n,o=editor.getDocument(),r=0;r<L.length;r++)e=L[r],t=o.getFieldById(e),J("#fill-popover_1_"+t.getId()).zpopover("close"),J("#fill-popover_err_tooltip-"+t.getId()).zpopover("close"),i=J(document.querySelector('span[data-field-id="'+t.getId()+'"]'))||E,n=nn(i),J("#fill-popover_1_"+t.getId()).zpopover("open",n)},mn=function(e,t){var i=(J(t),e.isChecked());h?Mt(!i):ie(e,!i)},hn=function(e,t){var i=editor.getDocument(),n=e.getName(),o=e.getFillableFieldType(),r=!1;return i.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(i){i&&i.getFillableFieldType()===o&&i[ATTR_FILLABLEFIELD.FF_NAME]&&i[ATTR_FILLABLEFIELD.FF_NAME]===n&&(e.getId()===i.getId()?(r=!0,i.setChecked(t)):i.getFillableFieldType()===FILLABLEFIELD_TYPE.RADIO&&(r=!0,i.setChecked(!1)))}),r},In=function(e){if(e){var t=editor.getDocument().getFieldRange(e);return J(editor.doc.getPortionData(e.isFillableImageField()?t.end-1:t.end-2).node)}},_n=function(e){if(e){var t=e.getName(),i=e.getFillableFieldType(),n=[];return editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){e&&e.getFillableFieldType()===i&&e[ATTR_FILLABLEFIELD.FF_NAME]&&e[ATTR_FILLABLEFIELD.FF_NAME]===t&&n.push(e)}),n}},An=function(){var e=function(e){for(var t=e.indexOf(UNICODE.MERGEFIELD_START),i={};t!=-1;){for(var n=e.indexOf(UNICODE.MERGEFIELD_END,t),o=e.substring(t+1,n),r=Object.keys(oe.allFillableFieldsInDoc),a=0;a<r.length;a++)oe.allFillableFieldsInDoc[r[a]].name===o&&(i[r[a]]=JSON.parse(JSON.stringify(oe.allFillableFieldsInDoc[r[a]])));t=e.indexOf(UNICODE.MERGEFIELD_START,n+1)}return i};return function(t){FillableFieldsHandler.listAllFields();var i={};if("object"==typeof t)for(var n=Object.keys(t),o=0;o<n.length;o++){var r={},a=t[n[o]];r=e(a),ZWJSONUtils.mergeJsonObjs(i,r)}else i=e(t);return i}}(),Sn=function(e){if("keydown"!==e.type||9===e.keyCode&&(!e.ctrlKey&&!e.metaKey||13===e.keyCode)){if("keyup"===e.type){if("TEXTAREA"===this.tagName)return FillableFieldsHandler.resizeTextArea(this),void FillableFieldsHandler.updateCharCount("tarea");if(13!==e.keyCode)return}else if("focus"===e.type)return void FillableFieldsHandler.updateCurrentPopup(this);FillableFieldsHandler.saveFilledValue(e)}},Rn=function(e,t){e&&J(e)[t?"on":"off"]("keyup keydown blur focus",Sn)};return{listAllFields:Ee,updateFieldsList:Ie,getFillableFieldInfo:u,saveFilledValue:yt,selectPreviousField:It,selectNextField:_t,sendFilledData:Ut,getFilledData:xt,getFieldIconClass:mt,updateCharCount:At,updateFieldNavigation:Ot,handleFieldNavigation:vt,showFieldNavigation:bt,fieldNavigationHover:Nt,fieldNavigationBlur:Pt,getFieldIconClass:mt,handleFillModePrint:Jt,getPDFInternalUrl:c,uploadDocToSign:Gt,handleSelfSigning:kt,handleFillSubmit:fi,openSelfSignDialog:Yt,cancelSelfSign:zt,sendForApproval:Zt,handlePreviewDocument:Xt,resetFillableFields:Kt,sendForSignFromPublisher:Qt,submitAndSendForSign:$t,clearFieldValues:pi,toggleTestMode:gi,insertImage:bi,removeImage:vi,insertSign:Di,removeSign:Li,handlePreFilledValues:yi,getPrefillOps:Fi,previewFilledDoc:wi,openHomePage:Ti,backToEditor:Mi,clearNavigationSelection:te,updatePermissionInfo:F,collectFilledImages:Ni,getFillMergeInfo:Ci,resetFieldsInfo:re,changeCursor:Ji,listAllFillableFields:Te,insertImageFromMachine:Hi,insertWebImage:qi,saveFilledValues:ti,handleDetectAndInsert:Gi,handleAutoInsertFieldsDialog:Vi,copyUrl:di,resizeTextArea:en,handleFieldHighlight:tn,selectFloatingField:$i,updateCurrentPopup:fn,getAllLinkedFields:_n,getSequenceNumberInfo:Bt,getFillableFieldsMappingInfo:An}}(PubSub,UIUtils,DomUtil,ZWNetworkUtils,ZWLogger,DocumentMap,PrintPreview,ZWComponentUtil,ZComponents),esignpanel=function(){var e={};e.signerDetails={};var t,i={},n={},o=function(t){var i=J.i18n("writer.common.NOT_AVAILABLE");t&&t.signature_src&&(e=t);var n=(new Date).getTime(),o=e.signerDetails.date_format&&new ZWDateTime(n).format(e.signerDetails.date_format.toUpperCase());J("#sign-preview")[0].innerHTML="",J("#sign-preview")[0].appendChild(a("signature",e.signature_src,i)),J("#initial-preview")[0].innerHTML="",J("#initial-preview")[0].appendChild(a("initial",e.initial_src,i)),J("#company-preview")[0].innerHTML="",J("#company-preview")[0].appendChild(r(e.signerDetails.company)),J("#firstname-preview")[0].innerHTML="",J("#firstname-preview")[0].appendChild(r(e.signerDetails.first_name)),J("#lastname-preview")[0].innerHTML="",J("#lastname-preview")[0].appendChild(r(e.signerDetails.last_name)),J("#jobtitle-preview")[0].innerHTML="",J("#jobtitle-preview")[0].appendChild(r(e.signerDetails.job_title)),J("#date-preview")[0].innerHTML="<span style='font-weight: bold;'>"+(o||i)+"</span>",UIUtils.hideLoadingMsg()},r=function(e){e||(e=J.i18n("writer.common.NOT_AVAILABLE"));var t=document.createElement(NODE_NAME.SPAN);return J(t).addClass("ui-semibold"),J(t).text(e),t},a=function(e,t,i){return s(e,i,"esign-prev-"+e,"data:image/png;base64,"+t)},s=function(e,t,i,n){t||(t=J.i18n("writer.common.NOT_AVAILABLE"));var o=document.createElement(NODE_NAME.IMAGE);return J(o).attr("src",n),J(o).css("max-width","100%"),J(o).css("max-height","100%"),J(o).attr("alt",t),o},l=function(t){e=t?t:e,e&&e.signature_src&&(LeftPanel.showSubPanel("subpanel-esign",ANIMATIONS.FLIPIN),o())},d=function(){e=ZSignController.getSignDetails()},c=function(){t||(t=J("#subpanel-esign"));var e=t.find("#esign-prev-signature")[0].children[0],o=t.find("#esign-prev-initial")[0].children[0];i.height=e.naturalHeight,i.width=e.naturalWidth,n.height=o.naturalHeight,n.width=o.naturalWidth},u=function(e){return c(),e===SIGNERFIELD_TYPE.SIGNATURE?i:n};return{open:function(t){t[0];UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),d(),e.signature_src&&(LeftPanel.showSubPanel("subpanel-esign",ANIMATIONS.FLIPIN),o())},showPanel:l,createImageSpan:s,showPreview:o,getSignImgProps:u}}(),AutomationHandler=function(){"use strict";var e,t,i={all:-1,YetToStart:-1,inprogress:53,completed:54,incompleted:3,scheduled:4,interrupted:5,FetchingData:6,DataFetchFailed:7,SendingDocFailed:8,Aborted:9,Cancelled:10,declined:56,expired:55,recalled:57,completed_new:36,sent_new:14,inprogress_new:15,failed_new:501,expired_new:502,recalled_new:1521,declined_new:1522},n={"-1":J.i18n("writer.common.INITIATED"),53:J.i18n("writer.common.IN_PROGRESS"),54:J.i18n("writer.common.COMPLETED"),4:J.i18n("writer.common.SCHEDULED"),5:J.i18n("writer.common.INTERRUPTED"),6:J.i18n("writer.common.INITIATED"),8:J.i18n("writer.common.FAILED"),55:J.i18n("writer.common.EXPIRED"),56:J.i18n("writer.common.DECLINED"),57:J.i18n("writer.sign.SIGNATURE_RECALLED"),9:J.i18n("writer.common.ABORTED"),10:J.i18n("writer.common.CANCELLED"),15:J.i18n("writer.common.IN_PROGRESS"),36:J.i18n("writer.common.COMPLETED"),14:J.i18n("writer.common.INITIATED"),501:J.i18n("writer.common.FAILED"),502:J.i18n("writer.common.EXPIRED"),1522:J.i18n("writer.common.DECLINED"),1521:J.i18n("writer.sign.SIGNATURE_RECALLED")},o={inprogress:"zbutton__icon ui-3dots-anim",inqueue:"zbutton__icon ui-mmstatus-progress-anim",scheduled:"zbutton__icon ui-clock-icon",failure:"zbutton__icon ui-sprit-lazy ui-icon-red-reload-sm",success:"zbutton__icon ui-sprit-lazy ui-icon-greentick-round-sm"},r={},a={},s=SignHandler.SIGN_SERVICE.ZOHOSIGN,l=!1,d=[],c=[],u=[],p=[],g=[],f={},E=['<a onclick="AutomationHandler.openDigiSignLogs()" class="ui-mouse-cursor ui-underline" style="color:black; text-decoration: underline;">',"</a>"],T="<center>"+J.i18n("common","SIGN_INITIATED")+"</center>"+(editorProps.isPublishToFill?"":J.i18n("writer.mailmergepopup.SIGN_INITIATED_BODY_MSG",E)),m={DONE:J.i18n("writer.common.DONE"),SIGN_INITIATED_MSG:J.i18n("writer.common.SIGN_INITIATED_MSG",["<b>","</b>","<b>","</b>"]),VIEW_LOGS:J.i18n("writer.common.VIEW_LOGS"),SIGN_WORKFLOW_INITIATED:J.i18n("writer.common.SIGN_WORKFLOW_INITIATED")},h={success:function(e){if(SignDlgHandler.hideProgressLoadingMsg(),SignDlgHandler.close(),Macros.isSignTemplate())if("string"==typeof e&&(e=JSON.parse(e)),e.sign_url){var t=e.sign_url,i={init:function(){J("#sign-yourself-iframe").attr("src",t)}};J.dialogutil.open("signyourselfdialog",null,i)}else MsgDialog.showMessage([m.VIEW_LOGS,m.DONE],CONST.SEVERITY_SUCCESS,m.SIGN_WORKFLOW_INITIATED,m.SIGN_INITIATED_MSG,null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:AutomationHandler.generateSignLogs()}},null,!0,!0);else ZAlertBanner.show({message:T,hideDelay:1e4,type:"success",isMessageHTMLEncoded:!0,closeButton:!0}),J(".zalertbanner").css("left","calc(40%)");if("string"==typeof e&&(e=JSON.parse(e)),e.signSettings){var n=JSON.parse(e.signSettings);n.common_attachments=n.cattachmentsInfo,PrepareDocumentHandler.setValues(n,PREPARE_DOCUMENT.OPERATION.SIGN)}var o=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.SIGN)||{};o.jobs_count=(o.jobs_count||0)+1,PrepareDocumentHandler.setValues(o,PREPARE_DOCUMENT.OPERATION.SIGN),ZWLogger.addToStatistics("Document sent for sign through automation."),PubSub.publish("Document/SignWorkflowInitiated")},fail:function(e,t,i){SignDlgHandler.hideProgressLoadingMsg();var n=JSON.parse(e);if(n.signSettings){var o=JSON.parse(n.signSettings);o.common_attachments=o.cattachmentsInfo,PrepareDocumentHandler.setValues(o,PREPARE_DOCUMENT.OPERATION.SIGN)}n.error_msg?SignDlgHandler.showNotificationMsg(n.error_msg):SignDlgHandler.isDialogOpened()?SignDlgHandler.showNotificationMsg(J.i18n("writer.common.SIGN_INITIATION_FAILED")):UIUtils.showToast({message:J.i18n("writer.common.SIGN_INITIATION_FAILED"),hideDelay:3e3,type:"error"})},setHeaders:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}},I=function(){SignDlgHandler.showProgressLoadingMsg(J.i18n("writer.mailmergepopup.PROCESSING"));var e={},t=SignDlgHandler.getSignInfo(),i=ZWNetworkUtils.getUrl("sign/"+s+"/settings");if(e=JSON.parse(t.actioninfo),USER_ROLE.PUBLIC===editorProps.userInfo.role&&editorProps.isPublishToFill||/SHAREDREAD|ANYONELINK_SHAREDREAD/.test(editorProps.userInfo.role)&&editorProps.isFillableForm){var n=JSON.stringify(FillableFieldsHandler.getFillableFieldInfo());n&&n.length>2&&(e.fillableFieldData=n)}if(USER_ROLE.PUBLIC===editorProps.userInfo.role&&editorProps.isPublishToFill){var o=FillableFieldsHandler.getFillMergeInfo("sign"),r=JSON.stringify(o.fillable_field_data);if(r&&r.length>2){var a={};a.fillable_field_data=o.fillable_field_data,e.fillableFieldData=JSON.stringify(a),delete o.fillable_field_data}o.actioninfo=e,t.fill_merge_data=JSON.stringify(o),delete t.actioninfo,i=ZWNetworkUtils.getUrl("filldata")}else t.actioninfo=JSON.stringify(e);J.ajaxUpload(i,t,h,"json")},_=function(){WDHandler.initialiseSaveAs(function(){PubSub.publish("MakeACopy/Open",{operation:["editor",!0]})})},A=function(){SignDlgHandler.showProgressLoadingMsg(J.i18n("writer.mailmergepopup.PROCESSING"));var e=editor.doc.docInfo.RID,t=ZWNetworkUtils.getNiceUrlPrefix(e)+"/automation/sign/fields",i=SignDlgHandler.getSignInfo();if(USER_ROLE.PUBLIC===editorProps.userInfo.role&&editorProps.isPublishToFill||/SHAREDREAD|ANYONELINK_SHAREDREAD/.test(editorProps.userInfo.role)&&editorProps.isFillableForm){var n=JSON.parse(i.actioninfo),o=FillableFieldsHandler.getFillMergeInfo("sign"),r=JSON.stringify(o.fillable_field_data);if(r&&r.length>2){var a={};a.fillable_field_data=o.fillable_field_data,n.fillableFieldData=JSON.stringify(a);var s=FillableFieldsHandler.getSequenceNumberInfo();Object.keys(s).length>0&&(n.sequence_number_info=JSON.stringify(s)),delete o.fillable_field_data}o.actioninfo=n,i.fill_merge_data=JSON.stringify(o),delete i.actioninfo,t=ZWNetworkUtils.getUrl("filldata")}J.ajaxUpload(t,i,h,"json")},S=function(){"undefined"!=typeof Workflow?Workflow.allowDefaultSignFlowBehaviour().done(function(){var e=J.i18n("writer.common.SIGNFLOW_UPDATE_MSG");MsgDialog.showMessage([J.i18n("writer.common.CONTINUE_ANYWAY"),J.i18n("writer.common.SIGNFLOW_CREATE_NEW")],CONST.SEVERITY_INFO,J.i18n("writer.common.SIGNFLOW_UPDATE_TITLE"),e,null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:R();break;case CONST.BUTTON_2_CLICKED:_()}})}).fail(function(){R()}):R()},R=function(){SignDlgHandler.open({isDigisign:!0,saveOnly:!1,isSelfSign:!0,callback:A,defaultValues:PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.SIGN),title:J.i18n("writer.common.SETUP_SIGN_WORKFLOW"),btns:[J.i18n("writer.common.SEND_FOR_SIGN")]})},O=function(){var e=function(){var e=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),t=e&&e.onsubmit.actions.contains("sign.configure"),i=editorProps.isPublishToFill&&e&&(t||e.onsubmit.submitter_permissions.contains("document.sign.send"));SignDlgHandler.open({isDigisign:!0,saveOnly:i,callback:Macros.isSignTemplate()||Macros.isFillableTemplate()?A:I,defaultValues:i?{}:PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.SIGN),title:J.i18n("writer.common.SETUP_SIGN_WORKFLOW"),btns:[J.i18n("writer.common.SEND_FOR_SIGN")]})},t={js:[jsCdnZWStaticPath+fingerPrintObj["js/writer_signerpanel_min_all.js"]]};return function(){zw.require(t,[],e)}}(),b=function(){"undefined"!=typeof Workflow?Workflow.allowDefaultSignFlowBehaviour().done(function(){var e=J.i18n("writer.common.SIGNFLOW_UPDATE_MSG");MsgDialog.showMessage([J.i18n("writer.common.CONTINUE_ANYWAY"),J.i18n("writer.common.SIGNFLOW_CREATE_NEW")],CONST.SEVERITY_INFO,J.i18n("writer.common.SIGNFLOW_UPDATE_TITLE"),e,null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:O();break;case CONST.BUTTON_2_CLICKED:_()}})}).fail(function(){O()}):O()},v=function(e,t){FetchHTML.get({callback:t,requestName:e,target:"#subpanel-container",requestURL:ZWNetworkUtils.getNiceUrlPrefix("toolbar/"+e)})},D=function(){return v("fill_automationpanel",function(){PubSub.publish("Esign/Init")}),Macros.isMergeTemplate()?void PubSub.publish("MailMerge/LoadLazyFiles",{action:"MailMergePanel.openPanel"}):Macros.isSignTemplate()?(LeftPanel.showAdvancedPanel({panelId:ELEM_ID.AUTOMATIONPANEL,animationType:ANIMATIONS.FADE_IN}),J("#automationPanel").addClass("ui-abs-loading-gif")&&J("#automationPanel").children().hide()&&PubSub.publish("digiSignpanel/showMenu",{operation:"automate-sign-dlg"}),void de()):Macros.isFillableTemplate()||editorProps.isFillableForm?(L(),void(Macros.isRemote()?(LeftPanel.addToMainPanel(ELEM_ID.INSERTFILLABLEFIELDS,"#menu-fillable"),PubSub.publish("subpanel-insertfillablefield/open",{operation:"insert_fillable_fields"})):(LeftPanel.showAdvancedPanel({panelId:ELEM_ID.AUTOMATIONPANEL,animationType:ANIMATIONS.FADE_IN}),J("#automationPanel").addClass("ui-abs-loading-gif")&&J("#automationPanel").children().hide()&&L()))):(LeftPanel.showSubPanel(ELEM_ID.AUTOMATIONPANEL,"FADEIN"),void J("#fillable-fields-help-btn").css("right","36px"))},L=function(e){LeftPanel.showAdvancedPanel({panelId:ELEM_ID.AUTOMATIONPANEL,animationType:ANIMATIONS.FADE_IN}),J("#automationPanel").addClass("ui-abs-loading-gif")&&J("#automationPanel").children().hide(),PubSub.publish("subpanel-insertfillablefield/open",{operation:"prepare_fillable_fields",ui_options:e}),Macros.isPDFDocument()&&Z("ff-on-submission-cont").addClass("ui-top-margin-small")},N=function(){var e,t,i;return function(){editor.isFinalDocument()?MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_WARNING,editorProps.deployment.writer,J.i18n("writer.common.FINAL_REVERT_MSG")):(Z("subpanel-digisign").length&&LeftPanel.showAdvancedPanel({panelId:"subpanel-digisign",animationType:Macros.isSignTemplate()?ANIMATIONS.FADE_IN:ANIMATIONS.FLIPIN,parentPanels:["automationPanel"]}),digisignpanel.initElems(),e&&t&&i||(e=J("#sign-automation-title,#sign-automation-buttons,#sign-automation-help"),t=J("#insert-digisign-title,#insert-digisign-help,#insert-digisign-note"),i=J("#sign-automation-title,#sign-preparation-buttons")),t.hide(),i.hide(),e.show(),digisignpanel.showSigners(),digisignpanel.resetSigner())}}(),P=function(){AutomationHandler.fetchPanels("posttoblogpanel",function(){LeftPanel.showAdvancedPanel({panelId:ELEM_ID.POSTTOBLOGPANEL,animationType:ANIMATIONS.FLIPIN,parentPanels:[ELEM_ID.AUTOMATIONPANEL]})})},C=function(){var e=J("<a>");e.attr("href",editorProps.urls.base_url+"/open/"+Macros.getRId()+"/signreports"),e.attr("target","_blank"),e.attr("rel","noreferrer noopener"),e.appendTo("body").get(0).click(),e.remove(),ZWLogger.addToStatistics("Sign logs viewed")},y=function(){var n=function(){UIUtils.hideLoadingMsg(),J("#sf-history-empty-view").show(),J("#sf-history-view").hide(),J(".ui-mmhistory").find("#dlgbutton0").disable()},o=function(e){J("#sf-history-empty-view").hide(),J("#sf-history-view").show(),J("#sf-history-view").html("");var t=oe().jobid;M(e)?l():n(),t&&c(t)},r=function(e){J.dialogutil.open("digisignjobsreportdlg","",{init:e.bind(null)})},s=function(e){e&&Object.keys(e).length?d()?o(e):r(o.bind(null,e)):d()?n():r(n)},l=function(){var n,o=!1;for(var r in a.jobs)if(n=a.jobs[r].status,o=n==i.inprogress||n==i.YetToStart||n==i.scheduled||n==i.inprogress_new||n==i.sent_new)break;o&&(clearInterval(e),e=setInterval(t,6e4))},d=function(){return DialogHandler.isDialogOpened("digisignjobsreportdlg")},c=function(e){for(var t=J(".ui-pstat-cont"),i=0,n=t.length;i<n;i++)if(t.eq(i).attr("data-jobid")==e){t[i].scrollIntoView(),t.eq(i).trigger("click");break}};return t=function(){clearInterval(e),d()&&F(s,!0)},function(){ne({}),F(s,!0),ZWLogger.addToStatistics("Sign logs viewed")}}(),F=function(e,t){t&&UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING"));var i=editorProps.userInfo.zuid,n=editor.doc.docInfo.RID,o=ZWNetworkUtils.getUrl("sign/jobinfo");J.ajax({type:"GET",global:!1,async:!0,url:o,data:{zuid:i,rid:n},dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:e.bind(null),error:function(e,t,i){UIUtils.hideLoadingMsg(),UIUtils.showToast({message:J.i18n("writer.common.FETCH_LOGS_ERROR"),hideDelay:3e3,type:"error"})}})},M=function(e){if(e=e.Jobs,a=new SignJobModel.SignJobCollection(e),!a.jobCount)return!1;var t=a.first(),i=new SignJobModel.SignJob(t),n=w(i);n.totalCount=a.jobCount,ne(n),54!=i.status&&36!=i.status?J(".ui-mmhistory").find("#dlgbutton0").disable():J(".ui-mmhistory").find("#dlgbutton0").enable(),d=J("#sf-history-view");var o=J("#sf-report-dialog-template").html(),r=Handlebars.compile(o),s=J(r(n));d.append(s),ZWComponentUtil.initElem(s),c=J("#sf-jobs-collection-container"),u=J("#sf-job-view-container");var l=J("<div></div>");l.attr("class","js-mm-job-item-container ui-pstat-cont-active"),o=J("#sf-jobs-item-view-template").html(),r=Handlebars.compile(o),s=J(r(n)),l.append(s),J(c[0].firstChild).append(l),ZWComponentUtil.initElem(l),o=J("#sf-job-history-template-old").html(),r=Handlebars.compile(o),s=J(r(n)),u.append(s),ZWComponentUtil.initElem(s),p=J("#sf-jobs-history-collection-container"),g=J("#js-sf-job-options"),J(l[0].firstChild).trigger("click");for(var f in a.jobs)if(f!=a.first().job_id){var E=a.getJob(f);i=new SignJobModel.SignJob(E),n=w(i),n.inFocus=!1;var l=J("<div></div>");l.attr("class","js-mm-job-item-container"),o=J("#sf-jobs-item-view-template").html(),r=Handlebars.compile(o),s=J(r(n)),l.append(s),J(c[0].firstChild).append(l),ZWComponentUtil.initElem(s)}return J(".mm-cprogress").zcircularprogress(),ZComponents.init(J("#sfHistoryJobList"),null,"ctype"),ZComponents.init(J("#sf-job-history"),null,"ctype"),!0},w=function(e){var t,r=e.details,a=Object.keys(r.signedDocInfo).length?r.signedDocInfo:null,s=e.status,l=0,d="ui-mm-initiated-msg",c=B(e),u=r.is_sequential,p=!!Object.keys(r.sign_result_info).length,g=!!Object.keys(r.storeattachmentinfo).length,E=!!Object.keys(r.emailinfo).length,T=!!Object.keys(r.customfunctioninfo).length,m=p&&r.sign_result_info.recipients_status_info||[],h=[];f[e.job_id]&&(s=e.status=i[f[e.job_id]])&&(m=[]);for(var I=0,_=m.length;I<_;I++)h[m[I].signing_order]=m[I],"SIGNED"==m[I].action_status&&l++;var A={};A.inFocus=!1,A.jobid=e.job_id,A.username=r.job_user||e.zid,A.dateString=c.dateString,A.created_time=e.scheduled_time,A.version=r.doc_version,A.isJobFailed=54!=s&&53!=s&&36!=s&&15!=s,A.isJobInprogress=53==s||54==s||15==s||36==s,A.completedRecords=l,A.totalRecords=r.recipients.length,A.completedRecordsPercentage=A.completedRecords/A.totalRecords*100|0,A.status=s,A.titleClass=d,A.titleText=n[s]||J.i18n("writer.common.INITIATED"),A.recordsColumnName=J.i18n("writer.common.ACTIVITY"),A.isRecordListing=!0,A.isMailJob=!0,A.isSignPresent=!1,A.isShowFilter=!1,A.scheduleMsg=c.scheduleMsg,A.canShowOptions=54!=e.status&&36!=e.status,A.index=1;for(var S={},R={},I=0,_=h.length;I<_;I++)R[I]={},R[I].status="SIGNED"==h[I].action_status?2:"UNOPENED"!=h[I].action_status&&"VIEWED"!=h[I].action_status&&u?0:1,R[I].recipient_email=h[I].recipient_email,R[I].mailedTime=x(h[I].mailed_time||(new Date).getTime()),R[I].signedTime=x(h[I].signed_time||(new Date).getTime()),R[I].signStatusText="declined"==r.sign_result_info.status?J.i18n("writer.common.SIGN_DECLINED"):"expired"==r.sign_result_info.status?J.i18n("writer.common.SIGN_EXPIRED"):J.i18n("writer.sign.WAITING_FOR_SIGN"),R[I].signFailed=!!/declined|expired/.test(r.sign_result_info.status),R[I].order=parseInt(h[I].signing_order)+1;if(i.YetToStart==s||i.sent_new==s?(d="ui-mm-initiated-msg",t=o.scheduled,A.folder_statusIconClass=o.scheduled,A.email_statusIconClass=A.execute_statusIconClass=o.scheduled):i.inprogress==s||i.inprogress_new==s||i.FetchingData==s?(d="ui-mm-progress-msg",t=o.inprogress,A.folder_statusIconClass=o.inprogress,A.email_statusIconClass=A.execute_statusIconClass=o.inprogress):i.scheduled==s?(d="ui-mm-schedule-msg",t=o.scheduled,A.folder_statusIconClass=o.scheduled,A.email_statusIconClass=A.execute_statusIconClass=o.scheduled):i.interrupted==s||i.SendingDocFailed==s||i.Aborted==s||i.declined==s||i.recalled==s||i.expired==s||i.Cancelled==s||i.expired_new==s||i.recalled_new==s||i.declined_new==s||i.failed_new==s?(d="ui-mm-failed-msg",t=o.failure,A.folder_statusIconClass=o.failure,A.email_statusIconClass=A.execute_statusIconClass=o.failure):i.completed!=s&&i.incompleted!=s&&i.completed_new!=s||(d="ui-mm-completed-msg",t=o.success,A.folder_statusIconClass=o.success,A.email_statusIconClass=A.execute_statusIconClass=o.success),S[0]={},S[0].isSignProgressStarted=!0,S[0].recipientsInfo=R,S[0].documentCreated=!!a,S[0].rid=e.resource_id,S[0].jobid=e.job_id,S[0].statusText=null,S[0].name=a?a.filename:"",S[0].isAttachmentAvailable=!!a,S[0].filepath=a?a.filepath:"",S[0].canShowAttachmentIcon=!1,S[0].statusIconClass=t,S[0].title=n[s]||J.i18n("writer.common.INITIATED"),S[0].hiddenrecipients=0,A.isJobInprogress&&(S[0].isJobInProgress=A.isJobInprogress,S[0].sign_document_link=editorProps.options.zohoSignLoginUrl+"/zs#/request/details/"+r.sign_result_info.id),8==s||501==s||p&&"failure"==r.sign_result_info.status?S[0].actionTitle=J.i18n("writer.common.SIGN_ERROR_TITLE")+" "+(p?r.sign_result_info.error_msg:""):s==i.recalled||s==i.recalled_new?S[0].actionTitle=J.i18n("writer.common.DOCUMENT_RECALLED"):p?S[0].actionTitle=J.i18n("writer.common.SIGN_ACTION_TITLE")+":":(S[0].actionTitle=J.i18n("writer.common.SIGN_PROGRESS_TITLE",[editorProps.deployment.zohosign]),S[0].statusIconClass=o.inprogress),S[0].isSendingFailed=8==e.status||501==e.status,A.titleClass=d,A.data=S,A.title=n[s]||J.i18n("writer.common.INITIATED"),A.emailTitle=n[s]||J.i18n("writer.common.INITIATED"),A.saveTitle=n[s]||J.i18n("writer.common.INITIATED"),A.isEmailFailed=!1,A.isSaveFailed=!1,A.isFolderStore=g,A.isEmail=E,A.isExecuteFailed=!1,A.isExecute=T,A.executeTitle=s==-1?J.i18n("writer.common.SCHEDULED"):n[s]||J.i18n("writer.common.SCHEDULED"),g?(A.folder_name=r.storeattachmentinfo.foldername,A.folder_url="https://"+editorProps.urls.docsApiURL+"/folder/"+r.storeattachmentinfo.folderid,A.index+=1,A.folder_status_msg=J.i18n("writer.common.DOCUMENT_STORED")):(A.folder_name="",A.folder_statusIconClass=o.failure,A.saveTitle=n[57]),E?(A.index+=1,A.emailRecipients=H(r.emailinfo.recipients)):(A.email_statusIconClass=o.failure,A.emailTitle=n[57],A.emailRecipients=""),T?(A.index+=1,A.customFuncName=r.customfunctioninfo.custom_function_name):(A.execute_statusIconClass=o.failure,A.executeTitle=n[57],A.customFuncName=""),(54==s||36==s)&&Object.keys(r.operationStatus).length){var O=r.operationStatus.emailStatus,b=r.operationStatus.saveAttachmentStatus,v=r.operationStatus.executeFunctionStatus;if(b&&!b.SUCCESS&&(A.folder_statusIconClass=o.failure,A.saveTitle=n[57],A.isSaveFailed=!0,"no_permission"==b.errormsg&&(A.folder_status_msg=J.i18n("writer.common.NO_FOLDER_PERMISSION"))),b.SUCCESS&&b.folder_link&&(A.folder_link=b.folder_link),O&&!O.SUCCESS)A.email_statusIconClass=o.failure,A.emailTitle=n[57],A.isEmailFailed=!0;else for(var I=1,_=Object.keys(O||{}).length;I<_;I++)O&&!O["EmailStatus"+I]&&(A.email_statusIconClass=o.failure,A.emailTitle=n[57],A.isEmailFailed=!0);v&&!v.SUCCESS&&(A.execute_statusIconClass=o.failure,A.executeTitle=n[57],A.isExecuteFailed=!0)}return A},x=function(e){var t=new ZWDateTime(e);return t.setLocale("en-US"),t.format("EEEE - MMM DD YYYY hh:mm A")},B=function(e){var t=new Date(e.scheduled_time),i=(new Date).getTime(),n={},o=t.valueOf()-i.valueOf(),r=Math.round(o/1e3/60/60);r=0==r?Math.round(o/1e3/60)+" "+J.i18n("writer.common.MINUTES"):r+" "+J.i18n("writer.common.HOURS");var a=J.i18n("writer.mmjobhistory.JOB_SCHEDULE_STATUS",[r])+".";return n.scheduleMsg=a,n.dateString=t.toDateString(),n},H=function(e){for(var t="",i=e.length,n=0;n<i;n++)t+=e[n],t+=n==i-2?" & ":n==i-1?"":", ";return t},G=function(e){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),J(".js-mm-job-item-container").removeClass("ui-pstat-cont-active"),J(J(e)[0].parentNode).addClass("ui-pstat-cont-active");var t,i,n,o=J(e).attr("data-jobid"),r={},s={};for(var l in a.jobs)a.jobs[l]&&a.jobs[l].job_id==o&&(r=a.jobs[l]);s=w(r),ne(s),54!=r.status&&36!=r.status?J(".ui-mmhistory").find("#dlgbutton0").disable():J(".ui-mmhistory").find("#dlgbutton0").enable(),t=J("#sf-job-history-template-old").html(),i=Handlebars.compile(t),n=J(i(s)),u.html(n),ZWComponentUtil.initElem(n),p=J("#sf-jobs-history-collection-container"),t=J("#sf-job-history-collection-template").html(),i=Handlebars.compile(t),n=J(i(s)),p.html(n),ZWComponentUtil.initElem(n),ZComponents.init(J("#sfHistoryJobList"),null,"ctype"),ZComponents.init(J("#sf-job-history"),null,"ctype"),UIUtils.hideLoadingMsg()},k=function(e){var t=oe();if(54==t.status||36==t.status){var i=("object"==typeof e?t.jobid:e)||t.jobid,n=editorProps.userInfo.zuid,o=ZWNetworkUtils.getNiceUrlPrefix("digisign/job/"+i+"/user/"+n+"/attachment/download");Y(o)}},Y=function(e){var t=J("#digisignIFrame");t.length||(t=J("<iframe>"),t.attr("id","digisignIFrame"),t.attr("name","digisignIFrame"),t.css({width:0,height:0,position:"absolute",top:"-1000px"}),J("body").append(t)),J("<form></form>").attr("action",e).attr("target","digisignIFrame").appendTo("body").submit().remove()},z=function(){var e=function(e,t,i,n){var o=e&&e.RESPONSE;"FAILED"==o?"NO_JOBS"==e.REASON&&Notification.show({container:"#sf-jobhistory-notify-container",message:"writer.mmjobhistory.NO_JOBS_COMPLETED",type:"error"}):Notification.show({container:"#sf-jobhistory-notify-container",message:"writer.mmjobhistory.UNABLE_TO_CLEAR_JOBS",type:"error"})},t=function(e){var t=e.RESPONSE;"FAILED"==t?"NO_JOBS"==e.REASON&&Notification.show({container:"#sf-jobhistory-notify-container",message:"writer.mmjobhistory.NO_JOBS_COMPLETED",type:"error"}):(Notification.show({container:"#sf-jobhistory-notify-container",message:"writer.common.DONE",type:"success"}),V(e.clearedjobs))},i=function(){Notification.show({container:"#sf-jobhistory-notify-container",message:"writer.mailmergepopup.PROCESSING",type:"info"});var i={};J.ajax({data:i,type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix("doc/digisign/"+editor.doc.docInfo.RID+"/job/clearcomplete"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:e.bind(null),success:t.bind(null)})},n=function(){MsgDialog.showMessage([J.i18n("writer.common.CLEAR"),J.i18n("writer.common.CANCEL")],CONST.SEVERITY_WARNING,J.i18n("writer.mmjobhistory.CLEAR_COMPLETED_JOBS"),J.i18n("writer.editor.MAILMERGE.JOB_DELETION_CONFIRMATION"),void 0,void 0,function(e){switch(e){case CONST.BUTTON_1_CLICKED:i();break;case CONST.BUTTON_2_CLICKED:}})};return function(){n()}}(),V=function(e){if(e&&e.length){var t=!1,i=e.length,n=a.jobCount,o=J(".js-mm-job-item-container");if(U.each(e,function(e){e==oe().jobid&&(t=!0);for(var i in a.jobs)a.jobs[i]&&a.jobs[i].job_id==e&&a.remove(e);for(var n=0,r=o.length;n<r;n++)J(o[n].firstChild).attr("data-jobid")==e&&o[n].remove()}),t){var r=J(".js-mm-job-item-container");r.removeClass("ui-pstat-cont-active"),r[0]&&(J(r[0]).addClass("ui-pstat-cont-active"),J(r[0].firstChild).trigger("click"))}i==n&&(J("#sf-history-view").hide(),J("#sf-history-empty-view").show(),J(".ui-mmhistory").find("#dlgbutton0").disable()),X()}},j=function(){var e,t=function(t){var n=t.recall_status;if("success"==n)Notification.show({container:"#sf-jobsreport-notify-container",message:"writer.common.DOCUMENT_RECALLED",type:"success"}),re().getJob(e).status=i.recalled,f[e]="recalled";else{Notification.show({container:"#sf-jobsreport-notify-container",message:"writer.common.SIGN_RECALL_FAILED",type:"error"}),J("#sf-jobsreport-recall-btn").enable();var o=parseInt(J("#sign-yourself-btn").find(".zbutton__badge")[0].innerText)||0;J("#sign-yourself-btn").znotificationmenubutton("setAttribute","badgeText",o+1)}},n=function(e){e.recall_status;J("#sf-jobsreport-recall-btn").enable(),Notification.show({container:"#sf-jobsreport-notify-container",message:"writer.common.SIGN_RECALL_FAILED",type:"error"});var t=parseInt(J("#sign-yourself-btn").find(".zbutton__badge")[0].innerText)||0;J("#sign-yourself-btn").znotificationmenubutton("setAttribute","badgeText",t+1)},o=function(){Notification.show({container:"#sf-jobsreport-notify-container",message:"writer.mailmergepopup.PROCESSING",type:"info"}),e=oe().jobid;var i={},o=re().getJob(e);return i.request_id=o.details.sign_result_info.id,i.request_id?(J("#sf-jobsreport-recall-btn").disable(),void J.ajax({data:i,type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix(""+editor.doc.docInfo.RID+"/sign/"+s+"/recall"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:n.bind(null),success:t.bind(null)})):void Notification.hide()},r=function(){MsgDialog.showMessage([J.i18n("writer.common.YES_RECALL"),J.i18n("writer.common.NO_DONT")],CONST.SEVERITY_WARNING,J.i18n("writer.common.RECALL_WARNING_TITLE"),J.i18n("writer.common.RECALL_WARNING_MSG"),void 0,void 0,function(e){switch(e){case CONST.BUTTON_1_CLICKED:o();break;case CONST.BUTTON_2_CLICKED:var t=parseInt(J("#sign-yourself-btn").find(".zbutton__badge")[0].innerText)||0;J("#sign-yourself-btn").znotificationmenubutton("setAttribute","badgeText",t+1)}})};return function(){r()}}(),X=function(){J("#sf-history-totaljobcount-cont").text(J.i18n("writer.mmjobhistory.TOTAL_JOBS")+": "+a.jobCount)},K=function(e){e=e||oe();var t=e.jobid,i=ZWNetworkUtils.getNiceUrlPrefix("digisign/email/job/"+t+"/downloadreport");Y(i)},q={subject:"",message:"",jobId:"",mailContent:"",enc_jobid:""},Q=function(e){var t=J("#sf-job-sharereport-toemail");t.ztokenfield("setAttributes",{dataSource:e||[]})},$=function(e){e=e||oe();var t=e.jobid,i=e.data[0].name;q.jobId=t;var n={init:function(){q.subject="",q.message="",Q([]),window.Contacts&&Contacts.getContacts().done(Q)},get:function(e,n){return"subject"==e.action?q.subject:"mailContent"==e.action?q.mailContent:"attachment_name"==e.action?i+"-"+t:void 0},set:function(e,t,i){"subject"==e.action?q.subject=t:"mailContent"==e.action&&(q.mailContent=t)}};J.dialogutil.open("digisign_sharejobreport",void 0,n)},ee=function(e){for(var t=[],i=e.ztokenfield("getAllValues"),n=0;n<i.length;n++){var o=i[n];t.push(o.email||o.id)}return t},te=function(){Notification.show({container:"#sf-jobshare-notify",message:"writer.mailmergepopup.PROCESSING",type:"info"});var e={};e.subject=q.subject,e.mailContent=q.mailContent;var t=ee(J("#sf-job-sharereport-toemail"))+"";e.emailId=t,J.ajax({data:e,type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix("digisign/email/job/"+q.jobId+"/sharereport"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(e,t,i){Notification.show({container:"#sf-jobshare-notify",message:"writer.common.EMAIL_FAIL",type:"error"})},success:function(e){Notification.show({container:"#sf-jobshare-notify",message:"writer.mailmergepopup.EMAILSENTSUCCESS",type:"success"})}})},ie=function(){var t=function(e,t,i){var n=this,o=n.action;delete n.action,UIUtils.hideLoadingMsg(),"save"==o?UIUtils.showToast({message:J.i18n("writer.common.RETRYING_SAVE_FAILED"),hideDelay:3e3,type:"error"}):"email"==o?UIUtils.showToast({message:J.i18n("writer.common.RETRYING_EMAIL_FAILED"),hideDelay:3e3,type:"error"}):"send"==o&&UIUtils.showToast({message:J.i18n("writer.common.RETRYING_SEND_FAILED"),hideDelay:3e3,type:"error"})},i=function(t){var i=this,r=i.jobid||"",s=i.action;if(delete i.action,"save"==s){t&&t.SUCCESS?(i.folder_statusIconClass=o.success,i.saveTitle=n[54]):UIUtils.showToast({message:J.i18n("writer.common.RETRYING_SAVE_FAILED"),hideDelay:3e3,type:"error"});for(var l in a.jobs)a.jobs[l]&&a.jobs[l].job_id==r&&a.jobs[l].details&&(a.jobs[l].details.operationStatus.saveAttachmentStatus=t)}else if("email"==s){if(t&&t.SUCCESS){i.email_statusIconClass=o.success,i.emailTitle=n[54];for(var d=1,c=Object.keys(t).length;d<c;d++)t["EmailStatus"+d]||(i.email_statusIconClass=o.failure,i.emailTitle=n[57])}else UIUtils.showToast({message:J.i18n("writer.common.RETRYING_EMAIL_FAILED"),hideDelay:3e3,type:"error"});for(var l in a.jobs)a.jobs[l]&&a.jobs[l].job_id==r&&a.jobs[l].details&&(a.jobs[l].details.operationStatus.emailStatus=t)}else if("execute"==s){t&&t.SUCCESS?(i.execute_statusIconClass=o.success,i.executeTitle=n[54]):UIUtils.showToast({message:J.i18n("writer.common.RETRYING_EXECUTE_FAILED"),hideDelay:3e3,type:"error"});for(var l in a.jobs)a.jobs[l]&&a.jobs[l].job_id==r&&a.jobs[l].details&&(a.jobs[l].details.operationStatus.executeStatus=t)}else if("send"==s){if(t&&"success"==t.response){for(var l in a.jobs)a.jobs[l]&&a.jobs[l].job_id==r&&a.jobs[l].details&&(a.jobs[l].details.sign_result_info=t.sign_result_info,a.jobs[l].status=-1);for(var u=J(".ui-pstat-cont"),d=0,c=u.length;d<c;d++)u.eq(d).attr("data-jobid")==r&&u.eq(d).trigger("click")}else UIUtils.showToast({message:J.i18n("writer.common.RETRYING_SEND_FAILED"),hideDelay:3e3,type:"error"});return}UIUtils.hideLoadingMsg(),ne(i);var p=J("#sf-jobs-history-collection-container"),g=J("#sf-job-history-collection-template").html(),f=Handlebars.compile(g),E=J(f(i));p.html(E),ZWComponentUtil.initElem(E),clearInterval(e)};return function(e){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING"));var n=oe()||{},o={},r=n.jobid||"";o.jobid=r,o.zuid=editorProps.userInfo.zuid,o.action=e,o.docname=n.data[0].name,o.filepath=n.data[0].filepath,n.action=e,J.ajax({data:o,type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix("digisign/job/"+r+"/report/retry"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:t.bind(n),success:i.bind(n)})}}(),ne=function(e){r=e},oe=function(){return r},re=function(){return a||(a=new SignJobModel.SignJobCollection({}))},ae=function(e){var t,i=J(e).parents(".ui-sstatus-blk").attr("data-job_id"),n=a.getJob(i),o={};t=n.resource_id,o.job_id=i;var r=ZWNetworkUtils.getNiceUrlPrefix(t+"/sign/selfsigninfo");J.ajax({type:"GET",url:r,data:o,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){var t=e.signresponse;UIUtils.hideLoadingMsg(t),"string"==typeof t&&(e=JSON.parse(t));var i=t.sign_url;SignHandler.openSelfSign(i);var n=parseInt(J("#sign-yourself-btn").find(".zbutton__badge")[0].innerText),o=n-1;J("#sign-yourself-btn").znotificationmenubutton(n?"showBadge":"hideBadge"),J("#sign-yourself-btn").znotificationmenubutton("setAttribute","badgeText",o)},error:function(e,t,i){UIUtils.hideLoadingMsg(),UIUtils.showToast({message:J.i18n("writer.common.SIGN_INITIATION_FAILED"),hideDelay:3e3,type:"error"})}})},se=function(e){if(!a.jobCount)return!1;var t,i=J(e).parents(".ui-sstatus-blk").attr("data-job_id"),t=a.getJob(i),n=w(t);n.totalCount=a.jobCount,ne(n),j();var o=parseInt(J("#sign-yourself-btn").find(".zbutton__badge")[0].innerText),r=o-1;J("#sign-yourself-btn").znotificationmenubutton(o?"showBadge":"hideBadge"),J("#sign-yourself-btn").znotificationmenubutton("setAttribute","badgeText",r)},le=function(e){var t=0;if(a=e?new SignJobModel.SignJobCollection(e.Jobs):re(),Object.keys(a).length&&Object.keys(a.jobs).length){var i=a.jobs;for(var n in i){var o=i[n].details.recipients[0].recipient_1;o===editorProps.userInfo.email&&(!i[n].details.recipients[0].is_embedded||15!=i[n].status&&53!=i[n].status||(t+=1))}}ce(t)},de=function(){var e=SignHandler.fetchAccountDetails(s);e.done(function(e){var t=e.license_type;"Enterprise"===t&&(l=!0,Z("sign_yourself").removeClass("ui-state-disabled"),F(le,!1))})},ce=function(e){return e?(J("#sign-yourself-btn").znotificationmenubutton("showBadge"),void J("#sign-yourself-btn").znotificationmenubutton("setAttribute","badgeText",e)):void J("#sign-yourself-btn").znotificationmenubutton("hideBadge")},ue=function(){var e=function(e){return'<div class="ui-sstatus-blk" data-job_id='+e.job_id+"><div>"+e.toBeSignedText+'</div><div class="ui-clr-light-lbl font-italic ui-display-inblock" title="'+e.signedTime+'"  data-title-position="bottom-left">'+e.datatime+'</div><div class="ui-flex-container ui-top-margin-xl ui-flex-hend"><button type="button" class="ui-sstatus-btn ui-sstatus-btn__cancel" onclick="AutomationHandler.recallPendingSignJob(this)">'+e.cancelTxt+'</button><button type="button" class="ui-sstatus-btn ui-left-margin-small" onclick="AutomationHandler.initiatePendingSign(this)">'+e.signTxt+"</button></div></div>"},t=function(e){var t={},i=new ZWDateTime(e.scheduled_time,null,editorProps.userInfo.language);return t.dateString=i.format("EEEE DD MMM YYYY hh mm"),t.dateTime=Utils.getTimeFromNow(e.scheduled_time),t},i=function(){var t={},i="",n=re(),t={},r=!1;if(Object.keys(n.jobs).length){W(document.getElementById("sign-separator")).show(),W(document.getElementById("sign-pending-list")).show();var a=n.jobs,s=0;for(var l in a){var d=a[l].details.recipients[0].recipient_1;d===editorProps.userInfo.email&&(!a[l].details.recipients[0].is_embedded||15!=a[l].status&&53!=a[l].status||(t=o(a[l]),i+=e(t),r=!0,s+=1))}r||(W(document.getElementById("sign-separator")).hide(),W(document.getElementById("sign-pending-list")).hide()),ce(s),document.getElementById("pending_sign_txt").innerText=1===s?J.i18n("writer.sign.AWAITING_SELF_SIGN_TXT",[s]):J.i18n("writer.sign.DOCUMENTS_AWAITING_SELF_SIGN_TXT",[s]);var c=document.getElementById("sign_progress_block");c.innerHTML=i}else W(document.getElementById("sign-separator")).hide(),W(document.getElementById("sign-pending-list")).hide()},n=function(e){if(UIUtils.hideLoadingMsg(),e){var t=e.Jobs;a=new SignJobModel.SignJobCollection(t),i()}},o=function(e){var i,n=e.details,o=t(e),r={};return r.recipients=n.recipients,r.totalRecord=n.recipients.length,i=1===n.recipients.length?J.i18n("writer.sign.ONLY_ME"):J.i18n("writer.sign.ME_AND_OTHERS",[n.recipients.length-1]),r.toBeSignedText=i,r.signedTime=o.dateString,r.datatime=o.dateTime,r.job_id=e.job_id,r.cancelTxt=J.i18n("writer.sign.CANCEL_SIGN"),r.signTxt=J.i18n("writer.sign.SIGN_NOW"),r},r=function(){var e=SignHandler.fetchAccountDetails(s);e.done(function(e){l()&&(F(n,!1),Z("sign_yourself").removeClass("ui-state-disabled"))})},l=function(){var e=SignHandler.SIGN_SERVICE.ZOHOSIGN,t=SignHandler.getAccountDetails(e);if(!Object.keys(t).length)return r(),!1;var i=t.license_type;return"Enterprise"===i};return function(){W(document.getElementById("sign-separator")).hide(),W(document.getElementById("sign-pending-list")).hide(),l()&&F(n,!1)}}();return{sendForSign:I,openSelfSignDlg:S,openSignDlg:b,openSignPanel:N,openBlogPostPanel:P,openAutomationPanel:D,openFillAutomationPanel:L,fetchPanels:v,openDigiSignLogs:C,refreshLogs:t,generateSignLogs:y,downloadAttachment:k,clearCompletedJobs:z,recallDocument:j,shareReport:te,openShareDialog:$,downloadReport:K,jobSelectionHandler:G,handleRetry:ie,getCurrentViewingJobInfo:oe,fetchLogs:F,getJobsCollection:re,pendingSelfSign:ue,initiatePendingSign:ae,recallPendingSignJob:se,getEmailsFromTokenField:ee}}(),FillAutomationHandler=function(){"use strict";var e,t,i,n,o={},r={name:"",info:{},actions:[]},a={},s={},l=(editorProps.urls.helpPageDomain+"/portal/en/kb/writer/how-to-document-review-and-collaboration/articles/what-happens-to-the-submissions-feature-after-the-free-introductory-period",editorProps.urls.helpPageURL+"add-on-limits-and-pricing-of-fillable-documents.html"),d=function(e){return"<span class='ui-text-blue' onclick='FillAutomationHandler."+e+"()'>"},c={SUCCESS_MSG:J.i18n("writer.automation.SUBMIT_SUCCESS_MSG"),WARNING:J.i18n("writer.common.WARNING"),WORKFLOW_IN_PROGRESS:J.i18n("writer.automation.SETTINGS_ALREADY_CONFIGURED"),CANCEL:J.i18n("writer.common.CANCEL"),LATER:J.i18n("writer.common.LATER"),CLOSE:J.i18n("writer.common.CLOSE"),GOT_IT:J.i18n("writer.common.OK_GOT_IT"),RESET_AND_PROCEED:J.i18n("writer.automation.RESET_AND_PROCEED"),A_COLLABORATOR:J.i18n("writer.automation.A_COLLABORATOR"),SUBMIT_SUCCESS_MSG:J.i18n("writer.common.SAVE_SUBMIT_SUCCESS"),SUBMIT_FAILURE_MSG:J.i18n("writer.common.SAVE_SUBMIT_FAILURE"),SIGN_INFO_NOT_CONFIGURED:J.i18n("writer.common.SIGN_INFO_NOT_CONFIGURED"),MSG_AND_REDIRECT_NOT_CONFIGURED:J.i18n("writer.common.MSG_AND_REDIRECT_NOT_CONFIGURED"),SUBMIT_PAYMENT_MSG:J.i18n("writer.automation.FILL_SUBMIT_PAYMENT_MSG",["October 31, 2020"]),EXTEND_LIMITS:J.i18n("writer.propack.EXTEND_LIMITS"),LIMIT_REACHED:J.i18n("writer.limitation.REACHED_SUBMISSION_LIMIT"),DAILY_CAP_REACHED:J.i18n("writer.limitation.REACHED_DAILY_SUBMISSION_CAP"),ADDON_REQUIRED_TITLE:J.i18n("writer.automation.ADDON_REQUIRED_TITLE"),ADDON_REQUIRED_MSG:J.i18n("writer.automation.ADDON_REQUIRED_MSG_USER",[d("openPropacKB"),"</span>"]),EXTEND_LIMITS_ADMIN_MSG:J.i18n("writer.automation.REACHED_SUBMISSION_LIMIT_MSG_ADDON_ADMIN",[d("openPropacKB"),"</span>"]),EXTEND_LIMITS_USER_MSG:J.i18n("writer.automation.REACHED_SUBMISSION_LIMIT_MSG_ADDON_USER",[d("openPropacKB"),"</span>"]),TEST_DESC_MSG:J.i18n("writer.automation.TEST_SUBMISSIONS_NOTE"),SEND_FOR_SIGN:J.i18n("writer.common.SEND_FOR_SIGN"),SEND_FOR_APPROVAL:J.i18n("writer.common.SEND_FOR_APPROVAL"),SIGN_YOURSELF:J.i18n("writer.common.SIGN_YOURSELF"),SUBMIT_AND_SEND_FOR_SIGN:J.i18n("writer.common.SUBMIT_AND_SEND_FOR_SIGN"),SUBMIT_BTN_HIDDEN_TITLE:J.i18n("writer.common.SUBMIT_BUTTON_WILL_BE_HIDDEN"),SUBMIT_BTN_HIDDEN_DESC:J.i18n("writer.common.SUBMIT_BUTTON_HIDDEN_DESC"),REACHED_DOWNLOAD_LIMIT_MSG_ADDON_USER:J.i18n("writer.limitation.REACHED_DOWNLOAD_LIMIT_MSG_ADDON_USER",[d("openPropacKB"),"</span>"]),REACHED_DOWNLOAD_LIMIT_MSG_ADDON_ADMIN:J.i18n("writer.limitation.REACHED_DOWNLOAD_LIMIT_MSG_ADDON_ADMIN",[d("openPropacKB"),"</span>"]),REACHED_DOWNLOAD_LIMIT:J.i18n("writer.limitation.REACHED_DOWNLOAD_LIMIT"),ADDON_REQUIRED_FOR_OPERATION_MSG_ADMIN:J.i18n("writer.automation.ADDON_REQUIRED_FOR_OPERATION_MSG_ADMIN",[d("openDocuFillerHelp"),"</span>"]),ADDON_REQUIRED_FOR_OPERATION_MSG_USER:J.i18n("writer.automation.ADDON_REQUIRED_FOR_OPERATION_MSG_USER",[d("openDocuFillerHelp"),"</span>"]),BUY_ADDON:J.i18n("writer.propack.BUY_ADDON")},u="Submitter's Email",p=function(){t=editorProps.isFillableForm||!1,i=editorProps.userInfo.zuid,o={email_info:{recipients:[editorProps.userInfo.email]},callback_info:{url:""},actions:["show_success_msg"],redirect_info:{url:""},show_success_msg_info:{message:c.SUCCESS_MSG},sign_info:{},store_info:{},sheet_info:{},forward_draft_info:{},submitter_permissions:["document.download"],document_name:"${document_name}_${random_string}"},s={field_navigation_panel:"hide"},a={}},g=function(){var e={submit_enabled:t,onsubmit:o,zuid:i,ui_options:s};return e};p();var f,E,T,m,h,I,_,A,S,R,O,b,v,D,L=!1,N=function(e){var t=editor.doc.docInfo,i=t.PUBLISH_SCOPE;if(e!=i)switch(e){case"1":C();break;case"2":P();break;case"3":Publish.republishClicked();break;case"4":Publish.openDialog();break;case"5":x(PUBLISH_TYPE.PRIVATE),L=!1}},P=function(){I||(I=T.find("#ff-action-email,#ff-action-sign")),I.attr("checked",!1),o.email=!1,o.sign=!1,U(!0,!0),x(PUBLISH_TYPE.EXTERNAL),L=!0,y(),F()},C=function(){x(PUBLISH_TYPE.INTERNAL),U(!0,!0),L=!0,y(),F()},y=function(){_=editor.doc.docInfo.PUBLISH_SETTINGS,_&&(_.fill_info=o,DocInfo.setProperty({PUBLISH_SETTINGS:_}))},F=function(){T.find("#publishfill-url-cont").show();var e=DomUtil.getPublishURL();e.indexOf("fill")==-1&&(e+="/fill"),T.find("#publishfill-url").val(e).select()},M=function(){m&&h&&S&&A||(m=J("#publishfill-linkcont"),h=J("#publishfill-buttoncont"),S=J("#publish_to_org,#fp-chng-prmsn-org"),A=J("#publish_to_web,#fp-chng-prmsn-web"));var e=editor.doc.docInfo,t=e.PUBLISH_SCOPE,i=(e.AUTO_PUBLISH,t==PUBLISH_TYPE.INTERNAL,t==PUBLISH_TYPE.EXTERNAL,editor.getRole().permissions.can("document.publish.external")),n=editor.getRole().permissions.can("document.publish.internal");i?A.removeClass("ui-opacity"):A.addClass("ui-opacity"),n?S.removeClass("ui-opacity"):S.addClass("ui-opacity")},w=function(e){k(),F(),V()},U=function(e,t){R&&O||(R=J("#publishToFill"),O=J("#publishfill-removepublish")),e?t?(R.disable(),R.zbutton("setAttribute","text",J.i18n("writer.common.PUBLISHING"))):t||(O.disable(),O.zbutton("setAttribute","text",J.i18n("writer.common.UNPUBLISHING"))):t?(R.enable(),R.zbutton("setAttribute","text",J.i18n("writer.common.PUBLISH"))):t||(O.enable(),O.zbutton("setAttribute","text",J.i18n("writer.common.UNPUBLISH")))},x=function(e,t,i){var n,o={},r="POST";if(e==PUBLISH_TYPE.INTERNAL?E=PUBLISH_TYPE.INTERNAL:e==PUBLISH_TYPE.EXTERNAL?E=PUBLISH_TYPE.EXTERNAL:e==PUBLISH_TYPE.PRIVATE&&(U(!0,!1),E=PUBLISH_TYPE.PRIVATE),f=!0,n=ZWNetworkUtils.getContextUrl("api/v1/documents/"+editor.doc.docInfo.RID+"/publish"),E==PUBLISH_TYPE.PRIVATE)r="DELETE";else{r="POST",o.auto_republish=f,o.scope=E==PUBLISH_TYPE.INTERNAL?"organization":"external",o.sm=ModeManager.getCurrentMode();var a={};a.fill_info=FillAutomationHandler.getFillPublishOptions(),o.publish_settings=JSON.stringify(a)}J.ajax({url:n,data:o,type:r,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:t||B,error:i||H})},B=function(){E==PUBLISH_TYPE.PRIVATE?(h.show(),m.hide(),U(!1,!1),k(),UIUtils.showToast({message:J.i18n("writer.common.REMOVE_PUBLISH_FILL_SUCCESS"),hideDelay:3e3,type:"success"})):(h.hide(),m.show(),U(!1,!0),V(E),k(),F(),UIUtils.showToast({message:J.i18n("writer.common.PUBLISH_FILL_SUCCESS"),hideDelay:3e3,type:"success"}))},H=function(){E==PUBLISH_TYPE.PRIVATE?(h.hide(),m.show(),U(!1,!1),V(E),V(editor.doc.docInfo.PUBLISH_SCOPE),F(),UIUtils.showToast({message:J.i18n("writer.common.REMOVE_PUBLISH_FILL_FAILED"),hideDelay:3e3,type:"error"})):(h.show(),m.hide(),U(!1,!0),F(),V(editor.doc.docInfo.PUBLISH_SCOPE),UIUtils.showToast({message:J.i18n("writer.common.PUBLISH_FILL_FAILED"),hideDelay:3e3,type:"error"}))},G=function(e){o[e]=!o[e]},k=function(){var e={};e.AUTO_PUBLISH=!0,e.PUBLISH_SCOPE=E,DocInfo.setProperty(e),UIUtils.showDocStatusIcon(),UIUtils.updateDocPublishStatus()},W=function(){editor.doc.docInfo.PUBLISH_SCOPE!=PUBLISH_TYPE.PRIVATE&&_&&_.fill_info?(F(),T.find("#publishfill-buttoncont").hide(),T.find("#publishfill-linkcont").show(),V(),J("#publishfill-copylink").text(J.i18n("writer.common.COPY_LINK"))):(T.find("#publishfill-buttoncont").show(),T.find("#publishfill-linkcont").hide(),V(),"YES"==editor.doc.docInfo.PUBLIC?J("#publishToFill").disable():J("#publishToFill").enable()),UIUtils.hideLoadingMsg(),M()},Y=function(){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),_=editor.doc.docInfo.PUBLISH_SETTINGS,_?z():Utils.getPublishSettings(FillAutomationHandler.showFillPanel)},z=function(){_=editor.doc.docInfo.PUBLISH_SETTINGS,T?(LeftPanel.showSubPanel("subpanel-fill-automation",ANIMATIONS.FLIPIN),W()):AutomationHandler.fetchPanels("fill_automationpanel",function(){LeftPanel.showSubPanel("subpanel-fill-automation",ANIMATIONS.FLIPIN),T=J("#subpanel-fill-automation"),J("#fillPublishCombobox").on("zselectboxchange",function(e,t){var i=t.selectedValue;FillAutomationHandler.handlePublish(i)}),J("#publishfill-url").on("focus",function(){J("#publishfill-url").select()}),W()})},V=function(e){var t=e?e:editor.doc.docInfo.PUBLISH_SCOPE;t-=1,J("#fillPublishCombobox").zselectbox("setAttribute","selectedIndex",t)},j=function(){return L||!!_&&!!_.fill_info},X=function(){J("#publishfill-url").select(),DomUtil.checkCopySupport("#publishfill-copylink","#publishfill-url","writer.common.COPIED"),J("#publishfill-copylink").text(J.i18n("writer.common.COPIED")),setTimeout(function(){J("#publishfill-copylink").text(J.i18n("writer.common.COPY_LINK"))},7e3)},K=function(){return o},q=function(){var e=J("input[name=publish-type]:checked").val();e&&FillAutomationHandler.handlePublish(e)},Q=!0,$=function(){var e=function(){Q&&(t=editorProps.isFillableForm||!t,ee({submit_enabled:t,onsubmit:o,zuid:i,ui_options:s},a,function(){Ot(t),_e()})),J("#ff-submit-container").hide(),J("#ff-on-submission-cont,#ff-responder-options").show()};return function(){if(Q)return void e();var t=ZWLicense.fetchAllDetails();J.when(t).done(function(t){Q=!0,e()})}}(),ee=function(e,t,i,n){var o=ZWNetworkUtils.getApiUrlPrefix(editor.doc.docInfo.RID+"/util/fill_settings"),r={};delete e.zuid,r.fillable_settings=JSON.stringify(e),ZWJSONUtils.isEmptyObject(t)||extend(r,t);var a={success:function(e){"string"==typeof e&&(e=JSON.parse(e)),PrepareDocumentHandler.setValues(e[PREPARE_DOCUMENT.OPERATION.FILL],PREPARE_DOCUMENT.OPERATION.FILL),e&&e.success&&i&&i(e)},fail:function(e,t,i){400==t.status&&"string"==typeof e&&(e=JSON.parse(e));var o=e&&e.error_msg,r=e&&e.error_code;n&&n(o,r)},setHeaders:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}};J.ajaxUpload(o,r,a,"json")},te=function(e,t){for(var i=[],n=0;n<t.length;n++){var o={},r=t[n];o.email=r,o.id=r,o.name=r,o.image=void 0,i.push(o)}e.ztokenfield("addTokens",i)},ie=function(){var e={init:function(){n=J("#fillsubmitsettngs").find("#fill_custom_func_name"),Utils.initFolderChooser({container_id:"signersDocFolder",folderId:o.store_info.folder_id,calbackFn:function(e){o.store_info.folder_id=e.folderId}}),J("#ff-submit-ccbcc-btn").on("click",function(){J("#ff-submit-ccbcc-cont").toggle()});var e=o.email_info;e.recipients&&te(J("#submitdlg-recipients"),"string"==typeof e.recipients?e.recipients.split(","):e.recipients),e.cc&&te(J("#submitdlg-cc"),"string"==typeof e.cc?e.cc.split(","):e.cc),e.bcc&&te(J("#submitdlg-bcc"),"string"==typeof e.bcc?e.bcc.split(","):e.bcc),setTimeout(r,400);var t=ZWLicense.isFillAddonPurchased();if(UIUtils.isPropackEnabled()){var i=ZWLicense.getLimit(SKU_CONST.FILL);t?rt(i,"#fillsubmit-notify-container",re):Notification.show({container:"#fillsubmit-notify-container",translatedMessage:!0,message:c.TEST_DESC_MSG,btnText:"writer.automation.BUY_THIS_FILETYPE",callback:Ut.bind(null,"fill-addon-popup"),setTimer:!1,type:"warning",close:!1}),J("#submitdlg-recipients,#ff-submit-ccbcc-btn")[t?"enable":"disable"]()}else t||Notification.show({container:"#fillsubmit-notify-container",translatedMessage:!0,message:c.SUBMIT_PAYMENT_MSG,setTimer:!1,type:"warning",close:!1});n[o.actions.contains("execute_custom_func")?"show":"hide"](),J("#ff-submit-sign-configure")[o.actions.contains("sign")?"show":"hide"]()},get:function(e,t){switch(e.action){case"recipients":case"cc":case"bcc":return null;case"success_msg":return o.show_success_msg_info.message;case"redirect_url":return o.redirect_info.url;case"callback_url":return o.callback_info.url;case"folder_id":return o.store_info.folder_id;case"download":case"sign.send":case"sign.self":case"email.attachment":return o.submitter_permissions.contains("document."+e.action);case"document_name":return o[e.action];case"overwrite_existing_file":return o.store_info.overwrite_existing_file;case"execute_custom_func":o.fill_custom_function_info?(J("#fillsubmitsettngs").find("#fill_custom_func_name").text(o.fill_custom_function_info.custom_function_name),b=o.fill_custom_function_info.custom_function_id,v=o.fill_custom_function_info.custom_function_name):(v="",b="");default:return o.actions.contains(e.action)}},set:function(e,a,s){switch(e.action){case"recipients":case"cc":case"bcc":var l=[];a.forEach(function(e){l.push(e.text())}),o.email_info[e.action]=l;break;case"success_msg":o.show_success_msg_info.message=a;break;case"redirect_url":o.redirect_info.url=a;break;case"callback_url":o.callback_info.url=a;break;case"folder_id":o.store_info.folder_id=a;break;case"download":case"sign.send":case"sign.self":case"email.attachment":(a?t:i).call(null,"submitter_permissions","document."+e.action);break;case"document_name":o[e.action]=a;break;case"sign":J("#ff-submit-sign-configure")[a?"show":"hide"]();case"execute_custom_func":"execute_custom_func"==e.action&&n[a?"show":"hide"]();case"overwrite_existing_file":o.store_info.overwrite_existing_file;break;default:(a?t:i).call(null,"actions",e.action),r()}}},t=function(e,t){!o[e].contains(t)&&o[e].push(t)},i=function(e,t){var i=o[e].indexOf(t);i>-1&&(o[e]=o[e].slice(0,i).concat(o[e].slice(i+1)))},r=function(){o.actions.contains("redirect")&&o.redirect_info.url?J("#submitter-actions-cont").find("input").disable():J("#submitter-actions-cont").find("input").enable()};return function(){if(Q)return void J.dialogutil.open("fillsubmitsettings",void 0,e);var t=ZWLicense.fetchAllDetails();J.when(t).done(function(t){Q=!0,J.dialogutil.open("fillsubmitsettings",void 0,e)})}}(),ne=function(){at(c.ADDON_REQUIRED_TITLE,c.ADDON_REQUIRED_MSG,[c.CLOSE],[MsgDialog.close])},oe=function(){FillAutomationHandler.openSubmitDialog(),FillAutomationHandler.updateSubmitSettings()},re=function(e){J.dialogutil.close("fillsubmitsettings"),_e()},ae=function(){var e="",n=function(t){UIUtils.hideLoadingMsg(),Notification.show({container:"#fillsubmit-notify-container",translatedMessage:!0,message:c.SUBMIT_SUCCESS_MSG,setTimer:!1,type:"success"}),"save_to_folder"===e?MailMergeMergeAndStoreDlgHandler.close():"email"===e?(MailMergeEmailDlgHandler.close(),D=t.fill.onsubmit.email_info.cattachmentsInfo):"webhook_custom_function"===e?J.dialogutil.close("webhookcustomfunctions"):"custom_message"===e?J.dialogutil.close("responsemsgandredirectionsdlg"):"submitter_permission"===e?J.dialogutil.close("submitterpermissionsdlg"):"store_in_sheet"===e?J.dialogutil.close("savetozohosheetdialog"):"forward_draft"===e&&J.dialogutil.close("addrespondentsdlg")},r=function(t,i){UIUtils.hideLoadingMsg();var n=c.SUBMIT_FAILURE_MSG;"F1101"!=i&&"F1102"!=i&&"F1103"!=i&&"F1104"!=i||(n=t),"store_in_sheet"==e?"F1104"==i&&(J("#ff-worksheet-name-error-msg-cont").show(),J("#ff-worksheet-name-error-msg-cont").html(n),J("#ff-worksheet-name-cont").addClass("ui-validation-error"),J("#save_to_sheet_dlg_save").disable()):Notification.show({container:"#fillsubmit-notify-container",translatedMessage:!0,message:n,setTimer:!1,type:"error"})},l=function(){var e=CollabListHandler.getListByStatus(),t=e["On&Ac"].concat(e["Off&Ac"].concat(e["Off&NA"]));return t},d=function(e,t,n){var o=c.A_COLLABORATOR,r=l();0==r.length&&(CollabListHandler.getSharedUserStatus(),r=l()),r.forEach(function(e){e.ZUID==i&&(o=e.FULLNAME)}),MsgDialog.showMessage([c.RESET_AND_PROCEED,c.CANCEL],CONST.SEVERITY_WARNING,c.WORKFLOW_IN_PROGRESS,J.i18n("writer.automation.SETTINGS_ALREADY_CONFIGURED_DESC",[o]),null,function(i){switch(i){case CONST.BUTTON_1_CLICKED:u(e,t,n)}})},u=function(e,i,n){if(o.actions.indexOf("sign")!=-1&&ZWJSONUtils.isEmptyObject(o.sign_info))return void Notification.show({container:"#fillsubmit-notify-container",translatedMessage:!0,message:c.SIGN_INFO_NOT_CONFIGURED,setTimer:!1,type:"error"});var r=!UIUtils.isPropackEnabled()||"undefined"==typeof ZWLicense||ZWLicense.isFillAddonPurchased();r||(o.email_info.recipients=[editorProps.userInfo.email],delete o.email_info.cc,delete o.email_info.bcc);var l={};if("email"==n){MailMergeOtherAttachments.addCommonAttachmentFiles(l);var d=MailMergeOtherAttachments.getCommonCloudAttachmentsInfo();d.length&&(l.common_attachments=JSON.stringify(d),D=l)}else l=a;"string"==typeof o.email_info.recipients&&(o.email_info.recipients=o.email_info.recipients.split(",")),"string"==typeof o.email_info.cc&&(o.email_info.cc=o.email_info.cc.split(",")),"string"==typeof o.email_info.bcc&&(o.email_info.bcc=o.email_info.bcc.split(","));var u=!1,p=1==o.actions.length&&o.actions.contains("forward_draft");0!=o.actions.length&&!p||"submitter_permission"==n?Xe(u):(u=!0,MsgDialog.showMessage([c.GOT_IT,c.CANCEL],CONST.SEVERITY_INFO,c.SUBMIT_BTN_HIDDEN_TITLE,c.SUBMIT_BTN_HIDDEN_DESC,null,function(n){switch(n){case CONST.BUTTON_1_CLICKED:MsgDialog.close(),Xe(u),o.actions=[],ee({submit_enabled:t,onsubmit:o,zuid:editorProps.userInfo.zuid,ui_options:s},l,e,i);break;case CONST.BUTTON_2_CLICKED:MsgDialog.close()}},null,!1,!0)),u||ee({submit_enabled:t,onsubmit:o,zuid:editorProps.userInfo.zuid,ui_options:s},l,e,i)};return function(t){e=t&&"string"==typeof t?t:"",i!==editorProps.userInfo.zuid?d(n,r,t):u(n,r,t)}}(),se=function(e){delete e.actioninfo,a=e},le=function(){var e=SignDlgHandler.getSignInfo(),t=JSON.parse(e.actioninfo);r.info.sign_info=t;var i=MailMergeUtil.getFieldMappingFromObject(ZWJSONUtils.clone(r.info.sign_info),{includeRLFields:!0});r.info.sign_info.mf_mapping=i,se(e),ve(),SignDlgHandler.close()},de=function(e){return e&&e.map(function(e){return"string"==typeof e?JSON.parse(e):e})},ce=function(e){return e&&e.map(function(e){return e="string"==typeof e?JSON.parse(e):e,"string"==typeof e?JSON.parse(e):e})},ue=function(){var e=function(){var e=JSON.parse(SignDlgHandler.getSignInfo().actioninfo),t=FillAutomationHandler.areEmptySignersPresent(e);return t?void me():void FillAutomationHandler.saveSignSettings()};return function(t){"enable"!=t&&Re("sign");var i=FieldPreFillHandler.getDataSourceInfo();!i||i.fields&&i.fields.length||FieldPreFillHandler.fetchLatestFields();var n=ZWJSONUtils.clone(r.info.sign_info),s=function(){o.actions.contains("sign")||(J("#ff-send-for-sign").prop("checked",!1),J("#ff-sign-sub-div").hide(),J("#ff-sign-link-text").html(J.i18n("writer.fillablefields.SEND_FOR_SIGN_COLLECTION",["<span id='ff-sign-no-link'>","</span>"]))),J.dialogutil.close("signdlg")};r.info.sign_info.cattachmentsInfo?n.common_attachments=r.info.sign_info.cattachmentsInfo:a.common_attachments&&(n.common_attachments=ce(JSON.parse(a.common_attachments))),n.recipients=de(r.info.sign_info.recipients),SignDlgHandler.open({isFillSubmit:!0,callback:e,cancel_callback:s,saveOnly:!0,defaultValues:n,title:J.i18n("writer.common.SETUP_SIGN_WORKFLOW"),btns:[J.i18n("writer.common.SAVE")]})}}(),pe=function(){var e=function(e){n.text(e.functionName).show(),ge(e.functionName,e.functionId)},t='recipients = fillInfo.get("recipients");\ninfo recipients;',i=[{paramName:"fillInfo",paramType:"Map"},{paramName:"docInfo",paramType:"Map"}],r={callback:e,btns:[J.i18n("writer.common.PROCEED")],showGalleryFunctions:!0,defaultScript:t,editorParams:i,functionCategory:"document_fill_submit",defaultFunctionId:b,functionReturnType:"void"},a=function(){var e,t="",i=[];return editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){e.getName()&&!i.contains(e.getName())&&c.push(e),i.push(e.getName())}),c.forEach(function(i){if(i.getName()){switch(""!=t&&(t+=","),i.getFillableFieldType()){case FILLABLEFIELD_TYPE.IMAGE:case FILLABLEFIELD_TYPE.SIGNATURE:case FILLABLEFIELD_TYPE.INITIAL:e=editorProps.urls.base_url+"/api/v1/"+editor.doc.docInfo.RID+"/fillmerge/image/"+Utils.randomString()+"/download";break;case FILLABLEFIELD_TYPE.DATE:e=(new Date).toLocaleDateString(i.getLocale());break;case FILLABLEFIELD_TYPE.CURRENCY:e="$ 123,456";break;case FILLABLEFIELD_TYPE.SELECTBOX:e=i.getList()[0];break;case FILLABLEFIELD_TYPE.CHECKBOX:e="Yes";break;case FILLABLEFIELD_TYPE.NUMBER:e="12345";break;case FILLABLEFIELD_TYPE.PERCENT:e="10 %";break;case FILLABLEFIELD_TYPE.PHONE:e="1234567890";break;case FILLABLEFIELD_TYPE.EMAIL:e="abc@example.com";break;default:e="Sample value"}t+='<br>&nbsp&nbsp&nbsp"'+Utils.encodeHTMLString(i.getName())+'": "'+e+'"',l[i.getName()]=e}}),t},s=function(){var e,t,i,n={},o="";return c.forEach(function(r){r.getName()&&(""!=o&&(o+=","),n={},e=r.getFillableFieldType(),t=r.rawFormat,i=r.getName(),n[ATTR_COMMON.TYPE]=e,t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_FORMAT]&&(n[ATTR_FILLABLEFIELD.FF_FORMAT]=r.getFormat()),t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_NUMBER_FORMAT]&&(n[ATTR_FILLABLEFIELD.FF_NUMBER_FORMAT]=r.getNumberFormat()),t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_AUTOFIELD.LOCALE]&&(n[ATTR_AUTOFIELD.LOCALE]=r.getLocale()),e==FILLABLEFIELD_TYPE.SELECTBOX?(n[ATTR_FILLABLEFIELD.FF_LIST]=r.getList(),n[ATTR_FILLABLEFIELD.FF_SELECTED_INDEX]=r.getSelectedIndex()):e==FILLABLEFIELD_TYPE.CHECKBOX?n[ATTR_FILLABLEFIELD.FF_CHECKED]=r.isChecked():r.isFillableImageField()?(n.height=r.getSize()[ATTR_FILLABLEFIELD.FF_HEIGHT]+r.style.heightUnit,n.width=r.getSize()[ATTR_FILLABLEFIELD.FF_WIDTH]+r.style.widthUnit):e==FILLABLEFIELD_TYPE.CURRENCY&&(n[ATTR_FILLABLEFIELD.FF_CURRENCY_CODE]=r.getCurrencyCode(),n[ATTR_FILLABLEFIELD.FF_USE_CURRENCY_SYMBOL]=r.isCurrencySymbolAsCode()),n[ATTR_FILLABLEFIELD.FF_VALUE]=l[i],n[ATTR_FILLABLEFIELD.FF_MANDATORY]=r.isMandatory(),n[ATTR_FILLABLEFIELD.FF_DISABLED]=!!r.disabled,o+='<br>&nbsp&nbsp&nbsp"'+Utils.encodeHTMLString(i)+'": '+JSON.stringify(n),d[i]=n)}),o},l={},d={},c=[];return function(){var e=Utils.encodeHTMLString(editor.doc.docInfo.DOCUMENT_NAME.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),"")),t=Utils.encodeHTMLString(editor.doc.docInfo.CREATOR.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),"")),i=Utils.encodeHTMLString(o.document_name.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),"")),n=o.email_info.recipients,c=("string"==typeof n?n:n.join(","),!1),u="";if(MailMergeDataModel.isDataAvailable()){c=!0;var p=MailMergeRecordUtil.getRecordAt(0)||docProps.MM_DETAILS.data[0];Object.keys(p).forEach(function(e,t){u+=(0!=t?",<br>":"")+'&nbsp&nbsp&nbsp"'+Utils.encodeHTMLString(e)+'": "'+Utils.encodeHTMLString(p[e])+'"'})}r.paramPopupsHTML||(r.paramPopupsHTML={fillInfo:{title:"FillInfo",content:'<p>{</p><p>"document_name": "'+i+'"</p><p>"submitter_permissions": "'+o.submitter_permissions+'"<p><p>"folder_id": "'+o.store_info.folder_id+'"</p><p>"recipients":"'+n+'"</p><p>"filled_document_download_url": "https://'+editorProps.urls.servername+'/api/v1/fillmerge/job/2030410000006289002/record/2030410000006289011/fill/attachment/download"</p><p>"status": {<br>&nbsp&nbsp&nbsp"webhookStatus": "sucess",<br>&nbsp&nbsp&nbsp"storeStatus": "'+!0+'",<br>&nbsp&nbsp&nbsp"mailStatus": "'+!0+'",<br>&nbsp&nbsp&nbsp"signStatus": "'+!0+'"<br>}</p><p>"filled_data": {'+a()+'<br>}</p><p>"filled_data_formats": {'+s()+"<br>}</p>"+(c?'<p>"record_data": {<br>'+u+"<br>}</p>":"")+"<p>}</p>"},docInfo:{title:"DocInfo",content:'<p>{</p><p>"open_url": "https://'+editorProps.urls.servername+"/writer/open/"+editor.doc.docInfo.RID+'"</p><p>"document_id": "'+editor.doc.docInfo.RID+'"</p><p>"document_name": "'+e+'"</p><p>"created_by": "'+t+'"</p><p>"creator_id": "'+editor.doc.docInfo.CREATOR_ZUID+'"</p><p>"download_url": "https://'+editorProps.urls.servername+"/api/v1/download/open/"+editor.doc.docInfo.RID+'"</p><p>"parent_folder_id": "'+editor.doc.docInfo.PARENT_ID+'"</p><p>}</p>'}}),r.defaultParamValues||(r.defaultParamValues={fillInfo:{document_name:i,submitter_permissions:o.submitters_permissions,folder_id:o.store_info.folder_id,recipients:n,filled_document_download_url:"https://"+editorProps.urls.servername+"/api/v1/fillmerge/job/2030410000006289002/record/2030410000006289011/fill/attachment/download",status:{webhookStatus:"success",storeStatus:!0,mailStatus:!0,signStatus:!0},filled_data:l,filled_data_formats:d},docInfo:{open_url:"https://"+editorProps.urls.servername+"/writer/open/"+editor.doc.docInfo.RID,document_id:editor.doc.docInfo.RID,document_name:e,created_by:t,creator_id:editor.doc.docInfo.CREATOR_ZUID,download_url:"https://"+editorProps.urls.servername+"/api/v1/download/open/"+editor.doc.docInfo.RID,parent_folder_id:editor.doc.docInfo.PARENT_ID}},c&&(r.defaultParamValues.fillInfo.record_data=MailMergeRecordUtil.getRecordAt(0)||docProps.MM_DETAILS.data[0])),b&&(r.defaultFunctionId=b),DREDialogHandler.openDialog(r)}}(),ge=function(e,t){var i=DelugeHandler.getDelugeEditor().isEditorContentModified();i?he(J.i18n("writer.common.UNSAVED_CHANGES_FOUND"),J.i18n("writer.automation.UNSAVED_CHANGES_MSG"),J.i18n("writer.common.CONTINUE"),Ie.bind(this,e,t)):Ie(e,t)},fe=function(){MsgDialog.close(),SignDlgHandler.isDialogOpened()||FillAutomationHandler.openSignDialog(),SignDlgHandler.highlightEmptySigners()},Ee=function(){o.actions.contains("sign.configure")||(r.actions.push("sign.configure"),J("#ff-sign-sub").prop("checked",!0),J("#ff-sign-sub-link-text").html(J.i18n("writer.fillablefields.ALLOW_RESPONDEDNTS_MSG",["<span id='ff-sign-sub-link' onclick=\"\" class=''>","</span>"]))),FillAutomationHandler.saveSignSettings(),J("#ff-sign-sub-div").addClass("ui-anim-glow"),setTimeout(function(){J("#ff-sign-sub-div").removeClass("ui-anim-glow")},3e3)},Te=function(e){var t=e.recipients.find(function(e,t){return!(!e||""!=e["recipient_"+(t+1)]&&""!==e.recipient_name.trim())||!(!e||"in_person_sign"!==e.action_type||""!=e.in_person_signer_info.email&&""!=e.in_person_signer_info.name.trim())});return t},me=function(){MsgDialog.showMessage([J.i18n("writer.sign.CONFIGURE_NOW"),J.i18n("writer.sign.ALLOW_RESPONDERS_TO_CONFIGURE")],CONST.SEVERITY_WARNING,J.i18n("writer.sign.SIGN_CONFIGURATION_INCOMPLETE"),J.i18n("writer.sign.SIGNER_FIELDS_NOT_CONFIGURED"),null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:fe();break;case CONST.BUTTON_2_CLICKED:Ee()}},null,!0)},he=function(e,t,i,n){MsgDialog.showMessage([i,J.i18n("writer.common.CANCEL")],CONST.SEVERITY_WARNING,e,t,null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:n&&n()}})},Ie=function(e,t){v=e,b=t;var i=DREDialogHandler.getSelectedFunction(),t=DelugeHandler.getFunctionIdFromName(i);o.fill_custom_function_info={custom_function_id:t,custom_function_name:v},r.info.fill_custom_function_info={custom_function_id:t,custom_function_name:v},DREDialogHandler.closeDialog()},_e=function(){var e=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL);e?(o=e.onsubmit,t=e.submit_enabled,i=e.zuid,s=e.ui_options):p(),J("#ff-submit-container").hide(),e&&Se(),t?J("#ff-configure-submit").enable():J("#ff-configure-submit").disable()},Ae=function(){J("#ff-email-link-text").html(J.i18n("writer.fillablefields.SEND_AS_EMAIL",["<span id='ff-email-no-link'>","</span>"])),J("#ff-sign-link-text").html(J.i18n("writer.fillablefields.SEND_FOR_SIGN_COLLECTION",["<span id='ff-sign-no-link'>","</span>"])),J("#ff-store-link-text").html(J.i18n("writer.fillablefields.SAVE_TO_FOLDER",["<span id='ff-store-no-link'>","</span>"])),J("#ff-sign-sub-link-text").html(J.i18n("writer.fillablefields.ALLOW_RESPONDEDNTS_MSG",["<span id='ff-sign-sub-no-link'>","</span>"])),J("#ff-webhook-link-text").html(J.i18n("writer.fillablefields.TRIGGER_WEBHOOK_AND_CUSTOM_FUNCTIONS",["<span id='ff-webhook-no-link'>","</span>"])),J("#ff-custom-message-link-text").html(J.i18n("writer.fillablefields.SHOW_CUSTOM_MESSAGE_AND_REDIRECTION",["<span id='ff-custom-message-no-link'>","</span>"])),J("#ff-sheet-link-text").html(J.i18n("writer.fillablefields.STORE_IN_SHEET",["<span id='ff-sheet-no-link'>","</span>"])),J("#ff-forward-draft-link-text").html(J.i18n("writer.fillablefields.SEND_RESPONSES_FOR_COMPLETION",["<span id='ff-forward-draft-no-link'>","</span>"]))},Se=function(){(o.actions.contains("store")||o.actions.contains("modify_doc_name"))&&(J("#ff-save-and-store").prop("checked",!0),J("#ff-store-link-text").html(J.i18n("writer.fillablefields.SAVE_TO_FOLDER",["<span id='ff-store-and-save-link' onclick=\"FillAutomationHandler.openSaveToFolderDlg(true)\" class='am-opt-link'>","</span>"]))),o.actions.contains("email")&&(J("#ff-email-submission").prop("checked",!0),J("#ff-email-link-text").html(J.i18n("writer.fillablefields.SEND_AS_EMAIL",["<span id='ff-email-link' onclick=\"FillAutomationHandler.openEmailDlg(true)\" class='am-opt-link'>","</span>"]))),o.actions.contains("sign")&&(J("#ff-send-for-sign").prop("checked",!0),J("#ff-sign-link-text").html(J.i18n("writer.fillablefields.SEND_FOR_SIGN_COLLECTION",["<span id='ff-sign-link' onclick=\"FillAutomationHandler.openSignDialog()\" class='am-opt-link'>","</span>"])),J("#ff-sign-sub-div").show()),(o.actions.contains("callback")||o.actions.contains("execute_custom_func"))&&(J("#ff-webhook-custom-function").prop("checked",!0),J("#ff-webhook-link-text").html(J.i18n("writer.fillablefields.TRIGGER_WEBHOOK_AND_CUSTOM_FUNCTIONS",["<span id='ff-webhook-link' onclick=\"FillAutomationHandler.openWebhookAndCustomFunctionDlg(true)\" class='am-opt-link'>","</span>"]))),(o.actions.contains("show_success_msg")||o.actions.contains("redirect"))&&(J("#ff-custom-message").prop("checked",!0),J("#ff-custom-message-link-text").html(J.i18n("writer.fillablefields.SHOW_CUSTOM_MESSAGE_AND_REDIRECTION",["<span id='ff-custom-message-link' onclick=\"FillAutomationHandler.openCustomMessageDlg(true)\" class='am-opt-link'>","</span>"]))),o.actions.contains("store_in_sheet")&&(J("#ff-store-in-sheet").prop("checked",!0),J("#ff-sheet-link-text").html(J.i18n("writer.fillablefields.STORE_IN_SHEET",["<span id='ff-sheet-link' onclick=\"FillAutomationHandler.openSheetDlg(true)\" class='am-opt-link'>","</span>"]))),o.actions.contains("forward_draft")&&(J("#ff-forward-draft").prop("checked",!0),J("#ff-forward-draft-link-text").html(J.i18n("writer.fillablefields.SEND_RESPONSES_FOR_COMPLETION",["<span id='ff-forward-draft-link' onclick=\"FillAutomationHandler.openRespondentsDlg(true)\" class='am-opt-link'>","</span>"]))),o.actions.contains("sign.configure")&&J("#ff-sign-sub").prop("checked",!0),Ne()},Re=function(e){r.name=e,r.actions=[];for(var t=0;t<o.actions.length;t++)r.actions.push(o.actions[t]);switch(r.info={},e){case"save_to_folder":o.document_name&&(r.info.document_name=o.document_name),r.info.store_info={},J.extend(!0,r.info.store_info={},o.store_info);break;case"email":r.info.email_info={},J.extend(!0,r.info.email_info={},o.email_info);break;case"sign":r.info.sign_info={},J.extend(!0,r.info.sign_info={},o.sign_info);break;case"webhook_custom_function":r.info.callback_info={},J.extend(!0,r.info.callback_info={},o.callback_info),o.fill_custom_function_info&&(r.info.fill_custom_function_info={},J.extend(!0,r.info.fill_custom_function_info={},o.fill_custom_function_info));break;case"response_message":r.info.show_success_msg_info={},J.extend(!0,r.info.show_success_msg_info={},o.show_success_msg_info),r.info.redirect_info={},J.extend(!0,r.info.redirect_info={},o.redirect_info);break;case"submitter_permission":r.info.submitter_permissions=o.submitter_permissions,r.info.ui_options=s||{};break;case"store_in_sheet":r.info.sheet_info={},J.extend(!0,r.info.sheet_info={},o.sheet_info);break;case"forward_draft":r.info.forward_draft_info={},J.extend(!0,r.info.forward_draft_info={},o.forward_draft_info)}},Oe=function(){o.actions=[];for(var e=0;e<r.actions.length;e++)o.actions.push(r.actions[e]);switch(r.name){case"save_to_folder":o.document_name=r.info.document_name,o.store_info=r.info.store_info;break;case"email":o.email_info=r.info.email_info;break;case"sign":o.sign_info=r.info.sign_info;break;case"webhook_custom_function":o.callback_info=r.info.callback_info,o.fill_custom_function_info=r.info.fill_custom_function_info;break;case"response_message":o.show_success_msg_info=r.info.show_success_msg_info,o.redirect_info=r.info.redirect_info;break;case"submitter_permission":o.submitter_permissions=r.info.submitter_permissions,s=r.info.ui_options;break;case"store_in_sheet":o.sheet_info=r.info.sheet_info;break;case"forward_draft":o.forward_draft_info=r.info.forward_draft_info}},be=function(e){Re(e)},ve=function(t){var i=/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/gi,n=/^[a-zA-Z0-9_\-&+$@*#'" ]*$/,o=!0;if(t&&"custom_message"===t){var a=e.getJSON(),s=e.getText(a);r.actions.contains("show_success_msg")&&""==s?r.actions.splice(r.actions.indexOf("show_success_msg"),1):(r.info.show_success_msg_info.message=s,r.info.show_success_msg_info.messageHTML=ZWRichTextEditor.getHTML(a),r.info.show_success_msg_info.messageJSON=a);var l=r.info.redirect_info.url;if(r.actions.contains("redirect")&&(""===l||!l.match(i)))return o=!1,J("#ff-redirect-errortext").show(),void r.actions.splice(r.actions.indexOf("redirect"),1);if(J("#ff-redirect-errortext").hide(),!r.actions.contains("show_success_msg")&&!r.actions.contains("redirect")&&o)return Oe(),void J("#custom_message_dlg_cancel").trigger("click")}if(t&&"webhook_custom_function"===t){var d=r.info.callback_info.url;if(r.actions.contains("callback")&&(""===d||!d.match(i)))return o=!1,J("#ff-webhook-errortext").show(),void r.actions.splice(r.actions.indexOf("callback"),1);if(J("#ff-webhook-errortext").hide(),r.actions.contains("execute_custom_func")&&!v&&r.actions.splice(r.actions.indexOf("execute_custom_func"),1),!r.actions.contains("execute_custom_func")&&!r.actions.contains("callback")&&o)return Oe(),void J("#webhook_custom_dlg_cancel").trigger("click")}if(t&&"store_in_sheet"===t){var c=r.info.sheet_info.workbook_id,u=r.info.sheet_info.worksheet_name,p=r.info.sheet_info.folder_id;if(r.actions.contains("store_in_sheet")&&""==c&&""==p)r.actions.splice(r.actions.indexOf("store_in_sheet"),1);else{if(r.actions.contains("store_in_sheet")&&u&&!u.match(n))return o=!1,Notification.show({container:"#ff-sheet-error-container",translatedMessage:!1,message:"writer.common.PLEASE_PROVIDE_VALID_SHEET_NAME",setTimer:!1,type:"error",close:!0}),void r.actions.splice(r.actions.indexOf("store_in_sheet"),1);r.info.sheet_info.workbook_id=c,r.info.sheet_info.worksheet_name=u,r.info.sheet_info.folder_id=p}if(!r.actions.contains("store_in_sheet")&&o)return Oe(),void J("#save_to_sheet_dlg_cancel").trigger("click")}if(t&&"forward_draft"===t){var g=r.info.forward_draft_info.recipients;if(!r.actions.contains("forward_draft")||g&&g.length?r.info.forward_draft_info.recipients=g:r.actions.splice(r.actions.indexOf("forward_draft"),1),!r.actions.contains("forward_draft")&&o)return Oe(),void J("#respondents_dlg_cancel").trigger("click")}o&&(Oe(),UIUtils.showLoadingMsg(J.i18n("writer.common.SAVING")),t&&"string"==typeof t?FillAutomationHandler.saveSubmitSettings(t):FillAutomationHandler.saveSubmitSettings(),Ne())},De={pdf:"PDF",docx:"MS_DOC",pdfform:"PDF_FORM",html:"HTML",zdoc:"ZDOC",zfdoc:"ZFDOC",sheet:"FILL_DATA_COLLECTION"},Le={store:"STORE",sign:"SIGN",email:"EMAIL",execute_custom_func:"DELUGE",callback:"WEBHOOK"},Ne=function(){if(Z("ff-limit-info-cont").hide(),UIUtils.isPropackEnabled()&&ZWLicense.isFillAddonPurchased()&&editorProps.IS_FILLABLE_FORM){var e=1,t="writer.editor.MAILMERGE.CREDIT_POINT_CONSUME_PER_SUBMISSION_NOTE",i=o.actions||[],n=SKU_JOB_CONST.MM_FILL,r=[],a=[],s=[],l=1;r.push(SKU_CONST[De.pdf]),s.push("pdf"),i.contains("store")&&o.store_info.format&&!s.contains(o.store_info.format)&&(r.push(SKU_CONST[De[o.store_info.format]]),s.push(o.store_info.format)),i.contains("email")&&o.email_info.format&&!s.contains(o.email_info.format)&&(r.push(SKU_CONST[De[o.email_info.format]]),s.push(o.email_info.format)),i.contains("store_in_sheet")&&r.push(SKU_CONST[De.sheet]),i.forEach(function(e){Le.hasOwnProperty(e)&&a.push(SKU_OP_DELIVERY_CONST[Le[e]])}),e=ZWLicense.getRequiredCredits(n,r,a,l),Z("ff-limit-info-cont").html(J.i18n(t,["<b>"+e,"</b>"])+"<br>"+J.i18n("writer.editor.MAILMERGE.CHECK_CREDIT_AVAILABILITY_HERE",["<span class='am-opt-link' onclick='ZWPropackHandler.open()'>","</span>"])).show()}},Pe=function(e,t){if("0.5"!=J(t).css("opacity")){if(J(t).hasClass("ui-onformsubmit-cbox-txt")){if(J(t).parent().find("input").is(":checked"))return;J(t).parent().find("input").prop("checked",!0)}var i=!1;"store_and_save"==e?(be("save_to_folder"),i=J("#ff-save-and-store").prop("checked"),i?(J("#ff-store-link-text").html(J.i18n("writer.fillablefields.SAVE_TO_FOLDER",["<span id='ff-store-and-save-link' onclick=\"FillAutomationHandler.openSaveToFolderDlg(true)\" class='am-opt-link'>","</span>"])),!r.actions.contains("store")&&r.actions.push("store"),!r.actions.contains("modify_doc_name")&&r.actions.push("modify_doc_name"),r.info.store_info&&0!=Object.keys(r.info.store_info).length?ve():Fe()):(r.actions.contains("store")&&r.actions.splice(r.actions.indexOf("store"),1),r.actions.contains("modify_doc_name")&&r.actions.splice(r.actions.indexOf("modify_doc_name"),1),J("#ff-store-link-text").html(J.i18n("writer.fillablefields.SAVE_TO_FOLDER",["<span id='ff-store-no-link'>","</span>"])),ve())):"email"==e?(be("email"),i=J("#ff-email-submission").prop("checked"),i?(J("#ff-email-link-text").html(J.i18n("writer.fillablefields.SEND_AS_EMAIL",["<span id='ff-email-link' onclick=\"FillAutomationHandler.openEmailDlg(true)\" class='am-opt-link'>","</span>"])),!r.actions.contains("email")&&r.actions.push("email"),!r.info.email_info||!r.info.email_info.recipients||r.info.email_info.recipients.length<=1?Me():ve()):(r.actions.contains("email")&&r.actions.splice(r.actions.indexOf("email"),1),J("#ff-email-link-text").html(J.i18n("writer.fillablefields.SEND_AS_EMAIL",["<span id='ff-email-no-link'>","</span>"])),ve())):"sign_collection"==e?(be("sign"),i=J("#ff-send-for-sign").prop("checked"),i?(J("#ff-sign-sub-div").show(),J("#ff-sign-link-text").html(J.i18n("writer.fillablefields.SEND_FOR_SIGN_COLLECTION",["<span id='ff-sign-link' onclick=\"FillAutomationHandler.openSignDialog()\" class='am-opt-link'>","</span>"])),!r.actions.contains("sign")&&r.actions.push("sign"),r.info.sign_info&&0!=Object.keys(r.info.sign_info).length?ve():FillAutomationHandler.openSignDialog("enable")):(J("#ff-sign-sub-div").hide(),r.actions.contains("sign")&&r.actions.splice(r.actions.indexOf("sign"),1),J("#ff-sign-link-text").html(J.i18n("writer.fillablefields.SEND_FOR_SIGN_COLLECTION",["<span id='ff-sign-no-link'>","</span>"])),ve())):"webhook_custom_function"==e?(be("webhook_custom_function"),i=J("#ff-webhook-custom-function").prop("checked"),i?(J("#ff-webhook-link-text").html(J.i18n("writer.fillablefields.TRIGGER_WEBHOOK_AND_CUSTOM_FUNCTIONS",["<span id='ff-webhook-link' onclick=\"FillAutomationHandler.openWebhookAndCustomFunctionDlg(true)\" class='am-opt-link'>","</span>"])),r.info.fill_custom_function_info||r.info.callback_info&&""!==r.info.callback_info.url?(!r.actions.contains("callback")&&(!r.info.callback_info||""!=r.info.callback_info.url)&&r.actions.push("callback"),!r.actions.contains("execute_custom_func")&&r.info.fill_custom_function_info&&r.actions.push("execute_custom_func"),ve()):we()):(r.actions.contains("callback")&&r.actions.splice(r.actions.indexOf("callback"),1),r.actions.contains("execute_custom_func")&&r.actions.splice(r.actions.indexOf("execute_custom_func"),1),J("#ff-webhook-link-text").html(J.i18n("writer.fillablefields.TRIGGER_WEBHOOK_AND_CUSTOM_FUNCTIONS",["<span id='ff-webhook-no-link'>","</span>"])),ve())):"custom_message"==e?(be("response_message"),i=J("#ff-custom-message").prop("checked"),i?(J("#ff-custom-message-link-text").html(J.i18n("writer.fillablefields.SHOW_CUSTOM_MESSAGE_AND_REDIRECTION",["<span id='ff-custom-message-link' onclick=\"FillAutomationHandler.openCustomMessageDlg(true)\" class='am-opt-link'>","</span>"])),r.info.redirect_info&&""!==r.info.redirect_info.url||r.info.show_success_msg_info&&""!==r.info.show_success_msg_info.message?(!r.actions.contains("show_success_msg")&&(!r.info.show_success_msg_info||""!=r.info.show_success_msg_info.message)&&r.actions.push("show_success_msg"),!r.actions.contains("redirect")&&(!r.info.redirect_info||""!=r.info.redirect_info.url)&&r.actions.push("redirect"),ve()):Ue()):(r.actions.contains("show_success_msg")&&r.actions.splice(r.actions.indexOf("show_success_msg"),1),r.actions.contains("redirect")&&r.actions.splice(r.actions.indexOf("redirect"),1),J("#ff-custom-message-link-text").html(J.i18n("writer.fillablefields.SHOW_CUSTOM_MESSAGE_AND_REDIRECTION",["<span id='ff-custom-message-no-link'>","</span>"])),ve())):"submitter_permission"==e?(be("submitter_permission"),et()):"configure_sign_collection"==e?(Re("configure_sign_collection"),J("#ff-sign-sub-link-text").html(J.i18n("writer.fillablefields.ALLOW_RESPONDEDNTS_MSG",["<span id='ff-sign-sub-link' onclick=\"\" class=''>","</span>"])),i=J("#ff-sign-sub").prop("checked"),i?!r.actions.contains("sign.configure")&&r.actions.push("sign.configure"):Te(o.sign_info)?(J("#ff-sign-sub").zstatebutton("checked",!0),me()):r.actions.splice(r.actions.indexOf("sign.configure"),1),ve()):"store_in_sheet"==e?(be("store_in_sheet"),i=J("#ff-store-in-sheet").prop("checked"),i?(J("#ff-sheet-link-text").html(J.i18n("writer.fillablefields.STORE_IN_SHEET",["<span id='ff-sheet-link' onclick=\"FillAutomationHandler.openSheetDlg(true)\" class='am-opt-link'>","</span>"])),!r.actions.contains("store_in_sheet")&&r.actions.push("store_in_sheet"),r.info.sheet_info&&(r.info.sheet_info.workbook_id||r.info.sheet_info.folder_id)?ve():xe()):(r.actions.contains("store_in_sheet")&&r.actions.splice(r.actions.indexOf("store_in_sheet"),1),J("#ff-sheet-link-text").html(J.i18n("writer.fillablefields.STORE_IN_SHEET",["<span id='ff-sheet-no-link'>","</span>"])),ve())):"forward_draft"==e&&(be("forward_draft"),i=J("#ff-forward-draft").prop("checked"),i?(J("#ff-forward-draft-link-text").html(J.i18n("writer.fillablefields.SEND_RESPONSES_FOR_COMPLETION",["<span id='ff-forward-draft-link' onclick=\"FillAutomationHandler.openRespondentsDlg(true)\" class='am-opt-link'>","</span>"])),!r.actions.contains("forward_draft")&&r.actions.push("forward_draft"),r.info.forward_draft_info&&r.info.forward_draft_info.recipients&&r.info.forward_draft_info.recipients.length?ve():He()):(r.actions.contains("forward_draft")&&r.actions.splice(r.actions.indexOf("forward_draft"),1),J("#ff-forward-draft-link-text").html(J.i18n("writer.fillablefields.SEND_RESPONSES_FOR_COMPLETION",["<span id='ff-forward-draft-no-link'>","</span>"])),ve()))}},Ce=function(e,t){"submitter_permissions"===e?!r.info[e].contains(t)&&r.info[e].push(t):!r[e].contains(t)&&r[e].push(t)},ye=function(e,t){if("submitter_permissions"===e){var i=r.info[e].indexOf(t);i>-1&&(r.info[e]=r.info[e].slice(0,i).concat(r.info[e].slice(i+1)))}else{var i=r[e].indexOf(t);i>-1&&(r[e]=r[e].slice(0,i).concat(r[e].slice(i+1)))}},Fe=function(e){e&&be("save_to_folder");var t=FieldPreFillHandler.getDataSourceInfo();!t||t.fields&&t.fields.length||FieldPreFillHandler.fetchLatestFields();var i=function(){var e=MailMergeMergeAndStoreDlgHandler.getDetails();e.filename;r.info.document_name=e.filename,r.info.store_info={},r.info.store_info.folder_id=e.folderid,e.password&&(r.info.store_info.password=e.password),e.enable_pwd||(r.info.store_info.password=""),r.info.store_info.format=e.format||"pdf",r.info.store_info.overwrite_existing_file=e.overwrite_existing_file,r.info.store_info.mf_mapping=e.mf_mapping,ve("save_to_folder")},n=function(){o.actions.contains("store")||o.actions.contains("modify_doc_name")||(J("#ff-save-and-store").prop("checked",!1),J("#ff-store-link-text").html(J.i18n("writer.fillablefields.SAVE_TO_FOLDER",["<span id='ff-store-no-link'>","</span>"]))),J.dialogutil.close("mailmergemergeandstoredlg")},a=r.info.document_name?r.info.document_name:"Untitled Document_",s={filename:a};r.actions.contains("store")&&r.info.store_info.folder_id&&(s.folderId=r.info.store_info.folder_id),r.actions.contains("store")&&r.info.store_info.password&&(s.password=r.info.store_info.password),s.format=r.info.store_info&&r.info.store_info.format||"pdf",s.overwrite_existing_file=r.info.store_info.overwrite_existing_file||!1,s.mf_mapping=r.info.store_info&&r.info.store_info.mf_mapping||{};var l={defaultValues:s,title:J.i18n("writer.fillablefields.SAVE_TO_A_FOLDER"),btns:[J.i18n("writer.common.SAVE")],saveOnly:!0,excludePassword:!1,isFillSubmit:!0,callback:i,cancel_callback:n,format:"pdf",showOverwriteOption:!0};MailMergeMergeAndStoreDlgHandler.open(l),J("#mm-storedlg").find("input[name=format][value=pdf]").trigger("click")},Me=function(e){e&&be("email");var t=FieldPreFillHandler.getDataSourceInfo();!t||t.fields&&t.fields.length||FieldPreFillHandler.fetchLatestFields();var i=function(){var e=MailMergeEmailDlgHandler.getEmailDetails();if(e.recipients.length>0){for(var t=e.recipients,i="",n=0;n<t.length;n++)i+=n+1<t.length?t[n]+",":t[n];r.info.email_info.recipients=e.recipients}if(e.bcc){for(var o=e.bcc,a="",n=0;n<o.length;n++)a+=n+1<o.length?o[n]+",":o[n];r.info.email_info.bcc=e.bcc}if(e.cc){for(var s=e.cc,l="",n=0;n<s.length;n++)l+=n+1<s.length?s[n]+",":s[n];r.info.email_info.cc=e.cc}r.info.email_info.from_address=e.from_address,r.info.email_info.reply_to=e.reply_to,r.info.email_info.subject=e.subject,r.info.email_info.message=e.message,r.info.email_info.messageHTML=e.messageHTML,r.info.email_info.messageJSON=e.messageJSON,r.info.email_info.attachment_name=e.attachment_name,e.storeinfo?(r.info.email_info.storeinfo={},r.info.email_info.storeinfo.filename=e.storeinfo.filename,r.info.email_info.storeinfo.folderid=e.storeinfo.folderid,r.info.email_info.storeinfo.format=e.storeinfo.format,e.storeinfo.password&&(r.info.email_info.storeinfo.password=e.storeinfo.password),r.info.email_info.storeinfo.overwrite_existing_file=e.storeinfo.overwrite_existing_file):delete r.info.email_info.storeinfo,r.info.email_info.format=e.format||"html";var d=MailMergeUtil.getFieldMappingFromObject(r.info.email_info,{includeRLFields:!0});d&&!ZWJSONUtils.isEmptyObject(d)&&(r.info.email_info.mf_mapping=d),ve("email")},n=function(){o.actions.contains("email")||(J("#ff-email-submission").prop("checked",!1),J("#ff-email-link-text").html(J.i18n("writer.fillablefields.SEND_AS_EMAIL",["<span id='ff-email-no-link' onclick=\"FillAutomationHandler.openEmailDlg(true)\" class='am-opt-link'>","</span>"]))),J.dialogutil.close("mailmerge_emaildlg")},a=[],s=[],l=[],d={};if(r.info.email_info){var c=r.info.email_info.recipients;a="string"==typeof c?c.split(","):c;var u=r.info.email_info.cc;s=u&&"string"==typeof u?u.split(","):u;var p=r.info.email_info.bcc;l=p&&"string"==typeof p?p.split(","):p,d=JSON.parse(JSON.stringify(r.info.email_info)),d.recipients=a,d.cc=s,d.bcc=l,(r.info.email_info.cattachmentsInfo||D)&&(d.common_attachments=r.info.email_info.cattachmentsInfo||D),r.info.email_info.format?d.format=r.info.email_info.format:d.format="pdf",d.emailtype="attachment",r.info.email_info.storeinfo?d.emailtype="link":"html"==r.info.email_info.format&&(d.emailtype="inline"),d.mf_mapping=r.info.email_info.mf_mapping}else a.put(editorProps.userInfo.email),d={recipients:a,format:"pdf"};var g={saveOnly:!0,btns:[J.i18n("writer.common.SAVE")],title:J.i18n("writer.documentautomation.EMAIL_SETTINGS"),isFillSubmit:!0,defaultValues:d,callback:i,cancel_callback:n};MailMergeEmailDlgHandler.open(g)},we=function(e){e&&be("webhook_custom_function");var t={init:function(){n=J("#ff-webhookcustomfunction").find("#fill_custom_func_name"),r.actions.contains("execute_custom_func")&&r.info.fill_custom_function_info&&(v=r.info.fill_custom_function_info.custom_function_name,b=r.info.fill_custom_function_info.custom_function_id,n.text(v)),J("#webhook_custom_dlg_save").off("click").on("click",FillAutomationHandler.saveConfFromDialog.bind(null,"webhook_custom_function"))},get:function(e,t){switch(e.action){case"webhook_url":if(r.info.callback_info.url)return J("#ff-webhookcustomfunction").find("#ff-webhook-url").val(r.info.callback_info.url),r.info.callback_info.url;break;case"execute_custom_func":r.actions.contains(e.action)&&n.show();default:return r.actions.contains(e.action)}},set:function(e,t,i){switch(e.action){case"webhook_url":r.info.callback_info.url=t;break;case"execute_custom_func":J("#custom_function_checkbox").prop("checked")?n.show():n.hide();default:(t?Ce:ye).call(null,"actions",e.action)}}};J.dialogutil.open("webhookcustomfunctions",void 0,t)},Ue=function(t){t&&be("response_message");var i={init:function(){var t={content:r.info.show_success_msg_info.messageJSON||r.info.show_success_msg_info.message,placeholder:J.i18n("writer.automation.PASTE_SUCCESS_MSG_HERE")};e=ZWRichTextEditor.init(J("#ff-response-message")[0],t),J("#custom_message_dlg_save").off("click").on("click",FillAutomationHandler.saveConfFromDialog.bind(null,"custom_message"))},get:function(e,t){switch(e.action){case"success_msg":break;case"redirect_url":return r.info.redirect_info.url;default:return r.actions.contains(e.action)}},set:function(t,i,n){switch(t.action){case"success_msg":r.info.show_success_msg_info.message=e.getText(e.getJSON());break;case"redirect_url":r.info.redirect_info.url=i;break;default:(i?Ce:ye).call(null,"actions",t.action)}}};J.dialogutil.open("responsemsgandredirectionsdlg",void 0,i)},xe=function(){var e,t,i,n,o,a,s,l={init:function(){o=J("#savetozohosheetdialog"),a=o.find("#ff-sheet-choose-location-cont"),s=o.find("#ff-sheet-choose-workbook-cont"),J("#ff-sheet-notify-container").hide(),J("#ff-sheet-chosen-location").hide(),J("#ff-sheet-remove-workbook").hide(),editor.doc.docInfo.TEMPLATE_SETTINGS&&editor.doc.docInfo.TEMPLATE_SETTINGS.fill&&editor.doc.docInfo.TEMPLATE_SETTINGS.fill.onsubmit&&editor.doc.docInfo.TEMPLATE_SETTINGS.fill.onsubmit.sheet_info&&(r.info.sheet_info=JSON.parse(JSON.stringify(editor.doc.docInfo.TEMPLATE_SETTINGS.fill.onsubmit.sheet_info)));var n=!!(editor.doc.docInfo.TEMPLATE_SETTINGS&&editor.doc.docInfo.TEMPLATE_SETTINGS.fill&&editor.doc.docInfo.TEMPLATE_SETTINGS.fill.onsubmit&&editor.doc.docInfo.TEMPLATE_SETTINGS.fill.onsubmit.sheet_info&&editor.doc.docInfo.TEMPLATE_SETTINGS.fill.onsubmit.sheet_info.workbook_id);J("#save_to_sheet_dlg_save").disable(),J("#save_to_sheet_dlg_save").off("click").on("click",FillAutomationHandler.saveConfFromDialog.bind(null,"store_in_sheet")),Utils.initFolderChooser({container_id:"ff-sheet-choose-location",folderId:r.info.sheet_info.folder_id,calbackFn:function(i){e=i.folderId,t=i.parentFolder,r.info.sheet_info.folder_id=e}}),Macros.isWorkDriveDocument()&&J("#ff-sheet-workbook-picker").off("click").on("click",d),Macros.isWorkDriveDocument()||n||(J("input[name=savetype]").eq(1).disable(),J("#ff-sheet-notify-container").show(),Notification.show({container:"#ff-sheet-notify-container",translatedMessage:!0,message:"Please migrate to WorkDrive to pick an existing workbook",setTimer:!1,type:"warning",close:!1})),!r.info.sheet_info.folder_id&&r.info.sheet_info.workbook_id?(a.hide(),s.show(),J("#save_to_sheet_dlg_save").text(J.i18n("writer.common.PROCEED"))):(a.show(),s.hide(),J("#save_to_sheet_dlg_save").text(J.i18n("writer.common.CREATE"))),o.find(".ui-right-overlap-btn")[r.info.sheet_info.workbook_id?"show":"hide"](),o.find(".ui-right-overlap-btn").off("click").on("click",p),i=r.info.sheet_info.workbook_id,J("#ff-sheet-workbook-name").val(r.info.sheet_info.worksheet_name),n&&(a.hide(),s.show(),J("#save_to_sheet_dlg_save").enable(),J("#ff-sheet-operation-cont").hide(),J("#ff-sheet-choose-workbook-text").text(J.i18n("writer.automation.CHOSEN_WORKBOOK")),J("#save_to_sheet_dlg_save").text(J.i18n("writer.common.DONE")),J("#ff-sheet-chosen-name-cont").html(r.info.sheet_info.workbook_name).click(p),J("#ff-sheet-choose-workbook").hide(),J("#ff-sheet-chosen-location").show(),J("#ff-sheet-folder-name").html(t),J("#ff-sheet-workbook-picker").hide(),J("#ff-sheet-remove-workbook").show().click(c))},get:function(e,t){switch(e.action){case"new":return!!r.info.sheet_info.folder_id&&!r.info.sheet_info.workbook_id||!r.info.sheet_info.folder_id&&!r.info.sheet_info.workbook_id;case"existing":return!!r.info.sheet_info.folder_id&&!!r.info.sheet_info.workbook_id;case"sheet_name":return r.info.sheet_info.worksheet_name;case"workbook_name":return r.info.sheet_info.workbook_name;default:return r.actions.contains(e.action)}},set:function(e,t,i){switch(e.action){case"new":a.show(),s.hide(),J("#save_to_sheet_dlg_save").text(J.i18n("writer.common.CREATE"));break;case"existing":a.hide(),s.show(),J("#save_to_sheet_dlg_save").text(J.i18n("writer.common.PROCEED"));break;case"sheet_name":var n=J.i18n("writer.automation.INVALID_SHEETNAME_ERROR",["_-&+$@*#'\""]);if(!u.test(t))return J("#ff-worksheet-name-error-msg-cont").show(),J("#ff-worksheet-name-error-msg-cont").html(n),J("#ff-worksheet-name-cont").addClass("ui-validation-error"),void J("#save_to_sheet_dlg_save").disable();t!=r.info.sheet_info.worksheet_name&&delete r.info.sheet_info.worksheet_id,r.info.sheet_info.worksheet_name=t,""!=t&&" "!=t?J("#save_to_sheet_dlg_save").enable():J("#save_to_sheet_dlg_save").disable();break;default:(t?Ce:ye).call(null,"actions",e.action)}}},d=function(){WDHandler.initialiseSaveAs(function(){WDHandler.chooseNativeFile("zw","zohosheet",!0)})},c=function(){delete r.info.sheet_info.workbook_name,delete r.info.sheet_info.workbook_id,delete r.info.sheet_info.worksheet_name,delete r.info.sheet_info.worksheet_id,J("#ff-sheet-workbook-picker").text(J.i18n("writer.common.CHOOSE")).show(),Macros.isWorkDriveDocument()&&J("#ff-sheet-workbook-picker").off("click").on("click",d),J("#save_to_sheet_dlg_save").disable(),J("#ff-sheet-operation-cont").show(),J("#ff-sheet-choose-workbook-text").text(J.i18n("writer.automation.CHOOSE_WORKBOOK")),a.show(),s.hide(),J("#save_to_sheet_dlg_save").text(J.i18n("writer.common.CREATE")),J("input[name=savetype]").eq(0).prop("checked",!0),J("#ff-worksheet-name-cont").val(""),o.find(".ui-right-overlap-btn").hide(),J("#ff-sheet-workbook-name").val(""),J("#ff-sheet-chosen-location").hide(),J("#ff-sheet-choose-workbook").show(),J("#ff-sheet-remove-workbook").hide(),Macros.isWorkDriveDocument()||(J("input[name=savetype]").eq(1).disable(),J("#ff-sheet-notify-container").show(),Notification.show({container:"#ff-sheet-notify-container",message:"writer.automation.MIGRATE_TO_WORKDRIVE_TO_PICK_A_WORKSHEET",setTimer:!1,type:"warning",close:!1}))},u=/^[a-zA-Z0-9_\-&+$@*#'" ]*$/,p=function(){Utils.safeWindowOpen(editorProps.urls.zohoSheetURL+"/sheet/open/"+i)};return Macros.isWorkDriveDocument()&&Macros.isFillableTemplate()&&J("body").on("wdsuccessrespcallback",function(e,o){var a=o.data;({workbook_name:a.name,workbook_id:o.id});i=o.id,n=a.name,r.info.sheet_info&&(r.info.sheet_info.workbook_id=i,r.info.sheet_info.workbook_name=n,delete r.info.sheet_info.folder_id),J("#ff-sheet-chosen-name-cont").html(n).click(p),J("#ff-sheet-choose-workbook").hide(),J("#ff-sheet-chosen-location").show(),J("#ff-sheet-folder-name").html(t),J("#ff-sheet-workbook-picker").text(J.i18n("writer.common.CHANGE",[""])),J("#ff-sheet-remove-workbook").show().click(c)}),function(e){e&&be("store_in_sheet"),J.dialogutil.open("savetozohosheetdialog",void 0,l)}}(),Be=function(){var e=J("#ff-worksheet-name-cont").val();""!=e&&" "!=e?J("#save_to_sheet_dlg_save").enable():J("#save_to_sheet_dlg_save").disable()},He=function(){var e={init:function(){var e=r.info.forward_draft_info.recipients||[],i=J("#addrespondentsdlg"),n=i.find("#fm-responders-list"),o=n.children();o.eq(0).find(".js-mm-field-choose").hide(),o.eq(0).find(".js-sign-emailfield").ztokenfield("setAttributes",{placeholder:t,disabled:!0}),e[0]&&Ge(o.eq(1).find(".js-sign-emailfield"),[e[0].recipient_1]),o.eq(1).find(".ui-icon-delete-blk-sm").hide(),o.find(".ui-mm-signdig-signer-dragicon").hide(),o.eq(1).find("#responder_2-ztokenfield-container").css("margin-left","auto"),o.eq(0).find("#responder_1-ztokenfield-container").css("margin-left","auto"),o.eq(1).find(".ui-separator-vt").hide(),ZWComponentUtil.initElem(o.eq(1)),ke(o.eq(1).find(".js-sign-emailfield"))},get:function(e,t){switch(e.action){case"recipients":r.info.forward_draft_info.recipients}},set:function(e,t,i){switch(e.action){case"recipients":}}},t=J.i18n("writer.common.RESPONDER_WHO_OPENS_THE_FORM");return function(t){t&&be("forward_draft"),J.dialogutil.open("addrespondentsdlg",void 0,e)}}(),Je=function(e){return/recipient_[0-9]/.test(e)},Ge=function(e,t,i){i=i||{};for(var n=[],o=0;o<t.length;o++){var r={},a=t[o];if("object"==typeof a){var s=Object.keys(a).find(Je);a=a.email||a[s]}var l=a;r.email=a,r.id=a,a&&(r.name=l,r.image=void 0,n.push(r))}e.ztokenfield("addTokens",n)},ke=function(e,t,i){e.ztokenfield("setAttributes",{dataSource:t||[]}),i||t||!window.Contacts||Contacts.getContacts().done(function(t){ke(e,t,!0)})},We=function(){var e=je(),t=[];e&&(e=e.slice(1),t=e.map(function(e,t){var i="recipient_"+(t+1),n={};return n[i]=e[0],n}),r.info.forward_draft_info.recipients=t,FillAutomationHandler.saveConfFromDialog.call(null,"forward_draft"))},Ye=function(){r.info.forward_draft_info.recipients=[],FillAutomationHandler.saveConfFromDialog.call(null,"forward_draft"),ae()},ze=function(e){for(var t=[],i=e.ztokenfield("getAllValues"),n=0;n<i.length;n++){var o=i[n],r=o.email||o.name||o.id;t.push(r)}return t},Ze=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},Ve=function(e){for(var t=0;t<e.length;t++){var i=e[t];if(!i.startsWith("$")&&!i.startsWith(UNICODE.MERGEFIELD_START)&&!Ze(i))return!1}return!0},je=function(e){for(var t,i,n,o=[],r=J("#addrespondentsdlg"),a=r.find("#fm-responders-list"),s=a.children(),l=s.length,d=0;d<l;d++){if(t=s.eq(d),n=ze(t.find(".js-sign-emailfield")),!n.length&&0!=d)return i=t.find(".ui-validation-error-message"),i.text(J.i18n("writer.common.PLEASE_ENTER_A_VALID_EMAIL_ADDRESS")).show(),void t.find(".ui-signer-token-field").addClass("ui-validation-error");o.push(n)}return o},Xe=function(e){var t=e?J.i18n("writer.common.DISABLED_MULTIPLE_RESPONDERS_MSG"):"",i=e?"0.5":1,n=e?"default":"pointer";J("#ff-forward-draft-link-text").css({opacity:i,cursor:n}).attr("title",t),J("#ff-forward-draft")[e?"disable":"enable"]()},Ke=function(){for(var e=je(),t=0;t<e.length;t++){var i=e[t];if(i&&e.indexOf(i)!=e.lastIndexOf(i))return!0}return!1},qe=function(e,t){var i=e.target,n=i.parents(".js-sign-signer-cont"),o=n.find(".ui-validation-error-message"),r=ze(i);return Ve(r)?Ke()?(i.ztokenfield("removeAllTokens"),i.focus(),o.text(J.i18n("writer.sign.SIGNER_EMAIL_DUPLICATED")).show(),void n.find(".ui-signer-token-field").addClass("ui-validation-error")):(o.hide(),t.element.parent().addClass("ui-single-sign-signer-cont"),void n.find(".ui-signer-token-field").removeClass("ui-validation-error")):(i.ztokenfield("removeAllTokens"),i.focus(),o.text(J.i18n("writer.sign.SIGNER_EMAIL_INVALID")).show(),void n.find(".ui-signer-token-field").addClass("ui-validation-error"))},Qe=function(e,t){t.element.parent().removeClass("ui-single-sign-signer-cont")},$e=function(e,t){var i=e.target,n=i.parents(".js-sign-signer-cont"),o=n.find(".ui-validation-error-message");o.hide()},et=function(){var e={init:function(){J("#submitter_permission_save").off("click").on("click",FillAutomationHandler.saveConfFromDialog.bind(null,"submitter_permission"))},get:function(e,t){switch(e.action){case"download":case"sign.send":case"sign.self":case"email.attachment":return r.info.submitter_permissions.contains("document."+e.action);case"navigationpanel":return!r.info.ui_options.hasOwnProperty("field_navigation_panel")||"show"==r.info.ui_options.field_navigation_panel;default:return r.actions.contains(e.action)}},set:function(e,t,i){switch(e.action){case"download":case"sign.send":case"sign.self":case"email.attachment":(t?Ce:ye).call(null,"submitter_permissions","document."+e.action);break;case"navigationpanel":r.info.ui_options.field_navigation_panel=t?"show":"hide";break;default:(t?Ce:ye).call(null,"actions",e.action)}}};J.dialogutil.open("submitterpermissionsdlg",void 0,e)},tt=function(e,t){var i=t.button&&"webhook_custom_dlg_cancel"===J(t.button).prop("id");(t&&t.closeButton||i)&&(o.actions.contains("callback")||o.actions.contains("execute_custom_func")||(J("#ff-webhook-custom-function").prop("checked",!1),J("#ff-webhook-link-text").html(J.i18n("writer.fillablefields.TRIGGER_WEBHOOK_AND_CUSTOM_FUNCTIONS",["<span id='ff-webhook-no-link'>","</span>"])))),J.dialogutil.close("webhookcustomfunctions")},it=function(e,t){var i=t.button&&"custom_message_dlg_cancel"===J(t.button).prop("id");(t.closeButton||i)&&(o.actions.contains("show_success_msg")||o.actions.contains("redirect")||(J("#ff-custom-message").prop("checked",!1),J("#ff-custom-message-link-text").html(J.i18n("writer.fillablefields.SHOW_CUSTOM_MESSAGE_AND_REDIRECTION",["<span id='ff-custom-message-no-link'","</span>"])))),J.dialogutil.close("responsemsgandredirectionsdlg")},nt=function(e,t){var i=t.button&&"save_to_sheet_dlg_cancel"===J(t.button).prop("id");(t.closeButton||i)&&(o.actions.contains("store_in_sheet")||(J("#ff-store-in-sheet").prop("checked",!1),J("#ff-sheet-link-text").html(J.i18n("writer.fillablefields.STORE_IN_SHEET",["<span id='ff-sheet-no-link'>","</span>"])))),J.dialogutil.close("savetozohosheetdialog")},ot=function(e,t){var i=t.button&&"respondents_dlg_cancel"===J(t.button).prop("id");(t.closeButton||i)&&(o.actions.contains("forward_draft")||(J("#ff-forward-draft").prop("checked",!1),J("#ff-forward-draft-link-text").html(J.i18n("writer.fillablefields.SEND_RESPONSES_FOR_COMPLETION",["<span id='ff-forward-draft-no-link'>","</span>"])))),J.dialogutil.close("addrespondentsdlg")},rt=function(e,t,i){var n=e.today_limit,o=e.available_limit,r=e.total_credits,a=e.available_credits,s=!0,l=UIUtils.isPropackAdmin(),d=function(){MsgDialog.close(),i&&i()},u=l?[c.EXTEND_LIMITS,c.LATER]:[c.CLOSE],p=l?[ZWPropackHandler.openCreditsAddonPayWidget,i]:[d],g="writer.automation.SUBMISSION_MONTHLY_LIMIT_MSG";o>a&&(o=a,n=r,s=!1);var f={container:t,setTimer:!1,type:"warning",close:!1,message:{key:g,args:[a,r]}};(o<1||a<1)&&(f.type="error"),!e.hide_upgrade&&l&&(UIUtils.isPropackEnabled()?(f.btnText="writer.propack.EXTEND_LIMITS",f.callback=ZWPropackHandler.openCreditsAddonPayWidget):(f.linkText="writer.common.UPGRADE_NOW",f.url=Macros.getUpgradeUrl())),o<1?at(c.DAILY_CAP_REACHED,l?c.EXTEND_LIMITS_ADMIN_MSG:EXTEND_LIMITS_USER_MSG,u,p):a<1&&at(c.LIMIT_REACHED,l?c.EXTEND_LIMITS_ADMIN_MSG:EXTEND_LIMITS_USER_MSG,u,p)},at=function(){var e={container:".ui-wdialog",className:"ui-wdialog-alert"};return function(t,i,n,o){var r=st(o||[]);MsgDialog.showMessage(n,CONST.SEVERITY_WARNING,t,i,void 0,void 0,r,!0,!0,e)}}(),st=function(e){return function(t){var i=t-1;e[i]&&e[i]()}},lt=function(){MsgDialog.close(),ZWPropackHandler.contactSupport()},dt=function(){var e=editorProps.urls.kbPageURL+"how-to-document-automation/articles/how-to-increase-document-merge-limits-in-writer";Utils.safeWindowOpen(e)},ct=function(){var e=editorProps.urls.zohoURL+"/sign/pricing.html";Utils.safeWindowOpen(e)},ut=function(){Utils.safeWindowOpen(l)},pt={id:"fillFieldHeaderItem",itemType:"custom",innerHTML:"<div class='zmenu__text'>"+J.i18n("writer.common.FILLABLE_FIELDS")+"</div>",className:"ui-custom-menuitem zmenu-ttl-with-line",isHeader:!0},gt={id:"fillFieldHeaderItem",itemType:"custom",innerHTML:"<div class='zmenu__text'>Datasource fields</div>",className:"ui-custom-menuitem zmenu-ttl-with-line",isHeader:!0},ft={id:"noFillFieldsMsgItem",itemType:"custom",innerHTML:"<div class='ui-clr-note'>"+J.i18n("writer.automation.NO_FIELDS_AVAILABLE")+"</div>",className:"ui-custom-menuitem"},Et={id:"submitterEmailItem",label:u,name:u,appData:{action:"FillAutomationHandler.insertFieldInRecipient",params:{}}},Tt=function(e){var t=[],i=editor.getDocument().getAllFields(),n=e.fieldTypes;for(var o in i){var r=i[o];r.type==NODE_TYPE.FILLABLEFIELD&&r.name&&(n?("string"==typeof n&&(n=[n]),n.indexOf(r.getFillableFieldType())!=-1&&t.push(mt(o,r,e))):t.push(mt(o,r,e)))}return 0==t.length&&t.push(ft),t},mt=function(e,t,i){var n="datasource"==i.source,o={element:i.targetElem||i.target,fieldInfo:n?t:t.rawFormat,singleField:i.singleField,source:i.source};i.targetElem&&(i.targetElem[0].id.includes("qrcode")||"barcode-text"===i.targetElem[0].id)&&(o.insertInFormatArray=!0);var r={action:"FillAutomationHandler.insertFieldInText",params:o},a=i.callback;a&&(r.action=a);var s=n?t.display_name:t.name,l={id:e,appData:r,label:s,name:s,iconClassName:n?"":FillableFieldsHandler.getFieldIconClass(t.getFillableFieldType())};return l},ht=function(e){return Et.appData.params.element=e.target,Et},It=function(){var e,t=function(e,t){var i=(t.data||{}).id;"fillFieldHeaderItem"!=i&&"noFillFieldsMsgItem"!=i||e.preventDefault()},i=[{id:"autoFieldHeaderItem",itemType:"custom",innerHTML:"<div class='ui-semibold zmenu__text'>"+J.i18n("writer.common.AUTO_FIELDS")+"</div>",className:"ui-custom-menuitem zmenu-ttl-with-line clearfix",isHeader:!0},{id:"docSeqNumberFieldItem",label:J.i18n("writer.common.DOCUMENT_SEQUENCE"),name:J.i18n("writer.common.DOCUMENT_SEQUENCE"),icon:"ui-sprit-lazy ui-icon-autonum-sm"},{id:"docNameFieldItem",label:J.i18n("writer.common.FILLED_DOCUMENT_NAME"),name:J.i18n("writer.common.FILLED_DOCUMENT_NAME"),icon:"ui-sprit-lazy ui-icon-doc-name-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_name"}}},{id:"docSharedLinkItem",label:J.i18n("writer.common.FILLED_DOCUMENT_LINK"),name:J.i18n("writer.common.FILLED_DOCUMENT_LINK"),icon:"ui-sprit-lazy ui-icon-merge-public-doc-sm",menuItems:[{id:"docSharedLinkItemAsUrlItem",label:J.i18n("writer.common.SHARED_LINK_PUBLIC_URL"),name:J.i18n("writer.common.SHARED_LINK_PUBLIC_URL"),icon:"ui-sprit-lazy ui-icon-text-link-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_shared_link"}}},{id:"docSharedLinkItemAsQRCodeItem",label:J.i18n("writer.common.SHARED_LINK_PUBLIC_QRCODE"),name:J.i18n("writer.common.SHARED_LINK_PUBLIC_QRCODE"),icon:"ui-sprit-lazy ui-icon-qrcode-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_shared_link_qrcode"}}}]},{itemType:"separator"}],n={"ff-doc-name":"store_to_folder","ff-email-recipient":"email_recipient","ff-email-cc-recipient":"email_cc","ff-email-bcc-recipient":"email_bcc","ff-email-message":"email_message","ff-signer-email":"signer_recipient","ff-signer-host-email":"signer_recipient","ff-sequence-prefix":"sequence_prefix","ff-sequence-suffix":"sequence_suffix","ff-responder-fields":"responder_email"},o=["#mailmerge-text-emailsubject","#mm-email-attachmentname","#signdlg-subject","#signdlg-attachname"],r=function(e){for(var t=[],n=0;n<i.length;n++){var o=ZWJSONUtils.clone(i[n]);if("docSeqNumberFieldItem"==o.id){if("sequence_prefix"==e.source||"sequence_suffix"==e.source)continue;o.menuItems=a(e)}else if("docSharedLinkItem"==o.id){if("email_message"!=e.source)continue;for(var r=o.menuItems||[],s=0;s<r.length;s++){var l=r[s],d=l.appData;if(d){var c=d.params;c.data=e}}}else if("docNameFieldItem"==o.id&&"email_message"!=e.source)continue;var d=o.appData;if(d){var c=d.params;c.data=e}t.push(o)}return t},a=function(e){var t=[],i=PrepareDocumentHandler.getSequenceNumbers();for(var n in i){var o=i[n],r=o.name,a={id:r,label:r,value:r,appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{data:e,fieldInfo:o,type:AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER}}};t.push(a)}t.push({itemType:"separator"});var s=function(t){insertAutoFields({data:e,fieldInfo:t,type:AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER})},a={label:J.i18n("writer.common.CREATE_DOCUMENT_SEQUENCE"),value:J.i18n("writer.common.CREATE_DOCUMENT_SEQUENCE"),icon:"ui-sprit-lazy ui-icon-insert-date-sm",appData:{action:"DocSequenceDlgHandler.open",params:{action:"createNew",callback:s}}};return t.push(a),t};return function(i,a){var s=[],l={};l.target=a.forElement;var d=l.target[0].id,c=n[d],u=JSON.parse(l.target.attr("mm-zmenu-data"));l.callback=u.callback,o.contains(u.target)&&(c="docname","ff-signer-name"===l.target[0].id&&(c="signer_name")),"datasrc"==u.fieldTypes&&(c="datasource"),l.source=c,l.targetElem=J(u.target),l.fieldType=u.fieldTypes,l.skipAutoFields=u.skipAutoFields,Et.appData.params.element=l.targetElem,e=J("#ff-field-menu"),e.zmenu(),e.zmenu("removeAllMenuItems");var p=l.targetElem.attr("id"),g=p&&p.indexOf("responder")>=0;if("signer_recipient"==c&&!g&&s.push(Et),s.push("datasource"==c?gt:pt),"datasource"==c){var f=FieldPreFillHandler.getDataSourceInfo().fields;f.forEach(function(e){s.push(mt(e.id,e,l))}),l.skipAutoFields=!0}else{var E=editor.getDocument().getAllFields();for(var T in E)E[T].type==NODE_TYPE.FILLABLEFIELD&&E[T].name&&(!l.fieldType||E[T].getFillableFieldType()==l.fieldType)&&s.push(mt(T,E[T],l))}if(s.length==("signer_recipient"!=c||g?1:2)&&s.push(ft),!l.skipAutoFields){var m=r(l);s=m.concat(s)}e.zmenu("addMenuItems",s),e.unbind("zmenubeforehide").bind("zmenubeforehide",t),e.unbind("zmenuitemclick").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),e.unbind("zmenusubmenuitemclick").bind("zmenusubmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),e.unbind("zmenubeforesubmenushow").bind("zmenubeforesubmenushow",function(e,t){t.menu.unbind("zmenusubmenuitemclick").bind("zmenusubmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)})})}}(),_t=function(e){var t=J(e.element),i=e.fieldInfo,n=t.val()||"",o="datasource"==e.source;if("ztokenfield"==t.attr("ctype")){var r={},a=[];r.id=o?i.id:i.name,r.email=i.email,r.type="field",e.insertInFormatArray?r.name=UNICODE.MERGEFIELD_START+i.name+UNICODE.MERGEFIELD_END:r.name="${"+(o?i.display_name:i.name)+"}",r.image=void 0,a.push(r),t.ztokenfield("addTokens",a)}else n+=e.type===AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER||e.insertInFormatArray?UNICODE.MERGEFIELD_START+i.name+UNICODE.MERGEFIELD_END:"${"+(o?i.display_name:i.name)+"}",t.val(n).trigger("blur"),t.keyup()},At=function(e){var t=J(e.element),i={},n=[];i.id=Utils.randomString(),i.email=void 0,i.type="field",i.name="${"+u+"}",i.image=void 0,n.push(i),t.ztokenfield("addTokens",n)},St=function(e,t){var i={},n=t.fieldInfo,o=t.type,r=["document_name","document_shared_link","document_shared_link_qrcode","document_org_shared_link","document_org_shared_link_qrcode"];if(r.contains(o)){i.type="autofield",i.fieldId=o,i.props={class:"am-opt-link"};var a="document_org_shared_link"==o||"document_org_shared_link_qrcode"==o,s=a?J.i18n("writer.common.SHARED_LINK_ORG_URL"):J.i18n("writer.common.SHARED_LINK_PUBLIC_URL");"document_name"==o?i.fieldName="["+J.i18n("writer.common.FILLED_DOCUMENT_NAME")+"]":"document_shared_link"==o||"document_org_shared_link"==o?i.fieldName="["+s+"]":"document_shared_link_qrcode"!=o&&"document_org_shared_link_qrcode"!=o||(i.fieldName=J.i18n("writer.qrcode.QRCODE"),i.contentType="qrcode",i.props={src:QRCodeGenerator.generateOperationalQRCode(location.href),height:100,width:100,title:"["+s+"]"})}else if(o==AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER)i.type="mergefield",i.fieldId=n.name,i.fieldName=n.name,i.meta={sequencenumberinfo:n};else{var l=n.hasOwnProperty("display_name");i.type="mergefield",i.fieldId=l?MailMergeFieldUtil.getFieldId(n):n.id,i.fieldName=l?n.display_name:n.name||n.ffInfo.name,!l&&(i.meta={fillablefieldinfo:n.ffInfo})}e.insertMergeField(i)},Rt=function(e){var t=e.data,i=e.fieldInfo,n={element:(t.targetElem||t.target)[0],fieldInfo:i,singleField:t.singleField,type:e.type},o=t.callback?Utils.getAsFunction(t.callback).fn:FillAutomationHandler.insertFieldInText;o(n)},Ot=function(e,t,i){var n=ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/fill/form");J.ajax({type:"POST",global:!1,async:!0,url:n,data:{is_form_active:e},dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(i){editorProps.isFillableForm=e,PubSub.publish("FillableForm/update"),e&&PubSub.publish("DocuFiller/Addon"),e&&UIUtils.isPropackEnabled()&&!ZWLicense.isFillAddonPurchased()&&J("#premium-filetype-banner").detach().appendTo(J("#premium-filetype-cont")).css("display","flex")&&J("#panel-container").css("margin-top","72px")&&J("#editor-rightPanel").css("margin-top","32px"),!e&&J("#panel-container").css("margin-top",Z("topband")[0].offsetHeight+Z("topband")[0].offsetTop+"px")&&J("#editor-rightPanel").css("margin-top","0px"),t&&t(i)},error:function(e,t,n){i&&i()}})},bt=function(e,t){var i=J("#ff-highlight-style")[0];i||t.state?i&&i.remove():(i=document.createElement("style"),i.id="ff-highlight-style",i.innerHTML=".fillablefield, .signerfield, .mergeField, .autodate, .autoauthor, .autoformula, .first_name, .last_name, .user_email, .user_phone .autocreateddate, .autolastmod, .autopno, .autopcnt { cursor: default; } .fillablefield, .ui-e-combofield:before { background-color: transparent !important; box-shadow: none !important;} .fillablefield .ui-eff-label__iconCont:before, .ui-eff-label__bg{display: none;} .ui-efillablefield-label:before {content: none;} .ui-layered-fillable-popover.ui-ffefill-input.ui-ffefill-errfld{ background-color: transparent !important}",document.head.appendChild(i))},vt=function(e){return e.onsubmit.actions.contains("sign")&&!!e.onsubmit.sign_info.recipients.find(function(e,t){return e.action_type==SIGNER_ROLE.APPROVE&&""!=e["recipient_"+(t+1)]})},Dt=function(e){return e.onsubmit.actions.contains("sign")&&!!e.onsubmit.sign_info.recipients.find(function(e,t){return e["recipient_"+(t+1)]=="${"+u+"}"})},Lt={selfsign:{BTN_TEXT:c.SIGN_YOURSELF,BTN_CALLBACK:"FillableFieldsHandler.openSelfSignDialog",BTN_CALLBACK_PARAMS:[]},approval:{BTN_TEXT:c.SEND_FOR_APPROVAL,BTN_CALLBACK:"FillableFieldsHandler.sendForApproval",BTN_CALLBACK_PARAMS:[]},sendforsign:{BTN_TEXT:c.SEND_FOR_SIGN,BTN_CALLBACK:"UIUtils.loadDocsComMoveResources",BTN_CALLBACK_PARAMS:[["AutomationHandler.openSignDlg"]]},configuresign:{BTN_TEXT:c.SEND_FOR_SIGN,BTN_CALLBACK:"UIUtils.loadDocsComMoveResources",BTN_CALLBACK_PARAMS:[["FillableFieldsHandler.sendForSignFromPublisher"]]},submitandsign:{BTN_TEXT:c.SUBMIT_AND_SEND_FOR_SIGN,BTN_CALLBACK:"UIUtils.loadDocsComMoveResources",BTN_CALLBACK_PARAMS:[["FillableFieldsHandler.submitAndSendForSign"]]},submitandsendforsign:{BTN_TEXT:c.SEND_FOR_SIGN,BTN_CALLBACK:"FillableFieldsHandler.handleFillSubmit",BTN_CALLBACK_PARAMS:[null,!0]}};(USER_ROLE.PUBLIC===editorProps.userInfo.role||editorProps.options.REMOTE)&&editorProps.isPublishToFill||/SHAREDREAD|ANYONELINK_SHAREDREAD/.test(editorProps.userInfo.role)&&editorProps.isFillableForm?(J("#branding-publishfill").hide(),PubSub.subscribe("Document/LoadingComplete",function(){UIUtils.hideLoadingMsg(),editorProps.isEmbed?(J("#report-help-btn").show(),J("#ff_save_draft_btn").hide(),UIUtils.initComponent("report-help-btn"),J("#bottombar-publishfill,#ff-publish-embed-cont").removeClass("ui-hide"),J("#drawcontainer").css("margin-bottom","50px"),J("#scrollTopContainer").css("opacity",1).css("z-index",1e3),J("#bottom").on("click",function(){var e=J(".unselectableSection"),t=e.eq(e.length-1).offset().top;editor.editorPaneContainer.animate({scrollTop:t},"slow")})):(J("#branding-publishfill").show(),J("#bottombar-publishfill,#ff-publish-beforesubmit").removeClass("ui-hide"),Z("branding-publishfill").on("click",ToolbarHandler.handleZButtonClick),Z("bottombar-publishfill").on("click",ToolbarHandler.handleZButtonClick)),UIUtils.initComponent("bottombar-publishfill"),UIUtils.initComponent("branding-publishfill"),J("#bottombar").addClass("ui-hide");var e=editor.doc.docInfo,t=PUBLISH_TYPE.EXTERNAL==e.PUBLISH_SCOPE||"ANYONELINK_SHAREDREAD"==editorProps.userInfo.role,i=!!editorProps.options.REMOTE,n=!i&&PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.FILL),o=function(e){return J("#ff-publish-list-opt-"+e.split(".")[0]+",#ff-topband-list-opt-"+e.split(".")[0]+",#ff-submitactions-"+e.split(".").join("-"))},r=function(){return!(editorProps.orgInfo&&!editorProps.orgInfo.export_document)},a=function(e){var i;switch(e){case"download":i=!r();break;case"email.attachment":case"sign.send":i=t}o(e)[n.onsubmit.submitter_permissions.contains("document."+e)&&!i?"removeClass":"addClass"]("ui-hide"),l=l&&i},s=function(e){J("#ff-publish-print-btn,#ff-publish-print-second-btn,#ff-publish-print-opt,#ff-publish-print-second-opt,#ff-publish-print-tband-opt,#ff-publish-print-tband-second-opt,#ff-print-action-btn,#ff-print-action-second-btn")[e]()},l=!0;if(n){a("download"),a("email.attachment"),a("sign.send");var d,c=0==n.onsubmit.actions.length||1==n.onsubmit.actions.length&&n.onsubmit.actions.contains("sign.configure"),u=0==n.onsubmit.submitter_permissions.length;c&&(u?(J("#ff-publish-submit-btn,#ff_save_draft_btn").hide(),s("show")):(J("#ff-publish-submit-btn,#ff_save_draft_btn").show(),s("hide")),!u&&J("#ff-publish-beforesubmit").addClass("ui-hide")&&J("#ff-publish-aftersubmit,#ff-publish-submitactions").removeClass("ui-hide"),l&&J("#ff-print-action-btn,#ff-print-action-second-btn").show()),d=null==d&&vt(n)?"approval":d,d=!u&&null==d&&Dt(n)?"selfsign":d,d=null==d&&n.onsubmit.actions.contains("sign")&&n.onsubmit.actions.contains("sign.configure")&&2==n.onsubmit.actions.length?"configuresign":d;var p=(n.onsubmit.submitter_permissions.contains("document.sign.send"),!c);d=null==d&&n.onsubmit.actions.contains("sign")&&n.onsubmit.actions.contains("sign.configure")&&p?"submitandsign":d,d=null==d&&1==n.onsubmit.actions.length&&n.onsubmit.actions.contains("sign")?"submitandsendforsign":d,editorProps.isEmbed||!d?J("#ff-publish-action-btn").hide():d&&(Z("ff-publish-action-btn").zbutton("setAttribute","text",Lt[d].BTN_TEXT),Z("ff-publish-action-btn").off("click").on("click",function(){Utils.getAsFunction(Lt[d].BTN_CALLBACK).fn.apply(null,Lt[d].BTN_CALLBACK_PARAMS)}),J("#ff-publish-submit-btn")["approval"!=d&&"selfsign"!=d&&"submitandsign"!=d&&"submitandsendforsign"!=d&&"configuresign"!=d&&p?"show":"hide"](),J("#ff-publish-action-btn").zbutton("setAttribute","appearance","sendforsign"==d&&p?"normal":"primary"))}if(i){var g=editorProps.options.REMOTE.fillable_data.form_options||editorProps.form_options;J("#ff-publish-action-btn,#ff-publish-list-opt-download,#ff-publish-list-opt-email").hide(),J("#ff-publish-print-opt,#ff-publish-print-second-opt")[g.print?"show":"hide"](),J("#ff-publish-submit-btn")[g.submit?"show":"hide"](),J("#ff_save_draft_btn,#ff-publish-list-save-draft")[g.save_and_resume?"show":"hide"]()}!editorProps.isEmbed&&!i&&(!n||!n.submit_enabled)&&J("#bottombar-publishfill,#ff-publish-beforesubmit").addClass("ui-hide"),editor.onResize(),J("#ff_save_draft_btn")["ANYONELINK_SHAREDREAD"==editorProps.userInfo.role||i?"hide":"show"](),J("#ff-publish-view-logs-opt").hide()})):/^(SHAREDREAD|ANYONELINK_SHAREDREAD)$/i.test(editorProps.userInfo.role)&&!editorProps.isFillableForm&&bt(null,{state:!1});var Nt=function(){var e;return function(){return e||(e=new zt),!!e.fieldCount}}(),Pt=function(){var e=J("<a>");e.attr("href",editorProps.urls.base_url+"/open/"+Macros.getRId()+"/fillreports"),e.attr("target","_blank"),e.attr("rel","noreferrer noopener"),e.appendTo("body").get(0).click(),e.remove()},Ct=function(){var e=J("<a>");e.attr("href",window.location.href+"/fill?submit_type=test_submit"),e.attr("target","_blank"),e.attr("rel","noreferrer noopener"),e.appendTo("body").get(0).click(),e.remove()},yt=function(){var e=J("<a>");e.attr("href",window.location.href+"/fill?submit_type=self_submit"),e.attr("target","_blank"),e.attr("rel","noreferrer noopener"),e.appendTo("body").get(0).click(),e.remove()},Ft=function(){var e=function(){Q&&UIUtils.isPropackEnabled()&&!ZWLicense.isFillAddonPurchased()&&J("#premium-filetype-banner").detach().appendTo(J("#premium-filetype-cont")).show()&&J("#panel-container").css("margin-top","72px")};return function(){if(Q)return void e();var t=ZWLicense.fetchAllDetails();J.when(t).done(function(t){Q=!0,e()})}}(),Mt=function(){J("#fill-addon-popup").show(),ZWComponentUtil.init("fill-addon-popup")},wt=function(){if(!UIUtils.isPropackEnabled()||!editorProps.isFillableForm)return void UIUtils.openShareDialog();var e=ZWLicense.isFillAddonPurchased();return e?void UIUtils.openShareDialog():(J("#premiumsharedocdlg").show(),void ZWComponentUtil.init("premiumsharedocdlg"))},Ut=function(e){return J("#"+e).hide(),UIUtils.isPropackAdmin()?void ZWPropackHandler.openFillAddonPayWidget():void ne()},xt=function(){window.open(editor.getBaseURL()+"/new?from=fillableForm")},Bt=function(){if(editorProps.isFillableForm){if(!UIUtils.isPropackEnabled())return!0;var e=ZWLicense.isFillAddonPurchased();return e?void ExportDialog.exportAs("pdfform"):void Mt()}},Ht=function(){window.open(window.location.origin+"/writer/new?rid="+editor.doc.docInfo.RID+"&from=menu&resource_type=fillable")},Jt=function(){editorProps.isFillableForm||(t=!0,ee({submit_enabled:t,onsubmit:o,zuid:i,ui_options:s},a,function(){Ot(t)}))},Gt=function(e){if(!UIUtils.isPropackEnabled())return void(e&&e());var t,i,n,o=ZWLicense.isFillAddonPurchased(),r=UIUtils.isPropackAdmin();return o?void ZWLicense.fetchCreditPoints().done(function(o){return o.available_points>0?void(e&&e()):(t=r?c.REACHED_DOWNLOAD_LIMIT_MSG_ADDON_ADMIN:c.REACHED_DOWNLOAD_LIMIT_MSG_ADDON_USER,i=r?[c.EXTEND_LIMITS,c.LATER]:[c.CLOSE],n=r?[ZWPropackHandler.openCreditsAddonPayWidget,MsgDialog.close]:[MsgDialog.close],void at(c.REACHED_DOWNLOAD_LIMIT,t,i,n))}).fail(function(){UIUtils.showLoadingMsg(J.i18n("writer.common.GENERATING_PDF_FAILURE"),3e3)}):(t=r?c.ADDON_REQUIRED_FOR_OPERATION_MSG_ADMIN:c.ADDON_REQUIRED_FOR_OPERATION_MSG_USER,i=r?[c.BUY_ADDON,c.LATER]:[c.CLOSE],n=r?[ZWPropackHandler.openFillAddonPayWidget,MsgDialog.close]:[MsgDialog.close],void at(c.ADDON_REQUIRED_TITLE,t,i,n))},kt=function(){Gt(ExportDialog.exportAs.bind(null,"pdfform"))};!editorProps.isPublishToFill&&editorProps.isFillableForm&&PubSub.publish("Require/ProPack"),PubSub.subscribeOnce("Document/ComponentInitialized",function(){!editorProps.isPublishToFill&&editorProps.isFillableForm&&PubSub.publish("Require/FillAddon"),PubSub.publish("FillableForm/update"),editorProps.isFillableForm&&(Ft(),PubSub.publish("DocuFiller/Addon")),UIStateHandler.build(J("#premium-filetype-cont")[0]),UIUtils.isPropackEnabled()||J("#topband-share-btn-premium").hide()});var Wt={VALUE:1,NAME:2,SIZE:3,CROPRECT:4,CHECKED_VALUES:5,RESULT:6,LIST:7,CHECKBOX_VALUES:8},Yt={},zt=function(){var e={},t={},i=editor.getDocument();i.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(i){var n=i.getId(),o=i.getFillableFieldType();i&&n&&(e[n]=i,FILLABLEFIELD_TYPE.SELECTBOX==o?t[n]=i.getSelectedIndex():FILLABLEFIELD_TYPE.CHECKBOX==o||o==FILLABLEFIELD_TYPE.RADIO||o==FILLABLEFIELD_TYPE.MULTIPLECHOICE?t[n]=i.isChecked():FILLABLEFIELD_TYPE.IMAGE==o||FILLABLEFIELD_TYPE.SIGNATURE==o||FILLABLEFIELD_TYPE.INITIAL==o?t[n]={src:i.getValue(),width:i.style.width,height:i.style.height,cropRect:i.style.cropRect}:t[n]=i.getValue())}),this.fields=e,this.init_values=t,this.prefilledFields=Yt};return zt.prototype.constructor=zt,Object.defineProperties(zt.prototype,{fieldCount:{get:function(){return Object.keys(this.fields).length||0},set:function(e){return Object.keys(this.fields).length||0}}}),extend(zt.prototype,{getFieldById:function(e){return e?this.fields[e]:null},getFieldNo:function(e){return e?Object.keys(this.fields).indexOf(e)+1:null},getAllLinkedFields:function(e){var t,i=[];for(var n in this.fields)t=this.fields[n],t.type==e.type&&t.getFillableFieldType()==e.getFillableFieldType()&&t[ATTR_FILLABLEFIELD.FF_NAME]&&t[ATTR_FILLABLEFIELD.FF_NAME]==e[ATTR_FILLABLEFIELD.FF_NAME]&&i.push(t);return i},updateAllFieldValues:function(e,t,i,n){if((e||n)&&t&&null!=i)for(var o in this.fields){var r=this.fields[o],a=r.getName();r&&r.getFillableFieldType()==t&&(a?a==e:r.getId()==n)&&(t==FILLABLEFIELD_TYPE.CHECKBOX?r.setChecked(i):t==FILLABLEFIELD_TYPE.SELECTBOX?r.setSelectedIndex(i):r.isFillableImageField()&&t!==FILLABLEFIELD_TYPE.MULTILINE?(r.setValue(i.src),r.getFitType()==IMAGE_FIT_TYPE.FIXED?(r.style.originalWidth=i.originalWid||i.WIDTH||r.getSize().wid,r.style.originalHeight=i.originalHt||i.HEIGHT||r.getSize().ht,t==FILLABLEFIELD_TYPE.IMAGE&&i.cropRect&&(r.style.cropRect=i.cropRect)&&(r.style.img_fit="cropFit")):(r.style.width=(t==FILLABLEFIELD_TYPE.IMAGE?100:i.originalWid)||r.getSize().wid,r.style.height=(t==FILLABLEFIELD_TYPE.IMAGE?100:i.originalHt)||r.getSize().ht),i.src&&(r.style.src=i.src)):t===FILLABLEFIELD_TYPE.RADIO||t==FILLABLEFIELD_TYPE.MULTIPLECHOICE?r.getId()===n?r.setChecked(i):r.getFillableFieldType()===FILLABLEFIELD_TYPE.RADIO&&r.setChecked(!1):r.setValue(i))}},updateValue:function(e,t){if(e&&null!=t&&this.fields[e]){var i=this.fields[e],n=i.getFillableFieldType();n==FILLABLEFIELD_TYPE.CHECKBOX||n==FILLABLEFIELD_TYPE.MULTIPLECHOICE&&i.getId()==e||n==FILLABLEFIELD_TYPE.RADIO?i.setChecked(t):n==FILLABLEFIELD_TYPE.SELECTBOX?i.setSelectedIndex(t):i.isFillableImageField()&&i.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE?(i.setValue(t.src),t.size&&i.setFormats({ht:t.size.ht,wid:t.size.wid}),n==FILLABLEFIELD_TYPE.IMAGE&&t.cropRect&&(i.style.cropRect=t.cropRect)):i.setValue(t)}},getFillInfo:function(e){var t,i,n,o={},r=!1;for(var a in this.fields){t=this.fields[a],n=t.getFillableFieldType(),i=n===FILLABLEFIELD_TYPE.CHECKBOX||n==FILLABLEFIELD_TYPE.RADIO||n==FILLABLEFIELD_TYPE.MULTIPLECHOICE?t.isChecked():n===FILLABLEFIELD_TYPE.SELECTBOX?t.getSelectedIndex():t.getValue();var s=this.prefilledFields.hasOwnProperty(t.getId());if(t.isFillableImageField()&&t.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE?(t=editor.getDocument().getFieldById(t.getId()),r=s||this.init_values[t.getId()].src!==i||this.init_values[t.getId()].height!==t.rawFormat.ht||this.init_values[t.getId()].width!==t.rawFormat.wid||!!t.rawFormat.cropRect):r=s||this.init_values[t.getId()]!==i,r){if(o[a]={},o[a][Wt.VALUE]=i,t.getName()&&(o[a][Wt.NAME]=t.getName()),!e&&t.isFillableImageField()&&t.getFillableFieldType()!==FILLABLEFIELD_TYPE.MULTILINE){o[a][Wt.SIZE]=t.getSize(),o[a][Wt.CROPRECT]=t.style.cropRect,!o[a][Wt.CROPRECT]&&delete o[a][Wt.CROPRECT];var l=o[a][Wt.VALUE];o[a][Wt.VALUE]=l&&l.indexOf("data:image")!=-1||l.indexOf("mage.do")!=-1?"":l}n!=FILLABLEFIELD_TYPE.RADIO&&n!=FILLABLEFIELD_TYPE.MULTIPLECHOICE||(o[a][Wt.CHECKED_VALUES]=t.getValue()),n!=FILLABLEFIELD_TYPE.DATE&&n!=FILLABLEFIELD_TYPE.CURRENCY&&n!=FILLABLEFIELD_TYPE.SELECTBOX||(o[a][Wt.RESULT]=t.getFillableFieldResult()),n==FILLABLEFIELD_TYPE.SELECTBOX?o[a][Wt.LIST]=t.getList():n==FILLABLEFIELD_TYPE.CHECKBOX&&(o[a][Wt.CHECKBOX_VALUES]={checked:t.getCheckedValue(),unchecked:t.getUncheckedValue()})}}return o},clearFieldValues:function(){var e,t;for(var i in this.fields)e=this.fields[i],t=e.getFillableFieldType(),t==FILLABLEFIELD_TYPE.CHECKBOX||t===FILLABLEFIELD_TYPE.RADIO||t===FILLABLEFIELD_TYPE.MULTIPLECHOICE?e.setChecked(!1):t==FILLABLEFIELD_TYPE.SELECTBOX?e.setSelectedIndex(0):e.isFillableImageField()&&t!==FILLABLEFIELD_TYPE.MULTILINE?e.setValue(""):e.setValue(" ")},resetFieldValues:function(){var e,t,i;for(var n in this.fields)e=this.fields[n],i=e.getFillableFieldType(),t=this.init_values[e.id||e.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]],i==FILLABLEFIELD_TYPE.CHECKBOX||i===FILLABLEFIELD_TYPE.RADIO||i==FILLABLEFIELD_TYPE.MULTIPLECHOICE?e.setChecked(t):i==FILLABLEFIELD_TYPE.SELECTBOX?e.setSelectedIndex(t):e.isFillableImageField()&&i!==FILLABLEFIELD_TYPE.MULTILINE?(e.setValue(t.src),e.style.width=t.width,e.style.height=t.height,e.style.cropRect=t.cropRect?t.cropRect:{cropTop:"0.000%",cropBottom:"0.000%",cropLeft:"0.000%",cropRight:"0.000%"}):e.setValue(t)},isFieldFilled:function(e){var t=e.getFillableFieldType();if(t==FILLABLEFIELD_TYPE.RADIO){var i=!1;return this.getAllLinkedFields(e).forEach(function(e){i=e.isChecked()}),i}return e.isFilled()},areMandatoryFieldsFilled:function(){var e,t,i,n=!0;for(var o in this.fields)e=this.fields[o],t=e.getFieldValue(),i=this.init_values[e.id],e.isMandatory()&&!this.isFieldFilled(e)&&(n=!1);return n},getLabelledFieldValues:function(){var e,t,i,n,o={},r=!1;for(var a in this.fields)e=this.fields[a],i=e.getFillableFieldType(),n=e.getName(),n&&(t=i===FILLABLEFIELD_TYPE.CHECKBOX?e.isChecked():i===FILLABLEFIELD_TYPE.SELECTBOX?e.getSelectedIndex():e.getValue(),e.isFillableImageField()?(e=editor.getDocument().getFieldById(e.getId()),n=e.getName(),r=this.init_values[e.getId()].src!==t||this.init_values[e.getId()].height!==e.rawFormat.ht||this.init_values[e.getId()].width!==e.rawFormat.wid||!!e.rawFormat.cropRect):r=this.init_values[e.getId()]!==t,r&&(o[n]=t));return o},isFieldFilled:function(e){var t=e.getFillableFieldType();if(t==FILLABLEFIELD_TYPE.RADIO||t==FILLABLEFIELD_TYPE.MULTIPLECHOICE){var i=!1;return this.getAllLinkedFields(e).forEach(function(e){e.isChecked()&&(i=e.isChecked())}),i}return e.isFilled()},addToPrefilledFields:function(e,t){this.prefilledFields[e.getId()]={1:t}},addField:function(e){var t=e.getId(),i=e.getFillableFieldType();this.fields[t]=e,FILLABLEFIELD_TYPE.SELECTBOX==i?this.init_values[t]=e.getSelectedIndex():FILLABLEFIELD_TYPE.CHECKBOX==i||i==FILLABLEFIELD_TYPE.RADIO||i==FILLABLEFIELD_TYPE.MULTIPLECHOICE?this.init_values[t]=e.isChecked():FILLABLEFIELD_TYPE.IMAGE==i||FILLABLEFIELD_TYPE.SIGNATURE==i||FILLABLEFIELD_TYPE.INITIAL==i?this.init_values[t]={src:e.getValue(),width:e.style.width,height:e.style.height,cropRect:e.style.cropRect}:this.init_values[t]=e.getValue()}}),window.FillableFieldsModel=zt,{getDefaultTemplateSettings:g,handlePublish:N,updateMenu:M,updatePreferences:G,showLinkToFill:F,openFillPanel:Y,showFillPanel:z,toggleSubmitAction:$,openSubmitDialog:ie,openMoreOptionsDialog:oe,closeSubmitDialog:re,saveSubmitSettings:ae,updateSubmitSettings:_e,copyPublishFillLink:X,isPublishedToFill:j,getFillPublishOptions:K,updatePublishInfo:w,handlePublishToFill:q,toggleFieldHighlight:bt,openSignDialog:ue,saveSignSettings:le,storeFillSettings:ee,areEmptySignersPresent:Te,showLimitBanner:rt,areFillableFieldsPresent:Nt,populateFields:It,openDREDialog:pe,saveCustomFunction:ge,insertFieldInText:_t,insertFieldInRecipient:At,viewFillLogs:Pt,writeToUs:lt,openPropacKB:dt,learnMoreForSign:ct,openDocuFillerHelp:ut,testSubmissions:Ct,selfSubmit:yt,openFillableForm:Ft,showDocuFillerPopup:Mt,showSharePopup:wt,buyAddon:Ut,openNewForm:xt,downloadAsForm:Bt,newFillableForm:Ht,makeDocumentFillableForm:Jt,updateLinkTexts:Ae,handleFillCheckbox:Pe,openSaveToFolderDlg:Fe,openEmailDlg:Me,openWebhookAndCustomFunctionDlg:we,openCustomMessageDlg:Ue,openSheetDlg:xe,openRespondentsDlg:He,closeWebhookAndCustomFunctionDlg:tt,closeCustomMessageDlg:it,closeSheetDlg:nt,closeRespondentsDlg:ot,saveConfFromDialog:ve,afterTokenAdd:qe,afterTokenRemove:Qe,beforeSearch:$e,saveResponderDetails:We,resetResponders:Ye,isSelfSignPresent:Dt,downloadPDFForm:kt,getFillableFieldsMenu:Tt,getSubmitterEmailMenu:ht,insertFillableFieldsInRTE:St,validateSheetNameOnKeyPress:Be,insertAutoFieldsFromFFZmenuPopup:Rt,getEmailsFromTokenField:ze}}(),DelugeHandler=function(){var e,t=[],i={},n=function(e){var t={js:["https://"+editorProps.urls.delugeURL+"/js/includeDelugeEditor.js"],css:[]};zw.require(t,[],e)},o=function(t,i,n){var o={serviceName:"ZohoWriter",save:i,loading:{show:function(){UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING"))},hide:function(){UIUtils.hideLoadingMsg()}},callback:function(){e=window.delugeEditor,n&&n()}};DRE.initEditor(document.getElementById(t),o)},r=function(e,t,i){var n="/writer/api/v1/deluge/functions/"+e;E("GET",n,{},t,i)},a=function(e,i,n){var o="/writer/api/v1/deluge/functions",r=function(e){t=e.functions||t,i&&i(e)};E("GET",o,{category:e},r,n)},s=function(e,t,n){var o="/writer/api/v1/deluge/gallery/functions",r=function(n){i[e]=n.functions||i[e],t&&t(n)};E("GET",o,{category:e},r,n)},l=function(e){return i[e]},d=function(e,t,i,n,o,r){var a="/writer/api/v1/deluge/functions",s={},l=t;s.name=e,s.script=i,"newtask"!=l?a=a+"/"+l:s.category="user_sign",n&&(s.category=n),E("POST",a,s,o,r)},c=function(e,t,i,n){var o="/writer/api/v1/deluge/functions/"+e+"/execute",r={};n&&(r.function_params=JSON.stringify(n)),E("POST",o,r,t,i)},u=function(e,t,i){var n="/writer/api/v1/deluge/functions/"+e;E("DELETE",n,{},t,i)},p=function(e){var i=t.find(function(t){return t.name==e||t.workflow.name==e});return i&&i.id},g=function(e){var i=t.find(function(t){return t.id==e});return i&&(i.name||i.workflow.name)},f=function(e){var i,n=t.length;t.forEach(function(t,n){t.id==e&&(i=n)}),n>0&&i>=0&&(t=t.slice(0,i).concat(t.slice(i+1,n-1)))},E=function(e,t,i,n,o){J.ajax({type:e,data:i,async:!0,global:!1,url:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(e){o&&o(e)},success:function(e){n&&n(e)}})},T=function(){return t},m=function(e){t&&e&&t.push(e)},h=function(){return e},I=function(t){e.addFuncParamsToEditor(t)};return{loadDependencies:n,initDelugeEditor:o,getFunctions:a,fetchGalleryFunctions:s,getGalleryFunctions:l,getFunction:r,saveFunction:d,executeFunction:c,deleteFunction:u,getFunctionIdFromName:p,getFunctionNameFromId:g,removeFunction:f,getFunctionsList:T,addFunctionToList:m,getDelugeEditor:h,setEditorParams:I}}(),DREDialogHandler=function(e){var t,i,n,o,r,a,s,l,d,c,u,p,g,f={},E="dredialog",T={},m="digisign",h={SAVE:J.i18n("writer.common.SAVE"),SAVING:J.i18n("writer.common.SAVING"),CONTINUE:J.i18n("writer.common.CONTINUE"),DELETE:J.i18n("writer.common.DELETE"),CANCEL:J.i18n("writer.common.CANCEL"),SAVE_SUCCESS:J.i18n("writer.automation.FUNCTION_SAVE_SUCCESS"),SAVE_FAILURE:J.i18n("writer.automation.FUNCTION_SAVE_FAILURE"),EXECUTE_SUCCESS:J.i18n("writer.automation.FUNCTION_EXECUTE_SUCCESS"),EXECUTE_FAILURE:J.i18n("writer.automation.FUNCTION_EXECUTE_FAILURE"),DELETE_SUCCESS:J.i18n("writer.automation.FUNCTION_DELETE_SUCCESS"),DELETE_FAILURE:J.i18n("writer.automation.FUNCTION_DELETE_FAILURE"),DELETE_FUNCTION:J.i18n("writer.automation.DELETE_FUNCTION"),DELETE_FUNCTION_MSG:J.i18n("writer.automation.DELETE_FUNCTION_MSG"),VALID_NAME_MSG:J.i18n("writer.automation.PLEASE_ENTER_VALID_FUNCTION_NAME"),UNSAVED_CONTENT:J.i18n("writer.common.UNSAVED_CHANGES_FOUND"),UNSAVED_CONTENT_MSG:J.i18n("writer.automation.UNSAVED_CHANGES_MSG"),LIMIT_EXCEEDED_MSG:J.i18n("writer.automation.LIMIT_EXCEEDED_MSG")},I=function(){t=J("#dredialog"),i=t.find("#dre-func-list-cont"),n=t.find("#dre-custom-func-editor"),a=t.find("#dre-editor-topband-name"),l=t.find("#dre-editor-topband-nameinput"),s=t.find("#dre-editor-topband-namediv"),d=J("#dredialog-submitbtn"),u=t.find("#dre-debug-cont"),c=t.find("#dre-debug-logs"),p=t.find("#dre-editor-topband-funcname"),i.on("click","div.dre-func-elem",O),g=t.find("#dre-editor-topband-save")},_=function(t){var i=function(){var e=l.val();y(e)},n=function(){f.functionCategory&&(m=f.functionCategory),G(),C(f.defaultFunctionId),$(),!f.defaultFunctionId&&q(f.funcInfo),J("#dreEditorFooter").prepend(J("<span>").text("}").addClass("ui-fl").css("padding-left","5px")),J(".deluge-main-container").prepend(J(".ui-dfunc-def").remove()),oe()},o=function(){J.dialogutil.open(E,"",{init:function(){ee(),I(),e.initDelugeEditor("dre-custom-func-editor",i,n),j(),X(),K(),A()}})};f=t,e.loadDependencies(o)},A=function(){t.find("#dre-galleryfunction-btn")[f.showGalleryFunctions?"show":"hide"](),t.find("#dre-editor-topband-save")[f.saveFuncWhileComplete?"hide":"show"](),t.find("#dre-connections-btn")[f.hideConnections?"hide":"show"](),t.find(".ui-signfunc-left-cont")[f.hideFunctionsList?"hide":"show"](),t.find(".ztabpanel__nav")[f.hideFunctionsList&&f.hideConnections&&!f.showGalleryFunctions?"hide":"show"]()},S=function(){return o.isEditorContentModified()},R=function(e,t,i,n){MsgDialog.showMessage([i,h.CANCEL],CONST.SEVERITY_WARNING,e,t,null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:n&&n()}})},O=function(e){var t=this.id||e;return S()?void R(h.UNSAVED_CONTENT,h.UNSAVED_CONTENT_MSG,h.CONTINUE,P.bind(this,t,b.bind(this,e))):void P.call(this,t,b.bind(this,e))},b=function(e){var t=(this.id||e,this.getAttribute("name"));n.attr("name",t),s.text(t),l.val(t),i.find(".dre-func-elem").removeClass("dre-func-elem-selected"),this.classList.add("dre-func-elem-selected"),p.text(t),o.clearLocalHistory(),f.testRunAfterLoad&&DREDialogHandler.runCurrentScript()},v=function(e,t){var n=J("<div>"),o=J("<span>");n.addClass("dre-func-elem"),n.attr("id",e),o.text(t).addClass("dre-func-list-name"),n.append(o),n.append('<div class="zbutton__icon ui-sprit-lazy ui-icon-delete-blk-sm dre-func-elem-del-icon" onclick="DREDialogHandler.deleteFunction(this);"></div>'),n.attr("name",t),n.css({padding:"6px 10px 6px 10px",cursor:"pointer"}),i.append(n)},D=function(){return n.attr("name")},L=function(){J.dialogutil.close(E)},N=function(){var e=l.val()||s.text();y(e)},P=function(t,i){if(T[t])return o.setEditorContent(T[t]),void(i&&i());var n=function(e){var n=JSON.parse(JSON.stringify(e));o.setEditorContent(n.workflow.snippet||n.script),Q(t,n.workflow.snippet||n.script),i&&i()},r=function(){};e.getFunction(t,n,r)},C=function(t){var n=function(e){var n=e.functions;if(n&&n.length){var o="digisign"!==m&&m?m:"Workflow";n=n.filter(function(e){return"document_sign"==o?e.category==o||"Workflow"==e.category:e.category==o}),r=n,n.forEach(function(e){v(e.id,e.name),Q(e.id,e.workflow.snippet||e.script)}),t&&i.find("#"+t).trigger("click")}},o=function(){};e.getFunctions(m,n,o)},y=function(t,r){var a=function(a){var d=JSON.parse(JSON.stringify(a)),c=d.function.workflow.name,p=d.function.workflow.snippet;o.setEditorContent(p),n.attr("name",c),"newtask"==u&&v(d.function.id,d.function.workflow.name),s.text(c),l.val(c),Q(u,p),e.addFunctionToList(d.function),i.find(".dre-func-elem-selected").removeClass("dre-func-elem-selected"),i.find("#"+d.function.id).addClass("dre-func-elem-selected").find(".dre-func-list-name").text(t),g.text(h.SAVE),Notification.show({container:"#dredialog-notify",message:h.SAVE_SUCCESS,translatedMessage:!0,setTimer:!1,type:"success"}),r&&r(a)},d=function(e){e=e&&e.responseJSON,g.text(h.SAVE);e.message||h.SAVE_FAILURE;Notification.show({container:"#dredialog-notify",message:h.SAVE_FAILURE,translatedMessage:!0,setTimer:!1,type:"error"}),e&&e.error_message&&ne(e.error_message)},c=o.getEditorValue(),u="";return u||(u=i.find(".dre-func-elem-selected").attr("id")),t?(u||(u="newtask"),c=F(c,t),g.text(h.SAVING),void(H(u,c)&&e.saveFunction(t,u,c,m,a,d))):void Notification.show({container:"#dredialog-notify",message:h.VALID_NAME_MSG,translatedMessage:!0,setTimer:!1,type:"error"})},F=function(e,t){var i="";return i+=f.functionReturnType||"void",i+=" "+t+"(",f.editorParams&&f.editorParams.forEach(function(e,t){i+=e.paramType+" "+e.paramName,t<f.editorParams.length-1&&(i+=", ")}),i+=")\n{\n"+e+"\n}\n"},M=function(){var t=function(e){var t=JSON.parse(JSON.stringify(e)),i=t.logs||[],n="";i.forEach(function(e){n+="<p>"+e+"</p>"}),n+="<p>"+t.message||"</p>",c.html(n),u.slideDown(),u[0].scrollIntoView();t.message||"";Notification.show({container:"#dredialog-notify",message:h.EXECUTE_SUCCESS,translatedMessage:!0,setTimer:!1,type:"success"})},i=function(e){var t=new RegExp("The limit of Function Execution has reached its maximum 100");e=e.responseJSON;var i=e.error.message.match(t)?h.LIMIT_EXCEEDED_MSG:h.EXECUTE_FAILURE;Notification.show({container:"#dredialog-notify",message:i,translatedMessage:!0,setTimer:!1,type:"error"}),e&&e.message&&ne(e.message)};return function(n){e.executeFunction(n,t,i,f.defaultParamValues)}}(),w=function(){var t=l.val(),i=function(i){M(e.getFunctionIdFromName(t))};y(t,i)},U=function(t){if(t=t){var n=function(n){var o=i&&i.find("#"+t),r=o.next();o.remove(),r.length?r.trigger("click"):q(),Notification.show({container:"#dredialog-notify",message:h.DELETE_SUCCESS,translatedMessage:!0,setTimer:!1,type:"success"}),e.removeFunction(t),B(t),delete T[t]},o=function(e){Notification.show({container:"#dredialog-notify",message:h.DELETE_FAILURE,translatedMessage:!0,setTimer:!1,type:"error"}),e&&e.error_message&&ne(e.error_message)};e.deleteFunction(t,n,o)}},x=function(e){var t=e.parentElement.id;event.stopPropagation(),R(h.DELETE_FUNCTION,h.DELETE_FUNCTION_MSG,h.DELETE,U.bind(null,t))},B=function(e){var t,i=r.length;r.forEach(function(i,n){i.id==e&&(t=n)}),i>0&&t>=0&&(r=r.slice(0,t).concat(r.slice(t+1,i-1)))},H=function(e,t){return T[e]!=t},G=function(){o=e.getDelugeEditor()},k=function(){s.hide(),l.show()},W=function(){k(),l.focus()},Y=function(e){Z();var t=l.val();t=t.replaceAll(FILLABLEFIELD_REGEX[ATTR_FILLABLEFIELD.FF_NAME],""),t=t.replaceAll(" ","_"),p.text(t),l.val(t)},z=function(e){e.keyCode==KEYS.ENTER?l.trigger("blur"):Z()},Z=function(){var e=l.val().length,t=V()*e;t>250?t=250:t<100&&(t=100),l.css("width",t)},V=function(){var e=.27,t=parseInt(l.css("height"))*e;return t},j=function(){f.title&&J("#"+E+"zdialog").zdialog("setAttributes",{title:f.title})},X=function(){f.btns&&f.btns.length&&d.zbutton("setAttribute","text",f.btns[0])},K=function(){var t=function(){var t=l.val(),i=function(){f.callback&&f.callback({functionName:t,functionId:e.getFunctionIdFromName(t)})};f.saveFuncWhileComplete?y(t,i):i()};d.off("click").on("click",t)},q=function(e){e=e||{},o.setEditorContent(e.script||f.defaultScript);var t=e.functionname||"untitled_function";s.text(t),l.val(t),p.text(t),i.find(".dre-func-elem").removeClass("dre-func-elem-selected"),l.focus()},Q=function(e,t){T[e]=t},$=function(){f.editorParams&&e.setEditorParams(f.editorParams)},ee=function(){var e='<b noi18n="true" class="ui-dfunc-rtype">{function_return_type}</b> <b noi18n="true" id="dre-editor-topband-funcname" class="ui-dfunc-name">{function_name}</b> ( ',t='<a noi18n="true" href="{param_type_url}" target="_blank" rel="noreferrer noopener" class="ui-dfunc-argtype">{param_type}</a> <span noi18n="true" data-paramname="{param_name}" onclick="DREDialogHandler.showParamPopup(this);" class="ui-dfunc-argname ui-mouse-cursor">{param_name}</span>',i={Map:editorProps.urls.zohoURL+"/creator/help/script/map-manipulations.html"};return function(){var n="";n+=e.replaceAll("{function_return_type}",f.functionReturnType||"void").replaceAll("{function_name}",f.functionName||"Function Name"),f.editorParams&&f.editorParams.forEach(function(e,o){n+=t.replaceAll("{param_type_url}",i[e.paramType||"Map"]).replaceAll("{param_name}",e.paramName).replaceAll("{param_type}",e.paramType),o<f.editorParams.length-1&&(n+=", ")}),n+=" ) {",J(".ui-dfunc-def").html(n)}}(),te=function(){'<p>{</p><p>"request_id": "1397293793974"</p><p>"request_name": "Untitled Document"</p><p>"request_status": "success"</p><p>"reminder_period": "1"</p><p>"expire_by": "1586951859025"</p><p>"sign_submitted_time": "1586951756018"</p><p>"sign_document_download_url": "https://'+editorProps.urls.servername+'/api/v1/fill/job/123455666322/attachment/download"</p><p>"recipient_info": [{<br>&nbsp"recipient_1": "abc@example.com",<br>&nbsp"recipient_name": "abc",<br>&nbsp"action_type": "sign"<br>}]</p><p>}</p>';return function(e){var t=J(e).data().paramname,i=f.paramPopupsHTML&&f.paramPopupsHTML[t];i&&(ZWComponentUtil.init("dre-param-popup"),ZWComponentUtil.init("dredialog-param-popup"),J("#dre-param-popup").zpopover("open",{target:e}),J("#dre-param-popup-title").text(i.title),J("#dre-param-popup-content").html(i.content))}}(),ie=function(e){var t=e.indexOf("line - ");if(t==-1)return e;var i=e.split("line - "),n=parseInt(i[1]),r=(n+"").length,a="";return n-=2,a=i[0]+"Line - "+n+i[1].slice(r),o.gotoLine(n),o.focusEditor(),a},ne=function(e){e&&(e=ie(e)),c.html(e),u.slideDown(),u[0].scrollIntoView()},oe=function(){u.slideUp()},re=function(e,t){var i=e.target,n=i.ztabpanel("getActiveTab").id;d["dre-myfunction-btn"==n?"show":"hide"](),J("#dredialog-connection-note")["dre-myfunction-btn"==n?"show":"hide"](),"dre-galleryfunction-btn"==n&&ae(),Notification.hide()},ae=function(){var t=function(e){var t=e.functions||[],i=Handlebars.compile(J("#dre-gallery-func-template").html()),n=J("#dre-galleryfunctions-list");n.html("");for(var o=0;o<t.length;o++){var r=t[o],a=se(i,r);n.append(a)}UIUtils.hideLoadingMsg()},i=function(){var e=J("<div>",{class:"ui-top-margin-large ui-left-margin-large",text:"Unable to list the functions. Please try again later."});J("#dre-galleryfunctions-list").append(e)},n=e.getGalleryFunctions(m);return n?t({functions:n}):(UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),void e.fetchGalleryFunctions(m,t,i))},se=function(e,t){var i=J(e(t));return i.find(".js-dre-use-function").off("click").on("click",function(){le(t)}),i},le=function(e){J("#dre-myfunction-btn").click(),q(e)},de=function(){J.dialogutil.open("about_dre_connections_dlg",null,"")},ce=function(){J.dialogutil.close("about_dre_connections_dlg"),window.open(window.location.protocol+"//"+editorProps.urls.servername+"/writer/delugeconnections")};return{openDialog:_,closeDialog:L,getSelectedFunction:D,handleSaveFunction:N,runCurrentScript:w,deleteFunction:x,handleNameDivHover:k,handleNameFieldClick:W,handleNameFieldBlur:Y,handleNameFieldKeyDown:z,createNewFunction:q,showParamPopup:te,closeDebugCont:oe,tabSwitch:re,install:le,openConnection:de,goToConnections:ce}}(DelugeHandler),SignJobModel=function(){"use strict";function e(e){this.details=e.details?new t(e.details):{},this.status=e.status,this.scheduled_time=e.scheduledTime||e.scheduled_time,this.zid=e.zid,this.resource_id=e.resourceId||e.resource_id,this.job_id=e.jobId||e.job_id}function t(e){this.docDetails=e.docDetails?new i(e.docDetails):{},this.signedDocInfo=e.signedDocInfo?new n(e.signedDocInfo):{},this.storeattachmentinfo=e.storeattachmentinfo?new o(e.storeattachmentinfo):{},this.emailinfo=e.emailinfo?new r(e.emailinfo):{},this.customfunctioninfo=e.customfunctioninfo?new a(e.customfunctioninfo):{},this.sign_result_info=e.sign_result_info?new s(e.sign_result_info):{},this.operationStatus=e.operationStatus||{},this.service_no=e.service_no,this.doc_version=e.doc_version,this.job_user=e.job_user,this.recipients=e.recipients||[],this.is_sequential=e.is_sequential,this.email_reminders=e.email_reminders,this.reminder_period=e.reminder_period,this.expiration_days=e.expiration_days,this.title=e.title,this.message=e.message,this.subject=e.subject,this.jobStatus=e.jobStatus,this.isAPIJob=e.isAPIJob||!1}function i(e){this.currentUserZuid=e.currentUserZuid,this.ownerZuid=e.ownerZuid,this.docId=e.docId,this.resourceId=e.resourceId,this.documentManager=e.documentManager}function n(e){this.filepath=e.filepath,this.filename=e.filename,this.format=e.format,this.created_time=e.created_time}function o(e){this.folderid=e.folderid,this.filename=e.filename,this.format=e.format,this.foldername=e.foldername}function r(e){this.from_address=e.from_address,this.reply_to=e.reply_to,this.cc=e.cc,this.bcc=e.bcc,this.recipients=e.recipients||[],this.subject=e.subject,this.message=e.message,this.attachment_name=e.attachment_name,this.format=e.format}function a(e){this.custom_function_id=e.custom_function_id,this.custom_function_name=e.custom_function_name}function s(e){this.status=e.status,this.id=e.id,this.recipients_status_info=e.recipients_status_info||[],this.recipients_status=e.recipients_status,this.error_msg=e.error_msg||""}e.prototype.constructor=e,e.prototype.get=function(e){return this.propName||this.details.propName||null},e.prototype.set=function(e,t){this.propName?this.propName=t||null:this.details.propName&&(this.details.propName=t||null)},t.prototype.get=function(e){return this.propName||null},t.prototype.set=function(e,t){this.propName=t||null};var l=function(t){var i={};t&&t.reverse();for(var n in t)if(!t[n]||0!=Object.keys(t[n]).length){var o=t[n].jobId||t[n].job_id;i[o]=new e(t[n]),i[o].details.isAPIJob&&delete i[o]}this.jobs=i};return l.prototype.constructor=l,Object.defineProperties(l.prototype,{jobCount:{get:function(){return Object.keys(this.jobs).length||0},set:function(e){this.jobCount=Object.keys(this.jobs).length||0}}}),l.prototype.getJob=function(e){return this.jobs[e]||{}},l.prototype.setJob=function(e,t){this.jobs[e]=t||{}},l.prototype.add=function(e){this.jobs[e]={}},l.prototype.remove=function(e){delete this.jobs[e]},l.prototype.first=function(){for(var e in this.jobs)return this.jobs[e]},{SignJob:e,SignJobCollection:l}}(),DropCap=function(){return insertDropCap=function(e){var t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.PARAGRAPH);if(i.dtNode.getParaStyles().isDropCapPresent)return void removeDropcap(i);var n=_getDropcapText(i);if(n.text){var o=n.latestIdx,r=editor.doc.createRange(o,o+1);t.removeAllRanges().addRange(r).deleteSelectedContents(null,!0),InsertShape.moveCursorIdx(i.getStart());var a=InsertShape.getDefaultShapeData();a.dropcapData={},_updateDropcapTextFormats(a,n),_fillDropcap(e,a),_updateDropcapHeight(a,3,t.getStart()),_updateDropcapPosition(a,"DROP"),a.wrapType="square",a.nvOProps.nvODProps={locks:{noAspectChange:!0}},a.textBody.props.inset={left:0,right:0,top:0,bottom:0};var s=DocUtil.getParaFormat(i.getEnd()-1);s[ATTR_PARAGRAPH.PS_DROPCAP]=!0,i.attr(s),a[ATTR_IMAGE.I_MR]=InsertShape.constant.DEFAULT_MARGIN_RIGHT_VAL,InsertShape.insertShape(a)}},changeDropCapType=function(e){var t=_getDropCapInPara();if(!t)return void insertDropCap(e);if(!t||t.style!=e){var i=InsertShape.getSelectedShape(),n=(editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),i&&i.data||t.shapeData);_fillDropcap(e,n);var o=editor.doc.getSelection().getStart();_updateDropcapHeight(n,n.dropcapData.linestodrop,o),InsertShape.applyStyle(n,!0)}},removeDropcap=function(e){var t=_getDropCapInPara();if(t){var i=editor.doc.getSelection();e=e||editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH);var n=DocUtil.getParaFormat(e.getEnd()-1);n[ATTR_PARAGRAPH.PS_DROPCAP]=!1,e.attr(n);var o=editor.doc.createRange(t.index,t.index+1);i.removeAllRanges().addRange(o).deleteSelectedContents(null,!0);var r=InsertShape.getTextFromShape(t.shapeData);if(r&&r.length>0){var a=editor.doc.createElement(NODE_TYPE.TEXT,r);Command.exec("InsertChar",{cmd:"insert",element:a})}else Op.sendMsg();InsertShape.closeToolbar()}},_getDropCapInPara=function(){for(var e=InsertShape.getShapesInPara(),t=void 0,i=0;i<e.length;i++){var n=e[i].getStart(),o=editor.doc.getRawFormatAt(n);o.shapeData&&o.shapeData.dropcapData&&(t={index:n,shapeData:o.shapeData,style:o.shapeData.dropcapData.style})}return t},_getDropcapText=function(e,t){var i=-1,n="";t?i=t:e?i=e.getStart():(e=editor.doc.getSelection().getNodesInSelection(NODE_TYPE.PARAGRAPH)[0],i=e.getStart());for(var o=editor.doc.getRawFormatAt(i);null==o||o.type;){if(o&&o.type!==NODE_TYPE.TEXT){if(o.type===NODE_TYPE.IMAGE&&o.shapeData&&o.shapeData.dropcapData){n=InsertShape.getTextFromShape(o.shapeData).toUpperCase();break}if(o.type===NODE_TYPE.PARAGRAPH||o.type===NODE_TYPE.SECTION)break}else if(n=editor.doc.getCharAt(i).trim(),n.length>0)break;i+=1,o=editor.doc.getRawFormatAt(i)}return{text:n.toUpperCase(),latestIdx:i,latestFormat:o}},isSelectedShapeADropcap=function(){var e=!1,t=InsertShape.getSelectedShape();return t&&(e=!!t.data.dropcapData),e},updateDropcapMenuLabels=function(e,t){var i=isSelectedShapeADropcap(),n="";if(i)n=_getTextFromDropcap(InsertShape.getSelectedShape().data);else{var o=_getDropCapInPara();n=o?_getDropcapText(void 0,o.index).text:_getDropcapText().text}n.length>=3&&(n=n.substring(0,2));var r=J("#dropcapmenu").find("li:not(:first-child)").find(".zmenu__text");J.each(r,function(e,t){J(t).text(n.charAt(0)).attr("style","color :rgb("+InsertShape.constant.DROPCAP_FONT_COLORS_MAP["dropcap"+(e+1)]+")")})},_updateDropcapTextFormats=function(e,t){var i=e.textBody.paras[0];i.style.spacing.line.percent="0.7",i.unmerged.style.spacing.line.percent="0.7";var n=i.portions[0];return n.t=t.text||"D",n.props.font.fontFamily.name=_getFontFamily(t.latestFormat),e},_calculateLinesToDropHeight=function(e,t){var i=DomViewManager.getDOMnodeFromDTnode(DocTreeManager.getTreeNodeAtIndex(t)),n=J(i).find(".zw-line-div"),o=0;if(n.length<e)for(;n.length<e;)n.push(n[0]);for(var r=0;r<e;r++)o+=J(n[r]).height();return o=o<40?40:o-10},_getFontFamily=function(e){var t="",i="arimo";"string"==typeof e?t=e:(e||(e={}),t=e.ff||editor.doc.getBodyFormat().styles.para[e.hd||"h0"].textFormat.ff);var n=DocumentDesign.getTheme();return i=t.indexOf("major")!=-1?n.font.major.latin:t.indexOf("minor")!=-1?n.font.minor.latin:t,i.split(",")[0]},_fillDropcap=function(e,t){var i=t.props.transform.dim.height,n=t.textBody.paras[0].portions[0],o=t.dropcapData;if(t.props.geom.preset.type="RECT","normal"==e)InsertShape.modifyShapeProperty(["fillcolor","NONE"],t);else if(e.indexOf("fill")!=-1){var r=[68,200,245];"greenfill"==e&&(r=[151,201,124],t.props.geom.preset.type="ROUND_RECT"),InsertShape.modifyShapeProperty(["fillcolor",r],t)}else InsertShape.modifyShapeProperty(["fillimage",[imgCdnZWStaticPath+fingerPrintObj["images/common/dropcap/png/"+e+".png"],i,i]],t);return InsertShape.modifyShapeProperty(["strokecolor","NONE"],t),n.props.fill.solid.color.rgb=InsertShape.constant.DROPCAP_FONT_COLORS_MAP[e],n.unmerged.props=n.props,o.style=e,t},_updateDropcapHeight=function(e,t,i){var n=e.dropcapData,o=_calculateLinesToDropHeight(t,i),r=e.props;r.transform.dim.height=o,r.transform.dim.width=o,n.linestodrop=t;var a=e.textBody.paras[0].portions[0];return a.props.size="normal"==n.style?InsertShape.getProportionalSize(o):o/2,e},_updateDropcapPosition=function(e,t,i){var n=e.props.transform,o=n.pos;if(i)t=e.dropcapData.type;else if(e.dropcapData.type==t)return;if("MARGIN"==t){var r=editor.doc.getSelection(),a=DocLayoutManager.getSectionLeftAtIndex(r.getStart()),s=n.dim.width+5;s>a&&(s=a),o.top=7,o.left=-s}else o.top=7,o.left=0;return e.dropcapData.type=t,e.dropcapData[ATTR_IMAGE.I_MR]=InsertShape.constant.DEFAULT_MARGIN_RIGHT_VAL,e},modifyDropcapProperty=function(e,t){var i=editor.doc.getSelection().getStart(),n=editor.doc.getRawFormatAt(i).shapeData;if(n){var o=(n.nvOProps.nvDProps.id,n.dropcapData);if("POSITION"==e){if("NONE"==t)return void removeDropcap();_updateDropcapPosition(n,t)}else"LINESTODROP"==e?(_updateDropcapHeight(n,t,i),"MARGIN"==o.type&&_updateDropcapPosition(n,null,!0)):"DISTANCEFROMRIGHT"==e?n[ATTR_IMAGE.I_MR]=t:"DISTANCEFROMBOTTOM"==e&&(n[ATTR_IMAGE.I_MB]=t);InsertShape.applyStyle(n,!1)}},updateDropcapButton=function(e){if(!editor.isOffline()){var t=(e.getStart(),e.text(!0).replaceAll("\\n","").trim().length),i=editor.clientActiveSection.className;t&&"cell"!=e.parentNode().type&&i.indexOf("header")==-1&&i.indexOf("footer")==-1&&i.indexOf("textbox")==-1?J("#fmt-lpnl-dropcap-btn").enable():J("#fmt-lpnl-dropcap-btn").disable()}},closeDropcapPanel=function(){for(var e=InsertShape.getSelectedShapesArray(),t=0;t<e.length;t++){var i=e[t].data||e[t];if(i.dropcapData){InsertShape.clearSelection();break}}DropcapPanel.close()},_getTextFromDropcap=function(e){var t="";e="string"==typeof e?J.ShapeData.getShape(e):e;var i=e.textBody.paras;return J.each(i,function(e,i){var n=i.portions;J.each(n,function(e,i){t+=i.t})}),t.toUpperCase()},{insertDropCap:insertDropCap,changeDropCapType:changeDropCapType,removeDropcap:removeDropcap,updateDropcapMenuLabels:updateDropcapMenuLabels,isSelectedShapeADropcap:isSelectedShapeADropcap,modifyDropcapProperty:modifyDropcapProperty,updateDropcapButton:updateDropcapButton,closeDropcapPanel:closeDropcapPanel}}();!function(e){"use strict";var t="doNotDrag",i="data-toc-id",n=!1;e.DragDrop=function(t){this.el=t.el,this.validClass=t.validClass,this.clsToAvoid=t.clsToAvoid,this.getChildren=t.getChildren,this.model=t.model,this.nonHandle=t.nonHandle,this.draggedElem=null,this.uniqAttr=t.uniqAttr,this.lineDiv=document.createElement(t.keepNumbering?"li":"div"),this.dirtyNodes={},this.horizontalDirection=void 0!=t.horizontalDirection&&t.horizontalDirection,this.replaceDragElem=t.replaceDragElem,this.considerDirection=t.considerDirection,this.boundDragOver=null,this.boundDragLeave=null,this.boundDrop=null,this.boundDragStart=null,this.boundDragEnd=null,e.dropModel=this.model;var i=document.createElement("div"),n=document.createElement("div");this.lineDiv.appendChild(i),this.lineDiv.appendChild(n),this.lineDiv.classList.add("ui-ghost-placeholder"),i.classList.add("ui-placeholder-header"),i.classList.add("ui-bottom-margin-medium"),n.classList.add("ui-placeholder-content"),this.el.addEventListener("drop",function(e){}),this.el.addEventListener("dragover",function(e){e.preventDefault()})},DragDrop.isCardDragOn=function(){return n};DragDrop.prototype.init=function(){var e=this.el.getElementsByClassName(this.className),t=Array.prototype.slice.call(e),i=this;t.forEach(function(e){i.bindDragEvents(e)})},DragDrop.prototype.bindDragEvents=function(e){this.nonHandle&&J(e).find("."+this.nonHandle).attr("onmousedown","return false"),this.boundDragOver=this.handleDragOver.bind(this),this.boundDragLeave=this.handleDragLeave.bind(this),this.boundDrop=this.handleDrop.bind(this),this.boundDragStart=this.handleDragStart.bind(this),this.boundDragEnd=this.handleDragEnd.bind(this),this.boundCancelDrag=this.cancelDrag.bind(this),e.setAttribute("draggable","true"),e.addEventListener("dragover",this.boundDragOver),e.addEventListener("dragleave",this.boundDragLeave),e.addEventListener("drop",this.boundDrop),e.addEventListener("dragstart",this.boundDragStart),e.addEventListener("dragend",this.boundDragEnd),e.addEventListener("keydown",this.boundCancelDrag)},DragDrop.prototype.unbindDragEvents=function(e){e.removeAttribute("draggable"),e.removeEventListener("dragover",this.boundDragOver),e.removeEventListener("dragleave",this.boundDragLeave),e.removeEventListener("drop",this.boundDrop),e.removeEventListener("dragstart",this.boundDragStart),e.removeEventListener("dragend",this.boundDragEnd)};var o=function(e,t){l(e),J(e).insertAfter(t)},r=function(e,t){l(e),J(e).insertBefore(t)},a=function(e,t){e.style.display="none",r(t,e)},s=function(e){e.style.display="none"},l=function(e){e.style.display="LI"==e.tagName.toUpperCase()?"list-item":"block"},d=function(e){var i=e.getElementsByClassName(t),n=Array.prototype.slice.call(i);n.forEach(function(e){e.classList.remove(t)})},c=function(e,i,n){var o=e.start,r=e.last;if(i.classList.add(t),o.id!=r.id)for(var a=i.nextElementSibling;a&&(a.classList.add(t),a.getAttribute(n)!=r.id);)a=a.nextElementSibling};DragDrop.prototype.handleDragStart=function(e){n=!0,this.draggedElem=e.target,this.dragResult={},this.group=this.model.getGroup(this.draggedElem.getAttribute(this.uniqAttr)),this.lineDiv.style.width=this.el.offsetWidth+"px",s(this.lineDiv),HTMLUtil.insertBefore(this.lineDiv,this.el),this.el.querySelectorAll("#"+this.group.start.id)[0].classList.add("ui-doc-nav-item-draggable");this.el.querySelectorAll("[ "+this.uniqAttr+'="'+this.group.last.id+'" ]')[0];c(this.group,this.draggedElem,this.uniqAttr),this.replaceDragElem&&requestAnimationFrame(function(){a(this.draggedElem,this.lineDiv)}.bind(this))},DragDrop.prototype.handleDragLeave=function(e){},DragDrop.prototype.getTargetCard=function(e){for(var t=e;t&&t!=this.el;){if(t.classList.contains(this.validClass))return t;t=t.parentElement}},DragDrop.prototype.getElementOffsetY=function(e,t){for(var i=e,n=0;i&&i!=this.el&&!i.classList.contains(this.validClass);)n+=i.offsetTop,i=i.parentElement;return n+t},DragDrop.prototype.getElementOffsetX=function(e,t){for(var i=e,n=0;i&&i!=this.el&&!i.classList.contains(this.validClass);)n+=i.offsetLeft,i=i.parentElement;return n+t},DragDrop.prototype.handleDragOver=function(e){var i=this.getTargetCard(e.target,this.validClass);if(i){var n=i.clientHeight,l=this.getElementOffsetY(e.target,e.offsetY),d=i.clientWidth,c=this.getElementOffsetX(e.target,e.offsetX),u=0==this.horizontalDirection?l<n/2:c<d/2;if(i.classList.contains(this.validClass)&&!i.classList.contains(t)&&i!=this.draggedElem){var p=(HTMLUtil.getElementIdx(i),i.getAttribute(this.uniqAttr));this.clsToAvoid&&i.classList.contains(this.clsToAvoid)||(0==this.considerDirection?this.dragResult.hasOwnProperty(p)&&"after"==this.dragResult[p]?(this.dragResult={},this.dragResult[p]="before",r(this.lineDiv,i)):(this.dragResult={},this.dragResult[p]="after",o(this.lineDiv,i)):(l<n/2?HTMLUtil.insertBefore(this.lineDiv,i):HTMLUtil.insertAfter(this.lineDiv,i),l<n/2?r(this.lineDiv,i):o(this.lineDiv,i),u?this.dragResult.hasOwnProperty(p)&&"before"==this.dragResult[p]||this.draggedElem.nextElementSibling==i?this.draggedElem.nextElementSibling==i&&(this.dragResult={},this.replaceDragElem?a(this.draggedElem,this.lineDiv):s(this.lineDiv)):(this.dragResult={},this.dragResult[p]="before",r(this.lineDiv,i)):this.dragResult.hasOwnProperty(p)&&"after"==this.dragResult[p]||this.draggedElem.previousElementSibling==i?this.draggedElem.previousElementSibling==i&&(this.dragResult={},this.replaceDragElem?a(this.draggedElem,this.lineDiv):s(this.lineDiv)):(this.dragResult={},this.dragResult[p]="after",o(this.lineDiv,i)))),e.preventDefault()}}},DragDrop.prototype.handleDrop=function(e){},DragDrop.prototype.getDeletedNodes=function(){var e=this.group.start.id,t=this.model.getContentGroup(e),i=t.start,n=t.last,o=[],r=DocTreeManager.getTreeNodeById(i.id),a=r.format;for(parseInt(a[ATTR_PARAGRAPH.PS_HD])?parseInt(a[ATTR_PARAGRAPH.PS_HD]):0;r;){var s=ZWUtils.getZWNode.call(editor.getDocument(),r);if(o.push(s),r.id==n.id)break;r=r.next}return o.map(function(e){e.remove()}),o};var u=function(e){var t=new ZWSelection,i=new ZWRange(e,e);return t.addRange(i),t.getParents(NODE_TYPE.SECTION)};DragDrop.prototype.getNodeIndexes=function(e,t){var i=this.model.scenes.getItemById(e),n=DocTreeManager.getTreeNodeById(e),o=n.start,r=null;return r=i.next?DocTreeManager.getTreeNodeById(i.next.id).start:u().getEnd(),{start:o,end:r}};var p=function(e,t,i){if("after"==i)for(var n=t.length-1;n>=0;n--)e.insertAfter(t[n]);else for(var n=0;n<t.length;n++)e.insertBefore(t[n])};DragDrop.prototype.handleDragEnd=function(e){if(n=!1,HTMLUtil.removeElement(this.lineDiv),J(this.el).find(".ui-doc-nav-item-draggable").removeClass("ui-doc-nav-item-draggable"),l(this.draggedElem),U.isEmpty(this.dragResult))d(this.el);else{var o=Object.keys(this.dragResult)[0],r=this.dragResult[o],a=this.draggedElem.getAttribute(this.uniqAttr),s=this.model.scenes.getItemById(o),c=this.el.getElementsByClassName(t),c=Array.prototype.slice.call(c),u=this.el.querySelectorAll("[ "+this.uniqAttr+'="'+o+'" ]')[0],g=this;c.forEach(function(e){var t=e.getAttribute(g.uniqAttr),n=DocTreeManager.getTreeNodeById(t),o=DocUtil.getTocId(n);e.setAttribute(i,o),"undefined"!=typeof o?g.dirtyNodes[o]=e:void 0}),d(this.el);var f=J(u).find("span.doc-nav-marker")[0],E=!f,T=f&&f.classList.contains("ui-icon-heading-inactive"),m=f&&f.classList.contains("doc-nav-marker-parent-nosublevel"),h=this.model.getGroup(o),I=J(this.el).find("#"+h.last.id)[0];if("before"==r?J(c).insertBefore(u):T?J(c).insertAfter(I):J(c).insertAfter(u),"before"==r&&(s.prev&&s.prev.id!=a||!s.prev)||"after"==r&&(s.next&&s.next.id!=a||!s.next)){var _=this.getDeletedNodes();h=this.model.getContentGroup(o),"after"==r&&(T||m||E)&&(o=h.last.id);var A=DocTreeManager.getTreeNodeById(o),S=ZWUtils.getZWNode.call(editor.getDocument(),A);p(S,_,r),UIUtils.showLoadingMsg(J.i18n("writer.common.UPDATING")),PubSub.subscribeOnce("SDK/AfterSyncComplete",function(){UIUtils.hideLoadingMsg()}),editor.getDocument().sync()}}this.group=null,this.draggedElem=null,this.dragResult=null},DragDrop.prototype.cancelDrag=function(e){"Escape"==e&&(this.dragResult={},this.handleDragEnd())}}(window);var FillableImportDialog=function(){var e=!1,t={init:function(e){$("#new_fillable_doc_btn").hover(function(){$("#fillImgAnimate").attr("src",imgCdnZWStaticPath+fingerPrintObj["images/fillable-document-once.gif"])},function(){$("#fillImgAnimate").attr("src",imgCdnZWStaticPath+fingerPrintObj["images/fillable-document.png"])}),$("#upload_fillable_doc_btn").hover(function(){$("#pdfFillAnimate").attr("src",imgCdnZWStaticPath+fingerPrintObj["images/pdf-filler-once.gif"])},function(){$("#pdfFillAnimate").attr("src",imgCdnZWStaticPath+fingerPrintObj["images/pdf-filler.png"])})},get:function(e){},set:function(e,t,i){}},i=function(i){"from_dashboard"===i&&(e=!0),UIUtils.initComponent("choosefillableflowdialog"),J.dialogutil.open("choosefillableflowdialog",null,t)},n=function(){J.dialogutil.close("choosefillableflowdialog")},o=function(t){FillableImportDialog.closeDialog(),e||"from_dashboard"===t?ThumbnailView.createNewBlankDocument("fillable"):FileMenu.newFile("fillable")},r=function(e){var t=null;"from_dashboard"===e&&(t=TeamSwitchHandler.getSelectedTeamId()),FillableImportDialog.closeDialog(),ImportDialog.openDlg(null,t,"fillablePDF")};return{openDialog:i,closeDialog:n,createNewFillableDoc:o,importFillableDocument:r}}(),TemplateUIHandler=function(e,t,i,n,o){"use strict";var r,a={FILL:{TOOLBAR:"docufiller-tb",AUTO_INSERT_POPUP:"auto_insert_field_popup",AUTO_INSERT_BTN:"#ff-handle-detect-and-insert",MAIN_PANEL_ELEMS:[{TAB:"#menu-signer-field",SUBPANEL:"subpanel-digisign"}],RESOURCE_TYPE:"fillable",PDF_RESOURCE_TYPE:"fillablePDF",PANEL_CALLBACK:function(){e.publish("FillableFieldPanelOpen",{operation:"fillable_fields_left_panel"})},SELECT_FIELD_CALLBACK:"undefined"!=typeof FillableFieldsHandler&&FillableFieldsHandler.selectFloatingField,FIELD_TYPE:NODE_TYPE.FILLABLEFIELD,FIELD_INSERT_CALLBACK:function(e,t){var i="textbox"==e.type?"singleline":e.type,n=editor.getDocument().createFillableField(i);n._.op.wid=e.width,n._.op.ht=e.height;var o={left:e.left,from:"page",type:"absolute"},r={top:e.top,from:"page",type:"absolute"};n._.op.wrapType="front",n._.op.positionH=o,n._.op.positionV=r,t.appendField(n)},FIELD_DETECT_CALLBACK:function(e){return e.type===NODE_TYPE.FILLABLEFIELD&&!!e[ATTR_FILLABLEFIELD.FF_INFO]},NO_FIELDS_EXIST:function(e){var t=new FillableFieldsModel;t&&t.fieldCount<1&&e&&e()}},SIGN:{TOOLBAR:"docufiller-tb",AUTO_INSERT_POPUP:"auto_insert_field_popup",AUTO_INSERT_BTN:"#sf-handle-detect-and-insert",MAIN_PANEL_ELEMS:[{TAB:"#menu-signer-field",SUBPANEL:"subpanel-insertsignerfield"}],RESOURCE_TYPE:"sign",PDF_RESOURCE_TYPE:"signPDF",PANEL_CALLBACK:function(){e.publish("digiSignpanel/showMenu",{operation:"automate-sign-template"})},FIELD_TYPE:NODE_TYPE.SIGNERFIELD,FIELD_INSERT_CALLBACK:function(e,t){var i=editor.getDocument().createSignerField(SIGN_TYPE.DIGISIGN,e.type);i._.op.wid=e.width,i._.op.ht=e.height;var n={left:e.left,from:"page",type:"absolute"},o={top:e.top,from:"page",type:"absolute"};i._.op.wrapType="front",i._.op.positionH=n,i._.op.positionV=o,i._.op.type="signerfield";var r="";r="textbox"===e.type?"{{Textfield:Recipient1}":"{{[]}}",i._.op.sfInfo.value=r,i._.isSpaceContent=!0,t.appendField(i)},FIELD_DETECT_CALLBACK:function(e){return e.type===NODE_TYPE.SIGNERFIELD&&!!e[ATTR_SIGNERFIELD.SFINFO]},NO_FIELDS_EXIST:function(e){var t=Utils.getSignRecipientsInDocument();t&&t.recipientCount<1&&e&&e()}},MERGE:{TOOLBAR:"docufiller-tb",AUTO_INSERT_POPUP:"auto_insert_field_popup",MAIN_PANEL_ELEMS:[{TAB:"#menu-signer-field",SUBPANEL:"subpanel-digisign"}],NO_FIELDS_EXIST:function(e){var t=MailMergeFieldUtil.getMergeFieldsInDocument();ZWJSONUtils.isEmptyObject(t)&&e&&e()}}},s={MERGE:{FIELD_INSERT:"writer.mailmergepopup.AUTO_INSERT_MERGE_FIELDS",FIELD_INSERT_MSG:"writer.mailmergepopup.AUTO_INSERT_FIELDS_DESC",FIELD_INSERTED:"writer.mailmergepopup.MERGE_FIELDS_INSERTED",FIELD_INSERTED_MSG:"writer.mailmergepopup.MERGE_FIELDS_INSERTED_COUNT_INFO",FIELD_INSERT_ERROR:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR",FIELD_INSERT_ERROR_MSG:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR_MSG",FIELD_NOT_FOUND:"writer.mailmergepopup.MERGE_FIELDS_NOT_FOUND",FIELD_NOT_FOUND_MSG:"writer.fillablefields.FILLABLE_FIELDS_NOT_FOUND_MSG"},FILL:{FIELD_INSERT:"writer.fillablefields.AUTO_INSERT_FILLABLE_FIELDS",FIELD_INSERT_MSG:"writer.fillablefields.AUTO_INSERT_FIELDS_DESC",FIELD_INSERTED:"writer.fillablefields.FILLABLE_FIELDS_INSERTED",FIELD_INSERTED_MSG:"writer.fillablefields.FILLABLE_FIELDS_INSERTED_COUNT_INFO",FIELD_INSERT_ERROR:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR",FIELD_INSERT_ERROR_MSG:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR_MSG",FIELD_NOT_FOUND:"writer.fillablefields.FILLABLE_FIELDS_NOT_FOUND",FIELD_NOT_FOUND_MSG:"writer.fillablefields.FILLABLE_FIELDS_NOT_FOUND_MSG"},SIGN:{FIELD_INSERT:"writer.sign.AUTO_INSERT_SIGNER_FIELDS",FIELD_INSERT_MSG:"writer.sign.AUTO_INSERT_SIGNER_FIELDS_DESC",FIELD_INSERTED:"writer.sign.SIGNER_FIELDS_INSERTED",FIELD_INSERTED_MSG:"writer.sign.SIGNER_FIELDS_INSERTED_COUNT_INFO",FIELD_INSERT_ERROR:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR",FIELD_INSERT_ERROR_MSG:"writer.fillablefields.FILLABLE_FIELDS_AUTO_INSERT_ERROR_MSG",FIELD_NOT_FOUND:"writer.sign.SIGNER_FIELDS_NOT_FOUND",FIELD_NOT_FOUND_MSG:"writer.fillablefields.FILLABLE_FIELDS_NOT_FOUND_MSG"}},l=function(){Macros.isSignTemplate()?r="SIGN":Macros.isFillableTemplate()?r="FILL":Macros.isMergeTemplate()&&(r="MERGE")};l();var d=function(){var e=a[r],t=J("#"+e.AUTO_INSERT_POPUP);t.hide(),e.NO_FIELDS_EXIST(function(){o.init(e.AUTO_INSERT_POPUP),h()})},c=function(){var e=a[r],t=J(e.AUTO_INSERT_BTN);e.NO_FIELDS_EXIST(function(){t.show()})},u=function(){var e=J("#"+a[r].AUTO_INSERT_POPUP);e.zpopover("close")},p=function(e,t){var i=J("span[data-field-id|='"+t+"']");"mouseup"==e&&(i[0].style.cursor="pointer"),"mousedown"==e&&(i[0].style.cursor="move")},g=function(){J("#"+a[r].AUTO_INSERT_POPUP).zpopover("close"),t.detectFieldsUsingZLabsApi(f,E)},f=function(t){var i=T(t);return"MERGE"==r?void e.publish("MailMerge/FieldDetected",t):(m(t),void(0===i?h("empty"):h("success",i)))},E=function(e){e||(e="failure"),h(e)},T=function(e){for(var t=0,i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++)t++;return t},m=function(t){for(var i=editor.doc.getFormats(),n=editor.getDocument(),o=0;o<i.length;o++)i[o]&&a[r].FIELD_DETECT_CALLBACK(i[o])&&n.getFieldById(i[o].id).remove();n.sync(),n=editor.getDocument();for(var o=0;o<t.length;o++)for(var s=0;s<t[o].length;s++){var l=DocLayoutManager.getPageAtPageNumber(o+1),d=l.getFirstParaView().getDTView().getNode(),c=ZWUtils.getZWNode.call(n,d);a[r].FIELD_INSERT_CALLBACK.call(null,t[o][s],c)}n.sync(),e.publish("FillableFieldDetectedAndInserted")},h=function(e,t){o.init(a[r].AUTO_INSERT_POPUP);var i=J("#"+a[r].AUTO_INSERT_POPUP);i.zpopover("open");var n=s[r];"success"===e?(Z("ff-auto-insert-detect-div").hide(),Z("ff-auto-insert-message-div").show(),Z("ff-auto-insert-icon").removeClass("ui-wdialog-error"),Z("ff-auto-insert-icon").addClass("ui-wdialog-success"),J("#ff-auto-insert-heading")[0].innerText=J.i18n(n.FIELD_INSERTED),J("#ff-message-span")[0].innerText=J.i18n(n.FIELD_INSERTED_MSG,[t]),Z("ff-auto-insert-try-again-btn").hide(),Z("ff-auto-insert-done-btn").show()):"failure"===e?(Z("ff-auto-insert-detect-div").hide(),Z("ff-auto-insert-message-div").show(),Z("ff-auto-insert-icon").removeClass("ui-wdialog-success"),Z("ff-auto-insert-icon").addClass("ui-wdialog-error"),J("#ff-auto-insert-heading")[0].innerText=J.i18n(n.FIELD_INSERT_ERROR),J("#ff-message-span")[0].innerText=J.i18n(n.FIELD_INSERT_ERROR_MSG),Z("ff-auto-insert-done-btn").hide(),Z("ff-auto-insert-try-again-btn").show()):"empty"===e?(Z("ff-auto-insert-detect-div").hide(),Z("ff-auto-insert-message-div").show(),Z("ff-auto-insert-icon").removeClass("ui-wdialog-success"),Z("ff-auto-insert-icon").addClass("ui-wdialog-error"),J("#ff-auto-insert-heading")[0].innerText=J.i18n(n.FIELD_NOT_FOUND),J("#ff-message-span")[0].innerText=J.i18n(n.FIELD_NOT_FOUND_MSG),Z("ff-auto-insert-try-again-btn").hide(),Z("ff-auto-insert-done-btn").show()):(Z("ff-auto-insert-detect-div").show(),Z("ff-auto-insert-message-div").hide(),J("#ff-detect-heading")[0].innerText=J.i18n(n.FIELD_INSERT),J("#ff-detect-message")[0].innerText=J.i18n(n.FIELD_INSERT_MSG))},I=function(){if(!Macros.isPDFDocument())return!1;var e=editor.doc.getSelection().getRangeAt(0),t=!!DocTreeManager.getParents(NODE_TYPE.TEXTBOX,e.start);return!LayoutManager.isRichEditActive()||t||LeftPanel.getCurrentPanel().panelId!=ELEM_ID.INSERTPANEL&&LeftPanel.getCurrentPanel().panelId!=ELEM_ID.FORMATPANEL||a[r].PANEL_CALLBACK(),!t},_=function(t,i){var n=t.id,o=t.idx,s=editor.doc.createRange();return editor.doc.getSelection().removeAllRanges().addRange(s),"SIGN"==r?void e.publish("Field/Selected",n,{idx:o}):void a[r].SELECT_FIELD_CALLBACK.call(t,i)},A=function(e,t){"from_dashboard"==t?ThumbnailView.createNewBlankDocument(e||a[r].RESOURCE_TYPE):FileMenu.newFile(e||a[r].RESOURCE_TYPE)},S=function(e,t){var i=null;"from_dashboard"==t&&(i=TeamSwitchHandler.getSelectedTeamId()),ImportDialog.openDlg(null,i,e||a[r].PDF_RESOURCE_TYPE)},R=function(){if("FILL"===r||"SIGN"===r){var e=editorProps.permissionsInfo&&editorProps.permissionsInfo.permissions&&editorProps.permissionsInfo.permissions.contains("document.edit"),t=editor.doc&&editor.doc.docInfo.newDoc;e&&!t&&AutomationHandler.openAutomationPanel()}},O=function(){if("FILL"==r&&J("#ff_access_form").show(),"SIGN"==r&&J("#sign-yourself-btn").show(),R(),Macros.isPDFDocument()){var t=a[r];"FILL"==r&&t.NO_FIELDS_EXIST(function(){J("#ff_access_form").disable(),e.subscribeOnce(["FillableFieldInserted","FillableFieldDetectedAndInserted"],function(){J("#ff_access_form").enable()})}),e.unsubscribe("Document/ComponentInitialized",O),TopbandHandler.showToolbar(t.TOOLBAR),J("#"+t.TOOLBAR).show();var i=t.MAIN_PANEL_ELEMS;i.forEach(function(e){LeftPanel.addToMainPanel(e.SUBPANEL,e.TAB)}),isV8Engine||(e.publish("PDFFiller/EditorReady"),EditorUtil.allowTypingOnKeypress(!1)),e.subscribe("subpanel-insertsignerfield/open",function(){PanelUtil.showDigiSignPanel()})}},b=function(e,t){if(e===NODE_TYPE.FILLABLEFIELD){var i,n,o,r=[];return editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){i=e.isFillableImageField()?e.start:e.getStart().getIndex(),o=DocLayoutManager.getPageAtIndex(i),n=o&&o.getPageNumber(),n===t&&r.push(e)}),r}};return r&&(e.subscribeOnce("Document/ComponentInitialized",O),e.subscribe("Cursor/Collapsed",function(){if(Macros.isPDFDocument()){var e=editor.doc.getSelection().getLastRange(),t=DocTreeManager.doc.getSection(e.start).getSectionType();return t===SECTION_TYPES.TEXTBOX?void KeyBoardShortCuts.bindUnbindNavShortCuts(!0):void KeyBoardShortCuts.bindUnbindNavShortCuts(!1)}})),{showAutoInsertFieldsPopup:d,closeAutoInsertFieldsPopup:u,handlePDFFillerEditor:I,showAutoInsertFieldsBtn:c,selectFloatingField:_,changeCursor:p,handleDetectAndInsert:g,createNewTemplateDoc:A,importPDFTemplateDocument:S,handleAutoInsertFieldsDialog:h,importPDFTemplateDocument:S,getAllFieldsInPage:b}}(PubSub,UIUtils,ZWNetworkUtils,ZWLogger,ZWComponentUtil),FieldPreFillHandler=function(){var e,t,i,n={dialogName:"prefillandsharetofilldlg",$el:{},elems:{},msgs:{configure:J.i18n("writer.common.CONFIGURE"),processing:J.i18n("writer.mailmergepopup.PROCESSING"),viewlog:J.i18n("writer.common.VIEW_LOGS"),done:J.i18n("writer.common.DONE"),entermsg:J.i18n("writer.mailmerge.ENTER_A_MESSAGE"),optional:J.i18n("writer.common.OPTIONAL"),sharesuccess:J.i18n("writer.automation.SHARED_SUCCESSFULLY"),sharemsg:J.i18n("writer.automation.PREFILL_SHARE_SUCCESS_MSG",["<br>","<b>","</b>","<b>","</b>"]),emailerrormsg:J.i18n("writer.common.ENTER_VALID_EMAIL_ADDRESS"),sendforfilling:J.i18n("writer.automation.SEND_FOR_FILLING"),prefillsuccessmsg:J.i18n("writer.automation.PREFILL_SHARE_SUCCESS_MSG"),insertlink:J.i18n("writer.automation.PLEASE_INSERT_PREFILL_LINK",["+"]),prefillinvalidnumber:J.i18n("writer.automation.PREFILL_VALUE_INVALID_NUMBER_MSG"),prefillinvalidemail:J.i18n("writer.automation.PREFILL_VALUE_INVALID_EMAIL_MSG"),prefillinvalidchars:J.i18n("writer.automation.PREFILL_VALUE_INVALID_CHARS_MSG")},fieldType:"undefined"!=typeof Macros&&Macros.isSignTemplate()?NODE_TYPE.SIGNERFIELD:NODE_TYPE.FILLABLEFIELD,dataSourceInfo:null,get:function(e){return this.$el.find(e)},initElems:function(){var e=this.elems,t=this.get.bind(this);e.recipients=t("#prefill-email-recipient"),e.cc=t("#prefill-email-cc"),e.bcc=t("#prefill-email-bcc"),e.message=t("#prefill-email-message"),e.subject=t("#prefill-email-subject"),e.tabpanel=t("#signdlg-details-tab"),e.btn0=J("#prefill-dlg-next"),e.btn1=J("#dlgbutton1"),e.datasrcName=t("#prefill-datasource-name"),e.popup=J("#dropdown-config-popup"),e.dreFuncName=t("#prefill-custom-func-name"),e.funcDelIcon=t("#prefill-custom-func-del"),e.statusCont=t("#prefill-status-cont"),e.statusMsg=t("#prefill-status-msg"),e.filterBtn=t("#prefill-datasrc-filter-btn"),e.filterNote=t("#prefill-filter-note"),e.sourceFileName=t("#ff-csvname"),e.invalidCharsNote=t("#prefill-invalid-chars-note"),e.notifyCont=t("#prefill-notify-cont"),e.publicPrefillNote=t("#prefill-note-anyone"),e.orgPrefillNote=t("#prefill-note-org"),e.messageErrorCont=t("#prefill-message-error-cont"),e.emailErrorCont=t("#prefill-email-error-cont"),e.previewText=t("#prefill-datasource-preview")},getFieldIconClass:function(e){var t=e.isFillableField()?e.getFillableFieldType():e.getSignerFieldType();if(e.isFillableField())return FillableFieldsHandler.getFieldIconClass(t)},getFieldType:function(e){var t=e.isFillableField()?e.getFillableFieldType():e.getSignerFieldType();if(e.isFillableField())return Utils.getFillableFieldTooltip(t)},getAllFieldIconClasses:function(){if(t&&t.fieldType==NODE_TYPE.FILLABLEFIELD)return["ui-sprit-fast","ui-sprit-lazy","ui-icon-fillablefield-stxt-sm","ui-icon-fillablefield-currency-sm","ui-icon-fillablefield-percentage-sm","ui-icon-fillablefield-phone-sm","ui-icon-fillablefield-number-sm","ui-icon-mail-sm","ui-icon-calendar-sm","ui-mouse-cursor","ui-icon-signerfield-sign-sm","ui-icon-signerfield-initial-sm","ui-icon-picture-sm","ui-icon-fillablefield-mline-sm"];},dropdownInfo:{currentField:null,currElem:null,setCurrentDropdownField:function(e){var t=e&&e.getFillableFieldType();e&&t!=FILLABLEFIELD_TYPE.SELECTBOX&&t!=FILLABLEFIELD_TYPE.RADIO&&t!=FILLABLEFIELD_TYPE.MULTIPLECHOICE||(this.currentField=e)},getCurrentDropdownField:function(){return this.currentField},setCurrentDropdownElem:function(e){this.currElem=e},getCurrentDropdownElem:function(){return this.currElem},defaultInfo:{idx:-1,value:"",type:"fixed",list:[]},getDefaultInfo:function(){if(this.isRadioOrMultipleChoice())return{field_value:"",checked:"false",value:""};var e=this.currentField.getList();this.defaultInfo.list=[];for(var t=0,i=e.length;t<i;t++)this.defaultInfo.list.push("");return this.defaultInfo},getDropdownValue:function(){var e,i=t.fieldMap[this.currentField.getId()];return e=""==i?"":this.isRadioOrMultipleChoice()?i.field_value||"":"fixed"!=i.type||i.idx==-1?"":i.list[i.idx]},getDropdownType:function(){var e=t.fieldMap[this.currentField.getId()];return!e||this.isRadioOrMultipleChoice()?n.msgs.configure:"fixed"==e.type?"Fixed List":"Dynamic List"},isRadioOrMultipleChoice:function(e){var t=e||this.currentField,i=t&&t.getFillableFieldType();return i==FILLABLEFIELD_TYPE.RADIO||i==FILLABLEFIELD_TYPE.MULTIPLECHOICE},radioInfo:null,getRadioInfo:function(){return this.radioInfo},setRadioInfo:function(e){this.radioInfo=e}},customFunctionEnabled:!1,customFunctionInfo:{},isAddonPurchased:!1,PREFILL_MSG_JSON:{type:"doc",content:[{type:"paragraph",content:[{type:"text",text:J.i18n("writer.common.HELLO")+","}]},{type:"paragraph",content:[{type:"text",text:J.i18n("writer.mailmergepopup.SENT_MAIL_AS_LINK_MSG_PREFIX",[editorProps.userInfo.displayName])+" "},{type:"mergefield",attrs:{fieldId:"document_shared_link",fieldName:"["+J.i18n("writer.common.SHARED_LINK_PUBLIC_URL")+"]",type:"autofield",props:{class:"am-opt-link"}}},{type:"text",text:" "+J.i18n("writer.common.WITH_YOU")}]}]}},o=function(e){this.dataSourceFields={},this.fillableFields={},this.signerFields={},this.fieldMap={},this.fieldType=e};o.prototype.constructor=o,extend(o.prototype,{getFieldMap:function(){var e={},t=this.fieldMap;return Object.keys(t).forEach(function(i){t[i]&&(e[i]=t[i])}),e},getFieldsList:function(){return this.fieldType==NODE_TYPE.FILLABLEFIELD?this.fillableFields:this.signerFields},updateFieldsList:function(){var e=this;this.fillableFields={},this.signerFields={},editor.getDocument().visitAllFields(this.fieldType,function(t){var i=e.fieldType==NODE_TYPE.FILLABLEFIELD?t.getId():t.id;e.getFieldsList()[i]=t})},getDataSourceFieldsList:function(){return this.dataSourceFields},updateDataSourceFields:function(){var e=this;this.dataSourceFields={},n.dataSourceInfo&&n.dataSourceInfo.fields.forEach(function(t){e.dataSourceFields[t.id]=t})},generateFieldMap:function(){var e=L(this.fieldType),t=this;this.fieldMap={},Object.keys(this.getFieldsList()).forEach(function(i){t.fieldMap[i]=e.field_map&&e.field_map[i]||""})},updateFieldMap:function(e,t){this.fieldMap[e]=t},refreshModel:function(){this.updateDataSourceFields(),this.updateFieldsList(),this.generateFieldMap()},bindEvents:function(){PubSub.subscribe("Document/AfterModelUpdation",refreshModel)},getDatasrcFieldName:function(e){var t=this.getDataSourceFieldsList()[e];return t?t.display_name:""},getDatasrcFieldId:function(e){var t,i=this.getDataSourceFieldsList();return Object.keys(i).forEach(function(n){i[n].display_name===e&&(t=i[n])}),t?t.id:""},replaceFieldsInString:function(e,t){for(var i="";e.indexOf(UNICODE.MERGEFIELD_START)!=-1;){var n=e.indexOf(UNICODE.MERGEFIELD_START),o=e.indexOf(UNICODE.MERGEFIELD_END);i+=e.substring(0,n),i+=t,e=e.substring(o+1)}return i+=e},replaceNamesWithIds:function(e){return MailMergeUtil.changeObjectToStore(e,{includeRLFields:!0,mapping:this.getDataSourceFieldsList()})},replaceIdsWithNames:function(e){return MailMergeUtil.changeObjectToDisplay(e,this.getDataSourceFieldsList())},getMappedValue:function(e){var t=this.fieldMap[e],i=this.getFieldsList()[e];return this.fieldType==NODE_TYPE.FILLABLEFIELD&&i.getFillableFieldType()==FILLABLEFIELD_TYPE.CHECKBOX?t.value:t}});var r=function(e){this.model=e,this.templates={},this.fieldMapHTML={header:"html",fields:{}},this.$el=n.get("#prefill-map-fields"),this.fieldsListElems={},this.setTemplates()};r.prototype.constructor=r,extend(r.prototype,{getModel:function(){return this.model},setTemplates:function(){this.templates={},this.getModel().fieldType==NODE_TYPE.FILLABLEFIELD&&(this.templates.dropdown=J("#prefill-field-map-row-selectbox"),this.templates.text=J("#prefill-field-map-row"))},getTemplate:function(e){if(this.getModel().fieldType==NODE_TYPE.FILLABLEFIELD)return this.templates[e==FILLABLEFIELD_TYPE.SELECTBOX||e==FILLABLEFIELD_TYPE.MULTIPLECHOICE||e==FILLABLEFIELD_TYPE.RADIO?"dropdown":"text"]},generateFieldMapHTML:function(){var e=this.getModel(),t=e.fieldMap,i=this,n=e.getFieldsList(),o=e.fieldType;Object.keys(t).forEach(function(e,t){var r=n[e][o==NODE_TYPE.FILLABLEFIELD?"getFillableFieldType":"getSignerFieldType"](),a=i.getTemplate(r);i.fieldMapHTML.fields[e]=i.getHTMLFromTemplate(a,e,n[e],t+1)})},setFieldMapHTML:function(){this.find("#prefill-field-map-list").html("");var e=this,t=this.getModel().getFieldsList();Object.keys(this.fieldMapHTML.fields).forEach(function(i){e.find("#prefill-field-map-list").append(e.fieldMapHTML.fields[i]),se(e.fieldMapHTML.fields[i],t[i]),e.fieldsListElems[i]=e.fieldMapHTML.fields[i]}),ZComponents.init(J("#prefill-field-map-list"),null,"ctype")},getHTMLFromTemplate:function(e,t,i,o){var r,a,s=e.clone(),l=this.getModel().getMappedValue(t),d=this.getModel().fieldType,c=d==NODE_TYPE.FILLABLEFIELD?i.getName():i.name,u=d==NODE_TYPE.FILLABLEFIELD&&(i.getFillableFieldType()==FILLABLEFIELD_TYPE.SELECTBOX||n.dropdownInfo.isRadioOrMultipleChoice(i));u?(n.dropdownInfo.setCurrentDropdownField(i),r=n.dropdownInfo.getDropdownValue(),a=n.dropdownInfo.getDropdownType(),r=r&&this.getModel().replaceIdsWithNames(r)):l=this.getModel().replaceIdsWithNames(l),s.find(".prefill-doc-fields-name").text(c),s.find(".doc-fields-icon").removeClass(n.getAllFieldIconClasses().join(" ")).addClass(n.getFieldIconClass(i)),s.find(".doc-fields-type").text(n.getFieldType(i)),s.find(".datasrc-field-name").attr("id","datasrc-field-name-"+o).val(u?r:l),u&&s.find(".datasrc-field-name").addClass("ui-state-disabled"),u&&s.find(".prefill-sbox-configure").text(a),s.attr("id",s.attr("id")+"-"+o),s.attr("data-field-id",t),s.attr("search-pattern",c);var p=JSON.parse(s.find(".js-mm-field-choose").attr("mm-zmenu-data"));return p.target="#datasrc-field-name-"+o,s.find(".js-mm-field-choose").attr("mm-zmenu-data",JSON.stringify(p))[u||ZWJSONUtils.isEmptyObject(this.getModel().getDataSourceFieldsList())?"hide":"show"](),s},updateFieldMap:function(){var e=this.getModel(),i=e.getFieldsList(),n=e.fieldType;this.find("#prefill-field-map-list").children().each(function(o,r){var a,s=J(r),l=(s.find(".prefill-doc-fields-name").text(),s.data().fieldId),d=s.find(".datasrc-field-name").val(),c=i[l][n==NODE_TYPE.FILLABLEFIELD?"getFillableFieldType":"getSignerFieldType"]();if(a=c==FILLABLEFIELD_TYPE.SELECTBOX||c==FILLABLEFIELD_TYPE.RADIO||c==FILLABLEFIELD_TYPE.MULTIPLECHOICE?t.fieldMap[l]:e.replaceNamesWithIds(d),n==NODE_TYPE.FILLABLEFIELD&&c==FILLABLEFIELD_TYPE.CHECKBOX){var u=t.fieldMap[l];u.value=a,a=u}t.updateFieldMap(l,a)})},find:function(e){return this.$el.find(e)},show:function(e){this.find(e).show()},hide:function(e){this.find(e).hide()},destroy:function(){this.fieldMapHTML={header:"html",fields:{}},this.fieldsListElems={}},showFieldErrorCont:function(e){this.fieldsListElems[e.getId()].find(".datasrc-field-name").addClass("ui-validation-error").removeClass("ui-fld-type-input")},hideFieldErrorCont:function(e){this.fieldsListElems[e.getId()].find(".datasrc-field-name").removeClass("ui-validation-error").addClass("ui-fld-type-input")}});var a=function(t){var i=document.getElementById("prefill-email-message"),o={};o.placeholder=n.msgs.entermsg+" ("+n.msgs.optional+")",o.className="ui-sign-msg-editor",o.includes=[{name:"mergefield",mount:!0}],o.content=t&&(t.messageJSON||t.message),e=ZWRichTextEditor.init(i,o);var r=e.getMountedNode("mergefield");r.appendChild(n.$el.find("#prefill-msg-ins-field")[0]),s(),t&&t.messageJSON&&t.message||e.reset(n.PREFILL_MSG_JSON)},s=function(){e.getRTEElement().addEventListener("linkInputOpen",function(){n.elems.btn0[0].classList.add("ui-zwdisabled")}),e.getRTEElement().addEventListener("linkInputClose",function(){n.elems.btn0[0].classList.remove("ui-zwdisabled")})},l=function(){e&&Object.keys(e).length&&e.remove(),e=null},d=function(t){FillAutomationHandler.insertFillableFieldsInRTE(e,t)},c=function(){DialogHandler.close(n.dialogName)},u=function(){return DialogHandler.isDialogOpened(n.dialogName)},p=function(){l()},g=function(){i=null},f=function(e){var t=[],n=i.getModel(),o=n.getFieldsList(),r=!1,a=[],s=[];return Object.keys(o).forEach(function(i){var l=o[i],d=n.fieldMap[i];l.getFillableFieldType()==e.getFillableFieldType()&&l.getName()==e.getName()&&(t.push(n.replaceIdsWithNames(d.field_value)),r=r||"true"==d.checked,"true"==d.checked&&a.push(t[t.length-1]),s.push(l))}),{list:t,isChecked:r,checkedValues:a,fields:s}},E=function(e){var t=(L(n.fieldType),i.getModel()),o=t.fieldMap&&t.fieldMap[e]?t.fieldMap[e]:n.dropdownInfo.getDefaultInfo(),r=n.elems.popup,a=r.find("#prefill-select-container"),s=a.children().eq(0).detach(),l=n.dropdownInfo.getCurrentDropdownField(),d=f(l),c=l.getFillableFieldType()==FILLABLEFIELD_TYPE.MULTIPLECHOICE;n.dropdownInfo.setRadioInfo(d),a.html(""),(d.list||[""]).forEach(function(e,i){var n=s.clone(),o="prefill-select-option-"+i;n.data("val",d.fields[i].getValue()),e=t.replaceIdsWithNames(e),n.find(".js-prefill-sbox-option").attr("id",o).val(e);var l=JSON.parse(n.find(".js-mm-field-choose").attr("mm-zmenu-data"));l.target="#"+o,n.find(".js-mm-field-choose").attr("mm-zmenu-data",JSON.stringify(l)),n.find(".js-prefill-sbox-remove").hide(),n.attr("order-id",i);var u="fixListOpt"+(c?i:"");n.find("input.js-dropdown-select").attr("name",u),a.append(n),n.find("input[name="+u+"]").next().removeAttr("onclick").attr("onclick","FieldPreFillHandler.setSelectedRadioOption(this)"),ZWComponentUtil.initElem(n),r.ZCtrackObjects("initEvents",n,void 0,!0),n.find(".zbutton")[d.checkedValues.contains(e)?"addClass":"removeClass"]("is-selected")}),r.find("#prefill-dropdown-value-field").val(o.value)[d.isChecked?"disable":"enable"](),r.find("#prefill-dropdown-value-field").next()[d.isChecked?"hide":"show"](),r.find("#prefill-dropdown-add-option").hide(),r.find("#prefill-dropdown-type").hide(),r.find("#prefill-fixed-list-note").hide(),r.find("input[name=prefill-sbox-type]").eq(0).click(),r.find(".js-mm-field-choose").off("click").on("click",function(){J("#mm-fieldmenu").zmenu("show",{forElement:J(this),direction:"right"})}),se(r,n.dropdownInfo.getCurrentDropdownField()),r.find("#prefill-dropdown-set-values").removeAttr("onclick").off("click").on("click",T)},T=function(){var e=n.dropdownInfo.getCurrentDropdownField(),t=i.getModel(),o=(t.fieldMap[e.id]||{},n.elems.popup),r=n.dropdownInfo.getCurrentDropdownElem(),a=n.dropdownInfo.getRadioInfo(),s={};o.find(".prefill-select-option").each(function(e,i){var n=J(i),o=n.find(".js-prefill-sbox-option").val(),r=n.data("val"),a=n.find(".zbutton").hasClass("is-selected");o=t.replaceNamesWithIds(o),s[r]={field_value:o,checked:a?"true":"false"}});var l=o.find("#prefill-dropdown-value-field").val();l&&(l=t.replaceNamesWithIds(l));var d=[];a.fields.forEach(function(e){var i=e.getId(),n=e.getValue(),o=t.fieldMap[i];o=s[n],o.value=l,t.updateFieldMap(i,o),d.push(i)}),r.parent().find(".js-fieldmap-parent").each(function(e,i){var n=J(i),o=n.data().fieldId;if(d.contains(o)){var r=t.replaceIdsWithNames(t.fieldMap[o].field_value||"");n.find(".datasrc-field-name").val(r)}}),Z("dropdown-config-popup").zpopover("close"),r.find(".prefill-sbox-configure").text(n.dropdownInfo.getDropdownType()),n.dropdownInfo.setCurrentDropdownField(null),n.dropdownInfo.setCurrentDropdownElem(null),n.dropdownInfo.setRadioInfo(null)},m=function(e){e||(e=event.currentTarget);var t=n.dropdownInfo.getCurrentDropdownField(),o=i.getModel(),r=(o.fieldMap[t.id]||{},n.dropdownInfo.getRadioInfo()),a=J(e).parents(".prefill-select-option").data("val");if(r.checkedValues.contains(a)){J(e).removeClass("is-selected");var s=r.checkedValues.indexOf(a);r.checkedValues.splice(s,1),!r.checkedValues.length&&n.elems.popup.find("#prefill-dropdown-value-field").enable()&&n.elems.popup.find("#prefill-dropdown-value-field").next().show()}else J(e).addClass("is-selected"),r.checkedValues.push(a),n.elems.popup.find("#prefill-dropdown-value-field").disable(),n.elems.popup.find("#prefill-dropdown-value-field").next().hide();r.isChecked=!!r.checkedValues.length,n.dropdownInfo.setRadioInfo(r)},h=function(e){var t=(L(n.fieldType),i.getModel()),o=t.fieldMap&&t.fieldMap[e]?t.fieldMap[e]:n.dropdownInfo.getDefaultInfo(),r=n.elems.popup,a=r.find("#prefill-select-container"),s=a.children().eq(0).detach();a.html(""),("fixed"==o.type?o.list:[""]).forEach(function(e,i){var n=s.clone(),l="prefill-select-option-"+i;e=t.replaceIdsWithNames(e),n.find(".js-prefill-sbox-option").attr("id",l).val(e);var d=JSON.parse(n.find(".js-mm-field-choose").attr("mm-zmenu-data"));d.target="#"+l,n.find(".js-mm-field-choose").attr("mm-zmenu-data",JSON.stringify(d)),n.find(".js-prefill-sbox-remove")[1==o.list.length?"hide":"show"](),n.attr("order-id",i),n.find("input.js-dropdown-select").attr("name","fixListOpt"),a.append(n),ZWComponentUtil.initElem(n),r.ZCtrackObjects("initEvents",n,void 0,!0)}),r.find(".zbutton").removeClass("is-selected"),o.idx>=0&&r.find(".zbutton").eq(o.idx).addClass("is-selected"),r.find("#prefill-dropdown-value-field").val(o.value)["fixed"==o.type&&o.idx!=-1?"disable":"enable"](),r.find("#prefill-dropdown-value-field").next()["fixed"==o.type&&o.idx!=-1?"hide":"show"](),"string"==typeof o.list&&r.find("#prefill-dynamic-options").val(o.list),r.find("#prefill-dropdown-add-option").show(),r.find("#prefill-dropdown-type").show(),r.find("input[name=prefill-sbox-type]").eq("fixed"==o.type?0:1).click(),r.find("#prefill-fixed-list-note").show(),r.find(".js-mm-field-choose").off("click").on("click",function(){J("#mm-fieldmenu").zmenu("show",{forElement:J(this),direction:"right"})}),se(r,n.dropdownInfo.getCurrentDropdownField()),r.find("#prefill-dropdown-set-values").removeAttr("onclick").off("click").on("click",_),r.find("input[name=fixListOpt]").next().removeAttr("onclick").attr("onclick","FieldPreFillHandler.setSelectedDropdownOption(this)")},I=function(e){var t=J(e).parents(".js-fieldmap-parent"),o=(t.find(".prefill-doc-fields-name").text(),t.data().fieldId),r=i.getModel().getFieldsList()[o];n.dropdownInfo.setCurrentDropdownField(r),n.dropdownInfo.setCurrentDropdownElem(t),n.dropdownInfo.isRadioOrMultipleChoice(r)?E(o):h(o),J("#mm-fieldmenu").zmenu()},_=function(){var e=n.dropdownInfo.getCurrentDropdownField(),t=i.getModel(),o=t.fieldMap[e.id]||{},r=n.elems.popup,a=n.dropdownInfo.getCurrentDropdownElem();o.type=r.find("input[name=prefill-sbox-type]:checked").val(),o.idx=r.find(".zbutton.is-selected").eq(0).parents(".prefill-select-option").attr("order-id"),o.idx="undefined"==typeof o.idx?-1:parseInt(o.idx);var s;"dynamic"==o.type?(s=r.find("#prefill-dynamic-options").val(),s=t.replaceNamesWithIds(s)):(s=[],r.find(".js-prefill-sbox-option").each(function(e,i){var n=J(i).val();n=t.replaceNamesWithIds(n),s.push(n)}),o.idx!=-1&&a.find(".datasrc-field-name").val(s[o.idx])),o.list=s,o.value=r.find("#prefill-dropdown-value-field").val(),o.value&&(o.value=t.replaceNamesWithIds(o.value)),t.updateFieldMap(e.id,o),Z("dropdown-config-popup").zpopover("close"),a.find(".prefill-sbox-configure").text(n.dropdownInfo.getDropdownType()),"fixed"==o.type&&o.idx!=-1&&a.find(".datasrc-field-name").val(o.list[o.idx]),n.dropdownInfo.setCurrentDropdownField(null),n.dropdownInfo.setCurrentDropdownElem(null)},A=function(e,t){var i=n.elems.popup;i.find("#prefill-sbox-options-fixed")["fixed"==e?"show":"hide"](),i.find("#prefill-sbox-options-dynamic")["dynamic"==e?"show":"hide"](),i.find(".mm-emailas-cont").removeClass("ui-active"),J(t).parents(".mm-emailas-cont").addClass("ui-active")},S=function(){var e=n.elems.popup,t=e.find("#prefill-select-container"),i=t.children().eq(0),o=i.clone(),r=t.children().length,a="prefill-select-option-"+r;o.find(".js-prefill-sbox-option").attr("id",a).val("");var s=JSON.parse(o.find(".js-mm-field-choose").attr("mm-zmenu-data"));s.target="#"+a,o.find(".js-mm-field-choose").attr("mm-zmenu-data",JSON.stringify(s)),o.find(".js-mm-field-choose").off("click").on("click",function(){J("#ff-field-menu").zmenu("show",{forElement:J(this),direction:"right"})}),o.attr("order-id",r),o.find(".zbutton").removeClass("is-selected"),t.append(o),t.find(".prefill-select-option").each(function(e,t){J(t).find(".js-prefill-sbox-remove").show()}),o[0].scrollIntoView()},R=function(e){var t=J(e),i=t.parents("#prefill-select-container");t.parents(".prefill-select-option").remove();var n=i.find(".prefill-select-option").length;i.find(".prefill-select-option").each(function(e,t){var i=J(t);i.attr("order-id",e);var o="prefill-select-option-"+e;i.find(".js-prefill-sbox-option").attr("id",o);var r=JSON.parse(i.find(".js-mm-field-choose").attr("mm-zmenu-data"));r.target="#"+o,i.find(".js-mm-field-choose").attr("mm-zmenu-data",JSON.stringify(r)),i.find(".js-prefill-sbox-remove")[1==n?"hide":"show"]()}),event.stopPropagation()},O=function(e){e||(e=event.currentTarget);var t=n.dropdownInfo.getCurrentDropdownField(),o=i.getModel(),r=o.fieldMap[t.id]||{},a=parseInt(J(e).parents(".prefill-select-option").attr("order-id"))||-1;a==r.idx?(J(e).removeClass("is-selected"),n.elems.popup.find("#prefill-dropdown-value-field").enable(),n.elems.popup.find("#prefill-dropdown-value-field").next().show()):(J(e).addClass("is-selected"),n.elems.popup.find("#prefill-dropdown-value-field").disable(),n.elems.popup.find("#prefill-dropdown-value-field").next().hide())},b=function(e,t){for(var i=[],n=0;n<t.length;n++){var o={},r=t[n];o.email=r,o.id=r,o.name=r,o.image=void 0,i.push(o)}e.ztokenfield("addTokens",i)},v=function(){var e,t,i=function(t){e=t.functionId,n.customFunctionInfo.custom_function_id=e,n.customFunctionInfo.custom_function_name=t.functionName,n.elems.dreFuncName.text(t.functionName).removeClass("ui-state-disabled"),n.elems.funcDelIcon.show(),DREDialogHandler.closeDialog()},o='prefilled_data = prefillInfo.get("field_map");\ninfo prefilled_data;',r=[{paramName:"prefillInfo",paramType:"Map"}],a={callback:i,btns:[J.i18n("writer.common.PROCEED")],showGalleryFunctions:!0,defaultScript:o,editorParams:r,functionCategory:"document_fill_submit",defaultFunctionId:e,functionReturnType:"void"},s=function(){var e,t="",i=[];return editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){e.getName()&&!i.contains(e.getName())&&l.push(e),i.push(e.getName())}),l.forEach(function(i){if(i.getName()&&!c.hasOwnProperty(i.getName())){switch(""!=t&&(t+=","),i.getFillableFieldType()){case FILLABLEFIELD_TYPE.IMAGE:case FILLABLEFIELD_TYPE.SIGNATURE:case FILLABLEFIELD_TYPE.INITIAL:e="www.example.com/sampleimage.jpeg";break;case FILLABLEFIELD_TYPE.DATE:e=(new Date).toLocaleDateString(i.getLocale());break;case FILLABLEFIELD_TYPE.CURRENCY:e="$ 123,456";break;case FILLABLEFIELD_TYPE.SELECTBOX:e=i.getList()[0];break;case FILLABLEFIELD_TYPE.MULTIPLECHOICE:e="Option 1,Option 3";break;case FILLABLEFIELD_TYPE.CHECKBOX:e="Yes";break;case FILLABLEFIELD_TYPE.NUMBER:e="12345";break;case FILLABLEFIELD_TYPE.PERCENT:e="10 %";break;case FILLABLEFIELD_TYPE.PHONE:e="1234567890";break;case FILLABLEFIELD_TYPE.EMAIL:e="abc@example.com";break;default:e="Sample value"}t+='<br>&nbsp&nbsp&nbsp"'+Utils.encodeHTMLString(i.getName())+'": "'+e+'"',c[i.getName()]=e}}),t},l=[],d="",c={};return function(){e=n.customFunctionInfo.custom_function_id,a.paramPopupsHTML||(t=(new Date).toDateString()+(new Date).toLocaleTimeString(),d="https://"+editorProps.urls.servername+"/open/"+editor.doc.docInfo.RID+"/fill/prefill/6817013e4b5c22a0998bcf832755e2fcc2b57af0215ddd028d242b79c4a2a116b796f6cd7fd81ea918f7d5ff07706b99cc2eee12ecbf1b98c21ee273b28169f88405742cf383407e17ae369dfbbe88fd5c61037944e51d60452192d2f5d2ed8e44fd3aad4bd565168feb58f048a30eeeab76856432b3470287b212dd7d781dca2355412f54d3594bfe8178546ac89820",a.paramPopupsHTML={prefillInfo:{title:"PrefillInfo",content:'<p>{</p><p>"field_map": {'+s()+'<br>}</p><p>"prefill_url": "'+d+'"</p><p>"email_info": {<br>&nbsp&nbsp&nbsp"status": "success"<br>&nbsp&nbsp&nbsp"mailed_time": "'+t+'"<br>}</p><p>}</p>'}}),a.defaultParamValues||(a.defaultParamValues={prefillInfo:{prefill_url:d,email_info:{status:"success",mailed_time:t},field_map:c}}),e&&(a.defaultFunctionId=e),DREDialogHandler.openDialog(a)}}(),D=function(){n.customFunctionInfo.custom_function_id=null,n.customFunctionInfo.custom_function_name=null,n.elems.dreFuncName.text(n.msgs.configure).removeClass("ui-state-disabled"),n.elems.funcDelIcon.hide()},L=function(e){var t=editor.doc.docInfo.TEMPLATE_SETTINGS;return t||(t=docProps.TEMPLATE_SETTINGS),t?(e==NODE_TYPE.FILLABLEFIELD?t=t.fill&&t.fill.onsubmit.prefill_info||{}:e==NODE_TYPE.SIGNERFIELD&&(t=t.sign&&t.sign.prefill_info||{}),t):{}},N=function(e){var t=ne().fieldType,i=editor.doc.docInfo.TEMPLATE_SETTINGS[t==NODE_TYPE.FILLABLEFIELD?"fill":"sign"];return t==NODE_TYPE.FILLABLEFIELD?(i||(i=FillAutomationHandler.getDefaultTemplateSettings()),i.onsubmit.prefill_info=e):t==NODE_TYPE.SIGNERFIELD&&(i.prefill_info=e),i},P=function(e){var t=FillAutomationHandler.getEmailsFromTokenField(n.elems[e]),i=L(n.fieldType),o=(i.email_info||{},[]);return t.forEach(function(e,t){o[t]||(o[t]={}),o[t]["recipient_"+(t+1)]=e}),o},C=function(e){var t=[];return e.forEach(function(e,i){t.push(e["recipient_"+(i+1)])}),t},y=function(){Macros.isSignTemplate()?NODE_TYPE.SIGNERFIELD:NODE_TYPE.FILLABLEFIELD;t=ne(),t.refreshModel(),i=new r(t),i.generateFieldMapHTML(),i.setFieldMapHTML()},F=function(){var e,t={init:function(){n.$el=J("#prefillandsharetofill"),n.initElems();var i=Macros.isSignTemplate()?NODE_TYPE.SIGNERFIELD:NODE_TYPE.FILLABLEFIELD;n.fieldType=i,e=L(i);var o=n.dataSourceInfo,r=n.$el;o?V(o):X();var s=ZWLicense.isFillAddonPurchased();r.find("#prefill-ccbcc-btn").off("click").on("click",function(){r.find("#prefill-ccbcc-cont").toggle()}).find(".zbutton__text").css("color","var(--themeColor)"),o&&o.fields&&o.fields.length||X();var l=e.email_info;l&&(s||(l.recipients=[{recipient_1:editorProps.userInfo.email}],r.find("#prefill-email-recipient").disable()),l.recipients&&b(r.find("#prefill-email-recipient"),C(l.recipients)),l.cc&&b(r.find("#prefill-email-cc"),l.cc),l.bcc&&b(r.find("#prefill-email-bcc"),l.bcc),l.subject&&n.elems.subject.val(l.subject)),e.custom_function_info&&e.custom_function_info.custom_function_id?(n.customFunctionInfo=e.custom_function_info,n.customFunctionEnabled=!0):(n.customFunctionInfo={},n.customFunctionEnabled=!1),n.customFunctionEnabled?(n.elems.dreFuncName.text(e.custom_function_info.custom_function_name).removeClass("ui-state-disabled"),n.elems.funcDelIcon.show(),r.find("#prefill-enable-custom-func").prop("checked",!0)):(n.elems.dreFuncName.text(n.msgs.configure).addClass("ui-state-disabled"),n.elems.funcDelIcon.hide(),r.find("#prefill-enable-custom-func").prop("checked",!1)),y(),a(l),W(!!o&&!!o.filter_data),ZWJSONUtils.isEmptyObject(ne().getFieldsList())?n.elems.btn0.disable():n.elems.btn0.enable(),r.find("#prefill-map-fields-btn").off("on").on("click",function(){n.elems.btn0.text("Next")}),r.find("#send-for-filling-btn").off("on").on("click",function(){n.elems.btn0.text(n.msgs.sendforfilling)}),r.find("#prefill-enable-custom-func").parent().off("click").on("click",function(){var e=J(this).children().eq(0).is(":checked");t.set({action:"execute_custom_func"},e)}),n.elems.messageErrorCont.hide(),n.elems.message.removeClass("ui-validation-error"),UIUtils.markVisitedFeature(2)},get:function(t,i){switch(t.action){case"message":return e.email_info&&(e.email_info.messageHTML||e.email_info.message);case"execute_custom_func":return!(!e.custom_function_info||!e.custom_function_info.custom_function_id)}},set:function(e,t,i){switch(e.action){case"execute_custom_func":n.customFunctionEnabled=!!t,n.elems.dreFuncName[t?"removeClass":"addClass"]("ui-state-disabled"),n.elems.funcDelIcon[t&&n.customFunctionInfo.custom_function_id?"show":"hide"]()}}};return function(){J.dialogutil.open("prefillandsharetofilldlg",void 0,t)}}(),M=function(){var e={js:[cdnZWStaticPath+fingerPrintObj["js/writer_public_min_all.js"]]},t=function(e,t,i){var n={scope:e==PUBLISH_TYPE.INTERNAL?"organization":"external",auto_republish:!0,successCallback:function(e){t&&t(e)},failureCallback:function(e){e&&i&&i(e)}};Publish.makePublish(n)};return function(i,n,o){editor.doc.docInfo.PUBLISH_SCOPE!=i?zw.require(e,[],t.bind(null,i,n,o)):n&&n()}}(),w=function(){var i=function(e){var t=editor.doc.docInfo.RID,i=ZWNetworkUtils.getNiceUrlPrefix(t+"/fields/prefill");J.ajax({url:i,params:{},type:"POST",dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(e,t,i){n.elems.statusCont.hide(),Notification.show({container:"#prefill-notify-container",message:"writer.automation.EMAIL_PREFILL_LINKS_FAIL",type:"error"})},success:function(e){n.elems.statusCont.hide(),c(),H(CONST.SEVERITY_SUCCESS,n.msgs.sharesuccess,n.msgs.sharemsg,[n.msgs.viewlog,n.msgs.done],[FillAutomationHandler.viewFillLogs,MsgDialog.close])}})};return function(){n.elems.statusCont.show(),n.elems.statusMsg.text(n.msgs.processing);var o={},r={},a=n.elems,s=e.getJSON();if(r.messageJSON=s,r.message=e.getText(s),r.messageHTML=RichTextEditor.getHTML(s),r.message.indexOf("document_org_shared_link")==-1&&r.message.indexOf("document_shared_link")==-1)return n.elems.statusCont.hide(),n.elems.messageErrorCont.show().text(n.msgs.insertlink),void n.elems.message.addClass("ui-validation-error");if(n.elems.messageErrorCont.hide(),r.recipients=P("recipients"),!r.recipients.length)return n.elems.statusCont.hide(),n.get("#prefill-email-recipient-ztokenfield-container").addClass("ui-validation-error"),void n.elems.emailErrorCont.show().text(n.msgs.emailerrormsg);n.elems.emailErrorCont.hide(),r.cc=FillAutomationHandler.getEmailsFromTokenField(a.cc),r.bcc=FillAutomationHandler.getEmailsFromTokenField(a.bcc);var l=ne().getDataSourceFieldsList();r.subject=n.elems.subject.val(),r.mf_mapping=MailMergeUtil.getFieldMappingFromObject(r.messageHTML,{includeRLFields:!0,mapping:l}),r.mf_mapping=MailMergeUtil.getFieldMappingFromObject(JSON.stringify(r.recipients),{includeRLFields:!0,mapping:l}),o.email_info=r,n.customFunctionEnabled&&n.customFunctionInfo.custom_function_id&&(o.custom_function_info=n.customFunctionInfo),o.field_map=t.getFieldMap();var d,c=function(){var e={},t=[];if(e.recordcallback=function(){FillAutomationHandler.storeFillSettings(N(o),{},re(i.bind(null,o)))},MailMergeDataModel.isDynamicFetch()){var n=MailMergeUtil.getFieldMappingFromObject(N(o),{includeRLFields:!0});Object.keys(n).forEach(function(e){t.push(n[e].id)}),e.additionalFields=t,MailMerge.getRecords(e)}else e.recordcallback()};d=r.message.indexOf("document_org_shared_link")!=-1?PUBLISH_TYPE.INTERNAL:PUBLISH_TYPE.EXTERNAL,M(d,c)}}(),U=function(){i.updateFieldMap();var e=ne(),t=e.fieldMap,o=!1,r=e.getFieldsList(),a=[],s=!1,l=!1;return Object.keys(t).forEach(function(n){var d=r[n],c=d.getFillableFieldType(),u=c==FILLABLEFIELD_TYPE.SELECTBOX;if(!u&&c!=FILLABLEFIELD_TYPE.RADIO&&c!=FILLABLEFIELD_TYPE.MULTIPLECHOICE&&c!=FILLABLEFIELD_TYPE.CHECKBOX){var p=e.replaceFieldsInString(t[n],"");FillableFieldsPanel.validateFilledValue(r[n],p)?i.hideFieldErrorCont(d):(o=!0,i.showFieldErrorCont(d),a.push(d),s=s||c==FILLABLEFIELD_TYPE.NUMBER||c==FILLABLEFIELD_TYPE.PERCENT,l=l||c==FILLABLEFIELD_TYPE.EMAIL)}}),n.elems.invalidCharsNote.text(1==a.length&&s?n.msgs.prefillinvalidnumber:1==a.length&&l?n.msgs.prefillinvalidemail:n.msgs.prefillinvalidchars),n.elems.invalidCharsNote[o?"show":"hide"](),!o},x=function(){var e=n.elems.tabpanel.ztabpanel("getAttribute","activeTab"),t=e.getAttribute("id");if("prefill-map-fields-btn"==t){if(!U())return;n.elems.tabpanel.ztabpanel("openNextTab"),n.elems.btn0.text(n.msgs.sendforfilling)}else w()},B=function(){c(),i.destroy(),g()},H=function(){var e={container:".ui-wdialog",className:"ui-wdialog-alert"},t=function(e,t,i){switch(i){case CONST.BUTTON_1_CLICKED:e&&e();break;case CONST.BUTTON_2_CLICKED:t&&t()}};return function(i,n,o,r,a){var s=t.bind(null,a[0],a[1]);MsgDialog.showMessage(r,i,n,o,void 0,void 0,s,!0,!0,e)}}(),G=function(){if(MailMergeDataModel.isDataAvailable()){var e=MailMergeDataModel.getFileName();n.elems.datasrcName.text(e),n.get("#prefill-source-text").show(),n.elems.previewText.show()}else n.elems.datasrcName.text(J.i18n("writer.editor.MAILMERGE.NO_DATASOURCE_AVAILABLE")),n.get("#prefill-source-text").hide(),n.elems.previewText.hide();k(n.elems.datasrcName),k(n.elems.previewText)},k=function(e){if(e.removeAttr("title"),e.removeClass("ui-mm-linktype-sourcename"),e.off("click"),e.addClass("ui-clr-blue ui-ms-pointer"),MailMergeDataModel.isDataAvailable())if(MailMergeDataModel.getSourceLink()){var t=MailMergeDataModel.getSourceLink();e.attr("title",t),e.click(function(){Utils.safeWindowOpen(t)}),e.addClass("ui-mm-linktype-sourcename")}else e.removeClass("ui-clr-blue ui-ms-pointer");else e.click(function(){MMDataSourceDlgHandler.open({action:"importDataSource"})})},W=function(e){Macros.isFillableTemplate()&&(e?(n.elems.filterNote.show(),n.elems.filterBtn.addClass("is-active"),Z("ff-data-filter-btn").addClass("is-active")):(n.elems.filterNote.hide(),n.elems.filterBtn.removeClass("is-active"),Z("ff-data-filter-btn").removeClass("is-active")))},Y=function(){return function(){PubSub.publish("MailMerge/LoadLazyFiles",{action:"FieldPreFillHandler.dataSourceDlgCallback"})}}(),z=function(){MMDataSourceDlgHandler.open({action:"importDataSource",callback:function(e){PubSub.publish("Prefill/DatasourceAdded",e)}}),UIUtils.markVisitedFeature(1)},V=function(e){u()&&(G(),n.get(".js-mm-field-choose").show(),n.get("#prefill-add-datasrc").hide(),n.elems.filterBtn.show(),n.get("#prefill-datasrc-options-btn").show(),n.elems.btn0.enable()),n.dataSourceInfo=e,!e||e.fields&&e.fields.length||Q(),t&&t.updateDataSourceFields()},j=function(){editor.getDocument().visitAllFields(NODE_TYPE.FILLABLEFIELD,function(e){var t=e.getFillableFieldType();e.isFillableImageField()||t==FILLABLEFIELD_TYPE.CHECKBOX||t==FILLABLEFIELD_TYPE.MULTIPLECHOICE||t==FILLABLEFIELD_TYPE.RADIO||(t==FILLABLEFIELD_TYPE.SELECTBOX?e.setSelectedIndex(e.getSelectedIndex()):e.setValue(e.getValue()))}).sync()},X=function(){u()&&(G(),n.get(".js-mm-field-choose").hide(),n.get(".datasrc-field-name").val(""),n.get("#prefill-add-datasrc").show(),n.elems.filterBtn.hide(),n.get("#prefill-datasrc-options-btn").hide(),n.elems.btn0.disable())},K=function(){X(),n.dataSourceInfo=null,ne().refreshModel();var e=L(ne().fieldType);e.field_map={},FillAutomationHandler.storeFillSettings(N(e),{},j)},q=function(e){var t=Macros.isSignTemplate()?NODE_TYPE.SIGNERFIELD:NODE_TYPE.FILLABLEFIELD,i=L(t),n={};if(i&&e){var o=e.id;if(i.field_map&&i.field_map[o]){delete i.field_map[o],delete i.fillable_field_map[o];var r=ne().getDataSourceFieldsList(),a=ne().getFieldsList();Object.keys(a).forEach(function(e){i.field_map[e]&&ZWJSONUtils.cloneAndExtend(n,MailMergeUtil.getFieldMappingFromObject(i.field_map[e],{includeRLFields:!0,mapping:r}))}),i.mf_mapping=n,FillAutomationHandler.storeFillSettings(N(i),{},null)}}},Q=function(){var e=function(e){n.dataSourceInfo&&(n.dataSourceInfo.fields=e.FIELDS,t&&t.updateDataSourceFields())};return function(){MailMerge.getFields(e,null)}}(),$=function(e){PubSub[e]("Prefill/DatasourceAdded",function(e){e&&V(e)}),PubSub[e]("Prefill/DatasourceRemoved",function(e){"Prefill"==e&&K()}),PubSub[e](["MailMerge/SourceDelinked","MailMerge/SourceDeleted"],function(){PubSub.publish("Prefill/DatasourceRemoved","Prefill")}),PubSub[e](["MailMerge/dataSourceAdded"],function(e){PubSub.publish("Prefill/DatasourceAdded",e)}),PubSub[e]("MailMerge/Filter/Modified",W),PubSub[e]("FillableFieldDeleted",q)};$("subscribe");var ee=function(){var e=function(){PubSub.publish("Prefill/DatasourceRemoved","Prefill")},t=function(){};return function(){MailMerge.removeDataLink(e,t)}}(),te=function(e){return n.dropdownInfo.setCurrentDropdownField(e),n.dropdownInfo.getDefaultInfo()};n.dataSourceInfo=docProps.MM_DETAILS;var ie=function(){return n.dataSourceInfo},ne=function(){if(!t){var e=Macros.isSignTemplate()?NODE_TYPE.SIGNERFIELD:NODE_TYPE.FILLABLEFIELD;t=new o(e),t.refreshModel()}return ZWJSONUtils.isEmptyObject(t.getDataSourceFieldsList())&&MailMergeDataModel.isDataAvailable()&&Q(),t},oe=function(e,t){var i=L(ne().fieldType);if(i.field_map&&i.field_map[t.getId()]){i.field_map[e.getId()]=i.field_map[t.getId()],N(i);var n=J("#field-properties").find(".js-mm-field-choose:visible").attr("mm-zmenu-data").target,o=J(n);o.val(i.field_map[e.getId()])}},re=function(e,t,i){var o=L(ne().fieldType),r={},a={},s=ne().getDataSourceFieldsList();if(t){if(!o.field_map||!o.field_map[t.getId()])return;if(r=o.fillable_field_map||{},a=ZWJSONUtils.clone(o.mf_mapping||{}),ZWJSONUtils.cloneAndExtend(a,MailMergeUtil.getFieldMappingFromObject(o.field_map[t.getId()],{includeRLFields:!0,mapping:s})),null==i&&""!=i&&(i=t.getName()),r[t.getId()]&&r[t.getId()][2]==i&&ZWJSONUtils.compareJSON(o.mf_mapping,a))return;r[t.getId()]={2:i}}else{var l=!1;editor.getDocument().visitAllFields(n.fieldType,function(e){if(o.field_map&&o.field_map[e.getId()]){r[e.id]={2:e.getName()},ZWJSONUtils.cloneAndExtend(a,MailMergeUtil.getFieldMappingFromObject(o.field_map[e.getId()],{includeRLFields:!0,mapping:s}));var t=e.getFillableFieldType(),i=n.fieldType==NODE_TYPE.FILLABLEFIELD&&t==FILLABLEFIELD_TYPE.SELECTBOX;if(t!=FILLABLEFIELD_TYPE.RADIO&&t!=FILLABLEFIELD_TYPE.MULTIPLECHOICE&&!e.isFillableImageField()){if(i){var d=o.field_map[e.getId()],c="fixed"==d.type&&d.idx==-1?-1:0;e.setSelectedIndex(c)}else t==FILLABLEFIELD_TYPE.CHECKBOX?e.setChecked(e.isChecked()):e.setValue(e.getValue());l=!0}}}),l&&editor.getDocument().sync()}o.fillable_field_map=r,o.mf_mapping=a,FillAutomationHandler.storeFillSettings(N(o),{},e)},ae=function(e){if(ne().fieldType==NODE_TYPE.FILLABLEFIELD){var t=e.getFillableFieldType();switch(t){case FILLABLEFIELD_TYPE.MULTILINE:return[MAILMERGE.FIELD_TYPE.MULTILINE,MAILMERGE.FIELD_TYPE.TEXT];case FILLABLEFIELD_TYPE.PERCENT:case FILLABLEFIELD_TYPE.PHONE:case FILLABLEFIELD_TYPE.CURRENCY:case FILLABLEFIELD_TYPE.NUMBER:return MAILMERGE.FIELD_TYPE.NUMBER;case FILLABLEFIELD_TYPE.EMAIL:return MAILMERGE.FIELD_TYPE.EMAIL;case FILLABLEFIELD_TYPE.IMAGE:case FILLABLEFIELD_TYPE.SIGNATURE:case FILLABLEFIELD_TYPE.INITIAL:return MAILMERGE.FIELD_TYPE.IMAGE;case FILLABLEFIELD_TYPE.DATE:return MAILMERGE.FIELD_TYPE.DATE;case FILLABLEFIELD_TYPE.CHECKBOX:return MAILMERGE.FIELD_TYPE.CHECKBOX;case FILLABLEFIELD_TYPE.RADIO:case FILLABLEFIELD_TYPE.MULTIPLECHOICE:case FILLABLEFIELD_TYPE.SELECTBOX:return[MAILMERGE.FIELD_TYPE.TEXT,MAILMERGE.FIELD_TYPE.NUMBER];case FILLABLEFIELD_TYPE.SINGLELINE:return[MAILMERGE.FIELD_TYPE.TEXT,MAILMERGE.FIELD_TYPE.NUMBER,MAILMERGE.FIELD_TYPE.WEBSITE];default:return MAILMERGE.FIELD_TYPE.TEXT}}},se=function(e,t){var i=e.find(".js-mm-field-choose:visible");i.each(function(e,i){var n=J(i),o=JSON.parse(n.attr("mm-zmenu-data")),r=ae(t);o.target.indexOf("dynamic")==-1&&o.target.indexOf("hecked")==-1&&(o.target.indexOf("prefill-value-field")!=-1&&t.getFillableFieldType()==FILLABLEFIELD_TYPE.MULTIPLECHOICE&&(r=MAILMERGE.FIELD_TYPE.LIST),o.fieldTypes=r,n.attr("mm-zmenu-data",JSON.stringify(o)))})},le=function(t,i){if("prefillDocSharedLinkItem"==i.target.attr("id")){var o=i.data.appData.params.type,r=e.getJSON();e.getText(r);o.indexOf("document_org_shared_link")!=-1?(n.elems.orgPrefillNote.show(),n.elems.publicPrefillNote.hide()):o.indexOf("document_shared_link")!=-1&&(n.elems.orgPrefillNote.hide(),n.elems.publicPrefillNote.show()),n.elems.message.removeClass("ui-validation-error"),n.elems.messageErrorCont.hide()}},de=function(t,i){if("prefillDocSharedLinkItem"==i.target.attr("id")){var n=e.getJSON(),o=e.getText(n);o.indexOf("document_org_shared_link")!=-1?J("#prefillDocSharedOrgLinkItemAsUrlItem,#prefillDocSharedOrgLinkItemAsQRCodeItem").disable():o.indexOf("document_shared_link")!=-1?J("#prefillDocSharedWebLinkItemAsUrlItem,#prefillDocSharedWebLinkItemAsQRCodeItem").disable():(J("#prefillDocSharedOrgLinkItemAsUrlItem,#prefillDocSharedOrgLinkItemAsQRCodeItem").enable(),J("#prefillDocSharedWebLinkItemAsUrlItem,#prefillDocSharedWebLinkItemAsQRCodeItem").enable())}},ce=function(){return{options:"option6"}},ue=function(){return{skipAutoFields:!0}};return{openCustomFunctionsDlg:v,deleteCustomFunction:D,getPrefillInfo:L,handleFieldMapping:y,openPrefillDlg:F,handleDocumentPublish:M,openDataSourceDlg:Y,dataSourceDlgCallback:z,removeDataSource:ee,initiatePreFill:w,handleNextButton:x,beforePopupOpen:I,setSelectedRadioOption:m,setDropdownValues:_,setDropdownType:A,addDropdownOption:S,removeDropdownOption:R,setSelectedDropdownOption:O,insertFieldsInRTE:d,closePrefillDlg:B,beforeClose:p,isDialogOpened:u,getDefaultDropdownInfo:te,getDataSourceInfo:ie,getPrefillModel:ne,updateFillableFieldDetails:re,updatePrefillForFieldName:oe,getMergeFieldTypes:ae,modifyFieldsMenu:se,insertPrefillLinkCallback:le,beforeShowPrefillLinkMenu:de,getMergeMenuData:ce,getFillMenuData:ue,setSourceFileLink:k,fetchLatestFields:Q}}();!function(e){var t=function(e,t){var i=Z(e),n=i.zdialog();i.data("ZCtrackObjects")?i.ZCtrackObjects("refreshValues"):(i.ZCtrackObjects({callbacks:t,fillVisible:!1,eventNameMapping:{zbutton:"zbuttonclick"}}),UIStateHandler.build(i[0])),n.zdialog("open")},i=function(e,t){Z(e).zdialog("close",t)};e.ZWDialogUtil={open:t,close:i}}(window),function(e){"use strict";var t=200,i="data-nav-card",n=5,o="data-toc-id",r="data-scene-title-id";e.CardOutlineView=function(e,t,n){this.operations={},this.model=e,this.viewElem=t,this.outerTimeOut=null,this.chunkProcessTimeOut=null,this.getView=n.getView,this.updateView=n.updateView,this.Events=n.events?n.events:{};var o={};o.el=t,o.validClass=i,o.model=this.model,o.uniqAttr=r,o.nonHandle="doc-nav-map-txt",o.horizontalDirection=n.horizontalDirection,o.keepNumbering=n.keepNumbering,o.replaceDragElem=n.replaceDragElem,o.considerDirection=n.considerDirection,this.dragAndDrop=n.isDragDropAllowed?new DragDrop(o):void 0},CardOutlineView.prototype.init=function(){this.boundUpdateOperationQueue=this.updateOperationQueue.bind(this),this.boundRemoveNode=this.removeNode.bind(this);for(var e in this.model.nodeOperations)this.updateOperationQueue(this.model.nodeOperations[e],!0);this.initRender(),this.subscribeEvents()},CardOutlineView.prototype.destroy=function(){delete this.operations,delete this.model,delete this.viewElem,delete this.outerTimeOut,delete this.chunkProcessTimeOut,this.unsubscribeEvents()},CardOutlineView.prototype.refresh=function(){this.operations={},this.model.refresh(),this.outerTimeOut=null,this.chunkProcessTimeOut=null},CardOutlineView.prototype.subscribeEvents=function(){PubSub.subscribe("Para/Create",this.boundUpdateOperationQueue),PubSub.subscribe("Para/Update",this.boundUpdateOperationQueue),PubSub.subscribe("Para/Modify",this.boundUpdateOperationQueue),PubSub.subscribe("Para/Remove",this.boundRemoveNode)},CardOutlineView.prototype.unsubscribeEvents=function(){PubSub.unsubscribe("Para/Create",this.boundUpdateOperationQueue),PubSub.unsubscribe("Para/Update",this.boundUpdateOperationQueue),PubSub.unsubscribe("Para/Modify",this.boundUpdateOperationQueue),PubSub.unsubscribe("Para/Remove",this.boundRemoveNode)},CardOutlineView.prototype.removeNode=function(e){var t=e.id,i=this.viewElem.querySelector("#"+t),n=DocUtil.getTocId(e);this.dragAndDrop&&this.dragAndDrop.dirtyNodes.hasOwnProperty(n)||(i&&this.viewElem.removeChild(i),delete this.operations[t]),"function"==typeof this.Events.cardMutation?this.Events.cardMutation(this.model.scenes.length):void 0},CardOutlineView.prototype.updateOperationQueue=function(e,t){var i=e.id;if(this.model.nodeOperations.hasOwnProperty(i)){var n=this.model.nodeOperations[i];this.model.removeNodeOperations(i),n.type==OPERATION_TYPE.DELETE_NODE?this.removeNode(n):(this.operations[i]=n,!t&&this.initRender())}"function"==typeof this.Events.cardMutation?this.Events.cardMutation(this.model.scenes.length):void 0},CardOutlineView.prototype.startRender=function(e){var i=0,o=e.length,r=function(){if(i<o){for(var a=0;a<n&&i<o;a+=1,i+=1){var s=e[i];this.buildNode(s)}this.processChunkTimeOut=setTimeout(r,t)}else clearTimeout(this.processChunkTimeOut),this.processChunkTimeOut=null}.bind(this);r()};var a=function(e,t,i){if(i){var n=e.querySelector("#"+i.id);n&&n.parentNode.insertBefore(t,n.nextSibling)}else{var o=e.firstChild;o?e.insertBefore(t,o):e.appendChild(t)}};CardOutlineView.prototype.buildNode=function(e){var t=this.viewElem.getElementsByClassName("div_loading")[0];if(t?t.parentNode.removeChild(t):null,e.type==OPERATION_TYPE.ADD_NODE&&e.isSplitter){var n,s=e.node,l=s.getContent().replaceAll(REGEX.docUnicodes,""),d=DocUtil.getTocId(s);if(l=l.replace(UNICODE.PARA,""),"undefined"!=typeof d&&this.dragAndDrop&&this.dragAndDrop.dirtyNodes&&this.dragAndDrop.dirtyNodes.hasOwnProperty(d)){var c=this.dragAndDrop.dirtyNodes[d];c.setAttribute("id",e.id),c.setAttribute(r,e.id),c.removeAttribute(o),n=c,this.updateView(c,s),delete this.dragAndDrop.dirtyNodes[d]}else{n=this.getView(s),n.classList.add(i),n.setAttribute(r,s.id),n.setAttribute("id",s.id),this.dragAndDrop?this.dragAndDrop.bindDragEvents(n):void 0;var u=this.model.scenes.getItemById(e.id),p=u.prev;a(this.viewElem,n,p),UIStateHandler.build(n)}}else if(e.type==OPERATION_TYPE.UPDATE_NODE){var g=e.id,s=e.node;if(!e.isSplitter){var f=this.model.getParentSplitterItem(g);g=f.id,s=f.node}n=this.viewElem.querySelector("#"+g),this.updateView(n,s)}delete this.operations[e.id]},CardOutlineView.prototype.initRender=function(e){this.outerTimeOut&&(clearTimeout(this.outerTimeOut),clearTimeout(this.processChunkTimeOut),this.outerTimeOut=this.processChunkTimeOut=null),this.outerTimeOut=setTimeout(function(){var e=this.getOperationQueue();e.length&&this.startRender(e)}.bind(this),t)},CardOutlineView.prototype.getOperationQueue=function(){var e=[];return U.each(this.operations,function(t,i){e.push(t)}),e=e.sort(function(e,t){return e.node.getIndex()-t.node.getIndex()})}}(window),function(){"use strict";var e=function(e){editor.doc.docInfo.TEMPLATE_SETTINGS||o(docProps.TEMPLATE_SETTINGS||{});var t=editor.doc.docInfo.TEMPLATE_SETTINGS||{};return e&&(t=t[e]),t},t=function(){return e(PREPARE_DOCUMENT.LAST_OPERATION)},i=function(e){o(e,PREPARE_DOCUMENT.LAST_OPERATION),PubSub.publish("PrepareDocument/ActionUpdated",t())},n=function(t){var i=ZWJSONUtils.clone(e(PREPARE_DOCUMENT.SEQUENCE_NUMBERS)||{});return t?i[t]||{}:i},o=function(t,i){if(i){var n=e();n[i]=t,t=n}DocInfo.setProperty({TEMPLATE_SETTINGS:t})},r=function(e,t,i,n){var r=ZWNetworkUtils.getContextUrl("v1/web/doc/"+Macros.getRId()+"/preparation/"+i+"/values"),a={success:function(t){var n=JSON.parse(t).operation_values;n&&o(n,i),e&&e()},fail:function(e,i,n){t&&t(e,i,n)},setHeaders:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}};J.ajaxUpload(r,ZWNetworkUtils.setDefaultParams(n),a,"json")},a=function(e){var t=ZWNetworkUtils.getContextUrl("v1/web/doc/"+Macros.getRId()+"/changeresourcetype"),i={resource_type:e};J.ajax({type:"POST",global:!1,async:!0,url:t,data:ZWNetworkUtils.setDefaultParams(i),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},dataType:"json",success:function(e){window.reload()},error:function(e,t,i){}})},s=function(e,t){var i=new Deferred,n=ZWNetworkUtils.getContextUrl("v1/web/doc/"+Macros.getRId()+"/preparation/sequencenumber"),o={action:e};return t&&(o.info=JSON.stringify(t)),J.ajax({type:"POST",global:!1,async:!0,url:n,data:ZWNetworkUtils.setDefaultParams(o),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},dataType:"json",success:function(e){PrepareDocumentHandler.setValues(e.sequence_numbers,PREPARE_DOCUMENT.SEQUENCE_NUMBERS),i.resolve()},error:function(e,t,n){i.reject()}}),i.promise()};window.PrepareDocumentHandler={getValues:e,setValues:o,setLastOperation:i,getLastOperation:t,getSequenceNumbers:n,handleActionValues:r,convertDocument:a,handleSequenceNumber:s}}(),function(){"use strict";var e,t={merge:{NAME:"writer.automation.MERGE_TEMPLATE",ICON:"ui-icon-mergedriven-datesource",MESSAGE:"LOADING_MERGE_TEMPLATE_EXPERIENCE"},sign:{NAME:"writer.automation.SIGN_TEMPLATE",ICON:"ui-icon-configure-zsign",MESSAGE:"LOADING_SIGN_TEMPLATE_EXPERIENCE",SAVED_MSG_DIV:"sign-saved-msg",PROCEED_FN:"AutomationHandler.openSignDlg"},fillable:{NAME:"writer.automation.FILLABLE_TEMPLATE",ICON:"ui-icon-publish-fill",MESSAGE:"LOADING_FILLABLE_TEMPLATE_EXPERIENCE"}},i=function(e){if(Macros.isMergeTemplate()||Macros.isSignTemplate()||editorProps.isFillableForm)return void AutomationHandler.openAutomationPanel();var i,n=t[e],o=[J.i18n(n.NAME)],r=J.i18n("writer.automation.CONVERT_TO_AUTOMATE_TEMPLATE",[o]),a=J.i18n("writer.automation.CONVERT_TO_AUTOMATE_TEMPLATE_MSG",["<b>"+o+"</b>"]),s=[J.i18n("writer.automation.CONVERT"),J.i18n("writer.common.CANCEL")],l=!1;if(("sign"==e||"fillable"==e)&&editor.doc.findNextIndexOf(UNICODE.MERGEFIELD_START,editor.doc.getContent())>-1){var d=J.i18n(t[PREPARE_DOCUMENT.OPERATION.MERGE].NAME);a=J.i18n("writer.automation.CONVERT_TO_AUTOMATE_TEMPLATE_WARNING_MSG",["<b>","</b>",d]),s=[J.i18n("writer.automation.PROCEED_WITH",[o]),J.i18n("writer.automation.CONVERT_TO_AUTOMATE_TEMPLATE",[d]),J.i18n("writer.common.CANCEL")],l=!0,i={className:"ui-wdialog-w-auto",container:".ui-wdialog"}}MsgDialog.showMessage(s,CONST.SEVERITY_WARNING,r,a,void 0,function(i){switch(i){case CONST.BUTTON_2_CLICKED:if(!l)break;e=PREPARE_DOCUMENT.OPERATION.MERGE,n=t[e];case CONST.BUTTON_1_CLICKED:var o=Z("automate-loading-cont");o.css("display","flex"),o.find("#automate-loading-icon").addClass(n.ICON),o.find("#automate-loading-msg").text(J.i18n("writer.common."+n.MESSAGE)),PrepareDocumentHandler.convertDocument(e);break;case CONST.BUTTON_3_CLICKED:}},void 0,!0,!0,i)},n=function(){SignDlgHandler.open({isDigisign:!0,saveOnly:!0,callback:o,defaultValues:PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.SIGN),title:J.i18n("writer.common.SETUP_SIGN_WORKFLOW"),btns:[J.i18n("writer.common.CONFIGURE")]})},o=function(){SignDlgHandler.showProgressLoadingMsg(J.i18n("writer.mailmergepopup.PROCESSING"));var t=function(){SignDlgHandler.close()},i=function(){SignDlgHandler.showNotificationMsg(J.i18n("writer.editor.MAILMERGE.DEFAULT_ERROR_MESSAGE"))},n=SignDlgHandler.getSignInfo(),o=JSON.parse(n.actioninfo);delete n.actioninfo,e=o,PrepareDocumentHandler.handleActionValues(t,i,PREPARE_DOCUMENT.OPERATION.SIGN,r(PREPARE_DOCUMENT.OPERATION.SIGN,o,n))},r=function(e,t,i){return i=i||{},t&&(i[e==PREPARE_DOCUMENT.OPERATION.SIGN?"signinfo":"values"]=JSON.stringify(t)),i},a=function(e){MailMergeUtil.showStatusMsg(Z(t[e].SAVED_MSG_DIV),"",3e3)},s=function(e){var i=t[e],n=Utils.getAsFunction(i.PROCEED_FN).fn;n()},l=function(){var t=function(){J("#sign-automation-saved,#sign-saved-msg").show(),J("#sign-automation-save").hide(),setTimeout(function(){J("#sign-automation-saved,#sign-saved-msg").hide(),J("#sign-automation-save").show()},5e3)},i=function(){};return function(){var n,o=e||PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.SIGN);o&&PrepareDocumentHandler.handleActionValues(t,i,PREPARE_DOCUMENT.OPERATION.SIGN,r(PREPARE_DOCUMENT.OPERATION.SIGN,o,n))}}();window.PrepareDocumentUIHandler={processAction:i,openSignDialog:n,showSavedMsg:a,proceed:s,saveSignSettings:l}}();var DesktopAppUIFrameWork=function(){var e=Object.keys(UIFrameWork_Config),t={},i=!1,n={"ins-lpnl-pagecnt":[{actionVal:"disable",actionName:["context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-docname":[{actionVal:"enable",actionName:["permission.document.edit"]},{actionVal:"disable",actionName:["context.canEditLockRange"]}],"ins-lpnl-date":[{actionVal:"disable",actionName:["context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-merge-fields":[{actionVal:"disable",actionName:["context.canEditLockRange","state.offline"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-fillable-fields":[{actionVal:"disable",actionName:["Section.header","Section.footer","Section.endnote","Section.footnote","state.offline","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-digisign-fields":[{actionVal:"disable",actionName:["Section.endnote","Section.footnote","context.canEditLockRange","state.offline"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"fmt-lpnl-undo":[{actionVal:"disable",actionName:["state.undoQueue.empty"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"fmt-lpnl-redo":[{actionVal:"disable",actionName:["state.redoQueue.empty"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"fmt-lpnl-incindent":[{actionVal:"enable",actionName:["permission.document.edit"]}],"fmt-lpnl-decindent":[{actionVal:"enable",actionName:["permission.document.edit"]}],superscript:[{actionVal:"enable",actionName:["permission.document.edit"]}],subscript:[{actionVal:"enable",actionName:["permission.document.edit"]}],"fmt-lpnl-changecasebtn":[{actionVal:"enable",actionName:["permission.document.edit"]}],"fmt-lpnl-brdrsandshading":[{actionVal:"enable",actionName:["permission.document.edit"]}],"fmt-lpnl-spacingmore":[{actionVal:"enable",actionName:["permission.document.edit"]}],"fmt-lpnl-spacingmore":[{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-img":[{actionVal:"disable",actionName:["Section.textbox","Section.endnote","Section.footnote","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-table":[{actionVal:"disable",actionName:["Section.endnote","Section.footnote","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-splchars":[{actionVal:"disable",actionName:["Section.endnote","Section.footnote","state.offline","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-chart-button":[{actionVal:"disable",actionName:["Section.endnote","Section.footnote","state.offline","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-barcode-button":[{actionVal:"disable",actionName:["Section.endnote","Section.footnote","state.offline","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-qrcode-button":[{actionVal:"disable",actionName:["Section.endnote","Section.footnote","state.offline","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-inshr":[{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-break-menu":[{actionVal:"disable",actionName:["Section.header","Section.footer","Section.textbox","context.isTable","Section.endnote","Section.footnote","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-bookmark":[{actionVal:"disable",actionName:["Section.header","Section.footer","Section.endnote","context.isTableSelected","Section.footnote","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit","context.isTextBoxInContentSection"]}],"ins-lpnl-toc":[{actionVal:"disable",actionName:["Section.header","Section.footer","Section.textbox","Section.endnote","Section.footnote","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-endnote":[{actionVal:"disable",actionName:["Section.header","Section.footer","Section.textbox","Section.endnote","Section.footnote","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-footnote":[{actionVal:"disable",actionName:["Section.header","Section.footer","Section.textbox","Section.endnote","Section.footnote","context.canEditLockRange"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"ins-lpnl-blnkpage":[{actionVal:"disable",actionName:["Section.header","Section.footer","Section.textbox","Section.endnote","Section.footnote","context.canEditLockRange","context.isTable"]},{actionVal:"enable",actionName:["permission.document.edit"]}],"tools-lpnl-personaldic":[{actionVal:"enable",actionName:["permission.document.edit","module.proofing.loaded"]},{actionVal:"disable",actionName:["state.offline"]}],"insert-pnl-signdiv":[{actionVal:"enable",actionName:["permission.document.edit"]},{actionVal:"disable",actionName:["state.offline","Section.endnote","Section.footnote","context.canEditLockRange"]}]},o={},r=function(t){for(var i,n=e.length,o=n-1;o>-1;o--){var r=e[o];if(t.indexOf(r)!=-1){i=r;break}}return i},a=function(e,t,i){PubSub.subscribe(e,p.bind(null,{id:t,obj:i}),{context:"desktopAppUIFrameWork-"+t})},s=function(e){var t=document.getElementById(e);return!!t},l=function(e,i){var n=t[e];PubSub.unsubscribe(n,null,{context:"desktopAppUIFrameWork-"+e})},d=function(){if(editor.browserInfo.is_macApp){var e=editorProps.permissionsInfo.appInfo.document_type;if("MERGE_PDF_TEMPLATE"!=e&&"SIGN_PDF_TEMPLATE"!=e&&"FILLABLE_PDF_TEMPLATE"!=e){for(id in n){var l=s(id);if(!l){var d=n[id],c=d.length;t[id]=[];for(var u=0;u<c;u++)for(var g=d[u],f=g.actionVal,E=g.actionName,T=E.length,m=0;m<T;m++){var h=E[m],I=r(h);UIFrameWork_Config[I].fn(f,"",h);o[id]={},o[id].disable=[],o[id].enable=[];var _=UIFrameWork_Config[I].event;t[id]=t[id].concat(_);var A={actionVal:f,actionName:h};i||a(_,id,A),p({id:id,obj:A})}}}i=!0}}},c=function(e,t){var i=o[e].disable.indexOf(t.actionName);i!=-1&&o[e].disable.splice(i,1),0==o[e].disable.length&&PubSub.publish("Document/UIStateChanged",{element:{id:e},state:"enable"})},u=function(e,t){var i=t.actionName;o[e].disable.indexOf(i)==-1&&o[e].disable.push(i),PubSub.publish("Document/UIStateChanged",{element:{id:e},state:"disable"})},p=function(e){try{var t=e.id,i=e.obj,n=s(t);if(n)return void l(t,i);var o=r(i.actionName),a=UIFrameWork_Config[o].fn(i.actionVal,"",i.actionName);"enable"==a?c(t,i):"disable"==a&&u(t,i)}catch(e){}};return{init:d}}(),ShapesUtil=function(){"use strict";var e=function(e,t){return t.props.transform.dim.height=e[ATTR_IMAGE.I_HT],t.props.transform.dim.width=e[ATTR_IMAGE.I_WID],t.props.transform.rotate=e[ATTR_IMAGE.I_ROTATE],t},t=function(){var e=editor.doc.getSelection()[0].start,t=editor.doc.getRawFormatAt(e);t.shapeData.dropcapData||"WATERMARK"==t.shapeData.shapetype||n([t.shapeData])},i=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.IMAGE);e&&(PubSub.publish("Document/ShapeDeleted"),editor.doc.execCmd("delete",e))},n=function(e){zw.require({js:[cdnZWStaticPath+fingerPrintObj["js/writer_shapes_dialog.js"]]},[],function(){ShapesDialog.open(e)})},o=function(e){e=e.data||e;var t=e.shapes;return t&&J.each(t,function(e,i){i.nvOProps.nvDProps.id=Math.uuid(),t[e]=i}),e.nvOProps.nvDProps.id=Math.uuid(),e},r={TEXTBOX:'{"nvOProps":{"nvDProps":{"id":""}},"props":{"transform":{"fliph":false,"flipv":false,"dim":{"width":316,"height":117},"pos":{"left":252,"top":146,"zindex":0},"rotate":0},"geom":{"type":"PRESET","preset":{"type":"RECT"}},"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}}}},"themeRef":{"fillRef":{"ref":"THEME","color":{"type":"A1"}},"strokeRef":{"ref":"THEME","color":{"type":"A1","tweaks":{"shade":0.5}}},"fontRef":{"ref":"MINOR","color":{"type":"CUSTOM","rgb":[255,255,255]}}},"textBody":{"paras":[{"portions":[{"t":"","props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}},"unmerged":{"props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[0,0,0]}}},"stroke":{"type":"DASH","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}}}}],"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}},"listStyle":{"bullet":{"type":"NONE","status":"disabled"}}},"unmerged":{"style":{"halign":"LEFT","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}}}},"listNum":false}],"props":{"column":{"num":1,"gap":0},"valign":"TOP","inset":{"left":10,"right":10,"top":5,"bottom":5},"autoFit":{"type":"NONE"},"wrap":"NONE"},"element":"","id":"textcontainer"},"type":"SHAPE","editable":true,"textBox":true,"containerDim":{"width":"1000","height":"1000"}}',SHAPE:'{"nvOProps":{"nvDProps":{"id":""}},"props":{"transform":{"fliph":false,"flipv":false,"dim":{"width":88,"height":76},"pos":{"left":0,"top":0,"zindex":1},"rotate":0},"geom":{"type":"PRESET","preset":{"type":"RECT"}},"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[137,191,74]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE","solid":{"color":{"type":"A1","rgb":[112,154,63]}}}}},"themeRef":{"fillRef":{"ref":"THEME","color":{"type":"A1"}},"strokeRef":{"ref":"THEME","color":{"type":"A1","tweaks":{"shade":0.5}}},"fontRef":{"ref":"MINOR","color":{"type":"CUSTOM","rgb":[255,255,255]}}},"textBody":{"paras":[{"portions":[{"t":"","props":{"size":11,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}},"unmerged":{"props":{"size":18,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","rgb":[255,255,255]}}},"stroke":{"type":"SOLID","captype":"FLAT","jointype":"ROUND","width":1,"fill":{"type":"NONE"}},"font":{"fontFamily":{"name":"Arimo"}}}}}],"style":{"halign":"CENTER","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}},"listStyle":{"bullet":{"type":"NONE","status":"disabled"}}},"unmerged":{"style":{"halign":"CENTER","level":1,"margin":{"left":0},"dir":"LTR","defPrProps":{"font":{"fontFamily":{"name":"Arimo"},"ref":"MINOR"},"fill":{"type":"SOLID","solid":{"color":{"type":"TX1","rgb":{"0":0,"1":0,"2":0}}}},"size":18,"stroke":{"type":"SOLID","width":2.6666667,"fill":{"type":"SOLID","solid":{"color":{"type":"A1","tweaks":{"shade":0.5},"rgb":[56,93,138]}}},"captype":"FLAT"}},"spacing":{"line":{"type":"PERCENT","percent":"1.2"}}}},"listNum":false}],"props":{"column":{"num":1,"gap":0},"valign":"MIDDLE","inset":{"left":10,"right":10,"top":5,"bottom":5},"autoFit":{"type":"NONE"},"wrap":"NONE"},"element":"","id":"textcontainer"},"type":"SHAPE","editable":true,"containerDim":{"width":"1000","height":"1000"}}'},a=function(e){e||(e="SHAPE");var t=JSON.parse(r[e]);return t.nvOProps.nvDProps.id=Math.uuid(),J.extend(!0,{},t)},s=function(){return editor.doc.getRawFormatAt(editor.doc.getSelection()[0].start)},l=function(e){return(e.data||e).nvOProps.nvDProps.id},d=function(e){if(e&&e.shapeData){if(e.shapeData.dropcapData){var t=e.shapeData.nvOProps.nvDProps.id,i=J("#"+t).parents("div.zw-paragraph");if(!i[0])return;var n=DocUtil.getDocElement(i[0]),e=DocUtil.getParaFormat(n.getEnd()-1);e[ATTR_PARAGRAPH.PS_DROPCAP]=!1,n.attr(e)}else e.shapeData.shapetype==InsertShape.constant.WATERMARK&&PubSub.publish("Watermark/Deleted");InsertShape.closeToolbar(),EditorUtil.focusMultiByteSpan()}},c=function(e){var t=editor.doc.getRawFormatAt(e.getIdx()),i=t.shapeData&&!t.shapeData.dropcapData&&"WATERMARK"!=t.shapeData.shapetype;"shape"==e.getType()&&i&&PubSub.publish("LoadShapeVisualCue",e)};return PubSub.subscribe("TransformableObject/Created",c),PubSub.subscribe("ZWSelection/ImageDeleted",d),PubSub.subscribe("TransformableObject/ShapeDoubleClicked",t),{copyFormatsToShapedata:e,openDrawingBoard:n,renewShape:o,getDefaultShapeData:a,editShape:t,deleteShapesInSelection:i,getSelectedShapeFormat:s,getShapeId:l,beforeShapeDelete:d}}();!function(e){"use strict";e.Design=function(e){this.styles=e.styles,this.theme=e.theme,this.styleUIInfo=e.styleUIInfo,this.isValid=this.validate(),this.isValid||this.fix()&&(this.isValid=!0)},Design.prototype.validate=function(){return Design_Validator.isValid(this)},Design.prototype.fix=function(){return Design_Validator.validateDesign(this)},Design.prototype.update=function(){},Design.prototype.apply=function(){},Design.prototype.save=function(){}}(window),Design_Validator=function(){"use strict";var e=function(e){!Styles_Validator.validate(e.styles)&&Styles_Validator.fix(e.styles),!Theme_Validator.validate(e.theme)&&Theme_Validator.fix(e.theme),!StyleUIInfo_Validator.validate(e.styleUIInfo)&&StyleUIInfo_Validator.fix(e.styleUIInfo)},t=function(e){Styles_Validator.validate(e.styles)&&Theme_Validator.validate(e.theme)&&StyleUIInfo_Validator.validate(e.styleUIInfo)},i=function(){};return{validateDesign:e,isValid:t,fix:i}}(),Styles_Validator=function(){"use strict";var e=["char","para","shape","table"],t=function(e){try{return i(e)}catch(e){throw e}},i=function(t){var i=!0;try{for(var n=0,o=e.length;n<o;n++){var r=e[n];if(!t.hasOwnProperty(r))throw i=!1,l+" object is missing in styles"}var a=t.char;for(var s in a){var l=a[s];if("object"!=typeof l&&0==Object.keys(l).length)throw"char object is empty for "+l}var d=t.styles;for(var s in d){var l=d[s];if("object"!=typeof l&&0==Object.keys(l).length)throw"style object is empty for"+l;if(!l.hasOwnProperty("info"))throw"info object is missing in para style object :: "+l;var c=l.info;if(!c.hasOwnProperty("next")||!c.hasOwnProperty("basedOn")||d.hasOwnProperty(c.next))throw"info object is corrupted for para style object :: "+l}}catch(e){throw e}return i},n=function(){};return{validate:t,fix:n}}(),StyleUIInfo_Validator=function(){"use strict";var e=["char","para","shape","table"],t=function(e){try{return i(e)}catch(e){throw e}},i=function(t){var i=!0;try{for(var n=0,o=e.length;n<o;n++){var r=e[n];if(!t.hasOwnProperty(r))throw i=!1,l+" object is missing in styleUIInfo"}var a=t.styles;for(var s in a){var l=a[s];if("object"!=typeof l||0==Object.keys(l).length)throw"styleUIInfo object is empty for"+l}}catch(e){throw e}return i},n=function(){};return{validate:t,fix:n}}(),Theme_Validator=function(){"use strict";var e=["name","color","fmtScheme","font"],t=function(e){try{return i(e)}catch(e){throw e}},i=function(t){var i=!0;try{for(var n=0,o=e.length;n<o;n++){var r=e[n];if(!t.hasOwnProperty(r))throw i=!1,_val+" object is missing in theme"}}catch(e){throw e}return i},n=function(){};return{validate:t,fix:n}}();var FillableDragAndDrop=function(){"use strict";var e=!1,t=FILLABLEFIELD_TYPE.SINGLELINE,i={"fillable-field1":FILLABLEFIELD_TYPE.SINGLELINE,"fillable-field2":FILLABLEFIELD_TYPE.EMAIL,"fillable-field3":FILLABLEFIELD_TYPE.PHONE,"fillable-field4":FILLABLEFIELD_TYPE.NUMBER,"fillable-field5":FILLABLEFIELD_TYPE.DATE,"fillable-field6":FILLABLEFIELD_TYPE.PERCENT,"fillable-field7":FILLABLEFIELD_TYPE.CURRENCY,"fillable-field8":FILLABLEFIELD_TYPE.CHECKBOX,"fillable-field9":FILLABLEFIELD_TYPE.SELECTBOX,"fillable-field11":FILLABLEFIELD_TYPE.IMAGE,"fillable-field12":FILLABLEFIELD_TYPE.SIGNATURE,"fillable-field13":FILLABLEFIELD_TYPE.INITIAL,"fillable-field14":FILLABLEFIELD_TYPE.MULTILINE,"fillable-field15":FILLABLEFIELD_TYPE.RADIO},n=function(){if(Macros.isPDFDocument()){t=a(event.target);var e=J("#fillable_fields_btns"),i=e.parents("body"),n=document.createElement("span"),s=200,l=18.933;t===FILLABLEFIELD_TYPE.CHECKBOX||t===FILLABLEFIELD_TYPE.RADIO||t===FILLABLEFIELD_TYPE.MULTIPLECHOICE?(s=20,l=20):t===FILLABLEFIELD_TYPE.IMAGE?(s=100,l=100):t===FILLABLEFIELD_TYPE.INITIAL?(s=50,l=50):t===FILLABLEFIELD_TYPE.SIGNATURE?(s=300,l=50):t===FILLABLEFIELD_TYPE.MULTILINE&&(s=300,l=90),s+="px",l+="px";var d={position:"absolute",top:0,left:0,opacity:"0.6","z-index":"110",display:"none",width:s,height:l};n.setAttribute("class","zw-portion fillablefield"),n.setAttribute("id","dummyDragFF"),W(n).css(d),i.append(n),i[0].addEventListener("mousemove",o),i[0].addEventListener("mouseup",r)}},o=function(){PubSub.publish("Gridlines/show"),e=!0;var t=J("#dummyDragFF");t.css({top:event.y,left:event.x,display:"block"})},r=function(){PubSub.publish("Gridlines/hide");var i=J("#fillable_fields_btns"),n=i.parents("body");n[0].removeEventListener("mousemove",o),n[0].removeEventListener("mouseup",r);var a=J("#dummyDragFF");if(a.remove(),e){for(var s=DomViewManager.getClosestPage({left:event.clientX,top:event.clientY}),l=J(s),d=event.clientX-l.offset().left,c=event.clientY-l.offset().top,u=DocLayoutManager.getPageWithId(s.getAttribute("doc-id")),p=u.getFirstParaView().getNodeStartIndex(),g=TemplateUIHandler.getAllFieldsInPage(NODE_TYPE.FILLABLEFIELD,u.pageNumber),f=0;f<g.length;f++){var E=g[f],T=E.isFillableImageField()?E.style._.op.positionV.top:E._.op.positionV.top,m=E.isFillableImageField()?E.style._.op.positionH.left:E._.op.positionH.left;if(c==T){d<=m&&(p=E.getStart().start);break}if(c<T){p=E.getStart().start;break}}var h=u.getFirstParaView().getNodeEndIndex(),I={};I.top=c,I.left=d,I.start=p,I.end=h,UIUtils.insertFillableField(t,null,I),e=!1,t=FILLABLEFIELD_TYPE.SINGLELINE}},a=function(e){var t=i[e.id];return"LI"==e.tagName&&(t=e.id),"BUTTON"!=e.tagName&&"LI"!=e.tagName&&(t=a(e.parentElement)),"checkbox_group"==t&&(t=FILLABLEFIELD_TYPE.MULTIPLECHOICE),t};return{handleMouseDown:n}}(),ZDComponents=function(){var e=!1,t=0,i=2,n=0;WD_PRODUCT_TYPE=1;var o=function(){var e={serviceName:"zw",resourceId:editor.doc.rid,editorLang:editor.lang,docsJsDomain:jsStaticPath,docsCssDomain:cssStaticPath,docsVersion:docsVersion,initCallback:r};docProps.productInfo.product_type===n?e.resourceType=i:e.resourceType=t,WDHandler.initialise(e)},r=function(t){e=!0,PubSub.publish("Docs/Component/Loaded")},a=function(){return e},s=function(e){var t=new WorkDrive,i={};i.WDDomainURL=window.location.protocol+"//"+editorProps.urls.teamdriveURL,i.resId=e,i.componentType="supportShare",i.service="zw",t.loadServiceComponent(i)};return{initDocsComponent:o,isComponentsLoaded:a,openShareToSupportComponent:s}}();!function(){"use strict";var e,t={},i={},n={},o={},r={},a=function(a){o=a.configuration||{},r=a.urls||{},t=a.info||{},i=a.actioninfo||{},"string"==typeof i&&(i=JSON.parse(i)),e=a.source,n=a.operation_values||{},MailMergeFieldUtil.init(a),MailMergeRecordUtil.init(a)},s=function(){return!!e},l=function(){a({})},d=function(){return o.integrationName},c=function(){return o.isInternalIntegration},u=function(){return c()&&!Macros.isVerticalIntegration()?d():o.fileName},p=function(){return t},g=function(e){i=e},f=function(){return r},E=function(e){var t=i.additionalInfo||{};return e&&t.configurations&&t.configurations[e]&&(t=ZWJSONUtils.clone(t),ZWJSONUtils.mergeJsonObjs(t,t.configurations[e])),t},T=function(){return editorProps.urls.base_url+"/open/"+Macros.getRId()+"/mergereports/"+i.enc_jobid},m=function(){return i.records||[]},h=function(e){return m()[e]||{}},I=function(){return i.outputtype},_=function(e){var t=I();if(MailMergeDataModel.isFormsAutomation()){if(MailMergeJobInfo.isOperationPresent(t,e))return!0}else{var i=MailMergeJobConstants.getOperationStr(e),n=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.MERGE);if(n&&n[i])return!0}return!1},A=function(){for(var e=MailMergeJobInfo.getEmailOperationList(),t=0;t<e.length;t++)if(_(e[t]))return!0;return!1},S=function(){for(var e=MailMergeJobInfo.getEmailOperationList(),t=0;t<e.length;t++)if(_(e[t]))return e[t];return 0},R=function(){return _(MailMergeJobInfo.MMJobType.SAVE_AS_DOCUMENT)||_(MailMergeJobInfo.MMJobType.SAVE_AS_ATTACHMENT)},O=function(){return _(MailMergeJobInfo.MMJobType.SAVE_AS_ATTACHMENT)?MailMergeJobInfo.MMJobType.SAVE_AS_ATTACHMENT:_(MailMergeJobInfo.MMJobType.SAVE_AS_DOCUMENT)?MailMergeJobInfo.MMJobType.SAVE_AS_DOCUMENT:0},b=function(e){var t=E(e);if(ZWJSONUtils.isEmptyObject(t)){e=MailMergeJobConstants.getOperationStr(e);var i=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.MERGE);i||(PrepareDocumentHandler.setValues({},PREPARE_DOCUMENT.OPERATION.MERGE),i=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.MERGE)),t=i[e]}return t},v=function(e){var t=MailMergeDataModel.getActionAddInfo()||{},i=t.configurations||{};return i[e]},D=function(){return e},L=function(){return D()==MAILMERGE.SOURCE.ZOHO_FORMS_AUTOMATION},N=function(){return o.isDynamicData},P=function(){return o.isFieldBasedRecordSupported},C=function(){return o.sourceLink},y=function(){return o.isUpdateTemplateAllowed},F=function(e){var t=editorProps.urls.zohoSheetURL+"/sheet/";return e?t+"open/"+e:t+"new"},M=function(){return o.supportEmail},w=function(e){for(var t=getRLNames(),i=0;i<t.length;i++){var n=t[i];if(MailMergeFieldUtil.getFieldId(n)==e)return n}},U=function(){return o.isRlSupported},x=function(){return o.isRecordIncludesRLData},B=function(){return o.rlTableLimit},H=function(){return o.rlColumnLimit},J=function(){return o.rlRecordScheduleLevel?o.rlRecordScheduleLevel-1:0},G=function(e){return e=e||MailMergeRecordUtil.getRecordsCount(),!!(o.rlRecordScheduleLevel&&e>o.rlRecordScheduleLevel)},k=function(e){var t=W(),i=t.hasOwnProperty(e);if(i&&MAILMERGE.ACTION.STORE==e){var n=t[e];return Object.keys(n).length>1}return i},W=function(e){var t=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.MERGE);return t||(PrepareDocumentHandler.setValues({},PREPARE_DOCUMENT.OPERATION.MERGE),t=PrepareDocumentHandler.getValues(PREPARE_DOCUMENT.OPERATION.MERGE)),e?t[e]:t},Y=function(e,t){var i=W();t?i[t]=e:PrepareDocumentHandler.setValues(e,PREPARE_DOCUMENT.OPERATION.MERGE)},z=function(e){var t=W();t.jobs_count=e},Z=function(){var e=W();return e.jobs_count||0},V=function(){docProps.MM_DETAILS&&a(docProps.MM_DETAILS),(docProps.mergeFields||docProps.MM_DETAILS||MailMergeRepeatView.isRepeatRendered())&&PubSub.publish("MailMerge/Fields/inited")};window.MailMergeDataModel={init:a,isDataAvailable:s,removeData:l,getSource:D,isInternalIntegration:c,getIntegrationName:d,isDynamicFetch:N,fieldsBasedRecordsSupported:P,getSupportEmail:M,getSourceLink:C,isUpdateTemplateAllowed:y,getSheetUrl:F,getFileName:u,getInfo:p,setActionInfo:g,getUrls:f,getActionAddInfo:E,getReportPageUrl:T,getRecordsInfo:m,getRecordInfoAt:h,getActionType:I,isActionConfigured:_,isEmailActionConfigured:A,getEmailAction:S,isStoreFileActionConfigured:R,getStoreFileAction:O,getActionValues:b,getActionValuestoStore:v,isFormsAutomation:L,getRLName:w,isRlSupported:U,isRecordIncludesRLData:x,getRLTableLimit:B,getRLColumnLimit:H,getRLRecordOnDemandFetchLimit:J,isRLWillSchedule:G,isOperationValuesPresent:k,getOperationValues:W,setOperationValues:Y,setJobCount:z,getJobCount:Z},PubSub.subscribe("MailMerge/SourceDeleted",l),PubSub.subscribe("Document/AfterInit",V)}(),function(){"use strict";var e=[],t={},i=[],n={},o={},r=[],a={},s="!@#$%^&*()+=[]{};':\"\\|,.<>/?",l=/[!@#$%^&*()+=\[\]{};':"\\|,.<>\/?]/,d=[{START:"«",END:"»"},{START:"${",END:"}"}],c={START:"[",END:"]"},u=function(e){m(e.fields||[]),i=e.rl_names||[],MailMergeDataModel.isDynamicFetch()||(n=e.rl_fields||{}),t=e.field_settings||{},docProps.mergeFields||(docProps.mergeFields={}),E(docProps.mergeFields.FIELDS)},p=function(){var e=T();return!!e&&!!e.length},g=function(){return e||[]},f=function(){return docProps.mergeFields&&docProps.mergeFields.FIELDS||[]},E=function(e){docProps.mergeFields.FIELDS=h(e||[]),_()},T=function(){return f().concat(g())},m=function(t){e=h(t||[]),_()},h=function(e){for(var t=0;t<e.length;t++){var i=e[t],n=i[MAILMERGE.TYPE]||"";if(MAILMERGE.FIELD_TYPE.hasOwnProperty(n.toUpperCase())||(n="currency"==n||"percentage"==n||"phone"==n?MAILMERGE.FIELD_TYPE.NUMBER:"textlink"==n?MAILMERGE.FIELD_TYPE.WEBSITE:"clickableimage"==n?MAILMERGE.FIELD_TYPE.IMAGE:MAILMERGE.FIELD_TYPE.TEXT,i[MAILMERGE.TYPE]=n),n==MAILMERGE.FIELD_TYPE.SEQUENCE&&i[MAILMERGE.FORMAT]){for(var o=i[MAILMERGE.FORMAT],r=i[MAILMERGE.START_WITH]||"1";r.length<o.length;)r="0"+r;delete i[MAILMERGE.FORMAT],i[MAILMERGE.START_WITH]=r}}return e},I=function(){if(!ZWJSONUtils.isEmptyObject(a))return a;for(var e=T(),t=0;t<e.length;t++){var i=e[t];a[k(i)]=i}return a},_=function(){o={},r=[],a={}},A=function(e,t){if(!e)return T();"string"==typeof e&&(e=[e]);var i=[];t=t||T();for(var n=0;n<t.length;n++){var o=t[n];e.indexOf(o[MAILMERGE.TYPE])!=-1&&i.push(o)}return i},S=function(e){var t=!0;if(e||(e=T(),t=!1),!t&&r.length)return r;for(var i=[],n=0;n<e.length;n++){var o=e[n],a=L(o);i.contains(a)||i.push(a)}return t||(r=i),i},R=function(e){var t=L(e),i=U(e);return t&&(i=t+"."+i),i},O=function(e){return UNICODE.MERGEFIELD_START+R(e)+UNICODE.MERGEFIELD_END},b=function(e){return x(e)||R(e)},v=function(e){return UNICODE.MERGEFIELD_START+b(e)+UNICODE.MERGEFIELD_END},D=function(e){return!!N(e)},L=function(e){return e[MAILMERGE.GROUP_NAME]},N=function(e){return e[MAILMERGE.CATEGORY]},P=function(e,t){var i=L(e);if(t)return i;var n=S();return n.length>1||n.indexOf(i)==-1?i:void 0},C=function(e,t){t=t||T();for(var i=0;i<t.length;i++){var n=t[i],o=R(n);if(o==e||b(n)==e)return n}return null},y=function(e,t){var i=C(e,t);return i?k(i):null},F=function(e,t){t=t||$();for(var i in t)for(var n=t[i],o=0;o<n.length;o++){var r=n[o],a=R(r);if(a==e||b(r)==e)return r}return null},M=function(e,t){var i=F(e,t);return i?k(i):null},w=function(e){var t=$();for(var i in t)for(var n=t[i],o=0;o<n.length;o++){var r=n[o];if(k(r)==e)return H(r),r}return null},U=function(e){return e[MAILMERGE.FIELD_NAME]||e.name||""},x=function(e){return e[MAILMERGE.SHORTEN_NAME]||""},B=function(e){if(e){var t=I(),i=t[e];return H(i),i}},H=function(e){"undefined"!=typeof MMFieldSettingsUtil&&MMFieldSettingsUtil.validateFieldInfo(e)},G=function(e){var t={};return t[MAILMERGE.FIELD_NAME]=e,t[MAILMERGE.FIELD_ID]=e,t[MAILMERGE.F_ID]=e,t[MAILMERGE.TYPE]=MAILMERGE.FIELD_TYPE.TEXT,t[MAILMERGE.CATEGORY]=MAILMERGE.CATEGORIES.CREATED,t},k=function(e){return e[MAILMERGE.F_ID]?e[MAILMERGE.F_ID]:e[MAILMERGE.FIELD_ID]},W=function(e){return e==MAILMERGE.FIELD_TYPE.WEBSITE||"textlink"==e},Y=function(e){return z(e)||W(e)},z=function(e){return e==MAILMERGE.FIELD_TYPE.IMAGE||"clickableimage"==e||e==MAILMERGE.FIELD_TYPE.IMAGELIST},Z=function(e){i=e},V=function(){return i||[]},j=function(e){docProps.mergeFields.RL_NAMES=e},X=function(){return docProps.mergeFields.RL_NAMES||[]},K=function(){return X().concat(V())},q=function(e){if(e){for(var t=V(),i=0;i<t.length;i++){var n=t[i];if(e==k(n))return n}for(var t=X(),i=0;i<t.length;i++){var n=t[i];if(e==k(n))return n}return null}},Q=function(e){return $().hasOwnProperty(e)},$=function(e){var t=ZWJSONUtils.clone(te()),i=ZWJSONUtils.clone(ee()),n=oe();for(var o in i){var r=i[o]||[];if(n[o]){var a=n[o]||{},s=a.fields||[];r=s.concat(r),i[o]=r}}return ZWJSONUtils.mergeJsonObjs(t,i),e?t[e]:t||[]},ee=function(e){return e?n[e]||[]:n||{}},te=function(e){var t=docProps.mergeFields.RL_FIELDS||{};return e?t[e]||[]:t},ie=function(e,t){return t?void(n[t]=e):void(n=e)},ne=function(e,t){if(t){var i=docProps.mergeFields.RL_FIELDS||{};i[t]=e,e=i}docProps.mergeFields.RL_FIELDS=e},oe=function(){return t},re=function(e){t=e},ae=function(){return!ZWJSONUtils.isEmptyObject(se())},se=function(e){var t={},i=editor.doc.getDocumentContent(),n=RegExp(UNICODE.RANGE_START+"|"+UNICODE.IMAGE+"|"+UNICODE.TABLE+"|"+UNICODE.ROW+"|"+UNICODE.CELL,"gi");e=e||{},e.mainFieldIdMap||(e.mainFieldIdMap=I()),e.fieldMapping||(e.fieldMapping=MailMergeRecordUtil.getFieldMapping());var o=e.from||0,r=e.to||i.length;n.lastIndex=o+1;for(var a=n.exec(i);a&&a.index>o&&a.index<r;){var s=a.index,l=editor.doc.getRawFormatAt(s)||{},d=l[MAILMERGE.MMINFO]||l.linkData&&l.linkData[MAILMERGE.MMINFO];l.type==NODE_TYPE.TABLE&&MailMergeRepeatUtil.isColumnRepeat(l)&&(d=MMRepeatFieldUtil.getRepeatInfo(l,s));var c=l[MAILMERGE.MMINFOS],u=l.fieldInfos,p=l.sequence_info;if(e.currentFieldMappingCount=0,d||c||u||p){l.type;if(c){var g=l.shapeData;if(g.shapes)for(var f=g.shapes,E=0,T=f.length;E<T;E++){var m=f[E];le(m,t,e)}else le(g,t,e);for(var h in c){var _=c[h];de(t,_,e)}}if(d)if(l.type==NODE_TYPE.TABLE||l.type==NODE_TYPE.ROW||l.type==NODE_TYPE.CELL||l.ftype==NODE_TYPE.REPEAT_START){var A={},S=ZWJSONUtils.clone(e);S.mminfo=d,S.isSubFormRange="main_fields"!=d.type;var R=d.filter_data;R&&R.condition&&ue(A,R.condition.fieldInfos,S),l.fieldInfos&&(ue(A,l.fieldInfos,S),u=null);var O=s+1;if(l.type==NODE_TYPE.TABLE){for(var b=ZWJSONUtils.clone(e),v=DocTreeManager.getParents(NODE_TYPE.TABLE,s),D=MailMergeRepeatUtil.getRepeatColumnIdx(v.format),L=v.children,N=0;N<L.length;N++){var P=L[N],C=P.children,y=C[D];b.from=P.getIndex(),b.to=y.getIndex();var F=se(b);ZWJSONUtils.mergeJsonObjs(t,F),S.from=y.getIndex(),S.to=y.getEndIndex();var M=se(S);ZWJSONUtils.mergeJsonObjs(A,M),b.from=y.getEndIndex(),b.to=P.getEndIndex();var F=se(b);ZWJSONUtils.mergeJsonObjs(t,F)}O=v.getEndIndex()}else{l.type==NODE_TYPE.ROW?O=DocUtil.getEnd(s+1,UNICODE.ROW,i):l.type==NODE_TYPE.CELL?O=DocUtil.getEnd(s+1,UNICODE.CELL,i):l.ftype==NODE_TYPE.REPEAT_START&&(O=DocUtil.getRangeEnd(s)),S.from=s,S.to=O;var M=se(S);ZWJSONUtils.mergeJsonObjs(A,M)}var w=ZWJSONUtils.clone(d),U=MailMergeFieldUtil.getFieldId(w);if(!e.skipMappingCheck&&e.fieldMapping[U]){var x=e.fieldMapping[U]||{};U=x.id||U,w=ZWJSONUtils.clone(MailMergeFieldUtil.getRLNameInfo(U)||w)}MMRepeatFieldUtil.isMainRecordRepeat(w)?ZWJSONUtils.mergeJsonObjs(t,A):pe(t,w,A,e),n.lastIndex=O}else if(l.type==NODE_TYPE.CHART&&l.mminfo&&l.mminfo.subFormInfo&&!MMRepeatFieldUtil.isMainRecordRepeat(l.mminfo.subFormInfo)){var w=l.mminfo.subFormInfo,S=ZWJSONUtils.clone(e);S.mminfo=w,S.isSubFormRange=!0;var A={};de(A,d,S),pe(t,w,A,e)}else de(t,d,e);if(u&&(l.oldCondition&&(u=ConditionsEvaluator.getMergeFieldsUsedInConditions(l)),ue(t,u,e)),p){var B=p.mf_mapping||{};ue(t,B,e)}}a=n.exec(i)}return t},le=function(e,t,i){for(var n=e.textBody||{},o=n.paras||[],r=0,a=o.length;r<a;r++)for(var s=o[r].portions||[],l=0,d=s.length;l<d;l++){var c=s[l];if(c[MAILMERGE.MMINFO]){var u=c[MAILMERGE.MMINFO];i.currentFieldMappingCount=0,de(t,u,i)}}},de=function(e,t,i){if(t.type!=MAILMERGE.BUILD_IN_FIELD&&t.type!=MAILMERGE.FIELD_TYPE.SEQUENCE){var n=i.skipMappingCheck,o=MailMergeFieldUtil.getFieldId(t)||"";if(i.currentFieldMappingCount=(i.currentFieldMappingCount||0)+1,i.currentFieldMappingCount>10&&(n=!0,delete t[MAILMERGE.MAPPING]),t.type==FIELD_TYPE.AUTO)return void ce(e,t,i);if(!n){var r=MailMergeRecordUtil.getFieldMapping();if(o&&r[o]){var a=r[o]||{};return void ue(e,a[MAILMERGE.MAPPING]||{},i)}if(i.mminfo){var s=i.mminfo,l=MailMergeFieldUtil.getFieldId(s)||"";if(l&&r[l]){var d=r[l]||{},c=d.field_mapping||{};if(o&&c[o]){var a=c[o]||{};return void ue(e,a[MAILMERGE.MAPPING]||{},i)}}}}if(t[MAILMERGE.MAPPING])return void ue(e,t[MAILMERGE.MAPPING],i);if(o&&!e[o]){if(i.skipCustomFields&&t[MAILMERGE.CATEGORY])return;if(i.mainFieldsAlone){if(!i.mainFieldIdMap.hasOwnProperty(o)&&i.isSubFormRange)return}else if(i.subformFieldsAlone&&(i.mainFieldIdMap.hasOwnProperty(o)||!i.isSubFormRange))return;e[o]=t}}},ce=function(e,t,i){var n=t[AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER]||{};for(var o in n){var r=n[o];r.mf_mapping&&ue(e,r.mf_mapping,i)}},ue=function(e,t,i){for(var n=ZWJSONUtils.getKeys(t),o=0;o<n.length;o++){var r=n[o],a=t[r];de(e,a,i)}},pe=function(e,t,i,n){if(!ZWJSONUtils.isEmptyObject(i)){if(!n.subformFieldsAlone)return void ZWJSONUtils.mergeJsonObjs(e,i);delete t.filter_data;var o=MailMergeFieldUtil.getFieldId(t);e[o]||(e[o]=t,t.fields={});var r=e[o],a=r.fields;for(var s in i){var l=i[s];l.fields?pe(e,l,l.fields,n):a[s]=l}}},ge=function(){return MailMergeUtil.isPreviewMode()?!!(MailMergeRecordUtil.getRecordsPerPage()-1):fe()||Ee()},fe=function(){for(var e=editor.doc.getDocumentContent(),t=RegExp(UNICODE.RANGE_START+"#"+UNICODE.RANGE_END+"|"+UNICODE.IMAGE,"gi"),i=t.exec(e);i;){var n=i.index,o=editor.doc.getRawFormatAt(n)||{};if(o[ATTR_AUTOFIELD.FIELDTYPE]==CONST.NEXTRECORD)return!0;if(o[MAILMERGE.MMINFOS]){var r=o[MAILMERGE.MMINFOS]||{};if(r.hasOwnProperty(J.i18n("writer.editor.MAILMERGE.NEXT_RECORD")))return!0}i=t.exec(e)}return!1},Ee=function(){for(var e=editor.doc.getDocumentContent(),t=RegExp(UNICODE.RANGE_START+"|"+UNICODE.TABLE+"|"+UNICODE.ROW+"|"+UNICODE.CELL+"|"+UNICODE.IMAGE,"gi"),i=t.exec(e);i;){var n=i.index,o=editor.doc.getRawFormatAt(n)||{};if(MailMergeRepeatUtil.isRepeat(o)){var r=MMRepeatFieldUtil.getRepeatInfo(o,n);if(MMRepeatFieldUtil.isMainRecordRepeat(r))return!0}else if(o.type===NODE_TYPE.CHART){var a=o.chartDetails;if("multiseries"===a.series&&o.mminfo&&o.mminfo.subFormInfo&&MMRepeatFieldUtil.isMainRecordRepeat(o.mminfo.subFormInfo))return!0}i=t.exec(e)}return!1},Te=function(e){return e.type=MAILMERGE.FIELD_TYPE.SEQUENCE,e.mf_mapping&&(e.mapping=e.mf_mapping),e.display_name=e.name,e.id=e.name,delete e.name,delete e.value,delete e.last_generated_value,delete e.mf_mapping,e};window.MailMergeFieldUtil={EXCLUDED_SPECIALCHARS:s,FIELDNAME_SPECIALCHAR_REGEX:l,FIELD_PATTERNS:d,DATEFIELD_PATTERN:c,init:u,isFieldsAvailable:p,getDataSourceFields:g,getCustomFields:f,setCustomFields:E,getFields:T,setFields:m,getFieldIdMapping:I,getFieldsWithType:A,getFieldName:R,getFieldInfoFromName:C,getFieldIdFromName:y,getFieldInfoFromNameInRLFields:F,getFieldIdFromNameInRLFields:M,getRLFieldInfo:w,getFullFieldName:O,getMergeFieldName:b,getFullMergeFieldName:v,isCustomField:D,getGroupName:P,getOriginalGroupName:L,getCategory:N,getDisplayName:U,getShortenName:x,getFieldInfo:B,getNewFieldInfo:G,getFieldId:k,isLinkTypeField:W,isUrlTypeField:Y,isImageTypeField:z,setRLNames:Z,getRLNames:K,setCustomRLNames:j,getCustomRLNames:X,getDataSourceRLNames:V,getRLNameInfo:q,hasRLFields:Q,setRLFields:ie,setCustomRLFields:ne,getCustomRLFields:te,getRLFields:$,getDataSourceRLFields:ee,getFieldSettings:oe,setFieldSettings:re,isMergeFieldsPresentInDocument:ae,getMergeFieldsInDocument:se,isMultiRecordsPerPage:ge,convertSequnceInfoToMMInfo:Te}}(),function(){"use strict";var e=function(e,t){if(e[MAILMERGE.MMINFO])return e[MAILMERGE.MMINFO];for(var i=e.cols||[],n=0;n<i.length;n++){var o=i[n];if(o[MAILMERGE.MMINFO])return o[MAILMERGE.MMINFO]}var r=DocTreeManager.getParents(NODE_TYPE.TABLE,t);if(null==r||r.getIndex()!=t)return null;for(var r=DocTreeManager.getParents(NODE_TYPE.TABLE,t),a=r.children,n=0;n<a.length;n++){var s=a[n],l=s.format;if(l.hasOwnProperty(MAILMERGE.MMINFO))return l[MAILMERGE.MMINFO];for(var d=s.children,c=0;c<d.length;c++){var u=d[c],p=u.format;if(p.hasOwnProperty(MAILMERGE.MMINFO))return p[MAILMERGE.MMINFO]}}return null},t=function(e){return"main_fields"==e.type};window.MMRepeatFieldUtil={getRepeatInfo:e,isMainRecordRepeat:t}}(),function(){"use strict";var e,t=[],i=[],n={},o={},r={},a={},s=0,l=0,d=0,c=function(e){t=e.data||[],"string"==typeof t&&(t=JSON.parse(t)),i=J.extend([],t),n=e.rl_data||{},"string"==typeof n&&(n=JSON.parse(n)),o=e.field_mapping||{},ie(e.filter_data)},u=function(){return i},p=function(){return E(S())},g=function(e){i=e||[]},f=function(e){i.push(e)},E=function(e){var t=u()[e]||{};return t[MAILMERGE.SEQUENCE]||(t[MAILMERGE.SEQUENCE]=e+1),t},T=function(){if(MailMergeDataModel.getInfo().RECORD_IDS)return MailMergeDataModel.getInfo().RECORD_IDS.split(",");if(docProps.info.RECORD_IDS)return docProps.info.RECORD_IDS.split(",");for(var e=[],t=u(),i=0;i<t.length;i++){var n=t[i].id;n&&e.push(n)}return e},m=function(){return u().length||T().length},h=function(){return u().length>0},I=function(e){s=e,A(e)},_=function(){return s},A=function(e){l=e,a=E(e),R(e)},S=function(){return l},R=function(e){d=e},O=function(){return d},b=function(){l=d+1,a=E(l)},v=function(){return d+1-s},D=function(e,t,i){var n="";if(!e)return n;if(t=L(t),"string"==typeof e){var r=e;e=MailMergeFieldUtil.getFieldInfo(r),e||(e=MailMergeFieldUtil.getNewFieldInfo(r))}var r=MailMergeFieldUtil.getFieldId(e),a=t.baseFieldId,s=t.record=t.record||p(),l=t.callbackCount=(t.callbackCount||0)+1,d=t.field_mapping||o;if(t.baseFieldId||(t.baseFieldId=r),1==l&&r!=a&&(d.hasOwnProperty(r)||e[MAILMERGE.VALUE])){var c=d[r]||e;n=F(c,t,i),n=N(n,e,t)}else if(n=U(r,s),e.type!=MAILMERGE.FIELD_TYPE.SEQUENCE||n||(n=U(MAILMERGE.SEQUENCE,s)),x(n))n=N(n,e,t);else if(l<10&&r!=a&&(d.hasOwnProperty(r)||e[MAILMERGE.VALUE])){var c=d[r]||e;n=F(c,t,i),n=N(n,e,t)}return n},L=function(e){if(!e)return{};var t=e.record;delete e.record;var i=ZWJSONUtils.clone(e);return i.record=t,e.record=t,i},N=function(e,t,i){var n=i.type||t.type||MAILMERGE.FIELD_TYPE.TEXT;if(n==MAILMERGE.FIELD_TYPE.MATRIX_CHOICE)return e;var o=MailMergeFieldUtil.isLinkTypeField(n);if("string"!=typeof e&&(Array.isArray(e)?n==MAILMERGE.FIELD_TYPE.IMAGE?e=e[0]+"":n!=MAILMERGE.FIELD_TYPE.IMAGELIST&&n!=MAILMERGE.FIELD_TYPE.LIST&&(e=W(e)):e&&"object"==typeof e?(o?e.hasOwnProperty("urllink")?e=e.urllink:e.hasOwnProperty("value")&&(e=e.value):e.hasOwnProperty("urlvalue")?e=e.urlvalue:e.hasOwnProperty("value")?e=e.value:e.hasOwnProperty("address")?e=e.address:e.hasOwnProperty("formattedValue")&&(e=e.formattedValue),e&&"object"==typeof e&&(e=JSON.stringify(e))):e+=""),o)t[MAILMERGE.LINK_VALUE]&&(e=z(t[MAILMERGE.LINK_VALUE],t.mapping,i));else if(n==MAILMERGE.FIELD_TYPE.DATE){if(t[MAILMERGE.DATE_INFO]&&e){var r=t[MAILMERGE.DATE_INFO],a=r.input||{},s=r.output||{},l=r.adjustment||{},d=a[MAILMERGE.DATE_FORMAT],c=!1;"custom"==d&&(d=a[MAILMERGE.DATE_CUSTOM_FORMAT],c=!0);var u=a[MAILMERGE.DATE_LOCALE],p=a[MAILMERGE.DATE_TIMEZONE],g=s[MAILMERGE.DATE_FORMAT],f=!1;"custom"==g&&(g=s[MAILMERGE.DATE_CUSTOM_FORMAT],f=!0);var E=s[MAILMERGE.DATE_LOCALE],T=s[MAILMERGE.DATE_TIMEZONE];try{if(d&&u&&p&&g&&E&&T){var m=new ZWDateTime(e,d,u,p,c);m.adjustDate(l),e=f?m.customFormat(g,E,T):m.format(g,E,T)}}catch(t){e="Invalid Date"}}if(t[MAILMERGE.VALUE_FORMAT]&&!isNaN(e)){var h=t[MAILMERGE.VALUE_FORMAT];e=new ZWDateTime(parseInt(e)).customFormat(h)}}else if(n==MAILMERGE.FIELD_TYPE.CHECKBOX)e=G(e);else if(n==MAILMERGE.FIELD_TYPE.IMAGELIST)Array.isArray(e)||(e=e?e.split(","):[]);else if(n==MAILMERGE.FIELD_TYPE.LIST)e=W(e,t[MAILMERGE.LIST_TYPE]);else if(n==MAILMERGE.FIELD_TYPE.NUMBER||"phone"==n){if(t[MAILMERGE.FORMULA]&&(e=H(e,t,i)),t[MAILMERGE.VALUE_FORMAT]){var h=t[MAILMERGE.VALUE_FORMAT];e=DomUtil.getFormatedNumber(e,h,t[MAILMERGE.COUNTRY_CODE])}}else n==MAILMERGE.FIELD_TYPE.SEQUENCE?e=B(e,t,i):n==MAILMERGE.FIELD_TYPE.TEXT&&t[MAILMERGE.DISPLAY_VALUE]&&(e=z(t[MAILMERGE.DISPLAY_VALUE],t.mapping,i));"string"!=typeof e||n==MAILMERGE.FIELD_TYPE.MULTILINE||n==MAILMERGE.FIELD_TYPE.TEXT||n==MAILMERGE.FIELD_TYPE.LIST&&t[MAILMERGE.LIST_TYPE]==MAILMERGE.LIST_TYPES.VERTICAL||(e=e.replaceAll("\n","\\n"));var I=(MailMergeFieldUtil.isUrlTypeField(n)||MailMergeFieldUtil.isImageTypeField(n))&&!i.skipEncode;if(I)if("string"==typeof e)e=P(e);else if(Array.isArray(e))for(var _=0;_<e.length;_++)e[_]=P(e[_]);return e=C(e)},P=function(e){try{MAILMERGE.URL_REGEX.test(e)||decodeURIComponent(e)!=e||(e=encodeURIComponent(e))}catch(e){}return e},C=function(t){if(!t)return t;if("string"!=typeof t)return t;if(!e){var i="";for(var n in UNICODE){var o=UNICODE[n];y(o)||(i+=o+"|")}e=new RegExp(i.substring(0,i.length-1),"g")}return t.replace(e,"")},y=function(e){return e==UNICODE.PARA||e==UNICODE.TAB||e==UNICODE.SPACE||e==UNICODE.MULTIBYTE_SPACE||e==UNICODE.MERGEFIELD_START||e==UNICODE.MERGEFIELD_END},F=function(e,t,i){var n=e[MAILMERGE.VALUE]||"",o=e[MAILMERGE.MAPPING]||{},r=Object.keys(o);if(1!=r.length||e.type!=MAILMERGE.FIELD_TYPE.LIST&&e.type!=MAILMERGE.FIELD_TYPE.IMAGELIST||n!=UNICODE.MERGEFIELD_START+MailMergeFieldUtil.getFieldId(o[r[0]])+UNICODE.MERGEFIELD_END)n=z(n,o,t,i);else{var a=r[0];n=U(a,t.record)}return n},M=function(e){for(var t=MailMergeFieldUtil.DATEFIELD_PATTERN,i=e.indexOf(t.START);i!=-1;){var n=e.indexOf(t.END,i+1),o=e.substring(i,n+1),r=o.replace(t.START,"").replace(t.END,"");e=e.replace(o,w(r)),i=e.indexOf(t.START,i+1)}return e},w=function(e){var t=new ZWDateTime;return t.customFormat(e)},U=function(e,t){t=t||a;var i=t[e];return x(i)||(i=""),i},x=function(e){return void 0!=e&&null!=e},B=function(e,t,i){var n=t[MAILMERGE.START_WITH]||"1";for(e=parseInt(e)+parseInt(n)-1+"";e.length<n.length;)e="0"+e;var o=t[MAILMERGE.PREFIX]||"",r=t[MAILMERGE.SUFFIX]||"";return e=o+e+r,i=L(i),i.type=MAILMERGE.FIELD_TYPE.TEXT,e=z(e,t.mapping,i)},H=function(e,t,i){var n=t[MAILMERGE.FORMULA],o=Formula.getFormulaFormat(n);i.parseNumber=!0,i.default_value=0,o.text=Z(o.text,t.mapping,i);var r=Formula.calculate(o),a=r.formattedVal;return a},G=function(e){return k(e)?MAILMERGE.CHECK_BOX.CHECKED:MAILMERGE.CHECK_BOX.UNCHECKED},k=function(e){var t=["Y","YES","1","TRUE",MAILMERGE.CHECK_BOX.CHECKED,MAILMERGE.RADIO_BTN.CHECKED];return e&&t.contains(e.toUpperCase())},W=function(e,t){var i=", ";MAILMERGE.LIST_TYPES.VERTICAL==t&&(i="\n");var n="";if(Array.isArray(e)||(e=e.split(",")),e.length){n+=(Y(e[0])||"").trim();for(var o=1;o<e.length;o++){var r=(Y(e[o])||"").trim();n+=i+r}}return n},Y=function(e){return"undefined"==typeof e?"":"string"==typeof e?e:JSON.stringify(e)},z=function(e,t,i,n){if(i=L(i),!e)return"";if(e=M(e),!t)return e;var o=t.mf_mapping||t,r=t.af_mapping||{},a=r.doc_sequence_number||{};i=i||{};for(var s=e.indexOf(UNICODE.MERGEFIELD_START);s!=-1;){var l=e.indexOf(UNICODE.MERGEFIELD_END,s),d=e.substring(s+1,l),c=o[d];c||(c=a[d]?MailMergeFieldUtil.convertSequnceInfoToMMInfo(a[d]):MailMergeFieldUtil.getNewFieldInfo(d));var u="";if(u=n?n.getFieldValue(c,null,i):D(c,i,n),i.parseNumber){u=u?Formula.localeParseFloat(u+"")+"":"0";var p=Formula.getThousandAndDecimalSeperator().decimalSeparator;"."!=p&&(u=u.replaceAll("\\.",p))}""==u&&i.hasOwnProperty("default_value")&&(u=i.default_value),"string"!=typeof u&&(u+=""),e=e.replace(UNICODE.MERGEFIELD_START+d+UNICODE.MERGEFIELD_END,u),s=e.indexOf(UNICODE.MERGEFIELD_START,s+u.length)}for(var g="${",f="}",E=e.indexOf(g);E!=-1;){var T=e.indexOf(f,E),m=e.substring(E,T+1),d=m.replace(g,"").replace(f,""),c=o[d],u=D(c,i);e=e.replace(m,u),E=e.indexOf(g,E+u.length)}return e},Z=function(e,t,i,n){if(!e)return e;if("string"==typeof e)e=z(e,t,i,n);else if(Array.isArray(e))for(var o=0;o<e.length;o++)e[o]=Z(e[o],t,i,n);else if("object"==typeof e)for(var r=Object.keys(e),o=0;o<r.length;o++){var a=r[o],s=e[a];e[a]=Z(s,t,i,n)}return e},V=function(e){ZWJSONUtils.mergeJsonObjs(n,e)},j=function(){n={}},X=function(e){return n[e]||{}},K=function(e){return!(!MailMergeDataModel.isRecordIncludesRLData()&&void 0==n[e])},q=function(e){var t=p();if(t[e])return t[e];var i=t.id;return X(i)[e]?X(i)[e]:[]},Q=function(){return o},$=function(e){o=e||{}},ee=function(){return!(!r||!r.range&&!r.condition)},te=function(){return r},ie=function(e){r=e||{},MailMergeDataModel.isDynamicFetch()||(i=ne(r,ZWJSONUtils.clone(t)))},ne=function(e,t){if(e.range){var i=e.range;return oe(i.start,i.end,t)}if(e.condition){var n=e.condition;return re(n,t)}return t},oe=function(e,t,i){e<1&&(e=1);for(var n=[],o=e-1,r=t;o<r&&o<i.length;o++)n.push(i[o]);return n},re=function(e,t){if(e&&JSONEvaluator.checkPattern(e.pattern)){for(var i=new MMDataBean(t,0,{type:"filter_records"}),n=[];i.hasNext();){var o=ConditionsEvaluator.evaluateForMailMerge(ZWJSONUtils.clone(e),i);o.result&&n.push(i.getCurrentRecord()),i.nextRecord()}return n}};window.MailMergeRecordUtil={init:c,setRecords:g,getRecords:u,getRecordAt:E,getCurrentRecord:p,getRecordIds:T,getRecordsCount:m,isRecordsAvailable:h,setRecordStartIndex:I,getRecordStartIndex:_,setCurrentRecordIndex:A,getCurrentRecordIndex:S,getRecordEndIndex:O,setRecordEndIndex:R,goToNextRecord:b,getRecordsPerPage:v,getFieldValue:D,getFormatedValue:N,isTrueValue:k,getFormatedListValue:W,replaceFieldsInObject:Z,replaceFieldInText:z,setRLRecords:V,clearRLRecords:j,hasRlRecord:K,getRLRecord:X,getRLValues:q,getFieldMapping:Q,setFieldMapping:$,isFilterConfigured:ee,getFilterData:te,setFilterData:ie,filterRecords:ne,filterRecordsByCondition:re},PubSub.subscribe("MailMerge/RecordAdded",f)}(),function(){"use strict";var e=!1,t=function(t){return void 0!=t&&(e=t),e},i=function(e,t,o){o=o||{mf_mapping:e.mf_mapping};for(var r=0;r<t.length;r++){var a=t[r];if("object"==typeof a){var s=a.NAME;if(Array.isArray(e))for(var l=0;l<e.length;l++)e[l][s]&&(e[l][s]=n(e[l][s],o.mf_mapping));else if(e[s]){var d=e[s];i(d,a.KEYS,o)}}else if(Array.isArray(e))for(var l=0;l<e.length;l++)e[l][a]&&(e[l][a]=n(e[l][a],o.mf_mapping));else e[a]&&(e[a]=n(e[a],o.mf_mapping))}},n=function(e,t){if(!e||!t)return e;if("string"==typeof e)for(var i=0;i<MailMergeFieldUtil.FIELD_PATTERNS.length;i++)for(var o=MailMergeFieldUtil.FIELD_PATTERNS[i],r=o.START,a=r.length,s=o.END,l=e.indexOf(r);l!=-1;){var d=e.indexOf(s,l),c=e.substring(l+a,d),u=t[c]||{},p=MailMergeFieldUtil.getMergeFieldName(u)||c,g=UNICODE.MERGEFIELD_START+p+UNICODE.MERGEFIELD_END;e=e.replace(r+c+s,g),l=e.indexOf(r,l+1)}else if(Array.isArray(e))for(var i=0;i<e.length;i++){var f=e[i];f=n(f,t),e[i]=f}else if("object"==typeof e)for(var E=Object.keys(e),i=0;i<E.length;i++){var T=E[i],m=e[T],m=n(m,t);e[T]=m}return e},o=["email","recipients","cc","bcc"],r=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if("object"==typeof n){var s=n.NAME;if(Array.isArray(e))for(var l=0;l<e.length;l++)e[l][s]&&(e[l][s]=a(e[l][s],c));else if(e[s]){var d=e[s];r(d,n.KEYS)}}else{var c={};if(o.includes(n)&&(c={prefix:"${",suffix:"}"}),Array.isArray(e))for(var l=0;l<e.length;l++)e[l][n]&&(e[l][n]=a(e[l][n],c));else e[n]&&(e[n]=a(e[n],c))}}},a=function(e,t){if(t=t||{},!e)return e;if("string"==typeof e)for(var i=l(e,t),n=i.mf_mapping||{},o=0;o<MailMergeFieldUtil.FIELD_PATTERNS.length;o++)for(var r=MailMergeFieldUtil.FIELD_PATTERNS[o],s=r.START,d=s.length,c=r.END,u=t.prefix||s,p=t.suffix||c,g=e.indexOf(s);g!=-1;){var f=e.indexOf(c,g),E=e.substring(g+d,f),T=E;if(n[E]){var m=n[E];T=MailMergeFieldUtil.getFieldId(m)}e=e.replace(s+E+c,u+T+p),g=e.indexOf(s,g+1)}else if(Array.isArray(e))for(var o=0;o<e.length;o++){var h=e[o];h=a(h,t),e[o]=h}else if("object"==typeof e)for(var I=Object.keys(e),o=0;o<I.length;o++){var _=I[o],A=e[_],A=a(A,t);e[_]=A}return e},s=function(e,t){t=t||{};for(var i=l(e,t),n=i.mf_mapping||{},o={},r=Object.keys(n),a=0;a<r.length;a++){var s=r[a],d=n[s];if(t.separateMapping)f(o,d);else{var c=MailMergeFieldUtil.getFieldId(d);o[c]=d}}return i.af_mapping&&(o.af_mapping=i.af_mapping),o},l=function(e,t){var i={};if(t=t||{},!e)return i;if("string"==typeof e){for(var n=0;n<MailMergeFieldUtil.FIELD_PATTERNS.length;n++)for(var o=MailMergeFieldUtil.FIELD_PATTERNS[n],r=o.START,a=r.length,s=o.END,d=e.indexOf(r);d!=-1;){var c=e.indexOf(s,d),h=e.substring(d+a,c);if(PrepareDocumentHandler.getSequenceNumbers().hasOwnProperty(h))g(i,PrepareDocumentHandler.getSequenceNumbers(h));else{var I;t.fieldNameReplaced?(I=MailMergeFieldUtil.getFieldInfo(h),!I&&t.includeRlFields&&(I=MailMergeFieldUtil.getRLFieldInfo(h))):(I=MailMergeFieldUtil.getFieldInfoFromName(h,t.dataSourceFieldsAlone?MailMergeFieldUtil.getDataSourceFields():null),!I&&t.includeRlFields&&(I=MailMergeFieldUtil.getFieldInfoFromNameInRLFields(h,t.dataSourceFieldsAlone?MailMergeFieldUtil.getDataSourceRLFields():null))),!I&&t.mapping&&(I=T(h,t.mapping)),I||(I=MailMergeFieldUtil.getNewFieldInfo(m(h))),f(i,I,h)}d=e.indexOf(r,d+1)}for(var _=e.indexOf(MailMergeFieldUtil.DATEFIELD_PATTERN.START);_!=-1;){var c=e.indexOf(MailMergeFieldUtil.DATEFIELD_PATTERN.END,_+1),A=e.substring(_+MailMergeFieldUtil.DATEFIELD_PATTERN.START.length,c);u(A)&&E(i,{format:A,isauto:1}),_=e.indexOf(MailMergeFieldUtil.DATEFIELD_PATTERN.START,_+1)}}else if(Array.isArray(e))for(var n=0;n<e.length;n++){var S=e[n],R=l(S,t);p(i,R)}else if("object"==typeof e)for(var O=Object.keys(e),n=0;n<O.length;n++){var b=O[n],v=e[b],R=l(v,t);p(i,R)}return i},d=["D","DD","MM","MMM","MMMM","YY","YYYY","EEE","EEEE","HH","H","h","hh","m","mm","s","ss"],c=["/",".",":",","," ","-"],u=function(e){if(d.contains(e))return!0;for(var t=0;t<c.length;t++){var i=c[t];if(e.includes(i))for(var n=e.split(i),o=0;o<n.length;o++)if(d.contains(n[o].trim()))return!0}return!1},p=function(e,t){ZWJSONUtils.deepMerge(e,t)},g=function(e,t){var i=e.af_mapping||{},n=i.doc_sequence_number||{};n[t.name]=t,i.doc_sequence_number=n,i.type=FIELD_TYPE.AUTO,e.af_mapping=i},f=function(e,t,i){var n=e.mf_mapping||{};n[i||MailMergeFieldUtil.getFieldId(t)]=t,e.mf_mapping=n},E=function(e,t){var i=e.af_mapping||{},n=i.autodate||{};n[t.format]=t,i.autodate=n,i.type=FIELD_TYPE.AUTO,e.af_mapping=i},T=function(e,t){for(var i in t){var n=t[i];if(MailMergeFieldUtil.getFieldName(n)==e)return n}return null},m=function(e){return e?(e+"").replaceAll(" ","_").replace(/[`~!@#$%^&*()|+\-=?;:'",<>\{\}\[\]\\\/]/gi,""):e},h=function(e,t){var i=jQuery.extend(!0,{},e);if(Shapes.isSelected())ZWLogger.addToStatistics("Mail_Merge.insert.Shape"),InsertShape.insertMergeFields([CONST.MERGEFIELD,i]);else{var n=A(i);if(!n)return;var o=editor.getDocument(),r=o.getSelection(),a=r.getRangeAt(0);if(editor.doc.getSelection().isCollapsed()||(editor.doc.getSelection().deleteSelectedContents(),Op.sendMsg()),Macros.isPDFDocument()&&!t&&!I()){var o=editor.getDocument(),a=o.getSelection().getRangeAt(0),s=DocLayoutManager.getLineAtIndex(a.start).view;t=ImagePanel.getDefaultImagePostionJson(),t.wrapType="front",t.positionV.from="page",t.positionH.from="page",t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=s.getAbsTop("page"),t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=s.getAbsLeft("page"),t.start=a.start,t.end=a.end}if(t&&t.wrapType){_(n,t);var a=o.createRange();a.start=t.start,a.end=t.end}n.type==NODE_TYPE.IMAGE?(n.style.id=Utils.getRandomNumber(),a.insertNode(n)):a.insertField(n),o.sync(function(){EditorUtil.focusMultiByteSpan()}),EditorUtil.focusMultiByteSpan()}},I=function(){var e=editor.doc.getSelection().getStart(),t=DocTreeManager.getParents(NODE_TYPE.TEXTBOX,e);if(null!=t){var i=t.getRangeIndex(),n=editor.doc.getRawFormatAt(i)||{};if("textbox"==n.subType)return!0}return!1},_=function(e,t){e.type==NODE_TYPE.IMAGE?(e.style.wrapType="front",e.style.positionV=t[ATTR_IMAGE.I_V_POSITION],e.style.positionH=t[ATTR_IMAGE.I_H_POSITION]):(e._.op.wrapType="front",e._.op.positionV=t[ATTR_IMAGE.I_V_POSITION],e._.op.positionH=t[ATTR_IMAGE.I_H_POSITION],e._.op.wid=200,e._.op.ht=18.933)},A=function(e){ZWLogger.addToStatistics("Mail_Merge.insert.mergeField");var t=editor.getDocument(),i=t.createMailmergeField(e),n=e[MAILMERGE.TYPE];if(MailMergeFieldUtil.isImageTypeField(n)||n==MAILMERGE.FIELD_TYPE.BARCODE||n==MAILMERGE.FIELD_TYPE.QRCODE){var o=R(e),r=MailMergeFieldUtil.getFieldId(e),a=e[MAILMERGE.VALUE]||UNICODE.MERGEFIELD_START+r+UNICODE.MERGEFIELD_END,l=82,d=82;if(MailMergeFieldUtil.isImageTypeField(n)){if(ZWLogger.addToStatistics("Mail_Merge.insert.imageField"),i=t.createNode(NODE_TYPE.IMAGE),n==MAILMERGE.FIELD_TYPE.IMAGELIST&&e[MAILMERGE.LIST_TYPE]&&(o[MAILMERGE.LIST_TYPE]=e[MAILMERGE.LIST_TYPE]),e[MAILMERGE.LINK_VALUE]){var c={};c.type=LINK_TYPE.MMFIELD;var u=e[MAILMERGE.LINK_VALUE];c.url=u;var p=s(u,{mapping:p});c.mminfo={mapping:p},ZWJSONUtils.isEmptyObject(p)&&(c.type=LINK_TYPES.WEBURL,delete c.mminfo),i.style.linkData=c}i.style._.op.fitAs="original"}else if(n==MAILMERGE.FIELD_TYPE.BARCODE){ZWLogger.addToStatistics("Mail_Merge.insert.barcodeField"),i=t.createNode(NODE_TYPE.BARCODE);var g=e[MAILMERGE.BARCODE_INFO]||{};g.format=g.format||BarCodeGenerator.TYPE.CODE128,g.value=g.value||UNICODE.MERGEFIELD_START+r+UNICODE.MERGEFIELD_END,g.display_vl=g.display_vl,void 0==g.display_vl&&(g.display_vl=!0),i.setBarcodeInfo(g),a=BarCodeGenerator.generateBarCodeForWriter(g,e),l=100,d=180}else if(n==MAILMERGE.FIELD_TYPE.QRCODE){ZWLogger.addToStatistics("Mail_Merge.insert.qrcodeField"),i=t.createNode(NODE_TYPE.QRCODE);var f=e[MAILMERGE.QRCODE_INFO]||{};f.format=f.format||QRCodeGenerator.TYPE.PLAIN_TEXT,f.values=f.values||S(f,r),i.setQRCodeInfo(f),a=QRCodeGenerator.generateQRCodeForWriter(f,e),l=100,d=100}e[ATTR_IMAGE.I_HT]&&(l=e[ATTR_IMAGE.I_HT]),e[ATTR_IMAGE.I_WID]&&(d=e[ATTR_IMAGE.I_WID]),i.style.src=a,i.style.originalHeight=i.style.height=l,i.style.originalWidth=i.style.width=d,i.setMMInfo(o)}else if(n==MAILMERGE.FIELD_TYPE.WIDGET){ZWLogger.addToStatistics("Mail_Merge.insert.widgetField");var E=e[MAILMERGE.VALUE]||UNICODE.MERGEFIELD_START+MailMergeFieldUtil.getFieldId(e)+UNICODE.MERGEFIELD_END;i=t.createNode(NODE_TYPE.WIDGET),i.style.widgetSrc=E,i.style.src=ATTR_WIDGET.WIDGET_DEF_IMG;var o=R(e);i.setMMInfo(o);var T=DocLayoutManager.getPageWidthAtIdx(editor.doc.getSelection()[0].start),m=DocLayoutManager.getPageHeightAtIdx(editor.doc.getSelection()[0].start),h=e[ATTR_IMAGE.I_HT]||2*T/3,I=e[ATTR_IMAGE.I_WID]||T;h>m&&(h=m),I>T&&(I=T),i.style.height=h,i.style.width=I}else if(n==MAILMERGE.BUILD_IN_FIELD)i=t.createNextRecordField();else if(n==MAILMERGE.FIELD_TYPE.MAP){var E=e[MAILMERGE.VALUE]||UNICODE.MERGEFIELD_START+MailMergeFieldUtil.getFieldId(e)+UNICODE.MERGEFIELD_END;i=t.createNode(NODE_TYPE.WIDGET),i.style.src=ATTR_WIDGET.WIDGET_DEF_IMG,i.style._.op.mapDetails={source:"GMap",value:E};var o={},r=MailMergeFieldUtil.getFieldId(e),p=ZWJSONUtils.clone(e[MAILMERGE.MAPPING])||{};p.hasOwnProperty(r)||(p[r]=e),o[MAILMERGE.MAPPING]=p,i.setMMInfo(o);var T=DocLayoutManager.getContentWidthAtIndex(editor.doc.getSelection()[0].start),m=DocLayoutManager.getContentHeightAtIndex(editor.doc.getSelection()[0].start),h=e[ATTR_IMAGE.I_HT]||2*T/3,I=e[ATTR_IMAGE.I_WID]||T;h>m&&(h=m),I>T&&(I=T),i.style.height=h,i.style.width=I}return i},S=function(e,t){var i=e.format,n={},o=UNICODE.MERGEFIELD_START+t+UNICODE.MERGEFIELD_END;return QRCodeGenerator.TYPE.PLAIN_TEXT==i?n.text=o:QRCodeGenerator.TYPE.URL==i?n.url=o:QRCodeGenerator.TYPE.CONTACT==i?n.name=o:QRCodeGenerator.TYPE.PHONE==i?n.phone=o:QRCodeGenerator.TYPE.SMS==i?n.mobileNumber=o:QRCodeGenerator.TYPE.WIFI==i?n.ssid=o:QRCodeGenerator.TYPE.EMAIL==i&&(n.recipients=o),n},R=function(e){var t={},i=MailMergeFieldUtil.getFieldId(e),n=ZWJSONUtils.clone(e[MAILMERGE.MAPPING]||{});return n.hasOwnProperty(i)||(n[i]=e),t[MAILMERGE.MAPPING]=n,t[MAILMERGE.TYPE]=e[MAILMERGE.TYPE],t[MAILMERGE.SHORTEN_NAME]=e[MAILMERGE.SHORTEN_NAME],t[MAILMERGE.FIELD_ID]=e[MAILMERGE.FIELD_ID],t[MAILMERGE.F_ID]=e[MAILMERGE.F_ID],t[MAILMERGE.FIELD_NAME]=e[MAILMERGE.FIELD_NAME],t[MAILMERGE.GROUP_NAME]=e[MAILMERGE.GROUP_NAME],t[MAILMERGE.CATEGORY]=e[MAILMERGE.CATEGORY],e[MAILMERGE.LIST_TYPE]&&(t[MAILMERGE.LIST_TYPE]=e[MAILMERGE.LIST_TYPE]),t},O=function(e,t){var i=[],n=Utils.randomString(),o=Utils.randomString(),r=e[MAILMERGE.TYPE];if(MailMergeFieldUtil.isImageTypeField(r)||r==MAILMERGE.FIELD_TYPE.BARCODE||r==MAILMERGE.FIELD_TYPE.QRCODE||r==MAILMERGE.FIELD_TYPE.WIDGET||r==MAILMERGE.FIELD_TYPE.MAP||r==MAILMERGE.FIELD_TYPE.CHART){var a=MailMergeFieldUtil.getFieldId(e),s={};if(s[ATTR_COMMON.TYPE]=NODE_TYPE.IMAGE,s[ATTR_IMAGE.I_SRC]=e[MAILMERGE.VALUE]||UNICODE.MERGEFIELD_START+a+UNICODE.MERGEFIELD_END,s[ATTR_IMAGE.I_HT]=82,s[ATTR_IMAGE.I_WID]=82,s[MAILMERGE.MMINFO]=R(e),r==MAILMERGE.FIELD_TYPE.BARCODE){var l=e[MAILMERGE.BARCODE_INFO]||{};l.format=l.format||BarCodeGenerator.TYPE.CODE128,l.value=l.value||UNICODE.MERGEFIELD_START+a+UNICODE.MERGEFIELD_END,l.display_vl=l.display_vl,void 0==l.display_vl&&(l.display_vl=!0),s.barcode_info=l,s.subType=NODE_TYPE.BARCODE,s.src=BarCodeGenerator.generateBarCodeForWriter(l,e),s.ht=100,s.wid=180}else if(r==MAILMERGE.FIELD_TYPE.QRCODE){var d=e[MAILMERGE.QRCODE_INFO]||{};d.format=d.format||QRCodeGenerator.TYPE.PLAIN_TEXT,d.values=d.values||S(d,a),s.qrcode_info=d,s.subType=NODE_TYPE.QRCODE,s.src=QRCodeGenerator.generateQRCodeForWriter(d,e),s.ht=100,s.wid=100}else r==MAILMERGE.FIELD_TYPE.WIDGET?(s.widgetSrc=s.src,s.src=ATTR_WIDGET.WIDGET_DEF_IMG,s.subType=NODE_TYPE.WIDGET):r==MAILMERGE.FIELD_TYPE.MAP&&(s.mapDetails={source:"GMap",value:s.src},s.src=ATTR_WIDGET.WIDGET_DEF_IMG,s.subType=NODE_TYPE.WIDGET);b(s,t),i.push({as:{start:s,id:o}}),i.push({is:UNICODE.IMAGE}),i.push({as:{end:Object.keys(s),id:o}})}else{var c=e[MAILMERGE.TYPE]==MAILMERGE.BUILD_IN_FIELD,u={type:NODE_TYPE.MAILMERGEFIELD,id:n,mminfo:e},p=NODE_TYPE.MAILMERGEFIELD;c&&(p=NODE_TYPE.NEXTRECORD),u.ftype=p,b(u,t),i.push({as:{start:u,id:o}}),i.push({is:UNICODE.RANGE_START}),i.push({as:{end:Object.keys(u),id:o}}),o=Utils.randomString();var g={type:NODE_TYPE.TEXT,cls:p};c&&(g[ATTR_COMMON.FIELDINFO]=n),i.push({as:{start:g,id:o}});var f=ZWUtils.getMergeFieldName(e);c&&(f="#"),i.push({is:f}),i.push({as:{end:Object.keys(g),id:o}}),o=Utils.randomString();var E={type:NODE_TYPE.MAILMERGEFIELD,id:n,ftype:p};i.push({as:{start:E,id:o}}),i.push({is:UNICODE.RANGE_END}),i.push({as:{end:Object.keys(E),id:o}})}return i},b=function(e,t){t&&t.wrapType&&(e.wrapType=t.wrapType,e.positionH=t.positionH,e.positionV=t.positionV,e.type==NODE_TYPE.IMAGE?(e.height=e.ht,e.width=e.wid):(e.ht=18.933,e.wid=200),e.fid=Utils.randomString())},v=function(){var e=J.i18n("writer.editor.MAILMERGE.NEXT_RECORD"),t={id:MAILMERGE.NEXT,type:MAILMERGE.BUILD_IN_FIELD,display_name:e};editor.doc.execCmd("mergeField",[CONST.NEXTRECORD,t])},D=function(e){for(var t={},i=0;i<e.length;i++){var n=e[i],o=MailMergeFieldUtil.getGroupName(n);if(o){t[o]||(t[o]={});var r=t[o];r[MailMergeFieldUtil.getFieldId(n)]=n,t[o]=r}else t[MailMergeFieldUtil.getFieldId(n)]=n}for(var a=Object.keys(t);1==a.length;)t=t[a[0]],a=Object.keys(t);return t},L=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},N=function(e){for(var t=0;t<e.length;t++){var i=e[t];if(!i.startsWith("$")&&!i.startsWith(UNICODE.MERGEFIELD_START)&&!L(i))return!1}return!0},P=function(e){return"zdoc"==e||"zfdoc"==e};window.MailMergeUtil={isPreviewMode:t,changeFieldsToDisplay:i,changeObjectToDisplay:n,changeFieldsToStore:r,changeObjectToStore:a,mergeMappingInfo:p,addSequenceFieldInfoInMapping:g,addMergeFieldInfoInMapping:f,addDateFieldInfoInMapping:E,getFieldMappingFromObject:s,removeSpecialChars:m,insertField:h,getZWFieldNode:A,getMMFieldInsertOp:O,insertNextRecordField:v,convertFieldsToListingFormat:D,isValidEmail:L,isProperEmails:N,isWriterFormat:P}}(),function(){"use strict";var e,t={};t[MAILMERGE.FIELD_TYPE.TEXT]={icon:"ui-sprit-lazy ui-icon-fillablefield-stxt-sm",text:J.i18n("writer.mailmergepopup.PLAIN_TEXT")},t[MAILMERGE.FIELD_TYPE.MULTILINE]={icon:"ui-sprit-lazy ui-icon-signerfield-title-sm",text:J.i18n("writer.mailmergepopup.MULTI_LINE")},t[MAILMERGE.FIELD_TYPE.RICHTEXT]={icon:"ui-sprit-lazy ui-icon-fillablefield-mline-sm",text:J.i18n("writer.mailmergepopup.RICH_TEXT")},t[MAILMERGE.FIELD_TYPE.NUMBER]={icon:"ui-sprit-lazy ui-icon-fillablefield-number-sm",text:J.i18n("writer.mailmergepopup.NUMBER")},t[MAILMERGE.FIELD_TYPE.DATE]={icon:"ui-sprit-lazy ui-icon-calendar-sm",text:J.i18n("writer.common.DATE")},t[MAILMERGE.FIELD_TYPE.EMAIL]={icon:"ui-sprit-fast ui-icon-mail-sm",text:J.i18n("writer.common.EMAIL")},t[MAILMERGE.FIELD_TYPE.WEBSITE]={icon:"ui-sprit-lazy ui-icon-field-hyperlink-sm",text:J.i18n("writer.mailmergepopup.LINK")},t[MAILMERGE.FIELD_TYPE.IMAGE]={icon:"ui-sprit-lazy ui-icon-picture-sm",text:J.i18n("writer.mailmergepopup.IMAGE")},t[MAILMERGE.FIELD_TYPE.IMAGELIST]={icon:"ui-sprit-lazy ui-icon-imagelist-sm",text:J.i18n("writer.mailmergepopup.IMAGE_LIST")},t[MAILMERGE.FIELD_TYPE.LIST]={icon:"ui-sprit-lazy ui-icon-bullets-sm",text:J.i18n("writer.mailmergepopup.LIST")},t[MAILMERGE.FIELD_TYPE.CHECKBOX]={icon:"ui-sprit-lazy ui-icon-fillablefield-checkbox-sm",text:J.i18n("writer.digisign.CHECK_BOX")},t[MAILMERGE.FIELD_TYPE.BARCODE]={icon:"ui-sprit-lazy ui-icon-barcode-sm",text:J.i18n("writer.barcode.BARCODE")},t[MAILMERGE.FIELD_TYPE.QRCODE]={icon:"ui-sprit-lazy ui-icon-qrcode-sm",text:J.i18n("writer.qrcode.QRCODE")},t[MAILMERGE.FIELD_TYPE.SEQUENCE]={icon:"ui-sprit-lazy ui-icon-fillablefield-number-sm",text:J.i18n("writer.fields.AUTONUMBER")},t[MAILMERGE.FIELD_TYPE.WIDGET]={icon:"ui-sprit-lazy ui-icon-embed-sm",text:J.i18n("writer.common.EMBED")},t[MAILMERGE.FIELD_TYPE.MAP]={icon:"ui-sprit-lazy ui-icon-map-sm",text:J.i18n("writer.mailmergepopup.MAP")},t[MAILMERGE.FIELD_TYPE.MATRIX_CHOICE]={icon:"ui-sprit-lazy ui-icon-matrix-field-sm",text:J.i18n("writer.fields.MATRIX_CHOICE")};var i=function(e,t){var i="";if("string"==typeof t)i=t;else{i=MailMergeFieldUtil.getFieldName(t);var n=MailMergeFieldUtil.getOriginalGroupName(t);n&&(i=n+"."+i)}e.attr("search-pattern",i)},n=function(e,t,i){var n=J(e);n.hasClass("active")||(n.siblings().removeClass("active"),n.addClass("active"),t&&J(t).show(),i&&i(e))},o=function(t){clearTimeout(e),e=setTimeout(function(){var e=r(J(t.target),t.value,t.type,t.caseSensitive,t.listItemCallBack);t.callback&&t.callback(e)},t.timeOut||300)},r=function(e,t,i,n,o,a){for(var s=!1,l=e.children(),d=0;d<l.length;d++){var c=J(l[d]),u=c.hasClass("js-group-label");if(!u){var p=c.hasClass("js-fieldset-label");if(!p){var g=c.hasClass("js-heading-label");if(!g){var f=c.attr("search-pattern")||"";c.is("label")&&(f=c.find(".ui-mmfieldlist-label").attr("search-pattern")),n||(f=f.toLowerCase(),t=t.toLowerCase());var E=!1;E=1==i?f.startsWith(t):f.includes(t);var T=!1,m=c.attr("isparent");"true"==m&&(T=r(c,t,i,n,o,a||E)),E||T||a?(s=!0,c.show()):c.hide(),o&&o(c,E||T||a)}}}}return s},a=function(e,t){var i=J(e),n=i.parents(".js-mfsearch-cont");n.addClass("ui-mmflied-search-cont-expand");var o=n.find(".js-mfsearch-box");o.focus()},s=function(e,t){e.value||l(e,t)},l=function(e,t){var i=J(e),n=i.parents(".js-mfsearch-cont"),o=n.find(".js-mfsearch-box");o.val(""),J(t).find(".js-field-parent-search").show(),n.removeClass("ui-mmflied-search-cont-expand")},d=function(e){var t=e.container;!e.dontRemoveElements&&t.empty();var i=e.getFieldElem;i||(i=g,e.withIcon&&(i=E));var n=e.fields;if(!n){var o=MailMergeFieldUIUtil.getFields(e.listRepeatFields);if(o.promise){var r=i({display_name:J.i18n("writer.common.LOADING"),id:"loading"},e,{paddingLeft:0});r.off("click"),t.append(r);var a=o.promise;return void a.done(function(t){e.fields=t,d(e)})}n=o.fields}for(var s=ZWJSONUtils.clone(e),l=e.getGroupElem||c,p=e.skipGrouping||!1,f=e.includeSubContainer||!1,T={},m=0;m<n.length;m++){var h=t;s.paddingLeft=0;var I=n[m],_=MailMergeFieldUtil.getGroupName(I);if(!p&&_){s.paddingLeft+=10,T[_]||(T[_]=Utils.randomString());var A=T[_],S=h.find("#"+A);if(S.length||(S=l(_,A,s),h.append(S)),h=S,f){var R=h.find(".js-sub-container").first();R.length||(R=u(),h.append(R)),h=R}}s.paddingLeft+=10;var O=i(I,e,s);if(f&&!h.hasClass("js-sub-container")){var R=h.find(".js-sub-container").first();R.length||(R=u(),h.append(R)),h=R}h.append(O)}if(!n.length&&!e.dontAddEmptyMsg){var b=J("<div>",{class:"ui-pop-prooflang-hint ui-vhalign-center1 ui-pad-medium-rgt-lft text-center"}),v=J.i18n("writer.mailmergepopup.NO_FIELDS_TO_LITS");Macros.isRemote()||(v+=" "+J.i18n("writer.mailmergepopup.CREATE_OR_IMPORT_FIELDS")),b.text(v),t.append(b)}},c=function(e,t,n){var o=J("<div>",{id:t,isparent:"true",class:"js-mf-group-cont clearfix"});i(o,e);var r=J("<div>",{class:"js-group-label"});o.append(r);var a=J("<div>",{class:"ui-mmfieldlist-grptitle"}),s=n.paddingLeft,l={"border-bottom":s>=20?"none":"1px solid rgb(187, 187, 187)","padding-left":s+"px"};a.css(l),r.append(a);var d=J("<span>",{text:e});return a.append(d),o},u=function(){return J("<div>",{class:"js-sub-container",isparent:"true"})},p=function(e,t,n){var o=f(e,t,n),r=J("<div class='ui-mmfieldlist-label ui-flex-container ui-flex-vcenter ui-flex-jus-space-btwn' "+o+"></div>");r.text(MailMergeFieldUtil.getDisplayName(e));var a=MailMergeFieldUtil.getShortenName(e);if(a){var s=J("<span class='ui-zw-mm-dp-name ui-mm-dp-name-container'></span>");s.text(a),r.append(s)}return i(r,e),r},g=function(e,t,i){var n=p(e,t,i);return!t.onclick&&T(n,e,t),n},f=function(e,t,i){i=i||{};var n="";t.onclick&&(n+=" onclick='"+t.onclick+"("+JSON.stringify(e)+");'");var o="";return void 0!=i.padding&&(o+="padding: "+(i.padding||0)+"px !important;"),void 0!=i.paddingLeft&&(o+="padding-left: "+(i.paddingLeft||0)+"px !important;"),!t.skipPadding&&o&&(n+="style='"+o+"'"),n},E=function(e,n,o){var r=f(e,n,o),a=J("<div class='ui-mmfieldlist-label ui-flex-container ui-flex-vcenter js-create-mfield' "+r+"></div>");a.attr("mergefield-id",MailMergeFieldUtil.getFieldId(e)),a.attr("category",MailMergeFieldUtil.getCategory(e)),a.attr("group-name",MailMergeFieldUtil.getGroupName(e));var s=J("<span class='ui-right-margin-small zbutton__icon ui-mouse-cursor'></span>");s.addClass((t[e[MAILMERGE.TYPE]]||t[MAILMERGE.FIELD_TYPE.TEXT]).icon),a.append(s);var l=J("<span class='ui-mmfieldlist-label-txt ui-flex-1 ui-left-margin-small'></span>");if(l.text(MailMergeFieldUtil.getDisplayName(e)),a.append(l),!n.readOnly&&MailMergeFieldUtil.getCategory(e)){var d=J("<span class='zbutton__icon ui-hover-sh ui-sprit-lazy ui-icon-delete-blk-sm ui-no-margin-right ui-mouse-cursor' onclick='"+o.deleteFn+"(this);event.stopPropagation()'></span>");d.attr("title",J.i18n("writer.mailmergepopup.DELETE_FIELD")),a.append(d)}var c=MailMergeFieldUtil.getShortenName(e);if(c){var u=J("<span class='ui-zw-mm-dp-name ui-mm-dp-name-container'></span>");u.text(c),n.readOnly||(u.attr("title",J.i18n("writer.mailmergepopup.EDIT_SHORT_NAME")),u.on("click",function(t){t.stopPropagation(),MMFieldShortenNameDlgHandler.open({fieldInfo:e,update:!0})})),a.append(u)}else if(!n.readOnly){var p=J("<span class='ui-mm-dp-name-container ui-hover-sh zbutton__icon ui-sprit-lazy ui-icon-dp-name-sm ui-no-margin-right ui-mouse-cursor'></span>");p.attr("title",J.i18n("writer.mailmergepopup.SET_SHORT_NAME")),p.on("click",function(t){t.stopPropagation(),MMFieldShortenNameDlgHandler.open({fieldInfo:e})}),a.append(p)}return i(a,e),!n.onclick&&T(a,e,n),a},T=function(e,t,i){MMTemplateHandler.isPDFMergeTemplate()&&!i.callback&&e.mousedown(function(){MMFieldDragAndDropHandler.handleMouseDown({fieldInfo:t,callBack:MailMergeUtil.insertField})}),e.click(function(){i.callback?i.callback(t):MailMergeUtil.insertField(t)})},m=function(e){var i=e.element;i.zselectbox(),!e.isIconRequired&&i.zselectbox("setAttributes",{contentType:"custom"}),i.empty();var n=e.fields;if(!n){var o=MailMergeFieldUIUtil.getFields(e.listRepeatFields,e.mminfo,e.extraInfo);if(o.promise){var r={label:J.i18n("writer.common.LOADING"),id:"loading"};i.zselectbox("addOption",r);var a=o.promise;return void a.done(function(t){e.fields=t,m(e)})}n=o.fields}var s=e.selectFieldId,l=e.fieldTypes;e.dataSourceFieldsOnly&&(n=MailMergeFieldUtil.getDataSourceFields()),l&&(n=MailMergeFieldUtil.getFieldsWithType(l,n));for(var d=n.length,c=e.skipGrouping||!1,u=e.leaveUnselected||!1,p=!1,g=[],f={},E=0,T=d;E<T;E++){var h,I=n[E],_=MailMergeFieldUtil.getFieldId(I),A=MailMergeFieldUtil.getDisplayName(I),S=MailMergeFieldUtil.getGroupName(I,e.skipGroupNameChecking);e.defaultGrpName&&(S=e.defaultGrpName);var R=MailMergeUiUtils.getFieldElemWithoutEvent(I,e,{padding:0,paddingLeft:20})[0].outerHTML;if(h=e.isIconRequired?{value:_,icon:t[I.type].icon,label:A}:{value:_,innerHTML:R,label:A},!c&&S){var r=f[S];if(!r){var O=Utils.randomString();r={value:S,label:S,id:O,options:[]},f[S]=r,g.push(r)}r.options.push(h)}else g.push(h);s==_&&(p=!0)}if(!p&&e.addIfOptionNotPresent&&s){var h={value:s,label:s};g.push(h),p=!0}if(i.zselectbox("addOption",g),!e.isIconRequired&&i.zselectbox("refresh"),p||g.length&&!u){var b=s;p||(b=g[0].options?g[0].options[0].value:g[0].value),i.zselectbox("setValue",b)}},h=function(e){var t=e.element,i=J(t);if(!i.attr("disabled")){if("ztokenfield"==i.attr("ctype"))return void I(e);var n="",o=e.fieldInfo;if(o){var r=e.type;n=r==AUTOFIELD_TYPE.AUTO_DATE?MailMergeFieldUtil.DATEFIELD_PATTERN.START+o.FORMAT+MailMergeFieldUtil.DATEFIELD_PATTERN.END:r==AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER?UNICODE.MERGEFIELD_START+o.name+UNICODE.MERGEFIELD_END:MailMergeFieldUtil.getFullMergeFieldName(o)}else e.text&&(n=e.text);var a=t.selectionStart,s=t.selectionEnd,l=i.val();if(e.singleField){var d=l.indexOf("«"),c=l.indexOf("»");d!=-1&&c!=-1&&(a=d,s=c+1)}var u=l.slice(0,a)+n+l.slice(s),p=i.attr("maxlength");if(!(p&&u.length>p)){t.setAttribute("value",u),i.val(u),i.focus();var g=a+n.length;i.setCursorPosition(g),i.keyup()}}},I=function(e){var t=e.element,i=e.fieldInfo;S(J(t),[i]),J(t).focus()},_=[AUTOFIELD_TYPE.AUTO_DATE,"document_name","document_shared_link","document_shared_link_qrcode"],A=function(e,t){var i=t.fieldInfo,n={},o=t.type;if(_.contains(o)){if(n.type="autofield",n.fieldId=o,"document_name"==o)n.fieldName="["+J.i18n("writer.common.MERGED_DOCUMENT_NAME")+"]",n.props={class:"am-opt-link"};else if("document_shared_link"==o)n.fieldName="["+J.i18n("writer.common.SHARED_LINK_PUBLIC_URL")+"]",n.props={class:"am-opt-link"};else if("document_shared_link_qrcode"==o)n.fieldName=J.i18n("writer.qrcode.QRCODE"),n.props={src:QRCodeGenerator.generateOperationalQRCode(location.href),height:100,width:100,title:"["+J.i18n("writer.common.SHARED_LINK_PUBLIC_URL")+"]"},n.contentType="qrcode";else if(o==AUTOFIELD_TYPE.AUTO_DATE){var r={};t.text?(n.fieldName=t.text,r.isauto=0):(n.fieldName="["+i.FORMAT+"]",r.format=i.FORMAT,r.isauto=1),n.meta={datefieldinfo:r}}}else o==AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER?(n.type="mergefield",n.fieldId=i.name,n.fieldName=i.name,n.meta={sequencenumberinfo:i}):(n.type="mergefield",n.fieldId=MailMergeFieldUtil.getFieldId(i),n.fieldName=MailMergeFieldUtil.getMergeFieldName(i),n.meta={mailmergefieldinfo:i});e.insertMergeField(n)},S=function(e,t){for(var i=[],n=0;n<t.length;n++){var o={},r=t[n],a=MailMergeFieldUtil.getFullMergeFieldName(r);o.email=void 0,o.id=MailMergeFieldUtil.getFieldId(r),o.name=a,o.image=void 0,o.type="field",i.push(o)}e.ztokenfield("addTokens",i)},R=function(e,t,i){e.ztokenfield("setAttributes",{dataSource:t||[]}),i||t||!window.Contacts||Contacts.getContacts().done(function(t){R(e,t,!0)})},O=function(e){return/recipient_[0-9]/.test(e)},b=function(e,t,i){i=i||{};for(var n=[],o=0;o<t.length;o++){var r={},a=t[o];if("object"==typeof a){var s=Object.keys(a).find(O);a=a.email||a[s]}var l=a;r.email=a,r.id=a,a&&(r.name=l,r.image=void 0,n.push(r))}e.ztokenfield("addTokens",n)},v=function(e){var t={};if(!e)return t;for(var i=e.indexOf(UNICODE.MERGEFIELD_START);i!=-1;){var n=e.indexOf(UNICODE.MERGEFIELD_END,i),o=e.substring(i+1,n),r=MailMergeFieldUtil.getFieldInfoFromName(o);r&&(t[MailMergeFieldUtil.getMergeFieldName(r)]=r),i=e.indexOf(UNICODE.MERGEFIELD_START,i+1)}return t},D=function(e){e.on("paste",function(e){e.originalEvent.clipboardData.getData("Text").match(/[^\d]/)&&e.preventDefault()}),e.on("keypress",function(e){if(e.which<48||e.which>58)return!1})};PubSub.subscribeOnce("Cursor/Collapsed",function(){editor.doc.getSelection().bind(NODE_TYPE.MAILMERGEFIELD,{onSelect:function(){PubSub.publish("MailMerge/LoadLazyFiles",{action:"MMFieldVisualCuesHandler.show"})},onDeselect:function(){PubSub.publish("MailMerge/LoadLazyFiles",{action:"MMFieldVisualCuesHandler.hide"})}})}),PubSub.subscribeOnce("Cursor/Collapsed",function(){editor.doc.getSelection().bind(NODE_TYPE.AUTOFIELD,{onSelect:function(){PubSub.publish("Fields/FetchJS",{action:"DocSequenceVisualCuesHandler.show"})},onDeselect:function(){PubSub.publish("Fields/FetchJS",{action:"DocSequenceVisualCuesHandler.hide"})}})}),window.MailMergeUiUtils={FIELD_INFOS:t,addSearchPattern:i,activeCurrentDiv:n,searchDataSourceFiles:o,showSearchBox:a,searchBoxFocusOut:s,hideSearchBox:l,listFields:d,getFieldElemWithoutEvent:p,getFieldElem:g,populateFieldsInDropdown:m,insertFieldInText:h,insertFieldInRTE:A,setDataSourceToTokenField:R,addEmails:b,addFieldsInTokenField:S,getFieldInfosInTextForShape:v,handleNumberValidation:D}}(),function(){"use strict";var e,t,i,n,o,r,a,s,l,d,c,u,p=!1,g=!1,f={ZMENU:"mm-fieldmenu",ZPOPOVER:"mm-cfpopup"},E=["autoFieldHeaderItem","noFieldsMsgItem","loadingFieldItem"],T=[],m={option1:{listSequenceFields:!0,listDateFields:!0,listMergeFields:!0,showCreateFieldBtn:!0,showManageFieldBtn:!0,listRepeatFields:!0},option2:{listSequenceFields:!0,listDateFields:!0,listMergeFields:Macros.isMergeTemplate()||Macros.isFillableTemplate(),showCreateFieldBtn:!0,showManageFieldBtn:!0,listFillableFields:Macros.isFillableTemplate()},option3:{listMergeFields:!0},option4:{listMergeFields:!0,dataSourceFieldsOnly:!0},option5:{listSequenceFields:!0,listDateFields:!0,listMergeFields:!0},option6:{listSequenceFields:!0,listMergeFields:!0,listFillableFields:!0},option7:{listSequenceFields:!0,listMergeFields:!0}},h=function(){e=J("#"+f.ZMENU),t=J("#"+f.ZPOPOVER),a={id:"noFieldsMsgItem",itemType:"custom",innerHTML:"<div class='ui-clr-note'>"+J.i18n("writer.mailmergepopup.NO_FIELDS_AVAILABLE")+"</div>",className:"ui-custom-menuitem"},s={id:"creatFieldItem",label:J.i18n("writer.mailmergepopup.CREATE_NEW_FIELD"),name:J.i18n("writer.mailmergepopup.CREATE_NEW_FIELD"),icon:"ui-icon-add-textselection-sm",isFooter:!0},l={id:"manageFieldItem",label:J.i18n("writer.mailmergepopup.MANAGE_FIELDS"),name:J.i18n("writer.mailmergepopup.MANAGE_FIELDS"),isFooter:!0},d={id:"loadingFieldItem",itemType:"custom",innerHTML:"<div class='ui-semibold'>"+J.i18n("writer.common.LOADING")+"</div>",className:"ui-custom-menuitem zmenu__header clearfix"},I(),_(),p=!0},I=function(){T=[{id:"autoFieldHeaderItem",itemType:"custom",innerHTML:"<div class='zmenu__text'>"+J.i18n("writer.common.AUTO_FIELDS")+"</div>",className:"ui-custom-menuitem zmenu-ttl-with-line",isHeader:!0},{id:"dateFieldItem",label:J.i18n("writer.common.DATE"),name:J.i18n("writer.common.DATE"),icon:"ui-sprit-lazy ui-icon-calendar-sm",menuId:"mm-date-menu"},{id:"docSeqNumberFieldItem",label:J.i18n("writer.common.DOCUMENT_SEQUENCE"),name:J.i18n("writer.common.DOCUMENT_SEQUENCE"),icon:"ui-sprit-lazy ui-icon-autonum-sm"},{id:"docNameFieldItem",label:J.i18n("writer.common.MERGED_DOCUMENT_NAME"),name:J.i18n("writer.common.MERGED_DOCUMENT_NAME"),icon:"ui-sprit-lazy ui-icon-doc-name-sm",appData:{action:"MMFieldZMenuHandler.insertAutoFields",params:{fieldInfo:{},type:"document_name"}}},{id:"docSharedLinkItem",label:J.i18n("writer.common.MERGED_DOCUMENT_LINK"),name:J.i18n("writer.common.MERGED_DOCUMENT_LINK"),icon:"ui-sprit-lazy ui-icon-merge-public-doc-sm",menuItems:[{id:"docSharedLinkItemAsUrlItem",label:J.i18n("writer.common.SHARED_LINK_PUBLIC_URL"),name:J.i18n("writer.common.SHARED_LINK_PUBLIC_URL"),icon:"ui-sprit-lazy ui-icon-text-link-sm",appData:{action:"MMFieldZMenuHandler.insertAutoFields",params:{fieldInfo:{},type:"document_shared_link"}}},{id:"docSharedLinkItemAsQRCodeItem",label:J.i18n("writer.common.SHARED_LINK_PUBLIC_QRCODE"),name:J.i18n("writer.common.SHARED_LINK_PUBLIC_QRCODE"),icon:"ui-sprit-lazy ui-icon-qrcode-sm",appData:{action:"MMFieldZMenuHandler.insertAutoFields",params:{fieldInfo:{},type:"document_shared_link_qrcode"}}}]},{id:"fillDocNameFieldItem",label:J.i18n("writer.common.FILLED_DOCUMENT_NAME"),name:J.i18n("writer.common.FILLED_DOCUMENT_NAME"),icon:"ui-sprit-lazy ui-icon-doc-name-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_name"}}},{id:"fillDocSharedLinkItem",label:J.i18n("writer.common.FILLED_DOCUMENT_LINK"),name:J.i18n("writer.common.FILLED_DOCUMENT_LINK"),icon:"ui-sprit-lazy ui-icon-merge-public-doc-sm",menuItems:[{id:"fillDocSharedLinkItemAsUrlItem",label:J.i18n("writer.common.SHARED_LINK_PUBLIC_URL"),name:J.i18n("writer.common.SHARED_LINK_PUBLIC_URL"),icon:"ui-sprit-lazy ui-icon-text-link-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_shared_link"}}},{id:"fillDocSharedLinkItemAsQRCodeItem",label:J.i18n("writer.common.SHARED_LINK_PUBLIC_QRCODE"),name:J.i18n("writer.common.SHARED_LINK_PUBLIC_QRCODE"),icon:"ui-sprit-lazy ui-icon-qrcode-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_shared_link_qrcode"}}}]},{id:"prefillDocSharedLinkItem",label:J.i18n("writer.common.PRE_FILLED_DOCUMENT_LINK"),name:J.i18n("writer.common.PRE_FILLED_DOCUMENT_LINK"),icon:"ui-sprit-lazy ui-icon-merge-public-doc-sm",menuItems:[{id:"prefillDocSharedOrgLinkItemAsUrlItem",label:J.i18n("writer.common.SHARED_LINK_ORG_URL"),name:J.i18n("writer.common.SHARED_LINK_ORG_URL"),icon:"ui-sprit-lazy ui-icon-text-link-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_org_shared_link"}}},{id:"prefillDocSharedOrgLinkItemAsQRCodeItem",label:J.i18n("writer.common.SHARED_LINK_ORG_QRCODE"),name:J.i18n("writer.common.SHARED_LINK_ORG_QRCODE"),icon:"ui-sprit-lazy ui-icon-qrcode-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_org_shared_link_qrcode"}}},{id:"prefillDocSharedWebLinkItemAsUrlItem",label:J.i18n("writer.common.SHARED_LINK_PUBLIC_URL"),name:J.i18n("writer.common.SHARED_LINK_PUBLIC_URL"),icon:"ui-sprit-lazy ui-icon-text-link-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_shared_link"}}},{id:"prefillDocSharedWebLinkItemAsQRCodeItem",label:J.i18n("writer.common.SHARED_LINK_PUBLIC_QRCODE"),name:J.i18n("writer.common.SHARED_LINK_PUBLIC_QRCODE"),icon:"ui-sprit-lazy ui-icon-qrcode-sm",appData:{action:"FillAutomationHandler.insertAutoFieldsFromFFZmenuPopup",params:{fieldInfo:{},type:"document_shared_link_qrcode"}}}]}]},_=function(){var e=J("#mm-date-picker");e.zdatetimepicker(),e.zdatetimepicker({type:"inline",title:"Pick a Date",changeMonth:!0,changeYear:!0,format:"DD/MM/YY",value:(new ZWDateTime).customFormat("DD/MM/YY")}),e.off("zdatetimepickerdateselect").on("zdatetimepickerdateselect",function(e,t){g=!0;var i=new ZWDateTime(t.value).customFormat("DD/MM/YY");z({data:u,text:i,type:AUTOFIELD_TYPE.AUTO_DATE})})},A=function(e){for(var t=[],i=0;i<T.length;i++){var n=ZWJSONUtils.clone(T[i]);if("dateFieldItem"==n.id){if(!e.listDateFields)continue}else if("docSeqNumberFieldItem"==n.id){if(!e.listSequenceFields)continue;n.menuItems=S(e)}else if("docNameFieldItem"==n.id){if(!e.listDocumentInfo)continue}else if("docSharedLinkItem"==n.id){if(!e.listDocumentInfo)continue;for(var o=n.menuItems||[],r=0;r<o.length;r++){var a=o[r],s=a.appData;if(s&&s.params){var l=s.params;l.data=e}}}else if("fillDocNameFieldItem"==n.id){if(!e.listFillDocumentInfo)continue}else if("fillDocSharedLinkItem"==n.id){if(!e.listFillDocumentInfo)continue;for(var o=n.menuItems||[],r=0;r<o.length;r++){var a=o[r],s=a.appData;if(s&&s.params){var l=s.params;l.data=e}}}else if("prefillDocSharedLinkItem"==n.id){if(!e.listPreFillDocumentInfo)continue;for(var o=n.menuItems||[],r=0;r<o.length;r++){var a=o[r],s=a.appData;if(s&&s.params){var l=s.params;l.data=e}}}var s=n.appData;if(s&&s.params){var l=s.params;l.data=e}t.push(n)}return t},S=function(e){var t=[],i=PrepareDocumentHandler.getSequenceNumbers();for(var n in i){var o=i[n],r=o.name,a={id:r,label:r,value:r,appData:{action:"MMFieldZMenuHandler.insertAutoFields",params:{data:e,fieldInfo:o,type:AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER}}};t.push(a)}t.push({itemType:"separator"});var s=function(t){z({data:e,fieldInfo:t,type:AUTOFIELD_TYPE.DOC_SEQUENCE_NUMBER})},a={label:J.i18n("writer.common.CREATE_DOCUMENT_SEQUENCE"),value:J.i18n("writer.common.CREATE_DOCUMENT_SEQUENCE"),icon:"ui-sprit-lazy ui-icon-insert-date-sm",appData:{action:"DocSequenceDlgHandler.open",params:{action:"createNew",callback:s}}};return t.push(a),t},R=function(e,t){return!E.contains(t)&&E.push(t),{id:t,itemType:"custom",innerHTML:"<div class='zmenu__text'>"+e+"</div>",className:"ui-custom-menuitem zmenu-ttl-with-line",isHeader:!0}},O=function(e){if(e.options){var t=m[e.options]||{};for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}J.dialogutil.isDialogOpened("mergefieldsettingsdlg")&&(e.showCreateFieldBtn=!1,e.showManageFieldBtn=!1,e.listSequenceFields=!1,e.listDateFields=!1),J.dialogutil.isDialogOpened("documentsequencedialog")&&(e.listSequenceFields=!1)},b=function(e,t){e.isMergeOperation?(t.find(".js-ff-menu").hide(),t.find(".js-mf-menu").show()):e.isFillableJob?(t.find(".js-mf-menu").hide(),t.find(".js-ff-menu").show(),MailMergeDataModel.isDataAvailable()&&(t.find(".js-mf-menu").show(),t.find(".js-ff-menu").hide())):e.isSignJob&&(t.find(".js-mf-menu").hide(),t.find(".js-ff-menu").hide())},v=function(e,i){p||h(),t.zpopover("close");var n=i.forElement,o=JSON.parse(n.attr("mm-zmenu-data"));o.target=J(o.target),o.isSubMenu&&(o.JfieldElem=e.target),D(o)},D=function(t){O(t),u=t,p||h();var i=t.menuId?J("#"+t.menuId):t.JfieldElem||e;i.zmenu(),i.zmenu("removeAllMenuItems");var n=[];if((t.listSequenceFields||t.listDateFields)&&!t.fieldTypes){var o=A(t);n=n.concat(o)}if(t.listMergeFields){n.length&&n.push({itemType:"separator"});var r=L(t);if(0==r.length&&r.push(a),t.showCreateFieldBtn&&r.push(s),t.showManageFieldBtn&&r.push(l),t.customHeading?r.unshift(R(t.customHeading,"mf-custom-heading")):t.dataSourceFieldsOnly&&r.unshift(R(J.i18n("writer.fields.DATA_SOURCE_FIELDS"),"mf-datasource-heading")),t.listFillableFields){var d={id:"mergeFieldMainMenu",label:J.i18n("writer.common.MERGE_FIELDS"),name:J.i18n("writer.common.MERGE_FIELDS"),menuItems:r};n.push(d)}else r.unshift(R(J.i18n("writer.common.MERGE_FIELDS"),"mf-heading")),n=n.concat(r)}if(t.listFillableFields){if(t.listSubmitterEmail){n.length&&n.push({itemType:"separator"});var c=FillAutomationHandler.getSubmitterEmailMenu(t);n.push(c)}n.length&&n.push({itemType:"separator"});var g=FillAutomationHandler.getFillableFieldsMenu(t);if(t.listMergeFields){var f={id:"fillableFieldMainMenu",label:J.i18n("writer.common.FILLABLE_FIELDS"),name:J.i18n("writer.common.FILLABLE_FIELDS"),menuItems:g};n.push(f)}else g.unshift(R(J.i18n("writer.common.MERGE_FIELDS"),"ff-heading")),n=n.concat(g)}i.zmenu("addMenuItems",n),i.unbind("zmenubeforehide").bind("zmenubeforehide",y),i.unbind("zmenuhide").bind("zmenuhide",F),i.unbind("zmenuitemclick").bind("zmenuitemclick",function(e,i){if(UIUtils._itemClicked(e,i),t.insertCallback){var n=Utils.getAsFunction(t.insertCallback).fn;n(e,i)}}),i.unbind("zmenubeforesubmenushow").bind("zmenubeforesubmenushow",function(e,i){if(UIUtils._itemClicked(e,i),t.submenuShowCallback){var n=Utils.getAsFunction(t.submenuShowCallback).fn;n(e,i)}}),i.unbind("zmenubeforesubmenuhide").bind("zmenubeforesubmenuhide",y),i.unbind("zmenusubmenuitemclick").bind("zmenusubmenuitemclick",function(e,i){if(UIUtils._itemClicked(e,i),t.insertCallback){var n=Utils.getAsFunction(t.insertCallback).fn;n(e,i)}var o=(i.data||{}).id||"";if(o.includes("-field-menu"))return!1})},L=function(e){if(e.getDynamicInfos){var t=Utils.getAsFunction(e.getDynamicInfos).fn,i=t(e);ZWJSONUtils.mergeJsonObjs(e,i),e.repeatInfo&&(e.listRepeatFields=!0)}if(e.getFields){var n=Utils.getAsFunction(e.getFields).fn;e.fields=n(e)}var o=[],r=e.fields;if(!r){var a={};if(a=MailMergeFieldUIUtil.getFields(e.listRepeatFields,e.repeatInfo,{excludeMainFields:e.excludeMainFields,dataSourceFieldsOnly:e.dataSourceFieldsOnly}),a.promise){o.push(d);var s=a.promise;s.done(function(t){e.fields=t,D(e)}),r=[]}else r=a.fields}return r=C(e,r),r.length&&(o=o.concat(N(r))),o},N=function(e){var t=[],i=J("<div>");MailMergeUiUtils.listFields({container:i,withIcon:!0,readOnly:!0,skipPadding:!0,onclick:"MMFieldZMenuHandler.insertMergeField",fields:e});var n=i.find(".js-mf-group-cont");if(n.length){for(var o=0;o<n.length;o++){var r=n[o],a=r.id,s=J(r),l=s.find(".js-group-label"),d=l.text();l.remove();var c=P({id:a,html:r.outerHTML,count:s.find(".js-create-mfield").length}),u={id:a,label:d,name:d,menuItems:[c]};t.push(u)}n.remove();var p=i.find(".js-create-mfield");if(p.length){var d=J.i18n("writer.mailmergepopup.CUSTOM_FIELDS"),a="customFields",c=P({id:a,html:i[0].outerHTML,count:p.length}),u={id:a,label:d,name:d,menuItems:[c]};t.push(u)}}else t.push(P({html:i.html(),count:i.find(".js-create-mfield").length}));return t},P=function(e){c||(c=Handlebars.compile(Z("mm-fieldwithsearch-grp-template").html()));var t=e.id||"mailmerge",i=t+"-fields",n=c({mmfield_cont_id:i,mmfield_serach_id:"#"+i,fields:e.html,fieldsCount:e.count});return{id:t+"-field-menu",itemType:"custom",innerHTML:n,className:"ui-custom-menuitem clearfix"}},C=function(e,t){if(e.dataSourceFieldsOnly&&!e.listRepeatFields){var i=MailMergeFieldUtil.getDataSourceFields();t=e.listRepeatFields?t.concat(i):i}var n=e.fieldTypes;return n&&(t=MailMergeFieldUtil.getFieldsWithType(n,t)),t},y=function(e,t){var i=(t.data||{}).id||"";if(E.contains(i)||i.includes("-field-menu"))return!1;if("manageFieldItem"==i)PubSub.publish("MailMerge/LoadLazyFiles",{action:"MMFieldSettingsDlgHandler.open",info:{from:"insertmergefield"}});else if(!i&&J(":focus").hasClass("js-mm-field-search"))return!1},F=function(e,t){var i=(t.data||{}).id;"creatFieldItem"==i&&M(t.forElement,t.menu.data("direction"))},M=function(e,i){ZWComponentUtil.init("mm-cfpopup");var n={target:e,position:i};t.zpopover("setAttribute","position",i);var o=Handlebars.compile(Z("mm-cf-content").html());t.zpopover("setAttribute","content",o()),t.zpopover("open",n),w(n)},w=function(e){i=J("#mm-cf-popover-content"),ZWComponentUtil.initElem(i),n=i.find("#mm-cf-popover-fname"),o=i.find("#mm-cf-popover-btn"),r=i.find("#mm-cf-pop-validation-errormsg"),k(),o.off("click").on("click",function(){U()&&(x(),PubSub.publish("MailMerge/LoadLazyFiles",{action:"MMFieldZMenuHandler.createField",info:e}))}),n.off("keyup").on("keyup",function(e){var t=e.keyCode?e.keyCode:e.which;"13"==t&&o.click(),J(this).removeClass("ui-error-placeholder-msg"),r.hide()})},U=function(){var e=n.val()||"";return e.trim()?MailMergeFieldUtil.FIELDNAME_SPECIALCHAR_REGEX.test(e)?(n.focus(),r.text(J.i18n("writer.fields.FIELD_NAME_CONTAINS_SPECIAL_CHARS",[MailMergeFieldUtil.EXCLUDED_SPECIALCHARS])).show(),!1):!H(e)||(n.focus(),r.text(J.i18n("writer.fields.FIELD_NAME_ALREADY_IN_USE")).show(),!1):(n.addClass("ui-error-placeholder-msg"),n.attr("placeholder",J.i18n("writer.fields.FIELD_NAME_MANDATORY")),n.focus(),n.val(""),!1)},x=function(){n.disable(),o.disable(),o.text(J.i18n("writer.common.CREATING"))},B=function(e){var t=n.val()||"",i={};i[MAILMERGE.FIELD_NAME]=t,i[MAILMERGE.FIELD_ID]=MailMergeUtil.removeSpecialChars(t),i[MAILMERGE.F_ID]=i[MAILMERGE.FIELD_ID],i[MAILMERGE.CATEGORY]=MAILMERGE.CATEGORIES.CREATED,i[MAILMERGE.TYPE]=MAILMERGE.FIELD_TYPE.TEXT;var o=function(){G(e)},r={};r.field=JSON.stringify(i),MailMerge.createFields(o,o,r)},H=function(e){for(var t=MailMergeFieldUtil.getCustomFields(),i=0;i<t.length;i++){var n=t[i],o=n[MAILMERGE.FIELD_NAME];if(e==o)return!0}return!1},G=function(t){e.zmenu("show",{target:t.target,direction:t.position})},k=function(){n.enable(),n.val(""),n.removeClass("ui-error-placeholder-msg"),n.focus(),o.enable(),o.text(J.i18n("writer.common.CREATE"))},W=function(e,t){if(t.listRepeatFields||t.getFields)for(var i=e.find("div[data-menu-id='mm-fieldmenu']"),n=0;n<i.length;n++){var o=J(i[n]),r=JSON.parse(o.attr("mm-zmenu-data")||"{}");t.listRepeatFields&&(r.listRepeatFields=!0),t.getFields&&(r.getFields=t.getFields),o.attr("mm-zmenu-data",JSON.stringify(r))}},Y=function(t){var i={element:u.target[0],fieldInfo:t,singleField:u.singleField},n=u.callback?Utils.getAsFunction(u.callback).fn:MailMergeUiUtils.insertFieldInText;n(i),e.zmenu("hide")},z=function(e){var t=e.data,i={element:t.target[0],fieldInfo:e.fieldInfo,text:e.text,singleField:t.singleField,type:e.type},n=t.callback?Utils.getAsFunction(t.callback).fn:MailMergeUiUtils.insertFieldInText;n(i)},V=function(e){z({data:u,fieldInfo:e,type:AUTOFIELD_TYPE.AUTO_DATE})},j=function(){var e,t,i,n="insertdateformatdlg",o={init:function(){e=J("#insertdateformatdlg"),t=e.find("#date-dlg-format"),e.find("#mm-date-example").text((new ZWDateTime).customFormat("DD MMM YYYY")),i=J("#date-dlg-insert"),i.off("click").on("click",function(){e.zvalidation("validateAllFields",e)&&(V({FORMAT:t.val()}),J.dialogutil.close(n))}),t.click()}};J.dialogutil.open(n,void 0,o)},X=function(){g=!1;var e=J("#mm-date-picker");e.zdatetimepicker("open")},K=function(){return!!g&&void J("#mm-date-picker").zdatetimepicker("close")};window.MMFieldZMenuHandler={handleZMenuInDlg:b,populateFields:v,createField:B,updateAllZMenuInfo:W,insertMergeField:Y,insertAutoFields:z,insertDateField:V,openDateDlg:j,beforeShowDatePickerMenu:X,beforeHideDatePickerMenu:K}}(),function(){"use strict";var e=function(e,i,n){var o={};n=n||{};var r=MailMergeFieldUtil.getFields();if(n.dataSourceFieldsOnly&&(r=MailMergeFieldUtil.getDataSourceFields()),e){if(!i){var a=editor.doc.getSelection().getStart();i=t(a)}if(i&&"main_fields"!=(i.info||{}).type){var s=i.info,l=MailMergeFieldUtil.getFieldId(s),d=MailMergeFieldUtil.getRLFields(l);if(n.dataSourceFieldsOnly&&(d=MailMergeFieldUtil.getDataSourceRLFields(l)),d&&d.length)r=n.excludeMainFields?d:d.concat(r);else if(MailMergeDataModel.isDynamicFetch()){var c=new Deferred,u=function(){var e=MailMergeFieldUtil.getRLFields(l);n.dataSourceFieldsOnly&&(e=MailMergeFieldUtil.getDataSourceRLFields(l)),r=n.excludeMainFields?e:e.concat(r),c.resolve(r)},p=function(){c.reject()};MMRelatedListHandler.getRLFields(s,u,p),o.promise=c.promise()}}}return o.fields=r,o},t=function(e){if(!MailMergeRepeatView.isRepeatRendered())return null;for(var t=DocTreeManager.getParents(NODE_TYPE.CELL,e);null!=t;){var i=t.format;if(MailMergeRepeatUtil.isCellRepeat(i)&&0==t.getChildIndex()){var n=MMRepeatFieldUtil.getRepeatInfo(i);return{start:t.getIndex(),end:t.getEndIndex(),info:n,type:NODE_TYPE.CELL,id:i.id,rowIdx:0,columnIdx:0}}var o=DocTreeManager.getParents(NODE_TYPE.ROW,t.getIndex()),r=o.format;if(MailMergeRepeatUtil.isRowRepeat(r)){var n=MMRepeatFieldUtil.getRepeatInfo(r);return{start:o.getIndex(),end:o.getEndIndex(),info:n,type:NODE_TYPE.ROW,id:r.id,rowIdx:o.getChildIndex()}}var a=DocTreeManager.getParents(NODE_TYPE.TABLE,t.getIndex()),s=a.format;if(MailMergeRepeatUtil.isColumnRepeat(s)){var l=MailMergeRepeatUtil.getRepeatColumnIdx(s);if(t.getChildIndex()==l){var n=MMRepeatFieldUtil.getRepeatInfo(s);return{start:a.getIndex(),end:a.getEndIndex(),info:n,type:"column",id:s.id,columnIdx:l}}}t=DocTreeManager.getParents(NODE_TYPE.CELL,a.getIndex()-1)}return MailMergeRepeatView.isRepeatPresentInPara(e)?MailMergeRepeatUtil.getParaRangeInfo(e):null};window.MailMergeFieldUIUtil={getFields:e,getRepeatRangeInfo:t}}(),function(){"use strict";var e=function(e){MailMergeSubFieldsUI.closePopup();var n={init:function(){var n=t;if("update"==e){J("#cellrepeatdlgzdialog").zdialog("setAttributes",{title:J.i18n("writer.table.EDIT_CELLS")});var o=DocTreeManager.getParents(NODE_TYPE.TABLE,editor.doc.getSelection()[0].start),r=o.format,a=r.cols,s=a.length;J("#mm-column-count").znumberfield("setValue",s),J("#mm-repeatcell-insert").zbutton("setAttribute","text",J.i18n("writer.common.UPDATE")),n=i}J("#mm-repeatcell-insert").on("click",function(){n()})}};DialogHandler.open("cellrepeatdlg",n)},t=function(){DialogHandler.close("cellrepeatdlg");var e=J("#mm-column-count").znumberfield("getValue");o("cellrepeat",e)},i=function(){DialogHandler.close("cellrepeatdlg");var e=J("#mm-column-count").znumberfield("getValue"),t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.TABLE),n=(i.dtNode,i.attr()),o=n.cols,r=o.length;if(r!=e)if(r<e)for(var a=r;a<e;a++)editor.doc.execCmd("inscolafter");else{for(var s=[],a=0;a<r-e;a++)s.push(e+a);editor.doc.execCmd("delcolumns",[i,s])}},n=function(e){var t="Recommendation",i="<b>Repeat as column</b> is recommended for less than 6 records due to horizontal space limitation.",n=[J.i18n("writer.common.CONTINUE"),"Repeat as rows",J.i18n("writer.common.CANCEL")];MsgDialog.showMessage(n,CONST.SEVERITY_WARNING,t,i,void 0,void 0,function(e){switch(e){case CONST.BUTTON_1_CLICKED:o("columnrepeat");break;case CONST.BUTTON_2_CLICKED:o("rowrepeat");break;case CONST.BUTTON_3_CLICKED:}},!0,!0)},o=function(e,t){ZWLogger.addToStatistics("Mail_Merge.addRlTable"),MailMergeSubFieldsUI.closePopup();var i=MailMergeSubFieldsUI.getFieldsType(),n=MailMergeSubFieldsUI.getSelectedRepeatInfo(),o=MailMergeSubFieldsUI.getSelectedFields();i==MailMergeSubFieldsUI.FIELDS_TYPE.SUB_FIELDS&&r(n,o)||editor.doc.execCmd(e,[n,o,t])},r=function(e,t){var i=J.i18n("writer.error.OOPS");if(MailMergeDataModel.getRLTableLimit()&&MMRelatedListHandler.getInsertedRLTablesCount()>=MailMergeDataModel.getRLTableLimit()){var n=J.i18n("writer.mailmergepopup.MAX_RL_TABLES_INSERTED",[MailMergeDataModel.getRLTableLimit()]);return MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ALERT,i,n,void 0,void 0),!0}return!t.length},a=function(){s(!0)},s=function(e){var t=editor.doc.getSelection().getStart(),i=MailMergeFieldUIUtil.getRepeatRangeInfo(t),n=MMDataFilterDlgHandler.getFilterData(),o=i.start,r=editor.doc.getRawFormatAt(o);if(i.type==NODE_TYPE.PARA){var a=r.mminfo;a.filter_data=n,e&&delete a.filter_data}else{var s=DocTreeManager.getParents(NODE_TYPE.TABLE,t);if(i.type==NODE_TYPE.ROW){var l=s.children[i.rowIdx];o=l.getIndex(),r=l.format;var a=r.mminfo;a.filter_data=n,e&&delete a.filter_data}else if("column"==i.type){o=s.getIndex(),r=s.format;var d=r.cols,c=d[i.columnIdx],a=c.mminfo;a.filter_data=n,e&&delete a.filter_data}else if(i.type==NODE_TYPE.CELL){var l=s.children[0],u=l.children[0];o=u.getIndex(),r=u.format;var a=r.mminfo;a.filter_data=n,e&&delete a.filter_data}}var p=Utils.randomString(),g=[{r:o},{as:{start:r,id:p}},{r:1},{as:{end:ZWJSONUtils.getKeys(r),id:p}}];Op.processMsg(g),Op.sendMsg(),MMDataFilterDlgHandler.close()},l=function(){var e=MailMergeFieldUIUtil.getRepeatRangeInfo(editor.doc.getSelection().getStart()),t=e.info,i=t.filter_data||{},n={defaultValue:i,submit:s,reset:a};if("main_fields"!=t.type&&(MailMergeDataModel.getSource()==MAILMERGE.SOURCE.ZOHO_CRM||MailMergeDataModel.getSource()==MAILMERGE.SOURCE.ZOHO_CRM_INWRITER)){var o=100;n.maxRange=o,n.range_note={key:"writer.mailmergepopup.FILTER_REPEAT_RECORD_WITH_RANGE_NOTE",args:[o,editorProps.deployment.zohocrm]},n.condition_note={key:"writer.mailmergepopup.FILTER_REPEAT_RECORD_WITH_CONDITION_NOTE",args:[o,editorProps.deployment.zohocrm]}}ConditionsDlg.setFieldType(NODE_TYPE.MAILMERGEFIELD),MMDataFilterDlgHandler.open(n)},d=function(e){try{if(MailMergeUtil.isPreviewMode())return;var t=e.parent||DocTreeManager.getParents(NODE_TYPE.TABLE,editor.doc.getSelection()[0].start);if(!MailMergeRepeatUtil.isColumnRepeat(t)&&!MailMergeRepeatUtil.isCellRepeatPresent(t))for(var i=DocLayoutManager.getViews(t)||[],n=0;n<i.length;n++){var o=DomViewManager.getDOMElem(i[n]);if(o){var r=J(o);r.find(".mmrepeatrange-bdr-highlight").removeClass("mmrepeatrange-bdr-highlight"),r.find(".mmrepeatrange-bdr-highlight-bottom").removeClass("mmrepeatrange-bdr-highlight-bottom"),r.find(".mmrepeatrange-bdr-highlight-right").removeClass("mmrepeatrange-bdr-highlight-right"),r.find(".mmrepeatrange-bdr").removeClass("mmrepeatrange-bdr"),r.find(".mmrepeatrange-bdr-bottom").removeClass("mmrepeatrange-bdr-bottom"),r.find(".mmrepeatrange-bdr-right").removeClass("mmrepeatrange-bdr-right")}}if(MailMergeRepeatUtil.isRowRepeatPresent(t))for(var a=MailMergeRepeatUtil.getRepeatRowIdx(t),s=t.children[a],l=s.children,n=0;n<l.length;n++)MailMergeRepeatView.addCellBorder(l[n])}catch(e){}},c=function(e){try{if(MailMergeUtil.isPreviewMode())return;var t=e.parent?e.parent.parent:DocTreeManager.getParents(NODE_TYPE.TABLE,editor.doc.getSelection()[0].start);if(!MailMergeRepeatUtil.isRowRepeatPresent(t)&&!MailMergeRepeatUtil.isCellRepeatPresent(t))for(var i=DocLayoutManager.getViews(t)||[],n=0;n<i.length;n++){var o=DomViewManager.getDOMElem(i[n]);if(o){var r=J(o);r.find(".mmrepeatrange-bdr-highlight").removeClass("mmrepeatrange-bdr-highlight"),r.find(".mmrepeatrange-bdr-highlight-bottom").removeClass("mmrepeatrange-bdr-highlight-bottom"),r.find(".mmrepeatrange-bdr-highlight-right").removeClass("mmrepeatrange-bdr-highlight-right"),r.find(".mmrepeatrange-bdr").removeClass("mmrepeatrange-bdr"),r.find(".mmrepeatrange-bdr-bottom").removeClass("mmrepeatrange-bdr-bottom"),r.find(".mmrepeatrange-bdr-right").removeClass("mmrepeatrange-bdr-right")}}if(MailMergeRepeatUtil.isColumnRepeat(t.format))for(var a=MailMergeRepeatUtil.getRepeatColumnInfo(t.format),s=a.start,l=t.children,n=0;n<l.length;n++){var d=l[n],c=d.children[s];MailMergeRepeatView.addCellBorder(c)}}catch(e){}},u=function(){PubSub.subscribe(DOMVIEW.ROWVIEW_AFTER_CREATE,d,{async:!0,timeout:100}),PubSub.subscribe(DOMVIEW.ROWVIEW_BEFORE_REMOVE,d,{async:!0,timeout:100}),PubSub.subscribe(DOMVIEW.CELLVIEW_AFTER_CREATE,c,{async:!0,timeout:100}),PubSub.subscribe(DOMVIEW.CELLVIEW_BEFORE_REMOVE,c,{async:!0,timeout:100})};PubSub.subscribe("Document/AfterInit",u),window.MailMergeRepeatUI={openCellRepeatDlg:e,openColumnRepeatDlg:n,addRepeatRange:o,openFilterDlg:l}}(),function(){"use strict";var e,t,i,n=3,o=3,r=0,a=0,s={folderId:-1,folderName:""},l={},d=function(e){l=e||{},r=0,a=0,i=void 0,n=l.uniqueAttachmentLimit||3,o=l.commonAttachmentLimit||3,t=l.callback},c=function(e){for(var t=0;t<o;t++){var i=J("#mm-common-attachment-"+t);i[0]&&i[0].files&&i[0].files.length&&(e["cattachment"+t]=i)}},u=function(){for(var e=[],t=J(".js-mm-ca-cloud-file"),i=0;i<t.length;i++){var n=J(t[i]).data().info;e.push(n)}return e},p=function(){for(var e=[],t=0;t<n;t++){var i=J("#mm-email-ua-"+t).attr("info");i&&e.push(i)}return e},g={init:function(){s={folderId:editor.doc.docInfo.PARENT_ID,folderName:""},e=MailMergeJobInfo.MMUniqueAttachmentType.COLUMN,MailMergeUiUtils.populateFieldsInDropdown({element:J("#mm-email-ua-column")}),l.hideFolderComponent?J("#mm-ua-pickfrom-cont").hide():(MailMergeUiUtils.populateFieldsInDropdown({element:J("#mm-email-ua-zdocs-column")}),Utils.initFolderChooser({container_id:"mm-email-ua-folder",calbackFn:f}))}},f=function(e){s.folderId=e.folderId,s.folderName=e.parentFolder},E=function(){if(r>=n){var e=J.i18n("writer.error.OOPS"),t=J.i18n("writer.mailmergepopup.UA_LIMIT_MSG",[n]);return void MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,e,t,void 0,void 0,void 0)}J.dialogutil.open("mailmerge_uniqueattachmentdlg",void 0,g)},T=function(){e=MailMergeJobInfo.MMUniqueAttachmentType.COLUMN,J("#mm-email-ua-column-cont").show(),J("#mm-email-ua-zdocs-cont").hide(),J("#mm-email-ua-type").zmenubutton("setAttribute","text",J.i18n("writer.mailmergepopup.U1_TEXT"))},m=function(){e=MailMergeJobInfo.MMUniqueAttachmentType.ZOHODOCS,J("#mm-email-ua-column-cont").hide(),J("#mm-email-ua-zdocs-cont").show(),J("#mm-email-ua-type").zmenubutton("setAttribute","text",J.i18n("writer.mailmergepopup.U2_TEXT"))},h=function(){var t={};t.id=Utils.randomString(),t.type=e;var i={};if(e==MailMergeJobInfo.MMUniqueAttachmentType.COLUMN){var n=J("#mm-email-ua-column").val(),o=MailMergeFieldUtil.getFieldInfo(n),r=J("#mm-email-ua-name").val()||MailMergeFieldUtil.getDisplayName(o);t.name=r,t.field_id=n,i[n]=o}else{var n=J("#mm-email-ua-zdocs-column").val(),o=MailMergeFieldUtil.getFieldInfo(n);t.field_id=n;var a=J("#mm-email-ua-operator").val();t.operator=a,t.folder_id=s.folderId;var l=s.folderName;t.folderName=l,i[n]=o}I(t,i),J.dialogutil.close("mailmerge_uniqueattachmentdlg")},I=function(e,i){i=i||{};var n=J("#mm-email-unique-attach").html(),o={},a=e.field_id,s=i[a]||MailMergeFieldUtil.getNewFieldInfo(a),l=MailMergeFieldUtil.getFullFieldName(s),d="<span class='ui-semibold js-mm-uattach-cname'></span>",c=MailMergeDataModel.getFileName(),u=e.folderName,p=e.operator,g=e.type,f="";if(g==MailMergeJobInfo.MMUniqueAttachmentType.COLUMN){var E="<span class='ui-semibold js-mm-uattach-filename'></span>";f=J.i18n("writer.mailmergepopup.UATTACHMENT_IN_COLUMN_MSG",[d,E])}else{var T="<span class='ui-semibold js-mm-uattach-foldername'></span>";f=MailMergeJobInfo.MMUniqueAttachmentOperator.START_WITH==p?J.i18n("writer.mailmergepopup.UATTACHMENT_START_WITH_MSG",[d,T]):MailMergeJobInfo.MMUniqueAttachmentOperator.CONTAINS==p?J.i18n("writer.mailmergepopup.UATTACHMENT_CONTAINS_MSG",[d,T]):MailMergeJobInfo.MMUniqueAttachmentOperator.END_WITH==p?J.i18n("writer.mailmergepopup.UATTACHMENT_END_WITH_MSG",[d,T]):J.i18n("writer.mailmergepopup.UATTACHMENT_IS_MSG",[d,T])}var m=Handlebars.compile(n);o.attachmentInfo=JSON.stringify(e),o.attachmentNo=r;var h=J(m(o));h.find(".js-mm-uattach-msg").html(f),h.find(".js-mm-uattach-cname").text(l),h.find(".js-mm-uattach-foldername").text(u),h.find(".js-mm-uattach-filename").text(c),J("#mm-email-attachments").append(h[0]),r++,D(),t&&t()},_=function(e){a=0;for(var i=0,n=0;n<o;n++){var r=J("#mm-common-attachment-"+n);r[0]?a++:i=n}if(a>=o){var s=J.i18n("writer.error.OOPS"),l=J.i18n("writer.mailmergepopup.CA_LIMIT_MSG",[o]);return void MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,s,l,void 0,void 0,void 0)}var d=J("#mm-email-common-attach").html(),c=Handlebars.compile(d),u={};u.attachmentNo=i;var p=".docx,.doc,.odt,.rtf,.pdf,.html,.epub,.txt,.png,.jpg,.jpeg,.gif,.ics,.ical,.ifb,.icalendar";SignDlgHandler.isDialogOpened()&&(p=".doc,.docx,.htm,.html,.jpeg,.jpg,.ods,.odt,.pdf,.png,.rtf,.sxw,.xls,.xlsx,.txt"),u.extn=p,u.extnForUi=p.replaceAll(",.",", .");var g=J(c(u));return"baihui"==editorProps.deployment.customername&&g.find("#mm-email-upload-from-cloud").remove(),e?J(g).insertAfter(J(e)):J("#mm-email-attachments").append(g),a++,D(),t&&t(),g},A=function(e){var t=J(e.target).siblings(".js-mm-common-attachment");t.off().on("change",function(){b(this)}),t.click()},S=function(e){i=e.target;var t=o-a;t+=J("#mm-email-attachments").find(".js-mm-email-ca-cloudpicker:visible").length,MMCloudPicker.openCloudPickerDialog(t)},R=function(e){CloudPicker.closeCloudPickerDialog();for(var t=0;t<e.length;t++){var n=e[t],o=n.cloudpicker_docname||n.name,r=J("#mm-email-attachments").find(".js-mm-email-ca-cloudpicker:visible");if(r.length)i=r[0];else{var a=void 0;i&&(a=J(i).parents(".js-mm-cattach-cont")),i=_(a).find(".js-mm-email-ca-cloudpicker")}J(i).addClass("js-mm-ca-cloud-file"),J(i).data({info:JSON.stringify(n)}),b(i,o)}},O=function(e){return e.slice(e.lastIndexOf("\\")+1)},b=function(e,t){t=t?t:e.value;var t=O(t),i=J(e).parents(".js-mm-cattach-cont"),n=i.find(".js-mm-email-ca-msg");n.html(J.i18n("writer.mailmergepopup.CATTACHMENT_MSG",["<span class='ui-semibold js-mm-uattach-filename'></span>"])),n.find(".js-mm-uattach-filename").text(t),i.find(".js-mm-email-ca-step1").hide(),i.find(".js-mm-email-ca-step2").show()},v=function(){CloudPicker.closeCloudPickerDialog()},D=function(){J("#mm-email-attachments").children().length?J("#mm-email-attachments").show():J("#mm-email-attachments").hide()},L=function(e,i){J(e).parents("li").remove(),"common"===i?a--:r--,D(),t&&t()};window.MailMergeOtherAttachments={initDlgVars:d,addCommonAttachmentFiles:c,getCommonCloudAttachmentsInfo:u,getUniqueAttachmentsInfo:p,openUniqueAttachmentDlg:E,showColumnAttachment:T,showZohoDocsAttachment:m,saveUniqueAttachmentInfo:h,addUniqueAttachmentCont:I,addCommonAttachmentCont:_,chooseCommonAttachment:A,openCloudPickerCommonAttachment:S,addCommonAttachmentInfos:R,cloudAttachmentFailed:v,removeAttachment:L}}(),function(){"use strict";var e=function(e,t,i){if(this.records=e||[],this.index=t||0,this.info=i||{},i){var n=MailMergeRecordUtil.getFieldMapping(),o=MailMergeFieldUtil.getFieldId(i);if(n[o]){var r=n[o]||{};this.field_mapping=r.field_mapping}}this.updateMainRecordIdx="main_records"==this.info.type||"main_fields"==this.info.type};e.prototype.getIndex=function(){return this.index},e.prototype.setIndex=function(e){this.updateMainRecordIdx&&MailMergeRecordUtil.setCurrentRecordIndex(e),this.index=e},e.prototype.getInfo=function(){return this.info},e.prototype.canUpdateMainRecordIdx=function(){return this.updateMainRecordIdx},e.prototype.nextRecord=function(){this.setIndex(this.index+1)},e.prototype.getRecordsLength=function(){return this.getRecords().length},e.prototype.isEmpty=function(){return!this.getRecordsLength()},e.prototype.isLastRecord=function(){return this.getRecordsLength()==this.getIndex()+1},e.prototype.hasNext=function(){return this.getIndex()<this.getRecords().length},e.prototype.getRecords=function(){return this.records},e.prototype.setRecords=function(e){return this.records=e},e.prototype.getParent=function(){return this.parent},e.prototype.setParent=function(e){return this.parent=e},e.prototype.getCurrentRecord=function(){return this.getRecords()[this.getIndex()]||{}},e.prototype.getCurrentMainRecord=function(){return this.getParent()?this.getParent().getCurrentMainRecord():this.getCurrentRecord()},e.prototype.getFieldValue=function(e,t,i){i=i||{record:this.getCurrentRecord()},t&&(i.type=t),this.field_mapping&&(i.field_mapping=this.field_mapping);var n=MailMergeFieldUtil.getFieldId(e)||"";if(n.indexOf("."+MAILMERGE.SEQUENCE)!=-1)return MailMergeRecordUtil.getFormatedValue(this.getIndex()+1,e,i);if(e.condition){var o=ConditionsEvaluator.evaluateForMailMerge(e.condition,this);return o.result?MAILMERGE.CHECK_BOX.CHECKED:MAILMERGE.CHECK_BOX.UNCHECKED}return MailMergeRecordUtil.getFieldValue(e,i)},e.prototype.getFormatedValue=function(e,t,i){return MailMergeRecordUtil.getFormatedValue(e,t,{type:i})},e.prototype.replaceFieldsInObject=function(e,t,i){return i=i||{},i.record=this.getCurrentRecord(),this.field_mapping&&(i.field_mapping=this.field_mapping),MailMergeRecordUtil.replaceFieldsInObject(e,t,i,this)},e.prototype.replaceFieldsInQRCode=function(e,t){return"url"==e.format?this.replaceFieldsInObject(e.values,t,{type:MAILMERGE.FIELD_TYPE.WEBSITE}):this.replaceFieldsInObject(e.values,t)},e.prototype.getImageListValue=function(e,t){var i=ZWJSONUtils.getKeys(t);if(1==i.length){var n=i[0],o=t[n],r=UNICODE.MERGEFIELD_START+n+UNICODE.MERGEFIELD_END,a={record:this.getCurrentRecord(),type:MAILMERGE.FIELD_TYPE.IMAGELIST};this.field_mapping&&(a.field_mapping=this.field_mapping);for(var s=MailMergeRecordUtil.getFieldValue(o,a),l=[],d=0;d<s.length;d++){var c=e.replaceAll(r,s[d]);c&&l.push(c)}e=l}else{var a={type:MAILMERGE.FIELD_TYPE.IMAGE};this.field_mapping&&(a.field_mapping=this.field_mapping),e=this.replaceFieldsInObject(e,t,a)}return e},e.prototype.getAllValuesForChart=function(e,t,i){for(var n={};this.hasNext();){for(var o=0;o<e.length;o++){var r=e[o],a=t[r],s=i?this.getCurrentRecord()[r]||"":this.getFieldValue(a);n[r]||(n[r]=[]),n[r].push(s)}this.nextRecord()}return n},e.prototype.getAllRecordsForChart=function(e,t){for(var i=[];this.hasNext();){for(var n={},o=0;o<e.length;o++){var r=e[o],a=t[r],s=this.getFieldValue(a);n[r]=s}i.push(n),this.nextRecord()}return i},window.MMDataBean=e}(),function(){"use strict";var e=!1,t=function(){return"MERGE_PDF_TEMPLATE"==editorProps.permissionsInfo.appInfo.document_type},i=function(){var e=editorProps.permissionsInfo.appInfo.NAME;return"MAILMERGE_LIBRARY"==e||"CRM_VERTICAL_MAILMERGE_LIBRARY"==e},n=function(){DocumentMap.refreshMap(),J("#documentPaneCombo").zselectbox("removeAllOptions"),J("#documentPaneCombo").zselectbox("addOption",{value:"field",label:J.i18n("writer.common.FIELDS")}),J("#documentPaneCombo").zselectbox("setValue","field"),DocumentMap.documentPaneComboChange("field")},o=function(){if(!J("#mf-highlight-style").length){for(var e=[".mergeField.zw-input-field",".mergeField.zw-checkbox-field"],t=".ui-active-bg-clr",i=e[0],n=e[0]+":hover",o=1;o<e.length;o++)i+=", "+e[o],n+=", "+e[o]+":hover";for(var o=0;o<e.length;o++)i+=", "+e[o]+t,n+=", "+e[o]+t+":hover";var i=".mergeField.zw-input-field, .mergeField.zw-checkbox-field, .mergeField.zw-input-field.ui-active-bg-clr, .mergeField.zw-checkbox-field.ui-active-bg-clr",r="<style id='mf-highlight-style' type='text/css'> "+i+" {background: #FFEED6 !important; box-shadow: inset -1px -1px 0 0 #ffe8c4, inset 1px 1px 0 0 #ffdead, inset -2px -2px 0 0 rgb(255 255 255 / 50%), inset 2px 2px 0 0 #ffe8c4 !important; } "+n+" {background: #FFEED6 !important; box-shadow: inset -1px -1px 0 0 #ffc05e, inset 1px 1px 0 0 #ffb647, inset -2px -2px 0 0 rgb(255 255 255 / 50%), inset 2px 2px 0 0 #ffe8c4 !important; }</style>";J("head").first().append(J(r))}},r=function(e,t){t.state?o():J("#mf-highlight-style").remove()},a=function(e){var t=s(e);0==t.length?TemplateUIHandler.handleAutoInsertFieldsDialog("empty"):(l(t),TemplateUIHandler.handleAutoInsertFieldsDialog("success",t.length))},s=function(e){for(var t=[],i={},n=0;n<e.length;n++)for(var o=e[n],r=0;r<o.length;r++){var a=o[r],s=a.top,l=a.left,d=a.width,c=a.height,u="TextField",p=MAILMERGE.FIELD_TYPE.TEXT;switch(a.type){case"checkbox":d=20,c=20,u="Checkbox",p=MAILMERGE.FIELD_TYPE.CHECKBOX;break;case"textbox":break;case"line":c=20,s-=c}var g={},f={};g.left=l,g.from="page",g.type="absolute",f.top=s,f.from="page",f.type="absolute";var E={};E.positionH=g,E.positionV=f,E.wrapType="front",E.wid=d,E.ht=c,i[u]||(i[u]=0),i[u]=i[u]+1,u=u+"_"+i[u];var T={id:u,display_name:u,type:p},m={no:n+1};t.push({mminfo:T,wrapInfo:E,pageInfo:m})}return t},l=function(e){for(var t=editor.getDocument(),i=0;i<e.length;i++){var n=e[i],o=n.pageInfo,r=editor.getDocument().createRange(),a=DocLayoutManager.getPageAtPageNumber(o.no).getFirstParaView().getNodeEndIndex(),s=DocLayoutManager.getPageAtPageNumber(o.no).getFirstParaView().getNodeStartIndex();r.start=s,r.end=a;var l=n.mminfo,d=MailMergeUtil.getZWFieldNode(l),c=n.wrapInfo;d._.op.wrapType=c.wrapType,d._.op.positionV=c.positionV,d._.op.positionH=c.positionH,d._.op.wid=c.wid,d._.op.ht=c.ht,r.insertField(d)}t.sync()},d=function(){if(c())return void MailMergeUtil.showMsg(J.i18n("writer.mailmerge.UPDATE_TEMPLATE_INPROGRESS"),3e3);if(!MailMergeDataModel.isUpdateTemplateAllowed()){var e=J.i18n("writer.common.INSUFFICIENT_PERMISSIONS"),t=J.i18n("writer.mailmerge.NO_PERMISSION_TO_UPDATE_TEMPLATE");return void MsgDialog.showMessage(CONST.MSG_TYPE_ALERT,CONST.SEVERITY_ERROR,e,t,void 0,void 0,void 0)}u(),MailMerge.updateTemplate(p,g)},c=function(){return e},u=function(){e=!0;var t=J.i18n("writer.mailmerge.UPDATE_TEMPLATE_INPROGRESS");MailMergeUtil.showMsg(t,3e3)},p=function(){e=!1;var t=J.i18n("writer.mailmerge.UPDATE_TEMPLATE_SUCCESS");MailMergeUtil.showMsg(t,3e3)},g=function(t){e=!1,MailMergeUtil.showMsg(t,3e3)},f=function(){var e=J.i18n(Macros.isFormsTemplate()?"writer.mmjobhistory.ENTRIES":"writer.mmjobhistory.RECORDS");MsgDialog.showMessage([J.i18n("writer.mailmerge.CLOSE_THIS_TAB"),J.i18n("writer.common.CANCEL")],CONST.SEVERITY_SUCCESS,J.i18n("writer.mailmerge.MEGRE_TEMPLATE_UPDATED"),J.i18n("writer.mailmerge.MERGE_TEMPLATE_UPDATED_MSG",[e,"<b>"+MailMergeDataModel.getIntegrationName()+"</b>"]),void 0,void 0,function(e){switch(e){case CONST.BUTTON_1_CLICKED:window.close();break;case CONST.BUTTON_2_CLICKED:}},!0,!0)},E=function(){if(!editor.isOffline())if(Macros.isMergeTemplate())if(t()&&(LeftPanel.addToMainPanel(ELEM_ID.MERGEFIELDPANEL,"#menu-merge-field"),o()),Macros.isRemote())LeftPanel.addToMainPanel(ELEM_ID.MERGEFIELDPANEL,"#menu-merge"),PubSub.publish("MergeFields/ShowMergePanelAlone");else{if(LeftPanel.addToMainPanel(ELEM_ID.MMPANEL,"#automation-menu"),editor.doc.docInfo.newDoc)return;PubSub.publish("MailMerge/LoadLazyFiles",{action:"MailMergePanel.openPanel"})}else if("TEMPLATE_USER"==editor.doc.getRole()){var e=MailMergeDataModel.getSource();e&&e!=MAILMERGE.SOURCE.ZOHO_FORMS&&e!=MAILMERGE.SOURCE.ZOHO_FORMS_AUTOMATION||Z("menu-automation-parent").remove()}},T=function(e){UIUtils.initComponent(e);var i=Z(e),n=i.find(".js-panel-close-btn");e==ELEM_ID.MMPANEL||t()||Macros.isRemote()?n.hide():(n.show(),n.off("click").on("click",function(){LeftPanel.closeSubPanel()}))};PubSub.subscribe("Document/ComponentInitialized",E),PubSub.subscribe("MailMerge/afterpanelload",T),PubSub.subscribe("MailMerge/FieldDetected",a),PubSub.subscribe("mm-mainpanel/open",function(){PubSub.publish("MailMerge/LoadLazyFiles",{action:"MailMergePanel.openPanel"})}),PubSub.subscribe("subpanel-mergefield/open",function(){PubSub.publish("MergeFields/ShowPanel")}),window.MMTemplateHandler={isPDFMergeTemplate:t,isInternalIntegrationTemplate:i,showFieldNavigation:n,handleFieldHighlight:r,updateTemplate:d,handleTemplateOperationDone:f}}(),function(){"use strict";var e="choosemergeflowdialog",t=!1,i=function(i){"from_dashboard"===i&&(t=!0),J.dialogutil.open(e,null,{})},n=function(){J.dialogutil.close(e)},o=function(e){"from_dashboard"===e?ThumbnailView.createNewBlankDocument("merge"):FileMenu.newFile("merge")},r=function(e){var t=null;"from_dashboard"===e&&(t=TeamSwitchHandler.getSelectedTeamId()),ImportDialog.openDlg(null,t,"mergePDF")};window.MergeTemplateDlgHandler={openNewTemplateDialog:i,closeNewTemplateDialog:n,createNewTemplate:o,openImportDialog:r}}(),function(){"use strict";var e=!1,t={},i=[MAILMERGE.FIELD_TYPE.MULTILINE,MAILMERGE.FIELD_TYPE.WEBSITE,MAILMERGE.FIELD_TYPE.IMAGELIST],n=function(e){var t=e.type||MAILMERGE.BUILD_IN_FIELD;t==MAILMERGE.FIELD_TYPE.IMAGELIST?(t=MAILMERGE.FIELD_TYPE.IMAGE,delete e[MAILMERGE.LIST_TYPE]):t==MAILMERGE.FIELD_TYPE.LIST?e[MAILMERGE.LIST_TYPE]=MAILMERGE.LIST_TYPES.HORIZONTAL:t==MAILMERGE.BUILD_IN_FIELD?(e.type=MAILMERGE.BUILD_IN_FIELD,e[MAILMERGE.FIELD_NAME]=J.i18n("writer.editor.MAILMERGE.NEXT_RECORD")):i.contains(t)&&(t=MAILMERGE.FIELD_TYPE.TEXT),e.type=t},o=function(){var e=t.fieldInfo||{};n(e);var i=J("<div>",{id:"dummyDragElem",class:"zw-portion"});i.css({position:"absolute",top:0,left:0,opacity:"0.6",display:"none","z-index":110});var o=e.type;if(MailMergeFieldUtil.isImageTypeField(o)||o==MAILMERGE.FIELD_TYPE.BARCODE||o==MAILMERGE.FIELD_TYPE.QRCODE||o==MAILMERGE.FIELD_TYPE.WIDGET){var r=cdnZWStaticPath+fingerPrintObj["images/common/mail-merge-image_opt1.png"];i.css({width:"82px",height:"82px","background-image":"url("+r+")","background-size":"66px 48px","background-repeat":"no-repeat","background-position":"center"})}else i.text(MailMergeFieldUtil.getFullMergeFieldName(e)),o==MAILMERGE.BUILD_IN_FIELD&&i.addClass("nextrecord");return i},r=function(e){t=e||{};var i=o();Jbody.append(i),Jbody[0].addEventListener("mousemove",a),Jbody[0].addEventListener("mouseup",s)},a=function(){PubSub.publish("Gridlines/show"),e=!0;var t=J("#dummyDragElem");t.css({top:event.y,left:event.x,display:"block"}),document.selection?document.selection.empty():window.getSelection().removeAllRanges()},s=function(){PubSub.publish("Gridlines/hide"),Jbody[0].removeEventListener("mousemove",a),Jbody[0].removeEventListener("mouseup",s);var i=J("#dummyDragElem");if(i.remove(),e){var n=DomViewManager.getClosestPage({left:event.clientX,top:event.clientY}),o=J(n),r=event.clientX-o.offset().left,l=event.clientY-o.offset().top,d=DocLayoutManager.getPageWithId(n.getAttribute("doc-id")),c=d.getFirstParaView().getNodeStartIndex(),u=d.getFirstParaView().getNodeEndIndex(),p=ImagePanel.getDefaultImagePostionJson();p.positionV.from="page",p.positionH.from="page",p[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=l,p[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=r;var g={};g.wrapType="front",g.positionV=p[ATTR_IMAGE.I_V_POSITION],g.positionH=p[ATTR_IMAGE.I_H_POSITION],g.start=c,g.end=u,t.callBack&&t.callBack(t.fieldInfo,g)}e=!1};window.MMFieldDragAndDropHandler={handleMouseDown:r}}();