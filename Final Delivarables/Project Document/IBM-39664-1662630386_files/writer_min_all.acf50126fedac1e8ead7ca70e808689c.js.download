function Editor(){if(!isV8Engine)var e=J("#editorpane"),t=J("#editorpane-wrapper"),n=J("#contentpane"),r=J("div.zw-contentpane:first")[0];var o,a,s={},l=[],d={TC_ON:0,TC_ON_BY_COLLAB:0,TC_All_Markup:0,TC_No_Markup:0,TC_Original:0,TC_Accept:0,TC_Reject:0,TC_Next:0,TC_Prev:0,TC_Review:0,ins_wm:0,pg_margin:0,pg_clr:0,pg_or:0,pg_ps:0},c={orgPolicyData:{},doc:_editorDoc,docClientInfo:{},documentContent:null,bookmarks:s,conditionalFields:l,statistics:d,jeditorPane:e,jeditorPaneWrapper:t,jContentPane:n,jMultiByteSpan:null,clientActiveSection:r,prevClientActiveSection:r,WCTimer:null,editorOffset:isV8Engine?null:e.offset(),jMbSpan_editableSpan:null,orgName:"",scheme:"http",uuid:"",zuid:"",timeZone:"",zoid:"",loginName:"",isMailMerge:"",lang:"",countryCode:"",currentCommand:COMMAND.ANY,currentKey:"",currentOp:"",w3schoolURL:"",view:"",editable:!0,type:"LOGIN",conversionURL:"",serverurl:"",editorType:"WRITER",subAction:null,startCursorIdx:1,isLazyFileLoaded:!1,browserInfo:{},zoomFactor:1,customZoom:"",isHardReload:!1,widthVariant:0,options:{},usedWebFont:[],shapeWebFont:[],PDFStats:{},usedFontWithVari:[],editorConfig:null,init:function(e,t){var i=editorProps.permissionsInfo.appInfo.NAME;if(editorProps.isWebLayout||"wiki"!=i&&"salesiq"!=i||(exportHTMLFrame=document.createElement("iframe"),exportHTMLFrame.setAttribute("class","exporthtml-iframe"),exportHTMLFrame.setAttribute("id","exportHTMLFrame"),exportHTMLFrame.setAttribute("src",editor.base_url+"/gethtml/"+docProps.info.RID),document.body.appendChild(exportHTMLFrame)),this.editorConfig=new EditorConfig(editorProps),this.editorConfig.setEditorConfig(),Utils.startTime("LOADING_COMPONENT"),Utils.startTime("LOADING_DOCUMENT"),PubSub.publish("Document/BeforeInitEditor"),editor.setOffline(editorProps.isOfflineMode),PubSub.publish("Document/InitEditor",editorProps),editor.documentContent=e.content,Macros.setUserSettings(),!isV8Engine){this.jMultiByteSpan=J(document.createElement("span")),editor.browserInfo.is_safari&&(this.jMultiByteSpan[0].style.height="1px");var n={};n.id="zohoMultiByteSpan",n.contenteditable=!1,n.tabindex=1,this.jMultiByteSpan.attr(n),n={},n.contenteditable=!0,this.jMbSpan_editableSpan=J(document.createElement("span")),this.jMbSpan_editableSpan.attr(n),this.jMultiByteSpan.append(this.jMbSpan_editableSpan);var r=document.getElementById("editorpane");r.appendChild(this.jMultiByteSpan[0]);var o=document.createElement("div");o.setAttribute("id","_zohoPaste"),r.appendChild(o);var a=document.createElement("canvas");a.setAttribute("id","copyImage"),r.appendChild(a),J.ajaxPrefilter(function(e,t,i){i.then(function(e,i,n){if("POST"===t.type){var r=n.getResponseHeader("buildversion");r&&null!=r&&r!==buildLabel&&(buildLabel=r,Macros.publishBuildChange(n,r))}})}),window.onbeforeunload=editor.onBeforeUnload,window.onunload=editor.onUnload,window.onresize=function(e){editor.onResize()}}this.loadDocument(e,t)},getPageID:function(e){e=e||editor.currentPageIndex||0;var t=DocLayoutManager.getPageAtPageNumber(e+1);if(t)return t.id},bindEditorErrors:function(){window.onerror=function(e,t,i,n,r){if(PubSub.publish("Document/SendPDFStats","Exception"),editor.lastError){var o=printStackTrace({e:editor.lastError});e=editor.lastError.message,ZWLogger.log("Stack ::: "+o.join("\n"),o.join("\n"))}return e===ZWCollaboration.SHOW_CARET_GETPORTION_ERROR||e===ZWCollaboration.NO_LINE_CANNOT_SELECT||e===ZWCollaboration.SHOW_CARET_SELECTION_ERROR||e===ZWCollaboration.SET_CURSOR_ERROR||e===ZWCollaboration.SHOW_SELECTION_ERROR?(PubSub.publish("Document/Error",{title:"TITLE_CURSOR_ERROR",errorNo:e,errorMsg:"MSG_CURSOR_ERROR"}),editor.lastError=null,!0):e===ZWCollaboration.API_NEGATIVE_IDX||e===ZWCollaboration.API_IOB_IDX||e===ZWCollaboration.OP_APPLYTO_ERROR||e===ZWCollaboration.OP_PROCESSING_ERR||e===ZWCollaboration.OP_TC_ERROR||e===ZWCollaboration.DELETE_TC_BLOCK_ERROR||e===ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR||e==ZWCollaboration.OP_LK_ERROR||e===ZWCollaboration.OP_APPLYTO_ERROR_DOM||e===ZWCollaboration.OP_IDX_IOB||e===ZWCollaboration.DT_DOM_RENDERING_ERROR||e==ZWCollaboration.COLLAB_OP_APPLYTO_ERROR||e===ZWCollaboration.TABLE_INSERT_COLUMN||e===ZWCollaboration.TABLE_INSERT_ROW||e===ZWCollaboration.TABLE_DELETE_COLUMN||e===ZWCollaboration.TABLE_DELETE_ROW||e===ZWCollaboration.TABLE_DISTRIBUTE_COLUMNS||e===ZWCollaboration.TABLE_FIXED_COLUMN_WIDTH||e===ZWCollaboration.TABLE_FIT_TO_WINDOW?(PubSub.publish("Document/Error",{title:"OOPS",errorNo:e,errorMsg:"MSG_EDIT_ERROR"}),editor.lastError=null,!0):void 0}},setView:function(e){PubSub.publish("Document/BeforeViewChange",e),this.view=e},setPermission:function(e){e=editor.mergePermission(e||[]);var t=function(){var t=e||[],i=function(e){var i=!1;if(Array.isArray(e)){i=!0;for(var n=0,r=e.length;n<r;n++){var o=e[n];if(!t.contains(o)){i=!1;break}}}else i=t.contains(e);return i},n=function(){};return{can:i,getAllPermissions:n}};this.role={},this.role.permissions=t(),PubSub.publish("Document/PermissionUpdate")},mergePermission:function(e){var t=[],n=editorProps.permissionsInfo.permissions;for(i=0;i<e.length;i++)n.indexOf(e[i])!=-1&&t.push(e[i]);return t},getRole:function(e){return this.role},getView:function(){return this.view},setViewConf:function(e){this.viewConf=e},getViewConf:function(){return this.viewConf},isVersionView:function(){return this.view===EDITOR_VIEWS.VERSIONVIEW},isNonEditableView:function(){return U.contains([EDITOR_VIEWS.HISTORY,EDITOR_VIEWS.MAILMERGE_PREVIEW,EDITOR_VIEWS.PRINTPREVIEW,EDITOR_VIEWS.VERSIONVIEW,EDITOR_VIEWS.FILLABLEFIELDS_PREVIEW],this.view)},setOrgPolicy:function(e){U.extend(editor.orgPolicyData,e)},getOrgPolicy:function(){return editor.orgPolicyData},setEditorProperty:function(e){for(var t in e.userInfo){var i=e.userInfo[t];if("role"==t)editor.doc.setRole(i),e.permissionsInfo?this.setPermission(e.permissionsInfo.permissions):this.setPermission([]);else if("orgName"===t||"zuid"===t||"zoid"===t||"scheme"===t||"language"===t||"countryCode"===t||"uuid"===t)editor[t]=i,"language"===t&&(editor.lang=i);else if("fullName"===t)editor.loginName=i;else if("isGrammarSupportedSetup"!==t||isV8Engine)"isZohoCorpUser"===t&&ReviewUtil.setZohocorpUser(i);else{ProofingAdaptor.setGrammarSupportedSetup(i);e.userInfo.settings;ProofingAdaptor.setGrammarSupportedUser(!0)}}for(var t in e.urls){var i=e.urls[t];"serverurl"===t||"base_url"===t||"w3schoolURL"===t||"docsUploadServerURL"===t||"conversionURL"===t||"iamServerURL"===t?editor[t]=i:"zohodocs"===t?editor.docsServerURL=i:"writerPublicURL"===t?editor.writerPublicURL=i:"servername"===t&&(editor.writerServerURL=i)}if(e.options){for(var t in e.options){var i=e.options[t];"REMOTE"===t?RemoteEditor.init(i):editor.options[t]=i}e.options.postMsgAllowedDomain&&PubSub.publish("Editor/AllowedDomains",e.options.postMsgAllowedDomain)}editor.setViewConf(e.viewInfo),editor.orgPolicyData=e.orgInfo,editor.setBrowserInfo(e.browserInfo),editor.setEditorType(e.type),editor.cloudUploadServices=e.deployment.cloudupload_services,editor.cloudPickerServices=e.deployment.cloudpicker_services,editor.makeACopyCustomOptions=e.deployment.makeacopy_options},setBrowserInfo:function(e){editor.browserInfo=e,editor.browserInfo.isPresto="Presto"==e.engine,editor.browserInfo.isTrident="Trident"==e.engine,editor.browserInfo.isWebkit="AppleWebKit"==e.engine,editor.browserInfo.isGecko="Gecko"==e.engine},clearDocInfo:function(){DocInfo.clear()},setDocProperty:function(e){for(var t in e){var i=e[t];"collabUsersDetails"===t?i&&(i[editor.zuid]&&!i[editor.zuid].uuids&&(i[editor.zuid].uuids=editor.uuid),editor.doc.setUserData(i)):"subAction"==t?0==ZWJSONUtils.getKeys(i).length?editor.subAction=null:(editor.subAction=i,editor.subAction&&editor.subAction.version&&this.setPermission(HISTORYVIEW_PERMISSION)):"highlights"==t&&Highlighter.initHilites(i)}},onResize:function(){PubSub.publish("Document/Resize"),isV8Engine||editor.updateEditorOffset()},updateEditorOffset:function(){editor.editorOffset=editor.jeditorPane.offset();var e=editor.doc.getSelection(),t=J("div.zw-contentpane:visible").first();0!=t.length&&e&&(editor.editorPaneContainerOffset=editor.editorPaneContainer.offset(),editor.editorPaneContainerHt=editor.editorPaneContainer.height())},processFetchResponse:function(e,t){return"FAILED"==e.RESPONSE?void PubSub.publish("Document/LoadingFailed",e):void editor.loadDocument(e,t)},setOffline:function(e){this.isOfflineMode!==e&&(this.isOfflineMode=e,PubSub.publish("NetworkState/Changed"))},isOnline:function(){return!editor.isOffline()},isOffline:function(){return this.isOfflineMode},lock:function(){DocInfo.setProperty({DOCUMENT_LOCKED:!0}),PubSub.publish("Document/Locked")},unlock:function(){DocInfo.setProperty({DOCUMENT_LOCKED:!1}),PubSub.publish("Document/UnLocked")},onBeforeUnload:function(e){PubSub.publish("Window/Unload");var t=editor.doc.docInfo,i=editor.doc.getRole();if(t&&(1!=t.VERSION||0!=t.REVISION||!t.newDoc||editor.isOffline())&&!t.UpgradeToWriter3){var n=Macros.onBeforeUnload(i);if(n)return n;var r=Utils.WriterCallbacks.evaluate("unload");return!r||void 0}},onUnload:function(){var e=editor.doc.getRole();"TRYEDITOR_WRITER"===e&&"TRYEDITOR_OFFICEAPI"===e||"PUBLIC"===e||editor.onZWUnload()},onZWUnload:function(){var e="undefined"!=typeof navigator&&"undefined"!=typeof navigator.sendBeacon,t={},i=DocLayoutManager.getPageCount(),n=25*parseInt(i/25),r=editor.doc.getSelection(),o=DocLayoutManager.getColumnCountAtIdx(r.getStart());t.data=JSON.stringify({Page:n,Papersize:DocLayoutManager.getPageSizeAtIndex(r.getStart()),Orientation:DocLayoutManager.getPageOrientationAtIndex(r.getStart()),"Column Count":o}),J.ajax({type:"POST",global:!1,async:!0,url:ZWNetworkUtils.getContextUrl("log/page"),data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(){},success:function(){}});var a=editor.doc.docInfo;t={};try{if(OfflineImpl.UnloadHandler(),editor.isOffline()&&("TRYEDITOR_WRITER"===editor.doc.getRole()||"TRYEDITOR_OFFICEAPI"==editor.doc.getRole()))return;ZWLogger.generateReports();try{2==window.devicePixelRatio?ZWLogger.addToStatistics("RetinaScreen"):ZWLogger.addToStatistics("NonRetinaScreen")}catch(e){}t.statistics=JSON.stringify(editor.statistics),editor.doc.docInfo.MAILMERGE_DOCUMENT&&(t.MAILMERGE_DOCUMENT=!0)}catch(e){}var s=editor.getEditorType();"REMOTE"!=s&&"ANYONEWITHLINK"!=s&&(editor.docClientInfo.JS_LOADING_TIME=JS_LODING_TIME,editor.docClientInfo.STATS_DOCUMNET_ID=editor.doc.docInfo.RID,t.docinfo=JSON.stringify(editor.docClientInfo)),t.unload="true",t.wmssessionid=ZWCollaboration.getWMSSessionId();var l=ZWCollaboration.getWMSRawSessionId();l&&(t.rawsid=l),t.chid=a.COLLAB_ID,t.uname=Macros.getUserZuid(),t.lang=isV8Engine?"":DocLocaleHandler.getLanguage()||"";var d=ZWNetworkUtils.getUrl("unload");if(t.tstamp=(new Date).getTime(),t.sid=editor.uuid,t.contentEdited=ZWCollaboration.contentEdited,t.starting_version_id=ZWCollaboration.startingVersionId,Macros.includeParamsForStats(t),e){var c=new FormData;for(key in t)c.append(key,t[key]);c.append(csrfParamName,getcsrf()),isSucceeded=navigator.sendBeacon(d,c),isSucceeded&&(ZWCollaboration.contentEdited=void 0,ZWCollaboration.startingVersionId=void 0)}else J.ajax({type:"POST",global:!1,async:!1,url:d,data:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(){},success:function(e){ZWCollaboration.contentEdited=void 0,ZWCollaboration.startingVersionId=void 0}})},loadDocument:function(e,t){PubSub.publish("Document/BeforeLoad"),!editor.getRole().permissions.can("document.edit")&&editor.jMultiByteSpan&&editor.jMultiByteSpan.css("top","-100000px"),EditorUtil.focusMultiByteSpan(),DocInfo.initialize(e.info),editor.isHardReload=t||!1,editor.commentCont=e.content.comments,editor.documentContent=e.content;var i=editor.doc.docInfo;if(editor.doc.contStr="",editor.doc.formats=[],ZWCollaboration.clientInfo="",ZWCollaboration.mailInfo="",editor.doc.bodyFormat={},editor.doc.bodyFormat.listFormat={},editor.doc.paintFormat={},extImgCache={},editor.doc.rid=i.RID,this.removeDOMCursor(),editor.doc.createDomCursor(editor.uuid,editor.zuid),ZWCollaboration.stopUpdates=!1,ZWCollaboration.msgQueue&&(ZWCollaboration.msgQueue=new MsgQueue(editor)),ZWCollaboration.syncSent=!1,ZWCollaboration.timeOutVal=void 0,"HISTORY"==editor.getView()||i.UpgradeToWriter3||1!=i.ISTRASHED||RestoreTrash.initRestoreEditor(),i.UpgradeToWriter3&&editor.rebindEvents(EDITOR_PERMISSION),isHeadlessPDF||isHeadlessHTML){if(!navigator.webdriver){if("function"!=typeof window.mailMergeDownloadPptr){var n=new ZWConsole;n.enable(),window.mailMergeDownloadPptr=function(e){n.log(e)}}editor.renderDocument()}}else editor.renderDocument();isV8Engine||ZWLogger.addScrRes()},removeDOMCursor:function(){for(var e in editor.doc.domCursor)DomUtil.removeCursorNode(e,"start"),DomUtil.removeCursorNode(e,"end")},modelErrorHandler:function(e,t){if("FORMAT_MISSING"===e)ZWLogger.sendErrorDetails("FORMAT_MISSING<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No = FORMAT_MISSING DOC len ="+editor.doc.getDocumentLength()+" buildLabel::: "+buildLabel+"\n IDX : CHAR : \n"+t.idx+" : "+JSON.stringify(t.char)+" Error Log End \n<ZWERROR>");else if("OP_IDX_IOB"===e||"API_NEGATIVE_IDX"===e)t.errorStr&&ZWLogger.log(t.errorStr),editor.lastError=t.error;else if("DELETESTRING_MISMATCH"===e){var i="Delete String content is mismatched... @ : start : "+t.start+" end : "+t.end;ZWLogger.log(i)}else if("DELETESTRING_IDX_EXCEEDS"===e){var i="Error in delete @ : start : "+t.start+" end : "+t.end;ZWLogger.log(i)}else if("LOCK_ERROR"===e){if(ZWLogger.log("finalOperation: "+t.builder.toProtoString()),"Error in xform lock"==t.error)PubSub.publish("DocOperation/LockError");else{if("Lock error in compose"!=t.error){ZWLogger.log("Exception: "+t.error.stack);var n=new Error(ZWCollaboration.OP_LK_ERROR);throw editor.lastError=n,n}PubSub.publish("Collaboration/LockNotAllowed")}Op.resetBuffer()}else{if("TABLESTART_END_CHARS_COUNT_MISMATCH"===e){ZWLogger.log("Excess table start end chars count mismatch in op delete...");try{ZWLogger.sendErrorDetails(ZWCollaboration.TABLESTART_END_COUNT_MISMATCH+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+ZWCollaboration.TABLESTART_END_COUNT_MISMATCH+" DOC len =\nError Log End \n<ZWERROR>",null,ZWCollaboration.TABLESTART_END_COUNT_MISMATCH)}catch(e){}var n=new Error(ZWCollaboration.TABLESTART_END_COUNT_MISMATCH);throw editor.lastError=n,n}if("CONDITIONAL_PATTERN_MISSING"===e)try{ZWLogger.sendErrorDetails(ZWCollaboration.CMF+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+ZWCollaboration.CMF+" DOC len =\nError Log End \n<ZWERROR>",null,ZWCollaboration.CMF)}catch(e){}else if("AUTOFIELD_MIGRATION"===e&&!isV8Engine)try{var r={shouldWriteToFile:!1,service:ZWCollaboration.AUTOFIELD_ID_MISMATCH,filePrefix:ZWCollaboration.AUTOFIELD_ID_MISMATCH},o="Err No: "+ZWCollaboration.AUTOFIELD_ID_MISMATCH+"\nDOC len: "+editor.doc.getDocumentLength()+"\nDOC RID: "+Macros.getRId()+"\nbuildLabel: "+buildLabel+"\nUserAgent: "+(navigator&&navigator.userAgent)+"\n";ZWClientLogger.sendToServer(ZWCollaboration.AUTOFIELD_ID_MISMATCH,o,r)}catch(e){}}},onModelInit:function(){DocumentDesign.initialize(),a=editor.getThemeFonts(),editor.usedWebFont=editor.usedWebFont.concat(a)},getThemeFonts:function(){var e,t,i,n,r=DocumentDesign.getStyles().para,o=[],a=DocumentDesign.getTheme();if(FontUtils)for(e in r)if(t=r[e]||{},i=t.textFormat||{},n=i[ATTR_TEXT.TS_FF]){"zwmajor"===n||"#major"===n?n=a.font.major.latin:"zwminor"!==n&&"#minor"!==n||(n=a.font.minor.latin);for(var s,l,d=FontUtils.stringToFonts(n),c=0,u=d.length;c<u;c++)if((s=d[c])&&(s=d[c],l=Utils.isWebFont(s),l||FontUtils.isFontAvailableInSystem(s))){l&&!o.contains(s)&&o.push(s);break}}return o},processFormat:function(e){var t=e[ATTR_TEXT.TS_FF];if(t||e.type===NODE_TYPE.CONDITIONAL_IF_START&&(t=CONDITIONAL_FIELD.FONT_FAMILY),!isV8Engine&&FontUtils){if([NODE_TYPE.FILLABLEFIELD,NODE_TYPE.MAILMERGEFIELD].contains(e.type)&&CHECKBOXES_AND_RADIO_FIELDS.contains(e.ffType)){var i=RENDERING_FONTS.CHECKBOXES_AND_RADIO_FIELDS;return void(isFontNeedToBeLoaded(i)&&(editor.addUsedWebFont(i),editor.addUsedWebFontWithVariants(i+":n4")))}if(t||e.shapeData){if(e.type===NODE_TYPE.IMAGE)return t=e.shapeData&&Shapes.getFontFamiliesInShape(e.shapeData)||[],void(t.length&&editor.addShapeWebFont(t));if(t)for(var n,r,o=t&&FontUtils.stringToFonts(t)||[],a=0,s=o.length;a<s;a++)if((n=o[a])&&(n=o[a],r=Utils.isWebFont(n),r||FontUtils.isFontAvailableInSystem(n))){var l=("bold"==e.fw?700:e.fw_i||400).toString(),d=("italic"===e.fs?"i":"n")+l.replace(/[0i]/g,""),c=n+":"+d;r&&editor.addUsedWebFontWithVariants(c),r&&editor.addUsedWebFont(n);break}}}},addShapeWebFont:function(e){editor.shapeWebFont=editor.shapeWebFont.concat(e)},addUsedWebFont:function(e){!editor.usedWebFont.contains(e)&&editor.usedWebFont.push(e)},getUsedWebFonts:function(){return editor.usedWebFont},getShapeWebFonts:function(){return editor.shapeWebFont},addUsedWebFontWithVariants:function(e){!editor.usedFontWithVari.contains(e)&&editor.usedFontWithVari.push(e)},getUsedWebFontWithVariants:function(){return editor.usedFontWithVari},renderDocument:function(){var e=editor.documentContent,t=editor.doc.docInfo;ZWLogger.log("FetchContent-ver:"+e.ver+",rev:"+e.rev+"curr.ver:"+t.VERSION+",curr.rev:"+t.REVISION),ZWLogger.log("LOAD DOCUMENT CONTENT STARTED ");var i={VERSION:e.ver,REVISION:e.rev};DocInfo.setProperty(i),ZWCollaboration.MUTATION_SEND_VERSION=e.ver,ZWCollaboration.MUTATION_SEND_REVISION=e.rev,ZWLogger.log("VERSION,REVISION UPDATED FROM FILESTORE CONTENT "),editor.conditionalFields=[],DocTreeManager&&DocTreeManager.destroy();var n=function(e){DocTreeManager=new DOCTreeManager(e),editor.doc.model=DocTreeManager.getModel(),editor.doc.snapShotManager?(editor.doc.snapShotManager.resetSnapShotManager(),editor.doc.snapShotManager.setSkipSnapShot(!1),editor.doc.snapShotManager.attachModel(editor.doc.model)):editorProps.options&&editorProps.options.isMailMerge&&(editor.doc.snapShotManager=SnapShotManager,editor.doc.snapShotManager.attachModel(editor.doc.model)),editor.doc.model.on("usedFonts",editor.webFontsInit),editor.doc.model.on("Model/Error",editor.modelErrorHandler),editor.doc.model.init()};if(isHeadlessHTML&&(!editorProps.options||!editorProps.options.isFillableFieldMerge)){var r=new Model(e.content,e.styles,e.defaults,e.locks,e.ranges);r.init();var a=NamedRange.replaceNamedRanges(e);r.applyOps(a,!0);var s=r.getDocument();e.content=s.content,e.styles=s.styles,e.defaults=s.defaults,e.locks=s.locks,e.ranges=s.ranges,r.destroy()}if("headless"===editorProps.mailmergetype)docProps.MM_DETAILS&&MailMergeDataModel.init(docProps.MM_DETAILS),n(e);else if(isHeadlessHTML&&editorProps.options&&editorProps.options.isFillableFieldMerge)try{var l=new Model(e.content,e.styles,e.defaults,e.locks,e.mig_ver,e.ranges);l.init(),o=new ZWDocument,o=editor.getDocument().loadDocument(l.getDocument());var d=FillableFieldHeadlessMerge.mergeFieldData(!1);d&&l.applyOps(d);var s=l.getDocument();e.content=s.content,e.styles=s.styles,e.defaults=s.defaults,e.locks=s.locks,e.ranges=s.ranges,l.destroy(),n(e)}catch(e){throw ZWCollaboration.clientInfo+="FillMerge Exception Stack Trace ::: "+e.stack,DomUtil.updateHeadlessChromeDiv(),e}else if(editorProps.options&&editorProps.options.include_changes)try{var c=TcUtil.getTcViewDocModel(e,editorProps.options.include_changes);n(c.model)}catch(e){throw ZWCollaboration.clientInfo+="Trackchange Exception Stack Trace ::: "+e.stack,isHeadlessHTML&&DomUtil.updateHeadlessChromeDiv(),e}else{var u=editor.doc.getTrackChangeDetails();if(u.updateDisplayMode(),u.resetHiddenRangeOps(),editor.getRole().permissions.can("document.edit")&&u.getDisplayMode()===TCConstants.NO_MARKUP_VIEW&&!isV8Engine){var c=TcUtil.getTcViewDocModel(e,"no_markup");u.setHiddenRangeOps(c.noMarkupHiddenOps),n(c.model)}else n(e)}if(window.isHeadlessPDF&&editor.doc.getContent().length>7e5)throw new Error(ZWCollaboration.PDF_CONTENT_LIMIT)},webFontsInit:function(){var e,t;if(isHeadlessPDF?(a=[],e=[],t=[]):(e=editor.getUsedWebFonts(),t=editor.getShapeWebFonts()),isV8Engine)editor.addFonts(e||[],!0,editor.onWebFontsLoadComplete);else{ZWLogger.log("@renderDocument-->addFonts");var i={usedWebFontWithVariants:editor.getUsedWebFontWithVariants()};editor.addFonts(a||[],frames.metricsFrame,function(n){editor.addFonts(e||[],frames.metricsFrame,function(e){e=e||[],ZWLogger.log("Failed web-fonts in metric frame: "+JSON.stringify(e)),editor.addFonts(t||[],window,function(t){t=t||[],ZWLogger.log("Failed web-fonts(Shapes) in top frame: "+JSON.stringify(t)),editor.onWebFontsLoadComplete(e.concat(t))})},i)})}},onWebFontsLoadComplete:function(e){ZWLogger.log("onWebFontsLoadComplete : Starts..."),isV8Engine||e&&e.length&&editor.isOnline()&&(ZWLogger.sendErrorDetails("NO_ERROR_MAIL<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>WEBFONTS_LOADING_FAILURE\nFailure Log Start \nFailed WebFonts: ["+e.toString()+"]\nCLIENT INFO: "+ZWCollaboration.clientInfo+"\nbuildLabel: "+buildLabel+"\nFailure Log End",null,ZWCollaboration.WEBFONTS_LOADING_FAILURE),PubSub.subscribeOnce("Document/ComponentInitialized",function(){UIUtils.showMessage("error",J.i18n("common","WEBFONT_FAILURE_INFO"),null,"normalfont",null,!0)}));var t=editor.isHardReload;Conversions.init(w_usersettings[ATTR_BODY.DS_UN]);var i=editor.doc.getBodyFormat();editor.getView();editor.isNonEditableView()?PubSub.publish("Document/readonlyview"):(DocLocaleHandler.init(),"cn"===editor.countryCode&&"zh"===editor.lang&&(editor.lang="zh-cn")),t&&afterWebFontsLoad(),Lock.init(),MailMergeRepeatView.init(),NamedRange.init(),isV8Engine||(Highlighter.init(),RangeCollection.init()),TableCollectionInstance?TableCollectionInstance.destroy():TableCollectionInstance=new TableCollection,TableCollectionInstance.init(),editor.setCursorStartIdx(),EditorView.initView(),editor.isHardReload||(editor.clientActiveSection=editor.jeditorPane.children(".zw-page").eq(editor.currentPageIndex).find(".zw-contentpane:first")[0]),ZWLogger.log("onWebFontsLoadComplete : DocTreeManager init starts");var n=editor.doc.findNextIndexOf(UNICODE.TOCSTART,0)!=-1,r=!!editorProps.options&&(editorProps.options.isMailMerge&&!n);r&&isHeadlessPDF?editor.setDeferredDocLoading(!0):editor.setDeferredDocLoading(!1),ViewInitializer.init(),DocTreeManager.init(),ZWLogger.log("onWebFontsLoadComplete : DocTreeManager init ends"),o=void 0,editor.doc.initTrackChangeDetails(),editor.doc.getRole()===USER_ROLE.PUBLIC?editor.doc.getTrackChangeDetails().setDisplayMode(TCConstants.NO_MARKUP_VIEW):(isHeadlessPDF||isHeadlessHTML)&&editor.options.include_changes&&editor.doc.getTrackChangeDetails().setDisplayMode(TCHandler.getDisplayMode(editor.options.include_changes)),ZWLogger.log("onWebFontsLoadComplete : Before Document Loading..."),PubSub.publish("Document/BeforeLoading");try{var a,s=ViewInitializer.getViewType();a=s===EDITORVIEW_TYPE.PUBLISH_VIEW&&(editorProps.isWebLayout||editorProps.isFixedLayout)?s===HTMLVIEW_TYPE.FIXED_VIEW:EditorView.isWebView(),a&&null!==editor.subAction&&PubSub.subscribe(DOCVIEW.PARAVIEW_AFTER_CREATE,editor.initAfterContentRendered),EditorView.setView(i.view,i.view_width);var l=editor.doc.getUserData()[editor.zuid];EditorView.getView()==EDITORVIEW_TYPE.WEB_VIEW&&l&&EditorView.setCurrentMode(l.editor_mode),DomUtil.applyDocumentStyle(i);var d=new DocOpBuilder;d.operation="load",DocTreeManager.updateDocOpBuilder(d),DocTreeManager.buildTree(),ZWLogger.log("onWebFontsLoadComplete : Post Apply To called..."),DomUtil.updateHeadlessChromeDiv(),editor.doc.postApplyTo({operation:"load"}),isV8Engine||editor.onResize(),"headless"===editorProps.mailmergetype&&MailMergeHandler.processMergeFieldInHeadLessBrowser(),t||(PubSub.publish("Document/EditorReady"),PubSub.publish("Document/ComponentReady"))}catch(e){if(isV8Engine)renderingError(e);else{editor.isHardReload=t,ZWLogger.log(" DOCUMENT READY STATE : "+document.readyState),ZWLogger.log("Stack :: "+e.stack,"LOADING FAILURE::"+e.stack),DomUtil.updateHeadlessChromeDiv();try{var c=!!editorProps.options&&editorProps.options.isMailMerge;if(c){var u=new ZWConsole;u.enable(),u.log("Loading error:::"+e.stack)}}catch(e){}if(isHeadlessPDF||isHeadlessHTML){var u=new ZWConsole;throw u.enable(),u.log(ZWCollaboration.clientInfo),window.status="PaginationCompleted",e.message&&e.message.indexOf(ZWCollaboration.HEADLESS_MAILMERGE_HTML_ERROR)!=-1?e:new Error(ZWCollaboration.HEADLESS_DOCUMENT_RENDERING_ERROR)}editor.renderingError(e)}return void UIUtils.hideLoadingMsg()}if(editor.currentPageIndex=0,isV8Engine||(editor.clientActiveSection=editor.prevClientActiveSection=editor.jeditorPane.children(".zw-page").eq(editor.currentPageIndex).find(".zw-contentpane:first")[0]),t&&writerLazyJsUrl&&!isV8Engine){var g=editorProps.viewInfo.view,h=g.JS;if(h&&h[0]){var f={defer:"defer",src:jsCdnZWStaticPath+h[0]};loadJS(f)}var p={async:"async",defer:"defer",src:writerLazyJsUrl,callback:function(){TransLiteration_EventHandler.isTransliterationEnabled()?(TransLiteration_EventHandler.setProcessingJSLoaded(!0),TransLiteration_EventHandler.preloadTransliteration(editor.afterInit)):editor.afterInit()}};loadJS(p)}else isV8Engine&&editor.afterInit()},initAfterContentRendered:function(e){(e.start>=editor.startCursorIdx||e.end>editor.startCursorIdx)&&editor.isLazyFileLoaded&&(editor.subAction.state=!0,editor.afterInit())},afterInit:function(){if(editor.isLazyFileLoaded=!0,isV8Engine||WordComplete.init(),null==editor.subAction||editor.subAction.state||!DocTreeManager.isContentSectionBuildInProgress()){PubSub.unsubscribe(DOCVIEW.PARAVIEW_AFTER_CREATE,editor.initAfterContentRendered);var e=editor.subAction;e&&(e.bookmarks||e.comments||e.pages||e.ranges)&&(editor.subAction=null),isV8Engine?loadWebFonts():editor.isOnline()&&0==ZWOffline.isOfflineOperationsAllowed()&&WMSHandler.initWMS(),null!=editor.subAction&&(editor.subAction.state=!0),editor.doc.createSelection(editor.uuid),editor.doc.snapShotManager=SnapShotManager,editor.doc.snapShotManager.attachModel(editor.doc.model),ZWCollaboration.msgQueue=new MsgQueue(editor);var t=editor.doc.getSelection();if(editor.startCursorIdx>1){var i=editor.doc.createRange(editor.startCursorIdx);t.removeAllRanges().addRange(i),DomUtil.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0],500,!0)}else if(!isV8Engine)try{var i=editor.doc.createRange(editor.startCursorIdx);t.removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(i),CurUtil.stopBlinking();var n=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");n||(CurUtil.createCursor("start",editor.uuid,editor.zuid),DomViewManager.updateVisiblePages(editor.currentPageIndex+1),DomViewManager.togglePages()),EventHandler.toggleSection()}catch(e){editor.doc.getDomCursorNode()||CurUtil.createCursor("start",editor.uuid,editor.zuid),PubSub.publish("cursor/blinkCursor")}editor.getRole().permissions.can("document.edit")||CurUtil.stopBlinking(),PubSub.publish("BeforeEditorReady"),isV8Engine||PubSub.publish("Document/AfterInit"),PubSub.publish("Document/EditorReady")}},openPDFView:function(){var e;e=Macros.getUrl(),Utils.safeWindowOpen(e)},sendBugReport:function(){ZWLogger.sendErrorDetails("LOADING FAILURE - USER REPORT<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No =LOADING FAILURE - USER REPORT DOC len ="+editor.doc.getDocumentLength()+" RID ::: "+editor.doc.docInfo.RID+" buildLabel::: "+buildLabel+"\n Error Log End \n",null,"loading_usr_report")},getEditorType:function(){return this.type},setEditorType:function(e){this.type=e},setOptions:function(e){this.options=e},getOptions:function(){return this.options},getBaseURL:function(){return this.base_url},getServerURL:function(){return this.serverurl},updateDashboardURL:function(e){e=editor.scheme+"://"+e,location.href=e},renderingError:function(e){editor.doc.docInfo;PubSub.publish("Document/SendPDFStats","Exception"),Macros.pubSubAction(e)},setDeferredDocLoading:function(e){editor.isDeferredDocLoading=e},setCursorStartIdx:function(){var e=1;if(null!=editor.subAction&&(null!=editor.subAction.bookmarks||null!=editor.subAction.comments||null!=editor.subAction.ranges))if(null!=editor.subAction.bookmarks?e=DocUtil.getFloatElementIdx(editor.subAction.bookmarks):null!=editor.subAction.comments?e=DocUtil.getFloatElementIdx(editor.subAction.comments):null!=editor.subAction.ranges&&(e=DocUtil.getNamedRangeIdx(editor.subAction.ranges)),e!=-1)editor.startCursorIdx=e;else if(editor.startCursorIdx=1,editor.subAction.state=!0,null!=editor.subAction.comments&&!editor.commentCont.comments[editor.subAction.comments]){var t=function(){UIUtils.showMessage("error",J.i18n(UIUtils.getUIText("COMMENT_DELETED_INFO")),"showclose","normalfont",8e3),PubSub.unsubscribe("Document/ComponentInitialized",t)};PubSub.subscribe("Document/ComponentInitialized",t)}},fetchDocument:function(e,t,i){var n=ZWNetworkUtils.getUrl("view"),r=editor.doc.docInfo,o={};o.viewVersion=t,o.chid=r.COLLAB_ID,o.sid=1,o.tstamp=(new Date).getTime(),o.uname=Macros.getUserZuid(),J.ajax({type:"POST",dataType:"json",url:n,data:o,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){if("SUCCESS"===e.RESPONSE){var t={};t.content=e.docContent,t.info=e.docInfo,editor.processFetchResponse(t)}else"FAILED"===e.RESPONSE&&PubSub.publish("Document/LoadingError",200)},error:function(e,t,i){PubSub.publish("Document/LoadingError",e.status)}})},mouseEventHandler:function(e,t){var i=e||window.event,n=i.target;if(isIPadSafariBrowser&&"touchmove"===i.type){var r=i.changedTouches[0];n=document.elementFromPoint(r.clientX,r.clientY)}var o=J(n),a=i.type,s=!1;if(this.currentCommand=COMMAND.ANY,"mouseup"!=a&&"touchend"!=a||PubSub.publish("Document/BeforeMouseUp",i),"tableProp"===n.id||o.hasClass("bMark")||o.hasClass("imgMark")||o.hasClass("ui-page-collapse-div")||o.parent().hasClass("ui-page-collapse-div")||"dummyImage"==o[0].id||o.hasClass("writer-glyphs-anchored-object")||o[0].getAttribute("class")&&o[0].getAttribute("class").indexOf("rect")!=-1)return!0;if(!J(e.target).parents("#review_Rightpane").length){if(("mouseup"==a||"mousemove"==a||"touchend"==a||"touchmove"==a)&&TableVisualCueHandler&&TableVisualCueHandler.isOpen()){var l=TableVisualCueHandler.handleMouseEvents(i);if(l)return i.stopPropagation(),!1}var d=editor.doc.getSelection();if("mousedown"==a||"mouseup"==a||"touchstart"==a||"touchend"==a){if(!d.isCollapsed()&&3==i.which&&o[0].getAttribute("class").indexOf("zw-image")==-1||editor.scrollOn)return EventHandler.mouseUpDone=!0,"mousedown"!=a&&"touchstart"!=a||(editor.scrollOn=!1),!1;if("mousedown"==a||"touchstart"==a){PubSub.publish("Document/BeforeMouseDown",i),EventHandler.mouseUpDone=!1;var c=(editor.editorPaneContainer[0].clientWidth,editor.editorPaneContainerOffset.top+editor.editorPaneContainerHt-20);(i.clientX>editor.editorPaneContainer[0].clientWidth||i.clientY>c)&&(editor.scrollOn=!0,EventHandler.mouseUpDone=!0)}else EventHandler.isMenuOpened&&EventHandler.isDialogOpened||(EventHandler.mouseUpDone=!0)}if("mousedown"!=a&&"touchstart"!=a||!d.isCollapsed()||editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start").css("visibility","hidden"),"mousemove"==a||"mouseup"==a||"mousedown"==a||"click"==a||"touchstart"==a||"touchend"==a||"touchmove"==a){if("mousemove"!=a&&"undefined"!=typeof TransLiteration_EventHandler&&TransLiteration_EventHandler.isTransliterationEnabled()&&EventHandler.multiByteTyping){var u=TransLiteration_EventHandler.getCompositionEndEvent(i);u.data=u.detail.data,EventHandler.handleCompositionEnd(u),editor.jMbSpan_editableSpan.innerHTML="&nbsp;"}if("mousedown"!=a&&"touchstart"!=a||(d.isMultipleSelection=!1,d.isCtrlSelection=!1,d.isCellSelection=!1,d.isRowSelection=!1,PubSub.publish("QuickSeek/hideBarWithID","Selection")),o.hasClass("ui-hdr-ftr-exit"))return!1;if(J(".ui-editor-selectbox-dropdown")[0]&&J(".ui-editor-selectbox-dropdown")[0].contains(o[0]))return!1;if("mouseup"!=a&&"touchend"!=a||editor.imgDrag&&(editor.imgDrag=!1),EventHandler.handleMouseEvents(i),d.isCollapsed()&&d.resetLastModifiedPosition(),d.isCollapsed()&&TransformHandler&&TransformHandler.getCurrentObjectInfo().type){var g=TransformHandler.shouldHideCursor(d.getStart());g&&CurUtil.setCursorVisiblity(!1)}}else if("dragstart"==a){TransformEventHandler.deselectObjects();var h=d.getLastRange();if(!h.isMultipleTablesSelected()&&J(n).hasClass("overlay"))d.isTextDrag=!0,EventHandler.textDragStart=!0,J(editor.clientActiveSection).removeClass("selectableSection").addClass("unselectable"),s=!0;else if(editor.imgDragStart||TransformHandler.getCurrentObjectInfo().isCropActive)return DomUtil.stopEvent(i),!1}else if("drop"==a||"dragstop"==a){if(EventHandler.mouseUpDone=!0,EventHandler.textDragStart)EventHandler.moveText();else if(EventHandler.mouseDown||"dragstop"==a){if(editor.imgDragStart)return DomUtil.stopEvent(i),!1}else editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start").css("border-left-style",""),EventHandler.dropImage(i);s=!0}else if("dragover"==a||"drag"==a){if((editor.imgDragStart||TransformHandler.getCurrentObjectInfo().isCropActive)&&(DomUtil.stopEvent(i),s=!0),EventHandler.mouseDown||(editor.externalImgDrag=!0),EventHandler.textDragStart||editor.externalImgDrag||!DTUtils.isFloatingImage(EventHandler.imgDragAttr)){if(0==J(i.originalEvent?i.originalEvent.target:n).parents("#ui-editor-outer-div").length)return;EventHandler.moveCursor(i)}}else{if("dragleave"==a)return EventHandler.mouseDown||(DomUtil.stopEvent(i),s=!0),editor.imgDragStart&&(DomUtil.stopEvent(i),s=!0),!0;if("dragenter"==a){if(!EventHandler.mouseDown){var f=i.dataTransfer&&i.dataTransfer.items[0];if(f||!DragDrop.isCardDragOn()&&!TransformHandler.getCurrentObjectInfo().isCropActive){if(!LayoutManager.isFullscreen()&&f.type&&(f.type.indexOf("image")!=-1||"file"==f.kind&&SUPPORTED_SUPPORTED_MIME_TYPES.contains(f.type)))return EditorDropHandler.showDropContainer(),!0}else DomUtil.stopEvent(i),s=!0}return(editor.imgDragStart||TransformHandler.getCurrentObjectInfo().isCropActive)&&(DomUtil.stopEvent(i),s=!0),!0}if("scroll"==a){if("undefined"!=typeof TransLiteration_EventHandler&&TransLiteration_EventHandler.isTransliterationEnabled()&&EventHandler.multiByteTyping){var u=TransLiteration_EventHandler.getCompositionEndEvent(i);u.data=u.detail.data,EventHandler.handleCompositionEnd(u),editor.jMbSpan_editableSpan.innerHTML="&nbsp;"}editor.scrollOn=!0,editor.updateEditorOffset(),PubSub.publish("Document/ScrollEvent")}}if("mouseup"!=a&&"touchend"!=a||(isIPadSafariBrowser&&editorProps.browserInfo.is_android_tab?(clearTimeout(EditorUtil.focusMultiByteSpanTimer),EditorUtil.focusMultiByteSpanTimer=setTimeout(function(){EditorUtil.focusMultiByteSpan()},50)):EditorUtil.focusMultiByteSpan(),/updateRowHeight|updateColumnWidth|updateLastColumnWidth/.test(editor.lastOperation)||(editor.editorPaneContainer[0].scrollTop=CurUtil.scrollTop),EventHandler.multiByteTyping||PubSub.publish("cursor/blinkCursor")),s)return DomUtil.stopEvent(i),!1;if(editor.doc.isHighLighterOn&&("mouseup"==a||"touchend"==a)){var p=d.getTextFormat(),E=d.getParaFormat();p=DocUtil.mergeObjs([E[ATTR_PARAGRAPH.TEXTFORMAT],p]);var T=DocUtil.formatGenerator.getTextFormat(p,"BackColor",editor.doc.highLightTextColor);d.applyFormat(T),Op.sendMsg();var h=editor.doc.createRange(d.getLastRange().end);d.removeAllRanges().addRange(h)}return!0}},close:function(){this.onBeforeUnload(),editor.jeditorPane.off("mousedown mouseup mousemove"),dom.onkeydown=dom.onkeyup=dom.onkeypress=dom.ondragenter=dom.ondragleave=dom.ondragstart=dom.ondrop=dom.ondragover=document.onmouseup=window.onblur=window.onresize=window.onfocus=void 0,PubSub.publish("Document/CloseEditor"),editor=void 0,PubSub.unsubscribeAll()},isFinalDocument:function(){var e=editor.doc.docInfo;return e.FINAL_INFO&&e.FINAL_INFO.STATUS},addFonts:function(e,t,i,n){if(!t||isHeadlessPDF)return"function"==typeof i&&i();for(var r,o,a=[],s=0,l=e&&e.length||0;s<l;s++)(r=e[s])&&(o=FontUtils.getWebFont(r),o&&!a.contains(o)&&a.push(o));return"undefined"!=typeof FontFace&&document.fonts?(ZWLogger.log("FontsToBeLoaded using FontFaceSet"),void ZWWebFontLoader.loadDocumentFonts(a,t,i,n)):(ZWLogger.sendErrorDetails("NO_ERROR_MAIL<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>FontsToBeLoaded using WebFontLoader\n Client Info : "+ZWCollaboration.clientInfo+"\n Log End",null,ZWCollaboration.FONTS_TO_BE_LOADED),ZWLogger.log("FontsToBeLoaded using WebFontLoader"),void ZWWebFontLoader.loadWebFonts(a,t,i))},handleScroll:function(){clearTimeout(this.scrollTimer),DocTreeManager.doc.setCurrentOperation(DOCUMENT_OPERATIONS.SCROLL),this.scrollTimer=setTimeout(function(){var e=DomViewManager.getViewPortInfo(),t=e.pageNo;DomViewManager.updateVisiblePages(t,e.viewport),DomViewManager.togglePages();var i=DocLayoutManager.getPageAtPageNumber(t);PubSub.publish("Document/ViewportChanged",i,e.viewport)},10)},initDocument:function(){o=new ZWDocument,o.loadDocTree(DocTreeManager.doc),TcManager.init(o),o.bindEvents()},getDocument:function(){return o||editor.initDocument(),o},getCursorOp:function(){var e=editor.doc.getSelection(),t=e.getCursorOp();return t&&(editor.doc.getTrackChangeDetails().isNoMarkupON()&&!isV8Engine?t=TcNoMarkupHandler.processClientToServerCursorOp(t):HiddenRangesHandler.hasHiddenRangeOps()&&!isV8Engine&&(t=HiddenRangesHandler.processClientToServerCursorOp(t))),t},getHTML:function(){var e=ZWJSONUtils.clone(docProps),t=editor.doc.model.getDocument();t.ver=editor.doc.docInfo.VERSION,t.rev=editor.doc.docInfo.REVISION,t.mig_ver=e.content.mig_ver,e.content=t;var i=editorProps.permissionsInfo.appInfo.NAME,n=exportHTMLFrame.contentWindow.ViewManager.getHTML(e,i);return n},reloadDocumentContent:function(){var e=function(){var t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,1);editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).moveTo(t,!0);var i=editor.doc.getTrackChangeDetails();i.getDisplayMode()===TCConstants.ORIGINAL_VIEW?editor.rebindEvents(ONRELOAD_PERMISSION):editor.rebindEvents(),PubSub.unsubscribe("Document/LoadingStart",e)},t=editor.doc.getParents(NODE_TYPE.PARAGRAPH,1);editor.doc.getSelection().removeAllRanges().setSelectionType(SEL_AUTO_GEN).moveTo(t,!0),PubSub.subscribe("Document/LoadingStart",e),editor.fetchDocument(Utils.getDocumentId(),"")}};return c}function DomUtil(){}function DTSection(e,t,i){this.doc=i,this.start=e,this.end=t,this.format=editor.doc.getRawFormatAt(e),this.id=this.format.sid||"section_"+("x"+Math.random()).replace(/\D/g,""),this.sid=this.id,this.lists={},this.headings={},this.tables={},this.nodes={},this.sectionBuilder=null,this.type="section",this.sectionType="",this.unknownImages={},this.children=[],this.nodesToUpdate=new DTUpdateQueue,this.nodelessRange=null,this.allowedMetaSections=[],this.bindEvents(),this.updateSectionType(this.format.st),DTUpdateQueueEventHandler.register(this.nodesToUpdate)}function DTHeaderFooterSection(e,t,i){DTSection.apply(this,arguments),this.hfType=parseInt(this.format.hftype),this.allowedMetaSections=[SECTION_TYPES.TEXTBOX]}function DTContentSection(e,t,i){DTSection.apply(this,arguments),this.breakType=null,this.hftype=0,this.hfTypeDetails=null,this.borders=null,this.updateProperties(this.format),this.refreshStatus=!0,this.allowedMetaSections=META_SECTIONS}function DTMetaSection(e,t,i){DTSection.apply(this,arguments),this.containingParaNode=null}function PageLayout(){this.paperSize="Letter"}function PUtil(){}function MsgHandler(){}function ZWCollaboration(){}function whenAlways(e){var t=new Deferred,i=[],n=function(){if(i.push(1===arguments.length?arguments[0]:arguments),0==e.length)t.resolve.apply(t,i);else{var r=e.shift();Deferred.when(r).always(n)}};if(0==e.length)t.resolve.apply(t,i);else{var r=e.shift();Deferred.when(r).always(n)}return t.promise()}function BatchAsyncOperationProcessor(e,t){this.itrIdx=0,this.responseList=[],this.batchSize=e,this.operationFn=t.fn,this.operationData=t.data||[],this.operationContext=t.context||null}function writerConfig(){}function UIUtils(){}function CommonError(){}var DTEventManager=function(e){"use strict";var t=function(t){e.publish(DOCUMENT.LOADING_PROGRESS,t)},i=function(t){e.publish(DOCUMENT.COMMAND_PROGRESS,t)},n=function(){e.publish(DOCUMENT.DOCTREE_DESTROYED)},r=function(r,o){e.publish(DOCUMENT.DOCTREE_INITIALIZED,r),o.on(DOCUMENT.LOADING_PROGRESS,t,this),o.on(DOCUMENT.COMMAND_PROGRESS,i,this),o.on(DOCUMENT.DOCTREE_DESTROYED,n,this)},o=function(e){e.off(DOCUMENT.LOADING_PROGRESS,t,this),e.off(DOCUMENT.COMMAND_PROGRESS,i,this),e.off(DOCUMENT.DOCTREE_DESTROYED,n,this)};return{register:r,unRegister:o}}(PubSub),DTViewEventManager=function(e){"use strict";var t=function(t,i,n){e.publish(DTVIEW.SECTION_OP_PROCESSED,t,i,n)},i=function(i){e.publish(DOCUMENT.DTVIEWMANAGER_INITIALIZED,i),i.on(DTVIEW.SECTION_OP_PROCESSED,t,this)},n=function(e){e.off(DTVIEW.SECTION_OP_PROCESSED,t,this)};return{register:i,unRegister:n}}(PubSub),DocLayoutEventManager=function(e){"use strict";function t(t){e.publish(DOCVIEW.LINE_ADDED,t)}function i(t){e.publish(DOCVIEW.LINE_UPDATED,t)}function n(t){e.publish(DOCVIEW.LINE_BEFORE_REMOVE,t)}function r(t){e.publish(DOCVIEW.PAGE_CREATED,t)}function o(t){e.publish(DOCVIEW.PAGE_REMOVED,t)}function a(t){e.publish(DOCVIEW.CURRENT_GROUP_LAYOUT_CHANGED,t)}function s(){e.publish("Document/Pagination/Complete")}function l(t){null==editor.subAction||editor.subAction.state||e.publish("Document/Paginated",t,t.documentLayoutManager.isPagesPendingToPaginate())}function d(t){e.publish(DOCUMENT.MAX_PAGE_WIDTH_UPDATED,t)}function c(t){e.publish(DOCUMENT.LAYOUT_MANAGER_INITIALIZED,t)}function u(t){var i;switch(t.getType()){case VIEW.PARA:i=DOCVIEW.PARAVIEW_AFTER_CREATE;break;case VIEW.CELL:i=DOCVIEW.CELLVIEW_AFTER_CREATE;break;case VIEW.ROW:i=DOCVIEW.ROWVIEW_AFTER_CREATE;break;case VIEW.TABLE:i=DOCVIEW.TABLEVIEW_AFTER_CREATE;break;case VIEW.HR:i=DOCVIEW.HRVIEW_AFTER_CREATE;break;case VIEW.TOC:i=DOCVIEW.TOCVIEW_AFTER_CREATE;break;default:i=DOCVIEW.VIEW_AFTER_CREATE}e.publish(i,t.getNode())}function g(t){var i;switch(t.getType()){case VIEW.PARA:i=DOCVIEW.PARAVIEW_AFTER_UPDATE;var n=t.getParent();n.getType()===VIEW.CELL&&n.getTable().getNode().containsHeaderRow&&e.publish("Document/Table/HeaderView/Update");break;case VIEW.CELL:i=DOCVIEW.CELLVIEW_AFTER_UPDATE;break;case VIEW.ROW:i=DOCVIEW.ROWVIEW_AFTER_UPDATE;break;case VIEW.TABLE:i=DOCVIEW.TABLEVIEW_AFTER_UPDATE;break;case VIEW.HR:i=DOCVIEW.HRVIEW_AFTER_UPDATE;break;case VIEW.TOC:i=DOCVIEW.TOCVIEW_AFTER_UPDATE;break;default:i=DOCVIEW.VIEW_AFTER_UPDATE}e.publish(i,t.getNode())}function h(t){e.publish(DOCVIEW.VIEW_AFTER_UPDATE_LIST,t.getNode())}function f(t){var i;switch(t.getType()){case VIEW.PARA:i=DOCVIEW.PARAVIEW_BEFORE_REMOVE;break;case VIEW.CELL:i=DOCVIEW.CELLVIEW_BEFORE_REMOVE;break;case VIEW.ROW:i=DOCVIEW.ROWVIEW_BEFORE_REMOVE;break;case VIEW.TABLE:i=DOCVIEW.TABLEVIEW_BEFORE_REMOVE;break;case VIEW.HR:i=DOCVIEW.HRVIEW_BEFORE_REMOVE;break;case VIEW.TOC:i=DOCVIEW.TOCVIEW_BEFORE_REMOVE;break;default:i=DOCVIEW.VIEW_BEFORE_REMOVE}e.publish(i,DocLayoutManager.getViews(t.getNode()))}function p(t){var i,n=t.getSectionType();switch(n){case SECTION_TYPES.HEADER:i="header/changed";break;case SECTION_TYPES.FOOTER:i="footer/changed"}e.publish(i,t)}function E(){this.handlePageBackgroundUpdate()}function T(t){e.unsubscribe("header/changed",T),e.unsubscribe("footer/changed",T);var i=t?t:DocLayoutManager.getCurrentSection();if(i&&i.isReplicableView()){var n=i.getSectionType();n==SECTION_TYPES.TEXTBOX&&(i=i.getRootSection()),i.trigger(DOCVIEW.AFTER_HF_SECTION_UPDATE,i)}e.subscribe("header/changed",T),e.subscribe("footer/changed",T)}function O(e){var t=EditorView.getCurrentMode();DocLayoutManager.getDocumentViewType()!=EDITORVIEW_TYPE.WEB_VIEW||e!=EDITOR_MODES.COLLABORATE&&t!=EDITOR_MODES.COLLABORATE||(EditorView.setCurrentMode(e),DocLayoutManager.reset())}var m=function(t){switch(t.getSectionType()){case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:e.publish("noteview/added",t)}},I=function(t){switch(t.getSectionType()){case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:e.publish("noteview/removed",t)}},D=function(t){switch(t.getSectionType()){case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:e.publish("noteview/attached",t)}},R=function(t){switch(t.getSectionType()){case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:e.publish("noteview/detached",t)}},S=function(S){S.on(DOCVIEW.SECTION_ADDED,m,this),S.on(DOCVIEW.SECTION_REMOVED,I,this),S.on(DOCVIEW.SECTION_ATTACHED,D,this),S.on(DOCVIEW.SECTION_BEFORE_DETACHED,R,this),S.on(DOCVIEW.AFTER_HF_SECTION_UPDATE,p,this),S.on(DOCVIEW.LINE_ADDED,t,this),S.on(DOCVIEW.LINE_UPDATED,i,this),S.on(DOCVIEW.LINE_BEFORE_REMOVE,n,this),S.on(DOCVIEW.PAGE_CREATED,r,this),S.on(DOCVIEW.PAGE_REMOVED,o,this),S.on(DOCVIEW.CURRENT_GROUP_LAYOUT_CHANGED,a,this),S.on(DOCVIEW.VIEW_AFTER_CREATE,u,this),S.on(DOCVIEW.VIEW_AFTER_UPDATE,g,this),S.on(DOCVIEW.VIEW_AFTER_UPDATE_LIST,h,this),S.on(DOCVIEW.VIEW_BEFORE_REMOVE,f,this),S.on(DOCVIEW.PAGE_PAGINATED,l,this),S.on(DOCUMENT.PAGINATION_COMPLETE,s,this),S.on(DOCUMENT.MAX_PAGE_WIDTH_UPDATED,d,this),S.on(DOCUMENT.LAYOUT_MANAGER_INITIALIZED,c,this),e.subscribe(DOCUMENT.PAGE_BACKGROUND_CHANGED,E.bind(S)),e.subscribe("header/changed",T),e.subscribe("footer/changed",T),e.subscribe("Document/ModeOpened",O)},C=function(S){S.off(DOCVIEW.SECTION_ADDED,m,this),S.off(DOCVIEW.SECTION_REMOVED,I,this),S.off(DOCVIEW.SECTION_ATTACHED,D,this),S.off(DOCVIEW.SECTION_BEFORE_DETACHED,R,this),S.off(DOCVIEW.AFTER_HF_SECTION_UPDATE,p,this),S.off(DOCVIEW.LINE_ADDED,t,this),S.off(DOCVIEW.LINE_UPDATED,i,this),S.off(DOCVIEW.LINE_BEFORE_REMOVE,n,this),S.off(DOCVIEW.PAGE_CREATED,r,this),S.off(DOCVIEW.PAGE_REMOVED,o,this),S.off(DOCVIEW.CURRENT_GROUP_LAYOUT_CHANGED,a,this),S.off(DOCVIEW.VIEW_AFTER_CREATE,u,this),S.off(DOCVIEW.VIEW_AFTER_UPDATE,g,this),S.off(DOCVIEW.VIEW_AFTER_UPDATE_LIST,h,this),S.off(DOCVIEW.VIEW_BEFORE_REMOVE,f,this),S.off(DOCVIEW.PAGE_PAGINATED,l,this),S.off(DOCUMENT.PAGINATION_COMPLETE,s,this),S.off(DOCUMENT.MAX_PAGE_WIDTH_UPDATED,d,this),S.off(DOCUMENT.LAYOUT_MANAGER_INITIALIZED,c,this),e.unsubscribe(DOCUMENT.PAGE_BACKGROUND_CHANGED,E.bind(S)),e.unsubscribe("header/changed",T),e.unsubscribe("footer/changed",T),e.unsubscribe("Document/ModeOpened",O)};return{register:S,unRegister:C}}(PubSub),EditorView;!function(){function e(){if(!editor.isNonEditableView()){var e=editor.doc.getBodyFormat();I=editor&&editor.doc&&e&&e[ATTR_BODY.DS_VIEW]||I,__viewWidth=editor&&editor.doc&&e&&e[ATTR_BODY.DS_VIEW_WIDTH]||"100%",I==E&&(I=T)}}function t(){return I||(I=T),editor.getView()==EDITOR_VIEWS.HISTORY&&HistoryUI.isDiffView()?T:I}function i(){return D}function n(e){f=e}function r(){return f}function o(e,t){var i=I,n=e;editor.isNonEditableView()||(e==E&&(e=T),(i!==n||i==m&&t!=D)&&editor.onResize(),I=e,t||(t="100%"),D=t)}function a(){if(p)s();else{J("#quickFixedView,#quickPageView,#quickWebView").removeClass("statusbar_acvtive"),J("#quickFullScreen").addClass("statusbar_acvtive"),J("#toolbarContainer,#ztb-topband,#remote_topband").hide();var e={position:"absolute",top:"5px",right:"21px","z-index":1e5,display:"block"},t=J("div#fullscreen_close");t[0]?t.css(e).show():J(document.createElement("div")).appendTo(document.body).attr("id","fullscreen_close").css(e).html('<div style="border-radius: 2px; display: inline-block; padding: 3px; background:#4d4d4d ; border: 1px solid #434345;"><span class="ui-components-icon ui-icon-closethick ui-fr" style ="cursor: pointer"></span><span style="float: left; margin-top: 2px; margin-right: 10px; color: #FFF;">'+J.i18n("common","FULL_SCREEN_CLOSE")+"</span></div>").bind("click",function(){J("#fullscreen_close").hide(),editor.editorOffset=editor.jeditorPane.offset(),EditorUtil.focusMultiByteSpan()}),J("#fullscreen_close").fadeOut(1e4,function(){J(this).hide()}),editor.getRole().permissions.can("document.edit")||J("#readonlyouter").hide(),DomUtil.setEditorHht(),editor.editorOffset=editor.jeditorPane.offset(),p=!0}PubSub.publish("Document/FullViewHandling"),setTimeout(function(){EditorUtil.focusMultiByteSpan(),editor.doc.getSelection().select()},100)}function s(){J("div#fullscreen_close").hide(),J("#toolbarContainer,#ztb-topband,#remote_topband").show(),editor.getRole().permissions.can("document.edit")||J("#readonlyouter").show(),J("#quickFullScreen").removeClass("statusbar_acvtive");var e=t();J("#quick"+e.replace(/\s/,"")).addClass("statusbar_acvtive"),DomUtil.setEditorHht(),editor.editorOffset=editor.jeditorPane.offset(),p=!1}function l(){return t()==T}function d(){return t()==O}function c(){return t()==m}function u(){return p}function g(){return!isV8Engine&&(PrintPreview&&PrintPreview.isPrintPreview())}function h(e){var t;if(isV8Engine)t=getDeviceWidth();else{t="undefined"!=typeof RemoteEditor&&RemoteEditor.options&&RemoteEditor.options.editor_width||editorProps.options&&editorProps.options.editor_width||document.body.offsetWidth;var n=i();f&&f==EDITOR_MODES.COLLABORATE&&(t-=354),c()&&n&&(t*=parseInt(n)/100),n&&100!=parseInt(n)||(t-=t/20)}if(!e){var r=DocTreeManager.doc.getFirstContentSection(),o=r.getFormats,a=(o.ml||"0in").convertor().pixels,s=(o.mr||"0in").convertor().pixels;t-=a+s}return t}var f,p=!1,E="Normal View",T="Fixed View",O="Page View",m="Web View",I="undefined"!=typeof w_usersettings&&w_usersettings.view||O,D="100%";I==E&&(I=T),EditorView={initView:e,getView:t,gotoFullView:a,exitFullView:s,isFixedView:l,isPageView:d,isWebView:c,isFullView:u,isPrintView:g,width:h,setView:o,getViewWidth:i,setCurrentMode:n,getCurrentMode:r}}();var Z=function(){"use strict";var e={},t=function(t,i){var n;return n=isV8Engine?"":i?J("#"+t,"#"+i):J("#"+t),n[0]&&(e[t]=n),n},i=function(i,n){if(i)return e[i]?e[i]:t(i,n);if(!isV8Engine)return J(i)};return i}();Z.insertAt=function(e,t){var i=this.children.length;e=e<=i?Math.max(e,0):i,this.insertBefore(t,this.children[e])};var PluginExtender=function(){"use strict";var e=function(e,i){for(var n=e.prototype,r=0;r<i.length;r++){var o=i[r];for(var a in o)switch(a){case"constructor":e=t(e,o[a]),e.prototype=n,e.prototype.constructor=e;break;default:if(n.hasOwnProperty(a)){var s=null;s="destroy"==a?t(o[a],n[a]):t(n[a],o[a]),n[a]=s}else n[a]=o[a]}}return e},t=function(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}};return{extend:e}}();DesignUtil=function(){var e={"arial,helvetica,sans-serif":"Arial","arial black,avant garde":"Arial Black","courier new,courier,monospace":"Courier New","georgia,times new roman,times,serif":"Georgia","ms mincho,ipmincho,serif":"MSMincho","ms pmincho,ipapmincho,serif":"MSPMincho","tahoma,arial,helvetica,sans-serif":"Tahoma","times new roman,times,serif":"Times New Roman","trebuchet ms,geneva":"Trebuchet MS"},t=!1,i={};!function(){var t={},i="undefined"!=typeof editorProps?editorProps:{fonts:{}};for(var n in i.fonts){var r=i.fonts[n];t[r.value]=r.name}extend(e,t)}();var n=["name","styles","theme","styleUIInfo"],r=["name","char","para","shape","table"],o=["name","color","fmtScheme","font"],a=["h0","h1","h2","h3","h4","h5","h6","h7","h8","h9","h101","h102","h103","h104","h105","h106"],s=function(e){for(var t in e){var i=e[t];"object"==typeof i?s(i):"undefined"!=typeof i&&""===i&&delete e[t]}},l=function(e){var t={shape:{},para:{},char:{},table:{}};for(var i in e.para){var n=parseInt(i.substr(1));t.para.hasOwnProperty(i)||(t.para[i]={},t.para[i].status="visible",n>2&&n<=9&&(t.para[i].status="semihidden",t.para[i].showWhenUsed="h"+(n-1)))}return t},d=function(){var e={};return J.isEmptyObject(SavedStyles)?(SavedStyles=w_usersettings.SavedStyles?w_usersettings.SavedStyles:SavedStyles,e=SavedStyles.para?SavedStyles.para:{}):SavedStyles.para&&(e=SavedStyles.para),e},c=function(e,t){for(var i in e){var n=e[i];"object"==typeof n?c(n,t):i==ATTR_TEXT.TS_FF&&t.push(n)}},u=function(e,t){var i=[],n=!0;i[t.indexOf("name")]="name";for(var r in e){var o=t.indexOf(r);if(o==-1){n=!1;break}i[o]=r}return n?n=ZWArrayUtils.compareArray(t,i):void 0,n},g=function(e){var t;return t=!!u(e,n)&&(!!u(e.styles,r)&&!!u(e.theme,o))},h=function(e){e=e.split(",")[0];for(var t="",i=e.split(" "),n=0;n<i.length;n++)t+=i[n].substring(0,1).toUpperCase()+i[n].substring(1),t+=n!=i.length?" ":"";return t},f=function(e,t){for(var i in t)e[i]&&"object"==typeof t[i]&&"para"==i?f(e[i],t[i]):e[i]=t[i]},p=function(e){var t=e.para;for(var i in t){var n=t[i],r=n.info;r&&r.next&&!t.hasOwnProperty(r.next)&&(r.next="h0")}},E=function(e){var t=function(e,i){for(var n in i)e[n]&&"object"==typeof i[n]&&"para"==n?t(e[n],i[n]):e[n]=i[n]},i=DocumentDesign.getStyles(),n=(DocumentDesign.getTheme(),DocumentDesign.getStyleUIInfo());t(i,e.styles),t(n,e.styleUIInfo),p(i);var r={styles:i,theme:e.theme,styleUIInfo:n};return r},T=function(e,t,i){if(p(e[ATTR_BODY.DS_STYLES]),!DesignUtil.isValidDesignData(e))return ZWLogger.sendErrorDetails("DesignSave<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"."+editor.doc.docInfo.RID+"<ZWERROR>\n Error Log Start \n buildLabel: "+buildLabel+"\n Error Log End \n <ZWERROR>#### DesignSave Error: \n\n AditionalInfo: Attempt to save design with invalid design data  #####",null,ZWCollaboration.CORRUPTED_DESIGN_DATA_SAVE),void PubSub.publish("Document/Error",{title:"UH_OH",errorNo:ZWCollaboration.CORRUPTED_DESIGN_DATA_SAVE,errorMsg:"MSG_CORRUPTED_DESIGN"});SavedDesign[t]=e;var n={};csrfParamName&&(n[csrfParamName]=getcsrf()),n.SavedDesign=JSON.stringify(SavedDesign),J.post(ZWNetworkUtils.getNiceUrlPrefix("user/settings/savedesign"),n,function(){i(),PubSub.publish("DocumentDesign/UserDesign/Updated")})},O=function(){var e=DesignUI.getDesignFromDialog(),t=e.design,i=e.type,n={},r=/[0-9a-zA-Z_\-\.\$@\?\,\:\'\/\!\s]+/g,o=e.name;if("undefined"==typeof o||!r.test(o))return void J.dialogutil.close("designdialog");var a=t[ATTR_BODY.DS_STYLE_UI_INFO];n.name=o,n[ATTR_BODY.DS_STYLES]=t[ATTR_BODY.DS_STYLES],n[ATTR_BODY.DS_THEME]={name:t[ATTR_BODY.DS_THEME].name||"",font:t[ATTR_BODY.DS_THEME].font,color:t[ATTR_BODY.DS_THEME].color,fmtScheme:t[ATTR_BODY.DS_THEME].fmtScheme||{}},n[ATTR_BODY.DS_STYLE_UI_INFO]=a;var s=n[ATTR_BODY.DS_STYLES].para;for(var l in s)a.para[l]&&a.para[l].hasOwnProperty("deleted")&&(delete s[l],delete a.para[l]);if(p(n[ATTR_BODY.DS_STYLES]),!DesignUtil.isValidDesignData(n))return ZWLogger.sendErrorDetails("DesignSave<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"."+editor.doc.docInfo.RID+"<ZWERROR>\n Error Log Start \n buildLabel: "+buildLabel+"\n Error Log End \n <ZWERROR>#### DesignSave Error: \n\n AditionalInfo: Attempt to save design with invalid design data  #####",null,ZWCollaboration.CORRUPTED_DESIGN_DATA_SAVE),void PubSub.publish("Document/Error",{title:"UH_OH",errorNo:ZWCollaboration.CORRUPTED_DESIGN_DATA_SAVE,errorMsg:"MSG_CORRUPTED_DESIGN"});if("user"==i){o="custom|"+o,SavedDesign[o]&&delete DesignSets[o],SavedDesign[o]=n;var d={};d.SavedDesign=JSON.stringify(SavedDesign),UIUtils.showLoadingMsg(J.i18n("writer.design.SAVING_DESIGN")+"..."),J.ajax({type:"post",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/savedesign"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},data:d,success:function(){UIUtils.hideLoadingMsg(),PubSub.publish("Design/UserDesign/Save/Success",o,n)},failure:function(){}}),PubSub.publish("Design/UserDesign/SaveStarted",o)}else"org"==i&&(UIUtils.showLoadingMsg(J.i18n("writer.design.SAVING_DESIGN")),P(n,o,function(e){UIUtils.hideLoadingMsg(),PubSub.publish("Design/OrgDesign/Save/Success",e.name,e.type)},function(){UIUtils.hideLoadingMsg(),PubSub.publish("Design/OrgDesign/Save/Failure",obj.name,obj.type)}),PubSub.publish("Design/OrgDesign/SaveStarted",o));J.dialogutil.close("designdialog")},m=function(e,t){SavedDesign[e]=ZWJSONUtils.clone(SavedDesign[t]),delete SavedDesign[t];var i={};csrfParamName&&(i[csrfParamName]=getcsrf()),i.SavedDesign=JSON.stringify(SavedDesign),UIUtils.showLoadingMsg(J.i18n("writer.design.RENAMING_DESIGN")+"..."),J.post(ZWNetworkUtils.getNiceUrlPrefix("user/settings/savedesign"),i,function(){UIUtils.hideLoadingMsg(),UIUtils.showMessage("info",J.i18n("writer.design.DESIGN_RENAMED"),!0,"normalfont",1e3),PubSub.publish("Design/UserDesign/Rename/Success",e)})},I=function(e){var t=e.indexOf("custom|")!=-1?e.substr("custom|".length):e,i=J.i18n("writer.design.DELETE_DESIGN_MSG").replace("{0}",t);MsgDialog.showMessage(CONST.MSG_TYPE_DELETECANCEL,"info",J.i18n("writer.design.DELETE_DESIGN"),i,null,function(t){if(1==t){delete SavedDesign[e];var i={};i.SavedDesign=JSON.stringify(SavedDesign),J.ajax({type:"post",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/savedesign"),beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},data:i,success:function(){UIUtils.showMessage("info",Utils.encodeHTMLString(e.substr("custom|".length))+" "+J.i18n("writer.trackchange.DELETED"),!0,"normalfont",1e3),PubSub.publish("Design/UserDesign/Delete/Success",e)},failure:function(){}})}},null)},D=function(e){for(var t in e){var n=e[t];"undefined"==typeof n.content&&delete e[t]}i=ZWJSONUtils.clone(e)},R=function(e){return e?ZWJSONUtils.clone(i[e]):ZWJSONUtils.clone(i)},S=function(e,t,i){var n=R(i).content;UIUtils.showLoadingMsg(J.i18n("writer.design.RENAMING_DESIGN")+"..."),N(n,i,e,function(){UIUtils.hideLoadingMsg(),UIUtils.showMessage("info",J.i18n("writer.design.DESIGN_RENAMED"),!0,"normalfont",1e3)},null)},C=function(e){var t=i[e].name,n=J.i18n("writer.design.DELETE_DESIGN_MSG").replace("{0}",t);MsgDialog.showMessage(CONST.MSG_TYPE_DELETECANCEL,"info",J.i18n("writer.design.DELETE_DESIGN"),n,null,function(n){if(1==n){var r="/"+Macros.getContextName()+"/api/v1/library/design/"+e;J.ajax({type:"delete",url:r,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(){delete i[e],UIUtils.hideLoadingMsg(),UIUtils.showMessage("info",Utils.encodeHTMLString(t)+" "+J.i18n("writer.trackchange.DELETED"),!0,"normalfont",1e3),PubSub.publish("Design/OrgDesign/Delete/Success",e)}})}},null),UIUtils.showLoadingMsg(J.i18n("writer.design.DELETING_DESIGN")+"...")},A=function(){return t},v=function(e,i){var n="/"+Macros.getContextName()+"/api/v1/library/design",r={type:"organization"};r.rid=editor.doc.docInfo.RID,PubSub.publish("Design/OrgDesign/RetrieveStarts"),J.ajax({type:"GET",data:r,url:n,success:function(i){for(var n=i.files,r={},o=0,a=n.length;o<a;o++){var s=n[o];r[s.id]={content:s.content,name:s.name}}t=!0,e&&e(),PubSub.publish("Design/OrgDesign/Retrieved",r)},failure:function(){t=!1,UIUtils.showMessage("error",J.i18n("writer.design.PROBLEM_IN_FETCHING_ORG_DESIGN"),!0,"normalfont",5e3),i&&i(),PubSub.publish("Design/OrgDesign/Retrieve/Failed")}})},_=function(e,t){var i="user"==t?SavedDesign:DesignSets,n={};n[ATTR_BODY.DS_STYLES]=i[e][ATTR_BODY.DS_STYLES],n[ATTR_BODY.DS_THEME]=i[e][ATTR_BODY.DS_THEME],n[ATTR_BODY.DS_STYLE_UI_INFO]=i[e][ATTR_BODY.DS_STYLE_UI_INFO];var r="user"==t?e.replace("custom|",""):e;P(n,r,function(e){UIUtils.hideLoadingMsg(),UIUtils.showMessage("info",Utils.encodeHTMLString(r)+" "+J.i18n("writer.design.DESIGN_COPIED_TO_ORG"),!0,"normalfont",1e3),PubSub.publish("Design/OrgDesign/Save/Success",e)},function(){}),UIUtils.showLoadingMsg(J.i18n("writer.design.COPYING_DESIGN")+"...")},P=function(e,t,n,r){var o={name:t,content:JSON.stringify(e),rid:editor.doc.docInfo.RID,type:"organization"},a="/"+Macros.getContextName()+"/api/v1/library/design";J.ajax({url:a,data:o,type:"POST",dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(r){var o={name:t,design:e,id:r.id,type:"org"};i[r.id]={content:r.content,name:r.name},n&&n(o)},error:function(){r&&r()}})},N=function(e,t,n,r,o){var a={content:JSON.stringify(e)},s="/"+Macros.getContextName()+"/api/v1/library/design/"+t;n&&(a.name=n),J.ajax({url:s,data:a,type:"POST",dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){var n={name:name,design:e,id:t.id,type:"org"};i[t.id]={content:t.content,name:t.name},PubSub.publish("Design/OrgDesign/Save/Success"),r&&r(n)},error:function(){o&&o()}})},b=function(e,t,i){var n=(editor.doc.getSelection().getParents(NODE_TYPE.BODY),{});if("user"==t&&e.indexOf("custom|")!=-1)n[ATTR_BODY.DS_STYLES]=SavedDesign[e][ATTR_BODY.DS_STYLES],n[ATTR_BODY.DS_THEME]=SavedDesign[e][ATTR_BODY.DS_THEME],n[ATTR_BODY.DS_STYLE_UI_INFO]=SavedDesign[e][ATTR_BODY.DS_STYLE_UI_INFO];else if("org"==t){var r=R();n[ATTR_BODY.DS_STYLES]=r[i].content[ATTR_BODY.DS_STYLES],n[ATTR_BODY.DS_THEME]=r[i].content[ATTR_BODY.DS_THEME],n[ATTR_BODY.DS_STYLE_UI_INFO]=r[i].content[ATTR_BODY.DS_STYLE_UI_INFO]}else n[ATTR_BODY.DS_STYLES]=DesignSets[e][ATTR_BODY.DS_STYLES],n[ATTR_BODY.DS_THEME]=DesignSets[e][ATTR_BODY.DS_THEME],n[ATTR_BODY.DS_STYLE_UI_INFO]=DesignSets[e][ATTR_BODY.DS_STYLE_UI_INFO];var o=n[ATTR_BODY.DS_THEME];UIUtils.showLoadingMsg(J.i18n("common","UPDATING")),ZWLogger.log("@applyDesign-->addFonts"),setTimeout(function(){var i=[];c(n[ATTR_BODY.DS_STYLES],i),i=U.uniq(i),i=i.concat(Utils.getThemeFonts(o)),editor.addFonts(i,frames.metricsFrame,function(){n=DesignUtil.constructDocDesignObj(n),M(n),UIUtils.hideLoadingMsg(),e="user"==t?e.substr("custom|".length):e,msg=J.i18n("writer.design.DESIGN_APPLIED_TO_DOCUMENT").replace("{0}",Utils.encodeHTMLString(e)),UIUtils.showMessage("info",msg,!0,"normalfont",2500)})},0)},L=function(){var e,t=(editor.doc.getSelection().getParents(NODE_TYPE.BODY),{});t[ATTR_BODY.DS_STYLES]=DocUtil.copyStyle(DesignSets[DefaultDesignName][ATTR_BODY.DS_STYLES]),t[ATTR_BODY.DS_THEME]=e=DocUtil.copyStyle(DesignSets[DefaultDesignName][ATTR_BODY.DS_THEME]),t[ATTR_BODY.DS_STYLE_UI_INFO]=DesignSets[DefaultDesignName][ATTR_BODY.DS_STYLE_UI_INFO];var i=function(i){if(1==i){UIUtils.showLoadingMsg(J.i18n("common","LOADING")),ZWLogger.log("@resetDesign-->addFonts");var n=[];c(t[ATTR_BODY.DS_STYLES],n),n=U.uniq(n),n=n.concat(Utils.getThemeFonts(e)),editor.addFonts(n,frames.metricsFrame,function(){UIUtils.hideLoadingMsg(),t=DesignUtil.constructDocDesignObj(t),M(t)})}};MsgDialog.showMessage(CONST.MSG_TYPE_YESNO,"info",J.i18n("writer.design.RESET_DESIGN"),J.i18n("writer.design.RESET_DESIGN_MSG"),null,i)},w=function(e){var t=ZWJSONUtils.clone(e);QuickStyle.updateDefaultStyleandTheme(e);var i,n=DesignUI.getDesignName(t),r=n?n.name:"";r=r?r:"Custom",r=r.indexOf("custom|")!=-1?r.substr("custom|".length):r,i=J.i18n("writer.design.DEFAULT_DESIGN_SETUP_DONE").replace("{0}",Utils.encodeHTMLString(r)),UIUtils.showMessage("info",i,!0,"normalfont",2500),PubSub.publish("Document/DefaultDesign/updated")},y=function(e,t){if(e="user"==t?"custom|"+e:e,"user"==t&&SavedDesign.hasOwnProperty(e))return!0;if("org"==t){var i=R();for(var n in i){var r=i[n];if(r.name==e)return!0}}return!1},M=function(e){var t=ListOperation.getHeadingListId();if(null!=t){var i=ListUtils.getAllHeadingsForList(),n={};n.id=t,ListOperation.removeHeadingListProperitesForParas(i,n)}editor.doc.execCmd("changeDesign",e)},F=function(e,t){var i={};i.name="custom|"+e.designName,i[ATTR_BODY.DS_STYLES]=e.styles,i[ATTR_BODY.DS_STYLE_UI_INFO]=e.styleUIInfo,i[ATTR_BODY.DS_THEME]=e.theme,i[ATTR_BODY.DS_THEME].font.name="",i[ATTR_BODY.DS_THEME].color.name="";var n=i[ATTR_BODY.DS_STYLES].para,r=e.styleUIInfo;for(var o in n)r.para[o]&&r.para[o].hasOwnProperty("deleted")&&delete n[o];if(p(i[ATTR_BODY.DS_STYLES]),!g(i))return ZWLogger.sendErrorDetails("DesignSave<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"."+editor.doc.docInfo.RID+"<ZWERROR>\n Error Log Start \n buildLabel: "+buildLabel+"\n Error Log End \n <ZWERROR>#### DesignSave Error: \n\n AditionalInfo: Attempt to save design with invalid design data  #####",null,ZWCollaboration.CORRUPTED_DESIGN_DATA_SAVE),PubSub.publish("Document/Error",{title:"UH_OH",errorNo:ZWCollaboration.CORRUPTED_DESIGN_DATA_SAVE,errorMsg:"MSG_CORRUPTED_DESIGN"}),void t(!1);SavedDesign[i.name]=i;var a={};csrfParamName&&(a[csrfParamName]=getcsrf()),a.SavedDesign=JSON.stringify(SavedDesign),J.post(ZWNetworkUtils.getNiceUrlPrefix("user/settings/savedesign"),a,function(){PubSub.publish("Design/UserDesign/Save/Success",i.name,i),t(!0)})},V=function(e){if("undefined"!=typeof FontSets)for(var t in FontSets)if(StyleUtil.compareStyleJson(e,FontSets[t]))return t},B=function(e){if("undefined"!=typeof ColorSets)for(var t in ColorSets)if(StyleUtil.compareStyleJson(e,ColorSets[t]))return t},x=function(e){if("undefined"!=typeof DesignSets)for(var t in DesignSets)if(StyleUtil.compareStyleJson(DesignSets[t][ATTR_BODY.DS_STYLES].para,e.para))return t},W=function(){if(G()&&!H()&&docProps.info.ZID_ADMIN_ZUIDS.indexOf(parseInt(editor.zuid))!=-1)return!0},H=function(){return!(!G||!docProps.info.EDITION||"PERSONAL"!=docProps.info.EDITION)},G=function(){return!(!docProps.info.SERVICE||"TeamDrive"!=docProps.info.SERVICE)},k=function(e){var t=parseInt(e[0]),i=parseInt(e[1]),n=parseInt(e[2]),r=(Math.max(t/255,i/255,n/255)+Math.min(t/255,i/255,n/255))/2,o=ZWColorUtils.rgbToHsl(t,i,n),a=o.h,s=o.s,l=o.l,d=[],c=[],u=[],r=255*r;r>=248&&r<=255?(c=[.05,.15,.25,.35,.5],u=[]):r>=0&&r<=15?(c=[],u=[.5,.35,.25,.15,.05]):r>=210&&r<248?(c=[.1,.25,.5,.75,.9],u=[]):r>15&&r<=48?(c=[],u=[.9,.75,.5,.25,.1]):(c=[.25,.5],u=[.8,.6,.4]);for(var g=u.length,h=c.length,f=0;f<g;f++){var p=100*u[f];ZWColorUtils.hslToRgb(a,s,l*p+(1-p));d.push({function:"lighten",percent:p})}for(var f=0;f<h;f++){var p=100*c[f];ZWColorUtils.hslToRgb(a,s,l*p);d.push({function:"darken",percent:p})}return d};return PubSub.subscribe("Design/OrgDesign/Retrieved",D),{getSavedParaStyles:d,getOrgDesign:R,deleteOrgDesign:C,updateOrgDocumentDesign:N,refineFormatObj:s,getDefaultStyleUIInfo:l,docDefaultHeadings:a,isValidDesignData:g,getStrippedFontName:h,styleMerge:f,constructDocDesignObj:E,saveDocumentDesign:O,deleteDocumentDesign:I,renameUserDesign:m,updateUserDocumentDesign:T,copyToOrgDesign:_,retreiveOrgDesign:v,applyDesign:b,resetDesign:L,setAsDefault:w,renameOrgDesign:S,isDesignNameAlreadyExists:y,saveImportedDesign:F,getFontName:V,getColorName:B,getStyleSetName:x,getTones:k,isOrgAdmin:W,isWorkDrivePersonalUser:H,isWorkdriveUser:G,orgDesignFetchStatus:A}}(),DocumentDesign=function(){"use strict";var e=(Object.create(null),Object.create(null)),t=Object.create(null),i={},n=[],r={ff:"Roboto",size:"12"},o={1:{fgc:"zwdark1/25",fs:"italic"},2:{fs:"italic"},3:{fw:"bold",fs:"italic"},4:{fw:"bold"},5:{fv:"small-caps",td:"underline",fgc:"zwdark1/25"},6:{fv:"small-caps",td:"underline",cs:"0.25pt",fw:"bold"},7:{fv:"small-caps",fw:"bold"}},a=function(e){d(e)},s=function(t){var r=t.info.basedOn;if(r&&n.indexOf(r)==-1){if(n.push(r),!i.hasOwnProperty(r)){var o=g(r);0==Object.keys(o).length&&(r="h0",o=g(r)),i[r]=s(o),i[r].info=e.para[r].info}return DocUtil.mergeObjs([i[r],t])}return t},l=function(e){n=new Array;var t=s(e);return t.info=e.info,t},d=function(n){var a=n?n:editor.doc.getBodyFormat();i={},e=DocUtil.copyStyle(a[ATTR_BODY.DS_STYLES]),e.hasOwnProperty("char")||(e.char=JSON.parse(JSON.stringify(o))),DesignUtil.refineFormatObj(e.para);var s=e.para,l=s.h0;!U.isEmpty(l.textFormat)&&l.textFormat.hasOwnProperty("ff")&&l.textFormat.hasOwnProperty("size")||(l.textFormat=DocUtil.mergeObjs([r,l.textFormat]));var d=!1;for(var u in s)s[u].info||(d?void 0:d=!0,s[u].info={},s[u].info.next="h0"),"h0"==u||s[u].info.hasOwnProperty("basedOn")||(s[u].info.basedOn="h0"),DesignUtil.docDefaultHeadings.indexOf(u)==-1&&U.isEmpty(s[u].info.cs_name)&&(s[u].info.cs_name="unnamed"),s[u].textFormat||(s[u].textFormat={});t=DocUtil.getRenderingFormat(e),t.para=c(t)},c=function(e){var t={};for(var n in e.para)i.hasOwnProperty(n)?t[n]=JSON.parse(JSON.stringify(i[n])):(t[n]=l(e.para[n]),i[n]=t[n]);return t},u=function(){return JSON.parse(JSON.stringify(editor.doc.getBodyFormat().theme))},g=function(t){return e.para.hasOwnProperty(t)?JSON.parse(JSON.stringify(e.para[t])):{}},h=function(){return JSON.parse(JSON.stringify(e))},f=function(t){return e.char.hasOwnProperty(t)?JSON.parse(JSON.stringify(e.char[t])):{}},p=function(){return JSON.parse(JSON.stringify(t))},E=function(e){return i.hasOwnProperty(e)?JSON.parse(JSON.stringify(i[e])):{}},T=function(){var e={};return e[ATTR_BODY.DS_STYLES]=h(),e[ATTR_BODY.DS_THEME]=u(),e[ATTR_BODY.DS_STYLE_UI_INFO]=O(),e},O=function(){return JSON.parse(JSON.stringify(editor.doc.getBodyFormat().styleUIInfo))};return{initialize:a,update:d,getParaStyle:g,getStyles:h,getTheme:u,getCharStyle:f,getComputedParaStyle:E,getComputedStyles:p,getStyleUIInfo:O,getDesign:T}}(),ImageCache=function(){"use strict";var e,t,i={},n={},r={},o={},a=[],s=function(){return e?e:(e=document.createElement("div"),J(e).attr("id","imageCopy").css({position:"absolute",width:200,height:200,overflow:"auto",left:-1e4,top:-1e4}),document.body.appendChild(e),e)},l=function(e,t){var n={};e[ATTR_IMAGE.I_ID]?void 0:e[ATTR_IMAGE.I_ID]=Utils.getRandomNumber();var r=e[ATTR_IMAGE.I_ID];if(r=t?r+"_"+t:r,i.hasOwnProperty(r)&&i[r].src===e.src)n.type="cached",n.image=i[r].element;else{var o=DocUtil.copyStyle(e);DocLayoutManager.isImagePreviewEnabled()&&DocUtils.isImage(e)&&(o.ht=0,o.wid=0),i[r]={element:DomUtil.createSvgImage(o),src:e.src},n.type="new",n.image=i[r].element}return"cached"==n.type&&J(n.image).find("div").remove(),n},d=function(e){return n[e]},c=function(e){if(!("PUBLIC"==editor.doc.getRole()||isHeadlessPDF||isHeadlessHTML||isV8Engine)){var t=s();if(e=Macros.getImageSrcWithRid(e),e=!e||e.indexOf("image.do")==-1&&e.indexOf("remoteImage.do")==-1?e:ZWNetworkUtils.getContextUrl(e),!n.hasOwnProperty(e)){var i=document.createElement("img");t.appendChild(i),i.onload=function(t){t.target;n[e]=i},i.setAttribute("src",e+"#"+(new Date).getTime())}}},u=function(e,t){e=t?e+"_"+t:e,delete i[e]},g=function(e){if(e&&e.type){var i=e.type;switch(i){case NODE_TYPE.IMAGE:!e.hasOwnProperty("shapeData")&&e.src&&a.push(e.src);break;case NODE_TYPE.CELL:case NODE_TYPE.TABLE:e.bgimg&&"none"!=e.bgimg&&a.push(e.bgimg)}t||(t=setInterval(function(){0==a.length?(clearInterval(t),t=void 0):ImageCache.loadImageForCopy(a.pop())},500))}},h=function(e){return URL.createObjectURL(e)},f=function(e){return r[e]},p=function(e){return o[e]},E=function(e){var t=e[0],i=e[1],n=e[2],a=e[3];if("uploading"==i&&void 0!=n&&(r[t]=h(n.imageFile),o[t]=a),"success"==i&&r.hasOwnProperty(t)){t.indexOf("image.do")==-1&&t.indexOf("remoteImage.do")==-1||(t=Macros.getImageSrcWithRid(t),t=ZWNetworkUtils.getContextUrl(t));var s=t.indexOf("?")!=-1?"&t=":"?t=";t=t+s+(new Date).getTime();var l=document.createElement("img");J(l).css({position:"absolute",top:-100,left:-100,opacity:.1,width:10,height:10}),document.body.appendChild(l),l.src=t,l.onload=function(){delete r[t]}}};return isV8Engine||(PubSub.subscribe(["Document/ImageBlockConstructed","Table/Create","Table/Update","Cell/Create","Cell/Update"],g),PubSub.subscribe(["externalImage/uploadStatus"],E)),{loadImageForCopy:c,getRenderingImageData:l,getCopyImageData:d,removeFromCache:u,getURIForImgURL:f,getBytesForURL:p}}();var ViewInitializer=function(){"use strict";var e=function(e,t){var i=editor.editorConfig.getRenderingLayers();i.contains(RENDERING_LAYERS.DTVIEW)&&(DocTreeViewManager=new DTViewManager(t),DTViewEventManager.register(DocTreeViewManager))},t=function(e,t){var n=editor.editorConfig.getRenderingLayers();DTEventManager.register(e,t);var r=i();if(r===EDITORVIEW_TYPE.PUBLISH_VIEW&&(editorProps.isWebLayout||editorProps.isFixedLayout)){var o;o=editorProps.isFixedLayout?HTMLVIEW_TYPE.FIXED_VIEW:HTMLVIEW_TYPE.WEB_VIEW;var a={shouldCleanHTML:editorProps.isCleanHTML||!1,isDarkMode:editorProps.darkmode||!1,renderStylesAs:editorProps.styles||RENDER_STYLES.AS_INLINE};DocLayoutManager=new HTMLLayoutManager(e,DocTreeViewManager,o,a),DomViewManager=new HTMLDomViewManager(DocLayoutManager)}else{var s=!editor.isDeferredDocLoading;n.contains(RENDERING_LAYERS.DOCVIEW)&&(DocLayoutManager=new DocumentLayoutManager(e,DocTreeViewManager,r,s)),n.contains(RENDERING_LAYERS.DOMVIEW)&&(DomViewManager=new EditorDomViewManager(DocLayoutManager))}n.contains(RENDERING_LAYERS.DOCVIEW)&&DocLayoutEventManager.register(DocLayoutManager),n.contains(RENDERING_LAYERS.DOMVIEW)&&DomViewEventManager.register(DomViewManager),DocLayoutManager&&DocLayoutManager.init()},i=function(){var e;return e=isHeadlessHTML||editorProps.isPublishView||"PUBLIC"===editor.doc.getRole()?editorProps.isPublishToFill?EditorView.getView():EDITORVIEW_TYPE.PUBLISH_VIEW:EditorView.getView()},n=function(){DomViewManager&&(DomViewEventManager.unRegister(DomViewManager),DomViewManager.destroy()),DocLayoutManager&&(DocLayoutEventManager.unRegister(DocLayoutManager),DocLayoutManager.destroy()),DocTreeViewManager&&(DTViewEventManager.unRegister(DocTreeViewManager),DocTreeViewManager.destroy()),DTEventManager.unRegister(DocTreeManager.doc)},r=function(){var i=!!editorProps.options&&editorProps.options.isMergeZdoc;i||DocTreeManager.on(DOCUMENT.DOCTREE_INITIALIZED,e);var n=editor.doc.findNextIndexOf(UNICODE.TOCSTART,0)!=-1,r=!!editorProps.options&&(editorProps.options.isMailMerge&&!n);r&&isHeadlessPDF||DocTreeManager.on(DOCUMENT.DOCTREE_INITIALIZED,t)};return{init:r,initDocViewLayer:t,destroyDocViewLayer:n,getViewType:i}}(),EditorConfig=function(){"use strict";function e(e){this.editorProps=e,this.layers=[]}return extend(e.prototype,{updateEditorProps:function(e){this.editorProps=e},setEditorConfig:function(){this.layers=ALL_RENDERING_LAYERS,this.editorProps.options&&this.editorProps.options.isMergeZdoc&&(this.layers=[RENDERING_LAYERS.MODEL,RENDERING_LAYERS.DOCTREE]),isV8Engine&&(this.layers=[RENDERING_LAYERS.MODEL,RENDERING_LAYERS.DOCTREE,RENDERING_LAYERS.DTVIEW,RENDERING_LAYERS.DOCVIEW])},getRenderingLayers:function(){return this.layers}}),e}(),editor={},DomViewManager,DocLayoutManager,DocTreeManager,DocTreeViewManager,TableCollectionInstance,exportHTMLFrame,isFontNeedToBeLoaded=function(){var e={};return function(t){return e[t]||(e[t]=Utils.isWebFont(t)&&!FontUtils.isFontAvailableInSystem(t)),e[t]}}();EditorUtil=function(){},EditorUtil.focusMultiByteSpanTimer=void 0,EditorUtil.focusMultiByteSpan=function(e){if(!editor.jMbSpan_editableSpan||!editor.jMultiByteSpan)return void(!isV8Engine&&window.getSelection&&window.getSelection().removeAllRanges());editor.isCompositionEventStart||EditorUtil.updateMultiByteSpanLeft();var t=editor.jMbSpan_editableSpan;if(t[0].focus(),!isV8Engine)if(editor.browserInfo.isWebkit||editor.browserInfo.isGecko||editor.browserInfo.isPresto){t.html("&nbsp;");var i=document.createRange();i.selectNodeContents(t[0]);var n=window.getSelection();n.removeAllRanges(),"Linux"===editor.browserInfo.platform&&editor.browserInfo.is_firefox||i.collapse(!0),n.addRange(i)}else{t.html("&#8203;");var i=document.body.createTextRange();i.moveToElementText(t[0]),i.select(i.collapse(!1))}},EditorUtil.moveToIndex=function(e){var t=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),i=editor.doc.getSelection(),n=editor.doc.createRange(e);i.removeAllRanges().addRange(n),DomUtil.scrollElementIntoView(t[0],500,!0),CurUtil.scrollTop=editor.editorPaneContainer[0].scrollTop,editor.editorOffset=editor.jeditorPane.offset(),CurUtil.blinkCursor();var r=DocTreeManager.doc.getSection(i.getStart());EventHandler.setClientActiveSection(r),EventHandler.toggleSection()},EditorUtil.updateMultiByteSpanLeft=function(){var e=editor.editorPaneContainer.scrollLeft()/editor.zoomFactor;DomViewManager&&DomViewManager.isMultiplePagesInRow()&&(e=DomViewManager.getCurrentSectionLeft(ABSOLUTE_TO.WINDOW)),editor.jMultiByteSpan.css({left:e,"z-index":0})},EditorUtil.positioningMultiByteSpan=function(){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start").css("visibility","hidden"),t=J("#cursorSpan"),i=editor.doc.getSelection(),n=i.getComputedTextFormat(),r=i.getFirstRange(),o=r.getStartPortionData(),a=o.node,s=o.line,l=s.parent;if(!t[0]){var d=n[ATTR_TEXT.TS_BGC]||J(a).css("background-color");d&&"transparent"!=d||(d=editor.doc.getBodyFormat()[ATTR_BODY.DS_BGC]),t=J(document.createElement("span")).attr("id","cursorSpan").css("color",d),DomUtil.placeNode(a.firstChild,o.cursorPos,t[0])}var c;if(jQuery.isEmptyObject(n))(c=J(a).attr("style"))&&editor.jMbSpan_editableSpan.attr("style",c);else{DomUtil.setStyle(editor.jMbSpan_editableSpan[0],n);var u=i.getParaFormat();u&&editor.jMultiByteSpan.css("line-height",u[ATTR_PARAGRAPH.PS_LS])}var g=editor.doc.getRawFormatAt(l.getEndIndex())||{},h=DocLayoutManager.getSectionLeftAtIndex(l.getEndIndex()),f=(h||0)+(g[ATTR_PARAGRAPH.PS_ML]||0).convertor().pixels;if(width=0,JparentTD=J(a).closest("td.zw-td"),JparentTD[0])width=JparentTD.width(),f=PUtil.offsetLeft(JparentTD[0]);else{var p=DocLayoutManager.getContentWidthAtIndex(i.getStart());width=p-(g[ATTR_PARAGRAPH.PS_ML]||0).convertor().pixels}width/=editor.zoomFactor,editor.jMultiByteSpan.css({left:f,top:CurUtil.offset.start.top||0,height:s.height,width:width,"z-index":16});var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")||jQuery(),E=(e.offset()||ZERO_RECT).left-(editor.jeditorPane.offset()||ZERO_RECT).left;if(DomViewManager&&DomViewManager.isMultiplePagesInRow()){var T=DomViewManager.getCurrentPageLeft(ABSOLUTE_TO.WINDOW)*editor.zoomFactor,O=DocumentView.getLeftPaneWidth();editor.jMultiByteSpan&&editor.jMultiByteSpan.css({left:DomViewManager.getCurrentSectionLeft(ABSOLUTE_TO.WINDOW)}),E=(e.offset()||ZERO_RECT).left-(T+O)}editor.jMbSpan_editableSpanOrigTextIndet=E/editor.zoomFactor-f,editor.jMbSpan_editableSpan.css("text-indent",editor.jMbSpan_editableSpanOrigTextIndet)},EditorUtil.flushContents=function(e){if("undefined"!=typeof EventHandler&&EventHandler.multiByteTyping){var t=editor.jMbSpan_editableSpan,i=e&&e.data||e&&e.detail&&e.detail.data||t.html();if(i){editor.jMultiByteSpan.css({top:CurUtil.offset.start.top,left:editor.editorPaneContainer.scrollLeft()/editor.zoomFactor,"z-index":0,width:"100px"});var n=i.replace(/\u200b/gi,"");n=n.replace(/&nbsp;/gi," "),n=n.replace(/&amp;/gi,"&"),n=n.replace(/&lt;/gi,"<"),n=n.replace(/&gt;/gi,">"),n=n.replace(/<br>/gi,""),editor.addChar(n),t.removeAttr("style").html(""),editor.editorPaneContainer[0].scrollTop=CurUtil.scrollTop,EventHandler.multiByteTyping=!1,J("#cursorSpan").remove()}}},EditorUtil.setHTML=function(e){var t,i,n=J("#cursorSpan");n.html(e&&e.data||editor.jMbSpan_editableSpan.html()),t=editor.doc.getSelection().getParaFormat()||{},1==t[ATTR_PARAGRAPH.PS_AL]?i=parseFloat(editor.jMbSpan_editableSpanOrigTextIndet)-n.width()/2:2==t[ATTR_PARAGRAPH.PS_AL]&&(i=parseFloat(editor.jMbSpan_editableSpanOrigTextIndet)-n.width()),i&&editor.jMbSpan_editableSpan.css("text-indent",i)},EditorUtil.joinCollaboration=function(){ZWLogger.log("JOIN COLLABORATION CALLED");var e={wmssessionid:ZWCollaboration.getWMSSessionId(),uuid:editor.uuid};J.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getUrl("join"),async:!0,data:e,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},dataType:"json",error:function(e){if(500===e.status&&e.responseText.search("1891")!==-1)return void(window.location.href="/writer/jsp/error.jsp?errorCode=1891")}})},EditorUtil.isCursorInHeaderFooter=function(){if(!editor.clientActiveSection)return!1;var e=editor.clientActiveSection.className;if(e.indexOf("zw-textbox-div")!=-1){var t=DomViewManager.getDocView(editor.clientActiveSection);return t.isReplicableView()}return e.indexOf("zw-contentpane")===-1&&e.indexOf("zw-notepane")===-1},EditorUtil.isClipboardWebInstalled=function(){if(!editor.browserInfo.is_chrome)return!1;var e;return(e=chrome.app.getDetails())&&"Zoho Clipboard"===e.name||!1},EditorUtil.isZohoWriterChromeAppInstalled=function(){if(!editor.browserInfo.is_chrome)return!1;var e;return(e=chrome.app.getDetails())&&"Zoho Writer"===e.name||!1},function(){var e=!0;EditorUtil.allowTypingOnKeypress=function(t){Macros.isPDFDocument()&&(e=!!t)},EditorUtil.isTypingAllowedOnKeypress=function(){return!Macros.isPDFDocument()||e}}(),EditorUtil.handleEnter=function(e){var t=(e.type,e.shiftKey),i=e.metaKey,n=(e.altKey,e.ctrlKey),r=(e.keyCode,!1);if(i||n)return!1;var o="undefined"!=typeof TransformHandler;if(o&&TransformHandler.getCurrentObjectInfo().isCropActive)return TransformHandler.removeCrop(),!1;var a,s=editor.doc.getSelection(),l=s.getLastRange(),d=s.getParents(NODE_TYPE.PARAGRAPH),c=d.getStart(),u=d.getEnd(),g=s.isCollapsed(),h=l.end==u-1,f=editor.doc.getContent(c,u).replace("\n",""),p=new RegExp(/^(=table\([1-9][0-9]*[,][1-9][0-9]*\))$/),E=new RegExp(/^=rand\(([0-9]|[1-9][0-9]|[1][0-9][0-9]|200)\)$/),T=new RegExp(/^=rand\([0-9]*,([0-9]|[1-9][0-9]|[1][0-9][0-9]|)\)$/),O=new RegExp(/^(=)(sum|abs|and|average|count|int|max|min|mod|not|or|product|round|sign|if|sumproduct)([()0-9.a-z\-*+\/,:><=!'"\s]*[^\s])$/i),m=d.dtNode;o&&(a=TransformHandler.getCurrentObjectInfo().type);var I=editor.doc.getRawFormatAt(s.getStart()),D=Macros.getAutoCorrectOnEnter();if(g&&h&&m&&!m.isCode()&&(/^===$/.test(f)||/^---$/.test(f)||/^___$/.test(f)||/^\*\*\*$/.test(f))){s.deleteContents(d.getStart(),d.getEnd()-1);var R=m.prev?m.prev:null,S={};S[ATTR_COMMON.BORDERS]={},S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={},f.indexOf("-")!=-1?(S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.TYPE]="solid",S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.WIDTH]="1px"):f.indexOf("_")!=-1?(S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.TYPE]="solid",S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.WIDTH]="2px"):f.indexOf("*")!=-1?(S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.TYPE]="dotted",S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.WIDTH]="3px"):(S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.TYPE]="double",S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.WIDTH]="3px"),S[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.COLOR]="rgb(0,0,0)",R&&"para"==R.type?(R=d.previousSibling(),editor.doc.execCmd("applyStyle",[R,S,"applyParaStyle"])):editor.doc.execCmd("applyStyle",[d,S,"applyParaStyle"])}else if(g&&h&&/^[+]([-]{1,}[+]){1,}$/.test(f))editor.doc.execCmd("insautotable",[d,f]);else if(g&&h&&/^[+]([\t]{1,}[+]){1,}$/.test(f))editor.doc.execCmd("insautotable",[d,f,UNICODE.TAB]);else if(g&&h&&p.test(f))editor.doc.execCmd("insautotable",[d,f,"rand"]);else if(!t&&!n&&g&&h&&"cell"==m.parent.type&&O.test(f)){var C=editor.doc.getRawFormatAt(d.getEnd()-1),A=!(!C||"ON"!=C[ATTR_TEXT.TS_AUTO_COREECT]);if(A)C[ATTR_TEXT.TS_AUTO_COREECT]="OFF",editor.doc.setFormatAt(d.getEnd()-1,C),editor.doc.updateLastAction("inspara"),EditorUtil.insertPara();else{var v=editor.doc.createRange(m.getIndex(),m.getEndIndex());s.removeAllRanges().addRange(v),s.deleteSelectedContents(),editor.doc.execCmd("updateFormula",["autoformula",f]);var _=editor.doc.getSelection().getParents(NODE_TYPE.PARAGRAPH),P=DocUtil.copyStyle(editor.doc.getRawFormatAt(_.getEnd()-1));P[ATTR_TEXT.TS_AUTO_COREECT]="ON",editor.doc.setFormatAt(_.getEnd()-1,P)}}else if(g&&h&&(E.test(f)||T.test(f)))editor.doc.execCmd("ins_random_text",d);else if(g&&h&&RANDOM_CODE_BLOCK_INS_REGEX.test(f))editor.doc.execCmd("ins_random_code",d);else if(o&&I&&"textbox"==I.subType&&"textbox"==a){var N=I.id,b=DocTreeManager.getSectionWithSid(N),L=b.getEndIndex()-1,l=editor.doc.createRange(L,L);editor.doc.getSelection().removeAllRanges().addRange(l),TextBoxHandler.handleCursorInsideTextBox(N)}else{var w={isCollapsed:g,isInLast:h,dtNode:m,cursorPara:d,currParaContent:f},y=!0;for(var M in D)if(D[M].condition(w)){y=D[M].fn(w);break}y&&(t||n?n||Command.exec("InsertChar",{cmd:"insbr"}):(editor.doc.updateLastAction("inspara"),EditorUtil.insertPara()))}return EditorUtil.focusMultiByteSpan(),PubSub.publish("ZWRange/ScrollIntoView"),r=!0},EditorUtil.insertPara=function(){var e,t,i=editor.doc.getSelection(),n=i.isListItemSelection,r=i.getNodesInSelection(NODE_TYPE.PARAGRAPH);n?(t=i.getFirstRange(),e=r[0]):(t=i.getLastRange(),e=r[0]);var o,a=e.getStart(),s=e.getEnd(),l=!1,d=!1,c=Utils.randomString();if("undefined"!=typeof WordComplete&&WordComplete.isSuggestionShown())WordComplete.insertSuggestion();else if(ListUtils.isList(e.attr("*"))&&DocUtil.isEmpty(e))"undefined"!=typeof ZWCode&&ZWCode.isPrevAndNextCodeBlock(e.dtNode)&&ListUtils.restartAsNewList(e.dtNode.next),Command.exec("InsertChar",{cmd:"outdent",element:!0});else if(DocUtil.isEmpty(e)&&e.dtNode.isCode())editor.doc.execCmd("uncode");else{editor.lastOperation="Ins Para";var u=t.start,g=t.end;o=u,editor.doc.getCharAt(u)!=UNICODE.RANGE_START&&editor.doc.getCharAt(u)!=UNICODE.RANGE_END||(o=DocUtil.getTextStyleEnd(u),o>s&&(o=s-1,u=g=o,t=editor.doc.createRange(u),i.removeAllRanges().addRange(t)));var h=DocUtil.copyStyle(editor.doc.getRawFormatAt(u));h.hasOwnProperty(ATTR_TEXT.TS_AUTO_COREECT)&&(delete h[ATTR_TEXT.TS_AUTO_COREECT],editor.doc.setFormatAt(u,h));var f={},p={},E=ListUtils.isList(h),T=h&&h[ATTR_PARAGRAPH.PS_HD];if(h&&"undefined"!=typeof T&&parseInt(T)>0&&(!E||E&&DocumentDesign.getComputedParaStyle("h"+T).info.next!="h"+T)){d=!0;var O=DocumentDesign.getComputedParaStyle("h"+h[ATTR_PARAGRAPH.PS_HD]).info.next;f=DocUtil.copyStyle(h),p.type=NODE_TYPE.PARAGRAPH,p[ATTR_PARAGRAPH.PS_HD]=O?O.substr(1):0,p[ATTR_TEXT.TS_NULL]=!0,p[ATTR_PARAGRAPH.PS_NULL]=!0,p[ATTR_PARAGRAPH.PS_TS]={}}else if(ListUtils.isList(e.attr("*"))){var f=DocUtil.copyStyle(editor.doc.getRawFormatAt(s-1));if(l=!0,(u===a||editor.doc.getCharAt(g)===UNICODE.PARA)&&f.ls_data){var m=f[ATTR_PARAGRAPH.LS_DATA].id,I=f[ATTR_PARAGRAPH.LS_DATA].l;editor.doc.getListType(m,I);if(CheckListOperations&&CheckListOperations.isCheckList(f)){var D;PubSub.publish("CheckListOperations/getUnCheckedBulletId",{style:f,callback:function(e){D=e}}),u===a?f[ATTR_PARAGRAPH.LS_DATA].bullet_id=D:(p.type=NODE_TYPE.PARAGRAPH,p[ATTR_PARAGRAPH.LS_DATA]=DocUtil.copyStyle(f[ATTR_PARAGRAPH.LS_DATA]),p[ATTR_PARAGRAPH.LS_DATA].bullet_id=D,p[ATTR_TEXT.TS_NULL]=!0,i.tempCursorFormat={})}}}else{f=DocUtil.copyStyle(editor.doc.getRawFormatAt(s-1));var T=0;if("undefined"!=typeof f[ATTR_PARAGRAPH.PS_HD]?T=f[ATTR_PARAGRAPH.PS_HD]:h&&"undefined"!=typeof h[ATTR_PARAGRAPH.PS_HD]&&(T=h[ATTR_PARAGRAPH.PS_HD]),f[ATTR_PARAGRAPH.PS_HD]&&0==parseInt(f[ATTR_PARAGRAPH.PS_HD])&&delete f[ATTR_PARAGRAPH.PS_HD],editor.doc.getCharAt(g)==UNICODE.PARA){var O=DocumentDesign.getComputedParaStyle("h"+T).info.next;O=O?O.substr(1):0,0==T&&0==O?(p=DocUtil.copyStyle(f),p[ATTR_PARAGRAPH.PS_TS]=i.textFormat):(p.type=NODE_TYPE.PARAGRAPH,p[ATTR_PARAGRAPH.PS_HD]=O,p[ATTR_TEXT.TS_NULL]=!0,p[ATTR_PARAGRAPH.PS_NULL]=!0,p[ATTR_PARAGRAPH.PS_TS]={})}else u==a&&(f[ATTR_PARAGRAPH.PS_TS]=i.textFormat)}isV8Engine||Utils.afterSpaceOperations("",!0),t=!n&&editor.doc.getSelection().getLastRange()||t,u=t.start,i.isCollapsed()||(0==u&&g-u==1?t.setStart(g):(i.isTableSelected()||g>u&&!n)&&i.deleteSelectedContents()),f.hasOwnProperty(TCConstants.TC)&&delete f[TCConstants.TC],p.hasOwnProperty(TCConstants.TC)&&delete p[TCConstants.TC],f.hasOwnProperty(ATTR_PARAGRAPH.PS_DROPCAP)&&(ZWJSONUtils.isEmptyObject(p)&&(p=DocUtil.copyStyle(f)),p[ATTR_PARAGRAPH.PS_DROPCAP]=""),p.hasOwnProperty(ATTR_PARAGRAPH.EN_BL)&&(p[ATTR_PARAGRAPH.EN_BL]=!1),p.hasOwnProperty(ATTR_PARAGRAPH.EN_WO)&&(p[ATTR_PARAGRAPH.EN_WO]=!1),p[ATTR_PARAGRAPH.PS_TS]&&p[ATTR_PARAGRAPH.PS_TS].hasOwnProperty(TCConstants.TC)&&delete p[ATTR_PARAGRAPH.PS_TS][TCConstants.TC],u=t.start;var R=[{r:n?a:u},{as:{start:f,id:c}},{is:UNICODE.PARA},{as:{end:ZWJSONUtils.getKeys(f),id:c}}];if(c=Utils.randomString(),ZWJSONUtils.isEmptyObject(p)||1!=r.length||(R.push({r:s-1-u}),R=R.concat({as:{start:p,id:c}},{r:1},{as:{end:ZWJSONUtils.getKeys(p),id:c}})),f[ATTR_PARAGRAPH.PS_HD]&&parseInt(f[ATTR_PARAGRAPH.PS_HD])>0&&105!=parseInt(f[ATTR_PARAGRAPH.PS_HD])&&!i.isCollapsed()&&!d){var S=Utils.randomString(),m="toc_"+Utils.randomString(),C={};C[ATTR_COMMON.TYPE]=NODE_TYPE.BOOKMARK,C[ATTR_COMMON.ID]=m,C[ATTR_COMMON.NAME]=S;var A={};A[ATTR_COMMON.TYPE]=NODE_TYPE.BOOKMARK,A[ATTR_COMMON.ID]=m;var v=Utils.randomString(),_=Utils.randomString();R=R.concat({as:{start:C,id:v}},{is:UNICODE.RANGE_START},{as:{end:["type",ATTR_COMMON.ID,ATTR_COMMON.NAME],id:v}},{r:s-u-1},{as:{start:A,id:_}},{is:UNICODE.RANGE_END},{as:{end:["type",ATTR_COMMON.ID],id:_}})}Op.processMsg(R),Op.sendMsg();var P=t.start;P&&editor.doc.getCharAt(P)==UNICODE.BR&&editor.doc.getCharAt(P-1)==UNICODE.PARA&&(EventHandler.mouseDown_coord.isLineEnd=!0,EventHandler.mouseDown_coord.portion=J(editor.doc.getCursorPortionNode()).parents("div.zw-paragraph").find("span.zw-portion,span.EOP")[0],i.removeAllRanges().addRange(t)),isV8Engine||DomUtil.scrollElementIntoView(editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start")[0])}},EditorUtil.addChar=function(e,t){var i="";for(var n in UNICODE)"MULTIBYTE_SPACE"!=n&&"SPACE"!=n&&"MERGEFIELD_START"!=n&&"MERGEFIELD_END"!=n&&(i=UNICODE[n],e=e.replace(new RegExp(i,"gi"),""));if(e.length){var r=Macros.getAddCharTextNode(e),o=editor.doc.getSelection(),a=o.getTextFormat(),s=!1,l={},d=o.getStart();U.isEmpty(a)||("ON"===a[ATTR_TEXT.TS_AUTO_COREECT]&&(s=!0,l=DocUtil.copyStyle(a),l[ATTR_TEXT.TS_AUTO_COREECT]="OFF"),a.hasOwnProperty(TCConstants.TC)&&delete a[TCConstants.TC],delete a[ATTR_TEXT.TS_AUTO_COREECT],r.css=a),"repeatAction"===editor.doc.lastAction.action&&(editor.doc.lastAction.action="Typing",editor.doc.clearLastAction()),isV8Engine||CurUtil.stopBlinking(),Command.exec("InsertChar",{cmd:"insert",element:r}),s&&(editor.doc.setFormatAt(d,l),o.setCursorFormat())}PubSub.publish("ZWRange/ScrollIntoView")};var TrackChangeDetails=function(){var e=!1,t=!1,i=!1,n=!1,r=TCConstants.ALL_MARKUP_VIEW,o=!1,a=!1,s="",l=!1,d=!1,c=DocOpBuilder.build([]);return _canReview=!1,{isContentMovedFromSource:function(){return l},setContentMovedFromSource:function(e){l=e},isContentMovedToTarget:function(){return d},setContentMovedToTarget:function(e){d=e},setProcessingContentDeletion:function(e){n=e},isProcessingContentDeletion:function(){return n},isOwner:function(){return a},canReview:function(){return _canReview},setReviewPermission:function(e){_canReview=e},isUserParticipated:function(){return o},makeUserParticipated:function(){o=!0},init:function(n){s=editor.zuid+"";var r=editor.doc.getBodyFormat()[ATTR_BODY.TC_COLLAB_LIST];e=!1,t=!1,i=!1,"true"===n[ATTR_BODY.TC_ISENABLED]?(e=!0,t=!0,i=!0):!editor.getRole().permissions.can("review.changes.trackall")&&r&&r.contains(editor.zuid.toString())&&(e=!0,i=!0);editor.doc.getRole();editor.getRole().permissions.can("review.changes.trackall")&&(a=!0),editor.getRole().permissions.can("review.changes.resolve")&&(_canReview=!0),"undefined"!=typeof RemoteEditor&&RemoteEditor.options.hasOwnProperty("isTcON")&&"true"==RemoteEditor.options.isTcON&&(e=!0,i=!0)},updateDisplayMode:function(){if(editor.getRole().permissions.can("document.edit")){var e=editor.doc.getUserData()[editor.zuid]||{};r=e[TCConstants.TC_VIEW]||TCConstants.ALL_MARKUP_VIEW}},isEnabled:function(){return e},isONByOwner:function(){return t},getProcessingTC:function(){return i},getDisplayMode:function(){return r},setIsEnabled:function(t){e=t,i=t},setProcessingTC:function(t){i=e&&1==t},setDisplayMode:function(e){r=e},isNoMarkupON:function(){return r===TCConstants.NO_MARKUP_VIEW},setZuid:function(e){s=e},getZuid:function(){return s},resetZuid:function(){s=editor.zuid+""},canCarryParaStyle:function(){return!e},setHiddenRangeOps:function(e){c=e},getHiddenRangeOps:function(){return c},resetHiddenRangeOps:function(){c=DocOpBuilder.build([])},toString:function(){var a="_isEnabled : "+e;return a+="; _isONByOwner : "+t,a+="; canProcessTC  : "+i,a+="; processingContentDeletion : "+n,a+="; displayMode : "+r,a+="; isCurrentUserParticipated : "+o}}}();Doc=function(){this.paintFormat={},this.paintFormat_dblClick=!1;Array.prototype.slice;this.locks=null,this.bucket=new BucketArray;var e={};return this.applyConditionsForFillable=!1,this.ranges={},{createRange:function(e,t,i){return new ZWRange(e,t,i)},createSelection:function(t){return t&&!e.hasOwnProperty(t)&&(e[t]=new ZWSelection(t)),e[t]},removeSelection:function(t){t&&e.hasOwnProperty(t)&&(e[t].removeAllRanges(),delete e[t])},getSelection:function(t){return t=t||editor.uuid,e[t]||null},getAllSelections:function(){return e},contStr:"",bucket:new BucketArray,formats:[],bodyFormat:{},domCursor:{},ranges:{},docInfo:{},role:"OWNER",zuid:"",locks:this.locks,ranges:this.ranges,lastAction:{},isHiddenMarkersEnabled:!1,isHighLighterOn:!1,userData:{},collabUsers:[],getDefaultFontSizeList:function(){return[8,9,10,11,12,14,16,18,24,36,48,58,70]},tcDetails:TrackChangeDetails,getTrackChangeDetails:function(){return this.tcDetails},setTrackChangeDetails:function(e){this.tcDetails=e},createDomCursor:function(e,t){if(!e)return editor.doc.domCursor;var t=t?t:editor.zuid,i=this.domCursor[e];return i||(this.domCursor[e]={},this.domCursor[e].start={node:"",idx:"",cursor:""},this.domCursor[e].end={node:"",idx:"",cursor:""},this.domCursor[e].zuid=t),this.domCursor.bgColor||(this.domCursor[e].bgColor=editor.doc.getUserData()[t]?editor.doc.getUserData()[t].color:"black"),editor.doc.domCursor},getContent:function(e,t){var i=this.getDocumentContent().substring(e,t);if(e<0||t<0||t<e){try{"undefined"!=typeof EventHandler&&ZWLogger.log(" MOUSE CO-ORDS ::: "+JSON.stringify(EventHandler.mouseDown_coord))}catch(e){}ZWLogger.log("_"+ZWCollaboration.API_NEGATIVE_IDX+"_API_NEGATIVE_IDX_ doc.getContent("+e+", "+t+")");var n=new Error(ZWCollaboration.API_NEGATIVE_IDX);throw editor.lastError=n,n}return i},getSelectedContent:function(){var e=this.getSelection();return this.getContent(e.getStart(),e.getEnd())},getContentIterator:function(e,t){e=e||0,t=t||this.getDocumentLength();var i=0;if(isV8Engine){var n=getCharIndexes(editor.doc.getContent(e,t));return{next:function(){return n[i]?n[i++]:-1}}}if("undefined"==typeof Intl||"undefined"==typeof Intl.v8BreakIterator){var i=1;return{next:function(){return e++<t?i++:-1}}}var r=new Intl.v8BreakIterator(["en"],{type:"character"});return r.adoptText(editor.doc.getContent(e,t)),r},setZuid:function(e){this.zuid=e},getRole:function(){return this.role},setRole:function(e){this.role=e},getUserData:function(e){var t=this.userData;if(!e)return t;var i,n;for(i in t)if((n=t[i])&&(n.uuids||"").indexOf(e)!==-1)return n.zuid=i,n},setUserData:function(e){this.userData=e},updateUserData:function(e,t){e&&t&&(this.userData[e]=t)},removeUserData:function(e){e&&this.userData[e]&&delete this.userData[e]},getDocumentContent:function(){return this.model.getText(0,this.model.getDocumentLength())},getDocumentLength:function(){return this.model?this.model.getDocumentLength():0},getRawListObj:function(e){if("undefined"==typeof e)return null;var t=this.getBodyFormat().listFormat[e];return"number"==typeof t&&(t=LIST_STYLE_OBJECT.hasOwnProperty(t)?LIST_STYLE_OBJECT[t]:LIST_STYLE_OBJECT[1]),DocUtil.copyStyle(t)},getListObj:function(e){if("undefined"==typeof e)return null;var t=this.getBodyFormat().listFormat[e];if("number"==typeof t&&(t=LIST_STYLE_OBJECT.hasOwnProperty(t)?LIST_STYLE_OBJECT[t]:LIST_STYLE_OBJECT[1]),t.hasOwnProperty("refAbstractNumId")){var i=DocUtil.copyStyle(this.getBodyFormat().listFormat[t.refAbstractNumId]);if(t.hasOwnProperty("levelOverride")){for(var n=DocUtil.copyStyle(t.levelOverride),r=0,o=9;r<o;r++)n.hasOwnProperty("level"+r)||(n["level"+r]=DocUtil.copyStyle(i["level"+r]));i=n}else if(t.hasOwnProperty("startOverride"))for(var n=t.startOverride,r=0,o=9;r<o;r++)n.hasOwnProperty("level"+r)&&(i["level"+r].startsWith=n["level"+r].startsWith);t=DocUtil.mergeObjs([i,t])}return DocUtil.copyStyle(t)},getListBulletObj:function(e){if("undefined"==typeof e)return null;var t=this.getBodyFormat().listFormat,i=t&&t.bulletStyles&&t.bulletStyles[e];return DocUtil.copyStyle(i)},getRawFormatAt:function(e){return this.model.getFormatAt(e)},getRawComputedTextFormatAt:function(e){var t=DocUtil.copyStyle(this.getRawFormatAt(e));try{if(Object.keys(t).length){var i=DocTreeManager.getParents(NODE_TYPE.PARAGRAPH,e).getFormat()[ATTR_PARAGRAPH.PS_HD],n=DocumentDesign.getParaStyle("h"+(i?i:"0")).textFormat;t=DocUtil.mergeObjs([n,t])}}catch(e){return t}return t},getThemeStyleFormatAt:function(e){var t=DocUtil.getRenderingFormat(this.getRawFormatAt(e));return t},getComputedFormatAt:function(e,t,i,n){if(!t){ZWLogger.log("getComputedFormatAt Invoked without type");var r=new Error(ZWCollaboration.OP_APPLYTO_ERROR);throw editor.lastError=r,r}var o=DocUtil.copyStyle(this.getRawFormatAt(e));if(!o||U.isEmpty(o)){if(t!=NODE_TYPE.TEXT&&t!=NODE_TYPE.PARAGRAPH)return{};t===NODE_TYPE.TEXT&&(o=DocUtil.getTextStyle(e))}else if(o.type&&o.type!=NODE_TYPE.TEXT&&o.type!=NODE_TYPE.PARAGRAPH)return o;if(t==NODE_TYPE.TEXT){var i=arguments[2]?arguments[2]:0,a=DocumentDesign.getComputedParaStyle("h"+i).textFormat;if(o.type==NODE_TYPE.PARAGRAPH&&(o=o[ATTR_PARAGRAPH.PS_TS]||{},o.type=NODE_TYPE.TEXT),o=DocUtil.mergeObjs([a,o]),o.hasOwnProperty(ATTR_CUSTOM.DISPLAY_TYPE)){for(var s,l,d={},c=e;c>=0;c--)if(editor.doc.getCharAt(c)===UNICODE.RANGE_START&&(s=c),(l=editor.doc.getRawFormatAt(c))&&l.hasOwnProperty(ATTR_CUSTOM.DISPLAY_TYPE)&&s===c){var u=l[ATTR_CUSTOM.DISPLAY_STYLE];ZWJSONUtils.mergeJsonObjs(d,u)}o=DocUtil.mergeObjs([o,d])}}else if(t===NODE_TYPE.PARAGRAPH){var g=e;editor.doc.getCharAt(e)!=UNICODE.PARA&&(n=DocTreeManager.getParents(NODE_TYPE.PARAGRAPH,e),g=n.getEndIndex()),o=DocUtil.getParaFormat(g,n)}return o.hasOwnProperty(ATTR_TEXT.CHAR_STY)&&DocUtil.updateWithCharStyle(o),o=DocUtil.getRenderingFormat(o)},setFormatAt:function(e,t){this.model.setFormatAt(e,t)},createSection:function(e,t,i,n,r,o,a,s,l,d){return new Section(e,t,i,n,r,o,a,s,l,d)},isSectionStart:function(e){var t=this.getCharAt(e);return 0==e||t==UNICODE.SECTION_START},getSectionStart:function(e){var t=this.getDocumentContent().lastIndexOf(UNICODE.SECTION_START,e-1);return t=t<0?0:t},getSectionEnd:function(e){var t=e;this.getCharAt(e)!=UNICODE.SECTION_START&&(t=this.getSectionStart(e));var i=this.getDocumentContent().indexOf(UNICODE.SECTION_START,t+1);return i=i<0?this.getDocumentLength():i},getSectionContent:function(e){var t=e;this.isSectionStart(e)||(t=this.getSectionStart(e)),t++;var i=this.getSectionEnd(t+1);return this.getContent(t,i)},getCharAt:function(e){return this.model.getCharAt(e)},getParents:function(e,t){var i,n=null,r={};if(e==NODE_TYPE.BODY){var o=this.createElement(e,{});return o}if(e==NODE_TYPE.TEXT){var a=t,s=DocUtil.getTextStyleStart(a-1),l=DocUtil.getTextStyleEnd(a+1);l&&(l=this.getSectionEnd(a));var d=this.getContent(s,l),c=this.createElement(NODE_TYPE.TEXT,d);return c.setStart(s),c.setEnd(l-1),c}if(e==NODE_TYPE.IMAGE){var u=editor.doc.getRawFormatAt(t),g=null;return this.getCharAt(t)==UNICODE.IMAGE&&(g=this.createElement(e,u),g.setStart(t),g.setEnd(t+1)),g}if(e==NODE_TYPE.IFRAME){var u=editor.doc.getRawFormatAt(t),h=null;return this.getCharAt(t)!=UNICODE.IMAGE||u.type!=ATTR_WIDGET.WIDGET&&!NODE_TYPE.IFRAME||(h=this.createElement(e,u),h.setStart(t),h.setEnd(t+1)),h}if(e==NODE_TYPE.CHART){var u=editor.doc.getRawFormatAt(t),f=null;return this.getCharAt(t)==UNICODE.IMAGE&&u.type==NODE_TYPE.CHART&&(f=this.createElement(e,u),f.setStart(t),f.setEnd(t+1)),f}if(e==NODE_TYPE.BR){var u=editor.doc.getRawFormatAt(t),p=null;return this.getCharAt(t)==UNICODE.BR&&(p=this.createElement(e,u),p.setStart(t),p.setEnd(t+1)),p}if(e==NODE_TYPE.TABLE)return i=DocTreeManager.getParents(e,t),i&&(r.dtNode=i,n=this.createElement(e,r),n.setStart(i.getIndex()),n.setEnd(i.getEndIndex()+1)),n;if(e==NODE_TYPE.ROW)return i=DocTreeManager.getParents(e,t),i&&(r.dtNode=i,n=this.createElement(e,r),n.setStart(i.getIndex()),n.setEnd(i.getEndIndex()+1)),n;if(e==NODE_TYPE.CELL)return i=DocTreeManager.getParents(e,t),i&&(n=this.createElement(e,i),n.setStart(i.getIndex()),n.setEnd(i.getEndIndex()+1)),n;if(e==NODE_TYPE.PARAGRAPH)return i=DocTreeManager.getParents(e,t),i&&(n=this.createElement(e,i),n.setStart(i.getIndex()),n.setEnd(i.getEndIndex()+1)),n;if(e==NODE_TYPE.TOC)return i=DocTreeManager.getParents(e,t),i&&(n=this.createElement(e,i),n.setStart(i.getIndex()),n.setEnd(i.getEndIndex()+1)),n;if(e==NODE_TYPE.HR){var E=this.createElement(e),T=t;if(editor.doc.getCharAt(t)!=UNICODE.HR&&(T=editor.doc.findNextIndexOf(UNICODE.HR,t)),T<0)return;return E.setStart(T),E.setEnd(T+1),E}if(e==NODE_TYPE.SECTION){var t=editor.doc.getSelection().getStart(),O=editor.doc.getSectionStart(t),m=editor.doc.getSectionEnd(O),I=editor.doc.getRawFormatAt(O),D=I.st||I.type,R=this.createSection(D,this.getContent(O+1,m),I.sid);return R.setStart(O),R.setEnd(m),R}if(e==NODE_TYPE.PLACEHOLDER||e==NODE_TYPE.COMMENT||e==NODE_TYPE.LINK||e==NODE_TYPE.AUTOFIELD){var S=DocUtil.getFloatElementRange(e,t);if(S){var I=editor.doc.getRawFormatAt(S.end-1)||{},C=e==NODE_TYPE.COMMENT||e==NODE_TYPE.PLACEHOLDER?this.createElement(e,{sectionId:I.id}):this.createElement(e,{});return C.setStart(S.start),C.setEnd(S.end),C}}return null},getBodyFormat:function(){return this.model.getBodyFormat()},getLocks:function(){return this.model.getLocks()},getRanges:function(){return this.model.getRanges()},getFormats:function(){return this.model.getFormats()},getFormatsBetween:function(e,t){return this.model.getFormatsBetween(e,t)},setBodyFormat:function(e){var t=this.getBodyFormat();for(var i in e){var n=e[i];t[i]=n}this.model.setBodyFormat(t)},findNextIndexOf:function(e,t){var i,n=this.getDocumentContent();if(i=Utils.findNextIndexOf(e,t,n),i>=0&&t>i){var r=new Error(ZWCollaboration.API_NEGATIVE_IDX);throw editor.lastError=r,r}return i},findPreviousIndexOf:function(e,t){var i,n=editor.doc.getContent(0,t);return i=Utils.findPreviousIndexOf(e,t,n)},getListType:function(e,t){var i=this.getListObj(e);if("undefined"==typeof e||t<0||!i||U.isEmpty(i))return null;var n=i["level"+t].type;return n},getListStartingNo:function(e,t){var i=this.getListObj(e);if("undefined"==typeof e||t<0||!i||U.isEmpty(i))return null;var n=i["level"+t].startsWith||1;return n},isAbstractListhasStartsWith:function(e,t){var i=this.getBodyFormat().listFormat[e];return!("undefined"==typeof e||t<0||!i||ZWJSONUtils.isEmptyObject(i)||!i.hasOwnProperty("refAbstractNumId")||!i.hasOwnProperty("startOverride"))&&(i.startOverride.hasOwnProperty("level"+t)&&i.startOverride["level"+t].hasOwnProperty("startsWith"))},getListChar:function(e,t){var i=this.getListObj(e);if("undefined"==typeof e||t<0||!i||U.isEmpty(i))return null;var n=i["level"+t].c;if("undefined"==typeof n){var r=i["level"+t].type;n=r<=4?ListLevelNo[t]+".":ListLevelNo[t]}return n},getHeadingListId:function(){var e=DocumentDesign.getParaStyle("h1").ls_data;return e&&e.id},getFontSize:function(e){var t=DocumentDesign.getParaStyle("h"+e).textFormat[ATTR_TEXT.TS_SIZE];return t},getSection:function(e,t){for(var i=this.findNextIndexOf(UNICODE.SECTION_START),n=editor.doc.getDocumentLength(),r=[],o=i;o<n&&o>=0;){var a=editor.doc.getRawFormatAt(o);if(a){var s=a.st;"main"==e&&(s=e);var l=a.sid,d=this.findNextIndexOf(UNICODE.SECTION_START,o+1);if(d<0&&(d=n),a&&s==e&&(!t||t&&t==l)){var c=this.createSection(e,"",l);if(c.setStart(o),c.setEnd(d),c.content=this.getContent(o+1,d),e==NODE_TYPE.COMMENT&&a.cType&&"child"==a.cType&&(c.cType="child",c.parentId=a.parentId),t==l){r.push(c);break}r.push(c)}o=d}else i=this.findNextIndexOf(UNICODE.SECTION_START,o),o=i<0?n:i+1}var u=r.length?t?r[0]:r:null;return u},getElementAt:function(e){var t,i,n=this.getCharAt(e),r={};switch(n){case UNICODE.PARA:i=DocTreeManager.getTreeNodeAtIndex(e),t=this.createElement(NODE_TYPE.PARAGRAPH,i),t.setStart(i.getIndex()),t.setEnd(i.getEndIndex()+1);break;case UNICODE.TABLE:i=DocTreeManager.getTreeNodeAtIndex(e),r.dtNode=i,t=this.createElement(NODE_TYPE.TABLE,r),t.setStart(i.getIndex()),t.setEnd(i.getEndIndex()+1);break;case UNICODE.ROW:i=DocTreeManager.getTreeNodeAtIndex(e),r.dtNode=i,t=this.createElement(NODE_TYPE.ROW,r),t.setStart(i.getIndex()),t.setEnd(i.getEndIndex()+1);break;case UNICODE.CELL:i=DocTreeManager.getTreeNodeAtIndex(e),t=this.createElement(NODE_TYPE.CELL,i),t.setStart(i.getIndex()),t.setEnd(i.getEndIndex()+1);break;case UNICODE.HR:t=this.createElement(NODE_TYPE.HR),t.setStart(e),t.setEnd(e+1);break;case UNICODE.BR:t=this.createElement(NODE_TYPE.BR),t.setStart(e),t.setEnd(e+1);break;case UNICODE.IMAGE:t=this.createElement(NODE_TYPE.IMAGE),t.setStart(e),t.setEnd(e+1);break;default:t=this.createElement(NODE_TYPE.TEXT),t.setStart(e),t.setEnd(e+1)}return t},getPortionData:function(e,t){var i,n=DocLayoutManager.getLineAtIndex(e);if(t){var r=DomViewManager.getDOMObjById(t);i=r.getRenderedDOM(n)}else i=DomViewManager.getDOMElem(n);for(var o,a,s=J(i),l=s.find("span.zw-portion"),d=0,c=0,u=l.length,g=n&&n.absStart;c<u;c++){a=parseInt(l.eq(c).attr("data-text-len")||0);var h=l[c];if(0==a&&(h.classList.contains(NODE_TYPE.FILLABLEFIELD)||h.classList.contains(NODE_TYPE.SIGNERFIELD)||h.classList.contains(NODE_TYPE.MAILMERGEFIELD)))for(var f=0;f<h.childElementCount;f++){var p=h.children[f];a+=parseInt(J(p).attr("data-text-len")||0)}if(g+a>=e){o=l[c],d=e-g;break}g+=a}return o=o||s.find("span.EOP")[0],o&&d<0&&(d=0),{node:o,cursorPos:d,line:n}},getNodesInSelection:function(e,t,i){var n=[];if(e==NODE_TYPE.PARAGRAPH){var r,o,a,s;for(r=DocTreeManager.getNodesBetweenIndex("para",t,i),o=0,a=r.length;o<a;o++)s=this.createElement(NODE_TYPE.PARAGRAPH,r[o]),s.setStart(r[o].getIndex()),s.setEnd(r[o].getEndIndex()+1),n.push(s)}else if(e==NODE_TYPE.TEXT)n=this.getTextNodesInSelection(t,i,!1);else if(e==NODE_TYPE.BOOKMARK){var l=this.findNextIndexOf(UNICODE.RANGE_END,t),d=[];if(l>=t&&l<i)for(var c,u;l<i&&l>0;){var g=-1,h=-1,f=editor.doc.getRawFormatAt(l);if(f&&f.type==e){c=f.id,u=f.name,g=l;for(var p=this.findNextIndexOf(UNICODE.RANGE_END,l);p<=i;){var E=editor.doc.getRawFormatAt(p);if(E&&E.type==e&&E.id==c){h=p+1;break}p=this.findNextIndexOf(UNICODE.RANGE_END,p+1)}if(g!=-1&&h!=-1){var T={id:c,name:u},O=this.createElement(e,T);O.setStart(g),O.setEnd(h),d.push(O)}}l=this.findNextIndexOf(UNICODE.RANGE_START,l+1)}n=d}else if(e==NODE_TYPE.IMAGE){for(var l=this.findNextIndexOf(UNICODE.IMAGE,t),d=[];l>=t&&l<i;){var m=this.getElementAt(l);d.push(m),l=this.findNextIndexOf(UNICODE.IMAGE,l+1)}n=d}else if(e==NODE_TYPE.LINK){var l,I,D,e,R,S;for(t==i&&(S=editor.doc.getParents(NODE_TYPE.LINK,t),S&&n.push(S)),l=t;l<=i&&(I=this.getDocumentContent().indexOf(UNICODE.RANGE_START,l),!(I<0||I>=i));)D=editor.doc.getRawFormatAt(I),e=D.type,"link"==e&&(R=editor.doc.getParents(NODE_TYPE.LINK,I+1),n.push(R)),l=I+1}return n},getNewListId:function(){for(var e=this.getBodyFormat().listFormat,t=Utils.getRandomNumber();e.hasOwnProperty(t);)t=Utils.getRandomNumber();return t},getNewDocumentBulletId:function(){for(var e=editor.doc.getBodyFormat().listFormat.bulletStyles,t=Utils.getRandomNumber();e&&e.hasOwnProperty(t);)t=Utils.getRandomNumber();return t},getElement:function(e,t){if(e==NODE_TYPE.BOOKMARK){for(var i,n,r=this.getDocumentContent().indexOf(UNICODE.RANGE_START),o=editor.doc.getDocumentLength(),a=[];r>-1&&r<o;){var s=-1,l=-1,d=editor.doc.getRawFormatAt(r);if(d&&d.type==e&&(!t||t&&(t==d.id||t==d.name))){i=d.id,n=d.name,s=r;var c=DocUtil.getRangeEnd(r);if(c<0)break;l=c+1;var u={id:i,name:n},g=this.createElement(e,u);if(g.setStart(s),g.setEnd(l),a.push(g),t)break}r=this.findNextIndexOf(UNICODE.RANGE_START,s!=-1?s+1:r+1)}return a}},getFloatElement:function(e,t){var i,n,r,o,a,s,l,d=null;if(a=DocTreeManager.getSectionWithSid(t),!a)return null;if(s=a.start,l=a.end,d=this.createSection(e,this.getContent(s+1,l),t),d.setStart(s),d.setEnd(l),!d)return null;var c=-1;for(n=this.findNextIndexOf(UNICODE.SECTION_START,1);n>0;){for(r=this.findNextIndexOf(UNICODE.RANGE_START,1);r>-1&&r<n;){if(o=this.getRawFormatAt(r)||{},o[ATTR_COMMON.TYPE]==e&&o[ATTR_COMMON.ID]==t){c=DocUtil.getRangeEnd(r);break}r=this.findNextIndexOf(UNICODE.RANGE_START,r+1)}if(c!==-1)break;n=this.findNextIndexOf(UNICODE.SECTION_START,n+1)}return r>-1&&c>-1&&(i=this.createElement(e,t),i.setStart(r),i.setEnd(c+1),i.section=d),i},getTextNodesInSelection:function(e,t,i){"undefined"==typeof e&&(e=editor.doc.getSelection().getStart()),"undefined"==typeof t&&(t=editor.doc.getSelection().getEnd());var n=[];if(e===t)return n;var r=editor.doc.getSectionEnd(e);t>r&&(t=r);var o,a=editor.doc.getRawFormatAt(e),s=U.isEmpty(a)||a.type===NODE_TYPE.TEXT&&(!!i||a.st!==NODE_TYPE.TAB);s&&(o=e);for(var l=e+1;l<t;l++)U.isEmpty(a=editor.doc.getRawFormatAt(l))||(s=a.type===NODE_TYPE.TEXT&&(!!i||a.st!==NODE_TYPE.TAB),o?(n.push(DocUtil.createTextElement(o,l)),o=s?l:null):s&&(o=l));return o&&n.push(DocUtil.createTextElement(o,l)),n},takeSnapShot:function(e){this.snapShotManager.takeSnapShot(e)},initTrackChangeDetails:function(){this.tcDetails.init(this.getBodyFormat())},getCollabUserCount:function(e){for(var t,i=[],n=0,r=editor.doc.collabUsers.length;n<r;n++)t=editor.doc.collabUsers[n].zuid,editor.zuid===t||i.contains(t)||t===e||i.push(t);return i.length},getPaperWidth:function(e){if(EditorView.isWebView())return EditorView.width(e);var t=DocLayoutManager.getFirstPageWidth();if(!e){var i=DocLayoutManager.getFirstSection();t-=i.getLeft()+i.getRight()}return t},isEditableMode:function(){return editor.getRole().permissions.can("document.edit")},applyConditionsForFillableFields:function(){return this.applyConditionsForFillable||!1},setApplyConditionsForFillableFields:function(e){this.applyConditionsForFillable=!!e},postApplyTo:function(e,t){ZWLogger.log("Post Apply To : Starts...");var i="load"===e.operation,n=i?"Document/LoadingComplete":"DocOperation/CommandComplete",r=function(){if(t&&t.setCursor(e.cursor),"collabop"===e.operation){var i=[];try{i=ZWCollaboration.getRangesInRegionOfUser(e.uuid)||[]}catch(e){i=[]}var r=editor.doc.getSelection();if((r&&r.isCollapsed()||i[0]&&i[0].SID===editor.uuid)&&(isV8Engine||!TransformHandler.getCurrentObjectInfo().type)){var o=r.toArray();if(r.removeAllRanges(),r.isListItemSelection)r.selectAllListItems(o[0].start);else for(var a=0,s=o.length;a<s;a++)r.showCaret(o[a])}i.length&&ZWCollaboration.updateCollabUsersRanges(i,e.uuid)}t&&PubSub.unsubscribe("ZWSelection/RangeAdded",t.resetCursor,{context:t}),ZWLogger.log(n+" event Published..."),PubSub.publish(n,e,t),ZWLogger.log(n+" event Completed..."),PubSub.publish("BuildChanges/Completed")};ZWLogger.log("Document Post Apply To : Published..."),PubSub.publish("Document/PostApplyTo"),DocTreeManager.applyChanges(),TcManager.applyChanges(),i||"collabop"===e.operation||PubSub.subscribe("ZWSelection/RangeAdded",t.resetCursor,{context:t}),"load"==e.operation&&(editor.isHardReload=!1,PubSub.publish("Document/LoadingStart"));var o=DocTreeManager.buildChanges();o.done(r),ZWLogger.log(" Post Apply To : Ends...")}}};var _editorDoc=new Doc;Doc.curForeGrdColor="#eb2b33",Doc.curBackGrdColor="#ffff00",Doc.curParaBackGrdColor="#fcbe02",Doc.curParaBorderColor="#eb2b33";var ArrayLikeObject=function(){"use strict";function e(){this.length=0}return e.prototype.push=function(e){this[this.length]=e,this.length+=1},e.prototype.pop=function(e){var t;return 0!==this.length&&(this.length-=1,t=this[this.length],delete this[this.length]),t},e.prototype.slice=Array.prototype.slice,e.prototype.splice=Array.prototype.splice,e.prototype.contains=Array.prototype.contains,e}(),W=function(e){"use strict";function t(e){return e&&e.nodeType&&1===e.nodeType}function i(t){if(e.call(this),t&&t.length>0)for(var i=0;i<t.length;i++)this.push(t[i])}function n(e){var t=null;return t=Array.isArray(e)?e:[e],new i(t)}var r=function(e,t){return t=t||document,t.querySelectorAll?t.querySelectorAll(e):[]},o=function(e,t){return t.matches(e)},a={removeClass:function(e,t){for(var i=t.split(" "),n=e.classList,r=0;r<i.length;r++)n.remove(i[r])},addClass:function(e,t){for(var i=t.split(" "),n=e.classList,r=0;r<i.length;r++)n.contains(i[r])||n.add(i[r])},show:function(e,t){e.style.display=t||"block"},hide:function(e){e.style.display="none"},prepend:function(e,t){t instanceof i&&(t=t[0]),e&&e.insertBefore(t,e.firstChild)},appendTo:function(e,t){t instanceof i&&(t=t[0]),t&&t.appendChild(e)},insertBefore:function(e,t){var i=t.parentElement;i&&i.insertBefore(e,t)},insertAfter:function(e,t){var i=t.parentElement;i&&i.insertBefore(e,t.nextSibling)},before:function(e,t){var i=e.parentElement;i&&i.insertBefore(t,e)},after:function(e,t){var i=e.parentElement;i&&i.insertBefore(t,e.nextSibling)},remove:function(e){e.parentElement&&e.parentElement.removeChild(e)},text:function(e,t){e.innerText=t},html:function(e,t){e.innerHTML=t},css:function(e){if("object"==typeof arguments[1]){var t=arguments[1];for(var i in t)e.style[i]=t[i]}else{var i=arguments[1],n=arguments[2];e.style[i]=n}},attr:function(e){if("object"==typeof arguments[1]){var t=arguments[1];for(var i in t)e.setAttribute(i,t[i])}else{var i=arguments[1],n=arguments[2];e.setAttribute(i,n)}},removeAttr:function(e,t){e.hasAttribute(t)&&e.removeAttribute(t)},scrollTop:function(e,t){e.scrollTop=t},scrollLeft:function(e,t){e.scrollLeft=t},height:function(e,t){"string"==typeof t?e.style.height=t:e.style.height=t+"px"},width:function(e,t){"string"==typeof t?e.style.width=t:e.style.width=t+"px"}},s={hasClass:function(e,t,i){if(1==t)return t;for(var n=i.split(" "),r=e.classList,o=0;o<n.length;o++)if(!r.contains(n[o]))return!1;return!0},text:function(e,t){return t=t||"",t+e.innerText},html:function(e){return e.innerHTML},css:function(e,t,i){return e.style[i]},attr:function(e,t,i){return e.getAttribute(i)},scrollTop:function(e){return e.scrollTop},scrollLeft:function(e){return e.scrollLeft},height:function(e){var t=window.getComputedStyle(e,null),i=0,n=e.getBoundingClientRect();return n.height>0&&(i=n.height-parseInt(t.getPropertyValue("padding-top"))-parseInt(t.getPropertyValue("padding-bottom"))-parseInt(t.getPropertyValue("border-top"))-parseInt(t.getPropertyValue("border-bottom"))),i},width:function(e){var t=window.getComputedStyle(e,null),i=0,n=e.getBoundingClientRect();return n.width>0&&(i=n.width-parseInt(t.getPropertyValue("padding-left"))-parseInt(t.getPropertyValue("padding-right"))-parseInt(t.getPropertyValue("border-left"))-parseInt(t.getPropertyValue("border-right"))),i},offset:function(e){if(!e.getClientRects().length)return{top:0,left:0};var t=e.getBoundingClientRect(),i=e.ownerDocument.defaultView;return{top:t.top+i.pageYOffset,left:t.left+i.pageXOffset}},is:function(e,i,n){if(1==i)return!0;var r=!1,a=arguments[3];return r="function"==typeof a?a.call(e,n,e):t(a)?e.isSameNode(a):o(a,e)}},l={clone:function(e,t,i){t.push(e.cloneNode(i))},find:function(e,t,i){for(var n=r(i,e),o=0;o<n.length;o++)!t.is(n[o])&&t.push(n[o])},parent:function(e,t,i){var n=e.parentElement;n&&(void 0==i||o(i,n))&&!t.is(n)&&t.push(n)},parents:function(e,t,i){for(var n=e.parentElement;n;)(void 0==i||o(i,n))&&!t.is(n)&&t.push(n),n=n.parentElement},parentsUntil:function(e,t,i,n){for(var r=e.parentElement;r&&!o(i,r);)(void 0==n||o(n,r))&&!t.is(r)&&t.push(r),r=r.parentElement},closest:function(e,t,i){for(;e;){if(o(i,e)){!t.is(e)&&t.push(e);break}e=e.parentElement}},not:function(e,t,i,n){var r=!0;r="function"==typeof n?!n.call(e,i,e):!o(n,e),r&&!t.is(e)&&t.push(e)}},d=function(e){return Array.prototype.splice.call(e,2)},c=function(e,t){try{for(var i,n=d(arguments),r=this.length,o=t&&t.iterateOnce,a=0,r=this.length;a<r&&(i=t&&t.isIdxRequired?s[e].bind(null,this[a],i,a).apply(null,n):s[e].bind(null,this[a],i).apply(null,n),!o);a++);return i}catch(e){var l=new Error("Occurred in DOMWrapper Read Handler: "+e);throw l}},u=function(e,t){try{for(var i=d(arguments),n=0,r=this.length;n<r;n++)a[e].bind(null,this[n]).apply(null,i);return this}catch(e){var o=new Error("Occurred in DOMWrapper Write Handler: "+e);throw o}},g=function(e,t){try{for(var n=d(arguments),r=new i,o=0,a=this.length;o<a;o++)t&&t.isIdxRequired?l[e].bind(null,this[o],r,o).apply(null,n):l[e].bind(null,this[o],r).apply(null,n);return r}catch(e){var s=new Error("Occurred in DOMWrapper Create Handler: "+e);throw s}},h=["removeClass","addClass","show","hide","prepend","appendTo","insertBefore","insertAfter","before","after","remove","removeAttr"],f=["clone","find","parent","parents","parentsUntil","closest"],p=["html","scrollTop","scrollLeft","height","width","offset"],E=["attr","css"];return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,h.forEach(function(e){i.prototype[e]=function(){return u.bind(this,e,null).apply(this,arguments)}}),f.forEach(function(e){i.prototype[e]=function(){return g.bind(this,e,null).apply(this,arguments)}}),p.forEach(function(e){i.prototype[e]=function(t){if("undefined"==typeof t){var i={};return i.iterateOnce=!0,c.call(this,e,i)}return u.call(this,e,null,t),this}}),E.forEach(function(e){i.prototype[e]=function(t,i){if("string"!=typeof t||i)return u.call(this,e,null,t,i),this;var n={};return n.iterateOnce=!0,c.call(this,e,n,t)}}),i.prototype.hasClass=function(e){return c.call(this,"hasClass",null,e)},i.prototype.text=function(e){return"undefined"!=typeof e?(u.call(this,"text",null,e),this):c.call(this,"text")},i.prototype.is=function(e){var t={};return t.isIdxRequired=!0,c.call(this,"is",t,e)},i.prototype.not=function(e){var t={};return t.isIdxRequired=!0,g.call(this,"not",t,e)},i.prototype.eq=function(e){var t=this[e];return new i([t])},n.get=function(e){for(var t=e.split(","),n=new i,r=0;r<t.length;r++){var o=t[r].substring(1),a=t[r].charAt(0);if("#"===a){var s=document.getElementById(o);null!=s&&n.push(s)}else if("."==a)for(var l=document.getElementsByClassName(o),d=0;d<l.length;d++)n.push(l[d])}return n},n.createDOM=function(e){var t=document.createElement("div");t.innerHTML=e;for(var n=[];t&&t.firstChild;){var r=t.removeChild(t.firstChild);n.push(r)}return t=null,new i(n)},n}(ArrayLikeObject);!function(e){"use strict";e.ZWSize=function(e,t){this.width=e||0,this.height=t||0},ZWSize.prototype.clone=function(){return new ZWSize(this.width,this.height)},ZWSize.prototype.isEqualSize=function(e){return e&&this.width===e.width&&this.height===e.height}}(window),DomUtil.createImage=function(e){var t=document.createElement("img");return t.className="zw-image",e&&DomUtil.applyStyleToImage(t,e),!DomUtil.isImageMergeField(e)&&!DomUtil.isMapMergeField(e)||DomUtil.isAlternateSrcPresent(e)?t.onerror=function(){DomUtil.imageErrorHandler(t,e)}:DomUtil.imageErrorHandler(t,e),t},DomUtil.imageErrorHandler=function(e,t){e.onerror=null;var i=e.getAttribute("src");e.setAttribute("data-zw-imagesrc",i),e.setAttribute("src",""),e.setAttribute("alt",J.i18n("writer.common.LOADING"));var n=e.className+" ui-loading-bg";DomUtil.isImagePlaceholder(t)?n=e.className+" ui-mm-img-bg ui-mm-img":t.wid>=50&&t.ht>=20&&(n+=" ui-loading-img"),DTUtils.isFloatingImage(t)||(n+=" ui-pos-rel",e.style.top=""),e.className=n},DomUtil.setFillableFieldAttr=function(e,t){if(e){e.classList.add(NODE_TYPE.FILLABLEFIELD);var i=t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_DISABLED]||!1;i?e.classList.add("ffield-disabled"):e.classList.remove("ffield-disabled"),e.setAttribute("data-field-id",t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]);var n=editorProps.userInfo.role,r=(USER_ROLE.PUBLIC===n&&editorProps.isPublishToFill||("SHAREDREAD"===n||"ANYONELINK_SHAREDREAD"===n)&&editorProps.isFillableForm&&editorProps.isPublishToFill||"function"==typeof editor.getView&&editor.getView()===EDITOR_VIEWS.FILLABLEFIELDS_PREVIEW||!!editorProps.options.REMOTE&&editorProps.isPublishToFill,t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_MANDATORY]||!1);r?e.classList.add("is-mandatory-field"):e.classList.remove("is-mandatory-field")}},DomUtil.addImageRotationStyles=function(e,t){var i=t[ATTR_IMAGE.I_ROTATE];if(i){var n=t[ATTR_IMAGE.I_WID],r=t[ATTR_IMAGE.I_HT],o=TransformationUtils.getTransformedSize(i,n,r),a=(o.width-n)/2,s=(o.height-r)/2;e.style.position="absolute",e.style.top=s+"px",e.style.left=a+"px"}},DomUtil.createSvgImage=function(e){var t=document.createElement("div");t.setAttribute("class","fgImgOuterDiv");var i=e&&e[ATTR_COMMON.SUBTYPE]==NODE_TYPE.TEXTBOX,n=e&&(e.cls||"").indexOf(NODE_TYPE.FILLABLEFIELD)!==-1;if(e&&(e.src||n)&&!i){var r="http",o=document.createElementNS(r+"://www.w3.org/2000/svg","svg");o.setAttributeNS(r+"://www.w3.org/2000/xmlns/","xmlns:xlink",r+"://www.w3.org/1999/xlink");var a=document.createElementNS(r+"://www.w3.org/2000/svg","image");o.appendChild(a),t.appendChild(o),a.setAttributeNS(null,"class","zw-image"),a.setAttribute("preserveAspectRatio","none");var s=!0;void 0!=ImageCache.getURIForImgURL(e.src)&&(e.src=ImageCache.getURIForImgURL(e.src)),DomUtil.applyStyleToSvgImage(a,e,s)}else{var l=e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;if(t.style.height=e.ht+2*l+"px",t.style.width=e.wid+2*l+"px",e&&e.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&!e.hasOwnProperty(ATTR_IMAGE.I_SHAPEDATA)){var d="rotate("+e[ATTR_IMAGE.I_ROTATE]+"deg)",c={"-ms-transform":d,"-moz-transform":d,"-webkit-transform":d,"-o-transform":d,transform:d};J(t).css(c)}if("textbox"==e.subType||e.shapeData){var u={};e.hasOwnProperty(ATTR_IMAGE.I_MB)&&(u["margin-bottom"]=e[ATTR_IMAGE.I_MB]),e.hasOwnProperty(ATTR_IMAGE.I_MR)&&(u["margin-right"]=e[ATTR_IMAGE.I_MR]),e.hasOwnProperty(ATTR_IMAGE.I_MT)&&(u["margin-top"]=e[ATTR_IMAGE.I_MT]),e.hasOwnProperty(ATTR_IMAGE.I_ML)&&(u["margin-left"]=e[ATTR_IMAGE.I_ML]),DTUtils.isWrappingFloatImage(e)&&ZWJSONUtils.getKeys(u).length&&J(t).css(u)}}return t},DomUtil.isSVGonloadSupportedBrowser=function(){return!(isHeadlessHTML||isHeadlessPDF||!editor.browserInfo.is_chrome&&!editor.browserInfo.is_firefox)},DomUtil.isImageMergeField=function(e){return!(!DomUtil.isImagePlaceholder(e)||DomUtil.isBarcodeQRCodeImage(e))},DomUtil.isMapMergeField=function(e){return!(e.type!=NODE_TYPE.IMAGE||!e[ATTR_WIDGET.MAPDETAILS]||e.subType!=NODE_TYPE.WIDGET||!e[MAILMERGE.MMINFO])},DomUtil.isAlternateSrcPresent=function(e){return!!e[ATTR_IMAGE.ALTSRC]},DomUtil.isImagePlaceholder=function(e){return!(e.type!=NODE_TYPE.IMAGE||!e[MAILMERGE.MMINFO]&&(!e[ATTR_FILLABLEFIELD.FF_INFO]||e.subType!=NODE_TYPE.QRCODE&&e.subType!=NODE_TYPE.BARCODE))},DomUtil.isBarcodeQRCodeImage=function(e){return e.subType==NODE_TYPE.QRCODE||e.subType==NODE_TYPE.BARCODE},DomUtil.bindEventsForImage=function(e,t){if(DomUtil.isSVGonloadSupportedBrowser()){var i=e.parentElement.parentElement;e.onload=function(){if(!i.classList.contains("zw-chart-image")){DomUtil.removeClassForElement(i,"ui-abs-loading-gif");var e=J(this);if(e.parents().hasClass("hf_content")||e.parents().hasClass("float-image-header-container")||e.parents().hasClass("float-image-footer-container")){var t,n,r;if(e.parents("span")[0]){var o=e.parents(".zw-paragraph")[0];n=o.getAttribute("doc-id"),r=o.getAttribute("node-id")}else{var a=e.parents(".zw-float")[0],s=e.parents(".fgImgOuterDiv")[0];r=s.getAttribute("pid"),n=a.getAttribute("pid"),n=n.substring(0,n.length-3)}var l=DocLayoutManager.getViewById(r,n);t=l.getSection(),t.getSectionType()==SECTION_TYPES.TEXTBOX&&(t=t.getRootSection()),PubSub.publish(t.getSectionType()+"/changed",t)}var d=i.querySelectorAll(".ui-brokenImg-cont");i&&d.length>0&&!i.classList.contains("ui-mm-img-outer-div")&&!i.classList.contains("js-image-field")&&d[0].remove()}},e.onerror=function(){var e=this.href.baseVal;if(e=0==e.indexOf("/writer/")?e.substr("/writer/".length):e,e.indexOf("#")>-1?e=e.substr(0,e.indexOf("#")):null,e.indexOf("&t=")>-1?e=e.substr(0,e.indexOf("&t=")):null,e.indexOf("&rid=")>-1?e=e.substr(0,e.indexOf("&rid=")):null,e.indexOf("&rsid=")>-1?e=e.substr(0,e.indexOf("&rsid=")):null,!i.classList.contains("zw-chart-image")&&WidgetView.isEmptySheet(i)&&(!ZWImageUtils.isWriterImage(e)||"undefined"==typeof PasteEventHandler||"uploading"!==PasteEventHandler.getImgUploadStatus(e)&&"success"!==PasteEventHandler.getImgUploadStatus(e))){DomUtil.removeClassForElement(i,"ui-abs-loading-gif");var t,n,r,o=J(this);if(o.parents("span")[0]){var a=o.parents(".zw-paragraph")[0];n=a.getAttribute("doc-id"),r=a.getAttribute("node-id")}else{var s=o.parents(".zw-float")[0],l=o.parents(".fgImgOuterDiv")[0];r=l.getAttribute("pid"),n=s.getAttribute("pid"),n=n.substring(0,n.length-3)}var d=DocLayoutManager.getViewById(r,n);t=d.getSection().getId();var c=i.classList.contains("zw-ifr-div")?null:t;ImageCache.removeFromCache(this.getAttribute("id"),c);var u=DomUtil.getBrokenDiv("image"),g={ht:parseInt(this.getAttribute("height")),wid:parseInt(this.getAttribute("width"))},h=J(this).parents().hasClass("hf_content");DomUtil.handleBrokenImage(g,i),i.innerHTML+=u,h&&(PubSub.publish("header/changed"),PubSub.publish("footer/changed"))}}}},DomUtil.getBrokenDiv=function(e){var t,i;if("chart"===e)t="ui-broken-icon ui-brokenChart-img",i=J.i18n("writer.chart.CHART_UNAVAILABLE_MSG");else{if("image"!==e)return;t="ui-broken-icon ui-brokenImg-img",i=J.i18n("writer.image.IMAGE_NOT_FOUND")}var n="<div class='ui-brokenImg-cont'><div class='ui-brokenImg-innercont'><div class='"+t+"'></div><div class='ui-brokenImg-text'>"+i+"</div></div></div>";return n},DomUtil.addClassForElement=function(e,t){if(e&&t)return e.classList.add(t),e},DomUtil.removeClassForElement=function(e,t){if(e&&t)return e.classList.remove(t),e},function(){var e={INPUT:"input",OUTPUT:"output"},t=function(t){var i=[];DocLocaleHandler.isSupportedLanguage(t)||(t=e.DEFAULT_LOCALE);var n=DocLocaleHandler.getLanguageDetails(t),r=n&&n.timezones;r.length||(n=DocLocaleHandler.getLanguageDetails(e.DEFAULT_LOCALE),r=n.timezones);for(var o,a=r.length,s=0;s<a;s++)o=r[s],i.push({label:o,value:o});return i},i=function(e,t,i,n,r){var o=new ZWDateTime(new Date);return o.setLocale(e),o.setTimezone(t),o.format(r,i,n)},n=function(e,t,i){return ZWDateTime.intlToNormalFormatConverter(i,e,t)},r=function(e){var t=[3,4,5,6,20];return t.contains(e)},o=function(e,t,i,n){var o;if(e&&t&&i){for(var a,s=!1,l=0,d=i.length;l<d;l++)if(characterType=DTUtils.getCharacterType(i[l]),r(characterType)){s=!0;break}a=s?"<div class='clearfix'><span class='ui-fl ui-right-margin-small' dir='rtl'>#label#</span><span class='ui-fl zmenu__hint' dir='rtl'>(#preview#)</span></span></div>":"<div class='clearfix'><span class='ui-fl ui-right-margin-small'>#label#</span><span class='ui-fl zmenu__hint'>(#preview#)</span></span></div>",o={innerHTML:a,replaceWithText:!0,label:e,preview:i,value:t}}else e&&t?o={label:e,value:t}:n&&(o={separator:!0});return o};DomUtil.populateLocaleOptions=function(e){var t=DocLocaleDlg.getLanguageOptions();e.zcombobox("removeAllOptions"),e.zcombobox("addOption",t)},DomUtil.populateTimezoneOptions=function(e,i){var n=[];i&&(n=t(i)),e.zselectbox("removeAllOptions"),e.zselectbox("addOption",n)},DomUtil.populateFormatOptions=function(t,r,a,s){a||(a=e.OUTPUT),"undefined"==typeof s&&(s=!1);var l,d,c,u,g=ZWDateTime.SUPPORTED_DATE_FORMATS;l=r.input.locale,d=r.input.timezone,c=a==e.OUTPUT?r.output.locale:r.input.locale,u=a==e.OUTPUT?r.output.timezone:r.input.timezone;var h,f,p,E,T=[],O=[],m=g.length;if(r[a].locale){for(var I=0;I<m;I++)p=g[I],h=i(l,d,c,u,p)||"-",E=n(c,u,p),T.contains(p)||(T.push(p),f=o(E,p,h,null),O.push(f));s&&(O.push(o(null,null,null,!0)),O.push(o("Custom","custom")))}t.zselectbox("removeAllOptions"),t.zselectbox("addOption",O)}}(),DomUtil.createDigiSignField=function(e){var t=document.createElement("input");return t.type="checkbox"===e["ds-data"]["field-name"]?"checkbox":"text",DomUtil.setStyleToInput(t,e),t},DomUtil.addFillImage=function(e,t,i){var n=J(e),r=imgCdnZWStaticPath+fingerPrintObj["images/spacer.gif"],o="http";n[0].setAttributeNS(o+"://www.w3.org/1999/xlink","xlink:href",r);var a=DTUtils.getFillableFieldWidth(t,null,i),s=DTUtils.getFillableFieldHeight(t,i),l=t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]==FILLABLEFIELD_TYPE.SIGNATURE||t[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]===FILLABLEFIELD_TYPE.INITIAL?"sign":"img",d=J('<div class="ui-efillablefield-label"><div class="ui-eff-label__bg"><div class="ui-eff-label__iconCont"><i class="zbutton__icon ui-no-margin-right ui-sprit-lazy ui-icon-'+l+'-efield-sm"></i></div></div></div>');J(e).append(d),n.css({height:s,width:a})},DomUtil.createIframe=function(e){var t=document.createElement("iframe");t.className="zw-iframe";var i=J(t),n={},r=e[ATTR_WIDGET.SERVICE],o=window.location.protocol+"//",a=o+document.domain;if(r==ATTR_WIDGET.SERVICE_SHEET)n[ATTR_IMAGE.I_SRC]=a+"/sheet/published.do?rid="+e[ATTR_WIDGET.TUBEID]+"&mode=embed";else if(r==ATTR_WIDGET.SERVICE_SHOW)n[ATTR_IMAGE.I_SRC]=a+"/show/publish/"+e[ATTR_WIDGET.TUBEID];else if(r==ATTR_WIDGET.SERVICE_REPORTS){var s=window.location.hostname;s=s.substring(s.indexOf(".")),n[ATTR_IMAGE.I_SRC]=o+"reports"+s+"/ZDBDataSheetView.cc?OBJID="+e[ATTR_WIDGET.TUBEID]+"&STANDALONE=true&ZDB_THEME_NAME=blue&INTERVAL=-1&REMTOOLBAR=true&INCLUDETITLE=true&INCLUDEDESC=false"}else if(r.toUpperCase()==ATTR_WIDGET.SERVICE_YOUTUBE){var l,d;e.src&&(l=e.src.split("/"),d=l[l.length-2]),n[ATTR_IMAGE.I_SRC]=o+"www.youtube.com/embed/"+d+"?wmode=transparent&rel=0&showinfo=0&modestbranding=1&fs=0 allowfullscreen"}else r==ATTR_WIDGET.SERVICE_SHEETEXTERNAL?n[ATTR_IMAGE.I_SRC]=a+"/sheet/publishrange.do?id="+e[ATTR_WIDGET.TUBEID]+"&mode=embed":r==ATTR_WIDGET.SERVICE_SHEETINTRANET?n[ATTR_IMAGE.I_SRC]=a+"/publishrange.org?id="+e[ATTR_WIDGET.TUBEID]+"&mode=embed":r==ATTR_WIDGET.SERVICE_SHEETCHARTIMG?n[ATTR_IMAGE.I_SRC]=a+"/sheet/publicgraphs/"+e[ATTR_WIDGET.TUBEID]+".png":r==ATTR_WIDGET.SERVICE_SHEETCHART?n[ATTR_IMAGE.I_SRC]=a+"/sheet/publicgraphs/"+e[ATTR_WIDGET.TUBEID]:r==ATTR_WIDGET.SERVICE_DOCS&&(n[ATTR_IMAGE.I_SRC]=a+"/file/"+e[ATTR_WIDGET.TUBEID]);n[ATTR_WIDGET.WIDTH]=e[ATTR_WIDGET.WID],n[ATTR_WIDGET.TUBEID]=e[ATTR_WIDGET.TUBEID],n[ATTR_WIDGET.SERVICE]=e[ATTR_WIDGET.SERVICE],n[ATTR_WIDGET.HEIGHT]=e[ATTR_WIDGET.HT];var c={};return c.border="1px solid #F2F2F2",c["border-radius"]="5px",i.attr(n).css(c),t},DomUtil.createWidget=function(e){var t=document.createElement("iframe");t.className="zw-iframe";var i=J(t),n={},r=e.hasOwnProperty(ATTR_WIDGET.SHEET_INFO);n[ATTR_IMAGE.I_SRC]=r?Macros.getSheetGridURL(e[ATTR_WIDGET.SHEET_INFO]):e[ATTR_WIDGET.SRC],n[ATTR_WIDGET.WIDTH]=e[ATTR_WIDGET.WID],n[ATTR_WIDGET.WIDTH]=e[ATTR_WIDGET.WID],n[ATTR_WIDGET.HEIGHT]=e[ATTR_WIDGET.HT],n["data-thumbnail"]=e[ATTR_WIDGET.THUMBNAIL],n["data-thumbnail-src"]=e[ATTR_IMAGE.I_SRC];var o={};return o.border="1px solid #F2F2F2",o["border-radius"]="5px",i.attr(n).css(o),t},DomUtil.createSpan=function(e){var t=document.createElement("span");return t.className="zw-portion",e&&DomUtil.setStyle(t,e),t},DomUtil.createTable=function(e,t){var i=document.createElement("table");i.className="zw-table";var n=document.createElement("colgroup");return i.appendChild(n),e&&DomUtil.setTableStyle(i,e,t),i},DomUtil.createTbody=function(){var e=document.createElement("tbody");return e.className="zw-tbody",e.style.verticalAlign="top",e},DomUtil.createTR=function(e){var t=document.createElement("tr");return t.className="zw-tr",e&&DomUtil.setRowStyle(t,e),t},DomUtil.createTD=function(e,t,i,n){var r=document.createElement("td");if(r.className="zw-td",i){var o=document.createElement("div");o.setAttribute("class","zw-cell-container"),J(o).css({position:"relative"}),r.appendChild(o)}return t&&DomUtil.setCellStyle(e,r,t,i,n),r},DomUtil.createHR=function(e){var t=null;return t=e?document.createElement("div"):document.createElement("hr"),t.className="zw-hr",t},DomUtil.createBR=function(){var e=document.createElement("br");return e.className="zw-br",e},DomUtil.getDigiSignFieldVal=function(e){var t={signature:J.i18n("writer.digisign.SIGNATURE"),signatureblock:J.i18n("writer.digisign.SIGNATURE_BLOCK"),initials:J.i18n("writer.digisign.INITIALS"),title:J.i18n("writer.digisign.TITLE"),company:J.i18n("writer.digisign.COMPANY"),fullname:J.i18n("writer.digisign.SIGNER_NAME"),email:J.i18n("writer.common.EMAIL"),date:J.i18n("writer.common.DATE"),textbox:J.i18n("writer.common.TEXT_FIELD"),checkbox:J.i18n("writer.digisign.CHECKBOX")},i=t[e];return i},DomUtil.setStyleToInput=function(e,t){var i,n={},r={};for(i in t)i==ATTR_IMAGE.I_WID?n.width=t[ATTR_IMAGE.I_WID]:i==ATTR_IMAGE.I_HT?n.height=t[ATTR_IMAGE.I_HT]:i==ATTR_IMAGE.I_ML?n["margin-left"]=t[ATTR_IMAGE.I_ML]:i==ATTR_IMAGE.I_MT?n["margin-top"]=t[ATTR_IMAGE.I_MT]:i==ATTR_IMAGE.I_MR?n["margin-right"]=t[ATTR_IMAGE.I_MR]:i==ATTR_IMAGE.I_MB&&(n["margin-bottom"]=t[ATTR_IMAGE.I_MB]);var o=t["ds-data"],a=o["field-name"],s=o["field-value"],l="";if(o&&s){if("checkbox"==a||"textbox"==a)l=J.i18n("writer.common.CUSTOM")+" "+DomUtil.getDigiSignFieldVal(a);else{var d=s.match(/signer[0-9]*/g);l=d[0].charAt(0).toUpperCase()+d[0].substring(1,d[0].length)}r.placeholder=DomUtil.getDigiSignFieldVal(a)+" - "+l,r.title=l,r.name=s+a}n["vertical-align"]="checkbox"==a?"middle":"super",J(e).attr(r).css(n)},DomUtil.applyStyleToImage=function(e,t){if(t&&e)try{var i=J(e);i.removeAttr("style");var n={},r={};r=DomUtil.getBorderStyles(t);for(var o in t)if(t.hasOwnProperty(o)&&"type"!=o){var a=t[o];if(null!=a&&void 0!=a)if(o==ATTR_IMAGE.I_SRC){var s=DomUtil.processImgSrc(a);n[ATTR_IMAGE.I_SRC]=s}else if(o==ATTR_COMMON.CLS)i.addClass(a);else if(o==ATTR_IMAGE.I_LINKDATA){if(!jQuery.isEmptyObject(a)){var l='{"data-link-url":"'+a.url+'","data-link-type":"'+a.type+'"}';i.attr("linkData",l)}}else if(o==ATTR_IMAGE.I_WRAP_TYPE)e.setAttribute("data-wrap-info",a);else if(o==ATTR_IMAGE.I_H_POSITION)e.setAttribute("data-position-h-info",JSON.stringify(a));else if(o==ATTR_IMAGE.I_V_POSITION)e.setAttribute("data-position-v-info",JSON.stringify(a));else if(o==ATTR_IMAGE.I_WID){var d=t[ATTR_IMAGE.I_WID_UN];d&&(a="%"===d?DocLayoutManager.getCurrentColumn().getWidth()+"px":parseInt(a)+d),i.width(a)}else if(o==ATTR_IMAGE.I_HT){var d=t[ATTR_IMAGE.I_HT_UN];d&&(a="%"===d?i[0].naturalHeight*DocLayoutManager.getCurrentColumn().getWidth()/i[0].naturalWidth+"px":parseInt(a)+d),i.height(a)}else if(o==ATTR_IMAGE.I_OP)e.style.opacity=a/100;else if(o==ATTR_IMAGE.I_AL)n.align=a;else if(o==ATTR_IMAGE.I_IMGSIZE)n.imagesize=a;else if(o==ATTR_IMAGE.I_LATEXEXP)n.latexexpression=a;else if(o==ATTR_IMAGE.I_ID)n.id=a,"dummyEquationImage"===a&&(r.display="inline-block");else if(o==ATTR_IMAGE.I_ALT)n.alt=a;else if(o==ATTR_IMAGE.I_TOOLTIP)n.title=a;else if(o==ATTR_IMAGE.I_ML&&DTUtils.isFloatingImage(t))r["margin-left"]=a;else if(o==ATTR_IMAGE.I_MR&&DTUtils.isFloatingImage(t))r["margin-right"]=a;else if(o==ATTR_IMAGE.I_MT&&DTUtils.isFloatingImage(t))r["margin-top"]=a;else if(o==ATTR_IMAGE.I_MB&&DTUtils.isFloatingImage(t))r["margin-bottom"]=a;else if(o==ATTR_IMAGE.I_TOP)r.top=a;else if(o==ATTR_IMAGE.I_LEFT)r.left=a;else if(o==ATTR_COMMON.BORDERS&&a.top){var c=DomUtil.getBorderStyles(t);i.css(c)}}if(i.attr(n).css(r),t&&t.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&!t.hasOwnProperty(ATTR_IMAGE.I_SHAPEDATA)){var u="rotate("+t[ATTR_IMAGE.I_ROTATE]+"deg)",r={"-ms-transform":u,"-moz-transform":u,"-webkit-transform":u,"-o-transform":u,transform:u};i.css(r)}}catch(e){}},DomUtil.applyStyleToSvgImage=function(e,t,i){if(t&&e)try{var n,r,o,a={},s=J(e),l=J(s[0].parentElement||s[0].parentNode),d=s.parent().parent()[0];i&&DomUtil.isSVGonloadSupportedBrowser()&&!t.shapeData&&!t.hasOwnProperty(ATTR_FILLABLEFIELD.FF_INFO)&&(DomUtil.addClassForElement(d,"ui-abs-loading-gif"),DomUtil.bindEventsForImage(s[0],t));var c=s.parents(".fgImgOuterDiv");if(s.removeClass("ui-mm-img-prop"),c.removeClass("ui-mm-img-outer-div"),s.removeAttr("style"),DocUtils.isImage(t)){var u=ZWJSONUtils.clone(t);if(!i){var g=JSON.parse(e.getAttribute("data-fmt"));u.src=g.src}e.setAttribute("data-fmt",JSON.stringify(u))}l.removeAttr("style"),c.removeAttr("style");var h={},f={};for(var p in t)if(t.hasOwnProperty(p)&&"type"!=p){var E=t[p];if(null!=E&&void 0!=E)if(p==ATTR_IMAGE.I_SRC){var T=DomUtil.processImgSrc(E);if(isHeadlessPDF&&DomUtil.isCropImge(t)){var O=t.id||Utils.randomString();DomUtil.addDummyImageForCrop(T,O);e.setAttribute("id",O),e.setAttribute("data-fmt",JSON.stringify(t))}(DomUtil.isImageMergeField(t)||DomUtil.isMapMergeField(t))&&(T=t.subType!=NODE_TYPE.WIDGET||DomUtil.isMapMergeField(t)?DomUtil.isMapMergeField(t)?imgCdnZWStaticPath+fingerPrintObj["images/common/svg/map.svg"]:DomUtil.isAlternateSrcPresent(t)?DomUtil.processImgSrc(t[ATTR_IMAGE.ALTSRC]):imgCdnZWStaticPath+fingerPrintObj["images/common/mail-merge-image_opt1.png"]:imgCdnZWStaticPath+fingerPrintObj["images/common/embed-background.png"]),t.hasOwnProperty("sheetInfo")&&(T=WidgetView.updateSheetSrc(T));var m="http";e.setAttributeNS(m+"://www.w3.org/1999/xlink","xlink:href",T)}else if(p==ATTR_COMMON.CLS)s.addClass(E),t&&t.hasOwnProperty(HISTORY_CONST.ACTION)&&t.hasOwnProperty(ATTR_COMMON.CLS)&&l.attr("class",(l.attr("class")||"")+" "+t[ATTR_COMMON.CLS]);else if(p==ATTR_IMAGE.I_LINKDATA){if(!jQuery.isEmptyObject(E)){var I='{"data-link-url":"'+E.url+'","data-link-type":"'+E.type+'"}';s.attr("linkData",I)}}else if(p==ATTR_IMAGE.I_WID){var D=t[ATTR_IMAGE.I_WID_UN],R=ZWImageUtils.getOrginalHeighWidthOfImage(t);if(""==t.wid&&""==t.ht&&(R.ht=0,R.wid=0),D&&("%"===D?(E=DocLayoutManager.getCurrentColumn().getWidth()+"px",t.cropRect&&!TransformHandler.getCurrentObjectInfo().isCropActive&&(E=DocLayoutManager.getCurrentColumn().getWidth()+(t.cropRect.cropLeft+t.cropRect.cropRight))):E=parseInt(R.wid)+D),DomUtil.isImageMergeField(t)&&!DomUtil.isAlternateSrcPresent(t)){var S=66;s.attr("width",S),s.attr("x",parseInt(E)/2-S/2)}else if(DomUtil.isBarcodeQRCodeImage(t)){var C=parseInt(E)-10;s.attr("width",C),s.attr("x",parseInt(E)/2-C/2)}else s.attr("width",E);r=E,s.parents("svg").width(E),J(s.parents("div")[0]).width(E)}else if(p==ATTR_IMAGE.I_HT){var D=t[ATTR_IMAGE.I_HT_UN],R=ZWImageUtils.getOrginalHeighWidthOfImage(t);if(""==t.wid&&""==t.ht&&(R.ht=0,R.wid=0),D&&("%"===D?(E=t[ATTR_IMAGE.I_ORGINALHT]*DocLayoutManager.getCurrentColumn().getWidth()/t[ATTR_IMAGE.I_ORGINALWID]+"px",t.cropRect&&!TransformHandler.getCurrentObjectInfo().isCropActive&&(E=t[ATTR_IMAGE.I_ORGINALHT]*DocLayoutManager.getCurrentColumn().getWidth()/t[ATTR_IMAGE.I_ORGINALWID]+(t.cropRect.cropTop+t.cropRect.cropBottom))):E=parseInt(R.ht)+D),DomUtil.isImageMergeField(t)&&!DomUtil.isAlternateSrcPresent(t)){var A=48;s.attr("height",A),s.attr("y",parseInt(E)/2-A/2)}else if(DomUtil.isBarcodeQRCodeImage(t)){var v=parseInt(E)-10;s.attr("height",v),s.attr("y",parseInt(E)/2-v/2)}else s.attr("height",E);o=E,s.parents("svg").height(E),J(s.parents("div")[0]).height(E)}else if(p==ATTR_IMAGE.I_OP)J(e).css("opacity",E/100);else if(p==ATTR_IMAGE.I_AL)h.align=E;else if(p==ATTR_IMAGE.I_IMGSIZE)h.imagesize=E;else if(p==ATTR_IMAGE.I_LATEXEXP)h.latexexpression=E;else if(p==ATTR_IMAGE.I_ID)h.id=E,"dummyEquationImage"===E&&(f.display="inline-block");else if(p==ATTR_IMAGE.I_ALT)h.alt=E;else if(p==ATTR_IMAGE.I_TOOLTIP)h.title=E;else if(p==ATTR_IMAGE.I_ML&&DTUtils.isFloatingImage(t))a["margin-left"]=E;else if(p==ATTR_IMAGE.I_MR&&DTUtils.isFloatingImage(t))a["margin-right"]=E;else if(p==ATTR_IMAGE.I_MT&&DTUtils.isFloatingImage(t))a["margin-top"]=E;else if(p==ATTR_IMAGE.I_MB&&DTUtils.isFloatingImage(t))a["margin-bottom"]=E;else if(p==ATTR_IMAGE.I_TOP)f.top=E;else if(p==ATTR_IMAGE.I_LEFT)f.left=E;else if(p==ATTR_IMAGE.I_CROPRECT){spanStyles={};var _=0,P=0;if("%"==t[ATTR_IMAGE.I_WID_UN])_=DocLayoutManager.getCurrentColumn().getWidth(),P=t[ATTR_IMAGE.I_ORGINALHT]*DocLayoutManager.getCurrentColumn().getWidth()/t[ATTR_IMAGE.I_ORGINALWID];else{var R=ZWImageUtils.getOrginalHeighWidthOfImage(t);_=R.wid,P=R.ht}E=ZWImageUtils.convertCropDataToPixel(E,P,_),spanStyles["margin-left"]=-E.cropLeft,spanStyles["margin-top"]=-E.cropTop,l.css(spanStyles)}else p==ATTR_COMMON.BORDERS&&E[ATTR_BORDERS.BORDER_TOP]&&(n=DomUtil.getBorderStyles(t),J(s.parents("div")[0]).css(n))}if(s.attr(h).css(f),DTUtils.isWrappingFloatImage(t)&&ZWJSONUtils.getKeys(a).length&&J(s.parents("div")[0]).css(a),t&&t.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&!t.shapeData){var N="rotate("+t[ATTR_IMAGE.I_ROTATE]+"deg)",f={"-ms-transform":N,"-moz-transform":N,"-webkit-transform":N,"-o-transform":N,transform:N};J(s.parents("div")[0]).css(f)}if(t&&t.hasOwnProperty(ATTR_IMAGE.I_CROPRECT)&&t[ATTR_IMAGE.I_CROPRECT]){var b=t[ATTR_IMAGE.I_HT],L=t[ATTR_IMAGE.I_WID],w=J(s.parents("div")[0]),R=ZWImageUtils.getOrginalHeighWidthOfImage(t),y=ZWImageUtils.convertCropDataToPixel(t[ATTR_IMAGE.I_CROPRECT],R.ht,R.wid);w.height(b),w.width(L),"%"==t[ATTR_IMAGE.I_WID_UN]&&(b=t[ATTR_IMAGE.I_ORGINALHT]*DocLayoutManager.getCurrentColumn().getWidth()/t[ATTR_IMAGE.I_ORGINALWID]-(y.cropTop+y.cropBottom),L=DocLayoutManager.getCurrentColumn().getWidth()-(y.cropTop+y.cropBottom),w.height(b),w.width(L)),o=b,r=L,w.css("overflow","hidden")}if(t[ATTR_COMMON.BORDERS]&&t[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]){var w=J(s.parents("div")[0]);w.css("height",parseFloat(o)+2*parseInt(t[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])),w.css("width",parseFloat(r)+2*parseInt(t[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]))}if(DomUtil.isBarcodeQRCodeImage(t)){J(e).addClass("ui-mm-img-prop");var M=t[ATTR_IMAGE.BARCODE_INFO]||t[ATTR_IMAGE.QRCODE_INFO];c.css("background-color",M.backgroundColor||BARCODE.DEFAULT.BG_COLOR)}if(DomUtil.isImagePlaceholder(t)){J(e).addClass("ui-mm-img-prop"),c.addClass("js-image-field"),!DomUtil.isImageMergeField(t)&&!DomUtil.isMapMergeField(t)||DomUtil.isAlternateSrcPresent(t)||c.addClass("ui-mm-img-outer-div");var F=t[MAILMERGE.MMINFO]||{},U=F[MAILMERGE.SHORTEN_NAME];!U&&F[MAILMERGE.FIELD_NAME]&&(U=F[MAILMERGE.FIELD_NAME],F[MAILMERGE.GROUP_NAME]&&(U=F[MAILMERGE.GROUP_NAME]+"."+U)),U||(U="Image",t.subType==NODE_TYPE.QRCODE?U="QR Code":t.subType==NODE_TYPE.BARCODE?U="Barcode":t.subType==NODE_TYPE.WIDGET&&(U="Embed",t[ATTR_WIDGET.MAPDETAILS]&&(U=J.i18n("writer.mailmergepopup.MAP"))));var V=J('<div class="ui-brokenImg-cont ui-flex-container ui-flex-center"><div class="ui-brokenImg-innercont"><div class="ui-emergefield-placeholder"></div></div></div>');V.find(".ui-emergefield-placeholder").text(U),t.subType==NODE_TYPE.WIDGET&&(c.css("border","0px"),V.css("border","0px")),c.append(V)}DomUtil.isSVGonloadSupportedBrowser()&&d.querySelectorAll(".ui-brokenImg-cont").length>0&&!DomUtil.isImagePlaceholder(t)&&t.cls&&t.cls.indexOf(NODE_TYPE.FILLABLEFIELD)===-1&&DomUtil.handleBrokenImage(t,d)}catch(e){}},DomUtil.handleBrokenImage=function(e,t){e.subType&&"chart"===e.subType&&(parseInt(e.wid)<124||parseInt(e.ht)<100)||parseInt(e.wid)<150||parseInt(e.ht)<90?(DomUtil.addClassForElement(t,"fgImgOuterDiv-xs"),DomUtil.removeClassForElement(t,"fgImgOuterDiv-sm")):parseInt(e.wid)<200||parseInt(e.ht)<138?(DomUtil.addClassForElement(t,"fgImgOuterDiv-sm"),DomUtil.removeClassForElement(t,"fgImgOuterDiv-xs")):(DomUtil.removeClassForElement(t,"fgImgOuterDiv-xs"),DomUtil.removeClassForElement(t,"fgImgOuterDiv-sm"))},DomUtil.getStyle=function(e){if(!e)return null;var t={},i="",n={},r={};for(var o in e)if(e.hasOwnProperty(o)&&"type"!=o){var a=e[o];if("cls"==o)i+=" "+a;else if(o==ATTR_TEXT.MM_FIELDNAME)r["data-fieldname"]=a;else if(o==ATTR_TEXT.TS_CS)n.letterSpacing="none"==a?"normal":a;else if("st"==o&&a==NODE_TYPE.TAB)i+=" tab";else if(o==ATTR_TEXT.TS_FW||o==ATTR_TEXT.TS_FW_I)n.fontWeight=Math.max("bold"===e[ATTR_TEXT.TS_FW]?700:0,e[ATTR_TEXT.TS_FW_I]||0)||400;else if(o==ATTR_TEXT.TS_FF)n.fontFamily="none"==a?"":Utils.fontFamilyRenderingFix(a);else if(o==ATTR_TEXT.TS_FV)n.fontVariant="none"==a?"":a;else if(o==ATTR_TEXT.TS_FS)n.fontStyle="none"==a?"normal":a;else if(o==ATTR_TEXT.TS_SIZE)n.fontSize="none"==a?"":a+"pt";else if(o==ATTR_TEXT.TS_FGC)n.color="none"==a?"":a;else if(o===ATTR_TEXT.TS_TT)n["text-transform"]=a;else if(o==ATTR_TEXT.TS_BGC)n.backgroundColor="none"==a?"":a;else if(o==ATTR_TEXT.TS_TD)"none"==a?n.textDecoration="none":e.cls&&"link"==e.cls&&a.indexOf("line-through")>-1?n.textDecoration="line-through underline":n.textDecoration=a;else if(o==ATTR_TEXT.TS_VA&&"none"!=a)n.verticalAlign=a;else if(o==ATTR_PARAGRAPH.PS_LS&&"none"!=a)n["line-height"]=a;else if(o==ATTR_PARAGRAPH.PS_PR&&"none"!=a)n["padding-right"]=a;else if("float"==o&&"none"!=a)n.float="left";else if("drop"==o&&"none"!=a)n.drop=a;else if(o==ATTR_PARAGRAPH.PS_ML&&"none"!=a)n["margin-left"]=a;else{if(o==ATTR_TEXT.TS_NULL){a&&(n={});break}o==ATTR_TEXT.CHAR_STY&&(i+="char_sty"+a)}}return e[ATTR_COMMON.BORDERS]&&ZWJSONUtils.mergeJsonObjs(n,DomUtil.getBorderStyles(e)),i&&(r.class=i),t.styles=n,t.attr=r,t},DomUtil.setStyle=function(e,t){try{if(!t||!e)return;var i=DomUtil.getStyle(t);if(jQuery.isEmptyObject(i))return;DomUtil.setStyleData(e,i)}catch(e){}},DomUtil.setStyleData=function(e,t){var i=J(e),n=t.styles;if(jQuery.isEmptyObject(n))e.style="";else{var r,o,a,s=n.verticalAlign;n.fontSize&&(a=n.fontSize,o=DomUtil.getFontSize(a),r=o),"super"!=s&&"sub"!=s||n.fontSize&&(r=Math.round(.7*r)),r&&(n.fontSize=r+"pt")}i.css(n);var l=t.attr;if(!jQuery.isEmptyObject(l)){var d=i.attr("class")||"";d=d.trim();var c=l.class||"";c=c.trim(),d+=d?" "+c:"",l.class=d.trim(),i.attr(l)}},DomUtil.getFontSize=function(e){e+="";var t,i=0;return e.match(/px$/)?(t=e.replace("px",""),i=72*parseFloat(t)/96,i=i%1===.5?i:Math.round(i)):e.match(/pt$/)?i=e.replace("pt",""):e.match(/em$/)||e.match(/%$/)?(t=e.replace("em",""),t.match(/%$/)&&(t=t.replace("%","")/100),i=parseFloat(t)*parseInt(editor.doc.getFontSize(0))):i=e,i},DomUtil.getBorderStyles=function(e){var t={"border-top":"paddingTop","border-left":"paddingLeft","border-right":"paddingRight","border-bottom":"paddingBottom"},i={"br-topLeft":"border-top-left-radius","br-topRight":"border-top-right-radius","br-bottomLeft":"border-bottom-left-radius","br-bottomRight":"border-bottom-right-radius"},n={};if(!e.hasOwnProperty(ATTR_COMMON.BORDERS))return n;var r=e[ATTR_COMMON.BORDERS];for(var o in r)U.isEmpty(r[o])||(r[o][ATTR_BORDERS.WIDTH]&&(n[o]=parseFloat(r[o][ATTR_BORDERS.WIDTH])+"px "+r[o][ATTR_BORDERS.TYPE]+" "+Utils.getColorValFromRefString(r[o][ATTR_BORDERS.COLOR])),r[o][ATTR_BORDERS.SPACE]&&(n[t[o]]=r[o][ATTR_BORDERS.SPACE].convertor().pixels));var a=e.borders[ATTR_BORDERS.BORDER_RADIUS];if(a)for(side in a)n[i[side]]=a[side]+"px";return n},DomUtil.setParaStyle=function(e,t,i,n,r){try{if(!e)return;t||(t={}),(t[ATTR_PARAGRAPH.PS_NULL]||t[ATTR_TEXT.TS_NULL])&&(para.style="");var o="",a=J(e),s=DomUtil.getBorderStyles(t);for(var l in t)t.hasOwnProperty(l)&&"type"!=l&&(o=t[l],l==ATTR_PARAGRAPH.PS_SB&&n?s.marginTop=o:l==ATTR_PARAGRAPH.PS_DIR?s.direction=o:l==ATTR_PARAGRAPH.PS_SA&&n?s.marginBottom=o:l==ATTR_PARAGRAPH.PS_ML?s.marginLeft=o:l==ATTR_PARAGRAPH.PS_MR?s.marginRight=o:l==ATTR_PARAGRAPH.PS_PL?s.paddingLeft=o:l==ATTR_PARAGRAPH.PS_PR?s.paddingRight=o:l==ATTR_PARAGRAPH.PS_PT?s.paddingTop=o:l==ATTR_PARAGRAPH.PS_PB?s.paddingBottom=o:l==ATTR_PARAGRAPH.PS_WS?s.wordSpacing=o:l==ATTR_PARAGRAPH.PS_TI&&n?s.textIndent=o:l==ATTR_PARAGRAPH.PS_BGC?s.backgroundColor="none"==o?"":o:l==ATTR_PARAGRAPH.PS_TPS?e.setAttribute("data-tabPoints",JSON.stringify(o)):l==ATTR_PARAGRAPH.PS_LS?s.lineHeight=o:l==ATTR_PARAGRAPH.PS_AL&&0==o?s.textAlign="rtl"===t.dir?"right":"left":l==ATTR_PARAGRAPH.PS_AL&&1==o?s.textAlign="center":l==ATTR_PARAGRAPH.PS_AL&&2==o?s.textAlign="rtl"===t.dir?"left":"right":l==ATTR_PARAGRAPH.PS_AL&&3==o?s.textAlign="justify":l==ATTR_PARAGRAPH.PS_HD?("undefined"==typeof o&&(o=0),a.attr({"data-header":o}).removeClass().addClass("zw-paragraph heading"+o)):l==ATTR_PARAGRAPH.PS_TS&&r&&DomUtil.isParaEmpty(r.getNode())?DomUtil.setStyle(J(e).find("span.EOP")[0],o):l==ATTR_PARAGRAPH.PS_LINE_RULE?(a.attr({"data-lineRule":o}),a.attr({"data-line-height":t[ATTR_PARAGRAPH.PS_LS]})):l==ATTR_PARAGRAPH.PS_CODE&&a.attr({"data-codeformat":JSON.stringify(o)}),l==ATTR_PARAGRAPH.PS_TS&&a.attr({"data-textformat":JSON.stringify(o)}));jQuery.isEmptyObject(s)||a.css(s)}catch(e){}},DomUtil.isParaEmpty=function(e){return e&&e.end-e.start==1},DomUtil.excludeTextBox=function(e,t,i){return!!J(i).parentsUntil(e).hasClass("zw-textbox-div")},DomUtil.setStyleToTextBox=function(e,t){var i=e[ATTR_COMMON.BORDERS]?parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0,n=t.children[0],r=n.children[0],o=t.children[1],a=function(e){var t=e.effects.shadow,i=!("none"==e.z_tb_bgc&&!e[ATTR_CELL.TDS_BGIMG]),n=10,r=function(){return this.style.marginTop?this.style.marginTop:"0"},o=function(){return this.style.marginLeft?this.style.marginLeft:"0"},a=function(){var e=editor.doc.getBodyFormat().bgc,t="rgba(0,0,0,0.15)",i=t.match(/\d+\.*\d*/g),n={};n.R=i.shift()/255,n.G=i.shift()/255,n.B=i.shift()/255,n.A=i.shift()/1;var r=e.match(/\d+\.*\d*/g),o={R:r.shift()/255,G:r.shift()/255,B:r.shift()/255},a={};a.R=parseInt(255*((1-n.A)*o.R+n.A*n.R)),a.G=parseInt(255*((1-n.A)*o.G+n.A*n.G)),a.B=parseInt(255*((1-n.A)*o.B+n.A*n.B));var s="rgb("+a.R+","+a.G+","+a.B+")";return s},s=function(){var t={},r=n+"px solid "+a(),o=a()+" 0px 0px "+n+"px 0px";if(!i){var s=ZWJSONUtils.clone(e);if(s[ATTR_COMMON.BORDERS]){s[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]&&(s[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.COLOR]=a());var l=DomUtil.getBorderStyles(s);r=l[ATTR_BORDERS.BORDER_TOP],o=a()+" 0px 0px "+s[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]+" 0px"}}return t.border=r,t.shadow=o,t},l={45:function(){var e={};return e["margin-top"]=r.call(this).convertor().pixels+n,e["margin-left"]=o.call(this).convertor().pixels+n,e},90:function(){var e={};return e["margin-top"]=r.call(this).convertor().pixels+n,e},135:function(){var e={};return e["margin-top"]=r.call(this).convertor().pixels+n,e["margin-left"]=o.call(this).convertor().pixels-n,e},0:function(){var e={};return e["margin-left"]=o.call(this).convertor().pixels+n,e},180:function(){var e={};return e["margin-left"]=o.call(this).convertor().pixels-n,e},315:function(){var e={};return e["margin-top"]=r.call(this).convertor().pixels-n,e["margin-left"]=o.call(this).convertor().pixels+n,e},270:function(){var e={};return e["margin-top"]=r.call(this).convertor().pixels-n,e},225:function(){var e={};return e["margin-top"]=r.call(this).convertor().pixels-n,e["margin-left"]=o.call(this).convertor().pixels-n,e},NONE:function(){return{}}},d=l[t]?l[t]:l.NONE,c=d.call(this),u=s();c.border=u.border,c["box-shadow"]=u.shadow,i?c["background-color"]=a():c["background-color"]="",J(this).css(c)};if(n.style.width=e[ATTR_IMAGE.I_WID]+"px",n.style.height=e[ATTR_IMAGE.I_HT]+"px",o.style.width=e[ATTR_IMAGE.I_WID]+"px",o.style.height=e[ATTR_IMAGE.I_HT]+"px",e.hasOwnProperty(ATTR_IMAGE.I_ROTATE)){var s="rotate("+e[ATTR_IMAGE.I_ROTATE]+"deg)",l={"-ms-transform":s,"-moz-transform":s,"-webkit-transform":s,"-o-transform":s,transform:s};J(n).css(l),J(o).css(l);var d=e[ATTR_IMAGE.I_WID],c=e[ATTR_IMAGE.I_HT],u=TransformationUtils.getTransformedSize(e[ATTR_IMAGE.I_ROTATE],d,c),g=(u.width-d)/2,h=(u.height-c)/2;l={position:"absolute",top:h+"px",left:g+"px"},J(n).css(l),J(o).css(l)}else{var l={height:"",width:""};J(t).css(l),l=e.hasOwnProperty(ATTR_IMAGE.I_WRAP_TYPE)?{position:"absolute",top:"0px",left:"0px"}:{position:"",top:"",left:""},l.transform="",J(n).css(l),l={transform:"",top:"0px",left:"0px"},J(o).css(l)}if(e.hasOwnProperty(ATTR_IMAGE.I_OP)){var f=e[ATTR_IMAGE.I_OP]/100;n.style.opacity=f,o.style.opacity=f,editor.browserInfo.is_ie&&(n.style.filter="alpha(opacity="+f+")",o.style.filter="alpha(opacity="+f+")")}if(e.hasOwnProperty(ATTR_COMMON.BORDERS)){var p=e[ATTR_COMMON.BORDERS],E=e[ATTR_IMAGE.I_HT],T=e[ATTR_IMAGE.I_WID];p[ATTR_BORDERS.BORDER_TOP]&&(borderStyles=DomUtil.getBorderStyles(e),J(n).css(borderStyles),J(n).css("height",parseFloat(E)+2*parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])),J(n).css("width",parseFloat(T)+2*parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])),J(o).css("height",parseFloat(E)+2*parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])),J(o).css("width",parseFloat(T)+2*parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])))}var O={};if(e.hasOwnProperty(ATTR_IMAGE.I_MB)&&(O["margin-bottom"]=e[ATTR_IMAGE.I_MB]),e.hasOwnProperty(ATTR_IMAGE.I_MR)&&(O["margin-right"]=e[ATTR_IMAGE.I_MR]),e.hasOwnProperty(ATTR_IMAGE.I_MT)&&(O["margin-top"]=e[ATTR_IMAGE.I_MT]),e.hasOwnProperty(ATTR_IMAGE.I_ML)&&(O["margin-left"]=e[ATTR_IMAGE.I_ML]),DTUtils.isWrappingFloatImage(e)&&ZWJSONUtils.getKeys(O).length?(J(n).css(O),J(o).css(O)):(O["margin-bottom"]="",O["margin-right"]="",O["margin-top"]="",O["margin-left"]="",J(n).css(O),J(o).css(O)),e.hasOwnProperty("z_tb_bgc")){var m=e.z_tb_bgc;n.style.background=m}if(e[ATTR_CELL.TDS_BGIMG]){var I=DomUtil.processImgSrc(e[ATTR_CELL.TDS_BGIMG]),D="url('"+I+"')";n.style.background=D,n.style.backgroundSize="100% 100%"}var R={};if(e.hasOwnProperty(ATTR_CELL.TDS_PB)&&(R["padding-bottom"]=e[ATTR_CELL.TDS_PB]),e.hasOwnProperty(ATTR_CELL.TDS_PR)&&(R["padding-right"]=e[ATTR_CELL.TDS_PR]),e.hasOwnProperty(ATTR_CELL.TDS_PT)&&(R["padding-top"]=e[ATTR_CELL.TDS_PT]),e.hasOwnProperty(ATTR_CELL.TDS_PL)&&(R["padding-left"]=e[ATTR_CELL.TDS_PL]),ZWJSONUtils.getKeys(R).length){var l={},S=e[ATTR_CELL.TDS_PT]?parseFloat(e[ATTR_CELL.TDS_PT].convertor().pixels):0,C=e[ATTR_CELL.TDS_PL]?parseFloat(e[ATTR_CELL.TDS_PL].convertor().pixels):0,A=e[ATTR_CELL.TDS_PR]?parseFloat(e[ATTR_CELL.TDS_PR].convertor().pixels):0,v=e[ATTR_CELL.TDS_PB]?parseFloat(e[ATTR_CELL.TDS_PB].convertor().pixels):0;l={width:e[ATTR_IMAGE.I_WID]-C-A,height:e[ATTR_IMAGE.I_HT]-S-v,"margin-top":S,"margin-left":C,"margin-right":A,"margin-bottom":v},J(r).css(l)}else{var l={width:e[ATTR_IMAGE.I_WID],height:e[ATTR_IMAGE.I_HT],"margin-top":"","margin-left":"","margin-right":"","margin-bottom":""};J(r).css(l)}if(e.hasOwnProperty("effects")&&e.effects.shadow&&(a.call(o,e),"NONE"==e.effects.shadow?o.style.display="none":o.style.display="block"),!e.hasOwnProperty(ATTR_IMAGE.I_WRAP_TYPE)&&"undefined"!=typeof TransformationUtils){var d=e[ATTR_IMAGE.I_WID],c=e[ATTR_IMAGE.I_HT],u=TransformationUtils.getTransformedSize(e[ATTR_IMAGE.I_ROTATE],d,c),_={width:u.width+2*i,height:u.height+2*i};J(t).css(_)}},DomUtil.setTableStyle=function(e,t,i){try{if(!t||!e)return;var n=i.getNode(),r=e.querySelector("colgroup"),o=n.cols,a=n.isTableWidthInPercentage,s="",l=0;if(o){J(r).empty();for(var d=0;d<o.length;d++){var c=document.createElement("col");a?c.style.width=o[d].wt:(l=Conversions.toGlobalUnit(o[d].wt).toFixed(2),0==l&&(l="1px".convertUnitTo(Conversions.globalUnit).toFixed(2)),c.style.width=l+Conversions.globalUnit),r.appendChild(c)}}var u=e.style;for(var g in t)if(t.hasOwnProperty(g)&&"type"!=g&&(s=t[g],null!=s))switch(g){case ATTR_TABLE.TBLS_AL:u.marginLeft=i.left+"px";break;case ATTR_TABLE.TBLS_ML:t[ATTR_TABLE.TBLS_AL]&&"left"!=t[ATTR_TABLE.TBLS_AL]||(u.marginLeft=s);break;case"z_tbl_bgc":u.background=s;break;case ATTR_TABLE.TBLS_CP:e.setAttribute("cellspacing",s);break;case ATTR_TABLE.TBLS_WID:u.width=s;break;case ATTR_TABLE.TBLS_BGIMG:s=DomUtil.processImgSrc(s),u.background="transparent  url("+s+") 50%",u.backgroundSize="100%";break;case ATTR_TABLE.TBLS_DIR:var h=t[ATTR_TABLE.TBLS_DIR]||PARA_DIR.LTR;u.direction=h;break;case ATTR_COMMON.CLS:var f=e.getAttribute("class");e.setAttribute("class",f+" "+s)}(t[ATTR_TABLE.TBLS_ML]||t[ATTR_TABLE.TBLS_AL])&&PubSub.publish("Table/marginChanged")}catch(e){}},DomUtil.setHRStyle=function(e,t,i){try{var n=t.getNode().getFormats();if(!n||!e)return;var r={},o=J(e);r=DomUtil.getBorderStyles(n),n[ATTR_COMMON.BORDERS]||n.bid||(r["border-top"]="1px solid black");for(var a in n)if(n.hasOwnProperty(a)&&"type"!=a){var s=n[a];switch(a){case ATTR_HR.HR_WID:i?e.setAttribute("width",s):r.width=s;break;case ATTR_HR.HR_HT:r.height=s;break;case ATTR_COMMON.BORDERS:if(!n.bid){var l=DomUtil.getBorderStyles(n);r["border-top"]=l["border-top"],i&&(r["border-bottom-width"]="0px",r["border-left-width"]="0px",r["border-right-width"]="0px")}break;case ATTR_HR.HR_AL:if(i)e.setAttribute("data-align",s);else{var d=n.wid?n.wid:J(e).width(),c=t.column?t.column.width:DocLayoutManager.getContentWidthAtIndex(t.getNode().getIndex()),u=c-d;0==s?r["margin-left"]=0:1==s?r["margin-left"]=u/2:2==s&&(r["margin-left"]=u)}break;case"bid":break;case"cls":o.addClass(s)}}r.cursor="text",o.css(r)}catch(e){}},DomUtil.setCellBorders=function(e,t){if(e&&t){var i=e.style;i.borderTop=t["border-top"]?t["border-top"]:"",i.borderLeft=t["border-left"]?t["border-left"]:"",i.borderRight=t["border-right"]?t["border-right"]:"",i.borderBottom=t["border-bottom"]?t["border-bottom"]:""}},DomUtil.setCellPadding=function(e,t){if(e&&t){var i=e.querySelector("div.zw-cell-container");i.style.paddingLeft=t.left+"px",i.style.paddingRight=t.right+"px",i.style.paddingTop=t.top+"px",i.style.paddingBottom=t.bottom+"px"}},DomUtil.setCellStyle=function(e,t,i,n,r){try{if(!i||!t)return;styles=DomUtil.getBorderStyles(i),DomUtil.setCellBorders(t,styles);var o,a=t.style,s=DocUtil.getCellPadding(i),l="";t.parentElement&&(o=t.parentElement.children);var d;i.parentRowRule&&"exact"==i.parentRowRule&&(d=!0);var c=t;n&&(c=t.querySelector("div.zw-cell-container")),i.isCellContainesImage||i.isCellContainesTable||d?a.overflow="hidden":(a.overflow="",c.style.height&&(c.style.height=""));for(var u in i)if(i.hasOwnProperty(u)&&"type"!=u&&(l=i[u],null!=l))switch(u){case"z_td_bgc":a.background=l;break;case ATTR_CELL.TDS_BGIMG:l=DomUtil.processImgSrc(l),a.background="transparent  url("+l+") 50%",a.backgroundSize="100%";break;case ATTR_CELL.TDS_VA:"baseline"!=l&&(a.verticalAlign=l);break;case ATTR_CELL.TDS_TXTAL:break;case ATTR_CELL.TDS_MRG:var g=r?r:t.parentElement;if("hmp"==l){if(a.display="none",t.setAttribute("merge","hmp"),styles["border-right"]&&g&&!e.next)for(var h,f=g.children.length-1,p=f;p>=0;p--){if(h=g.children[p],"fc"==h.attributes.merge.value){h.style.borderRight||(h.style.borderRight=styles["border-right"]);break}if("vmp"==h.attributes.merge.value)break}}else if("vmp"==l){if(t.setAttribute("merge","vmp"),a.display="none",styles["border-bottom"]&&e.parent&&!e.parent.next)for(var E,T=e.getRootMergeCell(),O=DocLayoutManager.getViews(T),m=O.length,p=0;p<m;p++)E=O[p]&&DomViewManager.getDOMElem(O[p]),E&&!E.style.borderBottom&&(E.style.borderBottom=styles["border-bottom"])}else if("fc"==l){if(t.setAttribute("merge","fc"),!styles["border-right"]&&t.nextElementSibling&&"hmp"==t.nextElementSibling.getAttribute("merge")){for(var I=t.nextElementSibling;I&&I.nextElementSibling&&"hmp"==I.nextElementSibling.getAttribute("merge");)I=I.nextElementSibling;!I.nextElementSibling&&I.style.borderRight&&(styles["border-right"]=I.style.borderRight,t.style.borderRight=I.style.borderRight)}if(!styles["border-bottom"])for(var D,E,R,S,O=DocLayoutManager.getViews(e),m=O.length,p=0;p<m;p++)D=O[p],R=D.getLastVmpCell(),R&&(E=DomViewManager.getDOMElem(D),S=DomViewManager.getDOMElem(R),S&&!S.parentElement.nextElementSibling&&S.style.borderBottom&&(styles["border-bottom"]=S.style.borderBottom,t.style.borderBottom=S.style.borderBottom))}break;case ATTR_CELL.TDS_CSPAN:styles.display&&"none"==styles.display||t.setAttribute("colspan",l);break;case ATTR_CELL.TDS_RSPAN:styles.display&&"none"==styles.display||t.setAttribute("rowspan",l);break;case ATTR_CELL.TDS_HT:var C;"fc"==i.merge&&i.fcHeight&&(C=i.fcHeight);var A=(s.top||0)+(s.bottom||0);DomUtil.setCellHeight(t,C>0?C:l,d,A);break;case ATTR_CELL.TDS_PL:c.style.paddingLeft=s.left+"px";break;case ATTR_CELL.TDS_PR:c.style.paddingRight=s.right+"px";break;case ATTR_CELL.TDS_PT:c.style.paddingTop=s.top+"px";break;case ATTR_CELL.TDS_PB:c.style.paddingBottom=s.bottom+"px";break;case"colwidth":l=l.convertor().pixels-1,a.width=l+"px",l-=s.left+s.right,l<0&&(l=0),c.style.width=l+"px";break;case"fc":a.color=l;break;case ATTR_COMMON.CLS:var v=t.getAttribute("class");t.setAttribute("class",v+" "+l)}}catch(e){var _=new ZWConsole;_.enable(),_.error(e),_.disable()}},DomUtil.setCellHeight=function(e,t,i,n){if(e&&"none"!=e.style.display){if(i){var r=e.querySelector("div.zw-cell-container");r.style.height=parseFloat((t-n).toFixed(2))+"px"}e.style.height=parseFloat(t.toFixed(2))+"px"}},DomUtil.setRowStyle=function(e,t){try{if(!t||!e)return;var i=J(e);t&&t.hasOwnProperty(TCConstants.TC)&&(t=TcView.updateDOMStyles(t));var n="",r=DomUtil.getBorderStyles(t),o={};for(var a in t)if(t.hasOwnProperty(a)&&"type"!=a)switch(n=t[a],a){case ATTR_ROW.TRS_HT:break;case ATTR_ROW.TRS_BGC:r.backgroundColor=n;break;case"z_tr_bgc":o.backgroundColor=n}t.hasOwnProperty(ATTR_COMMON.CLS)&&i.addClass(t[ATTR_COMMON.CLS])}catch(e){}if(!jQuery.isEmptyObject(o)){var s=i.find("td");s.css(o)}jQuery.isEmptyObject(r)||i.css(r)},DomUtil.removeCursorNode=function(e,t){t=t?t:"start",e=e?e:editor.uuid;try{if(editor.doc.domCursor[e]){var i=editor.doc.getDomCursorNode(e,null,t);if(i[0]&&e!=editor.uuid){i.remove();var n=editor.doc.getCursorPortionNode(e,t);n&&n.parentNode&&DomUtil.normalizeNode(n.parentNode),delete editor.doc.domCursor[e][t].cursor}}}catch(e){}},DomUtil.normalizeNode=function(){(editor.browserInfo.isWebkit||editor.browserInfo.isGecko||editor.browserInfo.isPresto)&&aNode&&aNode.normalize()},DomUtil.placeNode=function(e,t,i){for(var n,r=!1,o=J(i);e;){if(3==e.nodeType){if(t<e.length){n=e.splitText(t);break}if(e.length==t){n=e,r=!0;break}t-=e.length}else J(e).hasClass("zw-space")&&t--;if(t<=0){n=e,(0!=t||0==t&&J(e).hasClass("zw-space"))&&(r=!0);break}if(!e.nextSibling){n=e,r=!0;break}e=e.nextSibling}return r?o.insertAfter(n):o.insertBefore(n),r?n.nextSibling:n},DomUtil.tagVsClass={p:"div.zw-paragraph",span:"span.zw-portion",table:"table.zw-table",tbody:"tbody.zw-tbody",tr:"tr.zw-tr",td:"td.zw-td",hr:"div.zw-hr",br:".zw-br",image:"image.zw-image"},DomUtil.getTagWithClassName=function(e){var t=DomUtil.tagVsClass[e];return t=t?t:e},DomUtil.getPreviousSibling=function(e){if(!e)return null;for(var t=e.previousSibling;t&&3==t.nodeType;){if(J(t).parents().is("[class^=zw-]"))return t;t=t.parentNode}for(;t&&1==t.nodeType&&!J(t).is("[class^=zw-]");)t=t.previousSibling;return t},DomUtil.getNextSibling=function(e){if(!e)return null;for(var t=e.nextSibling;t&&3==t.nodeType;){if(J(t).parents().is("[class^=zw-]"))return t;t=t.parentNode}for(;t&&1==t.nodeType&&!J(t).is("[class^=zw-]");)t=t.nextSibling;return t},DomUtil.getElementAt=function(e,t,i){var n,r=J(i),o=DomUtil.getTagWithClassName(e);return n=r.hasClass("zw-contentpane")?editor.jeditorPane.find("div.zw-contentpane").find(o)[t]:r.find(o)[t]},DomUtil.addClickEventForLink=function(e,t,i,n,r){e.on("click",function(e){if(e.preventDefault(),2==t){var n=/^http(s)?:\/\/.*\..*/i,r=/^www\..*\..*/i;n.test(i)||r.test(i)?(r.test(i)&&(i=editor.scheme+"://"+i),Utils.safeWindowOpen(i)):Utils.moveToBookmark(i,!0)}else t==LINK_TYPES.WEBURL&&Utils.isRelativeLink(i)&&(i=Utils.getAbsoluteLink(i)),Utils.safeWindowOpen(i)}),r?e.children().css("cursor","pointer"):e.css("cursor","pointer")},DomUtil.setAnchorForImages=function(e,t){var i=J(t),n=e.type,r=e.url,o=e.target?e.target:"blank";DomUtil.addClickEventForLink(i,n,r,o,!0)},DomUtil.setLinkDatas=function(e,t){if(e){var i=e[ATTR_LINK.LINK_URL]||"",n=e[ATTR_LINK.LINK_TYPE]||"",r=e[ATTR_LINK.LINK_TARGET]?e[ATTR_LINK.LINK_TARGET]:"blank";n==LINK_TYPES.WEBURL&&Utils.isRelativeLink(i)&&(i=Utils.getAbsoluteLink(i));var o=J(t).attr({"data-title":i,"data-href":i,"data-type":n,"data-target":e[ATTR_LINK.LINK_TARGET]||"",title:n===LINK_TYPES.BOOKMARK||n===LINK_TYPES.MMFIELD?"":i});i&&("PUBLIC"===editor.doc.getRole()||e.cls&&e.cls.indexOf("autopno_toc")!=-1)&&DomUtil.addClickEventForLink(o,n,i,r,!1)}},DomUtil.bindTableEvents=function(e){e&&J(e).bind("mouseover",function(e){DomUtil.handleMouseOverForTable(e)}).bind("mouseout",function(e){DomUtil.handleMouseOutForTable(e)})},DomUtil.handleMouseOutForTable=function(){"undefined"==typeof TableResize||TableResize.isInProgress()||(editor.jeditorPane.unbind("mousemove.TableResize"),TableResize.setIsColumnResize(!1),TableResize.setIsRowResize(!1),TableResize.setColSelection(!1),J("div#editorpane, table").children().css({"user-select":"text","-o-user-select":"text","-moz-user-select":"text","-khtml-user-select":"text","-webkit-user-select":"text"}))},DomUtil.handleMouseOverForTable=function(e){"undefined"!=typeof TableResize&&"undefined"!=typeof TableResize&&editor.jeditorPane.bind("mousemove.TableResize",function(e){TableResize.mouseMove(e)});e.srcElement||e.target},DomUtil.processImgSrc=function(e){var t=e;return t?(editor.doc.getRole()==USER_ROLE.PUBLIC?0===e.indexOf("image.do")?(t=Macros.getImageSrcWithRid(t),t=editor.getBaseURL()+"/"+e):0===e.indexOf("images/")?t=imgStaticURL+e:0===e.indexOf("/images/")&&(t=imgStaticURL+e.substring("/".length)):ZWOffline.isOfflineSetupDone()&&editor.isOffline()?t=OfflineImpl.getImageSrc(e):0!=t.indexOf("image.do")&&0!=t.indexOf("remoteImage.do")||(t=Macros.getImageSrcWithRid(t),t=ZWNetworkUtils.getContextUrl(t)),t):t},DomUtil.updateImageSrc=function(e){if(e){e.indexOf("image.do")==-1&&e.indexOf("remoteImage.do")==-1||(e=Macros.getImageSrcWithRid(e),e=ZWNetworkUtils.getContextUrl(e));var t=e.indexOf("?")!=-1?"&t=":"?t=";e=e+t+(new Date).getTime();var i=editor.editorPaneContainer.find("image");U.each(i,function(t){var i=t.getAttribute("xlink:href");i=i.substr(0,i.indexOf("&t=")!=-1?i.indexOf("&t="):i.length),i=i.substr(0,i.indexOf("&rid=")!=-1?i.indexOf("&rid="):i.length),i=i.substr(0,i.indexOf("&rsid=")!=-1?i.indexOf("&rsid="):i.length);var n=e;n=n.substr(0,n.indexOf("&t=")!=-1?n.indexOf("&t="):n.length),n=n.substr(0,n.indexOf("&rid=")!=-1?n.indexOf("&rid="):n.length),n=n.substr(0,n.indexOf("&rsid=")!=-1?n.indexOf("&rsid="):n.length),i==n&&(t.setAttribute("xlink:href",e),DomUtil.bindEventsForImage(t))}),i=J('img[data-zw-imagesrc="'+e+'"]'),U.each(i,function(t){t.setAttribute("src",e);var i=J(t);i.removeAttr("alt"),i.removeClass("ui-loading-img ui-loading-bg ui-pos-rel")}),i=J("div#imageCopy").find('img[src^="'+e+'"]'),U.each(i,function(t){t.setAttribute("src",e)})}},DomUtil.createTOC=function(e){var t=editor.doc.getBodyFormat(),i='<div id="tocBtnGrp" class="ui-toc-btngrp zbutton--group ui-fr" style="z-index:100;position:relative;">';editor.getRole().permissions.can("document.edit")&&(i+='<div id="'+CONST.TOC_SETTINGS+'" class="zbutton" title="'+J.i18n("common","TOC_SETTINGS")+'"><span class="zbutton__icon ui-sprit-fast ui-icon-topband-settings-sm"></span></div><button id ="'+CONST.TOC_REGENERATE+'"  role="button" class="zbutton  zbutton--medium  zbutton--menu zbutton--icononly" aria-label="undefined" aria-haspopup="true" type="button" style="border-bottom-left-radius: 0px; border-bottom-right-radius: 0px;"><i class="zbutton__icon zbutton__mainicon  ui-sprit-fast ui-icon-refresh-blue-sm"></i></button><div id="'+CONST.TOC_CLOSE+'" class="zbutton" title="'+J.i18n("common","REMOVE_TOC")+'" onclick="editor.doc.execCmd(\'deletetoc\')"><span class="zbutton__icon ui-sprit-lazy ui-icon-delete-blk-sm"></span></div>');var n=J(document.createElement("div")).css("border-color",t[ATTR_BODY.DS_BGC]).attr({id:CONST.TOC_MAIN_DIV,bid:"pgbrk",class:"tocClass"}).html(i);return n.find("#"+CONST.TOC_REGENERATE+",#"+CONST.TOC_SETTINGS+",#"+CONST.TOC_CLOSE).on("mouseup",function(e){e.stopPropagation()}),n.find("#"+CONST.TOC_REGENERATE+",#"+CONST.TOC_SETTINGS+",#"+CONST.TOC_CLOSE).on("mousedown",function(e){var t=e.target,i=J(t).parents("div#toc"),n=editor.doc.getSelection().getStart(),r=i.next("div.zw-paragraph")[0];if(r||(r=i.prev("div.zw-paragraph")[0]),r){n=DocUtil.getDocElement(r).getStart();var o=editor.doc.getSelection().getLastRange();o&&o.setStart(n)&&o.setEnd(n)}e.stopPropagation()}),e[ATTR_COMMON.CLS]&&n.addClass(e[ATTR_COMMON.CLS]),n.find("#"+CONST.TOC_REGENERATE).on("click",function(e){var t=J("#tocRegenerateMenu");t.data().componentName||t.zmenu(),t.zmenu("show",{forElement:n.find("#"+CONST.TOC_REGENERATE)[0]})}),n.find("#"+CONST.TOC_SETTINGS).on("click",function(e){return TocDialog.openTocSettingsDlg(),DomUtil.stopEvent(e),!1}),n.on("mouseover",function(){var e=J(this);editor.getRole().permissions.can("document.edit")&&!DocTreeManager.isContentSectionBuildInProgress()&&e.css("border-color","#D4D4D4").find(".ui-toc-btngrp").show().find("#tocSettings")[LayoutManager.isFullscreen()?"hide":"show"]()}).on("mouseleave",function(e){"tocRegenerateMenu"!=e.toElement.id&&(J(this).css("border-color","transparent").find(".ui-toc-btngrp").hide(),J("#tocRegenerateMenu").hide())}),e[ATTR_COMMON.CLS]&&n.addClass(e[ATTR_COMMON.CLS]),DomUtil.setTOCStyle(e,n),n[0]},DomUtil.updateMarkingDiv=function(){var e=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start"),t=e.parents(".zw-line-div"),i=t.offset(),n=i.left,r=(i.top,t.children(".zw-line-content")),o=e.offset().left-n;J(".markingDiv").remove(),J(document.createElement("div")).addClass("markingDiv tc-rev-connector-horizontal").css({left:"-20px",width:o+20,position:"absolute","z-index":"2","border-top":"1px dotted #2d6fb9"}).prependTo(r),J(document.createElement("div")).addClass("markingDiv tc-rev-connector-horizontal").css({position:"absolute",width:"10",height:"3","margin-left":o,border:"1px solid #2d6fb9","background-color":"#2d6fb9"}).prependTo(r)},DomUtil.applyDocumentStyle=function(e){if(e){if(!isV8Engine)var t=editor.jeditorPane[0];for(var i in e)if(e.hasOwnProperty(i)){e[i];i!=ATTR_BODY.DS_TPS||isV8Engine?i!=ATTR_BODY.DS_STYLES&&i!=ATTR_BODY.DS_THEME&&i!=ATTR_BODY.DS_STYLE_UI_INFO||(Utils.setDocumentStyle(),PubSub.publish("Document/themeChanged")):t.setAttribute("tabPoints",e[i])}e[ATTR_BODY.DS_VIEW]&&!isV8Engine&&editor.onResize()}},DomUtil.isHRDiv=function(e){var t=e?e.className:"";return t&&J(e).hasClass("zw-hr")},DomUtil.setTOCStyle=function(e,t){DomUtil.setStyle(t[0],e)},DomUtil.getBorderRadiusStyle=function(e,t){var i=e[ATTR_BORDERS.BORDER_RADIUS],n={"br-topLeft":"border-top-left-radius","br-topRight":"border-top-right-radius","br-topLeft":"border-bottom-left-radius","br-topLeft":"border-bottom-right-radius"};if(i)for(side in i)t[n[side]]=i[side]},DomUtil.getBottombarHeight=function(){var e=document.getElementById("bottombar")||getPublishBottomBand(),t=document.getElementById("wmstoolbar"),i=(e&&e.offsetHeight)+(t&&t.offsetHeight);return i||0},DomUtil.setEditorHht=function(){var e=J("#ui-editor-outer-div");if(e[0]){var t=DomUtil.getBottombarHeight();(isHeadlessPDF||editorProps.isCleanHTML)&&e.css("overflow","");var i=J(window).height()-(e.offset().top+t);if(EditorView.isWebView()&&(i-=parseFloat(e.css("borderTopWidth"))+parseFloat(e.css("borderBottomWidth"))+parseFloat(e.css("marginBottom"))),isHeadlessPDF||e.css("height",i),e=J("#verdetails"),e[0]&&!e.is(":hidden")){var n=i-(e.innerHeight()-e.height());e.css("height",n);var r=J("#verlist"),o=r.outerHeight(!0)-r.height(),a=e.height()-(J("#vertitle").outerHeight(!0)+J("#versionpagination").height());r.css("height",a-o)}if(e=J("#mm-list-container"),e[0]&&!e.is(":hidden")){e.css("height",J(window).height()-e.offset().top),e=J("#mm-preview-recordlisting");var s=J(window).height()-(e.offset().top+t);e.css("height",s)}if(e=J("#docprintpreview"),e[0]&&!e.is(":hidden")){var l=document.documentElement.clientHeight-e.position().top-t;e.css("height",l),t>0&&e.css("margin-bottom",t)}e=J("#modifiedusercontainer"),e.css({"margin-top":i-e.height()})}},DomUtil.scrollToEditorTop=function(){editor.editorPaneContainer.scroll(function(){var e=J("#scrollTopContainer");if(editor.editorPaneContainer.scrollTop()>500){var t=DomUtil.getBottombarHeight()+17;e.css("bottom",t),e.addClass("ui-scroll-to-top-anim")}})},DomUtil.isEmpty=function(e,t){if(!e)return!0;if(3==e.nodeType)return 0==e.nodeValue.replace(/\u200b/g,"").length;var i=CONT_REGEXP.AUTOFIELD_WITHOUT_FORMULA+"|"+NODE_TYPE.FILLABLEFIELD+"|"+NODE_TYPE.SIGNERFIELD+"|"+NODE_TYPE.MAILMERGEFIELD+"|"+CONST.TOC_CLOSE+"|"+CONST.TOC_REGENERATE+"|"+CONST.TOC_SETTINGS+"|noteClass|seqNameClass|zohotab|<"+NODE_TYPE.HR;if(t||(i=i+"|<"+NODE_TYPE.BR),i=new RegExp(i,"gi"),"img"==e.nodeName.toLowerCase())return!1;var n=J(e).text();if(0==n.replace(/\u200B/g,"").length){var r=DomUtil.getOutterHTML(e).toLowerCase(),o=J(e).find("img").not(J(e).find("."+CONST.PG_SPLIT_NODE)),a=r.match(i);return(!a||0==a.length)&&0==o.length}return!1},DomUtil.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},DomUtil.createStyleTag=function(e){var t=document.createElement("style");return t.type="text/css",t.styleSheet&&t.styleSheet.cssText?t.styleSheet.cssText=e:J(t).text(e),t},DomUtil.createElement=function(e,t,i){var n,r,o=document.createElement(e);if(t)for(n in t)t.hasOwnProperty(n)&&(r=t[n],"class"===n?J(o).addClass(r):o.setAttribute(n,r));if(i){var a=null;a="string"==typeof i?document.createTextNode(i):i,o.appendChild(a)}return o},DomUtil.getOutterHTML=function(e){var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},DomUtil.scrollElementIntoView=function(e,t,i){var n=J.Deferred(),r=!1;if(!e||!e.parentNode)return n.resolve(r),r;var o=0,a=0,s=!1,l=editor.doc.getDomCursorNode(editor.uuid,editor.zuid,"start");l&&e==l[0]?(s=!0,o=CurUtil.offset.start.top,offsetLeft=CurUtil.offset.start.left,a=parseFloat(l[0].style.height)):(o=PUtil.offsetTop(e),offsetLeft=PUtil.offsetLeft(e),a=PUtil.offsetHeight(e)),o*=editor.zoomFactor,offsetLeft*=editor.zoomFactor,a*=editor.zoomFactor;var d=editor.editorPaneContainer,c=d.height(),u=d.width(),g=50;if("PUBLIC"==editor.doc.getRole()){var h=document.getElementById(editorProps.isPublishToFill&&"branding-publishfill"||"branding");g+=h&&h.offsetHeight||0}g*=editor.zoomFactor;var f,p,E=d[0].scrollTop,T=d[0].scrollLeft,O={};if(o>E?(o+=a,g=i?c-a:g,f=o-(E+c),f>-50*editor.zoomFactor&&(r=!0,O.scrollTop=E+f+g)):(f=o-E,f<0&&(r=!0,O.scrollTop=E+f-g)),offsetLeft>T?(p=offsetLeft-(T+u),p>-50*editor.zoomFactor&&(r=!0,O.scrollLeft=T+p+g)):(p=offsetLeft-T,p<0&&(r=!0,O.scrollLeft=T+p-g)),r){if(!t&&s){var m=(new Date).getTime();(!Utils.prevScrollTime||m-Utils.prevScrollTime>300)&&(t=Utils.scrollTimer,Utils.prevScrollTime=m)}"number"!=typeof t&&(t=10),void 0===O.scrollTop&&(t=0),d.animate(O,t,function(){setTimeout(function(){n.resolve(r)},t+50)})}else n.resolve(r);return n},PubSub.subscribe("ZWRange/ScrollIntoView",function(e,t,i){e&&DomUtil.scrollElementIntoView(e,t,i)}),DomUtil.unescapeHTML=function(e){return J("<textarea />").html(e).val()},DomUtil.nodeNameEquals=function(e,t){if(!e||!t)return!1;if(t.indexOf("*")!=-1)return!0;var i=t.split("|");return ZWArrayUtils.arrayContains(i,e.nodeName.toLowerCase())},DomUtil.clearFormatPainterData=function(){editor.doc.paintFormat_dblClick=!1,editor.doc.paintFormat={},editor.jeditorPane.find("div.zw-page").css("cursor","")},DomUtil.isDownloadSupported=function(){var e=document.createElement("a");return void 0!==e.download},DomUtil.getDomImage=function(e,t){var i=function(e,t,i){var n=e,r=null;for(n;n<=t;n++){var o=editor.doc.getRawFormatAt(n);!o||"image"!=o.type&&"widget"!=o.type||o[ATTR_IMAGE.I_WRAP_TYPE]||(null==r&&(r=-1),r++)}return null==r?-1:r};if(DTUtils.isFloatingImage(t)){var n=DomUtil.isTextBox(t)?"zw-textbox-div":"fgImgOuterDiv";if(DTUtils.isNonWrappingFloatImage(t)){var r=J(editor.clientActiveSection).parents("div.zw-pagecontainer")[0].querySelectorAll("div.float-image-container")[0].querySelectorAll("div."+n+"[fid='"+t.fid+"']")[0];g=r.querySelector("image")}else{var r=editor.clientActiveSection.querySelectorAll("div."+n+"[fid='"+t.fid+"']")[0];g=r.querySelector("image")}}else{var o=DocTreeManager.getTreeNodeAtIndex(e),a=i(o.getIndex(),e,UNICODE.IMAGE),s=[];if(J(editor.clientActiveSection).hasClass("zw-contentpane"))for(var l=DocLayoutManager.getViews(o),d=0;d<l.length;d++)s[d]=DomViewManager.getDOMObj(l[d]);else{var c=DocUtil.getDOMSourceIndex(e,UNICODE.PARA)+1;s[0]={},s[0]={el:DomUtil.getElementAt("div.zw-paragraph",c,editor.clientActiveSection)}}var u,d=0,g=null,h=s.length;for(d=0;d<h;d++){var f=J(s[d].el),p=f.clone();p.find(".zw-float").remove(),u="widget"==t.type?p.find("div.zw-ifr-div"):p.find("image.zw-image");var E=u.length;if(a<=E-1&&(void 0!=J.find("image.zw-image")[a]?g=f.find("image.zw-image")[a]:void 0!=f.find(".zw-ifr-div")[a]&&(g=f.find(".zw-ifr-div")[a])),g)return g;a-=E}}return g},DomUtil.findNodesInTable=function(e,t){var i=new Array,n=DomUtil.nodeNameEquals(e,"table")?e:J(e).parents("table")[0];return J(e).find(t).each(function(){J(this).parents("table")[0]==n&&i.push(this)}),i},DomUtil.updateHeadlessChromeDiv=function(){var e=function(e){var t=document.createElement("div");return t.id=e,t.style.cssText="display: none !important",t.style.top="-10000px",t.style.left="-100000px",t.style.visibility="hidden",document.body.appendChild(t),t},t=function(t,i){t||(t="error-div"),void 0==i&&(i=ZWCollaboration.clientInfo);var n=document.getElementById(t);n||(n=e(t)),n.innerHTML=i};return function(e,i){isHeadlessHTML&&t(e,i)}}(),DomUtil.getDocumentReadingTime=function(){var e=WC.getWordCountDetails().wordcount,t=ContentEngagement.getReadingTime(e);return t.readingTimeText},DomUtil.checkCopySupport=function(e,t,i){if(DomUtil.isCopySupported())DomUtil.enableCopySupport(e,t,"writer.common.COPIED");else{var n=J(e);n.text(J.i18n("writer.common.SELECT")),n.attr("title",J.i18n("writer.common.SELECT"))}},DomUtil.isCopySupported=function(){var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!!(e&&parseInt(e[2])>=42)},DomUtil.enableCopySupport=function(e,t,i,n,r){var o=document.querySelector(e),a=document.querySelector(t);if(successful=!1,a.select(),successful=document.execCommand("copy"),successful){var s=J(o).find("span"),l=J(o).find("span").text();o.classList.add("ui-pub-copy-btn-active"),(s[0]&&s||J(o)).text(J.i18n(i)),J(o).find("span").text(J.i18n(i)),setTimeout(function(){J(o).find("span").text(l),o.classList.remove("ui-pub-copy-btn-active")},5e3)}},DomUtil.getPublishURL=function(e){var t="";return t=editorProps.options&&editorProps.options.CNAME_ENABLED||editor.doc.docInfo.PUBLISH_SCOPE==PUBLISH_TYPE.INTERNAL?editor.getBaseURL():window.location.protocol+"//"+editor.options.public_domain+"/writer",t+"/published/"+Utils.getDocumentId()+(e?"/fill":"")},DomUtil.sharePublishURLToSocialMedia=function(e,t){var i=editor.doc.docInfo;if(title=i.title?i.title:editor.doc.docInfo.DOCUMENT_NAME,i.PUBLISH_SCOPE&&("facebook"==e||"twitter"==e||"linkedin"==e)){var n="twitter.com/intent/tweet?hashtags=ZohoWriter&text=";"fuji"!==editorProps.deployment.customername&&"facebook"!==editorProps.deployment.customername||(n="twitter.com/intent/tweet?text=");var r={facebook:"www.facebook.com/sharer/sharer.php?u=",twitter:n,linkedin:"www.linkedin.com/cws/share?url="},o=editor.scheme+"://"+r[e],a=encodeURIComponent(t),s=window.open("about:blank","","width=500, height=300,left=200,top=200,scrollbars=1");return o+="twitter"==e?encodeURIComponent(title)+":&url="+a:a,s.document.write("<script>window.open('"+o+"', '_self');</script>"),s.document.close(),!1}},DomUtil.addDummyImageForCrop=function(e,t){var i=document.createElement("img");return i.setAttribute("crossorigin","anonymous"),J(i).css({position:"absolute",top:"-1000000000000px",left:"-100000000000px"}),document.body.appendChild(i),i.setAttribute("src",e),i.setAttribute("data-id",t),i},DomUtil.isImage=function(e){return!(!e||e.type!=NODE_TYPE.IMAGE||e.subType||e.shapeData||e.mminfo||e.latexexp||e.ffInfo||e.fieldinfo)},DomUtil.isCropImge=function(e){var t;return!!e[ATTR_IMAGE.I_CROPRECT]&&(t=e[ATTR_IMAGE.I_CROPRECT],!(parseFloat(t.cropTop)<0||parseFloat(t.cropRight)<0||parseFloat(t.cropBottom)<0||parseFloat(t.cropLeft)<0))},DomUtil.emptyInnerHTML=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},DomUtil.getVerticalAlignContainerSpan=function(e){var t=document.createElement("span");return t.setAttribute("class","zw-portion-outline"),t.style.fontSize=e[ATTR_TEXT.TS_SIZE]+"pt",t},DomUtil.getLeaderStyle=function(e){var t="";return"1"==e?t="1px dotted #000000":"2"==e||"5"==e?t="1px dashed #000000":"3"!=e&&"4"!=e||(t="1px solid #000000"),t},DomUtil.preProcessRichTextFieldValue=function(e){var t=document.createElement("fragment");t.innerHTML=e;for(var i=t.getElementsByTagName("script"),n=i.length,r=n-1;r>=0;r--)i[r].remove();var o=t.querySelector("#webfonts-style");return o&&o.remove(),(isHeadlessHTML||isHeadlessPDF)&&console.log("Rich text length  =>"+t.innerHTML.length),t.innerHTML},DomUtil.createMapField=function(e){var t=document.createElement("div");t.setAttribute("class","zw-IfrDiv");var i,n=document.createElement("iframe"),r={class:"widget-iframe zmap-iframe",style:"position: absolute;border-width: 0px;background-color: #000;",frameborder:"0"};if("GMap"==e.mapDetails.source&&(i=MAP_DEFAULTSTRING.GMAP+e.mapDetails.value+"&output=embed&t=m&z=13&ie=UT8&hl=en"),r.allowfullscreen=!0,r.referrerpolicy="no-referrer",r.width="100%",r.height="100%",r[isHeadlessHTML?"data-widget-src":ATTR_IMAGE.I_SRC]=WidgetView.decodeHtml(i),r.sandbox="allow-scripts allow-same-origin allow-popups",J(n).attr(r),t.appendChild(n),DomUtil.applyStyleToSvgImage(n,e),isHeadlessPDF){var o="map-";o+=e.id?e.id:Utils.getRandomNumber(),J(n).attr({id:o})}return t},DomUtil.getFormatedPhoneNo=function(e,t){if(!e)return e;for(var i="",n=0,r=0;r<t.length;r++){var o=t.charAt(r);"#"==o&&(o=e.charAt(n),n++),i+=o}return i},DomUtil.getFormatedNumber=function(e,t,i){if(!e)return e;if("(###) ### ####"==t||"###-###-####"==t)return DomUtil.getFormatedPhoneNo(e,t);var n=Formula.localeParseFloat(e+""),r=Formula.extractFormulaOptions('"'+t+'"'),o=r.numberFormat;"currencyFormat"===o&&(t=n<0?r.currencyNegative:r.currencyPositive);var a;if(i){var s=DocLocaleHandler.getLanguageDetails(i);a=s.currencyCode}var l=Formula.applyNumberFormat(n,o,t,i,a);return n<0&&(l="("+l+")"),l},DomUtil.onAnchorClick=function(e){for(var t,i=J(this).parents(".zw-paragraph"),n=this.getAttribute("objectid"),r=i[0].getAttribute("node-id"),o=DocTreeManager.getTreeNodeById(r),a=o.getFloatImagesInfo(),s=0,l=a.length;s<l&&(t=a[s],t.fid!=n);s++);if(t){var d=DomViewManager.getDocView(i[0]);EventHandler.bringBehindImagesToFront(d);var c=o.getIndex(),u=t.index+c,g=editor.doc.createRange(u);editor.doc.getSelection().removeAllRanges().addRange(g);var h=editor.doc.getRawFormatAt(u),f={idx:u},p=DTUtils.getFloatingObjectType(h);h.shapeData&&(p="Shape"),PubSub.publish(p+"/Selected",h.id,f),DomUtil.stopEvent(e)}},DomUtil.isTextBox=function(e){return e.subType===SECTION_TYPES.TEXTBOX},DomUtil.isWidgetField=function(e){return!(!e[ATTR_WIDGET.SUBTYPE]||e[ATTR_WIDGET.SUBTYPE]!==ATTR_WIDGET.WIDGET)},DomUtil.isMapWidget=function(e){return!(!DomUtil.isWidgetField(e)||!e[ATTR_WIDGET.MAPDETAILS])},DomUtil.isChartField=function(e){return e.type===NODE_TYPE.CHART},DomUtil.isChartImage=function(e){return!(!e[ATTR_COMMON.SUBTYPE]||e[ATTR_COMMON.SUBTYPE]!==ATTR_CHART.CHART)},DomUtil.isLiveWidget=function(e){return DomUtil.isWidgetField(e)&&e[ATTR_WIDGET.RENDERTYPE]===ATTR_WIDGET.RENDERTYPE_LIVE},DomUtil.isSheetWidget=function(e){return DomUtil.isWidgetField(e)&&e.hasOwnProperty([ATTR_WIDGET.SHEET_INFO])},DomUtil.isImageFillableField=function(e){var t=(e&&e[ATTR_COMMON.CLS]||"").toLowerCase();return e[ATTR_COMMON.TYPE]===NODE_TYPE.IMAGE&&t===NODE_TYPE.FILLABLEFIELD&&e[ATTR_FILLABLEFIELD.FF_INFO]&&e[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.SUBTYPE]&&[FILLABLEFIELD_TYPE.IMAGE,FILLABLEFIELD_TYPE.SIGNATURE,FILLABLEFIELD_TYPE.INITIAL].contains(e[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.SUBTYPE])},DomUtil.isImageSignerField=function(e){var t=(e&&e[ATTR_COMMON.CLS]||"").toLowerCase();return e[ATTR_COMMON.TYPE]===NODE_TYPE.IMAGE&&t===NODE_TYPE.SIGNERFIELD&&e[ATTR_SIGNERFIELD.SFINFO]&&e[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE]&&[SIGNERFIELD_TYPE.STAMP,SIGNERFIELD_TYPE.IMAGE].contains(e[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE])};var addAnchorIcon=function(e){if(DomViewManager.getDOMElem(e)&&editor.getRole().permissions.can("document.edit")&&!Macros.isPDFDocument())for(var t=e.segments,i=0,n=t.length;i<n;i++){var r=t[i],o=r.format[ATTR_IMAGE.I_WRAP_TYPE],a=r.format[ATTR_IMAGE.WM_INFO];if(o&&!a){var s=document.createElement("div");s.className="writer-glyphs-anchored-object float-div",s.style.top=e.contentHeight/2+"px","undefined"!=typeof HiddenMarkers&&0==HiddenMarkers.isObjectIndicatorVisible()&&(s.style.display="none");var l=r.format&&r.format.fid;W(s).attr({objectid:l}),DomViewManager.getDOMElem(e).appendChild(s),s.addEventListener("click",DomUtil.onAnchorClick);break}}},getPublishBottomBand=function(){if(editorProps.isPublishToFill){var e=editor.doc.docInfo,t=e&&e.TEMPLATE_SETTINGS&&e.TEMPLATE_SETTINGS[TEMPLATE.FILLABLE_SETTINGS],i=!t||!(0==t.onsubmit.actions.length||1==t.onsubmit.actions.length&&t.onsubmit.actions.contains("sign.configure"));return editorProps.isEmbed?document.getElementById("ff-publish-embed-cont"):i?document.getElementById("ff-publish-beforesubmit"):document.getElementById("ff-publish-aftersubmit")}};isV8Engine||PubSub.subscribe([DOMVIEW.LINE_ADDED,DOMVIEW.LINE_UPDATED],addAnchorIcon),PubSub.subscribe(["Document/lineview/update","Document/lineview/create"],addAnchorIcon);var EventHandlerUtils=function(){var e={content:"div.zw-contentpane",header:"div.header_primary",footer:"div.footer_primary",endnote:"div.zw-endnotepane",footnote:"div.zw-footnotepane"},t=function(t){var i={content:"div.float-image-content-container",header:"div.float-image-header-container",footer:"div.float-image-footer-container"},n="div.float-image-container",r="div.zw-pagecontainer";if(t){var o=J(t).parents(e.content+","+e.header+","+e.footer+","+e.endnote+","+e.footnote);if(0==o.length){var a=J(t).parents(n);if(a.length>0){var s=J(t).parents(i.content+","+i.header+","+i.footer);if(s.length>0){var l=null,d=s[0].className;d.indexOf("header")!=-1?l="header":d.indexOf("footer")!=-1?l="footer":d.indexOf("content")!=-1&&(l="content");var c=J(t).parents(r);o=c.find(e[l])}}}return o}},i=function(t,i){if(t&&i){var n=null;t.indexOf("header")!=-1?n="header":t.indexOf("footer")!=-1?n="footer":t.indexOf("content")!=-1&&(n="content");var r=i.el;return J(r).find(e[n])[0]}};return{getSectionFromElement:t,getSectionFromPage:i}}(),chartFieldDomUtil=function(){"use strict";function e(e){var t=o[e];return t&&t.theme===DocumentDesign.getTheme().color.name?t:null}function t(e,t,i,n){var o=e.chartDetails,a=o.bgc&&ZWColorUtils.rgbToHex(o.bgc)||"white",s=void 0!=o.op?o.op/100:1;if(t.style.width=e.wid.toFixed(3)+e.wid_un,t.style.height=e.ht.toFixed(3)+e.ht_un,t.style.borderWidth=o.borders.width,t.style.borderStyle=o.borders.type,t.style.borderColor=o.borders.color,r.hasMminfo){var l=isHeadlessPDF?"Merge Chart Field":J.i18n("writer.chart.MERGE_CHART_FIELD");t.innerHTML='<div class="ui-brokenImg-cont ui-flex-container ui-flex-center" style="pointer-events: none; border:none"><div class="ui-emergefield-placeholder">'+l+"</div></div>",t.setAttribute("title",J.i18n("writer.chart.PREVIEW_INFO")),t.setAttribute("data-title-position","at-cursor")}t.appendChild(i),e.rotation&&(t.style.transform="rotate("+e.rotation+"deg)"),document.getElementsByTagName("body")[0].appendChild(t),i.setAttribute("id",i.id),t.setAttribute("class","fgImgOuterDiv"),t.style.backgroundColor=a,t.style.opacity=s,e.wrapType&&["square","left","right"].indexOf(e.wrapType)!==-1&&(t.style.margin=e.mt+" "+e.mr+" "+e.mb+" "+e.ml),i.classList.add("zw-chart-canvas")}function i(e){return{size:e.ts.size,style:e.ts.fs,weight:e.ts.fw_i||e.ts.fw,family:e.ts.ff||"Roboto"}}function n(e,n){var a=ZWJSONUtils.clone(e.chartDetails),s=document.createElement("div"),l=document.createElement("canvas");l.setAttribute("id",e.id);var d,c;if(r.isPieOrDoughnut=["Pie","Doughnut"].indexOf(a.type)!==-1,r.hasMminfo=e.hasOwnProperty(MAILMERGE.MMINFO),r.isSpider_Pie_Doughnut=r.isPieOrDoughnut||a.type===r.Spider_Web,r.isStacked=a.type.startsWith("Stacked"),r.dataLabelEnabled="none"!==a.dataLabels.valuesToDisplay,r.isAggregate=a.aggregate.enabled,!n||r.isPieOrDoughnut){var u=a.series===r.singleseries&&!r.isPieOrDoughnut&&!r.isStacked,g=a.xAxis.labels.value,h=r.isAggregate?a.yAxis.labels.value:ChartUtils.replaceSymbols(a.yAxis.labels.value),f=a.xAxis.serieslabel,p=a.yAxis.seriesvalue,E=[];if(r.hasMminfo){if(g=ChartUtils.getDisplayNameList(a.xAxis.labels.value[0],e.mminfo.mapping)||[],f=ChartUtils.getDisplayNameList(a.xAxis.serieslabel[0],e.mminfo.mapping)||[],h=ChartUtils.getRandomArray(1,r.isPieOrDoughnut&&a.series===r.multiseries?4:g.length)[0],p=[],a.series===r.multiseries){if(a.groupBy.enabled){var T=ChartUtils.getDisplayNameList(a.groupBy.field,e.mminfo.mapping)||[];T.length>0&&(f=[T[0],T[0]])}for(var O=ChartUtils.getRandomArray(f.length,4),m=0;m<f.length;m++)p.push(O[m]);for(var I=g.pop()||"",m=1;m<=4;m++)g.push(I+" "+m)}a.title.text=ChartUtils.replaceFieldId(a.title.text,e.mminfo.mapping),a.subtitle.text=ChartUtils.replaceFieldId(a.subtitle.text,e.mminfo.mapping)}r.isPieOrDoughnut&&a.series===r.multiseries&&(f=f?[f.shift()]:[],p=p.length>0?[p.shift()]:[],0==p.length&&(p=[g])),p=0==p.length?[g]:p;var D=g.length>f.length?g.length:f.length;ChartUtils.replaceChartDefaultColors(a.advancedOptions.color,u,D);var R=a.advancedOptions.color;if(a.series===r.singleseries)if(r.isStacked){for(var m=0;m<g.length;m++)E.push({data:r.isAggregate?[h[m]]:ChartUtils.replaceSymbols([h[m]]),label:g[m],backgroundColor:R[m]});g=[" "]}else{var S={data:h,backgroundColor:a.type!==r.Spider_Web?R:R[0].replace("rgb","rgba").replace(")",", 0.2)"),tension:"Spline"===a.type?.5:0};r.isPieOrDoughnut||(S.borderColor=R),extend(S,{borderRadius:a.barConfig.borderRadius,borderSkipped:a.barConfig.borderSkipped}),E.push(S)}else if(a.series===r.multiseries)for(var m=0,m=0;m<f.length;m++){var C=r.isPieOrDoughnut?R:R[m];E.push({label:f[m],data:r.isAggregate?p[m]:ChartUtils.replaceSymbols(p[m]),backgroundColor:a.type!==r.Spider_Web?C:C.replace("rgb","rgba").replace(")",", 0.2)"),borderColor:C,skipNull:!0,tension:"Spline"===a.type?.5:0})}var A={labels:g||[],datasets:E||{}},v={showTooltips:!1,responsive:!0,maintainAspectRatio:!1,layout:{padding:a.padding||0},animation:{duration:0},indexAxis:"x",elements:{line:{borderWidth:3}},plugins:{title:{display:!!a.title.text,text:a.title.text,color:a.title.ts.fc,font:i(a.title)},subtitle:{display:!!a.subtitle.text,text:a.subtitle.text,color:a.subtitle.ts.fc,font:i(a.subtitle)},legend:{display:(a.series===r.multiseries||r.isStacked||r.isPieOrDoughnut)&&a.legend.enabled,position:a.legend.position,labels:{usePointStyle:!0,pointStyle:"circle",color:a.legend.ts.fc,font:i(a.legend)}}},scales:{x:{reverse:a.xAxis.reverse,display:!r.isSpider_Pie_Doughnut&&a.xAxis.labels.enabled,stacked:!1,grid:{drawBorder:a.xAxis.grid.drawBorder,display:a.xAxis.grid.enabled},ticks:{color:a.xAxis.ts.fc,font:i(a.xAxis)},title:{display:!0,text:a.xAxis.title.text,color:a.xAxis.title.ts.fc,font:i(a.xAxis.title)}},y:{reverse:a.yAxis.reverse,display:!r.isSpider_Pie_Doughnut&&a.yAxis.labels.enabled,stacked:!1,grid:{drawBorder:a.yAxis.grid.drawBorder,display:a.yAxis.grid.enabled},ticks:{color:a.yAxis.ts.fc,font:i(a.yAxis)},title:{display:!0,text:a.yAxis.title.text,color:a.yAxis.title.ts.fc,font:i(a.yAxis.title)}}}};a.yAxis.crossAlign&&(v.scales.y.ticks.crossAlign=a.yAxis.crossAlign),"auto"!==a.xAxis.slant&&"0"!=a.xAxis.slant&&(v.scales.x.ticks.minRotation=v.scales.x.ticks.maxRotation=a.xAxis.slant),"auto"!==a.yAxis.slant&&"0"!=a.yAxis.slant&&(v.scales.y.ticks.minRotation=v.scales.y.ticks.maxRotation=a.yAxis.slant);var _=a.type.indexOf("Bar")!==-1?v.scales.x:v.scales.y;a.axisConfig.min&&(_.min=parseFloat(a.axisConfig.min)),a.axisConfig.max&&(_.max=parseFloat(a.axisConfig.max)),a.axisConfig.step&&(_.ticks.stepSize=parseFloat(a.axisConfig.step)),ZWJSONUtils.cloneAndExtend(_.ticks,{callback:function(e,t,i){var n=a.axisConfig.sf;return"auto"===n||isNaN(parseFloat(n))||(e/=parseFloat(n)),"custom"===a.axisConfig.format?a.axisConfig.prefix+e+a.axisConfig.suffix:"none"===a.axisConfig.format?e:DomUtil.getFormatedNumber(e,a.axisConfig.format)}});var P=r.dataLabelEnabled?[ChartDataLabels]:[],N="outside"===a.dataLabels.position,b="insight"===editorProps.permissionsInfo.appInfo.NAME,L=r.isPieOrDoughnut&&r.dataLabelEnabled&&N&&b;L&&(P=[ChartUtils.getInsightsDataLabelPlugin(a.dataLabels)]);var w={insideend:{anchor:"end",align:"start",clamp:!0},insidemiddle:{anchor:"center",align:"end",clamp:!0},insidebase:{anchor:"start",align:"end",clamp:!0},outside:{anchor:"end",align:"end",clamp:!0}};switch(r.isPieOrDoughnut&&r.dataLabelEnabled&&N&&(v.layout.padding=50),a.hasOwnProperty("padding")&&(v.layout.padding=a.padding),r.dataLabelEnabled&&!L?(v.plugins.datalabels={display:"auto",color:a.dataLabels.ts.fc,font:{color:a.dataLabels.ts.fc,size:a.dataLabels.ts.size||12,style:a.dataLabels.ts.fs,weight:a.dataLabels.ts.fw_i||a.dataLabels.ts.fw,family:a.dataLabels.ts.ff||"Roboto"},formatter:function(e,t){if(""===e)return"";var i=0;for(d=t.dataset.data,m=0;m<d.length;m++)t.chart._hiddenIndices[m]||(i+=parseFloat(d[m]||0));switch(a.dataLabels.valuesToDisplay){case"showLabel":return t.chart.data.labels[t.dataIndex];case"showValue":return e;case"showPercentage":return(100*e/i).toFixed(2)+"%";case"showLabelValue":return t.chart.data.labels[t.dataIndex]+"\n("+e+")";case"showLabelPercentage":return t.chart.data.labels[t.dataIndex]+"\n("+(100*e/i).toFixed(2)+"%)";case"showValuePercentage":return e+"\n("+(100*e/i).toFixed(2)+"%)"}}},ZWJSONUtils.cloneAndExtend(v.plugins.datalabels,w[a.dataLabels.position])):(v.plugins.datalabels=void 0,v.plugins.datalabels={display:!1}),a.type){case"Column":a.type="bar";break;case"Spline":a.type="line",v.elements={tension:0};break;case"Bar":a.type="bar",v.indexAxis="y";break;case"Stacked Bar":v.indexAxis="y";case"Stacked Column":a.type="bar",v.scales.x.stacked=!0,v.scales.y.stacked=!0;break;case r.Spider_Web:delete v.scales,a.type="radar";break;case"Pie":case"Doughnut":delete v.scales;case"Line":a.type=a.type.toLowerCase()}c={plugins:P,type:a.type,data:A,options:v}}else c=n;t(e,s,l,c);var y=new Chart(l,c);return l.setAttribute("chartJsId",y.id),r.hasMminfo?(l.style.pointerEvents="none",o[e.id]={chart_info:e.chartDetails,chart_config:y.config._config,theme:DocumentDesign.getTheme().color.name}):delete o[e.id],s}var r={Spider_Web:"Spider Web",singleseries:"singleseries",multiseries:"multiseries",randArr:[]},o={};return{createChartField:n,getChartInfo:e}}(),Aggregate=function(){"use strict";function e(e,t){var i,n=t.xAxis,r=t.keysToBeGrouped,o=t.operation,a=t.groupBy;if(a){var s,l,d,c=[];r.push(a),r=ZWArrayUtils.removeDuplicates(r),d=AggregateGroupByUtils.parseAndGroup(e,n,r,!0,!0),s=Object.keys(d);for(var u=[],g=0;g<s.length;g++)u[s[g]]=AggregateGroupByUtils.convertJsonToIPFormat(d[s[g]]);for(var h,f=[],g=0;g<s.length;g++)h=AggregateGroupByUtils.groupData(u[s[g]],a,r,o),f[s[g]]=h.jsonFormat,c=c.concat(h.label);c=ZWArrayUtils.removeDuplicates(c),l=[];for(var g=0;g<c.length;g++){l.push([]);for(var p=0;p<s.length;p++){var E=f[s[p]][c[g]]&&f[s[p]][c[g]][r[0]];l[g].push(E)}}return{label:s,seriesLabel:c,seriesValue:l,jsonFormat:f}}return AggregateGroupByUtils.groupData(e,n,r,o,i)}return{aggregateAndGroupData:e}}(),AggregateGroupByUtils=function(){"use strict";function e(e,i,n,r,o){for(var a,s,l,d,c,u=[],g=[],h=0;h<e.length;h++){a=!1,l=e[h][i],"string"==typeof l&&(l=r?l.trim():l.toLowerCase().trim());for(var f=0;f<u.length;f++)if(d=u[f],"string"==typeof d&&(d=r?u[f].trim():u[f].toLowerCase().trim()),l===d){for(s=0;s<n.length;s++)c=t(e[h][n[s]]),(o||void 0!==c)&&g[u[f]][n[s]].push(t(c)||e[h][n[s]]);a=!0;break}if(!a){l=e[h][i];var p,E={};for(s=0;s<n.length;s++)p=n[s],E[p]=[],c=t(e[h][p]),(o||void 0!=c)&&E[p].push(c||e[h][p]);u.push(l),g[l]=E}}return g}function t(e){var t=typeof e;if(t){if("string"===t&&""!==e.trim()){if(!e.match(/\d+/))return;e=Numeral.getNumber(e,DocLocaleHandler.getLanguage())}return"number"==typeof e?e:void 0}}function i(e,t){return e-t}function n(e,t,n){for(var r,a=Object.keys(e),s=0;s<a.length;s++)for(var l=0;l<t.length;l++){r=e[a[s]][t[l]],["min","max","median"].indexOf(n)!==-1?r.sort(i):"count distinct"==n&&(r=o(r));var d,c=r.length;if(0!=c){switch(n){case"min":d=r[0];break;case"max":d=r[c-1];break;case"median":d=c%2==1?r[parseInt(c/2)]:(r[parseInt(c/2)]+r[parseInt(c/2)-1])/2;break;case"average":case"sum":d=0;for(var u=0;u<r.length;u++)d+=parseFloat(r[u]);d="average"===n?d/c:d;break;case"count distinct":case"count":d=c}e[a[s]][t[l]]=d}else e[a[s]][t[l]]=void 0}return e}function r(e,t,i){var n,r,o=[];if(void 0==t||""==t){var a=e[0];n=[""],r=Object.keys(a);for(var s=0;s<r.length;s++)o.push([a[r[s]]])}else{n=Object.keys(e),r=i,o=[];for(var s=0;s<r.length;s++){o.push([]);for(var l=0;l<n.length;l++)o[s].push(e[n[l]][r[s]])}}return{label:n,seriesLabel:r,seriesValue:o,jsonFormat:e}}function o(e){for(var t=[],i=0;i<e.length;i++)t.indexOf(e[i])==-1&&t.push(e[i]);return t}function a(t,i,a,s,d){if(!t||t.length<1)throw"No Data Found";if(i&&!t[0][i])throw"GroupBy key not found";if(!a||a.length<1)throw"No keys to be grouped found";s=s?s:l[0],s=s.toLowerCase(),a=o(a);var c=l.indexOf(s);if(c==-1)throw"Invalid Operation";d=void 0!=d&&d;var u;if(i)u=e(t,i,a,d,c<2);else{for(var g,h={},f=0;f<a.length;f++)for(var p=0;p<t.length;p++)g=a[f],h[g]||(h[g]=[]),h[g].push(t[p][g]);u=[h]}var E=n(u,a,s);return r(E,i,a)}function s(e){for(var t=Object.keys(e),i=[],n=0;n<e[t[0]].length;n++){for(var r={},o=0;o<t.length;o++)r[t[o]]=e[t[o]][n];i.push(r)}return i}var l=["count","count distinct","sum","average","min","max","median"];return{groupData:a,parseAndGroup:e,aggreateOperation:n,convertJsonToIPFormat:s}}(),ChartUtils=function(){"use strict";function e(e){for(var t=o(),i=0;i<e.length;i++)for(var n=0;n<t.length;n++)if(e[i]&&e[i].includes(t[n]))return e[i];return null}function t(){return C.COLOR_ARR_SIZE}function i(){return C.RAND_VARIATION_COUNT}function n(e){var t="singleseries"===e.series,i=null!=e.type.match(/Pie|Doughnut|Stacked/g);return t&&!i}function r(t,i,n){var r,o=e(t);if(t[n]===o)for(r=n+1;r<t.length;r++)if(null==t[r]){t[r]=o;break}t[n]=i}function o(){for(var e=[],t=1;t<=C.VARIATION_COUNT;t++)e.push("v"+t);return e}function a(e,t){return Array.apply(null,Array(e)).map(function(){for(var e=0;e<40;)e=Math.round(Math.random()*t);return e})}function s(e,t){for(var i=A.slice(0,e),n=0;n<e;n++)i[n]=i[n].slice(0,t);return i}function l(){var e="#F0F8FF,#FAEBD7,#00FFFF,#7FFFD4,#F0FFFF,#F5F5DC,#FFE4C4,#000000,#FFEBCD,#0000FF,#8A2BE2,#A52A2A,#DEB887,#5F9EA0,#7FFF00,#D2691E,#FF7F50,#6495ED,#FFF8DC,#DC143C,#00FFFF,#00008B,#008B8B,#B8860B,#A9A9A9,#A9A9A9,#006400,#BDB76B,#8B008B,#556B2F,#FF8C00,#9932CC,#8B0000,#E9967A,#8FBC8F,#483D8B,#2F4F4F,#2F4F4F,#00CED1,#9400D3,#FF1493,#00BFFF,#696969,#696969,#1E90FF,#B22222,#FFFAF0,#228B22,#FF00FF,#DCDCDC,#F8F8FF,#FFD700,#DAA520,#808080,#808080,#008000,#ADFF2F,#F0FFF0,#FF69B4,#CD5C5C,#4B0082,#FFFFF0,#F0E68C,#E6E6FA,#FFF0F5,#7CFC00,#FFFACD,#ADD8E6,#F08080,#E0FFFF,#FAFAD2,#D3D3D3,#D3D3D3,#90EE90,#FFB6C1,#FFA07A,#20B2AA,#87CEFA,#778899,#778899,#B0C4DE,#FFFFE0,#00FF00,#32CD32,#FAF0E6,#FF00FF,#800000,#66CDAA,#0000CD,#BA55D3,#9370DB,#3CB371,#7B68EE,#00FA9A,#48D1CC,#C71585,#191970,#F5FFFA,#FFE4E1,#FFE4B5,#FFDEAD,#000080,#FDF5E6,#808000,#6B8E23,#FFA500,#FF4500,#DA70D6,#EEE8AA,#98FB98,#AFEEEE,#DB7093,#FFEFD5,#FFDAB9,#CD853F,#FFC0CB,#DDA0DD,#B0E0E6,#800080,#663399,#FF0000,#BC8F8F,#4169E1,#8B4513,#FA8072,#F4A460,#2E8B57,#FFF5EE,#A0522D,#C0C0C0,#87CEEB,#6A5ACD,#708090,#708090,#FFFAFA,#00FF7F,#4682B4,#D2B48C,#008080,#D8BFD8,#FF6347,#40E0D0,#EE82EE,#F5DEB3,#FFFFFF,#F5F5F5,#FFFF00,#9ACD32".split(",");return e[Math.floor(Math.random()*e.length)]}function d(e,t){if(e){for(var i=[],n=e.indexOf(UNICODE.MERGEFIELD_START);n!=-1;){var r=e.indexOf(UNICODE.MERGEFIELD_END,n),o=e.substring(n+1,r),a=t[o]?t[o].display_name:o;i.push(a),n=e.indexOf(UNICODE.MERGEFIELD_START,n+1)}return i}}function c(e,t){var i=e;if(!e)return i;for(var n=e.indexOf(UNICODE.MERGEFIELD_START);n!=-1;){var r=e.indexOf(UNICODE.MERGEFIELD_END,n),o=e.substring(n+1,r),a=t[o]?t[o].display_name:o;i=i.replaceAll(UNICODE.MERGEFIELD_START+o+UNICODE.MERGEFIELD_END,UNICODE.MERGEFIELD_START+a+UNICODE.MERGEFIELD_END),n=e.indexOf(UNICODE.MERGEFIELD_START,n+1)}return i}function u(e){if(!e)return[];for(var t=0;t<e.length;t++)""===e[t]?e[t]=null:(e[t]=Numeral.getNumber(e[t],DocLocaleHandler.getLanguage()),e[t]=isNaN(e[t])?"":e[t]);return e}function g(e,t){return ZWJSONUtils.clone(colorMapping[e][t])}function h(e){var t=ZWJSONUtils.clone(P);if(!e)return t;for(var i=e.split("."),n=0;n<i.length&&(t=t[i[n]],void 0!=t);n++);return t}function f(e){return N[e]||N.Default}function p(){return ZWJSONUtils.clone(N)}function E(){return v}function T(e){for(var t={v1:"/20",v2:"/40",v3:"/60",v4:"*75",v5:"*50"},i=0;i<e.length;i++){var n=e[i].split("/");n[1]&&t[n[1]]&&(e[i]=n[0]+t[n[1]])}return ZWJSONUtils.clone(e)}function O(t,i,n){var r=e(t),o=ZWJSONUtils.clone(t),a=editor.doc.getBodyFormat().theme.color.name;if(null!=r){var s=r.match(/\d+/)[0];if(r.indexOf("/")!==-1)for(var l=r.split("/"),d=T(ChartThemeUtil.getThemeSet(a,l[0])),c=d[l[1]-1],u=0;u<d.length;u++)d[u]=c;else if(s<=C.RAND_VARIATION_COUNT)var d=T(ChartThemeUtil.getThemeSet(a,r));else{var g=ChartThemeUtil.getThemeSet(a,"v1"),h=(s-C.RAND_VARIATION_COUNT-1)%C.SHADE_VARIATION_COUNT,f=g[h].split("/")[0],d=ChartThemeUtil.getdynamicShadeAccentArray(f,n);s>C.RAND_VARIATION_COUNT+C.SHADE_VARIATION_COUNT&&d.reverse()}for(var u=0;u<t.length;u++)null===t[u]||t[u].includes(r)?t[u]=Utils.getColorValFromRefString(d[u]):t[u]=Utils.getColorValFromRefString(t[u])}else for(var u=0;u<t.length;u++)t[u]=Utils.getColorValFromRefString(t[u]);if(i)for(var u=0;u<t.length;u++)(null===o[u]||o[u].includes(r))&&(t[u]=Utils.getColorValFromRefString(d[0]));return t}function m(e,t,i){if(e){for(var n=[],r=e.indexOf(UNICODE.MERGEFIELD_START);r!=-1;){var o=e.indexOf(UNICODE.MERGEFIELD_END,r),a=e.substring(r+1,o),s=t[a]&&!i?t[a].display_name:a;n.push(s),r=e.indexOf(UNICODE.MERGEFIELD_START,r+1)}return n}}function I(e,t,i){for(var n=e.ctx,r=(e.chartArea.width,e.chartArea.height,{x:0,y:0}),o=e.data.datasets,a=o.length,s=0;s<a;s++)for(var l=(o[s],e.getDatasetMeta(s).data),d=l.length,c=0;c<d;c++){var u=l[c];if(!e._hiddenIndices[c]){var g=u.tooltipPosition(),h=g.x,f=g.y,p=e._metasets[0].data[0].x,E=e._metasets[0].data[0].y,T=u.outerRadius+3,O=u.outerRadius-Math.sqrt((p-h)*(p-h)+(E-f)*(E-f))+3;h=(T*h-O*p)/(T-O),f=(T*f-O*E)/(T-O);var m=p,I=E,D=h>=m?h+.05*h:h-.05*h,R=f>=I?f+.3*Math.abs(f-I):f-.3*Math.abs(f-I),S=h>=m?1.55*m:.45*m,C=h>=m?2:-2,A=h>=m?1:-1;Math.abs(R-r.y)<20&&r.x==S&&(R=r.y+15*A),r.x=S,r.y=R,n.beginPath(),n.moveTo(h,f),n.lineTo(D,R),n.lineTo(S,R),n.strokeStyle="#D5D5E9",n.stroke(),n.textBaseline="middle";var v=this.datalabelConfig.ts;n.font=[v.fs,v.fw_i||v.fw,v.size+"px","'"+v.ff+"'"].join(" ");var _=h>=m?"left":"right";n.textAlign=_,n.fillStyle=this.datalabelConfig.ts.fc;for(var P,N=0,b=e.data.datasets[s].data,L=b[c],w=0;w<b.length;w++)e._hiddenIndices[w]||(N+=parseFloat(b[w]||0));switch(this.datalabelConfig.valuesToDisplay){case"showLabel":P=e.data.labels[c];break;case"showValue":P=L;break;case"showPercentage":P=(100*L/N).toFixed(2)+"%";break;case"showLabelValue":P=e.data.labels[c]+"\n("+L+")";break;case"showLabelPercentage":P=e.data.labels[c]+"\n("+(100*L/N).toFixed(2)+"%)";break;case"showValuePercentage":P=L+"\n("+(100*L/N).toFixed(2)+"%)"}n.fillText(P,S+C,R)}}}function D(e){return{afterDraw:I.bind({datalabelConfig:e})}}function R(e){var t=h();t.type=e.type||t.type,t.xAxis.labels.value=e.data.labels||[],t.yAxis.labels.value=e.data.values||[],e.data.colors&&(t.advancedOptions.color=e.data.colors),e.dataLabels.enabled?t.dataLabels.valuesToDisplay=e.dataLabels.text||"showValue":t.dataLabels.valuesToDisplay="none",t.padding=e.padding,t.dataLabels.position=e.dataLabels.position,t.dataLabels.ts.size=e.dataLabels.fontsize||12,t.dataLabels.ts.fc=e.dataLabels.fontcolor||t.dataLabels.ts.fc,t.xAxis.labels.enabled=e.axis.x.labels,t.yAxis.labels.enabled=e.axis.y.labels,t.height=e.height,t.width=e.width,t.legend.enabled=e.legend.enabled||!1,t.xAxis.grid.drawBorder=e.axis.x.drawBorder,t.yAxis.grid.drawBorder=e.axis.y.drawBorder,t.barConfig.borderRadius=e.barConfig.borderRadius,t.barConfig.borderSkipped=e.barConfig.borderSkipped,t.yAxis.crossAlign=e.axis.y.crossAlign,t.xAxis.grid.enabled=e.axis.x.grid,t.yAxis.grid.enabled=e.axis.y.grid,editor.doc.execCmd("insertChart",{chartDetails:t,ht:t.height,wid:t.width})}function S(e){for(var i=[],n=0;n<t();n++)i.push(null);return i[0]=e||"v1",i}var C={COLOR_ARR_SIZE:24,VARIATION_COUNT:16,RAND_VARIATION_COUNT:4,SHADE_VARIATION_COUNT:6},A=[];!function(){for(var e=0;e<100;e++)A.push(a(100,100))}();var v=["Default","Lightbox","Watercolor","Coral","Fruity","Icecream","Book","Cardamom","Community","Brushstrokes","Universal","Pinstripes","Elemental","Essential","Tradition","bold","Orbit","Executive","Architecture","Guidebook","Civil","Bulletin","Luxury","Oblique","Sheer","Treasury","Chalkboard","Motion","Perspective","Bubbles","Dormitory","Pulp"],_={fw:"normal",fs:"normal",fc:"#000000",ff:"roboto",fw_i:0,size:12},P={type:"Column",width:400,height:400,series:"singleseries",legend:{enabled:!0,position:"top",ts:_},title:{text:"",ts:_},subtitle:{text:"",ts:_},xAxis:{labels:{enabled:!0,value:[""]},grid:{enabled:!0,drawBorder:!0},reverse:!1,slant:"auto",serieslabel:[""],title:{text:"",ts:_},ts:_},yAxis:{labels:{enabled:!0,value:""},grid:{enabled:!0,drawBorder:!0},reverse:!1,slant:"auto",seriesvalue:"",title:{text:"",ts:_},ts:_},axisConfig:{format:"none",prefix:"",suffix:"",sf:"auto"},barConfig:{borderRadius:0},advancedOptions:{color:S()},ts:_,dataLabels:{valuesToDisplay:"showValue",position:"insidemiddle",ts:_},aggregate:{enabled:!1,operation:"count"},groupBy:{enabled:!1,field:""},bgc:"",op:100,borders:{color:"rgb(0,0,0)",width:"0px",type:"solid"},chartId:"",canvasId:""},N={Default:["rgb(68, 125, 226)","rgb(232, 166, 0)","rgb(127, 198, 93)","rgb(244, 126, 47)","rgb(136, 139, 163)","rgb(70, 171, 198)"],Lightbox:["rgb(156, 75, 87)","rgb(65, 108, 167)","rgb(228, 126, 81)","rgb(60, 136, 121)","rgb(232, 196, 67)","rgb(228, 108, 126)"],Watercolor:["rgb(235, 154, 150)","rgb(177, 204, 128)","rgb(217, 198, 114)","rgb(154, 201, 231)","rgb(234, 193, 116)","rgb(221, 175, 173)"],Coral:["rgb(161, 126, 219)","rgb(105, 204, 110)","rgb(253, 207, 70)","rgb(245, 116, 157)","rgb(79, 202, 246)","rgb(44, 231, 187)"],Fruity:["rgb(249, 169, 59)","rgb(252, 93, 98)","rgb(182, 109, 221)","rgb(54, 205, 198)","rgb(39, 158, 224)","rgb(132, 190, 57)"],Icecream:["rgb(242, 167, 195)","rgb(110, 191, 177)","rgb(242, 205, 92)","rgb(136, 201, 242)","rgb(237, 169, 162)","rgb(120, 165, 224)"],Book:["rgb(90, 81, 222)","rgb(42, 204, 112)","rgb(231, 77, 61)","rgb(0, 120, 255)","rgb(241, 196, 15)","rgb(1, 202, 255)"],Cardamom:["rgb(53, 160, 106)","rgb(140, 3, 78)","rgb(3, 49, 140)","rgb(242, 159, 5)","rgb(109, 120, 149)","rgb(217, 82, 4)"],Community:["rgb(78, 99, 143)","rgb(196, 154, 109)","rgb(142, 179, 106)","rgb(217, 98, 90)","rgb(122, 201, 190)","rgb(233, 168, 59)"],Brushstrokes:["rgb(222, 131, 112)","rgb(143, 143, 146)","rgb(141, 189, 76)","rgb(147, 133, 126)","rgb(128, 154, 148)","rgb(210, 192, 86)"],Universal:["rgb(109, 182, 87)","rgb(205, 74, 55)","rgb(163, 122, 67)","rgb(97, 152, 247)","rgb(229, 184, 70)","rgb(157, 80, 69)"],Pinstripes:["rgb(159, 145, 173)","rgb(219, 160, 89)","rgb(91, 173, 176)","rgb(223, 130, 103)","rgb(117, 193, 176)","rgb(213, 185, 74)"],Elemental:["rgb(132, 190, 57)","rgb(214, 46, 90)","rgb(98, 203, 250)","rgb(242, 170, 79)","rgb(137, 88, 86)","rgb(237, 109, 45)"],Essential:["rgb(226, 111, 152)","rgb(104, 188, 130)","rgb(230, 196, 99)","rgb(115, 140, 220)","rgb(231, 167, 58)","rgb(154, 109, 178)"],Tradition:["rgb(86, 138, 217)","rgb(226, 160, 65)","rgb(235, 135, 138)","rgb(122, 176, 141)","rgb(222, 189, 93)","rgb(143, 142, 145)"],bold:["rgb(179, 81, 121)","rgb(152, 195, 81)","rgb(239, 137, 59)","rgb(91, 185, 183)","rgb(208, 121, 103)","rgb(233, 169, 73)"],Orbit:["rgb(77, 165, 194)","rgb(240, 146, 54)","rgb(220, 108, 104)","rgb(148, 202, 62)","rgb(242, 204, 71)","rgb(142, 102, 208)"],Executive:["rgb(119, 128, 156)","rgb(212, 182, 69)","rgb(104, 171, 95)","rgb(133, 90, 88)","rgb(75, 155, 170)","rgb(164, 116, 67)"],Architecture:["rgb(224, 97, 92)","rgb(89, 152, 163)","rgb(199, 186, 63)","rgb(161, 129, 170)","rgb(90, 177, 117)","rgb(212, 162, 94)"],Guidebook:["rgb(96, 181, 183)","rgb(218, 144, 52)","rgb(191, 64, 57)","rgb(115, 188, 104)","rgb(197, 81, 115)","rgb(210, 193, 75)"],Civil:["rgb(213, 84, 52)","rgb(45, 101, 130)","rgb(190, 115, 42)","rgb(92, 50, 95)","rgb(78, 145, 125)","rgb(189, 155, 51)"],Bulletin:["rgb(79, 171, 212)","rgb(161, 132, 103)","rgb(157, 91, 115)","rgb(152, 198, 78)","rgb(234, 153, 82)","rgb(232, 199, 67)"],Luxury:["rgb(141, 113, 183)","rgb(91, 171, 151)","rgb(174, 82, 93)","rgb(124, 166, 215)","rgb(200, 86, 43)","rgb(191, 125, 56)"],Oblique:["rgb(146, 146, 152)","rgb(211, 154, 155)","rgb(169, 196, 106)","rgb(215, 191, 139)","rgb(154, 209, 204)","rgb(175, 164, 177)"],Sheer:["rgb(152, 93, 67)","rgb(104, 162, 84)","rgb(218, 119, 93)","rgb(191, 163, 58)","rgb(78, 162, 157)","rgb(209, 159, 92)"],Treasury:["rgb(105, 103, 102)","rgb(227, 185, 66)","rgb(97, 124, 142)","rgb(163, 123, 90)","rgb(232, 135, 50)","rgb(109, 159, 124)"],Chalkboard:["rgb(176, 180, 249)","rgb(208, 181, 141)","rgb(172, 182, 109)","rgb(222, 161, 172)","rgb(192, 181, 158)","rgb(151, 190, 190)"],Motion:["rgb(225, 112, 101)","rgb(167, 177, 65)","rgb(113, 191, 189)","rgb(219, 167, 62)","rgb(178, 114, 187)","rgb(208, 131, 82)"],Perspective:["rgb(129, 86, 33)","rgb(37, 77, 117)","rgb(84, 95, 57)","rgb(134, 51, 24)","rgb(64, 40, 38)","rgb(114, 102, 30)"],Bubbles:["rgb(109, 204, 147)","rgb(237, 116, 112)","rgb(236, 147, 54)","rgb(190, 111, 135)","rgb(128, 194, 249)","rgb(227, 192, 93)"],Dormitory:["rgb(102, 137, 76)","rgb(108, 61, 57)","rgb(197, 74, 49)","rgb(97, 127, 156)","rgb(165, 101, 39)","rgb(180, 151, 52)"],Pulp:["rgb(201, 67, 81)","rgb(120, 146, 88)","rgb(165, 142, 54)","rgb(83, 138, 171)","rgb(204, 121, 74)","rgb(199, 134, 54)"]},b=function(){var e=editor.doc.getSelection().getParents(NODE_TYPE.CHART);e&&(editor.doc.execCmd("delete",e),PubSub.publish("Document/ImageDeleted"))};return{getColorArrSize:t,isSingleSeriesWithSameColor:n,getInitalColorArray:S,getRandomArray:s,getRandomColor:l,getRandomVariationCount:i,getDisplayNameList:d,replaceFieldId:c,replaceSymbols:u,getColorValue:f,getChartColorJson:p,getDefaultChartValue:h,getInsightsDataLabelPlugin:D,insertChartforInsights:R,getChartColorOrder:E,replaceChartDefaultColors:O,getDisplayNameOrIdList:m,getColorMapping:g,getVariation:e,addCustomColor:r,convertAccentArray:T,removeChart:b}}(),ChartThemeUtil=function(){"use strict";function e(){return{category:1,base_arr:["zwaccent1","zwaccent2","zwaccent3","zwaccent4","zwaccent5","zwaccent6"]}}function t(t){var i=c[t]||e();return ZWJSONUtils.clone(i)}function i(e,t){for(var i=[],n=0;n<e.length;n++){var r=e[n],o=r.split("/"),a=u[o[1]][t],s=[o[0]];a&&(s[1]=a),i[n]=s.join("/")}return i}function n(e){return[e[3],e[4],e[5],e[2],e[1],e[0]]}function r(e,t){for(var i=[],n=0;n<e.length;n++){var r=e[n].split("/");r[1]="light"===t?"v1":"v5",i[n]=r.join("/")}return i}function o(e){for(var t=[],i=0;i<e.length;i++)t=t.concat(e[i]);return t}function a(e,t){for(var a=[e],s=g[t],l=1;l<4;l++){var d=s[l],c=d.deriveFrom,h=d.shade;a[l]=i(a[c],h)}for(var f=n(a[2]),p=[f],l=1;l<4;l++){var d=s[l],c=d.deriveFrom,h=d.shade;p[l]=i(p[c],h)}for(var E=r(e,"light"),T=[E],l=1;l<4;l++)T[l]=i(T[l-1],"dark");var O=r(e,"dark"),m=[O];u.v5.light="v4";for(var l=1;l<4;l++)m[l]=i(m[l-1],"light");return u.v5.light=void 0,{v1:o(a),v2:o(p),v3:o(T),v4:o(m)}}function s(e,t){var i=[];if(t<2)return[e];for(var n=130/(t-1),r=20,o=0;o<t-1;o++)r<101?i.push(e+"/"+r):i.push(e+"*"+(200-r)),r+=n;return i.push(e+"*50"),i}function l(e,i){var n=editor.doc.getBodyFormat().chartColorJson||t(e);return n?(d.THEMESET[e]=a(n.base_arr,n.category),"all"===i?ZWJSONUtils.clone(d.THEMESET[e]):ZWJSONUtils.clone(d.THEMESET[e][i])):[]}var d={THEMESET:{}},c={Default:{category:1,base_arr:["zwaccent1","zwaccent2","zwaccent3","zwaccent5","zwaccent4","zwaccent6"]},Coral:{category:1,base_arr:["zwaccent1","zwaccent3","zwaccent2","zwaccent4","zwaccent5","zwaccent6"]},Fruity:{category:1,base_arr:["zwaccent6","zwaccent1","zwaccent2","zwaccent5","zwaccent3","zwaccent4"]},Icecream:{category:1,base_arr:["zwaccent2","zwaccent5","zwaccent4","zwaccent3","zwaccent6/v3","zwaccent1/v3"]},Community:{category:1,base_arr:["zwaccent6","zwaccent5","zwaccent4","zwaccent3","zwaccent1","zwaccent2"]},Essential:{category:1,base_arr:["zwaccent1","zwaccent2","zwaccent3","zwaccent4","zwaccent5","zwaccent6"]},bold:{category:1,base_arr:["zwaccent6","zwaccent5","zwaccent3","zwaccent2","zwaccent1","zwaccent4"]},Motion:{category:1,base_arr:["zwaccent1","zwaccent2","zwaccent4","zwaccent3","zwaccent6","zwaccent5"]},Lightbox:{category:1,base_arr:["zwaccent6","zwaccent2","zwaccent3","zwaccent5","zwaccent1","zwaccent4"]},Watercolor:{category:1,base_arr:["zwaccent1","zwaccent2","zwaccent3","zwaccent4","zwaccent5","zwaccent6/v3"]},Book:{category:1,base_arr:["zwaccent1","zwaccent2","zwaccent6","zwaccent3","zwaccent4","zwaccent5"]},Cardamom:{category:1,base_arr:["zwaccent2","zwaccent1","zwaccent3","zwaccent4","zwaccent6","zwaccent5"]},Elemental:{category:1,base_arr:["zwaccent1","zwaccent5","zwaccent3","zwaccent2","zwaccent6","zwaccent4"]},Orbit:{category:1,base_arr:["zwaccent1","zwaccent2","zwaccent3","zwaccent4","zwaccent5","zwaccent6"]},Oblique:{category:1,base_arr:["zwaccent1","zwaccent2","zwaccent3","zwaccent4","zwaccent5","zwaccent6/v3"]},Universal:{category:2,base_arr:["zwaccent1/v4","zwaccent5/v4","zwaccent4/v4","zwaccent3","zwaccent2","zwaccent6"]},Executive:{category:2,base_arr:["zwaccent6/v3","zwaccent1/v4","zwaccent3/v4","zwaccent2","zwaccent5/v4","zwaccent4/v4"]},Guidebook:{category:2,base_arr:["zwaccent1/v4","zwaccent2/v4","zwaccent3/v4","zwaccent4","zwaccent6","zwaccent5"]},Civil:{category:2,base_arr:["zwaccent5","zwaccent2/v4","zwaccent1/v4","zwaccent6","zwaccent4/v4","zwaccent3/v4"]},Bulletin:{category:2,base_arr:["zwaccent6/v4","zwaccent3","zwaccent2","zwaccent4","zwaccent5","zwaccent1"]},Luxury:{category:2,base_arr:["zwaccent6","zwaccent1/v4","zwaccent5","zwaccent3","zwaccent4/v4","zwaccent2/v4"]},Bubbles:{category:2,base_arr:["zwaccent1/v4","zwaccent3","zwaccent4","zwaccent2/v3","zwaccent5","zwaccent6"]},Dormitory:{category:2,base_arr:["zwaccent5/v4","zwaccent6","zwaccent4/v4","zwaccent2/v4","zwaccent3/v4","zwaccent1/v4"]},Pulp:{category:2,base_arr:["zwaccent1/v4","zwaccent2/v4","zwaccent3/v4","zwaccent4/v4","zwaccent5/v4","zwaccent6/v4"]},Brushstrokes:{category:2,base_arr:["zwaccent2","zwaccent3/v3","zwaccent6/v4","zwaccent1","zwaccent4","zwaccent5"]},Pinstripes:{category:2,base_arr:["zwaccent6/v3","zwaccent4","zwaccent3/v4","zwaccent5","zwaccent1","zwaccent2"]},Tradition:{category:2,base_arr:["zwaccent1/v4","zwaccent2","zwaccent3","zwaccent4","zwaccent5","zwaccent6/v3"]},Architecture:{category:2,base_arr:["zwaccent6","zwaccent1/v4","zwaccent3","zwaccent4","zwaccent5","zwaccent2"]},Sheer:{category:2,base_arr:["zwaccent6","zwaccent3/v4","zwaccent2","zwaccent1/v4","zwaccent5","zwaccent4"]},Treasury:{category:2,base_arr:["zwaccent6","zwaccent1/v4","zwaccent2/v4","zwaccent4","zwaccent3","zwaccent5/v4"]},Chalkboard:{category:1,base_arr:["zwaccent1/v3","zwaccent2","zwaccent3","zwaccent5/v3","zwaccent4/v3","zwaccent6"]},Perspective:{category:2,base_arr:["zwaccent3/v5","zwaccent2/v5","zwaccent5/v5","zwaccent4/v5","zwaccent6/v5","zwaccent1/v5"]}},u={v1:{light:"v2",dark:"v2"},v2:{light:"v1",dark:"v3"},v3:{light:"v2",dark:void 0},undefined:{light:"v3",dark:"v4"},v4:{light:void 0,dark:"v5"},v5:{light:void 0,dark:"v4"}},g={1:[{deriveFrom:0},{deriveFrom:0,shade:"dark"},{deriveFrom:0,shade:"light"},{deriveFrom:1,shade:"dark"}],2:[{deriveFrom:0},{deriveFrom:0,shade:"light"},{deriveFrom:0,shade:"dark"},{deriveFrom:1,shade:"light"}]};return{getThemeSet:l,getdynamicShadeAccentArray:s,getChartColorJson:t}}();Lock=function(){var e,t=100,i=!1,n=function(){PubSub.subscribe(DOMVIEW.PARAVIEW_AFTER_CREATE,LockView.checkLock),PubSub.subscribe(DOMVIEW.PARAVIEW_AFTER_UPDATE,LockView.checkLock),PubSub.subscribe(DOMVIEW.LINE_ADDED,LockView.checkLock),PubSub.subscribe(DOMVIEW.LINE_UPDATED,LockView.checkLock),PubSub.subscribe("Document/readonlyview",r),PubSub.subscribe("Document/LockUpdated",LockView.updateLock)},r=function(){PubSub.unsubscribe(DOMVIEW.PARAVIEW_AFTER_CREATE,LockView.checkLock),PubSub.unsubscribe(DOMVIEW.PARAVIEW_AFTER_UPDATE,LockView.checkLock),PubSub.unsubscribe(DOMVIEW.LINE_ADDED,LockView.checkLock),PubSub.unsubscribe(DOMVIEW.LINE_UPDATED,LockView.checkLock),PubSub.unsubscribe("Document/LockUpdated",LockView.updateLock)},o=function(e,t){var i,n,r,o,a,s=0,l=0,d=0,c=!1;if(editor.doc.getLocks().isEmpty())return c;for(t=t||editor.zuid,i=editor.doc.getLocks().docOps,n=i.length;s<n;){if(r=i[s],r.isRetain())l+=r.retain_count;else if(r.isLock()){if(d=l,a=d+r.lock_data.range,d<e&&e<a){o=","+r.lock_data.data.allowed_zuids+",",o.indexOf(","+t+",")>-1||(c=!0);break}l+=r.lock_data.range}s++}return c},a=function(e){if(!editor.doc.getLocks().isEmpty()){var t,i,n,r,o=editor.doc.getLocks().docOps,a=0,s=0,l=0;for(t=o.length;a<t;){if(i=o[a],i.isRetain())s+=i.retain_count;else if(i.isLock()){if(l=s,r=l+i.lock_data.range,l<=e&&e<=r){n=DocOpBuilder.build([{r:l}]),n.push(DocOp.clone(i));break}s+=i.lock_data.range}a++}return n}},s=function(e,t,i,n){if(editor.doc.getLocks().isEmpty()&&!i)return[];var r,o,a,s,l=0,d=0,c=0,u=[],g={};for(r=i?i.docOps:editor.doc.getLocks().docOps,o=r.length;l<o;)a=r[l],a.isRetain()?d+=a.retain_count:a.isLock()&&(c=d,s=c+a.lock_data.range,(c<=e&&e<=s||c<=t&&t<=s||e<=c&&s<=t)&&(n||(e>c&&(c=e),t<s&&(s=t)),c!=s&&(g.start=c,g.end=s,g.data=a.lock_data.data,u.push(g)),g={}),d+=a.lock_data.range),l++;return u},l=function(e,t){if(e==t){var i=a(e).getDocOps();e=i[0].length(),t=e+i[1].length()}Op.processMsg([{r:e},{lk:{range:t-e},data:{state:"unlock",type:"",redact:!1,zuid:editor.zuid}}])},d=function(){var e=editor.doc.getSelection();e.isUnlockAllowed()&&(i=!0,editor.rebindEvents(LOCK_PERMISSION),editor.doc.getSelection().applyOnSelection(l))},c=function(){if(editor.doc.getLocks().isEmpty())return!0;var e=editor.doc,t=e.getSelection(),i=t.getStart(),n=t.getEnd(),r=e.getSectionStart(i),o=e.getSectionEnd(i);return t.isCollapsed()?!!t.isLockUnlockAllowed():!(!t.isLockUnlockAllowed()&&(Lock.isOtherUsersLockPresent(r+1,i)||Lock.isOtherUsersLockPresent(n,o-1)))},u=function(e,i,n){if(n&&n.user_infos){n.allowed_zuids="";for(var r,o,a=[],s=n.user_infos,l=s.length>t?t:s.length,d=0;d<l;d++)r=s[d],d>0&&(n.allowed_zuids+=","),o=sha256(r.user_id),n.allowed_zuids+=o,s[d].id=o,a.push(s[d]);n.user_infos=a}var c=[{r:e},{lk:{range:i-e},data:{allowed_zuids:n?n.allowed_zuids:"",restricted_zuids:"",zuid:editor.zuid,canDelete:!(!n||!n.canDelete)&&n.canDelete,type:"",state:"lock"}}];!n||1!=n.redact&&0!=n.redact||(c[1].data.redact=n.redact),n&&n.user_infos&&(c[1].data.user_infos=JSON.stringify(n.user_infos)),Op.processMsg(c)},g=function(e){var t=editor.doc.getSelection();O(t.getStart(),t.getEnd())||(i=!0,editor.rebindEvents(LOCK_PERMISSION),t.applyOnSelection(u,e))},h=function(e){var t=editor.doc,n=t.getSelection(),r=n.getStart(),o=n.getEnd(),a=t.getSectionStart(r),s=t.getSectionEnd(r);O(a+1,r)||O(o,s-1)||(i=!0,editor.rebindEvents(LOCK_PERMISSION),u(a+1,r,e),u(o,s-1,e))},f=function(){i&&(i=!1,editor.rebindEvents())},p=function(){editor.addChar("  ");var e=editor.doc.getSelection(),t={},i=editor.doc.createRange(e[0].start-2,e[0].start);e.removeAllRanges().addRange(i),t.allowed_zuids=editor.zuid,t.redact=!0,g(t),Op.sendMsg(),i=editor.doc.createRange(e[0].start+1,e[0].start+1),e.removeAllRanges().addRange(i),CurUtil.blinkCursor(),EditorUtil.focusMultiByteSpan(),ZWLogger.addToStatistics("Redact")},E=function(){isHeadlessPDF||isHeadlessHTML||n(),e=editor.getRole().permissions.can("document.content.unlock")},T=function(){return e},O=function(e,t){for(var i,n,r=Lock.getLockRanges(e,t),o=!1,a=editor.zuid,s=0,l=r.length;s<l;s++)if(i=r[s],n=i.data.zuid,n!=a){o=!0;break}return o};return{init:E,lockSelection:g,lockUnSelection:h,insertRedact:p,unlockSelection:d,getLock:a,getLockRanges:s,updateLockStatus:f,isIdxInLockArea:o,isUnLockRangeAllowed:T,isOtherUsersLockPresent:O,isLockUnlockPermittedWithInSelection:c}}(),LockView=function(){var e=0,t=function(e){editor.doc.getLocks().isEmpty()||isV8Engine||(i(e.absStart,e.absEnd),J(editor.clientActiveSection).hasClass("zw-contentpane")&&o(e))},i=function(t,i,n){var r,o,a,s,d,c,u,g,h,f,p,E,T,O=[],m=[],I=[],D=!1;for(O=Lock.getLockRanges(t,i,n,!0),a=O.length,r=0;r<a;r++){if(s=O[r],D=s.data.redact,void 0==D&&(D=!1),u=DocLayoutManager.getLeftAtIndex(s.start),h=DocLayoutManager.getLineAtIndex(s.start),!h)return;f=DocLayoutManager.linesBetween(s.start,s.end),p=f.length;var R=p>1;for(o=0;o<p;o++)if(0==o&&e++,h=f[o],!(h.absStart<t||h.absStart>=i)){g=h.absEnd>s.end?editor.doc.getCharAt(s.end-1)==UNICODE.PARA?DocLayoutManager.getLeftAtIndex(s.end-1):DocLayoutManager.getLeftAtIndex(s.end):DocLayoutManager.getLeftAtIndex(h.absEnd);var S=DomViewManager.getDOMElem(h);E=J(S),T=document.createElement("div"),c=document.createElement("div"),T.className="lock-overlay",T.className+=" lock-class-"+e,T.id="lock-class-"+e,0==o&&0==D?(c.className="lock-icon-class",c.className+=" lock-icon-position",c.id="lock-icon-"+e):0==o&&1==D&&(c.className="redact-icon-class",c.className+=" lock-icon-position",c.id="redact-icon-"+e);var C={},A={};R?0===o?(C.left=u,A.left=u,C.width=h.width-u):(C.left=0,A.left=0,C.width=h.width>=g&&o+1==p&&s.end!=h.absEnd?g:h.width):(C.left=u,A.left=u,s.end!=h.absEnd||g?C.width=g-u:C.width=h.width);var v=parseFloat(E.css("padding-top")||0)+"px";if(C.top=v,A.top=v,C.height=h.height,A.height="1px",E.find(".zw-image").length&&(C["z-index"]=-10),d=s.data){var _="";if(d.zuid==editor.zuid||d.allowed_zuids&&(","+d.allowed_zuids+",").indexOf(","+editor.zuid+",")>-1)if(d.zuid!=editor.zuid&&d.allowed_zuids&&(","+d.allowed_zuids+",").indexOf(","+editor.zuid+",")>-1){var P=DTUtils.getUserNameWithoutEncoding(d.zuid);0==D?(_=J.i18n("writer.lock.info.MESSSAGE1",[P]),c.title=_,T.title=_):(_=J.i18n("writer.lock.info.MESSSAGE2",[P]),T.title=_,c.title=_),T.className+=" editable-permitted"}else d.zuid==editor.zuid&&(0==D?(_=J.i18n("writer.lock.CONTENT_LOCKED_BY_YOU"),c.title=_,T.title=_):(_=J.i18n("writer.lock.CONTENT_HIDDEN_BY_YOU"),J(T).css({background:"#F5F5F5",opacity:".5",border:"1px dashed #808080"}),T.title=_,c.title=_),d.allowed_zuids&&(","+d.allowed_zuids+",").indexOf(","+editor.zuid+",")>-1&&(T.className+=" editable-permitted"));else if(0==D){var P=DTUtils.getUserNameWithoutEncoding(d.zuid);_=J.i18n("writer.lock.CONTENT_LOCKED_BY",[P]),c.title=_,T.title=_}else _=J.i18n("writer.lock.CONTENT_HIDDEN_BY",[Macros.getAuthorName()]),c.title=_,T.title=_}J(T).css(C).appendTo(E[0]),m.push(T),J(c).css(A).appendTo(E[0]),I.push(c)}l(m)}},n=function(e){var t,i=0;for(i=0,t=e.length;i<t;i++){var n=DomViewManager.getDOMElem(e[i]);J(n).find("div.lock-overlay,div.lock-icon-class,div.redact-icon-class").remove()}},r=function(e,t){var i,r,o,a=e==t;a||(r=DocLayoutManager.getLineAtIndex(e),r&&(o=DocLayoutManager.getLineAtIndex(t)),r&&o&&(i=DocLayoutManager.linesBetween(e,t),n(i))),!a&&r&&o&&i.length>0&&LockView.drawLockArea(i[0].absStart,i[i.length-1].absEnd,editor.doc.getLocks())},o=function(e){var t=editor.doc.getSelection();if(t){var i=t.getStart();e=e||DocLayoutManager.getLineAtIndex(i);var n=Lock.getLockRanges(e.absStart,e.absEnd);n.length>0&&t.isCollapsed()&&i>n[0].start&&i<n[0].end&&(editor.jeditorPane.find("div.lock-overlay").css({border:""}),J(editor.clientActiveSection).hasClass("zw-contentpane")?J(DomViewManager.getDOMElem(DocLayoutManager.getLineAtIndex(i))).find("div.lock-overlay").css({border:"1px solid #808080",opacity:".5"}):J(DomViewManager.getDOMElem(e)).find("div.lock-overlay").css({border:"1px solid #808080",opacity:".5"}))}},a=function(e){var t=W(this),i="lock-para";t.hasClass("editable-permitted")&&(i="lock-para-editable"),W(document).find("."+this.id)[e](i)},s=function(e){e.addEventListener("mouseover",a.bind(e,"addClass")),e.addEventListener("mouseout",a.bind(e,"removeClass"))},l=function(e){for(var t=0,i=e.length;t<i;t++)s(e[t])};return{checkLock:t,drawLockArea:i,drawOverLay:o,bindEvents:l,updateLock:r}}();var TableUtil=function(){var e=function(e){return t(e.dtNode.cols)},t=function(e){var i,n,r;i=Array.isArray(e)?[]:{};for(r in e)n=e[r],i[r]="object"==typeof n?t(n):n;return i},n=function(e,t){t[ATTR_TABLE.TBLS_VER]="4.0",e.attr(t)},r=function(e){var t,i=TableUtil.getCols(e),n=i.length,r=[],o=e.attr(),a=DocLayoutManager.getContentWidthAtIndex(e.getStart());if(d(o))for(t=0;t<n;t++)r.push(parseFloat(i[t].wt)*a/100);else for(t=0;t<n;t++)r.push(i[t].wt.convertor().pixels);return r},o=function(e){var t,i,n=editor.doc.getElementAt(e),o=n.attr(ATTR_TABLE.TBLS_WID),a=[];if(o&&o.indexOf(UNITS.PERCENTAGE)!==-1){var s=TableUtil.getCols(n);for(t=s.length,i=0;i<t;i++)a.push(parseFloat(s[i].wt))}else{o=Conversions.toPixels(o);var l=r(n);for(t=l.length,i=0;i<t;i++)a.push(Math.round(l[i]/o*100*100)/100)}return a},a=function(e){for(var t=0;e;)t++,e=e.previousSibling();return t},s=function(e){for(var t=0;e;)t++,e=e.previousSibling();return t;},l=function(e){var t=editor.doc.getRawFormatAt(e);t=t?t:{};var i=t[ATTR_CELL.TDS_MRG];return!i||"fc"===i},d=function(e){var t=e&&e[ATTR_TABLE.TBLS_WID]?e[ATTR_TABLE.TBLS_WID]:"";return t+="",t.indexOf(UNITS.PERCENTAGE)!==-1},c=function(e){var t=e&&e[ATTR_CELL.TDS_WID]?e[ATTR_CELL.TDS_WID]:"";return t+="",t.indexOf(UNITS.PERCENTAGE)!==-1},u=function(e){var t=1,i=DocTreeManager.getTreeNodeAtIndex(e),n=i.parent.parent;return t=DocLayoutManager.getViews(n)[0].actualWidth+UNITS.PIXELS,Conversions.isInInches?t=t.convertor().inches:Conversions.isInMM&&(t=t.convertor().millimeters),t},g=function(e,t){if(c(t)){t=DocUtil.copyStyle(t);var i=t[ATTR_CELL.TDS_WID]?parseFloat(t[ATTR_CELL.TDS_WID]).toFixed(3):1,n=u(e),r=(i/100*n).toFixed(3);t[ATTR_TABLE.TBLS_WID]=r+Conversions.globalUnit}return t},h=function(){return CONST.MIN_CELL_WIDTH},f=function(e){var t=e.firstChild();return t.children().length},p=function(e){return e.children().length},E=function(e){var t=e.children(),i=[];return U.each(t,function(e){i=i.concat(e.children())}),i},T=function(e){var t,i=e.parentNode,n=i.children,r=n.length;for(t=0;t<r;t++)if(n[t]==e)return t},O=function(e){return Conversions.toGlobalValue(DTTableUtils.getCellWidth(e.dtNode)+UNITS.PIXELS)},m=function(e){return e.parentNode().type==NODE_TYPE.CELL},I=function(){var e=[],t=editor.doc.getSelection().getParents(NODE_TYPE.ROW).dtNode;if(t)for(var i,n=t.children.length,r=0;r<n;r++)t.children[r].merge&&"fc"!=t.children[r].merge||(i=DocLayoutManager.getViews(t.children[r])[0],e.push(i.actualWidth+UNITS.PIXELS));return e},D=function(e){var t=e.format,i=t[ATTR_TABLE.TBLS_AL],n=t[ATTR_TABLE.TBLS_ML],r=0+Conversions.globalUnit;if(!n||i&&"left"!=i){if(i)if("left"==i)r=0+Conversions.globalUnit;else if("right"==i||"center"==i){var o=DocLayoutManager.getColumnWidthAtIdx(e.getStart()),a=o/Conversions.globalUnitInPx,s=e.parent;if(s&&"cell"==s.type){var l=editor.doc.getElementAt(s.getIndex()),d=l.parentNode().parentNode().dtNode.cols,c=TableUtil.findColIdx(l);a=Conversions.toGlobalUnit(d[c-1].wt)}var u;u=t[ATTR_TABLE.TBLS_WID].indexOf("%")!=-1?parseFloat(t[ATTR_TABLE.TBLS_WID])*parseFloat(a)/100:Conversions.toGlobalUnit(t[ATTR_TABLE.TBLS_WID]);var g=parseFloat(a)-parseFloat(u);-parseFloat(u),"center"==i?r=g/2+Conversions.globalUnit:"right"==i&&(r=g+Conversions.globalUnit)}}else r=n;return r},R=function(e){for(var t=!1,i=e.children(),n=0,r=i.length;n<r;n++){var o=i[n].attr("*");if(o&&("vmp"===o[ATTR_CELL.TDS_MRG]||o[ATTR_CELL.TDS_RSPAN]>1)){t=!0;break}}return t},S=function(e){for(var t=e.parentNode(),i=t.nodeCountBefore(e),n=!1;t;){var r=t.children(),o=r[i],a=o.attr();a&&("hmp"===a[ATTR_CELL.TDS_MRG]||a[ATTR_CELL.TDS_CSPAN]>1)&&(n=!0),t=t.nextSibling()}return n},C=function(e){var t;if(e.tblLook)t=e.tblLook;else{t={firstRow:0,lastRow:0,firstColumn:0,lastColumn:0,noHBand:1,noVBand:1};for(var i in e)switch(i){case"firstRow":t.firstRow=1;break;case"lastRow":t.lastRow=1;break;case"firstColumn":t.firstColumn=1;break;case"lastColumn":t.lastColumn=1;break;case"band1Horz":t.noHBand=0;break;case"band2Horz":t.noHBand=0;break;case"band1Vert":t.noVBand=0;break;case"band2Vert":t.noVBand=0}}return t},A=function(e,t){var i=e.parent,n=i.getChildIndex()+1,r=i.parent.children.length,o=e.getChildIndex()+1,a=i.children.length,s=[];return t.firstRow&&1==n?(1==n&&1==o?s.push("nwCell"):1==n&&o==a&&s.push("neCell"),s.push("firstRow")):t.lastRow&&n==r&&(n==r&&o==a?s.push("seCell"):n==r&&1==o&&s.push("swCell"),s.push("lastRow")),t.firstColumn&&1==o?s.push("firstColumn"):t.lastColumn&&o==a&&s.push("lastColumn"),t.noVBand||(t.firstColumn?o%2==0?s.push("band1Vert"):"band2Vert":n%2==1?s.push("band1Vert"):"band2Vert"),t.noHBand||(t.firstRow?n%2==0?s.push("band1Horz"):"band2Horz":n%2==1?s.push("band1Horz"):"band2Horz"),s},v=function(e,t){if(t||(t=DocTreeManager.getParents(NODE_TYPE.PARAGRAPH,e)),!t||"cell"!=t.parent.type)return null;var i=t.parent.parent.parent,n=(editor.doc.getRawFormatAt(i.getIndex()),{});i[ATTR_TABLE.TBLS_THEME]?n=i[ATTR_TABLE.TBLS_THEME]:i.format[ATTR_TABLE.TBLS_THEME]?n=i.format[ATTR_TABLE.TBLS_THEME]:(n[ATTR_TABLE.TBLS_THEME_OBJECT]={tblPr:{borders:{"border-top":{type:"solid",width:"0px",color:"rgb(0,0,0)"},"border-left":{type:"solid",width:"0px",color:"rgb(0,0,0)"},"border-bottom":{type:"solid",width:"0px",color:"rgb(0,0,0)"},"border-right":{type:"solid",width:"0px",color:"rgb(0,0,0)"},insideH:{type:"solid",width:"0px",color:"rgb(0,0,0)"},insideV:{type:"solid",width:"0px",color:"rgb(0,0,0)"}},cell:{bgc:"rgb(255,255,255)"}}},n[ATTR_TABLE.TBLS_THEMENAME]="theme2");var r={},o=n[ATTR_TABLE.TBLS_THEME_OBJECT].para;o&&(r=o);var a,s=U.keys(n[ATTR_TABLE.TBLS_THEME_OBJECT]),l=U.find(s,function(e){return n[ATTR_TABLE.TBLS_THEME_OBJECT][e].hasOwnProperty("para")});if(a=!!l,!a)return r;for(var d=t.parent,c=n[ATTR_TABLE.TBLS_THEME_OBJECT],u=C(c),g=A(d,u),e=g.length-1;e>-1;e--){var h=g[e],f=c[h];f&&f.hasOwnProperty("para")&&(r=DocUtil.mergeObjs([r,f.para]))}return r},_=function(e){tableFormat=DocUtil.copyStyle(editor.doc.getRawFormatAt(e.getIndex())),themeJSON=e[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT],tblLook=C(themeJSON),tblProps=themeJSON.tblPr?themeJSON.tblPr:{},tblBorders=tblProps.borders?tblProps.borders:{};tableFormat[ATTR_COMMON.BORDERS];return DocUtil.mergeObjs([{borders:tblBorders},tableFormat])},P=function(e){rowNode=e.parent,tableNode=rowNode.parent,tableFormat=DocUtil.copyStyle(editor.doc.getRawFormatAt(tableNode.getIndex())),cellFormat=DocUtil.copyStyle(editor.doc.getRawFormatAt(e.getIndex())),themeJSON=tableNode[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT],cellIndex=e.getChildIndex()+1,rowIndex=rowNode.getChildIndex()+1,rowCount=tableNode.children.length,colCount=rowNode.children.length,tblLook=C(themeJSON),cellLocArray=A(e,tblLook);var t={},i=themeJSON.tblPr?themeJSON.tblPr:{};if(!U.isEmpty(i)){if(i.cell&&(t.bgc=i.cell.bgc?i.cell.bgc:null,t[ATTR_CELL.TDS_VA]=i.cell[ATTR_CELL.TDS_VA]?i.cell[ATTR_CELL.TDS_VA]:null),t.borders={},!U.isEmpty(i.borders)||i.cell&&!U.isEmpty(i.cell.borders)){var n=i.borders?i.borders:i.cell.borders;(n[ATTR_BORDERS.BORDER_TOP]||n.insideH)&&(t.borders[ATTR_BORDERS.BORDER_TOP]=n[ATTR_BORDERS.BORDER_TOP]?n[ATTR_BORDERS.BORDER_TOP]:n.insideH),(n[ATTR_BORDERS.BORDER_LEFT]||n.insideV)&&(t.borders[ATTR_BORDERS.BORDER_LEFT]=n[ATTR_BORDERS.BORDER_LEFT]?n[ATTR_BORDERS.BORDER_LEFT]:n.insideV),(n[ATTR_BORDERS.BORDER_RIGHT]||n.insideV)&&(t.borders[ATTR_BORDERS.BORDER_RIGHT]=n[ATTR_BORDERS.BORDER_RIGHT]?n[ATTR_BORDERS.BORDER_RIGHT]:n.insideV),(n[ATTR_BORDERS.BORDER_BOTTOM]||n.insideH)&&(t.borders[ATTR_BORDERS.BORDER_BOTTOM]=n[ATTR_BORDERS.BORDER_BOTTOM]?n[ATTR_BORDERS.BORDER_BOTTOM]:n.insideH)}if(i.tblCellMar){var r=[ATTR_CELL.TDS_PT,ATTR_CELL.TDS_PB,ATTR_CELL.TDS_PL,ATTR_CELL.TDS_PR];U.each(r,function(e){t[e]=i.tblCellMar[e]?i.tblCellMar[e]:null})}}for(var o=cellLocArray.length-1;o>-1;o--){var a=cellLocArray[o],s=TableThemeCSSGenerator.getCellStyles(themeJSON,a);t=DocUtil.mergeObjs([t,s.borders])}return delete t.para,DocUtil.mergeObjs([t,cellFormat])},N=function(e,t,i,n){var r=e.attr("*"),o=r[ATTR_TABLE.TBLS_THEME][ATTR_TABLE.TBLS_THEME_OBJECT],a=n?o.sectionName:o;J.isEmptyObject(t)||(a.para=t),J.isEmptyObject(i)||(a.cell=i),e.attr({theme:o})},b=function(e,t){TableTemplate[t]=e;var i={};csrfParamName&&(i[csrfParamName]=getcsrf()),i.TableTemplate=JSON.stringify(TableTemplate),J.post(ZWNetworkUtils.getNiceUrlPrefix("user/settings/savetabletemplateinfo"),i,function(){})},L=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);if(!t)return null;var i={style:t.attr("*"),children:[]},n=t.children();return U.each(n,function(e,t){var n=e.children("*"),r=[];U.each(n,function(e,t){var i=e.attr("*");r.push({style:i,children:[]})}),i.children.push({style:e.attr("*"),children:r})}),i},w=function(e,t){var i=[],n=editor.doc.getSelection(),t=t?t:{type:"paragraph"};i.push({r:n.getStart()},{as:{start:t}},{is:UNICODE.PARA},{as:{end:U.keys(t)}});var r=e.style;i.push({as:{start:r}},{is:UNICODE.TABLE},{as:{end:U.keys(r)}}),U.each(e.children,function(e){i.push({as:{start:e.style}},{is:UNICODE.ROW},{as:{end:U.keys(e.style)}});var n=e.children;U.each(n,function(e){i.push({as:{start:e.style}},{is:UNICODE.CELL},{as:{end:U.keys(e.style)}}),i.push({as:{start:t}},{is:UNICODE.PARA},{as:{end:U.keys(t)}})})}),i.push({is:UNICODE.TABLEEND}),i.push({as:{start:t}},{is:UNICODE.PARA},{as:{end:U.keys(t)}}),Op.processMsg(i)},y=function(e){var t=e.parentNode(),n=t.children(),r=t.parentNode().children(),o=(n.length,e.attr()),a=null,s=TableUtil.findColIdx(e),l=TableUtil.findRowIdx(t);r.length;if("fc"==e.attr().merge)a=e;else if("hmp"==e.attr().merge)for(j=s-2;j>=0;j--){if("fc"==n[j].attr().merge){a=n[j];break}if("vmp"==n[j].attr().merge)for(i=l-2;i>=0;i--){var d=r[i].children()[j];if("fc"==d.attr().merge)return a=d}}else if("vmp"==o.merge)for(j=l-2;j>=0;j--){var d=r[j].children()[s-1];if("fc"==d.attr().merge){a=d;break}}return a};getBoundaryCellsForTable=function(e){var t,i=e.children(),n=i.length,r=i[0].children(),o=i[n-1].children(),a=[],s=[],l=r.length-1;for(t=0;t<n;t++)a.push(i[t].children()[0]),s.push(i[t].children()[l]);return{firstRowCells:r,lastRowCells:o,firstColCells:a,lastColCells:s}},getSurroundingCells=function(e){var t=TableUtil.findColIdx(e)-1,i=e.parentNode().children(),n=i[t-1]?i[t-1]:void 0,r=i[t+1]?i[t+1]:void 0,o=e.parentNode().previousSibling(),a=o?o.children():[],s=a[t]?a[t]:void 0,l=e.parentNode().nextSibling(),d=l?l.children():[],c=d[t]?d[t]:void 0,u={};return s&&(u.topCell=s),n&&(u.leftCell=n),r&&(u.rightCell=r),c&&(u.bottomCell=c),u},getDTTableStructure=function(e,t){var i=function(e){var t=e.getIndex(),i={};i.type=NODE_TYPE.TABLE,i.styles=editor.doc.getRawFormatAt(t),i.children=[];for(var r=e.children,o=0,a=r.length;o<a;o++){var s=r[o];i.children.push(n(s))}return i},n=function(e){var t=e.getIndex(),i={};i.type=NODE_TYPE.ROW,i.styles=editor.doc.getRawFormatAt(t),i.children=[];for(var n=e.children,o=0,a=n.length;o<a;o++){var s=n[o];i.children.push(r(s))}return i},r=function(e){var n=e.getIndex(),r={};if(r.type=NODE_TYPE.CELL,r.styles=editor.doc.getRawFormatAt(n),r.children=[],!t)for(var a=e.children,s=0,l=a.length;s<l;s++){var d,c=a[s],u=c.type;switch(u){case"para":d=o(c);break;case"table":d=i(c)}r.children.push(d)}return r},o=function(e){var t=e.getEndIndex(),i=e.getIndex(),n={};n.type=NODE_TYPE.PARAGRAPH,n.styles=editor.doc.getRawFormatAt(t),n.children=[];for(var r=e.segments,o=0,a=r.length;o<a;o++){var s=r[o],l=editor.doc.getContent(i+s.start,i+s.end);style=editor.doc.getRawFormatAt(i+s.start);var d={};d.type=style.type,d.str=l,d.style=style,n.children.push(d)}return n};return i(e)};var M=function(e){return DocUtil.getStart(e,UNICODE.TABLE)},F=function(e){var e=DocUtil.getEnd(e,"");return e>0?e+1:e},V=function(e){return DocUtil.getStart(e,UNICODE.ROW)},B=function(e){return DocUtil.getEnd(e,UNICODE.ROW)},x=function(e){return DocUtil.getStart(e,UNICODE.CELL)},W=function(e){return DocUtil.getEnd(e,UNICODE.ROW+"|"+UNICODE.CELL)},H=function(e){for(var t=editor.doc.collabUsers,i=t.length,n=editor.doc.getAllSelections(),r=0;r<i;r++){var o=t[r].uuid,a=n[o];if(editor.uuid!=o&&a){var s=a.getParents(NODE_TYPE.TABLE);if(s){if(e.getStart()==s.getStart())return!0;for(var l=e;TableUtil.isInnerTable(l);)l=editor.doc.getParents(NODE_TYPE.TABLE,l.getStart()-1);for(;TableUtil.isInnerTable(s);)s=editor.doc.getParents(NODE_TYPE.TABLE,s.getStart()-1);if(l.getStart()==s.getStart())return!0}}}return!1},G=function(e){var t=editor.doc.getParents(NODE_TYPE.CELL,e);if(!t)return{};var i=DomViewManager.getDOMnodeFromDTnode(t.dtNode),n=J(i).css("background-color");return{"background-color":n}},k=function(e){for(var t=[],i=e.children().length,n=0;n<i;n++){for(var r=e.children()[n],o=r.children().length,a=[],s=0;s<o;s++)a.push(r.children()[s]);t.push(a)}return t},Y=function(e){var t,i,n=[],r=e.children(),o=r.length;for(t=0;t<o;t++){var a=r[t],s=a.children(),l=s.length;for(i=0;i<l;i++){var d=s[i];d.parent=a,n.push(d)}}var c={allCells:n};return c},Z=function(e,t,i){var n=e,r=e&&parseInt(e.width),o=t&&parseInt(t.width),a=i&&parseInt(i.width);return"undefined"!=typeof r&&0==r&&"undefined"!=typeof o&&(0!=o?n=t:"undefined"!=typeof a&&0!=a&&(n=i)),n},z=function(e,t,i,n,r,o){r-=1,o-=1,e.borders||(e.borders={});var a=t[0],s=t[1],l=e.borders;0==a&&0==r?(l["border-top"]=Z(l["border-top"],n["border-top"],i["border-top"]),l["border-bottom"]=Z(l["border-bottom"],n["border-bottom"],i["border-bottom"])):0==a?(l["border-top"]=Z(l["border-top"],n["border-top"],i["border-top"]),l["border-bottom"]=Z(l["border-bottom"],n["border-bottom"])):r==a?(l["border-top"]=Z(l["border-top"],n["border-top"]),l["border-bottom"]=Z(l["border-bottom"],n["border-bottom"],i["border-bottom"])):(l["border-top"]=Z(l["border-top"],n["border-top"]),l["border-bottom"]=Z(l["border-bottom"],n["border-bottom"])),l["border-top"]?"":delete l["border-top"],l["border-bottom"]?"":delete l["border-bottom"],0==s&&s==o?(l["border-left"]=Z(l["border-left"],n["border-left"],i["border-left"]),l["border-right"]=Z(l["border-right"],n["border-right"],i["border-right"])):0==s?l["border-left"]=Z(l["border-left"],n["border-left"],i["border-left"]):s==o&&(l["border-right"]=Z(l["border-right"],n["border-right"],i["border-right"])),l["border-left"]?"":delete l["border-left"],l["border-right"]?"":delete l["border-right"],l["border-radius"]&&delete l["border-radius"]},X=function(e,t){var i=editor.doc.findNextIndexOf(UNICODE.TABLE,e);return i!=-1&&i<t},K=function(e){for(var t,i=e.length,n=0;n<i;n++){var r=e[n],o=r&&e[n].wt;if(!o)return!1;if(o.indexOf("in")==-1&&o.indexOf("mm")==-1&&o.indexOf("%")==-1)return!1;var a=o.indexOf("mm")?"mm":o.indexOf("in")?"in":"%";if(0==n)t=a;else if(a!=t)return!1}return!0},Q=function(){var e=editor.doc.getSelection(),t=e.getParents(NODE_TYPE.TABLE);if(t){var i=e.getSelectedCells().length,n=t.dtNode.children.length*t.dtNode.children[0].children.length;return i==n}},q=function(e,t){var i=editor.doc.findNextIndexOf(UNICODE.IMAGE,e);return i!=-1&&i<=t},$=function(e){var t;if(e)t=DocTreeManager.getTreeNodeAtIndex(e);else{var i=editor.doc.getSelection();t=i.getParents(NODE_TYPE.PARAGRAPH).dtNode}for(var n,r,o,a=0,s=t.parent;s.type===NODE_TYPE.CELL;)o=DocLayoutManager.getViews(s)[0],a+=o.left+s.cellPadding.left,n=s.getTable(),n.parent&&"section"==n.parent.getType()&&n.getSection().getSectionType()==SECTION_TYPES.TEXTBOX&&(a+=TextBoxHandler.getAbsoluteLeft(n.parent)),r=DocLayoutManager.getViews(n)[0],a+=r.left,s=n.parent;return a},ee=function(e){var t=ZWJSONUtils.clone(e.format);return t.ht&&(t.ht=Math.max(DocLayoutManager.getViews(e)[0].getHeight(),DocLayoutManager.getViews(e.parent)[0].getHeight())),t.pl||(t.pl=Conversions.defaultCellLeftRightPadding),t.pr||(t.pr=Conversions.defaultCellLeftRightPadding),t.pt||(t.pt=Conversions.defaultCellTopBottomPadding),t.pb||(t.pb=Conversions.defaultCellTopBottomPadding),t},te=function(){var e=!0,t=editor.doc.getSelection(),n=t[0]._.selectedCells;if(0==n.length)return!1;var r=n[0].getMatrixPosition()[1];for(i=1;i<n.length;i++){var o=n[i].getMatrixPosition()[1];if(r!=o)return!1;e=!0}return e},ie=function(){var e=editor.doc.getSelection(),t=e[0]._.selectedCells;if(0==t.length)return!1;var i,n=t[0].getMatrixPosition()[0];for(i=1;i<t.length;i++){var r=t[i].getMatrixPosition()[0];if(n!=r)return!1;isVertSel=!0}return isVertSel},ne=function(e){if(e&&0!=e.length)for(var t=e.length,i=0;i<t;i++)Op.processMsg(e[i])},re=function(e,t){var i=editor.doc.getParents(NODE_TYPE.TABLE,editor.doc.getSelection().getStart()),n=TableResize.getResizedCellIdx(e),r=TableResize.resizeColumnWidth(n,i,t);editor.doc.execCmd("applyStyle",[r.eleArr,r.styArr,n==i.attr().cols.length?"updateLastColumnWidth":"updateColumnWidth"])},oe=function(e){var t=HTMLPreProcessor.getDummyNode("td"),i=J(t),n=HTMLPreProcessor.getDummyNode("p");return n.appendChild(document.createElement("br")),t.appendChild(n),e&&i.attr({merge:e}).css("display","none"),t},ae=function(e){return JSON.parse(e.getAttribute("data-rowfix")||"[]")},se=function(e,t){var i=ae(e);i=i.concat(t),e.setAttribute("data-rowfix",JSON.stringify(i))},le=function(e){e.removeAttribute("data-rowfix")},de=function(e){var t=ae(e),i=t.length;if(0!=i){le(e),t.sort(function(e,t){return e.idx-t.idx});for(var n,r,o,a,s,l,d,c=0;c<i;c++){o=t[c],a=o.idx,s=o.vmp,l=o.hmp,n=DomUtil.findNodesInTable(e,"td,th"),r=n[a];for(var u=0;u<s;u++)d=oe("vmp"),r?J(r).before(d):J(e).append(d);for(var g=0;g<l;g++)d=oe("hmp"),r?J(r).before(d):J(e).append(d)}}},ce=function(e){var t,i,n,r,o,a;t=DomUtil.findNodesInTable(e,"td,th"),i=t.length;for(var s=0;s<i;s++)if(n=t[s],r=J(n),o=parseInt(r.attr("colspan")||1),o>1)for(var l=0;l<o-1;l++)a=oe("hmp"),r.after(a)},ue=function(e){for(var t,i,n,r,o,a,s,l,d=DomUtil.findNodesInTable(e,"tr"),c=d.length,u=0;u<c;u++){t=d[u],ce(t),de(t),i=DomUtil.findNodesInTable(t,"td,th"),n=i.length;for(var g=0;g<n;g++){if(r=i[g],o=J(r),a=parseInt(o.attr("rowspan")||1),s=parseInt(o.attr("colspan")||1),a>1){l={},l.idx=g,l.vmp=1,l.hmp=s-1;for(var h=1;h<a&&u+h<c;h++)se(d[u+h],[l])}(a>1||s>1)&&o.attr({merge:"fc"})}}},ge=function(){var e=!1,t=editor.doc.getSelection(),i=t.getParents(NODE_TYPE.TABLE),n=i&&i.firstChild().dtNode.isHeaderRow();if(n){var r=t.getSelectedRows();if(r.length>0){var o=r[0]+1,a=r[r.length-1]+1;o==a&&1==o&&(e=!0)}}return e},he=function(e){if("undefined"==typeof MailMergeRepeatUtil||!e)return!1;for(;null!=e&&e.type!=NODE_TYPE.TABLE;)e=e.parent;return!!e&&MailMergeRepeatUtil.isCellRepeatPresent(e)},fe=function(e){if("undefined"==typeof MailMergeRepeatUtil||!e)return null;for(;null!=e&&e.type!=NODE_TYPE.TABLE;)e=e.parent;return e?MailMergeRepeatUtil.getRepeatColumnInfo(e.format):null},pe=function(e,t,i,n,r,o){var a=t.start,s=t.end,l=t.mminfo;"insert"==n?i<a&&(a+=1,s+=1):"delete"==n&&(i<a?(a-=1,s-=1):i>=a&&i<=s&&(s-=1));for(var d=0;d<e.length;d++){var c=e[d];delete c.mminfo,d>=a&&d<=s&&(c.mminfo=l)}},Ee=function(){var e=editor.doc.getSelection(),t=e.getSelectedCells();if(t.length<1)return[];var i=[],n=[],r=[],o=[];t.forEach(function(e){ZWArrayUtils.arrayContains(o,e.getStart())||(r.push(e),o.push(e.getStart()))});for(var a=0,s=r[a],l=s.parentNode().parentNode().children();s;){var d=s.parentNode();if(!ZWArrayUtils.arrayContains(i,d.getStart())){i.push(d.getStart()),n.push(d);for(var c=d.children(),u=0;u<c.length;u++){var g=c[u],h=g.attr(ATTR_CELL.TDS_MRG);h&&"hmp"!=h&&!ZWArrayUtils.arrayContains(o,g.getStart())&&(r.push(g),o.push(g.getStart()))}}if("fc"===s.attr(ATTR_CELL.TDS_MRG)||"vmp"===s.attr(ATTR_CELL.TDS_MRG))for(var f=s.dtNode.getMergeCells().length>0?s.dtNode.getMergeCells():s.dtNode.getRootMergeCell().getMergeCells(),u=0;u<f.length;u++){var p=f[u],E=p.merge,T=p.getIndex();if(E&&"hmp"!=E&&!ZWArrayUtils.arrayContains(o,T)){var O=p.getParent().getChildIndex(),m=p.getChildIndex(),I=l[O].children()[m];r.push(I),o.push(I.getStart())}}a+=1,s=r[a]}return n},Te=function(){var e=editor.doc.getSelection(),t=e.getSelectedCells();if(t.length<1)return[];var i=[],n=[],r=[];t.forEach(function(e){ZWArrayUtils.arrayContains(r,e.getStart())||(n.push(e),r.push(e.getStart()))});for(var o=0,a=n[o],s=a.parentNode().parentNode().children();a;){var l=a.dtNode.getChildIndex();if(!ZWArrayUtils.arrayContains(i,l)){i.push(l);for(var d=0;d<s.length;d++){var c=s[d],u=c.children()[l],g=u&&u.attr(ATTR_CELL.TDS_MRG);g&&"vmp"!=g&&!ZWArrayUtils.arrayContains(r,l)&&(n.push(u),r.push(u.getStart()))}}if("fc"===a.attr(ATTR_CELL.TDS_MRG)||"hmp"===a.attr(ATTR_CELL.TDS_MRG))for(var h=a.dtNode.getMergeCells().length>0?a.dtNode.getMergeCells():a.dtNode.getRootMergeCell().getMergeCells(),d=0;d<h.length;d++){var f=h[d],p=f.merge,E=f.getIndex();if(p&&"vmp"!=p&&!ZWArrayUtils.arrayContains(r,E)){var T=f.getParent().getChildIndex(),O=f.getChildIndex(),m=s[T].children()[O];n.push(m),r.push(m.getStart())}}o+=1,a=n[o]}return i.sort(function(e,t){return e-t}),i},Oe=function(){var e,t,i=editor.doc.getSelection(),n=i.getSelectedCells();if(n.length>0){var r,o,a,s;i.getSelectedCells().forEach(function(e){var t=e.dtNode.matrixPosition[0],i=e.dtNode.matrixPosition[1];r=void 0===r||t<r?t:r,o=void 0===o||t>o?t:o,a=void 0===a||i<a?i:a,s=void 0===s||i>s?i:s}),e=o-r+1,t=s-a+1}else e=1,t=1;return{row:e,column:t}},me=function(){var e,t,i;i=Oe(),e=i.row,t=i.column,e=e>1?" "+e:"",t=t>1?" "+t:"";var n=J("#insertrowcolmenu");n.zmenu("setMenuItemsAttribute",J("#insertRowBefore"),"label",J.i18n("writer.table.INSERT_CUSTOM_ROW_ABOVE",[e])),n.zmenu("setMenuItemsAttribute",J("#insertRowAfter"),"label",J.i18n("writer.table.INSERT_CUSTOM_ROW_BELOW",[e])),n.zmenu("setMenuItemsAttribute",J("#insertColumnBefore"),"label",J.i18n("writer.table.INSERT_CUSTOM_COLUMN_TO_LEFT",[t])),n.zmenu("setMenuItemsAttribute",J("#insertColumnAfter"),"label",J.i18n("writer.table.INSERT_CUSTOM_COLUMN_TO_RIGHT",[t]))},Ie=function(){var e={tblPr:{cell:{borders:{"border-top":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-left":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-bottom":{type:"solid",width:"1px",color:"rgb(0,0,0)"},"border-right":{type:"solid",width:"1px",color:"rgb(0,0,0)"}}}}};return{themeName:"theme1",themeObj:e}},De=function(e){var t=Utils.findNextIndexOf(FIELD_PARENTHESIS.OPEN_PARENTHESIS_REGEX,0,e),i=Utils.findNextIndexOf(FIELD_PARENTHESIS.CLOSE_PARENTHESIS_REGEX,t+1,e);return{name:e.substring(0,t),cellName:e.substring(t+1,i)}},Re=function(){return"4.0"};return{getCols:e,getMinCellWidth:h,getColumnWidthsInPx:r,getColumnWidthsInPercentage:o,findRowIdx:a,findColIdx:s,getNumberOfColumns:f,getNumberOfRows:p,isVisibleCell:l,isTableWidthInPercentage:d,isCellWidthInPercentage:c,processCellWidth:g,getCellsFromTable:E,getParaStylesFromTableTheme:v,getCellStylesFromTableTheme:P,getTableStylesFromTableTheme:_,updateTableThemeInfo:N,getCellIdx:T,getParentTableWidth:u,setTableAttr:n,getCellWidth:O,getTableTemplateInfo:L,insertTableUsingTemplateInfo:w,isInnerTable:m,getCurrRowsVisibleColWidth:I,calculateTableMarginLeft:D,isVerticalMergedRow:R,isHorizontalyMergedColumn:S,saveTableTemplateInfo:b,getFirstCell:y,getBoundaryCellsForTable:getBoundaryCellsForTable,getSurroundingCells:getSurroundingCells,getDTTableStructure:getDTTableStructure,getTableStart:M,getTableEnd:F,getRowStart:V,getRowEnd:B,getCellStart:x,getCellEnd:W,getCellBgcAt:G,isCollabsInTable:H,getTableCells:Y,getTableAsMatrix:k,deriveCellBordersOnPaste:z,isRangeContainsTable:X,isContainsProperCols:K,isWholeTableSelected:Q,isRangeContainsImage:q,generateFormatForCell:ee,isCellsSelectedByVertical:te,getAbsoluteCellLeft:$,isCellsSelectedByhorizontal:ie,handleSectionOpsArr:ne,updateCurrentColumn:re,fixMergeforTableEl:ue,isHeaderRowOnlySelected:ge,isCellRepeatTable:he,getColumnRepeatInfo:fe,updateColumnRepeatInfo:pe,displayRowAndColumn:me,getRowsToBeDeleted:Ee,getColumnsToBeDeleted:Te,getSelectedRowAndColForInsertion:Oe,getDefaultTableTheme:Ie,getTableInfo:De,getTableCurrentVersion:Re}}(),ZWArrayUtils=function(){var e=function(){var e=Array.prototype.indexOf;return e?function(e,t){return e.indexOf(t)!=-1}:function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]==t)return!0;return!1}}(),t=function(e){return e.filter(function(t,i,n){return e.indexOf(t)==i})},i=function(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if("object"==typeof e[i]&&"object"==typeof t[i]){if(!ZWJSONUtils.compareJSON(e[i],t[i]))return!1}else if(jQuery.isArray(e[i])&&jQuery.isArray(t[i])){if(!ZWArrayUtils.compareArray(e[i],t[i]))return!1}else if(e[i]!==t[i])return!1;return!0},n=function(e,t){var i,n,r=e.length,o=t.length,a=[];for(i=0;i<r;i++)for(n=0;n<o;n++)e[i]===t[n]&&a.push(e[i]);return a},r=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if(e==n.uuid){t.splice(i,1);break}}},o=function(e){return e[0]},a=function(e){return e[e.length-1]},s=function(e){for(var i=[],n=0;n<e.length;n++)i=i.concat(e[n]);return t(i)},l=function(e){for(var t=[],i=0;i<e.length;++i)Array.isArray(e[i])?t=t.concat(ZWArrayUtils.flattenArray(e[i])):t.push(e[i]);return t},d=function(e,t,i){Array.isArray(e)&&e.forEach(t,i)};return{arrayContains:e,removeDuplicates:t,compareArray:i,commonElementsInArray:n,removeObjArray:r,firstElementOf:o,lastElementOf:a,union:s,flattenArray:l,each:d}}(),ZWColorUtils=function(){var e=function(e,t){t/=100;var r=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),o=i(parseInt(r[0]),parseInt(r[1]),parseInt(r[2]));o[2]=o[2]*t+(1-t);var a=n(o[0],o[1],o[2]);return"rgb("+a[0]+","+a[1]+","+a[2]+")"},t=function(e,t){var r=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),o=i(parseInt(r[0]),parseInt(r[1]),parseInt(r[2]));o[2]=o[2]*(parseInt(t)/100);var a=n(o[0],o[1],o[2]);return"rgb("+a[0]+","+a[1]+","+a[2]+")"},i=function(e,t,i){e/=255,t/=255,i/=255;var n,r,o=Math.max(e,t,i),a=Math.min(e,t,i),s=(o+a)/2;if(o==a)n=r=0;else{var l=o-a;switch(r=s>.5?l/(2-o-a):l/(o+a),o){case e:n=(t-i)/l+(t<i?6:0);break;case t:n=(i-e)/l+2;break;case i:n=(e-t)/l+4}n/=6}return[n,r,s]},n=function(e,t,i){var n,r,o;if(0==t)n=r=o=i;else{var a=function(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e},s=i<.5?i*(1+t):i+t-i*t,l=2*i-s;n=a(l,s,e+1/3),r=a(l,s,e),o=a(l,s,e-1/3)}return[Math.round(255*n),Math.round(255*r),Math.round(255*o)]},r=function(e){var t=e;return t=t.substring("#".length),t=parseInt(t,16),t^=16777215,t=t.toString(16),t=("000000"+t).slice(-6),t="#"+t},o=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},a=function(e){if(0===e.indexOf("#"))return e;var t="(",i=")",n=e.substring(e.indexOf(t)+t.length,e.lastIndexOf(i)),r=n.split(",");return"#"+o(parseInt(r[0]))+o(parseInt(r[1]))+o(parseInt(r[2]))},s=function(e){var t=function(e){return e.match(/rgba/gi)};if(!t(e))return e;var i=e.match(/\d+\.*\d*/g),n={};n.R=i.shift()/255,n.G=i.shift()/255,n.B=i.shift()/255,n.A=i.shift()/1;var r={R:1,G:1,B:1},o={};o.R=parseInt(255*((1-n.A)*r.R+n.A*n.R)),o.G=parseInt(255*((1-n.A)*r.G+n.A*n.G)),o.B=parseInt(255*((1-n.A)*r.B+n.A*n.B));var a="rgb("+o.R+","+o.G+","+o.B+")";return a};return{getColorAfterTint:e,getColorAfterShade:t,rgbToHsl:i,hslToRgb:n,invertColor:r,rgbToHex:a,rgbaToRgb:s}}(),ZWImageUtils=function(){var e=function(e){return/\.(gif|jpg|jpeg|bmp|png)$/i.test(e)},t=function(e){var t=e&&(e.value||e.name||"");return/\.(gif|jpg|jpeg|bmp|png)$/i.test(t)},i=function(e,t,i){var n={};return n.cropTop=(e.cropTop/t*100).toFixed(3)+"%",n.cropBottom=(e.cropBottom/t*100).toFixed(3)+"%",n.cropLeft=(e.cropLeft/i*100).toFixed(3)+"%",n.cropRight=(e.cropRight/i*100).toFixed(3)+"%",n},n=function(e,t,i){var n={};return n.cropTop=parseFloat(e.cropTop)/100*t,n.cropBottom=parseFloat(e.cropBottom)/100*t,n.cropLeft=parseFloat(e.cropLeft)/100*i,n.cropRight=parseFloat(e.cropRight)/100*i,n},r=function(e){var t={};if(e&&e.cropRect){var i=e.cropRect,n=100-(parseFloat(i.cropTop)+parseFloat(i.cropBottom)),r=100-(parseFloat(i.cropLeft)+parseFloat(i.cropRight));t.wid=(100*e.wid/r).toFixed(3),t.ht=(100*e.ht/n).toFixed(3)}else t.ht=e.ht,t.wid=e.wid;return t},o=function(e,t){var i,n;for(t>e&&(i=e,e=t,t=i);0!=t;)n=e%t,e=t,t=n;return e},a=function(e,t){var i=o(e,t);return e/i/(t/i)},s=function(e,t){if("function"!=typeof t)return!1;fetch(e).then(function(e){return e.blob()}).then(function(e){var i=new FileReader;i.onload=function(){t(this.result)},i.readAsDataURL(e)})},l=function(e,t,i){var n=document.getElementById("copyImage");n.width=t?t:e.naturalWidth,n.height=i?i:e.naturalHeight;var r=n.getContext("2d");return r.drawImage(e,0,0),n.toDataURL("image/png")},d=function(e,t,i,n){var r,o;if("string"==typeof e?o=e:r=e,o&&n&&"function"==typeof n)editor.isOffline()&&ZWOffline.isOfflineSetupDone()?n(OfflineImpl.getImageSrc(o)):(r=document.createElement("img"),r.onload=function(){n(l(r,t,i))},r.src=o);else if(r)return l(r,t,i)},c=function(e){return Macros.isWriterImage(e)},u=function(e,t,i){var n,r;if("undefined"!=typeof editor.doc.model){var o=editor.doc.getSelection();if(i="undefined"==typeof i?o&&o.getStart():i,DocLayoutManager)if(i)n=DocLayoutManager.getViewAtIndex(i).getWidth(),r=DocLayoutManager.getContentHeightAtIndex(i);else{n=DocLayoutManager.getFirstSection().getWidth();var a=DocLayoutManager.getFirstPage();r=a.getMaxContentHeight()}else{var s;i&&(s=DocTreeManager.getTreeNodeAtIndex(i).getSection(),s.getSectionType()===SECTION_TYPES.TEXTBOX&&(n=s.width||0)),s=DocTreeManager.getSectionAtIndex(0);var l=s.getLayoutProps(),d=l.pageDimensions,c=l.margin;n=n?n:s.getContentWidth(),r=d.height-c.top-c.bottom-s.getGutterTop()}}else n=624,r=864;return e>n&&(t=t/e*n,e=n),t>r&&(e=e/t*r,t=r),{width:e,height:t}};return{isValidImage:e,isImage:t,convertCropDataToPercentage:i,convertCropDataToPixel:n,getOrginalHeighWidthOfImage:r,calculateAspectRatio:a,getImageBytes:d,getNewDimensionBasedOnContainer:u,isWriterImage:c,fetchBytes:s}}(),ZWJSONUtils=function(){var e=function(t,i){if(!t||!i)return!1;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],o=i[n];if(U.isObject(r)&&U.isObject(o)){if(!e(r,o))return!1}else if(U.isArray(r)&&U.isArray(o)){if(!ZWArrayUtils.compareArray(r,o))return!1}else if(r!==o)return!1}for(var n in i)if(i.hasOwnProperty(n)){var r=t[n],o=i[n];if(U.isObject(o)&&U.isObject(r)){if(!e(o,r))return!1}else if(U.isArray(o)&&U.isArray(r)){if(!ZWArrayUtils.compareArray(o,r))return!1}else if(o!==r)return!1}return!0},t=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},i=function(e){try{return JSON.parse(e)&&!0}catch(e){return!1}},n=function(e,t){for(var i in t)e[i]&&"object"==typeof t[i]?n(e[i],t[i]):e[i]=t[i]},r=function(e){var t;if(null==e||"object"!=typeof e)return e;if(Array.isArray(e)){t=[];for(var i=0,n=e.length;i<n;i++)t[i]=r(e[i]);return t}if(a(e)){t={};for(var o in e)e.hasOwnProperty(o)&&(t[o]=r(e[o]));return t}return t},o=function(e,t){extend(e,r(t))},a=function(e){if("undefined"!=typeof jQuery)return jQuery.isPlainObject(e);var t=Object.getPrototypeOf(Object(e));return null===t||t===Object.prototype},s=function(e){var t;for(t in e)return!1;return!0},l=function(){return Object.keys?function(e){return e?Object.keys(e):null}:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t}}(),i=function(e){try{return JSON.parse(e)&&!0}catch(e){return!1}},d=function(e){for(var t in e)void 0===e[t]&&delete e[t];return e},c=function(e){for(var t in e)delete e[t]},u=function(e,t,i){return e[i]&&e[i]!=t[i]},g=function(e,t,i){var n=Object.keys(e),r=[];return n.forEach(function(n){r.push(i?t(e[n],n).bind(i):t(e[n],n))}),r};return{compareJSON:e,mergeJsonObjs:t,deepMerge:n,clone:r,cloneAndExtend:o,isPlainObject:a,isEmptyObject:s,getKeys:l,isJSON:i,jsonCleanser:d,emptyJSON:c,isPropertyChanged:u,mapJSON:g}}(),ZWWebFontLoader;!function(){"use strict";var e="loading",t="loaded",i="unloaded",n={},r={},o=[],a=new ZWConsole,s=function(e,t){if(e){t=t||document;var i=t.getElementById("webfonts-style");i?e=J(i).text()+e:(i=t.createElement(isHeadlessHTML?"div":NODE_NAME.STYLE),i.id="webfonts-style",i.type="text/css",J(isHeadlessHTML?t.body:t.head).append(i)),J(i).text(e)}},l=function(e,t,i){var o=t.replace(/\D/g,"")+"00";o+=/[i]/.test(t)?"i":"",r[i]=1,delete n[e].variants[o]},d=function(e,t,o,a){var s=[],l="";for(var d in n)s.push(n[d]);for(var c,u,g,h=0,f=s.length;h<f;h++){c=s[h],g=c.getFontVariants(),u=c.getFontName();for(var p,E,T,O,m=0,I=g.length;m<I;m++)p=g[m],E=(/^[1-9]00i$/.test(p)?"i":"n")+p.replace(/[0i]/g,""),T=u+":"+E,O=t.webFontsLoadStatus[T],O===i||o.hasOwnProperty(T)||r.hasOwnProperty(T)||(l+=c.getFontFaceCSS(p))}a=a||document;var D=a.getElementById("webfonts-style");J(D).text(l)},c=function(e){return e.fontsToBeLoaded.length?1===e.retryCount++?(e.startTime=(new Date).getTime(),void WebFont.load(e)):(e.retryCount=0,e.startTime=(new Date).getTime(),e.custom={families:[e.fontsToBeLoaded.shift()]},void WebFont.load(e)):e.loadComplete()},o=[],u=[],g=function(e,i,n,r,o,a){n=n||i.document,Array.isArray(a)||(a=[a]),a.forEach(function(e){if(e){var r=e.family,a=e.style,s=e.weight;a.indexOf("italic")!==-1&&(s+="i");var l=(/^[1-9]00i$/.test(s)?"i":"n")+s.replace(/[0i]/g,""),d=r+":"+l;clearTimeout(o.timeout[d]),delete o.timeout[d],n.fonts.add(e),document.fonts.add(e),i.webFontsLoadStatus[d]=t,u.contains(d)&&u.splice(u.indexOf(d),1);}}),"function"==typeof r&&r(u)},h=function(e,t,i){ZWLogger.log("Loading Failed Fonts callbackCalled : "+i)},f=function(e,t,n,r){var o=t.family,a=t.style,s=t.weight;a.indexOf("italic")!==-1&&(s+="i");var l=(/^[1-9]00i$/.test(s)?"i":"n")+s.replace(/[0i]/g,""),d=o+":"+l;if(e.webFontsLoadStatus[d]=i,u.push(d),n.failedWebFonts=u,1===++n.retryCount[d]){var c=FontUtils.getWebFont(o),h=c.getFontFaceCSS(s,!1,!0),p=new FontFace(h["font-family"],h.src,{style:h["font-style"],weight:h["font-weight"]});1===n.retryCount[d]++&&p.load().then(g.bind(null,null,e,null,null,n),f.bind(null,e,p,n))}},p=function(e,t){if(Object.keys(e.timeout).length){a.log("Failed WebFonts: TImeout fonts called ::",Object.keys(e.timeout));var i;for(var n in e.timeout)i=e.timeout[n],clearTimeout(i),delete e.timeout[n]}},E=function(e){ZWLogger.log("Failed WebFont ::",e)},T=function(e){ZWLogger.log("Exception in Loading WebFonts ::",e)},O={};O.loadDocumentFonts=function(i,r,s,l){if(!Array.isArray(i)||!i.length||!r)return"function"==typeof s&&s();r.webFontsLoadStatus||(r.webFontsLoadStatus={});var d,c,d,O=r.document,D=[],R={},S=[],C={};R.retryCount={},R.timeout={},R.startTime=(new Date).getTime();var A=editorProps.isWebLayout||editorProps.isFixedLayout;if(A)return"function"==typeof s&&s();for(var v,_,P,N=0,b=i.length;N<b;N++){v=i[N],_=v.getFontName(),P=v.getFontVariants(l&&l.defaultVarients),n[v.family]=v;for(var L,w,y,M,F=0,U=P.length;F<U;F++)if(L=P[F],w=(/^[1-9]00i$/.test(L)?"i":"n")+L.replace(/[0i]/g,""),y=_+":"+w,(!l||!l.usedWebFontWithVariants||l.usedWebFontWithVariants.contains(y))&&(M=r.webFontsLoadStatus[y],M!==e&&M!==t)){o.contains(_)||o.push(_),R.retryCount[y]=0,c=v.getFontFaceCSS(L,!1,!0);try{d=new FontFace(c["font-family"],c.src,{style:c["font-style"],weight:c["font-weight"]}),d.family||(d=I(c))}catch(e){d=I(c)}R.timeout[d.family+":"+w]=setTimeout(p.bind(null,R,s),3e4),C[_]=d;try{D.push(d.load().then(null,f.bind(null,r,d,R)).catch(E)),O.fonts.add(d),document.fonts.add(d)}catch(e){ZWLogger.log("Exception loading FontFace: ")}r.webFontsLoadStatus[y]=e,S.push(y)}}if(editorProps.browserInfo.is_safari)try{D.length&&Promise.all(D).then(g.bind(null,i,r,O,s,R),h.bind(null,R,s)).catch(T),a.log("LoadFontFace promiseArr ::  ",D)}catch(e){ZWLogger.log("Exception in promisisng all FontFace: ")}else{var V=[];document.fonts.ready.then(function(e){e.forEach(function(e){var i=e.family,n=e.style,o=e.weight;n.indexOf("italic")!==-1&&(o+="i");var a=(/^[1-9]00i$/.test(o)?"i":"n")+o.replace(/[0i]/g,""),s=i+":"+a;clearTimeout(R.timeout[s]),delete R.timeout[s],r.webFontsLoadStatus[s]=t,u.contains(s)&&u.splice(u.indexOf(s),1),V.push(m(e))}),"function"==typeof s&&s(u),s=null})}if(!S.length){var B="function"==typeof s&&s();return s=null,B}a.log("FontsToBeLoaded: "+S),ZWLogger.log("FontsToBeLoaded: ["+S+"]")};var m=function(e){var t=e.family,i=e.style,n=e.weight;i.indexOf("italic")!==-1&&(n+="i");var r=(/^[1-9]00i$/.test(n)?"i":"n")+n.replace(/[0i]/g,""),o=t+":"+r;return o},I=function(e){var t=new FontFace("'"+e["font-family"]+"'",e.src,{style:e["font-style"],weight:e["font-weight"]});return t};O.loadWebFonts=function(o,a,u){if(!Array.isArray(o)||!o.length||!a)return"function"==typeof u&&u();a.webFontsLoadStatus||(a.webFontsLoadStatus={});for(var g,h,f,p=[],E="",T=0,O=o.length;T<O;T++){g=o[T],h=g.getFontName(),f=g.getFontVariants(),n[g.family]=g;for(var m,I,D,R,S=0,C=f.length;S<C;S++)m=f[S],I=(/^[1-9]00i$/.test(m)?"i":"n")+m.replace(/[0i]/g,""),D=h+":"+I,R=a.webFontsLoadStatus[D],R!==e&&R!==t&&(E+=g.getFontFaceCSS(m),a.webFontsLoadStatus[D]=e,p.push(D))}if(!p.length)return"function"==typeof u&&u();ZWLogger.log("FontsToBeLoaded: ["+p+"]");var A=editorProps.isWebLayout||editorProps.isFixedLayout;if(E&&(s(E),!A&&s(E,a.document)),A)return"function"==typeof u&&u();var v={callback:u,context:a,failedWebFonts:{},fontsToBeLoaded:p,fontactive:function(e,i){e=e+":"+i,delete this.failedWebFonts[e],delete r[e],a.webFontsLoadStatus[e]=t,c(this)},fontinactive:function(e,t){e=e+":"+t,1===++this.retryCount||(l(e.split(":")[0],t,e),d(o,a,this.failedWebFonts),!A&&d(o,a,this.failedWebFonts,a.document)),a.webFontsLoadStatus[e]=i,this.failedWebFonts[e]=1,c(this)},loadComplete:function(){this.loading=this.active=this.inactive=this.fontloading=this.fontactive=this.fontinactive=void 0,"function"==typeof this.callback&&this.callback(Object.keys(this.failedWebFonts))},timeout:3e4};Object.defineProperties(v,{timeTaken:{get:function(){return(new Date).getTime()-this.startTime}}}),c(v)},O.getLoadedWebFonts=function(){return o},O.enableLogger=function(e){a.enable(e)},O.disableLogger=function(){a.disable()},ZWWebFontLoader=O}();var BiDi=function(){"use strict";function e(e,t){this.initialTypes=e,this.types=e.slice(0),this.paraEmbeddingLevel=t||-1,this.sos=null,this.eos=null,this.length=this.types.length,this.levels=[],this.init()}function t(e,t){return 0}function i(){for(var e=this.sos,t=0;t<this.length;t++){var i=this.types[t];i===d.NSM?this.types[t]=e:e=i}for(var t=0;t<this.length;t++)if(this.types[t]===d.EN)for(var o=t-1;o>=0;--o){var i=this.types[o];if(i===d.L||i===d.R||i===d.AL){i===d.AL&&(this.types[t]=d.AN);break}}for(var t=0;t<this.length;t++)this.types[t]===d.AL&&(this.types[t]=d.R);for(var t=1;t<this.length;t++){var i=this.types[t];if(i===d.ES||i===d.CS){var a=this.types[t-1],s=this.types[t+1];a===d.EN&&s===d.EN?this.types[t]=d.EN:i===d.CS&&a===d.AN&&s===d.AN&&(this.types[t]=d.AN)}}for(var t=0;t<this.length;t++)if(this.types[t]===d.ET){var l=t,c=n.call(this,l,this.length,[d.ET]),i=0===l?this.sos:this.types[l-1];i!==d.EN&&(i=c===this.length?this.eos:this.types[c]),i===d.EN&&r.call(this,l,c,d.EN),t=c}for(var t=0;t<this.length;t++){var i=this.types[t];i!==d.ES&&i!==d.ET&&i!==d.CS||(this.types[t]=d.ON)}for(var t=0;t<this.length;t++)if(this.types[t]===d.EN){for(var u=this.sos,o=t-1;o>=0;o--){var i=this.types[o];if(i===d.L||i===d.R){u=i;break}}u===d.L&&(this.types[t]=d.L)}}function n(e,t,i){for(;e<t;){for(var n=!1,r=this.types[e],o=0;o<i.length;o++)if(r===i[o]){++e,n=!0;break}if(!n)return e}return t}function r(e,t,i){for(var n=e;n<t;n++)this.types[n]=i}function o(){for(var e=0;e<this.length;e++){var t=this.types[e];if(t===d.WS||t===d.ON||t===d.B||t===d.S){var i,o,a=e,s=n.call(this,a,this.length,[d.B,d.S,d.WS,d.ON]);0===a?i=this.sos:(i=this.types[a-1],i!==d.AN&&i!==d.EN||(i=d.R)),s===this.length?o=this.eos:(o=this.types[s],o!==d.AN&&o!==d.EN||(o=d.R));var l;l=i===o?i:0===this.paraEmbeddingLevel?d.L:d.R,r.call(this,a,s,l),e=s}}}function a(){var e=this.sos;if(e%2===0)for(var t=0;t<this.length;t++){var i=this.types[t];i===d.R?this.levels[t]+=1:i!==d.AN&&i!==d.EN||(this.levels[t]+=2)}else for(var t=0;t<this.length;t++){var i=this.types[t];i!==d.L&&i!==d.AN&&i!==d.EN||(this.levels[t]+=1)}}function s(e,t,i,n){for(var r=t;r<i;r++)e.push(n)}var l=125,d={L:0,LRE:1,LRO:2,R:3,AL:4,RLE:5,RLO:6,PDF:7,EN:8,ES:9,ET:10,AN:11,CS:12,NSM:13,BN:14,B:15,S:16,WS:17,ON:18,LRI:19,RLI:20,FSI:21,PDI:22};return extend(e.prototype,{init:function(){this.paraEmbeddingLevel===-1&&(this.paraEmbeddingLevel=t.call(this,0,this.length)),s(this.levels,0,this.types.length,this.paraEmbeddingLevel),this.sos=this.paraEmbeddingLevel%2===1?d.R:d.L,this.eos=this.paraEmbeddingLevel%2===1?d.R:d.L,i.call(this),o.call(this),a.call(this)},getLevels:function(e,t){if(null==e||null==t)return this.levels;for(var i=this.levels.slice(e,t),n=0;n<i.length;++n){var r=this.initialTypes[e+n];if(r===d.B||r===d.S){i[n]=this.paraEmbeddingLevel;for(var o=n-1;o>=0&&r===d.WS;--o)i[o]=this.paraEmbeddingLevel}}for(var o=t-1;o>=e;--o){var r=this.initialTypes[o];if(r!==d.WS)break;i[o-e]=this.paraEmbeddingLevel}return i},getReordering:function(e,t){var i=[];e=e||0,t=t||this.length;for(var n=this.getLevels(e,t),r=0;r<t-e;r++)i[r]=r;for(var o=0,a=l+2,r=0;r<t-e;r++){var s=n[r];s>o&&(o=s),s%2!==0&&s<a&&(a=s)}for(var s=o;s>=a;s--)for(var r=0;r<t-e;r++)if(n[r]>=s){for(var d=r,c=r+1;c<t-e&&n[c]>=s;)++c;for(var u=d,g=c-1;u<g;++u,--g){var h=i[u];i[u]=i[g],i[g]=h}r=c}for(var r=0;r<t-e;r++)i[r]+=e;return i},getBaseLevel:function(){return this.paraEmbeddingLevel},destroy:function(){this.types=[],this.paraEmbeddingLevel=-1,this.sos=null,this.eos=null,this.length=0,this.levels=[]}}),e}(),SubBlock=function(){"use strict";function e(e,t,i,n,r){this.id=Utils.randomId("subblock"),this.start=e,this.end=t,this.visualOrder=i||[],this.block=n,this.width=0,this.left=0,this.direction=r,this.type=this.block.type}return extend(e.prototype,{getContent:function(){var e=this.block,t=e.start;return e.content.slice(this.start-t,this.end-t)},computeWidth:function(){var e=this.getVisualOrder();if(e.length||(this.width=0),this.block.type===BLOCK_TYPE.EOP||this.block.isSpecialBlock)this.width=this.block.getRenderWidth();else if(1===this.block.subBlocks.length)this.width=this.block.width;else{var t=e[0],i=ZWArrayUtils.lastElementOf(e);this.width=this.block.computeWidthBetweenIndex(t,i,!0)}},updateWidth:function(e){this.width=e},updateLeft:function(e){this.left=e},getLeft:function(){return this.left},getDirectionalLeft:function(e){var t=0,i=e.getSublineOfSubBlock(this);return i&&(t=i.left),this.left+t},getWidth:function(){return this.width},getVisualOrder:function(){return this.visualOrder},getAbsLeft:function(e){return e===VIEW.LINE?this.getLeft()+this.subline?this.subline.left:0:this.getLeft()}}),e}(),LineBlock=function(){"use strict";function e(e,t,i,n,r,o,a,s,l,d,c,u,g,h,f,p){var E={};for(var T in s)E["#"+T+"#"]=s[T];i=i||"",this.start=e,this.end=t||e+i.length,this.originalWidth=n,this.baseLine=o||0,this.left=0,this.width=n,this.height=r,this.fontStringObj=a,this.content=i,this.formats=E,this.displayStyle=l,this.isSpecialBlock=d||!1,this.isMetricsFilled=c||!1,this.isNonEditable=g||!1,this.type=u||"",this.renderingFormat=h||{},this.types=f||[],this.visualOrder=[],this.subBlocks=[],this.isLTR=!1,this.isRTL=!1,this.isNeutralChars=!1,this.isArabic=!1,this.levels=[],this.parent=p||null,this.computeCharacterTypes(),this.updateDimensionsBasedOnDisplayStyle()}var t=function(e){return e%2===0?PARA_DIR.LTR:PARA_DIR.RTL};return extend(e.prototype,{getAbsStart:function(){return this.parent.getIndex()+this.start},getAbsEnd:function(){return this.parent.getIndex()+this.end},getWidth:function(){return this.width},resetOriginalWidth:function(){this.width=this.originalWidth},computeCharacterTypes:function(){for(var e,t=0;t<this.types.length&&!(this.isNeutralChars&&this.isRTL&&this.isArabic&&this.isLTR);t++)e=this.types[t],!this.isNeutralChars&&[CHARACTER_TYPES.WS,CHARACTER_TYPES.ON,CHARACTER_TYPES.B,CHARACTER_TYPES.S].contains(e)&&(this.isNeutralChars=!0),!this.isRTL&&[CHARACTER_TYPES.AL,CHARACTER_TYPES.AN,CHARACTER_TYPES.R].contains(e)&&(this.isRTL=!0),!this.isArabic&&[CHARACTER_TYPES.AL,CHARACTER_TYPES.AN].contains(e)&&(this.isArabic=!0),!this.isLTR&&[CHARACTER_TYPES.L,CHARACTER_TYPES.EN,CHARACTER_TYPES.ES].contains(e)&&(this.isLTR=!0)},updateDimensionsBasedOnDisplayStyle:function(){if(!ZWJSONUtils.isEmptyObject(this.displayStyle)){var e=editor.doc.getCharAt(this.getAbsStart()-1)===UNICODE.RANGE_START,t=editor.doc.getCharAt(this.getAbsEnd())===UNICODE.RANGE_END,i=0,n=0,r=this.displayStyle[ATTR_COMMON.BORDERS];if(r){if(e){var o=r[ATTR_BORDERS.BORDER_LEFT];o&&(i+=parseFloat(o[ATTR_BORDERS.SPACE])+parseFloat(o[ATTR_BORDERS.WIDTH]))}if(t){var a=r[ATTR_BORDERS.BORDER_RIGHT];a&&(i+=parseFloat(a[ATTR_BORDERS.SPACE])+parseFloat(a[ATTR_BORDERS.WIDTH]))}var s=r[ATTR_BORDERS.BORDER_TOP];s&&(n+=parseFloat(s[ATTR_BORDERS.SPACE])+parseFloat(s[ATTR_BORDERS.WIDTH]));var l=r[ATTR_BORDERS.BORDER_BOTTOM];l&&(n+=parseFloat(l[ATTR_BORDERS.SPACE])+parseFloat(l[ATTR_BORDERS.WIDTH]))}this.width+=i,this.originalWidth=this.width,this.height+=n}},findClosestFormatInfo:function(e){var t=this.formats["#"+this.start+"#"],i=this.fontStringObj["#"+this.start+"#"];for(var n in this.formats){if(n.split("#")[1]>e)break;t=this.formats[n],i=this.fontStringObj[n]}return{format:t,fontStringObj:i}},spliceAllFormatsInfoAfterIndex:function(e){var t={},i={};for(var n in this.formats)n.split("#")[1]<e||(t[n]=this.formats[n],delete this.formats[n],i[n]=this.fontStringObj[n],delete this.fontStringObj[n]);return{formats:t,fontStringObj:i}},computeSpaceWidth:function(e,t,i){var n=0;this.subBlocks.forEach(function(e){n+=e.getWidth()});var r=this.end-this.start>1;if(r){i&&t++;var o=t-e,a=n/(this.end-this.start);n=a*o}return n},getWidthBetweenIndex:function(e,t,i,n){return e!==t||i?this.isSpecialBlock?this.getRenderWidth():this.isSpace()?this.computeSpaceWidth(e,t,i):this.computeWidthBetweenIndex(e,t,i,n):0},computeWidthBetweenIndex:function(e,t,i,n){return this.computeDimensionsBetweenIndex(e,t,i,n).width},computeDimensionsBetweenIndex:function(e,t,i,n){var r=this.getVisualOrder();e=null==e?r[0]:e;var o,a=this.findClosestFormatInfo(e),s=a.format,l=a.fontStringObj,d=0,c=0,u=0,g="",h="",f=e,p=-1,E=this.parent.getIndex(),T=r.indexOf(e),O=r.indexOf(t);for(n&&n.hasAdditionalInfo&&(f=n.visualIdx,g=n.subString,d=n.width||0,c=n.height||0,u=n.baseLine||0,a=this.findClosestFormatInfo(f),s=a.format,l=a.fontStringObj,T=r.indexOf(f));null!=f&&(f!==t||i);){var m="#"+(this.start+T)+"#";if(this.formats[m]&&g&&(o=DTUtils.getTextMetrics(g,s,l),d+=o.width,o.height>c&&(c=o.height),o.baseLine>u&&(u=o.baseLine),g="",s=this.formats[m],l=this.fontStringObj[m],n&&(n.width=d,n.height=c,n.baseLine=u)),h=editor.doc.getCharAt(E+f)||""," "===h&&(h=FontUtils.SPACE_CHAR),p>f){var I="";I=FontUtils.isCanvasSupported()?h:Utils.encodeHTMLChars(h),g=I+g}else g+=FontUtils.isCanvasSupported()?h:Utils.encodeHTMLChars(h);f===t?i=!1:(p=f,f=this.parent.hasRTLContent?O>=r.indexOf(f)?r[++T]:r[--T]:r[++T])}return""!==g&&(o=DTUtils.getTextMetrics(g,s,l),d+=o.width,o.height>c&&(c=o.height),o.baseLine>u&&(u=o.baseLine)),n&&(n.hasAdditionalInfo=!0,n.subString=g,n.visualIdx=f),{width:d,height:c,baseLine:u}},computeSubBlockWidth:function(){for(var e=0;e<this.subBlocks.length;e++)this.subBlocks[e].computeWidth()},getFormatAtIndex:function(e){if(e<this.start)return this.formats["#"+this.start+"#"];for(var t=e,i="#"+t+"#";this.start<t&&!this.formats.hasOwnProperty(i);)t--,i="#"+t+"#";return this.formats[i]},getFontStringObjAtIndex:function(e){if(e<this.start)return this.fontStringObj["#"+this.start+"#"];for(var t=e,i="#"+t+"#";this.start<t&&!this.fontStringObj.hasOwnProperty(i);)t--,i="#"+t+"#";return this.fontStringObj[i]},getVisualOrder:function(){return this.visualOrder},getLevels:function(){return this.levels},addToSubBlocks:function(e){this.subBlocks.push(e)},removeFromSubBlocks:function(e){var t=this.subBlocks.indexOf(e);return t!==-1?this.subBlocks.splice(t,1):null},moveSubBlock:function(e,t){this.removeFromSubBlocks(e),t.addToSubBlocks(e),e.block=t,e.type=e.block.type},getSubBlocks:function(){return this.subBlocks},getSubBlockAtIndex:function(e){for(var t=this.getSubBlocks(),i=0;i<t.length;i++)if(t[i].getVisualOrder().contains(e))return t[i]},getLeft:function(){var e=this.left,t=0,i=this.subBlocks.length;if(i){t=this.subBlocks[0].left;for(var n=1;n<this.subBlocks.length;n++)t>this.subBlocks[n].left&&(t=this.subBlocks[n].left)}return e+t},resetVisualOrderAndSubBlocks:function(){this.visualOrder=[],this.subBlocks=[]},computeSubBlocksVisualOrder:function(){var e=[],i=[],n=this.getVisualOrder(),r=this.getLevels(),o=[];if(1===n.length)e.push([n[0]]),o.push(t(r[0]));else for(var a=1;a<n.length;a++)n[a]!==n[a-1]+1&&n[a]!==n[a-1]-1?(i.push(n[a-1]),e.push(i),o.push(t(r[a-1])),i=[]):i.push(n[a-1]),a===n.length-1&&(i.push(n[a]),e.push(i),o.push(t(r[a])));return{subBlocksArray:e,directionArray:o}},computeSubBlocks:function(){for(var e,t=this.computeSubBlocksVisualOrder(),i=t.subBlocksArray,n=t.directionArray,r=0;r<i.length;r++){e=i[r];var o=Math.min.apply(null,e),a=Math.max.apply(null,e)+1;this.addToSubBlocks(new SubBlock(o,a,e,this,n[r]))}this.computeSubBlockWidth()},getSubBlocksLength:function(){return this.getSubBlocks().length},getRenderWidth:function(){var e=this.width;if(this.type===BLOCK_TYPE.EOP&&!this.parent.isEmpty()){var t=DocTreeViewManager.getDTView(this.parent);if(!t)return 0;for(var i=t.blocks,n=0;n<i.length;n++)if(i[n].type!==BLOCK_TYPE.EOP&&0!=i[n].width){e=0;break}}return e},getRenderHeight:function(){return this.height},updateWidth:function(e){this.width=e},updateLeft:function(e){this.left=e},isSpace:function(){if(0===this.content.trim().length)for(var e in this.formats)if(!this.formats[e].cls||this.formats[e].cls!==NODE_TYPE.FILLABLEFIELD)return!0;return!1}}),e}();!function(){var e=function(e,t){return{width:e,height:t}},t=e(0,0),i=function(e,t,i,n,r,o,a){e>t&&ZWLogger.log("DTSegment start > end :: start: "+e+", end: "+t),this.start=e,this.end=t,this.isRTL=i,this.format=n,this.content=r,this.computedFormat=o,this.type=a||""},n=function(e,t){return t=editor.doc.findNextIndexOf(e,t+1),t<0&&(t=editor.doc.getDocumentLength()),t},r=function(e,t){var i=editor.doc.findPreviousIndexOf(CONT_REGEXP.PARAEND,t);return i<0?i=editor.doc.getSectionStart(t)+1:i+=1,i},o=function(e,t,i){var r;switch(e){case UNICODE.PARA:r=editor.doc.getCharAt(t)==UNICODE.PARA?t:n(CONT_REGEXP.PARAEND,t),r+=1;break;case UNICODE.TABLE:r=TableUtil.getTableEnd(t+1)||n(CONT_REGEXP.SECTIONEND,t);break;case UNICODE.ROW:r=TableUtil.getRowEnd(t+1);break;case UNICODE.CELL:r=TableUtil.getCellEnd(t+1)||n(CONT_REGEXP.SECTIONEND,t);break;case UNICODE.HR:r=t+1;break;case UNICODE.TOCSTART:r=n(UNICODE.TOCEND,t)+1;break;case UNICODE.SECTIONSTART:r=n(UNICODE.SECTION_START,t);break;default:r=n(CONT_REGEXP.PARAEND,t)}return r},a=function(e){for(;e.parent;)e=e.parent;return e},s=function(e){return U.isEmpty(e)?e:(Object.defineProperties(e,{absEnd:{get:function(){return this.absStart+this.end-this.start}},absStart:{get:function(){return this.parent.getIndex()+this.start}},content:{get:function(){return this.parent.content().substring(this.start,this.end)}},parentStart:{get:function(){return this.parent.getIndex()}},absLeft:{get:function(){var e=this.view;return(e.styles.ml||"0in").convertor().pixels+this.left+this.listWidth+this.style.borders["border-left"].space}},footNoteHeight:{get:function(){var e,t=0,i=this.getFootNotesLength(),n=this.getMetaSectionByType(SECTION_TYPES.FOOTNOTE),r=this.getPage(),o=null;r&&(o=r.getFirstSection(SECTION_TYPES.FOOTNOTE));for(var a=0;a<i;a++)e=DocLayoutManager.getSectionViews(n[a].id),e.length&&(t+=e[0].getHeight(),o&&e[0]===o&&(t+=r.getSeparatorHeight()));return t}}}),e)};extend(this,{defineLineProperties:s,dimension:e,emptyDimension:t,DTSegment:i,getEnd:o,getStart:r,findNextIndexOf:n,getSection:a})}();var DTUtils=function(){var e=function(e,t,i,n,r,o){return{node:e,op:t,contentIndex:i,endIndex:n,type:r,styles:o||""}},t=function(e,t){var i=e[ATTR_COMMON.BORDERS],n=0,r=0,o=0,a=0,s=0,l=0,d=0,c=0;return"cell"==e.type&&(i=TableUtil.getCellStylesFromTableTheme(t).borders),i&&(n=i[ATTR_BORDERS.BORDER_TOP]&&parseFloat(i[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])||0,r=i[ATTR_BORDERS.BORDER_LEFT]&&parseFloat(i[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.WIDTH])||0,o=i[ATTR_BORDERS.BORDER_RIGHT]&&parseFloat(i[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.WIDTH])||0,a=i[ATTR_BORDERS.BORDER_BOTTOM]&&parseFloat(i[ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.WIDTH])||0,s=(i[ATTR_BORDERS.BORDER_TOP]&&i[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.SPACE]||0).convertor().pixels,d=(i[ATTR_BORDERS.BORDER_LEFT]&&i[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]||0).convertor().pixels,c=(i[ATTR_BORDERS.BORDER_RIGHT]&&i[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]||0).convertor().pixels,l=(i[ATTR_BORDERS.BORDER_BOTTOM]&&i[ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.SPACE]||0).convertor().pixels),{"border-top":n,"border-bottom":a,"border-right":o,"border-left":r,"padding-top":s,"padding-bottom":l,"padding-right":c,"padding-left":d}},i=function(e){return e&&(e.cls||"").indexOf(NODE_TYPE.FILLABLEFIELD)!==-1&&e[ATTR_FILLABLEFIELD.FF_INFO]&&(e[ATTR_FILLABLEFIELD.FF_INFO].subType===FILLABLEFIELD_TYPE.IMAGE||e[ATTR_FILLABLEFIELD.FF_INFO].subType===FILLABLEFIELD_TYPE.SIGNATURE||e[ATTR_FILLABLEFIELD.FF_INFO].subType===FILLABLEFIELD_TYPE.INITIAL)},n=function(e,t,i){if(DTUtils.isImageFillableField(e))return e.wid;var n;return n=null!=i[ATTR_IMAGE.I_WID]?Math.round(i[ATTR_IMAGE.I_WID]):Math.round(9*(e&&e[ATTR_TEXT.TS_SIZE]||t&&t[ATTR_TEXT.TS_SIZE])/12*(i&&i[ATTR_FILLABLEFIELD.FF_INFO]?i[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_MAX_LENGTH]:0))||150,DTUtils.isFloatingImage(i)||DTUtils.isEmptyFillableField(i)?n:null},r=function(e,t){if(DTUtils.isImageFillableField(e))return e.ht;var i;return i=null!=e[ATTR_IMAGE.I_HT]?Math.round(e[ATTR_IMAGE.I_HT]):Math.round((t&&t[ATTR_TEXT.TS_SIZE]||12)*(19/12)),DTUtils.isFloatingImage(e)||DTUtils.isEmptyFillableField(e)?i:null},o=function(e){if(e[ATTR_COMMON.TYPE]===NODE_TYPE.FILLABLEFIELD&&e[ATTR_FILLABLEFIELD.FF_TYPE]!==FILLABLEFIELD_TYPE.SELECTBOX&&e[ATTR_FILLABLEFIELD.FF_TYPE]!==FILLABLEFIELD_TYPE.CHECKBOX){var t=Utils.getFillableFieldValue(e);if("string"==typeof t&&!t.trim()&&!e[ATTR_FILLABLEFIELD.FF_NAME])return!0}return!1},a=function(e){var t=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,e),i=editor.doc.findNextIndexOf(UNICODE.RANGE_END,e);if(t<0||i<0)return!1;var n=editor.doc.getRawFormatAt(t)||{};if(n[ATTR_COMMON.TYPE]!=NODE_TYPE.SIGNERFIELD)return!1;var r=editor.doc.getContent(t+1,i);return!r.trim()},s=function(e){for(var t=e.top,i=e.parent;i;)t+=i.top,i=i.parent;return t};getUserNameWithoutEncoding=function(e){var t=editor.doc.getUserData();if(!ZWJSONUtils.isEmptyObject(t)&&t[e])return t[e].fname;if(editor.isOffline()||editorProps.permissionsInfo&&editorProps.permissionsInfo.appInfo&&"REMOTE"==editorProps.permissionsInfo.appInfo.NAME)return e;var i={};i.userid=e;var n;return ZWNetworkUtils.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/util/getParticipantDetails"),data:i,async:!1,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){n=t.COLLABUSERSINFO?t.COLLABUSERSINFO.FULLNAME:e},error:function(){n=e}}),n};var l=function(e){if(e){var t=null;return e[ATTR_COMMON.TYPE]==NODE_TYPE.IMAGE&&(t=e[ATTR_COMMON.SUBTYPE]==NODE_TYPE.TEXTBOX?"TextBox":e[ATTR_COMMON.SUBTYPE]==NODE_TYPE.SHAPE?"Shape":"Image"),t}},d=function(e){var t={},i=editor.doc.getComputedFormatAt(e.getEndIndex(),NODE_TYPE.PARAGRAPH),n=i.borders;if(n)for(var r=[ATTR_BORDERS.BORDER_TOP,ATTR_BORDERS.BORDER_RIGHT,ATTR_BORDERS.BORDER_BOTTOM,ATTR_BORDERS.BORDER_LEFT,ATTR_BORDERS.BORDER_BETWEEN],o=0,a=r.length;o<a;o++)n[r[o]]&&(t[r[o]]={width:n[r[o]].width?n[r[o]].width.convertor().pixels:0,type:n[r[o]].type||"",color:n[r[o]].color?Utils.getColorValFromRefString(n[r[o]].color):"",space:n[r[o]].space?n[r[o]].space.convertor().pixels:0});return t},c=function(e){for(var t=!1,i=e.columns.first,n=-1;i;){if(t=i.hasPageBreak())return n;n++,i=i.next}return-1},u=function(e){var t,i=0;for(i+=e.length,t=e.first;t;)t.childViews&&(i+=u(t.childViews)),t=t.next;return i},g=function(e,t,i,n){return e<=i&&i<t||i<e&&t<=n||e<n&&n<t},h=function(e,t){if(!e||!t||e.getType()!==VIEW.PARA||t.getType()!==VIEW.PARA)return!1;var i=e.dtView.getBorderProperties(),n=e.getCodeProperties(),r=t.dtView.getBorderProperties(),o=t.getCodeProperties();return ZWJSONUtils.compareJSON(n,o)&&ZWJSONUtils.compareJSON(i,r)},f={t1:{kwd:"#6679cc",com:"#6b7394",str:"#ac9739",fun:"#3d8fd1",var:"#c94922",atv:"#22a2c9",typ:"#3d8fd1",tag:"#c94922",lit:"#c76b29",atn:"#c76b29",pln:"#f5f7ff",pun:"#f5f7ff",opn:"#f5f7ff",clo:"#f5f7ff",dec:"#c76b29"},t2:{kwd:"#a71d5d",com:"#969896",str:"#183691",fun:"#900",var:"#008080",atv:"#183691",typ:"#0086b3",tag:"#000080",lit:"#0086b3",atn:"#795da3",pln:"#333",pun:"#333",opn:"#333",clo:"#333",dec:"#333"},t3:{kwd:"#a71d5d",com:"#969896",str:"#183691",fun:"#a71d5d",var:"#333",atv:"#183691",typ:"#333",tag:"#63a35c",lit:"#0086b3",atn:"#795da3",pln:"#183691",pun:"#183691",opn:"#183691",clo:"#183691",dec:"#183691"},t4:{kwd:"#F92672",com:"#75715E",str:"#E6DB74",fun:"#66D9EF",var:"#66D9EF",atv:"#E6DB74",typ:"#66D9EF",tag:"#66D9EF",lit:"#AE81FF",atn:"#A6E22E",pln:"#ffffff",pun:"#ffffff",opn:"#ffffff",clo:"#ffffff",dec:"#ffffff"}},p=function(e,t){return f[e]?f[e][t]:""},E=function(e){for(var t,i={},n=[ATTR_BORDERS.BORDER_TOP,ATTR_BORDERS.BORDER_RIGHT,ATTR_BORDERS.BORDER_BOTTOM,ATTR_BORDERS.BORDER_LEFT,ATTR_BORDERS.BORDER_BETWEEN,ATTR_BORDERS.BORDER_RADIUS],r=0;r<n.length;r++)t=n[r],e[t]&&(t===ATTR_BORDERS.BORDER_RADIUS?i[t]={"br-topLeft":e[t][ATTR_BORDERS.RADIUS_TOPLEFT]||0,"br-topRight":e[t][ATTR_BORDERS.RADIUS_TOPRIGHT]||0,"br-bottomLeft":e[t][ATTR_BORDERS.RADIUS_BOTTOMLEFT]||0,"br-bottomRight":e[t][ATTR_BORDERS.RADIUS_BOTTOMRIGHT]||0}:i[t]={width:e[t].width?e[t].width.convertor().pixels:0,type:e[t].type||"",color:e[t].color?Utils.getColorValFromRefString(e[t].color):"",space:e[t].space?e[t].space.convertor().pixels:0});return i},T=function(e){return!(!e||!e[ATTR_IMAGE.I_WRAP_TYPE]||e[ATTR_IMAGE.I_WRAP_TYPE]!==WRAP_TYPE.FRONT&&e[ATTR_IMAGE.I_WRAP_TYPE]!==WRAP_TYPE.BEHIND)},O=function(e){return!(!e||!e[ATTR_IMAGE.I_WRAP_TYPE]||e[ATTR_IMAGE.I_WRAP_TYPE]!==WRAP_TYPE.FRONT&&e[ATTR_IMAGE.I_WRAP_TYPE]!==WRAP_TYPE.SQUARE&&e[ATTR_IMAGE.I_WRAP_TYPE]!==WRAP_TYPE.BEHIND)},m=function(e){return!(!e||!e[ATTR_IMAGE.I_WRAP_TYPE]||e[ATTR_IMAGE.I_WRAP_TYPE]!==WRAP_TYPE.SQUARE)},I=function(e,t){for(var i in e)e.hasOwnProperty(i)&&"string"==typeof e[i]&&(e[i]=(e[i]||"0in").convertUnitTo(t));return e},D=function(e){for(var t=!1,i=0;i<LAYOUT_STYLE_PROPS.length;i++){var n=LAYOUT_STYLE_PROPS[i];if(e[n]){t=!0;break}}return t},R=function(e){var t={},i=[],n=[];return i.push(CONST.HEADER_PRIMARY),n.push(CONST.FOOTER_PRIMARY),e==HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE?(i.push(CONST.HEADER_EVEN),n.push(CONST.FOOTER_EVEN)):e==HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE?(i.push(CONST.HEADER_FIRST),n.push(CONST.FOOTER_FIRST)):e==HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE&&(i.push(CONST.HEADER_EVEN),n.push(CONST.FOOTER_EVEN),i.push(CONST.HEADER_FIRST),n.push(CONST.FOOTER_FIRST)),t[SECTION_TYPES.HEADER]=i,t[SECTION_TYPES.FOOTER]=n,t},S=function(e,t,i){var n={},r=[],o=ListUtils.isAbstractList(t.id);if(!o)return t.levelInfo;for(var a=ListUtils.getAbstractId(t.id),s=ListUtils.getListIdsSharingCommonAbstractId(a),l=0,d=0;d<s.length;d++)r=r.concat(e.getSection().lists[s[d]]||[]);if(1===r.length){for(;i>=0;)n["level"+i]=editor.doc.getListStartingNo(r[0].paraProperties.listData.id,i),i--;return n}for(var d=0;d<r.length;d++)for(var c=0;c<r.length-d-1;c++)if(r[c].getIndex()>r[c+1].getIndex()){var u=r[c];r[c]=r[c+1],r[c+1]=u}for(var d=0;d<r.length;d++)if(r[d].getIndex()===e.getIndex()){l=d;break}var g,h,f=0;for(l>0&&(h=r[l-1]&&r[l-1].paraProperties&&r[l-1].paraProperties.listData&&r[l-1].paraProperties.listData.levelInfo);f<=i;)g="level"+f,h&&void 0!=h[g]?(n[g]=h[g],f==i&&n[g]++):n[g]=1,f+=1;for(var f=0;f<=i;){n["level"+f]>0&&n["level"+f]--;var p=editor.doc.getListStartingNo(t.id,f);editor.doc.isAbstractListhasStartsWith(t.id,f)?n["level"+f]=p:n["level"+f]+=p,f+=1}return n},C=function(e){var t=DocTreeManager.getSectionWithSid(e),i=editor.doc.getContent(t.getIndex()+1,t.getEndIndex());return i},A=function(e){for(var t in BIDI_CHAR_TYPES_REGEX)if(BIDI_CHAR_TYPES_REGEX[t].test(e))return CHARACTER_TYPES[t]},v=function(e){var t=editor.doc.getCharAt(e),i=!1,n=!1;if(t===UNICODE.RANGE_START){var r=editor.doc.getCharAt(e+1);t=r&&r!==UNICODE.RANGE_END?r:t,i=!0}else if(t===UNICODE.RANGE_END){var o=editor.doc.getCharAt(e-1);t=o&&o!==UNICODE.RANGE_START?o:t,n=!0}return""===t?(r=i?editor.doc.getCharAt(e+2):editor.doc.getCharAt(e+1),t=r&&r!==UNICODE.RANGE_END?r:t):""===t&&(o=n?editor.doc.getCharAt(e-2):editor.doc.getCharAt(e-1),t=o&&o!==UNICODE.RANGE_START?o:t),A(t)},_=function(e,t,i){return isV8Engine?getTextMetrics(e,t):(i=i||FontUtils.getFontString(t),FontUtils.getCharSize(e,i))};return{makeOp:e,isEmptyFillableField:o,isEmptySignerField:a,getBorderSize:t,isImageFillableField:i,getFillableFieldWidth:n,getFillableFieldHeight:r,getUserNameWithoutEncoding:getUserNameWithoutEncoding,getFloatingObjectType:l,getAbsViewTop:s,getParaBorderProperties:d,getPageBreakColumnIndex:c,getViewsLength:u,isWithinRange:g,compareParaBorderFormats:h,getCodeHighlightColor:p,computeRenderingBorderProperties:E,isFloatingImage:O,isNonWrappingFloatImage:T,isWrappingFloatImage:m,convertJSONUnitTo:I,isLayoutPropUpdated:D,getHFTypeDetails:R,getListNumber:S,getTextBoxContent:C,getCharacterType:A,computeCharTypeAtIndex:v,getTextMetrics:_}}();!function(){var e=function(e){if(!e.isVisible)return 0;var t,i,n=e.parent.parent,r=n.cols,o=this.getColIdx(e);if(n.isTableWidthInPercentage){for(i=e.cspan,i=i?i:1,t=r[o]?parseFloat(r[o].wt):0;i>1;){o+=1;var a=r[o]?parseFloat(r[o].wt):0;t+=a,i--}t=t*DocLayoutManager.getWidthFromNode(n)/100}else for(t=r[o]?parseFloat(r[o].wt.convertor().pixels):0,i=e.cspan;i>1;){o+=1;var a=r[o]?parseFloat(r[o].wt.convertor().pixels):0;t+=a,i--}return t||0==t||(t=0),t},t=function(e){for(var t=e.parent.children,i=t.length,n=0,r=0;r<i&&e.id!=t[r].id;r++)n++;return n},i=function(e){for(var t=e.parent.children,i=t.length,n=0,r=0;r<i&&e.id!=t[r].id;r++)n++;return n},n=function(e){var t=DocTreeManager.doc.getComputedFormatAt(e.getIndex(),NODE_TYPE.TABLE),i=t[ATTR_TABLE.TBLS_WID];return!(!i||i.indexOf(UNITS.PERCENTAGE)===-1)},r=function(e){if(!e||"table"!=e.type)return!1;var t,i,n,r,o,a;t=e.children,i=t.length;for(var s=0;s<i;s++){o=t[s],n=o.children,r=n.length;for(var l=0;l<r;l++)if(a=n[l],"fc"===a.merge||"hmp"===a.merge||"vmp"===a.merge)return!0}return!1},o=function(e){if(!e.merge||"vmp"==!e.merge)return 0;for(var i=t(e),n=e.parent,r=0;n;){if(n=n.prev){var o=n.children[i];if(!o)return 0;var a=o.merge;"fc"!=a&&"vmp"===a||(n=null)}r++}return r},a=function(e){var t=e.parent;if(!e.merge||"vmp"!=e.merge||!t)return!1;var i=t.next;if(i){var n=DTTableUtils.getColIdx(e);return!i.children[n]||"vmp"!=i.children[n].merge}return!0},s=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.TABLE,e);return t?t.start:-1},l=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.ROW,e);return t?t.start:-1},d=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.CELL,e);return t?t.start:-1},c=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.TABLE,e);return t?t.end:-1},u=function(e){var t=DocTreeManager.doc.getParents(NODE_TYPE.ROW,e);return t?t.end:-1},g=function(e){var t,i,n,r,o=e.firstRow?e.firstRow:e.band1Horz,a="1px solid black";return o&&o.cell&&o.cell.borders&&o.cell.borders["border-top"]?(t=o.cell.borders["border-top"],t&&(i=t.width,n=t.color,r=t.type,a=i+" "+r+" "+n)):e.tblPr&&(e.tblPr.borders?t=e.tblPr.borders["border-top"]?e.tblPr.borders["border-top"]:e.tblPr.borders.insideH:e.tblPr.cell&&e.tblPr.cell.borders&&(t=e.tblPr.cell.borders["border-top"]),t&&(i=t.width,n=t.color,r=t.type,a=i+" "+r+" "+Utils.getColorValFromRefString(n))),a},h=function(e){if(!e||"table"!==e.type)return!1;var t=e.getIndex(),i=e.getEndIndex(),n=editor.doc.findNextIndexOf(UNICODE.TABLE,t+1);return n>t&&n<i},f=function(e){if(!e||e.getType()!==NODE_TYPE.ROW)return!1;var t=e.getIndex(),i=e.getEndIndex(),n=editor.doc.findNextIndexOf(UNICODE.TABLE,t+1);return n>t&&n<i},p=function(e){return e.id==ZWArrayUtils.lastElementOf(e.parent.children).id},E=function(e){var t=e.parent.parent,i=ZWArrayUtils.lastElementOf(t.children),n=ZWArrayUtils.lastElementOf(i.children);return n.id==e.id};this.DTTableUtils={getColIdx:t,getRowIdx:i,getTableStart:s,getRowStart:l,getCellStart:d,getTableEnd:c,getRowEnd:u,getCellWidth:e,isLastVmpCell:a,getCellDepth:o,isTableInPercentage:n,getTableTopBorder:g,isTableMerged:r,isTableContainsInnerTable:h,isLastCellInRow:p,isLastCellInTable:E,isRowContainsInnerTable:f}}(),function(){"use strict";function e(e,t,i){DTNode.call(this,e,t,i),this.format=editor.doc.getRawFormatAt(this.getEndIndex()),this.type=NODE_TYPE.PARA,this.prevProperties={},this.computedFormat={},this.borderProperties={},this.paraProperties={},this.viewProperties={},this.segments=[],this.codeSegments=[],this.hasRTLContent=!1}var t=function(e){var t=[3,4,5,6,20];return t.contains(e)};e.prototype=Object.create(DTNode.prototype),e.prototype.constructor=e,extend(e.prototype,{isEmpty:function(){return this.end-this.start==1;},getParaBorderFormats:function(){return this.getParaStyles()[ATTR_COMMON.BORDERS]||{}},getParaSpacingFormats:function(){return{before:this.getParaStyles()[ATTR_PARAGRAPH.PS_SB]||"0px",after:this.getParaStyles()[ATTR_PARAGRAPH.PS_SA]||"0px"}},setParentRemoveStatus:function(e){this.parentSetToRemove=e},setParentRemoveStatusToChildren:function(e){},setParaStyles:function(){var e=editor.doc.getComputedFormatAt(this.getEndIndex(),NODE_TYPE.PARAGRAPH,null,this);e.dir||(e.dir=PARA_DIR.LTR),this.computedFormat=e},getParaStyles:function(){return this.computedFormat},getParaProperties:function(){return this.paraProperties},getListData:function(){return this.getParaProperties().listData},getListObj:function(){return editor.doc.getListObj(this.getListData().id)},getListLevel:function(){var e=this.getListData(),t=this.getListObj();return t?t["level"+e.listLevel]:{}},getListBulletObj:function(e){if(!e){var t=this.getListLevel(),i=t.hasOwnProperty(ATTR_PARAGRAPH.BULLET_ID);if(!i)return null;e=t.bullet_id}return editor.doc.getListBulletObj(e)},getViewProperties:function(){return this.viewProperties},getBackgroundColor:function(){return this.getParaStyles().bgc||""},getPaddingLeft:function(){return this.getParaStyles()[ATTR_PARAGRAPH.PS_PL]},getTextIndent:function(){return this.getParaStyles()[ATTR_PARAGRAPH.PS_TI]},getMarginLeft:function(){return this.getParaStyles()[ATTR_PARAGRAPH.PS_ML]},getMarginRight:function(){return this.getParaStyles()[ATTR_PARAGRAPH.PS_MR]},getFloatImagesInfo:function(){return this.getViewProperties().floatImages},setParaProperties:function(){var e=this.getParaStyles(),t=0;e&&e.hasOwnProperty(ATTR_PARAGRAPH.PS_AL)&&(t=e[ATTR_PARAGRAPH.PS_AL]),t=parseInt(t||"0",10),this.paraProperties=this.paraProperties||{};var i=DocUtil.copyStyle(e[ATTR_PARAGRAPH.PS_TS]);for(var n in i)i.hasOwnProperty(n)&&i[n]||delete i[n];extend(this.paraProperties,{textFormat:i,isList:!1,isHeadingList:!1,listData:null,lineHeight:e&&e[ATTR_PARAGRAPH.PS_LS]||1.2,spaceBeforeParagraph:(e&&e[ATTR_PARAGRAPH.PS_SB]||"0").convertor().pixels,spaceAfterParagraph:(e&&e[ATTR_PARAGRAPH.PS_SA]||"0").convertor().pixels,align:t,pageBreakBefore:e[ATTR_PARAGRAPH.EN_PB]||!1,keepNext:e[ATTR_PARAGRAPH.EN_KN]||!1,linesTogether:e[ATTR_PARAGRAPH.EN_BL]||!1,widowsOrphan:e[ATTR_PARAGRAPH.EN_WO]||!1,level:parseInt(e&&e[ATTR_PARAGRAPH.PS_HD]||"0",10)});var r=e&&e[ATTR_PARAGRAPH.PS_LINE_RULE];"exact"!=r&&"atLeast"!=r||(this.paraProperties.lineHeight=1.2);var o=e.ls_data;o&&o.hasOwnProperty("id")&&(this.paraProperties.listData={id:o.id},this.paraProperties.isList=!0)},setListProperties:function(e){var t,i,n,r,o,a,s,l,d,c,u,g=this.section.lists,h=e.ls_data,f=!1,p=!1;this.section.doc.listCollections;this.paraProperties.listData=this.paraProperties.listData||{},t=this.paraProperties.listData;var E;if(this.paraProperties.isList=!0,this.isHeading()){var T=editor.doc.getListObj(h.id),O=T.level0.htype;O&&(this.paraProperties.isHeadingList=!0)}extend(this.paraProperties.listData,{id:parseInt(h.id),listLevel:parseInt(h.l)}),g[h.id]||(g[h.id]=[],g[h.id].push(this)),n=g[h.id];for(var m,I,D=this.section.doc.getAllSectionWithListId(h.id),c=0;c<D.length&&(I=D[c],!(I.getIndex()>=this.section.getIndex()));c++){var m=I.lists[h.id];m&&(E=m[m.length-1])}for(s=this.getIndex(),c=0,u=n.length;c<u;c++){if(r=n[c],r.id==this.id){f=!0,l=c+1;break}if(r.getIndex()>s){f=!0,p=!0,n.splice(c,0,this),l=c+1;break}}f||(n.push(this),l=n.length);var R=l-1,S={},C=t.listLevel,A=C;if(E||1!=n.length&&0!=R){var E=0===R?E:n[R-1],v=DocUtil.copyStyle(E.paraProperties.listData),_=v.levelInfo;if(A=v.listLevel,C==A)S=_,S["level"+C]=S["level"+C]+1;else if(C>A){var P=A+1;for(S=_;P<=C;)S["level"+P]=editor.doc.getListStartingNo(this.paraProperties.listData.id,P),P+=1}else if(C<A){var P=A;for(S=_;P>C;)delete S["level"+P],P--;P==C&&(S["level"+P]=S["level"+P]+1)}}else for(var N=0;N<=t.listLevel;)S["level"+N]=editor.doc.getListStartingNo(this.paraProperties.listData.id,N),N+=1;this.paraProperties.listData.levelInfo=S,a=editor.doc.getListType(h.id,h.l);var b=DocUtil.copyStyle(t);d=editor.doc.getListObj(b.id);var L,w=d["level"+C],y=w&&w.hasOwnProperty(ATTR_PARAGRAPH.BULLET_ID),M=-1;y&&(M=w.bullet_id,L=editor.doc.getListBulletObj(M));var F={};if(this.isImageList())if(o="",e.ls_data.hasOwnProperty(ATTR_PARAGRAPH.BULLET_ID)&&w.hasOwnProperty(ATTR_PARAGRAPH.CUST_DATA)){var U=w[ATTR_PARAGRAPH.CUST_DATA];ListUtils.handleImageCopyForCheckList(U);var V=editor.doc.getListBulletObj(e.ls_data.bullet_id);this.isSvgImageList()&&("undefined"==typeof ListUtils.getSVGImgIds(V.svg_id)&&ListUtils.setSVGImgIds(V.svg_id,e.ls_data.bullet_id),F.svg_id=V.svg_id),F.src=V&&V.img&&V.img.src}else F.src=L.img.src,ImageCache.loadImageForCopy(F.src),this.isSvgImageList()&&(F.svg_id=L.svg_id,"undefined"==typeof ListUtils.getSVGImgIds(L.svg_id)&&ListUtils.setSVGImgIds(L.svg_id,M));else if(this.isSymbolList())o=L.c;else{var B=DTUtils.getListNumber(this,b,C);b.levelInfo=S=B,o=ListUtils.getListNumber(a,B["level"+C],b)}if(extend(this.paraProperties.listData,{listType:a,levelInfo:S,listNumberString:o,listImageData:F}),0==i){var u=g[i].length;g[i][u-1].getIndex()==this.getIndex()&&0==i&&i!=h.id&&delete this.section.lists[i]}this.section.doc.updateListCollection(h.id,this)},resetListProperties:function(e){var t,i,n,r=this.section.lists,o=r[e]||[];for(i=0,n=o.length;i<n;i++)if(t=o[i],t.id==this.id){o.splice(i,1);break}o.length||(delete this.section.lists[e],this.section.doc.removeSectionFromListCollection(e,this.section.id)),this.paraProperties.isList=!1,this.paraProperties.isHeadingList=!1,this.paraProperties.listData=null},getTabIndexForListNumbering:function(e,t){for(var i=[t],n=Math.floor(t/48)+1,r=0;r<=10;)i.push(48*n++),r++;for(var o,a=0,s=0;o=i[s++];)if(e<=o){a=s;break}return a},updateProperties:function(e){this.prevProperties=clone(this.paraProperties),this.format=editor.doc.getRawFormatAt(this.getEndIndex()),this.setParaStyles();var t=this.getParaStyles();if(!e){if(this.borderProperties=clone(DTUtils.getBorderSize(t)),this.prevProperties&&this.prevProperties.isList){var i=this.prevProperties.listData.id,n=t.ls_data&&void 0!==t.ls_data.id?t.ls_data.id:-1;n!=i&&(this.resetListProperties(i),this.section.doc.updateAllListItemsFromCurrentList(i,this))}this.setParaProperties()}this.viewProperties=this.viewProperties||{}},updateListData:function(){var e=this.getParaStyles(),t=!!e.ls_data;t&&this.setListProperties(e),this.prevProperties&&this.prevProperties.isList&&!t&&this.resetListProperties(this.prevProperties.listData.id)},updatelist:function(){this.prevViewProperties=clone(this.viewProperties),this.update()},getMarginProperties:function(e){var t=0,i=0,n=DTUtils.getBorderSize(e);return t+=n[ATTR_BORDERS.BORDER_LEFT]+n[ATTR_BORDERS.BORDER_RIGHT],i+=n[ATTR_BORDERS.BORDER_TOP]+n[ATTR_BORDERS.BORDER_BOTTOM],t+=e[ATTR_IMAGE.I_ML]&&e[ATTR_IMAGE.I_ML].convertor().pixels||0,t+=e[ATTR_IMAGE.I_MR]&&e[ATTR_IMAGE.I_MR].convertor().pixels||0,i+=e[ATTR_IMAGE.I_MT]&&e[ATTR_IMAGE.I_MT].convertor().pixels||0,i+=e[ATTR_IMAGE.I_MB]&&e[ATTR_IMAGE.I_MB].convertor().pixels||0,{width:t,height:i}},applyShapeMarginProperty:function(e,t){var i=clone(e),n=parseInt(t.height),r=parseInt(t.width),o=i.hasOwnProperty(ATTR_IMAGE.I_MT)&&i[ATTR_IMAGE.I_MT].convertor().pixels||0,a=i.hasOwnProperty(ATTR_IMAGE.I_MB)&&i[ATTR_IMAGE.I_MB].convertor().pixels||0,s=i.hasOwnProperty(ATTR_IMAGE.I_ML)&&i[ATTR_IMAGE.I_ML].convertor().pixels||0,l=i.hasOwnProperty(ATTR_IMAGE.I_MR)&&i[ATTR_IMAGE.I_MR].convertor().pixels||0;return r+=l+s,n+=o+a,0!=o&&0!=a?t.top-=o:0!=o&&(t.top-=o),0!=s&&0!=l?t.left-=s:0!=s&&(t.left-=s),{top:t.top,left:t.left,height:n,width:r}},getImageProperties:function(e,t){PubSub.publish("Document/ImageBlockConstructed",e);var i,n,r,o=this.getMarginProperties(e),a=parseFloat(e[ATTR_IMAGE.I_CALC_WID]||e[ATTR_IMAGE.I_WID]||0),s=parseFloat(e[ATTR_IMAGE.I_HT]||0),l=e[ATTR_IMAGE.I_WRAP_TYPE],d=this.getSection().doc,c=d.getWidthFromSectionNode(d.getFirstContentSection()),u=e[ATTR_COMMON.BORDERS]&&e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]?2*parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]):0;if("front"==l||"behind"==l)return emptyDimension;if(isV8Engine||(r=window.frames.metricsFrame.document.getElementById("zwImgSpan")),e[ATTR_IMAGE.I_SRC]&&(!a||!s||100==a&&"%"==e[ATTR_IMAGE.I_WID_UN]&&!e[ATTR_IMAGE.I_CALC_WID]||100==s&&"%"==e[ATTR_IMAGE.I_WID_UN])){if(!isV8Engine){i=document.createElement("img"),i=J(i);var n=DomUtil.processImgSrc(imgCdnZWStaticPath+fingerPrintObj["images/shape-obj.png"]);i.attr("src",n),r.innerHTML="",J(r).append(i),a=i.width(),s=i.height()}isHeadlessHTML||(this.section.unknownImages[t]={index:t,src:e.src,para:this})}else if(100===a&&"%"==e[ATTR_IMAGE.I_WID_UN]&&!isV8Engine){var g=d.getWidthFromNode(d.getFirstContentSection());i=document.createElement("img"),n=DomUtil.processImgSrc(e.src),i=J(i),i.attr("src",n),r.innerHTML="",J(r).append(i),a=g;var h=i.height(),f=i.width();0!=h&&0!=f&&(s=e[ATTR_IMAGE.I_HT]=Math.round(h*g/f))}var p=parseFloat(e[ATTR_IMAGE.I_H_POSITION]&&e[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]||0),E=p<0?p:0;if(E+a>c&&(a=c),e&&e.hasOwnProperty(ATTR_IMAGE.I_ROTATE)){var T=TransformationUtils.getTransformedSize(e[ATTR_IMAGE.I_ROTATE],a,s);a=T.width,s=T.height,e.rot_ht=T.height,e.rot_width=T.width,editor.doc.setFormatAt(t,e)}return DTUtils.isFloatingImage(e)&&(s+=o.height,a+=o.width),dimension(a+u,s+u)},getAutoFieldValue:function(e,t){var i="";if(e.indexOf(AUTOFIELD_TYPE.AUTO_DATE)!=-1)i=ZWDate.getDateString(t);else if(e.indexOf(AUTOFIELD_TYPE.AUTO_DOCNAME)!=-1){var n=editor.doc.docInfo.DOCUMENT_NAME;i=Utils.encodeHTMLString(n.replaceAll(new RegExp("["+DOC_INVISIBLE_CHARS+"]","g"),""))}else e.indexOf(AUTOFIELD_TYPE.AUTO_DOCVERSION)!=-1?i=t.isauto?editor.doc.docInfo.DOCS_VERSION:t.val:e.indexOf(AUTOFIELD_TYPE.AUTO_AUTHOR)!=-1?i=editor.doc.docInfo.CREATOR_HTML:e.indexOf(AUTOFIELD_TYPE.AUTO_FORMULA)!=-1?i=Formula.calculate(t,this):e.indexOf(AUTOFIELD_TYPE.AUTO_LAST_MOD)!=-1?i=editor.doc.docInfo.LAST_MODIFIED_TIME_LONG:e.indexOf(AUTOFIELD_TYPE.AUTO_CREATED_MOD)!=-1&&(i=editor.doc.docInfo.CREATED_DATE_LONG);return i},clearChildren:function(){for(var e,t=0,i=this.children.length;t<i;t++)e=this.children[t],e.prev=e.next=e.parent=e.section=null,delete this.section.nodes[e.id];this.children.splice(0,this.children.length)},hasWaterMark:function(){return this.viewProperties.watermark.length>0},hasChart:function(){return this.viewProperties.chart.length>0},getParasWithChart:function(){var e=[];return this.hasChart()&&(e[0]=this),e},getWatermarkData:function(){return this.viewProperties.watermark},buildSegments:function(){this.clearChildren();var e,t,i,n,r,o,a,s,l=[],d=this.getIndex(),c=this.getEndIndex(),u=!1,g={formula:!1,docName:!1,docAuthor:!1,docVersion:!1};for(extend(this.viewProperties,{inlineImages:[],floatImages:[],chart:[],fields:{},watermark:null}),e=d;e<c;e++){if(n=editor.doc.getRawFormatAt(e),t=editor.doc.getCharAt(e),t==UNICODE.RANGE_START&&n&&("endnote"==n.type||"footnote"==n.type)){var h=DocTreeManager.getSectionWithSid(n.id||n.sid);h&&(h.setRangeIndex(e+1-d),h.setContainingParaNode(this))}if(t==UNICODE.IMAGE){if(n&&n.hasOwnProperty(ATTR_IMAGE.WM_INFO)&&(this.viewProperties.watermark={index:e-d,formats:n}),n&&n.hasOwnProperty("chartDetails")&&this.viewProperties.chart.push(n.id),n&&"textbox"==n.subType){DocTreeManager.getSectionWithSid(n.id||n.sid)}s=this.getImageProperties(n,e),o=n[ATTR_IMAGE.I_WRAP_TYPE],a=!(!n[ATTR_COMMON.ST]||"digisign-field"!==n[ATTR_COMMON.ST]);!!n.chartDetails;a?(s=dimension(s.width+2,s.height),u=!0):(o&&ZWArrayUtils.arrayContains(["square","front","behind"],o)?(DocTreeManager.isImagePreviewEnabled()&&DocUtils.isImage(n)&&(s.height=0,s.width=0),n.fid||(n.fid=Utils.randomString()),editor.doc.setFormatAt(e,n),this.viewProperties.floatImages.push({height:s.height,width:s.width,align:o,index:e-d,fid:n.fid,id:n.id,top:n.top,left:n.left,src:n.src,subType:n.subType,tc:n.tc,parentId:this.id,isShape:!1,shapeData:null,wrapType:n.wrapType,positionV:n.positionV,positionH:n.positionH,formats:n,renderingFormat:this.constructImageRenderingFormat(n)}),s=emptyDimension):(this.viewProperties.inlineImages.push({index:e-d,height:s.height}),s=dimension(s.width,0)),u=!0)}else if(t==UNICODE.RANGE_START&&"autofield"==n.type)if("autoformula"==n.ftype)this.handleTableRangeStart(e,n),g.formula=!0;else{var f=n[ATTR_COMMON.ID];this.viewProperties.fields[f]={},"autodocname"==n.ftype?(this.viewProperties.fields[f].value=this.getAutoFieldValue(n.ftype),g.docName=!0):"autoauthor"==n.ftype?(this.viewProperties.fields[f].value=this.getAutoFieldValue(n.ftype),g.docAuthor=!0):"autodocversion"==n.ftype&&(this.viewProperties.fields[f].value=this.getAutoFieldValue(n.ftype,n),g.docVersion=!0)}else t!=UNICODE.RANGE_START||"fillablefield"!=n.type&&"signerfield"!=n.type&&"mergeField"!=n.type||!n.wrapType||(s=this.getImageProperties(n,e),o=n[ATTR_IMAGE.I_WRAP_TYPE],n.fid||(n.fid=Utils.randomString()),editor.doc.setFormatAt(e,n),this.viewProperties.floatImages.push({height:s.height,width:s.width,align:o,index:e-d,fid:n.fid,id:n.id,top:n.top,left:n.left,subType:n.subType,tc:n.tc,parentId:this.id,isShape:!1,isFillableField:!0,shapeData:null,wrapType:n.wrapType,positionV:n.positionV,positionH:n.positionH,formats:n,renderingFormat:this.constructImageRenderingFormat(n)}));if(!ZWJSONUtils.isEmptyObject(n)){i=n[ATTR_COMMON.CLS];var f=n&&n.hasOwnProperty(ATTR_COMMON.FIELDINFO)?n[ATTR_COMMON.FIELDINFO]:null;if(i&&f&&t!=UNICODE.RANGE_START){var p=new RegExp(CONT_REGEXP.AUTOFIELD_WITHOUT_PAGENO_COUNT);if(p.test(i))t=this.handleAutoFieldWithOutPgCount(e,t,i,f,g,p);else if(i.indexOf(CONST.NEXTRECORD)!=-1){var E=editor.doc.getRawFormatAt(e-1);t=UNICODE.MERGEFIELD_START+E[MAILMERGE.MMINFO][MAILMERGE.FIELD_NAME]+UNICODE.MERGEFIELD_END,this.viewProperties.fields[f]=t}}if(r){var T=new(DTNode.types[this.getSegmentType(r)])(r-d,e-d,this);this.addChild(T);var O=editor.doc.getContent(r,e);l.push(new DTSegment(r-d,e-d,!1,T.format,O,{},T.type))}r=e}}if(r){var T=new(DTNode.types[this.getSegmentType(r)])(r-d,e-d,this);this.addChild(T);var O=editor.doc.getContent(r,c);l.push(new DTSegment(r-d,c-d,!1,T.format,O,{},T.type))}if(this.isCode()){var m=this.getCodeLanguage();this.codeSegments=ZWPR.prettyTokens(editor.doc.getContent(d,c),m)}this.segments=l},getSegmentType:function(e){var t=NODE_TYPE.RUN,i=editor.doc.getRawFormatAt(e),n=editor.doc.getCharAt(e);return i.type===NODE_TYPE.TEXT?t=NODE_TYPE.TEXT:i.type===NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR?t=NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR:n===UNICODE.RANGE_START?t=NODE_TYPE.FIELD_START:n===UNICODE.RANGE_END?t=NODE_TYPE.FIELD_END:n===UNICODE.IMAGE?t=NODE_TYPE.IMAGE:n===UNICODE.BR?t=NODE_TYPE.BR:n===UNICODE.TAB&&(t=NODE_TYPE.TAB),t},updateFormatForTC:function(e,t){TcView.isHiddenBlock(e,t)&&(t[ATTR_TEXT.TS_SIZE]=0)},constructImageRenderingFormat:function(e){var t={};if(e){t.margins={top:e.mt,right:e.mr,bottom:e.mb,left:e.ml},t.margins=DTUtils.convertJSONUnitTo(t.margins,UNITS.PIXELS);var i=e.borders;if(i){t.borders={};var n;for(var r in i)n=i[r]||{},t.borders[r]=(n.width||"0px").convertor().pixels}isV8Engine?t.drawInfo=DrawInfoManager.getImageRectArray(e):t.drawInfo={}}return t},buildBlocks:function(){var e,i,n,r,o,a,s,l,d,c,u,g,h,f,p,E,T,O,m,I=[],D=FontUtils.getWord(),R=this.getIndex(),S=this.getEndIndex(),C=this.getParaStyles().textFormat,A="",v={},_=!1,P=!1,N=!1,b=Utils.getWordBreakIndex(R,S),L=R,w=[],y=!1,M=!1,F="",U=!1,V={},B=[],x=editor.doc.getTrackChangeDetails().getDisplayMode(),W={},H=!1,G=!1,k=new RegExp(CONT_REGEXP.NONEDITABLE_BLOCK_FIELDS),Y=this.isCode(),Z={},z={formula:!1,docName:!1,docAuthor:!1,docVersion:!1};this.hasRTLContent=!1;var J=null;for(e=0,g=b.length;e<g;e++){u=b[e],v={},V={},V[L-R]=W||{},D.clear(),N=!1,G&&(H=!0);var j,X=[];for(i=L;i<u;i++){if(y=!1,n=editor.doc.getCharAt(i),j=DTUtils.computeCharTypeAtIndex(i),X.push(j),t(j)&&(this.hasRTLContent=!0),r=editor.doc.getRawFormatAt(i)||{},r&&!ZWJSONUtils.isEmptyObject(r)){var K=this.section.doc.getComputedFormatAt(i,NODE_TYPE.TEXT,this.getHeadingType())||{};Y&&(m=this.format.code,Z={fgc:m.t_fgc,bgc:m.p_bgc},r.fgc||(K.fgc=m.t_fgc),r.bgc||(K.bgc=m.p_bgc)),r=clone(K),TcView.isHiddenBlock(i,r)&&(r[ATTR_TEXT.TS_SIZE]=0),r.hasOwnProperty(TCConstants.TC)&&(r=TcViewUtil.getTcDomStyles(r)),ZWJSONUtils.isEmptyObject(J)||ZWJSONUtils.mergeJsonObjs(r,J),ZWJSONUtils.compareJSON(r,W)||(V[i-R]=r)}if(o=(r&&r[ATTR_COMMON.CLS]||"").toLowerCase(),l=ZWJSONUtils.isEmptyObject(r),W&&CHECKBOXES_AND_RADIO_FIELDS.contains(W.ffType)&&(r[ATTR_TEXT.TS_FF]=RENDERING_FONTS.CHECKBOXES_AND_RADIO_FIELDS),A=r&&!l?FontUtils.getFontString(r,C):A,r&&r[ATTR_TEXT.TS_VA]&&("super"===r[ATTR_TEXT.TS_VA]||"sub"===r[ATTR_TEXT.TS_VA])){var Q=editor.doc.getRawFormatAt(i);Q[ATTR_TEXT.TS_SIZE]=r[ATTR_TEXT.TS_SIZE]}if(n===UNICODE.RANGE_START||n===UNICODE.RANGE_END)if(a=dimension(0,0),n==UNICODE.RANGE_START)if(k.test(r.type)&&(G=!0),c=BLOCK_TYPE.TEXT,"endnote"==r.type||"footnote"==r.type){var q=DocTreeManager.getSectionWithSid(r.id||r.sid);q.setRangeIndex(i+1-R),q.setContainingParaNode(this)}else if("bookmark"==r.type&&r.id.indexOf("toc_")==-1)editor.bookmarks[r.id]={name:r.name};else if(r.type==NODE_TYPE.SIGNERFIELD)_=!0,r.hasOwnProperty(ATTR_IMAGE.I_WRAP_TYPE)&&(r.fid||(r.fid=Utils.randomString()),editor.doc.setFormatAt(i,r));else if(r.type==NODE_TYPE.MAILMERGEFIELD)P=!0;else if("conditional_if_start"==r.type||"conditional_else_seperator"==r.type||"conditional_if_end"==r.type)"conditional_if_start"!=r.type||editor.conditionalFields.contains(r.id)||editor.conditionalFields.push(r.id);else if("autofield"==r.type){var $=r[ATTR_COMMON.ID];if(this.viewProperties.fields[$]={},"autoformula"==r.ftype){var ee=r[ATTR_AUTOFIELD.FORMULA],te=Formula.getFormulaFormat(ee);te&&(te.index=i-this.getIndex(),this.viewProperties.fields[$].formula=te),z.formula=!0}else"autodocname"==r.ftype?(this.viewProperties.fields[$].value=this.getAutoFieldValue(r.ftype),z.docName=!0):"autoauthor"==r.ftype?(this.viewProperties.fields[$].value=this.getAutoFieldValue(r.ftype),z.docAuthor=!0):"autodocversion"==r.ftype&&(this.viewProperties.fields[$].value=this.getAutoFieldValue(r.ftype,r),z.docVersion=!0)}else if(r.type==NODE_TYPE.FILLABLEFIELD){M=!0;var ie=Utils.getFillableFieldValue(r);F=" "!=ie||r[ATTR_FILLABLEFIELD.FF_NAME]?ie:""}else r[ATTR_CUSTOM.DISPLAY_TYPE]===DISPLAY_TYPE.BUTTON&&(J=r[ATTR_CUSTOM.DISPLAY_STYLE]);else n==UNICODE.RANGE_END&&(k.test(r.type)&&(G=!1,H=!1),c=BLOCK_TYPE.TEXT,"conditional_if_end"!=r.type&&(M=!1,F="",_=!1,U=!1,J=null));else if(n==UNICODE.FIELD_SEPARATOR)N=!0,c=BLOCK_TYPE.FIELD_SEPARATOR,a=ZWJSONUtils.clone(isV8Engine?getTextMetrics(CONDITIONAL_FIELD.ELSE,{"font-weight":0,"font-size":"11pt","font-family":"TeXGyreCursor","letter-spacing":0}):FontUtils.getCharSize(CONDITIONAL_FIELD.ELSE,CONDITIONAL_FIELD.FONT_STRING)),a.width+=10,a.height+=4;else if(n==UNICODE.TAB){if(l){r={st:"tab",type:"text"},editor.doc.setFormatAt(i,r);var ne=new RegExp(CONT_REGEXP.PORTION_END,"g");!ne.test(editor.doc.getCharAt(i+1))&&ZWJSONUtils.isEmptyObject(editor.doc.getRawFormatAt(i+1))&&editor.doc.setFormatAt(i+1,{type:"text"}),l=!1}a={width:0,height:0},N=!0,c=BLOCK_TYPE.TAB}else if(n==UNICODE.IMAGE){if(a=this.getImageProperties(r,i),r&&r.subType===SECTION_TYPES.TEXTBOX){var re=DocTreeManager.getSectionWithSid(r.id||r.sid);re.setRangeIndex(i-R);var oe=r[ATTR_CELL.TDS_PL]?parseFloat(r[ATTR_CELL.TDS_PL].convertor().pixels):0,ae=r[ATTR_CELL.TDS_PR]?parseFloat(r[ATTR_CELL.TDS_PR].convertor().pixels):0;re.width=r.wid-oe-ae,re.setContainingParaNode(this)}N=!0,s=r[ATTR_IMAGE.I_WRAP_TYPE],d=!(!r[ATTR_COMMON.ST]||"digisign-field"!==r[ATTR_COMMON.ST]),d?(a=dimension(a.width+2,a.height),N=!0,c=BLOCK_TYPE.DIGISIGN):(s&&ZWArrayUtils.arrayContains(["square","front","behind"],s)&&(DocTreeManager.isImagePreviewEnabled()&&DocUtils.isImage(r)&&(a.height=0,a.width=0),r.fid||(r.fid=Utils.randomString()),editor.doc.setFormatAt(i,r),a=emptyDimension),a=dimension(a.width,0),N=!0,c=BLOCK_TYPE.IMAGE)}else if(n==UNICODE.BR)a=dimension(0,0),N=!0,c=BLOCK_TYPE.BR;else{var $=r&&r.hasOwnProperty(ATTR_COMMON.FIELDINFO)?r[ATTR_COMMON.FIELDINFO]:null;if(o&&$&&n!=UNICODE.RANGE_START){var se=new RegExp(CONT_REGEXP.AUTOFIELD_WITHOUT_PAGENO_COUNT);if(se.test(o))n=this.handleAutoFieldWithOutPgCount(i,n,o,$,z,se);else if(o.indexOf(CONST.NEXTRECORD)!=-1){var le=editor.doc.getRawFormatAt(i-1);n=UNICODE.MERGEFIELD_START+le[MAILMERGE.MMINFO][MAILMERGE.FIELD_NAME]+UNICODE.MERGEFIELD_END,this.viewProperties.fields[$]=n}}var de=!1;x!==TCConstants.ALL_MARKUP_VIEW&&r[TCConstants.TC]&&(de=TcView.isCharSizeZero(r))," "==n&&(y=!0,n=isV8Engine||FontUtils.isCanvasSupported()?" ":"&nbsp;"),U=!(!W[ATTR_FILLABLEFIELD.FF_INFO]||W[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]!==FILLABLEFIELD_TYPE.CURRENCY),c=BLOCK_TYPE.TEXT}var ce=new RegExp(AUTOFIELD_TYPE.AUTO_DATE),ue=i-R;if(Utils.isSpaceChar(n)||o&&ce.test(o)&&"#"==n){if(D.isEmpty()||(f=D.getBlock(V,{isSpecialBlock:N,type:c,isNonEditableBlock:H,types:X,parent:this,displayStyle:J}),isV8Engine&&!f.isMetricsFilled&&B.push(f),I.push(f)),D.clear(),v[ue]=A,N){Ee=editor.doc.getContent(R+ue,R+ue+1);var ge={},he=0;Ee===UNICODE.IMAGE&&(he=a.height||0,isV8Engine&&(ge=this.constructImageRenderingFormat(r))),f=new LineBlock(ue,ue+1,Ee,a.width,a.height,he,v,V,J,N,!0,c,H,ge,X,this),I.push(f)}else D.addChar(n,ue,A,a),f=D.getBlock(V,{isSpecialBlock:N,type:c,isNonEditableBlock:H,types:X,parent:this,displayStyle:J}),isV8Engine&&!f.isMetricsFilled&&B.push(f),I.push(f);D.clear()}else if(y&&_&&DTUtils.isEmptySignerField(R+ue)){D.clear(),v[ue]=A;var fe=W&&W.hasOwnProperty(ATTR_IMAGE.I_HT)?Math.round(W[ATTR_IMAGE.I_HT]):0,pe=W&&W.hasOwnProperty(ATTR_IMAGE.I_WID)?Math.round(W[ATTR_IMAGE.I_WID]):0;W.hasOwnProperty(ATTR_IMAGE.I_WRAP_TYPE)&&(pe=0);var Ee=editor.doc.getContent(R+ue,R+ue+1);I.push(new LineBlock(ue,ue+1,Ee,pe,fe,0,v,V,J,N,!1,c,H,{},X,this)),D.clear()}else if((y||U)&&M&&!F){U&&(f=D.getBlock(V,{isSpecialBlock:N,type:c,isNonEditableBlock:H,types:X,parent:this,displayStyle:J}),isV8Engine&&!f.isMetricsFilled&&B.push(f),I.push(f)),D.clear(),v[ue]=A;var Te=W&&"fillablefield"==W.type,Oe=Te&&W.hasOwnProperty(ATTR_IMAGE.I_HT)?Math.round(W[ATTR_IMAGE.I_HT]):DTUtils.getFillableFieldHeight(V[ue],W),pe=Te&&W.hasOwnProperty(ATTR_IMAGE.I_WID)?W.hasOwnProperty(ATTR_IMAGE.I_WRAP_TYPE)?0:Math.round(W[ATTR_IMAGE.I_WID]):DTUtils.getFillableFieldWidth(r,C,W),me=U&&"string"==typeof n?n.length:1,Ee=editor.doc.getContent(R+ue,R+ue+me);I.push(new LineBlock(ue,ue+1,Ee,pe,Oe,0,v,V,J,N,!1,c,H,{},X,this)),W.hasOwnProperty(ATTR_IMAGE.I_WRAP_TYPE)&&(pe=0,Oe=0),D.clear()}else if(U||!M||F||n===UNICODE.RANGE_START||n===UNICODE.RANGE_END)D.addChar(n,ue,A,a);else{D.clear(),v[ue]=A;var me="string"==typeof n?n.length:1,Oe=Math.round((V[ue]&&V[ue].size||12)*(19/12)),Ee=editor.doc.getContent(R+ue,R+ue+me);I.push(new LineBlock(ue,ue+1,Ee,0,Oe,0,v,V,J,N,!1,c,H,{},X,this)),W.hasOwnProperty(ATTR_IMAGE.I_WRAP_TYPE)&&(pe=0,Oe=0),D.clear()}if(p=void 0,E=0,!l&&r&&!E){if(h){var Ie=editor.doc.getRawFormatAt(h),De=editor.doc.getRawFormatAt(h-1);De&&CHECKBOXES_AND_RADIO_FIELDS.contains(De.ffType)&&(Ie[ATTR_TEXT.TS_FF]=RENDERING_FONTS.CHECKBOXES_AND_RADIO_FIELDS);var Re=editor.doc.getContent(h,i),O=!1,T=editor.doc.getComputedFormatAt(h,NODE_TYPE.TEXT,this.getHeadingType())||{};this.updateFormatForTC(h,T),p=new DTSegment(h-R,i-R,O,Ie,Re,T)}h=i,E=1}p&&w.push(p),ZWJSONUtils.isEmptyObject(r)||(W=r)}if(L=u,!D.isEmpty())if(N){var Ee=editor.doc.getContent(R+ue,R+ue+1);ge={},he=0,Ee===UNICODE.IMAGE&&(he=a.height||0,ge=this.constructImageRenderingFormat(r)),f=new LineBlock(ue,ue+1,Ee,a.width,a.height,0,v,V,J,N,!0,c,H,ge,[DTUtils.computeCharTypeAtIndex(R+ue)],this),I.push(f),D.clear()}else f=D.getBlock(V,{isSpecialBlock:N,type:c,isNonEditableBlock:H,types:X,parent:this,displayStyle:J}),isV8Engine&&!f.isMetricsFilled&&B.push(f),this.postProcessTempBlock(f,R,T,M,_,P),I.push(f)}if(h){var Ie=editor.doc.getRawFormatAt(h),Re=editor.doc.getContent(h,S),T=editor.doc.getComputedFormatAt(h,NODE_TYPE.TEXT,this.getHeadingType())||{},O=!1;this.updateFormatForTC(h,T),w.push(new DTSegment(h-R,S-R,O,Ie,Re,T))}if(this.segments=w,this.codeSegments=[],this.isCode()){var Se=this.getCodeLanguage();this.codeSegments=ZWPR.prettyTokens(editor.doc.getContent(R,S),Se)}for(var Ce,e=this.segments.length-1;e>=0;e--)if(this.segments[e].format&&"text"==this.segments[e].format.type){Ce=this.segments[e];break}var Ae=Ce&&Ce.format||this.paraProperties.textFormat||{},ve=FontUtils.getFontString(Ae,this.getParaStyles().textFormat),_e=isV8Engine?getTextMetrics(" ",ZWJSONUtils.mergeJsonObjs(ZWJSONUtils.clone(Ae),this.getParaStyles().textFormat)).height:FontUtils.getCharSize(" ",ve).height;a=dimension(CONST_VIEW.EOP_WIDTH,_e);var Pe=new LineBlock(S-R,S-R,"",a.width,a.height,0,"",{},J,!0,!1,BLOCK_TYPE.EOP,H,{},[CHARACTER_TYPES.B],this);return I.push(Pe),isV8Engine&&!Pe.isMetricsFilled&&B.push(Pe),w.push(new DTSegment(S-R,S-R,O,{},"",{},"EOP")),{blocks:I,nonMertricsBlocks:B}},postProcessTempBlock:function(e,t){var i=RANGE_CHARS_REGEX;i.lastIndex=0;for(var n=e.start+t,r=e.end+t,o=editor.doc.getContent(n,r),a=i.exec(o);null!=a;){var s=o.charAt(a.index),l=a.index+e.start+t,d=editor.doc.getRawFormatAt(l);if(s==UNICODE.RANGE_START&&d){if(("conditional_if_start"==d.type||"conditional_else_seperator"==d.type||"conditional_if_end"==d.type)&&!RangeCollection.isConditionToggled(d.id)){var c=ZWJSONUtils.clone(isV8Engine?getTextMetrics(CONDITIONAL_FIELD.IF_START,{"font-weight":0,"font-size":"11pt","font-family":"TeXGyreCursor","letter-spacing":0}):FontUtils.getCharSize(CONDITIONAL_FIELD.IF_START,CONDITIONAL_FIELD.FONT_STRING)),u=13;c.width+=10,editor.getRole().permissions.can("document.edit")&&(c.width+=u),c.height+=4,e.width+=c.width,e.originalWidth+=c.width,e.height=Math.max(e.height,c.height)}}else if(d&&"conditional_if_end"==d.type&&!RangeCollection.isConditionToggled(d.id)){var c=ZWJSONUtils.clone(isV8Engine?getTextMetrics(CONDITIONAL_FIELD.IF_END,{"font-weight":0,"font-size":"11pt","font-family":"TeXGyreCursor","letter-spacing":0}):FontUtils.getCharSize(CONDITIONAL_FIELD.IF_END,CONDITIONAL_FIELD.FONT_STRING));c.width+=10,c.height+=4,e.width+=c.width,e.originalWidth+=c.width,e.height=Math.max(e.height,c.height)}a=i.exec(o)}},create:function(){this.updateListData(),this.section.updateHeadingsNodes(this,"add"),PubSub.publish("Para/Create",this)},update:function(){this.updateProperties(!1),this.updateListData(),this.section.updateHeadingsNodes(this,"modify"),PubSub.publish("Para/Update",this)},modify:function(){var e=!0;this.updateListData(),this.updateProperties(e),this.section.updateHeadingsNodes(this,"modify"),PubSub.publish("Para/Modify",this)},remove:function(){if(this.isList()){var e=this.format.ls_data.id;this.resetListProperties(e)}this.section.updateHeadingsNodes(this,"remove"),PubSub.publish("Para/Remove",this)},destroy:function(){this.prev=this.next=this.parent=null,this.clearChildren(),delete this.section.nodes[this.id]},content:function(){var e=this.parent.getIndex(),t=e+this.start,i=e+this.end;return editor.doc.getContent(t,i)},getHeadingType:function(){return this.format[ATTR_PARAGRAPH.PS_HD]||0},isHeading:function(){return parseInt(this.getHeadingType())>0},isImageList:function(){return ListUtils.isImageList(this.format)},isSvgImageList:function(){return ListUtils.isSvgImageList(this.format)},isSymbolList:function(){return ListUtils.isSymbolList(this.format.ls_data)},isCode:function(){if(!this.format){var e=this.format,t=FontUtils.contentBetween(this.getEndIndex(),this.getEndIndex()+1);ZWLogger.log(" FORMAT : "+e+" :  CONT : "+t+" START : "+this.getIndex()+" END : "+this.getEndIndex()+"; END_INDEX_FORMAT : "+editor.doc.getRawFormatAt(this.getEndIndex()))}return!!this.format[ATTR_PARAGRAPH.PS_CODE]},getCodeTheme:function(){return this.isCode()?this.getCodeProperties().theme:null},getCodeLanguage:function(){return this.isCode()?this.format[ATTR_PARAGRAPH.PS_CODE].lg:""},getCodeSegments:function(){return this.codeSegments},getCodeProperties:function(){return this.isCode()&&this.format[ATTR_PARAGRAPH.PS_CODE]?this.format[ATTR_PARAGRAPH.PS_CODE]:{}},isList:function(){return ListUtils.isList(this.format)},getParaDirection:function(){return this.format[ATTR_PARAGRAPH.PS_DIR]||PARA_DIR.LTR},getFloatImageByIndex:function(e){for(var t,i=this.getFloatImagesInfo(),n=0;n<i.length;n++)if(t=this.viewProperties.floatImages[n],t.index===e)return t;return null},getFloatImageIndex:function(e){var t,i,n;for(t=0,n=this.viewProperties.floatImages.length;t<n;t++)if(i=this.viewProperties.floatImages[t],i.fid==e)return i.index+this.getIndex();return-1},getFormula:function(){var e=this.viewProperties.fields;for(var t in e){var i=t;if(e[i].formula){var n=clone(e[i].formula);return n.index+=this.getIndex(),n}}return null},isContainsFormula:function(){var e=this.viewProperties.fields;for(var t in e){var i=t;if(e[i].formula&&e[i].formula.text)return!0}return!1},handleTableRangeStart:function(e,t){var i=t[ATTR_AUTOFIELD.FORMULA],n=t[ATTR_COMMON.ID],r=Formula.getFormulaFormat(i);r&&(r.index=e-this.getIndex(),this.viewProperties.fields[n]={},this.viewProperties.fields[n].formula=r)},handleAutoFieldWithOutPgCount:function(e,t,i,n,r,o){var a,s=editor.doc,l=s.findPreviousIndexOf(UNICODE.RANGE_START,e),d=s.getRawFormatAt(l),c=i.match(o)[0];if("autoformula"==c){var u=this.viewProperties.fields[n].formula;if(u&&r.formula){if("#"==t){a=this.getAutoFieldValue(i,u);var g=a.formattedVal;this.viewProperties.fields[n].value=g,this.viewProperties.fields.containsOldFormula=!0,t=g}"currencyFormat"===u.numberFormat&&(this.viewProperties.fields.containsCurrencyFormat=!0),r.formula=!1}else r.formula||"#"!=t||(t="")}else if("autodocname"==c){var h=this.viewProperties.fields[n].value;if(h&&r.docName){if("#"==t){var a=this.getAutoFieldValue(i);this.viewProperties.fields[n].containsOldValue=!0,t=a}r.docName=!1}else r.docName||"#"!=t||(t="")}else if("autoauthor"==c){var f=this.viewProperties.fields[n].value;if(f&&r.docAuthor){if("#"==t){var a=this.getAutoFieldValue(i);this.viewProperties.fields[n].containsOldValue=!0,t=a}r.docAuthor=!1}else r.docAuthor||"#"!=t||(t="")}else if("autodocversion"==c){var p=this.viewProperties.fields[n].value;if(p&&r.docVersion){if("#"==t){var a=this.getAutoFieldValue(i,d);this.viewProperties.fields[n].containsOldValue=!0,t=a}r.docVersion=!1}else r.docVersion||"#"!=t||(t="")}else"#"==t?(a=this.getAutoFieldValue(i,d),t=a,this.viewProperties.fields[n]=t):this.viewProperties.fields[n]=this.getAutoFieldValue(i,d);return t},setState:function(e){this.state=e},getState:function(){return this.state},isRTLPara:function(){var e=this.getParaStyles()[ATTR_PARAGRAPH.PS_DIR];return e===PARA_DIR.RTL},getImageListData:function(){if(!this.isList())return{};var e=this.paraProperties.listData;return e?e.listImageData:{}}}),DTNode.types[UNICODE.PARA]=e}(),function(){"use strict";function e(e,t,i){DTRun.call(this,e,t,i)}function t(t,i,n){e.call(this,t,i,n),this.type=NODE_TYPE.FIELD_START,this.format=editor.doc.getRawFormatAt(this.getEndIndex())||{type:NODE_TYPE.FIELD_START}}function i(t,i,n){e.call(this,t,i,n),this.type=NODE_TYPE.FIELD_END,this.format=editor.doc.getRawFormatAt(this.getEndIndex())||{type:NODE_TYPE.FIELD_END}}NODE_TYPE.FIELD_START="fieldstart",NODE_TYPE.FIELD_END="fieldend",e.prototype=Object.create(DTRun.prototype),e.prototype.constructor=e,e.prototype.getFieldID=function(){var e=this.getFormat();return e&&e.id},e.prototype.getFieldName=function(){var e=this.getFormat();return e&&e.type},e.prototype.getFieldType=function(){var e=this.getFormat();return e&&e.type},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i.prototype=Object.create(e.prototype),i.prototype.constructor=i,DTNode.types[NODE_TYPE.FIELD_START]=t,DTNode.types[NODE_TYPE.FIELD_END]=i}(),DTUpdateQueueEventHandler=function(){"use strict";var e="Document/NodeAdded",t="Document/NodeRemoved",i="Document/NodeModified",n=function(){PubSub.publish.apply(null,arguments)},r=n.bind(null,e),o=n.bind(null,t),a=n.bind(null,i),s=function(n){n.on(e,r),n.on(t,o),n.on(i,a)};return{register:s}}();var SectionBuildProcess=function(e,t,i){"use strict";function n(e){this.sectionNode=e;var t=this.sectionNode.getBuildProcessData();this.itemsToBuild=t.itemsToBuild,this.itemCount=this.itemsToBuild.length,this.options=t.options,this.asyncBuild=t.asyncBuild,this.asyncTimer=null,this.currentBuildNode=null}var r=t.clone(e);r.TABLE_OP="tableop";var o=function(e){var t=0;switch(e){case r.SCROLL:case r.INSERT_CHAR:t=1;break;case r.TABLE_OP:t=5;break;default:t=5}return t};return n.prototype.preProcessItems=function(){this.trigger(DTNODE.SECTION_BUILD_PRE_PROCESS_STARTED);for(var e,t,i=0,n=0;n<this.itemCount;n++){e=this.itemsToBuild[n],"para"==e.node.type&&i++;for(t in this.options)e[t]=this.options[t];"remove"===e.op&&this.build(e)}this.asyncBuild=this.asyncBuild&&(i>5||this.itemCount>10),this.nextIndex=0,this.trigger(DTNODE.SECTION_BUILD_PRE_PROCESS_COMPLETE,this.sectionNode)},n.prototype.startBuilding=function(){this.trigger(DTNODE.SECTION_BUILD_STARTED),this.preProcessItems(),this.buildItems()},n.prototype.getChunkSize=function(){var e;if(this.asyncBuild){var t=this.sectionNode.doc.getCurrentOperation();e=o(t)}else e=this.itemCount;return e},n.prototype.isItemsPendingToBuild=function(){return this.nextIndex<this.itemCount},n.prototype.buildItems=function(){var e,t=this.getChunkSize(),i=!1,n=this.nextIndex,a=n+t;for(a>this.itemCount&&(a=this.itemCount);this.nextIndex<a;)e=this.itemsToBuild[this.nextIndex],!i&&this.asyncBuild&&("create"!==e.op&&"update"!==e.op||"table"!==e.node.type&&"row"!==e.node.type||(i=!0,t=o(r.TABLE_OP),a=n+t,a>this.itemCount&&(a=this.itemCount))),this.build(e),this.nextIndex++;this.isItemsPendingToBuild()?this.asyncTimer=setTimeout(this.buildItems.bind(this),10):(this.trigger(DTNODE.SECTION_BUILD_COMPLETE,this.itemCount),this.clear())},n.prototype.build=function(e){var t,i;"done"!=e.state&&(t=e.node,this.currentBuildNode=t,i=e.op,this.sectionNode.trigger(DTNODE.ITEM_BUILD_START,t,i),t[i].call(t),e.state="done",this.trigger(DTNODE.SECTION_BUILD_PROGRESS,e),this.sectionNode.trigger(DTNODE.ITEM_BUILD_END,t,i))},n.prototype.stopBuilding=function(){this.trigger(DTNODE.SECTION_BUILD_STOPPED),this.clear()},n.prototype.clear=function(){this.itemsToBuild=[],this.itemCount=0,this.options=null,this.sectionNode=null,this.currentBuildNode=null,null!=this.asyncTimer&&(clearTimeout(this.asyncTimer),this.asyncTimer=null),this.resetEventHandler()},n.prototype.getCurrentBuildNode=function(){return this.currentBuildNode},i.call(n.prototype),n}(DOCUMENT_OPERATIONS,ZWJSONUtils,BaseEventHandler);BaseEventHandler.call(DTSection.prototype),extend(DTSection.prototype,{hasChildNodes:function(){return!!this.children.length},getChildNodes:function(){return this.children},getFirstChild:function(){return this.children[0]},getLastChild:function(){return ZWArrayUtils.lastElementOf(this.children)},getId:function(){return this.id},getIndex:function(){return this.start},getEndIndex:function(){return this.end-1},getSectionType:function(){return this.sectionType},getSectionLength:function(){return this.end-this.start},getType:function(){return this.type},getHFType:function(){return""},getFormats:function(){return this.format},isDirtyNode:function(e){return!(!this.nodesToUpdate.nodesMap||!this.nodesToUpdate.nodesMap[e.id])},getOpTypeInUpdateQueue:function(e){return this.nodesToUpdate.nodesMap&&this.nodesToUpdate.getItem(e.id)&&this.nodesToUpdate.getItem(e.id).op},isNodeBuildInProgress:function(e){var t=null;return this.sectionBuilder&&(t=this.sectionBuilder.getCurrentBuildNode()),t&&t.id==e.id},isBuildInProgress:function(){return this.nodesToUpdate.length>0},hasNodesToBuild:function(){return this.nodesToUpdate.length>0},getBuildProcessData:function(){return{asyncBuild:!1,options:{collabop:"collabop"===this.doc.currentDocopBuilder.operation||!1,triggerPagination:this.doc.currentDocopBuilder.triggerPagination||!1},itemsToBuild:this.nodesToUpdate.getBuildList()}},hasUnknownImages:function(){return!ZWJSONUtils.isEmptyObject(this.unknownImages)},updateAllListItemsFromCurrentList:function(e,t){var i=ListUtils.isAbstractList(e),n=[];if(i){var r=ListUtils.getAbstractId(e);n=ListUtils.getListIdsSharingCommonAbstractId(r)}else n.push(e);for(var o=0;o<n.length;o++){var a,s,e=n[o],l=this.lists[e],d=l?l.length:0;for(a=0;a<d;a++)(!t||l[a].getIndex()>=t.getIndex())&&(s=DTUtils.makeOp(l[a],"updatelist"),this.nodesToUpdate.push(s.node.id,s))}},addToSection:function(e,t){this.stopRendering();var i,n,r,o,a,s,l,d,c=this.children,u=0,g=editor.doc.getContent(e,t);this.end+=t-e,l=e,d=t;var h=!1;for(o=c.length-1;o>=0;o-=1){if(i=c[o],u=o,!(this.start+i.start>e)){this.start+i.end<=e?(u=o+1,i=null):e==i.start+this.start&&"table"==i.type&&(i.updateIndex(t-e),i=null,h=!0);break}i.updateIndex(t-e)}if(!h)if(i){if("table"==i.type)return void i.addToTable(e,t);if("toc"==i.type)return void i.addToToc(e,t);e=i.start+this.start,"para"==i.type?(i.start=getStart(UNICODE.PARA,t)-this.start,i.end=getEnd(UNICODE.PARA,t)-this.start,s=g===UNICODE.PARA?DTUtils.makeOp(i,"update"):DTUtils.makeOp(i,"modify",l,Math.min(d,i.end+this.start),"is")):s=DTUtils.makeOp(i,"update")}else this.nodelessRange?this.nodelessRange.to<t&&(this.nodelessRange.to=t):this.nodelessRange={from:e,to:t},e=this.nodelessRange.from,t=this.nodelessRange.to;var f=!1;for(o=e;o<t;)a=editor.doc.getCharAt(o),DTNode.types[a]?(a==UNICODE.PARA?(n=getStart(UNICODE.PARA,o)-this.start,r=getEnd(UNICODE.PARA,o)-this.start,this.nodelessRange=null):a!=UNICODE.TABLE&&a!=UNICODE.HR&&a!=UNICODE.TOCSTART||(n=o-this.start,r=getEnd(a,o)-this.start),i=a==UNICODE.TABLE||a==UNICODE.TOCSTART?new DTNode.types[a](n,n+2,this):new DTNode.types[a](n,r,this),f=!0,this.addChildAt(i,u),this.nodesToUpdate.push(i.id,DTUtils.makeOp(i,"create")),i.updateProperties(),"para"==i.type?i.buildSegments():"table"==i.type?i.addToTable(n+this.start+1,r+this.start-1):"toc"==i.type&&i.addToToc(n+this.start+1,r+this.start-1),u++,o=this.start+i.end):o+=1;if(s){"para"===s.node.type&&("update"===s.op&&s.node.updateProperties(),s.node.buildSegments());var p=s.node;f&&!isNaN(s.contentIndex)&&p.type===NODE_TYPE.PARA&&(editor.doc.getCharAt(s.contentIndex)===UNICODE.PARA?(s.contentIndex=null,s.endIndex=null,s.type=null):s.contentIndex=p.getIndex()>s.contentIndex?p.getIndex():s.contentIndex),this.nodesToUpdate.push(p.id,s)}},remove:function(){for(var e,t=this.children[0];t;)e=t,t=t.next,e.remove.call(e),this.deleteChildAt(0);this.clearQueue(),this.nodesToUpdate=null,this.nodelessRange=null,this.doc=null,this.lists={},this.nodes={},PubSub.publish("Section/Remove",this),this.unbindEvents()},clearQueue:function(){this.stopRendering(),this.nodesToUpdate.clear()},deleteFromSection:function(e,t,i){this.stopRendering();var n,r,o,a,s=this.children,l=e,d=t;for(this.end-=t-e,n=0,a=s.length;n<a;n++){if(r=s[n],o=n,r.start+this.start>e){o=n-1,r=r.prev||r;break}if("para"!=r.type&&r.start+this.start==e)break}if(r){if("table"==r.type&&r.start+this.start!=e)r.deleteFromTable(e,t,i,l);else if("toc"==r.type&&r.start+this.start!=e)r.deleteFromToc(e,t,i,l);else{for(;r&&r.end+this.start<=t;)d-=r.getEndIndex()-r.getIndex()+1,this.nodesToUpdate.push(r.id,DTUtils.makeOp(r,"remove")),this.deleteChildAt(o),r=r.next,l=0;var c=r,u=!1;r&&("para"==r.type?(r.end=getEnd(UNICODE.PARA,e)-this.start,r.start=getStart(UNICODE.PARA,e)-this.start,i==UNICODE.PARA?this.nodesToUpdate.push(r.id,DTUtils.makeOp(r,"update")):(u=!0,this.nodesToUpdate.push(r.id,DTUtils.makeOp(r,"modify",l,d,"ds")))):this.nodesToUpdate.push(r.id,DTUtils.makeOp(r,"update")));var g=this.children[this.children.length-1],h=g?this.start+g.end:this.start+1;h<this.end&&(this.nodelessRange={from:h,to:this.end})}for(n=s.length-1;n>=0&&(r=s[n],!(e>=r.start+this.start));n-=1)r.updateIndex(e-t);c&&(c.updateProperties(u),"para"==c.type&&c.buildSegments())}else this.nodelessRange&&(this.nodelessRange.to-=t-e,this.nodelessRange.from>=this.nodelessRange.to&&(this.nodelessRange=null))},isViewRefreshDone:function(){return!0},updateSection:function(e,t,i){if((e!==this.start||e!==t-1)&&this.isViewRefreshDone()){var n,r,o,a,s=this.children;for(o=s.length-1;o>=0&&(n=s[o],r=o,!(e>=n.start+this.start));o-=1);if("para"==n.type&&(n.end=getEnd(UNICODE.PARA,n.start+this.start)-this.start),t<this.start+n.end)return void n.updateNode(e,t,i);var l;for(n.type!==NODE_TYPE.PARA?(n.updateNode(e,n.end+this.start,i),this.nodesToUpdate.push(n.id,DTUtils.makeOp(n,"update"))):(n.updateProperties(),l=n.getEndIndex()>t?t:n.getEndIndex(),editor.doc.getCharAt(e)===UNICODE.PARA||editor.doc.getContent(e,t)===UNICODE.PARA?this.nodesToUpdate.push(n.id,DTUtils.makeOp(n,"update")):this.nodesToUpdate.push(n.id,DTUtils.makeOp(n,"update",e,l,"as",i)),n.buildSegments()),o=n.end+this.start;o<t;)a=editor.doc.getCharAt(o),DTNode.types[a]?a!=UNICODE.PARA&&a!=UNICODE.TABLE&&a!=UNICODE.HR&&a!=UNICODE.TOCSTART||(n=n.next,n.updateProperties(),this.nodesToUpdate.push(n.id,DTUtils.makeOp(n,"update")),"para"!=n.type?n.updateNode(this.start+n.start,Math.min(n.end+this.start,t)):n.buildSegments(),o=n.end+this.start):(n=n.next,n.updateProperties(),n.type===NODE_TYPE.PARA?(l=n.getEndIndex()>t?t:n.getEndIndex(),this.nodesToUpdate.push(n.id,DTUtils.makeOp(n,"update",n.getIndex(),l,"as",i)),n.buildSegments()):this.nodesToUpdate.push(n.id,DTUtils.makeOp(n,"update")),o=n.end+this.start)}},updateSectionType:function(e){this.sectionType=e},updateAllNodes:function(){for(var e=this.children,t=0,i=e.length;t<i;t++){var n=e[t];this.nodesToUpdate.push(n.id,DTUtils.makeOp(n,"update"))}},updateIndex:function(e){this.start+=e,this.end+=e},addChild:function(e){var t=this.children,i=t[t.length-1]||null;e.prev=i,i&&(i.next=e),t.push(e)},addChildAt:function(e,t){var i=this.children,n=i[t-1]||null,r=i[t]||null;e.prev=n,e.next=r,n&&(n.next=e),r&&(r.prev=e),this.children.splice(t,0,e)},deleteChildAt:function(e){var t=this.children,i=t[e],n=i.prev||null,r=i.next||null;n&&(n.next=r),r&&(r.prev=n),this.children.splice(e,1)},processUnknownImages:function(){var e=function(e,t){var i=new Deferred,n=function(){var n,r=editor.doc.getRawFormatAt(t.index),o=parseFloat(r[ATTR_IMAGE.I_WID]||0),a=parseFloat(r[ATTR_IMAGE.I_HT]||0);if(DocLayoutManager)n=DocLayoutManager.getContentWidthAtIndex(t.index);else{var s=DocTreeManager.getSectionAtIndex(0);n=s.getContentWidth()}var l=e.height,d=e.width;if(d>n&&(l=l/d*n,d=n),(!o||100==o&&"%"==r[ATTR_IMAGE.I_WID_UN])&&(r[ATTR_IMAGE.I_WID]=d,r[ATTR_IMAGE.I_ORGINALWID]=d),(!a||100==a&&"%"==r[ATTR_IMAGE.I_WID_UN])&&(r[ATTR_IMAGE.I_HT]=l,r[ATTR_IMAGE.I_ORGINALHT]=l),100==o&&"%"==r[ATTR_IMAGE.I_WID_UN]){var c;c=DocLayoutManager?DocLayoutManager.getColumnWidthAtIdx(t.index):n,r[ATTR_IMAGE.I_HT]=r[ATTR_IMAGE.I_HT]*c/r[ATTR_IMAGE.I_WID],r[ATTR_IMAGE.I_CALC_WID]=c}if(r&&r.hasOwnProperty(ATTR_IMAGE.I_ROTATE)){var u=TransformationUtils.getTransformedSize(r[ATTR_IMAGE.I_ROTATE],r[ATTR_IMAGE.I_WID],r[ATTR_IMAGE.I_HT]);r.rot_ht=u.height,r.rot_width=u.width}i.resolve(t.para)},r=function(){var e=editor.doc.getRawFormatAt(t.index);e[ATTR_IMAGE.I_WID]=e[ATTR_IMAGE.I_ORGINALWID]=e[ATTR_IMAGE.I_HT]=e[ATTR_IMAGE.I_ORGINALHT]=.01,i.reject()};J(e).load(n).error(r);var o=DomUtil.processImgSrc(t.src);return J(e).attr("src",o),setTimeout(function(){i.reject()},1e4),i.promise()},t=function(){if(this.hasUnknownImages()){var t,i,n=[],r=this,o=window.frames.metricsFrame.document.getElementById("zwImgSpan"),a=J(o),s=function(e){r.doc.updateDocument(e.getIndex(),e.getEndIndex())};for(var l in r.unknownImages){t=r.unknownImages[l],i=document.createElement("img"),a.append(i);var d=e.call(r,i,t);d.done(s),n.push(d)}this.unknownImages={},whenAlways(n).done(function(){var e=r.doc;if(o.innerHTML="",e.currentDocopBuilder){var t=new DocOpBuilder;t.operation=e.currentDocopBuilder.operation,e.currentDocopBuilder.cursorStart&&(t.cursorStart=e.currentDocopBuilder.cursorStart,t.cursorEnd=e.currentDocopBuilder.cursorEnd,t.cursor.push({start:t.cursorStart,end:t.cursorEnd})),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),t.applyTo(),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!1)}else e.applyChanges(),e.buildChanges()})}};return t}(),updateList:function(e){var t,i,n=this.lists[e];for(t=0;t<n.length;t++){var i=DTUtils.makeOp(n[t],"updatelist");this.nodesToUpdate.push(i.node.id,i)}},updateTableNodes:function(e,t){var i,n,r=e.id,o=e.type;switch(t){case"add":o===NODE_TYPE.TABLE?this.tables[r]={}:o===NODE_TYPE.ROW?this.tables[e.parent.id][r]={}:o===NODE_TYPE.CELL&&(this.tables[e.parent.parent.id][e.parent.id][r]=r);break;case"update":break;case"remove":o===NODE_TYPE.TABLE?this.tables[r]&&delete this.tables[r]:o===NODE_TYPE.ROW?(i=e.parent.id,this.tables[i]&&this.tables[i][r]&&delete this.tables[i][r]):o===NODE_TYPE.CELL&&(i=e.parent.parent.id,n=e.parent.id,this.tables[i]&&this.tables[i][n]&&this.tables[i][n][r]&&delete this.tables[i][n][r])}},updateHeadingsNodes:function(e,t){var i=e.paraProperties,n=i&&i.level,r=e.id,o=this.findHeadingTypeFromNodeId(r);switch("undefined"==typeof n||this.headings[n]||(this.headings[n]=[]),t){case"add":this.headings[n].push(r);break;case"modify":o&&this.headings[o].splice(this.headings[o].indexOf(r),1),this.headings[n].push(r);break;case"remove":this.headings[n]&&this.headings[n].length&&this.headings[n].splice(this.headings[n].indexOf(r),1)}},findHeadingTypeFromNodeId:function(e){var t=this.headings;for(var i in t)if(t[i].indexOf(e)!==-1)return i},build:function(){var e=new Deferred;if(this.hasNodesToBuild()){this.sectionBuilder=new SectionBuildProcess(this);var t=function(){this.doc.addToInProgressDTSections(this),this.trigger(DTNODE.SECTION_BUILD_STARTED)},i=function(){this.trigger(DTNODE.SECTION_BUILD_PRE_PROCESS_STARTED)},n=function(e){this.trigger(DTNODE.SECTION_BUILD_PRE_PROCESS_COMPLETE,e)},r=function(e){this.nodesToUpdate.remove(e.node.id),this.trigger(DTNODE.SECTION_BUILD_PROGRESS,e,this.sectionBuilder.asyncBuild)},o=function(t){this.trigger(DTNODE.SECTION_BUILD_COMPLETE,t),this.doc.removeFromInProgressDTSections(this),this.sectionBuilder=null,e.resolve()},a=function(){this.sectionBuilder=null,e.reject()};this.sectionBuilder.on(DTNODE.SECTION_BUILD_STARTED,t,this),this.sectionBuilder.on(DTNODE.SECTION_BUILD_PROGRESS,r,this),this.sectionBuilder.on(DTNODE.SECTION_BUILD_COMPLETE,o,this),this.sectionBuilder.on(DTNODE.SECTION_BUILD_PRE_PROCESS_STARTED,i,this),this.sectionBuilder.on(DTNODE.SECTION_BUILD_PRE_PROCESS_COMPLETE,n,this),this.sectionBuilder.on(DTNODE.SECTION_BUILD_STOPPED,a,this),this.sectionBuilder.startBuilding()}else e.resolve();return e.promise()},stopRendering:function(){this.sectionBuilder&&this.sectionBuilder.stopBuilding()},adjustHeight:function(){},postProcessBuildItem:function(e,t){if(t===OP_TYPE.REMOVE){e.destroy.call(e);for(var i,n=0;n<this.children.length;n++)if(i=this.children[n],i.id===e.id){this.deleteChildAt(n);break}}},hasContent:function(){return this.end-this.start>2},bindEvents:function(){this.on(DTNODE.ITEM_BUILD_END,this.postProcessBuildItem,this)},unbindEvents:function(){this.off(DTNODE.ITEM_BUILD_END,this.postProcessBuildItem,this)},getStylesForNewSection:function(e){var t={},i=this.format[ATTR_SECTION.ST];switch(t[ATTR_SECTION.SID]=Utils.randomId(i),t[ATTR_COMMON.TYPE]=this.format[ATTR_COMMON.TYPE],t[ATTR_SECTION.ST]=i,t[ATTR_SECTION.BREAK_TYPE]=BREAK_TYPES.CONTINUOUS,i){case SECTION_TYPES.CONTENT:t[ATTR_SECTION.PS]=this.format[ATTR_SECTION.PS],t[ATTR_SECTION.OR]=this.format[ATTR_SECTION.OR],t[ATTR_SECTION.PW]=this.format[ATTR_SECTION.PW],t[ATTR_SECTION.PH]=this.format[ATTR_SECTION.PH],t[ATTR_SECTION.MT]=this.format[ATTR_SECTION.MT],t[ATTR_SECTION.ML]=this.format[ATTR_SECTION.ML],t[ATTR_SECTION.MB]=this.format[ATTR_SECTION.MB],t[ATTR_SECTION.MR]=this.format[ATTR_SECTION.MR],t[ATTR_SECTION.HT]=this.format[ATTR_SECTION.HT],t[ATTR_SECTION.FB]=this.format[ATTR_SECTION.FB],t[ATTR_SECTION.COLS]=ZWJSONUtils.clone(this.format[ATTR_SECTION.COLS]),t[ATTR_SECTION.GUTTER]=ZWJSONUtils.clone(this.format[ATTR_SECTION.GUTTER]),t[ATTR_SECTION.HF_TYPE]=this.format[ATTR_SECTION.HF_TYPE];break;case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:break;case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:}return extend(t,e||{}),t},getDefaultTabWidth:function(){return(editor.doc.getBodyFormat()[ATTR_BODY.DS_TPS]||"0in").convertor().pixels},buildAllowedMetaSections:function(){for(var e=[],t=0,i=this.allowedMetaSections.length;t<i;t++)for(var n=this.doc.getSectionsByType(this.allowedMetaSections[t]).first;n;){if(n.getContainingPara()&&this==n.getContainingSection()){var r=n.build();e.push(r)}n=n.next}return e},getListParasByListId:function(e){var t=this.lists[e];return t=t?t:[],t.sort(function(e,t){return e.getIndex()-t.getIndex()}),t},getParasWithChart:function(){for(var e,t=this.getChildNodes(),i=t.length,n=[],r=0;r<i;r++){e=t[r];var o=e.getParasWithChart();o.length&&Array.prototype.push.apply(n,o)}return n},getTableById:function(e){var t,i,n=this.tables;for(var r in n)if(t=this.doc.getTreeNodeById(r),t&&(i=t.getFormat(),i.id==e))return t;return null}}),DTHeaderFooterSection.prototype=Object.create(DTSection.prototype),DTHeaderFooterSection.prototype.constructor=DTHeaderFooterSection,DTHeaderFooterSection.prototype.build=function(){var e=new Deferred,t=this,i=DTSection.prototype.build.call(this);return i.then(function(){t.processUnknownImages();var i=t.buildAllowedMetaSections();Deferred.when.apply(null,i).then(function(){e.resolve()},function(){e.reject()})},function(){e.reject()}),e.promise()},DTHeaderFooterSection.prototype.updateSection=function(e,t,i){if(this.stopRendering(),e==this.start){if(t===this.start+1)return;e+=1}DTSection.prototype.updateSection.call(this,e,t,i)},DTHeaderFooterSection.prototype.getHFType=function(){return this.hfType},DTContentSection.prototype=Object.create(DTSection.prototype),DTContentSection.prototype.constructor=DTContentSection,extend(DTContentSection.prototype,{getBuildProcessData:function(){var e=DTSection.prototype.getBuildProcessData.call(this),t=this.doc.getBuildOptions();return e.asyncBuild=t.async,e},getHdrFtrSections:function(){var e=[];if(!this.isContinuousSection()){for(var t,i,n=this.getHFIds(SECTION_TYPES.HEADER),r=this.getHFIds(SECTION_TYPES.FOOTER),o=0;o<n.length;o++)t=this.doc.getSectionWithSid(n[o]),e.push(t);for(var o=0;o<r.length;o++)i=this.doc.getSectionWithSid(r[o]),e.push(i)}return e},getBreakType:function(){return this.format[ATTR_SECTION.BREAK_TYPE]},getHFType:function(){return this.hftype},getAttr:function(e){return this.format[e]},getLayoutProps:function(){var e=(this.format.ht||"0px").convertor().pixels,t=(this.format.fb||"0px").convertor().pixels,i=(this.format.ml||"0px").convertor().pixels,n=(this.format.mr||"0px").convertor().pixels,r=(this.format.mt||"0px").convertor().pixels,o=(this.format.mb||"0px").convertor().pixels,a=(this.format.pw||"0px").convertor().pixels,s=(this.format.ph||"0px").convertor().pixels,l=ZWJSONUtils.clone(this.format.gutter)||{};return l.value?l.value=(l.value||"0px").convertor().pixels:l.value=0,[GUTTER_POSITION.TOP,GUTTER_POSITION.LEFT,GUTTER_POSITION.RIGHT].contains(l.position)||(l.position="left"),{headerTop:e,footerBottom:t,margin:{left:i,right:n,top:r,bottom:o},gutter:{value:l.value,position:l.position},pageDimensions:{width:a,height:s}}},getContentWidth:function(){var e=this.getLayoutProps(),t=e.pageDimensions,i=e.margin,n=e.gutter,r=0;return n&&[GUTTER_POSITION.LEFT,GUTTER_POSITION.RIGHT].contains(n.position)&&(r=n.value),t.width-i.left-i.right-r},getGutterTop:function(){var e=this.getLayoutProps().gutter;return e&&GUTTER_POSITION.TOP==e.position?e.value:0},updateBorderProps:function(){var e=this.getFormats().borders;if(e){var e=ZWJSONUtils.clone(e);ZWJSONUtils.mergeJsonObjs(this.borders||{},e);var t=DTUtils.computeRenderingBorderProperties(e);t[ATTR_BORDERS.BORDER_DISPLAY]=e[ATTR_BORDERS.BORDER_DISPLAY]||0,t[ATTR_BORDERS.BORDER_DATA]=e[ATTR_BORDERS.BORDER_DATA]||{},t[ATTR_BORDERS.BORDER_TYPE]=e[ATTR_BORDERS.BORDER_TYPE]||"normal",t.measureFrom=MEASURE_FROM.TEXT,t.surroundHeader=!0,t.surroundFooter=!0,t.displayInFront=!1,this.borders=t}else this.borders=null},getBorderProps:function(){return this.borders},getColumnDetails:function(){return this.format.cols},isContinuousSection:function(){return this.getBreakType()===BREAK_TYPES.CONTINUOUS&&this.prev},updateHFNodeTypeDetails:function(){this.isContinuousSection()||(this.hfTypeDetails=DTUtils.getHFTypeDetails(this.hftype))},getHFTypeDetails:function(e){return this.isContinuousSection()?this.prev.getHFTypeDetails():this.hfTypeDetails[e]},getComputedHFIds:function(e){if(this.isContinuousSection())return this.prev.getComputedHFIds(e);for(var t=this.getHFTypeDetails(e),i=[],n=0;n<t.length;n++){var r=this.getHFIdByHFType(e,t[n]);r&&i.push(r)}return i},getHFIdByHFType:function(e,t){if(!this.isContinuousSection())for(var i,n=this.getHFIds(e),r=0;r<n.length;r++)if(i=this.doc.getSectionWithSid(n[r]),i&&i.getHFType()==t)return n[r];return this.prev?this.prev.getHFIdByHFType(e,t):null},getHFIds:function(e){var t;switch(e){case SECTION_TYPES.HEADER:t=this.format.headerIds?this.format.headerIds.slice(0):[];break;case SECTION_TYPES.FOOTER:t=this.format.footerIds?this.format.footerIds.slice(0):[]}return t},getNoteTypeInfo:function(e,t){var i=this.format[e]||{};return i.pgrst||(i.pgrst=NOTE_RESTART_NUM.CONTINUOUS),t=t||{stnum:1,refchars:[],fmt:"num",pgrst:NOTE_RESTART_NUM.CONTINUOUS},i.pgrst===NOTE_RESTART_NUM.CONTINUOUS&&this.prev&&(t=this.prev.getNoteTypeInfo(e,t)),ZWJSONUtils.cloneAndExtend(t,i),t},updateSection:function(e,t,i,n){if(this.stopRendering(),e==this.start){var r=i.section;t!==this.start+1||r.endnote||r.footnote?e+=1:this.updateProperties(r)}this.checkAndDoPreRefresh(i,n),DTSection.prototype.updateSection.call(this,e,t,i)},updateProperties:function(e){null!=e.breakType&&(this.breakType=e.breakType),null==this.breakType&&(this.breakType=BREAK_TYPES.CONTINUOUS),null!=e.hf_type&&(this.hftype=e.hf_type),null==this.hftype&&(this.hftype=0),this.updateHFNodeTypeDetails(),this.updateBorderProps()},checkAndDoPreRefresh:function(e,t){e&&e.section&&t&&"undefined"!=typeof t[ATTR_SECTION.HF_TYPE]&&"undefined"!=typeof e.section[ATTR_SECTION.HF_TYPE]&&e.section[ATTR_SECTION.HF_TYPE]!==t[ATTR_SECTION.HF_TYPE]&&(this.hftype=e.section[ATTR_SECTION.HF_TYPE],this.updateViewRefreshStatus(!1))},updateViewRefreshStatus:function(e){this.refreshStatus=e},isViewRefreshDone:function(){return this.refreshStatus},build:function(){for(var e,t=new Deferred,i=this,n=[],r=this.getHdrFtrSections(),o=0,a=r.length;o<a;o++)e=r[o].build(),n.push(e);return Deferred.when.apply(null,n).then(function(){var e=DTSection.prototype.build.call(i);e.then(function(){if(i.isViewRefreshDone()||(i.updateViewRefreshStatus(!0),i.trigger(DOCUMENT.REFRESH_DOCVIEWS)),i.hasUnknownImages())t.reject(),i.processUnknownImages();else{var e=i.buildAllowedMetaSections();Deferred.when.apply(null,e).then(function(){t.resolve()},function(){t.reject()})}},function(){t.reject()})},function(){t.reject()}),t.promise()}}),DTMetaSection.prototype=Object.create(DTSection.prototype),DTMetaSection.prototype.constructor=DTMetaSection,extend(DTMetaSection.prototype,{setContainingParaNode:function(e){this.containingParaNode!=e&&(this.containingParaNode=e,this.trigger(DTNODE.METASECTION_REFERENCE_UPDATED))},getContainingPara:function(){return this.containingParaNode},getContainingSection:function(){return this.getContainingPara().getSection()},setRangeIndex:function(e){this.rangeIndex=e},getRangeIndex:function(){return this.rangeIndex+this.getContainingPara().getIndex()},getRangeFormat:function(){return this.doc.getRawFormatAt(this.getRangeIndex())},updateSection:function(e,t,i){if(this.stopRendering(),e==this.start){var n=i.section;if(n&&n.st&&this.sectionType!==n.st&&this.updateSectionType(n.st),t===this.start+1)return;e+=1}DTSection.prototype.updateSection.call(this,e,t,i)},build:function(){var e=DTSection.prototype.build.call(this);return e.done(this.processUnknownImages.bind(this)),e}});var SectionCollection=function(){"use strict";function e(){this.orderedSectionList=[],this.sections={},this.sectionGroups={},this.lastNonMetaSection=null;var e,i;for(i in SECTION_TYPES)e=SECTION_TYPES[i],this.sectionGroups[e]=new t(e)}var t=function(e){this.type=e,this.sectionList=new LinkedList};extend(t.prototype,{add:function(e){for(var t=this.sectionList.last;t&&e.start<t.start;)t=t.prev;t?this.sectionList.insertAfter(e,t):this.sectionList.insertAsFirst(e)},remove:function(e){this.sectionList.remove(e)},getSections:function(){return this.sectionList},clear:function(){for(;this.sectionList.first;)this.sectionList.remove(this.sectionList.first)}});var i=function(e,t){return e.start-t.start};return BaseEventHandler.call(e.prototype),extend(e.prototype,{addSection:function(e){this.orderedSectionList.push(e),this.orderedSectionList.sort(i),this.sections[e.sid]=e,this.sectionGroups[e.sectionType].add(e),META_SECTIONS.contains(e.sectionType)||(!this.lastNonMetaSection||this.lastNonMetaSection.end<=e.start)&&(this.lastNonMetaSection=e)},updateSection:function(e,t,i){this.sectionGroups[t].remove(e),this.sectionGroups[i].add(e)},removeSection:function(e){var t=this.sections[e];if(void 0!=t){delete this.sections[e];var i=this.orderedSectionList.indexOf(t);this.orderedSectionList.splice(i,1),this.lastNonMetaSection==t&&(this.lastNonMetaSection=this.orderedSectionList.length?this.orderedSectionList[i-1]:null),this.sectionGroups[t.sectionType].remove(t)}return t},getSectionWithSid:function(e){return this.sections[e]},getSectionsByType:function(e){return this.sectionGroups[e].getSections()},getAllSectionsByType:function(e){for(var t=[],i=this.getSectionsByType(e).first;i;)t.push(i),i=i.next;return t},getAllSectionsByTypeFromIndex:function(e,t){for(var i=[],n=this.getSectionsByType(e).first;n;)n.start>=t&&i.push(n),n=n.next;return i},getAllSections:function(){return this.orderedSectionList},getLastNonMetaSection:function(){return this.lastNonMetaSection},getSectionsCountByType:function(e){return this.getSectionsByType(e).length},clearCollection:function(){this.orderedSectionList=[],this.sections={};var e,t;for(t in SECTION_TYPES)e=SECTION_TYPES[t],this.sectionGroups[e].clear();this.lastNonMetaSection=null}}),e}(),DocumentOperationManager=function(e){"use strict";function t(e,t,i,n){this.dtdoc=e||null,this.type=t||"",this.from=i||0,this.to=n||0}function i(e,i,n,r){t.call(this,e,o.INSERT,i,n),this.opContent=r}function n(e,i,n,r){t.call(this,e,o.DELETE,i,n),this.opContent=r}function r(e,i,n,r,a){t.call(this,e,o.UPDATE,i,n),this.opContent=editor.doc.getContent(i,n),this.oldStyles=r,this.styles=a}var o={INSERT:"insert",UPDATE:"update",DELETE:"delete"},a=new RegExp(UNICODE.TABLE,"g"),s=new RegExp(UNICODE.TABLEEND,"g"),l=new RegExp(UNICODE.TABLE+"|"+UNICODE.TABLEEND+"|"+UNICODE.TOCSTART+"|"+UNICODE.TOCEND+"|"+UNICODE.ROW,"g"),d=function(e){var t;for(t in e)this.buildOptions[t]=e[t]},c=function(){return this.buildOptions},u=function(e){if(this.skipList.indexOf(e)===-1){var t=this.operations.indexOf(e);t!==-1&&this.operations.splice(t,1),this.operations.push(e)}this.currentOperation=e},g=function(t){if(this.skipList.indexOf(t)===-1){var i=this.operations.indexOf(t);i!==-1&&this.operations.splice(i,1)}var n=this.operations.length;n>0?this.currentOperation=this.operations[n-1]:this.currentOperation=e.NONE},h=function(){this.currentOperation=e.NONE,this.operations=[]},f=function(){return this.operations},p=function(){return this.currentOperation},E=function(e){this.currentDocopBuilder=e,this.setCurrentOperation(e.operation)};extend(t.prototype,{destroy:function(){this.dtdoc=null,this.type=null,this.from=0,this.to=0},skipOp:function(e){return!1},shouldCombine:function(e){return!1},combineOp:function(e){this.to+=e.to-e.from,this.opContent+=e.opContent},applyChanges:function(){}}),i.prototype=Object.create(t.prototype),i.prototype.constructor=i,extend(i.prototype,{destroy:function(){t.prototype.destroy.call(this),this.opContent=null},skipOp:function(e){return e.type==o.UPDATE&&this.from<=e.from&&this.to==e.to},shouldCombine:function(e){e.dtdoc.updateTableStartCount(e);var t=!0;if(0===this.dtdoc.tableCount){var i=this.opContent.charAt(0),n=null===i.match(l),r=e.opContent.charAt(0),a=null!==r.match(l);n&&a&&(t=!1)}return e.dtdoc.updateTableEndCount(e),e.type==o.INSERT&&this.to==e.from&&e.opContent.charAt(0)!==UNICODE.SECTION_START&&t},applyChanges:function(){for(var e,t=this.dtdoc.getAllSections(),i=t.length-1;i>=0;){if(e=t[i],!(this.from<=e.start)){if(this.opContent.charAt(0)===UNICODE.SECTION_START){var n=editor.doc.findNextIndexOf(UNICODE.SECTION_START,this.from+1);n=n==-1?this.to:n,this.dtdoc.createSection(this.from,n);var r=t[i+1];if(r&&r.start<e.end){var o=editor.doc.getContent(this.to,r.end),a=e.end-o.length;e.deleteFromSection(a,e.end,o)}}else e.addToSection(this.from,this.to,this.opContent);break}e.updateIndex(this.opContent.length),i-=1}}}),n.prototype=Object.create(t.prototype),n.prototype.constructor=n,extend(n.prototype,{destroy:function(){t.prototype.destroy.call(this),this.opContent=null},shouldCombine:function(e){return e.type===o.INSERT&&(e.dtdoc.updateTableStartCount(e),e.dtdoc.updateTableEndCount(e)),e.type==o.DELETE&&this.from==e.from},applyChanges:function(){for(var e,t=this.dtdoc.getAllSections(),i=t.length-1;i>=0;)if(e=t[i],e.start>=this.to)e.updateIndex(-this.opContent.length),i-=1;else{if(!(this.from<=e.start&&e.start<this.to&&this.opContent.charAt(e.start-this.from)==UNICODE.SECTION_START)){if(this.from<e.end){var n=this.opContent.indexOf(UNICODE.SECTION_START,0);n=n==-1?this.opContent.length:n;var r=this.opContent.substring(0,n);e.deleteFromSection(this.from,this.from+n,r)}var o=t[i+1];if(o&&e.end!=o.start){var r=editor.doc.getContent(e.end,o.start);e.addToSection(e.end,o.start,r)}break}this.dtdoc.removeSection(e),i-=1}}}),r.prototype=Object.create(t.prototype),r.prototype.constructor=r,extend(r.prototype,{destroy:function(){t.prototype.destroy.call(this),this.opContent=null,this.oldStyles=null,this.styles=null},skipOp:function(e){return e.type==o.UPDATE&&this.from==e.from&&this.to==e.to},shouldCombine:function(e){return e.type===o.INSERT&&(e.dtdoc.updateTableStartCount(e),e.dtdoc.updateTableEndCount(e)),e.type==o.UPDATE&&this.to==e.from},combineOp:function(e){t.prototype.combineOp.call(this,e),this.styles=e.styles},applyChanges:function(){for(var e,t=this.dtdoc.getAllSections(),i=t.length-1;i>=0;i-=1)if(e=t[i],!(e.start>=this.to)){if(e.end<=this.from)break;var n;n=this.styles&&this.styles.section?e.start:e.start+1,n<this.from&&(n=this.from);var r=e.end;this.to<r&&(r=this.to),n==e.start?this.dtdoc.updateSection(e,n,r,this.styles,this.oldStyles):e.updateSection(n,r,this.styles)}}});var T=function(e){if(this.shouldRefreshTree)return void e.destroy();if(null==this.currentOp)this.setCurrentOp(e);else{if(this.currentOp.skipOp(e))return void e.destroy();this.currentOp.shouldCombine(e)?(this.currentOp.combineOp(e),e.destroy()):(this.tableCount=0,this.applyChanges(),this.setCurrentOp(e))}},O=function(e){this.currentOp=e,this.currentOp.type===o.INSERT&&(this.updateTableStartCount(this.currentOp),this.updateTableEndCount(this.currentOp))},m=function(e){var t=0,i=e.opContent.match(a);i&&(t=i.length),this.tableCount+=t},I=function(e){var t=0,i=e.opContent.match(s);i&&(t=i.length),this.tableCount-=t},D=function(e,t,n,r){try{var o=new i(this,e,t,n,r);this.processOp(o)}catch(e){throw ZWLogger.log("Stack "+e.stack),"error in addToDocument"}},R=function(e,t,i){try{var r=new n(this,e,t,i);this.processOp(r)}catch(e){throw ZWLogger.log("Stack "+e.stack),"error in deleteFromDocument"}},S=function(e,t,i,n){try{var o=new r(this,e,t,i,n);this.processOp(o)}catch(e){throw ZWLogger.log("Stack "+e.stack),"error in updateDocument"}},C=function(e,t,i,n){try{if(i&&i.type==NODE_TYPE.BODY||n&&n[NODE_TYPE.BODY])return void this.updateBodySection(i,n[NODE_TYPE.BODY])}catch(e){throw ZWLogger.log("Stack "+e.stack),"error in updateDocumentBody"}},A=function(){(this.shouldRefreshTree||this.shouldRefreshLayout)&&this.refreshTree();try{this.currentOp&&(this.currentOp.applyChanges(),this.clearCurrentOp());}catch(t){ZWLogger.log("Exception @applyChanges");var e=t.message;throw e===ZWCollaboration.SHOW_CARET_GETPORTION_ERROR||e===ZWCollaboration.NO_LINE_CANNOT_SELECT||e===ZWCollaboration.SHOW_CARET_SELECTION_ERROR||e===ZWCollaboration.SET_CURSOR_ERROR||e===ZWCollaboration.SET_COLLAB_CURSOR_ERROR?t:(ZWLogger.log("_ERROR_IN_DOM_APPLYTO_ Exception: "+t.stack),"error in dom applyTo")}},v=function(){this.currentOp.destroy(),this.currentOp=null};return function(){this.buildOptions={async:!0},this.currentOperation=e.NONE,this.currentOp=null,this.currentDocopBuilder=null,this.skipList=[e.SCROLL],this.operations=[],this.tableCount=0,this.getBuildOptions=c,this.setBuildOptions=d,this.setCurrentOperation=u,this.getCurrentOperation=p,this.getAllOperations=f,this.resetOperations=h,this.setOperationComplete=g,this.updateDocOpBuilder=E,this.processOp=T,this.addToDocument=D,this.deleteFromDocument=R,this.updateDocument=S,this.updateDocumentBody=C,this.applyChanges=A,this.clearCurrentOp=v,this.setCurrentOp=O,this.updateTableStartCount=m,this.updateTableEndCount=I}}(DOCUMENT_OPERATIONS),DTDocument=function(e){function t(e){this.sectionCollection=new SectionCollection,this.shouldRefreshTree=!1,this.shouldRefreshLayout=!1,this.width=0,this.listCollections={},this.inProgressDTSections=[],extend(this,e)}return e.call(t.prototype),DocumentOperationManager.call(t.prototype),t.prototype.destroy=function(){this.removeAllSections(),this.inProgressDTSections=[],this.width=0,this.shouldRefreshLayout=!1,this.shouldRefreshTree=!1,this.sectionCollection={},this.trigger(DOCUMENT.DTDOCUMENT_DESTROYED)},t.prototype.getAllSectionWithListId=function(e){if(void 0==e)return[];var t=this.listCollections;if(!t[e])return[];var i=Object.values(t[e]);return i.sort(function(e,t){return e.getIndex()-t.getIndex()}),i},t.prototype.updateListCollection=function(e,t){var i=this.listCollections;i[e]||(i[e]={}),i[e][t.section.id]=t.section},t.prototype.isListPresentInMultipleSection=function(e){var t=this.getAllSectionWithListId(e);return t.length>1},t.prototype.updateAllListItemsFromCurrentList=function(e,t){if(t)for(var i,n=this.getAllSectionWithListId(e),r=0;r<n.length;r++)n[r].getIndex()>=t.section.getIndex()&&(i=n[r]===t.section?t:void 0,n[r].updateAllListItemsFromCurrentList(e,i))},t.prototype.removeSectionFromListCollection=function(e,t){this.listCollections[e]&&delete this.listCollections[e][t]},t.prototype.getInProgressDTSections=function(){return this.inProgressDTSections},t.prototype.addToInProgressDTSections=function(e){this.inProgressDTSections.push(e)},t.prototype.removeFromInProgressDTSections=function(e){var t=this.inProgressDTSections.indexOf(e);t>-1&&this.inProgressDTSections.splice(t,1)},t.prototype.getRawFormatAt=function(e){return editor.doc.getRawFormatAt(e)||{}},t.prototype.getCharAt=function(e){return editor.doc.getCharAt(e)},t.prototype.getThemeStyleFormatAt=function(e){return editor.doc.getThemeStyleFormatAt(e)||{}},t.prototype.getTrackChangeDetails=function(){return editor.doc.getTrackChangeDetails()},t.prototype.getComputedFormatAt=function(e,t){return editor.doc.getComputedFormatAt(e,t,arguments[2],arguments[3])},t.prototype.isEditMode=function(){return editor.getRole().permissions.can("document.edit")},t.prototype.isFillMode=function(){return editor.getRole().permissions.can("document.fill")},t.prototype.createSections=function(){var e=0,t=0,i=editor.doc.getDocumentLength();do t=findNextIndexOf(CONT_REGEXP.SECTIONEND,e),this.createSection(e,t),e=t;while(e<i)},t.prototype.createSection=function(e,t){var i,n=this.getRawFormatAt(e);i=META_SECTIONS.contains(n.st)?new DTMetaSection(e,e+1,this):"header_primary"==n.st||"footer_primary"==n.st||n.hasOwnProperty("hftype")&&n.hftype!=-1?new DTHeaderFooterSection(e,e+1,this):new DTContentSection(e,e+1,this),this.sectionCollection.addSection(i),this.trigger(DTNODE.SECTION_ADDED,i),this.bindSectionEvent(i),i.addToSection(e+1,t)},t.prototype.updateSection=function(e,t,i,n,r){var o=n.section;e.updateSection(t,i,n,r),o&&o.st&&o.st!==r.st&&this.sectionCollection.updateSection(e,r.st,o.st),this.refreshTree()},t.prototype.removeSection=function(e){e.clearQueue(),this.unbindSectionEvent(e),this.sectionCollection.removeSection(e.sid),this.trigger(DTNODE.SECTION_REMOVED,e),e.remove()},t.prototype.removeAllSections=function(){this.trigger(DOCUMENT.BEFORE_TREE_DESTROY),this.removeAllSectionsOfGivenType(SECTION_TYPES.TEXTBOX),this.removeAllSectionsOfGivenType(SECTION_TYPES.FOOTNOTE),this.removeAllSectionsOfGivenType(SECTION_TYPES.ENDNOTE),this.removeAllSectionsOfGivenType(SECTION_TYPES.HEADER),this.removeAllSectionsOfGivenType(SECTION_TYPES.FOOTER),this.removeAllSectionsOfGivenType(SECTION_TYPES.CONTENT),this.trigger(DOCUMENT.AFTER_TREE_DESTROY)},t.prototype.removeAllSectionsOfGivenType=function(e){for(var t,i=this.getSectionsByType(e).last;i;)t=i.prev,this.removeSection(i),i=t},t.prototype.refresh=function(){this.removeAllSections(),this.createSections()},t.prototype.bindSectionEvent=function(e){e.on(DTNODE.SECTION_BUILD_PROGRESS,this.handleNodeBuildProgress,this),e.on(DOCUMENT.REFRESH_DOCVIEWS,this.handleRefreshDocViews,this)},t.prototype.unbindSectionEvent=function(e){e.off(DTNODE.SECTION_BUILD_PROGRESS,this.handleNodeBuildProgress,this)},t.prototype.handleNodeBuildProgress=function(e,t){if(t&&"remove"!==e.op&&"para"==e.node.type){var i="";i="load"===this.currentDocopBuilder.operation?DOCUMENT.LOADING_PROGRESS:DOCUMENT.COMMAND_PROGRESS,this.trigger(i,{node:e.node,cursor:this.currentDocopBuilder.cursorObj})}},t.prototype.handleRefreshDocViews=function(){this.trigger(DOCUMENT.REFRESH_DOCVIEWS)},t.prototype.getAllSections=function(){return this.sectionCollection.getAllSections()},t.prototype.getSectionWithSid=function(e){return this.sectionCollection.getSectionWithSid(e)},t.prototype.getSectionsByType=function(e){return this.sectionCollection.getSectionsByType(e)},t.prototype.getAllSectionsByType=function(e){return this.sectionCollection.getAllSectionsByType(e)},t.prototype.getAllSectionsByTypeFromIndex=function(e,t){return this.sectionCollection.getAllSectionsByTypeFromIndex(e,t)},t.prototype.getLastNonMetaSection=function(){return this.sectionCollection.getLastNonMetaSection()},t.prototype.isMultiSectionDocument=function(){return this.sectionCollection.getSectionsCountByType(SECTION_TYPES.CONTENT)>1},t.prototype.buildChanges=function(){var e=new Deferred,t=this;ZWLogger.log("Build Changes : starts..."),(editorProps.isWebLayout||editorProps.isFixedLayout||isHeadlessPDF)&&this.setBuildOptions({async:!1});var i=this.sectionCollection.getSectionsByType(SECTION_TYPES.CONTENT).first;ZWLogger.log("Build Changes : content build starts...");var n=function(){e.reject()},r=function(t){var i=t.build();i.then(function(){t=t.next,t?r(t):e.resolve()},n)},o=e.promise();return o.done(function(){t.resetOperations()}),o.always(function(){ZWLogger.log("Build Changes : ends..."),t.setBuildOptions({async:!0})}),i&&r(i),o},t.prototype.updateBodySection=function(e,t){var i,n=!1,r=!1,o=!1,a=[],s=[],l=[],d=!1;if(t&&(t.theme||t[ATTR_BODY.DS_STYLES])){if(t&&t.styles&&t.styles.para){var c=DocUtil.getRenderingFormat(t.styles.para,t.theme),u=DocUtil.getRenderingFormat(e.styles.para,e.theme);a=this.getModifiedHeadingsArray(u,c)}s=this.getModifiedTablesArray(),l=this.getParasWithChart()}if(t&&"listFormat"==t.st){r=!0;for(var g in t)if("st"!=g&&"type"!=g&&editor.doc.getListObj(g)){var h=e.listFormat[g];"number"==typeof format&&(h=LIST_STYLE_OBJECT[format]);var f=ListUtils.getChangedListLevel(h,t[g]);(f.length||"object"!=typeof t[g])&&(i=g)}}else if(t.view){var p=e.view;o=!0,"Web View"!=p&&"Web View"!=t.view||(d=!0)}else if(t[ATTR_BODY.DS_BGC]||t.resetBackground){for(var g in t)if("type"!=g&&g!=ATTR_BODY.DS_BGC){n=!0;break}t.resetBackground&&(n=!1)}else a.length||s.length||l.length?n=!1:t.hasOwnProperty(ATTR_BODY.TC_ISENABLED)||t.hasOwnProperty(ATTR_BODY.TC_ON_BY_COLLAB)||t.hasOwnProperty(ATTR_BODY.TC_OFF_BY_COLLAB)||t.hasOwnProperty(ATTR_BODY.DS_LANGUAGE)||t.hasOwnProperty(ATTR_BODY.DS_STYLES)||t.hasOwnProperty("mm_removeBlankLines")||t.hasOwnProperty("mm_remove_blankparas")||"bulletStyles"===t.st||"hilighter"===t.st||(n=!0);if(t.hasOwnProperty(ATTR_BODY.TC_ISENABLED)||t.hasOwnProperty(ATTR_BODY.TC_ON_BY_COLLAB)||t.hasOwnProperty(ATTR_BODY.TC_OFF_BY_COLLAB))editor.doc.initTrackChangeDetails(),PubSub.publish("Document/TCPropertiesChanged"),editor.doc.snapShotManager.resetSnapShotManager();else{if(d)return this.shouldRefreshLayout=d,void this.refreshTree(t);if(!r){if(e)for(var g in t)g!=ATTR_BODY.DS_THEME&&g!=ATTR_BODY.DS_STYLES&&g!=ATTR_BODY.DS_STYLE_UI_INFO||DocumentDesign.update();DomUtil.applyDocumentStyle(t)}n||(i?this.updateList(parseInt(i)):a.length&&this.updateHeadings(a),s.length&&this.updateTables(s),l.length&&this.updateParasWithChart(l))}this.shouldRefreshTree=n,this.shouldRefreshLayout=d},t.prototype.buildTree=function(){this.createSections(0,editor.doc.getDocumentLength())},t.prototype.refreshTree=function(e){this.shouldRefreshLayout?(this.trigger(DOCUMENT.REFRESH_TREE,e),this.shouldRefreshLayout=!1):(this.refresh(),this.shouldRefreshTree=!1,this.shouldRefreshLayout=!1)},t.prototype.getSection=function(e){var t,i,n=this.getAllSections();for(i=0;i<n.length;i++)if(t=n[i],t.start<=e&&e<t.end)return t;return null},t.prototype.getFirstContentSection=function(){var e,t,i=this.getAllSections(),n=null;for(t=0;t<i.length;t++)e=i[t],e.getSectionType()===SECTION_TYPES.CONTENT&&(!n||n.start>e.start)&&(n=e);return n},t.prototype.getLastContentSection=function(){var e,t,i=this.getAllSections(),n=null;for(t=0;t<i.length;t++)e=i[t],e.getSectionType()===SECTION_TYPES.CONTENT&&(!n||n.start<e.start)&&(n=e);return n},t.prototype.getWidthFromSectionNode=function(e){return(e&&e.format[ATTR_BODY.DS_PW]||"0in").convertor().pixels},t.prototype.logData=function(e){var t=this.getAllSections()[0].itemUnderProgress;t?ZWLogger.log("line index ::: "+e+"  op:"+t.item.op+", node index:"+t.item.node.getIndex()+", nth node: "+t.i+", total nodes: "+t.total+", lastNodeIndex: "+t.lastNodeIndex):ZWLogger.log("No rendering in progress")},t.prototype.getTablesInNode=function(e){var t=0;if(e.type==NODE_TYPE.TABLE&&(t+=1),e.children)for(var i=0;i<e.children.length;i++)t+=this.getTablesInNode(e.children[i]);return t},t.prototype.getFloatImageIndex=function(e,t){var i,n,r=this.getAllSections();for(ZWLogger.log(" nodeId : "+e+" : imageId : "+t),i=r.length-1;i>=0;i-=1)if(n=r[i],n.nodes[e])return n.nodes[e].getFloatImageIndex(t);return ZWLogger.log("Returning Negative Index ::::: "),-1},t.prototype.updateList=function(e){var t,i=ListUtils.isAbstractListID(e);t=i?ListUtils.getListIdsSharingCommonAbstractId(e):[e];for(var n,r=0;r<t.length;r++){n=t[r];var o,a,s=this.getAllSections();for(o=s.length-1;o>=0;o-=1)a=s[o],a.lists[n]&&a.updateList(n)}},t.prototype.updateHeadings=function(e){for(var t=this.getAllSections(),i=0,n=e.length;i<n;i++)for(var r=t.length-1;r>=0;r--){var o=t[r],a=e[i].split("h")[1],s=o.headings[a];if(s)for(var l=0,d=s.length;l<d;l++){var c=s[l];o.nodesToUpdate.push(c,DTUtils.makeOp(this.getTreeNodeById(c),"update"))}}},t.prototype.updateTables=function(e){for(var t,i=this.getAllSections(),n=0,r=e.length;n<r;n++){t=e[n];for(var o=i.length-1;o>=0;o--){var a=i[o],s=a.tables[t];if(s){a.nodesToUpdate.push(t,DTUtils.makeOp(this.getTreeNodeById(t),"update"));for(var l in s){a.nodesToUpdate.push(l,DTUtils.makeOp(this.getTreeNodeById(l),"update"));for(var d in s[l])a.nodesToUpdate.push(d,DTUtils.makeOp(this.getTreeNodeById(d),"update"))}}}}},t.prototype.updateParasWithChart=function(e){for(var t=0;t<e.length;t++){var i=e[t].getId(),n=e[t].getSection();n.nodesToUpdate.push(i,DTUtils.makeOp(this.getTreeNodeById(i),"update"))}},t.prototype.getTreeNode=function(e,t){for(var i,n=e.children,r=n.length-1;r>=0;r--){var o=n[r],a=o.getIndex();if(t===a?i=o:t>a&&(i=o.children.length>0&&o.type!==NODE_TYPE.PARA?this.getTreeNode(o,t):o),i)break}return i},t.prototype.getTreeNodeById=function(e){for(var t,i=this.getAllSections(),n=0,r=i.length;n<r;n++)if(t=i[n],t.nodes[e])return t.nodes[e];return null},t.prototype.getTreeNodeAtIndex=function(e){var t=this.getSection(e);return t?t.getIndex()==e?t:this.getTreeNode(t,e):null},t.prototype.paraNodeAtIndex=function(e){for(var t,i,n,r,o,a=this.getSection(e);;){for(t=a.children,r=!1,o=t.length-1;o>=0;o--)if(i=t[o],n=i.getIndex(),e>=n){i.type===NODE_TYPE.PARA&&(r=!0);break}if(a=i,r)break}return a},t.prototype.getParentCells=function(e){var t=[];do e.type===NODE_TYPE.CELL&&t.push(e);while(e=e.parent);return t},t.prototype.getParentTables=function(e){for(var t,i=[];t=this.getParents(NODE_TYPE.TABLE,t&&t.getIndex()-1||e);)i.push(t);return i},t.prototype.getTableValues=function(e,t){for(var i,n,r,o,a,s,l,d,c=e,u={},g=1;c&&c.type!=NODE_TYPE.TABLE;)c=c.parent;if(!c)throw"outside_table";for(i=c,n=0;n<i.children.length;n++){for(o=i.children[n],d="A",r=0;r<o.children.length;r++)a=o.children[r],l=g+d,s=Formula.getCellValue(a,t),u[d+g]=s,d+=1,d=String.fromCharCode(d.charCodeAt()+1);g+=1}return u},t.prototype.getCurrentCell=function(e){var t,i,n,r=0,o=0;for(n=e;n&&n.type!=NODE_TYPE.CELL;)n=n.parent;for(t=n,i=t.parent;t;)r+=1,t=t.prev;for(;i;)o+=1,i=i.prev;return String.fromCharCode("A".charCodeAt()+r-1)+o},t.prototype.getTableSize=function(e){var t,i,n;for(n=e;n&&n.type!=NODE_TYPE.ROW;)n=n.parent;return t=n,i=t.parent,{rows:i.children.length,cols:t.children.length}},t.prototype.getParents=function(e,t){var i=this.getTreeNodeAtIndex(t);switch(e=e==NODE_TYPE.PARAGRAPH?NODE_TYPE.PARA:e){case NODE_TYPE.SECTION:case NODE_TYPE.PARA:case NODE_TYPE.CELL:case NODE_TYPE.ROW:case NODE_TYPE.TABLE:case NODE_TYPE.TOC:for(;i&&i.type!=e;)i=i.parent||null;return i;case NODE_TYPE.TEXTBOX:for(;i&&i.sectionType!=e;)i=i.parent;return i;default:return null}},t.prototype.getNodesBetweenIndex=function(e,t,i,n){var r,o,a,s,l,d,c=0,u=[];for(d=[],n=n||this.getSection(t),s=n.children,l=s.length,c=0;c<l;c++)if(r=s[c],o=r.getIndex(),a=r.getEndIndex()+1,!(a<=t)){if(o>=i&&o>t)break;r.type!=e&&"*"!=e||d.push(r),r.type!=NODE_TYPE.PARA&&r.children&&(u=this.getNodesBetweenIndex(e,t,i,r),d=d.concat(u))}return d},t.prototype.getAllChildren=function(e,t){var i=[];return e.type===NODE_TYPE.PARA?i:(U.each(e.children,function(e){i=i.concat(this.getAllChildren(e,t)),t&&"*"!==t&&t!==e.type||i.push(e)}.bind(this)),i)},t.prototype.getModifiedHeadingsArray=function(e,t){var i=[];for(var n in t)ZWJSONUtils.compareJSON(e[n],t[n])||i.push(n);return i},t.prototype.getModifiedTablesArray=function(){for(var e,t,i,n=[],r=this.getAllSections(),o=0;r[o];){e=r[o].tables;for(var a in e)t=this.getTreeNodeById(a),t&&(i=JSON.stringify(t.format.theme&&t.format.theme.themeObj||""),i.indexOf("accent")!==-1&&n.push(a));o++}return n},t.prototype.getParasWithChart=function(){for(var e,t=[],i=this.getAllSections(),n=0,n=0;n<i.length;n++)e=i[n].getParasWithChart(),e.length>0&&Array.prototype.push.apply(t,e);return t},t.prototype.getPrevious=function(e,t,i){var n=e.prev||null;if(i&&(e.type==t||!t))return n=e;if(n){if(!t||n.type==t)return n;if(n.type==NODE_TYPE.TABLE){i=!0;var r=n.children[n.children.length-1],o=r.children[r.children.length-1];n=this.getPrevious(o.children[o.children.length-1],t,i)}else if(n.type==NODE_TYPE.ROW){i=!0;var a=n.children[n.children.length-1];n=this.getPrevious(a.children[a.children.length-1],t,i)}else n.type==NODE_TYPE.TOC||n.type==NODE_TYPE.CELL?(i=!0,n=this.getPrevious(n.children[n.children.length-1],t,i)):n.type==NODE_TYPE.HR&&(i=!0,n=this.getPrevious(n,t,i))}else e.parent&&e.parent.type&&(i=!0,n=this.getPrevious(e.parent,t,i));return n},t.prototype.getRootSectionAt=function(e){var t=this.getSection(e);return t?t.getSectionType()===SECTION_TYPES.TEXTBOX?this.getSection(t.getRangeIndex()):t:null},t.prototype.getRootSectionType=function(e){var t=this.getRootSectionAt(e);return t?t.getSectionType():""},t.prototype.getAutoFieldValue=function(e){var t,i=this.getTreeNodeAtIndex(e),n=this.getRawFormatAt(e),r=n&&n.ftype,o=i.viewProperties.fields[n.id];if(t="object"==typeof o?o.value:o,!t&&r!=AUTOFIELD_TYPE.AUTO_PAGENUMBER&&r!=AUTOFIELD_TYPE.AUTO_PAGECOUNT)for(var a=i.children,s=a.length,l=0;l<s;l++){var d=a[l];if(d.format&&d.format.fieldinfo==n.id){t=d.getContent();break}}return"Formula_Output"==t&&fieldType==AUTOFIELD_TYPE.AUTO_FORMULA&&n.label&&(t=n.label),t},t.prototype.isMirrorMargins=function(){var e=editor.doc.getBodyFormat()[ATTR_BODY.SPECIAL_MARGINS];return!(!e||e.type!=MARGINS_TYPE.MIRRORMARGINS)},t.prototype.getTableById=function(e){for(var t,i,n=this.getAllSections(),r=0;n[r]&&(i=n[r],!(t=i.getTableById(e)));)r++;return t},t}(BaseEventHandler),DOCTreeManager=function(){"use strict";function e(e){this.name="doctree",this.doc=null,this.imagePreviewEnabled=!1,this.model=new Model(e.content,e.styles,e.defaults,e.locks,e.mig_ver,e.ranges),this.bindEvents(),ModelUpdateHandler.init(this.model)}return BaseEventHandler.call(e.prototype),extend(e.prototype,{init:function(){var e={showBookMark:!0};editor.getRole().permissions.can("document.edit")&&(e.showBookMark=!1),this.doc=new DTDocument(e),this.trigger(DOCUMENT.DOCTREE_INITIALIZED,this,this.doc)},destroy:function(){this.doc.destroy(),this.doc=null,this.imagePreviewEnabled=!1,ModelUpdateHandler.destroy(this.model),this.trigger(DOCUMENT.DOCTREE_DESTROYED),this.unbindEvents(),this.model.destroy(),this.model=null},getInProgressDTSections:function(){return this.doc.getInProgressDTSections()},isInProgressDTSection:function(e){return this.getInProgressDTSections().contains(e)},getModel:function(){return this.model},addToTree:function(e,t,i,n){this.doc.addToDocument(e,t,i,n)},deleteFromTree:function(e,t,i){this.doc.deleteFromDocument(e,t,i)},updateTree:function(e,t,i,n){this.doc.updateDocument(e,t,i,n)},updateDocumentBody:function(e,t,i,n){this.doc.updateDocumentBody(e,t,i,n)},buildTree:function(){this.doc.buildTree()},refreshTree:function(){this.doc.refreshTree()},applyChanges:function(){this.doc.applyChanges()},buildChanges:function(){return this.doc.buildChanges()},updateDocOpBuilder:function(e){this.doc.updateDocOpBuilder(e)},getNodesBetweenIndex:function(e,t,i){return this.doc.getNodesBetweenIndex(e,t,i)},getFloatImageIndex:function(e,t){return this.doc.getFloatImageIndex(e,t)},updateList:function(e){return this.doc.updateList(e)},updateHeadings:function(e){return this.doc.updateHeadings(e)},updateTables:function(e){return this.doc.updateTables(e)},isContentSectionBuildInProgress:function(){for(var e=this.doc.getSectionsByType(SECTION_TYPES.CONTENT),t=e.first;t;){if(t.isBuildInProgress())return!0;t=t.next}return!1},getCharAt:function(e){return this.doc.getCharAt(e)},getTreeNodeAtIndex:function(e){return this.doc.getTreeNodeAtIndex(e)},getRootSectionType:function(e){return this.doc.getRootSectionType(e)},getRootSectionAt:function(e){return this.doc.getRootSectionAt(e)},getTreeNodeById:function(e){return this.doc.getTreeNodeById(e)},getNode:function(e){return this.doc.getNode(e)},getParents:function(e,t){return this.doc.getParents(e,t)},getParentCells:function(e){return this.doc.getParentCells(e)},getParentTables:function(e){return this.doc.getParentTables(e)},getSectionWithSid:function(e){return this.doc.getSectionWithSid(e)},getSectionsByType:function(e){return this.doc.getSectionsByType(e)},getAllSectionsByType:function(e){return this.doc.getAllSectionsByType(e)},getAllSectionsByTypeFromIndex:function(e,t){return this.doc.getAllSectionsByTypeFromIndex(e,t)},getSection:function(e){return this.doc.getSection(e)},getSectionAtIndex:function(e){return this.doc.getSection(e)},getLastNonMetaSection:function(){return this.doc.getLastNonMetaSection()},getEndNoteCount:function(){return this.doc.getSectionsByType(SECTION_TYPES.ENDNOTE).length},getFootNoteCount:function(){return this.doc.getSectionsByType(SECTION_TYPES.FOOTNOTE).length},getTableValues:function(e,t){return this.doc.getTableValues(e,t)},isMultiSectionDocument:function(){return this.doc.isMultiSectionDocument()},getCurrentCell:function(e){return this.doc.getCurrentCell(e)},getTableSize:function(e){return this.doc.getTableSize(e)},getTopAtIndex:function(e){return this.doc.getTopAtIndex(e)},getFirstPara:function(){return this.doc.getFirstPara()},getPrevious:function(e,t){return this.doc.getPrevious(e,t)},getCurrentSelectionIndex:function(){var e=editor.doc.getSelection();return e?e.getStart():1},getBackgroundColor:function(){var e=editor.doc.getBodyFormat();return e[ATTR_BODY.DS_BGC]?e[ATTR_BODY.DS_BGC]:DEFAULT_PAGE_BACKGROUND_COLOR},getAutoFieldValue:function(e){return this.doc.getAutoFieldValue(e)},isEditMode:function(){return this.doc.isEditMode()},isFillMode:function(){return this.doc.isFillMode()},setImagePreviewEnabled:function(e){this.imagePreviewEnabled=e},isImagePreviewEnabled:function(){return this.imagePreviewEnabled},getTableById:function(e){return this.doc.getTableById(e)},isMirrorMargins:function(){return this.doc.isMirrorMargins()},bindEvents:function(){PubSub.subscribe("Document/StyleChanged",this.updateTree,{context:this}),PubSub.subscribe("Document/BodyStyleChanged",this.updateDocumentBody,{context:this}),PubSub.subscribe("Document/ContentAdded",this.addToTree,{context:this}),PubSub.subscribe("Document/ContentDeleted",this.deleteFromTree,{context:this}),PubSub.subscribe("Document/BeforeModelUpdation",this.updateDocOpBuilder,{context:this}),PubSub.subscribe("Document/ContentMasked",this.updateTree,{context:this}),PubSub.subscribe("Document/ContentUnMasked",this.updateTree,{context:this})},unbindEvents:function(){PubSub.unsubscribe("Document/StyleChanged",this.updateTree,{context:this}),PubSub.unsubscribe("Document/BodyStyleChanged",this.updateDocumentBody,{context:this}),PubSub.unsubscribe("Document/ContentAdded",this.addToTree,{context:this}),PubSub.unsubscribe("Document/ContentDeleted",this.deleteFromTree,{context:this}),PubSub.unsubscribe("Document/BeforeModelUpdation",this.updateDocOpBuilder,{context:this}),PubSub.unsubscribe("Document/ContentMasked",this.updateTree,{context:this}),PubSub.unsubscribe("Document/ContentUnMasked",this.updateTree,{context:this})}}),e}();ListUtils=function(){"use strict";var e={},t={},i=function(e,t){var i=[];for(var n in e){var r=!U.isEqual(e[n],t[n]);r&&i.push(parseInt(n.substring(5)))}return i},n=function(e){for(var t in e){var i=e[t],n=editor.doc.getListBulletObj(i);n.img&&ImageCache.loadImageForCopy(n.img[ATTR_IMAGE.I_SRC])}},r=function(t){return e[t]},o=function(t,i){e[t]=i},a=function(e,t,i,n){var r="";if(i){var o=i.id,a=i.listLevel,s=(i.levelInfo,"");r=editor.doc.getListChar(o,a),r=r?r.replace(/\s/g,s):void 0;for(var l,d=-1,c=0;(l=ListLevelNo[c++])&&(d=r?r.indexOf(l):-1,!(d>-1)););d==-1&&(r=null)}n||(n=!1);var u;switch(e){case LIST_TYPE.NONE:var g=editor.doc.getListChar(o,a);u=g?g:"";break;case LIST_TYPE.IDEOGROPHICAL_TRADITIONAL:case LIST_TYPE.DECIMAL:u=t;break;case LIST_TYPE.LOWER_ALPHA:case LIST_TYPE.UPPER_ALPHA:var h=ListUtils.numberToAlpha(parseInt(t));u=e==LIST_TYPE.UPPER_ALPHA?h:h.toLowerCase();break;case LIST_TYPE.LOWER_ROMAN:case LIST_TYPE.UPPER_ROMAN:var f=ListUtils.numberToRoman(parseInt(t));u=e==LIST_TYPE.UPPER_ROMAN?f:f.toLowerCase();break;case LIST_TYPE.ORDINAL:u=ListUtils.numberToOrdinal(parseInt(t));break;case LIST_TYPE.DISC:u=ListUtils.fixedFromCharCode("0x25cf");break;case LIST_TYPE.CIRCLE:u=ListUtils.fixedFromCharCode("0x25cb");break;case LIST_TYPE.BOX:u=ListUtils.fixedFromCharCode("0x25a0");break;case 22:u=t>9?t:"0"+t;break;default:u=""}return e<=5&&!n&&(u+="."),r?ListUtils.getListNoByLevelInfo(r,t,i):u},s=function(e){var t=e%10,i=e%100;return 1==t&&11!=i?e+"st":2==t&&12!=i?e+"nd":3==t&&13!=i?e+"rd":e+"th"},l=function(e,t,i,n,r,o){for(o=e/1e3|0,e%=1e3,t=i="",n=5;e;i++,n^=7)for(r=e%n,e=e/n^0;r--;)t="IVXLCDM".charAt(r>2?i+e-(e&=-2)+(r=1):i)+t;return Array(o+1).join("M")+t},d=function(e){for(var t="",i=e;e>0;)i=e%26,e=parseInt(e/26),0==i&&(e-=1,i=26),t=String.fromCharCode(i+64)+t;return t},c=function(e){var t,i,n=0;e=e.toUpperCase();var r=e.length-1;for(t=0;t<e.length;t++)i=e.charCodeAt(t)-64,t!=r&&(i*=Math.pow(26,r-t)),n+=i;return n},u=function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e))):String.fromCharCode(e)},g=function(e,t,i){i=DocUtil.copyStyle(i);for(var n=i.id,r=i.listLevel,o=i.levelInfo,a=editor.doc.getListType(n,r),s=r;s>-1&&o;){if(e.indexOf(ListLevelNo[s])!=-1){var l=o["level"+s];a=editor.doc.getListType(n,s),e=e.replace(ListLevelNo[s],ListUtils.getListNumber(a,l,null,!0))}s--}return e},h=function(e,t){if("num"==t?t="1":"alphasml"==t?t="2":"alphacap"==t?t="3":"romansml"==t?t="4":"romancap"==t&&(t="5"),0==e)return e;var i="",n=0,r=new Array("IIII","V","XXXX","L","CCCC","D","MMMM");if(4==t||5==t){for(var o=0;o<r.length;o++){var a=r[o].length+1,s=e%a;i=r[o].substr(0,s)+i,e=(e-s)/a}i=i.replace(/DCCCC/g,"CM").replace(/CCCC/g,"CD").replace(/LXXXX/g,"XC"),i=i.replace(/XXXX/g,"XL").replace(/VIIII/g,"IX").replace(/IIII/g,"IV")}else if(2==t||3==t){do n=e%26,0==n&&(n=26,e-=1),i=String.fromCharCode(n+64)+i;while(0!=(e=parseInt(e/26)))}else 1==t&&(i=""+e);return 2==t||4==t?i.toLowerCase():i},f=function(e){var t=J(e).css("list-style-type");if("none"!=t)switch(t){case"decimal":t=LIST_TYPE.DECIMAL;break;case"lower-alpha":t=LIST_TYPE.LOWER_ALPHA;break;case"upper-alpha":t=LIST_TYPE.UPPER_ALPHA;break;case"lower-roman":t=LIST_TYPE.LOWER_ROMAN;break;case"upper-roman":t=LIST_TYPE.UPPER_ROMAN;break;case"disc":t=LIST_TYPE.DISC;break;case"circle":t=LIST_TYPE.CIRCLE;break;case"square":t=LIST_TYPE.BOX;break;default:t=1}else t=DomUtil.nodeNameEquals(e,"ol")?LIST_TYPE.DECIMAL:LIST_TYPE.DISC;return t},p=function(e,t){if(!e)return!1;var i=e.indexOf(ListLevelNo[t.listLevel]);i==-1&&(i=e.length);var n=e.substring(0,i),r=e.substring(i+1,e.length);return n=ListUtils.getListNoByLevelInfo(n,null,t),r=ListUtils.getListNoByLevelInfo(r,null,t),{prefix:n,suffix:r}},E=function(e){delete e[ATTR_PARAGRAPH.PS_TYPE],delete e[ATTR_PARAGRAPH.LS_DATA]},T=function(e,t){e[ATTR_PARAGRAPH.PS_TYPE]="list",e[ATTR_PARAGRAPH.LS_DATA]=t},O=function(e){return e&&e[ATTR_PARAGRAPH.PS_TYPE]&&e[ATTR_PARAGRAPH.PS_TYPE]==LIST_KEYS.LIST},m=function(e){return e&&e[ATTR_PARAGRAPH.LS_DATA]&&0==e[ATTR_PARAGRAPH.LS_DATA].id},I=function(e){if(e&&e.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)){var t=e[ATTR_PARAGRAPH.LS_DATA].id,i=e[ATTR_PARAGRAPH.LS_DATA].l,n=editor.doc.getListObj(t),r=n["level"+i].type,o=n["level"+i][ATTR_PARAGRAPH.BULLET_ID],a=editor.doc.getListBulletObj(o);return a&&r==LIST_TYPE.IMAGE&&(a.hasOwnProperty("img")||a.hasOwnProperty("svg_id"))}return!1},D=function(e){var i=e.listFormat;t={};for(var n in i)if("bulletStyles"!=n&&!isNaN(parseInt(n))){var r=i[n];if(!r.hasOwnProperty("abstract")&&r.hasOwnProperty("refAbstractNumId")){var o=r.refAbstractNumId;t.hasOwnProperty(o)||(t[o]=[]),t[o].indexOf(n)==-1&&t[o].push(n)}}},R=function(e,i){if(!i.hasOwnProperty("abstract")&&i.hasOwnProperty("refAbstractNumId")){var n=i.refAbstractNumId;t.hasOwnProperty(n)||(t[n]=[]),t[n].indexOf(e)==-1&&t[n].push(e)}},S=function(e){try{var i=editor.doc.getListObj(e);if(i.hasOwnProperty("refAbstractNumId")){var n=i.refAbstractNumId;return t[n].length>1}}catch(e){return!1}},C=function(e){try{var t=editor.doc.getListObj(e);if(t.hasOwnProperty("refAbstractNumId"))return t.refAbstractNumId}catch(e){return null}},A=function(e){return t[e]},v=function(e){var t=editor.doc.getRawListObj(e);return!(!t.hasOwnProperty("type")||"abstract"!=t.type)},_=function(){return t},P=function(e){var t=editor.doc.getListType(e.id,e.listLevel);return!(t>5&&t<9||t===LIST_TYPE.IMAGE)},N=function(e){var t=editor.doc.getListObj(e.id),i=t&&t["level"+e.l];return!(!e||editor.doc.getListType(e.id,e.l)!==LIST_TYPE.IMAGE&&e.t!==LIST_TYPE.IMAGE||!i.hasOwnProperty("data-custom_data"))},b=function(e){if(e&&e.hasOwnProperty("id")&&e.hasOwnProperty("l")){var t=e.id,i=e.l,n=editor.doc.getListObj(t),r=n["level"+i].type,o=n["level"+i][ATTR_PARAGRAPH.BULLET_ID],a=editor.doc.getListBulletObj(o);return r&&a&&r===LIST_TYPE.SYMBOL&&a.hasOwnProperty("c")}return!1},L=function(e){if(e&&e.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)){var t=e[ATTR_PARAGRAPH.LS_DATA].id,i=e[ATTR_PARAGRAPH.LS_DATA].l,n=editor.doc.getListObj(t),r=n["level"+i].type,o=n["level"+i][ATTR_PARAGRAPH.BULLET_ID],a=editor.doc.getListBulletObj(o);return r&&a&&r===LIST_TYPE.IMAGE&&a.hasOwnProperty("svg_id")}return!1},w=function(e){var t,i=editor.doc.getListType(e.id,e.l),n=!(i>5&&i<9);return t=i===LIST_TYPE.IMAGE?document.createElement("ul"):n?document.createElement("ol"):document.createElement("ul")};return PubSub.subscribe("List/newListAdded",R),PubSub.subscribe("Document/Model/InitStart",D),{getChangedListLevel:i,handleImageCopyForCheckList:n,getSVGImgIds:r,setSVGImgIds:o,getListNumber:a,numberToRoman:l,getListTypeFromHtmlNode:f,bullet_str:h,numberToAlpha:d,AlphatoNumber:c,fixedFromCharCode:u,getListNoByLevelInfo:g,getPrefixSuffixInfoForRendering:p,fillListProps:T,removeListProps:E,abstractCache:_,isList:O,isHeadingList:m,isOrderedList:P,isCheckList:N,isImageList:I,numberToOrdinal:s,isSymbolList:b,isSvgImageList:L,isAbstractList:S,isAbstractListID:v,getAbstractId:C,getListIdsSharingCommonAbstractId:A,buildCacheForAbstractIds:D,updateCache:R,getParentContainer:w}}();var DTViewManager=function(){"use strict";function e(e){this.dtDoc=e,this.nodeViewMap={},this.sectionViewMap={},this.headerFooterViewMap={},this.metaSectionMap={},this.contentSections=new LinkedList,this.bindEvents()}var t=function(e){e.on(DTVIEW.VIEW_ADDED,this.handleChildDTViewAdd,this),e.on(DTVIEW.VIEW_REMOVED,this.handleChildDTViewRemove,this),e.on(DTVIEW.NOTE_SEQUENCE_NUMBER_UPDATED,this.handleNoteSequenceNumberUpdate,this)},i=function(e){e.off(DTVIEW.VIEW_ADDED,this.handleChildDTViewAdd,this),e.off(DTVIEW.VIEW_REMOVED,this.handleChildDTViewRemove,this),e.off(DTVIEW.NOTE_SEQUENCE_NUMBER_UPDATED,this.handleNoteSequenceNumberUpdate,this)};return BaseEventHandler.call(e.prototype),e.prototype.init=function(){for(var e=this.dtDoc.getAllSections(),t=0;t<e.length;t++)this.handleSectionAdd(e[t])},e.prototype.destroy=function(){var e,t;for(e in this.sectionViewMap)t=this.sectionViewMap[e].getNode(),this.handleSectionRemove(t);this.trigger(DOCUMENT.DTVIEWMANAGER_DESTROYED),this.unbindEvents(),this.contentSections=null,this.metaSectionMap={},this.headerFooterViewMap={},this.sectionViewMap={},this.nodeViewMap={},this.dtDoc=null},e.prototype.bindEvents=function(){this.dtDoc.on(DTNODE.SECTION_ADDED,this.handleSectionAdd,this),this.dtDoc.on(DTNODE.SECTION_UPDATED,this.handleSectionUpdate,this),this.dtDoc.on(DTNODE.SECTION_REMOVED,this.handleSectionRemove,this),this.dtDoc.on(DOCUMENT.REFRESH_TREE,this.handleRefreshTree,this),this.dtDoc.on(DOCUMENT.BEFORE_TREE_DESTROY,this.handleBeforeTreeReset,this),this.dtDoc.on(DOCUMENT.AFTER_TREE_DESTROY,this.handleAfterTreeReset,this),this.dtDoc.on(DOCUMENT.REFRESH_DOCVIEWS,this.handleRefreshDocViews,this),this.dtDoc.on(DOCUMENT.DTDOCUMENT_DESTROYED,this.destroy,this)},e.prototype.unbindEvents=function(){this.dtDoc.off(DTNODE.SECTION_ADDED,this.handleSectionAdd,this),this.dtDoc.off(DTNODE.SECTION_UPDATED,this.handleSectionUpdate,this),this.dtDoc.off(DTNODE.SECTION_REMOVED,this.handleSectionRemove,this),this.dtDoc.off(DOCUMENT.REFRESH_TREE,this.handleRefreshTree,this),this.dtDoc.off(DOCUMENT.BEFORE_TREE_DESTROY,this.handleBeforeTreeReset,this),this.dtDoc.off(DOCUMENT.AFTER_TREE_DESTROY,this.handleAfterTreeReset,this),this.dtDoc.off(DOCUMENT.REFRESH_DOCVIEWS,this.handleRefreshDocViews,this),this.dtDoc.off(DOCUMENT.DTDOCUMENT_DESTROYED,this.destroy,this)},e.prototype.handleSectionAdd=function(e){var i=new DTViews[e.sectionType](e,this);this.sectionViewMap[e.getId()]=i;var n=e.getSectionType();if(n===SECTION_TYPES.CONTENT){for(var r=e.prev,o=null;r&&!(o=this.sectionViewMap[r.getId()]);)r=r.prev;o?this.contentSections.insertAfter(i,o):this.contentSections.insertAsFirst(i)}else HF_SECTIONS.contains(n)?this.headerFooterViewMap[e.getId()]=i:META_SECTIONS.contains(n)&&(this.metaSectionMap[e.getId()]=i);t.call(this,i),this.trigger(DTVIEW.SECTION_ADDED,i)},e.prototype.handleChildDTViewAdd=function(e){var t=e.getNode();this.nodeViewMap[t.getId()]=e;},e.prototype.handleChildDTViewRemove=function(e){delete this.nodeViewMap[e.getId()]},e.prototype.handleSectionUpdate=function(e,t,i){var n=this.sectionViewMap[e.getId()];n.update(t,i),this.trigger(DTVIEW.SECTION_UPDATED,n,t,i)},e.prototype.handleSectionRemove=function(e){var t=e.getId(),n=this.sectionViewMap[t],r=n.getNode().getSectionType(),o=n.next,a=n.prev;r===SECTION_TYPES.CONTENT?this.contentSections.remove(n):HF_SECTIONS.contains(r)?delete this.headerFooterViewMap[t]:META_SECTIONS.contains(r)&&delete this.metaSectionMap[t],this.trigger(DTVIEW.SECTION_REMOVED,n,o,a),i.call(this,n),n.remove(),delete this.sectionViewMap[t],n.destroy()},e.prototype.handleNoteSequenceNumberUpdate=function(e,t){for(var i=e.next;i;){var n=i.getNoteTypeInfo(t);n.pgrst===NOTE_RESTART_NUM.CONTINUOUS?(i.updateNoteNumbers(t),i=i.next):i=null}},e.prototype.handleRefreshTree=function(e){this.trigger(DOCUMENT.REFRESH_TREE,e)},e.prototype.handleBeforeTreeReset=function(){this.trigger(DOCUMENT.BEFORE_TREE_DESTROY)},e.prototype.handleAfterTreeReset=function(){this.trigger(DOCUMENT.AFTER_TREE_DESTROY)},e.prototype.handleRefreshDocViews=function(){this.trigger(DOCUMENT.REFRESH_DOCVIEWS)},e.prototype.getContentDTViews=function(){return this.contentSections},e.prototype.getFirstContentDTView=function(){return this.contentSections.first||null},e.prototype.getLastContentDTView=function(){return this.contentSections.last||null},e.prototype.getDTSectionViewByID=function(e){return this.sectionViewMap[e]||null},e.prototype.getDTSectionViewByIndex=function(e){var t,i;for(t in this.sectionViewMap)if(i=this.sectionViewMap[t],i.getIndex()<=e&&e<=i.getEndIndex())return i;return null},e.prototype.getAllSectionDTViews=function(){return this.sectionViewMap},e.prototype.getAllHeaderFooterDTViews=function(){return this.headerFooterViewMap},e.prototype.getAllMetaDTViews=function(){return this.metaSectionMap},e.prototype.getNoteViewsBetween=function(e,t,i){var n=this.getDTSectionViewByIndex(t),r=this.getDTSectionViewByIndex(i),o=[];if(n&&n.getSectionType()==e&&r&&r.getSectionType()==e){var a=n.getContainingSection(),s=r.getContainingSection();if(a.getIndex()>s.getIndex()){var l=a;a=s,s=l;var d=t;t=i,i=d}for(var c;a!=s;)c=a.getNoteViewsBetween(e,t,i),o=o.concat(c),a=a.next;c=s.getNoteViewsBetween(e,t,i),o=o.concat(c)}return o},e.prototype.getNoteRanges=function(e,t,i){var n,r=[],o=this.getNoteViewsBetween(e,t,i),a=o.length;if(o[0]&&o.length>1&&!(o[0].getNode().start<=t&&o[0].getNode().end<=i)){var s=t;t=i,i=s}for(var l=0;l<a;l++)n=o[l],r[l]={start:n.getIndex()+1,end:n.getEndIndex()},n.getIndex()<t&&t<n.getEndIndex()&&(r[l].start=t),n.getIndex()<i&&i<n.getEndIndex()&&(r[l].end=i);return r},e.prototype.getFirstNoteView=function(e){for(var t=this.getFirstContentDTView(),i=null;t&&!(i=t.getFirstNote(e));)t=t.next;return i},e.prototype.getLastNoteView=function(e){for(var t=this.getLastContentDTView(),i=null;t&&!(i=t.getLastNote(e));)t=t.prev;return i},e.prototype.getNoteCount=function(e){for(var t=this.getFirstContentDTView(),i=0;t;)i+=t.getNoteCount(e),t=t.next;return i},e.prototype.getNoteNumber=function(e){for(var t=e.getContainingSection(),i=e.getSectionType(),n=this.getFirstContentDTView(),r=0;n&&n!=t;)r+=n.getNoteCount(i),n=n.next;return r+=t.getNoteNumber(e)},e.prototype.getDTView=function(e){return"section"===e.type?this.sectionViewMap[e.getId()]||null:this.nodeViewMap[e.getId()]||null},e.prototype.getDTViewById=function(e){return this.nodeViewMap[e]||null},e}(),FloatImage=function(){"use strict";function e(e,t){this.id=Utils.randomId("f_img"),this.height=parseFloat(e.height),this.width=parseFloat(e.width),this.wrapType=e[ATTR_IMAGE.I_WRAP_TYPE],this.index=e.index,this.fid=e.fid,this.formatId=e.id,this.positionV=e[ATTR_IMAGE.I_V_POSITION],this.positionH=e[ATTR_IMAGE.I_H_POSITION],this.shapeData=e.shapeData,this.isFillableField=e.isFillableField||!1,this.parentId=e.parentId,this.src=e.src,this.docView=t,this.tc=e.tc,this.subType=e.subType,this.affectedNodes=[],this.isShape=!!this.shapeData,this.formats=e.formats,this.renderingFormat=e.renderingFormat}var t={ABSOLUTE:"absolute",RELATIVE:"relative",ALIGN:"align"},i={LEFT:"left",CENTER:"center",RIGHT:"right",TOP:"top",BOTTOM:"bottom",INSIDE:"inside",OUTSIDE:"outside"},n={CHARACTER:"character",LINE:"line",PARAGRAPH:"paragraph",COLUMN:"column",MARGIN:"margin",RIGHT_MARGIN:"rightmargin",LEFT_MARGIN:"leftmargin",TOP_MARGIN:"topmargin",BOTTOM_MARGIN:"bottommargin",INSIDE_MARGIN:"insidemargin",OUTSIDE_MARGIN:"outsidemargin",PAGE:"page"},r={left:0,inside:0,center:.5,right:1,outside:1,top:0,bottom:1};return extend(e.prototype,{isShape:function(){return!!this.shapeData},getAbsIndex:function(){return this.getView()?this.getIndex()+this.getView().getNodeStartIndex():-1},getSubType:function(){return this.subType},getTC:function(){return this.tc},getSrc:function(){return this.src},getNodeId:function(){return this.parentId},getWrapType:function(){return this.wrapType},getTop:function(){var e=this.getView(),t=parseFloat(this.positionV[ATTR_IMAGE.I_TOP]||0);if(e){var i=e.getColumn(),n=i.getFirstParaView(),r=!(!i||!n)&&e.getId()===n.getId();return t<0&&(ZWArrayUtils.arrayContains([IMAGE_ALIGN.FRONT,IMAGE_ALIGN.BEHIND],this.getWrapType())||r||(t=0)),t-this.getSplitTop()}return t},getSplitTop:function(){return this.getView().getSplitHeight()},getLeft:function(e){var n=0,r=this.wrapType,o=this.positionH,a=this.getView().getColumn().getWidth();if(r===WRAP_TYPE.SQUARE&&o[ATTR_IMAGE.I_POSITION_TYPE]===t.ALIGN){var s=this.getAlignHValue(e);s===i.RIGHT?n=a-this.getActualWidth():s===i.LEFT&&(n=0)}else[WRAP_TYPE.SQUARE,WRAP_TYPE.FRONT,WRAP_TYPE.BEHIND].contains(r)&&(n=o[ATTR_IMAGE.I_LEFT]);return n},getAbsTop:function(e){return this.getView()?this.getView().getAbsTop(e)+this.getTop():0},getAbsLeft:function(e){return this.getView()?this.getView().getAbsLeft(e)+this.getLeft():0},isNonWrappingImage:function(){return this.wrapType===WRAP_TYPE.FRONT||this.wrapType===WRAP_TYPE.BEHIND},getLeftForCharacterPositionedImage:function(e){var i=DocLayoutManager.getLineAtIndex(this.getIndex()+this.getView().getNodeStartIndex()),n=0;if(!i)return n;n=DocLayoutManager.getLeftRelativeToPageAtIndex(this.getIndex()+this.getView().getNodeStartIndex());var o=this.positionH[ATTR_IMAGE.I_POSITION_TYPE];if(o===t.ALIGN){var a=this.getAlignHValue(e),s=this.getFormatDimensions().width;n-=s*r[a]}else o===t.ABSOLUTE&&(n+=this.positionH[ATTR_IMAGE.I_LEFT]);return n},getTopForLinePositionedImage:function(e){var i=DocLayoutManager.getLineAtIndex(this.getIndex()+this.getView().getNodeStartIndex()),n=0;if(!i)return n;var o=i.getAbsTop(VIEW.PAGE),a=this.positionV,s=a[ATTR_IMAGE.I_POSITION_TYPE];if(s===t.ALIGN){var l=this.getAlignVValue(e),d=this.getFormatDimensions().height;n=o-d*r[l]}else s===t.ABSOLUTE&&(n=o+a[ATTR_IMAGE.I_TOP]);return n},getPositionHFrom:function(e){return this.getPositionFrom(this.positionH,e)},getPositionVFrom:function(e){return this.getPositionFrom(this.positionV,e)},getAlignHValue:function(e){return this.getAlignValue(this.positionH,e)},getAlignVValue:function(e){return this.getAlignValue(this.positionV,e)},getAlignValue:function(e,t){var n=e[ATTR_IMAGE.I_ALIGN_VAL];return t?n===i.INSIDE?i.OUTSIDE:n===i.OUTSIDE?i.INSIDE:n:n},getPositionFrom:function(e,t){var i=e[ATTR_IMAGE.I_POSITION_FROM];return t?i===n.INSIDE_MARGIN?n.OUTSIDE_MARGIN:i===n.OUTSIDE_MARGIN?n.INSIDE_MARGIN:i:i},isBookLayoutImage:function(){var e=this.positionH[ATTR_IMAGE.I_ALIGN_VAL],t=this.positionV[ATTR_IMAGE.I_ALIGN_VAL],r=this.positionH[ATTR_IMAGE.I_POSITION_FROM],o=this.positionV[ATTR_IMAGE.I_POSITION_FROM];return[e,t].contains(i.INSIDE)||[e,t].contains(i.OUTSIDE)||[r,o].contains(n.INSIDE_MARGIN)||[r,o].contains(n.OUTSIDE_MARGIN)},getPageOffset:function(e){var r=this.getView();if(!r)return null;var o,a,s=this.positionH,l=s[ATTR_IMAGE.I_POSITION_TYPE]===t.ALIGN?this.getAlignHValue(e):this.wrapType,d=this.getPositionHFrom(e),c=this.getPositionVFrom(e),u=r.getSection();return this.isNonWrappingImage()?(o=this.getLeftFromPosition(e),a=this.getTopFromPosition(e),d===n.CHARACTER&&(o=this.getLeftForCharacterPositionedImage(e)),c===n.LINE&&(a=this.getTopForLinePositionedImage()),d===n.COLUMN&&(o+=u.getLeft())):(a=this.positionV[ATTR_IMAGE.I_TOP]-this.getSplitTop(),o=l===i.RIGHT?r.getWidth()-this.getActualWidth():l===i.LEFT?0:s[ATTR_IMAGE.I_LEFT]),{top:a,left:o}},getTopFromPosition:function(e){var o=0,a=this.positionV,s=parseFloat(a[ATTR_IMAGE.I_TOP]),l=this.getView();if(!l)return s;var d=l.getSection(),c=d.getGroup(),u=c.getPageHeight(),g=d.getMargin(),h=g.top,f=g.bottom,p=a[ATTR_IMAGE.I_POSITION_TYPE],E=this.getPositionVFrom(e),T=this.getFormatDimensions().height,O=u-(h+f+c.getGutterTop()),m=this.getAlignVValue(a,e),I=c.getHeaderTop(),D=c.getFooterBottom();if(p===t.RELATIVE)E===n.PAGE?o=s/100*u:E===n.MARGIN?o=s/100*O+h:E===n.BOTTOM_MARGIN||E===n.OUTSIDE_MARGIN?o=h+O+s/100*f:E!==n.TOP_MARGIN&&E!==n.INSIDE_MARGIN||(o=s/100*h);else if(p===t.ABSOLUTE)switch(E){case n.PARAGRAPH:o=l.getAbsTop(VIEW.PAGE)+this.getTop();break;case n.BOTTOM_MARGIN:case n.OUTSIDE_MARGIN:o+=O;case n.MARGIN:o+=h;case n.PAGE:case n.TOP_MARGIN:case n.INSIDE_MARGIN:o+=s}else if(p===t.ALIGN)if(m===i.INSIDE&&E===n.PAGE)o=I/2;else if(m===i.OUTSIDE&&E===n.PAGE)o=h+O+(f-D/2-T);else{var R=r[m];switch(E){case n.PAGE:o=(u-T)*R;break;case n.TOP_MARGIN:case n.INSIDE_MARGIN:o=(h-T)*R;break;case n.MARGIN:o=h+(O-T)*R;break;case n.BOTTOM_MARGIN:case n.OUTSIDE_MARGIN:o=h+O+(f-T)*R}}return o},getLeftFromPosition:function(e){var i,o=this.positionH,a=o[ATTR_IMAGE.I_LEFT],s=o[ATTR_IMAGE.I_POSITION_TYPE],l=this.getPositionHFrom(e),d=this.getView();if(!d)return a;var c=d.getSection(),u=c.getLeft(),g=c.getGroup(),h=g.getPageWidth(),f=c.getWidth(),p=h-(u+f),E=this.getAlignHValue(e),T=this.getFormatDimensions().width,O=d.getColumn(),m=O.getLeft(),I=O.getWidth(),D=d.getParent();if(s===t.RELATIVE)switch(l){case n.PAGE:i=a/100*h;break;case n.MARGIN:i=a/100*f+u;break;case n.RIGHT_MARGIN:case n.OUTSIDE_MARGIN:i=u+f+a/100*p;break;case n.LEFT_MARGIN:case n.INSIDE_MARGIN:i=a/100*u}else if(s===t.ABSOLUTE)switch(l){case n.PAGE:case n.INSIDE_MARGIN:case n.LEFT_MARGIN:i=a;break;case n.MARGIN:i=a+u;break;case n.COLUMN:i=m+a,D.getType()==VIEW.CELL&&(i+=D.getContentLeft()+D.getAbsLeft(VIEW.COLUMN));break;case n.RIGHT_MARGIN:case n.OUTSIDE_MARGIN:i=u+f+a}else if(s===t.ALIGN){var R=r[E];switch(l){case n.PAGE:i=(h-T)*R;break;case n.LEFT_MARGIN:case n.INSIDE_MARGIN:i=(u-T)*R;break;case n.MARGIN:i=u+(f-T)*R;break;case n.COLUMN:i=m+(I-T)*R;break;case n.RIGHT_MARGIN:case n.OUTSIDE_MARGIN:i=u+f+(p-T)*R}}return i},getView:function(){return this.docView},getAffectedNodes:function(){return this.affectedNodes},getHeight:function(){return this.isNonWrappingImage()?0:this.height},getActualHeight:function(){return this.height},getActualWidth:function(){return this.width},getWidth:function(){return this.isNonWrappingImage()?0:this.width},getFormatDimensions:function(){var e={},t=this.formats;return e.width=t[ATTR_IMAGE.I_WID],e.height=t[ATTR_IMAGE.I_HT],t&&t.hasOwnProperty(ATTR_IMAGE.I_ROTATE)&&(e=TransformationUtils.getTransformedSize(t[ATTR_IMAGE.I_ROTATE],t[ATTR_IMAGE.I_WID],t[ATTR_IMAGE.I_HT])),e},getIndex:function(){return this.index},getId:function(){return this.id},getFId:function(){return this.fid},getFormatId:function(){return this.formatId},updateDocView:function(e){this.docView=e},addToAffectedNodes:function(e){if(this.docView.getId()!==e.getId()){for(var t=this.getAffectedNodes(),i=0;i<t.length;i++)if(t[i].getId()===e.getId())return;this.affectedNodes.push(e)}},removeFromAffectedNodes:function(e){for(var t=this.getAffectedNodes(),i=0;i<t.length;i++)t[i].getId()===e.getId()&&this.affectedNodes.splice(i,1)},updateHeight:function(e){this.height=e},updateWidth:function(e){this.width=e},updateIndex:function(e){this.index=e},destroy:function(){this.height=0,this.width=0,this.wrapType="",this.index=0,this.fid="",this.shapeData={},this.parentId="",this.docView=null,this.affectedNodes=[]},updateProperties:function(e){this.height=parseFloat(e.height),this.width=parseFloat(e.width),this.wrapType=e[ATTR_IMAGE.I_WRAP_TYPE],this.index=e.index,this.fid=e.fid,this.positionV=e[ATTR_IMAGE.I_V_POSITION],this.positionH=e[ATTR_IMAGE.I_H_POSITION],this.shapeData=e.shapeData,this.parentId=e.parentId,this.src=e.src,this.tc=e.tc,this.subType=e.subType,this.isShape=!!this.shapeData,this.formats=e.formats,this.renderingFormat=e.renderingFormat},addAllAffectedNodesToUpdateQueue:function(){for(var e,t=this.getAffectedNodes(),i=0;i<t.length;i++)e=t[i].getSection(),e&&t[i].addToUpdateQueue(OP_TYPE.UPDATE,!0)},resetAllAffectedNodes:function(){this.affectedNodes.splice(0,this.affectedNodes.length)},moveFloatImageToDocView:function(e){this.addAllAffectedNodesToUpdateQueue(),this.resetAllAffectedNodes(),this.updateDocView(e)}}),e}(),TextBoxFloatObject=function(e){"use strict";function t(t){this.isTextBox=!0,e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,extend(t.prototype,{updateDocView:function(t){if(e.prototype.updateDocView.apply(this,arguments),this.docView){var i=this.docView.getLayoutManager();i.getSectionViews(this.getFormatId())[0]}}}),t}(FloatImage),DTView=function(){"use strict";function e(e,t,i){this.id=e.id,this.node=e,this.parent=t,this.section=i,this.type=e.type,this.isSetToRemove=!1,this.type===VIEW.PARA&&this.type===VIEW.HR||(this.childViews=new LinkedList)}return extend(e.prototype,{getRawFormatAt:function(e){return editor.doc.getRawFormatAt(e)},getComputedFormatAt:function(e,t,i,n){return editor.doc.getComputedFormatAt(e,t,i,n)},getThemeStyleFormat:function(){var e=this.getNode().getIndex();return editor.doc.getThemeStyleFormatAt(e)},getCharAt:function(e){return editor.doc.getCharAt(e)},isParentSetToRemove:function(){return this.node.isParentSetToRemove()},getIndex:function(){return this.node.getIndex()},getEndIndex:function(){return this.node.getEndIndex()},getNode:function(){return this.node},getId:function(){return this.id},getParent:function(){return this.parent},getChildViews:function(){return this.childViews||null},getFirstChild:function(){return this.childViews.first||null},getLastChild:function(){return this.childViews.last||null},getChildViewsLength:function(){return this.childViews.length||0},getType:function(){return this.type},getSection:function(){return this.section},getNextView:function(){return this.next},getPrevView:function(){return this.prev},preRemoveDTView:function(){},isReplicableView:function(){return this.getSection().isReplicableView()},adjustBorder:function(){},setRemoveStatus:function(e){if(this.isSetToRemove=e,this.childViews)for(var t=this.childViews.first;t;)t.setRemoveStatus(e),t=t.next},toBeRemoved:function(){return this.isSetToRemove},destroy:function(){this.type===VIEW.PARA&&this.type===VIEW.HR||(this.childViews=null),this.type="",this.section=null,this.parent=null,this.node=null,this.id=""}}),e}(),SectionDTView=function(e,t,i){"use strict";function n(e,t){this.type=e.type,this.node=e,this.viewManager=t,this.id=e.getId(),this.viewMap={},this.childViews=new i,this.start=e.start,this.end=e.end,this.bindEvents()}return e.call(n.prototype),extend(n.prototype,{bindEvents:function(){this.node.on(DTNODE.SECTION_BUILD_STARTED,this.handleSectionOpStart,this),this.node.on(DTNODE.SECTION_BUILD_PROGRESS,this.handleSectionOpProgress,this),this.node.on(DTNODE.SECTION_BUILD_COMPLETE,this.handleSectionOpComplete,this),this.node.on(DTNODE.SECTION_BUILD_PRE_PROCESS_STARTED,this.handleSectionBuildPreProcessStart,this),this.node.on(DTNODE.SECTION_BUILD_PRE_PROCESS_COMPLETE,this.handleSectionBuildPreProcessComplete,this),this.node.on(DTNODE.REFRESH_TREE,this.handleRefreshTree,this)},unbindEvents:function(){this.node.off(DTNODE.SECTION_BUILD_STARTED,this.handleSectionOpStart,this),this.node.off(DTNODE.SECTION_BUILD_PROGRESS,this.handleSectionOpProgress,this),this.node.off(DTNODE.SECTION_BUILD_COMPLETE,this.handleSectionOpComplete,this),this.node.off(DTNODE.SECTION_BUILD_PRE_PROCESS_STARTED,this.handleSectionBuildPreProcessStart,this),this.node.off(DTNODE.SECTION_BUILD_PRE_PROCESS_COMPLETE,this.handleSectionBuildPreProcessComplete,this),this.node.off(DTNODE.REFRESH_TREE,this.handleRefreshTree,this)},remove:function(){},update:function(){},handleSectionOpStart:function(){this.trigger(DTVIEW.SECTION_BUILD_STARTED,this)},handleSectionOpProgress:function(e){var t=e.node,i=e.op,n={isCollabOp:e.collabop,triggerPagination:e.triggerPagination};switch(i){case OP_TYPE.CREATE:this.addToSectionView(t);break;case OP_TYPE.MODIFY:n.contentIndex=e.contentIndex,this.updateInSectionView(t,n);break;case OP_TYPE.UPDATE:n.forceReRender=!0,n.contentIndex=e.contentIndex,this.updateInSectionView(t,n);break;case OP_TYPE.UPDATE_LIST:this.updateListInSectionView(t);break;case OP_TYPE.REMOVE:var r=this.viewManager.getDTView(t);if(!r)return;this.removeFromSectionView(t,n);break;case OP_TYPE.ADJUST_BORDER:this.adjustTableBorder(t)}var o=this.viewManager.getDTView(t);this.propagateVia(this.viewManager,DTVIEW.SECTION_OP_PROCESSED,i,t,o)},handleSectionOpComplete:function(e){this.trigger(DTVIEW.SECTION_BUILD_COMPLETE,e,this)},handleSectionBuildPreProcessStart:function(){this.trigger(DTVIEW.SECTION_BUILD_PRE_PROCESS_STARTED)},handleSectionBuildPreProcessComplete:function(e){this.trigger(DTVIEW.SECTION_BUILD_PRE_PROCESS_COMPLETE,e)},handleRefreshTree:function(){this.trigger(DTVIEW.REFRESH_TREE,this)},addToSectionView:function(e){for(var t=e.parent,i=this.viewManager.getDTView(t),n=e.prev,r=null,o=i.childViews,a=new DTViews[e.type](e,i,this);n&&!(r=this.viewManager.getDTView(n));)n=n.prev;r?o.insertAfter(a,r):o.insertAsFirst(a),this.viewMap[a.id]=a,a.createDTView(),this.trigger(DTVIEW.VIEW_ADDED,a)},updateInSectionView:function(e,t){var i=this.viewManager.getDTView(e);i.updateDTView(),this.trigger(DTVIEW.VIEW_UPDATED,i,t)},updateListInSectionView:function(e){var t=this.viewManager.getDTView(e);this.trigger(DTVIEW.VIEW_LIST_UPDATED,t)},removeFromSectionView:function(e){var t=this.viewManager.getDTView(e);t.setRemoveStatus(!0),this.removeView(t)},adjustTableBorder:function(e){var t=this.viewManager.getDTView(e);this.trigger(DTVIEW.VIEW_ADJUST_BORDER,t)},removeView:function(e){if(e.childViews)for(;e.childViews.last;)this.removeView(e.childViews.last);e.parent.childViews.remove(e),delete this.viewMap[e.id],e.preRemoveDTView(),this.trigger(DTVIEW.VIEW_REMOVED,e),e.removeDTView()},destroy:function(){},isEmptyView:function(){var e=this.childViews.first;return null==e},getNodeId:function(){return this.node.id},getNode:function(){return this.node},isReplicableView:function(){return!1},isReferingTo:function(e){return!1},isDirtyNode:function(e){return this.node.isDirtyNode(e.getNode())},getOpTypeInUpdateQueue:function(e){return this.node.getOpTypeInUpdateQueue(e.getNode())},getIndex:function(){return this.node.getIndex()},getEndIndex:function(){return this.node.getEndIndex()},getColumnDetails:function(){return null},getSectionType:function(){return this.node.getSectionType()},getFormats:function(){return this.node.getFormats()},getId:function(){return this.id},getChildViews:function(){return this.childViews||null},getFirstChild:function(){return this.childViews.first||null},isFirstView:function(e){return this.childViews.first==e},getLastChild:function(){return this.childViews.last||null},getChildViewsLength:function(){return this.childViews.length||0},getType:function(){return this.type},getHFType:function(){return this.getNode().getHFType()},getRawFormatAt:function(e){return editor.doc.getRawFormatAt(e)}}),n}(BaseEventHandler,Utils,LinkedList),MetaDTView=function(e){"use strict";function t(t,i){e.apply(this,arguments),this.containingSection=null}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,extend(t.prototype,{remove:function(){this.containingSection&&this.containingSection.removeMetaView(this,this.getSectionType()),this.containingSection=null,e.prototype.remove.apply(this,arguments)},bindEvents:function(){e.prototype.bindEvents.apply(this,arguments),this.node.on(DTNODE.METASECTION_REFERENCE_UPDATED,this.handleReferenceParaUpdate,this)},unbindEvents:function(){e.prototype.unbindEvents.apply(this,arguments),this.node.off(DTNODE.METASECTION_REFERENCE_UPDATED,this.handleReferenceParaUpdate,this)},handleReferenceParaUpdate:function(){var e=this.viewManager.getDTSectionViewByIndex(this.getRangeIndex());if(this.containingSection){if(this.containingSection==e)return;this.containingSection.removeMetaView(this,this.getSectionType())}this.containingSection=e,this.containingSection.addMetaView(this,this.getSectionType())},getRangeIndex:function(){return this.getNode().getRangeIndex()},getContainingSection:function(){return this.containingSection},getRootSection:function(){return this.getContainingSection()},getRootSectionType:function(){return this.getRootSection().getSectionType()},isReplicableView:function(){return!!this.getRootSection()&&this.getRootSection().isReplicableView()},isReferingTo:function(e){var t=this.getRootSection();return!!t&&t.isReferingTo(e)},belongsToPara:function(e){var t=this.getNode().getContainingPara().getId();return t==e}}),t}(SectionDTView),NoteDTView=function(e,t,i,n){"use strict";function r(t,i){e.apply(this,arguments),this.referenceChar="",this.referenceCharWidth=0}var o=function(e,t){var i=t.length,n="",r="",o=e%i,a=Math.ceil(e/i);0==o&&(o=i),n=t[o-1];for(var s=0;s<a;s++)r+=n;return r},a=function(e,i){var n,r=e.fmt;return n="chicago"==r?o(i,e.refchars):t.bullet_str(i,r)};return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,extend(r.prototype,{hasCustomChar:function(){return!!this.getNode().getFormats().refchar},update:function(e,t){var i;for(i in e)switch(i){case"st":this.containingSection.removeMetaView(this,t.st),this.containingSection.addMetaView(this,e.st);break;case"refchar":t.refchar&&e.refchar&&t.refchar!=e.refchar?this.updateReferenceChar():this.containingSection.updateNoteChars(this.getSectionType(),this)}},updateReferenceChar:function(e){var t=this.getNode().getFormats().refchar;if(!t){var r=this.getContainingSection(),o=r.getNoteTypeInfo(this.getSectionType());t=a(o,e)}this.referenceChar=i.encodeHTMLString(t),isV8Engine?this.referenceCharWidth=getTextMetrics(this.referenceChar,this.getFontObject()).width:this.referenceCharWidth=n.getCharSize(this.referenceChar,this.getFontData()).width,this.trigger(DTVIEW.NOTE_CHAR_UPDATED,this)},getReferenceChar:function(){return this.referenceChar},getReferenceCharWidth:function(){return this.referenceCharWidth},getPreviousNoteView:function(){var e=this.prev;if(!e)for(var t=this.getContainingSection().prev;t&&!(e=t.getLastNote(this.getSectionType()));)t=t.prev;return e},getNextNoteView:function(){var e=this.next;if(!e)for(var t=this.getContainingSection().next;t&&!(e=t.getFirstNote(this.getSectionType()));)t=t.next;return e},getFontObject:function(){return{type:"text",ff:"arial,helvetica,sans-serif",size:12,va:"super"}},getFontData:function(){var e={type:"text",ff:"arial,roboto,sans-serif",size:12,va:"super"},t=n.getFontString(e);return function(){return t}}()}),r}(MetaDTView,ListUtils,Utils,FontUtils),MetaViewCollection=function(e,t){"use strict";function i(e,t){this.allViews={},this.type=e,this.containingSectionView=t}return t.call(i.prototype),i.prototype.addView=function(e){e&&(this.allViews[e.getNode().getId()]=e)},i.prototype.removeView=function(e){e&&delete this.allViews[e.getNode().getId()]},i.prototype.getViews=function(){return this.allViews},i.prototype.destroy=function(){this.allViews={},this.containingSectionView=null},i}(LinkedList,BaseEventHandler),NoteViewCollection=function(e,t){"use strict";function i(t,i){this.orderedNotes=new e,MetaViewCollection.apply(this,arguments)}return i.prototype=Object.create(MetaViewCollection.prototype),i.prototype.constructor=i,extend(i.prototype,{addView:function(e){if(e){for(var t=this.orderedNotes.last;t&&!(t.getRangeIndex()<e.getRangeIndex());)t=t.prev;null==t?this.orderedNotes.insertAsFirst(e):this.orderedNotes.insertAfter(e,t),this.allViews[e.getNode().getId()]=e,this.containingSectionView.updateNoteChars(e.getSectionType(),e)}},removeView:function(e){if(e){var t=e.next;this.orderedNotes.remove(e),delete this.allViews[e.getNode().getId()],t&&this.containingSectionView.updateNoteChars(t.getSectionType(),t)}},updateReferenceChar:function(e){var t,i;for(e?(i=this.getNoteSequenceNumber(e),t=e):(i=this.containingSectionView.getStartingNoteNumber(this.type),t=this.orderedNotes.first);t;)t.hasCustomChar()?t.updateReferenceChar():(t.updateReferenceChar(i),i++),t=t.next},getNoteSequenceNumber:function(e){for(var t=this.containingSectionView.getStartingNoteNumber(this.type),i=this.orderedNotes.first;i&&(!e||e!=i);)i.hasCustomChar()||t++,i=i.next;return t},getOrderedNotes:function(){return this.orderedNotes},getFirstNote:function(){return this.orderedNotes.first},getLastNote:function(){return this.orderedNotes.last},getNoteNumber:function(e){for(var t=0,i=this.orderedNotes.first;i&&(t+=1,i!=e);)i=i.next;return t},getViewAtIndex:function(e){for(var t=this.orderedNotes.first;t;){if(t.getIndex()<=e&&e<t.getEndIndex())return t;t=t.next}return null},getViewsBetween:function(e,t){var i=this.getViewAtIndex(e),n=this.getViewAtIndex(t);i||(i=this.getFirstNote()),n||(n=this.getLastNote());var r=i;i.getRangeIndex()>n.getRangeIndex()&&(r=n,n=i,i=r);for(var o=[r];r!=n;)r=r.next,o.push(r);return o},destroy:function(){for(;this.orderedNotes.first;)this.orderedNotes.remove(this.orderedNotes.first);MetaViewCollection.prototype.destroy.apply(this,arguments)},updateNoteReferenceChar:function(e){for(var t,i=this.getOrderedNotes(),n=i.length-1;n>=0&&(t=i[n],!t||(t.updateNoteReferenceChar(),!e||e.getId()!==noteView.getId()));n--);}}),i}(LinkedList,BaseEventHandler),ContentDTViewPlugins=function(e,t,i){"use strict";var n=function(e){return this[e].getViews()},r=function(e){return this[e]},o=function(e,t,i){var n=this.getMetaCollection(e);return n.getViewsBetween(t,i)},a=function(e){var t=this.getMetaCollection(e);return t.getFirstNote()},s=function(e){var t=this.getMetaCollection(e);return t.getLastNote()},l=function(e){return this.getNode().getNoteTypeInfo(e)},d=function(e){var t=this.getMetaCollection(e);return t.getNoteSequenceNumber()},c=function(e){var t=this.getMetaCollection(e.getSectionType());return t.getNoteNumber(e)},u=function(e){var t=this.getMetaCollection(e);return t.getOrderedNotes().length},g=function(e){return this.getMetaCollection(e).getOrderedNotes()},h=function(e){var t=this.getNoteTypeInfo(e);return t.pgrst===NOTE_RESTART_NUM.CONTINUOUS&&this.prev?this.prev.getNoteSequenceNumber(e):t.stnum},f=function(e,t){var i=this.getMetaCollection(t);i.addView(e)},p=function(e,t){var i=this.getMetaCollection(t);i.removeView(e)},E=function(e,t){this.updateNoteNumbers(e,t),this.trigger(DTVIEW.NOTE_SEQUENCE_NUMBER_UPDATED,this,e)},T=function(e,t){var i=this.getMetaCollection(e);i.updateReferenceChar(t)},O=function(){for(var e="",i=0;i<t.length;i++)e=t[i],this[e].destroy()},m=function(){for(var e="",i=0;i<t.length;i++)e=t[i],this[e]=new MetaCollections[e](e,this)};return{constructor:m,destroy:O,getMetaViews:n,getMetaCollection:r,getNoteViewsBetween:o,getFirstNote:a,getLastNote:s,getNoteNumber:c,getNoteCount:u,getOrderedNoteViews:g,getStartingNoteNumber:h,getNoteSequenceNumber:d,getNoteTypeInfo:l,addMetaView:f,removeMetaView:p,updateNoteChars:E,updateNoteNumbers:T}}(NoteViewCollection,META_SECTIONS,ZWArrayUtils),HFDTView=function(e,t){"use strict";function i(t,i){e.apply(this,arguments)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,extend(i.prototype,{isReplicableView:function(){return!0},isReferingTo:function(e){var t=e.getNode().getHFIdByHFType(this.getSectionType(),this.getHFType());return t==this.getNodeId()}}),PluginExtender.extend(i,t)}(SectionDTView,[ContentDTViewPlugins]),ContentDTView=function(e,t){"use strict";function i(t,i){e.apply(this,arguments)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,extend(i.prototype,{update:function(e,t){var i;for(i in e)switch(i){case"endnote":case"footnote":if(t[i])this.updateNoteChars(i,this.getFirstNote(i));else{var n="endnote"==i?"footnote":"endnote";this.updateNoteChars(n,this.getFirstNote(n))}}},getComputedHFIds:function(e){return this.node.getComputedHFIds(e)},getHFIds:function(e){return this.node.getHFIds(e)},isContinuousSection:function(){return this.node.isContinuousSection()},getLayoutProps:function(){return this.node.getLayoutProps()},getBreakType:function(){return this.node.getBreakType()},getColumnDetails:function(){return this.node.getColumnDetails()}}),PluginExtender.extend(i,t)}(SectionDTView,[ContentDTViewPlugins]),BaseParaDTView=function(e,t){"use strict";function i(t,i,n){e.apply(this,arguments),this.borderProperties={},this.paraSpacingProperties={},this.listData={}}return t.call(i.prototype),i.prototype=Object.create(e.prototype),i.prototype.constructor=i,extend(i.prototype,{createDTView:function(){this.updateProperties()},updateDTView:function(){this.updateProperties()},destroy:function(){this.listData={},this.paraSpacingProperties={},this.borderProperties={},e.prototype.destroy.call(this)},removeDTView:function(){this.destroy()},getParaProperties:function(){return this.node.getParaProperties()},getParaDirection:function(){return this.getNode().getParaDirection()},getThemeStyleFormat:function(){var e=this.getNode().getEndIndex();return editor.doc.getThemeStyleFormatAt(e)},isEndIndex:function(e){return this.getNode().start+e>=this.getNode().end-1},isListWidthChanged:function(){var e=this.getNode(),t=e.getListData(),i=e.getListLevel(),n=e.getListBulletObj(),r=this.getParaStyles();if(e.isImageList())if(t.listNumberString="",r.ls_data.hasOwnProperty(ATTR_PARAGRAPH.BULLET_ID)&&i.hasOwnProperty(ATTR_PARAGRAPH.CUST_DATA)){var o=e.getListBulletObj(r.ls_data.bullet_id);e.isSvgImageList()?t.listImageData.svg_id=o.svg_id:t.listImageData.src=o&&o.img&&o.img.src}else t.listImageData.src=n.img.src,e.isSvgImageList()&&(t.listImageData.svg_id=n.svg_id);else if(e.isSymbolList())t.listNumberString=n.c;else{var a=DTUtils.getListNumber(this.getNode(),t,t.listLevel);t.levelInfo=a,t.listNumberString=ListUtils.getListNumber(t.listType,a["level"+t.listLevel],t)}var s=e.getEndIndex(),r=e.section.doc.getRawFormatAt(s),l=r[ATTR_PARAGRAPH.PS_TI];l=Math.abs(l&&l.convertor().pixels||0),l||(l=0);var d=DocUtil.copyStyle(e.paraProperties.textFormat),c={};i.paraFormat?c=DocUtil.copyStyle(i.paraFormat.textFormat)||{}:i.paraFormat={},delete d[ATTR_TEXT.TS_BGC];var u=!0,g=DocUtil.mergeObjs([e.getParaStyles().textFormat,d]),h=FontUtils.getFontString(c,g,u),f=this.getListData(),p=f.listCharSize.width,E=t.listType==LIST_TYPE.UPPER_ROMAN||t.listType==LIST_TYPE.LOWER_ROMAN,T=i.hasOwnProperty("img")?t.listCharSize.width:isV8Engine?getTextMetrics(t.listNumberString,ZWJSONUtils.mergeJsonObjs(ZWJSONUtils.clone(c),g)).width:FontUtils.getCharSize(t.listNumberString,h).width;return(E!=f.isRomanList||e.getTabIndexForListNumbering(T,l)!=e.getTabIndexForListNumbering(p,l))&&(!(e.prev&&"para"===e.prev.type&&!e.prev.paraProperties)||void 0)},getListStyles:function(e){var t=this.getNode(),i={},n=t.getParaStyles(),r=n[ATTR_PARAGRAPH.PS_TI],o=n.tps,a=t.getListData();if(!a)return{};var s=r&&r.convertor().pixels||0;r=Math.abs(r&&r.convertor().pixels||0),r||(r=0);var l=DocUtil.copyStyle(t.paraProperties.textFormat),d=t.getListLevel(),c={};d.paraFormat?c=DocUtil.getRenderingFormat(d.paraFormat.textFormat)||{}:d.paraFormat={},delete l[ATTR_TEXT.TS_BGC];var u,g,h=!0,f=DocUtil.mergeObjs([this.getParaStyles().textFormat,l]),p=FontUtils.getFontString(c,f,h),E=DocUtil.mergeObjs([f,c]),T=parseInt(E.size)||11,O=t.getListLevel(),m=t.getListBulletObj(),t=this.getNode(),I={};t.isImageList()?n&&n.ls_data&&n.ls_data.hasOwnProperty(ATTR_PARAGRAPH.BULLET_ID)&&O.hasOwnProperty(ATTR_PARAGRAPH.CUST_DATA)?(u=ZWImageUtils.calculateAspectRatio(m.img.wid,m.img.ht),g=Conversions.ptToPx(T),I.width=a.listImageData.wid=u*g,I.height=a.listImageData.ht=g):(u=ZWImageUtils.calculateAspectRatio(m.img.wid,m.img.ht),g=Conversions.ptToPx(T),I.width=a.listImageData.wid=u*g,I.height=a.listImageData.ht=g):I=isV8Engine?getTextMetrics(a.listNumberString,E):FontUtils.getCharSize(a.listNumberString,p);var D=FontUtils.getFontString(c,f,h,!0),R=I.width,S=0;i.listNumOriginalWidth=0;var C=n[ATTR_PARAGRAPH.PS_ML];C=C&&C.convertor().pixels||0;var A=0!=a.id&&(a.listType==LIST_TYPE.UPPER_ROMAN||a.listType==LIST_TYPE.LOWER_ROMAN),v=0==a.id?DEFAULT_LIST_TAB_WIDTH:null,_=e.getSection(),P=_.getDefaultTabPointWidth(v);i.listNumOriginalWidth=R;var N=_.getLeft(),b=N+C,L=[];if(o&&o.length)for(var w=o.length,y=0,M=w;y<M;y++){var F=Conversions.toGlobalUnit(o[y].point)*Conversions.globalUnitInPx+N+_.grayArea;L.push({value:F})}if(s<0&&r>=R||A&&s<0){var U=r+C+N+_.grayArea;L.push({value:U})}else b+=r;_.arrangeTabPoints(L);var V=L[L.length-1];if(V)for(var B=P.length,y=0;y<B;y++)if(V.value<P[y].value){P.splice(0,y);break}L=L.concat(P);for(var x=L.length,y=0;y<x;y++){var W=L[y].value;if(A&&W>=b||!A&&W>=b+R){A?i.listRight=S=W-b:(S=W-(b+R),i.listRight=R=W-b);break}}return n[ATTR_PARAGRAPH.PS_DIR]==PARA_DIR.RTL?i.listStyle=D+";padding-left:"+S+"px;":i.listStyle=D+";padding-right:"+S+"px;",i.listNumberString=a.listNumberString,i.listPaddingRight=S,i.listCharSize=dimension(R,I.height),i.isRomanList=A,i.listImageData=this.node.getImageListData(),i.listCharSize.baseLine=I.baseLine,i.listStyleJSON=E,i},isEmpty:function(){return!this.node.isEmpty()},getParaStyles:function(){return this.node.getParaStyles()},getCodeProperties:function(){return this.node.getCodeProperties()},isList:function(){return this.node.isList()&&this.node.getListData().hasOwnProperty("listLevel")},addListData:function(e){this.listData=this.getListStyles(e)},removeListData:function(){this.listData={}},getListData:function(){return this.listData},getViewProperties:function(){return this.node.viewProperties},isRTLPara:function(){return this.node.isRTLPara()},getSegments:function(){return this.node.segments},isCode:function(){return this.node.isCode()},computeBorderProperties:function(){var e=this.getNode().getParaBorderFormats();this.borderProperties=DTUtils.computeRenderingBorderProperties(e)},getBorderProperties:function(){return this.borderProperties},updateProperties:function(){},getParaSpacingProperties:function(){return this.paraSpacingProperties},getBackgroundColor:function(){return Utils.getColorValFromRefString(this.getNode().getBackgroundColor()||"")},getPaddingLeft:function(){var e=this.getNode().getPaddingLeft();return e?e.convertor().pixels:0},getTextIndent:function(){var e=this.getNode().getTextIndent();return e?e.convertor().pixels:0},getMarginLeft:function(){var e=this.getNode().getMarginLeft();return e?e.convertor().pixels:0},getMarginRight:function(){var e=this.getNode().getMarginRight();return e?e.convertor().pixels:0},setParaSpacingProperties:function(){var e=this.getNode().getParaSpacingFormats();this.paraSpacingProperties={before:e.before.convertor().pixels,after:e.after.convertor().pixels}},hasPageBreakBefore:function(){return this.getParaProperties().pageBreakBefore},shouldKeepLinesTogether:function(){return this.getParaProperties().linesTogether},shouldKeepWithNext:function(){return this.getParaProperties().keepNext},isHeadingList:function(){return this.getNode().paraProperties.isHeadingList||!1},isNormalHeading:function(){var e=this.getNode();if(e.isHeading()){var t=e.getHeadingType();if(t>0&&t<=6)return!0}return!1},getImageSrc:function(e){e.service&&!e.src?e.src="https://i.ytimg.com/vi/"+e.id+"/hqdefault.jpg":e.src&&e.src.indexOf("image.do")!=-1&&(e.src="/writer/"+e.src)}}),i}(DTView,BaseEventHandler),CellDTView=function(e,t){"use strict";function i(t,i,n){e.apply(this,arguments),this.isVisible=!0}var n=[CELL_MERGE_TYPE.HMP,CELL_MERGE_TYPE.VMP];return t.call(i.prototype),i.prototype=Object.create(e.prototype),i.prototype.constructor=i,extend(i.prototype,{createDTView:function(){this.updateProperties()},updateDTView:function(){this.updateProperties()},removeDTView:function(){},updateProperties:function(){var e=this.getNode().getMergeType();this.isVisible=!n.contains(e)},getColIdx:function(){for(var e=this.getParent().childViews.first,t=0;e&&this.getId()!==e.getId();)t++,e=e.next;return t},getRow:function(){return this.parent},getTable:function(){return this.getRow().parent},getCellHeight:function(){if(this.getRow().hasEqualHtChildren()){var e=this.getNode().getFormat();return parseFloat((e.ht&&e.ht.convertor().pixels||0).toFixed(2))}return this.getParent().getMinHeight()},getBorderProperties:function(e){var t=this.getNode().getBorderProperties();return t&&e?t[e]||0:0},getCellPaddingHeight:function(){var e=this.getNode().getCellPadding();return e.top+e.bottom},getCellPaddingWidth:function(){var e=this.getNode().getCellPadding();return e.left+e.right}}),i}(DTView,BaseEventHandler),RowDTView=function(e,t){"use strict";function i(t,i,n){e.apply(this,arguments)}return t.call(i.prototype),i.prototype=Object.create(e.prototype),i.prototype.constructor=i,extend(i.prototype,{createDTView:function(){},updateDTView:function(){},removeDTView:function(){},getMinHeight:function(){return this.getNode().getMinHeight()},hasEqualHtChildren:function(){return this.getNode().hasEqualHtChildren}}),i}(DTView,BaseEventHandler),TableDTView=function(e,t){"use strict";function i(t,i,n){e.apply(this,arguments),this.bindEvents()}return t.call(i.prototype),i.prototype=Object.create(e.prototype),i.prototype.constructor=i,extend(i.prototype,{bindEvents:function(){},createDTView:function(){this.updateProperties()},updateDTView:function(){},removeDTView:function(){},updateProperties:function(){}}),i}(DTView,BaseEventHandler),HrDTView=function(){"use strict";function e(e,t,i){DTView.apply(this,arguments),this.bindEvents(),this.pageBreak=!1,this.columnBreak=!1,this.borderProperties={}}return BaseEventHandler.call(e.prototype),e.prototype=Object.create(DTView.prototype),e.prototype.constructor=e,extend(e.prototype,{createDTView:function(){this.updateProperties()},updateDTView:function(){},removeDTView:function(){},bindEvents:function(){},updateProperties:function(){var e=this.node.getFormats();this.pageBreak=e&&e.cls===ATTR_BODY.DS_PGBRK,this.columnBreak=e&&e.cls===ATTR_BODY.DS_COLBRK},isPageBreak:function(){return this.pageBreak&&this.getParent().getType()!==VIEW.CELL&&this.getSection().getSectionType()===SECTION_TYPES.CONTENT},isColumnBreak:function(){return this.columnBreak&&this.getParent().getType()!==VIEW.CELL&&this.getSection().getSectionType()===SECTION_TYPES.CONTENT},isBreaks:function(){return this.isPageBreak()||this.isColumnBreak()},getBorderProperties:function(){return this.borderProperties},computeBorderProperties:function(){var e={},t=this.getNode().getBorderFormats();for(var i in t)t.hasOwnProperty(i)&&(e[i]={width:t[i].width?t[i].width.convertor().pixels:0,type:t[i].type||"",color:t[i].color?Utils.getColorValFromRefString(t[i].color):"",space:t[i].space?t[i].space.convertor().pixels:0});this.borderProperties=e},getHeight:function(){if(this.isBreaks())return 0;var e=this.getNode().getFormat(),t=0;if(e){var i=e.borders;if(i)for(var n,r=[ATTR_BORDERS.BORDER_TOP,ATTR_BORDERS.BORDER_BOTTOM],o=0;o<r.length;o++)n=r[o],i[n]&&(t+=i[n].width?i[n].width.convertor().pixels:0,t+=i[n].space?i[n].space.convertor().pixels:0)}return t}}),e}(),TocDTView=function(){"use strict";function e(e,t,i){DTView.apply(this,arguments)}return BaseEventHandler.call(e.prototype),e.prototype=Object.create(DTView.prototype),e.prototype.constructor=e,extend(e.prototype,{createDTView:function(){},updateDTView:function(){},removeDTView:function(){}}),e}();PageLayout.prototype={Paper:{A4:{Portrait:{height:{pixel:1122.24,inch:11.69,mm:parseFloat(296.926.toFixed(3))},width:{pixel:793.92,inch:8.27,mm:parseFloat((8.27*25.4).toFixed(3))}},Landscape:{height:{pixel:793.92,inch:8.27,mm:parseFloat((8.27*25.4).toFixed(3))},width:{pixel:1122.24,inch:11.69,mm:parseFloat(296.926.toFixed(3))}}},Letter:{Portrait:{height:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))},width:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))}},Landscape:{height:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))},width:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))}}},Legal:{Portrait:{height:{pixel:1344,inch:14,mm:parseFloat((14*25.4).toFixed(3))},width:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))}},Landscape:{height:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))},width:{pixel:1344,inch:14,mm:parseFloat((14*25.4).toFixed(3))}}},Executive:{Portrait:{height:{pixel:1008,inch:10.5,mm:parseFloat(266.7.toFixed(3))},width:{pixel:696,inch:7.25,mm:parseFloat((7.25*25.4).toFixed(3))}},Landscape:{height:{pixel:696,inch:7.25,mm:parseFloat((7.25*25.4).toFixed(3))},width:{pixel:1008,inch:10.5,mm:parseFloat(266.7.toFixed(3))}}},Envelope_10:{Portrait:{height:{pixel:912,inch:9.5,mm:parseFloat((9.5*25.4).toFixed(3))},width:{pixel:396,inch:4.125,mm:parseFloat((4.125*25.4).toFixed(3))}},Landscape:{height:{pixel:396,inch:4.125,mm:parseFloat((4.125*25.4).toFixed(3))},width:{pixel:912,inch:9.5,mm:parseFloat((9.5*25.4).toFixed(3))}}},Custom:{Portrait:{height:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))},width:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))}},Landscape:{height:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))},width:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))}}},Tabloid:{Portrait:{height:{pixel:1632,inch:17,mm:parseFloat((17*25.4).toFixed(3))},width:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))}},Landscape:{height:{pixel:1056,inch:11,mm:parseFloat(279.4.toFixed(3))},width:{pixel:1632,inch:17,mm:parseFloat((17*25.4).toFixed(3))}}},Statement:{Portrait:{height:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))},width:{pixel:528,inch:5.5,mm:parseFloat(139.7.toFixed(3))}},Landscape:{height:{pixel:528,inch:5.5,mm:parseFloat(139.7.toFixed(3))},width:{pixel:816,inch:8.5,mm:parseFloat((8.5*25.4).toFixed(3))}}},Folio:{Portrait:{height:{pixel:1248,inch:13,mm:parseFloat(330.2.toFixed(3))},width:{pixel:768,inch:8,mm:parseFloat(203.2.toFixed(3))}},Landscape:{height:{pixel:768,inch:8,mm:parseFloat(203.2.toFixed(3))},width:{pixel:1248,inch:13,mm:parseFloat(330.2.toFixed(3))}}},A3:{Portrait:{height:{pixel:1587.84,inch:16.54,mm:parseFloat((16.54*25.4).toFixed(3))},width:{pixel:1122.24,inch:11.69,mm:parseFloat(296.926.toFixed(3))}},Landscape:{height:{pixel:1122.24,inch:11.69,mm:parseFloat(296.926.toFixed(3))},width:{pixel:1587.84,inch:16.54,mm:parseFloat((16.54*25.4).toFixed(3))}}},A5:{Portrait:{height:{pixel:793.92,inch:8.27,mm:parseFloat((8.27*25.4).toFixed(3))},width:{pixel:5.83*96,inch:5.83,mm:parseFloat(148.082.toFixed(3))}},Landscape:{height:{pixel:5.83*96,inch:5.83,mm:parseFloat(148.082.toFixed(3))},width:{pixel:793.92,inch:8.27,mm:parseFloat((8.27*25.4).toFixed(3))}}},B4:{Portrait:{height:{pixel:1375.68,inch:14.33,mm:parseFloat((14.33*25.4).toFixed(3))},width:{pixel:971.52,inch:10.12,mm:parseFloat((10.12*25.4).toFixed(3))}},Landscape:{height:{pixel:971.52,inch:10.12,mm:parseFloat((10.12*25.4).toFixed(3))},width:{pixel:1375.68,inch:14.33,mm:parseFloat((14.33*25.4).toFixed(3))}}},B5:{Portrait:{height:{pixel:971.52,inch:10.12,mm:parseFloat((10.12*25.4).toFixed(3))},width:{pixel:7.17*96,inch:7.17,mm:parseFloat(182.118.toFixed(3))}},Landscape:{height:{pixel:7.17*96,inch:7.17,mm:parseFloat(182.118.toFixed(3))},width:{pixel:971.52,inch:10.12,mm:parseFloat((10.12*25.4).toFixed(3))}}}}},PageLayout.prototype.getPaperSize=function(e,t,i,n){"undefined"!=typeof i&&"Inches"!=i&&"in"!=i||(i="inch");var r=PageLayout.Paper;e=parseFloat(e||r.Letter[n].width.unit).toFixed(3),t=parseFloat(t||r.Letter[n].height.unit).toFixed(3);for(var o in r){var a=r[o],s=a[n].width[i].toFixed(3),l=a[n].height[i].toFixed(3);if(s==e&&l==t||s==t&&l==e)return o}return"Custom"},PageLayout.prototype.getBodyHeight=function(e){var t=DocLayoutManager.getFirstPageHeight();if(!e){var i=DocLayoutManager.getFirstSection(),n=i.getMargin();t-=n.top+n.bottom+i.getGutterTop()}return t},PageLayout.prototype.getDimension=function(e){var t=editor.doc.getSelection(),i=DocLayoutManager.getPageWidthAtIdx(t.getStart()),n=DocLayoutManager.getPageHeightAtIdx(t.getStart()),r=Conversions.toGlobalUnit(i+"px"),o=Conversions.toGlobalUnit(n+"px");if("Portrait"==e&&r>o||"Landscape"==e&&o>r){var a=r;r=o,o=a}return{height:o,width:r}},PageLayout=new PageLayout,PUtil.containsOffset=function(e,t){var i=PUtil.offsetTop(e),n=PUtil.offsetHeight(e);return i<t&&t<n+i},PUtil.nodeCompare=function(e,t){var i=PUtil.offsetTop(e);return PUtil.containsOffset(e,t)?0:i<t?-1:1},PUtil.getElementAtOffset=function(e,t){var i=J(e).contents().not("[nodeType=8], #"+CONST.PG_SPLIT_LAYER+", ."+CONST.PG_SPLIT_NODE+", #"+CONST.FTR_LAYER+", #"+CONST.FN_LAYER+", #"+CONST.HDR_LAYER);if(0==i.length||DomUtil.nodeNameEquals(e,"#text"))return e;var n=Utils.binarySearch(i,PUtil.nodeCompare,t);return null===n?e:3==n.nodeType?n:PUtil.getElementAtOffset(n,t)},PUtil.insertBefore=function(e,t){if(e&&t){var i=t.parentNode;i&&i.insertBefore(e,t)}},PUtil.offsetHeight=function(e){if(null==e)return 0;var t,i=J(e).parents("div.zw-page"),n=!0;editor.doc.isEditableMode()&&(t=i.find("div.zw-contentpane"),n=t.is(":visible"));var r=0;if(n||t.show(),3==e.nodeType){var o=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE).get(0);null==e.parentNode&&(r=e.offsetHeight),PUtil.insertBefore(o,e);var a=PUtil.offsetTop(o),s=e.nextSibling;null==s&&e.parentNode.appendChild(o),PUtil.insertBefore(o,s);var l=PUtil.offsetTop(o);r=l-a+o.offsetHeight,J(o).remove()}else if("br"==e.nodeName.toLowerCase()||"span"==e.nodeName.toLowerCase()&&DomUtil.isEmpty(e)){var o=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];J(e).before(o),r=e.offsetHeight,J(o).remove()}else r=e.offsetHeight;return n||t.hide(),r},PUtil._offset=function(e,t){var i=0,n=0;if(null==e)return{top:n,left:i};n=e.offsetTop;var r=t?t:editor.jeditorPane[0];for(i=e.offsetLeft+editor.jeditorPane.offset().left+Z("ui-editor-outer-div").scrollLeft(),e=e.offsetParent;e&&e!=r;)n+=e.offsetTop,i+=e.offsetLeft,e=e.offsetParent;return{top:n,left:i}},PUtil.offset=function(e,t){if(null==e)return 0;var i,n=J(e).parents("div.zw-page"),r=!0;editor.doc.isEditableMode()&&(i=n.find("div.zw-contentpane"),r=i.is(":visible"));var o={};if(r||i.show(),3==e.nodeType||3!=e.nodeType&&!PUtil.offsetHeight(e)){var a=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];null==e.parentNode&&(o={top:e.offsetTop,left:e.offsetLeft}),PUtil.insertBefore(a,e),o=PUtil._offset(a,t),J(a).remove()}else o=PUtil._offset(e,t);return r||i.hide(),o},PUtil._offsetWidth=function(e,t){var i=0;if(null==e)return i;i=e.offsetWidth;t?t:editor.jeditorPane[0];return e=e.offsetParent,i},PUtil._offsetTop=function(e,t){var i=0;if(null==e)return i;i=e.offsetTop;var n=t?t:editor.jeditorPane[0];for(e=e.offsetParent;e&&e!=n;)i+=e.offsetTop,e=e.offsetParent;return i},PUtil.offsetWidth=function(e,t){if(null==e)return 0;var i,n=J(e).parents("div.zw-page"),r=!0;editor.doc.isEditableMode()&&(i=n.find("div.zw-contentpane"),r=i.is(":visible"));var o=0;if(r||i.show(),3==e.nodeType){var a=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];null==e.parentNode&&(offsetTop=e.offsetTop),PUtil.insertBefore(a,e);var s=PUtil._offsetTop(a,t);J(a).remove(),offsetTop=s}else o=PUtil._offsetWidth(e,t);return r||i.hide(),o},PUtil.offsetTop=function(e,t){if(null==e)return 0;var i,n=J(e).parents("div.zw-page"),r=!0;editor.doc.isEditableMode()&&(i=n.find("div.zw-contentpane"),r=i.is(":visible"));var o=0;if(r||i.show(),3==e.nodeType){var a=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];null==e.parentNode&&(o=e.offsetTop),PUtil.insertBefore(a,e);var s=PUtil._offsetTop(a,t);J(a).remove(),o=s}else o=PUtil._offsetTop(e,t);return r||i.hide(),o},PUtil._offsetLeft=function(e,t){var i=0;if(null==e)return i;i=e.offsetLeft;var n=t?t:editor.jeditorPane[0];for(e=e.offsetParent;e&&e!=n;)i+=e.offsetLeft,e=e.offsetParent;return i},PUtil.offsetLeft=function(e,t){if(null==e)return 0;var i,n=J(e).parents("div.zw-page"),r=!0;editor.doc.isEditableMode()&&(i=n.find("div.zw-contentpane"),r=i.is(":visible"));var o=0;if(r||i.show(),3==e.nodeType){var a=J(document.createElement("span")).html(CONST.ZERO_WIDTH_SPACE)[0];null==e.parentNode&&(o=e.offsetLeft),PUtil.insertBefore(a,e);var s=PUtil._offsetLeft(a);J(a).remove(),o=s}else o=PUtil._offsetLeft(e,t);return r||i.hide(),o};var TabHandler=function(){function e(e){var t=editor.doc.getBodyFormat();this.def_pt_len=Conversions.toGlobalUnit(t[ATTR_BODY.DS_TPS]),this.bodyRight=e.getWidth(),this.paddingLeft=e.getLeft(),this.paddingRight=e.getRight(),this.defaultTabPoints=this.getDefaultTabPoints(this.def_pt_len),this.defaultListTabPoints=[]}return extend(e.prototype,{getDefaultTabPointWidth:function(){return this.def_pt_len.convertor().pixels},getDefaultTabPoints:function(e){var t=[];if(e<=0)return t;for(var i=this.paddingLeft,n=e*Conversions.globalUnitInPx,r=this.bodyRight;i+n<r;)i+=n,t.push({value:i,align:"0",style:"0"});return t},destroy:function(){this.paddingRight=null,this.defaultListTabPoints=[],this.paddingLeft=null,this.bodyRight=null,this.defaultTabPoints=null,this.def_pt_len=0}}),e}(),ModelUpdateHandler=function(){function e(e,t,i,n){PubSub.publish("Document/BodyStyleChanged",e,t,i,n)}function t(e,t){PubSub.publish("List/newListAdded",e,t)}function i(e){PubSub.publish("Document/setBodyFormat",e)}function n(n){o=n,n.on(MODEL.STYLE_CHANGED,h),n.on(MODEL.CONTENT_ADDED,a),n.on(MODEL.CONTENT_DELETED,s),n.on(MODEL.AFTER_CONTENT_INSERTION,l),n.on(MODEL.AFTER_CONTENT_DELETION,d),n.on(MODEL.CONTENT_UNMASKED,u),n.on(MODEL.LOCK_UPDATED,g),n.on(MODEL.CONTENT_MASKED,c),n.on(MODEL.UPDATE_BODY_STYLES,f),n.on(MODEL.BODY_STYLE_CHANGED,e),n.on(MODEL.APPLYTO_STYLE_APPLIED,p),n.on(MODEL.INIT_START,E),n.on(MODEL.PROCESS_FORMAT,T),n.on(MODEL.INIT_END,O),n.on(MODEL.ERROR,m),n.on(MODEL.APPLYTO_COMPLETE,I),n.on(DOCUMENT.PAGE_BACKGROUND_CHANGED,D),n.on(MODEL.NAMED_RANGE,R),n.on(LIST.LIST_ADDED,t),n.on(MODEL.SET_BODY_FORMAT,i)}function r(n){n.off(MODEL.STYLE_CHANGED,h),n.off(MODEL.CONTENT_ADDED,a),n.off(MODEL.CONTENT_DELETED,s),n.off(MODEL.AFTER_CONTENT_INSERTION,l),n.off(MODEL.AFTER_CONTENT_DELETION,d),n.off(MODEL.CONTENT_UNMASKED,u),n.off(MODEL.LOCK_UPDATED,g),n.off(MODEL.CONTENT_MASKED,c),n.off(MODEL.UPDATE_BODY_STYLES,f),n.off(MODEL.BODY_STYLE_CHANGED,e),n.off(MODEL.APPLYTO_STYLE_APPLIED,p),n.off(MODEL.INIT_START,E),n.off(MODEL.PROCESS_FORMAT,T),n.off(MODEL.INIT_END,O),n.off(MODEL.ERROR,m),n.off(MODEL.APPLYTO_COMPLETE,I),n.off(DOCUMENT.PAGE_BACKGROUND_CHANGED,D),n.off(MODEL.NAMED_RANGE,R),n.off(LIST.LIST_ADDED,t),n.off(MODEL.SET_BODY_FORMAT,i),o=null}var o=null,a=function(e,t,i,n){PubSub.publish("Document/ContentAdded",e,t,i,n)},s=function(e,t,i){PubSub.publish("Document/ContentDeleted",e,t,i)},l=function(){PubSub.publish("Document/AfterContentInsertion")},d=function(){PubSub.publish("Document/AfterContentDeletion")},c=function(){PubSub.publish("Document/ContentMasked")},u=function(){PubSub.publish("Document/ContentUnMasked")},g=function(e,t){PubSub.publish("Document/LockUpdated",e,t)},h=function(e,t,i,n){PubSub.publish("Document/StyleChanged",e,t,i,n)},f=function(e,t,i,n){e===ATTR_BODY.DS_VIEW&&EditorView.setView(t,n[ATTR_BODY.DS_VIEW_WIDTH]),PubSub.publish("Document/"+e+"/changed",t,i)},p=function(e){PubSub.publish("Document/ApplyStyle",e)},E=function(e){editor.onModelInit(),PubSub.publish("Document/Model/InitStart",e)},T=function(e){editor.processFormat(e)},O=function(){editor.webFontsInit()},m=function(e,t){editor.modelErrorHandler(e,t)},I=function(){PubSub.publish("Document/Model/ApplyToComplete")},D=function(){PubSub.publish(DOCUMENT.PAGE_BACKGROUND_CHANGED)},R=function(e,t){PubSub.publish("Document/NamedRange",e,t)};return{init:n,destroy:r}}(),MIG_VERSIONS={MULTI_SECTION:12,GUTTER:14},ClientMigration=function(){"use strict";var e=["mr","mb","mt","ml","pw","ph","ht","fb","or","ps","cols","hf_type","gutter","borders","endnote","footnote","pagenumber"],t=MIG_VERSIONS.MULTI_SECTION+1,i={};i[MIG_VERSIONS.GUTTER]=function(e){for(var t=e.getText(0,e.getDocumentLength()),i=Utils.findNextIndexOf(UNICODE.SECTION,1,t);i!==-1;){var n=e.getFormatAt(i);"section"===n.type&&"content"===n.st&&"string"==typeof n.gutter&&(n.gutter={},e.setFormatAt(i,n)),i=Utils.findNextIndexOf(CONT_REGEXP.PORTION_END,i+1,t)}},i[MIG_VERSIONS.MULTI_SECTION]=function(t){for(var i=t.getText(0,t.getDocumentLength()),n=["evenPage_header","default_header","evenPage_footer","default_footer","firstPage_header","firstPage_footer"],r=[],o=[],a=Utils.findNextIndexOf(UNICODE.SECTION,1,i);a!=-1;){var s=t.getFormatAt(a);if("section"===s.type&&void 0!=s.hftype){var l=s.st.toString();if(["0","1","2","3","4","5"].contains(l)){var d=n[parseInt(s.hftype)],c={type:"section",hftype:s.hftype,sid:d},u=["0","1","4"].contains(l);u?(c.st="header",r.push(d)):(c.st="footer",o.push(d)),t.setFormatAt(a,c)}}a=Utils.findNextIndexOf(CONT_REGEXP.PORTION_END,a+1,i)}var g=t.getBodyFormat(),h=ZWJSONUtils.clone(t.getFormatAt(0)),f={sid:Utils.randomId("content"),st:"content",breakType:BREAK_TYPES.NEXT_PAGE,headerIds:r,footerIds:o,mr:g.mr,mt:g.mt,pw:g.pw,ps:g.ps,ht:g.ht,mb:g.mb,ph:g.ph,or:g.or,hf_type:g.hf_type||0,fb:g.fb,ml:g.ml,cols:g.cols,gutter:{}};g.borders&&(f.borders=g.borders),g.endnote&&(f.endnote=g.endnote,f.endnote.pgrst=f.endnote.pgrst||NOTE_RESTART_NUM.CONTINUOUS,f.endnote.position=f.endnote.position?f.endnote.position:NOTE_POSITION.DOC_END),g.footnote&&(f.footnote=g.footnote,f.footnote.pgrst=f.footnote.pgrst||NOTE_RESTART_NUM.CONTINUOUS,f.footnote.position=f.footnote.position?f.footnote.position:NOTE_POSITION.PAGE_BOTTOM),g.pagenumber&&(f.pagenumber=g.pagenumber),extend(h,f),t.setFormatAt(0,h);for(var p=0;p<e.length;p++)delete g[e[p]];t.setBodyFormat(g)};var n=function(e){var t=Utils.randomString();return{as_start:{as:{start:e,id:t}},as_end:{as:{end:ZWJSONUtils.getKeys(e),id:t}}}},r=function(e){var t=e[0];if(t.hasOwnProperty("r")&&0==t.r){var i=e[1];if(i.hasOwnProperty("as")&&"body"==i.as.start.type)return!0}return!1},o=function(e){for(var t=!1,i=0;i<e.length;i++){var n=e[i];if(n.hasOwnProperty("r"))t=0==n.r;else if(n.hasOwnProperty("as")&&n.as.hasOwnProperty("start")&&"section"==n.as.type)return!!t}return!1},a=function(t){var i=!1;if(r(t)&&!o(t)){for(var a={},s=1,l=-1,d=0,c=[],u=[],g=[],h=1;h<t.length;h++){var f=t[h];if(!f.hasOwnProperty("as")){if(f.hasOwnProperty("r")&&0==f.r){l==-1&&(l=h+1);continue}break}if(f.as.hasOwnProperty("start")){var p=f.as.start;if("body"!=p.type)break;d++;var E={};for(var T in p)e.contains(T)&&(E[T]=p[T],delete p[T]);Object.keys(E).length>0?(i=!0,E.type="section",a[f.as.id]={bodyOp:p,sectionOp:E}):a[f.as.id]={as_start:f}}else{var O=a[f.as.id];if(O.as_start)c.push(O.as_start),u.push(f);else{var m=n(O.bodyOp),I=n(O.sectionOp);c.push(m.as_start,I.as_start),u.push(m.as_end),g.push(I.as_end)}delete a[f.as.id]}}c.length>0&&(g.length>0&&(u=u.concat([{r:1}],g)),Array.prototype.splice.apply(t,[l,d].concat(u)),Array.prototype.splice.apply(t,[s,d].concat(c)))}return i},s=function(n){var r=n.getMigVersion();if(r===t){for(var o=n.getBodyFormat(),a=0;a<e.length;a++)delete o[e[a]];return n.setBodyFormat(o),!1}if(r<t){switch(r){case MIG_VERSIONS.MULTI_SECTION:i[MIG_VERSIONS.MULTI_SECTION](n);case MIG_VERSIONS.GUTTER:i[MIG_VERSIONS.GUTTER](n);default:n.setMigVersion(t)}return!0}},l=function(){return t};return{migrateOps:a,migrateDoc:s,getMaxMigrationVersion:l}}(),ERROR_CODES={API_NEGATIVE_IDX:"CNI_300",API_IOB_IDX:"CIO_400",OP_IDX_IOB:"CIO_500"},MODEL={INIT_START:"model/initStart",INIT_END:"model/initEnd",ERROR:"model/error",STYLE_CHANGED:"model/styleChanged",CONTENT_ADDED:"model/contentAdded",CONTENT_DELETED:"model/contentDeleted",AFTER_CONTENT_INSERTION:"model/afterContentInsertion",AFTER_CONTENT_DELETION:"model/afterContentDeletion",CONTENT_UNMASKED:"model/contentUnMasked",LOCK_UPDATED:"model/lockUpdated",CONTENT_MASKED:"model/contentMasked",SET_BODY_FORMAT:"model/body/setFormat",UPDATE_BODY_STYLES:"model/body/updateStyles",APPLYTO_STYLE_APPLIED:"model/applyStyle",PROCESS_FORMAT:"model/processFormat/progress",DESTROYED:"model/destroyed",APPLYTO_BEFORE_STYLE_CHANGED:"model/styleInRange",APPLYTO_AFTER_RETAIN_PROCESS:"model/retainBackUp",APPLYTO_COMPLETE:"model/applyToComplete",STYLE_BEFORE_CHANGE:"model/beforeStyleChange",BODY_STYLE_CHANGED:"model/bodyStyleChanged",BEFORE_CONTENT_DELETION:"model/beforeContentDeletion",BEFORE_CONTENT_INSERTION:"model/beforeContentInsertion",NAMED_RANGE:"model/namedRange"},writerShowThemeMap={zwaccent1:"A1",zwaccent2:"A2",zwaccent3:"A3",zwaccent4:"A4",zwaccent5:"A5",zwaccent6:"A6",zwlight1:"BG1",zwlight2:"BG2",zwdark1:"TX1",zwdark2:"TX2"},DocOpUtil=function(){var e=function(e,t){var i=e[TCConstants.TC]||[],n=t[TCConstants.TC];if(!Array.isArray(i)||!Array.isArray(n))throw"Error in TC";for(var r=0;r<n.length;r++){var o=n[r],a=o[TCConstants.TASK],s=o[TCConstants.ACTION];if(a&&a==TCConstants.REMOVE){for(var l=i.length,d=0;d<l;d++){var c=i[d];if(o[TCConstants.ACTION]==c[TCConstants.ACTION]){var s=o[TCConstants.ACTION];s===TCConstants.INSERT||s===TCConstants.DELETE?o[TCConstants.ZUID]==c[TCConstants.ZUID]&&(i.splice(d,1),l--,d--):s===TCConstants.FF_VALUE_UPDATE&&(i.splice(d,1),l--,d--)}}0==l&&delete e[TCConstants.TC]}else{for(var u=!1,d=0,l=i.length;d<l;d++){var c=i[d];if(o[TCConstants.ACTION]===c[TCConstants.ACTION]){if(s===TCConstants.INSERT||s===TCConstants.DELETE)c[TCConstants.ZUID]=o[TCConstants.ZUID],c[TCConstants.TIME]=o[TCConstants.TIME];else if(s===TCConstants.FF_VALUE_UPDATE){for(var g,h=o[TCConstants.DETAILS],f=c[TCConstants.DETAILS],p=0,E=0,T=f.length;p<T;p++)g=h[E],g&&f[p].id===g.id&&g[TCConstants.TASK]&&g[TCConstants.TASK]===TCConstants.REMOVE&&(f.splice(p,1),p--,T--);if(h.length)for(var p=0,O=h.length;p<O;p++)g=h[p],g[TCConstants.TASK]&&g[TCConstants.TASK]===TCConstants.REMOVE||c[TCConstants.DETAILS].push(g);f.length||(i.splice(d,1),l--,d--)}u=!0}}u||(e[TCConstants.TC]||(i=[],e[TCConstants.TC]=i),i.push(o)),i.length||delete e[TCConstants.TC]}}},t=function(e){return e===NODE_TYPE.TABLE||e===NODE_TYPE.ROW||e===NODE_TYPE.CELL||e===NODE_TYPE.TABLEEND||e===NODE_TYPE.TOC||e===NODE_TYPE.TOCEND||e===NODE_TYPE.COMMENT||e===NODE_TYPE.LINK||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.SIGNERFIELD||e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FILLABLEFIELD||e===NODE_TYPE.BOOKMARK||e==NODE_TYPE.IMAGE||e==NODE_TYPE.PARAGRAPH||e===NODE_TYPE.HR||e===NODE_TYPE.BR||e===NODE_TYPE.IFRAME||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE||e===NODE_TYPE.SECTION};return{updateTCStyles:e,isTcSupportedType:t}}(),Model=function(e,t,i,n,r,o,a,s){"use strict";function l(e,n,r,s,l,d){this.id=o.getRandomNumber(),this.content=e,this.formats=n,this.setBodyFormat(r),this.locks=i.build(s||[]),this.mig_ver=l,this.bucket=new t,this.applyToSequenceNumber=0;var c=a.clone(d||{});if(a.isEmptyObject(c))c.namedRange=i.build([]);else for(var u in c)c[u]=i.build(c[u]);this.ranges=c}function d(e){this.metaIDMap={},this.usedIDMap={},e&&(this.clonedModelData=JSON.parse(JSON.stringify(e.getDocument())))}function c(e,t){d.apply(this,arguments),t&&j.call(this),X.call(this)}var u=function(e){var t=this.getFormatAt(e);if(t)return e;for(var i=e-1;i>0;i--)if(t=this.getFormatAt(i))return i;return this.formats.length},g=function(e){for(var t=o.findNextIndexOf(CONT_REGEXP.PORTION_END,e+1,this.content),i=e+1;i<t;i++){var n=this.getFormatAt(i);if(n)return i}return t},h=function(e){for(var t,i,n=0,s=100,l=o.findPreviousIndexOf(CONT_REGEXP.PORTION_END,e,this.content.substring(0,e)),d=e;d>0;d--){var c=this.getFormatAt(d);c?c.type:"";if(n++,n==s||d==l)break;if(c&&c.type==NODE_TYPE.TEXT){if(t){if(t[TCConstants.TC]&&c[TCConstants.TC]&&(t=r.copyStyle(t),c=r.copyStyle(c),r.deleteTimeStampInTCStyle(t[TCConstants.TC]),r.deleteTimeStampInTCStyle(c[TCConstants.TC])),!a.compareJSON(t,c))break;this.setFormatAt(i,null)}t=c,i=d}}n=0;var u=this.content.length;t=void 0,c=void 0,l=o.findNextIndexOf(CONT_REGEXP.PORTION_END,e,this.content);for(var d=e;d<u;d++){var c=this.getFormatAt(d);n++;c?c.type:"";if(n==s||d==l)break;if(c&&c.type==NODE_TYPE.TEXT)if(t){if(t[TCConstants.TC]&&c[TCConstants.TC]&&(t=r.copyStyle(t),c=r.copyStyle(c),r.deleteTimeStampInTCStyle(t[TCConstants.TC]),r.deleteTimeStampInTCStyle(c[TCConstants.TC])),!a.compareJSON(t,c))break;this.setFormatAt(d,null)}else t=c}},f=function(e){var t,i,n,o={};for(t=e;t>=0;t--)if(i=this.getFormatAt(t)){if(n=i[ATTR_COMMON.TYPE],n==NODE_TYPE.SECTION)break;if(n==NODE_TYPE.PARAGRAPH){this.getCharAt(e)==UNICODE.PARA&&(o=i[ATTR_PARAGRAPH.PS_TS]||{}),o[ATTR_COMMON.TYPE]=NODE_TYPE.TEXT;break}if(n==NODE_TYPE.TEXT&&i.st!=NODE_TYPE.TAB&&i[ATTR_COMMON.CLS]!=NODE_TYPE.ENDNOTE&&i[ATTR_COMMON.CLS]!=NODE_TYPE.FOOTNOTE){o=r.copyStyle(i);var a=o[ATTR_COMMON.CLS];a&&a.indexOf("link")==-1&&a.indexOf("comment")==-1&&delete o[ATTR_COMMON.CLS];break}}return o},p=function(t,i){var r=i.type,o=i.st,s=(t[ATTR_COMMON.CLS],!(!t||"body"!==t.type));if(r===NODE_TYPE.PARAGRAPH){var l=this.getBodyFormat();if(i.hasOwnProperty(ATTR_PARAGRAPH.PS_HD)&&"number"==typeof i[ATTR_PARAGRAPH.PS_HD]){var d="h"+i[ATTR_PARAGRAPH.PS_HD],c=l.styleUIInfo.para[d].deleted;c&&delete i[ATTR_PARAGRAPH.PS_HD]}var u=i[ATTR_PARAGRAPH.LS_DATA];if(u&&!a.isEmptyObject(u)){var g=l.listFormat;(!g&&a.isEmptyObject(g)||("object"==typeof g[u.id]?a.isEmptyObject(g[u.id]):isNaN(parseInt(g[u.id]))))&&(delete i[ATTR_PARAGRAPH.LS_DATA],delete i[ATTR_PARAGRAPH.PS_TYPE])}}if(i[ATTR_PARAGRAPH.PS_NULL]&&t[ATTR_COMMON.TYPE]==NODE_TYPE.PARAGRAPH||i[ATTR_TEXT.TS_NULL]&&t[ATTR_COMMON.TYPE]==NODE_TYPE.TEXT)for(var h in t)!t.hasOwnProperty(h)||"type"==h||"id"==h||"cls"==h||h==ATTR_COMMON.FIELDINFO||h==ATTR_LINK.LINK_TYPE||h==ATTR_LINK.LINK_URL||h==ATTR_LINK.LINK_TARGET||h==ATTR_LINK.LINK_TOOLTIP||h==TCConstants.TC||"st"==h&&t.st==NODE_TYPE.TAB||delete t[h];for(var h in i)if(i.hasOwnProperty(h)){var f=i[h];if(h!=ATTR_PARAGRAPH.PS_NULL&&h!=ATTR_TEXT.TS_NULL)if(""===f&&null!=f||h==ATTR_PARAGRAPH.TEXTFORMAT)h==ATTR_IMAGE.I_WRAP_TYPE&&(delete t.fid,t&&t[ATTR_COMMON.SUBTYPE]!=NODE_TYPE.TEXTBOX&&delete t.pl),delete t[h];else if(r==NODE_TYPE.TEXT&&o!=NODE_TYPE.LINK)if(h==ATTR_TEXT.TS_TD){var E=t[h];E&&"none"!=E?"underline"==E&&"line-through"==f?t[h]=E+" "+f:"line-through"==E&&"underline"==f?t[h]=f+" "+E:t[h]=f:t[h]=f}else if("cls"==h)if("unlink"==f){var T=t.cls;if(T){var O="unlink"==f?NODE_TYPE.LINK:"",m=T.replace(O,"").trim();"unlink"==f&&(delete t[ATTR_LINK.LINK_URL],delete t[ATTR_LINK.LINK_TARGET],delete t[ATTR_LINK.LINK_TOOLTIP]),t[h]=m}}else if(t[h]&&f){var I=t[h].split(" "),D=f.split(" "),R=ZWArrayUtils.commonElementsInArray(I,D);R.length||"endnote"===f||"footnote"===f?t[h]=f:t[h]+=" "+f}else(!t[h]&&f||t[h]&&!f)&&(t[h]=f);else h===TCConstants.TC?n.updateTCStyles.call(this,t,i):t[h]=f;else if(r!=NODE_TYPE.PARAGRAPH||h!=ATTR_PARAGRAPH.PS_TYPE&&h!=ATTR_PARAGRAPH.LS_DATA)if(r==NODE_TYPE.PARAGRAPH&&h==ATTR_PARAGRAPH.PS_TS){var f=i[ATTR_PARAGRAPH.PS_TS];t[ATTR_PARAGRAPH.PS_TS]||(t[ATTR_PARAGRAPH.PS_TS]={}),a.isEmptyObject(f)?t[ATTR_PARAGRAPH.PS_TS]=f:p.call(this,t[ATTR_PARAGRAPH.PS_TS],f)}else if(h==TCConstants.TC&&n.isTcSupportedType(r))n.updateTCStyles.call(this,t,i);else if(r==NODE_TYPE.IMAGE&&h===ATTR_IMAGE.I_ROTATE&&0===f)delete t[ATTR_IMAGE.I_ROTATE];else if("st"==h&&"listFormat"==f&&r==NODE_TYPE.BODY)for(var S in i)"st"==S||"type"==S||isNaN(parseInt(S))||"undefined"==typeof i[S]||(this.defaults.listFormat[S]=i[S],this.trigger(LIST.LIST_ADDED,S,i[S]));else if("st"==h&&"bulletStyles"==f&&r==NODE_TYPE.BODY)for(var S in i)"st"==S||"type"==S||isNaN(parseInt(S))||"undefined"==typeof i[S]||(this.defaults.listFormat.hasOwnProperty("bulletStyles")||(this.defaults.listFormat.bulletStyles={}),this.defaults.listFormat.bulletStyles[S]=i[S]);else if(h===ATTR_BODY.TC_ISENABLED)t[h]=f,t.hasOwnProperty(ATTR_BODY.TC_COLLAB_LIST)&&"true"===f&&(t[ATTR_BODY.TC_COLLAB_LIST]=[]);else if(h===ATTR_BODY.TC_ON_BY_COLLAB)t.hasOwnProperty(ATTR_BODY.TC_COLLAB_LIST)?t[ATTR_BODY.TC_COLLAB_LIST].push(f):t[ATTR_BODY.TC_COLLAB_LIST]=[f];else if(h===ATTR_BODY.TC_OFF_BY_COLLAB&&t.hasOwnProperty(ATTR_BODY.TC_COLLAB_LIST))ZWArrayUtils.arrayContains(t[ATTR_BODY.TC_COLLAB_LIST],f)&&t[ATTR_BODY.TC_COLLAB_LIST].splice(t[ATTR_BODY.TC_COLLAB_LIST].indexOf(f),1);else if("resetBorder"!==h||t.type!=NODE_TYPE.BODY&&t.type!=NODE_TYPE.CELL&&t.type!=NODE_TYPE.TABLE&&t.type!=NODE_TYPE.IMAGE&&t.type!=NODE_TYPE.PARAGRAPH)if("resetBackground"===h)t.type==NODE_TYPE.CELL?(delete t[ATTR_CELL.TDS_BGIMG],delete t[ATTR_CELL.TDS_BGIMG_NAME],delete t[ATTR_CELL.Z_TD_BGC]):t.type==NODE_TYPE.TABLE?(delete t[ATTR_TABLE.TBLS_BGIMG],delete t[ATTR_TABLE.TBLS_BGIMG_NAME],delete t[ATTR_TABLE.TBLS_TBL_BGC]):(delete t[ATTR_PARAGRAPH.PS_BGC],t.type===NODE_TYPE.BODY&&this.trigger(DOCUMENT.PAGE_BACKGROUND_CHANGED));else if("resetSpecialMargins"==h)t.type===NODE_TYPE.BODY&&delete t[ATTR_BODY.SPECIAL_MARGINS];else if(h===ATTR_TABLE.SHEET_RANGE_INFO&&"table"==t.type&&null==f)delete t[ATTR_TABLE.SHEET_RANGE_INFO];else if(h===ATTR_TABLE.TBLS_THEME&&"table"==t.type)t[ATTR_TABLE.TBLS_THEME]=i[ATTR_TABLE.TBLS_THEME],t[ATTR_COMMON.BORDERS]&&delete t[ATTR_COMMON.BORDERS],t.z_tbl_bgc&&delete t.z_tbl_bgc;else if(s&&"id"!=h&&"level"!=h&&"st"!=h&&isNaN(parseInt(h))){if(s&&this.trigger(e.UPDATE_BODY_STYLES,h,f,t[h],i),"styles"===h)for(var C in i[h])if("para"==C)for(var A in i[h][C])t[h][C][A]=i[h][C][A];else t[h][C]=i[h][C];else t[h]=f;"bgc"===h&&this.trigger(DOCUMENT.PAGE_BACKGROUND_CHANGED)}else if(r==NODE_TYPE.SECTION)t[h]=f;else if(r==NODE_TYPE.FILLABLEFIELD&&"ffInfo"==h&&t[h])for(var v in f){var _=t[h]||{};_[v]=f[v]}else t[h]=f;else t[ATTR_COMMON.BORDERS]&&delete t[ATTR_COMMON.BORDERS];else f&&""!=f?i.ls_data&&i.ls_data.l>=0?(delete i.ls_data.t,t[h]=f):(delete t[ATTR_PARAGRAPH.LS_DATA],delete t[ATTR_PARAGRAPH.PS_TYPE],delete t[ATTR_PARAGRAPH.PS_SA]):(delete t[ATTR_PARAGRAPH.LS_DATA],delete t[ATTR_PARAGRAPH.PS_TYPE])}},E=function(e,t,i){for(var n,o=(this.getFormatAt(e),0),s=i.length,l=0,d={},l=e;l<t;l++){var c=this.getFormatAt(l);this.getCharAt(l);if(c)for(o=s-1;o>=0;o--)if(n=i[o],c.type==NODE_TYPE.TEXT&&n.type==NODE_TYPE.TEXT)p.call(this,c,n),"none"==n.link_type&&delete c.st,0==o&&(d&&d.st!=NODE_TYPE.TAB&&a.compareJSON(d,c)?this.setFormatAt(l,null):d=c);else if(d=null,c.type!=NODE_TYPE.PARAGRAPH||n.type!=NODE_TYPE.TEXT&&n.type!=NODE_TYPE.PARAGRAPH)n.type==c.type?p.call(this,c,n):"footnote"===c.type&&n.type==NODE_TYPE.ENDNOTE?p.call(this,c,n):"endnote"===c.type&&n.type==NODE_TYPE.FOOTNOTE&&p.call(this,c,n);else if(n.type==NODE_TYPE.TEXT){var u={},g=r.copyStyle(n);u.type=NODE_TYPE.PARAGRAPH,g[ATTR_TEXT.TS_NULL]&&delete g[ATTR_TEXT.TS_NULL],u[ATTR_PARAGRAPH.PS_TS]=g,p.call(this,c,u)}else n.type==NODE_TYPE.PARAGRAPH&&p.call(this,c,n)}},T=function(e){var t,i,n={},o=e.length,a=0;for(a=0;a<o;a++)if(i=r.copyStyle(e[a]),t=i.type,n[t])for(var s in i)s===TCConstants.TC&&n[t][s]?n[t][s]=n[t][s].concat(i[s]):n[t][s]=i[s];else n[t]=i;return n},O=function(e,t){return e.styles.para["h"+t]},m=function(e){var t,i;if(i=t=e.styles.para,!e.styleUIInfo||!Object.keys(e.styleUIInfo).length||!Object.keys(e.styleUIInfo.para).length){var n={shape:{},para:{},char:{},table:{}};for(var r in t){var o=parseInt(r.substr(1));n.para.hasOwnProperty(r)||(n.para[r]={},n.para[r].status="visible",o>2&&o<=9&&(n.para[r].status="semihidden",n.para[r].showWhenUsed="h"+(o-1))),t[r].hasOwnProperty("info")||(t[r].info={},t[r].info.next="h0",0!=o&&(t[r].info.basedOn="h0"))}e.styleUIInfo=n}for(var r in i){var a=i[r],s=a.info,l=a.textFormat;"undefined"==typeof s?(a.info={},a.info.next="h0"):"undefined"!=typeof s.next&&i.hasOwnProperty(s.next)||(s.next="h0"),"object"==typeof l&&shouldNotCarryTextStyle.filter(function(e){delete l[e]})}e.mm_removeBlankLines&&(e.mm_remove_blankparas=e.mm_removeBlankLines,delete e.mm_removeBlankLines)},I=function(e,t){try{if("GROUPSHAPE"==e.type&&e.shapes){for(var i=0;i<e.shapes.length;i++){var n=e.shapes[i];e.shapes[i]=I(n,t)}return e}if(e.props&&e.props.fill&&e.props.fill.solid&&R(e.props.fill.solid.color,t),e.props&&e.props.stroke&&e.props.stroke.fill&&e.props.stroke.fill.solid&&R(e.props.stroke.fill.solid.color,t),e.textBody&&e.textBody.props&&"NONE"==e.textBody.props.wrap&&delete e.textBody.props.wrap,e.themeRef&&(e.themeRef.fillRef&&e.themeRef.fillRef.color&&e.themeRef.fillRef.color.rgb&&(e.themeRef.fillRef.color.rgb=D(e.themeRef.fillRef.color.rgb)),e.themeRef.fontRef&&e.themeRef.fontRef.color&&e.themeRef.fontRef.color.rgb&&(e.themeRef.fontRef.color.rgb=D(e.themeRef.fontRef.color.rgb)),e.themeRef.strokeRef&&e.themeRef.strokeRef.color&&e.themeRef.strokeRef.color.rgb&&(e.themeRef.strokeRef.color.rgb=D(e.themeRef.strokeRef.color.rgb))),e.textBody){var r=e.textBody.listStyles;if(r&&r.length>0)for(var i=0;i<r.length;i++){var o=r[i];o.defPrProps.fill&&o.defPrProps.fill.solid&&o.defPrProps.fill.solid.color&&(o.defPrProps.fill.solid.color.rgb=D(o.defPrProps.fill.solid.color.rgb))}if(e.textBody.paras)for(var a=e.textBody.paras,i=0,s=a.length;i<s;i++){var l=a[i];l.style&&(l.style.defPrProps&&l.style.defPrProps.fill&&l.style.defPrProps.fill.solid&&(l.style.defPrProps.fill.solid.color.rgb=D(l.style.defPrProps.fill.solid.color.rgb)),l.style.spacing&&l.style.spacing.line&&(l.style.spacing.line.percent=parseFloat(l.style.spacing.line.percent))),l.unmerged&&l.unmerged.style&&(l.unmerged.style.defPrProps&&l.unmerged.style.defPrProps.fill&&l.unmerged.style.defPrProps.fill.solid&&(l.unmerged.style.defPrProps.fill.solid.color.rgb=D(l.unmerged.style.defPrProps.fill.solid.color.rgb)),l.unmerged.style.spacing&&l.unmerged.style.spacing.line&&(l.unmerged.style.spacing.line.percent=parseFloat(l.unmerged.style.spacing.line.percent)));for(var d=l.portions,c=0,u=d.length;c<u;c++){var g=d[c];g.props&&(g.props.fill&&g.props.fill.solid&&(g.props.fill.solid.color.rgb=D(g.props.fill.solid.color.rgb)),g.props.size&&(g.props.size=parseInt(g.props.size))),g.unmerged&&g.unmerged.props&&g.unmerged.props.fill&&g.unmerged.props.fill.solid&&(g.unmerged.props.fill.solid.color.rgb=D(g.unmerged.props.fill.solid.color.rgb),g.unmerged.props.fill.solid.color.type="CUSTOM")}}}}catch(e){}return e},D=function(e){return Array.isArray(e)||(e=Object.values(e)),e.map(Number)},R=function(e,t){if(e.zwtheme){var i=e.zwtheme.fill||e.zwtheme.sfill,n=i,r=void 0,a=void 0;i.indexOf("*")>-1?(n=i.split("*")[0],r=parseInt(i.split("*")[1])):i.indexOf("/")>-1&&(n=i.split("/")[0],a=parseInt(i.split("/")[1]));var s=[];if(r)s[0]={mode:"MODIFY",value:r/100};else if(a){var l=a/100;s[0]={mode:"MODIFY",value:l},s[1]={mode:"OFFSET",value:1-l}}e.type=writerShowThemeMap[n]||n,e.rgb=D(Shapes.getRGBArray(o.getColorValFromRefString(i))),e.tweaks={},e.tweaks.hsl={},e.tweaks.hsl.luminance=s,delete e.zwtheme}else void 0!=t.conversion?(e.rgb=D(e.rgb),e.type="CUSTOM"):e.rgb=D(e.rgb);return e};l.prototype.getMigVersion=function(){return this.mig_ver},l.prototype.setMigVersion=function(e){this.mig_ver=e},l.prototype.init=function(){this.trigger(e.INIT_START,this.defaults);var t,i=this.formats.length;this.bucket.initBucketSize(i),this.bucket.init(new Array(i));for(var n=!1,s=!1,l=0,d=this.formats.length;l<d;l++)if(t=this.formats[l],t&&t.chartDetails&&(t.type="chart"),!t||a.isEmptyObject(t)){this.setFormatAt(l,null);var c=this.getCharAt(l);!r.isBoundaryChar(c)&&r.isBoundaryChar(this.getCharAt(l-1))&&this.setFormatAt(l,{type:"text"}),n=!0}else{if(this.getCharAt(l)===UNICODE.PARAGRAPH&&t.type!==NODE_TYPE.PARAGRAPH&&(t={},t.type=NODE_TYPE.PARAGRAPH),t.type&&t.type==NODE_TYPE.PARAGRAPH&&(t.hasOwnProperty(ATTR_PARAGRAPH.TEXTFORMAT)&&delete t[ATTR_PARAGRAPH.TEXTFORMAT],t.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)&&!t.hasOwnProperty(ATTR_PARAGRAPH.PS_TYPE)&&(t[ATTR_PARAGRAPH.PS_TYPE]="list"),!t.hasOwnProperty(ATTR_PARAGRAPH.LS_DATA)&&t.hasOwnProperty(ATTR_PARAGRAPH.PS_TYPE)&&"list"==t[ATTR_PARAGRAPH.PS_TYPE]&&delete t[ATTR_PARAGRAPH.PS_TYPE],t[ATTR_PARAGRAPH.LS_DATA]&&!t[ATTR_PARAGRAPH.LS_DATA].hasOwnProperty("id")&&(delete t[ATTR_PARAGRAPH.LS_DATA],delete t[ATTR_PARAGRAPH.PS_TYPE]),t[ATTR_PARAGRAPH.LS_DATA]&&t[ATTR_PARAGRAPH.LS_DATA].hasOwnProperty("l")&&t[ATTR_PARAGRAPH.LS_DATA].l<0&&(delete t[ATTR_PARAGRAPH.LS_DATA],delete t[ATTR_PARAGRAPH.PS_TYPE])),t.type&&t.type==NODE_TYPE.SECTION&&"content"==t.st&&(!t.borders||t.borders.hasOwnProperty("border-left")&&t.borders.hasOwnProperty("border-right")&&t.borders.hasOwnProperty("border-top")&&t.borders.hasOwnProperty("border-bottom")||(t.borders=null),"string"==typeof t.gutter&&(t.gutter={})),t.type&&t.type==NODE_TYPE.PARAGRAPH&&t.hasOwnProperty(ATTR_PARAGRAPH.PS_HD)&&"undefined"==typeof O(this.defaults,t[ATTR_PARAGRAPH.PS_HD])&&(t[ATTR_PARAGRAPH.PS_HD]="0"),this.getCharAt(l)===UNICODE.IMAGE){if(t.shapeData){t[ATTR_IMAGE.I_SRC]||(t[ATTR_IMAGE.I_SRC]=ATTR_WIDGET.WIDGET_DEF_IMG),t.wid&&"0px"!=t.wid||(t.wid=t.shapeData.props.transform.dim.width),t.ht&&"0px"!=t.ht||(t.ht=t.shapeData.props.transform.dim.height),void 0!=t.shapeData.props.transform.rotate&&(t.shapeData.props.transform.rotAngle=t.shapeData.props.transform.rotate),t.left=t.left||t.shapeData.props.transform.pos.left,t.mr=t.mr||t.shapeData.mr,t.mt=t.mt||t.shapeData.mt,t.ml=t.ml||t.shapeData.ml,t.mb=t.mb||t.shapeData.mb;var u=t.shapeData.props.stroke;if(u&&"NONE"!=u.fill.type){var g={type:u.type,color:u.fill.solid.color.rgb,width:u.width,space:"0px"},h={};h["border-top"]=h["border-left"]=h["border-bottom"]=h["border-right"]=g}t.shapeData=I(t.shapeData,this.getBodyFormat())}else if("undefined"!=typeof t.widgetSrc&&null===t.widgetSrc)delete t.widgetSrc;else if(t.chartDetails){var f={fw:t.chartDetails.ts.fw,fs:t.chartDetails.ts.fs,fc:t.chartDetails.ts.fc,ff:"roboto",fw_i:0,size:12};if("string"==typeof t.chartDetails.advancedOptions.color){var p=t.chartDetails.advancedOptions.color;p="bold"===p?"Bold":p,t.chartDetails.advancedOptions.color=[];for(var E=0;E<6;E++)t.chartDetails.advancedOptions.color.push(p)}t.chartDetails.hasOwnProperty("barConfig")||(t.chartDetails.barConfig={borderRadius:0}),t.chartDetails.ts.ff=t.chartDetails.ts.ff?t.chartDetails.ts.ff:"roboto",t.chartDetails.bgc=t.chartDetails.bgc?t.chartDetails.bgc:"rgba(255, 255, 255, 1)",t.chartDetails.op=void 0!=t.chartDetails.op?t.chartDetails.op:100,t.chartDetails.title.ts=t.chartDetails.title.ts?t.chartDetails.title.ts:a.clone(f),t.chartDetails.subtitle=t.chartDetails.subtitle?t.chartDetails.subtitle:a.clone({text:"",ts:f}),t.chartDetails.dataLabels=t.chartDetails.dataLabels?t.chartDetails.dataLabels:a.clone({valuesToDisplay:"showValue",position:"insidemiddle",ts:f}),["Pie","Doughnut"].indexOf(t.chartDetails.type)===-1||"multiseries"!==t.chartDetails.series||t.chartDetails.aggregate||(t.chartDetails.aggregate={},t.chartDetails.aggregate.enabled=!0,t.chartDetails.aggregate.operation="count",t.chartDetails.xAxis.serieslabel=[t.chartDetails.xAxis.labels.value[0]]),t.chartDetails.aggregate=t.chartDetails.aggregate?t.chartDetails.aggregate:{enabled:!1,operation:"count"},t.chartDetails.legend.position||(t.chartDetails.legend.position="top",t.chartDetails.legend.ts=a.clone(f)),t.chartDetails.xAxis.title.hasOwnProperty("ts")||(t.chartDetails.xAxis.title={text:a.clone(t.chartDetails.xAxis.title),ts:a.clone(f)}),t.chartDetails.yAxis.title.hasOwnProperty("ts")||(t.chartDetails.yAxis.title={text:a.clone(t.chartDetails.yAxis.title),ts:a.clone(f)}),t.chartDetails.xAxis.hasOwnProperty("reverse")||(t.chartDetails.xAxis.reverse=!1,t.chartDetails.xAxis.slant="auto",t.chartDetails.xAxis.ts=a.clone(f)),t.chartDetails.yAxis.hasOwnProperty("reverse")||(t.chartDetails.yAxis.reverse=!1,t.chartDetails.xAxis.slant="auto",t.chartDetails.yAxis.ts=a.clone(f)),t.chartDetails.hasOwnProperty("borders")||(t.chartDetails.borders={color:"rgb(0,0,0)",width:"0px",type:"solid"}),t.chartDetails.hasOwnProperty("axisConfig")||(t.chartDetails.axisConfig={format:"none",prefix:"",suffix:"",sf:"auto"}),t.chartDetails.xAxis.hasOwnProperty("grid")||(t.chartDetails.xAxis.grid={enabled:t.chartDetails.type.indexOf("Bar")!==-1},t.chartDetails.yAxis.grid={enabled:t.chartDetails.type.indexOf("Bar")===-1}),t.chartDetails.xAxis.grid.hasOwnProperty("drawBorder")||(t.chartDetails.xAxis.grid.drawBorder=!0),t.chartDetails.yAxis.grid.hasOwnProperty("drawBorder")||(t.chartDetails.yAxis.grid.drawBorder=!0),t.chartDetails.hasOwnProperty("groupBy")||(t.chartDetails.groupBy={},t.chartDetails.groupBy.enabled=!1,t.chartDetails.groupBy.field="");var T=this.getBodyFormat().theme.color.name,p=t.chartDetails.advancedOptions.color,m=ChartUtils.getChartColorOrder();if(p.length<7){for(var D=[],E=0;E<ChartUtils.getColorArrSize();E++)D.push(null);for(var E=0;E<p.length;E++){"Bold"===p[E]&&(p[E]="bold");var R=m.indexOf(p[E])!==-1;if(R){if(p[E]!==T){var S=["Pie","Doughnut"].indexOf(t.chartDetails.type)!==-1,C=t.chartDetails.type.startsWith("Stacked");"singleseries"!==t.chartDetails.series||S||C?D[E]=ChartUtils.getColorValue(p[E])[E]:D[E]=ChartUtils.getColorValue(p[E])[0]}}else D[E]=p[E]}D[7]=ChartUtils.isSingleSeriesWithSameColor(t.chartDetails)?"v1/1":"v1",t.chartDetails.advancedOptions.color=D}}if(t.al){if("left"==t.al||"right"==t.al)t[ATTR_IMAGE.I_WRAP_TYPE]="square",t[ATTR_IMAGE.I_H_POSITION]={},t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="align",t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_FROM]="column",t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_ALIGN_VAL]=t.al,delete t.left,t[ATTR_IMAGE.I_V_POSITION]={},t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_FROM]="paragraph",t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=t.top||0,delete t.top;else if("front"==t.al||"square"==t.al||"behind"==t.al){t.shapeData&&!t.top&&(t.top=t.shapeData.props.transform.pos.top),t.shapeData&&!t.left&&(t.left=t.shapeData.props.transform.pos.left);var A=0;if("square"!=t.al){var v=this.formats[o.findNextIndexOf(UNICODE.PARAGRAPH,l,this.content)];A=v[ATTR_PARAGRAPH.PS_ML]?v[ATTR_PARAGRAPH.PS_ML].convertor().pixels:0}t[ATTR_IMAGE.I_WRAP_TYPE]=t.al,t[ATTR_IMAGE.I_H_POSITION]={},t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_POSITION_FROM]="column",t[ATTR_IMAGE.I_H_POSITION][ATTR_IMAGE.I_LEFT]=A+t.left||0,delete t.left,t[ATTR_IMAGE.I_V_POSITION]={},t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_TYPE]="absolute",t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_POSITION_FROM]="paragraph",t[ATTR_IMAGE.I_V_POSITION][ATTR_IMAGE.I_TOP]=t.top||0,delete t.top}else delete t[ATTR_IMAGE.I_WRAP_TYPE];delete t.al}"number"==typeof t[ATTR_IMAGE.I_WRAP_TYPE]&&delete t[ATTR_IMAGE.I_WRAP_TYPE],t.hasOwnProperty(ATTR_IMAGE.I_ID)&&null!=t[ATTR_IMAGE.I_ID]||(t[ATTR_IMAGE.I_ID]=o.getRandomNumber())}else this.getCharAt(l)==UNICODE.CELL&&(t.pl&&"number"==typeof t.pl&&(t.pl=t.pl+"in"),t.pr&&"number"==typeof t.pr&&(t.pr=t.pr+"in"),t.pt&&"number"==typeof t.pt&&(t.pt=t.pt+"in"),t.pb&&"number"==typeof t.pb&&(t.pb=t.pb+"in"));if(t.type==NODE_TYPE.LINK&&t.lnktype==LINK_TYPES.MMFIELD||t.type==NODE_TYPE.IMAGE&&t[ATTR_IMAGE.I_LINKDATA]&&t[ATTR_IMAGE.I_LINKDATA].type==LINK_TYPES.MMFIELD)for(var _=t[ATTR_IMAGE.I_LINKDATA]||t,P=_.url||"",N=_[MAILMERGE.MMINFO]||{},b=N[MAILMERGE.MAPPING]||N,L=Object.keys(b),w={},y=0;y<L.length;y++){var M=L[y],F=b[M];if("object"==typeof F)break;var U={};U[MAILMERGE.FIELD_ID]=F,U[MAILMERGE.F_ID]=F,U[MAILMERGE.FIELD_NAME]=M,U[MAILMERGE.TYPE]=MAILMERGE.FIELD_TYPE.TEXT,w[F]=U,N={},N[MAILMERGE.MAPPING]=w,_[MAILMERGE.MMINFO]=N,P=P.replaceAll(UNICODE.MERGEFIELD_START+M+UNICODE.MERGEFIELD_END,UNICODE.MERGEFIELD_START+F+UNICODE.MERGEFIELD_END),_.url=P,t[ATTR_IMAGE.I_LINKDATA]?t[ATTR_IMAGE.I_LINKDATA]=_:t=_}if(t.type==NODE_TYPE.IMAGE&&t[MAILMERGE.MMINFO]){var V=t[MAILMERGE.MMINFO];if("clickableimage"==V[MAILMERGE.TYPE]){var B=V.link_field;delete V.link_field;var U={};U[MAILMERGE.FIELD_ID]=B,U[MAILMERGE.F_ID]=B,U[MAILMERGE.FIELD_NAME]=B,U[MAILMERGE.TYPE]=MAILMERGE.FIELD_TYPE.TEXT;var x={};x.type=LINK_TYPES.MMFIELD;var P=UNICODE.MERGEFIELD_START+B+UNICODE.MERGEFIELD_END;x.url=P;var b={};b[B]=U,x.mminfo={mapping:b},t.linkData=x}if(!V[MAILMERGE.MAPPING]){var b={},W=V.id;b[V.id]=V,V={},V={mapping:b},t[MAILMERGE.MMINFO]=V,t.src=UNICODE.MERGEFIELD_START+W+UNICODE.MERGEFIELD_END}if(!V[MAILMERGE.TYPE]){V[MAILMERGE.TYPE]=t.subType?t.subType.toLowerCase():MAILMERGE.FIELD_TYPE.IMAGE,t[MAILMERGE.MMINFO]=V;var H=V[MAILMERGE.MAPPING],G=a.getKeys(H);if(1==G.length){var W=G[0],U=H[W];U[MAILMERGE.LIST_TYPE]&&(V[MAILMERGE.LIST_TYPE]=U[MAILMERGE.LIST_TYPE]),V.type=U[MAILMERGE.TYPE]}}}if(t.ftype==NODE_TYPE.MAILMERGEFIELD&&t[MAILMERGE.MMINFO]){var V=t[MAILMERGE.MMINFO];if(V.type==MAILMERGE.FIELD_TYPE.SEQUENCE&&V[MAILMERGE.FORMAT]){for(var t=V[MAILMERGE.FORMAT],k=V[MAILMERGE.START_WITH]||"1";k.length<t.length;)k="0"+k;V[MAILMERGE.START_WITH]=k}}if(t.type==NODE_TYPE.TABLE){t[MAILMERGE.MMINFO]&&delete t[MAILMERGE.MMINFO],t.id||(t.id="tb-"+o.randomString(4));try{if(t.cols&&t.cols.length&&"object"==typeof t.cols[0]){for(var Y=t.cols,Z=Y.length,z=!1,J=0;J<Z;J++)if(isNaN(parseFloat(Y[J].wt))){z=!0;break}if(z){t.wid="100%";for(var j=(parseFloat(t.wid)/Z).toFixed(2)+UNITS.PERCENTAGE,J=0;J<Z;J++)Y[J].wt=j}}}catch(e){}}if(t.type&&t.type==NODE_TYPE.CELL&&t.ht&&"string"==typeof t.ht&&t.ht.indexOf("NaN")!=-1&&delete t.ht,(t[ATTR_COMMON.CLS]||"").indexOf(CONST.NEXTRECORD)!=-1){t.cls=CONST.NEXTRECORD;var X=this.formats[l-1];X.ftype=CONST.NEXTRECORD,this.setFormatAt(l-1,X)}if("autodocversion"==t.cls||"autoauthor"==t.cls||"autodocname"==t.cls){var K=this.formats[l-1];K&&K.type==NODE_TYPE.AUTOFIELD||(delete t[ATTR_COMMON.CLS],delete t[ATTR_COMMON.FIELDINFO])}if(this.setFormatAt(l,t),t.type===NODE_TYPE.CONDITIONAL_IF_START){if(!t.pattern){var Q,q=t.condition,$=[];$.push("(");for(var ee=0,te=q.length;ee<te;ee++)Q=ee+1,$.push(Q),ee<q.length-1&&$.push("OR");$.push(")"),$=$.join(" "),t.pattern=$,this.trigger(e.ERROR,"CONDITIONAL_PATTERN_MISSING")}if(!t.fieldInfos){for(var ie={},q=t.condition,E=0;E<q.length;E++){var ne=q[E],re=ne.lhs;if(re.type!=NODE_TYPE.MAILMERGEFIELD)break;var W=re.fieldId,U={};U[MAILMERGE.FIELD_ID]=W,U[MAILMERGE.F_ID]=W,U[MAILMERGE.FIELD_NAME]=W,U[MAILMERGE.TYPE]=MAILMERGE.FIELD_TYPE.TEXT,ie[W]=U;var oe=ne.rhs;if(oe.fieldInfo){var W=oe.fieldInfo[0].fieldId,U={};U[MAILMERGE.FIELD_ID]=W,U[MAILMERGE.F_ID]=W,U[MAILMERGE.FIELD_NAME]=W,U[MAILMERGE.TYPE]=MAILMERGE.FIELD_TYPE.TEXT,ie[W]=U,t.oldCondition=!0}}t.fieldInfos=ie}}if("endnote"===t.cls||"footnote"===t.cls){var K=this.formats[l-1],ae=this.formats[l+1];(K&&K.type!==t.cls||ae&&ae.type!==t.cls)&&this.setFormatAt(l,{type:"text"})}if("autofield"==t.type&&this.getCharAt(l)==UNICODE.RANGE_START){var ae=this.formats[l+1];ae&&ae.fieldinfo!=t.id&&(ae.fieldinfo=t.id,this.setFormatAt(l+1,ae),s=!0)}if("autofield"==t.type&&("autodate"==t.ftype||"createddate"==t.ftype||"lastmodifieddate"==t.ftype)||"fillablefield"==t.type&&t.ffInfo&&"date"==t.ffInfo.subType){if(!t.locale){var se=this.defaults&&this.defaults.language||"en-US";t.locale=se}ZWDateTime.migrateMomentFormat(t)}var le=t[TCConstants.TC];if(le){for(var de,ce=0;le[ce];)de=le[ce],de[TCConstants.TASK]&&de[TCConstants.TASK]===TCConstants.REMOVE?le.splice(ce,1):ce++;le.length||delete t[TCConstants.TC]}this.trigger(e.PROCESS_FORMAT,t)}s&&this.trigger(e.ERROR,"AUTOFIELD_MIGRATION"),ClientMigration.migrateDoc(this),this.trigger(e.INIT_END)},l.prototype.isSamePaperSizedDocument=function(){for(var e=0,t=this.getFormatAt(e),i=t.or,n=parseInt(t.ph.convertor().pixels),r=parseInt(t.pw.convertor().pixels);e<this.getDocumentLength();){e=o.findNextIndexOf(CONT_REGEXP.SECTIONEND,e+1,this.content);var a=this.getFormatAt(e);if(!a||!a.type||a.type!=NODE_TYPE.SECTION||"content"!=a.st)break;if(2==a.breakType){var s=parseInt(a.ph.convertor().pixels),l=parseInt(a.pw.convertor().pixels);if(i==a.or){if(n!=s||r!=l)return!1}else if(n!=l||r!=s)return!1}}return!0},l.prototype.getCharAt=function(t){if(t<0){var i="_"+ERROR_CODES.API_NEGATIVE_IDX+"_API_NEGATIVE_IDX_ doc.getCharAt("+t+")",n=new Error(ERROR_CODES.API_NEGATIVE_IDX);throw this.trigger(e.ERROR,"API_NEGATIVE_IDX",{error:n,errorStr:i}),n}return this.content.charAt(t)},l.prototype.getFormatAt=function(t){if(t<0){var i="_"+ERROR_CODES.API_NEGATIVE_IDX+"_API_NEGATIVE_IDX_ doc.getRawFormatAt("+t+")",n=new Error(ERROR_CODES.API_NEGATIVE_IDX);throw this.trigger(e.ERROR,"API_NEGATIVE_IDX",{error:n,errorStr:i}),n}return this.bucket.get(t)},l.prototype.getBodyFormat=function(){return this.defaults},l.prototype.setFormatAt=function(t,i){if(t<0){var n="_"+ERROR_CODES.API_NEGATIVE_IDX+"_API_NEGATIVE_IDX_ doc.setFormatAt("+t+")",r=new Error(ERROR_CODES.API_NEGATIVE_IDX);throw this.trigger(e.ERROR,"API_NEGATIVE_IDX",{error:r,errorStr:n}),r}this.bucket.set(t,i)},l.prototype.setBodyFormat=function(e){void 0===e.listFormat&&(e.listFormat={}),e.view&&"Normal View"==e.view&&(e.view="Page View"),e.dateFmt&&(e.dateFmt=ZWDateTime.migrateMomentToIntlFormat(e.dateFmt,e.language)),m(e),this.defaults=e},l.prototype.getText=function(t,i){var n=this.content.substring(t,i);if(t<0||i<0||i<t){var r="_"+ERROR_CODES.API_NEGATIVE_IDX+"_API_NEGATIVE_IDX_ doc.getContent("+t+", "+i+")",o=new Error(ERROR_CODES.API_NEGATIVE_IDX);throw this.trigger(e.ERROR,"API_NEGATIVE_IDX",{error:o,errorStr:r}),o}return n},l.prototype.getDocumentLength=function(){return this.content.length},l.prototype.getParents=function(e){},l.prototype.getElements=function(e,t,i){},l.prototype.getTableStart=function(e){},l.prototype.getRowStart=function(e){},l.prototype.getCellStart=function(e){},l.prototype.getTableEnd=function(e){},l.prototype.getRowEnd=function(e){},l.prototype.getCellEnd=function(e){},l.prototype.getFormulaAtIndex=function(e){},l.prototype.getFloatElementIdx=function(e,t){},l.prototype.getRangeStart=function(e){},l.prototype.getRangeEnd=function(e){},l.prototype.findNextIndexOf=function(e,t){},l.prototype.findPreviousIndexOf=function(e,t){},l.prototype.isBoundaryChar=function(e){},l.prototype.getFloatImageIndex=function(e){},l.prototype.linesBetween=function(e,t){},l.prototype.applyOps=function(t,n){try{if(!this.locks.isEmpty()&&!t.isLock){var o=i.xform(this.locks,t);t=i.concise(o.second),this.locks=i.concise(o.first)}}catch(i){return void this.trigger(e.ERROR,"LOCK_ERROR",{error:i,builder:t})}for(var s,l=0,d=0,c=[],O=[],m=[],I={},D="",R=t.docOps.length,S="",C=0,A=0,v=[];l<R;){if(d>this.getDocumentLength()||d<0){var _=new Error(ERROR_CODES.OP_IDX_IOB);throw this.trigger(e.ERROR,"OP_IDX_IOB",{error:_}),_}var P=t.docOps[l];if(null!=P.retain_count){d+=P.retain_count,C=P.retain_count;var N=!1;i.build([]);if(c.length){N=!0;var b,L=T(c),w=d-P.retain_count;if(L[NODE_TYPE.BODY]){G=L[NODE_TYPE.BODY];var y=new DocOp;y.changeStyles(null,G),this.trigger(e.STYLE_BEFORE_CHANGE,d,y,!0);var M=this.getBodyFormat();b=r.copyStyle(M),p.call(this,M,G),this.trigger(e.BODY_STYLE_CHANGED,w,d,b,L)}else{if(b=a.clone(this.getFormatAt(w)),L[NODE_TYPE.PARAGRAPH]&&!t.triggerPagination&&(L[NODE_TYPE.PARAGRAPH].hasOwnProperty(ATTR_PARAGRAPH.EN_PB)||L[NODE_TYPE.PARAGRAPH].hasOwnProperty(ATTR_PARAGRAPH.EN_BL)||L[NODE_TYPE.PARAGRAPH].hasOwnProperty(ATTR_PARAGRAPH.EN_WO))&&(t.triggerPagination=!0),L[NODE_TYPE.TEXT]){var F={},U=this.getFormatAt(w);a.isEmptyObject(U)&&(U=f.call(this,w)),F=r.copyStyle(U);var V=this.getCharAt(d),B=this.getFormatAt(d);V&&!r.isBoundaryChar(V)&&a.isEmptyObject(B)&&(B=f.call(this,d),a.isEmptyObject(B)&&(B={type:NODE_TYPE.TEXT}),this.setFormatAt(d,B)),a.isEmptyObject(F)||this.setFormatAt(w,F)}this.trigger(e.APPLYTO_BEFORE_STYLE_CHANGED,w,d,L),E.call(this,w,d,c),this.trigger(e.STYLE_CHANGED,w,d,b,L)}}this.trigger(e.APPLYTO_AFTER_RETAIN_PROCESS,N,C)}else if(null!=P.characters){var L,x=null,W=P.characters.length,H=c.length,G=c[H-1],D="",k={},B=this.getFormatAt(d),Y=d,Z=d+P.characters.length;if(this.trigger(e.BEFORE_CONTENT_INSERTION,P.characters),G){x=G,D=x.type;var V=this.getCharAt(d);V&&!r.isBoundaryChar(V)&&(k=f.call(this,d)),L=T(c)[G.type]}this.trigger(e.CONTENT_ADDED,Y,Z,P.characters,L),B||a.isEmptyObject(k)||this.setFormatAt(d,k),this.content=this.content.substr(0,d)+P.characters+this.content.substr(d),x?(this.bucket.put(d,{type:x.type}),E.call(this,d,d+1,c)):this.bucket.put(d,null);for(var z=1,J=W;z<J;z++)this.bucket.put(d+z,null);if(!G&&d&&r.isBoundaryChar(this.getCharAt(d-1))&&!r.isBoundaryChar(this.getCharAt(d))){var j=g.call(this,d),X=this.getFormatAt(j);X||(X={type:"text"}),this.setFormatAt(d,r.copyStyle(X)),h.call(this,d)}G&&h.call(this,d),d+=P.characters.length,this.trigger(e.AFTER_CONTENT_INSERTION)}else if(P.delete_characters){this.trigger(e.BEFORE_CONTENT_DELETION,d,d+P.delete_characters.length);for(var K,Q,q=d,$=d+P.delete_characters.length,ee=new RegExp(UNICODE.TABLE+"|"+UNICODE.TABLEEND,"g"),te=P.delete_characters;ee.test(te)&&ee.lastIndex>0;)if(Q=ee.lastIndex-1,K=te.charAt(Q),K===UNICODE.TABLE&&v.push(Q),K===UNICODE.TABLEEND){if(!v.length)throw this.trigger(e.ERROR,"TABLESTART_END_CHARS_COUNT_MISMATCH",{start:q,end:$}),"error in document applyTo";v.pop()}if($>this.getDocumentLength())throw this.trigger(e.ERROR,"DELETESTRING_IDX_EXCEEDS",{start:q,end:$}),"error in document applyTo";var ie=this.content.substring(q,$);if(ie!=P.delete_characters)throw this.trigger(e.ERROR,"DELETESTRING_MISMATCH",{start:q,end:$,deletedString:P.delete_characters}),"error in document applyTo";if(S+=ie,this.trigger(e.CONTENT_DELETED,q,q+P.delete_characters.length,ie),$<this.getDocumentLength()&&!this.getFormatAt($)){var ne=u.call(this,$),re=this.getFormatAt(ne);re=r.copyStyle(re),delete re[ATTR_TEXT.TS_SP],delete re[ATTR_TEXT.TS_GR],delete re[ATTR_TEXT.TS_PROOFING_WQ],ne>=q&&ne<$&&this.setFormatAt($,re)}this.bucket.remove(q,P.delete_characters.length),this.content=this.content.substr(0,q)+this.content.substr($),h.call(this,d),this.trigger(e.AFTER_CONTENT_DELETION)}else if(P.styles){if(0==P.styles.end.length)if(this.trigger(e.APPLYTO_STYLE_APPLIED,P),P.styles.begin.chartDetails&&(P.styles.begin.type="chart"),"namedrange"!=P.styles.begin.type||n)m.push(d),c.push(P.styles.begin),O.push(P.styles.id);else{var oe=P.styles,ae={id:oe.begin.id,start:d,style:oe.begin,action:oe.begin.action,styleId:oe.id};I[ae.styleId]=ae}else if(P.styles.end.length>0){var se=P.styles.id,le=!1;for(s=c.length,A=s-1;A>=0;A--)if(O[A]==se){c.splice(A,1),m.splice(A,1),O.splice(A,1),le=!0;break}if(I&&I[se]){var de=I[se];de.end=d,this.trigger(e.NAMED_RANGE,de,!n),delete I[se]}else le||(c.pop(),O.pop(),m.pop())}}else if(P.isLock()){var $=P.length();if(P.isUnLock())try{this.updateLock(d,d+$,t),0==P.isRedact()&&t.redactContent&&(this.content=this.content.substr(0,d)+t.redactContent+this.content.substr(d+$),this.trigger(e.CONTENT_UNMASKED))}catch(i){return void this.trigger(e.ERROR,"LOCK_ERROR",{error:i,builder:t})}else{var ce=!0;this.updateLock(d,d+$,t,ce),P.isRedact()&&t.redactContent?(this.content=this.content.substr(0,d)+t.redactContent+this.content.substr(d+$),this.trigger(e.CONTENT_MASKED)):0==P.isRedact()&&t.redactContent&&(this.content=this.content.substr(0,d)+t.redactContent+this.content.substr(d+$),this.trigger(e.CONTENT_UNMASKED))}d+=$}l++}if(v.length)throw this.trigger(e.ERROR,"TABLESTART_END_CHARS_COUNT_MISMATCH"),"error in document applyTo";this.applyToSequenceNumber=this.applyToSequenceNumber+1,this.updateRanges(),this.trigger(e.APPLYTO_COMPLETE)},l.prototype.getApplyToSequence=function(){return this.applyToSequenceNumber},l.prototype.updateLock=function(t,n,r,o){o?this.locks.isEmpty()?this.locks=r:(this.locks=i.compose(this.locks,r),this.locks=i.concise(this.locks)):this.locks.isEmpty()||(this.locks=i.concise(i.compose(this.locks,r)),this.locks=i.cleanUpUnlockOp(this.locks)),this.trigger(e.LOCK_UPDATED,t,n)},l.prototype.getLocks=function(){return this.locks},l.prototype.updateRanges=function(){for(var e in this.ranges)switch(e){case"namedRange":this.ranges.namedRange=NamedRange.getComposedNamedRangeOp()}},l.prototype.getRanges=function(){return this.ranges},l.prototype.getFormats=function(){return this.bucket.getFormats()},l.prototype.getDocument=function(){var e={};e.content=this.content,e.styles=this.bucket.getFormats(),e.defaults=this.getBodyFormat(),e.locks=JSON.parse(this.locks.toString());var t=a.clone(this.ranges);for(var i in t)t[i]?t[i]=JSON.parse(t[i].toString()):t[i]=[];return e.ranges=t,e},l.prototype.getFormatsBetween=function(e,t){var i;return i="undefined"!=typeof e?this.bucket.getBetweenIdx(e,t):this.bucket.getFormats()},l.prototype.destroy=function(){this.content="",this.formats=[],this.defaults={},this.locks=i.build([]),this.bucket=null,this.ranges={namedRange:i.build([])},this.trigger(e.DESTROYED),this.resetEventHandler()},l.prototype.getId=function(){return this.id},l.prototype.insertChar=function(e,t){},l.prototype.insertFormat=function(e,t){};var S=UNICODE.PARA+"|"+UNICODE.RANGE_START+"|"+UNICODE.IMAGE+"|"+UNICODE.TABLE+"|"+UNICODE.ROW+"|"+UNICODE.CELL+"|"+UNICODE.SECTION_START,C=RegExp(S,"gi"),A=RegExp(UNICODE.SECTION_START,"gi"),v=!0,_={},P=0,N={},b={table:function(){return"tb-"+o.randomString(4)},row:function(){return"rw-"+o.randomString(4)},cell:function(){return"cl-"+o.randomString(4)},content:o.randomId.bind(null,"content"),header:o.randomId.bind(null,"header"),footer:o.randomId.bind(null,"footer"),endnote:o.randomId.bind(null,"endnote"),footnote:o.randomId.bind(null,"footnote"),textbox:o.randomString.bind(null)},L=[ATTR_SECTION.HEADER_IDS,ATTR_SECTION.FOOTER_IDS],w=function(e){var t=e.index,i=e.clonedModelData,n=i.styles,r=n[t];if(r.ls_data){var a=(i.defaults||{}).listFormat||{},s=r.ls_data,l=s.id,d="";_[l]?d=_[l]:(d=o.getRandomNumber(),_[l]=d,a[d+""]=a[l],delete a[l]),s.id=d,i.defaults.listFormat=a}},y=function(e){var t=e.index,i=e.formats[t],n=this.metaIDMap[i.id];W(t,e.clonedModelData,n)},M=function(e,t){var i=t.styles[e];i.id in this.metaIDMap&&(i.id=this.metaIDMap[i.id]),delete i.fid},F=function(e,t){var i=t.styles,n=i[e];if(n.id){var r=o.randomString();n.id=r}if(n.shapeData&&(n.shapeData.nvOProps&&(n.shapeData.nvOProps.nvDProps.id=Math.uuid()),n.shapeData.shapes))for(var a=n.shapeData.shapes,s=0;s<a.length;s++){var l=a[s];l.nvOProps&&(l.nvOProps.nvDProps.id=Math.uuid())}i[e]=n},U=function(e,t){var i=t.styles,n=i[e];n.id&&(n.subType==NODE_TYPE.TEXTBOX?M.call(this,e,t):n.id=o.randomString(),i[e]=n)},V=function(e){var t=e.index,i=e.clonedModelData,n=e.formats;n[t].shapeData?F.call(this,t,i):U.call(this,t,i)},B=function(e){var t=e.index,i=e.clonedModelData,n=i.content,r=i.styles,a=H(t,n,r);if(a!=-1){var s=r[t],l=s.id,d=o.randomString();s.id=d,r[t]=s;for(var c=n.indexOf(UNICODE.FIELD_SEPARATOR,t),u=r[c],g=u.id;g!=l;)c=n.indexOf(UNICODE.FIELD_SEPARATOR,c+1),u=r[c],g=u.id;u.id=d,r[c]=u;var h=r[a];h.id=d,r[a]=h,i.content=n,i.styles=r}},x=function(e){var t;return e in N?t=N[e]:(t=e+P,N[e]=t),t},W=function(e,t,i){var n=t.content,r=t.styles,a=H(e,n,r);if(a!=-1){i=i||o.randomString();var s=r[e],l=s.type,d=s.id;d.startsWith("toc_")&&(i="toc_"+i),s.id=i;var c=s.name,u=o.randomString();l==NODE_TYPE.LINK&&s.lnktype==LINK_TYPES.BOOKMARK?c=s.url:l==NODE_TYPE.AUTOFIELD&&s.ftype==AUTOFIELD_TYPE.AUTO_PAGE_REF&&s.bookmarkId&&(c=s.bookmarkId,s.bookmarkId=x(c)),c&&(u=N[c]?N[c]:c+P,N[c]=u),s.name&&!s.ffInfo&&(s.name=u),s.url&&l==NODE_TYPE.LINK&&s.lnktype==LINK_TYPES.BOOKMARK&&(s.url=u),r[e]=s;var g=r[e+1];g&&"textbox"!=g.subType&&"endnote"!=g.type&&"footnote"!=g.type&&n[e+1]!=UNICODE.RANGE_START&&(g.id&&(g.id=i),g.fieldinfo&&(g.fieldinfo=i),g.url&&g.lnktype==LINK_TYPES.BOOKMARK&&(g.url=u),r[e+1]=g);var h=r[a];h.id=i,h.name&&(h.name=u),r[a]=h,t.content=n,t.styles=r}},H=function(e,t,i){for(var n=i[e],r=n.id,o=t.indexOf(UNICODE.RANGE_END,e+1),a=i[o]||{},s=a.id;o!=-1&&r!=s;)o=t.indexOf(UNICODE.RANGE_END,o+1),a=i[o]||{},s=a.id;return o},G=function(e){var t=e.index,i=e.clonedModelData,n=e.nodeType,r=b[n]();i.styles[t].id=r},k=function(e){for(var t,i,n=e.formats[e.index],r=0;r<L.length;++r)if(i=L[r],n[i])for(var o=0;o<n[i].length;++o)t=n[i][o],t in this.metaIDMap&&(n[i][o]=this.metaIDMap[t])},Y=function(e){var t=e.format;v&&(this.usedIDMap[t.sid]=!0);var i;i=b[t.st](),this.usedIDMap[i]=!0,this.metaIDMap[t.sid]=i,t.sid=i},Z={};Z[NODE_TYPE.PARAGRAPH]=w,Z[NODE_TYPE.ENDNOTE]=Z[NODE_TYPE.FOOTNOTE]=y,Z[NODE_TYPE.IMAGE]=V,Z[NODE_TYPE.TABLE]=Z[NODE_TYPE.ROW]=Z[NODE_TYPE.CELL]=G,Z[NODE_TYPE.CONDITIONAL_IF_START]=B,Z[NODE_TYPE.SECTION]=k;var z=function(){for(var e=A.exec(this.clonedModelData.content);e;){var t=e.index,i=this.clonedModelData.styles[t];Y.call(this,{format:i,index:t}),e=A.exec(this.clonedModelData.content)}},J=function(){for(var e=C.exec(this.clonedModelData.content);e;){var t=e.index,i=this.clonedModelData.styles,n=i[t].type;n in Z?Z[n].call(this,{index:t,clonedModelData:this.clonedModelData,formats:i,nodeType:n}):W(t,this.clonedModelData),e=C.exec(this.clonedModelData.content);}};d.prototype.getCloneContent=function(){return z.call(this),J.call(this),P++,v&&(v=!1),_={},N={},this.clonedModelData};var j=function(){var e=this.clonedModelData.content.indexOf(UNICODE.TOCSTART);if(e!=-1){var t=this.clonedModelData.content.indexOf(UNICODE.TOCEND,e);this.clonedModelData.content=this.clonedModelData.content.slice(0,e)+this.clonedModelData.content.slice(t+1),this.clonedModelData.styles.splice(e,t+1-e)}},X=function(){for(var e=this.clonedModelData,t=e.content.indexOf(UNICODE.RANGE_START);t!=-1&&e.styles[t].type==NODE_TYPE.COMMENT;){var i=H(t,e.content,e.styles);i!=-1&&(e.content=e.content.slice(0,i)+e.content.slice(i+1),e.styles.splice(i,1)),e.content=e.content.slice(0,t)+e.content.slice(t+1),e.styles.splice(t,1),t=e.content.indexOf(UNICODE.RANGE_START,t+1)}};c.prototype=Object.create(d.prototype),Object.defineProperty(c.prototype,"constructor",{value:c,enumerable:!1,writable:!0}),l.prototype.getMultipleCloneContent=function(e){var t=[];e=e||1;for(var i=0;i<e;++i)t.push(this.cloneContent());return t},l.prototype.getMultipleCloneForMailMerge=function(e){var t=[];e=e||1;for(var i=0;i<e;++i)t.push(this.getCloneForMailMerge(i));return t},l.prototype.getCloneForMailMerge=function(e){var t=new c(this,e);return t.getCloneContent()},l.prototype.cloneContent=function(){var e=new d(this);return e.getCloneContent()};var K={contentSectEndIndx:function(e){return"content"==e},hdrFtrEndIndx:function(e){return"header"==e||"footer"==e}},Q={content:function(e,t){return e[t].slice(0,e.contentSectEndIndx)},hdrFtr:function(e,t){return e[t].slice(e.contentSectEndIndx,e.hdrFtrEndIndx)},other:function(e,t){return e[t].slice(e.hdrFtrEndIndx)}},q=function(e){var t,i={contentSectEndIndx:0,hdrFtrEndIndx:0};for(var n in i){do i[n]=e.content.indexOf(UNICODE.SECTION_START,i[n]+1),t=i[n],i[n]==-1&&(i[n]=e.content.length);while(t!=-1&&K[n](e.styles[t].st));"contentSectEndIndx"==n&&(i.hdrFtrEndIndx=i.contentSectEndIndx),e[n]=i[n]}return i},$=function(e,t){var i=t.defaults.listFormat;for(var n in i)e.defaults.listFormat[n]=a.clone(i[n])};return l.prototype.mergeContent=function(e){var t=a.clone(e[0]);t.styles=[],t.content="";var i,n;for(var r in Q)for(var o,s=0;s<e.length;++s)o=e[s],"content"==r&&(q(o),$(t,o)),i=Q[r](o,"content"),t.content=t.content.concat(i),n=Q[r](o,"styles"),t.styles=t.styles.concat(n);return t},s.call(l.prototype),l};Model=Model(MODEL,BucketArray,DocOpBuilder,DocOpUtil,DocUtil,Utils,ZWJSONUtils,BaseEventHandler),isV8Engine||(MsgHandler.logger=new ZWConsole),MsgHandler.handleJoin=function(e){editor.doc.getRole()!=USER_ROLE.PUBLIC&&WebMessanger.join(e)},MsgHandler.handlePresenceCallback=function(e,t){MsgHandler.logger.log("@handlePresenceCallback",e,t),PubSub.publish("Collaboration/UserAdded",t,e[t]),e[t]&&e[t].unique_userid&&(t=e[t].unique_userid,editor.doc.updateUserData(t,e[t])),editor.getRole().permissions.can("document.edit")&&ZWCollaboration.sendCursorMutation()},MsgHandler.handlePresence=function(e,t,i,n,r){var o=editor.doc.docInfo;if(e==o.COLLAB_ID)if(i=i||t,"1"==r)MsgHandler.logger.log("@handlePresence",e,t,i,n,r),editor.doc.getUserData()[i]||Utils.getUserMode(i,o.DOCUMENT_ID,MsgHandler.handlePresenceCallback,i);else{PubSub.publish("Collaboration/UserRemoved",i);var a=editor.doc.getUserData();a[i]&&a[i].unique_userid&&(i=a[i].unique_userid,editor.doc.removeUserData(i))}},MsgHandler.handleServerDown=function(){ZWOffline.isOfflineSetupDone()&&!editor.getRole().permissions.can("document.edit")&&"TEMPLATE_USER"!==editor.doc.getRole()&&(OfflineImpl.handleNetworkDown(),ZWNetworkUtils.retryNetwork())},MsgHandler.handleServerUp=function(){Macros.joinCollaboration()},MsgHandler.handleBroadcastMessage=function(e,t,i,n,r){var o=editor.doc.docInfo;if("CREATE_VERSION"==r.ACTION)return void DocInfo.setProperty({DOCS_VERSION:r.DOCS_VERSION});if(e==o.COLLAB_ID){var a=r.ACTION,s=!1;if(i||(i=n,s=!0),editor.doc.getUserData()[i]||Utils.getUserMode(i,editor.doc.docInfo.DOCUMENT_ID,MsgHandler.handlePresenceCallback,i,!0),s&&(n=editor.doc.getUserData()[i].fname),"DOCUMENT_FINAL_STATE_UPDATE"==r.ACTION)return void PubSub.publish("Document/FinalStateModified",r.docInfo,r.SESSIONID);if("IMAGESAVE"==r.ACTION)return void(r.SESSIONID!=editor.uuid&&DomUtil.updateImageSrc(r.IMGSRC));if("DOCUMENT_PUBLISH"==r.ACTION)return void Utils.loadRTE(!0,function(){PubSub.publish("Publish/Init",{operation:{action:"wms",data:r.data||{}}})});if("CHANGEPERMISSION"==r.ACTION)return void PubSub.publish("Collaboration/DocPermissionChanged",r.OWNER);if("READER_INSIGHTS_STATS"===r.ACTION)PubSub.publish("Stats/Fetch");else{if("REVERT"==a)return void(editor.getRole().permissions.can("document.edit")||editor.getRole().permissions.can("document.fill")||o.CREATOR_ZUID==editor.zuid?PubSub.publish("Collaboration/DocumentReverted",n,r.UPDATED_TIME,i,r):UIUtils.showMessage("info",J.i18n("common","REVERTED_INFO",[n,new ZWDateTime(r.UPDATED_TIME,null,editorProps.userInfo.language).format("MMM DD YYYY, hh:mm A")]),"showclose","normalfont",5e3));if("csv_update"==r.ACTION)return void UIUtils.showMessagePopup(r.MSG,J.i18n("common","ALERT"),"info",function(){document.location.reload()},!0);if("MERGE_DOCUMENT"==r.ACTION)return void((editor.getRole().permissions.can("document.edit")||o.CREATOR_ZUID==editor.zuid)&&PubSub.publish("Collaboration/DocumentMerged",i,r));if("REMIGRATE"==a)return void PubSub.publish("Collaboration/DocumentMigratedTo3.0");if("VERSION_UPLOAD"==a)return void PubSub.publish("Document/Warning",WARNING_MSG.NEW_VERSION_UPLOADED);if("MailMerge/Fieldsmodified"==a||"MailMerge/SourceDeleted"==a||"MailMerge/RecordAdded"==a){var l=JSON.parse(r.INFO);return void PubSub.publish(a,l)}if("MailMerge/SourceDeleted"==a)return void PubSub.publish(a);if("UPDATE_USER_DATA"===a){var d=JSON.parse(r.collabUsersDetails);return void(editor.doc.userData=extend(editor.doc.userData,d))}if("UPDATEWORKFLOW"===a){var c=r.WORKFLOW,u=r.SESSIONID;PubSub.publish("Document/WorkflowUpdated",c,u)}}if(ZWCollaboration.syncSent||editor.isNonEditableView()||ZWCollaboration.stopUpdates||e!==o.COLLAB_ID)return void ZWLogger.log("Return broadcast msg:"+ZWCollaboration.syncSent);if("CHAT"==a)i!=editor.zuid&&CollabPanelHandler.addChatMessage(i,n,r.MESSAGE);else if("UPDATESEG"==a){var g=r.VERSION,u=r.SESSIONID,h=r.REVISION,f={version:parseInt(g),revision:parseInt(h)},p={version:parseInt(o.VERSION),revision:parseInt(o.REVISION)},E=DocUtil.getVersionNumberDiff(f,p);if(u==editor.uuid)return;if(E<0)return;if(0==E){var T=editor.doc.getSelection();if(T&&u!=editor.uuid&&r.mc)for(var O,m=JSON.parse(r.mc),I=0,D=m.length;I<D;I++)O=T.createCursorOp(m[I].si,m[I].ei,i),O=DocOpBuilder.build(O),ZWCollaboration.applyCollaboratorsMutation(O,r,u,i,!0,n,I);return}if(1==E){if(u!=editor.uuid&&r.mc&&!r.COMPOSEDOP)return void ZWCollaboration.checkServerVersion()}else if(E>1||r.FETCHOPS&&u!=editor.uuid)return void ZWCollaboration.checkServerVersion();if(u!=editor.uuid){if(r.COMPOSEDOP){ZWLogger.log("handleBroadcastMessageEDIT RECD FROM "+i+" @ "+g+"."+h);var R=DocOpBuilder.build(r.COMPOSEDOP);ZWCollaboration.applyCollaboratorsMutation(R,r,u,i,!1,n)}var T=editor.doc.getSelection();if(T&&r.mc)for(var m=JSON.parse(r.mc),I=0,D=m.length;I<D;I++)O=T.createCursorOp(m[I].si,m[I].ei,i),O=DocOpBuilder.build(O),ZWCollaboration.applyCollaboratorsMutation(O,r,u,i,!0,n,I);PubSub.publish("Document/CollaboratorOpReceived",r,i)}}else if("REDACTSYNC"==r.ACTION&&editor.zuid!=r.zuid)ZWCollaboration.checkServerVersion();else if("LOCK_DOCUMENT"==a)r.USER_ZUID!==editor.zuid&&(r.LOCK?editor.lock():editor.unlock());else if("REMOTE_TRASH"==a)PubSub.publish("Document/RemoteTrashed",r.CUSTOM_MESSAGE);else if("REMOTE_SESSION_DELETED"==a){var i=r.USERID;RemoteEditor&&RemoteEditor.options.wms_annnonuser_id==i&&PubSub.publish("Document/RemoteTrashed",r.CUSTOM_MESSAGE)}else if("SESSION_INVALID"===a){var S={src:r.JSPATH+"js/zwsession_invalid.js"};loadJS(S)}else if("comment"==a)PubSub.publish("Comment/CollaboratorOpReceived",r,i);else if("RELOAD_COMMENTS"===a)PubSub.publish("Comment/Reload");else{if("USERCOLOR_UPDATED"==r.ACTION){var C=editor.doc.getUserData(),A=r.USER_DATA,i=A.zuid;return void(C[i]&&(C[i].color=A.color,C[i].light_color=A.lightColor,editor.doc.setUserData(C),PubSub.publish("Collaboration/UsercolorUpdated",i)))}if("RESOURCE_LOCKED"==a)return r.MESSAGE&&(r.MESSAGE=J.i18n("writer.remote.LOCKED_USER_MSG",[r.LOCKED_USER_NAME])),void PubSub.publish("Collaboration/ResourceLocked",r.LOCKED_USER_ZUID,r.LOCKED_USER_NAME,!1,r.MESSAGE);if("email_document"==a&&i===editor.zuid)return void Utils.loadRTE(!0,function(){PubSub.publish("Email/Init",{operation:{action:"wms",data:r.data||{}}})})}if("POST_TO_BLOG"==a)return void(i===editor.zuid&&("Wordpress"==r.data.SERVICE?PubSub.publish("PostToBlog/init",{operation:{service:"wordpress",action:"wms",data:r.data||{}}}):PubSub.publish("PostToBlog/init",{operation:{service:"blogger",action:"wms",data:r.data||{}}})));if("DOCUMENT_HANDED_OVER"==r.ACTION){var v=J.i18n("writer.common.DOCUMENT_HANDED_OVER",[r.USER1_NAME,r.USER2_NAME]),_=J.i18n("writer.common.DOCUMENTHANDEDOVER_TITLE_MSG",[r.DOCUMENTHANDEDOVER_TITLE_MSG]);return void UIUtils.showMessagePopup(v,_,"info",function(){document.location.reload()},!0)}if("RELOAD_WORKFLOW"===r.ACTION)PubSub.publish("Document/Workflow/Reload",r);else if("UPDATE_WORKFLOW"===r.ACTION)PubSub.publish("Document/Workflow/Updated",r);else if("COLLABORATOR_JOINED"==r.ACTION){if(i!=editor.zuid){var d=editor.doc.getUserData()[i],P={};P[i]=ZWJSONUtils.clone(d);var N=r.USER_UUID,b=[];d.uuids&&(b=d.uuids.split(",")),b.contains(N)||(P[i].uuids=b.length?d.uuids+","+N:N,MsgHandler.handlePresenceCallback(P,i))}return}}},MsgHandler.handleCustomMessage=function(e){var t=editor.doc.docInfo;if("ZWUSER_SESSION_MANAGEMENT"===e.ACTION){var i=e.SUBACTION;return void("ZW_SESSION_RELOAD"===i?window.location.reload():"ZW_SESSION_LOGOUT"===i?window.location.href="/writer/jsp/logout.jsp?ref=a_wms":"ZW_SESSION_TAB_CLOSE"===i&&window.close())}if(!e.COLLABID||e.COLLABID==t.COLLAB_ID){var n=e.ACTION;if("VERSION_UPLOAD"==n)if(e.VERSION&&e.REVISION){var r=DocUtil.getVersionFromMsg(e),o=DocUtil.getCurrentDocVersion(),a=DocUtil.getVersionNumberDiff(o,r);a<0&&ZWCollaboration.updateVersion(e.VERSION,e.REVISION,e.DOCS_VERSION)}else PubSub.publish("Document/Warning",WARNING_MSG.NEW_VERSION_UPLOADED);else if("UPDATESEG"==n||"comment"===n)MsgHandler.handleBroadcastMessage(e.COLLABID,e.zuid,e.zuid,e.uname,e);else if("PARTNER_REMOTESAVERESPONSE"===n){var s=e.statusValue,l=e.statusCode;l&&200==l&&Macros.updatePartnerSaveStatus(!0),e.showMessage&&"true"===e.showMessage&&(REMOTE_MESSAGE[s]?UIUtils.showLoadingMsg(J.i18n(REMOTE_MESSAGE[s]),5e3):"datasaved"==s?(UIUtils.showLoadingMsg(J.i18n("writer.remotesave.SUCCESS"),3e3),Macros.updatePartnerSaveStatus(!0)):"responsenull"==s?200!=l?UIUtils.showLoadingMsg(J.i18n("writer.remotesave.REMOTESAVE_ERR_MSG1"),5e3):UIUtils.showLoadingMsg(J.i18n("writer.remotesave.SUCCESS"),3e3):200!=l?UIUtils.showLoadingMsg(s,5e3):UIUtils.showLoadingMsg(s,3e3))}else"CHATBAR_VIEW_CHANGED"==e.ACTION&&e.SESSIONID!=editor.uuid&&UIUtils.handleChatBarView(e.SHOWCHATBAR);if("EXTENSION_CONNECTION_UPDATE"==e.ACTION){var d=jsCdnZWStaticPath+fingerPrintObj["js/writer_extension_min_all.js"];zw.require({js:[d]},[],function(){MarketplaceHandler.connectionStatusHandler(e)})}}};var SHAREDUSERSLIST=[];MsgHandler.handleUserAdd=function(e,t){e==editor.doc.docInfo.COLLAB_ID&&jQuery.map(t,function(e,t){SHAREDUSERSLIST.push(e)})},MsgHandler.handleUserDeleted=function(e,t){if(e==editor.doc.docInfo.COLLAB_ID){editor.loginName!=t[0].uname&&editor.zuid!=t[0].uname||ZWCollaboration.htabs.deleteTabArray(editor.doc.docInfo.DOCUMENT_ID.split(","));for(var i=SHAREDUSERSLIST.length,n=0;n<i;n++){var r=SHAREDUSERSLIST[n],o=r.uname;if(t[0].uname==o){SHAREDUSERSLIST.splice(n,1);break}}var a=t[0].uname;PubSub.publish("Collaboration/UserRemoved",a);var s=editor.doc.getUserData();if(s[a]&&s[a].unique_userid){var l=s[a].unique_userid;editor.doc.removeUserData(l)}}},MsgHandler.handleCrossProductMessage=function(e,t){if(editor.doc.getRole()!=USER_ROLE.PUBLIC){var i=t.ACTION,n=t.RESOURCE_ID;if("EX"===e&&"UDSERVER_UPLOAD"===i&&ImportDialog.updateImportStatus(t),"SG"===e){if("PROFILE_UPDATED"===i)return PubSub.publish("Esign/ZohoSign/Profile/Updated",t);var r=JSON.parse(t);r.account_created&&PubSub.publish("Esign/ZohoSign/Account/Added",r)}if("email_document"===i)return void Utils.loadRTE(!0,function(){PubSub.publish("Email/Init",{operation:{action:"wms",data:t.data||{}}})});if("ESIGN"===i)return void PubSub.publish("Esign/Init",{operation:{action:"wms",data:t.data||{}}});if("POST_TO_BLOG"===i)return void("Wordpress"==t.data.SERVICE?PubSub.publish("PostToBlog/init",{operation:{service:"wordpress",action:"wms",data:t.data||{}}}):PubSub.publish("PostToBlog/init",{operation:{service:"blogger",action:"wms",data:t.data||{}}}));if(n==editor.doc.docInfo.RID||t.resource_id==editor.doc.docInfo.RID){var o=t.ACTION_BY,a=t.ACTION_BY_USERNAME,s=editor.zuid,l=t.ACTION_INFO;switch(l=l?l:"{}",l=JSON.parse(l),i){case"RESOURCE_RENAMED":return void PubSub.publish("Document/Renamed",t.NAME);case"RESOURCE_PERMISSION_CHANGED":return void(s!=o&&PubSub.publish("Collaboration/DocPermissionChanged",o,a));case"RESOURCE_SHARED":return void PubSub.publish("Collaboration/ResourceShared",l.SHARED_TO);case"RESOURCE_UNSHARED":var d=l.SHARED_TO,c=d.split(",");if(c.indexOf(s)>-1)return void PubSub.publish("Collaboration/ResourcePermissionRemoved",o,a);PubSub.publish("Collaboration/ResourceUnshared",c);for(var u=0,g=c.length;u<g;u++)ZWCollaboration.removeCollaborator(c[u]);return;case"RESOURCE_TRASHED":return void PubSub.publish("Document/Trashed",o);case"RESOURCE_LOCKED":return void PubSub.publish("Collaboration/ResourceLocked",o,a,!0);case"RESOURCE_UNLOCKED":return void PubSub.publish("Collaboration/ResourceUnLocked",o,a)}if("MARK_AS_COMPLETE"===t.OPERATION||"CREATE"===t.OPERATION){MarkAsReady.wmsMsgHandler(t);var h=editorProps.permissionsInfo.appInfo.NAME;return void("teamdrive"===h&&"MARK_AS_COMPLETE"===t.OPERATION&&(editorProps.teamdrive.state="ready",PubSub.publish("Document/MarkedReady")))}if("REMOVE_FAVOURITE"!==i&&"MAKE_FAVOURITE"!=i)return"UPDATE_TITLE"==t.action?void PubSub.publish("Document/Update/Title",t.title):void 0;if(o==editor.zuid){var f="MAKE_FAVOURITE"==i;editorProps.userInfo.is_favourite=f,UIUtils.handleFavouriteView()}}}},MsgHandler.processAcknowledgement=function(e){var t=DocUtil.getVersionFromMsg(e),i=DocUtil.getCurrentDocVersion(),n=DocUtil.getVersionNumberDiff(t,i);ZWLogger.log("processAcknowledgementRES:"+t.version+"."+t.revision+",DIFF:"+n),1==n?(ZWCollaboration.updateVersion(e.VERSION,e.REVISION,e.DOCS_VERSION,e.VERSION_ID),ZWCollaboration.msgQueue.ackReceived(),ZWCollaboration.sendPendingMutation(),PubSub.publish("Document/SaveStatus",!0,void 0,editor.zuid,null,!0),e.MAX_REVISION&&(MAX_REVISION=e.MAX_REVISION)):n>1&&ZWCollaboration.checkServerVersion()},MsgHandler.openURL=function(e,t,i,n){return"WR"===n},MsgHandler.handleLogout=function(e){},MsgHandler.getPageTitle=function(){var e=editor.doc.docInfo;if(e&&e.DOCUMENT_NAME)return e.DOCUMENT_NAME},MsgHandler.handleComposeMail=function(e,t){return!1};var serverUpHandler=function(){if(MsgHandler.handleServerUp(),ZWCollaboration.serverupInvoked){if(!editor.getRole().permissions.can("document.edit"))return;return ZWCollaboration.LASTREQUEST_TIMESTAMP=(new Date).getTime(),void ZWCollaboration.checkForResend()}ZWCollaboration.serverupInvoked=!0};MsgHandler.subscribe=function(){PubSub.subscribe("WMS/UserPresence",MsgHandler.handlePresence),0==ZWOffline.isOfflineOperationsAllowed()&&PubSub.subscribe("WMS/ServerUp",serverUpHandler),PubSub.subscribe("WMS/ServerDown",MsgHandler.handleServerDown),PubSub.subscribe("WMS/Message",MsgHandler.handleBroadcastMessage),PubSub.subscribe("WMS/CustomMessage",MsgHandler.handleCustomMessage),PubSub.subscribe("WMS/UserAdded",MsgHandler.handleUserAdd),PubSub.subscribe("WMS/UserDeleted",MsgHandler.handleUserDeleted),PubSub.subscribe("WMS/CrossProductMessage",MsgHandler.handleCrossProductMessage),PubSub.subscribe("WMS/Logout",MsgHandler.handleLogout)},MsgHandler.unsubscribe=function(){PubSub.unsubscribe("WMS/UserPresence",MsgHandler.handlePresence),0==ZWOffline.isOfflineOperationsAllowed()&&PubSub.unsubscribe("WMS/ServerUp",serverUpHandler),PubSub.unsubscribe("WMS/ServerDown",MsgHandler.handleServerDown),PubSub.unsubscribe("WMS/Message",MsgHandler.handleBroadcastMessage),PubSub.unsubscribe("WMS/CustomMessage",MsgHandler.handleCustomMessage),PubSub.unsubscribe("WMS/UserAdded",MsgHandler.handleUserAdd),PubSub.unsubscribe("WMS/UserDeleted",MsgHandler.handleUserDeleted),PubSub.unsubscribe("WMS/CrossProductMessage",MsgHandler.handleCrossProductMessage),PubSub.unsubscribe("WMS/Logout",MsgHandler.handleLogout)},MsgHandler.handleNetworkChangeEvent=function(){editor.isOffline()?MsgHandler.unsubscribe():MsgHandler.subscribe()},PubSub.subscribe("Document/BeforeInitEditor",function(){ZWOffline.isOfflineOperationsAllowed()?PubSub.subscribe("NetworkState/Changed",MsgHandler.handleNetworkChangeEvent):MsgHandler.subscribe()}),function(e){function t(t){return function(){var n=[t].concat(i.call(arguments,0));e.publish.apply(e,n)}}var i=Array.prototype.slice,n={handleUserList:"WMS/UserList",handlePresence:"WMS/UserPresence",handleBroadcastMessage:"WMS/Message",handleServerUp:"WMS/ServerUp",handleServerDown:"WMS/ServerDown",handleUserAdd:"WMS/UserAdded",handleUserDeleted:"WMS/UserDeleted",handleCrossProductMessage:"WMS/CrossProductMessage",handleLogout:"WMS/Logout",handleCustomMessage:"WMS/CustomMessage"},r={handleJoin:function(e){WebMessanger.join(e)},handleQuit:function(e){return WebMessanger.quit(e)},openURL:function(e,t,i,n){return"WR"===n},getPageTitle:function(){var e=editor.doc.docInfo;return e&&e.DOCUMENT_NAME?e.DOCUMENT_NAME:null},handleComposeMail:function(e,t){return!1}};for(var o in n)r[o]=t(n[o]);this.CollabHandler=r}(PubSub),function(){var e=function(){};if("undefined"!=typeof CollabHandler){var t=CollabHandler;Collaboration={handleUserList:t.handleUserList,handlePresence:t.handlePresence,join:t.handleJoin,handleMessage:t.handleBroadcastMessage,quit:t.handleQuit,serverup:t.handleServerUp,openURL:t.openURL,handleUserAdd:t.handleUserAdd,handleUserDeleted:t.handleUserDeleted,handleCrossProductMessage:t.handleCrossProductMessage,handleLogout:t.handleLogout,getPageTitle:t.getPageTitle,handleComposeMail:t.handleComposeMail,handleCustomMessage:t.handleCustomMessage,serverdown:t.handleServerDown,wmsOffline:e,handleLanguageChange:e,handleZohoMessage:e,onConnect:e,handleCollabAdd:e,handleCollabDelete:e,handleIsOnline:e,goOffline:e,handleWmsDisable:e,handleChatNotifyMessage:e,handleServiceMessage:e}}}(),ZWCollaboration.reqId=0,ZWCollaboration.docOpIds=[],ZWCollaboration.startingVersion=0,ZWCollaboration.startingVersionId=0,ZWCollaboration.contentEdited=!1,ZWCollaboration.stopUpdates=!1,ZWCollaboration.syncSent=!1,ZWCollaboration.serverupInvoked=!1,ZWCollaboration.SYNC_TIMER=5e3,ZWCollaboration.MUTATION_SEND_VERSION=1,ZWCollaboration.MUTATION_SEND_REVISION=0,ZWCollaboration.SERVER_SLOW_RESPONSE_TIMEOUT="undefined"!=typeof serviceName&&"WRITER_GDRIVE"===serviceName?75e3:6e4,ZWCollaboration.SYNCOP_VDIFF_INVALID="SVI_100",ZWCollaboration.SYNCOP_CLIENT_VERSION_GREATER="SCVG_100",ZWCollaboration.SYNCOP_DELTA_INVALIDCOUNT="SVC_200",ZWCollaboration.SYNCOP_DELTA_EMPTY="SVD_300",ZWCollaboration.SERVER_EXCEPTION="SXP_400",ZWCollaboration.SYNCOP_RESP_ERROR="SRE_500",ZWCollaboration.REDIS_EXCEPTION="RXP_400",ZWCollaboration.RESENDVERIFY_RELOAD_EXCEPTION="RELOAD_100",ZWCollaboration.OP_TC_ERROR="CTC_100",ZWCollaboration.ENDNOTE_TC_ERROR="CTC_101",ZWCollaboration.DELETE_TC_BLOCK_ERROR="CTC_102",ZWCollaboration.HIDDEN_RANGE_OPS_PROCESSING_ERROR="HRE_100",ZWCollaboration.HIDDEN_RANGE_OPS_CLIENT_ERROR="HRE_101",ZWCollaboration.TC_NOMARKUP_OPS_PROCESSING_ERROR="CTC_103",ZWCollaboration.TC_USER_COLORS_NOT_LOADED="CTC_104",ZWCollaboration.TC_NO_MARKUP_CLIENT_ERROR="CTC_105",ZWCollaboration.TC_REVIEW_IN_SELECTION_ERROR="CTC_106",ZWCollaboration.OP_LK_ERROR="CLK_100",ZWCollaboration.PROOFING_WORKER_ERROR="CPR_100",ZWCollaboration.PROOFING_DRAWLINE_ERROR="CPR_101",ZWCollaboration.PROOFING_PANE_RENDERING_ERROR="CPR_102",ZWCollaboration.PROOFING_ERROR="CPR_103",ZWCollaboration.PROOFING_CACHE_ERROR="CPR_104",ZWCollaboration.PROOFING_FP_SPELL_ERROR="PROOFING_FP_SPELL_ERROR",ZWCollaboration.PROOFING_FP_GRAMMAR="PROOFING_FP_GRAMMAR",ZWCollaboration.PROOFING_FP_STYLE="PROOFING_FP_STYLE",ZWCollaboration.FIND_ERROR="CFE_100",ZWCollaboration.FIND_RESULT_NAVIGATOR_ERROR="CFE_101",ZWCollaboration.FIND_RANGE_HIGHLIGHTER_ERROR="CFE_102",ZWCollaboration.COMMON_WORKER_ERROR="CWE_100",ZWCollaboration.COMMON_WORKER_THREAD_POOL_ERROR="CWTP_100",ZWCollaboration.COMMON_RANGE_HIGHLIGHTER_ERROR="CRH_100",ZWCollaboration.COMMON_BULLETIN_ERROR="CBU_100",ZWCollaboration.DT_DOM_RENDERING_ERROR="CDTDOM_100",ZWCollaboration.DT_DOM_RENDERING_INVISIBLE_ERROR="CDTDOM_101",ZWCollaboration.TRANSLITERATION_REPORT_ERROR="TRANSLITERATION_REPORT_ERROR",ZWCollaboration.COLLAB_OP_APPLYTO_ERROR="CCAT_100",ZWCollaboration.OP_APPLYTO_ERROR="CAT_100",ZWCollaboration.OP_APPLYTO_ERROR_DOM="CAT_101",ZWCollaboration.OP_APPLYTO_ERROR_DOC="CAT_102",ZWCollaboration.SP_LANG_NOT_SUPPORTED_ERROR="CSL_100",ZWCollaboration.SHOW_CARET_GETPORTION_ERROR="CSC_201",ZWCollaboration.SHOW_CARET_SELECTION_ERROR="CSC_204",ZWCollaboration.CURSOR_IDX_ERROR="CSC_207",ZWCollaboration.SET_CURSOR_ERROR="CSC_208",ZWCollaboration.SET_COLLAB_CURSOR_ERROR="CSC_209",ZWCollaboration.NO_LINE_CANNOT_SELECT="CSC_210",ZWCollaboration.SHOW_SELECTION_ERROR="CSS_700",ZWCollaboration.WEBFONTS_LOADING_FAILURE="CWF_100",ZWCollaboration.KEYBOARD_NAVIGATION_FAILURE="CNF_101",ZWCollaboration.API_NEGATIVE_IDX="CNI_300",ZWCollaboration.API_IOB_IDX="CIO_400",ZWCollaboration.OP_IDX_IOB="CIO_500",ZWCollaboration.OP_RESEND_ERROR="CRE_600",ZWCollaboration.OP_PROCESSING_ERR="COPE_800",ZWCollaboration.TABLE_API_IDX_ERR="CTAI_900",ZWCollaboration.ACKPENDING_ERROR="ACK_100",ZWCollaboration.CHECKSERVERVERSION_LOOP_ERROR="ACK_101",ZWCollaboration.CHECKFORRESEND_LOOP_ERROR="ACK_102",ZWCollaboration.RESENDMUTATION_LOOP_ERROR="ACK_103",ZWCollaboration.FINDNEXTINDEXOF_GREATER_ERROR="FNI_111",ZWCollaboration.FONT_METRICS_ERROR="FMT_100",ZWCollaboration.SERVER_ERROR_502_BAD_GATEWAY="SXP_700",ZWCollaboration.SXP_ERR_100="SXP_ERR_100",ZWCollaboration.HISTORY_COMPARE_ERROR="CHI_101",ZWCollaboration.HISTORY_QUICK_COMPARE_ERROR="CHI_102",ZWCollaboration.UNHANDLED_MUTATION_RESPONSE="CMR_100",ZWCollaboration.TABLE_INSERT_COLUMN="CTBL_101",ZWCollaboration.TABLE_INSERT_ROW="CTBL_102",ZWCollaboration.TABLE_DELETE_COLUMN="CTBL_103",ZWCollaboration.TABLE_DELETE_ROW="CTBL_104",ZWCollaboration.TABLE_DISTRIBUTE_COLUMNS="CTBL_105",ZWCollaboration.TABLE_FIXED_COLUMN_WIDTH="CTBL_106",ZWCollaboration.TABLE_FIT_TO_WINDOW="CTBL_107",ZWCollaboration.ROW_RESIZE_HEIGHT="CTBL_108",ZWCollaboration.ABNORMAL_TABLECOLS="CTBL_109",ZWCollaboration.TABLE_SELECTION_CONTEXT="CTBL_110",ZWCollaboration.FORMULA_FIELD="CFF_100",ZWCollaboration.FORMULA_FIELD_ABNORMAL_CONTENT="CFF_101",ZWCollaboration.CMF="CMF",ZWCollaboration.CORRUPTED_DESIGN_DATA_SAVE="DSG_100",ZWCollaboration.AUTO_DATE_FORMAT="ADF",ZWCollaboration.DATE_FIELD_ERROR="DFE_101",ZWCollaboration.TABLESTART_END_COUNT_MISMATCH="TCM",ZWCollaboration.COPY_DATA_MISSING="CPY_100",ZWCollaboration.PASTE_PARA_CHAR_STYLE_MISSING="PST_100",ZWCollaboration.PASTE_PROCESSING_ERROR="PST_102",ZWCollaboration.CORRUPTED_DESIGN_DATA_SAVE="DSG_100",ZWCollaboration.PARA_STYLE_WITHOUT_INFO="DSG_101",ZWCollaboration.STYLES_MISSING_CHAR="DSG_102",ZWCollaboration.USER_SETTINGS_STYLES_MISSING_CHAR="DSG_103",ZWCollaboration.UIFRAMEWORK_FUNCTION_NOT_CONFIGURED="UIF_100",ZWCollaboration.FILLABLE_FIELD_INSERT_ERROR="CFILL_101",ZWCollaboration.FILLABLE_FIELD_SYNC_ERROR="CFILL_102",ZWCollaboration.FILLABLE_FIELD_FILL_ERROR="CFILL_103",ZWCollaboration.SIGNER_FIELD_INSERT_ERROR="CSIGH_101",ZWCollaboration.SIGNER_FIELD_REMOVE_ERROR="CSIGH_102",ZWCollaboration.MY_SIGNATURE_FIELD_INSERT_ERROR="CSIGH_103",ZWCollaboration.SIGNER_FIELD_SYNC_ERROR="CSIGH_104",ZWCollaboration.PDF_CONTENT_LIMIT="PDF_104",ZWCollaboration.HEADLESS_DOCUMENT_RENDERING_ERROR="HDLS_107",ZWCollaboration.HEADLESS_MAILMERGE_PDF_ERROR="HDLS_108",ZWCollaboration.HEADLESS_MAILMERGE_HTML_ERROR="HDLS_109",ZWCollaboration.AUTOFIELD_ID_MISMATCH="CAF_101",ZWCollaboration.AGGREGATION_ERROR="AGG_101",ZWCollaboration.FONTS_TO_BE_LOADED="CWF_102",ZWCollaboration.clientInfo="",ZWCollaboration.operationSequence=[],ZWCollaboration.checkForResendCount=0,ZWCollaboration.checkServerVersionCount=0,ZWCollaboration.SERVERCHECK_MAXCOUNT=3,ZWCollaboration.mutationResendCount=0,ZWCollaboration.MUTATIONRESEND_MAXCOUNT=3,ZWCollaboration.RESULT_ACK_PENDING=1,ZWCollaboration.RESULT_NOTHING_TO_SEND=2,ZWCollaboration.RESULT_SEND_STOPPED=3,ZWCollaboration.RESULT_SUCCESS=4,Error.stackTraceLimit=30,ZWCollaboration.updateVersion=function(e,t,i,n){var r={VERSION:e,REVISION:t};n&&(i&&(r.DOCS_VERSION=i),r.VERSION_ID=n),DocInfo.setProperty(r),PubSub.publish("Document/VersionUpdated",e,t,i)};var ZWNetworkUtils=function(){var e=void 0,t=function(e,t,i){if(isV8Engine)return e;var n=t?t:csrfParamName,r=i?i:getcsrf();n&&(e[n]=r)},i=function(){ZWLogger.log("RETRY NETWORK CALLED");var t=function(){ZWOfflineLogger.log("network available"),clearTimeout(e),e=void 0,ZWOffline.isOfflineOperationsAllowed()?OfflineImpl.handleNetworkUp():PubSub.publish("System/NetworkUp")},r=function(){ZWOfflineLogger.log("no network"),clearTimeout(e),e=void 0,e=setTimeout(i,5e3)};n(t,r)},n=function(e,t){ZWLogger.log("CHECK NETWORK CALLED"),J.ajax({url:r(),success:function(){e()},error:function(){t()}})},r=function(){var e=Macros.getRequestUrl();return e+"/favicon.ico?nocache="+J.now()},o=function(){var e=window.location.protocol+"//"+window.location.host;return e},a=function(e){var t="";return t=ZWOffline.isOfflineSetupDone()&&editor.isOffline()||!e||e&&"$"==e.toString().charAt(0)?window.imgCdnZWStaticPath+fingerPrintObj["images/common/icon-user.png"]:contactServer+"/file?ID="+e+"&fs=thumb"},s=function(e){e=e||editor.getBaseURL(),e&&(window.location.href=e)},l=function(e){var t=new Deferred;e=e||{url:""},e.type=e.type?e.type.toUpperCase():"GET",e.headers=e.headers||{},e.timeout=parseInt(e.timeout)||0;var i=e.success,n=e.error;e.success=function(e,n,r){i&&i(e,n,r),t.resolve(e)},e.error=function(e,i,r){n&&n(e,i,r),t.reject(e,r)},e.async="undefined"==typeof e.async||e.async;var r=e.data,o="";for(var a in r)if(r.hasOwnProperty(a)&&void 0!==r[a]){""!==o&&(o+="&");var s="";s=a,s+="=";var l=r[a];if(Array.isArray(l)){for(var d="",c=0;c<l.length;c++)0==c&&(d+="["),d+='"',d+=l[c],d+='"',c==l.length-1&&(d+="]");s+=d}else s+=l;o+=s}"GET"!==e.type&&"DELETE"!==e.type||!o||(e.url+="?"+o);var u=new XMLHttpRequest;e.timeout>0&&(u.timeout=e.timeout,u.ontimeout=function(){e.error("timeout","timeout",u)}),u.open(e.type,e.url,e.async),u.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),u.setRequestHeader("X-Requested-With","XMLHttpRequest");for(var c in e.headers)e.headers.hasOwnProperty(c)&&u.setRequestHeader(c,e.headers[c]);return e.beforeSend&&e.beforeSend(u),u.send(o),u.onreadystatechange=function(){if(4==this.readyState&&(this.status>=200&&this.status<300||304==this.status)){var t=this.responseText,i=this.getResponseHeader("Content-Type");i&&i.match(/json/)&&(t=JSON.parse(this.responseText)),e.success(t,this.statusText,this)}else 4==this.readyState&&e.error(this.status,this.statusText,this)},0==e.async&&(4==u.readyState&&(u.status>=200&&u.status<300||304==u.status)?e.success(JSON.parse(u.responseText),u):4==u.readyState&&e.error(u.status,u.statusText,u)),t},d=function(e){e=e||{url:""},e.type=e.type.toUpperCase()||"GET",e.headers=e.headers||{},e.timeout=parseInt(e.timeout)||0,e.success=e.success||function(){},e.error=e.error||function(){},e.async="undefined"==typeof e.async||e.async;var t=e.data,i="";for(var n in t)if(t.hasOwnProperty(n)){""!==i&&(i+="&");var r="";r=n,r+="=";var o=t[n];if(Array.isArray(o)){for(var a="",s=0;s<o.length;s++)0==s&&(a+="["),a+='"',a+=o[s],a+='"',s==o.length-1&&(a+="]");r+=a}else r+=encodeURIComponent(o);i+=r}"GET"!==e.type&&"DELETE"!==e.type||!i||(e.url+="?"+i);var l=new XMLHttpRequest;e.timeout>0&&(l.timeout=e.timeout,l.ontimeout=function(){e.error("timeout","timeout",l)}),l.open(e.type,e.url,e.async),l.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),l.setRequestHeader("X-Requested-With","XMLHttpRequest");for(var s in e.headers)e.headers.hasOwnProperty(s)&&l.setRequestHeader(s,e.headers[s]);return l.send(i),l.onreadystatechange=function(){if(4==this.readyState&&(this.status>=200&&this.status<300||304==this.status)){var t=this.responseText,i=this.getResponseHeader("Content-Type");i&&i.match(/json/)&&(t=JSON.parse(this.responseText)),e.success(t,this.statusText,this)}else 4==this.readyState&&e.error(this.status,this.statusText,this)},0==e.async&&(4==l.readyState&&(l.status>=200&&l.status<300||304==l.status)?e.success(l.responseText,l):4==l.readyState&&e.error(l.status,l.statusText,l)),l};getUrl=function(e,t){return t=t||Utils.getDocumentId(),url=Macros.getType()+"/docoperation/"+t+"/"+e,url=c(url),url},getActivitiesUrl=function(e,t){return t=t||Utils.getDocumentId(),url=Macros.getType()+"/docoperation/activities/"+t+"/"+e,url=c(url),url};var c=function(e){return"/"+Macros.getContextName()+"/"+e},u=function(e){return ZWNetworkUtils.getContextUrl("v1/web/"+e)},g=function(e){return ZWNetworkUtils.getContextUrl("api/v1/"+e)},h=function(){return Macros.getNiceUrl()},f=function(e,t,i){var n=t||csrfParamName;n&&e.setRequestHeader("X-ZCSRF-TOKEN",n+"="+(i||getcsrf()))},p=function(e,t,i){var n=t||csrfParamName,r=i||getcsrf();n&&(e["X-ZCSRF-TOKEN"]=n+"="+r)},E=function(e){return e=e||{},Macros.isRemote()&&Macros.getRIdInParams(e),e},T=function(e,t){if(null==e||null==t)return e;var i=e.indexOf("?")==-1?"?":"&";for(var n in t)i=i+n+"="+t[n]+"&";return e+=i.substring(0,i.length-1),encodeURI(e)},O=function(e){var t,i=new Deferred;return t={type:e.type||"GET",dataType:e.dataType||"",global:e.global||!1,timeout:e.timeout||"",url:e.url,error:function(t){e.error&&e.error.apply(null,arguments),i.reject(t)},success:function(t){e.success&&e.success.apply(null,arguments),i.resolve(t)},beforeSend:function(t){e.setCsrfParam&&ZWNetworkUtils.setCsrfTokenInHeader(t)},data:e.data},isV8Engine&&(t.isBulkOp=e.isBulkOp),e.isMultiPartReq&&(t.enctype=e.enctype||"multipart/form-data;",t.contentType=e.contentType||!1,t.processData=e.processData||!1),isV8Engine?(fetch(t),i):J.ajax(t)};return{setCsrfParam:t,retryNetwork:i,checkNetwork:n,getUserImageURL:a,getHostURL:o,resetURL:s,sendAjax:O,ajax:l,ajax_beta:d,getUrl:getUrl,getActivitiesUrl:getActivitiesUrl,getApiUrlPrefix:g,getContextUrl:c,getNiceUrlPrefix:u,getUtilUrl:h,setCsrfTokenInHeader:f,setCsrfParamInHeader:p,setDefaultParams:E,getUrlWithQueryParams:T}}(),DocLocaleHandler=function(e){"use strict";var t,i,n,r=[],o={},a=function(){var a=editor.doc.getBodyFormat();t=a[ATTR_BODY.DS_LANGUAGE]||"en-US",i=editorProps.userInfo.timezone||"America/Los_Angeles",n=a[ATTR_BODY.DS_DATEFORMAT]||"MM/DD/YYYY",ZWJSONUtils.isEmptyObject(o)&&(o[t]=a[ATTR_BODY.DS_LANGUAGE_DETAILS],r.push(a[ATTR_BODY.DS_LANGUAGE_DETAILS])),e.publish("Document/DefaultLanguageInitialized")},s=function(){try{l(function(e){p(e)})}catch(t){var e="EXCEPTION IN LOADING SUPPORTED LANGUAGES JSON"+(t.stack||t);ZWLogger.log(e)}},l=function(e){var t=1,i=function(e,t){var i={};ZWNetworkUtils.ajax({type:"GET",url:cdnZWStaticPath+fingerPrintObj["supportedlanguages.json"],data:i,dataType:"json",error:t,success:e})},n=function(t){e(t)},r=function(e){t++,t<=3&&i(n,r)};i(n,r)},d=function(e){var t=editor.doc.getSelection().getParents(NODE_TYPE.BODY);t||(editor.doc.getSelection().select(),t=editor.doc.getSelection().getParents(NODE_TYPE.BODY));var i={};for(var n in e)!e.hasOwnProperty(n)||n!==ATTR_BODY.DS_LANGUAGE&&n!==ATTR_BODY.DS_DATEFORMAT||(i[n]=e[n]);ZWJSONUtils.isEmptyObject(i)||editor.doc.execCmd("applyStyle",[t,e,"updateDocumentPropety"]);},c=function(e){var t=ZWDate.getLocaleSupportedFormats(e)||[],i={};i[ATTR_BODY.DS_LANGUAGE]=e,i[ATTR_BODY.DS_DATEFORMAT]=t[0]||"MM/DD/YYYY",d(i)},u=function(i){t=i,e.publish("Document/LanguageChanged",t)},g=function(t){n=t,e.publish("Document/DateFormatChanged",n)},h=function(){return n},f=function(){return i},p=function(t){o=t,r=E(t),e.publish("Document/LanguageInitialized")},E=function(e){var t,i,n={},r=[];for(var a in e)e.hasOwnProperty(a)&&(t=e[a],n[t.name]?n[t.name]=n[t.name]+","+a:n[t.name]=a);var s=Object.keys(n);return s=s.sort(),s.forEach(function(e){i=n[e].split(","),i.forEach(function(e){r.push(o[e])})}),r},T=function(){return r},O=function(e){return o.hasOwnProperty(e)},m=function(){return t},I=function(){return w_usersettings[ATTR_BODY.DS_LANGUAGE]||w_usersettings[ATTR_BODY.DS_SPLANG]},D=function(e){return o[e]},R=function(e){var t=D(e);return t&&t.name},S=function(e){var t=D(e);return t&&t.nativeLangName},C=function(e){var t=D(e);return t&&t.countryName},A=function(e){var t=D(e);return t&&t.countryNameInNativeLang},v=function(e){var t=D(e);return t&&t.currencyCode},_=function(){var e,t=[],i=m(),n=ZWDate.getLocaleSupportedFormats(i);for(var r in n)n.hasOwnProperty(r)&&(e=n[r],t.push({format:e,preview:ZWDate.getLocaleValue(i,e)}));return t};return e.subscribe("Document/language/changed",u),e.subscribe("Document/dateFmt/changed",g),e.subscribe("Document/ComponentInitialized",s),{init:a,getLanguage:m,getSupportedLanguages:T,isSupportedLanguage:O,getDateFormat:h,getTimezone:f,getLanguageDetails:D,getLanguageName:R,getNativeLanguageName:S,getCountryName:C,getCountryNameInNativeLang:A,getCurrencyCode:v,setDocumentProperty:d,changeLocale:c,getUserSettingsLanguage:I,getDateFormatsWithPreview:_}}(PubSub),Proofing=function(e){var t=!1,i=!1,n=!1,r=!1,o="en-US",a="es",s="fr",l=null,d={"en-US":"English(US)","en-GB":"English(UK)","en-AU":"English (AU)","en-CA":"English (CA)","en-NZ":"English (NZ)",en_ZA:"English (ZA)","en-ZA":"English (ZA)","en-IN":"English (IN)"},c={es:"Spanish (ES)","es-CL":"Spanish (CL)","es-CO":"Spanish (CO)","es-EC":"Spanish (EC)","es-MX":"Spanish (MX)","es-NI":"Spanish (NI)","es-PE":"Spanish (PE)","es-PR":"Spanish (PR)","es-UY":"Spanish (UY)","es-ES":"Spanish (ES)",es_CL:"Spanish (CL)",es_CO:"Spanish (CO)",es_EC:"Spanish (EC)",es_NI:"Spanish (NI)",es_PE:"Spanish (PE)",es_PR:"Spanish (PR)",es_UY:"Spanish (UY)","es-AR":"Spanish (AR)","es-BO":"Spanish (BO)","es-CR":"Spanish (CR)","es-CU":"Spanish (CU)","es-DO":"Spanish (DO)","es-GT":"Spanish (GT)","es-HN":"Spanish (HN)","es-PA":"Spanish (PA)","es-PH":"Spanish (PH)","es-PY":"Spanish (PY)","es-SV":"Spanish (SV)","es-US":"Spanish (US)","es-VE":"Spanish (VE)"},u={fr:"French (FR)","fr-CA":"French (CA)","fr-CH":"French (CH)"},g={SPELLCHECK:"sp",GRAMMAR:"grammar",WRITING_QUALITY:"wq"},h={IGNOREUPPERCASE:"ignoreuppercase",IGNOREMIXEDCASE:"ignoremixedcase",IGNORENUMBERED:"ignorenumbered"},f={WORDYPHRASES:"wordyphrases",REPHRASABLESENTENCES:"rephrasablesentences",IMPROPERWORDCHOICES:"improperwordchoices",INFORMALWRITING:"informalwriting",NONINCLUSIVELANG:"noninclusivelanguage"},p=function(){if(E(e.getLanguage()),T()?r=!0:(ZWLogger.log("LANGUAGE IS NOT SUPPORTED... Lang : "+e.getLanguage()),r=!1),editor.getRole().permissions.can("document.edit")&&!editor.isOffline()&&r?(Macros.proofing.initUserData(),t=O(g.SPELLCHECK),i=O(g.GRAMMAR),n=m()):(t=!1,i=!1,n=!1),PubSub.publish("Document/Proofing/Initialized"),!isV8Engine){for(var o,a="from",s=[],l=location.search.substr(1).split("&"),d=0;d<l.length;d++)s=l[d].split("="),s[0]===a&&(o=decodeURIComponent(s[1]));if("free_grammar_checker"===o){var c=function(){document.getElementById("topband-zia").click(),PubSub.unsubscribe("Module/Proofing/Loaded",c)};PubSub.subscribe("Module/Proofing/Loaded",c)}}},E=function(e){l=k(e)?e:null,PubSub.publish("Document/Proofing/LanguageChanged",l)},T=function(){return l},O=function(e){var t=editor.doc.getUserData()[editor.zuid];return t&&t.proofing&&t.proofing[e]||!1},m=function(){return Proofing.isWordyPhrasesEnabled()||Proofing.isRephrasableSentencesEnabled()||Proofing.isImproperWordChoicesEnabled()||Proofing.isInformalWritingEnabled()||Proofing.isNonInclusiveLanguageEnabled()},I=function(e){var t=D();return t[e]||!1},D=function(){var e=editor.doc.getUserData()[editor.zuid];return e&&e.proofing&&e.proofing.configurations||{}},R=function(e){var t=D(),i=editor.doc.getUserData(),r=i[editor.zuid].proofing||{};for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);r.configurations=t,i[editor.zuid].proofing=r,editor.doc.setUserData(i),n=m(),e.hasOwnProperty(h.IGNOREUPPERCASE)||e.hasOwnProperty(h.IGNOREMIXEDCASE)||e.hasOwnProperty(h.IGNORENUMBERED)?PubSub.publish("Document/ProofingConfigurations/Updated"):(e.hasOwnProperty(f.WORDYPHRASES)||e.hasOwnProperty(f.REPHRASABLESENTENCES)||e.hasOwnProperty(f.IMPROPERWORDCHOICES)||e.hasOwnProperty(f.INFORMALWRITING)||e.hasOwnProperty(f.NONINCLUSIVELANG))&&PubSub.publish("Document/WritingQualityConfigurations/Updated",e)},S=function(){var t=e.getLanguage()||"",i=e.getLanguageName(t)+" ("+e.getCountryName(t)+")";MsgDialog.showMessage([J.i18n("writer.common.OK")],"warning",J.i18n("proofing","NOT_SUPPORTED_LANG_TITLE"),J.i18n("proofing","NOT_SUPPORTED_LANG_MSG",[i]),null,null,function(){Z("bbar-sp-toggle-switch").ztoggleswitch("switchOff")})},C=function(e,i){if(i&&!i.fromui)return!1;if(t=!t,!T()&&t)return t=!1,void S();if(O(g.SPELLCHECK)!=t){var n={};n[g.SPELLCHECK]=t,_(n,{})}else PubSub.publish("Document/SpellCheck/Toggled",t)},A=function(e,n){if(n&&!n.fromui||!t)return!1;if(i=!i,O(g.GRAMMAR)!=i){var r={};r[g.GRAMMAR]=i,_(r,{})}else PubSub.publish("Document/Grammar/Toggled",i)},v=function(e,n){if(n&&!n.fromui||!t||!i)return!1;var r=n.state,o={};o[f.WORDYPHRASES]=r,o[f.REPHRASABLESENTENCES]=r,o[f.IMPROPERWORDCHOICES]=r,o[f.INFORMALWRITING]=r,o[f.NONINCLUSIVELANG]=r,_({},o)},_=function(e,t){var i={success:function(){var i=editor.doc.getUserData();i[editor.zuid].proofing||(i[editor.zuid].proofing={});var n;for(var r in e)e.hasOwnProperty(r)&&(n=e[r],i[editor.zuid].proofing[r]=e[r],r===g.SPELLCHECK?PubSub.publish("Document/SpellCheck/Toggled",n):r===g.GRAMMAR&&PubSub.publish("Document/Grammar/Toggled",n));t&&!ZWJSONUtils.isEmptyObject(t)&&R(t),editor.doc.setUserData(i)},failure:function(){}};Macros.proofing.setProofingData(e,t,i)},P=function(){return t},N=function(){return i},b=function(){return n},L=function(){return I(h.IGNOREUPPERCASE)},w=function(){return I(h.IGNOREMIXEDCASE)},y=function(){return I(h.IGNORENUMBERED)},M=function(){var e=D();return e.hasOwnProperty(f.WORDYPHRASES)?e[f.WORDYPHRASES]:O(g.WRITING_QUALITY)},F=function(){var e=D();return e.hasOwnProperty(f.REPHRASABLESENTENCES)?e[f.REPHRASABLESENTENCES]:O(g.WRITING_QUALITY)},U=function(){var e=D();return e.hasOwnProperty(f.IMPROPERWORDCHOICES)?e[f.IMPROPERWORDCHOICES]:O(g.WRITING_QUALITY)},V=function(){var e=D();return e.hasOwnProperty(f.INFORMALWRITING)?e[f.INFORMALWRITING]:O(g.WRITING_QUALITY)},B=function(){var e=D();return e.hasOwnProperty(f.NONINCLUSIVELANG)?e[f.NONINCLUSIVELANG]:O(g.WRITING_QUALITY)},x=function(e,t){var i=J(e).prop("checked");W(t,i);var n;switch(t){case"wordyphrases":n="wordyPhrases";break;case"rephrasablesentences":n="rephrasableSentences";break;case"improperwordchoices":n="betterWordChoices";break;case"informalwriting":n="informalWriting"}},W=function(){var e,t,i=!1,n=function(){var t=D(),i=!1;for(var n in e)if(e.hasOwnProperty(n)&&(!t.hasOwnProperty(n)||t[n]!=e[n])){i=!0;break}return i},r=function(){var o={success:function(o,a){R(a),i=!1,e&&!ZWJSONUtils.isEmptyObject(e)&&n()?r():(e=void 0,t=void 0)},failure:function(){i=!1}};!i&&e&&!ZWJSONUtils.isEmptyObject(e)&&n()&&(i=!0,Macros.proofing.setProofingData({},ZWJSONUtils.clone(e),o),e=void 0)};return function(i,n){e||(e={}),t&&(clearTimeout(t),t=void 0),e[i]=n,t=setTimeout(function(){r()},1e3)}}(),H=function(e){var t,i=D(),n={};for(key in e)e.hasOwnProperty(key)&&(t=e[key],key===ATTR_BODY.SP_IGNOREUPPERCASE&&t!=i[h.IGNOREUPPERCAS]?n[h.IGNOREUPPERCASE]=t:key===ATTR_BODY.SP_IGNOREMIXEDCASE&&t!=i[h.IGNOREMIXEDCASE]?n[h.IGNOREMIXEDCASE]=t:key===ATTR_BODY.SP_IGNORENUMBERED&&t!=i[h.IGNORENUMBERED]?n[h.IGNORENUMBERED]=t:key===ATTR_BODY.WQ_WORDYPHRASES&&t!=i[f.WQ_WORDYPHRASES]?n[f.WORDYPHRASES]=t:key===ATTR_BODY.WQ_REPHRASABLESENTENCES&&t!=i[f.WQ_REPHRASABLESENTENCES]?n[f.REPHRASABLESENTENCES]=t:key===ATTR_BODY.WQ_IMPROPERWORDCHOICES&&t!=i[f.WQ_IMPROPERWORDCHOICES]?n[f.IMPROPERWORDCHOICES]=t:key===ATTR_BODY.WQ_INFORMALWRITING&&t!=i[f.WQ_INFORMALWRITING]?n[f.INFORMALWRITING]=t:key===ATTR_BODY.WQ_NONINCLUSIVELANGUAGE&&t!=i[f.NONINCLUSIVELANG]&&(n[f.NONINCLUSIVELANG]=t));return n},G=function(e,n,o){if(r){var a,s={};for(var l in e)e.hasOwnProperty(l)&&(a=e[l],l===g.SPELLCHECK&&a!=t?(t=a,s[l]=a):l===g.GRAMMAR&&a!=i&&(i=a,s[l]=a));var d=H(n),c=H(o);for(var l in c)d[l]=c[l];ZWJSONUtils.isEmptyObject(s)&&ZWJSONUtils.isEmptyObject(d)||_(s,d)}},k=function(t){var i=e.getLanguageDetails(t);return i&&i.isProofingSupported},Y=function(e){E(e),T()?(r=!0,O(g.SPELLCHECK)&&!t&&(t=!0,PubSub.publish("Document/SpellCheck/Toggled",t))):(r=!1,t&&(t=!1,PubSub.publish("Document/SpellCheck/Toggled",t)))},z=!1,j=function(e){z=e},X=function(){return z},K=function(e){return q(e)||Q(e)||$(e)&&z},Q=function(e){return c.hasOwnProperty(e)},q=function(e){return d.hasOwnProperty(e)},$=function(e){return u.hasOwnProperty(e)},ee=function(){return o},te=function(){return a},ie=function(){return s};return PubSub.subscribe("Document/LanguageChanged",Y),PubSub.subscribe("Settings/Proofing/SettingsUpdated",G),PubSub.subscribe(["Document/ComponentInitialized","Document/EditorReady"],p),{init:p,toggleSp:C,toggleGrammar:A,toggleWq:v,isSpellCheckEnabled:P,isGrammarEnabled:N,isWritingQualityEnabled:b,isUppercaseIgnored:L,isNumberIgnored:y,isMixedcaseIgnored:w,isWordyPhrasesEnabled:M,isRephrasableSentencesEnabled:F,isImproperWordChoicesEnabled:U,isInformalWritingEnabled:V,isNonInclusiveLanguageEnabled:B,setProofingConfigValue:x,isSupportedLanguage:k,getDefaultLang:ee,getSpanishLang:te,getFrenchLang:ie,getLanguage:T,isEnglishLanguage:q,isSpanishLanguage:Q,isFrenchLanguage:$,isGrammarSupportedLanguage:K,isAnyWqConfEnabled:m,setIsFrenchUser:j,getIsFrenchUser:X}}(DocLocaleHandler),ReviewUtil=function(){var e=!1,t=!0,i=function(){return t},n=function(e){t=e},r=function(t){e=t,PubSub.publish("User/OrgIdentified")},o=function(){return e},a={angularLine:function(e,t,i){var n=DomUtil.createElement("div",{id:"annon_angular_"+i,class:"comnt-rev-connector-angular"}),r=e.top-t.top,o={},a=e.left-t.left,s=Math.atan(r/a),l=Math.sqrt(a*a+r*r);o.left=t.left;var d={};d["-moz-transform"]="rotate("+s+"rad)",d["-webkit-transform"]="rotate("+s+"rad)",d["-o-transform"]="rotate("+s+"rad)",d.transform="rotate("+s+"rad)",d.left=o.left,d.top=e.top-r,d.width=l;var c=J(n).css(d);return c.appendTo(J("#ui-editor-outer-div")),c},horizontalLine:function(e,t,i){var n=DomUtil.createElement("div",{id:"annon_horizontal_"+i,class:"comnt-rev-connector-horizontal"});horizontalDivStyles={width:t.left-e.left,left:e.left,top:e.top};var r=J(n).css(horizontalDivStyles);return r.appendTo(J("#ui-editor-outer-div")),r},boxConnectorLine:function(e,t){var i=DomUtil.createElement("div",{class:"comnt-rev-connector-horizontal"});horizontalDivStyles={width:e.left-t.left,right:Jdocument.width()-e.left,top:t.top};var n=J(i).css(horizontalDivStyles);return n.appendTo(J("#ui-editor-outer-div")),n},pointer:function(e,t){var i=DomUtil.createElement("div",{id:"annon_"+t,class:"comnt-rev-connector"}),n={};e.left;n.left=e.left-3,n.top=e.top-3;var r=J(i).css(n);return r.appendTo(J("#ui-editor-outer-div")),r}},s=function(){var e=function(){this.horizontalLine=null,this.angularLine=null,this.boxConnectorLine=null,this.pointer=null;var e=function(){this.angularLine&&this.angularLine.remove(),this.horizontalLine&&this.horizontalLine.remove(),this.boxConnectorLine&&this.boxConnectorLine.remove(),this.pointer&&this.pointer.remove(),this.horizontalLine=null,this.angularLine=null,this.boxConnectorLine=null,this.pointer=null},t=function(e,t,i){var n=10,r=20;this.remove();var o=Z(ELEM_ID.TOPBANDWRAPPER).offset().top+Z(ELEM_ID.TOPBANDWRAPPER).height();t.top=t.top<o?o:t.top;var a={top:e.top,left:e.left-n},s=J(".zw-page:first"),l=s.offset();l.right=l.left+s.width()*editor.zoomFactor;var d={},c=Z(ELEM_ID.EDITOROUTERDIV).offset();c.right=Z(ELEM_ID.EDITOROUTERDIV).width()+c.left,d.left=l.right<c.right?l.right:c.right,d.left=d.left-r,d.top=t.top,this.angularLine=ReviewUtil.draw.angularLine(a,d,i),this.horizontalLine=ReviewUtil.draw.horizontalLine(t,d,i),this.boxConnectorLine=ReviewUtil.draw.boxConnectorLine(e,a,i),this.pointer=ReviewUtil.draw.pointer(t,i)};return{drawLine:t,remove:e}};return{comment:new e,revision:new e,proofing:new e}}(),l=function(e){return e=new ZWDateTime(e,null,editorProps.userInfo.language),e.format("EEEE DD MMM YYYY hh mm")},d=function(e,t,i,n){var r=editor.doc.getSelection().createCursorOp(e.start,e.end);r=DocOpBuilder.build(r);var o={};o[n]=i,docOps=DocOpBuilder.build([{r:t},o]);var a=DocOpBuilder.xform(docOps,r),s=a.second.getCursorPos()[0];return s.start=s.start>=0?s.start:s.end,s.end=s.end>=0?s.end:s.start,s},c=function(e,t){return ReviewUtil.getUserProp(e,"color",t)},u=function(e,t){return ReviewUtil.getUserProp(e,"fname",t)},g=function(e,t){return ReviewUtil.getUserProp(e,"nickname_HTML",t)||ReviewUtil.getUserName(e,t)},h=function(e){return"$"==e.toString().charAt(0)?e.slice(1,e.length):e},f=function(e,t,i){if(!editor.isOffline()&&e){if(!ZWJSONUtils.isEmptyObject(editor.doc.userData)&&editor.doc.getUserData()[e])return editor.doc.getUserData()[e][t];ZWLogger.log("ADD ALL PARTICIPANTS CALLED FOR ZUID: "+e+" , KEY: "+t+" , VERSION: "+i);var n={},r={};ZWNetworkUtils.setCsrfParamInHeader(r);var o=ZWNetworkUtils.getNiceUrlPrefix(Macros.getType()+"/"+Macros.getRId()+"/util/addallparticipants");return i?n.versionid=i:editor.getView()===EDITOR_VIEWS.HISTORY&&"undefined"!=typeof HistoryUI&&(n.versionid=HistoryUI.getSelectedVersionId()),ZWNetworkUtils.ajax({type:"POST",global:!1,url:o,async:!1,data:n,headers:r,dataType:"json",error:function(e,t,i){PubSub.publish("trackchange/errormsg")},success:function(e){var t=editor.doc.getUserData(),i=e.userInfos||{};for(var n in i)i.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=i[n])}}),editor.doc.getUserData()[e]&&editor.doc.getUserData()[e][t]}},p=function(e){return ReviewUtil.getUserProp(e,"light_color")},E=function(){editor.doc.getTrackChangeDetails().makeUserParticipated(),Macros.review.addParticipant()},T=function(e){for(var t=0,i=e.length;t<i;t++)m(e[t])},O=function(){Z("userlist-panel").find("div").remove()},m=function(e){var t=c(e),i=u(e),n=ZWNetworkUtils.getUserImageURL(e);if(e=h(e),!Z("userlist-panel").find("#user_"+e).length){var r=DomUtil.createElement(NODE_NAME.DIV,{id:"user_"+e,class:"ui-tc-onindicater-imgdiv ui-ms-pointer"}),o=DomUtil.createElement(NODE_NAME.SPAN,{style:"border-left: 3px solid "+t+";height: 24px; display: inline-block; box-shadow: 0px 2px 1px 0px #CCC;"}),a=DomUtil.createElement("img");J(a).attr({src:n,title:i}),o.appendChild(a),r.appendChild(o),J(r).on("click",function(t){UIUtils.showProfileInfo(t.target,e)}),Z("userlist-panel").append(r)}},I=function(e){Z("userlist-panel").find("#user_"+h(e)).remove()},D=function(){Z("userlist-panel-container").show()},R=function(){Z("userlist-panel-container").hide()},S=function(){var e=editor.jeditorPane.offset(),t=Z("userlist-panel").width(),i=e.left;"undefined"!=typeof LeftPanel&&LeftPanel.getPanelWidth()>e.left?i=e.left:e.left>t&&(i-=t),Z("userlist-panel-container").css("left",i)},C=function(e,t){for(var i,n="",r=[],o=!1,a=0,s=0,l=function(e){for(a=0,s=e.length;a<s;a++)if(e[a][TCConstants.ACTION]===TCConstants.DELETE)return!0;return!1},d=0,c=e.length;d<c;d++)i=t[d],i&&(o=!(!i[TCConstants.TC]||!l(i[TCConstants.TC]))),o||(n+=e.charAt(d),r.push(i));return{contStr:n,styles:r}},A=function(e){return e.hasOwnProperty(TCConstants.TC)},v=function(e){var t=Z("reviewpane-freeze-overlay");e?t.show():t.hide()},_=function(e,t,i){var n=editor.doc.getContent(e,t),r=editor.doc.createElement(NODE_TYPE.TEXT,n);r.setStart(e),r.setEnd(t);var o=editor.doc.createElement(NODE_TYPE.TEXT,i);o.setStart(e),editor.doc.execCmd("replace",[r,o,!0])},P=function(e,t,i){},N=function(e){for(;e>0&&!editor.doc.getRawFormatAt(e);)e--;return e>0?editor.doc.getRawFormatAt(e):null},b=function(){tooltipConf={"review-tb-showhistory":{title:"writer.common.VIEW_HISTORY",content:"writer.common.VIEWHISTORY_TOOLTIP"},"review-tb-pausecollab":{title:"writer.common.PAUSE_COLLABORATION",content:"writer.common.PAUSE_COLLABORATION_TOOLTIP"},"review-tb-emailcollab":{title:"writer.common.COLLABORATORS_LIST",content:"writer.common.NOTIFY_COLLABORATORS_TOOLTIP"},"review-tb-follow":{title:"writer.common.EMAIL_NOTIFICATION_SETTINGS",content:UIUtils.getUIText("FOLLOW_TOOLTIP")},"review-tb-redact":{title:"writer.common.REDACT_CONTENT",content:"writer.common.REDACT_CONTENT_TOOLTIP"},"review-tb-unredact":{title:"writer.common.UNMASK_REDACT_CONTENT",content:"writer.common.UNMASK_REDACT_CONTENT_TOOLTIP"},"review-tb-tcswitch-outer":{title:"writer.common.TRACK_CHANGES",content:"writer.common.TRACKCHANGE_TOOLTIP_CONTENT"},"bbar-tcswitch-outer":{title:"writer.common.TRACK_CHANGES",content:"writer.common.TRACKCHANGE_TOOLTIP_CONTENT"},"review-tb-tcallmarkup":{title:"writer.common.VIEW_TOOLTIP_TITLE",content:"writer.common.VIEW_TOOLTIP_CONTENT"},"view-lpnl-tcallmarkup":{title:"writer.common.VIEW_TOOLTIP_TITLE",content:"writer.common.VIEW_TOOLTIP_CONTENT"},"review-tb-showcomment":{title:UIUtils.getUIText("INSERT_COMMENT"),content:UIUtils.getUIText("COMMENT_TOOLTIP")},"review-tb-comparedocs":{title:"writer.common.COMBINE_DOCUMENTS",content:"writer.common.COMBINE_TITLE_PRE"},"tools-lpnl-comparedocs":{title:"writer.common.COMBINE_DOCUMENTS",content:"writer.common.COMBINE_TITLE_PRE"}},UIUtils.addHTMLTooltips(tooltipConf)},L=function(){"undefined"!=typeof ActivityTracker&&ActivityTracker.initialize(editorProps.urls.base_url,ZWNetworkUtils.ajax,ZWNetworkUtils.setCsrfParamInHeader,ZWNetworkUtils.setCsrfParam)};L();var w=function(){var e=editor.doc.getTrackChangeDetails().getDisplayMode(),t="";return e===TCConstants.ALL_MARKUP_VIEW?t="as_markups":e===TCConstants.ORIGINAL_VIEW?t="none":e===TCConstants.NO_MARKUP_VIEW&&(t="all"),t},y=function(){var e={};return e.include_changes=w(),e.include_comments="none",e},M=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},F=function(e,t){ZWLogger.log(t),ZWLogger.sendErrorDetails(e+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+e+" DOC len ="+editor.doc.getDocumentLength()+" buildLabel::: "+buildLabel+"\n Error Log End \n<ZWERROR>Exception : \n"+t,null,e)},U=function(e,t,i,n,r){return},V=function(){var e=editor.getRole().permissions,t=!e.can("document.edit")&&e.can("review.comment.view");return t},B=function(){return"writer"},x=function(){return["BP-CP-ZAID",editor.options.zaid]},W={},H=function(){W={tc:{popup:Z("tc-popup"),popupContainer:Z("tcpopup-cont"),popupPeak:Z("tc-popup-peak-div")},comment:{popup:Z("comment-popup"),popupContainer:Z("commentpopup-cont"),popupPeak:Z("comment-popup-peak-div")}}};PubSub.subscribe(["Module/TC/Loaded","Document/Comment/Loaded"],H);var G=function(e){var t=W[e].popup,i=W[e].popupContainer,n=W[e].popupPeak,r=editor.editorPaneContainerOffset,o=editor.doc.getSelection().getStart(),a=0,s=0,l=0,d=265,c=85,u=10;try{var g=DocLayoutManager.getLineAtIndex(o),h=DomViewManager.getDOMElem(g);if(g&&h&&(rect=h.getClientRects(),rect.length)){a=rect[0].left-editor.editorOffset.left+(DocLayoutManager.getLeftAtIndex(o)||0),s=rect[0].top-editor.editorOffset.top,l=rect[0].height,n.removeClass("ui-tour-tb-right");var f=editor.editorOffset.left-LeftPanel.getPanelWidth();a+f-d>=0?(a-=d,n.addClass("ui-tour-tb-right")):a-=c}}catch(e){}t.show();var p=t[0].clientHeight,E=(t[0].clientTop,a),T=0;editor.editorOffset.top+s-p<r.top?(T=s+l+u,t.removeClass("ui-tour-bottom"),t.addClass("ui-tour-top")):(T=s-(p+u),t.removeClass("ui-tour-top"),t.addClass("ui-tour-bottom")),i.css({left:E,top:T})};return{setZohocorpUser:r,isZohoCorpUser:o,draw:a,focusLine:s,getdateTime:l,hasTcStyle:A,updateIndex:d,getUserColour:c,getUserName:u,getDisplayName:g,getUserProp:f,getUserLightColour:p,removeSplCharsInZuid:h,addParticipant:E,addUsersInUserListPanel:T,removeUsersInUserListPanel:O,addUserInUserListPanel:m,removeUserInUserListPanel:I,showUserListPanel:D,hideUserListPanel:R,positionUserListPanel:S,omitTcDeletions:C,setFreeze:v,getNearestFormat:N,initTooltips:b,replaceText:_,getCurrentReviewOptions:y,escapeHTML:M,track:P,sendErrorMail:F,trackProofingActivity:U,isReadCommentMode:V,getProductName:B,getVerticalAuthHeader:x,positionPopUp:G,canSkipSnapshotInNomarkup:i,setSkipSnapshotInNomarkup:n}}(),TcViewUtil=function(e,t,i){var n=function(){return!isV8Engine&&(editor.isOfflineMode||editor.getView()===EDITOR_VIEWS.HISTORY&&HistoryUI.isDiffView())},r=function(t){if(n())return t;t=DocUtil.copyStyle(t);var i=t[e.TC];i.length>1&&TcUtil.sortTCVals(i);for(var r=0,s=i.length;r<s;r++){var l=i[r],d=o(t,l[e.ZUID],l[e.ACTION]);a(t,d)}return t},o=function(t,i,n){return n===e.INSERT?s(t,i):n===e.DELETE?l(t,i):void 0},a=function(e,t){for(var i in t)if(e[i])if(i===ATTR_COMMON.CLS)e[i]=e[i]+" "+t[i];else if(i===ATTR_TEXT.TS_TD){var n=e[i];ZWArrayUtils.arrayContains(n,"none")?e[i]=t[i]:ZWArrayUtils.arrayContains(n,t[i])||(e[i]=e[i]+" "+t[i])}else e[i]=t[i];else e[i]=t[i]},s=function(i,n){var r={},o=i.type,a=editor.doc.getTrackChangeDetails().getDisplayMode();if(isV8Engine||a===e.ALL_MARKUP_VIEW){if(o===NODE_TYPE.TEXT){var s=t.getUserColour(n);r[ATTR_TEXT.TS_FGC]=s,r[ATTR_COMMON.BORDERS]={},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={type:"solid",width:"2px",color:s}}else if(o===NODE_TYPE.IMAGE){var s=t.getUserColour(n);r[ATTR_TEXT.TS_FGC]=s,r[ATTR_COMMON.BORDERS]={},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]={type:"solid",width:"2px",color:s},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]={type:"solid",width:"2px",color:s},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]={type:"solid",width:"2px",color:s},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={type:"solid",width:"2px",color:s}}else if(o===NODE_TYPE.ROW){var s=t.getUserLightColour(n);r[ATTR_ROW.TRS_BGC]=s}r.hasOwnProperty(ATTR_COMMON.CLS)?r[ATTR_COMMON.CLS]+=" tc-insertion tc-revision":r[ATTR_COMMON.CLS]="tc-insertion tc-revision"}else a===e.NO_MARKUP_VIEW?r={}:a===e.ORIGINAL_VIEW&&(r={cls:"tc-txt-hide"});return r},l=function(i,n){var r={},o=i.type,a=editor.doc.getTrackChangeDetails().getDisplayMode();if(isV8Engine||a===e.ALL_MARKUP_VIEW){if(o===NODE_TYPE.TEXT){var s=t.getUserColour(n);r[ATTR_TEXT.TS_FGC]=s,r[ATTR_TEXT.TS_TD]="line-through",i[ATTR_SECTION.ST]===NODE_TYPE.TAB&&(r[ATTR_COMMON.BORDERS]={},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={type:"solid",width:"2px",color:s})}else if(o===NODE_TYPE.IMAGE){var s=t.getUserColour(n);r[ATTR_TEXT.TS_FGC]=s,r[ATTR_COMMON.BORDERS]={},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]={type:"solid",width:"2px",color:s},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]={type:"solid",width:"2px",color:s},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]={type:"solid",width:"2px",color:s},r[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_BOTTOM]={type:"solid",width:"2px",color:s}}else if(o===NODE_TYPE.ROW){var s=t.getUserLightColour(n);r[ATTR_ROW.TRS_BGC]=s}r.hasOwnProperty(ATTR_COMMON.CLS)?r[ATTR_COMMON.CLS]+=" tc-deletion tc-revision":r[ATTR_COMMON.CLS]="tc-deletion tc-revision"}else a===e.NO_MARKUP_VIEW?r={cls:"tc-txt-hide"}:a===e.ORIGINAL_VIEW&&(r={});return r},d=function(t,i){var n,r,o,a,s=null!=i&&i.hasOwnProperty(ATTR_COMMON.CLS)&&i[ATTR_COMMON.CLS]===NODE_TYPE.FILLABLEFIELD,l=0,d=editor.doc;if(s&&i.hasOwnProperty(e.TC)&&(a=DocUtil.getFloatElementRange(NODE_TYPE.FILLABLEFIELD,t))){for(n=a.start,r=a.end;n<r;n++)o=d.getRawFormatAt(n),o&&o[ATTR_COMMON.TYPE]===NODE_TYPE.TEXT&&(l=n);return l!=t}return!1};return{canSkipFormat:n,getTcDomStyles:r,isHiddenBlock:d}}(TCConstants,ReviewUtil,Utils),TcView=function(e,t,i){var n=function(e){return TcViewUtil.getTcDomStyles(e)},r=function(t){for(var i=editor.doc.getTrackChangeDetails().getDisplayMode(),n=t[e.TC],r=0,o=n.length;r<o;r++){var a=n[r],s=a[e.ACTION];if(s===e.INSERT&&i===e.ORIGINAL_VIEW)return!0}return!1},o=function(i,n){var r=editor.doc.getTrackChangeDetails().getDisplayMode();if(i&&!TcViewUtil.canSkipFormat()&&r==e.ALL_MARKUP_VIEW){var o=n[e.TC][n[e.TC].length-1];i.className=i.className+" writer-glyphs-soft-return-line-break",i.style.color=t.getUserColour(o.zuid)}},a=function(i,n){var r=editor.doc.getTrackChangeDetails().getDisplayMode();if(n&&i&&!TcViewUtil.canSkipFormat()&&r==e.ALL_MARKUP_VIEW){var o=n[e.TC][n[e.TC].length-1];i.className=i.className+" writer-glyphs-end-of-paragraph",i.style.color=t.getUserColour(o.zuid),o[e.ACTION]===e.DELETE&&(i.className=i.className+" writer-glyphs-end-of-paragraph-strike-through")}},s=function(i,n){var r=editor.doc.getTrackChangeDetails().getDisplayMode();if(i&&n&&!TcViewUtil.canSkipFormat()&&r==e.ALL_MARKUP_VIEW){var o=J(n).find("div.fgImgOuterDiv"),a=TcUtil.getTcDeletionDetails(i).zuid,s=document.createElement(NODE_NAME.SPAN),l=t.getUserColour(a),d=o.width(),c=o.height(),u=i[ATTR_IMAGE.I_ROTATE]?i[ATTR_IMAGE.I_ROTATE]:0,g=Math.sqrt(d*d+c*c),h=Math.atan(c/d)*(180/Math.PI),f=parseInt(o[0].style.top.split("px")[0]),p=parseInt(o[0].style.left.split("px")[0]),E=c/2+(f?f:0),T=(d-g)/2+(p?p:0);0===u&&n.tagName.toLowerCase()==NODE_NAME.SPAN&&J(n).css("position","relative");var O=u-h,m=i[ATTR_IMAGE.I_MT]||0,I=i[ATTR_IMAGE.I_MR]||0,D=i[ATTR_IMAGE.I_MB]||0,R=i[ATTR_IMAGE.I_ML]||0;return J(s).css({position:"absolute",margin:m+" "+I+" "+D+" "+R,height:1,"z-index":ZINDEX.IMG_TC_VIEW,width:g,top:E,left:T,"background-color":l,"-ms-transform":"rotate("+O+"deg)","-o-transform":"rotate("+O+"deg)","-moz-transform":"rotate("+O+"deg)",transform:"rotate("+O+"deg)","-webkit-transform":"rotate("+O+"deg)"}),s}},l=function(e,t){return TcViewUtil.isHiddenBlock(e,t)};return{IMAGE_BORDER_WIDTH:2,updateDOMStyles:n,setBRStyle:o,setPilcrowStyle:a,isCharSizeZero:r,getDiagonalLineSpan:s,isHiddenBlock:l}}(TCConstants,ReviewUtil,Utils);!function(){var e=function(e){var t=TcManager.getDoc().createRange();t.start=t.end=e;var i=t.getStartNode();if(i)return i.end;throw new Error("No table found at index: ",e)},t=function(e){var t=TcManager.getDoc().createRange();t.start=t.end=e;var i=t.getStartNode();if(i)return i.end;throw new Error("No row found at index: ",e)},i=function(e){var t=TcManager.getDoc().createRange();t.start=t.end=e;var i=t.getStartNode();if(i)return i.end;throw new Error("No TOC found at index: ",e)},n=function(e){var t=TcManager.getDoc().createRange();t.start=t.end=e;var i=t.getStartNode();if(i)return i.end;throw new Error("No Image found at index: ",e)},r=function(e){for(var t=TcManager.getDoc().getAllSections(),i=0;i<t.length;i++){var n=t[i];if(n.start===e)return n.end+1}throw new Error("No section found with index: ",e)},o=function(e){var t=TcManager.getDoc().getRawFormatAt(e),i=t.id,n=TcManager.getDoc().getFieldById(i);if(!n)throw new Error("Range end cannot be found for index: ",e);var r=TcManager.getDoc().getFieldRange(n);if(!r)throw new Error("Range end cannot be found for index: ",e);return r.end},a=function(){var a=function(e,t,i,n,r,o,a,l,d){var c;return n===TCConstants.FF_VALUE_UPDATE?c=new s[n](e,t,i,n,r,o,a,l,d):(n===TCConstants.INSERT||TCConstants.DELETE)&&(c=new s[o](e,t,i,n,r,o,a,l,d)),c},l=function(e){return e===NODE_TYPE.TABLE||e===NODE_TYPE.ROW||e===NODE_TYPE.TOC||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.SIGNERFIELD||e===NODE_TYPE.FILLABLEFIELD||e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE||e===NODE_TYPE.IMAGE||e===NODE_TYPE.SECTION},d=function(a,s){var l=0;switch(s){case NODE_TYPE.TABLE:l=e(a);break;case NODE_TYPE.ROW:l=t(a);break;case NODE_TYPE.TOC:l=i(a);break;case NODE_TYPE.AUTOFIELD:case NODE_TYPE.FILLABLEFIELD:case TCConstants.FF_VALUE_UPDATE:case NODE_TYPE.SIGNERFIELD:case NODE_TYPE.MAILMERGEFIELD:case NODE_TYPE.FOOTNOTE:case NODE_TYPE.ENDNOTE:l=o(a);break;case NODE_TYPE.IMAGE:l=n(a);break;case NODE_TYPE.SECTION:l=r(a)}return l},c=function(e,t,i,n,r){var o,a,s,l=!0;for(o=0,a=e.length;o<a;o++)if(s=e[o],s.isBlockNode())if(s.getStart()<=t&&i<=s.getEnd()){if(l=s.canAllowNodeCreation(t,i,n,r),!l)break}else if(s.getStart()>t&&s.getEnd()>i)break;return l};return{createNode:a,isBlockNodeType:l,getBlockEnd:d,canAllowNodeCreation:c}}(),s=function(){var e=function(e,t,i,n,r,o,a,s,l,d){this.start=e,this.end=t,this.zuid=i,this.action=n,this.time=r,this.prev=null,this.next=null,this.type=o||"doc",this.details=a,this.headChildNode=s,this.tailChildNode=l,this.isBlock=d||!1,this.mode=TCConstants.CREATE_MODE,this.isHidden=!1,this.linkedNodes=[],this.id="tcnode_"+("x"+Math.random()).replace(/\D/g,"")};extend(e.prototype,{getId:function(){return this.id},getStart:function(){return this.start},getEnd:function(){return this.end},getAction:function(){return this.action},getUser:function(){return this.zuid},getLastModifiedUser:function(){return this.zuid},getAllParticipatedUsers:function(){return[this.zuid]},getHeadChildNode:function(){return this.headChildNode},getTailChildNode:function(){return this.tailChildNode},getElement:function(){return this.el},getType:function(){return this.type},getDetails:function(){return this.details},getTime:function(){return this.time},getMode:function(){return this.mode},getLinkedNodes:function(){return this.linkedNodes},isBlockNode:function(){return this.isBlock},isHiddenNode:function(){return this.isHidden},setType:function(e){this.type=e},setTime:function(e){this.time=e},setMode:function(e){return this.mode=e},setStart:function(e){this.start=e},setEnd:function(e){this.end=e},setAction:function(e){this.action=e},setDetails:function(e){this.details=e},setHeadChildNode:function(e){this.headChildNode=e},setTailChildNode:function(e){this.tailChildNode=e},setIsBlockNode:function(e){this.isBlock=e},setIsHiddenNode:function(e){this.isHidden=e},setLinkedNodes:function(e){this.linkedNodes=e},appendLinkedNodes:function(e){this.linkedNodes.push(e)},updateIndices:function(e){this.start+=e,this.end+=e},isUserParticipated:function(e){return this.zuid===e},getSdkNodes:function(){return TcManager.getRangeSdkNodes(this.getStart(),this.getEnd())},isEquals:function(e){return e.getAction()===this.action&&e.getUser()===this.zuid&&e.getType()===this.type},hasSameStyle:function(e){for(var t,i=0,n=e.length;i<n;i++)if(t=e[i],t[TCConstants.ZUID]===this.zuid&&t[TCConstants.ACTION]===this.action)return!0;return!1},getTcIndicesOp:function(e,t){var i,n,r,o,a=[],s=0;for(a.push({r:e}),i=e;i<t;i++)n=TcManager.getDoc().getRawFormatAt(i),n?(o&&(r=Utils.randomString(),a.push({as:{start:o,id:r}}),a.push({r:s}),a.push({as:{end:ZWJSONUtils.getKeys(o),id:r}}),o=void 0,s=0),n.hasOwnProperty(TCConstants.TC)&&this.hasSameStyle(n[TCConstants.TC])?(o={},o.type=n.type,s=1):a.push({r:1})):o?s+=1:a.push({r:1});return o&&(r=Utils.randomString(),a.push({as:{start:o,id:r}}),a.push({r:s}),a.push({as:{end:ZWJSONUtils.getKeys(o),id:r}})),a},_removeTcStyle:function(){var e={};e[TCConstants.TASK]=TCConstants.REMOVE,e[TCConstants.ACTION]=this.action,e[TCConstants.ZUID]=this.zuid;var t,i,n,r=this.getSdkNodes();for(t=0,i=r.length;t<i;t++)n=r[t],n.getFormat(TCConstants.TC)&&this.hasSameStyle(n.getFormat(TCConstants.TC))&&n.setFormat(TCConstants.TC,[e])},_removeContent:function(){this.getSdkNodes().forEach(function(e){e.remove()})},removeTcStyle:function(){var e,t;for(this._removeTcStyle(),e=0;e<this.linkedNodes.length;e++)t=this.linkedNodes[e],t.removeTcStyle()},removeContent:function(){var e,t;for(this._removeContent(),e=0;e<this.linkedNodes.length;e++)t=this.linkedNodes[e],t.removeContent()},accept:function(){this.action===TCConstants.INSERT?this.removeTcStyle():this.action===TCConstants.DELETE?this.removeContent():this.action===TCConstants.REPLACE&&(this.headChildNode&&this.headChildNode.accept(),this.tailChildNode&&this.tailChildNode.accept())},reject:function(){this.action===TCConstants.INSERT?this.removeContent():this.action===TCConstants.DELETE?this.removeTcStyle():this.action===TCConstants.REPLACE&&(this.headChildNode&&this.headChildNode.reject(),this.tailChildNode&&this.tailChildNode.reject())},toJson:function(){var e=this.headChildNode?this.headChildNode.toJson():null,t=this.tailChildNode?this.tailChildNode.toJson():null;this.linkedNodes=this.linkedNodes||[];var i=this.linkedNodes.map(function(e){return{id:e.id,start:e.start,end:e.end,zuid:e.zuid,action:e.action,time:e.time,type:e.type,details:ZWJSONUtils.clone(e.details),isBlockNode:e.isBlock,isHidden:e.isHidden}});return{id:this.id,start:this.start,end:this.end,zuid:this.zuid,action:this.action,time:this.time,type:this.type,details:ZWJSONUtils.clone(this.details),isBlockNode:this.isBlock,isHidden:this.isHidden,linkedNodes:i,mode:this.mode,headChildNode:e,tailChildNode:t}},toString:function(){return JSON.stringify(this.toJson())},clone:function(){var e,t=this.headChildNode&&this.headChildNode.clone(),i=this.tailChildNode&&this.tailChildNode.clone();return e=a.createNode(this.start,this.end,this.zuid,this.action,this.time,this.type,this.details,t,i)},fillLinkNodes:function(){},canAllowNodeCreation:function(){return!0},isTextNode:function(){return this instanceof t},isRowNode:function(){return this instanceof i},isTableNode:function(){return this instanceof n},isTocNode:function(){return this instanceof o},isSectionNode:function(){return this instanceof r},isAutoFieldNode:function(){return this instanceof s},isFillableFieldNode:function(){return this instanceof l},isSignerFieldNode:function(){return this instanceof c},isMailMergeFieldNode:function(){return this instanceof u},isFootnoteNode:function(){return this instanceof h},isEndnoteNode:function(){return this instanceof f}});var t=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!1),this.setType(NODE_TYPE.TEXT),this.setIsHiddenNode(!1)};t.prototype=Object.create(e.prototype),t.prototype.constructor=t,extend(t.prototype,{removeContent:function(){var e=TcManager.getDoc().createRange();e.start=this.getStart(),e.end=this.getEnd();var t={handleNodeStart:function(e){e&&e.type!=NODE_TYPE.PARAGRAPH&&e.remove()},handleNodeEnd:function(e){e&&e.type===NODE_TYPE.PARAGRAPH&&e.mergeToNextPara()}};e.visitNodes(t)}});var i=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.ROW),this.setIsHiddenNode(!1)};i.prototype=Object.create(e.prototype),i.prototype.constructor=i,extend(i.prototype,{getSdkNodes:function(){return TcManager.getBlockSdkNodes(this.getStart(),this.getEnd())},removeContent:function(){for(var e,t=this.getSdkNodes(),i=0,n=t.length;i<n;i++)if(e=t[i],e[ATTR_COMMON.TYPE]===NODE_TYPE.ROW){e.remove();break}},canAllowNodeCreation:function(e,t,i,n){return!(this.getUser()===n&&this.getAction()===i)}});var n=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.TABLE),this.setIsHiddenNode(!1)};n.prototype=Object.create(e.prototype),n.prototype.constructor=n,extend(n.prototype,{getSdkNodes:function(){return TcManager.getBlockSdkNodes(this.getStart(),this.getEnd())},removeContent:function(){for(var e,t=this.getSdkNodes(),i=0,n=t.length;i<n;i++)if(e=t[i],e[ATTR_COMMON.TYPE]===NODE_TYPE.TABLE){e.remove();break}},canAllowNodeCreation:function(e,t,i,n){return!(this.getUser()===n&&this.getAction()===i)}});var r=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.SECTION),this.setIsHiddenNode(!0)};r.prototype=Object.create(e.prototype),r.prototype.constructor=r,extend(r.prototype,{fillLinkNodes:function(e){var t,i,n,r=TcManager.getDoc().getRawFormatAt(this.start),o=r.st,a=TcManager.getDoc().getFieldById(r.sid),s=a?a.getStart().start:0;if(o==NODE_TYPE.TEXTBOX){var l=TcManager.getDoc().getTextBoxById(r.sid);s=l?l.start:0}if(s>0)for(t=0,i=e.length;t<i;t++)if(n=e[t],(n.getType()===o||o==NODE_TYPE.TEXTBOX&&n.getType()===NODE_TYPE.IMAGE&&p(n.start))&&n.getStart()===s&&n.getAction()===this.action&&n.getUser()===this.zuid){this.appendLinkedNodes(n),n.appendLinkedNodes(this);break}},removeContent:function(){},removeTcStyle:function(e){this._removeTcStyle()},canAllowNodeCreation:function(e,t,i,n){return!(this.getUser()===n&&this.getAction()===i)}});var o=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.TOC),this.setIsHiddenNode(!1)};o.prototype=Object.create(e.prototype),o.prototype.constructor=o,extend(o.prototype,{getSdkNodes:function(){return TcManager.getBlockSdkNodes(this.getStart(),this.getEnd())},removeContent:function(){for(var e,t=this.getSdkNodes(),i=0,n=t.length;i<n;i++)if(e=t[i],e[ATTR_COMMON.TYPE]===NODE_TYPE.TOC){e.remove();break}},canAllowNodeCreation:function(e,t,i,n){return!(this.getUser()===n&&this.getAction()===i)}});var s=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.AUTOFIELD),this.setIsHiddenNode(!1)};s.prototype=Object.create(e.prototype),s.prototype.constructor=s,extend(s.prototype,{canAllowNodeCreation:function(e,t,i,n){return!1},removeContent:function(){var e=this.getSdkNodes(),t=e[0];if(t&&t[ATTR_COMMON.TYPE]===NODE_TYPE.FIELD_START){var i=t.getField();i&&i.remove()}}});var l=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.FILLABLEFIELD),this.setIsHiddenNode(!1)};l.prototype=Object.create(e.prototype),l.prototype.constructor=l,extend(l.prototype,{fillLinkNodes:function(e){var t,i,n;for(t=0,i=e.length;t<i;t++)if(n=e[t],n.getType()===TCConstants.FF_VALUE_UPDATE&&n.getStart()===this.getStart()&&n.getEnd()===this.getEnd()){this.appendLinkedNodes(n),n.getLinkedNodes().length||n.appendLinkedNodes(this);break}},removeTcStyle:function(){this._removeTcStyle()},removeContent:function(){var e=this.getSdkNodes(),t=e[0];if(t&&t[ATTR_COMMON.TYPE]===NODE_TYPE.FIELD_START){var i=t.getField();i&&i.remove()}},canAllowNodeCreation:function(e,t,i,n){return i===TCConstants.FF_VALUE_UPDATE}});var d=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(TCConstants.FF_VALUE_UPDATE),this.setIsHiddenNode(!1)};d.prototype=Object.create(e.prototype),d.prototype.constructor=d,extend(d.prototype,{getAllParticipatedUsers:function(){var e,t,i,n,e,r=[];for(i=this.getDetails()||[],n=0,e=i.length;n<e;n++)t=i[n],r.indexOf(t.zuid)<0&&r.push(t.zuid);return r},getLastModifiedUser:function(){var e=this.details[this.details.length-1];return e&&e.zuid||""},isUserParticipated:function(e){var t=this.getAllParticipatedUsers();return t.forEach(function(t){if(t===e)return!0}),!1},fillLinkNodes:function(e){var t,i,n;for(t=0,i=e.length;t<i;t++)if(n=e[t],n.getType()===NODE_TYPE.FILLABLEFIELD&&n.getStart()===this.getStart()&&n.getEnd()===this.getEnd()){this.appendLinkedNodes(n),n.getLinkedNodes().length||n.appendLinkedNodes(this);break}},accept:function(e,t){t="undefined"==typeof t||t;var i=this.getLinkedNodes();if(t&&0!=i.length){var n=i[0];if(n.getAction()===TCConstants.DELETE)return}var r,o=this.getDetails();if(e=e||o[o.length-1].id,o.forEach(function(t){if(t.id===e)return void(r=t)}),r=r||o[0]){var a=ZWJSONUtils.clone(r.value),s={};s[TCConstants.TASK]=TCConstants.REMOVE,s[TCConstants.ACTION]=this.action,s[TCConstants.DETAILS]=o,delete a.prevInfo,a[TCConstants.TC]=[s];for(var l,d,c=this.getSdkNodes(),u=0,g=c.length;u<g;u++)if(l=c[u],l[ATTR_COMMON.TYPE]===NODE_TYPE.FIELD_START){d=l.getField();break}d&&d.setFieldFormat(a)}},reject:function(e){e="undefined"==typeof e||e;var t=this.getLinkedNodes();if(e&&0!=t.length){var i=t[0];if(i.getAction()===TCConstants.INSERT)return}var n=this.getDetails(),r=n[0];if(r&&r.value&&r.value.prevInfo){var o=ZWJSONUtils.clone(r.value.prevInfo),a={};a[TCConstants.TASK]=TCConstants.REMOVE,a[TCConstants.ACTION]=this.action,a[TCConstants.DETAILS]=n,o[TCConstants.TC]=[a];for(var s,l,d=this.getSdkNodes(),c=0,u=d.length;c<u;c++)if(s=d[c],s[ATTR_COMMON.TYPE]===NODE_TYPE.FIELD_START){l=s.getField();break}l&&l.setFieldFormat(o)}},canAllowNodeCreation:function(e,t,i,n){return this.getStart()===e&&(i===TCConstants.DELETE||i===TCConstants.INSERT)}});var c=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.SIGNERFIELD),this.setIsHiddenNode(!1)};c.prototype=Object.create(e.prototype),c.prototype.constructor=c,extend(c.prototype,{canAllowNodeCreation:function(e,t,i,n){return!1},removeContent:function(){var e=this.getSdkNodes(),t=e[0];if(t&&t[ATTR_COMMON.TYPE]===NODE_TYPE.FIELD_START){var i=t.getField();i&&i.remove()}}});var u=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.MAILMERGEFIELD),this.setIsHiddenNode(!1)};u.prototype=Object.create(e.prototype),u.prototype.constructor=u,extend(u.prototype,{canAllowNodeCreation:function(e,t,i,n){return!1},removeContent:function(){var e=this.getSdkNodes(),t=e[0];if(t&&t[ATTR_COMMON.TYPE]===NODE_TYPE.FIELD_START){var i=t.getField();i&&i.remove()}}});var g=function(e){var t=TcManager.getDoc().getRawFormatAt(e),i=t.id,n=TcManager.getDoc().getAllSections(),r=n.filter(function(e){return e.getSID()===i});return r&&r[0]||null},h=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.FOOTNOTE),this.setIsHiddenNode(!1)};h.prototype=Object.create(e.prototype),h.prototype.constructor=h,extend(h.prototype,{fillLinkNodes:function(e){var t,i,n,r,o=g(this.start);if(o)for(t=o.start,i=0,n=e.length;i<n;i++)if(r=e[i],r.getType()===NODE_TYPE.SECTION&&r.getStart()===t&&r.getAction()===this.action&&r.getUser()===this.zuid){this.appendLinkedNodes(r),r.appendLinkedNodes(this);break}},removeTcStyle:function(){this._removeTcStyle(),this.linkedNodes[0].removeTcStyle()},removeContent:function(){for(var e,t,i=this.getSdkNodes(),n=0,r=i.length;n<r;n++)if(e=i[n],e[ATTR_COMMON.TYPE]===NODE_TYPE.FIELD_START){t=e.getField(),t&&t.remove();break}},canAllowNodeCreation:function(e,t,i,n){return!1}});var f=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.ENDNOTE),this.setIsHiddenNode(!1)};f.prototype=Object.create(e.prototype),f.prototype.constructor=f,extend(f.prototype,{fillLinkNodes:function(e){var t,i,n,r,o=g(this.start);if(o)for(t=o.start,i=0,n=e.length;i<n;i++)if(r=e[i],r.getType()===NODE_TYPE.SECTION&&r.getStart()===t&&r.getAction()===this.action&&r.getUser()===this.zuid){this.appendLinkedNodes(r),r.appendLinkedNodes(this);break}},removeTcStyle:function(){this._removeTcStyle(),this.linkedNodes[0].removeTcStyle()},removeContent:function(){for(var e,t,i=this.getSdkNodes(),n=0,r=i.length;n<r;n++)if(e=i[n],e[ATTR_COMMON.TYPE]===NODE_TYPE.FIELD_START){t=e.getField(),t&&t.remove();break}},canAllowNodeCreation:function(e,t,i,n){return!1}});var p=function(e){var t=TcManager.getDoc().getRawFormatAt(e);return!(!t||t.subType!=NODE_TYPE.TEXTBOX)},E=function(t,i,n,r,o,a,s,l,d){e.apply(this,arguments),this.setIsBlockNode(!0),this.setType(NODE_TYPE.IMAGE),this.setIsHiddenNode(!1)};return E.prototype=Object.create(e.prototype),E.prototype.constructor=E,extend(E.prototype,{fillLinkNodes:function(e){var t,i,n,r,o=g(this.start);if(o)for(t=o.start,i=0,n=e.length;i<n;i++)if(r=e[i],r.getType()===NODE_TYPE.SECTION&&r.getStart()===t&&r.getAction()===this.action&&r.getUser()===this.zuid){this.appendLinkedNodes(r),r.appendLinkedNodes(this);break}},removeTcStyle:function(){this._removeTcStyle(),p(this.start)&&this.linkedNodes[0].removeTcStyle()},removeContent:function(){var e=TcManager.getDoc().createRange();e.start=this.getStart(),e.end=this.getEnd();var t={handleNodeStart:function(e){e&&e.type!=NODE_TYPE.PARAGRAPH&&e.remove()},handleNodeEnd:function(e){}};e.visitNodes(t)},canAllowNodeCreation:function(e,t,i,n){return!1}}),{text:t,table:n,row:i,toc:o,section:r,autofield:s,fillablefield:l,ffValueUpdate:d,signerfield:c,mergeField:u,footnote:h,endnote:f,image:E}}();window.TcBlockHandler=a}();var TCHandler=function(){var e=function(e){var o=e.length,a=!1,s=0,l=!1,c=function(t){var i=DocUtil.getTextStyle(s-1);i[TCConstants.TC]&&delete i[TCConstants.TC],i&&i.hasOwnProperty("type")||(i={type:"text"});var n=Utils.randomString(),r={as:{start:i,id:n}},o={as:{end:ZWJSONUtils.getKeys(i),id:n}};e.splice(t,0,r),e.splice(t+2,0,o)};if(!editor.doc.getTrackChangeDetails().isNoMarkupON()&&(editor.currentCommand===COMMAND.UNDO||editor.currentCommand===COMMAND.REDO))return void t(e);var E=editor.doc.getTrackChangeDetails();if(!E.getProcessingTC()||editor.isOfflineMode){for(var T=0;T<o;T++){var O=e[T];if(O.hasOwnProperty("r"))s+=O.r;else if(O.hasOwnProperty("as")){var m=O.as;m.hasOwnProperty("start")&&e[T+1]&&e[T+1].hasOwnProperty("is")?l=!0:m.hasOwnProperty("end")&&(l=!1)}else if(O.hasOwnProperty("is")&&!l){var I=editor.doc.getRawFormatAt(s-1);if(I||(I=DocUtil.getTextStyle(s-1)),!I.hasOwnProperty(TCConstants.TC))continue;c(T),o+=2,T--}}return void t(e)}for(var T=0;T<o;T++){var O=e[T];if(O.hasOwnProperty("r"))s+=O.r;else if(O.hasOwnProperty("ds")){var D=O.ds,R=D.length,S=d(s,s+R-1),C=0,A=S.start,v=S.end,_=A.length,P=0;e.splice(T,1);for(var N=0;N<_;N++){var b=A[N],L=v[N],w=editor.doc.getContent(b,L+1);if(p(b)){var y={ds:w};e.splice(T+C,0,y),C++}else{var M=TcUtil.getFormatTypeAtIndex(b),F=editor.doc.getRawFormatAt(b);if(F||(F=DocUtil.getTextStyle(b),ch=editor.doc.getCharAt(b),M=TcUtil.getFormatType(F,ch)),M&&r(M,F)){var U=i(b,L,e,T+C);C+=U,P+=w.length}else{var y={ds:w};e.splice(T+C,0,y),C++}}s+=w.length}T=T+C-1,o=e.length}else if(O.hasOwnProperty("as")){var m=O.as;if(m.hasOwnProperty("start")){if(e[T+1]&&e[T+1].hasOwnProperty("is")){l=!0,m=m.start;var V,M=m.type;if("cursor"===M)c(T+1),o+=2;else if(M&&n(M,m)){var B=editor.doc.getTrackChangeDetails().getZuid();V=u(B,TCConstants.INSERT),m[TCConstants.TC]=[],m[TCConstants.TC].push(V),a=!0}}else if(e[T+1]&&e[T+1].hasOwnProperty("r")){m=m.start;var M=m.type,x=[];if("fillablefield"===M&&g(m)&&h(m)){var B=editor.doc.getTrackChangeDetails().getZuid();m.prevInfo&&delete m.prevInfo[TCConstants.TC],x=f(B,TCConstants.FF_VALUE_UPDATE,ZWJSONUtils.clone(m)),m[TCConstants.TC]=x,a=!0}}}else m.hasOwnProperty("end")&&(l=!1,a&&m.end.push(TCConstants.TC),a=!1)}else if(O.hasOwnProperty("is")&&!l){var W=O.is,H=RegExp(CONT_REGEXP.TC_BLOCK_CHARS);if(H.test(W)){M=TcUtil.getFormatType(null,W),newStyle={},newStyle.type=M;var G=Utils.randomString();asStartOp={as:{start:newStyle,id:G}},asEndOp={as:{end:ZWJSONUtils.getKeys(newStyle),id:G}},e.splice(T,0,asStartOp),e.splice(T+2,0,asEndOp),o+=2,T--}else c(T),o+=2,T--}}t(e)},t=function(e){var t,i,n,r,o,a,s;for(t=0,i=e.length;t<i;t++)n=e[t],n.hasOwnProperty("as")&&(r=n.as,r.hasOwnProperty("start")?(o=r.start,"fillablefield"===o.type&&(a=r.id,delete o.prevInfo)):r.hasOwnProperty("end")&&a&&r.id&&a===r.id&&(s=r.end.indexOf("prevInfo"),s>=0&&r.end.splice(s,1)))},i=function(e,t,i,n){for(var o=[],a=[],s=e,l=RegExp(CONT_REGEXP.TC_BLOCK_CHARS),d=0,c=e+1;c<=t;c++){var g=editor.doc.getRawFormatAt(c),h=editor.doc.getCharAt(c);(g||l.test(h))&&(o.push(s),a.push(c-1),s=c)}a.indexOf(t)===-1&&(o.push(s),a.push(t));for(var c=0,f=o.length;c<f;c++){var s=o[c],p=a[c],E=TcUtil.getFormatTypeAtIndex(s),g=editor.doc.getRawFormatAt(s);if(g||(g=DocUtil.getTextStyle(s),h=editor.doc.getCharAt(s),E=TcUtil.getFormatType(g,h)),g=DocUtil.copyStyle(g),E&&r(E,g)){var T,O=editor.doc.getTrackChangeDetails().getZuid();T=u(O,TCConstants.DELETE);var m={};m.type=g.type,m[TCConstants.TC]=[],m[TCConstants.TC].push(T);var I=Utils.randomString(),D={as:{start:m,id:I}},R={r:p-s+1},S={as:{end:ZWJSONUtils.getKeys(m),id:I}};i.splice(n+d,0,D,R,S),d+=3}else{var R={r:p-s+1};i.splice(n+d,0,R),d+=1}}return d},n=function(e,t){return e===NODE_TYPE.TEXT&&t&&t.hasOwnProperty(ATTR_COMMON.FIELDINFO)?TcManager.getDoc().getFieldById(t[ATTR_COMMON.FIELDINFO]).getFillableFieldType()!=FILLABLEFIELD_TYPE.MULTIPLECHOICE:e===NODE_TYPE.TEXT||e===NODE_TYPE.PARAGRAPH||e===NODE_TYPE.BR||e===NODE_TYPE.IMAGE||e===NODE_TYPE.TABLE||e===NODE_TYPE.ROW||e===NODE_TYPE.CELL||e===NODE_TYPE.TABLEEND||e===NODE_TYPE.TOC||e===NODE_TYPE.TOCEND||e===NODE_TYPE.HR||e===NODE_TYPE.IFRAME||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.SIGNERFIELD||e===NODE_TYPE.FILLABLEFIELD||e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE||e===NODE_TYPE.SECTION},r=function(e,t){return e===NODE_TYPE.TEXT&&t&&t.hasOwnProperty(ATTR_COMMON.FIELDINFO)?TcManager.getDoc().getFieldById(t[ATTR_COMMON.FIELDINFO]).getFillableFieldType()!=FILLABLEFIELD_TYPE.MULTIPLECHOICE:e===NODE_TYPE.TEXT||e===NODE_TYPE.PARAGRAPH||e===NODE_TYPE.BR||e===NODE_TYPE.IMAGE||e===NODE_TYPE.TABLE||e===NODE_TYPE.TABLEEND||e===NODE_TYPE.ROW||e===NODE_TYPE.CELL||e===NODE_TYPE.TOC||e===NODE_TYPE.TOCEND||e===NODE_TYPE.HR||e===NODE_TYPE.IFRAME||e===NODE_TYPE.SECTION||!(!o(e)||!editor.doc.getTrackChangeDetails().isProcessingContentDeletion())},o=function(e){return e===NODE_TYPE.COMMENT||e===NODE_TYPE.LINK||e===NODE_TYPE.BOOKMARK||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.SIGNERFIELD||e===NODE_TYPE.FILLABLEFIELD||e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE},a=function(e){return!1},s=function(e){var t=TableUtil.getTableStart(e[0]),i=DocTreeManager.getTreeNodeAtIndex(t);return i.children.length===e.length},l=function(e,t){var i=0;switch(t){case NODE_TYPE.TABLE:i=e;break;case NODE_TYPE.TABLEEND:i=e;break;case NODE_TYPE.ROW:i=TableUtil.getRowEnd(e+1)-1;break;case NODE_TYPE.TOC:i=editor.doc.findNextIndexOf(UNICODE.TOCEND,e+1);break;case NODE_TYPE.AUTOFIELD:case NODE_TYPE.FILLABLEFIELD:case NODE_TYPE.SIGNERFIELD:case NODE_TYPE.MAILMERGEFIELD:case NODE_TYPE.FOOTNOTE:case NODE_TYPE.ENDNOTE:i=DocUtil.getRangeEnd(e);break;case NODE_TYPE.IMAGE:i=e;break;case NODE_TYPE.SECTION:i=editor.doc.getSectionEnd(e)-1}return i},d=function(e,t){var i=[],n=[],r=e,o=editor.doc,a=RegExp(CONT_REGEXP.TC_BLOCK_CHARS),s={start:i,end:n};if(e===t)return i.push(e),n.push(t),s;for(var d=e;d<=t;d++){var c=o.getRawFormatAt(d),u=o.getCharAt(d),g=TcUtil.getFormatTypeAtIndex(d);if(c||(u=editor.doc.getCharAt(d),g=TcUtil.getFormatType(DocUtil.getTextStyle(d),u)),u===UNICODE.TOCSTART&&g!=NODE_TYPE.TOC&&(c.type=NODE_TYPE.TOC,g=c.type,editor.doc.setFormatAt(d,c)),TcBlockHandler.isBlockNodeType(g)){i.indexOf(r)===-1&&r!==d&&(i.push(r),n.push(d-1)),i.push(d);var h;if(h=g===NODE_TYPE.TABLE?TableUtil.getTableEnd(d+1)-1:g===NODE_TYPE.SECTION?d:l(d,g),h>t)throw ZWLogger.log("Error in TcBlock Deletion... type : "+g+"... blockEnd : "+h+"... annotationStartIndex : "+e+"... annotationEndIndex : "+t),"Error in TcBlock Deletion";n.push(h),r=h+1,d=h}else(c||a.test(u))&&r!==d&&(i.push(r),n.push(d-1),r=d)}n.indexOf(t)===-1&&(i.push(r),n.push(t)),finalStartArrLen=i.length;for(var d=1;d<finalStartArrLen;d++){var r=i[d],f=n[d],p=(i[d-1],n[d-1]),E=o.getRawFormatAt(r),T=o.getRawFormatAt(p);E&&T&&E.type===NODE_TYPE.TEXT&&T.type===NODE_TYPE.TEXT&&!E[TCConstants.TC]&&!T[TCConstants.TC]&&(n[d-1]=f,i.splice(d,1),n.splice(d,1),d--,finalStartArrLen--)}return s},c=function(e){var t=editor.doc,i={};i.r=0;var n={};n.as={},n.as.start={};for(var r in e)e.hasOwnProperty(r)&&(n.as.start[r]=e[r]);n.as.start[ATTR_COMMON.TYPE]=NODE_TYPE.BODY;var o=Utils.randomString();n.as.id=o;var a={};a.as={},a.as.end=ZWJSONUtils.getKeys(n.as.start),a.as.id=o;var s=[];s.push(i),s.push(n),s.push(i),s.push(a),Op.processMsg(s),EditorUtil.focusMultiByteSpan(),t.snapShotManager.setSkipSnapShot(!0),Op.sendMsg(),t.snapShotManager.setSkipSnapShot(!1)},u=function(e,t){var i=editor.zuid+"";e=e?e:i,t=t?t:TCConstants.INSERT;var n={};n[TCConstants.ZUID]=e,n[TCConstants.ACTION]=t,n[TCConstants.TIME]=(new Date).getTime();var r=editor.doc.getTrackChangeDetails().isUserParticipated();return r||(editor.doc.getTrackChangeDetails().makeUserParticipated(),ReviewUtil.addParticipant()),n},g=function(e){var t=e[ATTR_FILLABLEFIELD.FF_INFO],i=t&&t[ATTR_FILLABLEFIELD.FF_SUBTYPE]||null;return e[ATTR_FILLABLEFIELD.FF_TYPE]!==FILLABLEFIELD_TYPE.SELECTBOX&&(e[ATTR_FILLABLEFIELD.FF_TYPE]===FILLABLEFIELD_TYPE.CHECKBOX||i&&i===FILLABLEFIELD_TYPE.SINGLELINE||i===FILLABLEFIELD_TYPE.EMAIL||i===FILLABLEFIELD_TYPE.PHONE||i===FILLABLEFIELD_TYPE.NUMBER||i===FILLABLEFIELD_TYPE.PERCENT)},h=function(e){if(e&&e[ATTR_FILLABLEFIELD.FF_INFO]){var t=e[ATTR_FILLABLEFIELD.FF_INFO];return t.hasOwnProperty(ATTR_FILLABLEFIELD.FF_VALUE)||t.hasOwnProperty(ATTR_FILLABLEFIELD.FF_CHECKED)}return!1},f=function(e,t,i){var n=editor.zuid+"";e=e?e:n,t=t?t:TCConstants.INSERT;var r=[];if(i.hasOwnProperty(TCConstants.TC))for(var o=i[TCConstants.TC],a=0,s=o.length;a<s;a++)r.push(o[a]);else{var l={};l[TCConstants.ACTION]=t;var d={};d[TCConstants.ZUID]=e,d[TCConstants.TIME]=(new Date).getTime(),d[TCConstants.VALUE]=i,d[TCConstants.ID]=Utils.randomString();var c=[d];l[TCConstants.DETAILS]=c;var u=editor.doc.getTrackChangeDetails().isUserParticipated();u||(editor.doc.getTrackChangeDetails().makeUserParticipated(),ReviewUtil.addParticipant()),r.push(l)}return r},p=function(e){var t=editor.doc,i=t.getRawFormatAt(e)||DocUtil.getTextStyle(e);if(i&&i[TCConstants.TC])for(var n=i[TCConstants.TC],r=editor.zuid+"",o=0,a=n.length;o<a;o++){var s=n[o];if(s[TCConstants.ZUID]===r&&s[TCConstants.ACTION]===TCConstants.INSERT)return!0}return!1},E=function(e){TcManager.acceptChanges(e)},T=function(e){TcManager.rejectChanges(e)},O=function(e,t){TcManager.accept(e,t)},m=function(e,t){TcManager.reject(e,t)},I=function(){TcManager.acceptAllInSelection()},D=function(){TcManager.rejectAllInSelection()},R=function(e){var t=TCConstants.ORIGINAL_VIEW;return"as_markups"===e?t=TCConstants.ALL_MARKUP_VIEW:"all"===e&&(t=TCConstants.NO_MARKUP_VIEW),t},S=function(){return!1};return{processMsg:e,accept:O,reject:m,acceptAllInSelection:I,rejectAllInSelection:D,acceptChanges:E,rejectChanges:T,isSupportedRangeCharType:o,isDeletionSupported:r,isInsertionSupported:n,isListData:a,isAllRowsSelected:s,sendTCPropertiesOP:c,getDisplayMode:R,hasOPs:S}}(),TCHandlerBeta=function(){function e(e,t,i,n,r,o,a){this.range=e,this.type=t,this.action=i,this.zuid=n,this.chars=r,this.style=o,this.details=a}var t=new DocOpBuilder,i=new DocOpBuilder,n=new DocOpBuilder,r=!1,o=[];e.prototype=new DocOp,e.prototype.length=function(){return this.range},e.prototype.toString=function(){var e={};return e.type=this.type,e.range=this.range,e.action=this.action,e.zuid=this.zuid,e.chars=this.chars,JSON.stringify(e)},e.prototype.toJSON=function(){return{tc:{range:this.range,action:this.action,zuid:this.zuid,chars:this.chars,style:this.style}}},e.prototype.getUser=function(){return this.zuid},e.prototype.setChars=function(e){this.chars=e},e.prototype.getChars=function(){return this.chars},e.prototype.getType=function(){return this.type},e.prototype.getStyle=function(){return this.style},e.prototype.setStyle=function(e){this.style=e},e.prototype.getDetails=function(){return this.details},e.prototype.setDetails=function(e){this.details=e},e.prototype.setRange=function(e){this.range=e},e.prototype.getRange=function(){return this.range},e.prototype.getAction=function(){return this.action},e.prototype.setAction=function(e){this.action=e};var a=function(a){var s=a.length,u=0,g=!1,h=function(e){var t=DocUtil.getTextStyle(u-1);t[TCConstants.TC]&&delete t[TCConstants.TC],t&&t.hasOwnProperty("type")||(t={type:"text"});var i=Utils.randomString(),n={as:{start:t,id:i}},r={as:{end:ZWJSONUtils.getKeys(t),id:i}};a.splice(e,0,n),a.splice(e+2,0,r)};if(!editor.doc.getTrackChangeDetails().isNoMarkupON()&&(editor.currentCommand===COMMAND.UNDO||editor.currentCommand===COMMAND.REDO))return void D(a);var f=editor.doc.getTrackChangeDetails();if(!f.getProcessingTC()||editor.isOfflineMode){for(var p=0;p<s;p++){var E=a[p];if(E.hasOwnProperty("r"))u+=E.r;else if(E.hasOwnProperty("as")){var T=E.as;T.hasOwnProperty("start")&&a[p+1]&&a[p+1].hasOwnProperty("is")?g=!0:T.hasOwnProperty("end")&&(g=!1)}else if(E.hasOwnProperty("is")&&!g){var O=editor.doc.getRawFormatAt(u-1);if(O||(O=DocUtil.getTextStyle(u-1)),!O.hasOwnProperty(TCConstants.TC))continue;h(p),s+=2,p--}}return void D(a)}var m,S=!1,v=!1;editor.doc.getTrackChangeDetails().isContentMovedFromSource()?(t=new DocOpBuilder,m=t):editor.doc.getTrackChangeDetails().isContentMovedToTarget()?(i=new DocOpBuilder,m=i):(n=new DocOpBuilder,m=n);for(var p=0;p<s;p++){var E=a[p];if(E.hasOwnProperty("r")){var _=E.r;u+=_;var P=new DocOp;P.skipChars(_),m.push(P)}else if(E.hasOwnProperty("ds")){var N=E.ds,L=N.length,V=b(u,u+L-1),B=0,x=V.start,W=V.end,H=x.length,G=0,k=0;S=!0,a.splice(p,1);for(var Y=0;Y<H;Y++){var Z=x[Y],z=W[Y],J=editor.doc.getContent(Z,z+1);if(U(Z)){var j={ds:J};a.splice(p+B,0,j),B++,j=new DocOp,j.deleteCharacters(J),m.push(j)}else{var X=TcUtil.getFormatTypeAtIndex(Z),K=editor.doc.getRawFormatAt(Z);if(K||(K=DocUtil.getTextStyle(Z),ch=editor.doc.getCharAt(Z),X=TcUtil.getFormatType(K,ch)),X&&A(X,K)){var Q=R(Z,z,a,p+B,m);B+=Q,G+=J.length}else{var j={ds:J};a.splice(p+B,0,j),B++,j=new DocOp,j.deleteCharacters(J),m.push(j)}}u+=J.length}p=p+B-1,s=a.length}else if(E.hasOwnProperty("as")){var T=E.as;if(T.hasOwnProperty("start")){if(T.start.hasOwnProperty(TCConstants.TC)&&delete T.start[TCConstants.TC],a[p+1]&&a[p+1].hasOwnProperty("is")){v=!0,g=!0,T=T.start;var q,X=T.type,$=a[p+1].is;if("cursor"===X)h(p+1),s+=2;else if(X&&C(X,T)){v=!0;var ee=editor.doc.getTrackChangeDetails().getZuid();q=w(ee,TCConstants.INSERT);var te={};te[TCConstants.TIME]=(new Date).getTime();var ie=new e($.length,X,TCConstants.INSERT,editor.doc.getTrackChangeDetails().getZuid(),$,{type:X});ie.setDetails(te),m.push(ie)}else{var ne=new DocOp;ne.newCharacters($),m.push(ne)}}else if(a[p+1]&&a[p+1].hasOwnProperty("r")){T=T.start;var X=T.type,re=[];if("fillablefield"===X&&y(T)&&M(T)){var ee=editor.doc.getTrackChangeDetails().getZuid();T.prevInfo&&delete T.prevInfo[TCConstants.TC];var oe=a[p+1].r;re=F(ee,TCConstants.FF_VALUE_UPDATE,ZWJSONUtils.clone(T));var ie=new e(oe,X,TCConstants.FF_VALUE_UPDATE,ee,"",{type:X},re);m.push(ie),u+=oe,p+=1}}}else T.hasOwnProperty("end")&&(g=!1,k=T.end.indexOf(TCConstants.TC),k>=0&&T.end.splice(k,1))}else if(E.hasOwnProperty("is")&&!g){var ae=E.is,se=RegExp(CONT_REGEXP.TC_BLOCK_CHARS);if(se.test(ae)){X=TcUtil.getFormatType(null,ae),newStyle={},newStyle.type=X;var le=Utils.randomString();asStartOp={as:{start:newStyle,id:le}},asEndOp={as:{end:ZWJSONUtils.getKeys(newStyle),id:le}},a.splice(p,0,asStartOp),a.splice(p+2,0,asEndOp),s+=2,p--}else h(p),s+=2,p--}}if(editor.doc.getTrackChangeDetails().isContentMovedToTarget())if(I(t,i)){t=c(t),i=c(i),l(t,TCConstants.MOVED_FROM),l(i,TCConstants.MOVED_TO);var de=Utils.randomString();d(t,de),d(i,de),o.push(t),o.push(i),t=new DocOpBuilder,i=new DocOpBuilder,r=!1}else t.isEmpty()||(t=c(t),o.push(t)),i.isEmpty()||(i=c(i),o.push(i)),t=new DocOpBuilder,i=new DocOpBuilder,r=!1;else n.length()&&(n=c(n),o.push(n),n=new DocOpBuilder);D(a)},s=function(t){return t instanceof e},l=function(e,t){e.getDocOps().forEach(function(e){docOp=new DocOp,s(e)&&e.setAction(t)})},d=function(e,t){e.getDocOps().forEach(function(e){if(docOp=new DocOp,s(e)){var i=e.getDetails();i[TCConstants.MOVEMENT_ID]=t}})},c=function(e){for(var t,i,n=e.docOps,r=!0,o=new DocOpBuilder,a=0,l=n.length;a<l;a++){var t=n[a];if(s(t)){if(r&&i&&i.getType()===t.getType()&&i.getAction()===t.getAction()&&i.getUser()===t.getUser()){i.setChars(i.getChars()+t.getChars()),i.setRange(i.getRange()+t.getRange());continue}r=!0,i=t,o.push(t)}else r=!1,i=null,o.push(t)}return o},u=function(e){var t=e.getAction(),i=e.getDetails(),n=e.getUser(),r=i.time?i.time:(new Date).getTime();if(t===TCConstants.DELETE||t===TCConstants.INSERT){var o={};o[TCConstants.ZUID]=n,o[TCConstants.ACTION]=t,o[TCConstants.TIME]=r}else if(t===TCConstants.FF_VALUE_UPDATE){var o={};o[TCConstants.ACTION]=t,o[TCConstants.DETAILS]=i}else if(t===TCConstants.MOVED_FROM||t===TCConstants.MOVED_TO){var o={};o[TCConstants.ACTION]=t;var a={};a[TCConstants.ZUID]=n,a[TCConstants.TIME]=r,a[TCConstants.MOVEMENT_ID]=i[TCConstants.MOVEMENT_ID]?i[TCConstants.MOVEMENT_ID]:Utils.randomString(),o[TCConstants.DETAILS]=a}var s=editor.doc.getTrackChangeDetails().isUserParticipated();return s||(editor.doc.getTrackChangeDetails().makeUserParticipated(),ReviewUtil.addParticipant()),o},g=function(e){var t,i,n,r,o=[];for(t=0,i=e.length;t<i;t++)n=e[t],n[TCConstants.ACTION]===TCConstants.MOVED_FROM?(r={},r[TCConstants.ACTION]=TCConstants.DELETE,r[TCConstants.ZUID]=n[TCConstants.DETAILS][TCConstants.ZUID],r[TCConstants.TIME]=n[TCConstants.DETAILS][TCConstants.TIME],o.push(r)):n[TCConstants.ACTION]===TCConstants.MOVED_TO?(r={},r[TCConstants.ACTION]=TCConstants.INSERT,r[TCConstants.ZUID]=n[TCConstants.DETAILS][TCConstants.ZUID],r[TCConstants.TIME]=n[TCConstants.DETAILS][TCConstants.TIME],o.push(r)):o.push(n);return o},h=function(e){e.getDocOps().forEach(function(e){if(e.isAnnotationStart()){var t=e.styles.begin;t.hasOwnProperty(TCConstants.TC)&&(t[TCConstants.TC]=g(t[TCConstants.TC]))}})},f=function(e){var t=Utils.randomString(),i=(e.getUser(),u(e)),n=[],r=e.getStyle();r[TCConstants.TC]=[],r[TCConstants.TC].push(i);var o=new DocOp;if(o.changeStyles([],r,t),n.push(o),e.getAction()===TCConstants.INSERT||"movedTo"===e.getAction()){var a=new DocOp;a.newCharacters(e.getChars()),n.push(a)}else{var s=new DocOp;s.skipChars(e.getRange()),n.push(s)}var l=new DocOp;return l.changeStyles(ZWJSONUtils.getKeys(r),[],t),n.push(l),n},p=function(){return!(!o.length&&!t.length())},E=function(){var e,i=[];return o.length?o.forEach(function(e){i.push(m(e))}):t.length()&&(i.push(m(t)),r=!0),e=DocOpBuilder.combineOps(i),e=T(e)},T=function(e){var t=new DocOpBuilder;return e.getDocOps().forEach(function(e){if(e.isInsert()){var i=new DocOp;i.skipChars(e.length()),t.push(i)}else!e.isDelete()&&t.push(e)}),t},O=function(){o=[],t=new DocOpBuilder,i=new DocOpBuilder,n=new DocOpBuilder,r=!1},m=function(e){var t,i=new DocOpBuilder;return e.getDocOps().forEach(function(e){if(t=new DocOp,e.isRetain())t.skipChars(e.length()),i.push(t);else if(s(e)){var n=f(e);n.forEach(function(e){i.push(e)})}else(e.isDelete()||e.isInsert())&&i.push(e)}),i},I=function(e,t){var i="",n="";return e.getDocOps().forEach(function(e){s(e)&&(i+=e.getChars())}),t.getDocOps().forEach(function(e){s(e)&&(n+=e.getChars())}),i===n},D=function(e){var t,i,n,r,o,a,s;for(t=0,i=e.length;t<i;t++)n=e[t],n.hasOwnProperty("as")&&(r=n.as,r.hasOwnProperty("start")?(o=r.start,"fillablefield"===o.type&&(a=r.id,delete o.prevInfo)):r.hasOwnProperty("end")&&a&&r.id&&a===r.id&&(s=r.end.indexOf("prevInfo"),s>=0&&r.end.splice(s,1)))},R=function(t,i,n,r,o){for(var a=[],s=[],l=t,d=RegExp(CONT_REGEXP.TC_BLOCK_CHARS),c=0,u=t+1;u<=i;u++){var g=editor.doc.getRawFormatAt(u),h=editor.doc.getCharAt(u);(g||d.test(h))&&(a.push(l),s.push(u-1),l=u)}s.indexOf(i)===-1&&(a.push(l),s.push(i));for(var u=0,f=a.length;u<f;u++){var l=a[u],p=s[u],E=TcUtil.getFormatTypeAtIndex(l),g=editor.doc.getRawFormatAt(l);if(g||(g=DocUtil.getTextStyle(l),h=editor.doc.getCharAt(l),E=TcUtil.getFormatType(g,h)),g=DocUtil.copyStyle(g),E&&A(E,g)){var T,O=editor.doc.getTrackChangeDetails().getZuid();T=w(O,TCConstants.DELETE);var m={};m.type=g.type;var I=Utils.randomString(),D={as:{start:m,id:I}},R={r:p-l+1},S={as:{end:ZWJSONUtils.getKeys(m),id:I}};n.splice(r+c,0,D,R,S),c+=3;var C=editor.doc.getContent(l,p+1),v={};v[TCConstants.TIME]=(new Date).getTime();var _=new e(C.length,E,TCConstants.DELETE,editor.doc.getTrackChangeDetails().getZuid(),C,{type:E});_.setDetails(v),o.push(_)}else{var R={r:p-l+1};n.splice(r+c,0,R),c+=1;var R=new DocOp;R.skipChars(p-l+1),o.push(R)}}return c},S=function(e){var t=e[ATTR_COMMON.ST];return t===NODE_TYPE.FOOTNOTE||t===NODE_TYPE.ENDNOTE||t===NODE_TYPE.TEXTBOX},C=function(e,t){return e===NODE_TYPE.SECTION?S(t):e===NODE_TYPE.TEXT||e===NODE_TYPE.PARAGRAPH||e===NODE_TYPE.BR||e===NODE_TYPE.IMAGE||e===NODE_TYPE.TABLE||e===NODE_TYPE.ROW||e===NODE_TYPE.CELL||e===NODE_TYPE.TABLEEND||e===NODE_TYPE.TOC||e===NODE_TYPE.TOCEND||e===NODE_TYPE.HR||e===NODE_TYPE.IFRAME||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.SIGNERFIELD||e===NODE_TYPE.FILLABLEFIELD||e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE;},A=function(e,t){return e===NODE_TYPE.SECTION?S(t):e===NODE_TYPE.TEXT||e===NODE_TYPE.PARAGRAPH||e===NODE_TYPE.BR||e===NODE_TYPE.IMAGE||e===NODE_TYPE.TABLE||e===NODE_TYPE.TABLEEND||e===NODE_TYPE.ROW||e===NODE_TYPE.CELL||e===NODE_TYPE.TOC||e===NODE_TYPE.TOCEND||e===NODE_TYPE.HR||e===NODE_TYPE.IFRAME||!(!v(e)||!editor.doc.getTrackChangeDetails().isProcessingContentDeletion())},v=function(e){return e===NODE_TYPE.COMMENT||e===NODE_TYPE.LINK||e===NODE_TYPE.BOOKMARK||e===NODE_TYPE.AUTOFIELD||e===NODE_TYPE.SIGNERFIELD||e===NODE_TYPE.FILLABLEFIELD||e===NODE_TYPE.MAILMERGEFIELD||e===NODE_TYPE.FOOTNOTE||e===NODE_TYPE.ENDNOTE},_=function(e){return!1},P=function(e){var t=TableUtil.getTableStart(e[0]),i=DocTreeManager.getTreeNodeAtIndex(t);return i.children.length===e.length},N=function(e,t){var i=0;switch(t){case NODE_TYPE.TABLE:i=e;break;case NODE_TYPE.TABLEEND:i=e;break;case NODE_TYPE.ROW:i=TableUtil.getRowEnd(e+1)-1;break;case NODE_TYPE.TOC:i=editor.doc.findNextIndexOf(UNICODE.TOCEND,e+1);break;case NODE_TYPE.AUTOFIELD:case NODE_TYPE.FILLABLEFIELD:case NODE_TYPE.SIGNERFIELD:case NODE_TYPE.MAILMERGEFIELD:case NODE_TYPE.FOOTNOTE:case NODE_TYPE.ENDNOTE:i=DocUtil.getRangeEnd(e);break;case NODE_TYPE.IMAGE:i=e;break;case NODE_TYPE.SECTION:i=editor.doc.getSectionEnd(e)-1}return i},b=function(e,t){var i=[],n=[],r=e,o=editor.doc,a=RegExp(CONT_REGEXP.TC_BLOCK_CHARS),s={start:i,end:n};if(e===t)return i.push(e),n.push(t),s;for(var l=e;l<=t;l++){var d=o.getRawFormatAt(l),c=o.getCharAt(l),u=TcUtil.getFormatTypeAtIndex(l);if(d||(c=editor.doc.getCharAt(l),u=TcUtil.getFormatType(DocUtil.getTextStyle(l),c)),c===UNICODE.TOCSTART&&u!=NODE_TYPE.TOC&&(d.type=NODE_TYPE.TOC,u=d.type,editor.doc.setFormatAt(l,d)),TcBlockHandler.isBlockNodeType(u)){i.indexOf(r)===-1&&r!==l&&(i.push(r),n.push(l-1)),i.push(l);var g;if(g=u===NODE_TYPE.TABLE?TableUtil.getTableEnd(l+1)-1:u===NODE_TYPE.SECTION?l:N(l,u),g>t)throw ZWLogger.log("Error in TcBlock Deletion... type : "+u+"... blockEnd : "+g+"... annotationStartIndex : "+e+"... annotationEndIndex : "+t),"Error in TcBlock Deletion";n.push(g),r=g+1,l=g}else(d||a.test(c))&&r!==l&&(i.push(r),n.push(l-1),r=l)}n.indexOf(t)===-1&&(i.push(r),n.push(t)),finalStartArrLen=i.length;for(var l=1;l<finalStartArrLen;l++){var r=i[l],h=n[l],f=(i[l-1],n[l-1]),p=o.getRawFormatAt(r),E=o.getRawFormatAt(f);p&&E&&p.type===NODE_TYPE.TEXT&&E.type===NODE_TYPE.TEXT&&!p[TCConstants.TC]&&!E[TCConstants.TC]&&(n[l-1]=h,i.splice(l,1),n.splice(l,1),l--,finalStartArrLen--)}return s},L=function(e){var t=editor.doc,i={};i.r=0;var n={};n.as={},n.as.start={};for(var r in e)e.hasOwnProperty(r)&&(n.as.start[r]=e[r]);n.as.start[ATTR_COMMON.TYPE]=NODE_TYPE.BODY;var o=Utils.randomString();n.as.id=o;var a={};a.as={},a.as.end=ZWJSONUtils.getKeys(n.as.start),a.as.id=o;var s=[];s.push(i),s.push(n),s.push(i),s.push(a),Op.processMsg(s),EditorUtil.focusMultiByteSpan(),t.snapShotManager.setSkipSnapShot(!0),Op.sendMsg(),t.snapShotManager.setSkipSnapShot(!1)},w=function(e,t){var i=editor.zuid+"";e=e?e:i,t=t?t:TCConstants.INSERT;var n={};if(n[TCConstants.ZUID]=e,n[TCConstants.ACTION]=t,n[TCConstants.TIME]=(new Date).getTime(),!isV8Engine){var r=editor.doc.getTrackChangeDetails().isUserParticipated();r||(editor.doc.getTrackChangeDetails().makeUserParticipated(),ReviewUtil.addParticipant())}return n},y=function(e){var t=e[ATTR_FILLABLEFIELD.FF_INFO],i=t&&t[ATTR_FILLABLEFIELD.FF_SUBTYPE]||null;return e[ATTR_FILLABLEFIELD.FF_TYPE]!==FILLABLEFIELD_TYPE.SELECTBOX&&(e[ATTR_FILLABLEFIELD.FF_TYPE]===FILLABLEFIELD_TYPE.CHECKBOX||i&&i===FILLABLEFIELD_TYPE.SINGLELINE||i===FILLABLEFIELD_TYPE.EMAIL||i===FILLABLEFIELD_TYPE.PHONE||i===FILLABLEFIELD_TYPE.NUMBER||i===FILLABLEFIELD_TYPE.PERCENT)},M=function(e){if(e&&e[ATTR_FILLABLEFIELD.FF_INFO]){var t=e[ATTR_FILLABLEFIELD.FF_INFO];return t.hasOwnProperty(ATTR_FILLABLEFIELD.FF_VALUE)||t.hasOwnProperty(ATTR_FILLABLEFIELD.FF_CHECKED)}return!1},F=function(e,t,i){var n=editor.zuid+"";e=e?e:n,t=t?t:TCConstants.INSERT;var r=[];if(i.hasOwnProperty(TCConstants.TC))for(var o=i[TCConstants.TC],a=0,s=o.length;a<s;a++)r.push(o[a]);else{var l={};l[TCConstants.ZUID]=e,l[TCConstants.TIME]=(new Date).getTime(),l[TCConstants.VALUE]=i,l[TCConstants.ID]=Utils.randomString();var d=editor.doc.getTrackChangeDetails().isUserParticipated();d||(editor.doc.getTrackChangeDetails().makeUserParticipated(),ReviewUtil.addParticipant()),r.push(l)}return r},U=function(e){var t=editor.doc,i=t.getRawFormatAt(e)||DocUtil.getTextStyle(e);if(i&&i[TCConstants.TC])for(var n=i[TCConstants.TC],r=editor.zuid+"",o=0,a=n.length;o<a;o++){var s=n[o];if(s[TCConstants.ZUID]===r&&s[TCConstants.ACTION]===TCConstants.INSERT)return!0}return!1},V=function(e){TcManager.acceptChanges(e)},B=function(e){TcManager.rejectChanges(e)},x=function(e,t){TcManager.accept(e,t)},W=function(e,t){TcManager.reject(e,t)},H=function(){TcManager.acceptAllInSelection()},G=function(){TcManager.rejectAllInSelection()},k=function(e){var t=TCConstants.ORIGINAL_VIEW;return"as_markups"===e?t=TCConstants.ALL_MARKUP_VIEW:"all"===e&&(t=TCConstants.NO_MARKUP_VIEW),t},Y=function(e){var t,i,n,r,o,a,s,l,d;if(!e||!e.length)return!1;for(t=0,i=e.length;t<i;t++)if(o=e[t],o.hasOwnProperty(TCConstants.TC))for(a=o[TCConstants.TC],n=0,r=a.length;n<r;n++)s=a[n],s[TCConstants.ACTION]===TCConstants.INSERT?l=s[TCConstants.ZUID]:s[TCConstants.ACTION]===TCConstants.DELETE&&(d=s[TCConstants.ZUID]);return!(!l||!d||l!==d)},Z=function(e){for(var t=[],i=e.docOps,n=!1,r=0,o=i.length;r<o;r++)if(docOp=i[r],docOp.isAnnotationStart())t.push(docOp.styles.begin);else if(docOp.isAnnotationEnd())t.pop();else if(n=Y(t))break;return n};return{hasOPs:p,getBufferOPs:E,resetBuffer:O,processMsg:a,accept:x,reject:W,acceptAllInSelection:H,rejectAllInSelection:G,acceptChanges:V,rejectChanges:B,isSupportedRangeCharType:v,isDeletionSupported:A,isInsertionSupported:C,isListData:_,isAllRowsSelected:P,sendTCPropertiesOP:L,getDisplayMode:k,convertMovedOpToNormalTcOp:h,isSameUserTcStyleOpPresents:Z}}();TCHandler=TCHandlerBeta;var TcUtil={};TcUtil.getFormatType=function(e,t){return t===UNICODE.TABLEEND?NODE_TYPE.TABLEEND:t===UNICODE.TOCEND?NODE_TYPE.TOCEND:e?e.type:""},TcUtil.getFormatTypeAtIndex=function(e){var t=editor.doc.getRawFormatAt(e),i=editor.doc.getCharAt(e);return TcUtil.getFormatType(t,i)},TcUtil.getFormatTypeAtIndexBeta=function(e){var t=TcManager.getDoc().getRawFormatAt(e),i=TcManager.getDoc().getCharAt(e);return TcUtil.getFormatType(t,i)},TcUtil.isEqualTCStyles=function(e,t){if(!e.hasOwnProperty(TCConstants.TC)||!t.hasOwnProperty(TCConstants.TC))return!1;var e=DocUtil.copyStyle(e),t=DocUtil.copyStyle(t);return DocUtil.deleteTimeStampInTCStyle(e[TCConstants.TC]),DocUtil.deleteTimeStampInTCStyle(t[TCConstants.TC]),ZWJSONUtils.compareJSON(e,t)},TcUtil.switchToChangesTab=function(){ReviewPane.switchTab("review",!0)},TcUtil.focusRevision=function(){ReviewPane.switchTab("review");var e=editor.doc.getSelection().getStart(),t=TcManager.getIntersectingNodes(e),i=TcManager.getCollection().getAtIndex(t[0]),n=i.getId();if("undefined"!=typeof TcPane){TcPane.highlightRevision(n);var r=TcPane.scrollRevisionIntoView(n);r&&r.then(function(){TrackChangeUI.drawLineToFocus(n)})}ZWLogger.addToStatistics("Tc_RightClick_ReviewChange")},TcUtil.hasTCDeletion=function(e){if(e&&e.hasOwnProperty(TCConstants.TC))for(var t=e[TCConstants.TC],i=0,n=t.length;i<n;i++){var r=t[i];if(r[TCConstants.ACTION]===TCConstants.DELETE)return!0}return!1},TcUtil.getTcDeletionDetails=function(e){var t,i,n;if(e&&e.hasOwnProperty(TCConstants.TC)){var r=e[TCConstants.TC];n="";for(var o=0,a=r.length;o<a;o++){var s=r[o];if(i=s[TCConstants.ZUID],s[TCConstants.ACTION]===TCConstants.DELETE){t=TC_ACTION_DELETE,n=s[TCConstants.TASK]?s[TCConstants.TASK]:"";break}t=TC_ACTION_INSERT,n=s[TCConstants.TASK]?s[TCConstants.TASK]:""}}return{action:t,zuid:i,task:n}},TcUtil.hasTCInsertion=function(e){if(e&&e.hasOwnProperty(TCConstants.TC))for(var t=e[TCConstants.TC],i=0,n=t.length;i<n;i++){var r=t[i];if(r[TCConstants.ACTION]===TCConstants.INSERT)return!0}return!1},TcUtil.hasTCProperty=function(e){var t=editor.doc.getRawFormatAt(e);return t||(t=DocUtil.getTextStyle(e)),!!t.hasOwnProperty(TCConstants.TC)},TcUtil.canCopy=function(e){return!TcUtil.hasTCDeletion(e)},TcUtil.sortTCVals=function(e){var t=e[0],i=e[1];if(i[TCConstants.ACTION]===TCConstants.INSERT&&t[TCConstants.ACTION]===TCConstants.DELETE){var n=e.splice(1,1);e.splice(0,0,n[0])}},TcUtil.isAllWithTCInsertionInPara=function(e,t){for(var i=e;i<t;i++){var n=editor.doc.getRawFormatAt(i);if(n&&!TcUtil.hasTCInsertion(n))return!1}return!0},TcUtil.setUserColor=function(e){var t={};t.color=e;var i=editor.doc.getUserData()[editor.zuid].color;J.ajax({type:"POST",url:ZWNetworkUtils.getUrl("updateusercolor"),data:t,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){if("SUCCESS"===e.RESPONSE){var t=editor.doc.getUserData();t[editor.zuid].color=e.color,t[editor.zuid].light_color=e.lightColor,editor.doc.setUserData(t),UIUtils.showMessage("info",J.i18n("writer.common.USER_COLOR_UPDATED_MSG"),"showclose","normalfont",3e3),PubSub.publish("Document/UsercolorUpdated",editor.zuid)}else setTimeout(function(e){TrackChangeUI.selectColorInColorPopup(e)},1e3,i),UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_UPDATE_USER_COLOR"),"showclose","normalfont",3e3)},error:function(e,t,n){setTimeout(function(e){TrackChangeUI.selectColorInColorPopup(e)},1e3,i),UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_UPDATE_USER_COLOR"),"showclose","normalfont",3e3)}})},TcUtil.setDefaultUserColor=function(e,t){var i={};i.rid=editor.doc.docInfo.RID,i.isdefaultcolor=e,e&&(i.color=t),J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/usercolor"),data:i,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(i){var n=editor.doc.getUserData()[editor.zuid];"SUCCESS"===i.RESPONSE?e?n.default_color=t:delete n.default_color:UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_UPDATE_USER_COLOR"),"showclose","normalfont",3e3),TrackChangeUI.selectColorInColorPopup(n.color)},error:function(e,i,n){TrackChangeUI.selectColorInColorPopup(t),UIUtils.showMessage("error",J.i18n("writer.common.UNABLE_TO_UPDATE_USER_COLOR"),"showclose","normalfont",3e3)}})},TcUtil.acceptAllFromRemoteClient=function(){var e=editor.doc.getTrackChangeDetails();if(!e.canReview())return{RESPONSE:"FAILED",ERROR_CODE:"PERMISSION_DENIED"};try{TCHandler.acceptChanges(TcManager.getCollection().getAllNodes())}catch(e){return{RESPONSE:"FAILED",ERROR_CODE:"CLIENT_ERROR"}}return{RESPONSE:"SUCCESS"}},TcUtil.rejectAllFromRemoteClient=function(){var e=editor.doc.getTrackChangeDetails();if(!e.canReview())return{RESPONSE:"FAILED",ERROR_CODE:"PERMISSION_DENIED"};try{TCHandler.rejectChanges(TcManager.getCollection().getAllNodes())}catch(e){return{RESPONSE:"FAILED",ERROR_CODE:"CLIENT_ERROR"}}return{RESPONSE:"SUCCESS"}},TcUtil.getDisplayMode=function(){var e=editor.doc.getTrackChangeDetails().getDisplayMode(),t="";return t=e===TCConstants.NO_MARKUP_VIEW?"No markup":e===TCConstants.ORIGINAL_VIEW?"Original":"All markup"},TcUtil.getFillableFieldValue=function(e,t){var i=ZWJSONUtils.clone(t),n=TcManager.getDoc().getRawFormatAt(e);if(n&&n.hasOwnProperty(ATTR_FILLABLEFIELD.FF_TYPE)){var r=ZWJSONUtils.clone(n[ATTR_FILLABLEFIELD.FF_INFO]),o=i[ATTR_FILLABLEFIELD.FF_INFO]||{};for(var a in r)r.hasOwnProperty(a)&&o.hasOwnProperty(a)&&(r[a]=o[a]);i[ATTR_FILLABLEFIELD.FF_TYPE]=n[ATTR_FILLABLEFIELD.FF_TYPE],i[ATTR_FILLABLEFIELD.FF_INFO]=r}return Utils.getFillableFieldResult(i)},TcUtil.addOps=function(e,t,i){var n=new DocOp,r=new DocOp;asEndOp=new DocOp,opId=Utils.randomString(),n.changeStyles([],t,opId),r.newCharacters(i),asEndOp.changeStyles(ZWJSONUtils.getKeys(t),[],opId),e.push(n),e.push(r),e.push(asEndOp)},TcUtil.getBlockEnd=function(e,t,i,n){var r=0;switch(t){case NODE_TYPE.TABLE:r=DocUtil.getEnd(e+1,UNICODE.TABLEEND,i)+1;break;case NODE_TYPE.ROW:r=DocUtil.getEnd(e+1,UNICODE.ROW,i);break;case NODE_TYPE.TOC:r=DocUtil.getEnd(e+1,UNICODE.TOCEND,i)+1;break;case NODE_TYPE.AUTOFIELD:case NODE_TYPE.FILLABLEFIELD:case TCConstants.FF_VALUE_UPDATE:case NODE_TYPE.SIGNERFIELD:case NODE_TYPE.MAILMERGEFIELD:case NODE_TYPE.FOOTNOTE:case NODE_TYPE.ENDNOTE:r=DocUtil.getRangeEndFromContent(e,i,n);break;case NODE_TYPE.IMAGE:r=e+1;break;case NODE_TYPE.SECTION:r=DocUtil.getSectionEnd(e,i)}return r},TcUtil.getAutoFieldValue=function(e,t,i){var n="0",r=e.ftype;return r?r===AUTOFIELD_TYPE.AUTO_PAGENUMBER?DocLayoutManager.getPageAtIndex(t).getAbsolutePageNumber():r===AUTOFIELD_TYPE.AUTO_PAGECOUNT?DocLayoutManager.getPageCount():DocTreeManager.getAutoFieldValue(t):e.val?n:editor.doc.getContent().substring(t+1,i-1)},TcUtil.getNoMarkupOPs=function(e,t){var i,n;e=e||"",t=t||[];var r,o,a=DocOpBuilder.build([]),s=[],l=[],d=0,c=0,u=null,g=0,h=null;for(i=1,n=e.length;i<n;i++){var f=t[i];if(f&&u){o=TcUtil.getFormatType(u),r=TcBlockHandler.isBlockNodeType(o)?TcUtil.getBlockEnd(d,o,e,t):i,s.push({start:d,end:r-1});var p=DocOpBuilder.build([]),E=e.substring(d,r);TcUtil.addOps(p,u,E);TcUtil.getTcDeletionDetails(u);if(a.push(new HiddenRangeOp(r-d,E,[TCConstants.TC],p,u,"hidden")),u=null,c=r,r!=i&&r>i){i=r-1;continue}}f&&h&&(l.push({start:g,end:i-1}),h=null,g=i),TcUtil.hasTCDeletion(f)&&(i!==c&&a.skipChars(i-c),u=f,d=i),TcUtil.hasTCInsertion(f)&&(h=f,g=i)}if(u){s.push({start:d,end:i-1});var p=DocOpBuilder.build([]),E=e.substring(d,i);TcUtil.addOps(p,u,E);TcUtil.getTcDeletionDetails(u);a.push(new HiddenRangeOp(i-d,E,[TCConstants.TC],p,u,"hidden"))}return h&&l.push({start:g,end:i-1}),{dsNodesRanges:s,tcRangeOps:a,insNodesRanges:l}},TcUtil.getTcViewDocModel=function(e,t){var i,n=new DocOpBuilder,r={},o=e.content,a=e.styles,s=new Model(e.content,e.styles,e.defaults,e.locks,e.mig_ver,e.ranges);"all"===t?n=TcUtil.getTcDeletionRangeOps(o,a):"none"===t?n=TcUtil.getTcInsertionRangeOps(o,a):"no_markup"===t&&(i=TcUtil.getNoMarkupViewOps(o,a),n=i.dsOps,r=i.hiddenRangeOps),s.init(),s.applyOps(n);var l=s.getDocument();return e.content=l.content,e.styles=l.styles,e.defaults=l.defaults,e.locks=l.locks,e.ranges=l.ranges,s.destroy(),{model:e,noMarkupHiddenOps:r}},TcUtil.getTcDeletionRangeOps=function(e,t){return TcUtil.getNoMarkupViewOps(e,t).dsOps},TcUtil.getTcInsertionRangeOps=function(e,t){var i,n,r,o,a=TcUtil.getNoMarkupOPs(e,t),s=a.insNodesRanges,l=new DocOpBuilder;for(i=0,n=s.length;i<n;i++)o=s[i],r=[],r.push({r:o.start}),r.push({ds:e.substring(o.start,o.end+1)}),l.applyOp(DocOpBuilder.build(r));return l=DocOpBuilder.concise(l)},TcUtil.getNoMarkupViewOps=function(e,t){var i,n,r,o,a,s,l,d,c=TcUtil.getNoMarkupOPs(e,t),u=c.dsNodesRanges,g=c.insNodesRanges,h=new DocOpBuilder,f=new DocOpBuilder;for(i=0,n=g.length;i<n;i++)a=g[i],s=t[a.start],l={},l.type=s.type,d=Utils.randomString(),r=[],r.push({r:a.start}),r.push({as:{start:l,id:d}}),r.push({r:a.end+1-a.start}),r.push({as:{end:ZWJSONUtils.getKeys(l),id:d}}),f.applyOp(DocOpBuilder.build(r));for(i=0,n=u.length;i<n;i++)o=u[i],r=[],r.push({r:o.start}),r.push({ds:e.substring(o.start,o.end+1)}),h.applyOp(DocOpBuilder.build(r));return f=DocOpBuilder.concise(f),h=DocOpBuilder.concise(h),{dsOps:h,insOps:f,hiddenRangeOps:c.tcRangeOps}},TcUtil.quickdiffUtils=function(){var e=function(e){return!!e.tc},t=function(e,t){var e=clone(e),t=clone(t);return e.tc=e.tc||[],t.tc=t.tc||[],DocOpUtil.updateTCStyles(e,t),e.tc.length?{tc:e.tc}:{}},i=function(i,n,r,o,a,s){for(var l=i,d={},c=0;c<l.length;c++){var u=QuickDiff.getComputedFmt(n,o+c),g=QuickDiff.getComputedFmt(r,a+c),h=t(u,g),f=s.takeFormattingFromSource?u:g;if(e(u)||e(g)){var p=l[c];TcUtil.isEqualTCStyles(h,d)?p&&(l[c]=extend(p,h)):(l[c]=extend(f||{},h),d=h)}else ZWJSONUtils.isEmptyObject(d)||(d={},l[c]=f)}return l};return{combineTCInRetains:i}}(),TcUtil.processMsg=function(e){"undefined"!=typeof editor?Op.processMsg(e):TcManager.getDoc().processMsg(e)},TcUtil.toggleTc=function(){var e=editor.doc.getTrackChangeDetails(),t=e.isEnabled(),t=(editor.doc.docInfo,editor.doc.getBodyFormat(),!t);if(e.isOwner()){var i={};i[ATTR_BODY.TC_ISENABLED]=t.toString(),i[ATTR_BODY.TC_ON_BY_ZUID]=editor.zuid,TCHandler.sendTCPropertiesOP(i)}else{var n={};t?n[ATTR_BODY.TC_ON_BY_COLLAB]=editor.zuid:n[ATTR_BODY.TC_OFF_BY_COLLAB]=editor.zuid,TCHandler.sendTCPropertiesOP(n)}};var TcManager=function(e,t,i,n){var r,o=null,a="undefined"!=typeof editor,s=function(){var t=[],n={},r={},o=function(){t=[],r={},a()},a=function(){n[i.INSERT]=0,n[i.DELETE]=0,n[i.REPLACE]=0,n[i.FF_VALUE_UPDATE]=0,n[i.ALL]=0},l=function(e){r[e]={},r[e][i.ALL]=0,r[e][i.INSERT]=0,r[e][i.DELETE]=0,r[e][i.REPLACE]=0,r[e][i.FF_VALUE_UPDATE]=0},d=function(t,n){r.hasOwnProperty(t)||(l(t),e.publish("Document/TC/UserAdded",t)),n==i.INSERT?r[t][i.INSERT]+=1:n==i.DELETE?r[t][i.DELETE]+=1:n===i.REPLACE?r[t][i.REPLACE]+=1:n===i.FF_VALUE_UPDATE&&(r[t][i.FF_VALUE_UPDATE]+=1),r[t][i.ALL]+=1},c=function(t,n){n==i.INSERT?r[t][i.INSERT]-=1:n==i.DELETE?r[t][i.DELETE]-=1:n===i.REPLACE?r[t][i.REPLACE]-=1:n===i.FF_VALUE_UPDATE&&(r[t][i.FF_VALUE_UPDATE]-=1),r[t][i.ALL]-=1,0===r[t][i.ALL]&&(delete r[t],e.publish("Document/TC/UserRemoved",t))},u=function(e,i){var n=t[e-1]||null,r=t[e]||null;i.prev=n,n&&(n.next=i),i.next=r,r&&(r.prev=i),i.fillLinkNodes(t),t.splice(e,0,i),M(i)},g=function(e,t){var i,n,r;for(i=0,n=t.length;i<n;i++)r=t[i],u(e++,r)},h=function(e){u(t.length,e)},f=function(e){var t,i,n,r,o,a,s=e.getId();for(n=0,o=e.getLinkedNodes().length;n<o;n++)for(t=e.getLinkedNodes()[n],i=t.getLinkedNodes(),r=0,a=i.length;r<a;r++)if(i[r].getId()===s){i.splice(r,1);break}},p=function(e){var i=t[e],n=i.prev||null,r=i.next||null;n&&(n.next=r),r&&(r.prev=n),i.prev=null,i.next=null,f(i),t.splice(e,1),F(i)},E=function(e){var i,n;for(i=0;i<t.length;i++)n=t[i],n.getId()===e&&(p(i),i--)},T=function(e){return t[e]},O=function(e){var i,n,r;for(i=0,n=t.length;i<n;i++)if(r=t[i],r.getId()===e)return r;return null},m=function(e){var i,n,r,o=null;for(n=0,r=t.length;n<r&&(o=t[n],i=t[n+1],!i||!(i.getStart()>=e||i.getEnd()>=e));n++);return o&&(o.getStart()>=e||o.getEnd()>=e)&&(o=null),o},I=function(e,t,i){return t<=e.getStart()&&e.getStart()<=i||t<=e.getEnd()&&e.getEnd()<=i||!e.isBlockNode()&&e.getStart()<=t&&i<=e.getEnd()},D=function(e,i){var n,r=[];if(0===t.length)return r;if(n=m(e)||t[0],n&&I(n,e,i)&&!n.isHiddenNode()&&r.push(n),n)for(;n.next&&n.next.getStart()<=i;)n=n.next,I(n,e,i)&&!n.isHiddenNode()&&r.push(n);return r},R=function(e,i){var n=m(e),r=!1;if(n||(n=t[0]),!n)return!1;if(r=I(n,e,i)&&!n.isHiddenNode(),!r)for(;n.next&&n.next.getStart()<=i;)if(n=n.next,I(n,e,i)&&!n.isHiddenNode()){r=!0;break}return r},S=function(e){var i=t[0],n=[];for(i||(i=t[0]);i;){if(i.getStart()<=e&&e<=i.getEnd())n.push(i);else if(i.getStart()>e)break;i=i.next}return n},C=function(){return t},A=function(){return t.length},v=function(e){var i,n,r,o,a=e.getStart(),s=!1;for(E(e.getId()),i=0,n=t.length;i<n;i++)if(r=t[i],o=r.getStart(),a<=o){u(i,e),s=!0;break}s||h(e)},_=function(e){var i,n,r,o=0,a=0;if(t.length>0){for(;o<e.length&&a<t.length;)n=e[o],r=t[a],node1Start=n.getStart(),node2Start=r.getStart(),node1Start===node2Start?(u(a,n),o++,a++):node1Start<node2Start?(u(a,n),o++,a++):a++;if(o!==e.length)for(i=o;i<e.length;i++)h(e[i])}else for(o=0;o<e.length;o++)h(e[o])},P=function(t,n){var r,o;for(o=s.length()-1;o>=0&&(r=s.getAtIndex(o),t<=r.getStart());o--)r.updateIndices(n),r.getAction()===i.REPLACE&&(r.getHeadChildNode().updateIndices(n),r.getTailChildNode().updateIndices(n));e.publish("Document/TC/ModelIndicesUpdated")},N=function(e){var i,n,r;for(i=0,n=t.length;i<n;i++)r=t[i],r.setMode(e)},b=function(){var e,i,n,r=[];for(e=0,i=t.length;e<i;e++)n=t[e],r.push(n.toJson());return r},L=function(){return JSON.stringify(b())},w=function(){var e,t={all:n[i.ALL],ins:n[i.INSERT],del:n[i.DELETE],replace:n[i.REPLACE],ffValueUpdate:n[i.FF_VALUE_UPDATE],authors:{}};for(e in r)r.hasOwnProperty(e)&&(t.authors[e]=r[e]);return t},y=function(e){var i,n,r=-1;for(i=0,n=t.length;i<n;i++)if(t[i].getId()===e.getId()){r=i;break}return r},M=function(t){t.isHiddenNode()||(n[t.getAction()]=n[t.getAction()]+1,action=t.getAction(),participatedUsers=t.getAllParticipatedUsers(),participatedUsers.forEach(function(e){d(e,action)}),n[i.ALL]+=1,e.publish("Document/TC/CountUpdated"))},F=function(t){t.isHiddenNode()||(n[t.getAction()]=n[t.getAction()]-1,participatedUsers=t.getAllParticipatedUsers(),action=t.getAction(),participatedUsers.forEach(function(e){c(e,action)}),n[i.ALL]-=1,e.publish("Document/TC/CountUpdated"))};return{init:o,addAll:g,remove:p,removeNodeById:E,getAtIndex:T,get:O,getAllNodes:C,getNodesAtDocIndex:S,length:A,injectNodes:_,placeNode:v,updateIndices:P,setMode:N,getVisibleNodesCountDetails:w,getNodeIndex:y,getNearestNode:m,isNodeInRange:R,getVisibleNodesInRange:D,increaseNodeActionCount:M,decreaseNodeActionCount:F,toJson:b,toString:L}}(),l=function(e){ae(e);var t;s.init(),t=c(0,e.getDocumentLength()),t.length>0&&(u(t),s.addAll(0,t),w(t[0].getStart(),t[t.length-1].getEnd()+1))},d=function(t){var i,n,r,o;for(i=0,n=t.length;i<n;i++)r=t[i],o=r.getId(),s.removeNodeById(o),e.publish("Document/TC/NodeRemoved",r)},c=function(e,t){var o,a,s,l,d,c,u,g,h,f,p,E,T,O,m,I=[],D=[],R=function(e,t){D.push(t),I.splice(e,1)},S=function(e){var t,i;for(t=0;t<I.length;t++)i=I[t],i.setEnd(e),R(t,i),t--;I=[]},C=function(e,t,i){var n,r;for(n=0;n<e.length;n++)if(r=e[n],r.getAction()===t&&r.getUser()===i)return!0;return!1},A=function(e,t,n){var r,o,a,s;if(e&&e.hasOwnProperty(i.TC))for(a=e[i.TC],r=0,o=a.length;r<o;r++)if(s=a[r],s[i.ACTION]===t&&s[i.ZUID]===n)return!0;return!1};for(s=e;s<t;s++)if(o=r.getRawFormatAt(s),l=n.getFormatTypeAtIndexBeta(s),o&&o.hasOwnProperty(i.TC)){for(d=o[i.TC],c=TcBlockHandler.isBlockNodeType(l),u=0,c&&(u=TcBlockHandler.getBlockEnd(s,l)),a=0;a<I.length;a++)g=I[a],!c&&A(o,g.getAction(),g.getUser())||(g.setEnd(s),R(a,g),a--);for(O=0;O<d.length;O++)h=d[O],f=h[i.ACTION],p=h[i.ZUID],E=h[i.TIME],details=h[i.DETAILS],details&&(details=ZWJSONUtils.clone(details)),m=TcBlockHandler.canAllowNodeCreation(D,s,s+1,f,p),c?m&&(T=TcBlockHandler.createNode(s,u,p,f,E,l,details),D.push(T)):!C(I,f,p)&&m&&(T=TcBlockHandler.createNode(s,u,p,f,E,NODE_TYPE.TEXT,details),I.push(T))}else o&&!o.hasOwnProperty(i.TC)&&S(s);return S(s),D},u=function(e){var t,i,n;for(t=0,n=e.length;t<n-1;t++)for(i=t+1;i<n;i++)e[t].getStart()>e[i].getStart()&&(temp=e[t],e.splice(t,1,e[i]),e.splice(i,1,temp))},g=function(e,t,i){var n=!0;return i?n=e.getAction()===t&&e.getAllParticipatedUsers().indexOf(i)>=0:t&&(n=e.getAction()===t),n},h=function(e,t,n){var r=[];return r=t===i.ALL?null!=n?e.filter(function(e){return e.getAllParticipatedUsers().indexOf(n)>=0}):e:e.filter(function(e){return g(e,t,n)})},f=function(e,t,n){for(var r=e.prev;r;)if(r.isHiddenNode())r=r.prev;else if(t===i.ALL){if(!n||n&&r.getAllParticipatedUsers().indexOf(n)>=0)break;r=r.prev}else{if(g(r,t,n))break;r=r.prev}return r},p=function(e){var t,r=ReviewUtil.getNearestFormat(e);if(r&&r.hasOwnProperty(i.TC)){var o=TcManager.getCollection().getNodesAtDocIndex(e),a=r[i.TC];a.length>1&&n.sortTCVals(a);for(var s,l=a[a.length-1],d=0,c=o.length;d<c;d++)if(s=o[d],s.getStart()<=e&&e<s.getEnd()){if(s.getAction()===i.REPLACE||s.getAction()===i.FF_VALUE_UPDATE){t=s;break}if(!s.isHiddenNode()&&s.getAction()===l.action&&s.getUser()===l.zuid){t=s;break}}}return t},E=function(e){for(var t=s.getAllNodes()[0],i=[];t;){if(t.getStart()<e&&e<t.getEnd())i.push(t);else if(e<t.getStart())break;t=t.next}return i},T=function(e,t,i){return t<=e.getStart()&&e.getEnd()<=i},O=function(e,t,i){return e.getStart()<t&&i<e.getEnd()},m=function(e,t,i){return t<=e.getStart()&&e.getStart()<i&&e.getEnd()>i},I=function(e,t,i){return t<e.getEnd()&&e.getEnd()<=i&&e.getStart()<t},D=function(e,t){var i,n,r=[],o=s.length();for(t=t?t:e,i=0;i<o;i++)if(n=s.getAtIndex(i),n.getStart()<=e&&e<=n.getEnd()||n.getStart()<=t&&t<=n.getEnd()||e<=n.getStart()&&n.getEnd()<=t)r.push(i);else if(n.getStart()>e)break;return r},R=function(e,t){for(var i=[],n=[],r=[],o=[],a=s.getAllNodes()[0];a;){if(T(a,e,t))r.push(a);else if(O(a,e,t))o.push(a);else if(m(a,e,t))i.push(a);else if(I(a,e,t))n.push(a);else if(e<a.getStart()&&t<a.getStart())break;a=a.next}return{startOnlyIncludedNodes:i,endOnlyIncludedNodes:n,fullyIncludedNodes:r,fullyExcludedNodes:o}},S=function(t,n,r){var o,a,l=(t.getStart(),t.getEnd()),c=!1,u=!1,g=!1;t.getAction()===i.REPLACE?(o=t.getHeadChildNode(),a=t.getTailChildNode(),T(o,n,r)?u=!0:O(o,n,r)?(C(t.getStart(),n,o.getAction(),o.getUser(),o.getTime(),o.getType(),o.getDetails()),t.setStart(r),o.setStart(r),c=!0):m(o,n,r)?(t.setStart(r),o.setStart(r),c=!0):I(o,n,r)&&(C(t.getStart(),n,o.getAction(),o.getUser(),o.getTime(),o.getType(),o.getDetails()),u=!0),T(a,n,r)?g=!0:O(a,n,r)?(C(r,t.getEnd(),a.getAction(),a.getUser(),a.getTime(),a.getType(),a.getDetails()),t.setEnd(n),a.setEnd(n),c=!0):m(a,n,r)?(C(r,t.getEnd(),a.getAction(),a.getUser(),a.getTime(),a.getType(),a.getDetails()),g=!0):I(a,n,r)&&(t.setEnd(n),a.setEnd(n),c=!0),a.getStart()===n&&a.getStart()===r&&(s.decreaseNodeActionCount(t),t.setEnd(o.getEnd()),t.setAction(o.getAction()),t.setTime(o.getTime()),t.setHeadChildNode(null),t.setTailChildNode(null),c=!0,s.increaseNodeActionCount(t),C(a.getStart(),a.getEnd(),a.getAction(),a.getUser(),a.getTime(),a.getType(),a.getDetails())),u&&g?d([t]):u?(s.decreaseNodeActionCount(t),t.setStart(a.getStart()),t.setAction(a.getAction()),t.setTime(a.getTime()),t.setHeadChildNode(null),t.setTailChildNode(null),s.increaseNodeActionCount(t),c=!0):g&&(s.decreaseNodeActionCount(t),t.setEnd(o.getEnd()),t.setAction(o.getAction()),t.setTime(o.getTime()),t.setHeadChildNode(null),t.setTailChildNode(null),c=!0,s.increaseNodeActionCount(t))):T(t,n,r)?d([t]):O(t,n,r)?(v(t,n),r<l&&C(r,l,t.getAction(),t.getUser(),t.getTime(),t.getType(),t.getDetails()),c=!0):m(t,n,r)?(A(t,r),c=!0):I(t,n,r)&&(v(t,n),c=!0),c&&(t.setMode(i.UPDATE_MODE),e.publish("Document/TC/NodeUpdated",t))},C=function(t,i,n,r,o,a,l,d,c){var u,g=TcBlockHandler.isBlockNodeType(a),h=0;l&&(l=ZWJSONUtils.clone(l)),g?(h=TcBlockHandler.getBlockEnd(t,a),u=TcBlockHandler.createNode(t,h,r,n,o,a,l,d,c)):u=TcBlockHandler.createNode(t,i,r,n,o,NODE_TYPE.TEXT,l,d,c),s.injectNodes([u]),e.publish("Document/TC/NodeCreated",u)},A=function(t,n){t.isBlockNode()?(t.setStart(n),t.setEnd(TcBlockHandler.getBlockEnd(n,t.getType()))):t.getAction()===i.REPLACE?(t.setStart(n),t.getHeadChildNode().getEnd()<=n?(s.decreaseNodeActionCount(t),t.setAction(t.getTailChildNode().getAction()),t.setTime(t.getTailChildNode().getTime()),t.setHeadChildNode(null),t.setTailChildNode(null),s.increaseNodeActionCount(t)):t.getHeadChildNode().setStart(n)):t.setStart(n),TcManager.getCollection().placeNode(t),t.setMode(i.UPDATE_MODE),e.publish("Document/TC/NodeUpdated",t)},v=function(t,n){t.isBlockNode()?t.setEnd(TcBlockHandler.getBlockEnd(t.getStart(),t.getType())):t.getAction()===i.REPLACE?(t.setEnd(n),n<=t.getTailChildNode().getStart()?(s.decreaseNodeActionCount(t),t.setAction(t.getHeadChildNode().getAction()),t.setTime(t.getHeadChildNode().getTime()),t.setHeadChildNode(null),t.setTailChildNode(null),s.increaseNodeActionCount(t)):t.getTailChildNode().setEnd(n)):t.setEnd(n),t.setMode(i.UPDATE_MODE),e.publish("Document/TC/NodeUpdated",t)},_=function(e,t){var n,r=e.getTime()>t.getTime()?e.getTime():t.getTime(),o=e.clone(),a=t.clone();return e.getMode()===i.UPDATE_MODE?(v(e,t.getEnd()),s.decreaseNodeActionCount(e),e.setAction(i.REPLACE),e.setHeadChildNode(o),e.setTailChildNode(a),e.setTime(r),s.increaseNodeActionCount(e),d([t]),n=e):(A(t,e.getStart()),s.decreaseNodeActionCount(t),t.setAction(i.REPLACE),t.setHeadChildNode(o),t.setTailChildNode(a),t.setTime(r),s.increaseNodeActionCount(t),d([e]),n=t),n},P=function(e,t){return!(!e.isTextNode()||!t.isTextNode()||e.getAction()!==t.getAction()||e.getUser()!==t.getUser()||e.getEnd()!==t.getStart()||e.isBlockNode()||t.isBlockNode())},N=function(e,t){return!(!e.isTextNode()||!t.isTextNode()||e.getUser()!==t.getUser()||e.getEnd()!==t.getStart()||e.isBlockNode()||t.isBlockNode()||!(e.getAction()===i.DELETE&&t.getAction()===i.INSERT||e.getAction()===i.INSERT&&t.getAction()===i.DELETE))},b=function(e,t){var n,r,o,a,s,l=!1;return e.getAction()===i.REPLACE&&t.getAction()!==i.REPLACE?(o=e.getTailChildNode(),P(o,t)&&(v(e,t.getEnd()),d([t]),l=!0,n=e)):e.getAction()!==i.REPLACE&&t.getAction()===i.REPLACE?(r=t.getHeadChildNode(),P(e,r)?(A(t,e.getStart()),d([e]),l=!0,n=t):N(e,r)&&(S(t,r.getEnd(),r.getEnd()),n=_(e,t),l=!0)):e.getAction()!==i.REPLACE&&t.getAction()!==i.REPLACE?N(e,t)?(n=_(e,t),l=!0):P(e,t)&&(e.getMode()===i.UPDATE_MODE?(v(e,t.getEnd()),d([t]),n=e):(A(t,e.getStart()),d([e]),n=t),l=!0):e.getAction()===i.REPLACE&&t.getAction()===i.REPLACE&&(a=e.getTailChildNode(),s=t.getHeadChildNode(),P(a,s)&&(S(t,s.getEnd(),s.getEnd()),v(e,t.getEnd()),d([t]),l=!0,n=e)),n},L=function(e,t){var i,n;if(t||(t=e.next),t)if(i=b(e,t)){if(n=i.next,!n)return;L(i,n)}else if(e.getEnd()<t.getStart()){if(e=e.next,t=e?e.next:null,!e||!t)return;L(e,t)}else{if(n=t.next,!n)return;L(e,n)}},w=function(e){var t,i;s.length()&&(t=s.getNearestNode(e),t||(t=s.getAllNodes()[0]),i=t.next,i&&L(t,i))},y=function(e,t,i,n){return TcBlockHandler.canAllowNodeCreation(s.getAllNodes(),e,t,i,n)},M=function(e,r,o){var a,l,d,c,u=r-e,g=E(e),h=0,f=0;for(g.length>0&&(h=g[0].getStart(),f=g[g.length-1].getStart()),h=h>e?e:h,f=f<r?r:f,d=0;d<g.length;d++)node=g[d],node.isBlockNode()?v(node):S(node,e,e);if(0!=u&&s.updateIndices(e,u),l=n.getFormatTypeAtIndex(e),o||(o=t.getTextStyle(e),ch=editor.doc.getCharAt(e),l=n.getFormatType(o,ch)),o.hasOwnProperty(i.TC))for(tcValsArr=o[i.TC],c=0;c<tcValsArr.length;c++)tcDetails=tcValsArr[c],user=tcDetails[i.ZUID],time=tcDetails[i.TIME],action=tcDetails[i.ACTION],a=tcDetails[i.DETAILS],y(e,r,action,user)&&C(e,r,action,user,time,l,a);w(h,f)},F=function(e,t){var i,n,r,o,a=e-t,l=0,c=0;if(o=R(e,t)){for(fullyIncludedNodes=o.fullyIncludedNodes,r=[],i=0;i<fullyIncludedNodes.length;i++)n=fullyIncludedNodes[i],r.push(n),l=l>n.getStart()?n.getStart():l,c=c<n.getEnd()?n.getEnd():c;for(d(r),fullyExcludedNodes=o.fullyExcludedNodes,i=0;i<fullyExcludedNodes.length;i++)n=fullyExcludedNodes[i],n.isBlockNode()?v(n):S(n,e,t),l=l>n.getStart()?n.getStart():l,c=c<n.getEnd()?n.getEnd():c;for(startOnlyIncludedNodes=o.startOnlyIncludedNodes,i=0;i<startOnlyIncludedNodes.length;i++)n=startOnlyIncludedNodes[i],n.isBlockNode()?v(n):S(n,e,t),l=l>n.getStart()?n.getStart():l,c=c<n.getEnd()?n.getEnd():c;for(endOnlyIncludedNodes=o.endOnlyIncludedNodes,i=0;i<endOnlyIncludedNodes.length;i++)n=endOnlyIncludedNodes[i],n.isBlockNode()?v(n):S(n,e,t),l=l>n.getStart()?n.getStart():l,c=c<n.getEnd()?n.getEnd():c}0!=a&&s.updateIndices(t,a),w(e-1,c)},U=function(e,r,o){var a,s,l,c,u,g,h=0,f=0;if(h=h>e?e:h,f=f<r?r:f,u=R(e,r)){for(fullyIncludedNodes=u.fullyIncludedNodes,c=[],a=0;a<fullyIncludedNodes.length;a++)s=fullyIncludedNodes[a],c.push(s),h=h>s.getStart()?s.getStart():h,f=f<s.getEnd()?s.getEnd():f;for(d(c),fullyExcludedNodes=u.fullyExcludedNodes,a=0;a<fullyExcludedNodes.length;a++)s=fullyExcludedNodes[a],s.isBlockNode()||S(s,e,r),h=h>s.getStart()?s.getStart():h,f=f<s.getEnd()?s.getEnd():f;for(startOnlyIncludedNodes=u.startOnlyIncludedNodes,a=0;a<startOnlyIncludedNodes.length;a++)s=startOnlyIncludedNodes[a],s.isBlockNode()?c.push(s):A(s,r),h=h>s.getStart()?s.getStart():h,f=f<s.getEnd()?s.getEnd():f;for(d(c),endOnlyIncludedNodes=u.endOnlyIncludedNodes,a=0;a<endOnlyIncludedNodes.length;a++)s=endOnlyIncludedNodes[a],s.isBlockNode()||v(s,e),h=h>s.getStart()?s.getStart():h,f=f<s.getEnd()?s.getEnd():f}if(g=n.getFormatTypeAtIndex(e),o||(o=t.getTextStyle(e),ch=editor.doc.getCharAt(e),g=n.getFormatType(o,ch)),o.hasOwnProperty(i.TC))for(tcValsArr=o[i.TC],tcValsIndex=0;tcValsIndex<tcValsArr.length;tcValsIndex++)tcDetails=tcValsArr[tcValsIndex],user=tcDetails[i.ZUID],time=tcDetails[i.TIME],action=tcDetails[i.ACTION],l=tcDetails[i.DETAILS],y(e,r,action,user)&&C(e,r,action,user,time,g,l);w(h,f)},V=function(){var t,n,r,a,s,l,d;if(o){e.publish("Document/TC/ModelUpdationStarted"),t=o.type,n=o.from,r=o.to,t===i.INSERT?fn=M:t===i.DELETE?fn=F:t===i.UPDATE&&(fn=U);try{if(t===i.DELETE)fn(n,r);else{for(s=n,l=editor.doc.getRawFormatAt(s),d=n+1;d<r;d++)a=editor.doc.getRawFormatAt(d),a&&(fn(s,d,l),l=a,s=d);fn(s,d,l)}}catch(e){}o=null,e.publish("Document/TC/ModelUpdated")}},B=function(e,t){var n;editor.getView()===EDITOR_VIEWS.HISTORY||editor.isVersionView()||(n=!0,o&&(o.type==i.INSERT&&o.to==e?(o.to=t,n=!1):V()),n&&(o={type:i.INSERT,from:e,to:t}))},x=function(e,t,n){var r;editor.getView()===EDITOR_VIEWS.HISTORY||editor.isVersionView()||(r=!0,o&&(o.type==i.DELETE&&o.to==e+(o.to-o.from)?(o.to+=t-e,r=!1):V()),r&&(o={type:i.DELETE,from:e,to:t}))},W=function(e,t){var n;editor.getView()===EDITOR_VIEWS.HISTORY||editor.isVersionView()||(n=!0,o&&(o.type==i.INSERT?o.from<=e&&o.to==t?n=!1:V():o.type==i.DELETE?V():o.type==i.UPDATE&&(o.to==e?(o.to=t,n=!1):o.from==e&&o.to==t?n=!1:V())),n&&(o={type:i.UPDATE,from:e,to:t}))},H=function(){return s},G=function(){var e=s.getVisibleNodesCountDetails();return!(e.all>0)},k=function(e,t){var i=TcManager.getDoc().createRange();return i.start=e,i.end=t,i.getNodes()||[]},Y=function(e,t){var i,n,r,o,a,s=k(e,t);for(i=0,n=s.length;i<n;i++)r=s[i],r[ATTR_COMMON.TYPE]===NODE_TYPE.FIELD_START&&(o=r.getField(),o&&(o.type===NODE_TYPE.FOOTNOTE||o.type===NODE_TYPE.ENDNOTE)&&o[ATTR_COMMON.ID]&&(a=Z(o[ATTR_COMMON.ID]),a&&(s=s.concat(k(a.start,a.end))))),r[ATTR_COMMON.TYPE]!==NODE_TYPE.FIELD_START&&r[ATTR_COMMON.TYPE]!==NODE_TYPE.FIELD_END||(o=r.getField(),o&&o.type===NODE_TYPE.LINK&&(s.splice(i--,1),n--));return s},Z=function(e){for(var t,i=TcManager.getDoc().getAllSections(),n=0,r=i.length;n<r;n++)if(t=i[n],t.getSID()===e)return t},z=function(e,t){var n,r=[],o=[];return t.forEach(function(t){n=t.getAction(),n===e?r.push(t):n===i.REPLACE&&t.getHeadChildNode()&&t.getTailChildNode()?t.getHeadChildNode().getAction()===e?(r.push(t.getHeadChildNode()),o.push(t.getTailChildNode())):(r.push(t.getTailChildNode()),o.push(t.getHeadChildNode())):o.push(t)}),{filteredNodes:r,otherNodes:o}},J=function(e){var t,i,n,r;if(!e||!e.length)return e;for(t=1,i=e.length;t<i;t++)r=e[t],n=e[t-1],n.getStart()>r.getStart()&&(e[t]=n,e[t-1]=r,t--);return e},j=function(e){var t,i,n,r,o=e.length;for(t=0;t<o;t++)for(n=e[t],i=t+1;i<o;i++)if(r=e[i],n.getStart()<r.getStart()&&r.getEnd()<n.getEnd())e.splice(i,1),i--,o--;else if(r.getStart()<n.getStart()&&n.getEnd()<r.getEnd()){e.splice(t,1),t--,o--;break}},X=function(e){var t,n,r,o,s,l=z(i.INSERT,e);for(a&&(editor.lastOperation="tc-accept-all",ZWLogger.log("Going to accept the below nodes")),o=J(l.filteredNodes)||[],s=J(l.otherNodes)||[],j(s),t=0,n=o.length;t<n;t++)r=o[t],r.isHiddenNode()||(a&&ZWLogger.log("TC Node: "+r.toString()),r.accept());for(t=s.length-1;t>=0;t--)r=s[t],r.isHiddenNode()||(a&&ZWLogger.log("TC Node: "+r.toString()),r.accept())},K=function(e){var t,n,r,o,s,l=z(i.DELETE,e);for(a&&(editor.lastOperation="tc-reject-all",ZWLogger.log("Going to reject the below nodes")),o=J(l.filteredNodes)||[],s=J(l.otherNodes)||[],j(s),t=0,n=o.length;t<n;t++)r=o[t],r.isHiddenNode()||(a&&ZWLogger.log("TC Node: "+r.toString()),r.reject());for(t=s.length-1;t>=0;t--)r=s[t],r.isHiddenNode()||(a&&ZWLogger.log("TC Node: "+r.toString()),r.reject())},Q=function(e){var t=editor.doc.getTrackChangeDetails();t.setProcessingTC(!1),X(e),TcManager.getDoc().sync(),t.setProcessingTC(!0)},q=function(e){var t=editor.doc.getTrackChangeDetails();t.setProcessingTC(!1),K(e),TcManager.getDoc().sync(),t.setProcessingTC(!0)},$=function(e,t){t=t||[];var n=editor.doc.getTrackChangeDetails();n.setProcessingTC(!1),editor.lastOperation="tc-accept",ZWLogger.log("Going to accept TC Node: "+e.toString());var r=z(i.INSERT,[e]);r.filteredNodes.forEach(function(e){e.accept.apply(e,t)}),r.otherNodes.forEach(function(e){e.accept.apply(e,t)}),TcManager.getDoc().sync(),n.setProcessingTC(!0),EditorUtil.focusMultiByteSpan()},ee=function(e,t){t=t||[];var n=editor.doc.getTrackChangeDetails();n.setProcessingTC(!1),editor.lastOperation="tc-reject",ZWLogger.log("Going to reject TC Node: "+e.toString());var r=z(i.DELETE,[e]);r.filteredNodes.forEach(function(e){e.reject.apply(e,t)}),r.otherNodes.forEach(function(e){e.reject.apply(e,t)}),TcManager.getDoc().sync(),n.setProcessingTC(!0),EditorUtil.focusMultiByteSpan()},te=function(e,t,i){return TcBlockHandler.createNode(e,t,i.getUser(),i.getAction(),i.getTime(),i.getType())},ie=function(e,t){var n,r,o,a=TcManager.getCollection().getVisibleNodesInRange(e,t-1),s=[],l=TcManager.getDoc().createRange();for(n=0,r=a.length;n<r;n++)o=a[n],o.getAction()===i.REPLACE&&(r++,a.splice(n+1,0,o.getTailChildNode()),o=o.getHeadChildNode()),T(o,e,t)?s.push(o):O(o,e,t)&&!o.isBlockNode()?(l.start=e,l.end=t,l.splitText(),s.push(te(e,t,o))):m(o,e,t)&&!o.isBlockNode()?(l.start=l.end=t,l.splitText(),s.push(te(o.getStart(),t,o))):I(o,e,t)&&!o.isBlockNode()&&(l.start=l.end=e,l.splitText(),s.push(te(e,o.getEnd(),o)));return s},ne=function(){var e=editor.doc.getSelection(),t=e.getStart(),i=e.getEnd();try{var n=ie(t,i);Q(n)}catch(e){var r="Exception while acceptall in selection, start: "+t+", end: "+i+" \n"+(e.stack||e);ReviewUtil.sendErrorMail(ZWCollaboration.TC_REVIEW_IN_SELECTION_ERROR,r)}},re=function(){var e=editor.doc.getSelection(),t=e.getStart(),i=e.getEnd();try{var n=ie(t,i);q(n)}catch(e){var r="Exception while rejectall in selection, start: "+t+", end: "+i+" \n"+(e.stack||e);ReviewUtil.sendErrorMail(ZWCollaboration.TC_REVIEW_IN_SELECTION_ERROR,r)}},oe=function(){return r},ae=function(e){r=e},se=function(){var e=s.getVisibleNodesCountDetails();return e.all>0||!("undefined"==typeof TcNoMarkupHandler||!TcNoMarkupHandler.hasTcHiddenRange())},le=function(){e.subscribe("Document/ContentAdded",B),e.subscribe("Document/ContentDeleted",x),e.subscribe("Document/StyleChanged",W)},de=function(){e.unsubscribe("Document/ContentAdded",B),e.unsubscribe("Document/ContentDeleted",x),e.unsubscribe("Document/StyleChanged",W)},ce=function(){e.subscribe(DOCUMENT.DOCTREE_INITIALIZED,le),e.subscribe(DOCUMENT.DOCTREE_DESTROYED,de)};return e.subscribe("User/OrgIdentified",ce),{init:l,getCollection:H,addToTree:B,deleteFromTree:x,updateTree:W,applyChanges:V,isEmpty:G,docHasTrackedChanges:se,getIntersectingNodes:D,getDoc:oe,accept:$,reject:ee,getRangeSdkNodes:k,getBlockSdkNodes:Y,acceptAllInSelection:ne,rejectAllInSelection:re,acceptAllClientApi:X,rejectAllClientApi:K,acceptChanges:Q,rejectChanges:q,filterNodes:h,getFilteredPrevNode:f,getNodeAtIndex:p}}(PubSub,DocUtil,TCConstants,TcUtil);TCAdaptor=function(){var e=!1,t=function(){editor.getRole().permissions.can("document.edit")&&!isV8Engine&&zw.require({js:[jsCdnZWStaticPath+fingerPrintObj["js/writer_tc_min_all.js"]]},[],function(){TrackChangeUI.init(),TCPopup.init(),ReviewPane.isReviewPanelLoaded()?TcPane.init():PubSub.subscribe("Document/ReviewRightPanel/Loaded",TcPane.init),e=!0,PubSub.publish("Module/TC/Loaded")})},i=function(e,t){if(!t||t.fromui)return TcUtil.toggleTc(),!1},n=function(){e&&TrackChangeUI.drawTCStatus(!0)},r=function(){var e=editor.doc.getTrackChangeDetails(),t=!e.isEnabled(),i=e.isOwner()?ActionJSON.getActionInfo("ToggleTcToAll"):ActionJSON.getActionInfo("ToggleTc"),n=null;return i&&i.activity_data&&(n=t?i.activity_data.on:i.activity_data.off),n},o=function(e,t){i(e,t),ActivityTracker.trackInAnalytics("Tc",r(),"FeatureFinder")},a=function(){return e};return PubSub.subscribe("Document/ComponentInitialized",t),{toggleState:i,toggleStateFromFeatureFinder:o,drawLeftPanelTcStatus:n,isLoaded:a}}();var ZWFieldParser=function(){"use strict";function e(e){this.value=e?"string"==typeof e?e:JSON.stringify(e):""}var t=new RegExp("[a-zA-Z][a-zA-Z]?[0-9]+","gm"),i=new RegExp("[0-9]+[a-zA-z]+","gm"),n=new RegExp("[^0-9]","gm"),r=new RegExp("[+*=&:)(%<>|!\\[\\]/-]","gm"),o=new RegExp("(SUM|ABS|AND|AVERAGE|COUNT|INT|MAX|MIN|MOD|NOT|OR|PRODUCT|ROUND|SIGN|IF|SUMPRODUCT)","gm"),a=new RegExp("(RIGHT|LEFT|ABOVE|BELOW)","gm"),s=new RegExp("[)(]","gm"),l=new RegExp("[+*=&,:%<>|!/-]+"),d=new RegExp("[A-Z]+","gm"),c=new RegExp("[0-9]+","gm"),u=new RegExp("[^a-zA-Z0-9\\s]","gm"),g=[[FIELD_PARENTHESIS.MERGEFIELD_START,FIELD_PARENTHESIS.MERGEFIELD_END],[FIELD_PARENTHESIS.FILLABLE_START,FIELD_PARENTHESIS.FILLABLE_END],[FIELD_PARENTHESIS.TABLE_REF_START_REGEX,FIELD_PARENTHESIS.TABLE_REF_END_REGEX]],h=function(e){var t=[];e=e.replaceAll(o,""),e=e.replaceAll(a,"");for(var i=0,n=0,r=e[n],s=!1,l=[];e[n];){switch(r=e[n]){case"(":l.push("("),s=!0;break;case")":l.pop(),0==l.length&&(s=!1);break;case",":s||(t.push(e.substring(i,n)),i=n+1)}n+=1}return t.push(e.substring(i)),t},f=function(e,t,i){var n,r={isValid:!0},o=[],a=0,s=0;for(a=Utils.findNextIndexOf(t,a,e),s=Utils.findNextIndexOf(i,a+1,e);a>-1||s>-1;){if(n=Utils.findNextIndexOf(t,a+1,e),s==-1||a==-1||n!=-1&&n<s)return r.isValid=!1,r.message=J.i18n("writer.formula.error.NOT_ENCLOSED_CORRECTLY"),r;o.push(e.substring(a,s+1)),a=n,s=Utils.findNextIndexOf(i,s+1,e)}return r.fields=o,r},p=function(e){for(var t,n,r,o,a,s,l,u,g,h={isValid:!0},f=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_START_REGEX,0,e),p=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_END_REGEX,f,e),E={};f!=-1&&p!=-1;){var T=e.substring(f+1,p),O=TableUtil.getTableInfo(T);r=O.name;var m=O.cellName.toUpperCase();if(t=TableCollectionInstance.getTableIdFromName(r),!t)return h.isValid=!1,h.message=J.i18n("writer.formula.error.TABLE_NAME_NOT_PRESENT"),h;if(E[r]||(E[r]=DocTreeManager.getTableById(t)),n=E[r],d.lastIndex=0,c.lastIndex=0,i.lastIndex=0,m.match(i))return h.isValid=!1,h.message=J.i18n("writer.formula.error.REFER_A_TABLE_CELL_IN_MENTIONED_TABLE",[r]),h;if(o=m.match(c),a=m.match(d),!o||!a)return h.isValid=!1,h.message=J.i18n("writer.formula.error.REFER_A_TABLE_CELL_IN_MENTIONED_TABLE",[r]),h;if(s=parseInt(o[0]),l=Formula.getColNum(a[0]),u=n.children.length,g=n.cols.length,Formula.getColNum(a)>g)return h.isValid=!1,h.message=J.i18n("writer.formula.error.COLUMN_NUMBER_NOT_PRESENT_IN_MENTIONED_TABLE",[a[0],r]),h;if(s>u)return h.isValid=!1,h.message=J.i18n("writer.formula.error.ROW_NUMBER_NOT_PRESENT_IN_MENTIONED_TABLE",[s,r]),h;if(0==s)return h.isValid=!1,h.message=J.i18n("writer.formula.error.INVALID_ROW_NUMBER_IN_MENTIONED_TABLE",[r]),h;f=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_START_REGEX,f+1,e),p=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_END_REGEX,f,e)}return h},E=function(e){var t=[];s.lastIndex=0;for(var i={isValid:!0},n=s.exec(e);n;){if(e[n.index]==FIELD_PARENTHESIS.OPEN_PARENTHESIS)t.push(FIELD_PARENTHESIS.OPEN_PARENTHESIS);else{if(!(t.length>0))return i.isValid=!1,i.message=J.i18n("writer.formula.error.EXTRA_CLOSED_PARENTHESIS_FOUND"),i;t.pop()}n=s.exec(e)}return 0!=t.length?(i.isValid=!1,i.message=J.i18n("writer.formula.error.EXTRA_OPEN_PARENTHESIS_FOUND"),i):i},T=function(e,i){for(var n={isValid:!0},r=i.children.length,o=i.cols.length,a=t.exec(e);a;){var s=a[0],l=s.match(RegExp("[A-Z]+","gm"))[0],d=s.match(RegExp("[0-9]+","gm"))[0];if(Formula.getColNum(l)>o)return n.isValid=!1,n.message=J.i18n("writer.formula.error.COLUMN_NUMBER_NOT_PRESENT"),n;if(d>r)return n.isValid=!1,n.message=J.i18n("writer.formula.error.ROW_NUMBER_NOT_PRESENT"),n;if(0==d)return n.isValid=!1,n.message=J.i18n("writer.formula.error.INVALID_ROW_NUMBER"),n;a=t.exec(e)}return n},O=function(e){for(var i={isValid:!0},n="SUMPRODUCT",r=e.indexOf(n);r>-1;){var s,l,u,g,h=r+n.length,f=0,p=0,E=0;for(g=Utils.findNextIndexOf(FIELD_PARENTHESIS.OPEN_PARENTHESIS_REGEX,r+n.length+2,e),h=Utils.findNextIndexOf(FIELD_PARENTHESIS.CLOSE_PARENTHESIS_REGEX,r+1,e);g>-1&&g<h;)g=Utils.findNextIndexOf(FIELD_PARENTHESIS.OPEN_PARENTHESIS_REGEX,g+1,e),h=Utils.findNextIndexOf(FIELD_PARENTHESIS.CLOSE_PARENTHESIS_REGEX,h+1,e);var T=e.substring(r+n.length+1,h);if(o.lastIndex=0,a.lastIndex=0,o.exec(T)||a.exec(T)||fieldsArr.length>0&&T.indexOf(fieldsArr)>-1)return i.isValid=!1,i.message=J.i18n("writer.formula.error.SYNTAX_ERROR_SUMPRODUCT"),i;T=T.split(",");for(var O,m,I=0,D=T.length;I<D;I++){if(s=T[I].split(":"),E=s.length,!s[0].match(t)||!s[E-1].match(t))return i.isValid=!1,i.message=J.i18n("writer.formula.error.SYNTAX_ERROR_SUMPRODUCT"),i;if(d.lastIndex=0,c.lastIndex=0,l=Formula.getColNum(d.exec(s[0])[0]),d.lastIndex=0,u=Formula.getColNum(d.exec(s[E-1])[0]),O=parseInt(c.exec(s[0])[0]),c.lastIndex=0,m=parseInt(c.exec(s[E-1])[0]),0==I)f=Formula.getDiff(O,m,l,u);else if(p=Formula.getDiff(O,m,l,u),f!=p)return i.isValid=!1,i.message=J.i18n("writer.formula.error.SYNTAX_ERROR_SUMPRODUCT"),i}e=e.replace(e.substring(r,h+1),""),r=e.indexOf(n)}return i},m=function(e){for(var r,o,a,d={isValid:!0},c="",u=e.lastIndexOf("IF");u!=-1;){c=e.substring(u);var g="",f=[];for(r=[],s.lastIndex=0,o=s.exec(c);o;){if(a=o.index,c[a]==FIELD_PARENTHESIS.OPEN_PARENTHESIS)r.push(FIELD_PARENTHESIS.OPEN_PARENTHESIS);else if(r.length>0&&(r.pop(),0==r.length))break;o=s.exec(c)}if(r.length>0)return d.isValid=!1,d.message=J.i18n("writer.formula.error.CONDITION_NOT_CONFIGURED_PROPERLY"),d;if(g=e.substring(u,u+a+1),f=h(g.substring(3,g.length-1)),f.length>3)return d.isValid=!1,d.message=J.i18n("writer.formula.error.EXTRA_ARGUMENT_FOUND"),d;if(f.length<3)return d.isValid=!1,d.message=J.i18n("writer.formula.error.LESS_ARGUMENT_FOUND"),d;for(var p,E,T=0;T<3;T++){p=f[T],p=p.replaceAll(s,""),E=p.split(l);for(var O=0,m=E.length;O<m;O++){var I=E[O],D=I.match(t),R=I.match(n),S=I.match(i);if(D&&D[0].length!=I.length||R&&R.length==I.length||S)return d.isValid=!1,d.message=J.i18n("writer.formula.error.STRING_FOUND"),d}}e=e.replace(g,""),u=e.lastIndexOf("IF")}return d.tempFormula=e,d},I=function(e,t){for(var i,n=0;n<t.length;n++)if(i=t[n],i.indexOf(FIELD_PARENTHESIS.TABLE_REF_START)>-1&&i.indexOf(FIELD_PARENTHESIS.TABLE_REF_END)>-1){var r=e.indexOf(i);e=e.substring(0,r)+e.substring(r+i.length)}else e=e.replaceAll(t[n],"");return e};return e.prototype.isFillableField=function(){return this.value.indexOf(FIELD_PARENTHESIS.FILLABLE_START)!=-1&&this.value.indexOf(FIELD_PARENTHESIS.FILLABLE_END)!=-1},e.prototype.isMergeField=function(){return this.value.indexOf(FIELD_PARENTHESIS.MERGEFIELD_START)!=-1&&this.value.indexOf(FIELD_PARENTHESIS.MERGEFIELD_END)!=-1},e.prototype.isTableReferenceField=function(){return this.value.indexOf(FIELD_PARENTHESIS.TABLE_REF_START)!=-1&&this.value.indexOf(FIELD_PARENTHESIS.TABLE_REF_END)!=-1},e.prototype.getAllTableNamesInFormula=function(e){for(var t=this.value,i=[],n=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_START_REGEX,0,t),r=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_END_REGEX,n,t);n!=-1&&r!=-1;){var o=t.substring(n+1,r),a=TableUtil.getTableInfo(o),s=a.name;e?i.push(s):i.contains(s)||i.push(s),n=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_START_REGEX,n+1,t),r=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_END_REGEX,n,t)}return i},e.prototype.getFieldInfosForFillable=function(){for(var e=this.value,t=Utils.findNextIndexOf(FIELD_PARENTHESIS.FILLABLE_START,0,e),i=Utils.findNextIndexOf(FIELD_PARENTHESIS.FILLABLE_END,t,e),n={};t!=-1&&i!=-1;){var r=e.substring(t+1,i),o=editor.getDocument().getFieldsByName(r);o&&(n.fieldName={id:o.id,type:o.getFillableFieldType()}),t=Utils.findNextIndexOf(FIELD_PARENTHESIS.FILLABLE_START,t+1,e),i=Utils.findNextIndexOf(FIELD_PARENTHESIS.FILLABLE_END,t,e)}return n},e.prototype.replaceFillableFieldsInFormula=function(){var e=this.value,t=0,i=0;t=Utils.findNextIndexOf(FIELD_PARENTHESIS.FILLABLE_START,t,e),i=Utils.findNextIndexOf(FIELD_PARENTHESIS.FILLABLE_END,t+1,e);for(var n=editor.getDocument(),r="";t>-1||i>-1;){var o=e.substring(t+1,i),a=n.getFieldsByName(o);if(a)switch(a.getFillableFieldType()){case FILLABLEFIELD_TYPE.CURRENCY:r=a.getFieldValue();break;default:r=a.getValue()}r=r.trim(),r=r?r:0,e=e.substring(0,t)+r+e.substring(i+1),t=Utils.findNextIndexOf(FIELD_PARENTHESIS.FILLABLE_START,t+1,e),i=Utils.findNextIndexOf(FIELD_PARENTHESIS.FILLABLE_END,t+1,e)}return e},e.prototype.destroy=function(){this.value=""},e.prototype.checkFormula=function(e){try{var s=this.value,l={isValid:!0,message:""},d=[],c=s.toUpperCase();if(c=c.replaceAll("\\s",""),"="!=c[0])return l.isValid=!1,l.message=J.i18n("writer.formula.error.START_WITH_EQUAL_SIGN"),l;if(l=E(c),!l.isValid)return l;if(l=p(s),!l.isValid)return l;for(var h=0;h<g.length;h++){var D=g[h],R=f(c,D[0],D[1]);if(!R.isValid)return R;d=d.concat(R.fields)}if(c=I(c,d),e){var S=e.getParent(NODE_TYPE.TABLE);if(t.lastIndex=0,S){if(l=T(c,S),!l.isValid)return l}else if(t.exec(c))return l.isValid=!1,l.message=J.i18n("writer.formula.error.TABLECELL_IN_PARA_FORMULA"),l}if(c=s.toUpperCase(),c=c.replaceAll("\\s",""),l=O(c),!l.isValid)return l;if(c=I(c,d),l=m(c),!l.isValid)return l;if(c=l.tempFormula,c.split("=").length>2)return l.isValid=!1,l.message=J.i18n("writer.formula.error.MORE_EQUAL_IN_FORMULA"),l;var C=Formula.getThousandAndDecimalSeperator(),A=C.decimalSeparator,v=C.thousandSeparator,_=","!=A?c.replaceAll("\\"+A,""):c;if(_=","!=v?_.replaceAll("\\"+v,""):_,_=_.replaceAll("\\,",""),_=_.replaceAll(r,""),u.lastIndex=0,u.exec(_))return l.isValid=!1,l.message=J.i18n("writer.formula.error.UNRECOGNIZED_SYMBOL"),l;c=c.replaceAll(new RegExp("[^a-zA-Z0-9+*/:\\,/-]","gm"),""),c=c.replaceAll(o,""),c=c.replaceAll(a,"");for(var P,N=c.split(/[+*\/,:\/-]+/),b=0;b<N.length;b++){P=N[b];var L=P.match(t),w=P.match(n),y=P.match(i);if(L&&L[0].length!=P.length||w&&w.length==P.length||y)return l.isValid=!1,l.message=J.i18n("writer.formula.error.STRING_FOUND"),l}return l}catch(e){return{isValid:!0}}},e}(),Formula=function(e,t){var i,n,r,o,a,s,l={},d={find:function(e){return this.def[e]||g("undefined_bookmark",e)},init:function(e){var t,i;this.def={};for(var n in e){try{var r=e[n];t=parseFloat(r)}catch(i){t=parseFloat(e[n])}i="(number)",isNaN(t)&&(t=0,i="(literal)"),this.def[n.toUpperCase()]={type:i,value:t}}}},c={ABS:1,AND:1,AVERAGE:1,COUNT:1,INT:1,MAX:1,MIN:1,MOD:1,NOT:1,OR:1,PRODUCT:1,ROUND:1,SIGN:1,SUM:1},u={ABOVE:1,BELOW:1,LEFT:1,RIGHT:1,IF:1},g=function(e,t){throw{message:e,param:t}},h={nud:function(){g("undefined")},led:function(e){g("missing_operator")}},f=function(e,t){var i,n,r,o,a="=<>!",s="=",l=[],d=0,c=function(e,t){return{type:e,value:t,from:n,to:d}},u=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"},h=function(e){return e>="0"&&e<="9"};if(!e)return l;for(i=e.charAt(d);i;)if(n=d," "==i)d+=1,i=e.charAt(d);else if(u(i)){for(r=i,d+=1;i=e.charAt(d),u(i)||h(i);)r+=i,d+=1;l.push(c("name",r.toUpperCase()))}else if(h(i)){for(r=i,d+=1;i=e.charAt(d),h(i);)r+=i,d+=1;if(i==t&&h(e.charAt(d+1)))for(r+=".",d+=1;i=e.charAt(d),h(i);)r+=i,d+=1;if("e"==i||"E"==i){r+=i,d+=1,i=e.charAt(d),"-"!==i&&"+"!==i||(r+=i,d+=1,i=e.charAt(d)),h(i)||g("bad_exponent");do r+=i,d+=1,i=e.charAt(d);while(h(i))}u(i)&&(r+=i,d+=1,g("bad_number")),o=+r,isFinite(o)?l.push(c("number",o)):g("bad_number")}else a.indexOf(i)>=0?(r=i,d+=1,i=e.charAt(d),s.indexOf(i)>=0&&(r+=i,d+=1,i=e.charAt(d)),l.push(c("operator",r))):"&"==i||"|"==i?(r=i,d+=1,i=e.charAt(d),i==r?(r+=i,d+=1,i=e.charAt(d),l.push(c("operator",r))):g("bad_number")):(d+=1,l.push(c("operator",i)),i=e.charAt(d));return l},p=function(e,t){var i=l[e];return t=t||0,i?t>i.lbp&&(i.lbp=t):(i=E(h),i.id=i.value=e,i.lbp=t,l[e]=i),i},E=function(e){var t={};for(var i in e)t[i]=e[i];return t},T=function(e){var t,o,a,s,h,f;e&&r.id!==e&&g("expected_'"+e),n>=i.length||(t=i[n],n+=1,o=h=t.value,a=t.type,"name"==a?c[o]||u[o]?s=l[o]:d.find(o)&&(f=d.find(o),o=f.value,a=f.type,s=l[a]):"operator"==a?(s=l[o],s||g("unknown_operator")):"number"==a?s=l["(number)"]:g("unexpected_token"),r=E(s),r.from=t.from,r.to=t.to,r.value=o,r.type=a,r.name=h)},O=function(e){var t,i=r;for(e=e||0,T(),t=i.nud();e<r.lbp;)i=r,T(),"function"==typeof t||void 0!==t.value?t=i.led(t):g("unexpected_token");return t},m=function(e,t,i){var n=p(e,t);n.led=i},I=function(e,t){var i=p(e);i.nud=t},D=function(e,t){I(e,function(){return t})},R=function(e,t,i){I(e,function(){return function(e){return e.reduce(t,S(i||0))}})},S=function(e){return{value:e}},C=function(e){e=e.toUpperCase();var t,i=d.find(e),n=l[i.type];return t=E(n),t.value=i.value,t.type=i.type,t.name=e,t};p(")"),p(","),p("(number)").nud=function(){return{name:this.name,value:this.value}},p("(literal)").nud=function(){return{name:this.name,value:this.value}},p("ABOVE").nud=function(){for(var e,t=[],i=o-1,n=a;i>=1&&(e=C(n+i),"(number)"==e.type);)t.push(e),i-=1;return t},p("BELOW").nud=function(){for(var e,t=[],i=o+1,n=s.rows,r=a;i<=n&&(e=C(r+i),"(number)"==e.type);)t.push(e),i+=1;return t},p("LEFT").nud=function(){for(var e,t=[],i=o,n=String.fromCharCode(a.charCodeAt()-1);n>="A"&&(e=C(n+i),"(number)"==e.type);)t.push(e),n=String.fromCharCode(n.charCodeAt()-1);return t},p("RIGHT").nud=function(){for(var e,t=[],i=o,n=String.fromCharCode(a.charCodeAt()+1),r=String.fromCharCode("A".charCodeAt()+s.cols-1);n<=r&&(e=C(n+i),"(number)"==e.type);)t.push(e),n=String.fromCharCode(n.charCodeAt()+1);return t},m(":",100,function(e){for(var t,i,n=e.name.replace(/([A-Z])([\d])/g,"$1 $2").split(" "),r=O(0).name.replace(/([A-Z])([\d])/g,"$1 $2").split(" "),o=n[0],a=r[0],s=[];o<=a;){for(t=+n[1],i=+r[1];t<=i;)s.push(C(o+t)),t+=1;o=String.fromCharCode(o.charCodeAt()+1)}return s}),m("&&",30,function(e){var t=O(this.lbp);return S(e.value&&t.value?1:0)}),m("||",30,function(e){var t=O(this.lbp);return S(e.value||t.value?1:0)}),m("=",40,function(e){var t=O(this.lbp);return S(e.value==t.value?1:0)}),m("!=",40,function(e){var t=O(this.lbp);return S(e.value!=t.value?1:0)}),m("<",40,function(e){var t=O(this.lbp);return S(e.value<t.value?1:0)}),m("<=",40,function(e){var t=O(this.lbp);return S(e.value<=t.value?1:0)}),m(">",40,function(e){var t=O(this.lbp);return S(e.value>t.value?1:0)}),m(">=",40,function(e){var t=O(this.lbp);return S(e.value>=t.value?1:0)}),m("+",50,function(e){var t=O(this.lbp);return S(e.value+t.value)}),m("-",50,function(e){return S(e.value-O(this.lbp).value)}),m("*",60,function(e){return S(e.value*O(this.lbp).value)}),m("/",60,function(e){var t=O(this.lbp).value;return 0==t&&g("zero_divide"),S(e.value/t)}),m("%",40,function(e){return S(e.value%O(this.lbp).value)}),m("(",90,function(e){var t=[];if(")"!==r.id)for(;t.push(O(0)),","==r.id||":"==r.id;)T();return T(")"),t=t.reduce(function(e,t){return e.concat(t)},[]),t.length?e.call(null,t):S(0)}),I("-",function(){return S(-O(70).value)}),I("(",function(){var e=O(0);return T(")"),e}),D("ABS",function(e){return S(Math.abs(e[0].value))}),R("AND",function(e,t){return S(e.value&&t.value?1:0)},1),D("AVERAGE",function(e){return S(e.reduce(function(e,t){return S(e.value+(t.value||0))}).value/e.length)}),R("COUNT",function(e,t){return S(e.value+(t.value?1:0))}),D("INT",function(e){return S(Math.floor(e[0].value))}),R("MAX",function(e,t){return S(Math.max(e.value,t.value))}),D("MIN",function(e){return e.reduce(function(t,i){return S(Math.min(t.value,i.value),e[0].value)})}),D("MOD",function(e){return S(e[0].value%e[1].value)}),D("NOT",function(e){return S(e[0].value?0:1)}),R("OR",function(e,t){return S(e.value||t.value?1:0)}),R("PRODUCT",function(e,t){return S(e.value*(t.value||(0===t.value?0:1)))},1),D("ROUND",function(e){var t,i=e[0].value,n=e[1]&&e[1].value||0;if(n<0){var r=Math.pow(10,Math.abs(n));t=Math.round(i/r)*r}else t=parseFloat(i.toFixed(n));return S(t)}),D("SIGN",function(e){var t=e[0].value;return S(t>0?1:t<0?-1:0)}),R("SUM",function(e,t){return S(e.value+(t.value||0))}),D("IF",function(e){return 3==e.length?S(e[0].value?e[1].value:e[2].value):0});var A=/([#\d])([\d#,\.\s]+[#\d])?(%)?/,v=/([#\d])([\d#,\.\s]+[#\d])?/,_=/(-)?\d+((\.|,|-|\s)\d+)*/,P="en-US",N="USD",b=",",L=".",w="$#,##0.00",y={".":/\./g,",":/\,/g," ":/\s/g,"":/\s/g,"'":/\'/g},M=function(e){if(/\s/.test(e))return/\s/g},F=function(e){return y[e]||M(e)},V=function(){return P},B=function(){return N||"USD"},x=function(){if("undefined"!=typeof editorProps)return!(!editorProps.browserInfo||!editorProps.browserInfo.is_chrome)},W=function(){var e=DocLocaleHandler.getLanguage();if(P!==e){e=Numeral.getValidLocale(e,x());var t=DocLocaleHandler.getLanguageDetails(e);t||(t=DocLocaleHandler.getLanguageDetails("en-US")),t&&(P=t.code,N=t.currencyCode);var i=Numeral.getThousandAndDecimalSeperator(P);b=i.thousands,L=i.decimal;var n={value:0,langCountryCode:P,decimalPlaces:2,integerPlaces:5,isCurrency:!0,currencyCode:N},r=Numeral.applyThousandAndDecimalSeperator(n);"0"==r&&(r="$00,000.00"),r=r.replace("0",""),w=k(r,3)}};t.subscribe("Document/DefaultLanguageInitialized",W),t.subscribe("Document/LanguageInitialized",W),t.subscribe("Document/LanguageChanged",W);var H=function(e){e=e.replace(/[^0-9,\.\-\s]/g," "),e=e.trim();var t=_.exec(e);if(!t||!t.length)return NaN;e=t[0];var i=e.split(F(L));return i[0]=i[0].replace(F(b),""),parseFloat(i[0]+"."+i[1])},G=function(e,t,i,n,r){var o="0",a={value:e,langCountryCode:n||P};if(r=r||Formula.getCurrencyCode(),t){var s;"currencyFormat"===t?(s=i.match(v)[0],a.isCurrency=!0,a.currencyCode=r):s=t.match(v)[0],s=s.trim();var l=Y(s,L),d=s.split(F(b)).length>1;a.decimalPlaces=l,a.useThousandGrouping=d,o=Numeral.applyThousandAndDecimalSeperator(a),"%"===t[t.length-1]&&(o+="%")}else{var c=(e+"").split(/\./);a.decimalPlaces=c[1]&&c[1].length||0,a.useThousandGrouping=!1,o=Numeral.applyThousandAndDecimalSeperator(a)}return o},k=function(e,t){for(;t>0;)e=e.replace(/\d/,"#"),t--;return e=e.replace(/\d/g,"0")},Y=function(e,t){var i=e.split(t);return i[1]?i[1].length:0},Z=function(){return{thousandSeparator:b,decimalSeparator:L}},z=function(e){var t={numberFormat:"",prefix:"",suffix:""},i=/(;)/;if(e)if(e=e.substring(1,e.length-1),i.test(e)){var n=e.split(";");t.isCurrencyFormat=!0,t.numberFormat="currencyFormat";var r=n[0],o=n[1],a=o.match(/\(.*\)/);if(a){var s=a[0],l=s.replace(/[\(\)]/g,"");t.currencyNegative=s,t.currencyPositive=l,t.prefix=r.replace(l,"")||"",t.suffix=o.replace(s,"")||"",t.suffix=t.suffix.replace(/[\(\)]/g,"")}else t.currencyPositive=r,t.currencyNegative=o,t.prefix="",t.suffix=""}else if(A.test(e)){var d=e.match(A)[0],c=e.indexOf(d);t.numberFormat=d,t.prefix=e.substring(0,c),t.suffix=e.substring(c+d.length)}else t.prefix=e;return t},J=function(e,t,i,n){var r=i+t+n;return r&&(e+=' \\# "'+r+'"'),e=e.trim()},j=function(e,t,i){var n,r;try{var o=e.text;if(r=new ZWFieldParser(o),r&&r.isTableReferenceField()&&(i||(i={}),o=TableCollectionInstance.getReplacedValue(o,i||{}),e.text=o),e.text&&(r.isMergeField()||r.isFillableField()))return n={},n.formattedVal="Formula_Output",n;n=t&&"cell"==t.parent.type?ne(e,DocTreeManager.getTableValues(t,i),DocTreeManager.getCurrentCell(t),DocTreeManager.getTableSize(t)):ne(e,{A1:void 0},"A1",{rows:1,cols:1})}catch(t){switch(n={val:0,error:!0},t){case"outside_table":n.formattedVal="!Formula_Not_In_Table";break;default:var a={shouldWriteToFile:!0,service:ZWCollaboration.FORMULA_FIELD,filePrefix:ZWCollaboration.FORMULA_FIELD},s=ZWJSONUtils.clone(e);s.prefix="",s.suffix="";var l="Exception: \n"+(t.stack||t)+"\nFormat: "+JSON.stringify(s)+"\nErr No: "+ZWCollaboration.FORMULA_FIELD+"\nDOC len: "+editor.doc.getDocumentLength()+"\nDOC RID: "+Macros.getRId()+"\nbuildLabel: "+buildLabel+"\nClientInfo: "+ZWCollaboration.clientInfo;ZWClientLogger.sendToServer(ZWCollaboration.FORMULA_FIELD,l,a),n.formattedVal="!Error"}}return r.destroy(),n},X=function(e){e=U.unescape(e);var t=e.split("\\#"),i=t[0].trim(),n=t[1]&&t[1].trim();return n=z(n),n.text=i,n},K=function(e){for(var t,i="";e>0;)t=(e-1)%26,i=String.fromCharCode(65+t)+i,e=(e-t)/26|0;return i||void 0},Q=function(e){for(var t=0,i=0;t<e.length;t++)i=e[t].charCodeAt()-64+26*i;return i},q=function(e){for(var t="",i=e;e>0;)i=e%26,e=parseInt(e/26),0==i&&(e-=1,i=26),t=String.fromCharCode(i+64)+t;return t},$=function(e,t,i,n){var r=0;return r=n&&i!=n?(n-i+1)*(t-e+1):t-e+1},ee=new RegExp("[A-Z]+","gm"),te=new RegExp("[0-9]+","gm"),ie=function(e){e=e.toUpperCase(),e=e.replaceAll("\\s","");for(var t,i,n,r,o,a,s,l,d,c,u,g,h="SUMPRODUCT",f=e.indexOf(h),p=[],E="";f>-1;){for(u=Utils.findNextIndexOf(FIELD_PARENTHESIS.OPEN_PARENTHESIS_REGEX,f+h.length+1,e),g=Utils.findNextIndexOf(FIELD_PARENTHESIS.CLOSE_PARENTHESIS_REGEX,f+1,e);u>-1&&u<g;)u=Utils.findNextIndexOf(FIELD_PARENTHESIS.OPEN_PARENTHESIS_REGEX,u+1,e),g=Utils.findNextIndexOf(FIELD_PARENTHESIS.CLOSE_PARENTHESIS_REGEX,g+1,e);var T=e.substring(f+h.length+1,g);T=T.split(","),t=0,i=0;for(var O=0,m=T.length;O<m;O++){if(u=0,n=T[O].split(":"),ee.lastIndex=0,te.lastIndex=0,l=Q(ee.exec(n[0])[0]),ee.lastIndex=0,d=Q(ee.exec(n[n.length-1])[0]),r=parseInt(te.exec(n[0])[0]),te.lastIndex=0,o=parseInt(te.exec(n[n.length-1])[0]),0==O)t=$(r,o,l,d);else if(i=$(r,o,l,d),t!=i)throw{msg:"Mismatch in the sumproduct"};for(;l<=d;){for(a=r,s=K(l);a<=o;)c=p[u],0==O?c="PRODUCT(":c+=",",c+=s+a,c+=O==m-1?")":"",a+=1,p[u]=c,u++;l+=1}}E="SUM("+p.join(",")+")",e=e.substring(0,f)+E+e.substring(g+1),f=e.indexOf(h)}return e},ne=function(e,t,r,l){var c={};try{var u=e.text;u.toUpperCase().indexOf("SUMPRODUCT")!=-1&&(u=ie(u.toUpperCase()));var g=e.numberFormat,h=e.prefix,p=e.suffix,E=/=([^\n]*)\n?/g;u=E.exec(u)[1].toUpperCase();var m=r.replace(/([A-Z])([\d])/gi,"$1 $2").split(" ");a=m[0],o=parseInt(m[1],10),s=l,d.init(t),i=f(u,Z().decimalSeparator),n=0,T();var I=O().value;if(isNaN(I)&&"string"!=typeof I)c.val=0,c.formattedVal=0;else{var D;if(c.val=I,e.isCurrencyFormat){if(e.currencyPositive!=w){e.currencyPositive=w,e.currencyNegative="("+w+")";var R=e.text,S=e.currencyPositive+";"+e.currencyNegative;c.updatedFormulaField=J(R,S,h,p)}D=G(Math.abs(I),g,I>=0?e.currencyPositive:e.currencyNegative),I<0&&(D="("+D+")")}else h&&!g?(D="",c.val=0):D=G(I,g);h&&(D=h+D),p&&(D+=p),c.formattedVal=D}c.formattedVal=c.formattedVal+""}catch(e){var C="";switch(e.message){case"zero_divide":C="!Zero_Divide";break;case"undefined_bookmark":C=e.param&&/(^([a-zA-Z]{1,2}(\d){1,2})$)/.test(e.param)?"!Undefined_Bookmark":"!Syntax_Error";break;default:C="!Syntax_Error"}c={val:0,formattedVal:C,error:!0}}return c},re=function(e,t){for(var i,n=e.children,r=n.length,o=0;o<r;o++){i="";var a=n[o];if(a.type==NODE_TYPE.PARA){if(t&&t[a.id])i=t[a.id];else if(a.viewProperties.fields.containsOldFormula){var s=a.viewProperties.fields;for(var l in s){var d=s[l];d.value&&(i=d.value)}}else i=a.content();try{if(a.viewProperties.fields.containsCurrencyFormat){var c=H(i);i=i.match(/\(.*\)/)?c*-1:c}else i=H(i)}catch(e){var u={shouldWriteToFile:!0,service:ZWCollaboration.FORMULA_FIELD_ABNORMAL_CONTENT,filePrefix:ZWCollaboration.FORMULA_FIELD_ABNORMAL_CONTENT},g="Exception: \n"+(e.stack||e)+"\nContentType: "+typeof i+"\nPara Start: "+a.start+"\nPara End: "+a.end+"\nErr No: "+ZWCollaboration.FORMULA_FIELD_ABNORMAL_CONTENT+"\nDOC len: "+editor.doc.getDocumentLength()+"\nDOC RID: "+Macros.getRId()+"\nbuildLabel: "+buildLabel+"\nClientInfo: "+ZWCollaboration.clientInfo;throw ZWClientLogger.sendToServer(ZWCollaboration.FORMULA_FIELD_ABNORMAL_CONTENT,g,u),e}if(!isNaN(i))return i}}},oe=function(e){return e||(e=""),e.replace(/^\s+/g,"")},ae=function(e){return e||(e=""),e.replace(/\s+$/g,"")},se=function(e){var t,i=e.code,n=Numeral.getValidLocale(i,x());t=n!=i?DocLocaleHandler.getLanguageDetails(n):e;var r=t.currencyCode;if(r)return Numeral.getFormattedNumberAndCurrencySymbol(t.code,r)};return{calculate:j,calc:ne,getFormulaFormat:X,extractFormulaOptions:z,getCellValue:re,localeParseFloat:H,getThousandAndDecimalSeperator:Z,getCurrencyCode:B,getUserLangCountryCode:V,replaceDigitsWithHash:k,createFormulaFieldString:J,removeLeadingWhiteSpace:oe,removeTrailingWhiteSpace:ae,getSymbolAndFormat:se,applyNumberFormat:G,getSeparatorPattern:F,getColNum:Q,getDiff:$,getAlphaFromNum:q}}(DocUtil,PubSub);!function(){"function"==typeof Numeral.setLocaleCurrencyProvider&&"function"==typeof DocLocaleHandler.getCurrencyCode&&Numeral.setLocaleCurrencyProvider(DocLocaleHandler.getCurrencyCode)}();var ZWDate=function(){var e={yyyy:"YYYY","M/d/yy":"M/D/YY","dd/MM/yyyy":"DD/MM/YYYY","dd.MM.yyyy":"DD.MM.YYYY","dd/mm/yyyy":"DD/MM/YYYY","dd.mm.yyyy":"DD.MM.YYYY","M.d.yy":"M.D.YY","M/d/yyyy":"M/D/YYYY","MMM. d, yy":"MMM. D, YY","MMMM, yy":"MMMM, YY","MMM-yy":"MMM-YY","MMMM d, yyyy":"MMMM D, YYYY","d-MMM-yy":"D-MMM-YY","d MMMM yyyy":"D MMMM YYYY","d MMM YYYY":"D MMM YYYY","d MMMM, yyyy":"D MMMM, YYYY","d/M/yy":"D/M/YY","d/M/yyyy":"D/M/YYYY","d-M-yyyy":"D-M-YYYY","yyyy-M-d":"YYYY-M-D","dddd, MMMM d, y":"dddd, MMMM D, YYYY","yyyy-MM-dd":"YYYY-MM-DD","yyyy/MM/dd":"YYYY/MM/DD","HH:mm":"HH:mm","HH:mm:ss":"HH:mm:ss","h:mm am/pm":"h:mm A","h:mm:ss am/pm":"h:mm:ss A","M/d/yy h:mm am/pm":"M/D/YY h:mm A","M/d/yy h:mm:ss am/pm":"M/D/YY h:mm:ss A","M/d/yy HH:mm:ss":"M/D/YY HH:mm:ss","d/M/yyyy HH:mm:ss":"D/M/YYYY HH:mm:ss"},t={zh:"zh-cn"},i=function(t){var i=e[t];return i||(i=t.replaceAll("d","D").replaceAll("y","Y")),i},n=function(){var e=DocLocaleHandler.getLanguage(),i=(t[e]||e).toLocaleLowerCase();return i},r=function(e){var t=null,n=parseInt(e[ATTR_AUTOFIELD.ISAUTO]),r=Utils.getAutoDateValue(e[ATTR_AUTOFIELD.FIELDTYPE]),o=n?r:e[ATTR_AUTOFIELD.VALUE];if(e[ATTR_AUTOFIELD.DATEINFO]&&!ZWJSONUtils.isEmptyObject(e[ATTR_AUTOFIELD.DATEINFO]))t=ZWDateTime.getDateStringFromDateInfo(o,e[ATTR_AUTOFIELD.DATEINFO]);else{try{var a={shouldSendMail:!0},s="Date migration error.\nOld flow execution.\nDate format:\n"+JSON.stringify(e);ZWClientLogger.sendToServer(ZWCollaboration.DATE_FIELD_ERROR,s,a)}catch(e){var l=new ZWConsole;l.enable(),loggger.log(e)}var d=ZWDateTime.getDateInfo(),c=ZWDateTime.migrateMomentToIntlFormat(i(e[ATTR_AUTOFIELD.DATEFMT]||"DD MM YYYY"));d.input.format=c,d.output.format=c,t=ZWDateTime.getDateStringFromDateInfo(o,d)}return t},o=function(e,t){var i=new moment(e||(new Date).getTime()),r=editorProps.userInfo.timezone;return r&&i.tz(r),i.locale(t||n())},a=function(e,t){return e=e||o(null,t),e._locale._longDateFormat.LL},s=function(e,t){var n=e.format(i(t));return e._locale.preparse&&(n=e._locale.preparse(n)),n},l=function(e,t){var i=ZWDateTime.CONSTANTS.DEFAULT_TIMEZONE,n=new ZWDateTime;return n.format(t,e,i)},d=function(e){return ZWDateTime.SUPPORTED_DATE_FORMATS};return{getEditorLocale:n,getDateString:r,getDefaultFormat:a,getMomentFormat:i,getMomentInst:o,getValue:s,getLocaleSupportedFormats:d,getLocaleValue:l}}();MsgDialog=function(){"use strict";var e=null,t=null,i=null,n=function(){J("#msgdlgzdialog").zdialog("close",{animation:!1})},r=function(){e()},o=function(){t()},a=function(){i()},s=!1,l=function(r,o,a,s,l,d,c,u,g,h){var f=null,p=null,E=null;U.isArray(r)?(f=r[0],p=r[1],E=r[2]):r==CONST.MSG_TYPE_RELOAD?f=J.i18n("writer.common.RELOAD"):r==CONST.MSG_TYPE_RELOADCANCEL?(f=J.i18n("writer.common.RELOAD"),p=J.i18n("writer.common.CANCEL")):r==CONST.MSG_TYPE_CONFIRM?(f=J.i18n("writer.common.OK"),p=J.i18n("writer.common.CANCEL")):r==CONST.MSG_TYPE_YESNO?(f=J.i18n("writer.common.YES"),p=J.i18n("writer.common.NO")):r==CONST.MSG_TYPE_ALERT?f=J.i18n("writer.common.OK"):r==CONST.MSG_TYPE_REPORT?(f=J.i18n("writer.common.SEND_ERROR_REPORT"),p=J.i18n("writer.common.DONT_SEND")):r==CONST.MSG_TYPE_DELETECANCEL&&(f=J.i18n("writer.common.DELETE"),p=J.i18n("writer.common.CANCEL")),d?(e=function(){n(),d(CONST.BUTTON_1_CLICKED)},t=function(){n(),d(CONST.BUTTON_2_CLICKED)},i=function(){n(),d(CONST.BUTTON_3_CLICKED)}):c?(e=function(){n(),c(CONST.BUTTON_1_CLICKED)},t=function(){n(),c(CONST.BUTTON_2_CLICKED)},i=function(){n(),c(CONST.BUTTON_3_CLICKED)}):e=t=i=n;var T={init:function(){var e=J("#messagedialog"),t=J("#messagedlgbtn_1"),i=J("#messagedlgbtn_2"),n=J("#messagedlgbtn_3");if(o&&"info"!=o&&e.find(".ui-wdialog-info").addClass("ui-wdialog-"+o),null!=E&&J(".ui-wdialog").addClass("ui-wdialog-extn"),f?t.zbutton("setAttribute","text",f):t.remove(),p?i.zbutton("setAttribute","text",p):i.remove(),E?n.zbutton("setAttribute","text",E):n.remove(),g&&t.zbutton("setAttribute","appearance","primary"),u?e.find(".ui-msg-content").html(s):e.find(".ui-msg-content").text(s),e.find(".ui-wdialog-title").text(a),h&&!ZWJSONUtils.isEmptyObject(h)&&J(h.container).addClass(h.className),J("#msgdlgzdialog").zdialog("reposition"),l)return void l()}};J.dialogutil.open("msgdlg",null,T)},d=function(){return s};return{showMessage:l,execCallback_1:r,execCallback_2:o,execCallback_3:a,isHardReloadDialogShown:d,close:n}}(),function(e){var t={},i=3,n=function(e){return new Error("Module `{{name}}` cannot be found. Possible reasons: \n #1) Module is not loaded \n #2) Module loading failed because of errors (check previous console errors).".replace("{{name}}",e))},r=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(!0,i.responseText):t(!1))},i.open("GET",e,!0),i.send(null)},o=function(e,t){var i=document.createElement("link");return i.type="text/css",i.rel="stylesheet",i.href=e,i.addEventListener("load",t.bind(this,!0),!1),i.addEventListener("error",t.bind(this,!1),!1),document.getElementsByTagName("head")[0].appendChild(i),e},a=function(){var e=function(e){var t=document.createElement("script");return t.type="text/javascript",t.charset="utf-8",t.defer=!0,t.src=e,t};return function(t,i){var n=e(t);n.addEventListener("load",i.bind(this,!0),!1),n.addEventListener("error",i.bind(this,!1),!1);var r=document.getElementsByTagName("head")[0];r.appendChild(n)}}(),s=function(e,t){this.list=e,this.cb=t};s.prototype.resolve=function(e){var t=this.list.indexOf(e);t>-1&&this.list.splice(t,1),this.list.length||this.cb()};var l=function(e,t){var i=new Error("Script/HTML/CSS download failed: "+e);throw t&&t(i),i},d=function(e,n,d){var c=e.js||[],u=e.css||[],g=e.html||[],h=[].concat(c).concat(u).concat(g),f={};h.forEach(function(e){f[e]=1});var p=new s(h,n);h.length||n();for(var E=this,T=function(e,n,s,c){s?(t[e]="html"!==n||c,p.resolve(e)):(f[e]++,f[e]<=i?setTimeout(function(){"css"===n?o(e,T.bind(E,e,"css")):"html"===n?r(e,T.bind(E,e,"html")):"js"===n&&a(e,T.bind(E,e,"html"))},5e3):l(e,d))},O=0;O<u.length;O++){var m=u[O];t[m]?p.resolve(m):o(m,T.bind(this,m,"css"))}for(var O=0;O<g.length;O++){var m=g[O];t[m]?p.resolve(m):r(m,T.bind(this,m,"html"))}for(var O=0;O<c.length;O++){var m=c[O];t[m]?p.resolve(m):a(m,T.bind(this,m,"js"))}},c=function(e,i){if(!i)return e.concat({});var n=i.reduce(function(e,i){return e[i]=t[i],e},{});return e=e.concat(n)},u=function(e,t,i,r,o){d(e,function(){t=t.map(function(e){if(window[e])return window[e];var t=n(e);throw r&&r(t),t}),t=c(t,e.html),i.apply(o,t)},r)},g=function(t,i,r,o,a,s){d(i,function(){r=r.map(function(e){if(window[e])return window[e];var t=n(e);throw a&&a(t),t}),r=c(r,i.html);var l=o.apply(s,r);e[t]=l},a)};e.zw=e.zw||{},e.zw.require=u,e.zw.define=g}(window),zw.define("JobScheduler",[],["PubSub","BaseEventHandler"],function(e,t){var i=function(i,n,r,o){this.jobs=[],this.jobHandler=i,this.timeout=n||500,this.delayOptions=r||{on:["Document/BeforeModelUpdation","Document/ScrollEvent"],timeout:1e3},this.context=o,this.timeoutId=!1,this.events=new t,this._paused=!1;var a=this;this.state={paused:function(){return a._paused},running:function(){return!a._paused&&a.jobs.length},idle:function(){return!a.jobs.length}},this._listeningEditorEvents=!1,this.add=function(e,t){var i=this.state.idle();if(U.isArray(e)){if(!e.length)return;var n=e.map(function(e){return e.id=e.id||a._getRandomId(),e});this.jobs.push.apply(this.jobs,n)}else e.id=e.id||this._getRandomId(),t?this.jobs.unshift(e):this.jobs.push(e);i&&(this._addSubscribers(),this.events.trigger("run")),i&&!this.state.paused()&&this._execJob()},this.remove=function(e){var t=this._findIndexOfJob(e);t>-1&&this.jobs.splice(t,1)},this.pause=function(){},this.resume=function(){},this.isQueued=function(e){var t=this._findIndexOfJob(e);return t>-1},this.addPriorityJob=function(e){this.add(e,!0)},this.reset=function(){this.jobs=[],clearTimeout(this.timeoutId),this._afterJobExec()},this.setJobHandler=function(e){this.jobHandler=e},this.setTimer=function(e){this.timeout=e},this._execJob=function(e){var t=this;this.timeoutId=setTimeout(function(){var e=t.jobs.shift();e&&t.jobHandler.apply(t.context,[e]),t._afterJobExec()},e||this.timeout)},this._afterJobExec=function(){this.jobs.length?this._execJob():(this._onIdle(),this._removeSubscribers())},this._onIdle=function(){this.events.trigger("idle")},this._addSubscribers=function(){this._listeningEditorEvents||(this._listeningEditorEvents=!0,e.subscribe(this.delayOptions.on,this._delay))},this._removeSubscribers=function(){this._listeningEditorEvents=!1,e.unsubscribe(this.delayOptions.on,this._delay)},this._delay=function(){clearTimeout(a.timeoutId),a._execJob(a.delayOptions.timeout)},this._getRandomId=function(){return Math.ceil(1e7*Math.random())},this._findIndexOfJob=function(e){for(var t=0;t<this.jobs.length;t++){var i=this.jobs[t];if(i.id===e)return t}return-1},this.length=function(){return this.jobs.length}};return i}),ProofingAdaptor=function(){var e,t=!1,i=!1,n=!1,r=function(){return t},o=function(e){t=e},a=function(){return i},s=function(e){i=e},l=function(){u(),editorProps.options.CNAME_ENABLED&&ZiaPanelConstants.updateWhiteLabelMessages();var t={onLoad:function(){ProofingManager.setProofingData(e,function(){Macros.proofing.getDictionaryWords(Proofing.getLanguage());var e;ProofingUtil.isLoginEditor()&&!Macros.isVerticalIntegration()?e=ZWP.Utils.getIsFrenchUser():(e=new Deferred,e.reject()),e.done(function(e){Proofing.setIsFrenchUser(e.is_french_supported_user)}).always(function(){g(),PubSub.subscribe("Document/EditorReady",g),PubSub.subscribe("Document/TC/ViewChanged",g),n=!0,PubSub.publish("Module/Proofing/Loaded")})})},from:"writer"};Macros.isVerticalIntegration()&&(t.zaid=editor.options.zaid),ZBluePencil.load(t)},d=function(){editor.getRole().permissions.can("document.edit")&&c(function(t){e=t,PubSub.publish("ModuleLoad/Proofing")})},c=function(e){var t=1,i=function(e,t){var i={};Macros.proofing.getCache(i,e,t)},n=function(t){t||(t={},t.spellData={},t.grammarData={},t.proofing_suggestions_data={});var i={};i.proofingCachedSuggestions=t.proofing_suggestions_data.SUGGESTIONS||{},i.ignoreAllWords=t.proofing_suggestions_data.IGNORED_WORDS||{},i.ignoreAllSuggestions=t.proofing_suggestions_data.IGNORED_SUGGESTIONS||{},i.wqCachedSuggestions=t.wqData||{},e(i)},r=function(e){t++,t<=3&&i(n,r)};i(n,r)},u=function(){UIUtils.initComponent("bbr-proofing-popup"),Z("rev-mode-tb-lang-menu").zmenu(),Z("review-tb-sp-switch").ztoggleswitch()},g=function(){ProofingUI.init(),ProofingManager.init(),SpLinePainter.init(),GrammarLinePainter.init(),ShortenPhraseLinePainter.init(),RephrasableSentenceLinePainter.init(),ImproperWordChoiceLinePainter.init(),InformalWritingLinePainter.init(),NonInclusiveLangLinePainter.init(),ProofingPopup.init()},h=function(){return n};return PubSub.subscribe("Document/ComponentInitialized",d),{isGrammarSupportedSetup:r,setGrammarSupportedSetup:o,isGrammarSupportedUser:a,setGrammarSupportedUser:s,isLoaded:h,onFilesLoaded:l}}(),zw.define("FindAdaptor",[],[],function(){var e=function(){var e,i=jsCdnZWStaticPath+fingerPrintObj["js/writer_find_min_all.js"];e=ZWNetworkUtils.getContextUrl("jsp/popups/findpopupbeta.jsp"),zw.require({js:[i],html:[e]},[],function(i){var n=document.createElement("div");n.id="find-fragment",n.innerHTML=i[e],document.body.appendChild(n),t(),FindManager.init(),FindUI.init(),FindResultHighlighter.init(),FindResultNavigator.init(),FindBulletinManager.init(),FindWorkerHandler.init()})},t=function(){UIUtils.initComponent("findpopup"),Z("findpopup").on("click",ToolbarHandler.handleZButtonClick),J("#findpopup-search-menu,#findpopup-hypen-submenu").bind("zmenuitemclick",function(e,t){UIUtils._itemClicked(e,t)}),J("#find-filter,#find-selectbox").bind("zselectboxchange",ToolbarHandler.comboChangeHandler)},i=function(){"undefined"!=typeof FindUI&&FindUI.openFind()},n=function(){"undefined"!=typeof FindUI&&FindUI.openReplace()};return PubSub.subscribe("Document/CommonWorkerFileLoaded",e),{openFind:i,openReplace:n}});var WidgetView=function(){var e={1:{embedUrl:"www.youtube.com/embed/VIDEO_ID",params:"?autoplay=1&allowfullscreen",imageUrl:"img.youtube.com/vi/VIDEO_ID/0.jpg"},2:{embedUrl:"player.vimeo.com/video/VIDEO_ID",params:"?autoplay=1",imageUrl:"i.vimeocdn.com/video/VIDEO_ID_640.jpg"},3:{embedUrl:"www.dailymotion.com/embed/video/VIDEO_ID",params:"?autoplay=1&controls=true&allowfullscreen"},getUrl:function(e,t,i){return"https://"+this[e].embedUrl.replace("VIDEO_ID",t)+(i?this[e].params:"")},getThumbnailUrl:function(e,t){var i=this[e].imageUrl;return i?"https://"+this[e].imageUrl.replace("VIDEO_ID",t):""}},t=function(e){if(e.hasAttribute("data-sheet-info")){var t=e.getAttribute("data-sheet-info");return"null"!=t}return!0},i=function(e){var t=document.createElement("div");t.setAttribute("class","zw-IfrDiv");var i="string"==typeof e.thumbnail?"true"==e.thumbnail:e.thumbnail;if((e.hasOwnProperty("sheetInfo")||i)&&isHeadlessPDF){var n=ImageCache.getRenderingImageData(e),r=n.image,a={};for(var s in e)s!=ATTR_IMAGE.I_SRC&&(a[s]=e[s]);t.appendChild(r),DomUtil.applyStyleToSvgImage(J(r).children("svg").children("image")[0],a)}else{var l=o(e);t.appendChild(l),DomUtil.applyStyleToSvgImage(l,e)}return t},n=function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},r=function(e,t){if("undefined"!=typeof e&&"undefined"!=typeof t){var i,r={class:"widget-iframe",style:"position: absolute;border-width: 0px;background-color: #000;",frameborder:"0"},o=t.hasOwnProperty(ATTR_WIDGET.SHEET_INFO);if(o){var a=48,l=40,d=36;scroller=13,r.class+=" zw-sheet-image",i=t[ATTR_WIDGET.SHEET_INFO].url?t[ATTR_WIDGET.SHEET_INFO].url:Macros.getSheetGridURL(t[ATTR_WIDGET.SHEET_INFO]),r.style+="border: 1px solid black;z-index : 22;",r.style+="top : -"+a+"px; left : -"+l+"px; height: "+(parseInt(t[ATTR_IMAGE.I_HT])+a+d+scroller)+"px; width : "+(parseInt(t[ATTR_IMAGE.I_WID])+l+scroller)+"px"}else{var c=editor.getRole().permissions.can("document.edit");i=s(t[ATTR_WIDGET.SRC],c),r.width="100%",r.height="100%",void 0!==t[ATTR_WIDGET.CONTROLS]&&"false"===t[ATTR_WIDGET.CONTROLS]&&(i+=c?"&controls=0":"?controls=0")}r.allowfullscreen=!0,r.referrerpolicy="no-referrer",r[isHeadlessHTML?"data-widget-src":ATTR_IMAGE.I_SRC]=n(o?i+"?frameorigin="+window.location.origin:i),r.sandbox="allow-scripts",(o||t.hasOwnProperty(ATTR_WIDGET.SRC)&&(t[ATTR_WIDGET.SRC].match(ATTR_WIDGET.VIDEO_REGEX)||t[ATTR_WIDGET.SRC].match(ATTR_WIDGET.ZOHO_REGEX)))&&(r.sandbox+=" allow-same-origin allow-popups allow-popups-to-escape-sandbox");var u=t[ATTR_WIDGET.SRC]||"";WIDGET.VIDEO_REGEX.YOUTUBE.test(u)||WIDGET.VIDEO_REGEX.VIMEO.test(u)||WIDGET.VIDEO_REGEX.DAILYMOTION.test(u)||(r.name="embed-frame"),J(e).attr(r)}},o=function(e){var t=document.createElement("iframe");return r(t,e),t},a=function(t){if(WIDGET.VIDEO_REGEX.VIMEO.test(t)){var i=t.match(WIDGET.VIDEO_REGEX.VIMEO)[1];t=e.getThumbnailUrl(2,i)}else if(WIDGET.VIDEO_REGEX.YOUTUBE.test(t)){var i=t.match(WIDGET.VIDEO_REGEX.YOUTUBE)[4];t=e.getThumbnailUrl(1,i)}else if(WIDGET.VIDEO_REGEX.DAILYMOTION.test(t)){var i=t.match(WIDGET.VIDEO_REGEX.DAILYMOTION)[1];t=e.getThumbnailUrl(3,i)}return t},s=function(t,i){if(WIDGET.VIDEO_REGEX.YOUTUBE.test(t)){var n=t.match(WIDGET.VIDEO_REGEX.YOUTUBE)[4];t=e.getUrl(1,n,i)}else if(WIDGET.VIDEO_REGEX.VIMEO.test(t)){var n=t.match(WIDGET.VIDEO_REGEX.VIMEO)[1],r=e.getUrl(2,n,i),o=t.match(/(?:app_id)=([A-Za-z0-9]+)/);o&&(r+="app_id="+o),t=r}else if(WIDGET.VIDEO_REGEX.DAILYMOTION.test(t)){var n=t.match(WIDGET.VIDEO_REGEX.DAILYMOTION)[1];t=e.getUrl(3,n,i)}return t},l=function(e,t){var i=J(e);if(i.removeClass("zw-ifr-div-sm zw-ifr-div-md"),t[ATTR_WIDGET.WID]<250&&i.addClass(t[ATTR_WIDGET.WID]<200?"zw-ifr-div-sm":"zw-ifr-div-md"),!i.find(".wid-info-container")[0]){var n=J(J("#widget-container").html()).clone();if(i.addClass("zw-ifr-div"),t[ATTR_WIDGET.THUMBNAIL]&&"true"==t[ATTR_WIDGET.THUMBNAIL]){if(n.find(".wid-info-txt-container").remove(),t[ATTR_WIDGET.SHEET_INFO])return i.attr({"data-sheet-info":t[ATTR_WIDGET.SHEET_INFO].rid?t[ATTR_WIDGET.SHEET_INFO].rid:"null"}),void i.addClass("zw-sheet-widget")}else{if(t.mminfo)return n.find(".wid-info-txt-container").remove(),n.find("#wid-click-view").remove(),void i.removeClass("zw-ifr-div-sm zw-ifr-div zw-ifr-div-md");n.find("#wid-click-view").remove();var r=(t.hasOwnProperty(ATTR_WIDGET.SHEET_INFO),d(t[ATTR_WIDGET.SRC]));ATTR_WIDGET.ICONMAP[r]&&n.find("#wid-view-info").eq(0).removeClass("ui-iframe-def-pro").addClass("ui-emd-product-logo "+ATTR_WIDGET.ICONMAP[r])}i.append(n.show())}},d=function(e){var t;try{var i=e.split("://")[1].split("/")[0];i=i.split("."),t=i[i.length-2],t=t.toUpperCase()}catch(e){}return t},c=function(e){return isHeadlessHTML||isHeadlessPDF||!e||(e+="&t="+(new Date).getTime()),e},u=function(e){return!e||"image"!=e[ATTR_COMMON.TYPE]&&e[ATTR_COMMON.TYPE]!==NODE_TYPE.CHART?("YOUTUBE"==e[ATTR_WIDGET.SERVICE]?e[ATTR_WIDGET.TUBEID]&&(e[ATTR_WIDGET.I_SRC]="https://img.youtube.com/vi/"+e[ATTR_WIDGET.TUBEID]+"/0.jpg",e[ATTR_WIDGET.THUMBNAIL]="true"):"widget"==e[ATTR_COMMON.TYPE]&&(e[ATTR_WIDGET.THUMBNAIL]?e[ATTR_IMAGE.I_SRC]=e[ATTR_WIDGET.THUMBNAIL]:e[ATTR_IMAGE.I_SRC]=ATTR_WIDGET.WIDGET_DEF_IMG,e[ATTR_WIDGET.SRC]&&e[ATTR_WIDGET.SRC].indexOf(".youtube.")!=-1?e[ATTR_WIDGET.THUMBNAIL]="true":e[ATTR_WIDGET.THUMBNAIL]="false"),e[ATTR_WIDGET.SUBTYPE]=ATTR_WIDGET.WIDGET,e[ATTR_COMMON.TYPE]="image",e[ATTR_WIDGET.SRC]=g(e),e):e},g=function(e){var t="",i=window.location.protocol+"//",n=e[ATTR_WIDGET.SERVICE],r=i+document.domain;if(n==ATTR_WIDGET.SERVICE_SHEET)t=r+"/sheet/published.do?rid="+e[ATTR_WIDGET.TUBEID]+"&mode=embed";else if(n==ATTR_WIDGET.SERVICE_SHOW)t=r+"/show/publish/"+e[ATTR_WIDGET.TUBEID];else if(n==ATTR_WIDGET.SERVICE_REPORTS){var o=window.location.hostname;o=o.substring(o.indexOf(".")),t=i+"reports"+o+"/ZDBDataSheetView.cc?OBJID="+e[ATTR_WIDGET.TUBEID]+"&STANDALONE=true&ZDB_THEME_NAME=blue&INTERVAL=-1&REMTOOLBAR=true&INCLUDETITLE=true&INCLUDEDESC=false"}else if(n==ATTR_WIDGET.SERVICE_SHEETEXTERNAL)t=r+"/sheet/publishrange.do?id="+e[ATTR_WIDGET.TUBEID]+"&mode=embed";else if(n==ATTR_WIDGET.SERVICE_SHEETINTRANET)t=r+"/publishrange.org?id="+e[ATTR_WIDGET.TUBEID]+"&mode=embed";else if(n==ATTR_WIDGET.SERVICE_SHEETCHARTIMG)t=r+"/sheet/publicgraphs/"+e[ATTR_WIDGET.TUBEID]+".png";else if(n==ATTR_WIDGET.SERVICE_SHEETCHART)t=r+"/sheet/publicgraphs/"+e[ATTR_WIDGET.TUBEID];else if(n==ATTR_WIDGET.SERVICE_DOCS)t=r+"/file/"+e[ATTR_WIDGET.TUBEID];else if(n&&n.toUpperCase()==ATTR_WIDGET.SERVICE_YOUTUBE){var a,s;e.src&&(a=e.src.split("/"),s=a[a.length-2]),t=i+"www.youtube.com/embed/"+s}else e[ATTR_WIDGET.SRC]&&(t=e[ATTR_WIDGET.SRC]);return t};return{isEmptySheet:t,createWidgetContainer:i,applyIframeProps:r,createIframeWithProps:o,addElements:l,updateSheetSrc:c,formatMigration:u,getEmbedUrl:s,getThumbnailUrl:a,decodeHtml:n}}();ChartView=function(){"use strict";var e=function(e,t){var i=J(e);if(!i.find(".chart-info-container")[0]){i.removeClass("zw-ifr-div-sm zw-ifr-div-md"),t[ATTR_WIDGET.WID]<250&&i.addClass(t[ATTR_WIDGET.WID]<200?"zw-ifr-div-sm":"zw-ifr-div-md");var n=J(J(".chart-container").html()).clone(!0),r=n.find(".chart-edit-cont");i.addClass("zw-ifr-div");J(n[0]);if(t.hasOwnProperty("sheet_id")&&null==t[ATTR_CHART.SHEET_ID]&&null==t[ATTR_CHART.CHART_ID]){DomUtil.removeClassForElement(e,"ui-abs-loading-gif");var o=DomUtil.getBrokenDiv("chart");DomUtil.handleBrokenImage(t,e),e.innerHTML+=o,i.find("image")[0].setAttribute("xlink:href","")}else t[ATTR_CHART.SHEET_ID]&&t[ATTR_CHART.CHART_ID]&&DomUtil.removeClassForElement(e,"ui-abs-loading-gif");r.attr("data-sheet_id",t[ATTR_CHART.SHEET_ID]),i.append(n)}},t=function(e){e[ATTR_IMAGE.I_ID]?void 0:e[ATTR_IMAGE.I_ID]=Utils.getRandomNumber();var t=DomUtil.createSvgImage(e);return editor.getRole().permissions.can("document.edit")&&t.classList.add("zw-chart-image"),t};return{addElements:e,createChartContainer:t}}(),function(e){"use strict";var t=function(e,t){if(e.prev)return e.prev;var i=e.getSection(),n=i.prev;return!n||t&&n.getSectionType()!==t?null:n.children[n.children.length-1]},i=function(e,t){if(e.next)return e.next;var i=e.getSection(),n=i.next;return!n||t&&n.getSectionType()!==t?null:n.children[0]};e.CardCollections=function(e,t){this.scenes=new LinkedList,this.nodeSceneMap={},this.nodeOperations={},this.isSplitter=t.isSplitter,this.mutationobserver="function"==typeof t.mutationobserver?t.mutationobserver:function(){},this.needEventForNonSplitterElems=t.needEventForNonSplitterElems,this.view=t.view,this.getGroup=t.getGroupById,this.getContentGroup=t.getContentGroup;for(var i=0,n=e.length;i<n;i++)e[i].section.getSectionType()===SECTION_TYPES.CONTENT&&this.handleNodeCreation(e[i])},CardCollections.prototype.init=function(){this.boundDocumentNodeAdded=this.handleDocumentNodeAdded.bind(this),this.boundDocumentNodeRemoved=this.handleDocumentNodeRemoved.bind(this),this.boundDocumentNodeModified=this.handleDocumentNodeModified.bind(this),this.subscribeEvents()},CardCollections.prototype.getNodeOperations=function(){return ZWJSONUtils.clone(this.nodeOperations)},CardCollections.prototype.removeNodeOperations=function(e){delete this.nodeOperations[e]};var n=function(e){return{id:e}};CardCollections.prototype.getSceneChildren=function(e){for(var t=DocTreeManager.getTreeNodeById(e),n=(this.nodeSceneMap.length,[]),r=i(t,SECTION_TYPES.CONTENT);r&&!this.isSplitter(r);)n.push(r.id),r=i(r,SECTION_TYPES.CONTENT);return n},CardCollections.prototype.removeFromNodeMap=function(e){delete this.nodeSceneMap[e.id]},CardCollections.prototype.addToNodeMap=function(e){var i=e.id,n=t(e,SECTION_TYPES.CONTENT);n&&(this.isSplitter(n)||this.nodeSceneMap[n.id])&&(this.nodeSceneMap[i]=this.nodeSceneMap[n.id]?this.nodeSceneMap[n.id]:n.id)},CardCollections.prototype.getPrevSceneId=function(e){for(var i=(e.id,t(e,SECTION_TYPES.CONTENT)),n=null;i;){if(this.isSplitter(i)||this.nodeSceneMap[i.id]){n=this.nodeSceneMap[i.id]?this.nodeSceneMap[i.id]:i.id;break}i=t(i,SECTION_TYPES.CONTENT)}return n},CardCollections.prototype.pushIntoScene=function(e){var t=e.id,r=n(t),o=this.getPrevSceneId(e);if(this.scenes.isEmpty()||!o)this.scenes.insertAsFirst(r);else if(o){var a=this.scenes.getItemById(o);this.scenes.insertAfter(r,a)}for(var s=i(e,SECTION_TYPES.CONTENT);s&&!this.isSplitter(s);)this.nodeSceneMap[s.id]=t,s=i(s,SECTION_TYPES.CONTENT)},CardCollections.prototype.deleteScene=function(e){var t=e.id,n=this.scenes.getItemById(t),r=n&&n.prev;this.getSceneIdx(t);n&&this.scenes.remove(n);for(var o=i(e,SECTION_TYPES.CONTENT);o&&!this.isSplitter(o);)r?this.nodeSceneMap[o.id]=r.id:delete this.nodeSceneMap[o.id],o=i(o,SECTION_TYPES.CONTENT)},CardCollections.prototype.getSceneIdx=function(e){if(this.scenes.first){if(this.scenes.first.id==e)return 0;if(this.scenes.last.id==e)return this.scenes.length-1;for(var t=0,i=this.scenes.first,n=i&&i.id;i&&n!=e;)i=i.next,n=i&&i.id,t++;return n==e?t:void 0}},CardCollections.prototype.getSceneIds=function(){var e=[];if(this.scenes.length){var t=this.scenes.first,i=t.next;for(e.push(t.id);i;)e.push(i.id),i=i.next}return e},CardCollections.prototype.getParentSplitterItem=function(e){var t=this.nodeSceneMap[e],i=DocTreeManager.getTreeNodeById(t),n={type:"custom",id:t,node:i,isSplitter:!0};return n},CardCollections.prototype.handleNodeCreation=function(e){var t=e.id,i=this.isSplitter(e);if(i?this.pushIntoScene(e):this.addToNodeMap(e),!i&&!this.needEventForNonSplitterElems)return!1;var n=(i?t:this.nodeSceneMap[t],this.getPrevSceneId(e),{type:OPERATION_TYPE.ADD_NODE,id:t,node:e,isSplitter:i});r.call(this,n)},CardCollections.prototype.deleteNode=function(e,t){var i=e.id,n=this.isSplitter(e);if(n?this.deleteScene(e):this.removeFromNodeMap(e),!n&&!this.needEventForNonSplitterElems)return!1;var o=(n?i:this.nodeSceneMap[i],this.getPrevSceneId(e),this.getSceneIdx(i),{type:OPERATION_TYPE.DELETE_NODE,id:i,node:e,isSplitter:n});r.call(this,o)},CardCollections.prototype.styleChange=function(e){var t=e.id,i=this.isSplitter(e);if(!i&&!this.scenes.getItemById(t))return!1;if(i&&this.scenes.getItemById(t)){var n={type:OPERATION_TYPE.UPDATE_NODE,id:t,node:e,isSplitter:i};r.call(this,n)}else if(i&&!this.scenes.getItemById(t)){var o=this.nodeSceneMap[t];this.removeFromNodeMap(e),this.pushIntoScene(e);var a={type:OPERATION_TYPE.ADD_NODE,id:t,node:e,isSplitter:i};if(r.call(this,a),this.needEventForNonSplitterElems){var s=this.nodeSceneMap[t],l={type:OPERATION_TYPE.UPDATE_NODE,id:o,node:e,isSplitter:i};r.call(this,l)}}else if(!i&&this.scenes.getItemById(t)){this.deleteScene(e),this.addToNodeMap(e);var a={type:OPERATION_TYPE.DELETE_NODE,id:t,node:e,isSplitter:i};if(r.call(this,a),this.needEventForNonSplitterElems){var s=this.nodeSceneMap[t],l={type:OPERATION_TYPE.UPDATE_NODE,id:s,node:e,isSplitter:i};r.call(this,l)}}},CardCollections.prototype.contentModification=function(e){var t=e.id,i=this.isSplitter(e);if(!i&&!this.needEventForNonSplitterElems)return!1;var n={type:OPERATION_TYPE.UPDATE_NODE,id:t,node:e,isSplitter:i};r.call(this,n)},CardCollections.prototype.handleDocumentNodeAdded=function(e){e.section.getSectionType()===SECTION_TYPES.CONTENT&&"para"==e.type&&(this.handleNodeCreation(e),this.mutationobserver("NodeAdded",e))},CardCollections.prototype.handleDocumentNodeRemoved=function(e){e.section.getSectionType()===SECTION_TYPES.CONTENT&&"para"==e.type&&(this.deleteNode(e),this.mutationobserver("NodeRemoved",e))},CardCollections.prototype.handleDocumentStyleUpdated=function(e){e.section.getSectionType()===SECTION_TYPES.CONTENT&&"para"==e.type&&this.styleChange(e)},CardCollections.prototype.handleDocumentContentUpdated=function(e){e.section.getSectionType()===SECTION_TYPES.CONTENT&&"para"==e.type&&this.contentModification(e)},CardCollections.prototype.handleDocumentNodeModified=function(e,t,i,n,r){e.section.getSectionType()===SECTION_TYPES.CONTENT&&"para"==e.type&&t&&("modify"==t?this.handleDocumentContentUpdated(e):"update"==t&&this.handleDocumentStyleUpdated(e),this.mutationobserver("NodeModified",e))};var r=function(e){var t=e.type,i=e.id;if(t==OPERATION_TYPE.DELETE_NODE)this.nodeOperations[i]=e;else if(this.nodeOperations.hasOwnProperty(i)){var n=this.nodeOperations[i],r=n.type;r==OPERATION_TYPE.UPDATE_NODE&&t==OPERATION_TYPE.ADD_NODE&&(this.nodeOperations[i]=e)}else this.nodeOperations[i]=e};CardCollections.prototype.subscribeEvents=function(){PubSub.subscribe("Document/NodeAdded",this.boundDocumentNodeAdded),PubSub.subscribe("Document/NodeRemoved",this.boundDocumentNodeRemoved),PubSub.subscribe("Document/NodeModified",this.boundDocumentNodeModified)},CardCollections.prototype.unsubscribeEvents=function(){PubSub.unsubscribe("Document/NodeAdded",this.boundDocumentNodeAdded),PubSub.unsubscribe("Document/NodeRemoved",this.boundDocumentNodeRemoved),PubSub.unsubscribe("Document/NodeModified",this.boundDocumentNodeModified)},CardCollections.prototype.refresh=function(){this.scenes=new LinkedList,this.nodeSceneMap={},this.nodeOperations={}},CardCollections.prototype.flushAllSceneData=function(){this.unsubscribeEvents(),this.scenes=new LinkedList,this.nodeSceneMap={},this.nodeOperations={}}}(window);var OPERATION_TYPE={ADD_NODE:"addNode",DELETE_NODE:"deleteNode",UPDATE_NODE:"updateNode",STYLE_CHANGE:"styleChange",CONTENT_MODIFY:"contentModification"};!function(e){"use strict";var t={screenplay:["ScreenplayToolbar/Show","Document/CharInserted","Document/ComponentInitialized","Cursor/Collapsed","Cursor/Selected","Toolbar/UpdateToolbar","Document/BeforeKeyDown","Cursor/BeforeKeyDown","Document/LoadingComplete","BeforePanelOpen","Document/ToolbarInitialized","Screenplay/refreshData","DOM/line/added","DOM/line/updated","DOM/line/before/remove","Document/BeforeLoad","Para/Create","Para/Update","Para/Modify","Para/Remove","Reports/close","Reports/open","documentMap/refresh","Document/ModeOpened","HeadingStyle/Add","HeadingStyle/RemoveAll","LeftPanel/StateChange","HeadingStyle/Changed","Document/OpenHistoryMode","Document/Comment/CountUpdated","Document/TC/CountUpdated","Document/ViewportChanged","Writer/SwitchToDarkMode","subpanel-scene","Characters/update","ScreenplayReport/Show","Screenplay/Breakdown/JSPLoaded","ScreenplayBreakDown/LoadLayout","Document/ReviewRightPanel/Loaded","BreakdownLayout/DOMLoaded","Screenplay/Editor/Layout/Init","Screenplay/showStyleDropDown"],insights:["Cursor/Collapsed","Cursor/Selected","Toolbar/UpdateToolbar","Document/ToolbarInitialized"]},i={screenplay:["editor.doc.getSelection","editor.doc.createElement","editor.doc.getContent","editor.doc.createRange","editor.doc.getCharAt","editor.doc.execCmd","editor.doc.getBodyFormat","editor.doc.getDomCursorNode","editor.getDocument","editor.addChar","editor.addFonts","editor.getRole","docProps.info","editor.onResize","EditorView.isWebView","EditorUtil.focusMultiByteSpan","editor.jeditorPane.offset","DocOpBuilder.build","DocOpBuilder.xform","DocOpBuilder.compose","DocOpBuilder.concise","DocLayoutManager.getViews","DocLayoutManager.getCurrentView","DocLayoutManager.getLineAtIndex","DocLayoutManager.getViewAtIdxWithType","DocLayoutManager.getLeftAtIndex","DocLayoutManager.getPageCount","DocTreeManager.doc.getTreeNodeAtIndex","DocTreeManager.getTreeNodeById","DocTreeManager.getAllSectionsByType","DocTreeManager.doc.getLastNonMetaSection","DocTreeManager.doc.getFirstContentSection","DocTreeManager.doc.getAllChildren","DocTreeManager.doc.getAllSectionsByType","DocTreeManager.doc.getTreeNodeById","DocTreeManager.doc.getAllSections","DomViewManager.getDOMElem","DocUtil.copyStyle","DocUtil.getSectionOps","DocUtil.getOldAndNewHFIds","DocUtil.deleteContentSection","DomUtil.scrollElementIntoView","LayoutManager.getCurrentLayout","LayoutManager.isFullscreen","LayoutManager.loadLayout","LayoutManager.addNewLayout","LayoutManager.toggleRichEdit","LayoutManager.isRichEditActive","LeftPanel.getPanelWidth","EditorLayout.updateElemCSS","Utils.encodeHTMLString","Utils.randomString","Utils.randomId","UIUtils.hideLoadingMsg","UIUtils.showLoadingMsg","UIUtils.switchToDarkMode","UIUtils.initComponent","UIUtils.setEditorPaneWrapperHeight","UIUtils._itemClicked","ZWImageUtils.fetchBytes","ZWImageUtils.getImageBytes","ZWJSONUtils.clone","ZWComponentUtil.init","HTMLUtil.insertAfter","HTMLUtil.insertBefore","HTMLUtil.htmlToElement","HTMLUtil.storeImageInFileStore","CurUtil.blinkCursor","FindUtils.getReplaceAllOps","CurUtil.getCursorOffset","HTMLUtil.removeAllChild","HTMLUtil.insertAsFirst","PopupHandler.openPopup","PopupHandler.clearTimeOut","PopupHandler.addPopup","PopupHandler.closePopup","PopupHandler.closeAllPopup","PasteEventHandler.processPaste","PasteEventHandler.setContentInIframe","PasteEventHandler.getDocOp","PasteEventHandler.getPasteInfo","TransLiteration_EventHandler.getCurrentLanguage","TransLiteration_EventHandler.changeLanguage","TransLiteration_EventHandler.toggleTransLiterationState","TransLiteration_EventHandler.isTransliterationEnabled","CommentUtils.isReviewPaneVisible","CommentModels.commentPane.get","TcManager.getCollection","TrackChangeDetails.isEnabled","ReviewPane.switchTab","ReviewPane.toggleRightPane","ReviewUtil.hideUserListPanel","ReviewUtil.showUserListPanel","WordComplete","WordComplete.clearDict","WordComplete.addWord","WordComplete.removeSuggestion","WordComplete.lookupWord","Toolbar.isBold","Toolbar.isItalic","Toolbar.isUnderline","Toolbar.isStrikethrough","ToolbarHandler.handleUIEvents","ToolbarHandler.handleZButtonClick","SmartToolbar.handleCursorCollapse","SmartToolbar.handleWheelEvent","SmartToolbar.handleMouseMove","TopbandHandler.showToolbar","TopbandHandler.hideToolbar","TopbandHandler.getBandHeight","UserPreferences.isPrefered","WC.getCharCountWithSpaces","Op.processMsg","Op.sendMsg","LeftPanel.showSubPanel","LeftPanel.toggleLeftPanel","DesignUI.getDesignName","DesignUtil.applyDesign","StyleUI.getDocumentParaMapping","UIStateHandler.build","ModeManager.getCurrentMode","ModeManager.setCurrentMode","UserPreferences.updateVCTools","ZWRulerController.showHideRuler","StyleUI.getHeadingArr","Module.processElement","ScreenplayToolbar/Open","NamedRange.createRange","Highlighter.createHiliter","Highlighter.getAllHighlightes","NamedRange.removeRangeById","NamedRange.removeAllRanges","NamedRange.getAllRanges","NamedRange.getNamedRangesBetween","NamedRange.modifyRange","Highlighter.hideAllRanges","Highlighter.showAllRanges","Highlighter.removeRange","DomViewManager.getVisiblePageNumbers","DocLayoutManager.getPageAtPageNumber","editor.doc.snapShotManager.setSkipSnapShot","DocUtil.insertTOCBookmark","HTMLBuilder.getDocElementFromDTNode"],insights:["editor.doc.getSelection","editor.doc.execCmd","DocUtil.copyStyle","DocTreeManager.doc.getAllSections","StyleUI.getDocumentParaMapping","UIUtils._itemClicked","UIUtils.initComponent","SmartToolbar.handleCursorCollapse","SmartToolbar.handleWheelEvent","SmartToolbar.handleMouseMove","ToolbarHandler.handleUIEvents","ToolbarHandler.handleZButtonClick","Toolbar.isBold","Toolbar.isItalic","Toolbar.isUnderline","Toolbar.isStrikethrough","TopbandHandler.showToolbar"]},n={screenplay:["DocTreeManager.doc.sectionCollection.orderedSectionList","editorProps.deployment.domain"],insights:[]},r={screenplay:{Element:Element,CardCollections:CardCollections},insights:{}};e.Writer=function(e){this.solutionName=e,this.allowedEvents=t[this.solutionName]||[],this.archivedEvents={},this.allowedFunctionalities=i[this.solutionName]||[],this.allowedVariables=n[this.solutionName]||[],this.classes=r[this.solutionName]||{},this._={}},Writer.prototype.addAllowedFuntions=function(e){this.allowedFunctionalities.push(e)},Writer.prototype.addAllowedVariables=function(e){this.allowedVariables.push(e),this._={}},Writer.prototype.setupVariables=function(){for(var t=0;t<this.allowedVariables.length;t++){var i,n=this.allowedVariables[t],r=n.split("."),o=e,a={};i=a;for(var s=0;s<r.length;s++){if("undefined"==typeof o)throw n+" :: Variable Not Found!!";o=o[r[s]],i.hasOwnProperty(o)||(i[r[s]]={}),s==r.length-1&&(i[r[s]]=o),i=i[r[s]]}this._[r[0]]=a[r[0]]}},Writer.prototype.call=function(){var t=Array.from(arguments),i=t.shift();if(this.allowedFunctionalities.indexOf(i)==-1)throw i+" :: Method Not Authorized!!";for(var n=i.split("."),r=null,o=e,a=0;a<n.length;a++){if("undefined"==typeof o)throw i+" :: Method Not Found!!";r=o,o=o[n[a]]}if("function"==typeof o)return o.apply(r,t);throw i+" :: Method Not Found!!"},Writer.prototype.get=function(t){var i=this.allowedVariables.concat(this.allowedFunctionalities);if(i.indexOf(t)==-1)throw" :: variable Not Authorized!!";for(var n=t.split("."),r=null,o=e,a=0;a<n.length;a++){if("undefined"==typeof o)throw t+" :: variable Not Found!!";r=o,o=o[n[a]]}return o},Writer.prototype.getSegregatedEvents=function(e){var t=[],i=[];return Array.isArray(e)?Array.prototype.forEach.call(e,function(e){this.allowedEvents.indexOf(e)!=-1?t.push(e):i.push(e)}.bind(this)):t.push(e),{allowedEvents:t,notAllowedEvents:i}},Writer.prototype.publish=function(){this.checkArchiveForEventsAndExecute(arguments[0]),PubSub.publish.apply(null,arguments)},Writer.prototype.checkArchiveForEventsAndExecute=function(e){var t=this.archivedEvents[e];({subscribe:this.subscribe,subscribeOnce:this.subscribeOnce,unsubscribe:this.unsubscribe});if("undefined"!=typeof t)for(var i=0;i<t.length;i++){var n=t[i];eventTypes[n.type]([e].concat(n.args))}this.allowedEvents.push(e),delete this.archivedEvents[e]},Writer.prototype.archiveEvents=function(e,t,i){Object.keys(this.archivedEvents);t.shift();for(var n=0;n<e.length;n++){var r=e[n];this.archivedEvents.hasOwnProperty(r)||(this.archivedEvents[r]=[]),this.archivedEvents[r].push({type:i,args:t})}},Writer.prototype.subscribe=function(){var e=this.getSegregatedEvents(arguments[0]),t=e.allowedEvents,i=e.notAllowedEvents;t.length>0?(arguments[0]=t,PubSub.subscribe.apply(null,arguments)):this.archiveEvents(i,arguments,"subscribe")},Writer.prototype.subscribeOnce=function(){var e=this.getSegregatedEvents(arguments[0]),t=e.allowedEvents,i=e.notAllowedEvents;t.length>0?(arguments[0]=t,PubSub.subscribeOnce.apply(null,arguments)):this.archiveEvents(i,arguments,"subscribeOnce")},Writer.prototype.unsubscribe=function(){var e=this.getSegregatedEvents(arguments[0]),t=e.allowedEvents,i=e.notAllowedEvents;t.length>0?(arguments[0]=t,PubSub.unsubscribe.apply(null,arguments)):this.archiveEvents(i,arguments,"unsubscribe")}}(window);var Macros=function(){};Macros.init=function(){this.userData=editor.doc.getUserData(),this.imgLibAppData={}},Macros.getRId=function(){return editor.doc.docInfo.RID},Macros.getDocId=function(){return editor.doc.docInfo.DOCUMENT_ID},Macros.getRIdInParams=function(e){return e.rid=this.getRId(),e},Macros.includeParamsForStats=function(e){return e},Macros.getRIdString=function(){return"&rid="+this.getRId()},Macros.getAction=function(){return"PUBLIC"===editor.doc.getRole()&&editor.doc.docInfo.PUBLISH_SCOPE!=PUBLISH_TYPE.INTERNAL||"ANYONELINK_SHAREDREADFILL"===editor.doc.getRole()?"publicExport":"export"},Macros.getAuthorName=function(){return editor.doc.docInfo.CREATOR},Macros.getImageURLValue=function(e){return rid=this.getRId(),editor.doc.docInfo.ORIGINAL_RID&&(rid=editor.doc.docInfo.ORIGINAL_RID),"r-"+rid+"-"+e},Macros.getImageSrc=function(e){return"image.do?imgurl="+e},Macros.getImageSrcWithRid=function(e){return e&&(rid=this.getRId(),e.startsWith("image.do")&&!editor.isOffline()&&e.indexOf("rid")===-1&&(e=e+"&rid="+rid)),e},Macros.getImageLibRemoteOptions=function(){var e={};return e},Macros.getFormDataValues=function(e){return e.append("rid",this.getRId()),e},Macros.getCurrentUserName=function(){return this.userData[editor.zuid].fname},Macros.getCollabPanelHandlerParams=function(e){return e},Macros.collabPanelGetTranscript=function(){CollabPanelHandler.getTranscript(this.getRId())},Macros.initSoundAndPlay=function(){"undefined"==typeof window.sound&&(window.sound={},sound.alert=new Audio(cdnZWStaticPath+fingerPrintObj["sound/alert.wav"]),sound.ascending=new Audio(cdnZWStaticPath+fingerPrintObj["sound/ascending.wav"]),sound.beep=new Audio(cdnZWStaticPath+fingerPrintObj["sound/beep.wav"]),sound.cuckoo=new Audio(cdnZWStaticPath+fingerPrintObj["sound/cuckoo.wav"]),sound.doorbell=new Audio(cdnZWStaticPath+fingerPrintObj["sound/doorbell.wav"]),sound.event=new Audio(cdnZWStaticPath+fingerPrintObj["sound/event.wav"]),sound.phonering=new Audio(cdnZWStaticPath+fingerPrintObj["sound/phonering.wav"]),sound.shaker=new Audio(cdnZWStaticPath+fingerPrintObj["sound/shaker.wav"]),sound.techno=new Audio(cdnZWStaticPath+fingerPrintObj["sound/techno.wav"]),sound.xylo=new Audio(cdnZWStaticPath+fingerPrintObj["sound/xylo.wav"])),"undefined"!=window.sound[w_usersettings.SOUNDPREF]&&window.sound[w_usersettings.SOUNDPREF].play()},Macros.getPreviewURL=function(e){return e+="/preview/"+this.getRId()},Macros.getPrintPreviewURL=function(e){return e+="/print/"+this.getRId()+"?"},Macros.getPDFDownloadURL=function(e,t,i,n,r){var o="/"+Macros.getContextName()+"/jsp/export.jsp?FORMAT="+r+"&IS_ATTACHMENT="+e+"&IS_PRINT="+t+"&cookietoken="+i+"&TARGET="+n;return o},Macros.getRsidAndLang=function(){},Macros.updateSaveButton=function(){UIUtils.updateSaveButton("disable"),UIUtils.showDocStatusIcon()},Macros.setUserSettings=function(){},Macros.getRidAndRsidInParams=function(e){return this.getRIdInParams(e)},Macros.sendStats=function(){var e={},t=editor.docClientInfo,i=ZWNetworkUtils.getNiceUrlPrefix("doc/stats/"+this.getRId());t.PAGE_COUNT=DocLayoutManager.getPageCount(),DocTreeManager.doc&&(t.ENDNOTE_LEN=DocTreeManager.getEndNoteCount(),t.FOOTNOTE_LEN=DocTreeManager.getFootNoteCount()),e.docinfo=JSON.stringify(t),J.ajax({type:"POST",global:!1,async:!1,url:i,data:e,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},error:function(){},success:function(e){}})},Macros.publishBuildChange=function(e,t){var i=function(){var t=e.getResponseHeader("zw-reload");PubSub.publish("Server/BuildChange",{force:"true"==t})},n=e.getResponseHeader("role");if(n){var r=n.split(",");r.indexOf(editor.doc.getRole())>-1&&i()}else i()},Macros.getUUID=function(e){return e.sid=editor.uuid,ZWNetworkUtils.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("userSettings/chatbar"),data:e,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}}),e},Macros.saveDoc=function(e){WebUtil.saveDocumentCurrentVersions(e)},Macros.getRsidLangAction=function(e){return e.rid=this.getRId(),e.action="normal",e},Macros.showMessagePopup=function(e,t){UIUtils.showMessagePopup(J.i18n("common","SESSION_RELOADDOCUMENT"),e,"info",t,!0)},Macros.getRequestUrl=function(){var e=window.location.protocol+"//"+window.location.host+"/writer/images/common";return e},Macros.triggerNotification=function(){var e={};e.rid=editor.doc.docInfo.RID,e.contentEdited=ZWCollaboration.contentEdited,e.starting_version_id=ZWCollaboration.startingVersionId,ZWNetworkUtils.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/notificationrule"),data:e,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})},Macros.getNiceUrl=function(){return ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/util/errorlog")},Macros.getRsidOnly=function(e){return e},Macros.getType=function(){return"doc"},Macros.getUserZuid=function(){return editor.zuid},Macros.getRIdAndUname=function(e){return e.rid=this.getRId(),e.uname=editor.zuid,e},Macros.onBeforeUnload=function(e){return MsgDialog.isHardReloadDialogShown()||!ZWCollaboration.msgQueue||!ZWCollaboration.msgQueue.isAckPending()||ZWOffline.isOfflineOperationsAllowed()&&"TEMPLATE_USER"!==e?"undefined"!=typeof CommentManager&&CommentManager.isUnposted()?J.i18n(UIUtils.getUIText("UNPOST_COMMENTS")):ZWOffline.isOfflineOperationsAllowed()&&ZWOffline.isDBOperationsPending()?J.i18n("writer.remotesave.DOCUMENT_UNSAVED"):void 0:J.i18n("writer.remotesave.DOCUMENT_UNSAVED")},Macros.pubSubAction=function(e){var t=editor.doc.docInfo;if("undefined"!=typeof MailMergeUtil&&MailMergeUtil.isPreviewMode())PubSub.publish("Document/Warning",WARNING_MSG.UNABLE_TO_LOAD_CONTENT_IN_MAILMERGE_PREVIEW);else if(editor.getView()==EDITOR_VIEWS.HISTORY)PubSub.publish("Document/HistoryLoadError",e);else if(t.newDoc||1==editor.docStatus){var i={init:function(){document.getElementById("repairdocdlg-title").innerHTML=J.i18n("writer.error.SOMETHING_WENT_WRONG")}};if(J.dialogutil.open("repairdocdialog","",i),editor.isHardReload){var n="LOADING FAILURE";ZWLogger.sendErrorDetails("LOADING FAILURE<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No =LOADING FAILURE DOC len ="+editor.doc.getDocumentLength()+" RID ::: "+Macros.getRId()+" buildLabel::: "+buildLabel+"\n Error Log End \n<ZWERROR>"+ZWCollaboration.mailInfo,null,n)}}else if(is_handheld&&editor.doc.docInfo.PUBLISH_SCOPE==PUBLISH_TYPE.INTERNAL)editor.isHardReload&&ZWLogger.sendErrorDetails("LOADING FAILURE<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No =LOADING FAILURE DOC len ="+editor.doc.getDocumentLength()+" RID ::: "+Macros.getRId()+" buildLabel::: "+buildLabel+"\n Error Log End \n"),UIUtils.showMessagePopup(J.i18n("common","DOCUMENT_CORRUPTED_REMOTE"),J.i18n("error","SOMETHING_WENT_WRONG"),"error",reload);else{var r=ZWNetworkUtils.getNiceUrlPrefix(Macros.getRId()+"/repair"),o={};J.ajax({type:"POST",dataType:"json",url:r,data:o,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(e){var t={};t.content=e.fileContent,t.info=e.docInfo,editor.docStatus=1,editor.processFetchResponse(t,editor.isHardReload)},error:function(e,t,i){PubSub.publish("Document/LoadingError",e.status)}})}},Macros.ctrlSave=function(e,t){return DomUtil.stopEvent(t),!1},Macros.review={addParticipant:function(){var e={};e.time=(new Date).getTime(),ZWNetworkUtils.ajax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix(Macros.getRId()+"/util/addparticipant"),async:!0,data:e,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})},getAccessType:function(){return"login"},setTcView:function(e,t,i){var n={};n.tc_view=e,J.ajax({type:"POST",url:ZWNetworkUtils.getUrl("updatetcview"),data:n,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(i){t&&t(e)},error:function(e,t,n){i&&i()}})}},Macros.isShareListAvailable=function(){return!0},Macros.proofing={initUserData:function(){},getCache:function(e,t,i){var n=DocLocaleHandler.getLanguage();n=Proofing.isSupportedLanguage(n)?n:Proofing.getDefaultLang();var r=ZWNetworkUtils.getNiceUrlPrefix("proofingdata/"+Macros.getType()+"/"+Macros.getRId()+"/"+n);J.ajax({type:"POST",url:r,data:e,dataType:"json",error:i,success:t,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})},ignoreAll:function(e,t,i){J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix(Macros.getType()+"/"+Macros.getRId()+"/proofing/sp/ignoreall"),data:e,dataType:"json",error:i,success:function(){t(e.lang,e.words)},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})},ignoreSuggestion:function(e,t,i){J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix(Macros.getType()+"/"+Macros.getRId()+"/proofing/suggestion/ignoreall"),data:e,dataType:"json",error:i,success:function(){t(e.lang,e.words)},beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)}})},getDictionaryWords:function(e,t){CustomDictionary.fetchWords(e,t)},canDetectLanguage:function(){return!0},setProofingData:function(e,t,i){var n={};n.settings=JSON.stringify(e),n.configurations=JSON.stringify(t),J.ajax({type:"POST",url:ZWNetworkUtils.getUrl("updateproofingdata"),data:n,dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(n){i&&i.success(e,t)},error:function(e,t,n){i&&i.failure()}})}},Macros.getActivityUrl=function(e,t){return"/"+Macros.getContextName()+"/doc/activities/"+e+"/"+t},Macros.getActivityTrackUrl=function(e,t){var i="";return t&&(i=Macros.getRId()+"/"),"/"+Macros.getContextName()+"/doc/activities/"+i+e},Macros.getNewActivityUrl=function(){return"/"+Macros.getContextName()+"/activities"},Macros.getBatchActivityUrl=function(){return"/"+Macros.getContextName()+"/"+Macros.getType()+"/"+Macros.getRId()+"/batch/activities"},Macros.getInternalActivityUrl=function(){for(var e,t=window.location.search.split("&"),i=0,n=t.length;i<n;i++)t[i].indexOf("iscsignature=")!=-1&&(e=t[i].replace("iscsignature=",""));return"/writer/internal/activities?iscsignature="+e},Macros.getIntergationActivityUrl=function(){return"/writer/integration/activities"},Macros.getChartActivityUrl=function(){return"/writer/"+Macros.getType()+"/"+Macros.getRId()+"/chart/activities"},Macros.isGlobalSettingsAvailable=function(){return!0},Macros.isMergeTemplate=function(){return"MERGE_TEMPLATE"==editorProps.permissionsInfo.appInfo.document_type||"MERGE_PDF_TEMPLATE"==editorProps.permissionsInfo.appInfo.document_type},Macros.isFormsTemplate=function(){return!1},Macros.isVerticalIntegration=function(){return!1},Macros.isPDFDocument=function(){return!!editorProps.permissionsInfo.appInfo.is_pdf_form},Macros.isSignTemplate=function(){return"SIGN_TEMPLATE"==editorProps.permissionsInfo.appInfo.document_type||"SIGN_PDF_TEMPLATE"==editorProps.permissionsInfo.appInfo.document_type},Macros.isFillableTemplate=function(){return!(!editorProps.IS_FILLABLE_FORM&&!editorProps.options.IS_FILLABLE_FORM)},Macros.canDisplayChangesLink=function(e){var t={};ZWNetworkUtils.setCsrfParam(t),J.ajax({type:"POST",dataType:"json",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/version/candisplaychangeslink"),data:t,success:e})},Macros.getUserColors=function(e,t,i){var n={};J.ajax({type:"GET",url:ZWNetworkUtils.getNiceUrlPrefix(editor.doc.docInfo.RID+"/getusercolors"),data:n,dataType:"json",success:function(t){e(t.usercolors)},error:function(e,n,r){t(r,i)}})};var savedToPartner=!0;Macros.isDocumentPushedToPartner=function(){return savedToPartner},Macros.updatePartnerSaveStatus=function(e){savedToPartner=e},Macros.saveUserMode=function(e){if(!editor.isOffline()){var t=editor.doc.docInfo,i={};i.rid=t.RID,i.mode=e,J.ajax({type:"POST",url:ZWNetworkUtils.getNiceUrlPrefix("user/settings/switchmode"),data:i,beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(t){editor.doc.userData[editor.zuid].editor_mode=e,editor.doc.userData[editor.zuid].editor_mode=e},error:function(e){}})}},Macros.createAddFontButton=function(){var e="<div id='addmorefonts' zui-disable='state.offline' class='moreOptions clearfix'><span class='ui-fr' style='float:left'>"+J.i18n("common","ADD_FONTS")+"</span></div>";return{innerHTML:e,isFooter:!0,itemType:"custom"}},Macros.getUrl=function(){return editor.getBaseURL()+"/pdfview/"+editor.doc.docInfo.RID},Macros.changeDialog=function(){editor.sendBugReport(),document.getElementById("repairdocdlg-title").innerHTML=J.i18n("writer.common.ERROR_REPORTED"),document.getElementById("repairdocdlg-msg").innerHTML=J.i18n("writer.common.WRITE_TO_US"),J(".ui-repairdialog").addClass("ui-repairdoc-err-reported-cont")},Macros.isRemote=function(){return!1},Macros.createNewFile=function(e){window.open(editor.getBaseURL()+"/new?from=menu&rid="+editor.doc.docInfo.RID+(e&&"&resource_type="+e||""))},Macros.getDocsUrl=function(){return"https://"+editor.docsServerURL},Macros.getContextName=function(){return"writer"},Macros.getUpgradeUrl=function(){return location.protocol+"\\\\"+editor.docsServerURL+"/showplan.do"},Macros.getAppType=function(){return"writer"},Macros.getPanelUrl=function(e){return e},Macros.getPrePasteCheckList=function(){return["isListItemSelection"]},Macros.getPasteEventListeners=function(){return["videoEmbed","imagePaste","tablePaste","textOnlyPaste","normalPaste"]},Macros.getDocumentType=function(){return"writer"},Macros.initFolderChooser=function(e){WDHandler.loadLocation(e.operation||{})},Macros.openShareDialog=function(){var e=!(!editor.doc.getRole()||"COOWNER"!==editor.doc.getRole());WDHandler.showShareForm("zw",Utils.getDocumentId(),e),ZWLogger.addToStatistics("Share")},Macros.getResourceLinkUrl=function(e){if(e.startsWith(ATTR_LINK.RELATIVE_LINK_CONST_VAL)){var t=e.substring(e.indexOf("/")+1);return ZWNetworkUtils.getHostURL()+"/"+editorProps.docMgmtInfo.context+"/open/"+t}return e},Macros.getCloudPickerServices=function(){return editor.cloudPickerServices},Macros.getUserModeParams=function(e){var t={};return t.zuid=e,t},Macros.isWorkDriveDocument=function(){return!1},Macros.isWriterImage=function(e){return e&&(e.indexOf("image.do")!==-1||e.indexOf("remoteImage.do")!==-1)},Macros.getBaseURL=function(){return editor.base_url+"/"},Macros.getReferenceURL=function(e){return regEx=/image.do/i,regEx.test(e)?e.split(/=|&/)[1]:""},Macros.isCropAllowed=function(){return!0},Macros.isFloatAllowed=function(){return!0},Macros.getDefaultDesignName=function(){return"The Writer"},Macros.getDocumentType=function(){return"writer"},Macros.processPaste=function(){PasteEventHandler.processPaste()},Macros.defaultLeftPanel=function(){if(!LayoutManager.isRichEditActive()&&Macros.isPDFDocument()){if(Macros.isMergeTemplate())return ELEM_ID.MMPANEL;if(Macros.isFillableTemplate())return ELEM_ID.INSERTFILLABLEFIELDS;if(Macros.isSignTemplate())return ELEM_ID.INSERTSIGNERFIELDS}return Macros.isPDFDocument()&&Macros.isMergeTemplate()?ELEM_ID.MMPANEL:ELEM_ID.FORMATPANEL},Macros.getPasteSectionConfig=function(){return{main:{text:{excludeStyles:[]},footnoteSection:{excludeStyles:[ATTR_TEXT.TS_VA]},endnoteSection:{excludeStyles:[ATTR_TEXT.TS_VA]}},header:{comment:{isAllowed:!1},endnoteSection:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS,ATTR_TEXT.TS_VA]},footnoteSection:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS,ATTR_TEXT.TS_VA]},input:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS]},signerField:{isAllowed:!0,excludeStyles:[]},bookmark:{isAllowed:!1}},noteSection:{comment:{isAllowed:!1},endnoteSection:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS,ATTR_TEXT.TS_VA]},footnoteSection:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS,ATTR_TEXT.TS_VA]},input:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS]},signerField:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS]},bookmark:{isAllowed:!1},image:{isAllowed:!1},table:{isAllowed:!1}},textbox:{comment:{isAllowed:!1},endnoteSection:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS,ATTR_TEXT.TS_VA]},footnoteSection:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS,ATTR_TEXT.TS_VA]},input:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS]},signerField:{isAllowed:!1,excludeStyles:[ATTR_COMMON.CLS]},bookmark:{isAllowed:!1},image:{isAllowed:!0},table:{isAllowed:!0},shape:{isAllowed:!1},textBox:{isAllowed:!1}}}},Macros.panelReferesh=function(){},Macros.getSheetGridURL=function(e){var t=e.rid,i=e.activeSheet?"/sheets/"+e.activeSheet:"",n=e.activeCell?"/ranges/"+e.activeCell:"";return editorProps.urls.zohoSheetURL+"/sheet/grid/"+t+i+n},Macros.beforePasteHandling=function(){},Macros.savePasteOpnInfo=function(e){var t=document.getElementById("pasteFrame"),i=t.contentWindow.document.body,n=(i.childNodes.length,PasteUtil.isListPaste(i)),r={sameDocSameListPaste:!1,sameDocNonListPaste:!1,sameDocDiffListPaste:!1,DiffDocDifflistPaste:!1,DiffDocNonListPaste:!1,normalPaste:!1,chartPaste:!1,tablePaste:!1,imagePaste:!1,sheetTablePaste:!1,textPaste:!1},o=PasteUtil.isSameDocumentPaste(i),a=ListUtils.isList(e.cursorFormats.paraFormat);if(e.content.html||e.content.imageItem||!e.content.text)if(n)if(o)if(a){var s=i.childNodes[0].getAttribute("data-list-id");s==e.cursorFormats.paraFormat[ATTR_PARAGRAPH.LS_DATA].id?r.sameDocSameListPaste=!0:r.sameDocDiffListPaste=!0}else r.sameDocNonListPaste=!0;else a?r.DiffDocDifflistPaste=!0:r.DiffDocNonListPaste=!0;else ChartHandler.isChartFromSheet(e.content.html)?r.chartPaste=!0:PasteUtil.isImagePaste(i)?r.imagePaste=!0:!Macros.isRemote()&&ChartHandler.isTableFromSheet(e.content.html)?r.sheetTablePaste=!0:r.normalPaste=!0;else r.isTextOnly=!0;e.pasteOpnInfo=r},Macros.shouldShowPasteToolbar=function(){return"undefined"!=typeof PasteEventHandler.getRecentPasteOption()},Macros.isScreenplayPaste=function(){return!1},Macros.getCursorFmtForPaste=function(){},Macros.handleCharInsert=function(e){"@"==e?PopupHandler.openPopup("inlineInsert"):PopupHandler.clearTimeOut("inlineInsert")},Macros.setImgLibAppData=function(e){this.imgLibAppData=e},Macros.getImgLibAppData=function(){return this.imgLibAppData||{}},Macros.onZiaPanelOpen=function(){ZiaPanelProofing.fillZiaPanelContainerContent(),ZiaPanelProofing.UpdateGreetingText.start(),ZiaPanelProofing.updateZiaPanel(),PubSub.subscribe(["Document/SpellCheck/Toggled","Document/Proofing/LanguageChanged","DocumentContent/LanguageDetected"],ZiaPanelProofing.updateZiaPanel),PubSub.subscribe(["Document/AfterContentInsertion","Document/AfterContentDeletion","ProofingManager/Para/AllDetailsIdentified"],ZiaPanelProofing.updateZiaPanel,{async:!0,timeout:2e3})},Macros.onZiaPanelClose=function(){ZiaPanelProofing.UpdateGreetingText.stop(),ZiaPanelProofing.detachCards(),PubSub.unsubscribe(["Document/SpellCheck/Toggled","Document/Proofing/LanguageChanged","DocumentContent/LanguageDetected"],ZiaPanelProofing.updateZiaPanel),PubSub.unsubscribe(["Document/AfterContentInsertion","Document/AfterContentDeletion","ProofingManager/Para/AllDetailsIdentified"],ZiaPanelProofing.updateZiaPanel,{async:!0,timeout:2e3})},Macros.onZiaSubPanelOpen=function(e){ZiaPanelProofing.openZiaSubPanel(e)},Macros.onZiaSubPanelClose=function(){ZiaPanelProofing.closeZiaSubPanel()},Macros.getEventMethodForSmarttoolbar=function(){var e={"Cursor/Selected":{method:SmartToolbar.handleSelection,param:{async:!0,timeout:100}},"Cursor/Collapsed":{method:SmartToolbar.handleCursorCollapse,param:{async:!0,timeout:100}},"Editor/WheelEvent":{method:SmartToolbar.handleWheelEvent},"Document/MouseMove":{method:SmartToolbar.handleMouseMove}};return e},Macros.isRulerAllowed=function(){return editor.getRole().permissions.can("document.edit")&&!EditorView.isWebView()&&!LayoutManager.isFullscreen()&&(UserPreferences.isPrefered("ruler")||ModeManager.getCurrentMode()==EDITOR_MODES.COMPOSE&&LayoutManager.isRichEditActive())},Macros.getAutoCorrectOnEnter=function(){return{}},Macros.getAddCharTextNode=function(e){return editor.doc.createElement(NODE_TYPE.TEXT,e)},Macros.getDesignStylesLimit=function(){return 106},Macros.getCheckListImgPath=function(e){return"/"+Macros.getContextName()+"/"+e},Macros.canCreateCustomFontSubMenu=function(){return!0},Macros.openDashboard=function(){FileMenu.goToWriterHomePage()},Macros.getHilighterDetails=function(e){return Highlighter.getHiliteDetails(e)},Macros.joinCollaboration=function(){editor.doc.getRole()!=USER_ROLE.PUBLIC&&EditorUtil.joinCollaboration()},Macros.handleBeforeKeydown=function(){return!0},Macros.shouldAllowTOCForHeading=function(e){return!0},Macros.skipToApplyDefaultParaFormats=function(){return!0},Macros.handleTagInfo=function(){};var PageBorders=function(){var e=!1,t=!1,i=!1,n=!1,r=!1,o=!1,a=null,s=null,l=function(e){var t=DomViewManager.getDOMElem(e);if(t){var i=t.getElementsByClassName("page-border-div")[0];if(i)d(i,e);else{var n=document.createElement("div");n.style["pointer-events"]="none",n.style.position="absolute",n.style.top="0px",n.style.left="0px",J(n).addClass("page-border-div"),d(n,e),J(n).appendTo(t)}}},d=function(e,t){var i={},n=t.getPageBorders(),r=n[ATTR_BORDERS.BORDER_TOP],o=n[ATTR_BORDERS.BORDER_RIGHT],a=n[ATTR_BORDERS.BORDER_BOTTOM],s=n[ATTR_BORDERS.BORDER_LEFT],l=new ViewRect(t,RECT.BORDER).rects[0];if(l){if(i.height=l.height+"px",i.width=l.width+"px",i["margin-top"]=l.top+"px",i["margin-left"]=l.left+"px","image"!==n[ATTR_BORDERS.BORDER_TYPE]){i["border-image"]="",i["-webkit-border-image"]="",i["-moz-border-image"]=";",i["-o-border-image"]="",i["border-top"]=r.width+"px "+r.type+" "+r.color,i["border-left"]=s.width+"px "+s.type+" "+s.color,i["border-right"]=o.width+"px "+o.type+" "+o.color,i["border-bottom"]=a.width+"px "+a.type+" "+a.color;var d=l.borderRadius;d&&(i["border-top-left-radius"]=(d["br-topLeft"]||0)+"px",i["border-top-right-radius"]=(d["br-topRight"]||0)+"px",i["border-bottom-left-radius"]=(d["br-bottomLeft"]||0)+"px",i["border-bottom-right-radius"]=(d["br-bottomRight"]||0)+"px")}else{i["border-radius"]="",i.border=r.width+"px solid transparent";var c=isHeadlessPDF?"stretch":n[ATTR_BORDERS.BORDER_DATA].repeat,u=n[ATTR_BORDERS.BORDER_DATA].slice,g=imgCdnZWStaticPath;i["border-image"]="url('"+g+fingerPrintObj["images/common/pageborder/svg/"+r[ATTR_BORDERS.TYPE][ATTR_BORDERS.B_SVG]+".svg"]+"') "+u+" "+c,i["-webkit-border-image"]="url('"+g+fingerPrintObj["images/common/pageborder/svg/"+r[ATTR_BORDERS.TYPE][ATTR_BORDERS.B_SVG]+".svg"]+"') "+u+" "+c,i["-moz-border-image"]="url('"+g+fingerPrintObj["images/common/pageborder/svg/"+r[ATTR_BORDERS.TYPE][ATTR_BORDERS.B_SVG]+".svg"]+"') "+u+" "+c,i["-o-border-image"]="url('"+g+fingerPrintObj["images/common/pageborder/svg/"+r[ATTR_BORDERS.TYPE][ATTR_BORDERS.B_SVG]+".svg"]+"') "+u+" "+c}J(e).css(i)}},c=function(a){if(DocLayoutManager.hasBorderInAtLeastOneSection()){var l=W(a.target).parents(".zw-page")[0];if(!l)return;var d=DomViewManager.getViewData(l),c=DocLayoutManager.getPageWithId(d.docViewId);if(!c)return;var u=c.getPageBorders(),g=l.querySelector(".page-border-div");if(g){var h=a.clientX,p=a.clientY,E=u[ATTR_BORDERS.BORDER_TOP]?parseInt(u[ATTR_BORDERS.BORDER_TOP].width):0,T=u[ATTR_BORDERS.BORDER_BOTTOM]?parseInt(u[ATTR_BORDERS.BORDER_BOTTOM].width):0,O=u[ATTR_BORDERS.BORDER_LEFT]?parseInt(u[ATTR_BORDERS.BORDER_LEFT].width):0,m=u[ATTR_BORDERS.BORDER_RIGHT]?parseInt(u[ATTR_BORDERS.BORDER_RIGHT].width):0;s=J(g);var I=s.offset(),D=s.height(),R=s.width();t?f(a,c):(i=!1,n=!1,r=!1,o=!1,e=!0,0!=E&&p>=I.top&&p<=I.top+E?(editor.editorPaneContainer.css("cursor","row-resize"),r=!0):0!=O&&h>=I.left&&h<=I.left+O?(editor.editorPaneContainer.css("cursor","col-resize"),i=!0):0!=m&&h>=I.left+O+R&&h<=I.left+R+O+m?(editor.editorPaneContainer.css("cursor","col-resize"),n=!0):0!=T&&p>=I.top+D+E&&p<=I.top+D+E+T?(editor.editorPaneContainer.css("cursor","row-resize"),o=!0):(e=!1,editor.editorPaneContainer.css("cursor","")))}}},u=function(t,i){e&&h(i)},g=function(a,l){t=!1,e&&E(a,l),p(),s=null,e=!1,r=!1,o=!1,n=!1,i=!1},h=function(e){t=!0,a=document.createElement("div");editor.jeditorPane.offset();pageBorderOffset=s.offset();var i=s.parent();if(pageOffset=i.offset(),r||o){var n=e.clientY-pageOffset.top+"px",l="0px",d=i.width()+"px",c="1px";a.style["border-top"]="1px dotted blue"}else{var n="0px",l=e.clientX-pageOffset.left+"px",d="1px",c=i.height()+"px";a.style["border-left"]="1px dotted blue"}J(a).css({width:d,height:c,position:"absolute",top:n,left:l,"pointer-events":"none"}),a.setAttribute("id","borderResizeeDiv"),i.append(a)},f=function(e,t){var n=t.getMargin(),l=s.parent();if(a)if(r||o){var d=e.clientY-pageOffset.top;if(r){var c=t.getHeader(),u=c&&c.getNode().hasContent(),g=u?c.headerTop:t.getContentTop();if(d>g)return}else{var h=t.getFooter(),f=h&&c.getNode().hasContent(),p=f?h.footerBottom:n.bottom;if(d<l.height()-p)return}J(a).css("top",e.clientY-pageOffset.top)}else{var E=e.clientX-pageOffset.left;if(i){if(E>t.getContentLeft())return}else if(E<t.getContentLeft()+t.getContentWidth())return;J(a).css("left",e.clientX-pageOffset.left)}},p=function(){a&&(a.remove(),a=null)},E=function(e,t){var l=J(t.srcElement).parents("div.zw-page")[0],d=l&&DomViewManager.getDocView(l),c=d.getFirstSection(SECTION_TYPES.CONTENT),u=d.getGroup();c||(c=u.getFirstSection());var g=u.getBorders(),h=c.getMargin(),f=d.getContentTop()||0,p=c.getLeft()||0,E=c.getRight()||0,T=h.bottom||0,O=parseInt(a.style.top),m=parseInt(a.style.left),I=s.parent(),D=I.width(),R=I.height(),S={},C=d&&d.getHeader(),A=d&&d.getFooter(),v=C&&C.getNode().hasContent(),_=A&&A.getNode().hasContent();v&&(f=C.headerTop),_&&(T=A.footerBottom);var P="normal"!==g[ATTR_BORDERS.BORDER_TYPE];if(r){var N=f-O,b=["border-top"];S=N>=0&&N<=f?PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(N)+"px"):N>=f?PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(f)+"px"):PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(0)+"px")}else if(o){var N=O-(R-T),b=["border-bottom"];S=N>=0&&N<=T?PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(N)+"px"):N>T?PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(T)+"px"):PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(0)+"px")}else if(i){var N=p-m,b=["border-left"];S=N>=0&&N<=p?PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(N)+"px"):N>=p?PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(p)+"px"):PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(0)+"px")}else if(n){var N=m-(D-E),b=["border-right"];if(N>=0&&N<=E)S=PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(N)+"px");else if(N>=E)S=PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(E)+"px");else{var b=["border-right"];S=PageLayoutPanel.constructBorderData(P,b,"space",parseFloat(0)+"px")}}if(S){var L={};L.borders=S.PAGE_BORDERS;var w=editor.getDocument();editor.doc.execCmd("updatesectionstyle",[{sectionNodes:[c.getNode()],styles:L},w]),w.sync(),PubSub.publish("Document/pageBorder/resized")}},T=function(e){var t=DomViewManager.getDOMElem(e);if(t){var i=W(t).find(".page-border-div")[0],n=e.getPageBorders();if(null==n)return void(i&&i.remove());DocLayoutManager.isFixedView()&&(DocLayoutManager.toggleFixedView(),PubSub.publish("Document/view/changed"));var r=e.getRelativePageNumber();editorProps.isWebLayout||editorProps.isFixedLayout||!(n[ATTR_BORDERS.BORDER_DISPLAY]===ATTR_PAGEBORDERS.FIRST_PAGE_ONLY&&1===r||n[ATTR_BORDERS.BORDER_DISPLAY]===ATTR_PAGEBORDERS.EXCEPT_FIRST_PAGE&&1!==r||n[ATTR_BORDERS.BORDER_DISPLAY]===ATTR_PAGEBORDERS.ALL_PAGES)?i&&J(i).remove():i?d(i,e):l(e)}},O=function(){for(var e=DocLayoutManager.getFirstPage();e;)T(e),e=DocLayoutManager.getNextPage(e)};(function(){PubSub.subscribe("Document/SwitchSection",O),PubSub.subscribe("Editor/MouseMove",c),PubSub.subscribe("Editor/MouseDown",u),PubSub.subscribe("Editor/MouseUp",g)})();return{updatePageBorders:T}}(),Module=function(e,t,i,n){"use strict";var r={},o={},a={LOADING_GIF:"ui-abs-loading-gif"},s=function(e){for(var t=e.html||[],i=[],n=0,r=t.length;n<r;n++){var o=t[n];if(o.hasOwnProperty("progressContainer"))i=i.concat(o.progressContainer);else{var a=o.container;a&&i.push(a)}}return i},l=function(e){for(var t=e.html||[],i=[],n=0,r=t.length;n<r;n++){var o=t[n],a=o.url||[];i=i.concat(a)}return i},d=function(e){for(var t=[],i=l(e),n=0,r=i.length;n<r;n++){var o=f(i[n]);t.push(o)}return t},c=function(e){var t=document.createElement("script"),i=e.innerHTML;""!==i?t.innerText=i:(t.type="text/javascript",t.src=e.src),document.head.appendChild(t)},u=function(e){for(var t=0;e[t];){var i=e[t];DomUtil.nodeNameEquals(i,"script")&&"text/javascript"==i.type?(c(i),e.splice(t,1)):t++}for(var n=e.find("script"),r=0,o=n.length;r<o;r++)"text/javascript"==n[r].type&&(c(n[r]),W(n[r]).remove())},g=function(e,t){for(var i=Object.keys(e),n=o[t],r=0,a=i.length;r<a;r++){var s=i[r],l=n[s]?W.get(n[s]):W(document.body),d=W.createDOM(e[s]);u(d),d.appendTo(l)}},h=function(){var e=arguments[0];if(e){var t=i.getAsFunction(e).fn,n=Array.prototype.slice.call(arguments,1);t.apply(null,n)}},f=function(i){var n={};if(editor&&"function"==typeof editor.isOffline&&editor.isOffline())n.action="offline",n.role="OFFLINE";else if("undefined"!=typeof isDashboard&&isDashboard===!0){n.action="dashboard";var r=JSON.stringify({role:"TRYEDITOR_WRITER",appname:"WRITERDEMO",document_type:"GENERIC"});n.app_role_info=r}else t.getRsidLangAction(n);return i=e.getHostURL()+e.getContextUrl(i),e.getUrlWithQueryParams(i,n)},p=function(e){var t=r[e],i=s(t);if(i.length)for(var n=0,l=i.length;n<l;n++){var d=i[n];W.get(d).addClass(a.LOADING_GIF)}var c={};o[e]=c;for(var u=t.html||[],n=0,g=u.length;n<g;n++)for(var h=u[n],p=h.url||[],d=h.container,E=0,T=p.length;E<T;E++){var O=f(p[E]);c[O]=d}},E=function(e){delete o[e]},T=function(e,t,i){var n=r[e],o=s(n);if(o.length)for(var l=0,d=o.length;l<d;l++){var c=o[l];W.get(c).removeClass(a.LOADING_GIF)}var u=arguments[arguments.length-1]||{};g(u,e),h(n.init,t,i)},O=function(e){var t=new Deferred,i=function(){t.resolve.apply(t,arguments)},n=function(){t.reject()},r={js:e.js||[],css:e.css||[],html:d(e)};return zw.require(r,[],i,n),t.promise()},m=function(e,t,i){for(var n=new Deferred,r=e.dependsOn||[],o=[],a=0;a<r.length;a++){var s=ZWJSONUtils.clone(i)||{};s.fromDependsOn=!0;var l=I(r[a],t,s);o.push(l)}return Deferred.when.apply(null,o).then(function(){n.resolve()},function(e){var t=new Error("\nError in Fetching Dependency Resources: "+e);n.reject(t)}),n.promise()},I=function(e,t,i){var n=r[e],o=new Deferred,a=function(e){var t=new Error("\nError in Processing Module: "+e);o.reject(t)},s=m(n,t,i);return s.then(function(){h(n.onBeforeLoad,t,i),n.promise&&"rejected"!=n.promise.state()||(p(e),n.promise=O(n,t,i),n.promise.done(T.bind(null,e,t,i)).always(E.bind(null,e))),n.promise.then(function(){h(n.onAfterLoad,t,i),o.resolve()},a)},a),o.promise()},D=function(e){extend(r,e);for(var t=Object.keys(e),i=0,o=t.length;i<o;i++){var a=e[t[i]];a.listerners=a.listerners||{};for(var s=a.listerners,l=a.trigger||[],d=0,c=l.length;d<c;d++){var u=l[d],g=s.eventListener||R.bind(null,t[i]);n.subscribe(u,g),s.eventListener=g}}},R=function(e,t){I(e,t)},S=function(e,t){var i={},n=t.currentTarget;if(n){var r=n.getAttribute("module-param");if(r)try{i=JSON.parse(r)}catch(e){i={}}}I(e,i)},C=function(e){for(var t=UIStateHandler.getElemsWithAttr(e,"module"),i=0,n=t.length;i<n;i++){var o=t[i],a=o.getAttribute("module"),s=r[a];if(s){var l=s.elements||[],d=o.id;s.listerners=s.listerners||{};var c=s.listerners;if(!l.contains(d)){var u=c.clickListener||S.bind(null,a);o.addEventListener("click",u),c.clickListener=u,l.push(d),s.elements=l}}}},A=function(e){var t=r[e];if(t){for(var i=t.listerners||{},o=i.clickListener,a=t.elements||[],s=0,l=a.length;s<l;s++){var d=a[s],c=W.get("#"+d)[0];c&&c.removeEventListener("click",o)}for(var u=i.eventListener,g=t.trigger||[],s=0,l=g.length;s<l;s++){var h=g[s];n.unsubscribe(h,u)}t.isDisabled=!0}},v=function(e){var t=r[e];if(t&&t.isDisabled){for(var i=t.listerners||{},o=i.clickListener,a=t.elements||[],s=0,l=a.length;s<l;s++){var d=a[s],c=W.get("#"+d)[0];c&&c.addEventListener("click",o)}for(var u=i.eventListener,g=t.trigger||[],s=0,l=g.length;s<l;s++){var h=g[s];n.subscribe(h,u)}t.isDisabled=!1}};return{processElement:C,loadConfiguration:D,unbindEvents:A,bindEvents:v,processModule:I}}(ZWNetworkUtils,Macros,Utils,PubSub);ModuleConfiguration=function(e){var t=("undefined"==typeof cdnZWStaticPath?"":cdnZWStaticPath,"undefined"==typeof cssCdnZWStaticPath?"":cssCdnZWStaticPath),i=("undefined"==typeof imgCdnZWStaticPath?"":imgCdnZWStaticPath,"undefined"==typeof jsCdnZWStaticPath?"":jsCdnZWStaticPath),n="undefined"==typeof bluePencilJsPath?"":bluePencilJsPath;return{TablePanel:{css:[],js:[i+e["js/writer_table_min_all.js"]],html:[{url:["v1/web/panels/tablePanel"],container:"#subpanel-table"}],onBeforeLoad:"PanelUtil.showTablePanel",onAfterLoad:"TablePanel.open",init:"TablePanel.init",trigger:["TablePanel/Show"]},TableThemePanel:{css:[],js:[],html:[{url:["v1/web/panels/tablethemepanel"],container:"#subpanel-tabletheme"}],onBeforeLoad:"PanelUtil.showMoreTableThemes",onAfterLoad:"TableLeftPanelTheme.open",init:"TableLeftPanelTheme.init",dependsOn:["TablePanel"]},ProPackJS:{container:".ui-body-bg",trigger:["Require/ProPackJS"],js:[i+e["js/writer_propack_min_all.js"]]},ProPack:{container:".ui-body-bg",dependsOn:["ProPackJS"],trigger:["Require/ProPack"],onAfterLoad:"ZWPropackHandler.afterResourceLoading",css:[t+e["styles/popups/propack.css"]],html:[{url:["v1/web/popup/propack","v1/web/popup/propackaddons"]}]},BarcodeQrcode:{js:[i+e["js/writer_barcodeqrcode_min_all.js"]],onAfterLoad:"BarCodeQRCodeHandler.handleDialog",trigger:["BarcodeQrcode/FetchJS"]},MailMergeUIElements:{html:[{url:["v1/web/popup/mailmergeelements"]}]},MailMergeLazyFiles:{js:[i+e["js/writer_mailmerge_lazy_min_all.js"]],init:"MailMergeJobConstants.initVariables",onAfterLoad:"MailMergeUtil.handleAfterJsLoad",dependsOn:["BarcodeQrcode","MailMergeUIElements"],trigger:["MailMerge/LoadLazyFiles"]},BarcodeQrcodePanel:{html:[{url:["v1/web/panels/barcodeqrcodepanel"],container:"#subpanel-barcodeqrcode"}],init:"BarCodeQRCodeHandler.initPanel",onAfterLoad:"BarCodeQRCodeHandler.handlePanel",dependsOn:["BarcodeQrcode"],trigger:["BarcodeQrcode/fetchPanel"]},MergeChartPanel:{html:[{url:["v1/web/panels/chartpanel"],container:"#mergeChart-leftPanel"}],js:[i+e["js/writer_chart_leftpanel_min_all.js"]],init:"ChartLeftPanel.initPanel",onBeforeLoad:"PanelUtil.openChartPanel",onAfterLoad:"ChartLeftPanel.init",trigger:["MergeChart/fetchPanel"]},FieldPanelJS:{css:[],js:[i+e["js/writer_fields_min_all.js"]],onAfterLoad:"InsertFieldPanel.handleAfterJsLoad",trigger:["Fields/FetchJS"]},FieldPanel:{css:[],html:[{url:["v1/web/panels/insertfieldpanel"],container:"#subpanel-inserfield"}],onBeforeLoad:"PanelUtil.showFieldPanel",init:"InsertFieldPanel.initPanel",onAfterLoad:"InsertFieldPanel.handleAfterPanelLoad",dependsOn:["FieldPanelJS"],trigger:["Fields/ShowPanel"]},MergeFieldPanel:{dependsOn:["FieldPanel","MergeFieldPanelWithoutFieldPanel"],trigger:["MergeFields/ShowPanel"]},MergeFieldPanelWithoutFieldPanel:{html:[{url:["v1/web/panels/mergefieldpanel"],container:"#subpanel-mergefield"}],onBeforeLoad:"MergeFieldPanel.open",init:"MergeFieldPanel.initPanel",onAfterLoad:"MergeFieldPanel.init",dependsOn:["MailMergeLazyFiles"],trigger:["MergeFields/ShowMergePanelAlone"]},MailMergePanel:{html:[{url:["v1/web/toolbar/mailmergecommonpanel"],container:"#mm-mainpanel"}],init:"MailMergePanel.initPanel",onAfterLoad:"MailMergePanel.open",dependsOn:["MailMergeLazyFiles","ProPack"],trigger:["MailMerge/ShowPanel"]},MailMergePreview:{html:[{url:["v1/web/toolbar/mailmergepreview"],container:"#mmpreview-toolbarcontainer"}],js:[i+e["js/writer_mailmerge_preview_min_all.js"]],onAfterLoad:"MailMergePreviewUiHandler.previewMergedDoc",dependsOn:["MailMergeLazyFiles"],trigger:["MailMerge/Preview"]},DigiSignPanel:{css:[],js:[i+e["js/writer_signerpanel_min_all.js"]],html:[{url:["v1/web/toolbar/digisign_panel"],container:"#subpanel-digisign"},{url:["jsp/inlinesignerfieldsmenu.jsp"],container:"#popup-menu-container"}],onAfterLoad:"digisignpanel.open",init:"digisignpanel.initPopoverElems",dependsOn:["MailMergeLazyFiles"],trigger:["digiSignpanel/showMenu"]},LatexDialog:{css:[t+e["styles/common/latex.min.css"]],js:[i+e["js/common/latex.min.js"]],html:[],onAfterLoad:"UIUtils.openLatexDialog",container:"body"},UnsupportedFeaturesDialog:{css:[],js:[i+e["js/writer_conversion_popover.min.js"]],html:[{url:["jsp/popups/unsupportedfeaturesdialog.jsp"]}],onAfterLoad:"UnsupportedPopOver.checkForUnsupportedInfo",trigger:["UnsupportedPopOver/Init"]},ReaderView:{css:[],js:[i+e["js/common/readerview.min.js"]],html:[{url:["v1/web/popup/reader"]}],onAfterLoad:"ReaderView.show",init:"UIUtils.initReaderView",trigger:["ReaderView/Show"]},ReaderInsights:{css:[t+e["styles/readerinsights.css"]],html:[{url:["v1/web/panels/readersinsightshomepanel"],container:"#documentinsightspanel"},{url:["v1/web/panels/readersinsightscollabpanel"],container:"#documentinsightscollabpanel"}],js:[i+e["js/writer_contentstats_min_all.js"]],onAfterLoad:"ContentStatsHandler.openPanel",onBeforeLoad:"CollabListHandler.openReaderInsights",init:"ContentStatsHandler.init"},InsertImageDialog:{html:[{url:["v1/web/popup/insertimagedialog"]}],js:[i+e["js/writer_insert_image_dialog_min_all.js"]],onBeforeLoad:"ImageHandler.beforeDialogShow",onAfterLoad:"InsertImageDialog.open",init:"InsertImageDialog.init",trigger:["InsertWebImage/ShowPanel"]},ShapeMenu:{css:[],html:[{url:["v1/web/popup/shapemenu"],container:"#menuitem-holder",progressContainer:[]}],init:"InsertShape.initShapeMenu"},ChartMenu:{css:[],html:[{url:["v1/web/popup/chartmenu"],container:"#chartsmenu",progressContainer:[]}],init:"ChartHandler.onChartMenuInit"},ShapeVisualCue:{css:[],js:[i+e["js/writer_shapes_toolbar.js"]],html:[{url:["jsp/popups/shapesvisualcues.jsp"],container:"#popup-menu-container"}],onAfterLoad:"ShapesVisualCueHandler.showContextMenu",init:"ShapesVisualCueHandler.initContextMenu",trigger:["LoadShapeVisualCue"]},ImageVisualCue:{html:[{url:["jsp/popups/imagevisualcues.jsp"],container:"#popup-menu-container"}],init:"ImageVisualCueHandler.onMenuFetch",trigger:["ImageVisualCues/Init"]},DropcapToolbar:{css:[],js:[],html:[{url:["v1/web/toolbar/dropcaptoolbar"],container:"#dropcap-panel"}],onBeforeLoad:"DropcapPanel.open",init:"InsertShape.initDropcapPanel",trigger:["DropcapPanel/Show"]},InitFolderChooser:{onAfterLoad:"Macros.initFolderChooser",trigger:["FolderChooser/Init"]},HtmlSanitizer:{js:[pasteHtmlSanitizerJs]},HelpPanel:{html:[{url:["v1/web/panels/helppanel"]}],onAfterLoad:"HelpPanel.openHelpPanel",js:[i+e["js/writer_helpcenter_min_all.js"]],dependsOn:["HtmlSanitizer"],trigger:["HelpPanel/Open"]},DocumentPropertiesPanel:{html:[{url:["v1/web/documentpropertiespanel"]}],onAfterLoad:"DocumentPropertiesPanel.handleOpenPanel",js:[i+e["js/writer_documentproperties_min_all.js"]],trigger:["DocumentProperties/Open"]},UserProfilePanel:{html:[{url:["v1/web/userprofile"]}],onAfterLoad:"UserProfilePanel.openPanel",js:[i+e["js/writer_userprofile_min_all.js"]]},MakeACopy:{onAfterLoad:"MakeACopy.handleOpendialog",js:[i+e["js/writer_makeacopy_min_all.js"]],trigger:["MakeACopy/Open"]},MoveToFolder:{onAfterLoad:"UIUtils.initMovetoFolderComponent",trigger:["MovetoFolder/init"]},PostToBlog:{onAfterLoad:"Blogger.handlePostToBlogModuleConfiguration",js:[i+e["js/writer_posttoblog_min_all.js"]],trigger:["PostToBlog/init"]},Trash:{onAfterLoad:"MoveToTrash.handleEmailModuleConfiguration",js:[i+e["js/writer_trash_min_all.js"]],trigger:["Trash/Init"]},Email:{onAfterLoad:"EmailDocument.handleEmailModuleConfiguration",js:[i+e["js/writer_email_min_all.js"]],trigger:["Email/Init"]},Publish:{onAfterLoad:"Publish.handlePublishModuleConfiguration",js:[i+e["js/writer_public_min_all.js"]],trigger:["Publish/Init"]},Esign:{js:[i+e["js/writer_esign_min_all.js"]],trigger:["Esign/Init"],onAfterLoad:"EsignController.handleEsignModuleLoaderConfigurations"},DesignPanel:{css:[],js:[],html:[{url:["v1/web/panels/designtab"],container:"#designpanel"}],onBeforeLoad:"DesignTabUI.showPanel",init:"DesignTabUI.init"},InsertPanel:{html:[{url:["v1/web/panels/insertpanel"],container:"#menuInsert"}],onBeforeLoad:"PanelUtil.openInsertPanel",init:"InsertPanel.init",trigger:["menuInsert/open"]},FormatPanel:{html:[{url:["v1/web/panels/formatPanel"],container:"#menuFormat"}],onBeforeLoad:"PanelUtil.openFormatPanel",init:"FormatPanel.init",trigger:["menuFormat/open"]},ParagraphPanel:{html:[{url:["v1/web/panels/paragraphpanel"],container:"#subpanel-para"}],onAfterLoad:"ParagraphPanel.open",init:"ParagraphPanel.init",dependsOn:["FormatPanel"],trigger:["ParagraphPanel/Open"]},PageLayoutPanel:{html:[{url:["v1/web/panels/pagelayoutpanel"],container:"#subpanel-pagelayout"}],onBeforeLoad:"PanelUtil.openPageLayoutPanel",init:"PageLayoutPanel.open",trigger:["PageLayoutPanel/open"]},WatermarkPanel:{onBeforeLoad:"PageLayoutPanel.showWatermarkDialog",dependsOn:["PageLayoutPanel"]},Announcement:{onAfterLoad:"ZWAnnouncement.handleAnnouncementhModuleConfiguration",html:[{url:["html/templates/announcements.html"]}],trigger:["Announcement/Init"]},ReviewRightPanel:{html:[{url:["jsp/reviewrightpane.jsp"],container:"#review_Rightpane"}],onAfterLoad:"ReviewPane.initReviewRightPanel",trigger:["Document/ComponentInitialized"]},VersionViewToolbar:{html:[{url:["jsp/versionviewtoolbar.jsp"],container:"#toolbar-container"}],onBeforeLoad:"HistoryUI.onBeforeVersionViewLoad",onAfterLoad:"HistoryUI.onVersionViewLoad",init:"HistoryUI.initVersionViewTopband",trigger:["Document/VersionViewOpened"]},CustomFontSettings:{css:[],js:[i+e["js/customfontsettings.min.js"]],html:[],onAfterLoad:"CustomFontSettings.openLocalFontDlg",trigger:["Font/CustomFontSettings"]},ImageCarousel:{css:[],js:[i+e["js/imagecarousel.min.js"]],html:[],onAfterLoad:"ImagePreview.handleImageCarousel",trigger:["Image/HandleImageCarousel"]},TextboxPanel:{html:[{url:["v1/web/panels/textboxPanel"],container:"#subpanel-textbox"}],js:[i+e["js/writer_textbox_panel_min_all.js"]],init:"TextBoxPanel.initPanel",onAfterLoad:"TextBoxPanel.toggleTextBoxOptions",trigger:["TextBox/ShowPanel"]},Proofing:{html:[{url:["jsp/proofingfragments.jsp"]}],js:[i+e["js/writer_proofing_min_all.js"],i+e["js/writer_zohocharts_min_all.js"]],css:[t+e["styles/proofing.css"]],init:"ProofingAdaptor.onFilesLoaded",trigger:["ModuleLoad/Proofing"],dependsOn:["BluePencil"]},MarketPlaceAddOn:{js:[i+e["js/writer_extension_min_all.js"]],onBeforeLoad:"PanelUtil.openExtensionsPanel",onAfterLoad:"MarketplaceHandler.initPanel",trigger:["Marketplace/Init"]},BluePencil:{js:[n]},ImageEditAlignment:{css:[],js:[i+e["js/writer_image_alignment_min_all.js"]],html:[{url:["v1/web/toolbar/image_edit_alignment"],container:"#imageeditalign"}],onBeforeLoad:"PanelUtil.showImageAlignPanel",init:"ImageEditAlignment.initPanel",onAfterLoad:"ImageEditAlignment.toggleImageAlignOptions",trigger:["ImageAlign/ShowPanel"]},DocsComponent:{js:[docsComponentjsSource],init:"ZDComponents.initDocsComponent",trigger:["DocsComponent/Init"]},FillAddon:{container:".ui-body-bg",trigger:["Require/FillAddon"],html:[{url:["v1/web/popup/fieldsaddonpopup"]}]},AutoInsertFieldPopup:{html:[{url:["v1/web/panels/autoinsertfieldspopup"]}],init:"TemplateUIHandler.showAutoInsertFieldsPopup",trigger:["PDFFiller/EditorReady"]},FillableFieldPanel:{css:[],js:[],html:[{url:["v1/web/toolbar/insert_fillable_fields"],container:"#subpanel-container"}],onBeforeLoad:"PanelUtil.openFillableFieldsPanel",onAfterLoad:"FillableFieldsPanel.fillableFieldPanelAfterLoad",trigger:["subpanel-insertfillablefield/open"]},ScreenplayReports:{css:[],js:[],html:[{url:["v1/web/panels/screenplayreports"],container:"#preview-container"}],init:"Screenplay_Report_Layout.initLayOutElements",trigger:["ScreenplayReport/Show"]},ScreenplayToolbar:{css:[],js:[],html:[{url:["v1/web/toolbar/screenplaytoolbar"],container:"#screenplay_toolbar_container"}],init:"Screenplay_Editor_Layout.initLayOutElements",trigger:["ScreenplayToolbar/Show"]},ScreenplayBreakdown:{css:[],js:[],html:[{url:["v1/web/toolbar/screenplaybreakdown"],container:"#screenplay_breakdown_toolbar_container"}],init:"Screenplay_Breakdown_Layout.initBreakDownComponents",trigger:["ScreenplayBreakDown/LoadLayout"]},ScreenplaySceneGridView:{css:[],js:[],html:[{url:["v1/web/toolbar/screenplayscenesgridview"],container:"#screenplay_grid_view_toolbar_container"}],init:"Screenplay_Scenes_Grid_View.initScenesGridView",trigger:["ScreenplaySceneGridViewLayout/LoadLayout"]},Workflow:{css:[],js:[i+e["js/writer_workflow_min_all.js"]],onAfterLoad:"WorkflowAdapter.afterInit",trigger:["ModuleLoad/Workflow"]},mergedocument:{css:[],js:[i+e["js/mergedocument.min.js"]],onAfterLoad:"MergeDocumentDialogue.showWDDialogueForMergeDocument"},advancedpagesetup:{css:[],js:[i+e["js/advancepagesetupdialogue.min.js"]],onAfterLoad:"PageLayoutAdvancedDialogue.showPageSetupDialogue",trigger:["PageLayout/ShowAdvancedPanel"]},ResearchStudioToolbar:{css:[],js:[],html:[{url:["v1/web/toolbar/researchstudiotoolbar"],container:"#researchstudio_toolbar_container"}],onAfterLoad:"ResearchStudioToolbar.openTopband",trigger:["ResearchStudioToolbar/Show"]},CitationPanel:{html:[{url:["v1/web/panels/citationPanel"],container:"#subpanel-citation"}],js:[i+e["js/writer_citation_source_min_all.js"]],onBeforeLoad:"PanelUtil.openCitationPanel",init:"CitationPanel.init",dependsOn:["InsertPanel"],onAfterLoad:"CitationPanel.onAfterLoad"}}}(fingerPrintObj),Module.loadConfiguration(ModuleConfiguration);var ContentEngagement=function(){"use strict";var e=function(e){var t,i=e/200,n="";if(i>0&&i<1)n=J.i18n("writer.documentproperty.READING_TIME_LESS_THAN_A_MINUTE");else if(i>=1&&i<=59)n=J.i18n("writer.common.READING_TIME_MINUTE",[Math.ceil(i)]);else if(i>59){var r=Math.floor(i/60),o=Math.ceil(60*[i/60-r]);60==o&&(r+=1,o=0),n=0==o?J.i18n("writer.common.READING_TIME_HOUR",[r]):J.i18n("writer.common.READING_TIME_HOUR_AND_TIME",[r,o])}return t=60*i,{readingTimeText:n,readingTimeInSeconds:t}};return{getReadingTime:e}}();DocInfo=function(){"use strict";var e={},t=Object.create(null),i=function(e){Object.defineProperty(editor.doc,"docInfo",{get:function(){return t},set:function(){},enumerable:!0}),n(e)},n=function(i){var n=Object.keys(i);n.forEach(function(n){e.hasOwnProperty(n)||Object.defineProperty(t,n,{get:function(){return e[n]},set:function(){},enumerable:!0}),void 0!=i[n]&&e[n]==i[n]||(e[n]=i[n],PubSub.publish("DocInfo/"+n+"/modified"))})},r=function(){e={},t=Object.create(null)};return{setProperty:n,initialize:i,clear:r}}(),function(e){var t=function(e){function t(e){for(var t=new ArrayBuffer(2*e.length),i=new Uint16Array(t),n=0,r=e.length;n<r;n++)i[n]=e.charCodeAt(n);return t}var i,n="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof URL&&"undefined"!=typeof URL.createObjectURL&&"undefined"!=typeof Blob&&"undefined"!=typeof Worker,r=function(){return(""+Math.random()).replace(/\D/g,"")},o={},a={},s=function(e,t){var n,r=!1;return i=new c(e),n=i.load(t),n.promise().done(function(){r=!0}).fail(function(){r=!1}),a[i.id]=i,n},l=function(t,i){var n=1,r=0,o=function(i,n,o){o=o||0,r=setTimeout(function(){e({type:"GET",url:t,error:n,success:i})},o)},a=function(e){var n={fileName:t,status:"success",fileContent:e};i&&i.resolve(n)},s=function(e,r,l){n++;var d="Response Status: "+e.status+" ResponseText: "+(e.responseText||"null")+" Text Status: "+(r||"null")+"Error Thrown: "+(l||"null");if(n<=3)o(a,s,2e3);else{var c={fileName:t,status:"failure",message:d};i&&i.reject(c)}};o(a,s)},d=function(e){var t=e.data,i=t.threadId;a[i]&&a[i].processDataFromWorker(e)},c=function(e){this.fileName=e,this.worker,this.callBackFnsMap={},this.id=r()};c.prototype={load:function(e){var t=new Deferred;if(n){var i=this;if(e){var r=new Deferred;l(i.fileName,r),r.promise().done(function(e){e&&"success"===e.status&&(o[e.fileName]=e.fileContent);try{var n=window.URL.createObjectURL(new Blob([o[i.fileName]]));i.worker=new Worker(n)}catch(e){}i.worker.onmessage=function(e){ZWJsThreadExecutor.processDataFromWorker(e)},t.resolve()}).fail(function(e){var i={};i.message="Request failed, FileName: "+e.fileName+" Message: "+e.message,i.code="CWE_100",t.reject(i)})}else try{i.worker=new Worker(i.fileName),i.worker.onmessage=function(e){ZWJsThreadExecutor.processDataFromWorker(e)},t.resolve()}catch(e){var a={};a.message="Failed to initialize ZW js thread executor",e.stack&&(a.message+="\nStack: "+e.stack),a.code="CWE_100",t.reject(a)}}else{var i=this;zw.require({js:[i.fileName]},[],function(){i.worker=ZWJsThread,t.resolve()})}return t},execFn:function(e,i,o){var a=r();o&&(this.callBackFnsMap[a]=o);var s={};s.fnName=e,s.callerId=a,s.threadId=this.id,s.params=i,s=n?t(JSON.stringify(s)):{data:s},this.worker.postMessage(s)},getWorker:function(){return this.worker},processDataFromWorker:function(e){var t=e.data,i=t.callerId,n=t.response,r=this.callBackFnsMap[i];return t.status&&"error"===t.status?void(r&&r.error&&r.error.apply(r.context||null,[t.exception])):void(r&&r.success&&r.success.apply(r.context||null,[n]))}};var u=function(e,t,n){i.execFn(e,t,n)};return{init:s,execFn:u,fileContentCache:o,processDataFromWorker:d}}(jQuery.ajax);"undefined"!=typeof e&&(e.ZWJsThreadExecutor=t)}(window),zw.define("ZWJsThreadPool",[],["ZWJsThreadExecutor"],function(e){var t=function(e,t,i,n,r,o,a){this.type=e,this.timeToInitiate=t||1e3,this.workerFnToExecute=i,this.onBeforeExecute=n,this.callback=r,this.failureCb=o,this.maxProcessingCount=a,this.queue=[],this.ids=[],this.isInitiated=!1,this.timer};return t.prototype={add:function(e){var t,i,n={};if(!e.hasOwnProperty("id"))throw"ID is mandatory to proceed further.";t=e.id,n.isInProgress=!1,n.data=e,n.id=t,i=this.ids.indexOf(t),i!==-1?(this.queue.splice(i,1),this.queue.unshift(n),this.ids.splice(i,1),this.ids.unshift(t)):(this.queue.push(n),this.ids.push(t)),this.isInitiated||this.start()},remove:function(e){if(!e.hasOwnProperty("id"))throw"ID is mandatory to proceed further.";var t=this.ids.indexOf(e.id);t!==-1&&(this.queue.splice(t,1),this.ids.splice(t,1))},start:function(){var e=this;clearTimeout(e.timer),e.timer=setTimeout(function(){e.run(),e.isInitiated=!0},e.timeToInitiate)},run:function(){for(var t,i=this,n=[],r=i.queue.length>i.maxProcessingCount?i.maxProcessingCount:i.queue.length,o=0,a=r;o<a;o++)t=i.queue[o],t.isInProgress=!0,i.onBeforeExecute&&i.onBeforeExecute(t.data),n.push(t);e.execFn(i.workerFnToExecute,n,{success:i.onComplete,error:i.onError,context:this})},onError:function(e){this.isInitiated=!1,this.failureCb&&this.failureCb(e)},onComplete:function(e){try{var t,i,n,r,o=(e.length,this),a=o.queue;e.forEach(function(e){for(i=e.id,n=e.data,t=0;t<a.length;t++)if(r=a[t],r.id===i){r.isInProgress&&(o.callback(n),a.splice(t,1),o.ids.splice(t,1));break}}),a.length?o.run():o.isInitiated=!1}catch(e){ZWLogger.log("EXCEPTION IN ZWJSTHREAD WORKER");var s=e.stack||e,l=ZWCollaboration.COMMON_WORKER_THREAD_POOL_ERROR;return void ZWLogger.sendErrorDetails(l+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+l+" buildLabel::: "+buildLabel+"\n Error Log End \n<ZWERROR>Exception : \n"+s,null,l)}},isEmpty:function(){return 0===this.queue.length},clear:function(){this.queue=[],this.ids=[],this.isInitiated=!1}},t});var RangeUtil=function(e){"use strict";var t=function(t,i,n,r){var o={type:"cursor",zuid:editor.zuid},a=Utils.randomString(),s=[{r:t.start},{as:{start:o,id:a}},{r:t.end-t.start},{as:{end:ZWJSONUtils.getKeys(o),id:a}}];s=e.build(s);var l={};l[r]=n;var d=e.build([{r:i},l]),c=e.xform(s,d),u=c.first.getCursorPos()[0];return u.start=u.start>=0?u.start:u.end,u.end=u.end>=0?u.end:u.start,u};return{updateIndex:t}}(DocOpBuilder),NamedRange=function(e){"use strict";var t=[],i=[],n=null,r=[],o=function(e,n,o,a){var s={id:o.id,start:e,end:n,styles:o,name:o.name,styleId:a};i.push(s),i=i.sort(DocUtil.sortFn),t=i.map(function(e){return e.id}),r=i.map(function(e){return e.name})},a=function(t){n=n?e.compose(n,t):t},s=function(t){if(n){var i=e.xform(n,t);n=e.concise(i.first)}},l=function(e,t,n){i=i.filter(function(i){var r=RangeUtil.updateIndex(i,e,t,n);return i.start=r.start,i.end=r.end,i.start!=i.end?i:void T(i.id)})},d=function(){t=i.map(function(e){return e.id}),r=i.map(function(e){return e.name})},c=function(t,i,n){l(t,n,"is");var r=[{r:t},{is:n}];s(e.build(r))},u=function(t,i,n){l(t,n,"ds");var r=[{r:t},{ds:n}];s(e.build(r))},g=function(e,t,n,r){i=i.map(function(i){return i.id==n.id&&(i.start=e<i.start?e:i.start,i.end=t>i.end?t:i.end,i.styles=n,i.styleId=r),i})},h=function(e,t){var i,n,r=!1;for(n in e)if(i=e[n],i.contains(t)&&0!=i.indexOf(t)&&i.indexOf(t)!=i.length-1){r=!0;break}return r},f=function(){if(n){for(var t,i={},r=[],o=n.getDocOps(),a=0,s=o.length;a<s;a++)if(t=o[a],t.isAnnotation()){var l=t.styles.id;t.isAnnotationStart()?(i[l]||(i[l]=[]),i[l].push(a)):i[l].push(a)}for(var a=0,s=o.length;a<s;a++)h(i,a)||r.push(o[a]);n.docOps=r,n=e.concise(n)}},p=function(t,n){var r=t.style;if(r&&n){var s=!0;if(r.action)T(r.id);else{i.filter(function(e){r.id==e.id&&(s=!1)});var l=[{r:t.start},{as:{start:r,id:t.styleId}},{r:t.end-t.start},{as:{end:ZWJSONUtils.getKeys(r),id:t.styleId}}];a(e.build(l)),s?o(t.start,t.end,r,t.styleId):(g(t.start,t.end,r,t.styleId),f())}}},E=function(t){if(n){for(var i,r,o=n.getDocOps(),a=0;a<o.length;a++){var s=o[a];s.isAnnotation()&&(s.isAnnotationStart()?(r=s.styles.begin,r.id==t&&(i=s.styles.id,o.splice(a,1),a--)):s.styles.id==i&&(o.splice(a,1),a--))}n.docOps=o,n=e.concise(n);var o=n.getDocOps();o[o.length-1].isRetain()&&o.splice(o.length-1),o.length?n.docOps=o:P()}},T=function(e){E(e),i=i.filter(function(t){return t.id!=e?t:void PubSub.publish("Document/range/removed",t)}),d()},O=function(e,t,i,n){var r=Utils.randomString(),o=Utils.randomString(),a=n?ZWJSONUtils.getKeys(n)[0]:null;i=i?i:a+n[a];var s=[],l={};s.push({r:e});var d={type:"namedrange",zuid:editor.zuid,id:o,name:i};return n&&(d.info=n),s.push({as:{start:d,id:r}}),s.push({r:t-e}),s.push({as:{end:ZWJSONUtils.getKeys(d),id:r}}),l.op=s,l.nmgId=o,l},m=function(e,t,i,n){var r=O(e,t,i,n);return Highlighter.setNewRangeInsertedValue(!0),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),Op.processMsg(r.op),Op.sendMsg(),r.nmgId},I=function(e,t,n,r){i.filter(function(i){if(i.id==n){editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0),e=i.start<e?i.start:e,t=i.end>t?i.end:t;var o={type:"namedrange",zuid:editor.zuid,id:i.id,name:i.name};(i.styles.info||r)&&(o.info=r?r:i.styles.info);var i=[{r:e},{as:{start:o,id:i.styleId}},{r:t-e},{as:{end:ZWJSONUtils.getKeys(o),id:i.styleId}}];Op.processMsg(i),Op.sendMsg()}})},D=function(e){n=e?e:editor.doc.getRanges().namedRange;var t,r,o=0,a=0,s=[];n&&(s=n.getDocOps());for(var t=s.length,l={},c=function(e,t){i=i.map(function(i){return i.styleId==e&&(i.end=t),i})};o<t;){var u=s[o];null!=u.retain_count?a+=u.retain_count:u.isAnnotation()&&(u.isAnnotationStart()?(r=u.styles.begin,l.start=a,l.styles=r,l.id=r.id,l.styleId=u.styles.id,l.name=r.name,i.push(l),l={}):c(u.styles.id,a)),o++}i=i.sort(DocUtil.sortFn),d()},R=function(e){var t=[];return t=i.filter(function(t){if(t.id==e)return t})},S=function(e){var t=[];return t=i.filter(function(t){if(t.name===e)return t})},C=function(e,t){var n=[];return n=i.filter(function(i){if(i.start<=e&&e<=i.end||i.start<=t&&t<=i.end||e<=i.start&&i.end<=t)return i})},A=function(){if(n){for(var e,t=n.getDocOps(),i=0,r=[],o={},a={},s=0,l=t.length;s<l;s++){var d=t[s];null!=d.retain_count?i+=d.retain_count:d.isAnnotation()&&(d.isAnnotationStart()?(e=r.pop(),e&&(e.end||(e.end=i),r.push(e)),o[d.styles.id]=d.styles.begin,a={start:i,style:ZWJSONUtils.clone(o)},r.push(a),a={}):(e=r.pop(),e.end?a={start:e.end,style:ZWJSONUtils.clone(o),end:i}:e.end=i,r.push(e),ZWJSONUtils.isEmptyObject(a)||(r.push(a),a={}),delete o[d.styles.id]))}return r}},v=function(e,t){for(var i,n=A(),r=[],o=0,a=n.length;o<a;o++){if(i=n[o],i.start<e){if(i.end<e)continue;i.start=e,i.end>t&&(i.end=t)}else{if(i.start>t)break;i.end>t&&(i.end=t)}r.push(i)}return r},_=function(){return n},P=function(){n=null},N=function(e,t){t&&PubSub.publish("Document/range/removed",e);var e=[{r:e.start},{as:{start:{type:"namedrange",zuid:editor.zuid,id:e.id,name:e.name,action:"remove"},id:e.styleId}},{r:e.end-e.start},{as:{end:["type","zuid","id","name","action"],id:e.styleId}}];Op.processMsg(e),Op.sendMsg()},b=function(e,t){e&&(i=i.filter(function(i){return i.id!=e?i:void N(i,t)}))},L=function(e){i=i.filter(function(t){return t.name!=e?t:void N(t)})},w=function(e,t){for(var i,n=C(e,t),r=[],o=0;o<n.length;o++)i=n[o],(i.start>=e&&e<=i.end||i.start<=t&&t>=i.end)&&r.push(i);return ZWJSONUtils.clone(r)},y=function(e){isHeadlessPDF||isHeadlessHTML||(M(),PubSub.subscribe("Document/ContentAdded",c),PubSub.subscribe("Document/ContentDeleted",u),PubSub.subscribe("Document/NamedRange",p),D(e))},M=function(){i=[],t=[],n=null,PubSub.unsubscribe("Document/ContentAdded",c),PubSub.unsubscribe("Document/ContentDeleted",u),PubSub.unsubscribe("Document/NamedRange",p)},F=function(e,t){var i=Utils.randomString(),n=Utils.randomString(),r=[],o=t[e.end];r.push({r:e.start});var a=e.styles.info,s={type:"namedrange",id:e.id,name:e.name};if(a){var l=ZWJSONUtils.getKeys(a)[0];s[l]=a[l]}return r.push({as:{start:s,id:i}}),r.push({is:""}),r.push({as:{end:ZWJSONUtils.getKeys(s),id:i}}),!o||o.type!=NODE_TYPE.TABLE&&o.type!=NODE_TYPE.TOC&&o.type!=NODE_TYPE.SECTION&&o.type!=NODE_TYPE.HR?r.push({r:e.end-e.start}):r.push({r:e.end-e.start-1}),r.push({as:{start:{type:"namedrange",id:e.id,name:e.name},id:n}}),r.push({is:""}),r.push({as:{end:["type","id","name"],id:n}}),r},U=function(t){var n=e.build([]),r=t.ranges&&t.ranges.namedRange,o=t.styles||[];return D(e.build(r||[])),i.filter(function(t){n.applyOp(e.build(F(t,o)))}),n},V=function(e,t){var i=ZWJSONUtils.clone(NamedRange.getNamedRangesBetween(e,t));return i=i.filter(function(i){return i.start<e&&(i.start=e),i.end>t&&(i.end=t),i})},B=function(t,i){for(var n=e.build([]),r=V(t.start,t.end),o=0,a=r.length;o<a;o++){var s=r[o];n.applyOp(e.build(O(s.start,s.end,s.name,s.styles.info).op))}var l=e.compose(e.build(i),n);return JSON.parse(l.toString())},x=function(e,t){var n=i.filter(function(i){if(i.start>=e&&i.end<=t)return i});return ZWJSONUtils.clone(n)},W=function(t,i){var n,r,o,a,s=[],l=0;if(t&&i)s=x(r.start,r.end);else for(var d=editor.doc.getSelection().sortRanges(),c=0;c<d.length;c++)if(r=d[c],o=x(r.start,r.end),c>0){n=d[c-1];for(var u=0;u<o.length;u++)a=o[u],a.start=a.start-(r.start-n.end+l),a.end=a.end-(r.start-n.end+l),s.push(a);l+=r.start-n.end}else s=o;for(var g=e.build([]),c=0,h=s.length;c<h;c++)a=s[c],g.applyOp(e.build(O(a.start,a.end,a.name,a.styles.info).op));return s.length>0?g:null},H=function(e){i=i.filter(function(t){N(t,e)})},G=function(){return ZWJSONUtils.clone(i)};return{init:y,createRange:m,getNamedRangeForId:R,getNamedRangeForName:S,getNamedRangesBetween:C,getNamedRangeSegments:A,getNamedRangeSegmentsBetween:v,getComposedNamedRangeOp:_,clearComposedRange:P,removeRangeById:b,removeRangeByName:L,getEnclosedRanges:w,replaceNamedRanges:U,getInsertionOps:B,getComposedRangesInSelection:W,removeAllRanges:H,modifyRange:I,getAllRanges:G,generateOp:O}}(DocOpBuilder),Highlighter=function(e,t){var i=[],n=[],r={},o=!1,a="ui-comment-indication-new",s=function(){return i},l=function(e){i.push(e),o&&(m(e),w(!1))},d=function(t){i=i.filter(function(e){return e.id!==t}),e.get(".rng-highlight-"+t).remove()},c=function(e,t,n){i=i.filter(function(i){var r=RangeUtil.updateIndex(i,e,t,n);return i.start=r.start,i.end=r.end,i.start!=i.end?i:void d(i.id)})},u=function(e,t,i,n){var r,o,a,s=n?n:Utils.randomString();i&&(r=i.type,o=i.width,a=i.color),editor.doc.snapShotManager&&editor.doc.snapShotManager.setSkipSnapShot(!0);var l=[{r:0},{as:{start:{type:"body",st:"hilighter",details:{name:e,borders:{"border-top":{type:r,width:o,color:a,space:"1px"},"border-right":{type:r,width:o,color:a,space:"5px"},"border-left":{type:r,width:o,color:a,space:"5px"},"border-bottom":{type:r,width:o,color:a,space:"1px"},"border-radius":{"br-topLeft":0,"br-topRight":0,"br-bottomLeft":0,"br-bottomRight":0}},bgc:t}}},id:s},{r:0},{as:{end:["type","st","details"],id:s}}];Op.processMsg(l),Op.sendMsg()},g=function(e,t,i){c(e,i,"is")},h=function(e,t,i){c(e,i,"ds")},f=function(e,t){return t-e==2&&editor.doc.getCharAt(e+1)===UNICODE.IMAGE},p=function(t){t.filter(function(t){n.contains(t)&&(n.splice(n.indexOf(t),1),e.get(".rng-highlight-"+t).css({visibility:"visible"}))})},E=function(t){n=n.concat(t),i.filter(function(i){t.contains(i.id)&&e.get(".rng-highlight-"+i.id).css({visibility:"hidden"})})},T=function(){for(var t,r=0,o=i.length;r<o;r++)t=i[r].id,n.push(t),e.get(".rng-highlight-"+t).css({visibility:"hidden"})},O=function(){n=[];for(var t,r=0,o=i.length;r<o;r++)t=i[r].id,e.get(".rng-highlight-"+t).css({visibility:"visible"})},m=function(e){var t=e.start,i=e.end,r=e.h_name;if(t===i)return!1;var o=DocLayoutManager.getLineAtIndex(t);if(!o)return!1;var s=DocLayoutManager.getLeftAtIndex(t),l=DocLayoutManager.getLeftAtIndex(i);if(i==o.parent.getIndex()+o.end&&editor.doc.getCharAt(i)!=UNICODE.PARA?(i-=1,l=DocLayoutManager.getLeftAtIndex(i)):editor.doc.getCharAt(i-1)==UNICODE.PARA&&(l=DocLayoutManager.getLeftAtIndex(i-1)),t===i)return!1;for(var d,c,u=DocLayoutManager.linesBetween(t,i),g=editor.doc.getContent(t,i),h=Utils.isRTL(g),p=u.length>1,E=0;E<u.length;E++)if(o=u[E],c=DomViewManager.getDOMElem(o)){var T,O=editor.doc.getComputedFormatAt(o.parent.getEndIndex(),NODE_TYPE.PARAGRAPH)||{},m=O[ATTR_PARAGRAPH.PS_AL]||0,I=o.height,D=J(c),R=document.createElement("div"),S={},C=parseFloat(D.css("padding-top")||0);S.height=I,S.top=C,T=3===m?0:o.remainingWidth*m/2,d=o.listRight?o.listRight:0,p?0===E?(S.left=s,S.width=o.width-s+T+d):E==u.length-1?(S.left=T+d,S.width=l-T-d):(S.left=T+d,S.width=o.width):h?(S.left=l,S.width=s-l):(S.left=s,S.width=l-s),S["z-index"]=ZINDEX.COMMENT_HIGHLIGHT,f(t,i)&&(S.top--,S.left--,S.width=S.width+2);var A=J(R),v=Macros.getHilighterDetails(r,e.id);v&&(S["background-color"]=v.bgc,A.css(DomUtil.getBorderStyles(v))),n.contains(e.id)&&(S.visibility="hidden"),A.addClass(a).addClass("rng-highlight").addClass("rng-highlight-"+e.id).css(S).appendTo(D[0]),PubSub.publish("Document/range/rendered",e,A)}},I=function(t){var i=DomViewManager.getDOMElem(t);i&&e(i).find(".rng-highlight").remove()},D=function(e){var t=e.parent,n=t.getIndex();I(e);var r=n+e.start,o=n+e.end,a=i.filter(function(e){return e.start<=r&&e.end>=o||(e.start>=r&&e.start<=o||(e.end>=r&&e.end<=o||e.start>=r&&e.end<=o))}).map(function(e){var t={start:e.start,end:e.end,id:e.id,h_name:e.h_name,name:e.name};return t.start=e.start<r?r:e.start,t.end=e.end>o?o:e.end,t});U.each(a,function(e){m(e)})},R=function(e){U.each(e,function(e){U.each(e.getNodeLines(),function(e){I(e)})})},S=function(e,t,n){i=i.map(function(i){return i.id==n.id&&(i.start=e<i.start?e:i.start,i.end=t>i.end?t:i.end,i.h_name=n.h_name),i})},C=function(t,n){var r=t.style;if(r&&r.info&&r.info.hilite_name&&n){var o=!0;if(r.action)d(r.id);else{i.filter(function(e){r.id==e.id&&(o=!1)});var a={start:t.start,end:t.end,id:r.id,h_name:r.info.hilite_name,name:r.name};o?l(a):(S(t.start,t.end,a),e.get(".rng-highlight-"+a.id).remove(),m(a))}}else"remove"==r.action&&d(r.id)},A=function(e,t,i,n){var o,a,s;if(i&&i.type==NODE_TYPE.BODY&&"hilighter"==n.body.st){a=n.body.details||{},o=r[a.name],o||(o={},r[a.name]=o);for(s in a)"name"!=s&&(o[s]=a[s])}},v=function(e){r=e},_=function(){return ZWJSONUtils.clone(r)},P=function(){i=[],PubSub.unsubscribe("Document/ContentAdded",g),PubSub.unsubscribe("Document/ContentDeleted",h),PubSub.unsubscribe(DOMVIEW.LINE_ADDED,D),PubSub.unsubscribe(DOMVIEW.LINE_UPDATED,D),PubSub.unsubscribe("paraview/before/remove",R),PubSub.unsubscribe("line/before/remove",I),PubSub.unsubscribe("Document/BodyStyleChanged",A),PubSub.unsubscribe("Document/NamedRange",C)},N=function(e,t){return e.start>t.start?1:e.start<t.start?-1:e.end>t.end?1:e.end<t.end?-1:0},b=function(e){composedRange=e?e:editor.doc.getRanges().namedRange;var t,n,r=0,o=0,a=[];composedRange&&(a=composedRange.getDocOps());for(var t=a.length,s={},l=function(e,t){i=i.map(function(i){return i.styleId==e&&(i.end=t),i})};r<t;){var d=a[r];null!=d.retain_count?o+=d.retain_count:d.isAnnotation()&&(d.isAnnotationStart()&&d.styles.begin.info&&d.styles.begin.info.hilite_name?(n=d.styles.begin,s.start=o,s.id=n.id,s.styleId=d.styles.id,s.h_name=n.info.hilite_name,s.name=n.name,i.push(s),s={}):l(d.styles.id,o)),r++}i=i.sort(N)},L=function(){isHeadlessPDF||isHeadlessHTML||(P(),PubSub.subscribe("Document/ContentAdded",g),PubSub.subscribe("Document/ContentDeleted",h),PubSub.subscribe(DOMVIEW.LINE_ADDED,D),PubSub.subscribe(DOMVIEW.LINE_UPDATED,D),PubSub.subscribe("paraview/before/remove",R),PubSub.subscribe("line/before/remove",I),PubSub.subscribe("Document/BodyStyleChanged",A),PubSub.subscribe("Document/NamedRange",C),b())},w=function(e){o=e},y=function(e){return r[e]};return{addRange:l,removeRange:d,getRanges:s,init:L,initHilites:v,createHiliter:u,destroy:P,hideAllRanges:T,showAllRanges:O,hideSelectedRanges:E,showSelectedRanges:p,getAllHighlightes:_,setNewRangeInsertedValue:w,getHiliteDetails:y}}(W,NamedRange),RangeCollection=function(){"use strict";var e={},t=[],i=function(){for(var t,i,n,r=editor.doc,o=editor.doc.findNextIndexOf(UNICODE.RANGE_START,0),a=0;o>-1;){if(t=r.getRawFormatAt(o),t&&"conditional_if_start"==t.type){a=DocUtil.getRangeEndAcrossSection(o),i=[],n=t.condition;for(var s=0,l=n.length;s<l;s++)i.push(n[s].lhs.fieldId);e[t.id]={start:o,end:a+1,id:t.id,fieldIds:i,type:t.condition[0].lhs.type,isVisible:!0}}o=editor.doc.findNextIndexOf(UNICODE.RANGE_START,o+1)}},n=function(t,i){e[t]&&(e[t].end=i)},r=function(i,r,o,a){if(l(i,o,"is"),a&&"conditional_if_start"==a.type){var s,d=!0;for(var c in e)if(s=e[c],s.id==a.id){d=!1;break}if(d){for(var u=[],g=a.condition,h=0,p=g.length;h<p;h++)u.push(g[h].lhs.fieldId);var E={start:i,id:a.id,fieldIds:u,type:a.condition[0].lhs.type,isVisible:!0};e[a.id]=E}else e[a.id].start=i}else a&&"conditional_if_end"==a.type&&n(a.id,r);"hiddenRangesApplyto"!=editor.lastOperation&&f()&&a&&("fillablefield"==a.cls||"conditional_if_start"==a.type)&&t.push(a)},o=function(e,t,i){l(e,i,"ds")},a=function(e){for(var i,n=FillableFieldsHandler.getAllLinkedFields(e),r=[],o=0,a=t.length;o<a;o++)i=t[o],r.push(i.fieldinfo);for(var s,l,d,o=0,a=n.length;o<a;o++)s=n[o],d=s.getId(),l=r.indexOf(d),l!=-1&&(t.splice(l,1),r.splice(l,1))},s=function(){for(var i;t[0];)if(i=t[0],t.splice(0,1),"fillablefield"==i.cls){var n=editor.getDocument().getFieldById(i.fieldinfo);t.length>0&&a(n),ConditionalUIHandler.onFillableFieldUpdate(n)}else"conditional_if_start"==i.type&&ConditionsEvaluator.evaluateFillableFieldsInPreviewMode([e[i.id]])},l=function(t,i,n){var r;for(var o in e)if(r=e[o],r.start&&r.end){var a=RangeUtil.updateIndex(r,t,i,n);r.start=a.start,r.end=a.end,f()||r.start!=r.end||delete e[o]}},d=function(){isHeadlessPDF||isHeadlessHTML||(c(),PubSub.subscribe("Document/ContentAdded",r),PubSub.subscribe("Document/ContentDeleted",o),PubSub.subscribe("DocOperation/CommandComplete",s),i())},c=function(){e={},PubSub.unsubscribe("Document/ContentAdded",r),PubSub.unsubscribe("Document/ContentDeleted",o),PubSub.unsubscribe("DocOperation/CommandComplete",s)},u=function(t){var i,n=[];for(var r in e)i=e[r],t&&i.type==t&&n.push(i);return n=n.sort(DocUtil.sortFn)},g=function(t){return e[t]&&e[t].isVisible},h=function(e){return Utils.canEvaluateFillableFields()||!g(e)},f=function(){return Utils.canEvaluateFillableFields()},p=function(){return ZWJSONUtils.clone(e)},E=function(t){var i,n=[];for(var r in e)i=e[r],i.start<=t&&i.end>t&&n.push(i);return n=n.sort(DocUtil.sortFn)},T=function(e){var t,i=E(e);return t=i.length>1?i[0].start==e?i[0]:i[i.length-1]:i[0]},O=function(t,i){e[t].isVisible=i},m=function(t){for(var i,n,r=[],o=0,a=t.length;o<a;o++){i=t[o].getId();for(var s in e)n=e[s],n.start!=n.end&&n.fieldIds.contains(i)&&r.push(n)}return r},I=function(t){var i,n,r,o=[],a=t.length,s=[];for(r=0;r<a;r++)s.push(t[r].id);for(r=0;r<a;r++){i=t[r];for(var l in e)n=e[l],i.start<n.start&&i.end>n.end&&!s.contains(n.id)&&o.push(n)}return o};return{init:d,destroy:c,getRangesBasedOnType:u,isConditionToggled:h,getAllConditionRanges:p,getClosestCondition:T,changeVisibility:O,getConditionRanges:m,getInnerConditions:I,isConditionVisible:g}}(),TableCollection=function(){"use strict";var e="Table_",t=new RegExp("[A-Z]+","gm"),i=new RegExp("[0-9]+","gm"),n=new RegExp("[0-9]+[a-zA-z]+","gm"),r=function(){this.tableMapping={},this.unNamedTableMapping={},this.lastInsertedTableNumber=0};return r.prototype.updateLastInsertedTableNumber=function(t){if(t.length>e.length){var n=t.substring(e.length);i.lastIndex=0;var r=n.match(i);r&&r[0].length==n.length&&parseInt(n)>this.lastInsertedTableNumber&&(this.lastInsertedTableNumber=parseInt(n))}},r.prototype.onTableCreated=function(e){var t=e.name;t&&(this.tableMapping[e.id]=t,this.updateLastInsertedTableNumber(t))},r.prototype.getUnnamedTableName=function(){var t=e+(this.lastInsertedTableNumber+1);return this.lastInsertedTableNumber=this.lastInsertedTableNumber+1,t},r.prototype.onStyleChanged=function(e,t,i,n){if(i&&"table"==i.type){var r=n.table,o=(i.name,r.name),a=i.id;o?(this.tableMapping[a]=o,this.updateLastInsertedTableNumber(o)):delete this.tableMapping[a]}},r.prototype.onContentDeleted=function(e,t,i){for(var n,r=Utils.findNextIndexOf(UNICODE.TABLE,0,i);r!=-1;)n=editor.doc.getRawFormatAt(e+r),delete this.tableMapping[n.id],r=Utils.findNextIndexOf(UNICODE.TABLE,r+1,i)},r.prototype.initTables=function(){for(var e,t,i=editor.doc,n=i.findNextIndexOf(UNICODE.TABLE,0);n!=-1;)e=i.getRawFormatAt(n),t=e&&e.name,t?(this.tableMapping[e.id]=t,this.updateLastInsertedTableNumber(t)):this.unNamedTableMapping[e.id]=this.getUnnamedTableName(),n=i.findNextIndexOf(UNICODE.TABLE,n+1)},r.prototype.init=function(){this.bindEvents(),this.initTables()},r.prototype.bindEvents=function(){PubSub.subscribe("Table/Create",this.onTableCreated,{context:this}),PubSub.subscribe("Document/StyleChanged",this.onStyleChanged,{context:this}),PubSub.subscribe("Document/ContentDeleted",this.onContentDeleted,{context:this})},r.prototype.unBindEvents=function(){PubSub.unsubscribe("Table/Create",this.onTableCreated,{context:this}),PubSub.unsubscribe("Document/StyleChanged",this.onStyleChanged,{context:this}),PubSub.unsubscribe("Document/ContentDeleted",this.onContentDeleted,{context:this})},r.prototype.destroy=function(){this.tableMapping={},this.unNamedTableMapping={},this.lastInsertedTableNumber=0,this.unBindEvents()},r.prototype.getNewTableName=function(){var t=e+(this.lastInsertedTableNumber+1);return this.lastInsertedTableNumber=this.lastInsertedTableNumber+1,t},r.prototype.getAllTableNames=function(e){var t=[];for(var i in this.tableMapping)!!this.tableMapping[i]&&t.push(this.tableMapping[i]);return e&&(t=t.concat(this.getUnmappedTableNames())),t},r.prototype.getReplacedValue=function(e,r){for(var o,a,s,l,d,c,u,g,h,f,p=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_START_REGEX,0,e),E=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_END_REGEX,p,e);p!=-1&&E!=-1;){var T=e.substring(p+1,E),O=TableUtil.getTableInfo(T),s=O.name,m=O.cellName.toUpperCase();o=this.getTableIdFromName(s),o?(a=DocTreeManager.getTableById(o),a?(t.lastIndex=0,i.lastIndex=0,n.lastIndex=0,m.match(n)?g=0:(l=m.match(i),d=m.match(t),l&&d?(c=l[0],u=Formula.getColNum(d[0]),f=DocTreeManager.getTreeNodeAtIndex(a.getIndex()),h=DocTreeManager.getTableValues(f,r),g=h[m],g=g?g:0):g=0)):g=0):g=0,e=e.substring(0,p)+g+e.substring(E+1),p=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_START_REGEX,p+1,e),E=Utils.findNextIndexOf(FIELD_PARENTHESIS.TABLE_REF_END_REGEX,p,e)}return e},r.prototype.getTableIdFromName=function(e){var t;for(var i in this.tableMapping)if(t=this.tableMapping[i],t&&t==e)return i;for(i in this.unNamedTableMapping)if(t=this.unNamedTableMapping[i],t&&t==e)return i;return null},r.prototype.isAlreadyExistingTableName=function(e){var t=this.getAllTableNames(!0);return!!t.contains(e)},r.prototype.getTableNameFromId=function(e){return this.tableMapping[e]},r.prototype.getUnnamedTableNameFromId=function(e){return this.unNamedTableMapping[e]},r.prototype.getUnmappedTableNames=function(){var e=[];for(var t in this.unNamedTableMapping)!this.tableMapping[t]&&e.push(this.unNamedTableMapping[t]);return e},r}();zw.define("HiddenRangesHandler",[],["DocOpBuilder","PubSub"],function(e,t){var i=e.build([]),n="",r=function(e){i=e,E(i)},o=function(){return i},a=function(){r(e.build([]))},s=function(t,i){var n,r,o,a,s=new e;for(n=0,r=i.length;n<r;n++)o=i[n],a=[],o.isRangeChar?(a.push({r:o.start}),s.applyOp(e.build(a))):(a.push({r:o.start}),a.push({ds:t.substring(o.start,o.end)}),s.applyOp(e.build(a)));return s=e.concise(s)},l=function(t){for(var n,r,o,a,s,l,d,c,u=i.docOps,g=new e,h=new e,r=0,o=u.length;r<o;r++)if(n=u[r],n.isRetain())g.push(n),h.push(n);else if(n.isHiddenRangeOp())if(d=n.getRangeTypes(),1===d.length&&d[0]===t){for(l=n.getContentStyleOp(),l=l.length()>0?l.docOps:[],a=0,s=l.length;a<s;a++)g.push(l[a]);h.skipChars(n.length())}else c=d.indexOf(t),c>=0&&d.splice(c,1),h.push(n);else n.isHiddenRangeCharOp()&&(d=n.getRangeTypes(),g.skipChars(n.length()),1===d.length&&d[0]===t?h.skipChars(n.length()):(c=d.indexOf(t),c>=0&&d.splice(c,1),h.push(n)));return h=e.concise(h),{insertionOps:g,hiddenOps:h}},d=function(t,i,n,r,o){var a=e.build([]),s=new DocOp,l=new DocOp,d=new DocOp,c=Utils.randomString();s.changeStyles([],i,c),l.newCharacters(n),d.changeStyles(ZWJSONUtils.getKeys(i),[],c),a.push(s),a.push(l),a.push(d),t.push(new HiddenRangeOp(n.length,n,[r],a,null,null,o))},c=function(e,t,i,n,r){e.push(new HiddenRangeCharOp(i.char,[t],i.id,i.isIfConditionShown||!1))},u=function(e,t,i,n,r){var o,a,s,l,c=0,u=null;for(o=i.start,a=i.end;o<a;o++)l=r[o],o!==i.start||l||(l=ReviewUtil.getNearestFormat(o)),l&&u&&(s=n.substring(c,o),d(e,u,s,t,i.id),c=o,u=null),l&&(c=o,u=l);u&&(s=n.substring(c,o),d(e,u,s,t,i.id))},g=function(t){for(var i=t.docOps,n=e.build([]),r=0,o=i.length;r<o;r++){var a=i[r];a.isHiddenRangeOp()?n.push(new HiddenComposeOp(a.range,a.chars,a.rangeTypes,a.contentStyleOp,a.getStyle(),null,a.getId())):n.push(a)}return n},h=function(t){for(var i=t.docOps,n=e.build([]),r=0,o=i.length;r<o;r++){var a=i[r];a.isHiddenComposeOp()?n.push(new HiddenRangeOp(a.range,a.chars,a.rangeTypes,a.contentStyleOp,a.getStyle(),null,a.getId())):n.push(a)}return n},f=function(t){try{b("HiddenRangesHandler xForm and compose Hidden Ops, New Hidden Ops: "+t.toProtoString()),b("HiddenRangesHandler Hiddedn Ops: "+i.toProtoString());var n=e.xform(i,t),r=e.concise(n.first),o=e.concise(n.second),a=e.compose(o,r);a=e.concise(a),i=h(a),i=G(i),E(i),b("HiddenRangesHandler Merged Hiddedn Ops: "+i.toProtoString())}catch(e){ZWLogger.log("Exception occurred while xform and Compose HiddenRangeOps OPs"),ZWLogger.log("Exception: "+(e.stack||e)),ZWLogger.log("HiddenRange OPs: "+i.toProtoString()),ZWLogger.log("New Hidden Ops : "+t.toProtoString());var s=new Error(ZWCollaboration.HIDDEN_RANGE_OPS_PROCESSING_ERROR);throw editor.lastError=s,s}},p=function(t,i){var n,r,o,a,s=editor.doc.getContent(),l=editor.doc.getFormats(),d=e.build([]),h=0;for(n=0,r=i.length;n<r;n++)a=i[n],a.isRangeChar?(a.start-h&&(o=new DocOp,o.skipChars(a.start-h),d.push(o)),h=a.end,c(d,t,a,s,l)):(a.start-h&&(o=new DocOp,o.skipChars(a.start-h),d.push(o)),h=a.end,u(d,t,a,s,l));f(g(d))},E=function(t){for(var i=t.docOps,n=(e.build([]),0),r=i.length;n<r;n++){var o=i[n];(o.isHiddenRangeOp()||o.isHiddenRangeCharOp())&&o.containsConditionRangeType()&&(prevOp&&o.setPreviousOp(prevOp),i[n+1]&&o.setNextOp(i[n+1])),prevOp=o}},T=function(e){return e===NODE_TYPE.COMMENT||e===NODE_TYPE.LINK||e===NODE_TYPE.CONDITIONAL_IF_START||e===NODE_TYPE.CONDITIONAL_IF_END},O=function(e){var t,i,n,r,o,a,s,l,d=[],c=editor.doc.getFormats();return e.forEach(function(e){for(a=e.start,s=e.end,t=e.start,i=e.end;t<i;t++)r=c[t],r&&T(r.type)&&(n=editor.doc.getCharAt(t),o=0,n===UNICODE.RANGE_START?o=DocUtil.getRangeEnd(t):n===UNICODE.RANGE_END&&(o=DocUtil.getRangeStart(t)),!o||e.start<=o&&o<e.end||(t-a&&d.push({start:a,end:t,id:e.id}),l={start:t,end:t+1,isRangeChar:!0,char:n,id:e.id},e.hasOwnProperty("isIfConditionShown")&&(l.isIfConditionShown=e.isIfConditionShown),d.push(l),a=t+1));a<s&&d.push({start:a,end:s,id:e.id})}),d},m=function(e){e.forEach(function(e){e.id=Utils.randomString()})},I=function(e,t){m(t),t=O(t);var i=editor.doc,n=i.getContent();i.getFormats();p(e,t),ZWCollaboration.transformAndApplyOthersCursor(o());var r=s(n,t),a=editor.lastOperation;editor.lastOperation="hiddenRangesApplyto",r.applyTo(Op.createOpInfo()),editor.lastOperation=a,i.snapShotManager&&i.snapShotManager.resetSnapShotManager()},D=function(e){var t=editor.doc,i=l(e),n=editor.lastOperation;editor.lastOperation="hiddenRangesApplyto",i.insertionOps.applyTo(Op.createOpInfo()),editor.lastOperation=n,r(i.hiddenOps),t.snapShotManager&&t.snapShotManager.resetSnapShotManager()},R=function(t,n){var r,o,a,s,l,d,c,u,g,h,f=i.docOps,p=new e,E=new e,T=0;for(o=0,a=f.length;o<a;o++){if(r=f[o],T+=r.length(),r.isRetain())p.push(r),E.push(r);else if(r.isHiddenRangeCharOp())c=r.getRangeTypes(),p.skipChars(r.length()),T>=t&&c.indexOf(n)>=0?1===c.length?E.skipChars(r.length()):(u=c.indexOf(n),c.splice(u,1),E.push(r)):E.push(r);else if(r.isHiddenRangeOp()){if(c=r.getRangeTypes(),h&&g&&(c.indexOf(n)<0||(h.isRetain()||h.isHiddenRangeCharOp())&&g.getId()!=r.getId())){E.push(r);break}if(T>=t&&c.indexOf(n)>=0)if(g=r,1===c.length){for(d=r.getContentStyleOp(),d=d.length()>0?d.docOps:[],s=0,l=d.length;s<l;s++)p.push(d[s]);E.skipChars(r.length())}else u=c.indexOf(n),c.splice(u,1),E.push(r);else E.push(r)}h=r}for(o++;o<a;o++)E.push(f[o]);return E=e.concise(E),p=e.concise(p),{insertionOps:p,hiddenOps:E}},S=function(t,n){try{var o=editor.doc,a=0,s=new e,l=new DocOp;l.skipChars(t),s.push(l);var d=e.xform(i,s);d=e.concise(d.second),a=d.docOps&&d.docOps[0]?d.docOps[0].length():0;var c=R(a,n),u=editor.lastOperation;editor.lastOperation="hiddenRangesApplyto",c.insertionOps.applyTo(Op.createOpInfo()),editor.lastOperation=u,r(c.hiddenOps),o.snapShotManager&&o.snapShotManager.resetSnapShotManager()}catch(e){ZWLogger.log("Exception occurred while showing Range By Index. Index"+t),ZWLogger.log("HiddenRange OPs: "+i.toProtoString()),ZWLogger.log("Exception: "+(e.stack||e))}},C=function(){return!i.isEmpty()},A=function(t,i){var n=t.getContentStyleOp();if(n&&0!==n.length()){var r=new DocOp,o=new DocOp,a=e.build([]),s=Utils.randomString();r.changeStyles([],i,s),o.changeStyles(ZWJSONUtils.getKeys(i),[],s),a.push(r),a.skipChars(t.getContentStyleOpLength()),a.push(o);var l=e.compose(n,a);t.setContentStyleOp(l)}},v=function(t,i){var n=t.getContentStyleOp();n=n.length()>0?n.docOps:[];var r=e.build([]),o=e.build([]);contentIndex=0;for(var a=0,s=n.length;a<s;a++){var l=n[a];if(l.isAnnotation())r.push(l),o.push(l);else if(l.isInsert()){var d=l.length();if(contentIndex+d<=i)r.push(l);else if(contentIndex>=i)o.push(l);else{var c=l.characters,u=i-contentIndex,g=c.substr(0,u),h=c.substr(u),f=new DocOp;f.newCharacters(g);var p=new DocOp;p.newCharacters(h),r.push(f),o.push(p)}contentIndex+=d}}return r=e.concise(r),o=e.concise(o),{inclusiveCutop:r,exclusiveCutop:o}},_=function(t){for(var i=t.docOps,n=e.build([]),r=[],o=0,a=i.length;o<a;o++){var s=i[o];if(s.isRetain())n.skipChars(s.length());else if(s.isHiddenRangeOp()){for(var l=r.length-1;l>=0;l--){var d=r[l],c=s.getContentStyleOp(),u=e.build([]),g=new DocOp,h=new DocOp,f=Utils.randomString();g.changeStyles([],d,f),h.changeStyles(ZWJSONUtils.getKeys(d),[],f),u.push(g),u.skipChars(s.getContentStyleOpLength()),u.push(h);var p=e.compose(c,u);s.setContentStyleOp(p)}n.push(s)}else s.isAnnotationStart()?r.push(s.styles.begin):s.isAnnotationEnd()?r.pop():n.push(s)}return n},P=function(t){for(var i=t.docOps,n=e.build([]),r=0,o=i.length;r<o;r++){var a=i[r];if(a.isRetain())n.skipChars(a.length());else if(a.isInsert()){var s=new DocOp;s.skipChars(a.length()),n.push(s)}else a.isHiddenRangeOp()||a.isHiddenComposeOp()?n.push(a):a.isAnnotation()&&n.push(a)}return n},N=function(t){for(var i=t.docOps,n=e.build([]),r=0,o=i.length;r<o;r++){var a=i[r];a.isRetain()?n.skipChars(a.length()):a.isHiddenRangeOp()||a.isHiddenRemoveOp()?n.push(a):a.isAnnotation()?n.push(a):a.isInsert()&&n.push(a)}return n},b=function(e){var t=editor.doc.docInfo;25==t.REVISION&&1!=t.VERSION&&(n="",ZWLogger.log("25 Revisions reached. Hence, Clearing HiddenRangesHandler related logs..."));var i="\n"+(new Date).toLocaleString()+"->"+e+"| DocId ="+Utils.getDocumentId()+" Doc Len ="+editor.doc.getDocumentLength()+"|CUR:"+t.VERSION+"."+t.REVISION,r=editor.doc.getSelection();r&&(i+="|Selection: "+r.toIntervals().join("|")),n+=i},L=function(){return n},w=function(e){if(e&&0!==e.length){for(var t=e.length-1;t>=0;t--)if(e[t].hasOwnProperty(TCConstants.TC))return e[t];return e[e.length-1]}},y=function(e,t,i){var n,r,o,a=0,s=[];t.forEach(function(t){n=new DocOp,o=Utils.randomString(),s.push(o),n.changeStyles([],t,o),e.push(n)}),e.push(i),t.forEach(function(t){r=new DocOp,r.changeStyles(ZWJSONUtils.getKeys(t),[],s[a]),e.push(r),a++})},M=function(t){for(var i,n,r=e.build([]),o=[],a=[],s=0,l=function(e){var t,i,n;if(e&&e.hasOwnProperty(TCConstants.TC)){var r=e[TCConstants.TC];n="";for(var o=0,a=r.length;o<a;o++){var s=r[o];if(i=s[TCConstants.ZUID],s[TCConstants.ACTION]===TCConstants.DELETE){t=TC_ACTION_DELETE,n=s[TCConstants.TASK]?s[TCConstants.TASK]:"";break}t=TC_ACTION_INSERT,n=s[TCConstants.TASK]?s[TCConstants.TASK]:""}}return{action:t,zuid:i,task:n}},d=t.docOps,c=0,u=d.length;c<u;c++){var g=d[c];if(g.isRetain()){var h=g.length();if(i=w(o),TcUtil.hasTCDeletion(i)){var f=editor.doc.getRawFormatAt(s);f=f?f:DocUtil.getTextStyle(s);for(var p=s,E=s+h,T=s+1;T<E;T++){var O=editor.doc.getRawFormatAt(T);if(O){var m=editor.doc.getContent(p,T),I=(l(i),e.build([]));TcUtil.addOps(I,f,m),r.push(new HiddenComposeOp(T-p,m,[TCConstants.TC],I,i,TCConstants.DELETE)),f=O,p=T}}if(p!==E){var m=editor.doc.getContent(p,E),D=ZWJSONUtils.clone(i);D.tc_nomarkup={styleOps:f,chars:m};var I=(l(i),e.build([]));TcUtil.addOps(I,f,m),r.push(new HiddenComposeOp(E-p,m,[TCConstants.TC],I,i,TCConstants.DELETE))}}else if(i){var R=new DocOp;R.skipChars(h),y(r,o,R)}else r.skipChars(h);s+=h}else if(g.isAnnotationStart())n=g.styles.begin,o.push(g.styles.begin),a.push(g.styles.id);else if(g.isAnnotationEnd()){for(var S=g.styles.id,C=!1,A=o.length,v=A-1;v>=0;v--)if(a[v]==S){o.splice(v,1),a.splice(v,1),C=!0;break}C||(o.pop(),a.pop())}else if(g.isInsert()){var h=g.length();i=w(o);var m=g.characters;if(TcUtil.hasTCDeletion(i)){var D=ZWJSONUtils.clone(i);D.tc_nomarkup={styleOps:i,chars:m};var I=(l(i),e.build([])),_=new DocOp;_.newCharacters(m),y(I,o,_),r.push(new HiddenComposeOp(E-p,m,[TCConstants.TC],I,i,TCConstants.DELETE))}else if(i){var _=new DocOp;_.newCharacters(m),y(r,o,_)}else r.newCharacters(m);s+=h}else if(g.isDelete()){var P=g.delete_characters;r.push(g),s+=P.length}else r.push(g)}return r},F=function(t){for(var i=t.docOps,n=e.build([]),r=0,o=i.length;r<o;r++){var a=i[r];if(a.isHiddenComposeOp()){var s=(a.getContentStyleOp(),a.getContentStyleOpChars(),a.getStyle()),l=new DocOp,d=new DocOp,c=new DocOp,u=Utils.randomString();l.changeStyles([],s,u),d.skipChars(a.length()),c.changeStyles(ZWJSONUtils.getKeys(s),[],u),n.push(l),n.push(d),n.push(c)}else if(a.isHiddenRangeOp()||a.isHiddenRangeCharOp()){var d=new DocOp;d.skipChars(a.length()),n.push(d)}else n.push(a)}return n},U=function(t,n){try{ZWLogger.log("HiddenRangesHandler client OPs before transform "+t.toProtoString()),b("HiddenRangesHandler Client Ops: "+t.toProtoString()),b("HiddenRangesHandler hidden range ops: "+i.toProtoString());var r=t;n===TCConstants.TC&&(r=M(r));var o=e.xform(i,r),a=e.concise(o.first),s=e.concise(o.second),l=P(s),d=e.compose(l,a);i=_(h(d)),i=Q(i),i=e.concise(i),n===TCConstants.TC&&q(i),i=G(i),E(i),b("HiddednRangeOps after transform : "+i.toProtoString())}catch(e){ZWLogger.log("Exception occurred while processing OPs from client to server in hiddenranges"),ZWLogger.log("Exception: "+(e.stack||e)),ZWLogger.log("HiddenRange OPs: "+i.toProtoString()),ZWLogger.log("Ops from client to Server: "+t.toProtoString());var c=new Error(ZWCollaboration.HIDDEN_RANGE_OPS_PROCESSING_ERROR);throw editor.lastError=c,c}},V=function(t,n){try{ZWLogger.log("HiddenRangesHandler client OPs before transform "+t.toProtoString()),b("HiddenRangesHandler Client Ops: "+t.toProtoString()),b("HiddenRangesHandler hidden range ops: "+i.toProtoString());var r=t;n===TCConstants.TC&&(r=M(r));var o=e.xform(i,r),a=(e.concise(o.first),e.concise(o.second));n===TCConstants.TC&&(a=F(a))}catch(e){ZWLogger.log("Exception occurred while processing OPs from client to server in hiddenranges"),ZWLogger.log("Exception: "+(e.stack||e)),ZWLogger.log("HiddenRange OPs: "+i.toProtoString()),ZWLogger.log("Ops from client to Server: "+t.toProtoString());var s=new Error(ZWCollaboration.HIDDEN_RANGE_OPS_PROCESSING_ERROR);throw editor.lastError=s,s}return ZWLogger.log("HiddenRangeHandler client OPs after transform "+a.toProtoString()),b("HiddenRangeHandler client OPs after transform "+a.toProtoString()),a},B=function(t){try{var n=[];t=JSON.parse(t);for(var r=0,o=t.length;r<o;r++){var a=t[r].si,s=t[r].ei,l=editor.doc.getSelection().createCursorOp(a,s);l=e.build(l);var d=e.xform(i,l),c=d.second.getCursorPos()[0];a=c.start>=0?c.start:c.end,s=c.end>=0?c.end:c.start,n.push({si:a,ei:s})}}catch(e){ZWLogger.log("Exception occurred while XForm the Cursor OP from Client to Server with HiddenRange OPs"),ZWLogger.log("HiddenRange OPs: "+i.toProtoString()),ZWLogger.log("Cursor OP : "+l.toProtoString()),ZWLogger.log("Exception: "+(e.stack||e));var u=new Error(ZWCollaboration.HIDDEN_RANGE_OPS_PROCESSING_ERROR);throw editor.lastError=u,u}return JSON.stringify(n)},x=function(e){b("Hidden Ops "+e.toProtoString());for(var t,i,n=e.docOps,r=0,o=n.length;r<o;r++){var a=n[r];a.isHiddenRangeOp()&&a.range!=a.originalRange&&a.setOriginalRange(a.range),a.isHiddenRangeOp()&&a.getRangeTypes()&&0===a.getRangeTypes().length&&(t.isHiddenRangeOp()?a.setRangeTypes(t.getRangeTypes()):(i=new DocOp,i.skipChars(a.range),n.splice(r,1,i))),t=a}b("Updated Hidden Ops "+e.toProtoString())},W=function(e,t){var i=e.getRangeTypes(),n=t.getRangeTypes();if(i.length!=n.length)return!1;for(var r=0,o=i.length;r<o;r++)if(n.indexOf(i[r])<0)return!1;return!0},H=function(t,i){for(var n=t.range+i.range,r=t.chars+i.chars,o=e.clone(t.getContentStyleOp()),a=i.getContentStyleOp(),s=a.length()>0?a.docOps:[],l=0,d=s.length;l<d;l++)o.push(s[l]);return new HiddenRangeOp(n,r,t.getRangeTypes(),o,t.getStyle(),null,t.getId())},G=function(t){var i,n,r=t.getDocOps(),o=new e,a=r.length;for(n=0;n<a;n++){i=r[n];var s=o.docOps.pop();s?s.isHiddenRangeOp()&&i.isHiddenRangeOp()&&W(s,i)?o.push(H(s,i)):(o.push(s),o.push(i)):o.push(i)}return o},k=function(t,n){try{var r,o,a,s=t,l=n===TCConstants.TC;ZWLogger.log("HiddenRangesHandler Server OPs: "+s.toProtoString()),b("HiddenRangesHandler Server Ops "+s.toProtoString()),b("HiddenRangesHandler Hidden range Ops"+i.toProtoString()),l?(a=z(t),r=a.includeTCRemoveOps):r=t;var d=e.xform(r,i),c=e.concise(d.second),u=e.concise(d.first);l?(o=a.tcServerOpsForCompose,X(o)):o=t;var g=N(o),h=e.compose(g,c);return l&&(h=K(h),u=J(u),u=j(u)),i=_(h),i=Q(i),i=e.concise(i),q(i),x(i),i=G(i),E(i),b("HiddenRangesHandler hidden ranges ops after transform: "+i.toProtoString()),u}catch(e){ZWLogger.log("Exception occurred while processing OPs from server to client in hiddenranges"),ZWLogger.log("Hidden Ranges Ops: "+i.toProtoString()),ZWLogger.log("Ops from server to client : "+t.toProtoString()),ZWLogger.log("Exception: "+(e.stack||e));var f=new Error(ZWCollaboration.HIDDEN_RANGE_OPS_PROCESSING_ERROR);throw editor.lastError=f,b("Exception: "+(e.stack||e)),e}return ZWLogger.log("Hidden Ranges server OPs after transform "+t.toProtoString()),b("Hidden Ranges server OPs after transform "+t.toProtoString()),t},Y=function(e,t){var i=editor.doc.getRawFormatAt(e);return i=i?i:DocUtil.getTextStyle(e),i=DocUtil.copyStyle(i),Z(i,t),i},Z=function(e,t){!e.hasOwnProperty(TCConstants.TC)&&t.hasOwnProperty(TCConstants.TC)?e[TCConstants.TC]=t[TCConstants.TC]:e.hasOwnProperty(TCConstants.TC)&&t.hasOwnProperty(TCConstants.TC)&&DocOpUtil.updateTCStyles(e,t)},z=function(t){for(var i,n,r=e.build([]),o=e.build([]),a=e.build([]),s=[],l=[],d=0,c=0,u=function(e){var t,i,n;if(e&&e.hasOwnProperty(TCConstants.TC)){var r=e[TCConstants.TC];n="";for(var o=0,a=r.length;o<a;o++){var s=r[o];if(i=s[TCConstants.ZUID],s[TCConstants.ACTION]===TCConstants.DELETE){t=TC_ACTION_DELETE,n=s[TCConstants.TASK]?s[TCConstants.TASK]:"";break}t=TC_ACTION_INSERT,n=s[TCConstants.TASK]?s[TCConstants.TASK]:""}}return{action:t,zuid:i,task:n}},g=t.docOps,h=0,f=g.length;h<f;h++){var p=g[h];if(p.isRetain()){var E=p.length();if(i=w(l),TcUtil.hasTCDeletion(i)){var T=u(i),O=T.task,m=editor.doc.getContent(d,d+E),I=editor.doc.getContent(c,c+E),D=Y(d,i),R=e.build([]);TcUtil.addOps(R,D,m);var S=i.tc_nomarkup;if(S=S?S:{},r.deleteCharacters(I),O===TCConstants.REMOVE){var C=new HiddenRemoveOp(E,m,[TCConstants.TC],[],i,TCConstants.DELETE);o.push(C),a.push(new HiddenRemoveOp(E,m,[TCConstants.TC],[],i,TCConstants.DELETE))}else y(o,l,p),a.push(new HiddenRangeOp(E,m,[TCConstants.TC],R,i,TCConstants.DELETE))}else r.skipChars(E),o.skipChars(E),a.skipChars(E);d+=E,c+=E}else if(p.isAnnotationStart()){if(n=p.styles.begin,l.push(n),!TcUtil.hasTCDeletion(n)){var A=new DocOp;A.changeStyles([],n,p.styles.id),r.push(A),o.push(A),a.push(A),s.push(d)}}else if(p.isAnnotationEnd()){if(n=p.styles.end,i=l.pop(),s.length){var A=new DocOp;A.changeStyles(n,[],p.styles.id),r.push(A),o.push(A),a.push(A),s.pop()}}else if(p.isInsert()){var E=p.length();if(i=w(l),TcUtil.hasTCDeletion(i)){var T=u(i),O=T.task,m=p.characters,R=e.build([]),v=new DocOp;v.newCharacters(m),y(R,l,v);var S=i.tc_nomarkup;S=S?S:{},O===TCConstants.REMOVE?(o.push(new HiddenRemoveOp(m.length,m,[TCConstants.TC],R,i,TCConstants.INSERT)),a.push(new HiddenRemoveOp(m.length,m,[TCConstants.TC],R,i,TCConstants.INSERT))):(y(o,l,p),a.push(new HiddenRangeOp(m.length,m,[TCConstants.TC],R,i,TCConstants.INSERT)))}else{var _=p.characters;r.newCharacters(_),o.newCharacters(_),a.newCharacters(_)}d+=E}else if(p.isDelete()){var _=p.delete_characters;r.deleteCharacters(_),o.deleteCharacters(_),a.deleteCharacters(_),d+=_.length,c+=_.length}else p.isRemoveTC()&&r.push(p)}return{excludedTCDeleteOps:r,includeTCRemoveOps:o,tcServerOpsForCompose:a}},J=function(t){for(var i,n,r=e.build([]),o=[],a=[],s=0,l=t.docOps,d=0,c=l.length;d<c;d++){var u=l[d];if(u.isRetain()){var g=u.length();if(i=w(a),TcUtil.hasTCDeletion(i)){var h=editor.doc.getContent(s,s+g);r.deleteCharacters(h)}else r.skipChars(g);s+=g}else if(u.isAnnotationStart()){if(n=u.styles.begin,a.push(n),!TcUtil.hasTCDeletion(n)){var f=new DocOp;f.changeStyles([],n,u.styles.id),r.push(f),o.push(s)}}else if(u.isAnnotationEnd()){if(n=u.styles.end,i=a.pop(),o.length){var f=new DocOp;f.changeStyles(n,[],u.styles.id),r.push(f),o.pop()}}else if(u.isInsert()){var g=u.length();if(i=w(a),!TcUtil.hasTCDeletion(i)){var p=u.characters;r.newCharacters(p)}}else if(u.isDelete()){var p=u.delete_characters;r.deleteCharacters(p),s+=p.length}else u.isHiddenRemoveOp()&&r.push(u)}return r},j=function(t){for(var i=t.docOps,n=e.build([]),r=0,o=i.length;r<o;r++){var a=i[r];if(a.isHiddenRemoveOp()){var s=a.getRangeTypes();if(s&&1===s.length&&s[0]===TCConstants.TC){var l=a.getContentStyleOp();if(!l||0===l.length()){n.skipChars(a.length());continue}var d=new DocOp,c=new DocOp,u=e.build([]),g=Utils.randomString();d.changeStyles([],a.style,g),c.changeStyles(ZWJSONUtils.getKeys(a.style),[],g),u.push(d),u.skipChars(a.getContentStyleOpLength()),u.push(c);for(var h=e.compose(l,u),f=h.docOps,p=0,E=f.length;p<E;p++)n.push(f[p])}}else n.push(a)}return n},X=function(e){for(var t=e.docOps,i=0,n=t.length;i<n;i++){var r=t[i];r.isHiddenRangeOp()&&r.getOriginAction()===TCConstants.DELETE&&r.setChars("")}},K=function(t){for(var i=t.docOps,n=e.build([]),r=0,o=0,a=0,s=i.length;a<s;a++){var l=i[a];if(l.isRetain())r+=l.length(),n.push(l);else if(l.isHiddenRangeCharOp())r+=l.length(),n.push(l);else if(l.isHiddenRangeOp()&&l.getOriginAction()===TCConstants.DELETE){var o=l.length(),d=0,c=null;c=editor.doc.getRawFormatAt(r),c=c?c:DocUtil.getTextStyle(r),d=r;for(var u=r+1;u<r+o;u++){var g=editor.doc.getRawFormatAt(u);if(g){var h=editor.doc.getContent(d,u),f=e.build([]);TcUtil.addOps(f,c,h);var p=l.getStyle(),E=e.build([]),T=new DocOp,O=new DocOp,m=Utils.randomString();T.changeStyles([],p,m),O.changeStyles(ZWJSONUtils.getKeys(p),[],m),E.push(T),E.skipChars(h.length),E.push(O);var I=e.compose(f,E);n.push(new HiddenRangeOp(u-d,h,[TCConstants.TC],I,l.getStyle(),l.getOriginAction())),c=g,d=u}}if(c){var h=editor.doc.getContent(d,u),f=e.build([]);TcUtil.addOps(f,c,h);var p=l.getStyle(),E=e.build([]),T=new DocOp,O=new DocOp,m=Utils.randomString();T.changeStyles([],p,m),O.changeStyles(ZWJSONUtils.getKeys(p),[],m),E.push(T),E.skipChars(h.length),E.push(O);var I=e.compose(f,E);n.push(new HiddenRangeOp(u-d,h,[TCConstants.TC],I,l.getStyle(),l.getOriginAction()))}r+=o}else n.push(l)}return n},Q=function(t){for(var i=t.docOps,n=e.build([]),r=0,o=i.length;r<o;r++){var a=i[r];if(a.isInsert()){var s=new DocOp;s.skipChars(a.length()),n.push(s)}else a.isRetain()&&0!=a.retain_count?n.push(a):(a.isHiddenRangeOp()||a.isHiddenRangeCharOp())&&n.push(a)}var l=-1;for(r=0,o=n.length();r<o;r++){var a=n.docOps[r];(a.isHiddenRangeOp()||a.isHiddenRangeCharOp())&&(l=r)}if(l!=o-1){var d=e.build([]);for(r=0;r<=l;r++)d.push(n.docOps[r])}else var d=n;return d},q=function(e){for(var t=e.docOps,i=0,n=t.length;i<n;i++){var r=t[i];r.isHiddenRangeOp()&&r.setOriginAction("hidden")}},$=function(t,n){try{var r=editor.doc.getSelection().createCursorOp(t,n);r=e.build(r);var o=e.xform(r,i),a=o.first.getCursorPos()[0];t=a.start>=0?a.start:a.end,n=a.end>=0?a.end:a.start}catch(e){ZWLogger.log("Exception occurred while XForm the Cursor OP from Server to Client with HiddenRangeOps OPs"),ZWLogger.log("HiddenRange OPs: "+i.toProtoString()),ZWLogger.log("Cursor OP : "+r.toProtoString()),ZWLogger.log("Exception: "+(e.stack||e));var s=new Error(ZWCollaboration.HIDDEN_RANGE_OPS_PROCESSING_ERROR);throw editor.lastError=s,s}return{start:t,end:n}},ee=function(){for(var e,t,n=i.docOps,r=TCConstants.TC,o=0,a=n.length;o<a;o++)if(t=n[o],t.isHiddenRangeOp()&&(e=t.getRangeTypes(),e&&e.indexOf(r)>=0))return!0;return!1},te=function(e){f(e)},ie=function(e){return e=z(e),e.excludedTCDeleteOps},ne=function(){var e=editor.doc.getContent(),t=e.slice(1,e.length-5);Op.processMsg([{r:1},{ds:t},{as:{start:{type:"text"},id:"y24s69ojew0m"}},{is:"A"},{as:{end:["type"],id:"y24s69ojew0m"}},{is:"BCD 1234 EFGH 5678"}]),Op.sendMsg(),setTimeout(function(){I("job",[{start:6,end:10},{start:16,end:18}])},2e3)};return t.subscribe("Document/BeforeLoad",a),{hasHiddenRangeOps:C,getHiddenRangeOps:o,setHiddenRangeOps:r,cutContentStyleOp:v,applyContentStyle:A,hasTcHiddenRange:ee,addTcHiddenRangesOps:te,convertOPs:z,processClientToServerOp:V,composeClientOpAndHiddenRangeOps:U,processClientToServerCursorOp:B,processServerToClientOp:k,processServerToClientCursorOp:$,hideRanges:I,showRanges:D,getLog:L,processTcClientOp:ie,showRangeByIndex:S,reset:a,resetContent:ne}}),function(){var e=function(e){return t(e)||n(e)||g(e)||l(e)},t=function(e){return!(e.type!=NODE_TYPE.REPEAT_START||!e.hasOwnProperty(MAILMERGE.MMINFO))},i=function(e){for(var t=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,e);t!=-1;){var i=DocUtil.getRangeEnd(t),n=editor.doc.getRawFormatAt(t);if(n.type===NODE_TYPE.REPEAT_START&&t<=e&&e<=i)return{start:t,end:i,info:n.mminfo,type:NODE_TYPE.PARA,id:n.id};t=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,t)}return null},n=function(e){return!(e.type!=NODE_TYPE.ROW||!e.hasOwnProperty(MAILMERGE.MMINFO))},r=function(e){var t=DocTreeManager.getParents(NODE_TYPE.TABLE,e);return null!=t&&t.getIndex()==e&&o(t)},o=function(e){for(var t=e.children,i=0;i<t.length;i++){var n=t[i],r=n.format;if(r.hasOwnProperty(MAILMERGE.MMINFO))return!0}return!1},a=function(e){if(!e)return!1;var t=e.parentNode(),i=t.attr();return!!MailMergeRepeatUtil.isRowRepeat(i)},s=function(e){for(var t=e.children,i=0;i<t.length;i++){var n=t[i],r=n.format;if(r.mminfo)return i}},l=function(e){for(var t=e.cols||[],i=0;i<t.length;i++){var n=t[i];if(n[MAILMERGE.MMINFO])return!0}return!1},d=function(e){if(!e)return!1;var t=e.parentNode().parentNode(),i=t.attr();if(MailMergeRepeatUtil.isColumnRepeat(i)){var n=c(i),r=e.dtNode.getChildIndex();if(r>=n.start&&r<=n.end)return!0}return!1},c=function(e){for(var t=null,i=e.cols||[],n=0;n<i.length;n++){var r=i[n];r[MAILMERGE.MMINFO]&&(t||(t={}),t.hasOwnProperty("start")||(t.start=n,t.mminfo=r[MAILMERGE.MMINFO]),t.end=n)}return t},u=function(e){var t=c(e);return t.start},g=function(e){return!(e.type!=NODE_TYPE.CELL||!e.hasOwnProperty(MAILMERGE.MMINFO))},h=function(e){var t=DocTreeManager.getParents(NODE_TYPE.TABLE,e);return null!=t&&t.getIndex()==e&&f(t)},f=function(e){for(var t=e.children,i=0;i<t.length;i++)for(var n=t[i],r=n.children,o=0;o<r.length;o++){var a=r[o],s=a.format;if(s.hasOwnProperty(MAILMERGE.MMINFO))return!0}return!1},p=function(e){return!!g(e.format)&&0!=e.getChildIndex()},E=function(e){return!!e&&(a(e)||d(e)||g(e.attr()))},T=function(e){if(!e)return null;if(g(e.format))return{start:e.getIndex(),end:e.getEndIndex(),info:e.format.mminfo,type:NODE_TYPE.CELL};var t=e.parent;if(n(t.format))return{start:t.getIndex(),end:t.getEndIndex(),info:t.format.mminfo,type:NODE_TYPE.ROW};var i=t.parent;if(l(i.format)){var r=i.format,o=c(r),a=e.getChildIndex();if(a>=o.start&&a<=o.end)return{start:i.getIndex(),end:i.getEndIndex(),info:o.mminfo,type:"column"}}return f(i)?(e=i.children[0].children[0],{start:i.getIndex(),end:i.getEndIndex(),info:e.format.mminfo,type:NODE_TYPE.CELL}):null};window.MailMergeRepeatUtil={isRepeat:e,isParaRepeat:t,getParaRangeInfo:i,isRowRepeat:n,isRowRepeatPresentInTable:r,isRowRepeatPresent:o,isRowRepeatCell:a,getRepeatRowIdx:s,isColumnRepeat:l,isColumnRepeatCell:d,getRepeatColumnInfo:c,getRepeatColumnIdx:u,isCellRepeat:g,isCellRepeatPresentInTable:h,isCellRepeatPresent:f,isNonEditableRepeatCell:p,isRepeatCell:E,getRepeatInfoFromCell:T}}(),function(){var e=!1,t=!1,i=function(){return t},n=function(){return t||e},r=function(e){if(!i())return!1;var t=DocLayoutManager.getLineAtIndex(e);if(!t)return!1;var n=J(DomViewManager.getDOMElem(t));return!!n.find(".js-mm-repeat-para").length},o=function(){PubSub.subscribe([DOMVIEW.LINE_ADDED,DOMVIEW.LINE_UPDATED],c),PubSub.subscribe([DOMVIEW.CELLVIEW_AFTER_CREATE,DOMVIEW.CELLVIEW_AFTER_UPDATE],s),PubSub.subscribe("Document/readonlyview",a)},a=function(){PubSub.unsubscribe([DOMVIEW.LINE_ADDED,DOMVIEW.LINE_UPDATED],c),PubSub.unsubscribe([DOMVIEW.CELLVIEW_AFTER_CREATE,DOMVIEW.CELLVIEW_AFTER_UPDATE],s)},s=function(t){try{var i=MailMergeRepeatUtil.getRepeatInfoFromCell(t);i&&(e=!0,l(t,i))}catch(e){}},l=function(e,t){t=t||MailMergeRepeatUtil.getRepeatInfoFromCell(e);for(var i=MailMergeRepeatUtil.isNonEditableRepeatCell(e),n=DocLayoutManager.getViews(e),r=0;r<n.length;r++){var o=J(DomViewManager.getDOMElem(n[r]));o.addClass("mmrepeatrange-bdr"),d(o,t.type),i&&o.addClass("ui-state-disabled");var a=e.parent,s=a.parent;if(a.getChildIndex()){var l=s.children[a.getChildIndex()-1],c=l.children[e.getChildIndex()],u=DocLayoutManager.getViews(c);if(u&&u.length){var g=J(DomViewManager.getDOMElem(u[u.length-1]));g.addClass("mmrepeatrange-bdr-bottom")}}if(e.getChildIndex()){var h=a.children[e.getChildIndex()-1],f=DocLayoutManager.getViews(h);if(f&&f.length){var p=J(DomViewManager.getDOMElem(f[0]));p.addClass("mmrepeatrange-bdr-right")}}}},d=function(e,t){var i=J.i18n("writer.mailmerge."+t.toUpperCase()+"_REPEAT_TOOLTIP"),n='<div class="ui-ztooltip-content"><div style="width: 200px; text-align: center;">'+i+"</div></div>";e.attr("title",n),e.ztooltip({isMessageHTMLEncoded:!0,innerHTML:n})},c=function(e){setTimeout(function(){g(e)},1)},u=function(e,i){var n=[],r=editor.doc.getContent(),o=RegExp(UNICODE.RANGE_START+"|"+UNICODE.RANGE_END,"gi");o.lastIndex=e;for(var a=o.exec(r);a;){var s=a.index;if(s>i)break;var l=editor.doc.getRawFormatAt(s)||{};if(l.type==NODE_TYPE.REPEAT_START&&l.hasOwnProperty(MAILMERGE.MMINFO)){var d=DocUtil.getRangeEnd(s);n.push({start:s,end:d,type:NODE_TYPE.PARA,id:l.id})}else if(l.type==NODE_TYPE.REPEAT_END){var c=DocUtil.getRangeStart(s);n.push({start:c,end:s,type:NODE_TYPE.PARA,id:l.id})}a=o.exec(r)}if(!n.length&&t){var u=MailMergeRepeatUtil.getParaRangeInfo(e);u&&n.push(u)}return n},g=function(e){if(!isV8Engine)try{var i=J(DomViewManager.getDOMElem(e));i.find(".js-mm-repeat-para").remove();var n=e.absStart,r=e.absEnd,o=u(n,r);if(!o.length)return;t=!0;for(var a=0;a<o.length;a++){var s=o[a],l=s.start,d=s.end,c={},g=e.getWidth();c.width=g,c.height=e.getHeight(!0);var f=DocLayoutManager.getLeftAtIndex(n);c.left=f;var p=parseFloat(i.css("padding-top")||0)+"px";if(c.top=p,l>n){var E=DocLayoutManager.getLeftAtIndex(l);c.left=E,c.width=g+f-E}if(d<r){var T=DocLayoutManager.getLeftAtIndex(d);c.width=T-c.left}c["z-index"]=-10;var O=J("<div>");O.addClass("js-mm-repeat-para mmrepeatrange"),O.css(c).appendTo(i[0]),h(i,c)}}catch(e){}},h=function(e,t){var i=J("<div>");i.addClass("js-mm-repeat-para"),i.css(t).appendTo(e[0]),i.css({position:"absolute"}),d(i,NODE_TYPE.PARA)},f=function(){isHeadlessPDF||isHeadlessHTML||!Macros.isMergeTemplate()||"undefined"!=typeof MailMergeUtil&&MailMergeUtil.isPreviewMode()||o()};window.MailMergeRepeatView={isRepeatRendered:n,isRepeatPresentInPara:r,init:f,addCellBorder:l}}();var ZWIDBUtil=function(e){"use strict";function t(e,t,i,n,r,o){if(r.length)try{o=o||{},this.tableName=t,this.transactionType=i,this.operationType=n,this.records=r||[],this.currentRecord=null,this.index=0,this.state="pending",this.table=null,this.resultCollection=[],this.onsuccess=o.onsuccess,this.onerror=o.onerror,this.oncomplete=o.oncomplete,this.onfailure=o.onfailure,this.openTable(e),this.performOperation()}catch(e){this.state="failure";var a={transactionStatus:this.state,exception:e.stack};f.call(this,a)}}var i={SUCCESS:"SUCCESS",FAILURE:"FAILURE"},n={READ_WRITE:"readwrite",READ_ONLY:"readonly"},r={GET:"get",PUT:"put",DELETE:"delete"},o=function(e,t,i){var n=!0,r=function(e){i&&i(n)},o=window.indexedDB.open(e,t);o.onupgradeneeded=function(e){n=!1,e.target.transaction.abort()},o.onblocked=function(e){n=!1,r(e)},o.onsuccess=r,o.onerror=function(e){n=!1,r(e)}},a=function(t,n){var r=n||{};if(!e.indexedDB)throw new Error("IndexedDB is not supported in this version of browser");var o=e.indexedDB.open(t.name,t.dbversion);o.onblocked=function(e){r.onblocked&&r.onblocked("BLOCKED")},o.onupgradeneeded=function(e){for(var i,n,r=e.target.result,o=t.tables,a=0,s=o.length;a<s;a++)i=o[a],r.objectStoreNames.contains(i.name)||(n=r.createObjectStore(i.name,i.props))},o.onsuccess=function(e){var t=e.target.result;r.onsuccess&&r.onsuccess(t)},o.onerror=function(e){r.onerror&&r.onerror(i.FAILURE)}},s=function(e){e&&e.close()},l=function(t,n){var r=e.indexedDB.deleteDatabase(t);r.onsuccess=function(){n&&n(i.SUCCESS)},r.onerror=function(){n&&n(i.FAILURE)}},d=function(e,i,o,a){new t(e,i,n.READ_ONLY,r.GET,o,a)},c=function(e,i,o,a){new t(e,i,n.READ_WRITE,r.PUT,o,a)},u=function(e,i,o,a){new t(e,i,n.READ_WRITE,r.DELETE,o,a)},g=function(e,t,r){var o=r||{},a=[],s=e.transaction([t],n.READ_ONLY);s.oncomplete=function(e){var t={result:a,status:i.SUCCESS};o.oncomplete&&o.oncomplete(t)},s.onerror=function(e){var t={status:i.FAILURE};o.onfailure&&o.onfailure(t)};var l=s.objectStore(t),d=l.openCursor();d.onsuccess=function(e){var t=e.target.result;if(t)a.push(t.value),t.continue();else{var n={result:a,status:i.SUCCESS};o.onsuccess&&o.onsuccess(n)}},d.onerror=function(e){var t={status:i.FAILURE};o.onerror&&o.onerror(t)}},h=function(e,t,r){var o=r||{},a=e.transaction([t],n.READ_WRITE);a.oncomplete=function(e){o.oncomplete&&o.oncomplete(i.SUCCESS)},a.onerror=function(e){o.onfailure&&o.onfailure(i.FAILURE)};var s=a.objectStore(t),l=s.clear();l.onsuccess=function(e){o.onsuccess&&o.onsuccess(i.SUCCESS)},l.onerror=function(e){o.onerror&&o.onerror(i.FAILURE)}};t.prototype.destroy=function(){this.records=[],this.currentRecord=null,this.table=null,this.resultCollection=[],this.onsuccess=null,this.onerror=null,this.oncomplete=null,this.onfailure=null},t.prototype.openTable=function(e){var t=this,i=e.transaction([this.tableName],this.transactionType);this.table=i.objectStore(this.tableName),i.oncomplete=function(e){t.state="complete";var i={result:t.resultCollection,transactionStatus:t.state};f.call(t,i)},i.onerror=function(e){t.state="failure";var n={transactionStatus:t.state,exception:i&&i.error||"IDB Transaction error"};f.call(t,n)}},t.prototype.performOperation=function(){if(!(this.index>=this.records.length)){var e=this;this.currentRecord=this.records[this.index++];var t=this.table[this.operationType](this.currentRecord);t.onsuccess=function(t){p.call(e,"success",t)},t.onerror=function(t){p.call(e,"error",t)}}};var f=function(e){var t=this["on"+this.state];t&&t(e)},p=function(e,t){var i;i=this.operationType==r.GET?{key:this.currentRecord,record:t.target.result,status:e}:this.operationType==r.DELETE?{key:this.currentRecord,record:t.target.result,status:e}:{key:t.target.result,record:this.currentRecord,status:e},this.resultCollection.push(i);var n=this["on"+e];if(n){var o={transactionStatus:this.index==this.records.length?"complete":"pending",result:i};n(o)}this.performOperation()};return{doesDBExist:o,openDatabase:a,closeDatabase:s,fetchAllContents:g,fetchContents:d,storeContents:c,deleteContents:u,deleteAllContents:h,dropDatabase:l}}(window),ZWDBWrapper=function(e,t){"use strict";function i(){this.queue=[],this.currentOperation=null}function n(e){this.operationQueues={},this.db=e}i.prototype.enQueue=function(e){this.queue.push(e),this.performOperation()},i.prototype.deQueue=function(){return this.queue.shift()},i.prototype.isEmpty=function(){return 0===this.queue.length},i.prototype.performOperation=function(){if(null===this.currentOperation&&!this.isEmpty()){this.currentOperation=this.queue[0];var e=this,t=e.currentOperation();t.always(function(){e.deQueue(),e.currentOperation=null,e.performOperation()})}},n.prototype.addToOperationQueue=function(e,t){this.operationQueues[e]||(this.operationQueues[e]=new i),this.operationQueues[e].enQueue(t)},n.prototype.fetchContents=function(i,n){var r=new t,o=r.promise(),a=this,s=function(){var t={onsuccess:function(e){r.notify(e)},onerror:function(e){r.notify(e)},oncomplete:function(e){r.resolve(e)},onfailure:function(e){r.reject(e)}};return e.fetchContents(a.db,i,n,t),o};return this.addToOperationQueue(i,s),o},n.prototype.storeContents=function(i,n){var r=new t,o=r.promise(),a=this,s=function(){var t={onsuccess:function(e){r.notify(e)},onerror:function(e){r.notify(e)},oncomplete:function(e){r.resolve(e)},onfailure:function(e){r.reject(e)}};return e.storeContents(a.db,i,n,t),o};return this.addToOperationQueue(i,s),o},n.prototype.deleteContents=function(i,n){var r=new t,o=r.promise(),a=this,s=function(){var t={onsuccess:function(e){r.notify(e)},onerror:function(e){r.notify(e)},oncomplete:function(e){r.resolve(e)},onfailure:function(e){r.reject(e)}};return e.deleteContents(a.db,i,n,t),o};return this.addToOperationQueue(i,s),o},n.prototype.fetchAllContents=function(i){var n=new t,r=n.promise(),o=this,a=function(){var t={onsuccess:function(e){n.notify(e)},onerror:function(e){n.notify(e)},oncomplete:function(e){n.resolve(e)},onfailure:function(e){n.reject(e)}};return e.fetchAllContents(o.db,i,t),r};return this.addToOperationQueue(i,a),r},n.prototype.deleteAllContents=function(i){var n=new t,r=n.promise(),o=this,a=function(){var t={onsuccess:function(e){n.notify(e)},onerror:function(e){n.notify(e)},oncomplete:function(e){n.resolve(e)},onfailure:function(e){n.reject(e)}};return e.deleteAllContents(o.db,i,t),r};return this.addToOperationQueue(i,a),r},n.prototype.closeDatabase=function(){e.closeDatabase(this.db)},n.prototype.dropDatabase=function(){var i=new t,n=i.promise(),r=function(e){"SUCCESS"==e?i.resolve(e):i.reject(e)};return e.dropDatabase(this.db.name,r),n},n.prototype.isDBOperationsPending=function(){var e;for(e in this.operationQueues)if(!this.operationQueues[e].isEmpty())return!0;return!1};var r=function(i){var r=new t,o={onblocked:function(e){r.reject(null)},onsuccess:function(e){var t=new n(e);r.resolve(t)},onerror:function(e){r.reject(null)}};return e.openDatabase(i,o),r.promise()},o=function(i,n){var r=new t,o=function(e){e===!0?r.resolve(e):r.reject(e)};return e.doesDBExist(i,n,o),r.promise()};return{configureDB:r,doesDBExist:o}}(ZWIDBUtil,Deferred),ZWOfflineDBUtil=function(e,t){"use strict";var i="ZWriterOfflineDB",n="ZWDocumentTable",r="ZWImageTable",o="ZWOpsTable",a="ZWMetaTable",s="ZWNewDocumentTable",l={BLANK:"blank"},d={name:i,dbversion:1,tables:[{name:n,props:{keyPath:"rid",autoIncrement:!1}},{name:r,props:{keyPath:"rid",autoIncrement:!1}},{name:o,props:{keyPath:"rid",autoIncrement:!1}},{name:a,props:{keyPath:"keyId",autoIncrement:!1}},{name:s,props:{keyPath:"documentCategory",autoIncrement:!1}}]},c=null,u=function(){return e.doesDBExist(d.name,d.dbversion)},g=function(){ZWOfflineLogger.log("ConfigureDB ASync Function Start");var i=new t,n=e.configureDB(d);return n.then(function(e){ZWOfflineLogger.log("Configure DB succeeded"),c=e,i.resolve(e)},function(){ZWOfflineLogger.log("Configure DB Failed"),c=null;var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.CONFIGURE_DB_FAILED};i.reject(e)}),ZWOfflineLogger.log("ConfigureDB ASync Function End"),i.promise()},h=function(){ZWOfflineLogger.log("getMetaFromDB Function Start");var e=new t,i=c.fetchContents(a,["metadata"]);return i.then(function(t){ZWOfflineLogger.log("getMetaFromDB Succeeded"),e.resolve(t.result[0].record)},function(t){ZWOfflineLogger.log("getMetaFromDB Failed");var i={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.META_FETCH_FROM_DB_FAILED,resp:t};e.reject(i)}),ZWOfflineLogger.log("getMetaFromDB Function End"),e.promise()},f=function(e){ZWOfflineLogger.log("storeMetaInDB Function Start");var i=new t,n=c.storeContents(a,[e]);return n.then(function(e){ZWOfflineLogger.log("storeMetaInDB Succeeded"),i.resolve(e)},function(){ZWOfflineLogger.log("storeMetaInDB Failed");var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.META_STORE_TO_DB_FAILED};i.reject(e)}),ZWOfflineLogger.log("storeMetaInDB Function End"),i.promise()},p=function(e){ZWOfflineLogger.log("getDocumentFromDB Function Start");var i=new t,r=c.fetchContents(n,[e]);return r.then(function(e){ZWOfflineLogger.log("getDocumentFromDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("getDocumentFromDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.DOC_FETCH_FROM_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("getDocumentFromDB Function End"),i.promise()},E=function(e){ZWOfflineLogger.log("storeDocumentInDB Function Start");var i=new t,r=c.storeContents(n,[e]);return r.then(function(e){ZWOfflineLogger.log("storeDocumentInDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("storeDocumentInDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.DOC_STORE_TO_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("storeDocumentInDB Function End"),i.promise()},T=function(e){ZWOfflineLogger.log("deleteDocumentInDB Function Start");var i=new t,r=c.deleteContents(n,[e]);return r.then(function(e){ZWOfflineLogger.log("deleteDocumentInDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("deleteDocumentInDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.DOC_DELETE_FROM_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("deleteDocumentInDB Function End"),i.promise()},O=function(e){ZWOfflineLogger.log("getDocImagesFromDB Function Start");var i=new t,n=c.fetchContents(r,[e]);return n.then(function(e){ZWOfflineLogger.log("getDocImagesFromDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("getDocImagesFromDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.IMAGE_FETCH_FROM_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("getDocImagesFromDB Function End"),i.promise()},m=function(e){ZWOfflineLogger.log("storeImagesInDB Function Start");var i=new t,n=c.storeContents(r,[e]);return n.then(function(e){ZWOfflineLogger.log("storeImagesInDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("storeImagesInDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.IMAGE_STORE_TO_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("storeImagesInDB Function End"),i.promise()},I=function(e){ZWOfflineLogger.log("deleteDocImagesInDB Function Start");var i=new t,n=c.deleteContents(r,[e]);return n.then(function(e){ZWOfflineLogger.log("deleteDocImagesInDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("deleteDocImagesInDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.IMAGE_DELETE_FROM_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("deleteDocImagesInDB Function End"),i.promise()},D=function(){ZWOfflineLogger.log("getNewDocumentContentFromDB Function Start");var e=new t,i=c.fetchContents(s,[l.BLANK]);return i.then(function(t){ZWOfflineLogger.log("getNewDocumentContentFromDB Succeeded"),e.resolve(t.result[0].record.docObject)},function(t){ZWOfflineLogger.log("getNewDocumentContentFromDB Failed");var i={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.NEW_DOC_FETCH_FROM_DB_FAILED};e.reject(i)}),ZWOfflineLogger.log("getNewDocumentContentFromDB Function End"),e.promise()},R=function(e){ZWOfflineLogger.log("storeNewDocumentContentInDB Function Start");var i=new t,n={documentCategory:l.BLANK,docObject:e},r=c.storeContents(s,[n]);return r.then(function(e){ZWOfflineLogger.log("storeNewDocumentContentInDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("storeNewDocumentContentInDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.NEW_DOC_STORE_TO_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("storeNewDocumentContentInDB Function End"),i.promise()},S=function(e){ZWOfflineLogger.log("getOpsFromDB Function Start");var i=new t,n=c.fetchContents(o,[e]);return n.then(function(e){ZWOfflineLogger.log("getOpsFromDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("getOpsFromDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.OPS_FETCH_FROM_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("getOpsFromDB Function End"),i.promise()},C=function(e){ZWOfflineLogger.log("storeOpsInDB Function Start");var i=new t,n=c.storeContents(o,[e]);return n.then(function(e){ZWOfflineLogger.log("storeOpsInDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("storeOpsInDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.OPS_STORE_TO_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("storeOpsInDB Function End"),i.promise()},A=function(e){ZWOfflineLogger.log("deleteOpsInDB Function Start");var i=new t,n=c.deleteContents(o,[e]);return n.then(function(e){ZWOfflineLogger.log("deleteOpsInDB Succeeded"),i.resolve(e.result[0].record)},function(e){ZWOfflineLogger.log("deleteOpsInDB Failed");var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.OPS_DELETE_FROM_DB_FAILED};i.reject(t)}),ZWOfflineLogger.log("deleteOpsInDB Function End"),i.promise()},v=function(){ZWOfflineLogger.log("closeDatabase Start"),c.closeDatabase(),c=null,ZWOfflineLogger.log("closeDatabase End")},_=function(){ZWOfflineLogger.log("dropDatabase Function Start");var e=new t,i=function(t){ZWOfflineLogger.log("dropDatabase Succeeded"),c=null,e.resolve(t)},n=function(t){ZWOfflineLogger.log("dropDatabase Failed");var i={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.DB_DROP_FAILED};e.reject(i)},r=function(){c.closeDatabase();var e=c.dropDatabase();e.then(i,n)};return c?r():g().then(r,n),ZWOfflineLogger.log("dropDatabase Function End"),e.promise()},P=function(){return c.isDBOperationsPending()},N=function(){return c};return{doesOfflineDBExist:u,configureDB:g,getMetaFromDB:h,storeMetaInDB:f,getDocumentFromDB:p,storeDocumentInDB:E,deleteDocumentInDB:T,getDocImagesFromDB:O,storeImagesInDB:m,deleteDocImagesInDB:I,getNewDocumentContentFromDB:D,storeNewDocumentContentInDB:R,getOpsFromDB:S,storeOpsInDB:C,deleteOpsInDB:A,closeDatabase:v,dropDatabase:_,isDBOperationsPending:P,getDBInstance:N}}(ZWDBWrapper,Deferred),CrossInstanceCommunicator=function(){"use strict";var e,t=window.localStorage,i={"Url/Changed":!0,"Document/Locked":!0,"Document/Unlocked":!0,"MetaCollection/Updated":!0,"OfflineSetup/Revoked":!0,"OfflineSetup/Reset":!0,"OfflineSetup/InProgress":!0},n={"OfflineSetup/Completed":!0,"OfflineSetup/PreconfigCompleted":!0,"OfflineSetup/Revoked":!0},r=function(e){e in t&&t.removeItem(e)},o=function(){for(var e in n)r(e)},a=function(e,n){var a=e,s=n;try{s=JSON.stringify(s)}catch(e){ZWOfflineLogger.log("the value of the message is not JSON, sending it as it is: ",e)}finally{t.setItem(a,s)}setTimeout(function(){"OfflineSetup/Revoked"==e?o():e in i&&r(e)},50)},s=function(t){e=t,window.addEventListener("storage",function(t){if(null!=t.newValue){var i=t.newValue,n={};if(null!=i)try{n=JSON.parse(i)}catch(e){n={}}n.msgStr=t.key,e(n)}})};return{broadcast:a,listenTo:s,freeUpChannel:r}}(),ZWOfflineUIUtil=function(){"use strict";var e=function(){var e="<style>.ui-pres-notfound-contentdiv {margin:0 auto;width:680px;margin-top:100px;font-family:Lucida Grande,Segoe UI,Arial,sans-serif;}.ui-pres-notfound-errortxt {text-align:center;margin-top:5px;font-weight:bold;font-size:14px;padding: 10px;}.ui-state-error {border: 1px solid #cd0a0a;background: #FEF8F6;color: #cd0a0a;text-align: center;margin-top: 5px;font-weight: bold;font-size: 14px;padding: 10px;border-radius: 2px;}</style><div class='ui-pres-notfound-contentdiv'><div class='ui-state-error ui-pres-notfound-errortxt'>"+J.i18n("writer.common.OFFLINE_DOCUMENT_NOT_AVAILABLE")+"</div></div>";document.body.innerHTML=e},t=function(e,t,i,n,r){var o=new Deferred;return n||(n=CONST.SEVERITY_INFO),r||(r={}),i&&0!==i.length||(i=[J.i18n("writer.common.PROCEED"),J.i18n("writer.common.CANCEL")]),MsgDialog.showMessage(i,n,e,t,null,function(e){o.resolve(e)},null,r.isHTML,r.isPrimaryBtn,r.infoObj),o.promise()};return{showNotFoundContent:e,prompt:t}}(),ZWOfflineLogger=function(e){var t={},i=new e,n="",r=!1,o=function(){r=!1,i.enable()},a=function(){r=!0,i.disable()},s=function(e,t){1!=r&&(t&&(e=e+"; Details: "+JSON.stringify(t)),n+="Time: "+Date.now()+"; "+e+"\n")},l=function(){i.log(n)},d=function(e,i,r){if(void 0==t[e]&&(t[e]=0),!(void 0!=r&&t[e]>=r)){var o=new Deferred,a=function(e){o.reject(e)},s={},l={};try{if(l.additionalClientInfo=ZWOffline.getAdditionalInfoForLog(),l.shouldSendMail=!0,l.shouldWriteToFile=!0,ZWJSONUtils.mergeJsonObjs(l,i),l.filePrefix="OFFLINE",l.feature_name="offline",l.logInfo=n,"OFFLINE_NULL_OPS"==e||"OFFLINE_VERSION_MISMATCH"==e){ZWCollaboration="undefined"==typeof ZWCollaboration?void 0:ZWCollaboration;var d=ZWCollaboration&&ZWCollaboration.clientInfo||"";l.logInfo+="\n\n\nZWCollaboration.clientInfo = "+d}s.clientinfo=JSON.stringify(l),s.errorcode=e||"OFFLINE_ERROR",ZWNetworkUtils.sendAjax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix("util/clienterrorlog"),data:s,setCsrfParam:!0,dataType:"json",error:function(e){var t={STATUS:OPERATION_STATUS.ERROR,exception:e};a(t)},success:function(i){t[e]++,o.resolve(i)}})}catch(e){var c={STATUS:OPERATION_STATUS.ERROR,exception:e,reason:"Error getting offline details"};a(c)}return o.promise()}},c=function(e,t,i){var r=new Deferred,o=function(e){r.reject(e)},a={},s={};try{s.additionalClientInfo=ZWOffline.getAdditionalInfoForLog(),s.shouldSendMail=!0,s.shouldWriteToFile=!0,s.service="USER_REPORT",ZWJSONUtils.mergeJsonObjs(s,i),s.filePrefix="OFFLINE",s.feature_name="offline";var l=n+"\n Exception Data: "+JSON.stringify(t);s.logInfo=l,a.clientinfo=JSON.stringify(s),a.errorcode=e||"OFFLINE_ERROR",ZWNetworkUtils.sendAjax({type:"POST",global:!1,url:ZWNetworkUtils.getNiceUrlPrefix("util/clienterrorlog"),data:a,setCsrfParam:!0,dataType:"json",error:function(e){var t={STATUS:OPERATION_STATUS.ERROR,exception:e};o(t)},success:function(e){r.resolve(e)}})}catch(e){var d={STATUS:OPERATION_STATUS.ERROR,exception:e,reason:"Error getting offline details"};o(d)}return r.promise()};return o(),{enable:o,disable:a,log:s,printLog:l,sendLog:d,sendExceptionData:c}}(ZWConsole),OnLoadInitializer=function(e){"use strict";function t(){this.processes={}}t.prototype.waitFor=function(e){var t=e.length;if(0===t)i.call(this);else{for(var n=0;n<t;n++)this.processes[e[n]]=!1;this.trigger("PreProcessEditorResources")}},t.prototype.getBlockingProcesses=function(){var e,t=[];for(e in this.processes)this.processes[e]===!1&&t.push(e);return t},t.prototype.updateCompletedProcess=function(e){this.processes[e]=!0,i.call(this)};var i=function(){var e=this.getBlockingProcesses();if(0===e.length){if(!isV8Engine){var t=new CustomEvent("OnloadResourcesReady");document.dispatchEvent(t)}this.trigger("OnloadResourcesReady")}};return e.call(t.prototype),new t}(BaseEventHandler),OFFLINE_DOC_STATES={PENDING:0,SYNCED:1,FAILED:2},OFFLINE_SETUP_STATE={NEW:"NEW",PENDING:"PENDING",PROGRESS:"PROGRESS",COMPLETED:"COMPLETED"},OPERATION_STATUS={SUCCESS:"SUCCESS",ERROR:"ERROR",FAILED:"FAILURE"},OFFLINE_ERROR_CODES={ALREADY_OFFLINE_SETUP_BY_SAME_USER:"COE_100",ALREADY_OFFLINE_SETUP_BY_OTHER_USER:"COE_101",PREVIOUS_OFFLINE_SETUP_INCOMPLETE:"COE_102",USER_STOPPED_OFFLINE_SETUP:"COE_103",OPS_PRESENT_DURING_REMOVE_SETUP:"COE_104",METAUPDATED_FOR_UNAVAILABLE_RID:"COE_105",CLIENT_COMPOSE_EXCEPTION:"COE_106",OPS_NOT_AVAILABLE_TO_PERFORM_OT:"COE_107",SYNC_OT_PREVENTED_DUE_TO_DOCUMENT_REVERTED_CASE:"COE_108",SYNC_OT_PREVENTED_DUE_TO_TRASH_PERMISSION_REVOKED_CASE:"COE_109",DOCUMENT_NOT_OPTED_FOR_OFFLINE_BEING_OPENED:"COE_110",DOCUMENT_WITH_UNSUPPORTED_ROLE_BEING_OPENED:"COE_111",DOCUMENT_CHOSEN_FOR_OFFLINE_YET_TO_BE_CACHED_BEING_OPENED_OFFLINE:"COE_112",DOCUMENT_LOCKED_BY_ANOTHER_INSTANCE:"COE_113",UNSUPPORTED_URL_BEING_OPENED:"COE_114",OPS_PRESENT_FOR_DOCUMENT_CHOSEN_TO_REMOVE:"COE_115",PROCESSING_SERVER_RESPONSE_CAUSES_ERROR:"COE_116",UNSUPPORTED_URL_BEING_OPENED_OFFLINE:"COE_117",JS_SCRIPT_ERROR_DURING_OFFLINE_SETUP:"COE_118",DOCUMENT_ALREADY_SYNCING:"COE_119",META_FETCH_FROM_DB_FAILED:"COE_200",META_STORE_TO_DB_FAILED:"COE_201",DOC_FETCH_FROM_DB_FAILED:"COE_202",DOC_STORE_TO_DB_FAILED:"COE_203",DOC_DELETE_FROM_DB_FAILED:"COE_204",IMAGE_FETCH_FROM_DB_FAILED:"COE_205",IMAGE_STORE_TO_DB_FAILED:"COE_206",IMAGE_DELETE_FROM_DB_FAILED:"COE_207",NEW_DOC_FETCH_FROM_DB_FAILED:"COE_208",NEW_DOC_STORE_TO_DB_FAILED:"COE_209",OPS_FETCH_FROM_DB_FAILED:"COE_210",OPS_STORE_TO_DB_FAILED:"COE_211",OPS_DELETE_FROM_DB_FAILED:"COE_212",DB_DROP_FAILED:"COE_213",CONFIGURE_DB_FAILED:"COE_214",FETCH_VERSIONOPS_FROM_SERVER_FAILED:"COE_300",FETCH_VERSIONLIST_FROM_SERVER_FAILED:"COE_301",SAVE_ARRAYOFOPS_TO_SERVER_FAILED:"COE_302",REGISTER_SESSION_FAILED:"COE_303",META_FETCH_FROM_SERVER_FAILED:"COE_304",FETCH_DOCCONTENT_FROM_SERVER_FAILED:"COE_305",FETCH_IMAGEBYTES_FROM_SERVER_FAILED:"COE_306",SAVE_IMAGEBYTES_TO_SERVER_FAILED:"COE_307",SAVE_DOCCONTENT_TO_SERVER_FAILED:"COE_308",FETCH_NEW_DOCCONTENT_FROM_SERVER_FAILED:"COE_309",FETCH_PERMISSIONS_FROM_SERVER_FAILED:"COE_310",DOCUMENT_MIGRATED_IN_SERVER:"COE_311",DOCUMENT_MIGRATED_OR_OWNER_CHANGED_IN_SERVER:"COE_312"},OFFLINE_INFO_CODES={},OFFLINE_ERROR_MSG_KEYS={COE_106:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_107:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_108:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_109:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_116:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_200:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_201:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_202:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_203:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_211:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_212:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_300:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_301:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_302:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_305:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_308:"writer.offline.DASHBOARD_SYNC_CHANGES_ERROR_MSG",COE_204:"writer.offline.DELETE_DOC_ERROR_MSG",COE_205:"writer.offline.UPDATE_IMAGE_ERROR_MSG",COE_206:"writer.offline.UPDATE_IMAGE_ERROR_MSG",COE_207:"writer.offline.UPDATE_IMAGE_ERROR_MSG",COE_306:"writer.offline.UPDATE_IMAGE_ERROR_MSG",COE_307:"writer.offline.UPDATE_IMAGE_ERROR_MSG",COE_208:"writer.offline.DASHBOARD_SYNC_DOC_ERROR_MSG",COE_209:"writer.offline.DASHBOARD_SYNC_DOC_ERROR_MSG",COE_210:"writer.offline.DASHBOARD_SYNC_DOC_ERROR_MSG",COE_311:"writer.offline.DOCUMENT_MIGRATED_ERROR_MSG",COE_312:"writer.offline.DOCUMENT_MIGRATED_OR_OWNER_CHANGED_ERROR_MSG"},OFFLINE_ERROR_TITLE_KEYS={COE_106:"writer.common.UNSAVED_CHANGES_FOUND",COE_107:"writer.common.UNSAVED_CHANGES_FOUND",COE_108:"writer.common.UNSAVED_CHANGES_FOUND",COE_109:"writer.common.UNSAVED_CHANGES_FOUND",COE_116:"writer.common.UNSAVED_CHANGES_FOUND",COE_200:"writer.common.UNSAVED_CHANGES_FOUND",COE_201:"writer.common.UNSAVED_CHANGES_FOUND",COE_202:"writer.common.UNSAVED_CHANGES_FOUND",COE_203:"writer.common.UNSAVED_CHANGES_FOUND",COE_211:"writer.common.UNSAVED_CHANGES_FOUND",COE_212:"writer.common.UNSAVED_CHANGES_FOUND",COE_300:"writer.common.UNSAVED_CHANGES_FOUND",COE_301:"writer.common.UNSAVED_CHANGES_FOUND",COE_302:"writer.common.UNSAVED_CHANGES_FOUND",COE_305:"writer.common.UNSAVED_CHANGES_FOUND",COE_308:"writer.common.UNSAVED_CHANGES_FOUND",COE_204:"writer.offline.DELETE_DOC_ERROR_TITLE",COE_205:"writer.offline.UPDATE_IMAGE_ERROR_TITLE",COE_206:"writer.offline.UPDATE_IMAGE_ERROR_TITLE",COE_207:"writer.offline.UPDATE_IMAGE_ERROR_TITLE",COE_306:"writer.offline.UPDATE_IMAGE_ERROR_TITLE",COE_307:"writer.offline.UPDATE_IMAGE_ERROR_TITLE",COE_208:"writer.common.SORRY",COE_209:"writer.common.SORRY",COE_210:"writer.common.SORRY",COE_311:"writer.offline.DOCUMENT_MIGRATED_ERROR_TITLE",COE_312:"writer.offline.DOCUMENT_MIGRATED_OR_OWNER_CHANGED_ERROR_TITLE"},ZWOfflineServerUtil=function(e,t){"use strict";var i=function(e,t){var i=O(e);i.originalResponse=t,i.status===OPERATION_STATUS.SUCCESS?this.resolve(i):(i.reason=e,this.reject(i))},n=function(){ZWOfflineLogger.log("fetchCacheURLs Function Start");var t=new e;return ZWNetworkUtils.sendAjax({type:"GET",dataType:"json",url:ZWNetworkUtils.getContextUrl("offline/getcacheurls"),timeout:3e4,success:function(e){var n=e?e.RESPONSE:"";i.call(t,n,e)},error:function(e){var n=T(e);i.call(t,n,e)}}),t.always(function(e){ZWOfflineLogger.log("fetchCacheURLs"+e.status)}),ZWOfflineLogger.log("fetchCacheURLs Function End"),t.promise()},r=function(t,n){ZWOfflineLogger.log("fetchSpecificVersionOps Function Start");var r=new e,o={};return n.versionList?o.versionlist=n.versionList.join(","):o.versionidlist=n.versionIdList.join(","),ZWNetworkUtils.sendAjax({type:"POST",dataType:"json",url:ZWNetworkUtils.getContextUrl("offline/"+t+"/getversionops"),data:o,setCsrfParam:!0,success:function(e){var t=e?e.RESPONSE:"";i.call(r,t,e)},error:function(e){var t=T(e);i.call(r,t,e)}}),r.always(function(e){ZWOfflineLogger.log("fetchSpecificVersionOps"+e.status)}),ZWOfflineLogger.log("fetchSpecificVersionOps Function End"),r.promise()},o=function(t,n){ZWOfflineLogger.log("fetchSavedAndRevertedVersions Function Start");var r=new e;return ZWNetworkUtils.sendAjax({type:"GET",dataType:"json",data:n,url:ZWNetworkUtils.getContextUrl("offline/"+t+"/versioninfo"),timeout:3e4,success:function(e){var t=e?e.RESPONSE:"";i.call(r,t,e)},error:function(e){var t=T(e);i.call(r,t,e)}}),r.always(function(e){ZWOfflineLogger.log("fetchSavedAndRevertedVersions"+e.status)}),ZWOfflineLogger.log("fetchSavedAndRevertedVersions Function End"),r.promise()},a=function(t,n){ZWOfflineLogger.log("saveOps Function Start");var r=new e;n.op=ZWOfflineUtil.getBinaryObj(n.op);var o=ZWOfflineUtil.packageForNetwork(n,{exclude:{sid:!0,rid:!0}});return ZWNetworkUtils.sendAjax({type:"POST",global:!1,dataType:"json",url:ZWNetworkUtils.getContextUrl("offline/"+t+"/sync"),data:o,isMultiPartReq:!0,enctype:"multipart/form-data;",processData:!1,contentType:!1,success:function(e){var t=e?e.UPDATE:"";i.call(r,t,e)},error:function(e){var t=T(e);i.call(r,t,e)}}),r.always(function(e){ZWOfflineLogger.log("saveOps"+e.status)}),ZWOfflineLogger.log("saveOps Function End"),r.promise()},s=function(t,n){ZWOfflineLogger.log("fetchSessionId Function Start");var r={sid:n},o=new e;return ZWNetworkUtils.sendAjax({type:"POST",dataType:"json",url:ZWNetworkUtils.getContextUrl("offline/"+t+"/createsessionid"),data:r,setCsrfParam:!0,success:function(e){var t=e?e.RESPONSE:"";i.call(o,t,e)},error:function(e){var t=T(e);i.call(o,t,e)}}),o.always(function(e){ZWOfflineLogger.log("fetchSessionId"+e.status)}),ZWOfflineLogger.log("fetchSessionId Function End"),o.promise()},l=function(t){ZWOfflineLogger.log("fetchDocMetaList Function Start");var n={modifiedtime:t||0},r=new e;return ZWNetworkUtils.sendAjax({type:"POST",dataType:"json",url:ZWNetworkUtils.getContextUrl("offline/documents"),data:n,timeout:25e3,setCsrfParam:!0,success:function(e){var t=e?e.RESPONSE:"";i.call(r,t,e)},error:function(e){var t=T(e);i.call(r,t,e)}}),r.always(function(e){ZWOfflineLogger.log("fetchDocMetaList"+e.status)}),ZWOfflineLogger.log("fetchDocMetaList Function End"),r.promise()},d=function(t){ZWOfflineLogger.log("fetchDocument Function Start for rid: "+t);var n=new e;return ZWNetworkUtils.sendAjax({type:"GET",dataType:"json",url:ZWNetworkUtils.getContextUrl("offline/"+t+"/fetchdoccontent"),data:{},timeout:3e4,success:function(e){var t=e?e.RESPONSE:"";i.call(n,t,e)},error:function(e){var t=T(e);i.call(n,t,e)}}),n.always(function(e){ZWOfflineLogger.log("fetchDocument for RID: "+t+"; Status: "+e.status)}),ZWOfflineLogger.log("fetchDocument Function End"),n.promise()},c=function(t,i){ZWOfflineLogger.log("fetchImageBytes Function Start");var n={rid:t,imageURL:i,imageBytes:null},r=new e;return ZWNetworkUtils.sendAjax({type:"GET",datatype:"json",url:ZWNetworkUtils.getContextUrl("offline/"+t+"/images/"+i),timeout:3e4,success:function(e){var t=e?e.RESPONSE:"",i=O(t);if(i.originalResponse=e,i.status===OPERATION_STATUS.SUCCESS){var o=ZWOfflineUtil.convertImageBytesToBinary(e.bytes);n.imageBytes="data:image/"+e.extn+";base64,"+ZWOfflineUtil.convertBinToB64(o),i.result=n,r.resolve(i)}else i.reason=t,i.result=n,r.reject(i)},error:function(e){var t=T(e),i=O(t);i.originalResponse=e,i.reason=t,i.result=n,r.reject(i)}}),r.always(function(e){ZWOfflineLogger.log("fetchImageBytes"+e.status)}),ZWOfflineLogger.log("fetchImageBytes Function End"),r.promise()},u=function(t){ZWOfflineLogger.log("saveImage Function Start");var n=({rid:t.rid,imageId:t.imageId},new e),r=ZWOfflineUtil.convertdataURItoBlob(t.imageBase64),o=ZWOfflineUtil.packageForNetwork({imagecontent:r.imageFile,sid:t.sid,rid:t.rid,imgid:t.imageId,imageURLValue:t.imageURLValue}),a=ZWNetworkUtils.getUrl("copyImageFile",t.rid);return ZWNetworkUtils.sendAjax({type:"POST",dataType:"json",url:a,data:o,isMultiPartReq:!0,enctype:"multipart/form-data; "+r.type,contentType:!1,processData:!1,success:function(e){var t=e?e.validation.toUpperCase():"";i.call(n,t,e)},error:function(e){var t=T(e);i.call(n,t,e)}}),n.always(function(e){ZWOfflineLogger.log("saveImage"+e.status)}),ZWOfflineLogger.log("saveImage Function End"),n.promise()},g=function(t,n){ZWOfflineLogger.log("saveDocument Function Start");var r=new e;delete t.docContent.default;var o=ZWOfflineUtil.getBinaryObj(t),a=ZWOfflineUtil.packageForNetwork({docObject:o,documentName:n});return ZWNetworkUtils.sendAjax({type:"POST",url:ZWNetworkUtils.getContextUrl("offline/savenewdocument"),data:a,isMultiPartReq:!0,enctype:"multipart/form-data;",contentType:!1,processData:!1,success:function(e){var t=e?e.RESPONSE:"";i.call(r,t,e)},error:function(e){var t=T(e);i.call(r,t,e)}}),r.always(function(e){ZWOfflineLogger.log("saveDocument"+e.status)}),ZWOfflineLogger.log("saveDocument Function End"),r.promise()},h=function(){ZWOfflineLogger.log("fetchNewDocumentContent Function Start");var t=new e,n={};return ZWNetworkUtils.sendAjax({type:"GET",dataType:"json",data:n,url:ZWNetworkUtils.getContextUrl("offline/getnewdocument"),timeout:3e4,setCsrfParam:!0,success:function(e){var n=e?e.RESPONSE:"";i.call(t,n,e)},error:function(e){var n=T(e);i.call(t,n,e)}}),t.always(function(e){ZWOfflineLogger.log("fetchNewDocumentContent"+e.status)}),ZWOfflineLogger.log("fetchNewDocumentContent Function End"),t.promise()},f=function(){ZWOfflineLogger.log("fetchOfflinePermissions Function Start");var t=new e;return ZWNetworkUtils.sendAjax({type:"GET",dataType:"json",url:ZWNetworkUtils.getContextUrl("offline/permissions"),timeout:3e4,success:function(e){var n=e?e.RESPONSE:"";i.call(t,n,e)},error:function(e){var n=T(e);i.call(t,n,e)}}),t.always(function(e){ZWOfflineLogger.log("fetchOfflinePermissions"+e.status)}),ZWOfflineLogger.log("fetchOfflinePermissions Function End"),t.promise()},p=function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r={},o=e[i];r.RID=o.document_id,r.ROLE=o.role,r.version=o.version,r.revision=o.revision,r.versionId=o.version_id,r.status=o.status,r.DOCUMENT_NAME=o.document_name,r.isFavourite=o.is_favourite,r.isTrackChangeOn=o.is_trackchange_on,r.LAST_MODIFIED_TIME_LONG=o.modified_time_ms,r.finalInfo=!!o.final_info&&o.final_info.status,r.isCheckedOut=!!o.lock_info&&o.lock_info.status,t.push(r)}return t},E=function(t){ZWOfflineLogger.log("fetchDocumentDetails Function Start");var n={resource_ids:JSON.stringify(t)},r=new e;return ZWNetworkUtils.sendAjax({type:"GET",dataType:"json",url:ZWNetworkUtils.getContextUrl("api/v1/documents/offline"),data:n,timeout:3e4,success:function(e){var t=e?e.RESPONSE:"",n=p(e.documents);e.documents=n,i.call(r,t,e)},error:function(e){var t=T(e);i.call(r,t,e)}}),r.always(function(e){ZWOfflineLogger.log(""+e.status)}),ZWOfflineLogger.log("fetchDocumentDetails Function End"),r.promise()},T=function(e){var t=e.responseText||"",i=e.status,n="";if(200==i&&e.getResponseHeader("Content-Type").toLowerCase().indexOf("text/html")>=0)n="LOGGED_OUT";else if(500==i||410==i||404==i)if(t.indexOf("AUTHENTICATION_FAILED")!=-1)n="CHANGEPERMISSION";else if(t.indexOf("TRASHED_DOC")!=-1||t.indexOf("RESOURCE_TRASHED")!=-1)n="RESOURCE_TRASHED";else if(t.indexOf("ZFS_EXCEPTION")!=-1){var r=JSON.parse(t),o=r.ERROR_CODE;n="F918"===o?"CHECKEDOUT":"ZFS_EXCEPTION"}else n=t.indexOf("REDIS_EXCEPTION")!=-1?"REDIS_EXCEPTION":t.indexOf("BROWSER_COOKIES_DISABLED")!=-1?"BROWSER_COOKIES_DISABLED":e.getResponseHeader("Content-Type").toLowerCase().indexOf("text/html")>=0&&t.indexOf("deleted")!=-1?"RESOURCE_TRASHED":"ZFS_EXCEPTION";else if(409===i)n="CSRFTOKEN_MISSING";else if(502===i)n="BAD_GATEWAY";else if("timeout"===e.statusText)n="TIMEOUT";else if(401==i)t.indexOf("LOGGED_OUT")!=-1&&(n="LOGGED_OUT");else if(400==i&&0==t.indexOf("<?xml")){var a=new DOMParser,s=a.parseFromString(t,"text/xml"),l=s.getElementsByTagName("code")[0].innerHTML;"1401"==l&&(n="LOGGED_OUT")}return n},O=function(e){var t={};switch(e){case"SUCCESS":t.status=OPERATION_STATUS.SUCCESS;break;case"CHANGEPERMISSION":case"REVERTED_REVISION":case"OPUPDATEFAILED_INLOCKSTATE":case"SAVE_FAILURE":case"REDIS_VERSION_MISMATCH":case"REMOTE_TRASH":case"RESOURCE_TRASHED":case"READ_ONLY_USER":case"PERMISSIONDENIED_FOR_LOCK":case"PERMISSIONDENIED_FOR_UNLOCK":case"VIEWING":case"NOT_AUTHORIZED_USER":case"REVERT_STATE":case"MARKAS_FINAL":case"NEW_VERSION_UPLOAD_STATE":case"CHECKEDOUT":case"RESOURCE_EMPTY":case"SAVEDCONTENT_REPAIRED":case"FAILED":case"ZFS_EXCEPTION":case"REDIS_EXCEPTION":t.status=OPERATION_STATUS.FAILED;break;case"SAMEVERSIONREVISION":case"OPS_NOT_PRESENT":case"CLIENT_VERSIONDIFF_EXCEEDS":case"NORESEND":case"RELOAD":case"RESEND":case"BROWSER_COOKIES_DISABLED":case"CSRFTOKEN_MISSING":case"TIMEOUT":case"BAD_GATEWAY":case"NETWORK_ISSUE":case"LOGGED_OUT":default:t.status=OPERATION_STATUS.ERROR}return t};return{fetchCacheURLs:n,fetchDocMetaList:l,fetchDocument:d,fetchImageBytes:c,fetchNewDocumentContent:h,fetchSessionId:s,fetchSpecificVersionOps:r,fetchSavedAndRevertedVersions:o,saveOps:a,saveDocument:g,saveImage:u,fetchPermissionsInfo:f,fetchDocumentDetails:E}}(Deferred,Utils),ZWOfflineSyncProtocol=function(){function e(e,t,i,n,r,o){ZWOfflineLogger.log("Sync Protocol Instance Created"),this.rid=e,this.sid=t,this.updateVersionRevision(i,n,r),this.topVersion=this.fullversion,this.topVersionId=this.versionId,this.collabProtocol=o}var t=function(e,t){if(this.versionId){var i=!1;if(e.length>0&&t&&t.length>0)for(var n=0;n<e.length;n++)if(t.indexOf(e[n])!=-1){i=!0;break}return i}for(var r=this.fullversion,n=0,o=e.length;n<o;n++)if(e[n]>=r)return!0;return!1},i=function(e){return"SHAREDREADCOMMENT"!==e.currentRole&&"SHAREDREAD"!==e.currentRole&&e.isFinal!==!0&&e.isTrashed!==!0&&e.CHECKEDOUT!==!0&&e.isMigrated!==!0&&e.isChangeOwner!==!0},n=function(){var e={};if(this.versionId){var t=[];t=this.versionIdList.splice(0,5),e.versionIdList=t}else{var i,n,r=[];for(this.fullversion===this.topVersion?i=!0:(i=!1,n=this.version+.99,n=parseFloat(n.toFixed(2)),99==this.revision&&(n+=1,n=parseFloat(n.toFixed(2))));!i;)n>this.topVersion&&(n=this.topVersion,i=!0),r.push(n),5===r.length&&(i=!0),n+=1,n=parseFloat(n.toFixed(2));e.versionList=r}return e},r=function(e,t){ZWOfflineLogger.log("Sync Protocol - ComposeOps Function Start");var i=[];if(this.versionId){for(var n,r,o,a,s,l,d,c,u,g=new DocOpBuilder,h=this.version,f=this.revision+1,p=0,E=t.length;p<E;p++){if(f>99&&(f=1,h+=1),a=t[p],n=e[a],targetVersion=n.version,targetRevision=n.revision,h!=targetVersion||!n[f]){if(f>targetRevision&&h>=targetVersion)continue;return[]}for(;f<=targetRevision;)r=n[f],r.sid==this.sid&&0!==g.length()&&(i.push({ops:g,versionInfo:{VERSION:c,REVISION:u,VERSION_ID:opVersionId},sid:s,zuid:l,mc:d}),g=new DocOpBuilder),o=DocOpBuilder.build(r.op),s=r.sid,l=r.zuid,d=r.mc,c=h,u=f,opVersionId=a,g=DocOpBuilder.compose(g,o),f++}0!==g.length()&&i.push({ops:g,versionInfo:{VERSION:c,REVISION:u,VERSION_ID:opVersionId},sid:s,zuid:l,mc:d})}else{var T,O,n,r,o,c,u,s,l,d,g=new DocOpBuilder;n=e[this.version];for(O in n){if(!(parseInt(O)<=this.revision))break;delete n[O]}for(T in e){n=e[T],delete n.locks,delete n.redactops;for(O in n)r=n[O],r.sid==this.sid&&0!==g.length()&&(i.push({ops:g,versionInfo:{VERSION:c,REVISION:u},sid:s,zuid:l,mc:d}),g=new DocOpBuilder),o=DocOpBuilder.build(r.op),c=parseInt(T),u=parseInt(O),s=r.sid,l=r.zuid,d=r.mc,g=DocOpBuilder.compose(g,o)}0!==g.length()&&i.push({ops:g,versionInfo:{VERSION:c,REVISION:u},sid:s,zuid:l,mc:d})}return ZWOfflineLogger.log("Sync Protocol - ComposeOps Function end"),i};return e.prototype.updateVersionRevision=function(e,t,i){if(ZWOfflineLogger.log("Sync Protocol - version/revision updated"),this.version=parseInt(e),this.revision=t,this.versionId=i,ZWOfflineLogger.log("Updated Version: "+e+", Revision: "+t+", VersionId: "+i),this.versionId)this.fullversion=null;else{var n=this.revision>9?".":".0";this.fullversion=parseFloat(this.version+n+this.revision)}},e.prototype.sync=function(){ZWOfflineLogger.log("Sync Protocol - Sync Function Start");var e=new Deferred,n=this,r={};this.versionId?r.sourceVersionId=this.versionId:r.sourceVersion=this.fullversion;var o=ZWOfflineServerUtil.fetchSavedAndRevertedVersions(this.rid,r);return o.then(function(r){var o=r.originalResponse;if(ZWOfflineLogger.log("Sync Protocol - Fetch version list completed"),i(o))if(t.call(n,o.excludedList,o.versionIdList))ZWOfflineLogger.log("Sync Protocol - document reverted"),e.reject({status:OPERATION_STATUS.FAILED,errorCode:OFFLINE_ERROR_CODES.SYNC_OT_PREVENTED_DUE_TO_DOCUMENT_REVERTED_CASE,reason:"DOCUMENT_REVERTED"});else{if(ZWOfflineLogger.log("Sync Protocol - version list fetch succeeded"),n.versionId){var a=o.versionIdList.length;a>0?(n.topVersionId=o.versionIdList[a-1],n.versionIdList=o.versionIdList):n.versionIdList=[]}else{var a=o.versionList.length;if(a>0){var s=o.versionList[a-1];n.topVersion=parseFloat(s.toFixed(2))}}n.def=new Deferred;var l=n.def.promise();l.then(function(){ZWOfflineLogger.log("Sync Protocol - OT Completed"),e.resolve({status:OPERATION_STATUS.SUCCESS})},function(t){t.errorCode!==OFFLINE_ERROR_CODES.DOCUMENT_MIGRATED_IN_SERVER&&t.errorCode!==OFFLINE_ERROR_CODES.DOCUMENT_MIGRATED_OR_OWNER_CHANGED_IN_SERVER&&ZWOfflineLogger.log("Sync Protocol - OT Failed"),e.reject(t)}),ZWOfflineLogger.log("Sync Protocol - OT Started"),n.performSync()}else{var d,c;o.isMigrated===!0?(d=OFFLINE_ERROR_CODES.DOCUMENT_MIGRATED_IN_SERVER,c="DOCUMENT_MIGRATED_IN_SERVER"):o.isChangeOwner===!0?(d=OFFLINE_ERROR_CODES.DOCUMENT_MIGRATED_OR_OWNER_CHANGED_IN_SERVER,c="DOCUMENT_MIGRATED_OR_OWNER_CHANGED_IN_SERVER"):(d=OFFLINE_ERROR_CODES.SYNC_OT_PREVENTED_DUE_TO_TRASH_PERMISSION_REVOKED_CASE,c="PERMISSION_REVOKED/DOCUMENT_TRASHED"),ZWOfflineLogger.log("Sync Protocol - version list fetch permission revoked"),e.reject({status:OPERATION_STATUS.FAILED,errorCode:d,reason:c})}},function(t){var i={status:t.status,errorCode:OFFLINE_ERROR_CODES.FETCH_VERSIONLIST_FROM_SERVER_FAILED,reason:t.reason};e.reject(i)}),ZWOfflineLogger.log("Sync Protocol - Sync Function end"),e.promise()},e.prototype.performSync=function(){if(!this.versionId&&this.fullversion===this.topVersion||this.versionId&&this.versionId===this.topVersionId)this.def.resolve();else{var e=this,t=n.call(this);(!t||!t.versionIdList||t.versionIdList.length<=0)&&(ZWOfflineLogger.log("Current Version Id : "+this.versionId+", Current TopVersion Id: "+this.topVersionId),ZWOfflineLogger.sendLog("OFFLINE_EMPTY_VERSION_ID_REQUEST",{},1));var i=ZWOfflineServerUtil.fetchSpecificVersionOps(this.rid,t);i.then(function(i){try{var n=i.originalResponse,o=n.version_ops;if(n.isMigrated===!0)return void e.def.reject({status:OPERATION_STATUS.FAILED,errorCode:OFFLINE_ERROR_CODES.DOCUMENT_MIGRATED_IN_SERVER,reason:"DOCUMENT_MIGRATED_IN_SERVER"});if(n.isChangeOwner===!0)return void e.def.reject({status:OPERATION_STATUS.FAILED,errorCode:OFFLINE_ERROR_CODES.DOCUMENT_MIGRATED_OR_OWNER_CHANGED_IN_SERVER,reason:"DOCUMENT_MIGRATED_OR_OWNER_CHANGED_IN_SERVER"});if(o.hasOwnProperty("FAILURE"))return void e.def.reject({status:OPERATION_STATUS.FAILED,errorCode:OFFLINE_ERROR_CODES.OPS_NOT_AVAILABLE_TO_PERFORM_OT,reason:"OPS_NOT_AVAILABLE"});var a,s;if(e.versionId)if(a=r.call(e,o,t.versionIdList),ZWOfflineLogger.log("Composed Ops Length - "+a.length),a.length>0)e.applyServerOps(a),s=a[a.length-1].versionInfo;else{var l=t.versionIdList.length-1,d=t.versionIdList[l],c=o[d];e.revision===c.revision&&e.version===c.version&&(s={VERSION:c.version,REVISION:c.revision,VERSION_ID:d},e.collabProtocol.updateVersion(s.VERSION,s.REVISION,"",s.VERSION_ID))}else a=r.call(e,o),e.applyServerOps(a),s=a[a.length-1].versionInfo;ZWOfflineLogger.log("Stringified VersionInfo - "+JSON.stringify(s)),s&&e.updateVersionRevision(s.VERSION,s.REVISION,s.VERSION_ID),e.performSync()}catch(t){ZWOfflineLogger.log("Sync Protocol - Exception occured in performSync Function",t),e.def.reject({status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.CLIENT_COMPOSE_EXCEPTION,reason:"CLIENT_COMPOSE_EXCEPTION"})}},function(t){var i={status:t.status,errorCode:OFFLINE_ERROR_CODES.FETCH_VERSIONOPS_FROM_SERVER_FAILED,reason:t.reason};e.def.reject(i)})}},e.prototype.applyServerOps=function(e){ZWOfflineLogger.log("Sync Protocol - apply serverOps invoked");for(var t,i,n,r,o=0,a=e.length;o<a;o++)t=e[o],i=t.ops,ZWOfflineLogger.log("Sync Protocol - Client session ID = "+this.sid),ZWOfflineLogger.log("Sync Protocol - serverOp session ID = "+t.sid),n=t.sid,r=t.versionInfo,ZWOfflineLogger.log("Sync Protocol - versionInfo = "+JSON.stringify(r)),ZWOfflineLogger.log("Sync Protocol - serverop sid in localvariable ="+n),n===this.sid?(ZWOfflineLogger.log("Sync Protocol - updateVersion Invoked for user op"),this.collabProtocol.updateVersion(r.VERSION,r.REVISION,"",r.VERSION_ID),ZWOfflineLogger.log("Sync Protocol - ack received for user op"),this.collabProtocol.msgQueue.ackReceived(),ZWOfflineLogger.log("Sync Protocol - queue shift Invoked for user op"),this.collabProtocol.msgQueue.shift()):(ZWOfflineLogger.log("Sync Protocol - applyCollaboratorMutation invoked"),this.collabProtocol.applyCollaboratorsMutation(i,r),ZWOfflineLogger.log("Sync Protocol - updateVersion Invoked for collabuser op"),this.collabProtocol.updateVersion(r.VERSION,r.REVISION,"",r.VERSION_ID))},e}(),OfflineMigration=function(){var e=function(e){var t=e.defaults;if(t.styleUIInfo)return e;var i=t.styles,n=i.para,r={shape:{},para:{},char:{},table:{}};for(var o in n){var a=parseInt(o.substr(1));r.para.hasOwnProperty(o)||(r.para[o]={},r.para[o].status="visible",a>2&&a<=9&&(r.para[o].status="semihidden",r.para[o].showWhenUsed="h"+(a-1))),n[o].hasOwnProperty("info")||(n[o].info={},n[o].info.next="h0",0!=a&&(n[o].info.basedOn="h0"))}return e.defaults.styleUIInfo=r,e};return{migrateDocument:e}}(),ZWOfflineMetaCollection=function(e,t,i,n,r){"use strict";function o(){this.populateMetaCollection()}var a=!0,s=function(){var e={keyId:"metadata",docMeta:this.docMeta,userData:this.userDetails,generalInfo:this.generalInfo,editorProps:this.editorProperty},i=t.storeMetaInDB(e);return i.done(l),i},l=function(){ZWOfflineCommsWrapper.broadcastMetaCollectionUpdated()},d=function(){this.trigger.apply(this,arguments)},c=function(e,t){var i=!0;return e===t||"SHAREDREADWRITE"===t&&"COOWNER"===t&&"OWNER"===t||(i=!1),i},u=function(e,t,i){for(var n=[],r=[],o=[],a=0,s=e.length;a<s;a++){var l=e[a],d=l.RID;c(this.getRole(d),l.ROLE)?r.push(l):l.ROLE?n.push(l):o.push(l)}var u={toBeRemovedList:n,toBeProcessedList:r,offlineCreatedDocList:t,quarantineList:o,activeDocList:i};return u};o.prototype.populateMetaCollection=function(e,t,i,n){this.docMeta=e||{},this.userDetails=t||{},this.generalInfo=i||{},this.editorProperty=n||{}};var g=function(e){var t;for(t in e){var i=e[t];"email"==t&&(i=n.stringToHex(i||"")),this.userDetails[t]=i}};o.prototype.updateUserDetails=function(e){g.call(this,e);var t=s.call(this);return t.then(d.bind(this,"UserDetails/Updated",e),d.bind(this,"UserDetailsUpdate/Failed",e)),t},o.prototype.updateGeneralInfo=function(e){var t;for(t in e)this.generalInfo[t]=e[t];var i=s.call(this);return i.then(d.bind(this,"GeneralInfo/Updated",e),d.bind(this,"GeneralInfoUpdate/Failed",e)),i};var h=function(e){var t;for(t in e)this.editorProperty[t]=e[t]};o.prototype.updateEditorProperty=function(e){h.call(this,e);var t=s.call(this);return t.then(d.bind(this,"EditorProperty/Updated",e),d.bind(this,"EditorPropertyUpdate/Failed",e)),t},o.prototype.getUserDetails=function(){var e=ZWJSONUtils.clone(this.userDetails);return e.email=n.hexToString(e.email||""),e},o.prototype.getDocMetaList=function(){return ZWJSONUtils.clone(this.docMeta)},o.prototype.addDocMeta=function(e,t){this.docMeta[e]=t;var i=s.call(this);return i.then(d.bind(this,"DocMeta/Added",e,t),d.bind(this,"DocMetaAdd/Failed",e)),i},o.prototype.getDocMeta=function(e){return ZWJSONUtils.clone(this.docMeta[e]||null)},o.prototype.removeDocMeta=function(e){var t=this.docMeta[e];delete this.docMeta[e];var i=s.call(this);return i.then(d.bind(this,"DocMeta/Removed",e,t),d.bind(this,"DocMetaRemove/Failed",e)),i},o.prototype.getUserZuid=function(){return this.userDetails.zuid},o.prototype.getOfflineSetupUserEmail=function(){return n.hexToString(this.userDetails.email||"")},o.prototype.getOfflineSetupUserName=function(){return this.userDetails.userData.fname};var f=function(e,t){var i,n="";for(i in t)"errorCode"==i?n=t[i]:this.docMeta[e][i]=t[i];try{t.docSyncStatus&&this.trigger("SyncStatus/Updated",e,t.docSyncStatus,n)}catch(t){ZWOfflineLogger.log("JavaScript error occured during offline setup in updateDocMeta in RID: "+e),ZWOfflineLogger.log("Exception: "+t),a&&(ZWOfflineLogger.sendLog(OFFLINE_ERROR_CODES.JS_SCRIPT_ERROR_DURING_OFFLINE_SETUP,{shouldSendMail:!0}),a=!1)}};o.prototype.updateDocMeta=function(e,t){var n;if(this.docMeta[e])f.call(this,e,t),n=s.call(this),n.then(d.bind(this,"DocMeta/Updated",e,t),d.call(this,"DocMetaUpdate/Failed",e));else{var r=new i;n=r.promise();var o={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.METAUPDATED_FOR_UNAVAILABLE_RID};r.reject(o)}return n},o.prototype.updateWholeMeta=function(e,t,n){var r=new i;g.call(this,e),h.call(this,t);for(var o,a=0;a<n.length;++a)o=n[a],f.call(this,o.rid,o.docMeta);var l=s.call(this);return l.then(function(){d.bind(this,"WholeMetaUpdated/Success"),r.resolve()},function(e){d.bind(this,"WholeMetaUpdate/Failure"),r.reject({message:"whole meta update failed",ex:e})}),r.promise()},o.prototype.getSyncDocumentList=function(){var e,t=[];for(e in this.docMeta)t.push(e);return t},o.prototype.getPermissionsInfo=function(){return this.generalInfo.permissionInfo||{}},o.prototype.getRolesInfoFor=function(e){return this.getPermissionsInfo().ROLE_INFO[e]},o.prototype.getRole=function(e){return this.docMeta[e].ROLE},o.prototype.isOptedOfflineByUser=function(e){return this.docMeta[e].userOpted},o.prototype.isOfflineNewDocument=function(e){return this.docMeta[e].isNew},o.prototype.getAppSettings=function(){return this.getPermissionsInfo().APP_SETTINGS},o.prototype.getLastSyncTime=function(){return this.generalInfo.lastSyncTime},o.prototype.getBuildLabel=function(){return this.generalInfo.buildLabel},o.prototype.isOfflineSetupCompleted=function(){return this.generalInfo.offlineSetupState===OFFLINE_SETUP_STATE.COMPLETED},o.prototype.isOfflineSetupCorrupted=function(){var e=this.generalInfo.offlineSetupState;return e===OFFLINE_SETUP_STATE.PROGRESS||e===OFFLINE_SETUP_STATE.NEW},o.prototype.fetchAndStoreOfflinePermissions=function(){var e,t=this,n=new i;return e=isV8Engine&&"undefined"!=typeof MobileController&&!MobileController.isMobileAuthed()?ZWOfflineMobServerUtil.fetchPermissionsInfo():r.fetchPermissionsInfo(),e.then(function(e){var i=e.originalResponse.PERMISSION_INFO;i.APP_SETTINGS.visibility&&(i.APP_SETTINGS.visibility.usersInfo={},i.APP_SETTINGS.visibility.adminBoundary.entities=[]);var r={permissionInfo:i},o=t.updateGeneralInfo(r);o.then(function(){ZWOfflineLogger.log("offline permissions updated"),n.resolve()},function(e){ZWOfflineLogger.log("unable to fetch and store offline permissions",e),n.reject(e)})},function(e){var t={status:e.status,errorCode:OFFLINE_ERROR_CODES.FETCH_PERMISSIONS_FROM_SERVER_FAILED,reason:e.reason};n.reject(t)}),n.promise()},o.prototype.getPreProcessedMetaObj=function(){for(var e=new i,t=this,n=t.getSyncDocumentList(),o=[],a=[],s=[],l=[],d=function(i){var n=u.call(t,i,a,s);e.resolve(n)},c=function(t){ZWOfflineLogger.log("Fetch server meta for preprocess failed",t),e.reject(t)},g=0,h=n.length;g<h;g++){var f=ZWOfflineCommsWrapper.isLocked(n[g]);l.push(f)}var p=whenAlways(l);return p.done(function(){for(var e=0;e<arguments.length;e++){var i=arguments[e],n=i.rid;i.isActive?s.push(n):t.isOfflineNewDocument(n)?a.push(t.getDocMeta(n)):o.push(n)}if(0!==o.length){var l={data:o.splitArray(100),fn:r.fetchDocumentDetails},u=new BatchAsyncOperationProcessor(1,l),g=u.startProcess();g.then(function(e){for(var t=[],i=0;i<e.length;++i)t=t.concat(e[i].originalResponse.documents);d(t)},c)}else d([])}),e.promise()},o.prototype.destroy=function(){var e;for(e in this.docMeta)delete this.docMeta[e];this.docMeta=null,this.trigger("MetadataCollection/Destroyed"),this.resetEventHandler()},o.prototype.refresh=function(){var e=this,n=new i,r=t.getMetaFromDB();return r.then(function(t){t&&e.populateMetaCollection(t.docMeta,t.userData,t.generalInfo,t.editorProps),n.resolve(e)},function(e){n.reject(e)}),n.promise()},o.prototype.syncMetaResources=function(){var e=new i,t=this.fetchAndStoreOfflinePermissions();return t.then(function(){ZWOfflineLogger.log("meta resouces cached"),e.resolve()},function(t){ZWOfflineLogger.log("MetaCollection update Failed",t),e.reject(t)}),e.promise()},o.prototype.getEditorProperty=function(){return this.editorProperty},o.prototype.getUserInfo=function(){return this.editorProperty.userInfo},o.prototype.getOrgInfo=function(){return this.editorProperty.orgInfo},o.prototype.prepareForSetup=function(e){this.generalInfo.offlineSetupState=OFFLINE_SETUP_STATE.PROGRESS,this.userDetails=e;var t=n.stringToHex(e.email||"");this.userDetails.email=t;var i=editorProps.userInfo;this.editorProperty={userInfo:{zuid:i.zuid,fullName:i.fullName,language:i.language,email:t,settings:i.settings,country:i.country,zoid:i.zoid},orgInfo:editorProps.orgInfo,uiText:editorProps.uiText};var r=s.call(this);return r.then(d.bind(this,"MetaCollection/Updated"),d.bind(this,"MetaCollectionUpdate/Failed")),r},o.prototype.isAvailableOffline=function(e){var t=!0;return this.docMeta[e]||(t=!1),t},e.call(o.prototype);var p=function(){var e=new o;return e.refresh()};return{getInstance:p}}(BaseEventHandler,ZWOfflineDBUtil,Deferred,Utils,ZWOfflineServerUtil),ZWOfflineImageCollection=function(e,t,i){"use strict";function n(e){this.populateImageCollection({rid:e})}var r=function(){var e=this.getImageObject(),i=t.storeImagesInDB(e);return i},o=function(e){return t.deleteDocImagesInDB(e)},a=function(){this.trigger.apply(this,arguments)};n.prototype.populateImageCollection=function(e){e=e||{},this.rid=e.rid||"",this.images=e.images||{},this.pendingImages=e.pendingImages||[],this.offlineImages=e.offlineImages||{}},n.prototype.getImageObject=function(){var e={rid:this.rid,images:this.images,pendingImages:this.pendingImages,offlineImages:this.offlineImages};return e},n.prototype.updateImageCollection=function(e){this.populateImageCollection(e);var t=r.call(this);return t.then(a.bind(this,"ImageDetails/Stored",e),a.bind(this,"ImageDetailsUpdate/Failed",e)),t},n.prototype.clearCollection=function(){var e=(new i,this.rid);return this.rid="",o(e)},n.prototype.addImage=function(e){var t;for(t in e)this.images[t]=e[t];var i=r.call(this);return i.then(a.bind(this,"ImageDetails/Updated",e),a.bind(this,"ImageDetailsUpdate/Failed",e)),i},n.prototype.addPendingImages=function(e){for(var t=0,i=e.length;t<i;t++)this.pendingImages.push(e[t]);var n=r.call(this);return n.then(a.bind(this,"PendingImages/Updated",e),a.bind(this,"PendingImagesUpdate/Failed",e)),n},n.prototype.addOnlineImage=function(e){var t=new i;if(this.images.hasOwnProperty(e)||this.pendingImages.contains(e))t.resolve();else{this.pendingImages.push(e);var n=this,o=ZWOfflineServerUtil.fetchImageBytes(this.rid,e);o.done(function(t){var i=t.result;if(t.status===OPERATION_STATUS.SUCCESS){n.images[i.imageURL]=i.imageBytes;var r=n.pendingImages.indexOf(e);n.pendingImages.splice(r,1)}}),o.always(function(){var i=r.call(n);i.then(function(){a.call(n,"OnlineImageDetails/Updated",e),t.resolve()},function(){a.call(n,"OnlineImageDetailsUpdate/Failed",e),t.reject()})})}return t.promise()},n.prototype.addOfflineImage=function(e){var t=e.imageURLValue;this.offlineImages[t]=e;var i=r.call(this);return i.then(a.bind(this,"OfflineImages/Updated",e),a.bind(this,"OfflineImagesUpdate/Failed",e)),i},n.prototype.removeOfflineImage=function(e){this.offlineImages[e]&&delete this.offlineImages[e];var t=r.call(this);return t.then(a.bind(this,"OfflineImages/Updated",e),a.bind(this,"OfflineImagesUpdate/Failed",e)),t},n.prototype.removeImage=function(e){if(this.images[e])delete this.images[e];else if(this.pendingImages.contains(e))for(var t=0,i=this.pendingImages.length;t<i;t++)if(this.pendingImages[t]==e){this.pendingImages.splice(t,1);break}var n=r.call(this);return n.then(a.bind(this,"Images/Removed",e),a.bind(this,"ImagesRemove/Failed",e)),n},n.prototype.getOfflineImages=function(){return this.offlineImages},n.prototype.getImages=function(){return this.images},n.prototype.getPendingImages=function(){return this.pendingImages},n.prototype.getRID=function(){return this.rid},n.prototype.destroy=function(){this.trigger("OfflineImageCollection/Destroyed"),this.resetEventHandler()},n.prototype.refresh=function(){var e=this,n=new i,r=t.getDocImagesFromDB(this.rid);return r.then(function(t){t&&e.populateImageCollection(t),n.resolve(e)},function(e){n.reject(e)}),n.promise()},n.prototype.syncImages=function(){var e=new i,t=function(t){ZWOfflineLogger.log("Image sync failed",t),e.reject(t)},n=this,r=n.performClientToServerSync();return r.then(function(){var i=n.performServerToClientSync();i.then(function(){ZWOfflineLogger.log("Image sync completed"),e.resolve()},t)},t),e.promise()},n.prototype.performServerToClientSync=function(){ZWOfflineLogger.log("Image server to client sync function start");var e=new i,t=this,n=ZWOffline.getMetaCollection(),r=function(t){ZWOfflineLogger.log("Image server to client sync failed"),e.reject(t)},o=s(t.getRID(),t.getPendingImages());return o.then(function(i){var o,a=t.getImages();for(o in a)i.images[o]=a[o];i.offlineImages=t.getOfflineImages();var s=t.updateImageCollection(i);s.then(function(){var i=n.updateDocMeta(t.getRID(),{docSyncStatus:OFFLINE_DOC_STATES.SYNCED});i.then(function(){ZWOfflineLogger.log("Image server to client sync completed"),e.resolve()},r)},r)},r),ZWOfflineLogger.log("Image server to client sync function end"),e.promise()},n.prototype.performClientToServerSync=function(){ZWOfflineLogger.log("Image client to server sync function start");var e=new i,t=function(t){ZWOfflineLogger.log("Image client to server sync failed",t),e.reject(t)},n=this,r=ZWOffline.getMetaCollection(),o=r.updateDocMeta(n.getRID(),{docSyncStatus:OFFLINE_DOC_STATES.PENDING});return o.then(function(){var i=n.getOfflineImages(),o=10,a={fn:l,data:Object.keys(i),context:n},s=new BatchAsyncOperationProcessor(o,a),d=s.startProcess();d.done(function(){var i=r.updateDocMeta(n.getRID(),{docSyncStatus:OFFLINE_DOC_STATES.SYNCED});i.then(function(){ZWOfflineLogger.log("Image client to server sync completed"),e.resolve()},t)})},t),ZWOfflineLogger.log("Image client to server sync function end"),e.promise()},e.call(n.prototype);var s=function(e,t){var n=new i,r=10,o={fn:ZWOfflineServerUtil.fetchImageBytes.bind(null,e),data:t},a=new BatchAsyncOperationProcessor(r,o),s=a.startProcess();return s.done(function(){for(var t,i,r=arguments,o={rid:e,images:{},pendingImages:[]},a=0,s=r.length;a<s;a++)t=r[a],i=t.result,t.status===OPERATION_STATUS.SUCCESS?o.images[i.imageURL]=i.imageBytes:o.pendingImages.push(i.imageURL);n.resolve(o)}),n.promise()},l=function(e){var t=new i,n=function(e){ZWOfflineLogger.log("Image sync failed",e),t.reject(e)},r=this,o=r.getOfflineImages(),a={imageId:o[e].imgid,imageURLValue:o[e].imageURLValue,imageBase64:o[e].bytes,sid:o[e].sid,rid:this.rid},s=ZWOfflineServerUtil.saveImage(a);return s.then(function(i){var o=r.removeOfflineImage(e);o.then(function(){var i={};i[e]=a.imageBase64;var o=r.addImage(i);o.then(function(e){t.resolve(e)},n)},n)},function(e){var t={status:e.status,errorCode:OFFLINE_ERROR_CODES.SAVE_IMAGEBYTES_TO_SERVER_FAILED,reason:e.reason};n(t)}),t.promise()},d=function(e){var t=new n(e);return t.refresh()};return{getInstance:d}}(BaseEventHandler,ZWOfflineDBUtil,Deferred),ZWOfflineOpsCollection=function(e,t,i){"use strict";function n(e){this.rid=e,this.populateOpCollection()}var r=function(){var e=this.getOpsObject(),i=t.storeOpsInDB(e);return i},o=function(e){return t.deleteOpsInDB(e)};n.prototype.getRID=function(){return this.rid},n.prototype.getSessionID=function(){var e;return e=null!==this.offlineOps.ackPendingEdit?this.offlineOps.ackPendingEdit.sid:this.offlineOps.pendingEdits.length>0?this.offlineOps.pendingEdits[0].sid:""},n.prototype.isEmpty=function(){return null===this.offlineOps.ackPendingEdit&&0===this.offlineOps.pendingEdits.length},n.prototype.getOfflineOps=function(){return this.offlineOps},n.prototype.getOnlineOps=function(){return this.onlineOps},n.prototype.getVersionObj=function(){return{version:this.version,revision:this.revision,versionId:this.versionId}},n.prototype.getOpsObject=function(){return{rid:this.rid,onlineOps:this.onlineOps,offlineOps:this.offlineOps,version:this.version,revision:this.revision,versionId:this.versionId}},n.prototype.clearCollection=function(){var e=this.rid;this.rid="";var t=o(e);return t},n.prototype.emptyCollection=function(){this.populateOpCollection({rid:this.rid});var e=r.call(this);return e},n.prototype.emptyOnlineOps=function(){this.onlineOps=[];var e=r.call(this);return e},n.prototype.updateOfflineOps=function(e,t,i,n){return ZWOfflineLogger.log("Ops collection - updateOfflineOps invoked at version: "+t+", revision: "+i+", versionId: "+n+" for RID: "+this.getRID()),this.offlineOps=e,this.updateVersion(t,i,n)},n.prototype.addStatusToLog=function(){try{var e=this.getOnlineOps(),t=this.getOfflineOps();ZWOfflineLogger.log("opCollection details: onlineOps length = "+e.length+"\nofflineOps.ackpendingEdit = "+(null==t.ackPendingEdit?"no ops":"has ops")+"\nofflineOps.pendingEdits.length = "+t.pendingEdits.length+"\nopsCollection Session-ID = "+this.getSessionID()+"\nopscollection version = "+this.version+" ;revision = "+this.revision)}catch(e){ZWOfflineLogger.log("Error occurred while adding ops collection info in log",e)}},n.prototype.updateAcknowledgement=function(e,t,i){ZWOfflineLogger.log("Ops collection - updateAcknowledgement invoked at version: "+e+", revision: "+t+", versionId: "+i+" for RID: "+this.getRID());var n=this.offlineOps.ackPendingEdit&&this.offlineOps.ackPendingEdit.op;return n||(ZWOfflineLogger.log("Null ops is swapped from offline ops to online ops at version: "+e+", revision: "+t+", versionId: "+i+" for RID: "+this.getRID()),this.addStatusToLog(),clearTimeout(this.sendLogTimer),this.sendLogTimer=setTimeout(function(){ZWOfflineLogger.sendLog("OFFLINE_NULL_OPS")},5e3)),this.onlineOps.push(n),this.offlineOps.ackPendingEdit=null,this.updateVersion(e,t,i)},n.prototype.addAckEdit=function(){ZWOfflineLogger.log("Ops collection - addAckEdit invoked for RID: "+this.getRID()),this.offlineOps.ackPendingEdit=this.offlineOps.pendingEdits.shift();var e=r.call(this);return e},n.prototype.updateVersion=function(e,t,i){ZWOfflineLogger.log("Ops collection - update version invoked at version: "+e+", revision: "+t+", versionId: "+i+" for RID: "+this.getRID()),this.version=e,this.revision=t,this.versionId=i;var n=r.call(this);return n},n.prototype.addCollaboratorMutation=function(e,t,i,n){return ZWOfflineLogger.log("Ops collection - addCollaboratorMutation invoked at version: "+t+", revision: "+i+", versionId: "+n+" for RID: "+this.getRID()),e||(ZWOfflineLogger.log("Null ops is pushed into online ops during addCollaboratorMutation at version: "+t+", revision: "+i+", versionId: "+n+" for RID: "+this.getRID()),ZWOfflineLogger.sendLog("OFFLINE_NULL_OPS")),this.onlineOps.push(e),this.updateVersion(t,i,n)},n.prototype.populateOpCollection=function(e){e=e||{},this.rid=e.rid||this.rid||"",this.onlineOps=e.onlineOps||[],this.offlineOps=e.offlineOps||{ackPendingEdit:null,pendingEdits:[]},this.version=e.version||1,this.revision=e.revision||0,this.versionId=e.versionId||""},n.prototype.refresh=function(){var e=this,n=new i,o=t.getOpsFromDB(this.rid);return o.then(function(t){var i=a(t);if(e.populateOpCollection(t),i){var o=r.call(e);o.then(function(){n.resolve(e)},function(e){n.reject(e)})}else n.resolve(e)},function(e){n.reject(e)}),n.promise()};var a=function(e){var t=!1;try{var i=e.onlineOps,n=e.offlineOps;if(i){for(var r=0,o=i.length;r<o;r++){var a=JSON.parse(i[r]),s=ClientMigration.migrateOps(a);1==s&&(i[r]=JSON.stringify(a),t=!0)}e.onlineOps=i}if(n){var l=n.pendingEdits;if(null!=n.ackPendingEdit){var a=JSON.parse(n.ackPendingEdit.op),s=ClientMigration.migrateOps(a);1==s&&(n.ackPendingEdit.op=JSON.stringify(a),t=!0)}for(var d=0,c=l.length;d<c;d++){var a=JSON.parse(l[d].op),s=ClientMigration.migrateOps(a);1==s&&(l[d].op=JSON.stringify(a),t=!0)}n.pendingEdits=l,e.offlineOps=n}}catch(e){ZWOfflineLogger.log("Error occurred while running migration on Offline docOps",e)}return t};e.call(n.prototype);var s=function(e){var t=new n(e);return t.refresh()};return{getInstance:s}}(BaseEventHandler,ZWOfflineDBUtil,Deferred),ZWOfflineDocumentHandler=function(e,t,i,n,r){"use strict";function o(e,t,i,n){this.rid=e||"",this.populateDocInstance(t,i,n)}var a=function(){var e=this.getDocResp(),t=n.storeDocumentInDB(e);return t},s=function(e){return n.deleteDocumentInDB(e)},l=function(){this.trigger.apply(this,arguments)},d=function(e,t,i){if(null!==e){var n=new Model(e.content,e.styles,e.defaults,e.locks,e.mig_ver,e.ranges);n.init();try{if(t)for(var r=0,o=t.length;r<o;r++)n.applyOps(DocOpBuilder.build(JSON.parse(t[r])));if(i){var a=i.pendingEdits;null!=i.ackPendingEdit&&n.applyOps(DocOpBuilder.build(JSON.parse(i.ackPendingEdit.op)));for(var s=0,l=a.length;s<l;s++)n.applyOps(DocOpBuilder.build(JSON.parse(a[s].op)))}var d=n.getDocument();e.content=d.content,e.defaults=d.defaults,e.styles=d.styles,e.locks=d.locks,e.ranges=d.ranges}catch(t){ZWOfflineLogger.log("Error in offlinedocInstance applyTo ",t);var c=printStackTrace({e:t});c=c.join("\n"),ZWOfflineLogger.log("Message: "+t.message+"\nTrace: ",c),e=null}finally{n.destroy()}}return e};o.prototype.populateDocInstance=function(e,t,i,n){this.imageCollection=e||null,this.opsCollection=t||null,i=i||{},this.docInfo=i.docInfo||null,this.docContent=i.docContent||null,this.sid=n||""},e.call(o.prototype),o.prototype.getSessionID=function(){return this.sid},o.prototype.getImageCollection=function(){return this.imageCollection},o.prototype.getOpsCollection=function(){return this.opsCollection},o.prototype.getRID=function(){return this.rid},o.prototype.getDocResp=function(){return{rid:this.rid,sid:this.sid,docObject:this.getDocObject()}},o.prototype.getDocObject=function(){var e,t=this.getDocInfo(),i=this.getDocContent();return e=null===t||null===i?null:{docInfo:t,docContent:i}},o.prototype.getDocContent=function(){return this.docContent},o.prototype.getDocInfo=function(){return this.docInfo},o.prototype.getWholeDocObject=function(){var e=this.getDocObject();if(null!==e){var t=this.opsCollection.getOnlineOps(),i=this.opsCollection.getOfflineOps(),n=d(ZWJSONUtils.clone(e.docContent),t,i);null!=n?e.docContent=n:(this.sendExceptionData("OFFLINE_DOCINSTANCE_APPLYTO"),e.docContent=ZWJSONUtils.clone(e.docContent)),e.docInfo=ZWJSONUtils.clone(e.docInfo)}return e},o.prototype.getVersionObj=function(){return ZWJSONUtils.clone({version:this.docContent.ver,revision:this.docContent.rev,versionId:this.docInfo.VERSION_ID})},o.prototype.isEmptyInstance=function(){return null==this.docContent||null==this.docInfo},o.prototype.getOfflineOps=function(){return ZWJSONUtils.clone(this.opsCollection.getOfflineOps())},o.prototype.updateImageCollection=function(e){return this.imageCollection.updateImageCollection(e)},o.prototype.getDocumentName=function(){return ZWJSONUtils.clone(this.docInfo.DOCUMENT_NAME)},o.prototype.updateDocObject=function(e){ZWOfflineLogger.log("DocInstance.updateDocObject Invoked"),this.rid=e.rid;var t=e.docObject||{};this.docInfo=t.docInfo||null,this.docContent=t.docContent||null;var i=D.call(this),n=a.call(this);return n.then(l.bind(this,"DocObject/Updated",e),l.bind(this,"DocObjectUpdate/Failed",e)),r.when(i,n)},o.prototype.updateDocInfo=function(e){for(var t in e)this.docInfo[t]=e[t],"DOCUMENT_NAME"==t&&(this.docInfo[t+"_HTML"]=Utils.encodeHTMLString(e[t]),this.docInfo.title=e[t]);return a.call(this)},o.prototype.rename=function(e){return this.updateDocInfo({DOCUMENT_NAME:e})},o.prototype.updateOfflineOps=function(e,t,i,n){ZWOfflineLogger.log("offline ops updated"),this.opsCollection.updateOfflineOps(e,t,i,n),this.updateVersion(t,i,n)},o.prototype.updateAcknowledgement=function(e,t,i){ZWOfflineLogger.log("Ack received"),this.opsCollection.updateAcknowledgement(e,t,i),this.updateVersion(e,t,i)},o.prototype.updateOpsVersion=function(e,t,i){this.opsCollection.updateVersion(e,t,i),this.updateVersion(e,t,i)},o.prototype.updateVersion=function(e,t,i){ZWOfflineLogger.log("version/revision updated"),this.docInfo.VERSION=e,this.docInfo.REVISION=t,this.docInfo.VERSION_ID=i,this.docContent.rev=t,this.docContent.ver=e,this.docContent.verId=i;var n=a.call(this);return n},o.prototype.addCollaboratorMutation=function(e,t,i,n){ZWOfflineLogger.log("Collaborator mutation added"),this.opsCollection.addCollaboratorMutation(e,t,i,n),this.updateVersion(t,i,n)},o.prototype.addAckEdit=function(){ZWOfflineLogger.log("Ack edit sent"),this.opsCollection.addAckEdit()},o.prototype.syncDocument=function(){ZWOfflineLogger.log("syncDocument function invoked");var e=new r,t=function(t){e.reject(t)},i=this,n=ZWOffline.getMetaCollection(),o=n.getDocMeta(i.getRID());if(o.isNew===!0){var a=R.call(i);a.then(function(t){PubSub.publish("DocumentSync/Success",t),e.resolve(t)},t)}else{ZWOfflineLogger.log("Existing Document Sync Start");var s=O.call(i);s.then(function(){var n=m.call(i);n.then(function(){PubSub.publish("DocumentSync/Success",{rid:i.rid}),e.resolve({status:OPERATION_STATUS.SUCCESS,rid:i.rid})},t)},t)}return e.promise()},o.prototype.sendExceptionData=function(e){var t=ZWOffline.getMetaCollection(),i=t&&t.getDocMeta(this.getRID())||null,n=this.getDocObject(),r=this.opsCollection.getOnlineOps(),o=this.opsCollection.getOfflineOps(),a={metaData:i,docCont:n,onlineOps:r,offlineOps:o};ZWOfflineLogger.sendExceptionData(e,a)},o.prototype.clearDocInstance=function(){var e=this.rid;this.rid="",this.docInfo=null,this.docObject=null;var t=s(e),i=this.imageCollection.clearCollection(),n=this.opsCollection.clearCollection(),o=ZWOffline.getMetaCollection(),a=o.removeDocMeta(e),l=r.when(t,i,n,a);return l},o.prototype.addStatusToLog=function(){try{var e=this.docContent||{},t=this.docInfo||{};ZWOfflineLogger.log("\nDocContent version = "+e.ver+" ;revision = "+e.rev+"\nDocInfo version = "+t.VERSION+" ;revision = "+t.REVISION+"\nDocInstance session ID = "+this.getSessionID())}catch(e){ZWOfflineLogger.log("Error occurred while adding docInstance info in log",e)}},o.prototype.refresh=function(){var e=this,o=new r,s=t.getInstance(e.rid),l=i.getInstance(e.rid),d=n.getDocumentFromDB(e.rid),c=r.when(s,l,d);return c.then(function(t,i,n){n=n||{};var r=n.docObject,s=!1;r&&(s=f(r));var l=n.sid;if(e.populateDocInstance(t,i,r,l),e.addStatusToLog(),i.addStatusToLog(),s){var d=a.call(e);d.then(function(){o.resolve(e)},function(e){o.reject(e)})}else o.resolve(e)},function(e){o.reject(e)}),o.promise()};var c=function(e,t,i){return{bytes:t,sid:i,imgid:e,imageURLValue:e}},u=function(e){var t,i,n=e.getImageCollection().getImageObject(),r=n.images,o=n,a=e.getSessionID();for(t in r)i=c(t,r[t],a),o.offlineImages[i.imageURLValue]=i,delete o.images[t];return o},g=function(e){var t=new r,i=this.getWholeDocObject(),n=e.docObject.docInfo,o=e.updateDocObject({rid:e.getRID(),docObject:i}),a=e.updateDocInfo(n),s=u(this);s.rid=e.getRID();var l=e.updateImageCollection(s);return r.when(o,l,a).then(function(){t.resolve(e)},function(e){t.reject(e)}),t.promise()},h=function(e,t){var i=new r;return C(e).then(function(e){e.makeACopy(t).then(function(e){i.resolve(e)},function(e){i.reject(e)})}),i.promise()};o.prototype.makeACopy=function(e){var t=new r,i=this;return v(e).then(function(e){g.call(i,e).then(function(){t.resolve(e)},function(e){t.reject(e)})},function(e){t.reject(e)}),t.promise()};var f=function(e){var t=!1;try{var i=e.docContent;OfflineMigration.migrateDocument(i);var n=new Model(i.content,i.styles,i.defaults,i.locks,i.mig_ver,i.ranges);if(n.init(),t=ClientMigration.migrateDoc(n)){var r=n.getDocument();i.content=r.content,i.defaults=r.defaults,i.styles=r.styles,i.locks=r.locks,i.ranges=r.ranges,e.docContent=i}n.destroy()}catch(e){ZWOfflineLogger.log("Error occurred while running migration on Offline docContent",e)}return t},p=function(e){this.sid=e||this.sid},E=function(){var e=new r,t=this,i=this.getDocContent();if(null===i)e.resolve({status:OPERATION_STATUS.SUCCESS});else{var n=this.opsCollection.getOfflineOps(),o=this.opsCollection.getOnlineOps(),a=n.pendingEdits;if(0===o.length&&null===n.ackPendingEdit&&0===a.length)e.resolve({status:OPERATION_STATUS.SUCCESS});else{ZWOfflineLogger.log("Applying online ops in docInstance");var s=d(i,o);if(null===s){t.sendExceptionData("OFFLINE_DOCINSTANCE_APPLYTO");var l=t.opsCollection.emptyCollection();l.then(function(){e.resolve({status:OPERATION_STATUS.SUCCESS})},function(t){e.reject(t)})}else{var c=t.opsCollection.getSessionID();p.call(t,c);var u={rid:t.getRID(),docObject:{docContent:s,docInfo:t.getDocInfo()}},g=t.opsCollection.emptyOnlineOps(),h=t.updateDocObject(u);r.when(g,h).then(function(){e.resolve({status:OPERATION_STATUS.SUCCESS})},function(t){e.reject(t)})}}}return e.promise()},T=function(){var e=this,t=(e.getOpsCollection(),e.getOfflineOps()),i=t.pendingEdits;null!==t.ackPendingEdit&&i.unshift(t.ackPendingEdit);var n=e.getVersionObj(),r={rid:e.getRID(),op:i,syncVersion:n.version,syncRevision:n.revision,sid:e.getSessionID()};return n.versionId&&(r.syncVersionId=n.versionId),r},O=function(){ZWOfflineLogger.log("Client to server Sync function Start");var e=new r,t=(ZWOffline.getMetaCollection(),this),i=t.getOpsCollection(),n=t.getRID(),o=function(t){e.reject(t)},a=function(){ZWOfflineLogger.log("Client to server Sync completed");var n=i.emptyCollection();n.then(function(){var i=t.imageCollection.performClientToServerSync();i.always(function(){e.resolve({status:OPERATION_STATUS.SUCCESS})})},function(e){o({status:e.status,errorCode:e.errorCode,reason:"EMPTY_OPS_COLLECTION_FAILED"})})},s=E.call(t);return s.then(function(){if(i.isEmpty())e.resolve({status:OPERATION_STATUS.SUCCESS});else{var r=t.getSessionID(),s=t.getVersionObj(),l=new ZWOfflineCollaboration(t),d=new ZWOfflineSyncProtocol(n,r,s.version,s.revision,s.versionId,l),c=d.sync();c.then(function(){var e=T.call(t);if(e&&e.op.length>0){ZWOfflineLogger.log("Ops sent to server");var i=ZWOfflineServerUtil.saveOps(n,e);i.then(a,function(e){var t={status:e.status,errorCode:OFFLINE_ERROR_CODES.SAVE_ARRAYOFOPS_TO_SERVER_FAILED,reason:e.reason};o(t)})}else ZWOfflineLogger.log("No ops to send"),a({status:OPERATION_STATUS.SUCCESS})},o)}},o),ZWOfflineLogger.log("Client to server Sync function end"),e.promise()},m=function(){ZWOfflineLogger.log("Server to client Sync function Start");var e=this,t=new r,i=e.getRID(),n=ZWOffline.getMetaCollection(),o=function(e){ZWOfflineLogger.log("Server to client Sync failed");var r=n.updateDocMeta(i,{docSyncStatus:OFFLINE_DOC_STATES.FAILED,errorCode:e.errorCode});r.always(function(){t.reject(e)})},a=n.updateDocMeta(i,{docSyncStatus:OFFLINE_DOC_STATES.PENDING});return a.then(function(){var r=ZWOfflineServerUtil.fetchDocument(i);r.then(function(r){var a=r.originalResponse.doc_resp;try{var s=a.docInfo.ROLE;delete a.docInfo.ROLE}catch(e){ZWOfflineLogger.sendLog()}var l={rid:i,docObject:a},d=e.updateDocObject(l);d.then(function(){var r={ROLE:s,DOCUMENT_NAME:a.docInfo.DOCUMENT_NAME,LASTMODIFIEDBY:a.docInfo.LASTMODIFIEDBY,LASTMODIFIEDBY_HTML:a.docInfo.LASTMODIFIEDBY_HTML,LAST_MODIFIED_TIME_LONG:a.docInfo.LAST_MODIFIED_TIME_LONG,SERVICE_NAME:a.docInfo.SERVICE_NAME,lastSyncDate:Date.now(),docSyncStatus:OFFLINE_DOC_STATES.SYNCED},l=n.updateDocMeta(i,r);l.then(function(){ZWOfflineLogger.log("Server to client Sync Complete");var i=e.getImageCollection(),n=i.performServerToClientSync();n.then(function(){t.resolve()},o)},o)},o)},function(e){var t={status:e.status,errorCode:OFFLINE_ERROR_CODES.FETCH_DOCCONTENT_FROM_SERVER_FAILED,reason:e.reason};o(t)})},o),ZWOfflineLogger.log("Server to client Sync function end"),t.promise()},I=function(e,t,i){var n,r,o={};for(n in i)if(r=t[n]){var a=r.replace("r-"+e+"-","");o[r]=i[n],o[r].imageURLValue=r,o[r].imgid=a}return o},D=function(){var e=new r,t=this,i=t.getImageCollection(),n=t.getDocContent();if(null===n||null===i)e.resolve();else{for(var o,a=i.getImages(),s=[],l={},d=i.getOfflineImages(),c=ZWOfflineUtil.getWriterImageURLs(n),u=0,g=c.length;u<g;u++)o=c[u],a[o]?l[o]=a[o]:d[o]||s.push(o);var h={rid:t.getRID(),pendingImages:s,images:l,offlineImages:d},f=i.updateImageCollection(h);f.then(function(){e.resolve()},function(t){e.reject(t)})}return e.promise()},R=function(){ZWOfflineLogger.log("New Document sync function start");var e=new r,t=this,i=function(t){ZWOfflineLogger.log("New Document sync failed",t),e.reject(t)},n=t.getRID(),o=t.getWholeDocObject(),a=ZWOfflineServerUtil.saveDocument(o,o.docInfo.DOCUMENT_NAME);return a.then(function(r){var a=r.originalResponse;ZWOfflineLogger.log("New Document Saved to server");var s=a.rid,l=a.image_mapping,d=t.getImageCollection(),c=I(s,l,d.getOfflineImages()),u=ZWOffline.getMetaCollection(),g=t.clearDocInstance();g.then(function(){var r=ZWOfflineUtil.constructMeta(a.docInfo,"OWNER"),l=u.addDocMeta(s,r);l.then(function(){var l={rid:s,images:{},pendingImages:[],offlineImages:c},d=t.imageCollection.updateImageCollection(l);d.then(function(){var l={rid:s,docObject:{docContent:o.docContent,docInfo:a.docInfo}},d=t.updateDocObject(l);d.then(function(){ZWOfflineLogger.log("New Document content updated to Local DB");var o=t.imageCollection.syncImages();o.then(function(){ZWOfflineCommsWrapper.notifyUrlChange(n,s),PubSub.publish("OfflineDocument/Saved",{oldRID:n,newRID:s,newDocMeta:r}),e.resolve({status:OPERATION_STATUS.SUCCESS,oldRID:n,newRID:s})},i)},i)},i)},i)},i)},function(e){var t={status:e.status,errorCode:OFFLINE_ERROR_CODES.SAVE_DOCCONTENT_TO_SERVER_FAILED,reason:e.reason};i(t)}),ZWOfflineLogger.log("New Document sync function end"),e.promise()},S=function(){for(var e=ZWOffline.getMetaCollection(),t=e.getDocMetaList(),i="off_".concat(Utils.randomString(15));Object.keys(t).contains(i);)i="off_".concat(Utils.randomString(15));return i},C=function(e){ZWOfflineLogger.log("getInstance in docinstance invoked");var t=new r,i=function(e){t.reject(e)},n=new o(e),a=n.refresh();return a.then(function(){var e=E.call(n);e.then(function(){t.resolve(n)},i)},i),t.promise()},A=function(e){ZWOfflineLogger.log("getReadOnlyInstance in docinstance invoked");var t=new o(e);return t.refresh()},v=function(e){ZWOfflineLogger.log("create New Document offline function start");var t=new r,i=function(e){t.reject(e)},o=S(),a=C(o),s=n.getNewDocumentContentFromDB(),l=r.when(a,s);return l.then(function(n,r){r.docInfo.CATEGORY="OWNED",r.docInfo.RID=o,r.docInfo.DOCUMENT_NAME_URL=o,r.docInfo.is_direct_wd_document=!0,r.docInfo.LAST_MODIFIED_TIME_LONG=Date.now();var a=ZWOfflineUtil.constructMeta(r.docInfo,"OWNER");for(var s in e)a[s]=e[s];a.isNew=!0;var l=ZWOffline.getMetaCollection(),d=l.addDocMeta(o,a);d.then(function(){var e={rid:o,docObject:r},a=n.updateDocObject(e);a.then(function(e){ZWOfflineLogger.log("create New Document offline complete"),t.resolve(n)},i)},i)},i),ZWOfflineLogger.log("create New Document offline function end"),t.promise()},_=function(){var e=new r;return n.getNewDocumentContentFromDB().then(function(t){e.resolve(t.docInfo)}),e.promise()},P=function(e){ZWOfflineLogger.log("Converting old document to new function start");var t=new r,i=function(e){ZWOfflineLogger.log("converting old document to new failed",e),t.reject(e)};return e.makeACopy({DOCUMENT_NAME:"Copy of "+e.docInfo.DOCUMENT_NAME}).then(t.resolve.bind(t),i),t.promise()},N=function(e){var t=new r,i=ZWOffline.getMetaCollection(),n=function(i){i.rid=e,ZWOfflineLogger.log("Making Document available offline failed. ",i),t.reject(i)},o=ZWOfflineServerUtil.fetchDocument(e);return o.then(function(r){try{var o=r.originalResponse.doc_resp,a=o.docInfo.ROLE;delete o.docInfo.ROLE;var s=ZWOfflineUtil.constructMeta(o.docInfo,a),l=i.addDocMeta(e,s);l.then(function(){var r={rid:e,docObject:o},a=C(e);a.then(function(o){var a=o.updateDocObject(r);a.then(function(r){var a=o.imageCollection.syncImages();a.then(function(){var r=i.updateDocMeta(e,{docSyncStatus:OFFLINE_DOC_STATES.SYNCED,userOpted:!0,lastSyncDate:Date.now()});r.then(function(){t.resolve({status:OPERATION_STATUS.SUCCESS,rid:e})},n)},n)},n)},n)},n)}catch(e){var d={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.PROCESSING_SERVER_RESPONSE_CAUSES_ERROR};n(d)}},function(e){var t={status:e.status,errorCode:OFFLINE_ERROR_CODES.FETCH_DOCCONTENT_FROM_SERVER_FAILED,reason:e.reason};n(t)}),t.promise()};return{getInstance:C,getReadOnlyInstance:A,getNewDocument:v,saveAsNew:P,takeDocumentOffline:N,getNewDocInfo:_,makeACopy:h}}(BaseEventHandler,ZWOfflineImageCollection,ZWOfflineOpsCollection,ZWOfflineDBUtil,Deferred),ZWOfflineUtil=function(e,t,i,n){"use strict";var r=!1,o=null,a=function(e){if(!e)return[];for(var t,i=e.styles,n=[],r=0,o=i.length;r<o;r++)i[r]&&"image"===i[r].type&&(t=i[r].src,t&&t.indexOf("imgurl=")!=-1&&(t=t.substring(t.indexOf("=")+1),n.contains(t)||n.push(t)));return n},s=function(e){o=e},l=function(){return o},d=function(){var t,i=new Deferred;if(isV8Engine&&void 0!==typeof MobileController&&!MobileController.isMobileAuthed())t=ZWOfflineMobServerUtil.fetchNewDocumentContent(),t.then(function(e){var t=e.originalResponse.doc_resp;s(t),i.resolve()},function(e){var t={status:e.status,errorCode:OFFLINE_ERROR_CODES.FETCH_NEW_DOCCONTENT_FROM_SERVER_FAILED,reason:e.reason};i.reject(t)});else{var n=l();if(n)return i.resolve(n),i.promise();t=e.fetchNewDocumentContent(),t.then(function(e){var t=e.originalResponse.doc_resp;s(t),i.resolve(t)},function(e){var t={status:e.status,errorCode:OFFLINE_ERROR_CODES.FETCH_NEW_DOCCONTENT_FROM_SERVER_FAILED,reason:e.reason};i.reject(t)})}return i.promise()},c=function(){var e=new Deferred,i=t.storeNewDocumentContentInDB(l());return i.then(function(){e.resolve()},function(t){ZWOfflineLogger.log("unable to fetch and store new document content",t),e.reject(t)}),e.promise()},u=function(){},g=function(){var e=new Deferred,t=function(t){ZWOfflineLogger.log("resources fetch and store failed"),e.reject(t)};return h().then(function(){f().then(function(){ZWOfflineLogger.log("resources cached and stored"),e.resolve()},t)},t),e.promise()},h=function(){var e=new Deferred,t=d();return t.then(function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise()},f=function(){var e=new Deferred,t=c();return t.then(function(){e.resolve()},function(t){e.reject(t)}),e.promise()},p=function(e){if(!r){var i=t.getOpsFromDB(e),n=t.getDocumentFromDB(e),o=Deferred.when(i,n);o.done(function(e,t){try{e=e||{};var i=e.onlineOps||[],n=e.offlineOps||{ackPendingEdit:null,pendingEdits:[]},o="";null!==n.ackPendingEdit?o=n.ackPendingEdit.sid:n.pendingEdits.length>0&&(o=n.pendingEdits[0].sid),t=t||{};var a=t.docObject||{},s=a.docContent||{},l=a.docInfo||{},d=parseInt(e.revision)>9?".":".0",c=parseFloat(e.version+d+e.revision);d=parseInt(l.REVISION)>9?".":".0";var u=parseFloat(l.VERSION+d+l.REVISION);Math.abs(c-u)>5&&(ZWOfflineLogger.log("opCollection details: onlineOps length = "+i.length+"\nofflineOps.ackpendingEdit = "+(null==n.ackPendingEdit?"no ops":"has ops")+"\nofflineOps.pendingEdits.length = "+n.pendingEdits.length+"\nopsCollection Session-ID = "+o+"\nopscollection version = "+e.version+" ;revision = "+e.revision),ZWOfflineLogger.log("\nDocContent version = "+s.ver+" ;revision = "+s.rev+"\nDocInfo version = "+l.VERSION+" ;revision = "+l.REVISION+"\nDocInstance session ID = "+t.sid),ZWOfflineLogger.sendLog("OFFLINE_VERSION_MISMATCH"),r=!0)}catch(e){ZWOfflineLogger.log("Error occurred while adding ops collection info in log",e)}})}},E=function(e){var t=new Deferred,i=function(i){i.rid=e,t.reject(i)},r=n.getInstance(e);return r.then(function(n){var r=n.clearDocInstance();r.then(function(){ZWOfflineCommsWrapper.broadcastDocumentRemoveFromOffline(e,"RESOURCE_REMOVED_BY_USER"),t.resolve({status:OPERATION_STATUS.SUCCESS,rid:e})},i)},i),t.promise()},T=function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i],o=E(r);t.push(o)}return whenAlways(t)},O=function(e){var t=new Deferred,i=[];if(0!=e.length){for(var r=0,o=e.length;r<o;r++){var a=e[r],s=n.getInstance(a);i.push(s)}Deferred.when.apply(null,i).then(function(){for(var e=[],i=0,n=arguments.length;i<n;i++){var r=arguments[i],o=r.clearDocInstance();e.push(o)}whenAlways(e).done(function(){t.resolve()})},function(e){t.reject()})}else t.resolve();return t.promise()},m=function(e){var t=new Deferred,n=i.getInstance(e);return n.then(function(i){i.isEmpty()?t.resolve({status:OPERATION_STATUS.SUCCESS,isOpsEmpty:!0,rid:e}):t.reject({status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.OPS_PRESENT_DURING_REMOVE_SETUP,rid:e})},function(e){t.reject(e)}),t.promise()},I=function(){var e=new Deferred;return e.resolve(),e.promise()},D=function(){var e=new Deferred;return e.resolve(),e.promise()},R=function(e,t){var i={RID:e.RID,CREATOR:e.CREATOR,CREATOR_HTML:e.CREATOR_HTML,CREATOR_ZUID:e.CREATOR_ZUID,DOCUMENT_NAME:e.DOCUMENT_NAME,LASTMODIFIEDBY:e.LASTMODIFIEDBY,LASTMODIFIEDBY_HTML:e.LASTMODIFIEDBY_HTML,LAST_MODIFIED_TIME_LONG:e.LAST_MODIFIED_TIME_LONG,SERVICE_NAME:e.SERVICE_NAME,ROLE:t,editor_mode:1,docSyncStatus:OFFLINE_DOC_STATES.SYNCED,userOpted:!1};return i},S=function(e){var t={};return t.zuid=e.zuid,t.email=e.email||"",t.userData={color:"",cstatus:"0",fname:e.fname,fname_HTML:e.fname_HTML,fname_JS:e.fname_JS,uuids:""},ZWJSONUtils.clone(t)};return{cacheAndStoreTemplates:g,getWriterImageURLs:a,convertdataURItoBlob:u,handleVersionUpdate:p,cacheTemplateDocuments:h,storeTemplateDocuments:f,forceRemoveDocumentFromOffline:E,forceRemoveDocuments:T,isOfflineOpsEmptyInDoc:m,removeRidEntriesFromTables:O,cacheOfflineAppResources:I,removeOfflineAppResources:D,constructMeta:R,constructMetaUserDetails:S}}(ZWOfflineServerUtil,ZWOfflineDBUtil,ZWOfflineOpsCollection,ZWOfflineDocumentHandler),AsyncProcessHandler=function(){function e(){this.processes={}}return e.prototype.removeProcess=function(e){delete this.processes[e]},e.prototype.addProcess=function(e,t){this.processes[e]=t},e.prototype.abortProcess=function(e,t){var i=this.processes[e];i&&i.reject(t)},e.prototype.notify=function(e,t){var i=this.processes[e];i&&i.notify(t)},e.prototype.getProcessState=function(e){var t=this.processes[e];return t&&t.state()},e}();BatchAsyncOperationProcessor.prototype.startProcess=function(){return this.dfd=new Deferred,this.performBatchOperation(),this.dfd.promise()},BatchAsyncOperationProcessor.prototype.performBatchOperation=function(){this.itrIdx+this.batchSize>this.operationData.length&&(this.batchSize=this.operationData.length-this.itrIdx);for(var e=[],t=0;t<this.batchSize;t++,this.itrIdx++){var i=this.operationData[this.itrIdx],n=this.operationFn.call(this.operationContext,i);e.push(n)}var r=this;whenAlways(e).done(function(){Array.prototype.push.apply(r.responseList,arguments),r.itrIdx==r.operationData.length?r.dfd.resolve.apply(r.dfd,r.responseList):r.performBatchOperation()})},BatchAsyncOperationProcessor.prototype.destroy=function(){this.itrIdx=0,this.responseList=[],this.batchSize=0,this.operationFn=null,this.operationData=null,this.operationContext=null},function(e,t,i){"use strict";var n={},r=function(){return"serviceWorker"in navigator},o=function(){var e=new Deferred,t=navigator.serviceWorker.getRegistrations();return t.then(function(t){var i=[];t.forEach(function(e){i.push(e.unregister())}),whenAlways(i).done(function(){e.resolve()})}),e.promise()},a=function(e){var t=document.getElementById(e);return t||(t=document.createElement("iframe"),t.id=e,t.style.width="0px",t.style.height="0px",t.style.border="none",document.body.appendChild(t)),t},s=function(){var e=new Date;e.setTime(e.getTime()+18e5);var t="expires="+e.toGMTString();window.document.cookie="ZW_OFF_END=1; path=/;"+t},l=function(e){e=e||n;var t,r,o;for(t in e)r=i.getHostURL()+e[t],o=a(t),o.setAttribute("src",r)},d=function(){var t=new Deferred,i=e.fetchCacheURLs();return i.then(function(e){var i=e.originalResponse;r()?o().done(function(){t.resolve()}):(t.resolve(),s(),n=i.appCacheURLs,l(i.appCacheURLs))},function(e){t.reject(e),ZWOfflineLogger.log("Offline fetchCacheURL failed",e)}),t.promise()},c=function(){var t=function(e){var t,n,r=i.getHostURL(),o=new ZWConsole;o.enable();var a=[];for(n in e){t=e[n];var s=navigator.serviceWorker.register(r+t.url,{scope:r+t.scope});s.then(function(e){ZWOfflineLogger.log("Service Worker Registeration completed"),o.log("Service Worker Registeration completed"),o.disable()}).catch(function(e){ZWOfflineLogger.log("Registration failed:"+e),o.error("Registration failed:"+e),o.disable()}),a.push(s)}return Deferred.when.apply(null,a)};return function(){var i=new Deferred;if(isV8Engine)return i.resolve(),i.promise();var o=e.fetchCacheURLs();return o.then(function(e){var o=e.originalResponse;if(r()){var a=t(o.serviceWorkerURLs);a.then(function(){i.resolve()},function(){i.reject()})}else i.resolve(),n=o.appCacheURLs,l(o.appCacheURLs)},function(e){i.reject(e),ZWOfflineLogger.log("Offline fetchCacheURL failed",e)}),i.promise()}}();t.cacheOfflineAppResources=c,t.isServiceWorkerSupported=r,t.removeOfflineAppResources=d,t.convertBinToB64=function(e){return window.btoa(e)},t.convertBase64toBin=function(e){return window.atob(e)},t.packageForNetwork=function(e,t){var i=new FormData;t=t||{exclude:{}};for(var n in e)n in t.exclude||i.append(n,e[n]);return i.append(csrfParamName,getcsrf()),i},t.getBinaryObj=function(e){var t=new Blob([JSON.stringify(e)],{type:"text/plain"});return t},t.getFallbackImgSrc=function(){return window.imgCdnZWStaticPath+fingerPrintObj["images/common/OfflineImage.png"]},t.convertdataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return{imageFile:new Blob([n],{type:i}),type:i}},t.convertImageBytesToBinary=function(e){for(var t="",i=new Uint8Array(e),n=0,r=i.byteLength;n<r;n++)t+=String.fromCharCode(i[n]);return t}}(ZWOfflineServerUtil,ZWOfflineUtil,ZWNetworkUtils);var ZWOfflineCommsWrapper=function(e,t){"use strict";function i(e,i){ZWOfflineLogger.log("Current session is notifying other tabs with info: "+JSON.stringify(i)),void 0==i&&(i={}),t.broadcast(e,i),setTimeout(function(){e.indexOf("/Response")==-1&&i.queryId&&"pending"==O(i.queryId)&&("IsDocumentLocked"==e?(i.msgStr=e+"/Response",i.lockStatus=!1,D(i)):"IsSetupInProgress"==e&&D({msgStr:e+"/Response",setupStatus:!1,queryId:i.queryId}),t.freeUpChannel(e))},50)}var n=function(e,t){i("Url/Changed",{oldRid:e,newRid:t})},r=function(e){i("Document/Locked",{rid:e})},o=function(e){i("Document/Unlocked",{rid:e})},a=function(e,t){i("OfflineDocument/Removed",{rid:e,info:t})},s=function(e){return ZWOfflineLogger.log("Document is being checked for Lock in offline mode"),E("IsDocumentLocked",{rid:e})},l=function(){return E("IsSetupInProgress")},d=function(){i("OfflineSetup/PreconfigCompleted")},c=function(){i("OfflineSetup/InProgress")},u=function(){i("OfflineSetup/Completed")},g=function(){i("MetaCollection/Updated")},h=function(){i("OfflineSetup/Revoked")},f=function(){i("OfflineSetup/Reset")},p={},E=function(e,t){void 0==t&&(t={});var n=e+performance.now()+""+Math.floor(99999*Math.random());t.queryId=n;var r=T(n);return i(e,t),ZWOfflineLogger.log("Current session querying other tabs with message"+e),r},T=function(e){var t=new Deferred;return p[e]=t,p[e].promise()},O=function(e){var t=p[e];return t?t.state():null},m=function(e){var t=p[e];return delete p[e],t},I={"Url/Changed":function(e){OfflineImpl.handleUrlChanged(e.oldRid,e.newRid)},"Document/Locked":function(e){OfflineImpl.handleDocumentLocked(e.rid)},"Document/Unlocked":function(e){OfflineImpl.handleDocumentUnlocked(e.rid)},IsDocumentLocked:function(e){if("editor"==zwEnvironment.type&&e.rid==zwEnvironment.getCurrentRID()){var n=OfflineImpl.isOfflineOperationsAllowed();if(n){var r=e.msgStr+"/Response";t.freeUpChannel(e.msgStr),delete e.msgStr,e.lockStatus=n,i(r,e)}}},"IsDocumentLocked/Response":function(e){e.lockStatus?ZWOfflineLogger.log("Document is locked by another Session"):ZWOfflineLogger.log("Document is locked by current Session");var i=m(e.queryId);i&&(i.resolve({rid:e.rid,isActive:e.lockStatus}),t.freeUpChannel(e.msgStr))},IsSetupInProgress:function(e){var n=ZWOffline.isOfflineSetupInProgress();if(n){var r=e.msgStr+"/Response";t.freeUpChannel(e.msgStr),delete e.msgStr,e.setupStatus=n,i(r,e)}},"IsSetupInProgress/Response":function(e){var i=m(e.queryId);i&&(i.resolve(e.setupStatus),t.freeUpChannel(e.msgStr))},"OfflineDocument/Removed":function(e){OfflineImpl.handleOfflineDocumentRemoved(e.rid,e.info)},"OfflineSetup/PreconfigCompleted":function(e){OfflineImpl.handleOfflineSetupPreconfigCompleted()},"OfflineSetup/InProgress":function(e){},"OfflineSetup/Completed":function(e){OfflineImpl.handleOfflineSetupCompleted()},"MetaCollection/Updated":function(e){OfflineImpl.handleMetaCollectionUpdated()},"OfflineSetup/Reset":function(e){OfflineImpl.handleOfflineSetupReset()},"OfflineSetup/Revoked":function(e){OfflineImpl.handleOfflineSetupRevoked()}},D=function(e){try{I[e.msgStr](e)}catch(t){ZWOfflineLogger.log("COMMS ERROR function wasn't found. msgStr: "+e.msgStr,{ex:t.toString()})}};return t.listenTo(D),{notifyUrlChange:n,lockDocument:r,unlockDocument:o,isLocked:s,broadcastDocumentRemoveFromOffline:a,isSetupInProgress:l,broadcastOfflinePreconfigComplete:d,broadcastOfflineSetupProgress:c,broadcastOfflineSetupDone:u,broadcastMetaCollectionUpdated:g,broadcastOfflineSetupRevoked:h,broadcastOfflineSetupReset:f,getQueryDeferredStatus:O}}(OfflineImpl,CrossInstanceCommunicator),OfflineImpl=function(e,t){"use strict";function i(e,t){e==zwEnvironment.getCurrentRID()&&UIUtils.showMessagePopup(J.i18n("writer.common.VERSION_UPLOAD_RELOAD"),J.i18n("writer.offline.OFFLINE_OLDER_VERSION_TITLE"),"info",function(){zwEnvironment.loadDocument(t,!0)})}function n(e){e==zwEnvironment.getCurrentRID()}function r(e){var t=zwEnvironment.getCurrentRID();e===t&&(E()||(ZWOfflineLogger.log("Document in editable state in another tab is closed"),UIUtils.showMessagePopup(J.i18n("writer.offline.OFFLINE_EDITABLE_INSTANCE_CLOSED_IN_ANOTHER_TAB"),J.i18n("writer.trackchange.READ_ONLY_MODE"),"info",reload,!0)))}function o(e,t){var i=zwEnvironment.getCurrentRID();e==i&&E()&&ZWOfflineUIUtil.prompt(J.i18n("writer.offline.OFFLINE_ACCESS_REMOVED"),J.i18n("writer.offline.OFFLINE_ACCESS_REMOVED_FOR_DOC_MSG"),[J.i18n("writer.offline.GIVE_OFFLINE_ACCESS"),J.i18n("writer.common.GOT_IT")]).done(function(e){switch(e){case CONST.BUTTON_YES_CLICKED:pe(i);break;case CONST.BUTTON_NO_CLICKED:ge()}})}function a(){ZWOffline.setOfflinePreConfigurationStatus(!0)}function s(){ZWOfflineLogger.log("OfflineSetupDone state changed in another session");var e=zwEnvironment.getCurrentRID();if(T())isV8Engine||Notification.hide(),ZWOfflineUIUtil.prompt(J.i18n("writer.offline.OFFLINE_MODE_ENABLED"),J.i18n("writer.common.OFFLINESETUP_DONE_INANOTHERTAB"),[J.i18n("writer.common.GOT_IT")]).done(function(i){switch(i){case CONST.BUTTON_YES_CLICKED:ZWOffline.setOfflineSetupState(!0);var n=ZWOfflineMetaCollection.getInstance();n.then(function(i){ZWOffline.setMetaCollection(i);var n=ZWOfflineCommsWrapper.isLocked(e);n.then(function(i){if(i.isActive){p(!1);var n=t.getReadOnlyInstance(e);n.then(function(e){u=e,he()})}else p(!0),pe(e)})})}});else{var i={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.DOCUMENT_WITH_UNSUPPORTED_ROLE_BEING_OPENED};ZWOfflineLogger.log("Document opened with unsupported role",i)}}function l(){if(ZWOffline.isOfflineOperationsAllowed()){ZWOfflineLogger.log("MetaCollection updated in another tab");var e=ZWOffline.getMetaCollection();e.refresh()}}function d(){}function c(){p(!1),se(!1),u=null,F(),ZWOfflineDBUtil.closeDatabase(),ZWOfflineDBUtil.configureDB(),ZWOfflineUIUtil.prompt(J.i18n("writer.offline.OFFLINE_MODE_REMOVED"),J.i18n("writer.common.OFFLINESETUP_REMOVED_INANOTHERTAB"),[J.i18n("writer.common.GOT_IT")]).done(function(e){switch(e){case CONST.BUTTON_YES_CLICKED:h||editor.rebindEvents(),ZWOffline.setMetaCollection(null),ZWOffline.setOfflineSetupState(!1),ZWOffline.setOfflinePreConfigurationStatus(!1)}})}var u=null,g=!1,h=!1,f=function(){ZWOfflineLogger.log("Offline preprocess function start");var i=new e;p(!0);var n=zwEnvironment.getCurrentRID();try{ZWOfflineLogger.log("Loading sessionID = "+editorProps.userInfo.uuid),zwEnvironment.isLoadedFromCache()||ZWOfflineLogger.log("serverContent Version: "+docProps.content.ver+" ;revision:  "+docProps.content.rev+" contentLen: "+docProps.content.content.length)}catch(e){ZWOfflineLogger.log("Exception getting loading sessionID",e)}if(null===n)if(zwEnvironment.isLoadedFromCache()){ZWOfflineLogger.log("Unsupported URL for offline processing is loaded in offline mode. URL: "+zwEnvironment.getUrl());var r={status:OPERATION_STATUS.FAILURE,errorCode:OFFLINE_ERROR_CODES.UNSUPPORTED_URL_BEING_OPENED_OFFLINE};B.call(i,r)}else{ZWOfflineLogger.log("Unsupported URL for offline processing is loaded in online mode. URL: "+zwEnvironment.getUrl());var r={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.UNSUPPORTED_URL_BEING_OPENED};B.call(i,r)}else if("new"===n){ZWOfflineLogger.log("Offline new document creation started");var o=t.getNewDocument();o.then(function(e){ZWOfflineLogger.log("Offline new document created successfully"),ZWOfflineCommsWrapper.lockDocument(e.getRID()),zwEnvironment.loadDocument(e.getRID(),!0),V.call(i)},function(e){ZWOfflineLogger.log("Offline new document creation failed"),B.call(i,e)})}else{var a=ZWOfflineCommsWrapper.isLocked(n);a.then(function(e){var r,o=e.isActive;o?(p(!1),r=t.getReadOnlyInstance(n)):(p(!0),ZWOfflineCommsWrapper.lockDocument(n),r=t.getInstance(n)),r.then(function(e){ZWOfflineLogger.log("Offline document instance created with RID"),u=e;var t=ZWOffline.getMetaCollection(),r=t.getDocMetaList();if(r[n]){var a=u.getWholeDocObject();if(null===a)if(zwEnvironment.isLoadedFromCache()){var s={status:OPERATION_STATUS.FAILURE,errorCode:OFFLINE_ERROR_CODES.DOCUMENT_CHOSEN_FOR_OFFLINE_YET_TO_BE_CACHED_BEING_OPENED_OFFLINE};ZWOfflineLogger.log("Offline Mode - Document being opened is yet to be saved for offline use"),B.call(i,s)}else if(o)ZWOfflineLogger.log("Online Mode - Document being opened is yet to be saved for offline use"),V.call(i);else{ZWOfflineLogger.log("Document being opened is yet to be saved for offline use, hence saving them");var l=U(n);l.then(V.bind(i),B.bind(i))}else if(zwEnvironment.isLoadedFromCache()){ZWOfflineLogger.log("Document being loaded with offline content in offline mode"),docProps=docProps||{},docProps.info=a.docInfo,docProps.content=a.docContent;var d=r[n].ROLE,c=u.getSessionID();c&&!o||(c=Utils.randomString()),editorProps.userInfo.uuid=c,docProps.collabUsersDetails=H(),editorProps.userInfo.role=d,editorProps.permissionsInfo.appInfo=t.getAppSettings(),editorProps.permissionsInfo.permissions=D(1==o?"SHAREDREAD":d),V.call(i)}else if(o)V.call(i);else{var g=u.getOpsCollection();if(g.isEmpty()){ZWOfflineLogger.log("Document being loaded with online content");var l=U(n);l.then(V.bind(i),B.bind(i))}else{ZWOfflineLogger.log("Document being loaded with offline content in online mode");var c=u.getSessionID();editorProps.userInfo.uuid=c||Utils.randomString(),docProps.info=a.docInfo,docProps.content=a.docContent,V.call(i)}}}else if(ZWOfflineLogger.log("Document being opened is not selected for Offline use"),zwEnvironment.isLoadedFromCache()){ZWOfflineLogger.log("Document not opted for offline is opened in offline mode");var s={status:OPERATION_STATUS.FAILURE,errorCode:OFFLINE_ERROR_CODES.DOCUMENT_NOT_OPTED_FOR_OFFLINE_BEING_OPENED};B.call(i,s)}else if(ZWOfflineLogger.log("Document not opted for offline is opened in online mode"),o)ZWOfflineLogger.log("Document opened in locked mode."),V.call(i);else{var d=editorProps.userInfo.role;if(T()){ZWOfflineLogger.log("Caching unavailable document");var h=K(docProps.info,d),f=t.addDocMeta(n,h);f.then(function(){ZWOfflineLogger.log("Doc Meta Added for offline the document");var e=U(n);e.then(V.bind(i),B.bind(i))},B.bind(i))}else{var s={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.DOCUMENT_WITH_UNSUPPORTED_ROLE_BEING_OPENED};ZWOfflineLogger.log("Document opened with unsupported role"),B.call(i,s)}}},B.bind(i))},B.bind(i))}return ZWOfflineLogger.log("Offline preprocess function end"),i.promise()},p=function(e){g=e},E=function(){return g&&T()},T=function(){try{var e=editorProps.userInfo.role,t=editorProps.permissionsInfo.appInfo.NAME,i=docProps.info.is_direct_wd_document;return!(!i||"WRITER"!==t&&"teamdrive"!==t&&"MACAPP_WD"!=t&&"MACAPP_DOCS"!=t||"OWNER"!==e&&"COOWNER"!==e&&"SHAREDREAD"!==e&&"SHAREDREADCOMMENT"!==e&&"SHAREDREADWRITE"!==e&&"SHAREDREADFILL"!==e)}catch(e){return!1}},O=function(){!E()&&T()&&ZWOffline.isOfflinePreconfigurationDone()&&(ZWOffline.isOfflineSetupDone()||(isV8Engine||Notification.hide(),editor.rebindEvents()))},m=function(e){var t=e,i={},n=ZWOffline.isOfflineSetupDone();return i.message="writer.offline.NETWORK_ISSUE_NOTIFICATION",i.setTimer=!1,i.close=!1,i.type="info",i.btnText="writer.offline.WORK_OFFLINE",i.callback=function(){isV8Engine||Notification.hide();var e,i,r,o={container:".ui-wdialog",className:"ui-zw-alert-dialog-modify"},a=[];if(n)a=[J.i18n("writer.offline.GIVE_OFFLINE_ACCESS"),J.i18n("writer.offline.REJECT_DOC_OFFLINE_BTN_MSG")],e=J.i18n("writer.common.NOT_CONNECTED_TO_INTERNET"),i=J.i18n("writer.offline.TAKE_DOC_OFFLINE_NOTIFY_MSG_AFTER_SETUP"),r=CONST.SEVERITY_INFO;else{a=[J.i18n("writer.offline.TAKE_DOC_OFFLINE_BTN_MSG"),J.i18n("writer.offline.REJECT_DOC_OFFLINE_BTN_MSG")],e=J.i18n("writer.common.OFFLINE_HEADING_MESSAGE");var s="/writer/html/aboutoffline.html",l="<a href='"+s+"' rel='noreferrer' target='_blank'>";i=J.i18n("writer.offline.TAKE_DOC_OFFLINE_NOTIFY_MSG_BEFORE_SETUP",[l,"</a>"]),r=CONST.SEVERITY_WARNING}var d={isHTML:!0,isPrimaryBtn:!0,infoObj:o};ZWOfflineUIUtil.prompt(e,i,a,r,d).done(function(e){switch(e){case CONST.BUTTON_YES_CLICKED:var i=editor.doc.docInfo.RID,r=n?pe(i):ZWOffline.takeDocumentOfflineFromEditor(i);r.then(function(){ZWOfflineLogger.log("enable offline from editor succeeded"),re()},function(e){ZWOfflineLogger.log("enable offline from editor failed",e),UIUtils.showFreezeMessage(!0,"warning",t?t:J.i18n("common","UNABLE_TO_REACH"))});break;case CONST.BUTTON_NO_CLICKED:isV8Engine||Notification.show(m(t))}})},i},I=function(e){var t=e,i=function(){UIUtils.showFreezeMessage(!0,"warning",t?t:J.i18n("common","UNABLE_TO_REACH"))};if(ZWOffline.isOfflineSetupDone())if(T()){var n=editor.doc.docInfo.RID,r=ZWOffline.getMetaCollection();r.isAvailableOffline(n)?re():(editor.rebindEvents(ERROR_PERMISSION),isV8Engine||Notification.show(m(t)))}else i();else T()&&ZWOffline.isOfflinePreconfigurationDone()?(editor.rebindEvents(ERROR_PERMISSION),isV8Engine||Notification.show(m(t))):(ZWOfflineLogger.log("offline preconfiguration not done"),i())},D=function(e){var t=ZWOffline.getMetaCollection();return t.getRolesInfoFor(e).PERMISSIONS},R=function(){ZWOfflineLogger.log("Sync Session function start");var t=new e,i=ZWOffline.getMetaCollection(),n=i.getDocMetaList(),r=zwEnvironment.getCurrentRID();if(n[r].isNew===!0){ZWOfflineLogger.log("Sync new document from Editor");var o=u.syncDocument();o.then(function(e){ZWOfflineLogger.log("Sync new document from Editor succeeded"),zwEnvironment.loadDocument(e.newRID,!0),t.resolve({status:OPERATION_STATUS.SUCCESS})},function(e){ZWOfflineLogger.log("Sync new document from Editor failed"),t.reject(e)})}else{var a=editor.uuid;ZWOfflineLogger.log("performing OT with client session ID = "+a),S(r,a).then(function(){var e=v(r,a);e.then(function(){t.resolve()},function(e){ZWOfflineLogger.log("Error occured while registering session from Editor"),t.reject(e)})},function(e){ZWOfflineLogger.log("Error occured while performing OT"),t.reject(e)}),t.done(function(){u.getImageCollection().syncImages()})}return t.promise()},S=function(t,i){var n=new e,r=u.getOpsCollection();if(r.isEmpty())n.resolve();else{ZWOfflineLogger.log("Register session completed");var o=editor.doc.docInfo,a=new ZWOfflineSyncProtocol(t,i,o.VERSION,o.REVISION,o.VERSION_ID,ZWCollaboration),s=a.sync();s.then(function(e){ZWOfflineLogger.log("Sync Existing document in Editor completed"),n.resolve(e)},function(e){n.reject(e)})}return n.promise()},C=function(){PubSub.unsubscribe("WMS/ServerUp",C),MsgHandler.handleServerUp()},A=function(){WMSHandler.initWMS(),PubSub.subscribe("WMS/ServerUp",C)},v=function(t,i){var n=new e;if(isV8Engine)n.resolve();else if(WMSHandler.isWMSRegistered()===!1){ZWOfflineLogger.log("WMS to be registered for the first time");var r=ZWOfflineServerUtil.fetchSessionId(t,i);r.then(function(e){var t=e.originalResponse;editor.doc.setUserData(t.collabUsersDetails),X(t.uuid),PubSub.publish("Document/UserDataFetched"),DomUtil.setEditorHht(),A(),n.resolve(e)},function(e){var t={status:e.status,errorCode:OFFLINE_ERROR_CODES.REGISTER_SESSION_FAILED,reason:e.reason};n.reject(t)})}else{ZWOfflineLogger.log("WMS already registered");try{MsgHandler.handleServerUp()}catch(e){ZWOfflineLogger.log("Exception occured during joinCollaboration")}n.resolve({status:OPERATION_STATUS.SUCCESS})}return n.promise()},_=function(){if(!isV8Engine||"undefined"==typeof MobileController||MobileController.isMobileAuthed()){var e=ZWOffline.updateResources();e.then(function(){R().then(function(){ZWOfflineLogger.log("Network up"),editor.isOffline()&&(editor.setOffline(!1),ae()),ZWCollaboration.LASTREQUEST_TIMESTAMP=(new Date).getTime(),PubSub.publish("System/NetworkUp")},function(e){e.status===OPERATION_STATUS.ERROR?(ZWOfflineLogger.log("Error occured during Sync existing document from Editor, Reason: "+e.reason),"LOGGED_OUT"===e.reason?(PubSub.publish("User/SignedOut"),clearTimeout(ZWCollaboration.slowRespTimer)):ZWNetworkUtils.retryNetwork()):e.status===OPERATION_STATUS.FAILED&&(ZWOfflineLogger.log("Sync existing document from Editor failed, Reason: "+e.reason),ZWOfflineLogger.sendLog(),Q(e))})},function(e){ZWOfflineLogger.log("Error occured during Sync existing document from Editor, Reason: "+e.reason),"LOGGED_OUT"===e.reason?(PubSub.publish("User/SignedOut"),clearTimeout(ZWCollaboration.slowRespTimer)):ZWNetworkUtils.retryNetwork()})}},P=function(){var e=ZWCollaboration.msgQueue.getStringifiedQueue(),t=editor.doc.docInfo;u.updateOfflineOps(e,t.VERSION,t.REVISION,t.VERSION_ID)},N=function(){var e=editor.doc.docInfo;u.updateAcknowledgement(e.VERSION,e.REVISION,e.VERSION_ID),ZWOfflineUtil.handleVersionUpdate(e.RID)},b=function(){u.addAckEdit()},L=function(e,t,i,n){u.addCollaboratorMutation(e.toString(),t,i,n)},w=function(){if(ZWOffline.isOfflineSetupDone()){if(T()&&!editor.doc.docInfo.CHECKEDOUT)if(zwEnvironment.isLoadedFromCache()&&(isV8Engine||(document.title=editor.doc.docInfo.DOCUMENT_NAME)),E())if(u.opsCollection.isEmpty())zwEnvironment.isLoadedFromCache()?(re(),ZWNetworkUtils.retryNetwork()):(ZWOffline.updateResources().then(ZWOfflineUtil.cacheAndStoreTemplates),A());else{var e=u.getOfflineOps();ZWCollaboration.msgQueue.msgQueueInitialize(e),zwEnvironment.isLoadedFromCache()?re():editor.setOffline(!0),ZWNetworkUtils.retryNetwork()}else zwEnvironment.isLoadedFromCache()&&se(!0)}else ZWOffline.handleOfflineSetupPreProcess()},y=function(){editor.isOffline()?(PubSub.unsubscribe("Document/ContentAdded",k),PubSub.unsubscribe("Document/ContentDeleted",G)):(PubSub.subscribe("Document/ContentAdded",k),PubSub.subscribe("Document/ContentDeleted",G))},M=function(){if(PubSub.subscribe("Document/ComponentInitialized",ie),PubSub.subscribe("BeforeEditorReady",w),PubSub.subscribe("System/NetworkUp",O),E()){if(!u)return;PubSub.subscribe(["MessageQueue/EditAdded","MessageQueue/EditsTransformed"],P),PubSub.subscribe("MessageQueue/AckReceived",N),PubSub.subscribe("MessageQueue/AckEditSent",b),PubSub.subscribe("CollaboratorMutation/Added",L),PubSub.subscribe("NetworkState/Changed",y)}},F=function(){PubSub.unsubscribe("Document/ComponentInitialized",ie),PubSub.unsubscribe(["MessageQueue/EditAdded","MessageQueue/EditsTransformed"],P),PubSub.unsubscribe("MessageQueue/AckReceived",N),PubSub.unsubscribe("MessageQueue/AckEditSent",b),PubSub.unsubscribe("CollaboratorMutation/Added",L),PubSub.unsubscribe("BeforeEditorReady",w),PubSub.unsubscribe("NetworkState/Changed",y),PubSub.unsubscribe("Document/ContentAdded",k),PubSub.unsubscribe("Document/ContentDeleted",G),PubSub.unsubscribe("System/NetworkUp",O)},U=function(t){var i=new e;ZWOfflineLogger.log("Saving document content during with server response");var n=function(e){i.reject(e)},r={docObject:{docContent:docProps.content,docInfo:docProps.info},rid:t},o=u.updateDocObject(r);return o.then(function(){var e=u.imageCollection.syncImages();e.then(function(){var e=ZWOffline.getMetaCollection(),r=e.updateDocMeta(t,{ROLE:editorProps.userInfo.role});r.then(function(e){i.resolve(e)},n)},n)},n),i.promise()},V=function(){ZWOfflineLogger.log("Pre process completed");try{ZWOfflineLogger.log("after preprocess success: editorprops sessionID = "+editorProps.userInfo.uuid)}catch(e){ZWOfflineLogger.log("Exception getting sessionID",e)}this.resolve()},B=function(e){ZWOfflineLogger.log("Pre process failed");try{ZWOfflineLogger.log("after preprocess fail: editorprops sessionID = "+editorProps.userInfo.uuid)}catch(e){ZWOfflineLogger.log("Exception getting sessionID",e)}this.reject(e)},x=function(e){},W=function(){var e={};e.zuid=editorProps.userInfo.zuid,e.email=editorProps.userInfo.email||"";var t=editor.doc.getUserData()[editor.zuid];return e.userData={color:t.color,cstatus:t.cstatus,fname:t.fname,fname_HTML:t.fname_HTML,fname_JS:t.fname_JS,uuids:t.uuids},ZWJSONUtils.clone(e)},H=function(){var e=ZWOffline.getMetaCollection(),t=e.getUserDetails(),i=t.userData||{};i.uuids=editorProps.userInfo.uuid,i.editor_mode=EDITOR_MODES.COMPOSE;var n={};return n[t.zuid]=i,n},G=function(e,t,i){try{var n=JSON.stringify(editor.doc.getCharAt(e))===JSON.stringify(UNICODE.IMAGE),r=i.indexOf(UNICODE.IMAGE)>=0;if((n||r)&&!editor.doc.getFormats()[e].shapeData){var o=n?e:i.indexOf(UNICODE.IMAGE)+1,a=editor.doc.getFormats()[o].src;if(0==a.indexOf("image.do?imgurl=")){a=a.substr(a.indexOf("=")+1);var s=u.getImageCollection(),l=s.removeImage(a);l.then(function(e){},function(){})}}}catch(e){ZWOfflineLogger.log("Exception occured at deleteOnlineImage:"+e)}},k=function(e,t,i,n){if(n&&"image"==n.type&&!n.shapeData){var r=n.src;if(r&&0==r.indexOf("image.do?imgurl=")){var o=r.substring(r.indexOf("=")+1);if(o){var a=u.getImageCollection(),s=a.addOnlineImage(o);s.then(function(e){ZWOfflineLogger.log("Successfully Stored Online image")},function(){ZWOfflineLogger.log("Failed to store online image in DB")})}}}},Y=function(){var t=new e,i=function(e){t.reject()},n=document.createElement("input");return n.setAttribute("type","file"),n.setAttribute("accept","image/jpeg,image/png,image/jpg,image/bmp,image/gif"),n.addEventListener("change",function(e,r){var o=n.files[0];if(Z(o)){var a=ImageHandler.readImageBytes(o);a.then(function(e){var n=ImageHandler.getImageObjForUpload(e,editor.uuid),r=u.getImageCollection(),o=r.addOfflineImage(n);o.then(function(){var r=ImageHandler.getImageDimension(e);r.then(function(e){e.URL=Macros.getImageSrc(n.imageURLValue);var i={DATA:[e]};t.resolve(i)},i)},i)},i)}else t.reject(J.i18n("writer.offline.UNSUPPORTED_IMAGE_INSERTION_IN_OFFLINE"))}),n.click(),t.promise()},Z=function(e){for(var t=e.type,i=!1,n=["image/jpeg","image/png","image/jpg","image/bmp","image/gif"],r=0,o=n.length;r<o;r++)if(t==n[r]){i=!0;break}return i},z=function(e){var t=ImageHandler.getImageObjForUpload(e,editor.uuid),i=Macros.getImageSrc(t.imageURLValue),n=u.getImageCollection(),r=n.addOfflineImage(t);return r.then(function(){ZWOfflineLogger.log("Sucessfully stored copy pasted image in DB")},function(){ZWOfflineLogger.log("Failed to store Copy pasted image in DB")}),i},j=function(t){var i=new e,n=function(){i.reject(null)},r=ImageHandler.getImageObjForUpload(t,editor.uuid),o=u.getImageCollection(),a=o.addOfflineImage(r);return a.then(function(){var e=ImageHandler.getImageDimension(t);e.then(function(e){e.URL=Macros.getImageSrc(r.imageURLValue),i.resolve(e)},n)},n),i.promise()},X=function(e){var t={};t.start=editor.doc.getSelection().getStart(),t.end=editor.doc.getSelection().getEnd(),t.uuid=editor.uuid,editor.uuid=e,DomUtil.removeCursorNode(t.uuid,"start"),DomUtil.removeCursorNode(t.uuid,"end"),delete editor.doc.domCursor[t.uuid],editor.doc.createDomCursor(editor.uuid,editor.zuid),editor.doc.createSelection(editor.uuid);var i=editor.doc.getSelection(),n=editor.doc.createRange(t.start,t.end);i.removeAllRanges().addRange(n)},K=function(e,t){var i={CREATOR:e.CREATOR,CREATOR_HTML:e.CREATOR_HTML,CREATOR_ZUID:e.CREATOR_ZUID,DOCUMENT_NAME:e.DOCUMENT_NAME,LASTMODIFIEDBY:e.LASTMODIFIEDBY,LASTMODIFIEDBY_HTML:e.LASTMODIFIEDBY_HTML,LAST_MODIFIED_TIME_LONG:e.LAST_MODIFIED_TIME_LONG,SERVICE_NAME:e.SERVICE_NAME,RID:e.RID,ROLE:t,editor_mode:1,docSyncStatus:OFFLINE_DOC_STATES.SYNCED,userOpted:!1};return i},Q=function(e,i){var n=function(){var e=ZWOfflineUIUtil.prompt(J.i18n("writer.error.OOPS"),J.i18n("writer.offline.OFFLINE_LOOP_ERROR"),[J.i18n("writer.common.SEND_ERROR_REPORT"),J.i18n("writer.common.DONT_SEND")]);e.done(function(e){e==CONST.BUTTON_1_CLICKED&&ZWOfflineLogger.sendLog()})},r=function(){ZWOfflineLogger.sendLog()},o=J.i18n("writer.offline.SYNC_ERROR_MSG"),a=J.i18n("writer.offline.SYNC_ERROR_TITLE"),s=e&&e.errorCode,l=[J.i18n("writer.offline.SAVE_AS_NEW_DOC"),J.i18n("writer.offline.CONTINUE_WITHOUT_SAVING")];if(s)if(s==OFFLINE_ERROR_CODES.DOCUMENT_MIGRATED_IN_SERVER||s==OFFLINE_ERROR_CODES.DOCUMENT_MIGRATED_OR_OWNER_CHANGED_IN_SERVER){var d=ZWOffline.getErrorInfo(s);o=d.description,a=d.title,l=[J.i18n("writer.offline.SAVE_AS_NEW_RECOMMENDED"),J.i18n("writer.common.DISCARD_CHANGES")]}else o=o+" ("+J.i18n("writer.offline.ERROR_CODE",[s.toLowerCase()])+")";ZWOfflineUIUtil.prompt(a,o,l).done(function(e){switch(e){case CONST.BUTTON_YES_CLICKED:ZWOfflineLogger.log("user opted for save as new");var o=t.saveAsNew(u);o.then(function(e){var t=e.syncDocument();t.then(function(e){zwEnvironment.loadDocument(e.newRID),i?zwEnvironment.loadDocument(e.oldRID,!0):zwEnvironment.loadDashboard(!0)},n)},n);break;case CONST.BUTTON_NO_CLICKED:ZWOfflineLogger.log("user opted not to save");var a=u.getRID(),s=u.clearDocInstance();s.then(function(){zwEnvironment.loadDocument(a,!0)},r)}})},q=function(){var t=new e;try{u.sendExceptionData("OFFLINE_SAVE_FAILURE"),editor.rebindEvents(ERROR_PERMISSION);var i=u.clearDocInstance();i.always(function(){p(!1),u=null,F(),ZWOfflineDBUtil.closeDatabase(),ZWOfflineDBUtil.configureDB().then(function(){editor.rebindEvents(),t.resolve()})})}catch(e){t.resolve()}return t.promise()},$=function(e){try{var t,i="";if(e.length>0)if(e.indexOf("imgurl=")>-1){t=e.substring(e.indexOf("=")+1);var n=u.getImageCollection();i=n.getImages()[t]?n.getImages()[t]:n.getOfflineImages()[t]?n.getOfflineImages()[t].bytes:ZWOfflineUtil.getFallbackImgSrc()}else i=ZWOfflineUtil.getFallbackImgSrc()}catch(e){i=ZWOfflineUtil.getFallbackImgSrc()}return i},ee=function(){return editorProps.userInfo.zuid},te=function(){var e=editor.doc.getRole(),t=ZWOffline.getMetaCollection(),i=t.getRolesInfoFor(e),n=i.EXCLUDEIDLIST;if(void 0!==n&&null!==n)for(var r=0;r<n.length;r++)J("#"+n[r].trim()).remove();var o=i.EXCLUDE_PERMISSIONS;if(void 0!==o&&null!==o)for(var r=0;r<o.length;r++)J('[data-fn="'+o[r]+'"]').remove();if(editor.getRole().permissions.can("document.edit")){var a=document.querySelector("[data-fragid='sharemode-topband']");a&&a.remove()}},ie=function(){editor.isOffline()&&(te(),re())},ne=function(){if(ZWOffline.isOfflineOperationsAllowed()){var e=zwEnvironment.getCurrentRID();ZWOfflineCommsWrapper.unlockDocument(e),ZWOfflineDBUtil.closeDatabase()}},re=function(){editor.setOffline(!0),de(),ZWOffline.isOfflineOperationsAllowed()?oe():se(!0)},oe=function(){UIUtils.showOfflineBanner(),ce(),editor.rebindEvents()},ae=function(){UIUtils.hideBanner(),ue(),editor.rebindEvents()},se=function(e){e&&(h=!0,UIUtils.showOfflineReadOnlyBanner());try{var t=ZWOffline.getMetaCollection(),i=t.getRolesInfoFor("SHAREDREAD");editor.rebindEvents(i.PERMISSIONS),editor.removeDOMCursor()}catch(e){ZWOfflineLogger.log("Exception occured when switching to readOnly")}},le=function(e){e.isLoadedFromCache=zwEnvironment.isLoadedFromCache(),editor&&"function"==typeof editor.isOffline&&(e.isCurrentSessionOffline=editor.isOffline()),e.rid=zwEnvironment.getCurrentRID()},de=function(){for(var e in editor.doc.domCursor)e!==editor.uuid&&(DomUtil.removeCursorNode(e,"start"),DomUtil.removeCursorNode(e,"end"))},ce=function(){PubSub.publish("UI/OfflineMode",!0)},ue=function(){PubSub.publish("UI/OfflineMode",!1)},ge=function(){u.clearDocInstance().then(function(){p(!1),se(!1),u=null,F(),ZWOfflineDBUtil.closeDatabase(),ZWOfflineDBUtil.configureDB().then(function(){editor.rebindEvents()})})},he=function(e){if(e&&(e.status==OPERATION_STATUS.ERROR||e.status==OPERATION_STATUS.FAILURE)){var t=e.errorCode?"OFFLINE_ERROR_"+e.errorCode:"OFFLINE_PREPROCESS_ERROR";switch(ZWOfflineLogger.sendLog(t),e.errorCode){case OFFLINE_ERROR_CODES.UNSUPPORTED_URL_BEING_OPENED_OFFLINE:case OFFLINE_ERROR_CODES.DOCUMENT_NOT_OPTED_FOR_OFFLINE_BEING_OPENED:case OFFLINE_ERROR_CODES.DOCUMENT_CHOSEN_FOR_OFFLINE_YET_TO_BE_CACHED_BEING_OPENED_OFFLINE:return void ZWOfflineUIUtil.showNotFoundContent();case OFFLINE_ERROR_CODES.META_FETCH_FROM_DB_FAILED:setTimeout(performRemoveOfflineSetup,2e3)}}M()},fe=function(){var e={};for(var t in editor.doc.docInfo)e[t]=editor.doc.docInfo[t];return e},pe=function(i){var n=new e;editor.rebindEvents(ERROR_PERMISSION),UIUtils.showLoadingMsg(J.i18n("writer.offline.SETTING_UP_FOR_OFFLINE"));var r=function(e){e.rid=i,ZWOfflineLogger.log("Making Document available offline failed. ",e),n.reject(e)};p(!0);var o=ZWOffline.getMetaCollection(),a=[],s=[],l=editor.doc.model.getDocument(),d=ZWCollaboration.msgQueue.getStringifiedQueue();if(null!==d.ackPendingEdit||0!==d.pendingEdits.length){null!==d.ackPendingEdit&&a.push(d.ackPendingEdit.op);for(var c=0,g=d.pendingEdits.length;c<g;c++)a.push(d.pendingEdits[c].op);for(c=0,g=a.length;c<g;c++)s.push(editor.doc.snapShotManager.getReverseOp(DocOpBuilder.build(JSON.parse(a[c]))));var h=new Model(l.content,l.styles,l.defaults,l.locks,null,l.ranges);h.init();for(var g=s.length,c=g-1;c>=0;c--)h.applyOps(DocOpBuilder.build(s[c]));l=h.getDocument()}var f=editor.doc.getRole(),E=K(editor.doc.docInfo,f),T=o.addDocMeta(i,E);return T.then(function(){var e=fe(),a=Ee(l,e,docProps.content.mig_ver,editor.uuid),s={rid:i,docObject:a},c=t.getInstance(i);c.then(function(e){u=e,ZWOfflineCommsWrapper.lockDocument(i);var t=u.updateDocObject(s);t.then(function(){var e=u.getVersionObj();u.updateOfflineOps(d,e.version,e.revision,e.versionId),he();var t=o.updateGeneralInfo({offlineSetupState:OFFLINE_SETUP_STATE.COMPLETED,lastSyncTime:Date.now()});t.then(function(){editor.rebindEvents(),ZWOfflineCommsWrapper.lockDocument(i),UIUtils.hideLoadingMsg(),n.resolve({status:OPERATION_STATUS.SUCCESS,rid:i})},r)},r)},r)},r),n.promise()},Ee=function(e,t,i,n){var r={docContent:{content:e.content,defaults:e.defaults,locks:e.locks,mig_ver:i,rev:t.REVISION,styles:e.styles,ver:t.VERSION},docInfo:t,rid:t.RID,sid:n};return r},Te=function(e,t){ZWNetworkUtils.checkNetwork(e,t)},Oe=function(){return u};return{performPreProcess:f,handleNetworkUp:_,handleNetworkDown:re,updateMetaCollection:x,getUserDetails:W,insertImageOffline:Y,getImageSrc:$,getUserZuid:ee,UnloadHandler:ne,storeImageInOfflineDB:z,isOfflineOperationsAllowed:E,isOfflineSupported:T,handlePreprocessEnd:he,disableOnlineFeatures:ce,enableOnlineFeatures:ue,fillAdditionalInfo:le,handleSaveFailure:q,takeDocumentOfflineFromEditor:pe,handleNetworkError:I,checkNetwork:Te,handleSaveAsNew:Q,handleUrlChanged:i,handleDocumentLocked:n,handleDocumentUnlocked:r,handleOfflineDocumentRemoved:o,handleOfflineSetupPreconfigCompleted:a,handleOfflineSetupCompleted:s,handleMetaCollectionUpdated:l,handleOfflineSetupReset:d,handleOfflineSetupRevoked:c,processAndStoreImageURI:j,getCurrentDocInstance:Oe}}(Deferred,ZWOfflineDocumentHandler),ZWOffline=function(e,t,i,n,r){"use strict";var o=!1,a=!1,s=!1,l=!1,d="",c=!1,u=null,g=!1,h=new n,f=function(){var n=new Deferred;if(ZWOfflineLogger.log("Offline init function start"),zwEnvironment.platform.isSupportedPlatform()){var r=ZWOfflineCommsWrapper.isSetupInProgress();r.then(function(r){if(r)O.call(n);else{var s=t.doesOfflineDBExist();s.then(function(){ZWOfflineLogger.log("Offline DB exists");var r=t.configureDB();r.then(function(){ZWOfflineLogger.log("Configuring Offline DB");var t=i.getInstance();t.then(function(t){if(t.isOfflineSetupCorrupted()){l=!0,ZWOfflineLogger.log("Previous offline setup incomplete");var i={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.PREVIOUS_OFFLINE_SETUP_INCOMPLETE};I.call(n,i)}else if(t.isOfflineSetupCompleted()){ZWOfflineLogger.log("Offline metaCollection Fetched");var r=t.getUserZuid();if(zwEnvironment.isLoadedFromCache()&&p(t),C(r)){o=!0,te(!0),L(t);var s=t.getOfflineSetupUserEmail();s||(s=editorProps.userInfo.email,t.updateUserDetails({email:s})),d=s;var c=e.performPreProcess();c.then(O.bind(n),I.bind(n))}else a=!0,ZWOfflineLogger.log("Another user has setup offline"),d=t.getOfflineSetupUserEmail(),d||(d=t.getOfflineSetupUserName()),O.call(n)}else te(!0),O.call(n)},I.bind(n))},I.bind(n))},O.bind(n))}},I.bind(n))}else ZWOfflineLogger.log("Browser not supported for offline"),O.call(n);return ZWOfflineLogger.log("Offline init function end"),n.promise()},p=function(e){var t=e.getUserInfo();w_usersettings=t.settings,editorProps.userInfo.zuid=t.zuid,editorProps.userInfo.fullName=t.fullName,editorProps.userInfo.fname_JS=t.fname_JS,editorProps.userInfo.language=t.language,editorProps.userInfo.email=Utils.hexToString(t.email),editorProps.userInfo.settings=t.settings,editorProps.userInfo.country=t.country,editorProps.userInfo.zoid=t.zoid,editorProps.orgInfo=e.getOrgInfo(),editorProps.uiText=e.getEditorProperty().uiText},E=function(){var e=new Deferred;if(zwEnvironment.platform.isSupportedPlatform())if(P())e.resolve();else{var n=function(t){Y(),ZWOfflineLogger.log("pre configure db failed",t),e.reject(t)},r=t.configureDB();r.then(function(){var t=i.getInstance();t.then(function(t){var i=t.updateGeneralInfo({offlineSetupState:OFFLINE_SETUP_STATE.NEW});i.then(function(){var i=ZWOfflineUtil.cacheOfflineAppResources();i.then(function(){var i=t.syncMetaResources();i.then(function(){var i=t.updateGeneralInfo({offlineSetupState:OFFLINE_SETUP_STATE.PENDING,buildLabel:zwEnvironment.buildLabel});i.then(function(){te(!0),ZWOfflineCommsWrapper.broadcastOfflinePreconfigComplete(),ZWOfflineLogger.log("pre configure db successful"),e.resolve()},n)},n)},n)},n)},n)},n)}else ZWOfflineLogger.log("Browser not supported for offline"),e.reject();return e.promise()},T=function(e){o=e},O=function(){ZWOfflineLogger.log("Offline preprocess completed"),this.resolve()},m=function(){return d},I=function(e){T(!1),u=null,s=!0,ZWOfflineLogger.log("Offline preprocess failed",e),this.resolve(e)},D=function(){return a},R=function(){return s},S=function(){return l},C=function(t){var i=e.getUserZuid();return t===i},A=function(){return t.isDBOperationsPending()},v=function(){return o},_=function(){return v()&&e.isOfflineOperationsAllowed()},P=function(){return g},N=function(){var t={};return t.isOfflineSetupDone=v(),t.isOfflineOperationsAllowed=_(),t.isOfflinePreProcessFailed=R(),t.isOfflineSetupDoneByAnotherUser=D(),t.isPreviousOfflineSetupIncomplete=S(),e.fillAdditionalInfo(t),t},b=function(){return u},L=function(t){u=t,e.updateMetaCollection(u)},w=function(){var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.USER_STOPPED_OFFLINE_SETUP};h.abortProcess("SETUP",e)},y=function(){ZWOfflineCommsWrapper.broadcastOfflineSetupProgress(),c=!0},M=function(){ZWOfflineCommsWrapper.broadcastOfflineSetupReset(),c=!1},F=function(){return c},U=function(){var i=new Deferred;h.addProcess("SETUP",i),y();var n=function(e){M(),ZWOfflineLogger.log("Error occurred. Error Code: "+e.errorCode),e.errorCode!==OFFLINE_ERROR_CODES.ALREADY_OFFLINE_SETUP_BY_OTHER_USER&&Y(),h.abortProcess("SETUP",e),h.removeProcess("SETUP")},r=function(){T(!0),M(),ZWOfflineCommsWrapper.broadcastOfflineSetupDone(),i.resolve(),h.removeProcess("SETUP")},o=function(){E().then(function(){e.checkNetwork(function(){V().then(r,n)},function(){ee().then(r,n)})},n)},a=t.doesOfflineDBExist();return a.then(function(){if(D()){var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.ALREADY_OFFLINE_SETUP_BY_OTHER_USER};n.call(null,e)}else{var t,i=J.i18n("writer.offline.INCOMPLETE_PREVIOUS_SETUP",[J.i18n("writer.common.WRITER")]);if(S()){t=OFFLINE_ERROR_CODES.PREVIOUS_OFFLINE_SETUP_INCOMPLETE,i=i+" ("+J.i18n("writer.offline.ERROR_CODE",[t.toLowerCase()])+")";var e={status:OPERATION_STATUS.ERROR,errorCode:t},r=ZWOfflineUIUtil.prompt(J.i18n("writer.error.UH_OH"),i);r.done(function(t){switch(t){case CONST.BUTTON_YES_CLICKED:ZWOfflineLogger.log("User Opted to proceed setup Offline",e),Y().then(o,n);default:n(e)}})}else o()}},o),i.promise()},V=function(){var t=new Deferred,n=function(e){t.reject(e)},r=function(){t.resolve()},o=i.getInstance();return o.then(function(t){if("rejected"===h.getProcessState("SETUP")){var i={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.USER_STOPPED_OFFLINE_SETUP};n(i)}else{L(t);var o=u.prepareForSetup(e.getUserDetails());o.then(function(){if("rejected"===h.getProcessState("SETUP")){var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.USER_STOPPED_OFFLINE_SETUP};n(e)}else{var t=ZWOfflineUtil.cacheAndStoreTemplates();t.then(function(){if("rejected"===h.getProcessState("SETUP")){var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.USER_STOPPED_OFFLINE_SETUP};n(e)}else{var t=x();t.then(function(e){if("rejected"===h.getProcessState("SETUP")){var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.USER_STOPPED_OFFLINE_SETUP};n(t)}else{var i=B(e);i.then(function(){if("rejected"===h.getProcessState("SETUP")){var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.USER_STOPPED_OFFLINE_SETUP};n(t)}else{var i=q(ZWOffline.getMetaCollection());i.then(function(){if("rejected"===h.getProcessState("SETUP")){var t={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.USER_STOPPED_OFFLINE_SETUP};n(t)}else{var i=ZWOfflineSyncProcess.syncDocumentsDuringSetup(e);i.then(function(){if("rejected"===h.getProcessState("SETUP")){var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.USER_STOPPED_OFFLINE_SETUP};n(e)}else{var t=u.updateGeneralInfo({offlineSetupState:OFFLINE_SETUP_STATE.COMPLETED});t.then(function(){if("rejected"===h.getProcessState("SETUP")){var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.USER_STOPPED_OFFLINE_SETUP};n(e)}else r()},n)}},n)}},n)}},n)}},n)}},n)}},n)}},n),t.promise()},B=function(e){for(var t=new Deferred,i=[],n=0,r=e.length;n<r;n++)e[n].lastSyncDate=0,e[n].docSyncStatus=OFFLINE_DOC_STATES.PENDING,i[n]=u.addDocMeta(e[n].RID,e[n]);var o=Deferred.when.apply(null,i);return o.then(function(){t.resolve()},function(){var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.META_STORE_TO_DB_FAILED,reason:"Adding metadata to DB failed"};t.reject(e)}),t.promise()},x=function(){var e=new Deferred;if(isV8Engine)return e.resolve([]),e.promise();var t=u.getLastSyncTime(),i=ZWOfflineServerUtil.fetchDocMetaList(t);return i.then(function(t){var i=t.originalResponse,n={lastSyncTime:i.SYNCTIME},r=u.updateGeneralInfo(n);r.then(function(){var t=i.DOCUMENTS;e.resolve(t)},function(t){e.reject(t)})},function(t){var i={status:t.status,errorCode:OFFLINE_ERROR_CODES.META_FETCH_FROM_SERVER_FAILED,reason:t.reason};e.reject(i)}),e.promise()},W=function(){var e=new Deferred,t=function(t){e.reject(t)},i=ZWOfflineSyncProcess.syncOfflineModifiedDocument();return i.then(function(){k().then(e.resolve.bind(e),function(i){if(i.errorCode===OFFLINE_ERROR_CODES.OPS_PRESENT_DURING_REMOVE_SETUP){var n=J.i18n("writer.common.OFFLINE_PENDINGEDITS_WARNINGMSG");i.errorCode&&(n=n+" ("+J.i18n("writer.offline.ERROR_CODE",[i.errorCode.toLowerCase()])+")");var r=[J.i18n("writer.common.CANCEL"),J.i18n("writer.offline.REPORT_ERROR"),J.i18n("writer.common.PROCEED")],o=ZWOfflineUIUtil.prompt(J.i18n("writer.error.UH_OH"),n,r);o.done(function(n){n==CONST.BUTTON_3_CLICKED?e.resolve():n==CONST.BUTTON_2_CLICKED?(ZWOfflineLogger.log("Ops present while removing Offline setup"),ZWOfflineLogger.sendLog("USER_REPORTED_OFFLINE_OPS_PRESENT_ON_REMOVE_SETUP"),t(i)):t(i)})}else t(i)})}),e.promise()},H=function(){var e=new Deferred,t=function(t){e.reject(t)},i=function(){PubSub.publish("Offline/Removed"),e.resolve()};return Y().then(function(){E().then(i,t)},t),e.promise()},G=function(){var e=new Deferred,t=function(t){e.reject(t)},i=W();return i.then(function(){H().then(e.resolve.bind(e),t)},t),e.promise()},k=function(){for(var e=new Deferred,t=u.getSyncDocumentList(),i=[],n=0,r=t.length;n<r;n++){var o=ZWOfflineUtil.isOfflineOpsEmptyInDoc(t[n]);i.push(o)}var a=Deferred.when.apply(null,i);return a.then(function(t){e.resolve()},function(t){e.reject(t[0])}),e.promise()},Y=function(){var e=new Deferred;ZWOfflineCommsWrapper.broadcastOfflineSetupRevoked();var i=t.dropDatabase();return i.then(function(){o=!1,u=null,te(!1),ZWOfflineSyncProcess.resetSyncMap(),ZWOfflineUtil.removeOfflineAppResources().done(function(){e.resolve()})},function(t){e.reject(t)}),e.promise()},Z=function(e){return r.takeDocumentOffline(e)},z=function(e){var t=new Deferred,i=function(i){i.rid=e,t.reject(i)},n=function(){ZWOfflineLogger.log("Document removed from Offline DB by user RID: "+e),ZWOfflineLogger.sendLog("USER_REMOVED_DOCUMENT"),t.resolve({status:OPERATION_STATUS.SUCCESS,rid:e}),ZWOfflineCommsWrapper.broadcastDocumentRemoveFromOffline(e,"RESOURCE_REMOVED_BY_USER"),ZWOfflineSyncProcess.removeSyncLock(e)},o=r.getInstance(e);return o.then(function(t){var r=u.getDocMeta(t.getRID());if(r.isNew||t.opsCollection.isEmpty()||isV8Engine&&"undefined"!=typeof MobileController&&!MobileController.isMobileAuthed()){var o=t.clearDocInstance();o.then(n,i)}else{var a=ZWOfflineSyncProcess.syncDoc(e);a.then(function(){var e=t.clearDocInstance();e.then(n,i)},function(){var r=OFFLINE_ERROR_CODES.OPS_PRESENT_FOR_DOCUMENT_CHOSEN_TO_REMOVE,o=u.getDocMeta(e),a=J.i18n("writer.common.OFFLINE_PENDINGEDITS_IN_DOC",[o.DOCUMENT_NAME]);a=a+" ("+J.i18n("writer.offline.ERROR_CODE",[r.toLowerCase()])+")";var s=[J.i18n("writer.common.CANCEL"),J.i18n("writer.offline.REPORT_ERROR"),J.i18n("writer.common.PROCEED")],l=ZWOfflineUIUtil.prompt(J.i18n("writer.error.UH_OH"),a,s);l.done(function(o){if(o==CONST.BUTTON_3_CLICKED){var a=t.clearDocInstance();a.then(n,i)}else if(o==CONST.BUTTON_2_CLICKED){ZWOfflineLogger.log("Ops present while removing document from offline for RID: "+e),ZWOfflineLogger.sendLog("USER_REPORTED_OFFLINE_OPS_PRESENT_ON_REMOVE_DOCUMENT");var s={status:OPERATION_STATUS.ERROR,errorCode:r};i(s)}else{var s={status:OPERATION_STATUS.ERROR,errorCode:r};i(s)}})})}},i),t.promise()};OnLoadInitializer.on("PreProcessEditorResources",function(){var t=f();t.always(function(t){e.handlePreprocessEnd(t),OnLoadInitializer.updateCompletedProcess("offline")})});var j=function(e){var t=J.i18n(OFFLINE_ERROR_MSG_KEYS[e]),i=J.i18n(OFFLINE_ERROR_TITLE_KEYS[e]),n={};return t&&(t=t+"("+J.i18n("writer.offline.ERROR_CODE",[e.toLowerCase()])+")",n={title:i,description:t}),n},X=function(t){var n=new Deferred;o=!0;var r=function(e){ZWOfflineLogger.log("Taking Document Offline failed",e),n.reject(e)},a=i.getInstance();return a.then(function(i){L(i);var o=u.prepareForSetup(e.getUserDetails());o.then(function(){var i=ZWOfflineUtil.storeTemplateDocuments();i.then(function(){e.takeDocumentOfflineFromEditor(t).then(function(){ZWOfflineCommsWrapper.broadcastOfflineSetupDone(),ZWOfflineLogger.log("Document made Offline"),n.resolve()},r)},r)},r)},r),n.promise()},K=function(){var e=editorProps.userInfo,t={userInfo:{zuid:e.zuid,fullName:e.fullName,fname_JS:e.fname_JS,language:e.language,email:Utils.stringToHex(e.email),settings:e.settings,country:e.country,zoid:e.zoid},orgInfo:editorProps.orgInfo,uiText:editorProps.uiText};return t},Q=function(e){var t=new Deferred;if(v()){var i=e.updateEditorProperty(K());i.then(function(){t.resolve()},function(e){t.reject(e)})}else t.resolve();return t.promise()},q=function(e){var t=new Deferred,i=function(e){ZWOfflineLogger.log("Update resources failed",e),t.reject(e)},n=ZWOfflineUtil.cacheOfflineAppResources();return n.then(function(){u=e?e:ZWOffline.getMetaCollection();var n=Q(u);n.then(function(){var e=u.getBuildLabel();if(e&&e===zwEnvironment.buildLabel)F()||v()||(u=null),ZWOfflineLogger.log("Build Label is same as in DB"),t.resolve();else{var n=u.syncMetaResources();n.then(function(){var e=u.updateGeneralInfo({buildLabel:zwEnvironment.buildLabel});e.then(function(){F()||v()||(u=null),ZWOfflineLogger.log("resources cached and build label updated"),t.resolve()},i)},i)}},i)},i),t.promise()},$=function(){var e=new Deferred,t=function(){var t={};t.isOfflineSetupDone=v(),t.isOfflineSetupDoneByAnotherUser=D(),e.resolve(t)},n=function(t){e.reject(t)};if(S()){var r=Y();r.done(E().then(t,n))}else D()?t():E().then(function(){if(v())q().then(function(){ZWOfflineUtil.cacheAndStoreTemplates().then(t,n)},n);else{var e=i.getInstance();e.then(function(e){q(e).then(function(){ZWOfflineUtil.cacheTemplateDocuments().then(t,n)},n)},n)}},n);return e.promise()},ee=function(){var t=new Deferred,n=function(){ZWOfflineLogger.log("Setup Offline failed"),t.reject()},r=e.performPreProcess();return r.then(function(){var r=i.getInstance();r.then(function(i){L(i);var r=i.prepareForSetup(e.getUserDetails());r.then(function(){var e=ZWOfflineUtil.cacheAndStoreTemplates();e.then(function(){var e=i.updateGeneralInfo({offlineSetupState:OFFLINE_SETUP_STATE.COMPLETED,lastSyncTime:Date.now()});e.then(function(){o=!0,ZWOfflineCommsWrapper.broadcastOfflineSetupDone(),ZWOfflineLogger.log("Offline setup Completed"),t.resolve()},n)},n)},n)},n)},n),t.promise()},te=function(e){g=e};return{isOfflineSetupInProgress:F,isOfflineSetupDone:v,isOfflineOperationsAllowed:_,isOfflineSetupDoneByAnotherUser:D,isOfflinePreProcessFailed:R,isPreviousOfflineSetupIncomplete:S,isDBOperationsPending:A,getMetaCollection:b,removeOfflineSetup:G,abortOfflineSetup:w,setupOffline:U,removeDocumentFromOffline:z,takeDocumentOffline:Z,getAdditionalInfoForLog:N,getOfflineSetupUser:m,getErrorInfo:j,preConfigureDB:E,takeDocumentOfflineFromEditor:X,updateResources:q,handleOfflineSetupPreProcess:$,isOfflinePreconfigurationDone:P,setMetaCollection:L,setOfflineSetupState:T,setOfflinePreConfigurationStatus:te,processAndAddDocMetas:B,processHandler:h,resetOfflineSetupInProgressState:M,setOfflineSetupInProgressState:y,performRemoveOfflineSetup:Y,setupOfflineDuringNetworkDown:ee,prepareOfflineReConfig:W}}(OfflineImpl,ZWOfflineDBUtil,ZWOfflineMetaCollection,AsyncProcessHandler,ZWOfflineDocumentHandler),ZWOfflineSyncProcess=function(e,t,i,n){"use strict";var r={SYNCING:0,COMPLETED:1,FAILED:2,LOCKED:3},o=100,a={},s=function(){var e=new n,t=l();return t.then(function(t){var i=p(t);n.when(i).always(function(){e.resolve()})},function(t){e.reject(t)}),e.promise()},l=function(){for(var e=new n,r=i.getMetaCollection(),o=r.getSyncDocumentList(),a=[],s=0,l=o.length;s<l;s++){var d=t.isOfflineOpsEmptyInDoc(o[s]);a.push(d)}var c=whenAlways(a);return c.done(function(){for(var t=[],i=0,n=arguments.length;i<n;i++){var r=arguments[i];if(r.status==OPERATION_STATUS.ERROR){if(r.errorCode!=OFFLINE_ERROR_CODES.OPS_PRESENT_DURING_REMOVE_SETUP)return void e.reject(r);t.push(r.rid)}}e.resolve(t)}),e.promise()},d=function(t){for(var i=new n,r=[],o=0,a=t.length;o<a;o++){var s=t[o],l=e.getInstance(s);r.push(l)}return n.when.apply(null,r).then(function(){for(var e={},t=0,n=arguments.length;t<n;t++){var r=arguments[t];e[r.getRID()]=r}i.resolve(e)},function(e){i.reject(e)}),i.promise()},c=function(e,t){return t.LAST_MODIFIED_TIME_LONG-e.LAST_MODIFIED_TIME_LONG},u=function(e,t){var n=[],r=[],a=[],s=[],l=[],d=[],u=[],g=e.toBeProcessedList;if(0!==g.length){for(var h=i.getMetaCollection(),f=0,p=g.length;f<p;f++){var E=g[f],T=E.RID,O=t[T];if(O.isEmptyInstance())d.push(T);else{var m=O.getVersionObj(),I=O.getOpsCollection();I.isEmpty()?"trashed"===E.status||"exception"===E.status||"deleted"===E.status||E.finalInfo||E.isCheckedOut?n.push(E):(E.clientVersion=m.version,E.clientRevision=m.revision,E.clientVersionId=m.versionId,E.clientDocName=O.getDocumentName(),1==h.isOptedOfflineByUser(T)||E.isFavourite?a.push(E):s.push(E)):"exception"===E.status||"deleted"===E.status?l.push(E):r.push(E)}}s=s.sort(c);var D=o;if(r.length+a.length>D)D=r.length+a.length,n=n.concat(s),s=[];else{var R=D-(r.length+a.length),C=r.length+a.length+s.length;C>D&&(n=n.concat(s.splice(R)))}s=s.concat(a);for(var f=0;f<s.length;){var A=s[f];A.clientVersion===A.version&&A.clientRevision===A.revision&&A.clientDocName===A.DOCUMENT_NAME&&A.clientVersionId&&A.clientVersionId===A.versionId?(u.push(s[f].RID),s.splice(f,1)):f++}}s=s.concat(e.offlineCreatedDocList,r),n=e.toBeRemovedList.concat(n);var v=S(s),_=S(n),P={toBeSyncedList:v,toBeRemovedList:_,metaMismatchList:d,unmodifiedList:u,activeDocList:e.activeDocList};return P},g=function(e,t){for(var i=0;i<t.length;)e.toBeSyncedList.contains(t[i].RID)||e.toBeRemovedList.contains(t[i].RID)||e.metaMismatchList.contains(t[i].RID)||e.unmodifiedList.contains(t[i].RID)||e.activeDocList.contains(t[i].RID)?t.splice(i,1):i++;return t},h=function(){var e=new n,t={},r=i.getMetaCollection(),o=function(i){var n=u(t,i);e.resolve(n)},a=function(t){ZWOfflineLogger.log("Pre process sync documents failed"),e.reject(t)},s=r.getPreProcessedMetaObj();return s.then(function(e){t=e;var i=S(t.toBeProcessedList);if(0!=i.length){var n=d(i);n.then(o,a)}else o({})},a),e.promise()},f=function(e){for(var t=i.getMetaCollection(),r=new n,o=[],a=0,s=e.length;a<s;a++){var l={};l.docSyncStatus=OFFLINE_DOC_STATES.PENDING,o[a]=t.updateDocMeta(e[a],l)}var d=n.when.apply(null,o);return d.then(function(){r.resolve()},function(){var e={status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.META_STORE_TO_DB_FAILED,reason:"Adding metadata to DB failed"};r.reject(e)}),r.promise()},p=function(e){for(var t=new n,i=[],r=!1,o=!1,a=function(e){e.errorCode!==OFFLINE_ERROR_CODES.DOCUMENT_LOCKED_BY_ANOTHER_INSTANCE&&(r=!0,(!e.reason||"TIMEOUT"!==e.reason&&"RESOURCE_TRASHED"!==e.reason&&"PERMISSION_REVOKED/DOCUMENT_TRASHED"!==e.reason&&"DOCUMENT_MIGRATED_IN_SERVER"!==e.reason&&"DOCUMENT_MIGRATED_OR_OWNER_CHANGED_IN_SERVER"!=e.reason&&"CHANGEPERMISSION"!==e.reason)&&(o=!0)),t.notify(e)},s=function(e){t.notify(e)},l=0,d=e.length;l<d;l++){var c=e[l],u=E(c);u.then(s,a),i.push(u)}var g=whenAlways(i);return g.done(function(){r&&ZWOfflineLogger.sendLog("OFFLINE_DASHBOARD_SYNC_ERROR",{shouldSendMail:o}),t.resolve.apply(t,arguments)}),t.promise()},E=function(i){var o=new n,a=function(e){ZWOfflineLogger.log("Exception in caching resources: rid="+i,e),e.RID=i,o.reject(e)},s=ZWOfflineCommsWrapper.isLocked(i);return s.done(function(n){if(n.isActive)m(i),a({status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.DOCUMENT_LOCKED_BY_ANOTHER_INSTANCE,reason:"LOCKED_BY_ANOTHER_INSTANCE"});else{var s=e.getInstance(i);s.then(function(e){if(T(i)==r.LOCKED)a({status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.DOCUMENT_LOCKED_BY_ANOTHER_INSTANCE,reason:"LOCKED_BY_ANOTHER_INSTANCE"});else if(T(i)===r.SYNCING)a({status:OPERATION_STATUS.ERROR,errorCode:OFFLINE_ERROR_CODES.DOCUMENT_ALREADY_SYNCING,reason:"DOCUMENT_ALREADY_SYNCING"});else{O(i,r.SYNCING);var n=e.syncDocument();n.then(function(e){O(i,r.COMPLETED),e.RID=i,o.resolve(e)},function(n){O(i,r.FAILED),n.status!==OPERATION_STATUS.FAILED||"SAVE_FAILURE"!==n.reason&&"FAILED"!==n.reason&&"REDIS_VERSION_MISMATCH"!==n.reason&&("RESOURCE_TRASHED"!==n.reason&&"DOCUMENT_MIGRATED_IN_SERVER"!==n.reason&&"DOCUMENT_MIGRATED_OR_OWNER_CHANGED_IN_SERVER"!==n.reason||!e.opsCollection.isEmpty())||t.forceRemoveDocumentFromOffline(i),a(n)})}},a)}}),o.promise()},T=function(e){return a[e]?a[e].status:""},O=function(e,t){a[e]||(a[e]={}),a[e].status=t},m=function(e){O(e,r.LOCKED)},I=function(e){var t="";return a[e]&&(t=a[e].status),t},D=function(e){var t=new n;if(e.toBeSyncedList.length<20){var r=i.getMetaCollection(),o=r.getLastSyncTime(),a=ZWOfflineServerUtil.fetchDocMetaList(o);a.then(function(i){var n=i.originalResponse,o=g(e,n.DOCUMENTS);r.updateGeneralInfo({lastSyncTime:Date.now()}).then(function(){t.resolve(o)})},function(){t.resolve([])})}else t.resolve([]);return t.promise()},R=function(){var e=new n,r=function(t){ZWOfflineLogger.log("SyncProcess for existing documents failed",t),e.reject(t)},o=function(){e.resolve.apply(e,arguments)},a=function(t){e.notify(t)},s=h();return s.then(function(e){var n=t.forceRemoveDocuments(e.toBeRemovedList);n.then(function(){var n=t.removeRidEntriesFromTables(e.metaMismatchList);n.then(function(){var t=D(e);t.then(function(t){var n=i.processAndAddDocMetas(t);n.then(function(){var i=f(e.toBeSyncedList);i.then(function(){var i=S(t),n=e.toBeSyncedList.concat(i),s=p(n);s.progress(a),s.then(o,r)})},r)},r)},r)},r)},r),e.promise()},S=function(e){for(var t=[],i=0,n=e.length;i<n;i++)t.push(e[i].RID);return t},C=function(e){var t=S(e),i=p(t);return i},A=function(e){a[e]&&delete a[e]},v=function(){a={}};return{syncAllExistingDocuments:R,syncOfflineModifiedDocument:s,syncDocumentsDuringSetup:C,setSyncLock:m,removeSyncLock:A,resetSyncMap:v,syncDoc:E,getDocSyncStatus:I}}(ZWOfflineDocumentHandler,ZWOfflineUtil,ZWOffline,Deferred),ParaDTView=function(){"use strict";function e(e,t,i){BaseParaDTView.apply(this,arguments),this.blocks=[],this.levels=[],this.types=[],this.visualOrder=[],this.bidi=null}return e.prototype=Object.create(BaseParaDTView.prototype),e.prototype.constructor=e,extend(e.prototype,{buildBlocks:function(){var e=this.node.buildBlocks(),t=e.nonMertricsBlocks;if(isV8Engine&&t.length){var i=setBlockMetrics(t);FontUtils.setWordMetrics(i);for(var n,r=0,o=0,a=e.blocks.length;o<a;o++)n=i[r],e.blocks[o].isMetricsFilled||e.blocks[o].start!==n.start||(e.blocks[o].width=n.width,e.blocks[o].height=n.height,e.blocks[o].baseLine=n.baseLine,e.blocks[o].isMetricsFilled=!0,r++)}this.blocks=e.blocks},updateProperties:function(){this.buildBlocks(),this.computeVisualOrderAndLevels(),this.computeBorderProperties(),this.setParaSpacingProperties()},computeVisualOrderAndLevels:function(){var e=this.isRTLPara()?1:0,t=this.getAllBlocksTypes();this.bidi=new BiDi(t,e),this.levels=this.bidi.levels,this.types=this.bidi.types},getLevels:function(e,t){return this.bidi.getLevels(e,t)},getTypes:function(){return this.types},getVisualOrder:function(e,t){return this.bidi.getReordering(e,t)},getAllBlocksTypes:function(){for(var e=[],t=0;t<this.blocks.length;t++)Array.prototype.push.apply(e,this.blocks[t].types);return e},getBlocks:function(){return this.getSection().isDirtyNode(this)&&this.updateProperties(),this.blocks},getBlockByIndex:function(e){var t,i=this.blocks.length;for(t=0;t<i;t++)if(this.blocks[t].start===e)return this.blocks[t];return null},destroy:function(){this.bidi.destroy(),this.bidi=null,this.blocks=[],this.types=[],this.levels=[],this.visualOrder=[],BaseParaDTView.prototype.destroy.call(this)}}),e}(),DTViews,MetaCollections;!function(){"use strict";DTViews={para:ParaDTView,cell:CellDTView,row:RowDTView,table:TableDTView,hr:HrDTView,toc:TocDTView,endnote:NoteDTView,footnote:NoteDTView,textbox:MetaDTView,content:ContentDTView,header:HFDTView,footer:HFDTView},MetaCollections={endnote:NoteViewCollection,footnote:NoteViewCollection,textbox:MetaViewCollection}}();var DocViewUpdateQueue=function(e){"use strict";function t(){this.viewsToProcess={},this.viewsToRemove=[]}var i=function(e,t){return e.view.getNode().getIndex()-t.view.getNode().getIndex()},n=function(t,i){var n=e.prototype.priorityTable[t],r=e.prototype.priorityTable[i];return n>r?t:i};return t.prototype.add=function(e,t,i){var r=this.viewsToRemove.indexOf(e);if(r!=-1)t=n(OP_TYPE.REMOVE,t),this.viewsToRemove.splice(r,1);else for(var o=this.viewsToProcess[e.dtView.id]||[],a=0;a<o.length;a++){var s=o[a];if(s.view===e){t=n(s.opType,t),o.splice(a,1),0===o.length&&delete this.viewsToProcess[e.dtView.id];break}}if(t===OP_TYPE.REMOVE)this.viewsToRemove.push(e);else{var l={opType:t,view:e,options:i||null};o.unshift(l),this.viewsToProcess[e.dtView.id]=o}},t.prototype.remove=function(e){var t,i=this.viewsToProcess[e.dtView.id];if(i)for(var n=0;n<i.length;n++){var r=i[n];if(r.view==e)return t=i.splice(n,1),0==i.length&&delete this.viewsToProcess[e.dtView.id],t}var o=this.viewsToRemove.indexOf(e);if(o!==-1)return[{opType:OP_TYPE.REMOVE,view:this.viewsToRemove.splice(o,1)[0],options:null}]},t.prototype.getNextView=function(){if(this.viewsToRemove.length>0)return{opType:OP_TYPE.REMOVE,view:this.viewsToRemove.shift(),options:null};var e,t=[];for(e in this.viewsToProcess)this.viewsToProcess.hasOwnProperty(e)&&(this.sortViewsToProcess(e),t.push(this.viewsToProcess[e][0]));t.sort(i);var n=t[0];return this.remove(n.view),n},t.prototype.sortViewsToProcess=function(e){var t=this.viewsToProcess[e],i=t[0].view;i.getType()===VIEW.PARA?t.sort(function(e,t){return e.view.getStart()-t.view.getStart()}):t.sort(function(e,t){return e.view.getPage().getPageNumber()-t.view.getPage().getPageNumber()})},t.prototype.isViewsPendingToBuild=function(){return this.viewsToRemove.length>0||Object.keys(this.viewsToProcess).length>0},t.prototype.isInUpdateQueue=function(e){var t,i=e.getNodeId();if(this.isViewsPendingToBuild()){if(this.viewsToProcess[i]){t=this.viewsToProcess[i];for(var n=0;n<t.length;n++)if(t[n].view.getId()===e.getId())return!0}for(var n=0;n<this.viewsToRemove.length;n++)if(this.viewsToRemove[n].getId()===e.getId())return!0}return!1},t.prototype.isAnySplitViewsInUpdateQueue=function(e){var t=e.getNodeId();if(this.isViewsPendingToBuild()){if(this.viewsToProcess[t])return!0;for(var i=0;i<this.viewsToRemove.length;i++)if(this.viewsToRemove[i].getNodeId()===e.getNodeId())return!0}return!1},t.prototype.getOpType=function(e){var t,i=e.getNodeId();if(this.isViewsPendingToBuild()){if(this.viewsToProcess[i]){t=this.viewsToProcess[i];for(var n=0;n<t.length;n++)if(t[n].view.getId()===e.getId())return t[n].opType}for(var n=0;n<this.viewsToRemove.length;n++)if(this.viewsToRemove[n].getId()===e.getId())return OP_TYPE.REMOVE}return""},t}(DTUpdateQueue),DocView=function(e){"use strict";function t(t,i,n,r){this.id=e.randomId(t.type),this.dtView=t,this.type=t.type,this.width=0,this.height=0,this.left=0,this.top=0,this.column=n,this.parent=r,this.section=i,this.type===VIEW.PARA&&this.type===VIEW.HR||(this.childViews=new LinkedList),this.documentLayoutManager=this.getGroup().getLayoutManager(),this.isUserOperation=!1,this.setViewTop()}return BaseEventHandler.call(t.prototype),extend(t.prototype,{setViewTop:function(){var e=0,t=this.getPrevView();if(t&&(e=t.getTop()+t.getHeight()),this.getTop()!==e){this.top=e,this.getSection().trigger(DOCVIEW.VIEW_TOP_UPDATED,this);for(var i=this.getChildViewsArray(!0),n=0;n<i.length;n++)this.getSection().trigger(DOCVIEW.VIEW_TOP_UPDATED,i[n])}},getAbsTop:function(e){if(this.getType()===e)return 0;var t=this.getTop(),i=this.getParent();return i&&(t+=i.getContentTop(),i.getType()!==e&&(t+=i.getAbsTop(e))),t},getAbsLeft:function(e){if(this.getType()===e)return 0;var t=this.getLeft(),i=this.getParent();return i&&(t+=i.getContentLeft(),i.getType()!==e&&(t+=i.getAbsLeft(e))),t},getContentTop:function(){return 0},getContentLeft:function(){return 0},getId:function(){return this.id},isParentSetToRemove:function(){return this.dtView.isParentSetToRemove()},getThemeStyleFormat:function(){return this.dtView.getThemeStyleFormat()},getNodeId:function(){return this.getNode().getId()},getDTViewId:function(){return this.getDTView().getId()},getWidth:function(){return this.width},getHeight:function(){return this.height},getDOMViewHeight:function(){return this.height},getDOMViewWidth:function(){return this.width},getGroup:function(){return this.section.getGroup()},getPage:function(){return this.column.getPage()},getNode:function(){return this.dtView.getNode()},getViews:function(e){return this.getGroup().getDocViews(this.getNodeId(),e)},getLayoutManager:function(){return this.documentLayoutManager},getFloatImages:function(){return[]},belongsToPage:function(e){return this.getSection().belongsToPage(e)},getSplitHeight:function(){for(var e=0,t=this.getPreviousSplitView();t;)e+=t.getHeight(),t=t.getPreviousSplitView();return e},isPrevViewAllowed:function(){return!0},isNextViewAllowed:function(){return!0},isInFloatImageArea:function(e){return this.getSection().isInFloatImageArea(this,e)},getPageFloatImages:function(){var e=this.getSection();return e.isReplicableView()?e.getFloatImages():e.getPage().getFloatImages()},setHeightAndTop:function(){this.setHeight(),DTUtils.updateAllViewsTop(this)},getColumn:function(){return this.column},getPreviousColumn:function(){return this.column.getPreviousColumn()},getNextColumn:function(){return this.column.getNextView()},getNextView:function(){return this.next},getPrevView:function(){return this.prev},getFirstSplitView:function(){var e,t=this.column.getDocViews(this.dtView.getId());return t.length&&(e=t[0]),e},getLastSplitView:function(){var e,t=this.column.getDocViews(this.dtView.getId());return t.length&&(e=ZWArrayUtils.lastElementOf(t)),e},getNextSplitView:function(){for(var e,t=this.column.getDocViews(this.dtView.getId()),i=0;i<t.length-1;i++)if(this.getId()===t[i].getId()){e=t[i+1];break}return e},getPreviousSplitView:function(){for(var e,t=this.column.getDocViews(this.dtView.getId()),i=1;i<t.length;i++)if(this.getId()===t[i].getId()){e=t[i-1];break}return e},getType:function(){return this.type},getSection:function(){return this.section},findParentDocViewInColumn:function(e){for(var t=null,i=this.parent;i;){if(i.getType()===VIEW.COLUMN){t=e;break}for(var n=this.getViews(),r=0;r<n.length;r++)if(n[r].column.getId()===e.getId()){t=n[r];break}i=i.parent}return t},findDocViewInColumn:function(e){for(var t,i=this.getDocViews(),n=0;n<i.length;n++)if(t=i[n],t.getColumn().getId()===e.getId())return t;return null},findPreviousSiblingWithDocViews:function(){var e=this.getDTView(),t=e.getPrevView();if(!t)return null;var i;do i=this.getGroup().getDocViews(t.getId()),t=t.getPrevView();while(t&&!i.length);return i},findChildDocViewByDTView:function(e){for(var t,i=this.getFirstChild();i;){if(i.getDTViewId()===e.getId())return i;if(i.getFirstChild()&&(t=i.findChildDocViewByDTView(e)))return t;i=i.next}return null},isParentOf:function(e,t){for(var i=this.getFirstChild();i;){if(i===e)return!0;if(t&&i.getChildViewsLength()){var n=i.isParentOf(e,t);if(n)return!0}i=i.next}return!1},isChildOf:function(e){if(this.getSection()!==e.getSection())return!1;for(var t=this.getParent();t;){if(t.getType()===VIEW.COLUMN)return!1;if(t===e)return!0;t=t.getParent()}return!1},getLeft:function(){return this.left},setHeight:function(){for(var e=0,t=this.getFirstChild();t;)e+=t.getHeight(),t=t.next;this.height=e},updateHeight:function(){var e=this.getHeight();this.setHeight(),e!==this.getHeight()&&(DocUtils.updateAllViewsTop(this),this.propagateVia(this.documentLayoutManager,DOCVIEW.HEIGHT_UPDATED,this),this.getParent()&&this.getParent().updateHeight(this))},updateWidth:function(){this.width=this.getParent().getWidth()},getMinRenderingHeight:function(){var e=this.getFirstChild(),t=0;return e&&(t=e.getMinRenderingHeight()),t},addToUpdateQueue:function(e,t,i){this.isParentSetToRemove()&&ZWLogger.log("Current view is added to DocView Update Queue while its parent is set to remove in DT Update Queue"),this.getColumn().addToUpdateQueue(this,e,t,i)},checkMerge:function(){return this.next&&this.column.id===this.next.column.id&&this.dtView.id===this.next.dtView.id?this.merge(this.next,this.column):this.prev&&this.column.id===this.prev.column.id&&this.prev.dtView.id===this.dtView.id?this.prev.merge(this,this.column):this},getChildViews:function(){return this.childViews||null},getFirstChild:function(){return this.childViews.first||null},getLastChild:function(){return this.childViews.last||null},getChildViewsLength:function(){return this.childViews.length||0},getParent:function(){return this.parent},getTop:function(){return this.top},detachView:function(e){this.propagateVia(this.getSection(),DOCVIEW.VIEW_DETACHED,e),this.childViews.remove(e),this.updateHeight(),e.updateParent(null)},attachView:function(e,t){e.updateParent(this),t?this.childViews.insertAfter(e,t):this.childViews.insertAsFirst(e),this.updateHeight(),this.propagateVia(this.getSection(),DOCVIEW.VIEW_ATTACHED,e)},findOrCreateSplitDocView:function(e,t){var i;i=t&&t.parent?t.parent:this.findParentDocViewInColumn(e)||e;var n=e.getSection(),r=this.findDocViewInColumn(e);return r||(r=n.addToSectionView(this.dtView,n,e,i,{isUserOperation:t.isUserOperation})),r},preDocViewsRemove:function(){},removeView:function(e,t){var i=this.getSection();i.removeFromSectionView(this,t),e&&(i.removeAllFloatImagesInView(this),i.removeFromUpdateQueue(this),i.needBuildData()&&i.gatherBuildData({viewId:this.getId(),opType:OP_TYPE.REMOVE}),this.remove(e,t))},removeAllChildViews:function(e,t,i){if(this.getChildViewsLength())for(var n,r=this.getLastChild();r;)n=r.getPrevView(),r.removeAllChildViews(e,t,i),r=n;(i||this.isEligibleForRemove())&&this.removeView(e,t)},preRemove:function(e){this.detachView(e)},remove:function(){var e=this.getNextView(),t=this.getParent();return t.preRemove(this),DocUtils.updateAllViewsTop(e),this.destroy(),!0},destroy:function(){this.documentLayoutManager=null,this.childViews=null,this.section=null,this.parent=null,this.column=null,this.top=0,this.left=0,this.height=0,this.width=0,this.type="",this.dtView=null,this.id=""},isEmpty:function(){return!(this.getChildViews()&&this.getChildViewsLength())},getDTView:function(){return this.dtView},isEligibleForRemove:function(){return!!(1!==this.getViews().length||this.getDTView().toBeRemoved()&&this.documentLayoutManager.docTreeDestroyInProgress)&&!(this.getChildViews()&&0!==this.getChildViewsLength()||this.getSection().isInUpdateQueue(this))},refresh:function(){var e=this.getChildViewsLength();if(e)for(var t=this.getFirstChild();t;)t.refresh(),t=t.getNextView()},isBalanced:function(){var e=this.getChildViewsLength();if(e){var t=this.getFirstChild();return t&&t.isBalanced()}return!1},updateLayoutAndDesign:function(){},publishNodeLineEvents:function(){},isPendingToBuild:function(){for(var e=this.getLastChild();e;){if(e.isPendingToBuild())return!0;e=e.getPrevView()}return!1},isViewsBuilt:function(){if(this.isPendingToBuild())return!1;for(var e=this.getFirstChild();e;){if(!e.isViewsBuilt())return!1;e=e.getNextView()}return!0},isFirstView:function(e){return this.getFirstChild().getId()===e.getId()},updateParent:function(e){this.parent=e},updateSection:function(e){this.section=e},updateColumn:function(e){this.column=e},setUserOperation:function(e){this.isUserOperation=e},hasFootNotes:function(){return!1},isEligibleForSplit:function(){for(var e=this.getFirstChild();e;){if(!e.isEligibleForSplit())return!1;e=e.getNextView()}return this.getSection().getOpTypeInViewUpdateQueue(this)!==OP_TYPE.CREATE},addAllChildViewsToUpdateQueue:function(e,t,i){if(this.getChildViewsLength())for(var n=this.getFirstChild();n;)n.addAllChildViewsToUpdateQueue(e,t,null),n=n.getNextView();i&&i.getId()===this.getId()||this.getSection().addToUpdateQueue(this,e,t)},getAllChildViewsInArray:function(e){var t=[];if(this.getChildViewsLength())for(var i=this.getFirstChild();i;)i.getAllChildViewsInArray(null),i=i.getNextView();return e&&e.getId()===this.getId()||t.push(this),t},removeNodeLines:function(){},getChildViewsArray:function(e){for(var t=[],i=this.getFirstChild();i;)e&&(t=t.concat(i.getChildViewsArray(e))),t.push(i),i=i.getNextView();return t},getFirstParaView:function(){for(var e=this.getFirstChild();e;){if(e.getType()===VIEW.PARA)return e;if(e.getChildViewsLength())return e.getFirstParaView();e=e.getNextView()}var t=this.getNextView();return t?t.getFirstParaView():null},getLastParaView:function(){for(var e=this.getLastChild();e;){if(e.getType()===VIEW.PARA)return e;if(e.getChildViewsLength())return e.getLastParaView();e=e.getPrevView()}var t=this.getPrevView();return t?t.getLastParaView():null},getNodeStartIndex:function(){return this.getNode().getIndex()},getNodeEndIndex:function(){return this.getNode().getEndIndex()},getChildViewsOfGivenType:function(e){for(var t=[],i=this.getFirstChild();i;)i.getType()===e&&t.push(i),i.getChildViewsLength()&&(t=t.concat(i.getChildViewsOfGivenType(e))),i=i.next;return t},getDocViews:function(){return this.getGroup().getDocViews(this.getNodeId())},getFootNoteHeight:function(){for(var e=0,t=this.getFirstChild();t;)e+=t.getFootNoteHeight(),t=t.next;return e},isMetaSection:function(){var e=this.getSection().getSectionType();return META_SECTIONS.contains(e)},getRawFormatAt:function(e){return this.dtView.getRawFormatAt(e)},getSectionType:function(){return this.getSection().getSectionType()},getRootSectionType:function(){return this.getSection().getRootSectionType()},getRawFormat:function(){return this.getNode().getFormat()},logger:function(){return this.getSection().logger()},isDirtyNode:function(){var e=this.getSection();return e.isDirtyNode(this)},getLastVmpRowHeight:function(){return 0},isSplitViewOf:function(e){return this.getNodeId()===e.getNodeId()},hasInnerTable:function(){for(var e=this.getFirstChild();e;){if(e.hasInnerTable())return!0;e=e.next}return!1},hasWaterMark:function(){return!1},getWatermarkData:function(){for(var e=null,t=this.getFirstChild();t;){if(e=t.getWatermarkData())return e;t=t.next}return e}}),t}(Utils),DocUtils=function(){var e=function(t){for(var i=t;t;)t.setViewTop(),i=t,t=t.next;i&&i.parent&&e(i.parent)},t=function(e,t){var i=!0,n=e.getView();if(n&&t&&n!==t){var r=n.getParent();r&&r.getType()===VIEW.CELL&&(i=t.isChildOf(r))}return i},i=function(e,i,n,r){n=n||{top:0,bottom:0,left:0,right:0},r=r?r:0;var o=i?i.getAbsTop():0,a=i?i.getAbsLeft():0,s=i?i.getHeight():0,l=i?i.getWidth():0,d=e.getAbsTop(VIEW.PAGE);d+=r;var c=e.getAbsLeft(VIEW.PAGE),u=!(o+n.top+s+n.bottom<=d||o+n.top>d+e.getHeight()||a+n.left+l+n.right<c||a+n.left>c+e.getWidth()),g=!0;return i&&(g=t(e,i)),u&&g},n=function(e){var t=e.getParent();if(t)for(var i=t.getFirstChild();i;){if(e.getId()===i.getId())return i.getNextView();i=i.getNextView()}return null},r=function(e,t){var i,o;if(e.getChildViews()&&e.getFirstChild()){if(i=e.getFirstChild(),i.getType()===t)return i;if(o=r(i,t))return o}var a=e.getNextView()||n(e);if(!a){for(var s,l=e.getParent();l&&l.getType()!==VIEW.SECTION&&!(s=l.getNextSplitView()||l.getNextView());)l=l.getParent();for(;s&&s.getType()!==VIEW.SECTION;){if(s.getType()===t)return s;if(a=s.getFirstChild())break;s=n(e)||s.getParent()}}for(;a;){if(a.getType()===t)return a;if(a.getChildViews()&&a.getFirstChild()){if(i=a.getFirstChild(),i.getType()===t)return i;if(o=r(i,t))return o}a=a.getNextView()}return null},o=function(e){for(var t,i=e.getNextPage();i;){if(!i.isEmpty())return i;t=i.getNextPage(),i.getGroup().removePage(i),i=t}return null},a=function(e){for(var t,i,n=e.getNextSection();n;){if(!n.isEligibleForRemove())return n;t=n.getNextSplitView()||n.getNextSection(),n.removeAllChildViews(),i=n.getPage(),i&&i.isEmpty()&&i.getGroup().removePage(i),n=t}return null},s=function(e,t,i){i=i||{};var n,r=e.getFirstChild(),o=e.getSection().getMaxRenderingHeight(),a=0,s=i.height||0,l=e.getType(),d=0;for(l===VIEW.TABLE&&e.shouldIncludeHeaderRow()&&(d=e.getHeaderRow().getHeight()),s+=d;r;){if(a=DocLayoutManager.getViewHeight(r,i.considerFootNotes),s+a>t){if(l===VIEW.TABLE&&r.cantsplit&&a+d<o){var c=r.getPrevView();c?(n=c,s-=c.getHeight()):(n=r,s=t)}else n=r;break}s+=a,r=r.getNextView()}return{breakNode:n,height:s}},l=function(e,t,i,n){for(var r,o,a=e.getNextView();a;)r=a.getId(),o=a.getNextView(),i.moveView(a,n),a=o,a&&r===a.getId()&&e.logger().error("After docview split :: prev id equals next id");t&&t.isEligibleForRemove()&&t.removeAllChildViews(!0,!0),e.isEligibleForRemove()&&e.removeAllChildViews(!0,!0)},d=function(e,t,i,n){var r="";if(t&&(r=t.cls||""),t&&(r.indexOf(AUTOFIELD_TYPE.AUTO_PAGECOUNT)!==-1||r.indexOf(AUTOFIELD_TYPE.AUTO_PAGENUMBER)!==-1)){if(!isV8Engine){var o,a=editor.getPageID(),s=DocLayoutManager.getPageWithId(a);if(s){var l=s.getGroup();if(r.indexOf(AUTOFIELD_TYPE.AUTO_PAGECOUNT)!==-1){var d=editor.doc.getRawFormatAt(e-1),c=!(!d||d[ATTR_AUTOFIELD.FIELDTYPE]!==AUTOFIELD_TYPE.AUTO_PAGECOUNT||!d[ATTR_AUTOFIELD.SECTIONPAGES]);o=c?l.getRelativePageCount().toString():DocLayoutManager.getPageCount().toString()}else if(r.indexOf(AUTOFIELD_TYPE.AUTO_PAGENUMBER)!==-1){var u=l.getPageNumberFormat(),g=s.getPageNumber();o=ListUtils.getListNumber(u,g,null,!0).toString()}}else o="#";var h=DTUtils.getTextMetrics(o,t,n);return{width:h.width}}if(r.indexOf(AUTOFIELD_TYPE.AUTO_PAGECOUNT)!==-1)return getTextMetrics("##",t);if(r.indexOf(AUTOFIELD_TYPE.AUTO_PAGENUMBER)!==-1)return getTextMetrics("#",t)}if(t&&(r.indexOf(AUTOFIELD_TYPE.AUTO_AUTHOR)!==-1||r.indexOf(AUTOFIELD_TYPE.AUTO_DATE)!==-1||r.indexOf(AUTOFIELD_TYPE.AUTO_DOCNAME)!==-1||r.indexOf(AUTOFIELD_TYPE.AUTO_DOCVERSION)!==-1)){var f=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,e),d=editor.doc.getRawFormatAt(f);if(1==d[ATTR_AUTOFIELD.ISAUTO]){var p=DocTreeManager.getAutoFieldValue(f),h=DTUtils.getTextMetrics(p,t,n);return{width:h.width}}}if(t&&(r===NODE_TYPE.ENDNOTE||r===NODE_TYPE.FOOTNOTE)){var E=i.getDTSectionViewByID(t.id),T=E?E.getReferenceCharWidth():0;return{width:T}}if(t&&r===CONST.NEXTRECORD){var d=editor.doc.getRawFormatAt(e-1),o=UNICODE.MERGEFIELD_START+d[MAILMERGE.MMINFO][MAILMERGE.FIELD_NAME]+UNICODE.MERGEFIELD_END,h=DTUtils.getTextMetrics(o,t,n);return{width:h.width}}},c=function(e,t,i){var n=e.getParentNode(),r=n.getParaStyles(),o=r&&r[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL||!1,a=t&&t.isRTL||!1;return t&&(t.isNeutralChars&&i&&i.isRTL?a=!0:!i&&t.isNeutralChars&&(a=o)),a},u=function(e,t,i){var n=0;return e&&(t||(n+=e.width),i||(n+=e.space)),n},g=function(e,t){var i=t.getPrevView();if(i)return i;for(var n=e.getPreviousSplitView();n;){if(n.getLastColumn())return n.getLastColumn();n=n.getPreviousSplitView()}return null},h=function(e,t){if(e.getType()!==VIEW.PARA)return!1;var i=t.getSection(),n=i.getMaxRenderingHeight()-t.getHeight(),r=0,o=e.getParent(),a=t.getLastChild(),s=e.prev;if(s){if(s.getType()===VIEW.PARA&&s.getParaProperties().keepNext)return!0}else if(o.getType()===VIEW.CELL&&a&&a.getType()===VIEW.TABLE){for(var l=o.getViews(),d=o.getId(),c=0;d!==l[c].getId();)c++;if(0===c)return!1;var u=l[c-1],g=u.getContentHeight(),h=u.getRow().getHeight(),f=e.getFirstNodeLine(),p=f?f.getHeight():0;if(h-g+n>=p)return!0}else{if(a&&a.getNodeId()!==e.getNodeId()&&a.getType()===VIEW.PARA&&a.getParaProperties().keepNext)return!0;if(e.getDTView().shouldKeepWithNext())for(var E=e;E&&E.getType()===VIEW.PARA&&(r+=E.getHeight(),E.getDTView().shouldKeepWithNext());)E=E.getNextView();else for(var T=e.getParent().getType()!==VIEW.CELL,O=e.getParaObjForSplit(n,t,e.getColumn(),{considerFootNotes:T,hasPrevView:!!e.getPrevView()}),c=0;c<O.splitIndex;c++)r+=e.getNodeLine(c+1).getHeight(!1,!0)}return!!(r&&n>r)},f=function(e,t){var i=e.getParaProperties(),n=e.getNodeLinesLength(),r=i.keepNext||!1,o=i.linesTogether||!1,a=i.widowsOrphan||!1,s=!1;if(t<0)return s;var l=n>0?e.getFirstNodeLine():null;if(o)s=e.getHeight()<=t;else if(r)if(a)if(n>3)s=l.getHeight(!1,!0)+e.getNodeLine(2).height<=t;else{var d=e.getHeight();if(e=e.next){var c=e.getType();c==VIEW.TABLE||c==VIEW.TOC?s=d+e.getFirstChild().getHeight()<=t:c==VIEW.PARA&&(t-=d,s=f(e,t))}else s=d<=t}else if(n>1)s=l.getHeight(!1,!0)<=t;else{var d=e.getHeight();if(e=e.next){var c=e.getType();c==VIEW.TABLE||c==VIEW.TOC?s=d+e.getFirstChild().getHeight()<=t:c==VIEW.PARA&&(t-=d,s=f(e,t))}else s=d<=t}else a?s=n>3?l.getHeight(!1,!0)+e.getNodeLine(2).height<=t:e.getHeight()<=t:l&&l.getHeight(!1,!0)<=t&&(s=!0);return s},p=function(e){return!(!e||e.type!=NODE_TYPE.IMAGE||e.subType||e.shapeData||e.mminfo||e.latexexp||e.fieldinfo)};return{updateAllViewsTop:e,isInFloatImageArea:i,checkFloatImageAffectedViewHierarchy:t,findNextViewOfGivenType:r,getNextNonEmptyPage:o,getNextNonEmptySection:a,getBreakViewInfo:s,afterDocViewSplit:l,getHashReplaceNumberWidthAt:d,isRTLBlock:c,getBorderWidthAndSpacing:u,getPrevColumnInSection:g,doesFirstLineFitInPreviousPage:h,shouldPaginateFromPrevColumn:f,isImage:p}}(),DocumentLayoutManager=function(e,t){"use strict";function i(t,i,n){this.docTree=t,this.dtViewManager=i,this.viewType=n,this.pageViewMap={},this.groups=new e,this.waitingPaginationThread=-1,this._logger=new ZWConsole,this.prototypesOverridden=[],this.maxPagesWidth=0,this.pageOffset=null,this.docTreeDestroyInProgress=!1,this.isPaginationAllowed=!0,this.bindEvents()}var n=[1],r=(new RegExp(AUTOFIELD_TYPE.AUTO_PAGECOUNT+"|"+AUTOFIELD_TYPE.AUTO_PAGENUMBER+"|"+NODE_TYPE.ENDNOTE+"|"+NODE_TYPE.FOOTNOTE),function(e,t){var i=0;if(e.length>1)for(var n,r,o=e.length;i<o;i++){var a=e[i].nodeLines;if(a.length&&(n=a[0].absStart,r=ZWArrayUtils.lastElementOf(a).absEnd,n<=t&&t<r||i+1==e.length))break}return e[i]}),o=function(e){for(var t=e;t&&t.prev;)t=t.prev,t.updatePageCountInViews();for(t=e.next;t;)t.updatePageCountInViews(),t=t.next;for(t=e.next;t&&t.shouldContinuePageNumber();)t.updatePageNumberInViews(),t=t.next},a=function(e,t){this.pageViewMap[e.id]=e,this.trigger(DOCVIEW.PAGE_CREATED,e),o.call(this,t)},s=function(e,t){delete this.pageViewMap[e.id],this.trigger(DOCVIEW.PAGE_REMOVED,e),o.call(this,t)},l=function(e){this.updateMaxPagesWidth(e,OP_TYPE.CREATE),this.trigger(DOCVIEW.SECTION_ADDED,e)},d=function(e){this.trigger(DOCVIEW.SECTION_REMOVED,e),this.updateMaxPagesWidth(e,OP_TYPE.REMOVE)},c=function(e){this.trigger(DOCVIEW.VIEW_BEFORE_CREATE,e)},u=function(e){this.trigger(DOCVIEW.VIEW_BEFORE_UPDATE,e)},g=function(e){this.trigger(DOCVIEW.VIEW_BEFORE_REMOVE,e)},h=function(e){this.trigger(DOCVIEW.VIEW_ATTACHED,e)},f=function(e){this.trigger(DOCVIEW.VIEW_AFTER_CREATE,e)},p=function(e){this.trigger(DOCVIEW.VIEW_AFTER_UPDATE,e)},E=function(e){this.trigger(DOCVIEW.VIEW_ADJUST_BORDER,e)},T=function(e){this.trigger(DOCVIEW.VIEW_DETACHED,e)},O=function(e){this.trigger(DOCVIEW.VIEW_TOP_UPDATED,e)},m=function(e){this.trigger(DOCVIEW.LINE_ADDED,e)},I=function(e){this.trigger(DOCVIEW.LINE_UPDATED,e)},D=function(e){this.trigger(DOCVIEW.LINE_STYLE_UPDATED,e)},R=function(e){this.trigger(DOCVIEW.LINE_BEFORE_REMOVE,e)},S=function(e){this.trigger(DOCVIEW.LIST_NUMBER_CHANGED,e)},C=function(e){e.on(DOCVIEW.PAGE_CREATED,a,this),e.on(DOCVIEW.PAGE_REMOVED,s,this),e.on(DOCVIEW.SECTION_ADDED,l,this),e.on(DOCVIEW.SECTION_REMOVED,d,this),e.on(DOCVIEW.VIEW_BEFORE_CREATE,c,this),e.on(DOCVIEW.VIEW_BEFORE_UPDATE,u,this),e.on(DOCVIEW.VIEW_BEFORE_REMOVE,g,this),e.on(DOCVIEW.VIEW_ATTACHED,h,this),e.on(DOCVIEW.VIEW_DETACHED,T,this),e.on(DOCVIEW.VIEW_TOP_UPDATED,O,this),e.on(DOCVIEW.VIEW_AFTER_CREATE,f,this),e.on(DOCVIEW.VIEW_AFTER_UPDATE,p,this),e.on(DOCVIEW.VIEW_ADJUST_BORDER,E,this),e.on(DOCVIEW.LINE_ADDED,m,this),e.on(DOCVIEW.LINE_UPDATED,I,this),e.on(DOCVIEW.LINE_STYLE_UPDATED,D,this),e.on(DOCVIEW.LINE_BEFORE_REMOVE,R,this),e.on(DOCVIEW.LIST_NUMBER_CHANGED,S,this)},A=function(e){e.off(DOCVIEW.PAGE_CREATED,a,this),e.off(DOCVIEW.PAGE_REMOVED,s,this),e.off(DOCVIEW.SECTION_ADDED,l,this),e.off(DOCVIEW.SECTION_REMOVED,d,this),e.off(DOCVIEW.VIEW_BEFORE_CREATE,c,this),e.off(DOCVIEW.VIEW_BEFORE_UPDATE,u,this),e.off(DOCVIEW.VIEW_BEFORE_REMOVE,g,this),e.off(DOCVIEW.VIEW_ATTACHED,h,this),e.off(DOCVIEW.VIEW_DETACHED,T,this),e.off(DOCVIEW.VIEW_TOP_UPDATED,O,this),e.off(DOCVIEW.VIEW_AFTER_CREATE,f,this),e.off(DOCVIEW.VIEW_AFTER_UPDATE,p,this),e.off(DOCVIEW.VIEW_ADJUST_BORDER,E,this),e.off(DOCVIEW.LINE_ADDED,m,this),e.off(DOCVIEW.LINE_UPDATED,I,this),e.off(DOCVIEW.LINE_STYLE_UPDATED,D,this),e.off(DOCVIEW.LINE_BEFORE_REMOVE,R,this),e.off(DOCVIEW.LIST_NUMBER_CHANGED,S,this)};return t.call(i.prototype),extend(i.prototype,{init:function(){this.setPageOffset({top:0,left:0,gap:PAGE.GAP}),this.initLayoutFunctions(),this.trigger(DOCUMENT.LAYOUT_MANAGER_INITIALIZED,this),this.initDTViews()},initDTViews:function(){var e=this.dtViewManager.getAllMetaDTViews();for(var t in e)this.addSectionView(e[t]);var i=this.dtViewManager.getAllHeaderFooterDTViews();for(var n in i)this.addSectionView(i[n]);for(var r=this.dtViewManager.getFirstContentDTView();r;)this.addSectionView(r),r=r.next},initLayoutFunctions:function(){var e=this.getDocumentViewType();if(DocumentLayoutManager.resetPrototype(this.prototypesOverridden),this.maxPagesWidth=0,isHeadlessPDF)this.docTree.getModel().isSamePaperSizedDocument()?DocumentLayoutManager.appendPrototype(PageLayoutManager,this.prototypesOverridden):DocumentLayoutManager.appendPrototype(PDFLayoutManager,this.prototypesOverridden);else switch(e){case EDITORVIEW_TYPE.PAGE_VIEW:case EDITORVIEW_TYPE.FIXED_VIEW:DocumentLayoutManager.appendPrototype(PageLayoutManager,this.prototypesOverridden);break;case EDITORVIEW_TYPE.WEB_VIEW:DocumentLayoutManager.appendPrototype(WebLayoutManager,this.prototypesOverridden);break;case EDITORVIEW_TYPE.PUBLISH_VIEW:DocumentLayoutManager.appendPrototype(PublishLayoutManager,this.prototypesOverridden)}},bindEvents:function(){this.dtViewManager.on(DTVIEW.SECTION_ADDED,this.addSectionView,this),this.dtViewManager.on(DTVIEW.SECTION_UPDATED,this.updateSectionView,this),this.dtViewManager.on(DTVIEW.SECTION_REMOVED,this.handleRemoveSectionView,this),this.dtViewManager.on(DOCUMENT.REFRESH_TREE,this.handleRefreshTree,this),this.dtViewManager.on(DOCUMENT.BEFORE_TREE_DESTROY,this.handleBeforeTreeReset,this),this.dtViewManager.on(DOCUMENT.AFTER_TREE_DESTROY,this.handleAfterTreeReset,this),this.dtViewManager.on(DOCUMENT.REFRESH_DOCVIEWS,this.handleRefreshTree,this),this.dtViewManager.on(DOCUMENT.DTVIEWMANAGER_DESTROYED,this.destroy,this)},unbindEvents:function(){this.dtViewManager.off(DTVIEW.SECTION_ADDED,this.addSectionView,this),this.dtViewManager.off(DTVIEW.SECTION_UPDATED,this.updateSectionView,this),this.dtViewManager.off(DTVIEW.SECTION_REMOVED,this.handleRemoveSectionView,this),this.dtViewManager.off(DOCUMENT.REFRESH_TREE,this.handleRefreshTree,this),this.dtViewManager.off(DOCUMENT.BEFORE_TREE_DESTROY,this.handleBeforeTreeReset,this),this.dtViewManager.off(DOCUMENT.AFTER_TREE_DESTROY,this.handleAfterTreeReset,this),this.dtViewManager.off(DOCUMENT.REFRESH_DOCVIEWS,this.handleRefreshTree,this),this.dtViewManager.off(DOCUMENT.DTVIEWMANAGER_DESTROYED,this.destroy,this)},getPageOffset:function(){return this.pageOffset},setPageOffset:function(e){this.pageOffset={top:e.top||0,left:e.left||0,gap:e.gap||0}},addSectionView:function(e){switch(e.getSectionType()){case SECTION_TYPES.CONTENT:this.createContentSection(e);break;case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:e.on(DTVIEW.SECTION_BUILD_STARTED,this.handleSectionOpStart,this)}this.handleAddSectionViewComplete(e)},updateSectionView:function(e,t,i){switch(e.getSectionType()){case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:case SECTION_TYPES.TEXTBOX:this.paginate();break;case SECTION_TYPES.CONTENT:if(this.handleContentDTViewUpdate(e,t,i),this.paginate(),DTUtils.isLayoutPropUpdated(t)){var n=this.getSectionViews(e.getId())[0],r=n.getGroup();r==this.getCurrentGroup()&&this.trigger(DOCVIEW.CURRENT_GROUP_LAYOUT_CHANGED,r)}break;case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:this.handleNoteDTViewUpdate(e,t,i),this.paginate()}},refreshDTSection:function(e){this.removeSectionView(e),this.addSectionView(e)},splitGroupAt:function(e){do this.refreshDTSection(e),e=e.next;while(e&&e.isContinuousSection())},mergeGroups:function(e,t){if(null!=e&&null!=t)for(var i,n=e.getFirstContentDTView();n&&(i=this.getGroupFromDTView(n),i===e);)this.refreshDTSection(n),n=n.next},handleContentDTViewUpdate:function(e,t,i){if("undefined"==typeof i[ATTR_SECTION.HF_TYPE]||"undefined"==typeof t[ATTR_SECTION.HF_TYPE]||t[ATTR_SECTION.HF_TYPE]===i[ATTR_SECTION.HF_TYPE]){var n=this.getSectionViews(e.getId())[0],r=n.getGroup();if(!this.isContinuousLayout()&&t[ATTR_SECTION.BREAK_TYPE]&&t[ATTR_SECTION.BREAK_TYPE]!==i[ATTR_SECTION.BREAK_TYPE])e.isContinuousSection()?this.mergeGroups(r,r.getPrevGroup()):this.splitGroupAt(e);else{for(var o,a=[ATTR_SECTION.PW,ATTR_SECTION.PH,ATTR_SECTION.OR,ATTR_SECTION.HEADER_IDS,ATTR_SECTION.FOOTER_IDS,ATTR_SECTION.MT,ATTR_SECTION.MR,ATTR_SECTION.MB,ATTR_SECTION.ML,ATTR_SECTION.GUTTER,ATTR_SECTION.HT,ATTR_SECTION.FB,ATTR_SECTION.HF_TYPE],s=!1,l=!1,d=0;d<a.length;d++)if(o=a[d],t[o]&&t[o]!==i[o]){if(r.getFirstSection().getNodeId()===e.getId()){s=!0;break}o!==ATTR_SECTION.MR&&o!==ATTR_SECTION.ML||(l=!0)}s?this.handleRefreshTree():t[ATTR_SECTION.COLS]&&!ZWJSONUtils.compareJSON(t[ATTR_SECTION.COLS],i[ATTR_SECTION.COLS])||l?r.rebuildDTSection(e):ZWJSONUtils.compareJSON(t[ATTR_COMMON.BORDERS]||{},i[ATTR_COMMON.BORDERS]||{})?t[ATTR_BODY.DS_PAGENUMBER]&&!ZWJSONUtils.compareJSON(t[ATTR_BODY.DS_PAGENUMBER],i[ATTR_BODY.DS_PAGENUMBER])&&r.updatePageNumberInViews():r.getFirstContentDTView().getId()===e.getId()&&r.updateBorders()}}},handlePageBackgroundUpdate:function(){this.trigger(DOCUMENT.PAGE_BACKGROUND_CHANGED)},handleNoteDTViewUpdate:function(e,t,i){var n,r=this.getSectionViews(e.getId())[0],o=r.getGroup(),a=r.getContainingPara();for(n in t)switch(n){case"st":o.handleNoteTypeChange(e,a);break;case"refchar":}},getDocumentViewType:function(){return this.viewType},isPageView:function(){return this.getDocumentViewType()===EDITORVIEW_TYPE.PAGE_VIEW},isWebView:function(){return this.getDocumentViewType()===EDITORVIEW_TYPE.WEB_VIEW},isFixedView:function(){return this.getDocumentViewType()===EDITORVIEW_TYPE.FIXED_VIEW},isEditMode:function(){return this.docTree.isEditMode()},isFillMode:function(){return this.docTree.isFillMode()},getGroupFromDTView:function(e){if(!e)return null;var t=this.getSectionViews(e.getId());return t.length?t[0].getGroup():null},getPageDOMViewHeight:function(){},getPageContentContainerHeight:function(){},createContentSection:function(){},createHFSection:function(e){for(var t=this.getFirstGroup();t;)t.isReferingToReplicableView(e)&&t.addHFView(e),t=t.getNextGroup();e.off(DTVIEW.SECTION_BUILD_STARTED,this.handleSectionOpStart,this)},handleSectionOpStart:function(e){switch(e.getSectionType()){case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:this.createHFSection(e)}},handleRemoveSectionView:function(e,t){if(e.getSectionType()===SECTION_TYPES.CONTENT){var i=this.getSectionViews(e.getId())[0],n=i.getGroup(),r=i.isContinuousSection();if(this.removeSectionView(e),!r)for(;t;){var o=this.getGroupFromDTView(t);if(o!==n)break;this.refreshDTSection(t),t=t.next}}else this.removeSectionView(e)},removeSectionView:function(e){e.getSectionType();if(e.isReplicableView())for(var t=this.getFirstGroup();t;)t.doesDocSectionExist(e)&&t.removeSectionView(e),t=t.getNextGroup();else{var i=this.getSectionViews(e.getId());if(0===i.length)return;var n=i[0].group;n.removeSectionView(e),n.isEmpty()&&this.destroySectionGroup(n)}},handleRefreshTree:function(e){e&&e.view&&this.updateViewType(e.view),this.reset()},handleBeforeTreeReset:function(){this.docTreeDestroyInProgress=!0},handleAfterTreeReset:function(){this.docTreeDestroyInProgress=!1},createSectionGroup:function(e){var t=new SectionViewGroup(this,this.docTree);return C.call(this,t),e?this.groups.insertAfter(t,e):this.groups.insertAsFirst(t),t},destroySectionGroup:function(e){e.remove(),this.groups.remove(e),A.call(this,e),e.destroy()},updateViewType:function(e){this.viewType!==e&&(this.viewType=e,this.trigger(DOCUMENT.VIEW_CHANGED))},reset:function(){this.clear(),this.init(),this.paginate()},clear:function(){this.docTreeDestroyInProgress=!0;var e=this.dtViewManager.getAllMetaDTViews();for(var t in e)this.removeSectionView(e[t]);var i=this.dtViewManager.getAllHeaderFooterDTViews();for(var n in i)this.removeSectionView(i[n]);for(var r=this.dtViewManager.getLastContentDTView();r;)this.removeSectionView(r),r=r.prev;for(var o,a=this.getLastGroup();null!=a;)o=a.getPrevGroup(),this.destroySectionGroup(a),a=o;this.pageViewMap={},DocumentLayoutManager.resetPrototype(this.prototypesOverridden),this.prototypesOverridden=[],this.docTreeDestroyInProgress=!1},destroy:function(){this.clear(),this.trigger(DOCUMENT.LAYOUT_MANAGER_DESTROYED),this.unbindEvents(),this.docTreeDestroyInProgress=!1,this.pageOffset=null,this.maxPagesWidth=0,this.prototypesOverridden=[],this._logger=null,this.waitingPaginationThread=-1,this.groups=null,this.pageViewMap={},this.viewType="",this.dtViewManager=null,this.docTree=null},isPagesPendingToPaginate:function(){for(var e=this.getFirstGroup();null!=e;){if(e.isPagesPendingToPaginate())return!0;e=e.next}return!1},paginate:function(){clearTimeout(this.waitingPaginationThread),this.waitingPaginationThread=-1;for(var e,t=this.getFirstGroup();null!=t;)e=t.getNextGroup(),editor.isDeferredDocLoading&&t.buildAllViewsInUpdateQueue(),t.paginate(),t.isEmpty()&&t.remove(),t=e;if(this.isPagesPendingToPaginate())this.triggerPagination();else{var i=!DocTreeManager.isContentSectionBuildInProgress(),n=this.isContentDTViewAddedToGroup(),r=this.waitingPaginationThread!=-1;i&&n&&!r&&("undefined"!=typeof EditorInitStart&&(editor.docClientInfo.RENDERING_COMPLETE=(performance.now()-EditorInitStart)/1e3),this.trigger(DOCUMENT.PAGINATION_COMPLETE))}},triggerPagination:function(){this.waitingPaginationThread!=-1&&(clearTimeout(this.waitingPaginationThread),this.waitingPaginationThread=-1),this.waitingPaginationThread=setTimeout(this.paginate.bind(this),10)},isContentDTViewAddedToGroup:function(){for(var e,t=this.dtViewManager.getFirstContentDTView();t;){if(e=this.getGroupFromDTView(t),!e)return!1;t=t.next}return!0},getViews:function(e,t){t=!!t;var i,n=e.id,r=this.dtViewManager.getDTViewById(n);if(r&&r.isReplicableView()&&(i=this.getCurrentGroup()?this.getCurrentGroup().getDocViews(n,!0):[],i.length))return i;for(var o=this.getFirstGroup();o;){if(i=o.getDocViews(n,!0),i.length)return t?i:o.sortDocViews(i);o=o.next}return[]},getSectionViews:function(e){var t=this.dtViewManager.getDTSectionViewByID(e);if(!t)return[];var i;if(t.isReplicableView()&&(i=this.getCurrentGroup()?this.getCurrentGroup().getDocViews(e):[],i.length))return i;for(var n=this.getFirstGroup();n;){if(i=n.getDocViews(e),i&&i.length>0)return i;n=n.next}return[]},getPageAtPageNumber:function(e){for(var t,i=this.getFirstGroup(),n=0;i;){if(n+=i.getPageCount(),n>=e)for(n-=i.getPageCount(),t=i.getFirstPage();t;){if(n++,n===e)return t;t=t.next}i=i.next}return null},getViewById:function(e,t){for(var i=this.groups.first,n=[];i;){n=i.getDocViews(e,!0);for(var r=0;r<n.length;r++)if(n[r].getId()===t)return n[r];i=i.next}return null},getIntervalFromIndex:function(e){var t=this.getLineAtIndex(e);if(!t)return!1;var i=e-t.getView().getNodeStartIndex()-t.start,n=t.getLevels()[i];return n%2!==0},getIndexAtLeft:function(e,t){var i=t.getParentNode(),n=i.getIndex(),r=t.getView(),o=t.getBlocks(),a=t.isLineDirectionRTL(),s=o.length;if(!s||e<0)return{index:n+t.start,isClosedInterval:!1};var l=t.getVisualOrder();if(e>r.getColumn().getWidth()){var d=n+ZWArrayUtils.lastElementOf(l);return d<i.getEndIndex()&&!a&&d++,{index:d,isClosedInterval:a}}if(e>r.getContentWidth()&&r.isRTLPara())return{index:t.absEnd===i.getEndIndex()?t.absEnd:t.end,isClosedInterval:!1};e-=r.getLeft()-r.getOuterLeft(),e-=t.getLeft();var c=t.getFirstNonEOPSubBlockInfo(),u=c.subBlock,g=l[0],h=0;e-=u.getDirectionalLeft(t);for(var f,p,E,T=h,O=l[T],m=!1,I=0,D=0;I<e&&t.start+T<=t.end;){if(D=I,O=l[T],E=m,p=l[T+1],O+1===l[T+1]||m){if(p=l[++T],null==p)break;m=!1}else p=l[T],m=!0;I=t.getWidthBetweenIndex(g,p,m)}if(f=t.getBlockAtIndex(l[T]),f&&f.isNonEditable)return{index:editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,n+l[T]),isClosedInterval:!1};if(I<e){var d=n+ZWArrayUtils.lastElementOf(l);return!a&&d<i.getEndIndex()&&d++,{index:d,isClosedInterval:a}}var R=I-D,S=editor.doc.getRawFormatAt(n+O),C=S&&S.type===NODE_TYPE.CONDITIONAL_IF_START;return R>0&&D+R/2>=e||C?(a&&!E&&(O++,E=!0),{index:n+O,isClosedInterval:E}):{index:n+l[T],isClosedInterval:m}},getLeftAtIndex:function(e,t,i,n){var r=t||this.getLineAtIndex(e);if(!r)return 0;var o=r.getParentNode(),a=r.isLineDirectionRTL(),s=o.getIndex(),l=o.getEndIndex(),d=e-s,c=0;switch(n){case VIEW.DOCUMENT:c+=DocLayoutManager.getAbsolutePageLeft(r.getPage());case VIEW.PAGE:var u=r.getParent();u&&(c+=u.getAbsLeft(VIEW.PAGE))}var g=r.getFirstNonEOPSubBlockInfo(),h=g.subBlock;if(!h)return 0;var f=r.getSublineOfSubBlock(h);if(!f||f.isFloating)return 0;var p=g.visualIndex;if(null==p||null==h)return 0;c+=h.getDirectionalLeft(r),o.isEmpty()?a&&(c+=r.getWidth()):e===l&&a||(p!==d||i)&&(c+=r.getWidthBetweenIndex(p,d,i)),c+=r.getLeft(),c+=r.getBorderWidthAndSpacing(ATTR_BORDERS.BORDER_LEFT,!0);var E=r.getView().getOuterWidth();return a&&c>E&&(c=E),c},blockAtIndex:function(e){for(var t=this.getLineAtIndex(e),i=t&&t.blocks,n=t&&t.parent.getIndex(),r=i&&i.length||0,o=0,a=i&&i[o];o<r&&a.end+n<=e;)a=i[o++];return a},getBlocksBetween:function(e,t){for(var i,n,r,o=this.linesBetween(e,t),a=[],s=this.blockAtIndex(e),l=this.blockAtIndex(t),d=s&&s.start+this.getLineAtIndex(e).parent.getIndex()||0,c=l&&l.end+this.getLineAtIndex(t).parent.getIndex()||0,u=0;u<o.length;u++){i=o[u],n=i.parent.getIndex(),r=i.blocks;for(var g,h=0,f=r.length;h<f;h++)g=r[h],g.start+n>=d&&g.end+n<=c&&a.push(g)}return a},getFirstImageIndexAtLineInIndex:function(e){var t=this.getLineAtIndex(e),i=-1;return t&&(i=t.getFirstImageIndex()),i},linesBetweenIndex:function(e,t,i){var n,r,o,a,s,l,d=[],c=i.getIndex(),u=i.children;for(n=u.length-1;n>=0;n--)if(i=u[n],i.start+c<t){o=n+1;break}for(a=u.length-1,n=0;n<u.length;n++)if(i=u[n],i.start+c>=e){a=n?n-1:n;break}for(n=a;n<o;n++)if(i=u[n],i.type==NODE_TYPE.PARA){s=this.getLinesFromPara(i),r=s.length,r&&e==s[r-1].absEnd&&d.push(s[r-1]);for(var g=0;g<r&&(l=s[g],(l.absStart<=e&&e<l.absEnd||e<l.absStart&&l.absEnd<=t||l.absStart<t&&t<l.absEnd)&&d.push(s[g]),!(s[g].absEnd>t));g++);}else{var h=this.linesBetweenIndex(e,t,i);for(g=0;g<h.length;g++)d.push(h[g])}return d},linesBetween:function(e,t){var i=this.docTree.getSectionAtIndex(e),n=this.linesBetweenIndex(e,t,i);if(0===n.length)return n;var r=this.getLineAtIndex(e);return r.start<n[0].start&&n.splice(0,0,r),n},getLinesInNode:function(e){for(var t=this.getViews(e)||[],i=[],n=0;n<t.length;n++)i=i.concat(t[n].cloneNodeLines());return i},getLines:function(e){return this.getLinesFromPara(this.docTree.paraNodeAtIndex(e))},getLinesFromPara:function(e){return this.getLinesInNode(e)},isWithinRange:function(e,t,i,n){return e<=i&&i<t||i<e&&t<=n||e<n&&n<t},getSectionsBetweenRange:function(e,t){for(var i=this.docTree.getSectionAtIndex(e),n=[];i&&e<=t;)n.push(i),e=i.getEndIndex()+1,i=this.docTree.getSectionAtIndex(i.getEndIndex()+1);return n},getNodesBetweenRange:function(e,t){for(var i=this.getSectionsBetweenRange(e,t),n=[],r=0;r<i.length;r++){var o=i[r].getIndex();o<e&&(o=e);var a=i[r].getEndIndex();a>t&&(a=t);for(var s=this.getViews(i[r]),l=0;l<s.length;l++)n=n.concat(s[l].getNodesBetweenRange(o,a))}return n},getRectsToDrawSelection:function(e,t,i){var n=[],r=e,o=t;if(e===t)for(var a=editor.doc.getCharAt(e);[UNICODE.SECTION,UNICODE.TABLE,UNICODE.TABLEEND,UNICODE.ROW,UNICODE.CELL,UNICODE.HR,UNICODE.TOCSTART,UNICODE.TOCEND].contains(a)&&(r--,o--,!(r<=0));)a=editor.doc.getCharAt(r);for(var s=this.getNodesBetweenRange(r,o),l=0;l<s.length;l++){var d=new ViewRect(s[l],RECT.SELECTION,{from:r,to:o,absoluteTo:i,actualFrom:e,actualTo:t});n.push(d.getRects())}return n},getLineAtIndex:function(e){try{if(!e)return ZWLogger.log("Error at finding lineAtIndex. Passed index has null value."),null;var t=editor.doc.getCharAt(e);editor.doc.getCharAt(e-1)!==UNICODE.PARA||t!==UNICODE.CELL&&t!==UNICODE.ROW&&t!==UNICODE.TABLEEND&&t!==UNICODE.TABLE&&t!==UNICODE.HR&&t!==UNICODE.TOCSTART&&t!==UNICODE.TOCEND||e--;var i=this.docTree.getSectionAtIndex(e);if(i&&i.getEndIndex()<e)return null;for(var n=i,r=function(e,t){return t>=e.start&&t<e.end?0:t<e.start?1:-1};n.children&&(n=Utils.binarySearch(n.children,r,e-=n.start),n.type!=NODE_TYPE.PARA););return Utils.binarySearch(this.getLinesInNode(n),r,e-=n.start)}catch(e){return null}},getColumnAtIndex:function(e){var t=this.getViewAtIndex(e);return t?t.getColumn():null},getPageAtIndex:function(e){var t=this.getSectionViewAtIndex(e);return t?t.getPage():null},getSectionViewWithResizeObjectAtIndex:function(e){var t=this.getViewContainingResizeObjectAtIndex(e),i=null;if(t&&(i=t.getSection(),i.isReplicableView())){var n=this.getCurrentGroup();i=n.getDocViews(i.getNodeId())[0]}return i},getViewContainingResizeObjectAtIndex:function(e){var t=this.docTree.getTreeNodeAtIndex(e),i=this.getViews(t)||[],n=this.docTree.doc.getRawFormatAt(e);if(!i.length)return null;if(t.getType()===NODE_TYPE.HR)return i[0].isBreaks()?null:i[0];if(t.getType()!==NODE_TYPE.PARA)return null;if(!DTUtils.isFloatingImage(n))return this.getViewAtIndex(e);for(var r=e-t.getIndex(),o=0;o<i.length;o++)if(i[o].getFloatImageForIndex(r))return i[o];return null},getViewAtIndex:function(e){var t=this.docTree.getTreeNodeAtIndex(e),i=this.getViews(t)||[];return i.length?i[0].getType()===VIEW.PARA?r(i,e):i[0]:null;},getMarginAtIndex:function(e){var t=this.getSectionViewAtIndex(e);return t?t.getMargin():null},getSectionLeftAtIndex:function(e){var t=this.getSectionViewAtIndex(e);return t?t.getLeft():0},getContentWidthAtIndex:function(e,t){var i=this.getSectionViewAtIndex(e);if(!i)return 0;var n=i.getSectionType();if(n==SECTION_TYPES.HEADER||n==SECTION_TYPES.FOOTER){t=t||this.getCurrentPageIdx()+1;var r=this.getPageAtPageNumber(t);i=r.getHFSection(n)}return i.getWidth()},getContentHeightAtIndex:function(e,t){var i=this.getSectionViewAtIndex(e),n=i.getSectionType(),r=i.getPage();return n!=SECTION_TYPES.HEADER&&n!=SECTION_TYPES.FOOTER||(t=t||this.getCurrentPageIdx()+1,r=this.getPageAtPageNumber(t)),r.getMaxContentHeight()},getPageWithId:function(e){return this.pageViewMap[e]||null},getFirstGroup:function(){return this.groups.first||null},getLastGroup:function(){return this.groups.last||null},getFirstPage:function(){return this.getFirstGroup()&&this.getFirstGroup().getFirstPage()||null},getLastPage:function(){return this.getLastGroup()&&this.getLastGroup().getLastPage()||null},getFirstPageHeight:function(){var e=this.getFirstPage();return e?e.getHeight():0},getFirstPageWidth:function(){var e=this.getFirstPage();return e?e.getWidth():0},getFirstSection:function(){return this.getFirstPage()&&this.getFirstPage().getFirstSection(SECTION_TYPES.CONTENT)||null},getLastSection:function(){return this.getLastPage()&&this.getLastPage().getLastSection(SECTION_TYPES.CONTENT)||null},getPageCount:function(){for(var e=this.groups.first,t=0;e;)t+=e.getPageCount(),e=e.next;return t},getAllPages:function(){return this.pageViewMap},getWidthFromNode:function(e){if("section"===e.type)return this.getContentWidthAtIndex(e.getIndex());var t=this.getViews(e)[0];return t?t.width:0},getHeightFromNode:function(e){var t=this.getViews(e),i=0;if(!t)return i;for(var n=0,r=t.length;n<r;n++)i+=t[n].getHeight();return i},canEdit:function(){return editor.getRole().permissions.can("document.edit")},getListData:function(e){var t=this.dtViewManager.getDTView(e);return t&&"para"===t.type?t.getListData():{}},isFixedLayout:function(){return EditorView.isWebView()},getDocTree:function(){return this.docTree},getSectionViewAtIndex:function(e){var t=this.docTree.getTreeNodeAtIndex(e);if(!t)return null;var i=this.getViews(t);if(!i.length)return null;var n,r=i[0],o=r.getType();if(o===VIEW.HR)return r.getSection();if(o===VIEW.PARA)n=i;else{var a=r.getFirstParaView();n=a?a.getViews():[]}e-=t.getIndex();for(var s=0;s<n.length;s++){var l=n[s];if(s+1===n.length)return l.getSection();if(l.getStart()<=e&&e<l.getEnd())return l.getSection()}return null},getColumnFormatAtIdx:function(e){var t=this.getSectionViewAtIndex(e);return t.getColumnFormat()},getColumnCountAtIdx:function(e){var t=this.getSectionViewAtIndex(e);return t.getColumnCount()},isEqualColumnWidthAtIdx:function(e){var t=this.getColumnFormatAtIdx(e);return t.iseqwidth},getColumnWidthAtIdx:function(e){var t=this.getColumnAtIndex(e);return t.getWidth()},getColumnWidthArrayAtIdx:function(e){var t=this.getSectionViewAtIndex(e);return t.getColumnWidthArray()},getColumnSpaceArrayAtIdx:function(e){var t=this.getSectionViewAtIndex(e);return t.getColumnSpaceArray()},getColumnSeparatorFormatAtIdx:function(e){var t=this.getSectionViewAtIndex(e);return t.getColumnSeparatorFormat()},getPageHeightAtIdx:function(e){var t=this.getPageAtIndex(e);return t?t.getHeight():0},getPageWidthAtIdx:function(e){var t=this.getPageAtIndex(e);return t?t.getWidth():0},getCurrentPageIdx:function(){var e=editor.currentPageIndex||0;return e>this.getPageCount()-1?this.getPageCount()-1:e},setCurrentPageIdx:function(){},updateMaxPagesWidth:function(e,t){var i=this.maxPagesWidth;switch(t){case OP_TYPE.CREATE:var n=e.getGroup();n.getPageWidth()>i&&(i=n.getPageWidth());break;case OP_TYPE.REMOVE:i=this.getMaxPagesWidth()}this.maxPagesWidth!==i&&(this.maxPagesWidth=i,this.trigger(DOCUMENT.MAX_PAGE_WIDTH_UPDATED,this.maxPagesWidth))},getMaxPagesWidth:function(){for(var e=this.getFirstGroup(),t=0,i=0;e;)t=e.getPageWidth(),t>i&&(i=t),e=e.next;return i},getPrevSection:function(e){if(e.getSectionType()!==SECTION_TYPES.CONTENT)return null;var t=e.getPrevSection();if(!t){var i=e.getPage().getPrevPage();if(t=i?i.getLastSection(SECTION_TYPES.CONTENT):null)return t;var n=e.getGroup().getPrevGroup();if(n)return n.getLastSection()}return t},getNextSection:function(e){if(e.getSectionType()!==SECTION_TYPES.CONTENT)return null;var t=e.getNextSection();if(!t){var i=e.getPage().getNextPage();if(t=i?i.getFirstSection(SECTION_TYPES.CONTENT):null)return t;var n=e.getGroup().getNextGroup();if(n)return n.getFirstSection()}return t},getNextPage:function(e){var t=e.getNextPage();if(!t){var i=e.group.getNextGroup();if(i)return i.getFirstPage()}return t},getPrevPage:function(e){var t=e.getPrevPage();if(!t){var i=e.group.getPrevGroup();if(i)return i.getLastPage()}return t},getNextColumn:function(e){var t=e.getNextView();if(!t){var i=this.getNextSection(e.getSection());if(i)return i.getFirstColumn()}return t},getPrevColumn:function(e){var t=e.getPrevView();if(!t){var i=this.getPrevSection(e.getSection());if(i)return i.getLastColumn()}return t},getViewHeight:function(e,t){if(!e)return 0;var i=0,n=e.getType();switch(n){case VIEW.TABLE:case VIEW.ROW:case VIEW.CELL:i=e.getHeight({includeMissedBorder:!0});break;default:i=e.getHeight()}return e.getType()===VIEW.PARA&&t&&(i+=e.getFootNoteHeight()),i},getAbsolutePageTop:function(e){var t=this.getPageOffset().gap,i=(e.getAbsolutePageNumber()-1)*t;for(e=this.getPrevPage(e);e;)i+=e.getHeight(),e=this.getPrevPage(e);return i+this.getPageOffset().top},getAbsolutePageLeft:function(e){return this.getPageOffset().left},getAbsolutePageHeight:function(e){return this.getAbsolutePageTop(e)+e.getHeight()},getCurrentPage:function(){var e=this.getCurrentPageIdx();return e>=0?this.getPageAtPageNumber(e+1):null},getCurrentSection:function(){var e=this.docTree.getCurrentSelectionIndex();return this.getSectionViewAtIndex(e)},getCurrentGutter:function(){var e,t=this.getCurrentSection(),i=this.getCurrentGroup();return e=t.getSectionType()==SECTION_TYPES.CONTENT?t.getGutter():i.getGutter(),e.position==GUTTER_POSITION.TOP&&(e=i.getGutter()),e},getCurrentColumn:function(){var e=this.docTree.getCurrentSelectionIndex();return this.getColumnAtIndex(e)},getCurrentGroup:function(){var e=null,t=this.getCurrentPage();return t&&(e=t.getGroup()),e},getCurrentLine:function(){var e=this.docTree.getCurrentSelectionIndex();return this.getLineAtIndex(e)},getCurrentView:function(e){var t=this.getCurrentLine().getView();if(t&&!e)return t;for(;t;){if(t.getType()===e)return t;t=t.getParent()}return null},isAReplicableViewAtIdx:function(e){var t=this.dtViewManager.getDTSectionViewByIndex(e);return t.isReplicableView()},getViewAtIdxWithType:function(e,t){var i=this.getLineAtIndex(e).getView();if(i&&!t)return i;for(;i;){if(i.getType()===t)return i;i=i.getParent()}return null},getAllRenderedLines:function(){for(var e=this.getFirstSection(),t=[],i=[];e;){i=e.getAllViewsOfGivenType(VIEW.PARA);for(var n=0;n<i.length;n++)t=t.concat(i[n].getNodeLines());e=this.getNextSection(e)}return t},getSectionGroupBorderInfo:function(){},handleAddSectionViewComplete:function(e){},getLayoutProps:function(){},getActualPageDimensions:function(){return this.getLayoutProps().actualPageDimensions},getBackgroundColor:function(){return Utils.getColorValFromRefString(this.docTree.getBackgroundColor())},hasBorderInAtLeastOneSection:function(){return!0},initColumnLayout:function(){},toggleFixedView:function(){var e=this.getDocumentViewType();return(e===EDITORVIEW_TYPE.PAGE_VIEW||e===EDITORVIEW_TYPE.FIXED_VIEW)&&(e=e===EDITORVIEW_TYPE.PAGE_VIEW?EDITORVIEW_TYPE.FIXED_VIEW:EDITORVIEW_TYPE.PAGE_VIEW,this.updateViewType(e),!0)},toggleWebView:function(){var e=this.getDocumentViewType();return e=e==EDITORVIEW_TYPE.WEB_VIEW?EDITORVIEW_TYPE.PAGE_VIEW:EDITORVIEW_TYPE.WEB_VIEW,this.updateViewType(e),this.reset(),!0},getViewsHeight:function(e,t){for(var i=0,n=this.getViews(e,!0),r=0;r<n.length;r++)i+=this.getViewHeight(n[r],t);return i},getPageRange:function(e){var t=this.getPageAtPageNumber(e);return t?t.getRange():null},getPageSizeAtIndex:function(e,t){var i=this.getSectionViewAtIndex(e),n=i.getSectionType();switch(n){case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:var r=t?this.getPageAtPageNumber(t):this.getCurrentPage();return r.getGroup().getPageSize();default:return i.getGroup().getPageSize()}},getPageOrientationAtIndex:function(e,t){var i=this.getSectionViewAtIndex(e),n=i.getSectionType();switch(n){case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:var r=t?this.getPageAtPageNumber(t):this.getCurrentPage();return r.getGroup().getPageOrientation();default:return i.getGroup().getPageOrientation()}},setImagePreviewEnabled:function(e){DocTreeManager.setImagePreviewEnabled(e)},isImagePreviewEnabled:function(){return DocTreeManager.isImagePreviewEnabled()},isEmbedMode:function(){return!1},hasEndNotes:function(){for(var e=this.getFirstGroup();e;){if(e.hasEndNotes())return!0;e=e.next}return!1},isSamePaperSizedDocument:function(){var e=this.getFirstGroup(),t=e.getPageOrientation(),i=parseInt(e.getPageHeight()),n=parseInt(e.getPageWidth());for(e=e.next;e;){if(t==e.getPageOrientation()){if(i!=parseInt(e.getPageHeight())||n!=parseInt(e.getPageWidth()))return!1}else if(i!=parseInt(e.getPageWidth())||n!=parseInt(e.getPageHeight()))return!1;e=e.next}return!0},isPageRotationAllowedInPDF:function(){return(isHeadlessPDF||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview())&&this.groups.length>1&&this.isSamePaperSizedDocument()},hasRotatedPageInDocument:function(){var e=!1;if(this.isPageRotationAllowedInPDF()){var t=this.getFirstGroup(),i=t.getPageOrientation();for(t=t.next;t;){if(i!=t.getPageOrientation()){e=!0;break}t=t.next}}return e},getRotatedPageNumbers:function(){var e=[];if(this.isPageRotationAllowedInPDF()){var t=this.getFirstGroup(),i=t.getPageOrientation();t=t.getNextGroup();for(var n;t;)t.getPageOrientation()!==i&&(n=t.getAbsolutePageNumbers(),e=e.concat(n)),t=t.getNextGroup()}return e},getVisiblePageNumbers:function(){return isV8Engine?n:DomViewManager.getVisiblePageNumbers()||[]},updateVisiblePageNumbers:function(e){isV8Engine&&(n=e)},getLeftRelativeToPageAtIndex:function(e){e=e||DocTreeManager.getCurrentSelectionIndex();var t=this.getLineAtIndex(e);return t.getAbsLeft()+this.getLeftAtIndex(e)+PAGE_LEFT_BORDER_WIDTH},getViewInPage:function(e,t){var i=this.getViews(e);if(i.length){if(HF_SECTIONS.contains(e.getSectionType()))return i[0];for(var n=0;n<i.length;n++)if(i[n].getPage()===t)return i[n]}return null},getRectsFromDocViews:function(e,t){for(var i=[],n=0;n<e.length;n++){var r=new ViewRect(e[n],RECT.SELECTION,{absoluteTo:t});i.push(r.getRects())}return i},isMirrorMargins:function(){return this.docTree.isMirrorMargins()},setPaginationAllowed:function(e){this.isPaginationAllowed=e},getPaginationAllowed:function(){return this.isPaginationAllowed},enableLogger:function(e){this._logger.enable(e)},disableLogger:function(){this._logger.disable()},logger:function(){return this._logger}}),i}(LinkedList,BaseEventHandler);DocumentLayoutManager.appendPrototype=function(e,t){for(var i in e.prototype)t.push(i),this.prototype[i]=e.prototype[i]},DocumentLayoutManager.resetPrototype=function(e){for(var t=e.length,i=0;i<t;i++)delete this.prototype[e[i]];e.splice(0,t)};var ViewRect=function(){function e(e,t,i){this.id=e.getId();var n=e.getParent();this.parentId=n?n.getId():null,this.rects=[],this.createRects(e,t,i)}var t={LTR:[0,8,11],RTL:[3,4,5,6,20]},i=function(e){for(var i in t)if(t[i].contains(e))return CONTENT_TYPE[i];return null};return e.prototype.createRects=function(e,t,i){switch(t){case RECT.SELECTION:var n=[];switch(e.getType()){case VIEW.LINE:n=this.computeLineSelectionRects(e,i);break;case VIEW.CELL:n.push({top:e.getTop(),left:0,height:e.getDOMViewHeight(),width:e.getDOMViewWidth()})}for(var r=0;r<n.length;r++)this.preProcessRect(e,i,n[r]),this.addRects(n[r]);break;case RECT.BACKGROUND:break;case RECT.BORDER:switch(e.getType()){case VIEW.PAGE:this.addRects(this.computePageBorderRect(e))}}},e.prototype.preProcessRect=function(e,t,i){switch(t.absoluteTo){case VIEW.DOCUMENT:i.top+=DocLayoutManager.getAbsolutePageTop(e.getPage()),i.left+=DocLayoutManager.getAbsolutePageLeft(e.getPage());case VIEW.PAGE:var n=e.getParent();i.top+=e.getAbsTop(VIEW.PAGE),n&&e.getType()===VIEW.LINE?i.left+=n.getAbsLeft(VIEW.PAGE):i.left+=e.getAbsLeft(VIEW.PAGE)}return i},e.prototype.splitRangesBasedOnCharacterTypes=function(e,t,n){for(var r=[],o=e.getTypes(),a=e.getView(),s=a.getNodeStartIndex(),l=null,d=null,c=e.getVisualOrder(),u=c.indexOf(t),g=null,h=!1,f=!1,p=t;p<=n;p++)l=i(o[p-e.start])||CONTENT_TYPE.LTR,u=c.indexOf(p),null!=g&&(l===CONTENT_TYPE.LTR&&g+1!==u?h=!0:l===CONTENT_TYPE.RTL&&g-1!==u&&(h=!0)),(d&&l!==d||h)&&(r.push({index:p+s-1,isClosed:d===CONTENT_TYPE.LTR}),r.push({index:p+s,isClosed:l!==CONTENT_TYPE.LTR}),p===n&&(f=!0)),p===t?r.push({index:p+s,isClosed:l!==CONTENT_TYPE.LTR}):p===n&&(f?r.push({index:p+s,isClosed:l===CONTENT_TYPE.LTR}):r.push({index:p+s-1,isClosed:l===CONTENT_TYPE.LTR})),d=l,g=u,h=!1;return r},e.prototype.computeLineSelectionRects=function(e,t){var i,n=t.from||e.absStart,r=t.to||e.absEnd;i=null!=t.actualTo?t.actualTo:t.to,n<e.absStart&&r>=e.absStart&&(n=e.absStart),r>e.absEnd&&n<=e.absEnd&&(r=e.absEnd);var o=e.absEnd===e.parent.getEndIndex()&&i>e.parent.getEndIndex(),a=[],s=n-e.absStart,l=r-e.absStart,d=this.splitRangesBasedOnCharacterTypes(e,s+e.start,l+e.start);if(d.length>1)for(var c=0;c<d.length;c+=2){var u,g=DocLayoutManager.getLeftAtIndex(d[c].index,e,d[c].isClosed),h=DocLayoutManager.getLeftAtIndex(d[c+1].index,e,d[c+1].isClosed);g>h&&(u=g,g=h,h=u);var f=h-g;a.push({top:0,left:g,height:e.getSelectionHeight(),width:f})}else if(1===d.length&&!o){var g=DocLayoutManager.getLeftAtIndex(d[0].index,e,d[0].isClosed);a.push({top:0,left:g,height:e.getSelectionHeight(),width:0})}if(o){var p=e.getEOPBlock();if(p){var E=p.subBlocks[0];g=e.getLeft()+E.getDirectionalLeft(e),g+=e.getBorderWidthAndSpacing(ATTR_BORDERS.BORDER_LEFT,!0),e.view.isRTLPara()&&(g-=CONST_VIEW.EOP_SELECT_WIDTH),a.push({top:0,left:g,height:e.getSelectionHeight(),width:CONST_VIEW.EOP_SELECT_WIDTH})}}return a},e.prototype.computePageBorderRect=function(e){var t=e.getPageBorders();if(null==t)return null;var i,n=e.getContentTop(),r=e.getContentLeft(),o=e.getPaginationHeight(),a=e.getContentWidth(),s=DocUtils.getBorderWidthAndSpacing(t[ATTR_BORDERS.BORDER_TOP]),l=DocUtils.getBorderWidthAndSpacing(t[ATTR_BORDERS.BORDER_LEFT]),d=e.getHeader(),c=e.getFooter(),u=DocLayoutManager.getCurrentSection();i=u?u.getSectionType():SECTION_TYPES.CONTENT;var g=t.surroundHeader&&(d&&d.getNode().hasContent()||i===SECTION_TYPES.HEADER),h=t.surroundFooter&&(c&&c.getNode().hasContent()||i===SECTION_TYPES.FOOTER);if(g){var f=e.getHeaderHeight()-e.getHeaderTop();o+=f,n-=f}h&&(o+=e.getFooterHeight()-e.getFooterBottom()),o+=s,o+=DocUtils.getBorderWidthAndSpacing(t[ATTR_BORDERS.BORDER_BOTTOM]),a+=DocUtils.getBorderWidthAndSpacing(t[ATTR_BORDERS.BORDER_LEFT]),a+=DocUtils.getBorderWidthAndSpacing(t[ATTR_BORDERS.BORDER_RIGHT]),n-=s,r-=l,n<0&&(n=0),r<0&&(r=0);var p=e.getDOMViewHeight(),E=e.getDOMViewWidth();return a+r>E&&(a=E-r),o+n>p&&(o=p-n),{top:n,left:r,height:o,width:a,radius:t[ATTR_BORDERS.BORDER_RADIUS]}},e.prototype.addRects=function(e){e&&this.rects.push({top:e.top,left:e.left,height:e.height,width:e.width,borderRadius:e.radius})},e.prototype.getRects=function(){return{id:this.id,parentId:this.parentId,rects:this.rects}},e}(),SectionViewGroup=function(e){"use strict";function t(e,t,i){var n=0;return"a4"==e&&t>i?n=2:"executive"==e||"a5"==e?i>t&&(n=1):"b5"==e&&t>i?n=1:"a3"==e&&(n=1),n}function i(e,t){this.id=Utils.randomId("group"),this.documentLayoutManager=e,this.docTree=t,this.headerTop=0,this.footerBottom=0,this.margin={},this.gutter={},this.pageDimensions={},this.actualPageDimensions={},this.inProgressSection={},this.firstContentDTView=null,this[SECTION_TYPES.CONTENT]={},this[SECTION_TYPES.HEADER]={},this[SECTION_TYPES.FOOTER]={},this[SECTION_TYPES.FOOTNOTE]={},this[SECTION_TYPES.ENDNOTE]={},this[SECTION_TYPES.TEXTBOX]={},this.docViewMap=new CustomJSON,this.pages=new LinkedList,this.pagesToPaginate=[],this.canPaginate=!0,this.viewBuildInProgress={},this.bindEvents()}var n={header:10,footer:9,content:8,endnote:7,footnote:6,textbox:5},r=function(e,t){var i=e.section,r=t.section,o=i.getSectionType(),a=r.getSectionType();if(n[o]>n[a])return-1;if(n[o]<n[a])return 1;switch(o){case SECTION_TYPES.CONTENT:var s=i.getPage().getRelativePageNumber(),l=r.getPage().getRelativePageNumber();return s===l?i.getDTView().getIndex()-r.getDTView().getIndex():s-l;case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:case SECTION_TYPES.TEXTBOX:return i.getDTView().getRangeIndex()-r.getDTView().getRangeIndex();default:return i.getDTView().getIndex()-r.getDTView().getIndex()}};return e.call(i.prototype),extend(i.prototype,{updateLayoutProps:function(e){var t=this.documentLayoutManager.getLayoutProps(e);this.headerTop=t.headerTop,this.footerBottom=t.footerBottom,this.margin=t.margin,this.gutter=t.gutter,this.pageDimensions=t.pageDimensions,this.actualPageDimensions=t.actualPageDimensions,this.trigger(DOCVIEW.SECTIONGROUP_LAYOUT_CHANGED)},handleViewTypeUpdate:function(){this.updatePageHeightForLayoutChange(),this.updateBorders(),this.updateHeaderFooterVisibility()},updatePageHeightForLayoutChange:function(){for(var e=this.getFirstPage();e;)e.updatePageHeight(),e.updateContentContainerHeight(),e=e.next},updateHeaderRowInAllTableViews:function(e){for(var t=e.getViews(),i=0;i<t.length;i++){var n=t[i];n.getId()!==e.getId()&&n.propagateVia(n.documentLayoutManager,DOCVIEW.TABLE_HEADER_ROW_UPDATED,n,n.getHeaderRow())}},updateBorders:function(){var e=this.documentLayoutManager.getSectionGroupBorderInfo(this);if(!ZWJSONUtils.compareJSON(this.borders,e)){if(e){var t=e[ATTR_BORDERS.BORDER_DISPLAY];t&&(e[ATTR_BORDERS.BORDER_DISPLAY]=parseInt(t))}this.borders=e,this.trigger(GROUP.PAGE_BORDER_CHANGED)}},updateHeaderFooterVisibility:function(){this.trigger(GROUP.HF_VISIBILITY_UPDATE,HF_SECTIONS)},getPageToAppendContentSection:function(e){var t=e.prev;if(t){var i=this.getDocViews(t.getId()),n=ZWArrayUtils.lastElementOf(i);if(n&&n.getGroup()==this)return n.getPage()}return this.updateLayoutProps(e),this.updateBorders(),0===this.getPageCount()&&this.createPage(),this.getFirstPage()},getDocTree:function(){return this.docTree},rebuildDTSection:function(e){for(var t,i=this.getDocViews(e.getId()),n=i.length-1;n>=0&&(t=i[n],t.cleanSection(!0,!0,!0),0!==n);n--)this.removePaginationInfo(t),this.removeDocSectionView(t);t.create(),t.refresh(),this.canPaginateGroup(e)&&this.paginate()},addContentSectionView:function(e){this.addToSectionInProgressMap(e),this.bindSectionViewEvent(e),(!this.firstContentDTView||this.firstContentDTView.getIndex()>e.getIndex())&&this.updateFirstContentDTView(e);var t=this.getPageToAppendContentSection(e),i=this.createDocSectionView(e,t);this.addSectionToPage(i,t),i.refresh(),this.canPaginateGroup()&&this.paginate(),this.removefromSectionInProgressMap(e)},removeSectionView:function(e){e.getSectionType()==SECTION_TYPES.CONTENT&&this.firstContentDTView&&this.firstContentDTView.getId()===e.getId()&&this.updateFirstContentDTView(null),this.removeAllDocSectionView(e),this.unbindSectionViewEvent(e),e.isReplicableView()||!this.canPaginateGroup(e)||this.documentLayoutManager.docTreeDestroyInProgress||this.paginate()},updateFirstContentDTView:function(e){this.firstContentDTView&&this.removeContentSectionHFViews(),e?(this.firstContentDTView=e,this.updateLayoutProps(this.firstContentDTView),this.updateBorders(),this.updateContentSectionHFViews()):this.firstContentDTView=null},updateContentSectionHFViews:function(){for(var e,t,i,n=0;n<HF_SECTIONS.length;n++){i=HF_SECTIONS[n],e=this.getComputedHFIds(i);for(var r=0,o=e.length;r<o;r++)t=this.getDTViewManager().getDTSectionViewByID(e[r]),t&&!this[i][e[r]]&&this.addHFView(t)}},removeContentSectionHFViews:function(){for(var e,t,i=0;i<HF_SECTIONS.length;i++){t=HF_SECTIONS[i];var n=this[t];for(var r in n)e=n[r][0],e&&this.removeSectionView(e.getDTView())}},isReferingToReplicableView:function(e){var t=!1;return this.firstContentDTView&&(t=e.isReferingTo(this.firstContentDTView)),t},addHFView:function(e){this.addToSectionInProgressMap(e);var t=this.getHFView(e.getSectionType(),e.getHFType());t&&this.removeSectionView(t.getDTView()),this.bindSectionViewEvent(e);var i=this.createDocSectionView(e);this.addSectionToPage(i),i.refresh(),this.removefromSectionInProgressMap(e)},addToSectionInProgressMap:function(e){this.inProgressSection[e.getId()]=e},removefromSectionInProgressMap:function(e){delete this.inProgressSection[e.getId()]},isSectionInProgressMap:function(e){return!!this.inProgressSection[e]},buildReferenceMetaSection:function(e,t){var i=this.getDTViewManager().getDTSectionViewByID(t);if(i)if(this.doesDocSectionExist(i)){var n=i.getSectionType(),r=this[n][i.getId()][0];n==SECTION_TYPES.TEXTBOX&&r.isLayoutChanged()&&this.rebuildDTSection(i);for(var o,a,s=r.getContainingPara(),l=0;l<s.nodeLines.length;l++){o=s.nodeLines[l],a=o.getMetaSectionByType(n);for(var d=0;d<a.length;)i.getId()===a[d].id?o[n].splice(d,1):d++}if(n==SECTION_TYPES.TEXTBOX&&r.getPage()!==e.getPage()){var c=r.getPage();c.getPrevPage()&&c.getPrevPage().removeOutGoingTextboxFromPrevPages(r.getId()),this.removeSectionFromPage(r),this.addSectionToPage(r,e.getPage())}r.setContainingParaReference(e,e.getNode())}else this.addMetaView(i,e);var u=this.getDocTree().getSectionWithSid(t);u.build()},findPageForMetaView:function(e,t){var i;switch(e.getSectionType()){case SECTION_TYPES.FOOTNOTE:case SECTION_TYPES.TEXTBOX:i=t.getPage();break;case SECTION_TYPES.ENDNOTE:i=this.getLastPage();for(var n=i.prev;n;){if(n.hasEndNotes()){var r=n.getLastSection(SECTION_TYPES.ENDNOTE).getDTView();if(e.getRangeIndex()<r.getRangeIndex()){i=n,n=i.prev;continue}}break}}return i},handleNoteTypeChange:function(e,t){this.removeSectionView(e),this.addMetaView(e,t)},bindSectionViewEvent:function(e){e.on(DTVIEW.VIEW_ADDED,this.onViewAddedToDTSectionView,this),e.on(DTVIEW.VIEW_LIST_UPDATED,this.onViewListUpdatedInDTSectionView,this),e.on(DTVIEW.VIEW_UPDATED,this.onViewUpdatedInDTSectionView,this),e.on(DTVIEW.VIEW_REMOVED,this.onViewRemovedFromDTSectionView,this),e.on(DTVIEW.VIEW_ADJUST_BORDER,this.onViewAdjustBorder,this),e.on(DTVIEW.NOTE_CHAR_UPDATED,this.handleNoteCharUpdate,this),e.on(DTVIEW.SECTION_BUILD_STARTED,this.handleSectionOpStart,this),e.on(DTVIEW.SECTION_BUILD_COMPLETE,this.handleSectionOpComplete,this),e.on(DTVIEW.SECTION_BUILD_PRE_PROCESS_STARTED,this.handleSectionBuildPreProcessStart,this),e.on(DTVIEW.SECTION_BUILD_PRE_PROCESS_COMPLETE,this.handleSectionBuildPreProcessComplete,this)},unbindSectionViewEvent:function(e){e.off(DTVIEW.VIEW_ADDED,this.onViewAddedToDTSectionView,this),e.off(DTVIEW.VIEW_LIST_UPDATED,this.onViewListUpdatedInDTSectionView,this),e.off(DTVIEW.VIEW_UPDATED,this.onViewUpdatedInDTSectionView,this),e.off(DTVIEW.VIEW_REMOVED,this.onViewRemovedFromDTSectionView,this),e.off(DTVIEW.VIEW_ADJUST_BORDER,this.onViewAdjustBorder,this),e.off(DTVIEW.NOTE_CHAR_UPDATED,this.handleNoteCharUpdate,this),e.off(DTVIEW.SECTION_BUILD_STARTED,this.handleSectionOpStart,this),e.off(DTVIEW.SECTION_BUILD_COMPLETE,this.handleSectionOpComplete,this),e.off(DTVIEW.SECTION_BUILD_PRE_PROCESS_STARTED,this.handleSectionBuildPreProcessStart,this),e.off(DTVIEW.SECTION_BUILD_PRE_PROCESS_COMPLETE,this.handleSectionBuildPreProcessComplete,this)},preBalancingColumnProcess:function(e){this.logger().log("Pre balancing column process :: %c"+e.getId(),"color:"+COLOUR.GREEN);var t=e.getPrevView();if(!t)return void this.logger().log("Pre balancing process :: No prev column");for(var i=e.getFirstChild(),n=t.getLastChild();i;)n&&(n.getId()!==i.getId()||t.getPage().hasOutGoingFootnotes())&&n.getNodeId()===i.getNodeId()?t.mergeViews(i):(i.removeNodeLines(),i.addToUpdateQueue(OP_TYPE.UPDATE,!0),t.moveView(i,e)),i=e.getFirstChild(),n=t.getLastChild();e.removeAllChildViews(!0,!0)},preBalancingProcess:function(e,t){this.logger().log("Pre balancing process :: %c"+e.getId(),"color:"+COLOUR.GREEN);var i=e.getLastColumn();if(i){var n,r=i.getPrevView(),o=e.getFirstColumn();for(o&&(n=t&&t.getColumn().getId()===o.getId()?t.getNextView():o.getFirstChild());i&&r;)this.preBalancingColumnProcess(i,e),i=e.getLastColumn(),r=i.getPrevView();if(!o)return void this.logger().warn("Pre balancing process :: Exit without single column");for(var a;n;)a=n.getNextView(),n.refresh(),n=a}},findDocRelationshipDetailsFromDTView:function(e){var t,i,n,r,o,a=null,s=[];if(e.prev)for(t=e.prev;t&&(s=this.getDocViews(t.id),!(s.length>0));)t=t.prev;if(s.length){var l;l=e.getType()===VIEW.CELL?s[0]:s[s.length-1],a=l.section,i=l.column,n=l.parent}else r=e.parent,o=this.getDocViews(r.id),n=o[0],n.getType()===VIEW.SECTION?(a=n,n.getFirstColumn()||n.createColumn(),i=n.getFirstColumn(),i||(n.createColumn(),i=n.getFirstColumn()),n=i):(a=n.section,i=n.column);return{column:i,section:a,parent:n}},buildAllViewsInUpdateQueue:function(){for(var e=this.getFirstPage();e;)e.buildAllViewsInUpdateQueue(),e=e.getNextPage()},buildAllDocViewsOfDTView:function(e,t){var i=t.getSection();if(this.shouldBuildDocViews(i)){var n=t;if(t.getType()===VIEW.PARA){var r=!1;do if(n.getSection().buildChildViews(),n=ZWArrayUtils.lastElementOf(this.getDocViews(e.getId())),r=n&&n.isViewsBuilt(),!r&&(n&&!n.getSection().isAnySplitViewsInUpdateQueue(n)&&n.addToUpdateQueue(OP_TYPE.UPDATE),!this.canPaginateGroup(e.getSection())))break;while(!r)}else do{var o=n.getSection();o.buildChildViews(),n=null;var a=o.getNextSection();if(a)for(var s=this.getDocViews(e.getId()),l=0;l<s.length;l++)if(s[l].getSection()===a){n=s[l];break}}while(n)}},shouldBuildDocViews:function(e){return!(isHeadlessPDF&&!this.canPaginateGroup(e))},onViewAddedToDTSectionView:function(e){var t=this.findDocRelationshipDetailsFromDTView(e),i=t.section;i.addToSectionView(e,i,t.column,t.parent,{isUserOperation:!0});var n=this.getDocViews(e.getId()),r=n.length?n[0]:null;i.addToPaginationQueue(r.getColumn()),this.buildAllDocViewsOfDTView(e,r)},onViewListUpdatedInDTSectionView:function(e){var t=this.getDocViews(e.getId());if(t.length){var i=t[0],n=i.getSection();n.updateListInSectionView(i,{isUserOperation:!0}),n.addToPaginationQueue(i.getColumn())}this.buildAllDocViewsOfDTView(e,i)},onViewUpdatedInDTSectionView:function(e,t){this.logger().log("On view update in dtsection section view %c"+e.getId(),"color: "+COLOUR.GREEN);var i=this.getDocViews(e.id);t.contentIndex&&(t.contentIndex-=e.getIndex());var n=0;if(i[0]&&i[0].getType()===VIEW.PARA)for(var r=0;r<i.length;r++)if(i[r].getEnd()!==-1&&i[r].getEnd()>=t.contentIndex){n=r;break}if(i[n]){t.isUserOperation=!0;for(var r=n;r<i.length;r++)i[r].getSection().updateViewInSectionView(i[r],t);var o=i[n];this.buildAllDocViewsOfDTView(e,o)}},onViewRemovedFromDTSectionView:function(e){this.logger().log(e.getId()+" came for view remove in section group");var t,i=this.getDocViews(e.getId());if(i.length){var n=i[0];t=n.getSection(),t&&t.shouldResetSectionBalancing()&&(this.preBalancingProcess(t,n),t.setAllowedHeight(0),t.setMaxHeightRendered(0)),n.preDocViewsRemove()}for(var r,n,o=!0;i.length;)r=i.length-1,n=i[r],n.getSection().addToPaginationQueue(n.getColumn()),0===r&&(o=!1),n.removeAllChildViews(!0,o,!0);this.canPaginateGroup(t)&&this.documentLayoutManager.paginate()},onViewAdjustBorder:function(e){for(var t=this.getDocViews(e.getId()),i=0;i<t.length;i++)this.trigger(DOCVIEW.VIEW_ADJUST_BORDER,t[i])},addMetaView:function(e,t){this.addToSectionInProgressMap(e),this.bindSectionViewEvent(e);var i=this.findPageForMetaView(e,t),n=this.createDocSectionView(e,i);n.setContainingParaReference(t,t.getNode()),this.addSectionToPage(n,i),n.refresh(),this.removefromSectionInProgressMap(e)},createDocSectionView:function(e,t){var i=new(DocViews[e.getSectionType()])(e,this,t),n=i.getNodeId(),r=i.getSectionType();return this.setDocViews(n,i),this[r][n]||(this[r][n]=[]),this[r][n].push(i),this.bindSectionDocViewEvent(i),this.trigger(DOCVIEW.SECTION_ADDED,i),i},removeDocSectionView:function(e){this.removeSectionFromPage(e),this.trigger(DOCVIEW.SECTION_REMOVED,e),this.unbindSectionDocViewEvent(e);var t=e.getNodeId(),i=e.getSectionType(),n=this[i][t].indexOf(e);n>=0?this[i][t].splice(n,1):this.logger().warn("Section view remove :: docview not in map %c"+t,"color:"+COLOUR.YELLOW),this[i][t].length||delete this[i][t],this.removeFromDocViewMap(e),e.destroy()},doesDocSectionExist:function(e){var t=e.getSectionType(),i=e.getNodeId();return!!this[t][i]&&this[t][i].length>0},removeAllDocSectionView:function(e){for(var t,i=this.getDocViews(e.getId());i.length>0;)t=i.length-1,i[t].removeAllChildViews(!0,!0,!0)},addSectionToPage:function(e,t){var i=e.getSectionType();switch(i===SECTION_TYPES.TEXTBOX&&(i=e.getRootSectionType()),i){case SECTION_TYPES.CONTENT:case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:t.addSectionView(e);break;case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:for(t=this.getFirstPage();t;)e.belongsToPage(t)&&t.addSectionView(e),t=t.getNextPage()}},removeSectionFromPage:function(e){var t=e.getSectionType();switch(t===SECTION_TYPES.TEXTBOX&&(t=e.getRootSectionType()),t){case SECTION_TYPES.CONTENT:case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:var i=e.getPage();i&&i.removeSectionView(e);break;case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:for(var i=this.getFirstPage();i;)i.containsSection(e)&&i.removeSectionView(e),i=i.getNextPage()}},bindSectionDocViewEvent:function(e){e.on(DOCVIEW.VIEW_BEFORE_CREATE,this.handleChildDocViewAdd,this),e.on(DOCVIEW.VIEW_BEFORE_UPDATE,this.handleChildDocViewUpdate,this),e.on(DOCVIEW.VIEW_BEFORE_REMOVE,this.handleChildDocViewRemove,this),e.on(DOCVIEW.VIEW_ATTACHED,this.handleChildDocViewAttached,this),e.on(DOCVIEW.VIEW_DETACHED,this.handleChildDocViewDetached,this),e.on(DOCVIEW.VIEW_TOP_UPDATED,this.handleChildDocViewTopUpdated,this),e.on(DOCVIEW.VIEW_AFTER_CREATE,this.handleViewAfterCreate,this),e.on(DOCVIEW.VIEW_AFTER_UPDATE,this.handleViewAfterUpdate,this),e.on(DOCVIEW.LINE_ADDED,this.handleLineDocViewAdd,this),e.on(DOCVIEW.LINE_UPDATED,this.handleLineDocViewUpdate,this),e.on(DOCVIEW.LINE_STYLE_UPDATED,this.handleLineDocViewStyleUpdate,this),e.on(DOCVIEW.LINE_BEFORE_REMOVE,this.handleLineDocViewRemove,this),e.on(DOCVIEW.LIST_NUMBER_CHANGED,this.handleListNumber,this)},unbindSectionDocViewEvent:function(e){e.off(DOCVIEW.VIEW_BEFORE_CREATE,this.handleChildDocViewAdd,this),e.off(DOCVIEW.VIEW_BEFORE_UPDATE,this.handleChildDocViewUpdate,this),e.off(DOCVIEW.VIEW_BEFORE_REMOVE,this.handleChildDocViewRemove,this),e.off(DOCVIEW.VIEW_ATTACHED,this.handleChildDocViewAttached,this),e.off(DOCVIEW.VIEW_DETACHED,this.handleChildDocViewDetached,this),e.off(DOCVIEW.VIEW_TOP_UPDATED,this.handleChildDocViewTopUpdated,this),e.off(DOCVIEW.VIEW_AFTER_CREATE,this.handleViewAfterCreate,this),e.off(DOCVIEW.VIEW_AFTER_UPDATE,this.handleViewAfterUpdate,this),e.off(DOCVIEW.LINE_ADDED,this.handleLineDocViewAdd,this),e.off(DOCVIEW.LINE_UPDATED,this.handleLineDocViewUpdate,this),e.off(DOCVIEW.LINE_STYLE_UPDATED,this.handleLineDocViewStyleUpdate,this),e.off(DOCVIEW.LINE_BEFORE_REMOVE,this.handleLineDocViewRemove,this),e.off(DOCVIEW.LIST_NUMBER_CHANGED,this.handleListNumber,this)},handleLineDocViewAdd:function(e){this.trigger(DOCVIEW.LINE_ADDED,e)},handleLineDocViewUpdate:function(e){this.trigger(DOCVIEW.LINE_UPDATED,e)},handleLineDocViewStyleUpdate:function(e){this.trigger(DOCVIEW.LINE_STYLE_UPDATED,e)},handleLineDocViewRemove:function(e){this.trigger(DOCVIEW.LINE_BEFORE_REMOVE,e)},handleListNumber:function(e){this.trigger(DOCVIEW.LIST_NUMBER_CHANGED,e)},handleChildDocViewAdd:function(e){var t=e.dtView;this.setDocViews(t.id,e),this.trigger(DOCVIEW.VIEW_BEFORE_CREATE,e)},handleChildDocViewUpdate:function(e){this.trigger(DOCVIEW.VIEW_BEFORE_UPDATE,e)},handleChildDocViewRemove:function(e){this.trigger(DOCVIEW.VIEW_BEFORE_REMOVE,e),this.removeFromDocViewMap(e)},handleChildDocViewAttached:function(e){this.trigger(DOCVIEW.VIEW_ATTACHED,e)},handleChildDocViewDetached:function(e){this.trigger(DOCVIEW.VIEW_DETACHED,e)},handleChildDocViewTopUpdated:function(e){this.trigger(DOCVIEW.VIEW_TOP_UPDATED,e)},handleNoteCharUpdate:function(e){var t=this.documentLayoutManager.getSectionViews(e.getNodeId())[0];this.propagateVia(this.documentLayoutManager,DOCVIEW.NOTE_CHAR_UPDATED,t)},handleSectionOpStart:function(e){var t=e.getSectionType();if(t===SECTION_TYPES.HEADER||t===SECTION_TYPES.FOOTER||t===SECTION_TYPES.FOOTNOTE||t===SECTION_TYPES.ENDNOTE){var i=this.getDocViews(e.getId())[0];i&&i.handleSectionOpStart()}},handleSectionOpComplete:function(e,t){var i=this.getDocViews(t.id);this.canPaginateGroup(i[0])&&this.documentLayoutManager.paginate()},handleSectionBuildPreProcessStart:function(){this.updateCanPaginateStatus(!1)},handleSectionBuildPreProcessComplete:function(e){this.updateCanPaginateStatus(!0),this.canPaginateGroup(this.getDTViewManager().getDTView(e))&&this.documentLayoutManager.paginate()},handleViewAfterCreate:function(e){this.trigger(DOCVIEW.VIEW_AFTER_CREATE,e)},handleViewAfterUpdate:function(e){this.trigger(DOCVIEW.VIEW_AFTER_UPDATE,e)},getDTViewManager:function(){return this.documentLayoutManager.dtViewManager},getDocViews:function(e,t){t=!!t;var i=this.docViewMap.get(e)||[];return!i.length||t?i:this.sortDocViews(i)},sortDocViews:function(e){var t,i=e[0],n=i.getType();switch(n){case VIEW.SECTION:t=i.getSectionType(),t===SECTION_TYPES.CONTENT&&e.sort(function(e,t){return e.getPage().getPageNumber()-t.getPage().getPageNumber()});break;default:t=i.getSection().getSectionType(),t===SECTION_TYPES.CONTENT&&e.sort(function(e,t){var i=e.getPage().getPageNumber(),n=t.getPage().getPageNumber();return i!==n?i-n:e.getColumn().getColumnNumber()-t.getColumn().getColumnNumber()})}return e},setDocViews:function(e,t){for(var i=this.docViewMap.get(e)||[],n=0;n<i.length;n++)if(i[n].getId()===t.getId())return;i.push(t),this.docViewMap.add(e,i)},removeFromDocViewMap:function(e){var t=e.dtView,i=this.docViewMap.get(t.getId()),n=i?i.indexOf(e):-1;n<0||(i.splice(n,1),0===i.length&&this.docViewMap.remove(t.getId()))},getLayoutProps:function(){return{headerTop:this.headerTop,footerBottom:this.footerBottom,margin:this.margin,gutter:this.gutter,pageDimensions:this.pageDimensions,actualPageDimensions:this.actualPageDimensions}},getHFView:function(e,t){var i=this[e];for(var n in i){var r=i[n][0];if(r.getHFType()==t)return r}return null},getHeader:function(e){var t=this[SECTION_TYPES.HEADER];for(var i in t){var n=t[i][0];if(n.getHFType()==e)return n}return null},getFooter:function(e){var t=this[SECTION_TYPES.FOOTER];for(var i in t){var n=t[i][0];if(n.getHFType()==e)return n}return null},getHeaderTop:function(){return this.headerTop},getFooterBottom:function(){return this.footerBottom},getMargin:function(){return this.margin},getGutter:function(){return this.gutter},getGutterTop:function(){return this.gutter.position===GUTTER_POSITION.TOP?this.gutter.value:0},getGutterLeft:function(){return this.gutter.position===GUTTER_POSITION.LEFT?this.gutter.value:0},getGutterRight:function(){return this.gutter.position===GUTTER_POSITION.RIGHT?this.gutter.value:0},getPageHeight:function(){return this.pageDimensions.height},getPageWidth:function(){return this.pageDimensions.width},getActualPageHeight:function(){return this.actualPageDimensions.height},getActualPageWidth:function(){return this.actualPageDimensions.width},getPrintPageHeight:function(){var e=this.getPageSize(),i=this.getPageOrientation(),n=(PageLayout.Paper[e][i].height.inch+"in").convertor().pixels,r=t(e.toLowerCase(),this.getPageWidth(),this.getPageHeight()),o=this.getPageHeight();return o=Math.ceil(o-r),o=o>n?n:o},getBorders:function(){return this.borders},sortPaginationInfo:function(){this.pagesToPaginate.sort(r)},addPaginationInfo:function(e,t,i){t=t||0;for(var n=0;n<this.pagesToPaginate.length;n++)if(this.pagesToPaginate[n].section.id===e.getId())return this.pagesToPaginate[n].colIdx=Math.min(this.pagesToPaginate[n].colIdx,t),this.pagesToPaginate[n];var r={section:e,colIdx:t,height:i||0};return this.pagesToPaginate.push(r),r},removePaginationInfo:function(e){for(var t=0;t<this.pagesToPaginate.length;t++)if(this.pagesToPaginate[t].section.id===e.getId())return this.pagesToPaginate.splice(t,1)[0];return null},isPagesPendingToPaginate:function(){return 0!==this.pagesToPaginate.length},getPageInfoToPaginateCopy:function(){var e=this.getPageInfoToPaginate();return e&&this.addPaginationInfo(e.section,e.colIdx,e.currentHeight),e},getPageInfoToPaginate:function(){this.sortPaginationInfo();for(var e=0;e<this.pagesToPaginate.length;e++)if(this.pagesToPaginate[e].section.getSectionType()===SECTION_TYPES.HEADER||this.pagesToPaginate[e].section.getSectionType()===SECTION_TYPES.FOOTER)return this.removePaginationInfo(this.pagesToPaginate[e].section);return this.removePaginationInfo(this.pagesToPaginate[0].section)},getPages:function(){return this.pages},getFirstPage:function(){return this.pages.first},getLastPage:function(){return this.pages.last},getFirstPageWithSection:function(e){for(var t=this.getFirstPage();t&&!t.containsSection(e);)t=t.next;return t},handlePageCreateAndRemove:function(e,t){for(var i=this.getFirstPage();i&&i!=e;)i.updatePageCountInViews(),i=i.next;for(i=t?t:e?e.next:null;i;)i.updatePageNumber(),i.updatePageNumberInViews(),i.updatePageCountInViews(),i=i.next},updatePageNumberInViews:function(){for(var e=this.pages.first;e;)e.updatePageNumberInViews(),e=e.next},updatePageCountInViews:function(){for(var e=this.pages.first;e;)e.updatePageCountInViews(),e=e.next},updateSurroundingPages:function(e,t,i){this.documentLayoutManager.isFixedView()&&(i&&i.handleHFVisibilityUpdate([SECTION_TYPES.HEADER]),t&&t.handleHFVisibilityUpdate([SECTION_TYPES.FOOTER]))},handleSurroundingPages:function(e,t,i){this.propagateVia(this.documentLayoutManager,DOCVIEW.UPDATE_SURROUNDING_PAGES,e,t,i)},createPage:function(e){var t=new PageDocView(this);return e?this.pages.insertAfter(t,e):this.pages.append(t),t.updatePageNumber(),this.handlePageCreateAndRemove(t),this.updateSurroundingPages(t,t.getNextPage(),t.getPrevPage()),this.trigger(DOCVIEW.PAGE_CREATED,t,this),this.handleSurroundingPages(t,t.getPrevPage(),t.getNextPage()),this.handleMirrorMarginsOnPageUpdate(t.getNextPage()),t.init(),t},splitPage:function(e,t){var i=t||e.findOverflowingContentDocView();if(i){var n=this.createPage(e);n.split(i)}},removePage:function(e){e.remove();var t=e.getNextPage(),i=e.getPrevPage();this.pages.remove(e),this.updateSurroundingPages(e,t,i),this.handlePageCreateAndRemove(e,t),this.trigger(DOCVIEW.PAGE_REMOVED,e,this),this.handleSurroundingPages(e,i,t),this.handleMirrorMarginsOnPageUpdate(t),e.destroy()},handleMirrorMarginsOnPageUpdate:function(e){if(this.documentLayoutManager.isMirrorMargins()){for(;e;)e.refreshSectionMargins(),e=e.next;this.trigger(GROUP.PAGE_BORDER_CHANGED)}},triggerPagination:function(){this.paginate()},shouldContinuePagination:function(){if(!this.isPagesPendingToPaginate())return!1;var e=this.getPageInfoToPaginateCopy(),t=e.section;return this.canPaginateGroup(t)&&!t.shouldSkipPagination()},paginate:function(){var e;if(this.isPagesPendingToPaginate())for(;this.shouldContinuePagination();){var t=this.getPageInfoToPaginate(),i=t.section,n=t.colIdx;if(i.isReplicableView()?i.paginate(n):(e=i.getPage(),e.paginate(i,n),e.isEmpty()&&(this.removePage(e),e=null)),!this.shouldPaginateNextPageWithoutTimeout())break}else{var r;for(e=this.getFirstPage();e;)r=e.getNextPage(),e.isEmpty()&&this.removePage(e),e=r}},shouldPaginateNextPageWithoutTimeout:function(){if(!this.isPagesPendingToPaginate())return!1;var e=this.getPageInfoToPaginateCopy(),t=e.section;if(t.getSectionType()===SECTION_TYPES.CONTENT){var i=t.getPage(),n=this.documentLayoutManager.getVisiblePageNumbers();return n.indexOf(i.getAbsolutePageNumber())!==-1}return!(!t.isReplicableView()&&t.getSectionType()!=SECTION_TYPES.ENDNOTE)},getPageCount:function(){return this.pages.length},getPageNumberFormat:function(){var e,t=this.getFirstSectionFormat();return e=t&&t.pagenumber&&t.pagenumber.hasOwnProperty("pageno_format")?t.pagenumber.pageno_format:this.prev?this.prev.getPageNumberFormat():LIST_TYPE.DECIMAL},getStartingPageNumber:function(){var e,t=this.getFirstSectionFormat();return e=t&&t.pagenumber&&t.pagenumber.hasOwnProperty("pageno_starts_at")?t.pagenumber.pageno_starts_at:this.prev?this.prev.getStartingPageNumber()+this.prev.getPageCount():1},getAbsolutePageStart:function(){var e;return e=this.prev?this.prev.getAbsolutePageStart()+this.prev.getPageCount():1},getAbsolutePageNumbers:function(){for(var e=[],t=this.getAbsolutePageStart(),i=t+this.getPageCount();t<i;)e.push(t),t++;return e},getPageNumberInfo:function(){var e={};return e.pageno_starts_at=this.getStartingPageNumber(),e.pageno_format=this.getPageNumberFormat(),e},shouldContinuePageNumber:function(){var e=this.getFirstSectionFormat();return!(!this.prev||e&&e.pagenumber&&e.pagenumber.hasOwnProperty("pageno_starts_at"))},getAbsolutePageCount:function(){var e=this.prev?this.prev.getAbsolutePageCount():0;return e+this.getPageCount()},getRelativePageCount:function(){return this.getPageCount()},getNextGroup:function(){return this.next},getPrevGroup:function(){return this.prev},getId:function(){return this.id},getLayoutManager:function(){return this.documentLayoutManager},isEmpty:function(){return this.docViewMap.isEmpty()},getFirstSection:function(){for(var e=this.getFirstPage();e&&!e.getFirstSection(SECTION_TYPES.CONTENT);)e=e.next;return e?e.getFirstSection(SECTION_TYPES.CONTENT):null},getLastSection:function(){for(var e=this.getLastPage();e&&!e.getLastSection(SECTION_TYPES.CONTENT);)e=e.prev;return e?e.getLastSection(SECTION_TYPES.CONTENT):null},getFirstSectionFormat:function(){return this.firstContentDTView?this.firstContentDTView.getFormats():null},getFirstContentDTView:function(){return this.firstContentDTView},getComputedHFIds:function(e){var t=[];return this.firstContentDTView&&(t=this.firstContentDTView.getComputedHFIds(e)),t},getHFIds:function(e){var t=[];return this.firstContentDTView&&(t=this.firstContentDTView.getHFIds(e)),t},getHFType:function(){return this.firstContentDTView?this.firstContentDTView.getHFType():0},getHFViews:function(e,t){var i=this[e];if(t){for(var n in i)if(i.hasOwnProperty(n)&&i[n].getNodeId()===t)return i[n];return[]}return i},remove:function(){var e=this[SECTION_TYPES.FOOTNOTE];for(var t in e)this.removeSectionView(e[t][0].dtView);var i=this[SECTION_TYPES.ENDNOTE];for(var t in i)this.removeSectionView(i[t][0].dtView);for(var n=this.getLastSection(),r=n?n.getDTView():null;r;){this.removeSectionView(r);r.prev;if(r===this.firstContentDTView)break;r=r.prev}var o=this[SECTION_TYPES.HEADER];for(var t in o)this.removeSectionView(o[t][0].dtView);var a=this[SECTION_TYPES.FOOTER];for(var t in a)this.removeSectionView(a[t][0].dtView);this.canPaginateGroup()&&this.paginate(),this.trigger(DOCVIEW.SECTIONGROUP_REMOVED,this)},bindEvents:function(){this.documentLayoutManager.on(DOCUMENT.VIEW_CHANGED,this.handleViewTypeUpdate,this)},unbindEvents:function(){this.documentLayoutManager.off(DOCUMENT.VIEW_CHANGED,this.handleViewTypeUpdate,this)},destroy:function(){this.unbindEvents(),this.id="",this.documentLayoutManager=null,this.docTree=null,this.headerTop=0,this.footerBottom=0,this.gutter={},this.margin={},this.pageDimensions={},this.actualPageDimensions={},this.firstContentDTView=null,this[SECTION_TYPES.CONTENT]={},this[SECTION_TYPES.HEADER]={},this[SECTION_TYPES.FOOTER]={},this[SECTION_TYPES.FOOTNOTE]={},this[SECTION_TYPES.ENDNOTE]={},this.docViewMap=null,this.pages=null,this.pagesToPaginate=[],this.canPaginate=null,this.viewBuildInProgress={}},canPaginateGroup:function(e){var t=this.documentLayoutManager.getPaginationAllowed();if(!t)return!1;if(this.canPaginate&&e&&META_SECTIONS.contains(e.getSectionType())){var i=e.getNode();return!this.isViewBuildInProgress(i.getContainingPara().getId())&&!i.getContainingSection().isDirtyNode(i.getContainingPara())}return this.canPaginate},updateCanPaginateStatus:function(e){this.canPaginate=e},updateViewBuildInProgress:function(e,t){t?this.viewBuildInProgress[e]=t:delete this.viewBuildInProgress[e]},isViewBuildInProgress:function(e){return this.viewBuildInProgress[e]||!1},isLastGroup:function(){var e=this.documentLayoutManager.getLastGroup();return!(!e||e!==this)},getPageSize:function(){var e=this.getFirstContentDTView();return e?e.getFormats()[ATTR_BODY.DS_PS]:null},getPageOrientation:function(){var e=this.getFirstContentDTView();if(e){var t=this.getActualPageWidth(),i=this.getActualPageHeight();return i>t?PAGE_ORIENTATION.PORTRAIT:PAGE_ORIENTATION.LANDSCAPE}return null},hasEndNotes:function(){return!ZWJSONUtils.isEmptyObject(this[SECTION_TYPES.ENDNOTE])},logger:function(){return this.documentLayoutManager._logger}}),i}(BaseEventHandler,DocUtils),LINE_STATUS={NONE:"none",CREATE:"create",UPDATE:"update",STYLE_UPDATE:"style_update",REMOVE:"remove",RECREATE:"recreate"},CONTENT_TYPE={RTL:"rtl",LTR:"ltr",AN:"an"},LineDocView=function(){"use strict";function e(e){this.id=e.id,this.type=e.type,this.section=e.section||null,this.start=e.start,this.end=e.end,this.height=e.height,this.outerHeight=e.outerHeight,this.contentHeight=e.contentHeight,this.style=e.style,this.remainingWidth=e.remainingWidth,this.origRemainingWidth=e.origRemainingWidth,this.listWidth=e.listWidth,this.listRight=e.listRight,this.width=e.width,this.left=e.left,this.right=e.right,this.floatImagesData=e.floatImagesData,this.align=e.align,this.segments=e.segments,this.imageSegments=e.imageSegments,this.blocks=e.blocks,this.length=e.length,this.parent=e.parent,this.updateParentReference(e.view),this.imagePaddingLeft=e.imagePaddingLeft,this.renderedSpaceWidths=e.renderedSpaceWidths,this.spaceWidths=e.spaceWidths,this.commentEnds=e.commentEnds,this.autoField=e.autoField,this.isPageAutoField=e.isPageAutoField,this.bookMarks=e.bookMarks;for(var t=0;t<META_SECTIONS.length;t++){var i=META_SECTIONS[t];this[i]=e[i]||[]}this.tabs=e.tabs,this.baseLine=e.baseLine,this.footNoteHeight=e.footNoteHeight,this.status=e.status||LINE_STATUS.NONE,this.borderStyles=e.borderStyles||{},this.paddingStyles=e.paddingStyles||{},this.backgroundStyles=e.backgroundStyles||{},this.spacingStyles=e.spacingStyles||{},this.drawInfo=e.drawInfo||{},this.cachedContent=e.cachedContent||"",this.firstBlock=e.firstBlock||null,this.lastBlock=e.lastBlock||null,this.resolvedLevels=e.resolvedLevels||[],this.visualOrder=e.visualOrder||[],this.levels=e.levels||[],this.types=e.types||[],this.sublines=e.sublines||new LinkedList,this.fieldsInfo=e.fieldsInfo||{},this.segmentOrder=e.segmentOrder||[]}var t={LTR:[0],RTL:[3,4,5,6,20],AN:[11]},i=function(e){for(var i in t)if(t[i].contains(e))return CONTENT_TYPE[i];return null};return BaseEventHandler.call(e.prototype),extend(e.prototype,{getSegmentAtIndex:function(e){for(var t,i=0;i<this.segments.length;i++)if(t=this.segments[i],e>=t.start&&e<t.end)return t;return null},getFormatAtIndex:function(e){var t=this.getSegmentAtIndex(e);return t?t.computedFormat:null},getCharDirectionAtIndex:function(e){return this.levels[e]%2===0?PARA_DIR.LTR:PARA_DIR.RTL},getWidthBetweenIndex:function(e,t,i){var n=this.getVisualOrder();e=null!=e?e:this.start,t=null!=t?t:this.end;for(var r,o=(n.indexOf(t),this.getBlockAtVisualIndex(n[0])),a=(!!o&&o.type===BLOCK_TYPE.EOP,0),s=this.getSubBlockAtVisualIndex(e);s;){var l,d=s.getVisualOrder()||[];d.contains(e)||(e=d[0]),l=d.contains(t)?t:ZWArrayUtils.lastElementOf(d),r=t!==l||i;var c=s.block,u=this.view.getNodeStartIndex(),g=c.start+u,h=c.end+u,f=editor.doc.getContent(g,h),p=RANGE_CHARS_REGEX;p.lastIndex=0;for(var E=p.exec(f);d.indexOf(e)!=-1&&d.indexOf(e)<=d.indexOf(l);){var T=E&&E.index+d[0]<=l;h=T?E.index+d[0]:l;var O=this.view.documentLayoutManager.dtViewManager,m=e-d[0],I=c.formats["#"+(c.start+m)+"#"],D=c.fontStringObj["#"+(c.start+m)+"#"],R=DocUtils.getHashReplaceNumberWidthAt(this.view.getNodeStartIndex()+e,I,O,D);R?a+=R.width:d[0]===e&&ZWArrayUtils.lastElementOf(d)===h&&r?(a+=s.getWidth(),T=!1):a+=s.block.getWidthBetweenIndex(e,h,r);var S=d.indexOf(h)+1;if(e=d[S],T){var C=f.charAt(E.index);if(I=editor.doc.getRawFormatAt(g+E.index),C==UNICODE.RANGE_START){if(("conditional_if_start"==I.type||"conditional_else_seperator"==I.type||"conditional_if_end"==I.type)&&!RangeCollection.isConditionToggled(I.id)){var A=ZWJSONUtils.clone(isV8Engine?getTextMetrics(CONDITIONAL_FIELD.IF_START,{"font-weight":0,"font-size":"11pt","font-family":"TeXGyreCursor","letter-spacing":0}):FontUtils.getCharSize(CONDITIONAL_FIELD.IF_START,CONDITIONAL_FIELD.FONT_STRING)),v=13;A.width+=10,editor.getRole().permissions.can("document.edit")&&(A.width+=v),a+=A.width}}else if(I&&"conditional_if_end"==I.type&&!RangeCollection.isConditionToggled(I.id)){var A=ZWJSONUtils.clone(isV8Engine?getTextMetrics(CONDITIONAL_FIELD.IF_END,{"font-weight":0,"font-size":"11pt","font-family":"TeXGyreCursor","letter-spacing":0}):FontUtils.getCharSize(CONDITIONAL_FIELD.IF_END,CONDITIONAL_FIELD.FONT_STRING));A.width+=10,a+=A.width}}E=p.exec(f)}if(d.contains(t))break;if(e=l,s.next)s=s.next;else{var _=this.getSublineOfSubBlock(s);_.next?(s=_.next.subBlocksList.first,s&&(a+=_.next.left)):s=null}}return a},getSublineOfSubBlock:function(e){for(var t=this.sublines.first;t;){if(t.subBlocksList.getItemById(e.id))return t;t=t.next}return null},getResolvedLevels:function(){return this.resolvedLevels||[]},getVisualOrder:function(){return this.visualOrder||[]},getBlockAtIndex:function(e){for(var t,i=this.blocks,n=0;n<i.length;n++)if(t=i[n],e>=t.start&&(e<t.end||t.type===BLOCK_TYPE.EOP))return t;return null},getBlockAtVisualIndex:function(e){for(var t=this.blocks,i=0;i<t.length;i++)if(t[i].getVisualOrder().contains(e))return t[i];return null},getEOPBlock:function(){var e=this.getView().getNodeEndIndex();if(this.parent.getEndIndex()!==e)return null;for(var t=this.blocks,i=t.length-1;i>=0;i--)if(t[i].type===BLOCK_TYPE.EOP)return t[i];return null},getSubBlockAtVisualIndex:function(e){for(var t=this.blocks,i=0;i<t.length;i++)for(var n=t[i].getSubBlocks(),r=0;r<n.length;r++)if(n[r].getVisualOrder().contains(e))return n[r];return null},getAbsTop:function(e){if(this.getType()===e)return 0;var t=this.getTop(),i=this.getParent();return i&&(t+=i.getContentTop(),i.getType()!==e&&(t+=i.getAbsTop(e))),t},getAbsLeft:function(e){if(this.getType()===e)return 0;var t=this.getLeft(),i=this.getParent();return i&&(t+=i.getContentLeft(),i.getType()!==e&&(t+=i.getAbsLeft(e))),t},getType:function(){return this.type},getHeight:function(e,t){var i=e?this.height:this.outerHeight;return t&&(i+=this.footNoteHeight),i},getWidth:function(){return this.width},getMaxContentWidth:function(){return this.getWidth()+this.getRemainingWidth()},getTop:function(){for(var e=0,t=this.prev;t;)e+=t.getHeight(),t=t.prev;return e},getContentTop:function(){var e=this.getBorderStyles(ATTR_BORDERS.BORDER_TOP),t=this.getSpacingStyles();return t.spaceBefore+(e?e.width:0)},getLeft:function(){return this.left},getRight:function(){return this.right},getParent:function(){return this.view},isLineDirectionRTL:function(){return this.getView().getDTView().isRTLPara()},getDirectionalLeft:function(){return this.isLineDirectionRTL()?this.getRight()-this.getLeft()-this.getWidth():this.getLeft()},getDirectionalRight:function(){return this.isLineDirectionRTL()?this.getDirectionalLeft()+this.getWidth():this.getRight()},getFirstImageIndex:function(){for(var e,t=this.segments.length,i=0;i<t;i++)if(e=this.segments[i].format,e.type===NODE_TYPE.IMAGE&&DocUtils.isImage(e))return this.parent.getIndex()+this.segments[i].start;return-1},getId:function(){return this.id},getSection:function(){return this.section},getSectionType:function(){return this.getSection().getSectionType()},getRootSectionType:function(){return this.getSection().getRootSectionType()},getSegmentsLength:function(){return this.segments.length},getStatus:function(){return this.status},getContent:function(){return this.parent.content().substring(this.start,this.end)},getBorderStyles:function(e){return e?this.borderStyles[e]||null:this.borderStyles},getBorderWidthAndSpacing:function(e,t,i){var n=this.getBorderStyles(e),r=0;return n&&(t||(r+=n.width),i||(r+=n.space)),r},getView:function(){return this.view},getPage:function(){return this.getView().getPage()},getContentHeight:function(){return this.contentHeight},getParentNode:function(){return this.parent},getBlocks:function(){return this.blocks},getBlocksLength:function(){return this.blocks.length},getAlign:function(){return this.align},getPaddingStyles:function(){return this.paddingStyles},getSpacingStyles:function(){return this.spacingStyles},getFootnoteHeight:function(){return this.footNoteHeight},getDrawInfo:function(){return this.drawInfo},fillFirstLastBlock:function(){this.firstBlock=this.getBlockAtVisualIndex(this.visualOrder[0]),this.lastBlock=this.getBlockAtVisualIndex(ZWArrayUtils.lastElementOf(this.visualOrder))},setStatus:function(e){this.status=e},setId:function(e){this.id=e},updateLeft:function(){var e=0,t=this.getRemainingWidth(),i=this.getAlign(),n=this.getView().isRTLPara();n&&([ALIGN.LEFT,ALIGN.JUSTIFY].contains(TEXT_ALIGN[i])?i=2:TEXT_ALIGN[i]===ALIGN.RIGHT&&(i=0)),1===i?e=t/2:2===i&&(e=t),this.left=e},updateRight:function(){this.right=this.getWidth()+this.getRemainingWidth()},updateProperties:function(e){var t=[];if(t.push(this.spacingStyles),this.updateSpacingStyles(e.spaceProperties,e.samePrevFormat,e.sameNextFormat),t.push(this.borderStyles),this.updateBorderStyles(e.samePrevFormat,e.sameNextFormat),t.push(this.paddingStyles),this.setPaddingStyles(),t.push(this.outerHeight),this.updateHeight(),t.push(this.backgroundStyles),this.updateBackgroundStyles(e.backgroundColor),t.push(this.left),this.updateLeft(),t.push(this.right),this.updateRight(),t.push(this.drawInfo),this.updateDrawInfo(),this.getStatus()===LINE_STATUS.NONE){for(var i=!1,n=[this.spacingStyles,this.borderStyles,this.paddingStyles,this.outerHeight,this.backgroundStyles,this.left,this.right,this.drawInfo],r=0;r<t.length;r++){var o=typeof t[r];if(["number","string"].contains(o)){if(t[r]!==n[r]){i=!0;break}}else if("object"===o&&!ZWJSONUtils.compareJSON(t[r],n[r])){i=!0;break}}i&&this.setStatus(LINE_STATUS.STYLE_UPDATE)}},updateBorderBetweenStyles:function(e,t,i){if(t){var n=e.getBorderStyles(),r=t.getBorderStyles(),o=e.getView().getBorderStyles(ATTR_BORDERS.BORDER_BETWEEN),a=t.getView().getBorderStyles(ATTR_BORDERS.BORDER_BETWEEN);"prev"===i&&a&&a.width>0?(r[ATTR_BORDERS.BORDER_BOTTOM]=ZWJSONUtils.clone(a),delete n[ATTR_BORDERS.BORDER_TOP]):"next"===i&&o&&o.width>0&&(n[ATTR_BORDERS.BORDER_BOTTOM]=ZWJSONUtils.clone(o),delete r[ATTR_BORDERS.BORDER_TOP]),t.getStatus()===LINE_STATUS.NONE&&(t.setStatus(LINE_STATUS.STYLE_UPDATE),t.getView().publishNodeLineEvents())}},updateBorderStyles:function(e,t){var i=this.getView(),n=i.getDTView(),r=n.getEndIndex(),o=i.getBorderStyles(),a=o[ATTR_BORDERS.BORDER_TOP],s=o[ATTR_BORDERS.BORDER_BOTTOM],l=o[ATTR_BORDERS.BORDER_LEFT],d=o[ATTR_BORDERS.BORDER_RIGHT],c=o[ATTR_BORDERS.BORDER_BETWEEN],u=o[ATTR_BORDERS.BORDER_RADIUS],g={},h={};if(0===this.start&&(a&&(g[ATTR_BORDERS.BORDER_TOP]=ZWJSONUtils.clone(a),e&&(g[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]=0,g[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.SPACE]=0)),u&&(h[ATTR_BORDERS.RADIUS_TOPLEFT]=e?0:u[ATTR_BORDERS.RADIUS_TOPLEFT]||0,h[ATTR_BORDERS.RADIUS_TOPRIGHT]=e?0:u[ATTR_BORDERS.RADIUS_TOPRIGHT]||0)),this.absEnd===r&&(s&&(g[ATTR_BORDERS.BORDER_BOTTOM]=ZWJSONUtils.clone(s),t&&(g[ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.WIDTH]=0,g[ATTR_BORDERS.BORDER_BOTTOM][ATTR_BORDERS.SPACE]=0)),u&&(h[ATTR_BORDERS.RADIUS_BOTTOMLEFT]=t?0:u[ATTR_BORDERS.RADIUS_BOTTOMLEFT]||0,h[ATTR_BORDERS.RADIUS_BOTTOMRIGHT]=t?0:u[ATTR_BORDERS.RADIUS_BOTTOMRIGHT]||0)),l&&(g[ATTR_BORDERS.BORDER_LEFT]=ZWJSONUtils.clone(l)),d&&(g[ATTR_BORDERS.BORDER_RIGHT]=ZWJSONUtils.clone(d)),ZWJSONUtils.isEmptyObject(h)||(g[ATTR_BORDERS.BORDER_RADIUS]=h),this.borderStyles=g,c&&this.absEnd===r){var f=i.getPrevView(),p=i.getNextView();f&&f.getType()===VIEW.PARA&&this.updateBorderBetweenStyles(this,f.getLastNodeLine(),"prev"),p&&p.getType()===VIEW.PARA&&this.updateBorderBetweenStyles(this,p.getFirstNodeLine(),"next")}},updateDrawInfo:function(){this.drawInfo=isV8Engine?DrawInfoManager.getParaRectArray(this):{}},setPaddingStyles:function(){var e,t=this.getBorderStyles(),i={};for(var n in t)t.hasOwnProperty(n)&&n!==ATTR_BORDERS.BORDER_RADIUS&&(e="padding-"+n.split("-")[1],i[e]=t[n].space);this.paddingStyles=i},updateHeight:function(){var e=this.height,t=this.getBorderStyles(ATTR_BORDERS.BORDER_TOP),i=this.getBorderStyles(ATTR_BORDERS.BORDER_BOTTOM);t&&(e+=t.width,e+=t.space),i&&(e+=i.width,e+=i.space);var n=this.getSpacingStyles();for(var r in n)n.hasOwnProperty(r)&&!["spaceBefore","spaceAfter"].contains(r)&&(e+=n[r]);var o=this.getHeight();this.outerHeight=e,o!==e&&this.view.updateHeight()},updateSpacingStyles:function(e,t,i){var n=this.getView(),r=e.before,o=e.after,a=r,s=o,l=n.dtView.getEndIndex(),d={};if(r&&0===this.start){var c=n.getPrevView();if(c&&c.getType()===VIEW.PARA){var u=c.dtView.getParaSpacingProperties();r>=u.after&&(r-=u.after),!c.getSection().isDirtyNode(c)&&t?d[PADDING.TOP]=r:d[MARGIN.TOP]=a}else d[MARGIN.TOP]=a}if(o&&this.absEnd===l){var g=n.getNextView();if(g&&g.getType()===VIEW.PARA){var h=g.dtView.getParaSpacingProperties();o>h.before&&(o-=h.before),!g.getSection().isDirtyNode(g)&&i?d[PADDING.BOTTOM]=o:d[MARGIN.BOTTOM]=s}else d[MARGIN.BOTTOM]=s}d.spaceBefore=r,d.spaceAfter=o,this.spacingStyles=d},getBackgroundStyles:function(){return this.backgroundStyles},getRemainingWidth:function(){return this.remainingWidth},getStyles:function(){return this.style},getMetaSectionByType:function(e){return this[e]},getFootNotesLength:function(){return this[SECTION_TYPES.FOOTNOTE].length},updateBackgroundStyles:function(e){if(""===e)return void(this.backgroundStyles={});var t=this.getBorderStyles(ATTR_BORDERS.BORDER_RADIUS),i=this.getHeight(!0)+this.getPaddingForRendering("top")+this.getPaddingForRendering("bottom"),n=this.getView().getOuterWidth()-(this.getBorderWidthAndSpacing(ATTR_BORDERS.BORDER_LEFT,!1,!0)+this.getBorderWidthAndSpacing(ATTR_BORDERS.BORDER_RIGHT,!1,!0));this.backgroundStyles={height:i,width:n,color:e,radius:t}},getAsNewLine:function(){return this.id=Utils.randomId(VIEW.LINE),this},removeParentReference:function(){this.updateSection(null),this.unbindEvents(),this.updateView(null)},updateParentReference:function(e){this.updateView(e),this.bindEvents(),this.updateSection(e.getSection())},updateView:function(e){this.view=e},moveLineTo:function(e){this.removeParentReference(),this.updateParentReference(e)},handlePageCountUpdate:function(){if(this.isPageAutoField&&this.view){var e=this.view.getLayoutManager();e&&this.propagateVia(e,DOCVIEW.PAGE_COUNT_UPDATED,this)}},handlePageNumberUpdate:function(){if(this.isPageAutoField&&this.view){var e=this.view.getLayoutManager();e&&this.propagateVia(e,DOCVIEW.PAGE_NUMBER_UPDATED,this)}},bindEvents:function(){if(this.isPageAutoField){var e=this.view?this.view.getPage():null;e&&(e.on(DOCVIEW.PAGE_COUNT_UPDATED,this.handlePageCountUpdate,this),e.on(DOCVIEW.PAGE_NUMBER_UPDATED,this.handlePageNumberUpdate,this))}},unbindEvents:function(){if(this.isPageAutoField){var e=this.view?this.view.getPage():null;e&&(e.off(DOCVIEW.PAGE_COUNT_UPDATED,this.handlePageCountUpdate,this),e.off(DOCVIEW.PAGE_NUMBER_UPDATED,this.handlePageNumberUpdate,this))}},updateSection:function(e){this.section=e},getSelectionHeight:function(){var e=this.getPaddingHeight();return this.getHeight(!0)+e},getPaddingHeight:function(){var e=0,t=this.getPaddingStyles();for(var i in t)"padding-top"!==i&&"padding-bottom"!==i||(e+=t[i]);var n=this.getSpacingStyles();for(var i in n)"padding-top"!==i&&"padding-bottom"!==i||(e+=n[i]);return e},addTrailingSpacesToRemWidth:function(){if(!this.isLineDirectionRTL()){for(var e=this.remainingWidth,t=this.blocks,i=this.getView().getNodeStartIndex(),n=t.length-1;n>=0;n--){var r=t[n],o=editor.doc.getContent(r.start+i,r.end+i);if(r.isTailingBlock=!1," "===o[0])e+=r.getRenderWidth(),this.width-=r.getRenderWidth(),r.isTailingBlock=!0;else{if(o!==UNICODE.BR)break;e+=0}}this.remainingWidth=e,this.origRemainingWidth<0&&(this.remainingWidth+=this.origRemainingWidth)}},adjustBlocksWidth:function(){if(3===this.getView().getParaProperties().align){for(var e,t,i,n=this.getView().getNode().getIndex(),r=0,o=0,a=0,s=this.end+n,l=this.spaceWidths.length,d=this.blocks,c=0,u=-1,g=d[d.length-1],h=d.length-1;h>=0;h--)if(g=d[h],e=g.content,i=editor.doc.getRawFormatAt(n+g.start)||{},e[0]===UNICODE.SPACE&&i.cls!==NODE_TYPE.FILLABLEFIELD)l-=g.end-g.start,c+=g.width||0;else{if(e!==UNICODE.BR&&e!==UNICODE.RANGE_START&&e!==UNICODE.RANGE_END){u=h;break}c+=0}var f=l>=1&&(s!==this.getView().getNodeEndIndex()||editor.doc.getCharAt(s-1)===UNICODE.BR)&&this.remainingWidth>0;if(f){for(a=this.origRemainingWidth,a+=c,o=a,h=0;h<l;h++)o+=this.spaceWidths[h];r=Math.floor(o/l),o-=l*r,this.width+=a,this.remainingWidth=0}this.renderedSpaceWidths.length=0;var p,E,T=!1,O=!1;for(i={},h=0;h<u;h++){for(t=d[h].width,O=!1,E=d[h].start;E<d[h].end;E++)i=editor.doc.getRawFormatAt(E+n)||{}," "===editor.doc.getCharAt(E+n)&&i.cls!==NODE_TYPE.FILLABLEFIELD?(O=!0,f?(p=r+(o>0?1:0),T?d[h].width+=p:d[h].width=p,d[h].subBlocks[0].updateWidth(d[h].width)):p=d[h].width/(d[h].end-d[h].start),this.renderedSpaceWidths.push(p),o-=1,T=!0):T=!1;if(O)for(var m=this.sublines.first;m;){for(var I=m.subBlocksList.first,D=0;I;)I.updateLeft(D),D+=I.width,I=I.next;m=m.next}T=!1}}},getPaddingForRendering:function(e){return(this.getPaddingStyles()["padding-"+e]||0)+(this.getSpacingStyles()["padding-"+e]||0)},getMarginForRendering:function(e){return this.getSpacingStyles()["margin-"+e]||0},getLeftRightForRendering:function(){var e=this.getDirectionalLeft(),t=this.getView().isRTLPara(),i=this.getBorderWidthAndSpacing(ATTR_BORDERS.BORDER_LEFT,!0),n=this.getBorderWidthAndSpacing(ATTR_BORDERS.BORDER_RIGHT,!0),r=i,o=n,a=this.getAlign();t&&![ALIGN.LEFT,ALIGN.JUSTIFY].contains(TEXT_ALIGN[a])?o+=e:r+=e;var s=this.style.ti||0;return t?o+=s:r+=s,r<0&&(r=0),{left:r,right:o}},findBlockTypeFormats:function(e,t){for(var i,n,r=0;r<this.blocks.length;r++)if(i=this.blocks[r],i.type===e){n=i.formats;for(var o in n)if(!t||n[o].type===t)return n[o]}return null},updateCachedContent:function(){this.cachedContent=this.content},getCachedContent:function(){return this.cachedContent},getFirstVisualBlock:function(){return this.firstBlock},getLastVisualBlock:function(){return this.lastBlock},getLevels:function(){return this.levels},getTypes:function(){return this.types},simplifyLevelsArray:function(){var e=null!==this.getEOPBlock();this.levels=this.view.dtView.getLevels().slice(this.start,e?this.end+1:this.end),this.types=this.view.dtView.getTypes().slice(this.start,e?this.end+1:this.end);for(var t=this.levels,n=this.types,r=[],o="",a=0;a<n.length;a++){var s=i(n[a]);0!==a&&s===o&&t[a]===t[a-1]&&a!==t.length-1||r.push({index:a,contentType:s,direction:t[a]%2===0?PARA_DIR.LTR:PARA_DIR.RTL}),o=s}this.resolvedLevels=r},updateVisualOrder:function(){for(var e,t=[],i=this.sublines.first;i;){for(e=i.subBlocksList.first;e;)t=t.concat(e.getVisualOrder()),e=e.next;i=i.next}this.visualOrder=t},getFirstNonEOPSubBlockInfo:function(){var e=this.getVisualOrder(),t=0,i=e[t],n=this.isLineDirectionRTL(),r=this.getSubBlockAtVisualIndex(i);return r&&n&&r.type===BLOCK_TYPE.EOP&&e.length>1&&(i=e[++t],r=this.getSubBlockAtVisualIndex(i)),{subBlock:r,index:t,visualIndex:i}},updateVisualOrderAndLevels:function(){this.simplifyLevelsArray(),this.fillFirstLastBlock()},adjustLineCodeSegments:function(){var e,t,i,n,r,o=this.segments,a=[];for(e=this.view.getNode().getCodeSegments(),i=0,r=e.length;i<r&&!(e[i]>=this.start);i+=2);for(n=i,i=0,r=o.length;i<r;i++)if(t=o[i],"EOP"!==t.type)if(n<=e.length-2)if(t.start==e[n]||t.start>e[n])for(;t.end&&"undefined"!=typeof e[n];){var s,l=Math.max(t.start,e[n]),d=e[n+2]||t.end,c=t.content.slice(l-t.start,d-t.start);if(t.start==e[n]&&(s=t.left),t.end<=e[n+2]){t.end==e[n+2]&&(n+=2),d=t.end,a.push(new LineSegment(l,d,s,t.format,this.getParent(),t.isRTL,t.width,c,t.computedFormat,!1,e[n+1],t.type));break}a.push(new LineSegment(l,d,s,t.format,this.getParent(),t.isRTL,t.width,c,t.computedFormat,!1,e[n+1],t.type)),n+=2}else{var l=t.start,d=t.end;if(!(t.end>e[n])){d=t.end,a.push(new LineSegment(l,d,t.left,t.format,this.getParent(),t.isRTL,t.width,t.content.slice(0,d-l),t.computedFormat,!1,e[n-1],t.type));continue}for(d=e[n],a.push(new LineSegment(l,d,t.left,t.format,this.getParent(),t.isRTL,t.width,t.content.slice(0,d-l),t.computedFormat,!1,e[n-1],t.type));t.end&&e[n];){var s,l=Math.max(t.start,e[n]),d=e[n+2]||t.end;if(t.start==e[n]&&(s=t.left),t.end<e[n+2]){d=t.end,l!=d&&a.push(new LineSegment(l,d,s,t.format,this.getParent(),t.isRTL,t.width,t.content.slice(l-t.start,d-t.start),t.computedFormat,!1,e[n+1],t.type));break}a.push(new LineSegment(l,d,s,t.format,this.getParent(),t.isRTL,t.width,t.content.slice(l-t.start,d-t.start),t.computedFormat,!1,e[n+1],t.type)),n+=2}}else a.push(new LineSegment(t.start,t.end,t.left,t.format,this.getParent(),t.isRTL,t.width,t.content.slice(l,d),t.computedFormat,!1,e[e.length-1],t.type));else a.push(new LineSegment(t.start,t.end,t.left,t.format,this.getParent(),t.isRTL,t.width,"",t.computedFormat,!1,"",t.type));this.segments=a},splitAndArrangeSegments:function(){this.splitSegmentsWithLevels(),this.updateSegmentDirection(),this.constructSegmentVisualOrder()},splitSegmentsWithLevels:function(){for(var e=this.getResolvedLevels(),t=e.length,i=this.segments,n=0;n<t;n++)for(var r=e[n].index+this.start,o=0;o<i.length;o++){var a=i[o];if("EOP"===a.type&&a.end>=r)break;if(a.start<r&&a.end>r){var s=a.content.slice(r-a.start,a.end),l=e[n].direction===PARA_DIR.RTL,d=new LineSegment(r,a.end,a.left,a.format,this.getParent(),l,a.width,s,a.computedFormat,a.isSpaceSegment,a.code,a.type);i.splice(o+1,0,d),a.end=r,a.content=a.content.slice(0,r-a.start);break}}},updateSegmentDirection:function(){var e=this.getResolvedLevels(),t=e.length,i=this.segments;if(t>1)for(var n=0,r=e[n],o=r.direction,a=r.contentType,s=e[n+1],l=0;l<i.length;l++){var d=i[l];if(this.start+s.index<=d.start&&(n++,r=s,o=r.direction,a=r.contentType,s=e[n+1],!s))break;d.isRTL=o===PARA_DIR.RTL,d.contentType=a}},getSegmentAndPositionAtIndex:function(e){for(var t,i=0;i<this.segments.length;i++)if(t=this.segments[i],e>=t.start&&e<t.end||"EOP"===t.type&&t.start===e)return{segment:t,position:i};return null},constructSegmentVisualOrder:function(){for(var e,t,i=[],n=this.getVisualOrder(),r=-1,o=0;null!=n[o];)if(e=this.getSegmentAndPositionAtIndex(n[o])){t=e.segment,"EOP"===t.type?r=e.position:i.push(e.position);var a=t.end-t.start;0===a&&(a=1),o+=a,n[o]>=t.start&&n[o]<t.end&&o++}else o++;r>-1&&(this.isLineDirectionRTL()?i.splice(0,0,r):i.push(r)),this.segmentOrder=i},updateSpaceSegments:function(){for(var e=this.getView().isRTLPara(),t=this.segments,i=t.length,n=e?0:i-1;e?n<i:n>=0;e?n++:n--){var r=t[n],o=r.content,a=o.trimRight();if(0!==a.length){if(a.length!==r.end-r.start){var s=a.length,l=new LineSegment(r.start+s,r.end,r.left,r.format,this.getParent(),r.isRTL,r.width,r.content.slice(s,r.end),r.computedFormat,!0,"",r.type);r=new LineSegment(r.start,r.start+s,r.left,r.format,this.getParent(),r.isRTL,r.width,r.content.slice(0,s),r.computedFormat,!1,r.code,r.type),t.splice(n,1,r),t.splice(n+1,0,l)}break}r.isSpaceSegment=!0}},destroy:function(){this.id="",this.type="",this.start=0,this.end=0,this.height=0,this.outerHeight=0,this.contentHeight=0,this.style={},this.remainingWidth=0,this.origRemainingWidth=0,this.listWidth=0,this.listRight=0,this.width=0,this.left=0,this.right=0,this.floatImagesData=[],this.align=0,this.segments=[],this.imageSegments=[],this.blocks=[],this.length=0,this.parent=null,this.removeParentReference(),this.section=null,this.imagePaddingLeft=0,this.renderedSpaceWidths=[],this.spaceWidths=[],this.commentEnds=null,this.autoField=null,this.isPageAutoField=!1,this.bookMarks=null;for(var e=0;e<META_SECTIONS.length;e++){var t=META_SECTIONS[e];this[t]=null}this.baseLine=null,this.status=LINE_STATUS.NONE,this.borderStyles={},this.paddingStyles={},this.spacingStyles={},this.cachedContent="",this.sublines=null,this.segmentOrder=[],this.tabs=null,this.backgroundStyles={},this.drawInfo={},this.firstBlock=null,this.lastBlock=null,this.resolvedLevels=[],this.visualOrder=[],this.levels=[],this.types=[]}}),e}(),BaseParaDocView=function(e,t,i,n){"use strict";function r(e,t,i,n){DocView.apply(this,arguments),this.start=0,this.nodeLines=[],this.paraStyles={},this.borderStyles={},this.isReflow=!1,this.lineFormats=null,this.forceReRender=!1}var o=function(e){for(var t=0;t<e.length;t++)e[t].destroy()};return r.prototype=Object.create(DocView.prototype),r.prototype.constructor=r,extend(r.prototype,{createDocView:function(){},updateLayoutAndDesign:function(t){for(var i,n=this.getPrevView(),r=this.getNextView(),o=this.getDTView(),a={spaceProperties:o.getParaSpacingProperties(),backgroundColor:o.getBackgroundColor(),samePrevFormat:e.compareParaBorderFormats(this,n)&&this.getLeft()===n.getLeft()&&this.getWidth()===n.getWidth(),sameNextFormat:e.compareParaBorderFormats(this,r)&&this.getLeft()===r.getLeft()&&this.getWidth()===r.getWidth()},s=0;s<this.getNodeLinesLength();s++)i=this.nodeLines[s],i.updateProperties(a);if(this.adjustHeight(),this.publishNodeLineEvents(),t){if(n){var l=n.getSection();l&&!l.isInUpdateQueue(n)&&n.updateLayoutAndDesign()}if(r){var d=r.getSection();d&&!d.isInUpdateQueue(r)&&r.updateLayoutAndDesign()}}},shouldBuildAllLines:function(){var e=!1;this.section.getSectionType();return(this.section.isReplicableView()||this.parent.getType()===VIEW.CELL)&&(e=!0),e},getLineHeightUntil:function(e){if(!e)return this.getHeight();for(var t=0,i=0;i<this.getNodeLinesLength();i++){if(this.nodeLines[i]===e)return t;t+=this.nodeLines[i].getHeight()}},updateSectionAllowedHeight:function(){var e=this.getSection();if(!(this.getColumn().getColumnNumber()>1)){var t=this.getAbsTop(VIEW.SECTION);this.getNodeLinesLength()>1?t+=this.getLineHeightUntil(this.getLastNodeLine()):0===e.getAllowedHeight()&&(t+=this.getHeight()),t<=e.getAllowedHeight()||e.setAllowedHeight(t)}},addLinesToView:function(e){if(e.length){for(var t,n,r={},a=0;a<META_SECTIONS.length;a++){n=META_SECTIONS[a],r[n]=[];for(var s=0,l=e.length;s<l;s++){t=e[s];for(var d=t.getMetaSectionByType(n),c=0;c<d.length;c++){var u=d[c].id,g=t.view.documentLayoutManager.getSectionViews(u)[0];n===SECTION_TYPES.ENDNOTE?r[n].push(g):g&&g.getDTView().belongsToPara(t.view.getNodeId())&&(n!=SECTION_TYPES.TEXTBOX||g.getPage()===t.view.getPage())&&(r[n].push(g),g.getPage().removeSectionView(g))}}}for(var s=0,l=e.length;s<l;s++)t=e[s],t.removeParentReference(),t.updateParentReference(this);for(var n in r){d=r[n];for(var s=0;s<d.length;s++)d[s].setContainingParaReference(this,this.getNode()),d[s].getSectionType()!==SECTION_TYPES.ENDNOTE&&this.getPage().addSectionView(d[s])}var h=this.cloneNodeLines();if(this.nodeLines.length){var f=i.lastElementOf(e);if(f.end<=this.nodeLines[0].start)f.next=this.nodeLines[0],this.nodeLines[0].prev=f,this.nodeLines=e.concat(this.nodeLines);else{var p=e[0],E=i.lastElementOf(this.nodeLines);E.next=p,p.prev=E,this.nodeLines=this.nodeLines.concat(e)}}else this.nodeLines=e;this.updateHeight(),this.updateNodeLineStatus(h),o(h),this.updateLayoutAndDesign(!0),this.updateSectionAllowedHeight(),this.publishNodeLineEvents()}},updateDocView:function(e){e=e||{};var i=this.getHeight(!0),n=this.getDTView(),r=n.getListData();this.updateListData();var a=!t.compareJSON(r,n.getListData()),s=this.getParent(),l=s.getHeight(),d=0;s.getType()!==VIEW.COLUMN&&(d=s.getLastVmpRowHeight()),this.updateProperties();var c=this.cloneNodeLines();this.clearChildren(),this.preUpdateFloatImageProcess(),this.updateHeight(),this.moveOverFlowingFloatImagesFromPreviousSplitViews(),this.buildLines(),this.updateNodeLineStatus(c,e.forceReRender,a),o(c),this.updateLayoutAndDesign(!0),this.updateSectionAllowedHeight(),this.publishNodeLineEvents(),this.updateMetaReferenceInPara();var u=this.removeNextExcessViews(),g=!1;(!n.isEndIndex(this.getEnd())||u||s.getType()!==VIEW.CELL&&(i!==this.getHeight(!0)||this.getSection().isOverFlowing())||n.hasPageBreakBefore()||n.shouldKeepWithNext())&&(g=!0);var h=this.isMetaSection(),f=this.getColumn(),p=this,E=!1,T=this.getNode(),O=f.getPreviousSplitView(),m=O&&O.getSection();if(h)if(this.getSection().getSectionType()===SECTION_TYPES.FOOTNOTE){var I=this.getSection();p=I.getContainingPara(),f=p.getColumn(),O=f.getPreviousSplitView(),m=O&&O.getSection()}else T.section.getSectionType()===SECTION_TYPES.ENDNOTE&&(E=!0);var D=!1,R=p.getColumnToBePaginated();if(R&&R!=f&&(D=!0),O&&!E&&D&&this.getParent().getType()!==VIEW.CELL&&!this.getSection().shouldResetSectionBalancing())m.addToPaginationQueue(O);else if(s.getType()===VIEW.CELL){var S=s.getParent(),C=S.getMaxHeightExceptThisCell(s),A=s.getHeight();l!=A&&(l>C?this.getSection().addToPaginationQueue(this.getColumn()):A>C&&this.getSection().addToPaginationQueue(this.getColumn()));var v=s.isFCCell(),_=s.getLastVmpCell();v&&d&&d!=_.getParent().getHeight()&&this.getSection().addToPaginationQueue(this.getColumn()),S.updateHeaderRowInAllViews()}return g},removeNextExcessViews:function(){var e=!1,t=this.getDTView();if(t.getIndex()+this.getEnd()===this.getDTView().getEndIndex())for(var i,n=this.getNextSplitView();n;)i=n.getNextSplitView(),n.getSection().addToPaginationQueue(n.getColumn()),n.removeAllChildViews(!0,!0),e=!0,n=i;return e},updateListData:function(){var e=this.getDTView();e.isList()?e.addListData(this):e.removeListData()},preUpdateFloatImageProcess:function(){var e=this.getPreviousSplitView();if(!this.isReflow)if(e)for(var t=this.getFloatImages(),i=0;i<t.length;i++)t[i].getIndex()<e.getEnd()||this.getSection().removeFloatImage(t[i]);else this.getSection().removeAllFloatImagesInView(this);this.isReflow=!1},prepareViewForCreate:function(){var e=this.getDTView(),i=e.getListData();this.updateListData();var n=!t.compareJSON(i,e.getListData()),r=this.cloneNodeLines();this.clearChildren(),this.preUpdateFloatImageProcess(),this.updateHeight(),this.moveOverFlowingFloatImagesFromPreviousSplitViews(),this.updateNodeLineStatus(r,!1,n),o(r),this.updateLayoutAndDesign(!0),this.updateSectionAllowedHeight(),this.publishNodeLineEvents()},addToUpdateQueue:function(e,t,i){var n=this.getSection();if(n.isDirtyNode(this)){var r=n.getOpTypeInUpdateQueue(this);if(r===OP_TYPE.REMOVE||r===OP_TYPE.UPDATE)return}else if(this.isParentSetToRemove())return;if(e===OP_TYPE.UPDATE){var o=this.getSection();o.getOpTypeInViewUpdateQueue(this)===OP_TYPE.CREATE&&this.prepareViewForCreate()}DocView.prototype.addToUpdateQueue.call(this,e,t,i)},getNodeLine:function(e){return this.nodeLines[e-1]},isPageBreakSetInPrevViews:function(){for(var e,t,i=this.getPrevView();i;){if(i.getType()==NODE_TYPE.PARA&&(e=i.getParaProperties(),t=e.pageBreakBefore||!1))return!0;i=i.getPrevView()}return!1},getColumnToBePaginated:function(){var e=this.getColumn(),t=e.getPage()||null,i=e.getPreviousSplitView();if(!i||!t)return e;var r=i.getSection(),o=i?i.getLastChild():null;if(o&&o.getType()===VIEW.HR&&o.isBreaks())return e;var a,s,l,d,c=i.getHeight(),u=r.getMaxRenderingHeight()-r.getFirstColumn().getFootNoteHeight(),g=u-c,h=this.getParaProperties();a=h.keepNext||!1,s=h.linesTogether||!1,l=h.widowsOrphan||!1,d=h.pageBreakBefore||!1;var f=this.prev,p=this.getParent(),E=i.getLastChild(),T=!1;if(p.getType()===VIEW.CELL&&E&&E.getType()===VIEW.TABLE){for(var O=p.getViews(),m=p.getId(),I=0;m!==O[I].getId();)I++;if(0===I)return e;var D=O[I-1],R=D.getContentHeight(),S=D.getRow().getHeight(),C=this.getFirstNodeLine(),A=C?C.getHeight():0;S-R+g>=A&&(T=!0)}else d?(T=f&&this.getTop()<=g,T=T&&!this.isPageBreakSetInPrevViews()):f||(T=n.shouldPaginateFromPrevColumn(this,g)),T||a||s||l||d||f||(T=o&&o.getType()===VIEW.PARA&&o.getParaProperties().keepNext);return T?i:e},getMinRenderingHeight:function(){var e=this.getParaProperties(),t=this.getNodeLinesLength(),i=e.keepNext||!1,n=e.linesTogether||!1,r=e.widowsOrphan||!1,o=this.getHeight(!0),a=0;if(n)a=o;else{var s=this.getFirstNodeLine();if(i)if(t>1)a=s.getHeight(!1,!0);else{a=o;var l=this.next;l&&(a+=l.getMinRenderingHeight())}else r?a=t>3?s.getHeight(!1,!0)+this.getNodeLine(2).getHeight(!1,!0):o:s&&(a+=s.getHeight(!1,!0))}return a},getBorderStyles:function(e){var t=this.getDTView().getBorderProperties();return e?t[e]:t},getBorderWidthAndSpacing:function(e,t,i){var n=this.getBorderStyles(e),r=0;return n&&(t||(r+=n.width),i||(r+=n.space)),r},updateLeft:function(){var e=this.getDTView(),t=e.getMarginLeft(),i=e.getTextIndent(),n=e.getPaddingLeft(),r=t+n;i<0&&(r+=i),this.left=r},updateRight:function(){var e=this.getDTView().getMarginRight(),t=0;t+=this.getWidth(),t-=e,this.right=t},getContentWidth:function(){return this.getRight()-this.getLeft()},getOuterLeft:function(){return this.getLeft()-this.getBorderWidthAndSpacing(ATTR_BORDERS.BORDER_LEFT)},getOuterRight:function(){return this.getRight()+this.getBorderWidthAndSpacing(ATTR_BORDERS.BORDER_RIGHT)},getOuterWidth:function(){return this.getOuterRight()-this.getOuterLeft()},getVisualRight:function(){return this.getDTView().getMarginRight()},getRight:function(){return this.right},getHeight:function(e){var t=this.height;return e&&(t+=this.getFootNoteHeight()),t},getFootNoteHeight:function(){for(var e=0,t=0,i=this.nodeLines.length;t<i;t++)e+=this.nodeLines[t].getFootnoteHeight();return e},updateProperties:function(e){this.setViewTop(),e=e||{};var t=this.getParaStyles();this.updateLeft(),this.updateWidth(),this.updateRight(),this.lineFormats=this.lineFormatGenerator(t),e.start>=0&&this.setStart(e.start)},getParaProperties:function(){return this.dtView.getParaProperties()},getIndexAfterWidowsOrphan:function(e,t,i){var n=e,r=this.getNodeLines(),o=this.getNodeLinesLength();if(o>1){e===o-1?2===e?e=0:e--:1===e&&(e=0);var a=r.slice(e),s=a.length;if(e!=n){var l,d=a[0].getHeight(!1,i);if(s>1){var c=a[1].getHeight(!1,i);l=d+c}else l=d;0==e&&(s>3||1==s)&&l>t?e=n:2==s&&l>t?e=n:3==s&&l+a[2].getHeight(!1,i)>t&&(e=n)}}return e},getParaObjForSplit:function(e,t,i,n){var r,o,a,s,l,d=this.getNodeLines(),c=0,u=this.getSection().getMaxRenderingHeight(),g=0,h=this.getNodeLinesLength(),f=this.getParent(),p=this.getPrevView();for((!f||f.getType()!==VIEW.CELL&&f.getType()!==VIEW.TOC)&&(a=this.getDTView().getParaProperties().linesTogether,s=this.getDTView().getParaProperties().widowsOrphan,l=!(!p||p.getType()!==VIEW.PARA||!p.getDTView().getParaProperties())&&p.getDTView().getParaProperties().keepNext),n&&n.borderHeight&&(g=n.borderHeight),o=0;o<h;o++){if(r=d[o].getHeight(!1,n.considerFootNotes),c+r>e){0===o&&g+r>=u&&this.getSection().isFirstSectionInPage()&&!n.hasPrevView&&(o++,d[o]&&(r=d[o].getHeight(!1,n.considerFootNotes))),a&&c+r<u&&(o=0);break}c+=r}if(s&&(o=this.getIndexAfterWidowsOrphan(o,u,n.considerFootNotes)),l&&0===o){var E=this.getPreviousViewObj();if(E.view){var p=E.view,T=0;if(p.getDTView().getParaProperties()&&!p.getDTView().getParaProperties().keepNext?p=p.getNextView():p.getNodeLinesLength()>1&&(o=p.getNodeLinesLength()-1,T=p.getHeight()-p.getLastNodeLine().getHeight()),s=p.getParaProperties().widowsOrphan){var O=p.getParaObjForSplit(T,i,t,n);if(O.view&&!O.view.getPrevView()&&0==O.splitIndex||O.forceSplit)return{splitHeight:e,view:this,splitIndex:0,forceSplit:!0};T=O.splitHeight,p=O.view,o=O.splitIndex}return{splitHeight:T,view:p,splitIndex:o}}}return{splitHeight:e,view:this,splitIndex:o}},setHeightAndTop:function(){this.updateHeight(),n.updateAllViewsTop(this)},adjustHeight:function(){var e=this.getParent(),t=this.getDTView();if(e&&e.getType()===VIEW.CELL&&t&&!t.next){var i=[],n=e.getFirstChild();for(var r in e.floatImageHeight)i.push(e.floatImageHeight[r]);for(var o=function(e){i=i.map(function(t){return t-e.getHeight()})};n;)o(n),n=n.next;if(i.sort(),i=i[i.length-1],i>0&&this.getNodeLinesLength()&&this.getLastNodeLine().outerHeight<i){var a=this.getLastNodeLine();a.height+=i,a.outerHeight+=i,this.setHeightAndTop()}}},checkMerge:function(){var e=this.getNextView(),t=this.getPrevView();return e&&this.getNodeId()===e.getNodeId()?this.merge(e,this.getColumn()):t&&t.getNodeId()===this.getNodeId()?t.merge(this,this.getColumn()):this},merge:function(e){if(this.logger().log("Para views merge :: %c"+this.getId()+", "+e.getId(),"color:"+COLOUR.GREEN),this.getStart()!==-1&&e.getStart()!==-1&&this.getStart()>e.getStart())return this.logger().log("Para views merge :: Reverse merge"),e.merge(this);var t=this.isInFloatImageArea(),i=e.isInFloatImageArea();if(t||i||this.getColumn().getWidth()!==e.getColumn().getWidth()||this.getEnd()!==e.getStart()){var n=this.cloneNodeLines();e.removeNodeLines(),this.updateHeight(),this.updateNodeLineStatus(n),o(n),this.publishNodeLineEvents()}else e.moveLines(0,this);this.addToUpdateQueue(OP_TYPE.UPDATE,!0),e.moveOverFlowingFloatImagesTo(this,!0);var r=e.getSection().removeFromUpdateQueue(e);if(r){var a=this.getSection(),s=r[0].opType;switch(s){case OP_TYPE.CREATE:if(a.isInUpdateQueue(this)){var l=a.getOpTypeInViewUpdateQueue(this);[OP_TYPE.UPDATE_LIST,OP_TYPE.ADJUST_BORDER].contains(l)&&this.addToUpdateQueue(OP_TYPE.UPDATE,!0)}else this.addToUpdateQueue(OP_TYPE.UPDATE,!0);break;default:this.addToUpdateQueue(r[0].opType,!0)}}return e.isEligibleForRemove()&&e.removeAllChildViews(!0,!0),this.updateMetaReferenceInPara(),this.updateLayoutAndDesign(),this.getSection().isDirtyNode(this)||this.getSection().isInUpdateQueue(this)||this.getSection().trigger(DOCVIEW.VIEW_AFTER_UPDATE,this),this},removeAllChildViews:function(e,t){this.removeView(e,t)},removeAllReferenceSections:function(e){for(var t,i,n=this.getGroup(),r=n.getDTViewManager(),o=n.canPaginate,a=0;a<META_SECTIONS.length;a++){i=e[META_SECTIONS[a]]||[];for(var s=0;s<i.length;s++)if(t=r.getDTSectionViewByID(i[s].id)){var l=this.documentLayoutManager.getSectionViews(i[s].id)[0];if(l&&l.getDTView().belongsToPara(this.getNodeId())&&(META_SECTIONS[a]!=SECTION_TYPES.TEXTBOX||l.getPage()&&l.getPage()===e.getPage())){if(META_SECTIONS[a]==SECTION_TYPES.TEXTBOX){var d=this.getFloatImageForFid(l.getRangeFormat().fid);d&&this.getSection().removeFloatImage(d)}l.getPage().removeSectionView(l)}n.updateCanPaginateStatus(!1),n.removeSectionView(t),n.updateCanPaginateStatus(o)}}},remove:function(){var e=this.getHeight(!0);this.removeNodeLines(),this.getSection().removeAllFloatImagesInView(this);var t=this.getNextView(),i=this.getParent();i.preRemove(this),n.updateAllViewsTop(t);var r=!0;return e===this.getHeight(!0)&&(r=!1),this.destroy(),r},removeView:function(e,t){var i=this.getPrevView();DocView.prototype.removeView.call(this,e,t),!i||i.getSection().isInUpdateQueue(i)||i.getDTView().toBeRemoved()||i.documentLayoutManager.docTreeDestroyInProgress||i.updateLayoutAndDesign()},getFloatImages:function(){for(var e,t=[],i=this.getSection().getFloatImages(!0),n=0;n<i.length;n++)e=i[n],e.getView()===this&&t.push(e);return t.sort(function(e,t){return e.getAbsLeft(VIEW.PAGE)-t.getAbsLeft(VIEW.PAGE)}),t},getFloatImageForIndex:function(e){for(var t=this.getFloatImages(),i=0;i<t.length;i++)if(t[i].getIndex()===e)return t[i];return null},getFloatImageForFid:function(e){for(var t=this.getFloatImages(),i=0;i<t.length;i++)if(t[i].getFId()===e)return t[i];return null},destroy:function(){this.forceReRender=!1,this.isReflow=!1,this.borderStyles={},this.start=0,this.nodeLines=[],this.floatImages=[],this.paraStyles={},DocView.prototype.destroy.call(this)},isEligibleForRemove:function(){return 0===this.getHeight(!0)&&DocView.prototype.isEligibleForRemove.call(this)},getParaStyles:function(){return this.getDTView().getParaStyles()},getCodeProperties:function(){return this.getNode().getCodeProperties()},getNodeLines:function(){return this.nodeLines},cloneNodeLines:function(e,t,n){var r,o,a=[];t=t>=0?t:0,n=n>=0?n:this.getNodeLinesLength();for(var s=t;s<n;s++)r=new LineDocView(this.nodeLines[s]),e&&(r=r.getAsNewLine()),defineLineProperties(r),o=i.lastElementOf(a),a.push(r),o&&(r.prev=o,o.next=r),r.next=null;return a},updateNodeLineStatus:function(e,t,i){for(var n,r,o=this.getNodeLines(),a=this.getNodeLinesLength(),s=e.length,l=0;l<a;l++)n=o[l],r=e[l],r?(n.setId(r.getId()),t||this.forceReRender||n.getContent()!==r.getCachedContent()||n.getSegmentsLength()!==r.getSegmentsLength()||n.getContent().indexOf(UNICODE.IMAGE)!==-1||this.isStyleChanged(n,r)||0===n.start&&i?n.setStatus(LINE_STATUS.UPDATE):(n.setStatus(r.getStatus()),n.getStatus()===LINE_STATUS.NONE&&n.setStatus(LINE_STATUS.RECREATE))):n.setStatus(LINE_STATUS.CREATE);if(s>a)for(var l=a;l<s;l++)this.propagateVia(this.getSection(),DOCVIEW.LINE_BEFORE_REMOVE,e[l])},triggerNodeLinesRemovedEvent:function(e,t){var i=this.nodeLines;e=e||0,t=t||i.length;for(var n=e;n<t;n++)this.propagateVia(this.getSection(),DOCVIEW.LINE_BEFORE_REMOVE,i[n])},removeNodeLines:function(){for(var e=0;e<this.getNodeLinesLength();e++)this.removeAllReferenceSections(this.getNodeLine(e+1));this.triggerNodeLinesRemovedEvent(),this.clearChildren(),this.documentLayoutManager.docTreeDestroyInProgress||this.updateHeight()},clearChildren:function(){var e,t=this.getNodeLines(),i=t.length;for(e=0;e<i;e++)t[e].destroy();this.nodeLines.splice(0,this.getNodeLinesLength())},lineFormatGenerator:function(e){var t,i,n,r,o=this.getContentWidth(),a=[],s={},l={},d=this.getParaStyles(),c=[ATTR_PARAGRAPH.PS_ML,ATTR_PARAGRAPH.PS_MR,ATTR_PARAGRAPH.PS_PL,ATTR_PARAGRAPH.PS_PR];for(r=c.length,n=0;n<r;n++)t=c[n],i=e[t]||d[t],i&&(i=i.convertor().pixels,s[t]=i,l[t]=i);var u=e[ATTR_COMMON.BORDERS];s[ATTR_COMMON.BORDERS]={},s[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]={space:(u&&u[ATTR_BORDERS.BORDER_TOP]&&u[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},s[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]={space:(u&&u[ATTR_BORDERS.BORDER_LEFT]&&u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},s[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]={space:(u&&u[ATTR_BORDERS.BORDER_RIGHT]&&u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},s[ATTR_PARAGRAPH.PS_PL]=0,s[ATTR_PARAGRAPH.PS_PR]=0,l[ATTR_COMMON.BORDERS]={},l[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_RIGHT]={space:(u&&u[ATTR_BORDERS.BORDER_RIGHT]&&u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_RIGHT][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},l[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_LEFT]={space:(u&&u[ATTR_BORDERS.BORDER_LEFT]&&u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]?u[ATTR_BORDERS.BORDER_LEFT][ATTR_BORDERS.SPACE]:"0in").convertor().pixels},l[ATTR_PARAGRAPH.PS_PL]=0,l[ATTR_PARAGRAPH.PS_PR]=0,l.width=o,l.width<0&&(l.width=20);var g=e[ATTR_PARAGRAPH.PS_TI]||d[ATTR_PARAGRAPH.PS_TI];g&&(g=g.convertor().pixels,g>0?(s.width=o-g,l.width=o,s[ATTR_PARAGRAPH.PS_TI]=g,l[ATTR_PARAGRAPH.PS_TI]=0):(s.width=o,l.width=o+g,l[ATTR_PARAGRAPH.PS_TI]=Math.abs(g),s[ATTR_PARAGRAPH.PS_TI]=0,l[ATTR_PARAGRAPH.PS_ML]-=g),0==this.start&&a.push(s)),s.width<20&&(s.width=20);var h=this,f=function(){return!h.nodeLines.length&&a.length?clone(a.pop()):clone(l)};return{next:f}},getTabPoints:function(){var e,t=this.getParaStyles(),i=[],n=0,r=0,o=0;t&&(t[ATTR_PARAGRAPH.PS_TPS]&&(e=t[ATTR_PARAGRAPH.PS_TPS]),t[ATTR_PARAGRAPH.PS_PL]&&(n=(t[ATTR_PARAGRAPH.PS_PL]||"0in").convertor().pixels),t[ATTR_PARAGRAPH.PS_ML]&&(r=(t[ATTR_PARAGRAPH.PS_ML]||"0in").convertor().pixels),t[ATTR_PARAGRAPH.PS_TI]&&(o=(t[ATTR_PARAGRAPH.PS_TI]||"0in").convertor().pixels));var a=this.getSection().getLeft();if(e&&"object"==typeof e)for(var s=e.length,l=0;l<s;l++){var d=e[l].point;d||(d="0in");var c=d.convertor().pixels+a;i[l]={value:c,align:e[l].align,style:e[l].leader}}o<0&&i.push({value:a+r+n,align:0,style:0});for(var u=i.length,g=0;g<u;g++)for(var h=u-1;h>g;h--)if(i[h-1].value>i[h].value){var f=i[h-1];i[h-1]=i[h],i[h]=f}var p=this.getSection().getDefaultTabPointWidth(),u=i.length;if(u>0){p=[];for(var E=0;E<u;E++)p[E]=i[E].value;var T=Math.max.apply(Math,p);p=i,u=p.length;for(var E=0;E<u;E++){var O=p[E];O.value>T&&p.push(O)}}return p},getLineIndex:function(){var e=this.getEnd();if(e===-1){var t=this.getPreviousSplitView();if(t)return t.getLineIndex()}var i=this.getNodeLinesLength()&&this.getLastNodeLine().getEOPBlock();return this.dtView.getIndex()+e===this.dtView.getEndIndex()&&i?-1:(e===-1&&(e=0),e)},isAboveGivenView:function(e){var t=!1,i=this.getNodeStartIndex(),n=e.getNodeStartIndex();if(i<n){t=!0;for(var r=this;r&&"column"!=r.getParent().getType();){if(r.getParent().getNodeEndIndex()>n){"row"==r.getParent().getType()&&(t=!1);break}r=r.getParent()}}return t},postLineProcess:function(e){var t,i,n,r,o,a,s;for(s=this.getLastNodeLine(),this.nodeLines.push(e),s&&(e.prev=s,s.next=e),e.next=null,i=this.dtView.getIndex(),o=0,a=e.blocks.length;o<a;o+=1)if(t=e.blocks[o],n=editor.doc.getCharAt(i+t.start),r=editor.doc.getRawFormatAt(i+t.start),n===UNICODE.IMAGE&&r&&r.subType===SECTION_TYPES.TEXTBOX)this.getGroup().buildReferenceMetaSection(this,r.id||r.sid),e[r.subType].push({index:i+t.start,id:r.id});else{var l=RANGE_CHARS_REGEX;l.lastIndex=0;for(var d=t.start+i,c=t.end+i,u=editor.doc.getContent(d,c),g=l.exec(u);null!=g;){var h=u.charAt(g.index),f=g.index+t.start+i;r=this.dtView.getRawFormatAt(f),h==UNICODE.RANGE_START?"bookmark"==r.type?e.bookMarks.push({index:f,id:r.id,name:r.name}):NOTE_SECTIONS.contains(r.type)?this.getGroup().buildReferenceMetaSection(this,r.id||r.sid):r.type===NODE_TYPE.AUTOFIELD&&("autopno"!=r.ftype&&"autopcnt"!=r.ftype||(e.isPageAutoField=!0)):r&&(r.type===NODE_TYPE.AUTOFIELD||r.type===NODE_TYPE.FILLABLEFIELD||r.type===NODE_TYPE.SIGNERFIELD?e.autoField=!0:r.type===SECTION_TYPES.FOOTNOTE||r.type===SECTION_TYPES.ENDNOTE?(e[r.type].push({index:f,id:r.id}),this.updateMetaReference(r.id)):"comment"==r.type&&e.commentEnds.push({index:f,id:r.id})),g=l.exec(u)}}this.updateHeight()},buildLines:function(){var e=this.getLineIndex(),t=this.lineFormats.next(),i=t.width,n=this.getSection().getMaxRenderingHeight(),r=this.getAbsTop(VIEW.SECTION),o={height:0,baseLine:0};if(0===e){if(this.getDTView().isList()){var a=this.dtView.getListData();i-=a.listRight,o.height=a.listCharSize.height,o.baseLine=a.listCharSize.baseLine}var s=this.getSection().getDTView();s&&NOTE_SECTIONS.contains(s.getSectionType())&&s.isFirstView(this.getDTView())&&(i-=s.getReferenceCharWidth())}for(var l,d,c;e!==-1;){var u=this.getContentWidth()-i,g=this.getContentWidth();if(this.isRTLPara()&&(g-=u,u=0),l=new LineBuilder(this,e,r,u,g,t,o),l.init(),this.isReflow||l.end===-1)return;if(d=l.build(),d&&this.postLineProcess(d),c=this.getLineIndex(),c!==-1||d.getEOPBlock()||(c=this.getEnd()),e=c,r+=this.getLastNodeLine().getHeight(),r>n&&this.getColumn().isEligibleForSplit()&&!this.shouldBuildAllLines())return;t=this.lineFormats.next(),i=t.width}},isRTLPara:function(){return this.getDTView().isRTLPara()},updateSpaceSegments:function(){for(var e=0;e<this.nodeLines.length;e++)this.nodeLines[e].updateSpaceSegments()},getPreviousViewObj:function(){for(var e=this.getHeight(),t=this.getPrevView();t;){if(t.getType()!==VIEW.PARA||!t.getParaProperties().keepNext){t.getType()!==VIEW.PARA&&(t=t.getNextView());break}if(t.getNodeLinesLength()>1&&!t.getParaProperties().linesTogether)break;e+=t.getHeight(),t=t.getPrevView()}return{view:t,height:e}},setStart:function(e){this.start=e},getFirstNodeLine:function(){return this.nodeLines[0]||null},getLastNodeLine:function(){return this.nodeLines.length&&i.lastElementOf(this.nodeLines)||null},moveLines:function(e,t){if(this.nodeLines[e]){var i=this.cloneNodeLines(),n=this.cloneNodeLines(!0,e);this.nodeLines.splice(e);var r=this.getLastNodeLine();r&&(r.next=null),n[0].prev=null,t.addLinesToView(n),this.updateHeight(),this.updateNodeLineStatus(i),o(i),this.publishNodeLineEvents()}},findOrCreateSplitDocView:function(e,t){var i;i=t&&t.parent?t.parent:this.findParentDocViewInColumn(e)||e;var n=e.getSection(),r=this.getDTView(),o=this.findDocViewInColumn(e);if(o){var a=o.getSection(),s=a.removeFromUpdateQueue(o);s&&s.length&&s[0].opType===OP_TYPE.REMOVE&&(o.removeAllChildViews(!0,!0),o=null)}return o?(o.removeNodeLines(),o.updateLayoutAndDesign(!0),o.updateSectionAllowedHeight(),o.publishNodeLineEvents()):o=n.addToSectionView(r,n,e,i),o},split:function(e,t,i,n,r){if(this.logger().log("para view split :: %c"+this.getId(),"color:"+COLOUR.GREEN),!this.nodeLines[r])return null;n=n||{},n.isUserOperation=!1;var a=this.findOrCreateSplitDocView(t,n),s=a.getSection();a.updateProperties({start:this.start+r});var l=this.isInFloatImageArea(),d=a.isInFloatImageArea();if(l||d||this.column.getWidth()!==a.column.getWidth()){var c=this.cloneNodeLines();this.nodeLines[r].next=null,this.nodeLines.splice(r),this.updateNodeLineStatus(c),o(c),this.publishNodeLineEvents(),this.updateHeight()}else this.moveLines(r,a);if(a.getDTView().isEndIndex(a.getEnd()))s.getOpTypeInViewUpdateQueue(a)===OP_TYPE.CREATE&&s.removeFromUpdateQueue(a);else{var u=a.getPage()===this.getPage();a.addToUpdateQueue(OP_TYPE.UPDATE,u)}var g=0,h=a.getViews();return U.each(h,function(e){e.setStart(g),g+=e.getNodeLinesLength()}),this.moveOverFlowingFloatImagesTo(a,this.isEligibleForRemove()),this.updateLayoutAndDesign(),a.updateLayoutAndDesign(!0),this.getSection().isDirtyNode(this)||(!this.getSection().isInUpdateQueue(this)&&this.getSection().trigger(DOCVIEW.VIEW_AFTER_UPDATE,this),!a.getSection().isInUpdateQueue(a)&&a.getSection().trigger(DOCVIEW.VIEW_AFTER_UPDATE,a)),a},updateMetaReferenceInPara:function(){if(!this.isMetaSection())for(var e=0;e<META_SECTIONS.length;e++)for(var t=0;t<this.getNodeLinesLength();t++){var i=this.nodeLines[t];this.updateMetaReferenceInLine(i,META_SECTIONS[e])}},updateMetaReferenceInLine:function(e,t){for(var i=e.getMetaSectionByType(t),n=0;n<i.length;n++){var r=i[n].id;this.updateMetaReference(r)}},updateMetaReference:function(e){var t=this.documentLayoutManager.getSectionViews(e)[0];t&&t.getDTView().belongsToPara(this.getNodeId())&&t.setContainingParaReference(this,this.getNode())},moveOverFlowingFloatImagesTo:function(e,t){t=!!t;for(var i,n,r=this.getFloatImages(),o=0;o<r.length;o++)if(i=r[o],t||i.getSplitTop()+i.getTop()>=this.getSplitHeight()+this.getHeight()){if(n=e.getFloatImageForIndex(i.getIndex()),n&&e.getSection().removeFloatImage(n),i.isTextBox){var a=this.documentLayoutManager.getSectionViews(i.getFormatId())[0];a&&a.getPage()!==e.getPage()&&(e.getPage().isAnOutGoingTextbox(i.getFormatId())?(e.getPage().removeFromOutGoingTextbox(i.getFormatId()),a.getPage().removeSectionView(a),e.getPage().addSectionView(a)):a.getPage().addToOutGoingTextboxes(i.getFormatId(),a.getContainingPara(),e.getPage()))}this.getSection().updateFloatImage(i,e)}},moveOverFlowingFloatImagesFromPreviousSplitViews:function(){for(var e=this.getViews()||[],t=0;t<e.length&&e[t]!==this;t++)e[t].moveOverFlowingFloatImagesTo(this)},updateHeight:function(){for(var e=0,t=this.getNodeLines(),i=0;i<this.getNodeLinesLength();i++)e+=t[i].getHeight();this.getHeight()!==e&&(this.height=e,n.updateAllViewsTop(this),this.parent.updateHeight())},getCommonStyles:function(){var e={};return e[ATTR_PARAGRAPH.PS_DIR]="direction",e[ATTR_PARAGRAPH.PS_ML]="marginLeft",e[ATTR_PARAGRAPH.PS_MR]="marginRight",e[ATTR_PARAGRAPH.PS_WS]="wordSpacing",e},getSpecialStyles:function(){return[ATTR_PARAGRAPH.PS_BGC,ATTR_PARAGRAPH.PS_TPS,ATTR_PARAGRAPH.PS_HD,ATTR_PARAGRAPH.PS_TS]},publishNodeLineEvents:function(){for(var e,t,i=0;i<this.getNodeLinesLength();i++){switch(t=this.nodeLines[i],e=t.getStatus()){case LINE_STATUS.CREATE:this.propagateVia(this.getSection(),DOCVIEW.LINE_ADDED,t);break;case LINE_STATUS.UPDATE:this.propagateVia(this.getSection(),DOCVIEW.LINE_UPDATED,t);break;case LINE_STATUS.REMOVE:this.propagateVia(this.getSection(),DOCVIEW.LINE_BEFORE_REMOVE,t);break;case LINE_STATUS.STYLE_UPDATE:this.propagateVia(this.getSection(),DOCVIEW.LINE_STYLE_UPDATED,t);break;case LINE_STATUS.RECREATE:this.propagateVia(this.documentLayoutManager,DOCVIEW.LINE_RECREATED,t,!0)}var n=this.getSection();(n.isRemoveInProgress||n.isDirtyNode(this))&&e!==LINE_STATUS.REMOVE?this.forceReRender=!0:(this.forceReRender=!1,t.setStatus(LINE_STATUS.NONE))}},isStyleChanged:function(e,i){var n,r,o,a;for(n=0,r=e.segments.length;n<r;n++)if(o=e.segments[n],a=i.segments[n],o.left!==a.left||!t.compareJSON(o.computedFormat,a.computedFormat))return!0;return!1},hasFootNotes:function(){for(var e=0;e<this.nodeLines.length;e++)if(this.nodeLines[e].getFootNotesLength()>0)return!0;return!1},getNodeLinesLength:function(){return this.nodeLines.length},getStart:function(){return this.getNodeLinesLength()?this.getFirstNodeLine().start:-1},getEnd:function(){return this.getNodeLinesLength()?this.getLastNodeLine().end:-1},getNodesBetweenRange:function(t,i){for(var n=[],r=this.getNodeLinesLength(),o=0;o<r;o++){var a=this.nodeLines[o];if(e.isWithinRange(a.absStart,a.absEnd,t,i)&&n.push(a),a.absEnd>i)break}return r&&t===this.getLastNodeLine().absEnd&&n.push(this.getLastNodeLine()),n},refresh:function(){var e=this.cloneNodeLines();this.clearChildren(),this.updateHeight(),this.updateNodeLineStatus(e,!1),o(e),this.publishNodeLineEvents(),this.addToUpdateQueue(OP_TYPE.UPDATE)},isBalanced:function(){return this.isViewsBuilt()&&this.getAbsTop(VIEW.SECTION)+this.getHeight()<=this.getSection().getAllowedHeight()},isPendingToBuild:function(){return this.getSection().isInUpdateQueue(this)},isViewsBuilt:function(){if(this.isPendingToBuild()||this.getSection().isAnySplitViewsInUpdateQueue(this))return!1;var e=this.getLastSplitView();return!!e&&e.dtView.isEndIndex(e.getEnd())},getDirectionalLeft:function(){return this.getDTView().isRTLPara()?this.getRight()-this.getWidth():this.getLeft()},getDirectionalRight:function(){return this.getDTView().isRTLPara()?this.getDirectionalLeft()+this.getWidth():this.getRight()},getNodeLineWithId:function(e){for(var t,i=this.getNodeLines(),n=0;n<i.length;n++)if(t=i[n],t.getId()===e)return t;return null},hasInnerTable:function(){return!1},isPrevViewAllowed:function(){var e=this.getParaProperties();return!e.pageBreakBefore},hasWaterMark:function(){return this.getNode().hasWaterMark()},getWatermarkData:function(){return this.getNode().viewProperties.watermark}}),r}(DTUtils,ZWJSONUtils,ZWArrayUtils,DocUtils),MAX_RENDERING_HEIGHT=1e6,SectionDocView=function(e,t,i){"use strict";function n(e,n){this.type=e.type,this.sectionType=e.getSectionType(),this.dtView=e,this.group=n,this.documentLayoutManager=this.group.getLayoutManager(),this.id=t.randomId(this.sectionType),this.name="",this.updateName(),this.columns=new i,this.width=0,this.height=0,this.top=0,this.left=0,this.right=0,this.allowedHeight=0,this.maxHeightRendered=0,this.inProgressViewData=null,this.floatImages={},this.paginationStatus=!1,this.buildData=[],this.shouldNeedBuildData=!1,this.shouldMergeBeforePaginate=!1,this.shouldBalanceFromNextSection=!1,this.grayArea=0,this.isRemoveInProgress=!1,this.enableSectionMargins=!0,this.bindEvents()}e.call(n.prototype),extend(n.prototype,{create:function(){this.initLayout(),this.initColumns()},initLayout:function(){this.computeLeft(),this.computeRight(),this.computeWidth()},computeWidth:function(){var e=this.group.getLayoutProps(),t=e.pageDimensions.width;this.width=t-(this.getLeft()+this.getRight())},computeLeft:function(){var e=this.getMargin(),t=this.getPage();t&&t.isMirroredEvenPage()?this.left=e.right+this.getGutterRight():this.left=e.left+this.getGutterLeft()},computeRight:function(){var e=this.getMargin(),t=this.getPage();t&&t.isMirroredEvenPage()?this.right=e.left+this.getGutterLeft():this.right=e.right+this.getGutterRight()},updateName:function(){this.name=this.sectionType},createColumn:function(e){var t,i=this.getColumnCount(),n=0,r=0;e=e||0;for(var o=e;o>0;)o--,r+=this.getColumnWidth(o)+this.getColumnSpace(o);e<i&&(n=this.getColumnWidth(e),t=new ColumnDocView(this,n,r,e+1),this.columns.append(t),this.propagateVia(this.documentLayoutManager,DOCVIEW.COLUMN_ADDED,t))},getColumn:function(e){var t=this.columns.first;for(e=e?e:0;t&&e>0;)e--,t=t.next;return t},updateColumnNumber:function(e){for(;e;)e.setColumnNumber(),e=e.getNextView()},updateColumnsProperties:function(e){for(;e;)e.updateProperties(),e=e.getNextView()},getHeight:function(){return this.height},addToSectionView:function(e,t,i,n,r){r=r||{};var o=i.addToColumnView(e,t,n);return this.logger().log("Added to section view :: %c"+o.getId(),"color:"+COLOUR.GREEN),o.setUserOperation(r.isUserOperation),r.dontBuild||o.addToUpdateQueue(OP_TYPE.CREATE,!0,r),this.trigger(DOCVIEW.VIEW_BEFORE_CREATE,o),o},updateViewInSectionView:function(e,t){t=t||{},this.logger().log("Update in section view :: %c"+e.getId(),"color:"+COLOUR.GREEN),e.setUserOperation(t.isUserOperation),e.addToUpdateQueue(OP_TYPE.UPDATE,!0,t),this.trigger(DOCVIEW.VIEW_BEFORE_UPDATE,e)},updateListInSectionView:function(e,t){t=t||{},e.setUserOperation(t.isUserOperation),e.addToUpdateQueue(OP_TYPE.UPDATE_LIST,!0,t),this.trigger(DOCVIEW.UPDATE_LIST,e)},removeFromSectionView:function(e,t,i){i=i||{},this.logger().log("Remove from section view :: %c"+e.getId(),"color:"+COLOUR.GREEN),e.setUserOperation(i.isUserOperation),e.addToUpdateQueue(OP_TYPE.REMOVE,t,i),this.trigger(DOCVIEW.VIEW_BEFORE_REMOVE,e)},adjustTableBorder:function(e){},initColumns:function(){this.columnFormats=this.documentLayoutManager.initColumnLayout(this)},getColumnFormat:function(){return ZWJSONUtils.clone(this.columnFormats)},getColumnCount:function(){return this.columnFormats.count},isEqualColumnWidth:function(){return this.columnFormats.isEqualWidth},getColumnWidth:function(e){return this.columnFormats.width[e]||0},getColumnSpace:function(e){return this.columnFormats.space[e]||0},getColumnWidthArray:function(){return this.columnFormats.width},getColumnSpaceArray:function(){return this.columnFormats.space||[]},getColumnSeparatorFormat:function(){return this.columnFormats.separatorFormat},getMargin:function(){return this.getGroup().getMargin()},getGutter:function(){return this.getGroup().getGutter()},getGutterTop:function(){return this.getGroup().getGutterTop()},getGutterLeft:function(){return this.getGroup().getGutterLeft()},getGutterRight:function(){return this.getGroup().getGutterRight()},updateTop:function(){var e=this.top;return this.top=this.prev?this.prev.getTop()+this.prev.getHeight():0,e!==this.top&&this.propagateVia(this.documentLayoutManager,DOCVIEW.SECTION_TOP_UPDATED,this),this.top},setViewTop:function(){},getNode:function(){return this.dtView.getNode()},getDTView:function(){return this.dtView},isDirtyNode:function(e){return this.dtView.isDirtyNode(e.getDTView())},getOpTypeInUpdateQueue:function(e){return this.dtView.getOpTypeInUpdateQueue(e.getDTView())},getOpTypeInViewUpdateQueue:function(e){for(var t=this.getFirstColumn();t;){var i=t.updateQueue.getOpType(e);if(i)return i;t=t.next}return""},computeMaxHeight:function(){for(var e=0,t=this.getFirstColumn();t;)e<t.getHeight()&&(e=t.getHeight()),t=t.getNextView();return e},getMaxContentHeight:function(){for(var e=0,t=this.getFirstColumn();t;)e<t.getHeight()&&(e=t.getHeight()),t=t.getNextView();return e},updateHeight:function(){var e=this.computeMaxHeight();this.getHeight()!==e&&(this.height=e,this.trigger(DOCVIEW.SECTION_HEIGHT_UPDATED,this),this.isRemoveInProgress||this.propagateVia(this.documentLayoutManager,DOCVIEW.SECTION_HEIGHT_UPDATED,this))},getId:function(){return this.id},getGroup:function(){return this.group},isReplicableView:function(){return this.dtView.isReplicableView()},isInUpdateQueue:function(e){for(var t=this.getFirstColumn();t;){if(t.isInUpdateQueue(e))return!0;t=t.getNextView()}return!1},isAnySplitViewsInUpdateQueue:function(e){for(var t=this.getFirstColumn();t;){if(t.isAnySplitViewsInUpdateQueue(e))return!0;t=t.getNextView()}return!1},addToPaginationQueue:function(e){var t=0;e&&(t=e.getColumnIndex()),this.updatePaginationStatus(!1),this.getGroup().addPaginationInfo(this,t)},removeFromUpdateQueue:function(e){for(var t=this.getFirstColumn();t;){if(t.isInUpdateQueue(e))return t.removeFromUpdateQueue(e);t=t.getNextView()}return null},setAllowedHeight:function(e){this.allowedHeight=e},setMaxHeightRendered:function(e){this.maxHeightRendered=e},isOverFlowing:function(){return this.getHeight()>this.getRemainingHeightInParent()},getMaxRenderingHeight:function(){return MAX_RENDERING_HEIGHT},getRemainingHeightInParent:function(){return MAX_RENDERING_HEIGHT},getAllowedHeight:function(){return this.shouldSectionsBalanced()?this.allowedHeight:this.getHeight()},getMaxHeightRendered:function(){return this.maxHeightRendered},getSectionType:function(){return this.sectionType},getHFType:function(){return this.dtView.getHFType()},gatherBuildData:function(e){this.buildData.push(e)},resetBuildData:function(){return this.buildData.splice(0,this.buildData.length)},processBuildData:function(e,t){for(var i=!1,n=!0,r=0;r<e.length;r++)e[r].viewId===t&&e[r].opType===OP_TYPE.REMOVE&&(i=!0),e[r].shouldPaginateNext||(n=!1);return{isViewRemoved:i,shouldPaginateNext:n}},updateNeedBuildDataStatus:function(e){this.shouldNeedBuildData=e},needBuildData:function(){return this.shouldNeedBuildData},updateShouldMergeBeforePaginateStatus:function(e){this.shouldMergeBeforePaginate=e},isBalanced:function(){if(this.hasViewsPendingToBuild())return!1;for(var e=!0,t=this.getFirstColumn();t;){if(t.getHeight()>this.getAllowedHeight()){e=!1;break}t=t.next}var i=!0;t=this.getLastColumn();for(var n;t&&(n=t.prev);){if(t.getHeight()>n.getHeight()&&t.getHeight()>this.getRemainingHeightInParent()){i=!1;break}t=t.prev}return i&&(e||this.getPage()&&this.getTop()+this.getAllowedHeight()>this.getPage().getPaginationHeight())},updateBalancingStatus:function(){this.balancingProgress=this.shouldSectionsBalanced()},isBalancingInProgress:function(){return this.balancingProgress},buildChildViews:function(){do{this.updateBalancingStatus();for(var e=this.getFirstColumn();e;)if(e.buildChildViews()){var t=e.isEligibleForRemove();if(e.updateCanColumnRemoveStatus(!0),t)e.removeAllChildViews();else if(e.shouldStopBuildingForReBalancing())break;e=this.getFirstColumn()}else e=e.getNextView();if(this.isBalancingInProgress()){if(this.getMinRenderingHeight()>this.getMaxRenderingHeight())break;if(!this.isBalanced()){var i=this.getMaxHeightRendered();this.getGroup().preBalancingProcess(this),this.setAllowedHeight(i),this.setMaxHeightRendered(i)}}}while(this.hasViewsPendingToBuild());this.isBalancingInProgress()&&this.isBalanced()&&this.propagateVia(this.documentLayoutManager,DOCVIEW.SECTION_BALANCING_COMPLETE,this)},isFirstView:function(e){var t=this.getFirstColumn();return t.isFirstView(e)},isViewBuildInProgress:function(e){return this.inProgressViewData&&this.inProgressViewData.view.getId()===e.getId()},hasViewsPendingToBuild:function(){for(var e=this.getFirstColumn();e;){if(e.hasViewsPendingToBuild())return!0;e=e.getNextView()}return!1},updateViewBuildInProgress:function(e){this.inProgressViewData=e},preRemove:function(e){var t=e.getNextView();if(this.columns.remove(e),t)for(var i,n;t;)i=t.getWidth(),t.setColumnNumber(),t.updateProperties(),n=t.getWidth(),i!==n&&t.refresh(),t=t.getNextView()},removeAllChildViews:function(e,t,i){this.isRemoveInProgress=!0,this.cleanSection(e,t,i),(i||this.isEligibleForRemove())&&(this.group.removePaginationInfo(this),this.group.removeDocSectionView(this)),this.isRemoveInProgress=!1},bindEvents:function(){this.getDTView().on(DTVIEW.SECTION_BUILD_COMPLETE,this.handleSectionOpComplete,this)},unbindEvents:function(){this.getDTView().off(DTVIEW.SECTION_BUILD_COMPLETE,this.handleSectionOpComplete,this)},destroy:function(){this.unbindEvents(),this.isRemoveInProgress=!1,this.grayArea=0,this.shouldMergeBeforePaginate=!1,this.shouldNeedBuildData=!1,this.buildData=[],this.floatImages=null,this.group=null,this.inProgressViewData=null,this.maxHeightRendered=0,this.allowedHeight=0,this.right=0,this.left=0,this.top=0,this.height=0,this.width=0,this.columns=null,this.id="",this.documentLayoutManager=null,this.type="",this.dtView=null,this.name=""},getMinRenderingHeight:function(){for(var e=this.getFirstColumn();e&&e.isEligibleForRemove();)e=e.getNextView();var t=0;return e&&(t=e.getMinRenderingHeight()),t},hasLessColumns:function(){return this.columns.length<this.getColumnCount()},checkPaginationStatus:function(){return!this.hasViewsPendingToBuild()},resetBalancingForPagination:function(){this.getGroup().preBalancingProcess(this);var e=this.getLastColumn();if(e)for(var t=e.getLastChild();t;)t.removeNodeLines(),t.addToUpdateQueue(OP_TYPE.UPDATE,!0),t=t.prev},buildAllViewsInUpdateQueue:function(){for(var e=this.getFirstColumn();e;)e.hasViewsPendingToBuild()&&e.buildChildViews(),e=e.getNextView()},isPaginatableSection:function(){return!1},paginate:function(e){if(e=e||0,this.buildChildViews(),this.getGroup().canPaginateGroup()){for(var t,i=this.getColumn(e)||this.getFirstColumn();i;){if(i.isEligibleForRemove())t=i.getNextView(),i.removeAllChildViews();else{do i.buildChildViews(!0),i.paginate();while(i.hasViewsPendingToBuild());var n=this.getNextSplitView();if(!(i.getNextView()||n&&n.getFirstColumn())){i.updateCanColumnRemoveStatus(!0);break}t=this.isPrecededColumnsHasPageBreak(i)?i.getNextView():i.getNextColumnToPaginate();var r=i.isEligibleForRemove();i.updateCanColumnRemoveStatus(!0),r&&i.removeAllChildViews()}i=t,t=null}this.updatePaginationStatus(this.checkPaginationStatus()),this.isBalancingInProgress()&&this.isBalanced()&&this.propagateVia(this.documentLayoutManager,DOCVIEW.SECTION_BALANCING_COMPLETE,this),this.paginationStatus&&this.removeFromPaginationInfo()}else this.addToPaginationQueue(this.getColumn(e))},isPrecededColumnsHasPageBreak:function(e){e=e?e.prev:null;for(var t;e;){if(t=e.getLastChild(),t&&t.getType()===VIEW.HR&&t.isPageBreak())return!0;e=e.prev}return!1},mergeViews:function(e,t){var i=this.getLastColumn(),n=e.getFirstColumn();if(!i||!n)return null;for(var r,o,a=e.getFirstColumn();a;){for(r=i.getLastChild(),o=a.getFirstChild(),r&&o&&r.getNodeId()===o.getNodeId()&&r.merge(o,i,t),o=a.getFirstChild();o;)i.moveView(o,a),o=a.getFirstChild();a=a.next}},getPrevSection:function(){return this.prev},getNextSection:function(){return this.next},getFormats:function(){return this.dtView.getFormats()},getChildViewCount:function(){for(var e=0,t=this.columns.first;t;)e+=t.getChildViewCount(),t=t.next;return e},getChildViews:function(){return this.columns},getTop:function(){return this.top},getType:function(){return this.type},getNodeId:function(){return this.dtView.getId()},getPage:function(){return this.page},belongsToPage:function(e){return this.getPage()===e},getFirstColumn:function(){return this.columns.first},getLastColumn:function(){return this.columns.last},getFirstView:function(){return this.getFirstColumn().getFirstChild()},getLastView:function(){return this.getLastColumn().getLastChild()},getFirstParaView:function(){return this.getFirstColumn()?this.getFirstColumn().getFirstParaView():null},getLastParaView:function(){return this.getLastColumn()?this.getLastColumn().getLastParaView():null},getLeft:function(){return this.left},getRight:function(){return this.right},getWidth:function(){return this.width},getOuterWidth:function(){return this.getLeft()+this.getWidth()+this.getRight()},getOuterHeight:function(){return this.height},getNodesBetweenRange:function(e,t){for(var i=this.getFirstColumn(),n=[];i;)n=n.concat(i.getNodesBetweenRange(e,t)),i=i.getNextView();return n},getNextSplitView:function(){for(var e,t=this.group.getDocViews(this.dtView.getId()),i=0;i<t.length-1;i++)if(this.getId()===t[i].getId()){e=t[i+1];break}return e},getPreviousSplitView:function(){for(var e,t=this.group.getDocViews(this.dtView.getId()),i=1;i<t.length;i++)if(this.getId()===t[i].getId()){e=t[i-1];break}return e},isEmpty:function(){if(this.columns)for(var e=this.getFirstColumn();e;){if(!e.isEmpty())return!1;e=e.getNextView()}return!0},setPage:function(e){this.page=e},refresh:function(){var e=this.getGroup(),t=e.canPaginate,i=editor.doc.findNextIndexOf(UNICODE.TOCSTART,0)!=-1,n=!!editorProps.options&&(editorProps.options.isMailMerge&&!i),o=n&&isHeadlessPDF&&this.getSectionType()==SECTION_TYPES.CONTENT;e.updateCanPaginateStatus(o);var a=this.getDTView();r.call(this,a),e.updateCanPaginateStatus(t)},cleanSection:function(e,t,i){for(var n,r=this.getLastColumn();r;)n=r.getPrevView(),r.removeAllChildViews(e,t,i),r=n;SectionDocView.prototype.buildChildViews.call(this)},getParent:function(){return this.getPage()},isEligibleForRemove:function(){var e=this.isEmpty();if(e){var t=this.group.getDocViews(this.getNodeId());if(1===t.length){var i=this.group.isSectionInProgressMap(this.getDTView().getId()),n=this.getNode().isBuildInProgress();return!(i||n)}return!0}return e},createFloatImage:function(e,t){var i=e.subType||NODE_TYPE.IMAGE;i!==NODE_TYPE.WIDGET&&i!=NODE_TYPE.QRCODE&&i!=NODE_TYPE.BARCODE&&i!=NODE_TYPE.CHART&&i!=SIGNERFIELD_TYPE.SIGNATURE&&i!=SIGNERFIELD_TYPE.INITIAL||(i=NODE_TYPE.IMAGE);var n=new FloatImage[i](e,t);return this.updateFloatImagesJSON(n,OP_TYPE.CREATE),n},updateFloatImage:function(e,t){e.moveFloatImageToDocView(t),t.getSection()!==this&&(this.updateFloatImagesJSON(e,OP_TYPE.REMOVE),t.getSection().updateFloatImagesJSON(e,OP_TYPE.CREATE))},removeFloatImage:function(e){e.moveFloatImageToDocView(null),this.updateFloatImagesJSON(e,OP_TYPE.REMOVE),e.destroy()},moveFloatImage:function(e,t){this.updateFloatImagesJSON(e,OP_TYPE.REMOVE),t.updateFloatImagesJSON(e,OP_TYPE.CREATE)},removeAllFloatImagesInView:function(e){for(var t=e.getFloatImages(),i=0;i<t.length;i++)this.removeFloatImage(t[i])},getFloatImageById:function(e){return this.floatImages[e]},getFloatImages:function(e){var t=[];for(var i in this.floatImages)t.push(this.floatImages[i]);return e||t.sort(function(e,t){return e.getAbsLeft(VIEW.PAGE)-t.getAbsLeft(VIEW.PAGE)}),t},updateFloatImagesJSON:function(e,t){switch(t){case OP_TYPE.CREATE:case OP_TYPE.UPDATE:this.floatImages[e.getId()]=e;break;case OP_TYPE.REMOVE:delete this.floatImages[e.getId()]}},processFloatImages:function(e){if(this.getSectionType()!=SECTION_TYPES.TEXTBOX){var t=this.processFloatImageAffectedViewsBelow(e.getNextView());t||this.trigger(DOCVIEW.FLOAT_IMAGES_UPDATED,this)}},isInFloatImageArea:function(e,t){for(var i,n=e.getPageFloatImages(),r=0;r<n.length;r++)if(i=n[r],i&&i.getView()&&!i.isNonWrappingImage()&&DocUtils.isInFloatImageArea(i,e,t))return!0;return!1},processFloatImageAffectedViewsBelow:function(e){for(;e;){if(!this.isFloatImageBelowThisViewInPage(e))return!0;if(e.getType()===VIEW.PARA){if(this.isInFloatImageArea(e)){var t=e.getPage()===this.getPage();e.addToUpdateQueue(OP_TYPE.UPDATE,t)}}else if(e.getChildViewsLength()){var i=this.processFloatImageAffectedViewsBelow(e.getFirstChild());if(i)return!0}e=e.getNextView()}return!1},isFloatImageBelowThisViewInPage:function(e){for(var t,i=e.getPageFloatImages(),n=!1,r=0;r<i.length;r++)if(t=i[r],t&&t.getView()&&t.getAbsTop()+t.getHeight()>=e.getAbsTop()&&t.getAbsLeft()+t.getWidth()>=e.getAbsLeft()){n=!0;break}return n},getAbsTop:function(e){if(this.getType()===e)return 0;var t=0,i=this.getParent();return i&&(e&&e!==VIEW.PAGE?i.getType()!==e&&(t+=i.getAbsTop(e)):t+=this.getPageTop()),t},getAbsLeft:function(e){if(this.getType()===e)return 0;var t=this.getLeft(),i=this.getParent();return i&&(e&&e!==VIEW.PAGE?i.getType()!==e&&(t+=i.getAbsLeft(e)):t+=this.getPageLeft()),t},getDOMViewHeight:function(){return this.getHeight()},getDOMViewWidth:function(){return this.getWidth()},updatePaginationStatus:function(e){this.paginationStatus=e},isPaginationCompleted:function(){return this.paginationStatus},removeFromPaginationInfo:function(){this.getGroup().removePaginationInfo(this)},getAllViewsOfGivenType:function(e){var t=[];return this.getChildViewsArray(!0).forEach(function(i){i.getType()==e&&t.push(i)}),t},logger:function(){return this.group.logger()},shouldSectionsBalanced:function(){return this.shouldResetSectionBalancing()&&!this.getNode().hasNodesToBuild()&&!this.hasColumnBreakOrPageBreakBefore()},shouldResetSectionBalancing:function(){return!!(this.getColumnCount()>1&&(!this.isLastSectionInGroup()||this.getGroup().isLastGroup()&&(this.documentLayoutManager.hasEndNotes()||this.getDTView().getNoteCount(SECTION_TYPES.ENDNOTE)>0))&&this.isLastSplitView())},isFirstSectionInPage:function(){var e=this.getPage()&&this.getPage().getFirstPaginatableSection();return this===e},isLastSectionInGroup:function(){var e=this.getGroup().getLastSection();return!(!e||e.getDTView()!==this.getDTView())},isLastSplitView:function(){var e=this.getGroup().getDocViews(this.getDTView().getId()),t=e.length;return t>0&&e[t-1]==this},hasContent:function(){return this.getNode().hasContent()},hasColumnBreakOrPageBreakBefore:function(){for(var e=!1,t=this.getFirstColumn();t;){if(t.hasColumnBreakOrPageBreakBefore()){e=!0;break}t=t.next}return e},getPaginationTop:function(){return 0},getPageTop:function(){return 0},getPageLeft:function(){return 0},getDefaultTabPointWidth:function(e){if(!e&&(e=this.getNode().getDefaultTabWidth(),e<=0))return[];for(var t=[],i=this.getLeft(),n=this.getWidth();i+e<n;)i+=e,t.push({value:i,align:"0",style:"0"});return t},arrangeTabPoints:function(e){for(var t=e.length,i=0;i<t;i++)for(var n=t-1;n>i;n--)if(e[n-1].value>e[n].value){var r=e[n-1];e[n-1]=e[n],e[n]=r}},getContentTop:function(){return 0},getContentLeft:function(){return 0},getContentHeight:function(){for(var e=this.getFirstColumn(),t=0;e;)e.getHeight()>t&&(t=e.getHeight()),e=e.next;return t},getChildViewsArray:function(e){for(var t=this.getFirstColumn(),i=[];t;)i=i.concat(t.getChildViewsArray(e)),t=t.next;return i},getRawFormatAt:function(e){return this.dtView.getRawFormatAt(e)},getRootSectionType:function(){return""},handleSectionOpComplete:function(){},getDocTree:function(){return this.group.getDocTree()},shouldSkipPagination:function(){var e=this.getNode();return e.hasNodesToBuild()&&!this.getDocTree().isInProgressDTSection(e)}});var r=function(e){for(var t=e.getFirstChild(),i=this.group;t;)i.onViewAddedToDTSectionView(t),t.getChildViews()&&r.call(this,t),t=t.getNextView()};return n}(BaseEventHandler,Utils,LinkedList),ContentDocView=function(){"use strict";function e(e,t,i){SectionDocView.apply(this,arguments),this.page=i,this.create()}return e.prototype=Object.create(SectionDocView.prototype),e.prototype.constructor=e,extend(e.prototype,{destroy:function(){this.page=null,SectionDocView.prototype.destroy.apply(this,arguments)},getLayoutProps:function(){return this.dtView.getLayoutProps()},getMargin:function(){return this.enableSectionMargins?this.getLayoutProps().margin:this.group.getMargin()},getGutter:function(){return this.enableSectionMargins?this.getLayoutProps().gutter:this.group.getGutter()},getGutterTop:function(){var e=this.getGutter();return e.position===GUTTER_POSITION.TOP?e.value:0},getGutterLeft:function(){var e=this.getGutter();return e.position===GUTTER_POSITION.LEFT?e.value:0},getGutterRight:function(){var e=this.getGutter();return e.position===GUTTER_POSITION.RIGHT?e.value:0},getBreakType:function(){return this.isContinuousSection()?BREAK_TYPES.CONTINUOUS:this.dtView.getBreakType()},isContinuousSection:function(){return!(!this.documentLayoutManager.isContinuousLayout()&&!this.dtView.isContinuousSection())},findColumn:function(e){var t,i,n,r=e.prev,o=e.parent;if(r)if(i=this.documentLayoutManager.getViews(r),e.type===NODE_TYPE.CELL)t=i[0].column;else if(node.type===NODE_TYPE.ROW)for(var a=i.length-1;a>=0;a--){var s=i[a];if(s.containsSplittedFc||s.containsSplittedVmp){s=i[0];break}break}else t=ZWArrayUtils.lastElementOf(i).column;else o&&(n=this.documentLayoutManager.getViews(o),t="section"===o.type?n.columns.last:ZWArrayUtils.lastElementOf(n).column);return t},getMaxRenderingHeight:function(){var e=this.getRemainingHeightInParent(),t=this.getAllowedHeight();return!this.shouldSectionsBalanced()||t>e?e:t},getRemainingHeightInParent:function(){return this.getPage().getPaginationHeight()-this.getTop()-this.getFootNoteHeightFactor()},getDOMViewHeight:function(){var e=this.getPage();return e&&e.getLastSection(SECTION_TYPES.CONTENT)===this&&!e.hasEndNotes()?e.getContentContainerHeight()-this.getTop()-this.getFootNoteHeightFactor():this.getHeight()},getFootNoteHeight:function(){for(var e=0,t=this.columns.first;t;)e+=t.getFootNoteHeight(),t=t.next;return e},getFootNoteHeightFactor:function(){for(var e=0,t=this.prev;t;)e+=t.getFootNoteHeight(),t=t.prev;return e},isPaginatableSection:function(){return!0},buildChildViews:function(){if(this.shouldResetSectionBalancing()){for(var e,t=this.getNextSplitView();t;){e=t.getNextSplitView(),t.getGroup().preBalancingProcess(t),this.mergeViews(t);var i;t.isEligibleForRemove()&&(i=t.getPage(),t.removeAllChildViews(!0,!0)),i&&i.isEmpty()&&i.getGroup().removePage(i),t=e}this.resetBalancingForPagination(),this.setAllowedHeight(0),this.setMaxHeightRendered(0)}SectionDocView.prototype.buildChildViews.call(this)},updateHeight:function(){SectionDocView.prototype.updateHeight.call(this),this.getHeight()>this.getMaxHeightRendered()&&this.setMaxHeightRendered(this.getHeight())},getPaginationTop:function(){return this.getTop()},getPageTop:function(){var e=this.getTop(),t=this.getPage();return t&&(e+=t.getContentTop()),e},isOverFlowing:function(){return this.getHeight()+this.getPage().getNoteHeight(SECTION_TYPES.FOOTNOTE)>this.getRemainingHeightInParent()}}),e}(),ColumnDocView=function(e){"use strict";function t(t,i,n,r){this.id=e.randomId(VIEW.COLUMN),this.top=0,this.height=0,this.left=n,this.width=i,this.parent=t,this.columnNumber=r,this.childViews=new LinkedList,this.paginationStatus=!1,this.type=VIEW.COLUMN,this.updateQueue=new DocViewUpdateQueue,this.canRemoveThisColumn=!0}return BaseEventHandler.call(t.prototype),extend(t.prototype,{addToColumnView:function(e,t,i){var n=new DocViews[e.type](e,t,this,i);if(e.prev){for(var r,o=this.getDocViews(e.prev.id),a=0;a<o.length;a++)if(this.id===o[a].column.id){r=o[a];break}r?i.childViews.insertAfter(n,r):i.childViews.insertAsFirst(n)}else i.childViews.insertAsFirst(n);return n},getMinRenderingHeight:function(){var e=this.getFirstChild(),t=0;return e&&(t=e.getMinRenderingHeight()),t},isInUpdateQueue:function(e){return this.updateQueue.isInUpdateQueue(e)},isAnySplitViewsInUpdateQueue:function(e){return this.updateQueue.isAnySplitViewsInUpdateQueue(e)},hasViewsPendingToBuild:function(){return this.updateQueue.isViewsPendingToBuild()},addToUpdateQueue:function(e,t,i,n){this.updateQueue.add(e,t,n),i||this.getSection().addToPaginationQueue(e.getColumn())},removeFromUpdateQueue:function(e){var t=null;return this.isInUpdateQueue(e)?t=this.updateQueue.remove(e):this.logger().warn("Not in column update queue but came for remove "+e.getId()),t},shiftColumnRelatedInfo:function(e){var t=e.getColumn();if(this.getId()!==t.getId()&&this.updateQueue.isInUpdateQueue(e)){var i=this.updateQueue.remove(e);i&&i[0].view.addToUpdateQueue(i[0].opType,!0)}},isNumericallyLastColumn:function(){return this.getColumnNumber()===this.getSection().getColumnCount()},shouldStopBuildingForReBalancing:function(){var e=this.getSection();return e.isBalancingInProgress()&&this.isNumericallyLastColumn()&&this.isOverFlowingDuringBalancing()},checkIsViewEmptyAndRemove:function(e){for(var t,i,n=e,r=n.getType();n&&r!==VIEW.COLUMN;){if(n.isEligibleForRemove())if(r===VIEW.CELL){var o=n.getParent();i=n.getViews(),i.length>1?(t=o.getParent(),o.removeAllChildViews(!0,!0)):(t=n.getParent(),n.removeAllChildViews(!0,!0))}else t=n.getParent(),n.removeAllChildViews(!0,!0);else t=n.getParent();n=t,r=n.getType()}},buildChildViews:function(e){if(!this.hasViewsPendingToBuild())return!1;var t=this.updateQueue.getNextView();for(this.getSection().updateViewBuildInProgress(t);t;){var i=this.buildChildView(t,!1,!1),n=this.shouldStopBuildingForReBalancing();if(i&&!e&&(this.getGroup().canPaginateGroup()?this.paginate():this.getSection().addToPaginationQueue(this)),!this.hasViewsPendingToBuild()||n)break;t=this.updateQueue.getNextView(),this.getSection().updateViewBuildInProgress(t)}return!0},buildChildView:function(e,t,i){var n=e.opType,r=e.view,o=e.options,a=r.getNodeId();this.getGroup().updateViewBuildInProgress(a,!0);var s=!1;switch(n){case OP_TYPE.CREATE:case OP_TYPE.MODIFY:s=r.createDocView(o);break;case OP_TYPE.UPDATE:s=r.updateDocView(o);break;case OP_TYPE.REMOVE:s=r.remove(t,i,o),r=null;break;case OP_TYPE.UPDATE_LIST:o=o||{};var l=r.getDTView(),d=l.isListWidthChanged();if(l.isList()?l.addListData(r):l.removeListData(),d)o.forceReRender=!0,s=r.updateDocView(o);else{for(var c,u=r.getDocViews(),g=0;g<u.length;g++)c=u[g],c.publishNodeLineEvents();this.getSection().trigger(DOCVIEW.LIST_NUMBER_CHANGED,r),s=!1}}return n!==OP_TYPE.REMOVE&&(r.setUserOperation(!1),this.getSection().trigger(DOCVIEW["VIEW_AFTER_"+n.toUpperCase()],r),this.getSection().processFloatImages(r),this.checkIsViewEmptyAndRemove(r)),this.getGroup().updateViewBuildInProgress(a,!1),s},getDocViews:function(e){return this.parent.getGroup().getDocViews(e)},getHeight:function(){return this.height},getId:function(){return this.id},hasVerticallyPrevView:function(e){for(e.getType()===VIEW.CELL&&(e=e.getParent());e&&!(e.getType()===VIEW.COLUMN||e.getType()===VIEW.ROW&&e.isExcessDom);){if(e.prev)return!0;e=e.getParent(),e&&e.getType()===VIEW.CELL&&(e=e.getParent())}return!1},hasColumnBreakOrPageBreakBefore:function(){for(var e=this.getFirstChild(),t=!1;e;){if(e.getType()===VIEW.HR&&e.isColumnBreak()){t=!0;break}if(e.getType()===VIEW.PARA&&e.getDTView().hasPageBreakBefore()){t=!0;break}e=e.getNextView()}return t},hasPageBreak:function(){for(var e=this.getFirstChild(),t=!1;e;){if(e.getType()===VIEW.HR&&e.isPageBreak()){t=!0;break}e=e.getNextView()}return t},getColumnNumber:function(){return this.columnNumber},getColumnIndex:function(){return this.columnNumber-1},getPage:function(){return this.getSection().getPage()},updateHeight:function(){var e,t=0;for(e=this.getFirstChild();e;)t+=e.getHeight(),e=e.getNextView();var i=this.getHeight();this.height=t,i!==t&&(DocUtils.updateAllViewsTop(this),this.parent.updateHeight())},setWidth:function(){this.width=this.parent.getColumnWidth(this.columnNumber-1)},updateProperties:function(){this.setColumnLeft(),this.setWidth(),this.updateHeight(),this.propagateVia(this.getSection().documentLayoutManager,DOCVIEW.COLUMN_UPDATED,this)},getPrevView:function(){return this.prev},getNextView:function(){return this.next},getNextColumnToPaginate:function(){var e=this.getNextView();return!e&&this.getSection().hasLessColumns()&&(this.getSection().createColumn(this.getColumnNumber()),e=this.getNextView()),e},getFirstChild:function(){return this.childViews?this.childViews.first:null},getLastChild:function(){return this.childViews?this.childViews.last:null},getFirstParaView:function(){for(var e=this.getFirstChild();e;){if(e.getType()===VIEW.PARA)return e;if(e.getChildViewsLength())return e.getFirstParaView();e=e.getNextView()}return null},getLastParaView:function(){for(var e=this.getLastChild();e;){if(e.getType()===VIEW.PARA)return e;if(e.getChildViewsLength())return e.getLastParaView();e=e.getPrevView()}return null},getChildViewsLength:function(){return this.childViews.length||0},getFootNoteHeight:function(){for(var e=0,t=this.getFirstChild();t;)e+=t.getFootNoteHeight(),t=t.next;return e},destroy:function(){this.canRemoveThisColumn=!0,this.updateQueue=null,this.paginationStatus=!1,this.type="",this.childViews=null,this.columnNumber=0,this.parent=null,this.width=0,this.left=0,this.height=0,this.top=0,this.id=""},setColumnNumber:function(){for(var e=0,t=this;t.prev;)e++,t=t.prev;this.columnNumber=e+1},setColumnLeft:function(){var e=this.prev;if(e){var t=e.columnNumber-1,i=e.parent.getColumnWidth(t),n=e.parent.getColumnSpace(t);this.left=e.left+i+n}else this.left=0},addViewTo:function(e,t,i){if(this.logger().log("Add view to column :: %c"+e.getId(),"color:"+COLOUR.GREEN),e.getColumn().getId()===this.getId())return this.logger().warn("Add view to column :: View moving inside same column"),null;var n={};if(e.getType()===VIEW.PARA&&e.getNodeLinesLength())for(var r,o,a=[SECTION_TYPES.FOOTNOTE,SECTION_TYPES.TEXTBOX],s=0;s<a.length;s++){o=a[s],n[o]=[];for(var l=0;l<e.nodeLines.length;l++){r=e.nodeLines[l];for(var d=r.getMetaSectionByType(o),c=0;c<d.length;c++){var u=d[c].id,g=e.documentLayoutManager.getSectionViews(u)[0];g&&g.getDTView().belongsToPara(e.getNodeId())&&(o===SECTION_TYPES.ENDNOTE||g.getPage()===e.getPage())&&(n[o].push(g),e.getPage().removeSectionView(g))}}}var h=e.getFloatImages();e.getParent().detachView(e);var f,p=e.getDTView(),E=p.getPrevView(),T=p.getParent();if(T.getType()===VIEW.SECTION){var O=this.getDocViews(p.getId()),m=e.findDocViewInColumn(this);m?f=m.getPrevView():E?(O=e.findPreviousSiblingWithDocViews(),f=O[0].findDocViewInColumn(this)):f=null,i=this}else{var I=this.getDocViews(T.getId());i=I.length?I[0].findDocViewInColumn(this):e.getParent();var D,R=i.getChildViews();if(E)if(D=this.getDocViews(E.getId()),e.getType()===VIEW.CELL)null!=R.last&&R.last.getNodeId()===E.getId()?f=R.last:D&&(f=D[0].findDocViewInColumn(this));else if(D=e.findPreviousSiblingWithDocViews()){for(var l=0;l<D.length;l++)if(D[l].parent&&D[l].parent.getId()===i.getId()){f=D[l];break}}else f=null;else f=null}var S=e.getSection();if(e.updateColumn(this),e.updateSection(this.getSection()),e.getType()===VIEW.PARA)for(var l=0;l<e.getNodeLinesLength();l++)e.nodeLines[l].moveLineTo(e);for(var C,l=0;l<h.length;l++)C=h[l],C.moveFloatImageToDocView(e),S.moveFloatImage(C,this.getSection());i.attachView(e,f),DocUtils.updateAllViewsTop(e),this.updateHeight();for(var o in n){d=n[o];for(var l=0;l<d.length;l++)e.getPage().addSectionView(d[l])}return this.logger().group("Add view to column ::"),this.logger().table({docView:{id:e.getId(),type:e.getType()},column:{id:e.getColumn().getId(),columnNumber:e.getColumn().getColumnNumber()},section:{id:e.getSection().getId(),type:e.getSection().getSectionType()},parent:{id:e.getParent().getId(),type:e.getParent().getType()}}),this.logger().groupEnd(),i},addView:function(e){return this.addViewTo(e,this.childViews,this)},moveChildViews:function(e,t){var i,n=e.getChildViewsArray();for(i=0;i<n.length;i++)this.moveView(n[i],t)},moveView:function(e,t){this.logger().log("Move view across column :: %c"+e.getId(),"color:"+COLOUR.GREEN),this.logger().log("From column %c "+t.getId()+", to "+this.getId(),"color:"+COLOUR.GREEN);var i=e.getPrevView(),n=!!i&&(i.getType()===VIEW.HR&&i.isBreaks()),r=e.isInFloatImageArea(),o=e.getColumn(),a=e.getNextView();if(this.addView(e),DocUtils.updateAllViewsTop(a),o.shiftColumnRelatedInfo(e),e.getType()===VIEW.PARA&&!this.getSection().isAnySplitViewsInUpdateQueue(e)){var s=e.getDTView(),l=ZWArrayUtils.lastElementOf(e.getViews());l&&!s.isEndIndex(l.getEnd())&&l.addToUpdateQueue(OP_TYPE.UPDATE)}e=e.checkMerge(),e.getType()===VIEW.PARA&&e.updateMetaReferenceInPara();var d=e.isInFloatImageArea();(r||d||this.getWidth()!==t.getWidth()||n)&&(e.removeNodeLines(),e.addToUpdateQueue(OP_TYPE.UPDATE,!0)),e.updateLayoutAndDesign(!0);var i=e.getPrevView(),a=e.getNextView();if(e.getType()===VIEW.ROW&&(e.refreshBorderValues(),i&&i.refreshBorderValues(),a&&a.refreshBorderValues()),this.moveChildViews(e,t),e.getType()===VIEW.ROW&&e.hasVmpCells()&&e.updateAllVmpCellsHeightInRow(),e.getType()===VIEW.CELL&&e.getMergeType()===CELL_MERGE_TYPE.VMP){var c=e.getFCRowAndCellView();c&&c.fcCell.updateRowSpan(c.fcCell.calculateViewRspan())}return e},detachView:function(e){this.propagateVia(this.getSection(),DOCVIEW.VIEW_DETACHED,e),this.childViews.remove(e),this.updateHeight(),e.updateParent(null)},attachView:function(e,t){e.updateParent(this),t?this.childViews.insertAfter(e,t):this.childViews.insertAsFirst(e),this.updateHeight(),this.propagateVia(this.getSection(),DOCVIEW.VIEW_ATTACHED,e)},removeView:function(){this.remove()},removeAllChildViews:function(e,t,i){if(this.getChildViewsLength())for(var n,r=this.getLastChild();r;)n=r.getPrevView(),r.removeAllChildViews(e,t,i),r=n;(i||this.isEligibleForRemove())&&this.removeView()},preRemove:function(e){this.childViews.remove(e)},remove:function(){this.propagateVia(this.getSection().documentLayoutManager,DOCVIEW.COLUMN_REMOVED,this),this.getParent().preRemove(this),this.destroy()},mergeViews:function(e,t){this.logger().log("Column merge views :: %c"+this.getId(),"color:"+COLOUR.GREEN);var i=this.getLastChild();i.getId()!==e.getId()&&i.getNodeId()===e.getNodeId()?i.merge(e,this,t):this.logger().warn("Column merge views Ends :: With no merge")},getParent:function(){return this.parent},getPreviousSplitView:function(){var e=this.getPrevView();if(e)return e;var t=this.getSection().getPreviousSplitView();return t&&(e=t.getLastColumn()),e},getNextSplitView:function(){var e=this.getNextColumnToPaginate();if(e)return e;var t=this.getSection().getNextSplitView();return t&&(e=t.getFirstColumn(),!e&&t.hasLessColumns()&&(t.createColumn(),e=t.getFirstColumn())),e},isOverFlowing:function(){return this.getHeight()+this.getPage().getNoteHeight(SECTION_TYPES.FOOTNOTE)>this.getSection().getRemainingHeightInParent()},splitColumn:function(e,t){var i,n=this.getNextSplitView(),r=this.getParent(),o=this.getPage(),a=e.prev;if(a&&a.getType()===VIEW.HR&&(!n&&a.isColumnBreak()||a.isPageBreak())){o.getNextPage()||r.group.splitPage(o,r);for(var s=this;s&&(n=s.getNextSplitView(),n&&a.isPageBreak()&&n.getPage()===o);)s=n;!n&&o.getNextPage()&&(o.getNextPage().split(this.getSection()),n=s.getNextSplitView())}if(!n){var l=e.getNextView();if(!(this.isOverFlowing()||l&&l.getType()===VIEW.PARA&&l.getDTView().hasPageBreakBefore()))return;var d=o.getNextPage();d?d.split(r):r.group.splitPage(o,r),n=this.getNextSplitView()}var c,u;e.getType()===VIEW.PARA&&(c=e.getParaObjForSplit(t,n,this,{considerFootNotes:!0,hasPrevView:!!e.getPrevView()}),e=c.view,t=c.splitHeight,u=c.splitIndex);var g=this.getLastChild(),h=n.getFirstChild();(g.getId()!==e.getId()||this.getPage().hasOutGoingFootnotes())&&h&&g.getNodeId()===h.getNodeId()&&(this.mergeViews(h),n=this.getNextSplitView());var l,f=e;if(a&&a.getType()===VIEW.HR&&a.isBreaks())for(i=e.getColumn();i;){for(;f;)l=f.getNextView(),n.moveView(f,i),f=l;if(a.isColumnBreak())break;i=i.getNextView(),i&&(f=i.getFirstChild())}else{var p=e.split(t,n,this,{considerFootNotes:!0},u);for(p&&p.isEligibleForRemove()&&p.removeAllChildViews(!0,!0),l=e.getNextView();l;)n.moveView(l,l.getColumn()),l=e.getNextView()}e.getDTView()&&e.isEligibleForRemove()&&e.removeAllChildViews(!0,!0)},isOverFlowingDuringBalancing:function(){return this.getHeight()>this.getSection().getMaxRenderingHeight()},getSplitInfo:function(){for(var e,t,i,n=0,r=0,o=!1,a=!1,s=this.getFirstChild(),l=this.getSection(),d=l.getMaxRenderingHeight(),c=l.documentLayoutManager,u=c.isPageView()||c.isFixedView();s&&(t=s.getDTView(),e=s.getType()===VIEW.PARA&&(t.hasPageBreakBefore()&&u),!this.isInUpdateQueue(s));){if(r=s.getHeight(!0),n+r>=d||a||e){if(!e){o=!0;break}if(s.getPrevView()){o=!0,s=s.getPrevView(),n=0;break}if(n+r>d){o=!0;break}}n+=r,i=s,s=s.getNextView(),u&&i.getType()===VIEW.HR&&i.isBreaks()&&(a=!0)}var g=l.getNextSplitView();return o&&l.shouldMergeBeforePaginate&&g&&g.shouldMergeBeforePaginate?o=!1:o&&l.shouldMergeBeforePaginate&&l.updateShouldMergeBeforePaginateStatus(!1),{shouldSplitView:o,view:s,prevView:i,height:n}},fillColumn:function(){this.logger().log("Column filling starts :: %c"+this.getId(),"color:"+COLOUR.GREEN);var e,t,i=this.getSection(),n=i.getNextSplitView(),r=i.getMaxRenderingHeight(),o=this.getHeight(),a=r-o,s=!1,l=!1;if(e=this.getNextView(),!e&&n&&(e=n.getFirstColumn()),e)for(var d,c;e&&e.isEligibleForRemove();)t=e.getNextView(),!t&&e.getSection().getNextSplitView()&&(t=e.getSection().getNextSplitView().getFirstColumn()),d=e.getSection(),e.removeAllChildViews(),d&&!d.getFirstColumn()&&d.isEligibleForRemove()&&(c=d.getPage(),d.removeAllChildViews(),d=null),c&&c.isEmpty()&&(c.getGroup().removePage(c),c=null),e=t;else{var u;n&&n.isEligibleForRemove()&&(u=n.getPage(),n.removeAllChildViews()),u&&u.isEmpty()&&u.getGroup().removePage(u)}if(e&&e.getChildViewsLength()){var g=e.getFirstChild(),h=g.getHeight(),f=this.getLastChild();if(g&&f&&g.getNodeId()===f.getNodeId()){if(a-=h,s=!0,this.getSection().shouldMergeBeforePaginate&&g.getType()===VIEW.TABLE?(g.mergeAllViewsOnImproperPagination(),g.getSection().updateShouldMergeBeforePaginateStatus(!1),g.getSection().getNextSplitView()&&g.getSection().getNextSplitView().shouldMergeBeforePaginate||this.getSection().updateShouldMergeBeforePaginateStatus(!1),this.mergeViews(g)):this.mergeViews(g,r-o),this.isEligibleForRemove())return{paginateAgain:!1,paginationStatus:!0};e=this.getNextView(),!e&&this.getSection().getNextSplitView()&&(e=this.getSection().getNextSplitView().getFirstColumn());var p=null;e&&(p=e.getFirstChild()),g.getType()!==VIEW.TABLE&&g.getType()!==VIEW.TOC||g.isEmpty()||(p=null),g=p,h=g&&g.getHeight(!0)||0,l=!0}var E=this.getLastChild(),T=!E||E.isNextViewAllowed();if((!s||a>0)&&T)for(;g;){if(!g.isPrevViewAllowed())return{paginateAgain:!1,paginationStatus:!0};g=this.moveView(g,e),h=g.getHeight(),l=!0;var O=g.getSection().isInUpdateQueue(g);if(h>=a||O||g.hasFootNotes()){l=!O&&l;break}a-=h,g=e.getFirstChild()}}t=this.getNextView(),!t&&this.getSection().getNextSplitView()&&(t=this.getSection().getNextSplitView().getFirstColumn());var m;t&&t.isEligibleForRemove()&&(m=t.getSection(),t.removeAllChildViews());var I;return m&&m.isEligibleForRemove()&&(I=m.getPage(),m.removeAllChildViews()),I&&I.isEmpty()&&I.getGroup().removePage(I),{paginateAgain:l,paginationStatus:!1}},updateCanColumnRemoveStatus:function(e){this.canRemoveThisColumn=e},canFillColumn:function(e){var t=this.getLastChild();if(t&&t.getType()===VIEW.TABLE){var i=this.getSection(),n=i.getNextSplitView(),r=this.getNextView()||n&&n.getFirstColumn(),o=r&&r.getMinRenderingHeight()||0,a=r.getFirstChild();if(a&&e<o&&a.isSplitViewOf(t)){var s=t.getLastChild(),l=a.getFirstChild();if(s&&l){var d=l.hasInnerTable();if(d||l.isSplitViewOf(s)||(d=s.hasInnerTable()),!(d||l.hasMergedCells()||s.hasMergedCells()||l.isAnyChildViewsInFloatImageArea(!0)||s.isAnyChildViewsInFloatImageArea(!0)))return!1}}}return!0},paginate:function(){var e=this.getSection();if(e.getSectionType()!==SECTION_TYPES.CONTENT)return!0;this.logger().log("Column Pagination Begins :: %c"+this.getId(),"color:"+COLOUR.GREEN),this.logger().info("columnNo :: %c"+this.getColumnNumber(),"color:"+COLOUR.GREEN),this.logger().info("sectionId :: %c"+e.getId(),"color:"+COLOUR.GREEN);var t,i=e.getMaxRenderingHeight(),n=this.getSplitInfo(),r=n.height,o=n.view,a=n.prevView,s=e.isPrecededColumnsHasPageBreak(this),l=n.shouldSplitView;t=i-r;var d=e.getNextSplitView();if(l)return this.getMinRenderingHeight()>e.getMaxRenderingHeight()&&this.updateCanColumnRemoveStatus(!1),this.splitColumn(o,t),!0;if(!o&&a&&a.getType()===VIEW.HR&&a.isBreaks()||s)return!0;if(this.getNextView()||d&&d.getFirstColumn()){if(!this.canFillColumn(t))return!0;var c=this.fillColumn();if(c.paginationStatus)return this.logger().log("Column Pagination Ends :: After filling column"),!1;if(c.paginateAgain&&(this.logger().log("Column Pagination Ends :: Going for paginate again"),!this.hasViewsPendingToBuild()))return this.paginate()}else d&&this.logger().log("Column Pagination Ends :: Need to remove next empty section");return!0},isEligibleForRemove:function(){return!this.hasViewsPendingToBuild()&&this.isEmpty()&&this.canRemoveThisColumn},getWidth:function(){return this.width},getSpacing:function(){return 0===this.getColumnIndex()?0:this.getSection().getColumnSpace(this.getColumnIndex()-1)},getChildViewsArray:function(e){for(var t=[],i=this.getFirstChild();i;)e&&(t=t.concat(i.getChildViewsArray(e))),t.push(i),i=i.getNextView();return t},getChildViewCount:function(){return this.childViews.length},checkMerge:function(e){var t=e.next,i=e.prev;return t&&e.getNodeId()===t.getNodeId()?t:i&&i.getNodeId()===e.getNodeId()?i:null},merge:function(e,t,i){this.logger().log("views came for merge :: "),this.logger().info("view1 :: %c"+e.getId(),"color:"+COLOUR.GREEN),this.logger().info("view2 :: %c"+t.getId(),"color:"+COLOUR.GREEN);var n;n=e.merge(t,this,i),n===t&&(t=e,e=n);var r;if(t.getSection().isInUpdateQueue(t)){r=t.getSection().removeFromUpdateQueue(t);var o=e.getPage()===t.getPage();e.addToUpdateQueue(r[0].opType,o)}return t.isEligibleForRemove()&&(t.propagateVia(t.getSection(),DOCVIEW.VIEW_BEFORE_REMOVE,t),t.getColumn().buildChildView({opType:OP_TYPE.REMOVE,view:t},!0,!0)),e},getType:function(){return this.type},getSection:function(){return this.parent},getSectionType:function(){return this.getSection().getSectionType()},getGroup:function(){return this.getSection().getGroup()},getRootSectionType:function(){return this.getSection().getRootSectionType()},getLeft:function(){return this.left},getAbsTop:function(e){if(this.getType()===e)return 0;var t=this.getTop(),i=this.getParent();return i&&(t+=i.getContentTop(),i.getType()!==e&&(t+=i.getAbsTop(e))),t},getAbsLeft:function(e){if(this.getType()===e)return 0;var t=this.getLeft(),i=this.getParent();return i&&(t+=i.getContentLeft(),i.getType()!==e&&(t+=i.getAbsLeft(e))),t},getContentTop:function(){return 0},getContentLeft:function(){return 0},getNodesBetweenRange:function(e,t){for(var i=[],n=this.getFirstChild();n;)i=i.concat(n.getNodesBetweenRange(e,t)),n=n.getNextView();return i},getChildViews:function(){return this.childViews||null},isEmpty:function(){return!this.getChildViewsLength()},getTop:function(){return this.top},refresh:function(){var e=this.getChildViewsLength();if(e)for(var t=this.getFirstChild();t;)t.refresh(),t=t.getNextView()},isEligibleForSplit:function(){var e=this.getChildViewsLength();if(0===e)return!1;for(var t=this.getLastChild(),i=0;t;){if(t.getType()===VIEW.PARA&&(i+=t.getNodeLinesLength()),i>1)return!0;t=t.getPrevView()}return!1},isFirstView:function(e){return this.getFirstChild().getId()===e.getId()},setViewTop:function(){},getSeparatorFormat:function(){return this.prev?this.getSection().getColumnSeparatorFormat():{width:"0px",type:"solid",color:"#ccc"}},getWatermarkData:function(){for(var e=this.getFirstChild(),t=null;e;){if(t=e.getWatermarkData())return t;e=e.next}return t},logger:function(){return this.getSection().logger()}}),t}(Utils),PageDocView=function(e,t){"use strict";function i(e){this.id=Utils.randomId(VIEW.PAGE),this.group=e,this.documentLayoutManager=this.group.getLayoutManager(),this.pageNumber=1;for(var t=0;t<SECTION_SEQUENCE.length;t++){var i=SECTION_SEQUENCE[t];this[i]=new LinkedList}this.style={},this.height=0,this.paginationHeight=0,this.width=0,this.maxHeaderHeight=0,this.maxFooterHeight=0,this.headerHeight=0,this.footerHeight=0,this.type=VIEW.PAGE,this.initLayout(),this.contentHeight=0,this.contentContainerHeight=0,this.outgoingFootnotes={references:{},ids:[]},this.outgoingTextboxes={references:{},ids:[]},this.bindGroupEvents()}var n=function(){var e=this.group.getHFType(),t=this.getRelativePageNumber();switch(e){case HEADER_FOOTER_TYPE.PRIMARY:return{header:CONST.HEADER_PRIMARY,footer:CONST.FOOTER_PRIMARY};case HEADER_FOOTER_TYPE.DIFF_FIRST_PAGE:return 1===t?{header:CONST.HEADER_FIRST,footer:CONST.FOOTER_FIRST}:{header:CONST.HEADER_PRIMARY,footer:CONST.FOOTER_PRIMARY};case HEADER_FOOTER_TYPE.DIFF_ODD_EVEN_PAGE:return t%2?{header:CONST.HEADER_PRIMARY,footer:CONST.FOOTER_PRIMARY}:{header:CONST.HEADER_EVEN,footer:CONST.FOOTER_EVEN};case HEADER_FOOTER_TYPE.DIFF_FIRST_ODD_EVEN_PAGE:return 1===t?{header:CONST.HEADER_FIRST,footer:CONST.FOOTER_FIRST}:t%2?{header:CONST.HEADER_PRIMARY,footer:CONST.FOOTER_PRIMARY}:{header:CONST.HEADER_EVEN,footer:CONST.FOOTER_EVEN}}},r={};r[SECTION_TYPES.CONTENT]=function(e){e.getPaginationTop()>=this.getPaginationHeight()?this.moveOverflowingSectionsToNextPage(e):e.getPaginationTop()+e.getHeight()>this.getPaginationHeight()&&e.addToPaginationQueue(e.getFirstColumn())},r[SECTION_TYPES.ENDNOTE]=function(e){this.moveOverflowingSectionsToNextPage(e)};var o=.2;return t.call(i.prototype),extend(i.prototype,{init:function(){var e=n.call(this),t=this.group.getHeader(e.header),i=this.group.getFooter(e.footer);t&&this.addSectionView(t),i&&this.addSectionView(i)},initLayout:function(){this.width=this.group.getPageWidth(),this.height=this.group.getPageHeight(),this.updatePaginationHeight()},handleSectionUpdate:function(e){},handleAfterHFSectionUpdate:function(e){this.propagateVia(this.documentLayoutManager,DOCVIEW.AFTER_HF_SECTION_UPDATE,e,this)},handleSectionHeightUpdate:function(e){this.processSectionUpdate(e);var t=e.getSectionType();if(NOTE_SECTIONS.contains(t)){var i=e.getContainingPara();if(i&&!e.getGroup().isViewBuildInProgress(i.getNodeId())){var n=i.getSection(),r=i.getColumn();n.addToPaginationQueue(r)}}},processSectionUpdate:function(e){var t=e.getSectionType();switch(t){case SECTION_TYPES.CONTENT:this.updateAllSectionTop(this.getFirstSection(t)),this.updateContentHeight(),this.updateContentContainerHeight(),this.updatePageHeight();break;case SECTION_TYPES.HEADER:this.updateHeaderMaxHeight(),this.updateHeaderHeight();break;case SECTION_TYPES.FOOTER:this.updateFooterMaxHeight(),this.updateFooterHeight();break;case SECTION_TYPES.ENDNOTE:this.updateAllSectionTop(this.getFirstSection(t));case SECTION_TYPES.FOOTNOTE:case SECTION_TYPES.TEXTBOX:this.updatePaginationHeight(),this.updateContentContainerHeight(),this.updatePageHeight()}},getMaxHeaderHeight:function(){return this.maxHeaderHeight},getMaxFooterHeight:function(){return this.maxFooterHeight},getHeaderTop:function(){return this.group.getHeaderTop()},getFooterBottom:function(){return this.group.getFooterBottom()},getMargin:function(){var e=this.getFirstSection(SECTION_TYPES.CONTENT);return e?e.getMargin():this.group.getMargin()},getGutter:function(){var e=this.getFirstSection(SECTION_TYPES.CONTENT);return e?e.getGutter():this.group.getGutter()},getGutterTop:function(){var e=this.group.getGutter();return e.position===GUTTER_POSITION.TOP?e.value:0},getGutterLeft:function(){var e=this.getFirstSection(SECTION_TYPES.CONTENT);return e?e.getGutterLeft():this.group.getGutterLeft()},getGutterRight:function(){var e=this.getFirstSection(SECTION_TYPES.CONTENT);return e?e.getGutterRight():this.group.getGutterRight()},updatePageHeight:function(){var e=this.documentLayoutManager.getPageDOMViewHeight(this);this.height!==e&&this.propagateVia(this.documentLayoutManager,DOCVIEW.PAGE_HEIGHT_UPDATED,this)},updateContentHeight:function(){for(var e=this.getFirstSection(SECTION_TYPES.CONTENT),t=0;e;)t+=e.getHeight(),e=e.next;this.contentHeight=t},updatePaginationHeight:function(){this.paginationHeight=this.getHeight()-(this.getHeaderHeight()+this.getFooterHeight())},updateContentContainerHeight:function(){var e=this.documentLayoutManager.getPageContentContainerHeight(this);this.contentContainerHeight!==e&&(this.contentContainerHeight=e,this.updateAllSectionTop(this.getFirstSection(SECTION_TYPES.CONTENT)),this.propagateVia(this.documentLayoutManager,DOCVIEW.PAGE_CONTENT_HEIGHT_UPDATED,this))},updateFooterMaxHeight:function(){this.maxFooterHeight=this.getActualPageHeight()-(Math.max(this.getHeader()&&this.getHeader().getHeight()||0,this.group.getMargin().top+this.group.getGutterTop())+this.getMinRenderingHeight())},updateHeaderMaxHeight:function(){this.maxHeaderHeight=this.getActualPageHeight()-(Math.max(this.getFooter()&&this.getFooter().getHeight()||0,this.group.getMargin().bottom)+this.getMinRenderingHeight())},updateFooterHeight:function(){var e=this.group.getMargin().bottom,t=Math.min(Math.max(this.getFooter()&&this.getFooter().height||0,e),this.getMaxFooterHeight());this.footerHeight!==t&&(this.footerHeight=t,this.updatePaginationHeight(),this.updateContentContainerHeight(),this.updatePageHeight())},updateHeaderHeight:function(){var e=this.group.getLayoutProps(),t=e.margin.top,i=this.group.getGutterTop(),n=Math.min(Math.max(this.getHeader()&&this.getHeader().height||0,t+i),this.getMaxHeaderHeight());this.headerHeight!==n&&(this.headerHeight=n,this.updatePaginationHeight(),this.updateContentContainerHeight(),this.updatePageHeight())},getMinRenderingHeight:function(){return this.getActualPageHeight()*o},getActualPageHeight:function(){return this.getGroup().getLayoutProps().actualPageDimensions.height},handleFloatImagesUpdate:function(e){this.processFloatImageAffectedViewsBelow(e)},getId:function(){return this.id},getAllViews:function(e){for(var t=this.group.getDocViews(e.getId()),i=[],n=0;n<t.length;n++)t[n].belongsToPage(this)&&i.push(t[n]);return i},getContentTop:function(){return this.getHeaderHeight()},getFootnoteTop:function(){return this.getHeaderHeight()+this.getContentContainerHeight()},getEndnoteTop:function(){return this.getHeaderHeight()+this.getContentHeight()},getContentHeight:function(){return this.contentHeight},getContentContainerHeight:function(){return this.contentContainerHeight},getContentWidth:function(){var e=this.getFirstSection(SECTION_TYPES.CONTENT);if(!e){var t=this.getMargin();return this.group.getPageWidth()-(t.left+this.getGutterLeft()+this.getGutterRight()+t.right)}return e.getWidth()},getMaxContentHeight:function(){var e=this.getHeight(),t=this.group.getMargin();return e-t.top-t.bottom-this.group.getGutterTop()},getSectionContainerTop:function(e){var t=this.getFirstSection(e);return t?t.getPageTop():0},getContentLeft:function(){var e=this.getFirstSection(SECTION_TYPES.CONTENT);if(!e){var t=this.group.getMargin();return this.isMirroredEvenPage()?t.left+this.group.getGutterLeft():t.right+this.group.getGutterRight()}return e.getLeft()},isMirroredEvenPage:function(){return!(!this.documentLayoutManager.isMirrorMargins()||this.getAbsolutePageNumber()%2!==0)},getHeaderHeight:function(){return this.isHFVisible(SECTION_TYPES.HEADER)?this.headerHeight:0},getFooterHeight:function(){return this.isHFVisible(SECTION_TYPES.FOOTER)?this.footerHeight:0},updateAllSectionTop:function(e){for(var t,i;e;)t=e.getTop(),i=e.updateTop(),i!==t&&e.addToPaginationQueue(e.getFirstColumn()),e=e.next},getFloatImages:function(e,t){for(var i=[],n=this.getFirstSection(SECTION_TYPES.CONTENT);n;)i=i.concat(n.getFloatImages()),n=n.next;return e?i[e]:(t||i.sort(function(e,t){return e.getAbsLeft(VIEW.PAGE)-t.getAbsLeft(VIEW.PAGE)}),i)},processFloatImageAffectedViewsBelow:function(e){var t=e.getSectionType();if(t===SECTION_TYPES.CONTENT)for(var i=e.getNextSection();i&&!i.isEmpty();)i.processFloatImageAffectedViewsBelow(i.getFirstView()),i=i.getNextSection()},split:function(e){var t=(e.getPage(),e.getNextSection()),i=this.group.createDocSectionView(e.dtView,this);this.group.addSectionToPage(i,this),this.moveRemainingPaginatableSectionsToPage(t)},getHeader:function(){return this.getFirstSection(SECTION_TYPES.HEADER)},getFooter:function(){return this.getFirstSection(SECTION_TYPES.FOOTER)},getHFSection:function(e){return this[e].first},bindEvents:function(e){e.on(DOCVIEW.SECTION_HEIGHT_UPDATED,this.handleSectionHeightUpdate,this),e.on(DOCVIEW.FLOAT_IMAGES_UPDATED,this.handleFloatImagesUpdate,this)},unbindEvents:function(e){e.off(DOCVIEW.SECTION_HEIGHT_UPDATED,this.handleSectionHeightUpdate,this),e.off(DOCVIEW.FLOAT_IMAGES_UPDATED,this.handleFloatImagesUpdate,this)},remove:function(){for(var e=0;e<SECTION_SEQUENCE.length;e++)for(var t,i=SECTION_SEQUENCE[e],n=this.getLastSection(i);n;)t=n.prev,this.removeSectionView(n),this.prev&&i==SECTION_TYPES.TEXTBOX&&this.prev.isAnOutGoingTextbox(n.getNodeId())&&(this.prev.removeFromOutGoingTextbox(n.getNodeId()),this.prev.addSectionView(n)),n=t},destroy:function(){this.unbindGroupEvents(),this.outgoingTextboxes={},this.outgoingFootnotes={},this.contentContainerHeight=0,this.contentHeight=0,this.type="",this.footerHeight=0,this.headerHeight=0,this.maxFooterHeight=0,this.maxHeaderHeight=0,this.width=0,this.paginationHeight=0,this.height=0,this.style={},this.pageNumber=0,this.documentLayoutManager=null,this.group=null,this.id=""},updatePageNumber:function(){this.pageNumber=(this.prev?this.prev.getRelativePageNumber():0)+1},updatePageCountInViews:function(){this.trigger(DOCVIEW.PAGE_COUNT_UPDATED,this),this.propagateVia(this.documentLayoutManager,DOCVIEW.PAGE_COUNT_UPDATED_IN_HF,this)},updatePageNumberInViews:function(){this.trigger(DOCVIEW.PAGE_NUMBER_UPDATED,this),this.propagateVia(this.documentLayoutManager,DOCVIEW.PAGE_NUMBER_UPDATED_IN_HF,this)},isEmpty:function(){for(var e="",t=0;t<PAGINATING_SECTIONS.length;t++)if(e=PAGINATING_SECTIONS[t],!this[e].isEmpty())return!1;return!0},after:function(e){return!!e&&this.pageNumber>e.pageNumber},before:function(e){return e&&!this.after(e)},isPagePaginated:function(){for(var e=this.getFirstSection(SECTION_TYPES.CONTENT);e;){if(!e.isPaginationCompleted())return!1;e=e.next}return!0},getNextPaginatableSection:function(e){[SECTION_TYPES.FOOTNOTE,SECTION_TYPES.TEXTBOX].contains(e.getSectionType())&&(e=e.getRootSection());var t=e.next;return t||e.getSectionType()==SECTION_TYPES.CONTENT&&this.hasEndNotes()&&(t=this.getFirstSection(SECTION_TYPES.ENDNOTE)),t},getFirstPaginatableSection:function(){var e=this.getFirstSection(SECTION_TYPES.CONTENT);return e||(e=this.getFirstSection(SECTION_TYPES.ENDNOTE)),e||null},getLastPaginatableSection:function(){var e=this.getLastSection(SECTION_TYPES.ENDNOTE);return e||(e=this.getLastSection(SECTION_TYPES.CONTENT)),e||null},isSectionOverFlowing:function(e){var t=e.getSectionType();return!(t!=SECTION_TYPES.CONTENT&&(t!=SECTION_TYPES.ENDNOTE||!e.prev&&!this.hasContentSection()))&&(e.getPaginationTop()>=this.getPaginationHeight()||e.getPaginationTop()+e.getHeight()>this.getPaginationHeight())},haveEnoughSpaceToFitSection:function(e){var t=this.getLastPaginatableSection();if(t&&t.getNodeId()!==e.getNodeId()){var i=this.getPaginationHeight()-(t.getPaginationTop()+t.getHeight());if(e.getSectionType()==SECTION_TYPES.ENDNOTE)return!(i<e.getHeight());var n=e.getMinRenderingHeight();return i>n}return!1},postProcessPaginate:function(e){if(e.getSectionType()==SECTION_TYPES.ENDNOTE&&this.isSectionOverFlowing(e))r[e.getSectionType()].call(this,e);else{var t=DocUtils.getNextNonEmptyPage(this),i=this.getNextPaginatableSection(e);if(i){if(t&&t.getFirstPaginatableSection().getNodeId()==e.getNodeId())return void this.moveOverflowingSectionsToNextPage(i);for(;i;){if(!i.isPaginationCompleted())return;if(this.isSectionOverFlowing(i))return void r[i.getSectionType()].call(this,i);i=this.getNextPaginatableSection(i)}}if(t){var n=t.getFirstPaginatableSection();n&&(this.haveEnoughSpaceToFitSection(n)&&this.moveSectionToPage(n),n.addToPaginationQueue(n.getFirstColumn()))}}},buildAllViews:function(e){for(;e;)this.getGroup().shouldBuildDocViews(e)&&e.buildAllViewsInUpdateQueue(),e=e.getNextSection()},buildAllViewsInUpdateQueue:function(){this.buildAllViews(this.getFirstSection(SECTION_TYPES.HEADER)),this.buildAllViews(this.getFirstSection(SECTION_TYPES.FOOTER)),this.buildAllViews(this.getFirstSection(SECTION_TYPES.CONTENT))},paginate:function(e,t){this.clearOutGoingFootNotes();var i=e||this.getFirstSection(SECTION_TYPES.CONTENT);if(i.paginate(t),i.isPaginationCompleted())if(i.isPaginatableSection())this.postProcessPaginate(i),i.isEligibleForRemove()&&i.removeAllChildViews(),this.isPagePaginated()&&this.propagateVia(this.documentLayoutManager,DOCVIEW.PAGE_PAGINATED,this);else if(i.getSectionType()==SECTION_TYPES.FOOTNOTE){var n=i.getRootSection(),r=i.getContainingPara(),o=r.getColumn();n.addToPaginationQueue(o)}},moveOverflowingSectionsToNextPage:function(e){if(e){var t=DocUtils.getNextNonEmptyPage(this);t||(t=this.getGroup().createPage(this)),t.moveRemainingSectionsToPage(e),e.getSectionType()==SECTION_TYPES.CONTENT&&this.hasEndNotes()&&(e=this.getFirstSection(SECTION_TYPES.ENDNOTE),t.moveRemainingSectionsToPage(e))}},moveSectionToPage:function(e){var t=e.getPage();if(t){e.removeFromPaginationInfo();for(var i,n,r=[],o=t.textbox.first;o;)n=o.next,i=o.getParent().getSection(),e.getId()===i.getId()&&(t.removeSectionView(o),r.push(o)),o=n;t.removeSectionView(e)}this.addSectionView(e);for(var a=0;a<r.length;a++)this.addSectionView(r[a])},moveRemainingSectionsToPage:function(e){for(var t,i=e;e;)t=e.next,this.moveSectionToPage(e),e=t;i.addToPaginationQueue(i.getFirstColumn())},moveRemainingPaginatableSectionsToPage:function(e){var t=this.getPrevPage();if(e&&this.moveRemainingSectionsToPage(e),t.hasEndNotes()){var e=t.getFirstSection(SECTION_TYPES.ENDNOTE);this.moveRemainingSectionsToPage(e)}},isFirstPage:function(){return 1===this.pageNumber},isOddPage:function(){return this.pageNumber%2===1},isEvenPage:function(){return this.pageNumber%2===0},getPageNumber:function(){return this.group.getStartingPageNumber()+this.getRelativePageNumber()-1},getRelativePageNumber:function(){return this.pageNumber},getAbsolutePageNumber:function(){return(this.group.prev&&this.group.prev.getAbsolutePageCount()||0)+this.pageNumber},getPrevPage:function(){return this.prev},getNextPage:function(){return this.next},getGroup:function(){return this.group},getHeight:function(){return this.height},getDOMViewHeight:function(){return DocLayoutManager.getPageDOMViewHeight(this)},getPaginationHeight:function(){return this.paginationHeight},getWidth:function(){return this.width},getDOMViewWidth:function(){return this.width+PAGE_BORDER_WIDTH},getType:function(){return this.type},getHFType:function(e){return n.call(this)[e]},getNoteHeight:function(e){var t=this.getFirstSection(e),i=0;for(t&&(i+=this.getSeparatorHeight());t;)i+=t.getHeight(),t=t.next;return i},getFootNoteDOMHeight:function(){return this.getHeight()-(this.getContentContainerHeight()+this.getHeaderHeight()+this.getFooterHeight())},getEndNoteDOMHeight:function(){return this.getContentContainerHeight()-this.getContentHeight()},addSectionView:function(e){var t=e.getSectionType(),i=null,n=e.getPage();if(HF_SECTIONS.contains(t)){var r=this.getHFSection(t);if(r){if(r.getId()===e.getId())return;this.removeSectionView(r)}e.on(DOCVIEW.AFTER_HF_SECTION_UPDATE,this.handleAfterHFSectionUpdate,this)}else if(e.setPage(this),SECTION_TYPES.CONTENT===t){var o=e.getDTView().prev;if(o)for(var a=this.getFirstSection(t);a;){if(a.getNodeId()===o.getId()){i=a;break}a=a.next}}else if(META_SECTIONS.contains(t)&&!e.isReplicableView())for(var s=e.getDTView(),l=this[t].last;l;){if(s.getRangeIndex()>l.getDTView().getRangeIndex()){i=l;break}l=l.prev}if(!META_SECTIONS.contains(t)||!e.isReplicableView())if(i)this[t].insertAfter(e,i),t===SECTION_TYPES.CONTENT&&i.propagateVia(i.documentLayoutManager,DOCVIEW.SECTION_TOP_UPDATED,i);else if(this[t].insertAsFirst(e),t===SECTION_TYPES.ENDNOTE&&1==this[t].length&&this.hasContentSection()){var d=this.getLastSection(SECTION_TYPES.CONTENT);d.propagateVia(d.documentLayoutManager,DOCVIEW.SECTION_TOP_UPDATED,d)}this.bindEvents(e),this.processSectionUpdate(e),HF_SECTIONS.contains(t)&&!n&&this.propagateVia(this.documentLayoutManager,DOCVIEW.AFTER_HF_SECTION_BUILD_COMPLETE,e),this.propagateVia(this.documentLayoutManager,DOCVIEW.SECTION_ATTACHED,e,this)},removeSectionView:function(e){var t=e.getSectionType();this.propagateVia(this.documentLayoutManager,DOCVIEW.SECTION_BEFORE_DETACHED,e,this),HF_SECTIONS.contains(t)?e.off(DOCVIEW.AFTER_HF_SECTION_UPDATE,this.handleAfterHFSectionUpdate,this):e.setPage(null),this.unbindEvents(e),this[t].remove(e),this.processSectionUpdate(e);var i=this.getLastSection(SECTION_TYPES.CONTENT);(t===SECTION_TYPES.CONTENT||t===SECTION_TYPES.ENDNOTE&&!this.hasEndNotes())&&i&&i.propagateVia(i.documentLayoutManager,DOCVIEW.SECTION_TOP_UPDATED,i),this.propagateVia(this.documentLayoutManager,DOCVIEW.SECTION_AFTER_DETACHED,e,this)},containsSection:function(e){var t=e.getSectionType();return this[t].hasItem(e)},addToOutGoingFootNotes:function(e,t,i){var n=this.documentLayoutManager.getSectionViews(e)[0],r={footNoteView:n,containingPara:t};this.outgoingFootnotes.references[e]=r,this.outgoingFootnotes.ids.push(e),i.moveSectionToPage(n)},addToOutGoingTextboxes:function(e,t,i){var n=this.documentLayoutManager.getSectionViews(e)[0],r={textboxView:n,containingPara:t};this.outgoingTextboxes.references[e]=r,this.outgoingTextboxes.ids.push(e),i.moveSectionToPage(n)},clearOutGoingFootNotes:function(){var e,t,i=this.outgoingFootnotes.references;for(var e in i)t=i[e].footNoteView,this.moveSectionToPage(t),this.removeFromOutGoingFootNotes(e);this.outgoingFootnotes={references:{},ids:[]}},getSeparatorHeight:function(){return CONST_VIEW.SEPARATOR_HEIGHT},carryOutGoingFootNotesToNextPage:function(e){var t,i,n,r,o,a=0,s=this.getPrevPage(),l=this.getNextPage();l||(l=this.group.createPage());for(var d=s.outgoingFootnotes.ids,c=s.outgoingFootnotes.references,u=!1,g=0,h=d.length;g<h;g++)t=d[g],r=c[t],i=r.footNoteView,o=i.getHeight(),u?(n=r.containingPara,this.addToOutGoingFootNotes(t,n,l)):a+o<e?a+=o:u=!0;return a},getOutGoingFootnoteHeight:function(){for(var e,t=0,i=this.outgoingFootnotes.ids,n=0,r=i.length;n<r;n++)e=this.outgoingFootnotes.references[i[n]].footNoteView,t+=e.getHeight();return t},removeFromOutGoingFootNotes:function(e){for(var t,i=this;i&&i.isAnOutGoingFootNote(e);){delete i.outgoingFootnotes.references[e],t=i.outgoingFootnotes.ids;var n=t.indexOf(e);n!=-1&&i.outgoingFootnotes.ids.splice(n,1),i=i.getNextPage()}},removeOutGoingTextboxFromPrevPages:function(e){for(var t,i=this;i&&i.isAnOutGoingTextbox(e);){delete i.outgoingTextboxes.references[e],t=i.outgoingTextboxes.ids;var n=t.indexOf(e);n!=-1&&i.outgoingTextboxes.ids.splice(n,1),i=i.getPrevPage()}},removeFromOutGoingTextbox:function(e){for(var t,i=this;i&&i.isAnOutGoingTextbox(e);){delete i.outgoingTextboxes.references[e],t=i.outgoingTextboxes.ids;var n=t.indexOf(e);n!=-1&&i.outgoingTextboxes.ids.splice(n,1),i=i.getNextPage()}},isAnOutGoingFootNote:function(e){return!!this.outgoingFootnotes.references[e]},isAnOutGoingTextbox:function(e){return!!this.outgoingTextboxes.references[e]},hasOutGoingFootnotes:function(){return this.outgoingFootnotes.ids.length>0},hasEndNotes:function(){return!this[SECTION_TYPES.ENDNOTE].isEmpty()},hasFootNotes:function(){return!this[SECTION_TYPES.FOOTNOTE].isEmpty()},hasContentSection:function(){return!this[SECTION_TYPES.CONTENT].isEmpty()},getFirstSection:function(e){return this[e].first},getLastSection:function(e){return this[e].last},getFirstSectionContainingNote:function(e){var t,i=this.getFirstSection(e);return t=i&&i.getContainingPara()?i.getContainingPara().getSection():this.getFirstSection(SECTION_TYPES.CONTENT)},getNoteProps:function(e){var t={},i=this.getFirstSectionContainingNote(e);return e===SECTION_TYPES.FOOTNOTE?t.height=this.getFootNoteDOMHeight():t.height=this.getEndNoteDOMHeight(),t.width=i?i.getWidth():0,t.left=i?i.getLeft():0,t.right=i?i.getRight():0,t},isNotesEmpty:function(e){return this[e].isEmpty()},findOverflowingContentDocView:function(){for(var e=this.getFirstSection(SECTION_TYPES.CONTENT);e;){if(e.top+e.height>this.getPaginationHeight())return e;e=e.next}return null},getPageBorders:function(){return this.getGroup().getBorders()},handleBorderChange:function(){this.canDrawPageBorders()&&this.trigger(GROUP.PAGE_BORDER_CHANGED)},handleHFVisibilityUpdate:function(e){this.propagateVia(this.documentLayoutManager,GROUP.HF_VISIBILITY_UPDATE,this,e)},canDrawPageBorders:function(){return null!==this.getHeader()&&null!==this.getFooter()},bindGroupEvents:function(){this.group.on(GROUP.PAGE_BORDER_CHANGED,this.handleBorderChange,this),this.group.on(GROUP.HF_VISIBILITY_UPDATE,this.handleHFVisibilityUpdate,this)},unbindGroupEvents:function(){this.group.off(GROUP.PAGE_BORDER_CHANGED,this.handleBorderChange,this),this.group.off(GROUP.HF_VISIBILITY_UPDATE,this.handleHFVisibilityUpdate,this)},getFirstParaView:function(){return this.getFirstPaginatableSection().getFirstParaView()},getLastParaView:function(){return this.getLastPaginatableSection().getLastParaView()},isHFVisible:function(e){var t=!0,i=this.documentLayoutManager;return i.isFixedView()&&(e==SECTION_TYPES.HEADER&&i.getFirstPage()&&i.getFirstPage().getId()!==this.getId()||e==SECTION_TYPES.FOOTER&&i.getLastPage()&&i.getLastPage().getId()!==this.getId())&&(t=!1),t},getRange:function(){var e=this.getFirstParaView(),t=this.getLastParaView();return e&&t?{start:e.getNodeStartIndex()+e.getStart(),end:t.getNodeStartIndex()+t.getEnd()}:null},getParent:function(){return null},getWatermarkData:function(){for(var e=this.getFirstSection(SECTION_TYPES.HEADER),t=null;e;){if(t=e.getWatermarkData())return t;e=e.next}return t},refreshSectionMargins:function(){for(var e=0;e<PAGINATING_SECTIONS.length;e++)for(var t=this.getFirstSection(PAGINATING_SECTIONS[e]);t;)t.initLayout(),t.propagateVia(this.documentLayoutManager,DOCVIEW.SECTION_STYLE_UPDATED,t,this),t=t.next;for(var e=0;e<HF_SECTIONS.length;e++)for(var t=this.getFirstSection(HF_SECTIONS[e]);t;)t.propagateVia(this.documentLayoutManager,DOCVIEW.SECTION_STYLE_UPDATED,t,this),t=t.next}}),i}(DTUtils,BaseEventHandler),CellDocView=function(e,t){"use strict";function i(t,i,n,r){e.apply(this,arguments),this.minCellHeight=this.dtView.getCellHeight(),this.height=this.minCellHeight,this.domHeight=0,this.floatImageHeight={},this.actualWidth=0,this.borders={top:0,bottom:0,left:0,right:0,missedTop:0,missedBottom:0,missedLeft:0,missedRight:0},this.alignmentHeightInfo={top:0,cellContainerHeight:0,cellHeight:0};var o=this.getNode();this.mergeType=o.getMergeType(),this.rspan=o.getRowSpan(),this.cspan=o.getColSpan(),this.borderOverwritten=!1,this.containsDummyTopBorder=!1}var n=function(){var e=this.getRow();if(e.isExcessDom||e.isEmpty()&&e.isSplittedParentOrChildFCVmpRow())return 0;var t=0,i=this.getParent().isRowHeightRuleExact();return t=i?this.getDTView().getCellHeight():this.getContentHeight(),t=Math.max(t,this.minCellHeight),t+=this.getDTView().getCellPaddingHeight(),t+=this.getBordersHeight()};return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,extend(i.prototype,{createDocView:function(){var e="";this.updateProperties();var t=this.getParent();return t.isAllCellViewsBuiltInRow()&&t.updateAllFcRspanOfVmpCellsInRow(),this.isUserOperation&&this.handleCellMergeTypeUpdate(e),!1},updateDocView:function(){var e=this.getMergeType();return this.updateProperties(),this.isUserOperation&&this.handleCellMergeTypeUpdate(e),!1},getMinRenderingHeight:function(){var e=this.getFirstChild(),t=0;return e&&(t=e.getMinRenderingHeight()),t<this.minCellHeight&&(t=this.minCellHeight),t},handleCellMergeTypeUpdate:function(e){var i=this.getMergeType();if(e!==i){var n,r=this.getNode();i===CELL_MERGE_TYPE.VMP&&t.isLastVmpCell(r)?n=r.getRootMergeCell():e===CELL_MERGE_TYPE.VMP&&(n=r);var o=this.getTable().getDocViews();if(n)for(var a=0;a<o.length;a++){var s=o[a];s.updateShouldMergeBeforePaginateStatus(!0)}if(this.getTable().isCompleteTableBuilded())for(var a=o.length-1;a>=0;a--){var l=o[a];l.shouldMergeBeforePaginate&&(l.updateShouldMergeBeforePaginateStatus(!1),l.getSection().updateShouldMergeBeforePaginateStatus(!0),l.getSection().addToPaginationQueue(l.getColumn()))}}},addToUpdateQueue:function(t,i,n){this.getParent().isExcessDom||e.prototype.addToUpdateQueue.call(this,t,i,n)},isCellContainsImage:function(){return this.getNode().isCellContainesImage},isCellContainsTable:function(){return this.getNode().isCellContainesTable},getFirstChildMarginTop:function(){var e=this.getFirstChild(),t=0;if(e&&e.getType()===VIEW.PARA){var i=e.getDTView().getParaSpacingProperties();i&&i.before&&(t+=i.before)}return t},getDOMViewHeight:function(){return this.domHeight},updateDOMHeight:function(){var e;e=this.getMergeType()===CELL_MERGE_TYPE.FC?this.getFCCellTotalHeight():this.getParent().getHeight();var t=e-(this.getBordersHeight()+this.getDTView().getCellPaddingHeight()+this.getFirstChildMarginTop());this.domHeight=t>0?t:0},getDOMViewWidth:function(){return this.actualWidth},getMissedBordersHeight:function(){return this.getBordersHeight(!0)-this.getBordersHeight()},getHeightWithoutBorders:function(){var e={includeMissedBorder:!1};return this.getHeight(e)-this.getBordersHeight()},isInnerTableCell:function(){var e=this.getTable();return e&&e.getParent().getType()===VIEW.CELL},updateWidth:function(){var e=this.getNode(),t=this.borders.left+this.borders.right,i=e.cellPadding.left+e.cellPadding.right;this.width=this.actualWidth-t-i,this.width<=0&&(this.width=20)},updateLeft:function(){var e,t=this.getNode(),i=(t.prev,this.prev),n=this.getTable();if(i?(e=i.left+i.actualWidth,i.getMergeType()===CELL_MERGE_TYPE.VMP&&i.getFCCellView()&&(e+=i.getFCCellView().actualWidth)):e=0,n.isRTLDirection()){var r=n.getWidth();e=i?i.left-this.getActualWidth():r-this.getActualWidth()}this.left=e},getContentHeight:function(){var e,t=0;for(e=this.getFirstChild();e;)t+=e.getHeight(),e=e.next;return t},getContentLeft:function(){return this.borders.left+this.getNode().getCellPadding().left},getCellHeight:function(){return this.getDTView().getCellHeight()},updateMergeType:function(){var e=this.getNode();if(this.mergeType=e.getMergeType(),this.mergeType===CELL_MERGE_TYPE.FC)this.rspan=this.calculateViewRspan();else if(this.mergeType===CELL_MERGE_TYPE.VMP){var t=this.getFCCellView();t&&t.updateRowSpan(t.calculateViewRspan())}else this.rspan=e.getRowSpan();this.cspan=e.getColSpan()},updateProperties:function(){this.actualWidth=this.getCellWidth(),this.setMinHeight(),this.refreshBorderValues(),this.updateSurroundingCellViews(),this.updateWidth(),this.updateLeft(),this.updateMergeType(),this.updateHeight()},destroy:function(){this.borderOverwritten=!1,this.containsDummyTopBorder=!1,this.borders={},this.minCellHeight=0,this.actualWidth=0,this.floatImageHeight={},this.height=0,e.prototype.destroy.call(this)},refreshBorderValues:function(){var e=this.getBordersHeight(),t=this.getNode(),i=t.borderProperties||{},n=i[ATTR_BORDERS.BORDER_LEFT]||0,r=i[ATTR_BORDERS.BORDER_RIGHT]||0,o=i[ATTR_BORDERS.BORDER_TOP]||0,a=i[ATTR_BORDERS.BORDER_BOTTOM]||0,s=this.borders;s.top=o/2,s.bottom=a/2,s.left=n/2,s.right=r/2,s.missedTop=s.top,s.missedBottom=s.bottom,s.missedLeft=s.left,s.missedRight=s.right,this.mergeBorderWidth(),e!==this.getBordersHeight()&&this.updateHeight()},findColIdx:function(){for(var e=this,t=-1;e;)t++,e=e.prev;return t},updateSurroundingCellViews:function(){var e=this.getSurroundingCellViews();for(var t in e){var i=e[t];i&&i.refreshBorderValues()}},mergeBorderWidth:function(){var e=this.getSurroundingCellViews(),t=this.borders;if(e.top){var i=e.top;i.borders.missedBottom=0,t.missedTop=0;var n=i.getNode().borderProperties&&i.getNode().borderProperties[ATTR_BORDERS.BORDER_BOTTOM]/2||0;n>t.top&&(t.top=n)}if(e.bottom){var r=e.bottom;r.borders.missedTop=0,t.missedBottom=0;var o=r.getNode().borderProperties&&r.getNode().borderProperties[ATTR_BORDERS.BORDER_TOP]/2||0;o>t.bottom&&(t.bottom=o)}if(e.left){var a=e.left;a.borders.missedRight=0,t.missedLeft=0;var s=a.getNode().borderProperties&&a.getNode().borderProperties[ATTR_BORDERS.BORDER_RIGHT]/2||0;s>t.left&&(t.left=s)}if(e.right){var l=e.right;l.borders.missedLeft=0,t.missedRight=0;var d=l.getNode().borderProperties&&l.getNode().borderProperties[ATTR_BORDERS.BORDER_LEFT]/2||0;d>t.right&&(t.right=d)}},getSurroundingCellViews:function(){for(var e=-1,t={},i=this;i;)e++,i=i.prev;return i=this,i.prev&&(t.left=i.prev),i.next&&(t.right=i.next),i.parent&&i.parent.prev&&(t.top=i.parent.prev.getCellViewAtIndex(e)),i.parent&&i.parent.next&&(t.bottom=i.parent.next.getCellViewAtIndex(e)),t},getRow:function(){return this.getParent()},getTable:function(){return this.getRow().getParent()},getCellWidth:function(){var e=this.dtView;if(!e.isVisible)return 0;var t,i,n=this.getNode(),r=e.getTable(),o=this.getTable(),a=o.getColsArray(),s=this.dtView.getColIdx();if(r.isTableWidthInPercentage){for(i=n.cspan,i=i?i:1,t=a[s]?parseFloat(a[s].wt):0;i>1;){s+=1;var l=a[s]?parseFloat(a[s].wt):0;t+=l,i--}t=t*DocLayoutManager.getWidthFromNode(r)/100}else for(t=a[s]?parseFloat(a[s].wt.convertor().pixels):0,i=n.cspan;i>1;){s+=1;var l=a[s]?parseFloat(a[s].wt.convertor().pixels):0;t+=l,i--}return t||0==t||(t=0),t},setMinHeight:function(){this.minCellHeight=this.getDTView().getCellHeight(),this.minCellHeight>0&&(this.minCellHeight+=this.getBordersHeight())},merge:function(e,t){var i,n,r=[],o=this.getFirstChild(),a=this.getLastChild(),s=e.getFirstChild(),l=e.getLastChild();for(s&&a&&s.getNodeId()===a.getNodeId()?a.merge(s,t):s&&o&&s.getNodeId()===o.getNodeId()?o.merge(s,t):l&&a&&l.getNodeId()===a.getNodeId()?a.merge(l,t):l&&o&&l.getNodeId()===o.getNodeId()&&o.merge(l,t),n=e.getFirstChild();n;)r.push(n),n=n.getNextView();for(i=0;i<r.length;i++)t.moveView(r[i],r[i].getColumn());var d=e.getSection().removeFromUpdateQueue(e);d&&this.addToUpdateQueue(d[0].opType,!0);var c=!0;return e.isEligibleForRemove(c)&&e.removeAllChildViews(!0,!0,!1,c),this.refreshBorderValues(),this},removeAllChildViews:function(e,t,i,n){if(this.getChildViewsLength())for(var r,o=this.getLastChild();o;)r=o.getPrevView(),o.removeAllChildViews(e,t,i),o=r;(i||this.isEligibleForRemove(n))&&this.removeView(e,t)},getPaginationMinCellHeight:function(){var e;return e=this.mergeType===CELL_MERGE_TYPE.VMP||this.mergeType===CELL_MERGE_TYPE.HMP?this.getParent().getMaxMinCellHeight()||0:this.minCellHeight},split:function(e,t,i,n){n=n||{};var r,o,a,s=this.getPaginationMinCellHeight();n.isUserOperation=!1;var l=this.findOrCreateSplitDocView(t,n);if(l.getParent().isExcessDom)return l;o=this.getFirstChild(),l.refreshBorderValues();var d=l.getDTView().getCellPaddingHeight()+l.getBordersHeight();r=d;var c;if(s>e&&n.considerMinCellHeight?(a=o,d=Math.max(d,s)):(n.height=d,c=DocUtils.getBreakViewInfo(this,e,n),a=c.breakNode,d=c.height),a){var u,g=e-d;if(a.type===NODE_TYPE.PARA){var h=a.getParaObjForSplit(g,t,i,{parent:l,borderHeight:r,considerFootNotes:n.considerFootNotes,hasPrevView:a.getColumn().hasVerticallyPrevView(a)});a=h.view,g=h.splitHeight,u=h.splitIndex}var f=a.split(g,t,i,{parent:l,borderHeight:r,considerFootNotes:n.considerFootNotes},u);DocUtils.afterDocViewSplit(a,f,t,i)}return l},getNodesBetweenRange:function(e,t){for(var i=[],n=this.getFirstChild();n;)i=i.concat(n.getNodesBetweenRange(e,t)),n=n.next;if(i.length){var r=i[0],o=ZWArrayUtils.lastElementOf(i);("line"===r.type&&e<this.getNode().getIndex()+1||"line"===o.type&&t>this.getNode().getEndIndex())&&(i.splice(0,i.length),i.push(this))}return i},getBordersHeight:function(e){var t=this.borders.top+this.borders.bottom;return e&&(t+=this.borders.missedTop+this.borders.missedBottom),t},setViewTop:function(){var e=0;if(this.getTop()!==e){this.top=e,this.getSection().trigger(DOCVIEW.VIEW_TOP_UPDATED,this);for(var t=this.getChildViewsArray(),i=0;i<t.length;i++)this.getSection().trigger(DOCVIEW.VIEW_TOP_UPDATED,t[i])}},isMergedCell:function(){var e=this.mergeType,t=this.getNode();return e===CELL_MERGE_TYPE.FC?!(1===t.getColSpan()&&1===t.getRowSpan()):e===CELL_MERGE_TYPE.VMP||e===CELL_MERGE_TYPE.HMP},setHeight:function(e){if(null!=e)this.height=e;else{var t=this.getMergeType();switch(t){case CELL_MERGE_TYPE.FC:this.height=n.call(this);case CELL_MERGE_TYPE.VMP:var i=this.getFCCellView();if(i){i!==this&&(i.height=n.call(i));var r,o,a=i.getHeight(),s=i.getNode().matrixPosition[1],l=i.getParent(),d=l.getMaxHeightExceptThisCell(i),c=i.getNode().getRowSpan()-1,u=i.getLastVmpCell();for(c>0&&(a>d?(i.setHeight(i.minCellHeight),d+=i.minCellHeight,l.updateHeight(),o=a-d):o=0);c>0&&l.next&&(l=l.next,r=l.getCellViewAtIndex(s),r&&r.getMergeType()===CELL_MERGE_TYPE.VMP);)r===u?(d=o,o=0):o>0?(d=l.getMaxHeightExceptThisCell(r),o>=d?(o-=d,d=0):(d=0,o=0)):d=0,r.setHeight(d),l.updateHeight(),c--}else this.height=0;break;case CELL_MERGE_TYPE.HMP:this.height=0;break;case CELL_MERGE_TYPE.NONE:this.height=n.call(this)}}},updateHeight:function(){this.setHeight();for(var e=this.getParent(),t=e.getFirstChild();t;)t!==this&&t.isMergedCell()&&t.setHeight(),t=t.next;e.updateHeight()},updateAlignmentAndHeight:function(){var e=this.getMergeType();if("vmp"==e){var t=this.getFCCellView();return void(t&&t.updateAlignmentAndHeight())}var i=this.getContentHeight(),n=this.getDOMViewHeight(),r=this.getVerticalAlign(),o=0,a=this.getFirstChildMarginTop(),s=n+a-i;switch(s<0&&(s=0,this.parent.isRowHeightRuleExact()||(n=i)),r){case"middle":o=s/2;break;case"bottom":o=s}var l=this.getNode(),d=l.getCellPadding().top,c=this.dtView.getCellPaddingHeight();this.isEmpty()&&this.borderOverwritten&&this.parent.containsDummyBorder&&(d=0,c=0),this.alignmentHeightInfo.top=o+d,this.alignmentHeightInfo.cellContainerHeight=n-o,this.alignmentHeightInfo.cellHeight=n+c},getFCCellTotalHeight:function(){var e=this.getFCCellView();if(!e)return this.getHeight();for(var t=e.getParent(),i=t.getHeight(),n=this.getNode().matrixPosition[1],r=t.next;r;){var o=r.getCellViewAtIndex(n);if(!o||o.getMergeType()!==CELL_MERGE_TYPE.VMP)break;i+=r.getHeight(),r=r.next}return i},isFCCell:function(){return this.mergeType===CELL_MERGE_TYPE.FC},getFCCellView:function(){var e=this.getMergeType();if(e===CELL_MERGE_TYPE.FC)return this;if(e!==CELL_MERGE_TYPE.VMP)return null;for(var t,i=this.getNode().matrixPosition[1],n=this.getParent().prev;n;){if(t=n.getCellViewAtIndex(i),t&&t.mergeType===CELL_MERGE_TYPE.FC)return t;n=n.prev}return null},getLastVmpCell:function(){if(!this.isFCCell())return null;for(var e,t=this.findColIdx(),i=null,n=this.parent&&this.parent.next;n&&(e=n.getCellViewAtIndex(t),e&&e.getNode().getMergeType()===CELL_MERGE_TYPE.VMP);)i=e,n=n.next;return i},getLastHmpCell:function(){if(!this.isFCCell())return null;for(var e,t=this.getParent(),i=this.findColIdx(),n=t.getCellViewAtIndex(i+1);n&&n.getNode().getMergeType()===CELL_MERGE_TYPE.HMP;)e=n,n=n.next;return e},getMergeType:function(){return this.mergeType},calculateViewRspan:function(){if(this.getMergeType()!==CELL_MERGE_TYPE.FC)return 0;for(var e=this.findColIdx(),t=1,i=this.getParent(),n=this;i.next&&(i=i.next,n=i.getCellViewAtIndex(e),n&&n.getMergeType()===CELL_MERGE_TYPE.VMP);)i.isExcessDom||t++;return t},updateRowSpan:function(e){if(this.getMergeType()===CELL_MERGE_TYPE.FC){var t=this.getNode(),i=t.getRowSpan();e>i&&(e=i),this.rspan!==e&&(this.rspan=e,this.trigger(DOCVIEW.ROWSPAN_UPDATED))}},getFCRowAndCellView:function(){if(this.getMergeType()!==CELL_MERGE_TYPE.VMP)return null;var e=this.getNode(),t=e.getRootMergeCell();if(!t)return null;for(var i=0,n=t.rspan-1,r=this.getNode().matrixPosition[1],o=this.parent.prev;o&&n>0;){i+=o.getHeight();var a=o.getCellViewAtIndex(r);if(a&&a.getMergeType()===CELL_MERGE_TYPE.FC)return{fcCell:a,fcRow:o,fcVmpHeight:i};n--,o=o.prev}},isValidCellToMakeBordersNone:function(){if(this.getMergeType()!==CELL_MERGE_TYPE.FC||this.rspan<=1)return!0;var e=this.getLastVmpCell(),t=e.getParent();return!(!t.next||!t.next.isSplittedParentOrChildFCVmpRow())},getVerticalAlign:function(){return this.getNode().getVerticalAlign()},getCellBackgroundType:function(){var e=this.getNode();return e.getBackgroundColor()?CELL_BACKGROUND_TYPE.COLOR:e.getBackgroundImage()?CELL_BACKGROUND_TYPE.IMAGE:CELL_BACKGROUND_TYPE.NONE},getCellBackground:function(){var e=this.getNode(),t=this.getCellBackgroundType();switch(t){case CELL_BACKGROUND_TYPE.COLOR:return Utils.getColorValFromRefString(e.getBackgroundColor());case CELL_BACKGROUND_TYPE.IMAGE:return e.getBackgroundImage();default:return""}},getActualWidth:function(){return this.actualWidth},getRowSpan:function(){return this.rspan},getColSpan:function(){return this.cspan},getBorderStyle:function(){var e=this.getNode(),t=e.getFormat(),i=DomUtil.getBorderStyles(t);if(!this.isFCCell())return i;if(!i["border-right"]){var n=this.getLastHmpCell();if(n&&!n.getNode().next){var r=n.getBorderStyle();r["border-right"]&&(i["border-right"]=r["border-right"])}}if(!i["border-bottom"]){var o=this.getLastVmpCell();if(o&&!o.getNode().parent.next){var a=o.getBorderStyle();a["border-bottom"]&&(i["border-bottom"]=a["border-bottom"])}}return i},isEligibleForRemove:function(t){var i=e.prototype.isEligibleForRemove.call(this);if(i){var n=this.getViews();if(1===n.length)return!1;if(!t)for(var r=this.getParent(),o=r.getFirstChild();o;){if(o!==this&&!e.prototype.isEligibleForRemove.call(o)){i=!1;break}o=o.next}}return i},getLastVmpRowHeight:function(){var e=0,t=this.isFCCell();if(!t)return e;var i=this.getLastVmpCell();return i&&(e=i.getParent().getHeight()),e},isAnyChildViewsInFloatImageArea:function(e){for(var t=this.getChildViewsArray(e),i=0;i<t.length;i++)if(t[i].getType()===VIEW.PARA&&t[i].isInFloatImageArea())return!0;return!1},hasInnerTable:function(){for(var e=this.getFirstChild();e;){if(e.getType()===VIEW.TABLE)return!0;if(e.hasInnerTable())return!0;e=e.next}return!1}}),i}(DocView,DTTableUtils),RowDocView=function(e){"use strict";function t(t,i,n,r){e.apply(this,arguments),this.cantsplit=!1,this.containsParentSplittedFc=!1,this.containsParentSplittedVmp=!1,this.containsSplittedFc=!1,this.containsSplittedVmp=!1,this.containsDummyBorder=!1,this.containsDummyTopBorder=!1,this.isExcessDom=!1}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,extend(t.prototype,{createDocView:function(){this.getHeight();return this.updateProperties(),!1},isHeaderRow:function(){return this.getNode().isHeaderRow()},updateDocView:function(){var e=this.getHeight();return this.updateProperties(),e!==this.getHeight()&&this.getSection().addToPaginationQueue(this.getColumn()),!1},getMinRenderingHeight:function(){for(var e=this.getFirstCell(),t=0,i=0;e;)i=e.getMinRenderingHeight(),i>t&&(t=i),e=e.next;return t},preDocViewsRemove:function(){if(1===this.getTable().getChildViewsLength()){var e=DocUtils.getPrevColumnInSection(this.getSection(),this.getColumn());e&&e.getSection().addToPaginationQueue(e)}if(this.getNode().containsMultiRowMergeCell()||this.hasVmpCells())for(var t=this.getTable().getDocViews(),i=0;i<t.length;i++){var n=t[i];n.getSection().updateShouldMergeBeforePaginateStatus(!0),n.getSection().addToPaginationQueue(n.getColumn())}},updateProperties:function(){this.setViewTop(),this.updateWidth(),this.updateCantSplit(),this.updateAllFcRspanOfVmpCellsInRow()},destroy:function(){this.isExcessDom=!1,this.containsDummyBorder=!1,this.containsDummyTopBorder=!1,this.containsSplittedVmp=!1,this.containsSplittedFc=!1,this.containsParentSplittedVmp=!1,this.containsParentSplittedFc=!1,this.cantsplit=!1,e.prototype.destroy.call(this)},updateCantSplit:function(){var e=this.getNode();this.cantsplit=e.cantSplit(),this.cantsplit||(this.cantsplit=e.isHeaderRow())},getBordersHeight:function(){for(var e,t=this.getFirstChild(),i=0;t;)e=t.getBordersHeight(),e>i&&(i=e),t=t.next;return i},getMissedBordersHeight:function(){for(var e,t=this.getFirstChild(),i=0;t;)e=t.getMissedBordersHeight(),e>i&&(i=e),t=t.next;return i},getCellViewAtIndex:function(e){for(var t=this.getFirstChild(),i=0;t;){if(e===i)return t;i++,t=t.next}return null},isRowHeightRuleExact:function(){return this.getNode().isRowHeightRuleExact()},isRowHeightRuleAtleast:function(){return this.getNode().isRowHeightRuleAtleast()},split:function(e,t,i,n){n=n||{},n.isUserOperation=!1;var r=this.findOrCreateSplitDocView(t,n);n.isExcessDom?(r.isExcessDom=!0,r.propagateVia(r.documentLayoutManager,DOCVIEW.ROW_VISIBILITY_UPDATED,r)):n.considerFootNotes&&(e=this.findSplitHeight(e,t));for(var o=this.getFirstChild();o;)o.split(e,t,i,{parent:r,considerMinCellHeight:n.isLastRowToSplit,considerFootNotes:!1}),o=o.getNextView();return DocUtils.updateAllViewsTop(this),r},merge:function(e,t){for(var i,n,r=this.getFirstChild();r;){for(i=e.getFirstChild();i;)i.getNodeId()===r.getNodeId()?(n&&i.getPrevView()&&i.getPrevView().getNodeId()===n.getNodeId()&&(t.moveView(n,n.getColumn()),n=null),r.merge(i,t)):n=i,i=i.getNextView();r=r.getNextView()}for(i=e.getFirstChild();i;)t.moveView(i,i.getColumn()),i=e.getFirstChild();var o=e.getSection().removeFromUpdateQueue(e);return o&&this.addToUpdateQueue(o[0].opType,!0),e.removeAllChildViews(!0,!0,!0),this},findSplitHeight:function(e,t){for(var i,n,r,o,a,s,l,d,c,u,g,h,f,p,E=this.getTop()+e,T=e,O=this.getFirstChild(),m=this.getColumn(),I=!1;O;){for(l=O.getChildViewsOfGivenType(VIEW.PARA),i=0,o=l.length;i<o;i++){for(d=l[i],g=d.top,h=g,c=d.getNodeLines(),n=0,a=c.length;n<a;n++)if(u=c[n],f=u.getMetaSectionByType(SECTION_TYPES.FOOTNOTE),s=f.length,h+=u.getHeight(),T<=0){if(!(h<=E)){I=!0;break}for(r=0;r<s;r++)m.getPage().addToOutGoingFootNotes(f[r].id,d,t.getPage())}else{if(h<=E){for(r=0;r<s;r++){var D=this.documentLayoutManager.getSectionViews(f[r].id)[0];if(p=D?D.getHeight():0,!(p<=T&&h<=E-p))break;E-=p,e-=p,T=Math.min(E-h,T-p)}if(r<s)for(T=0;r<s;r++)m.getPage().addToOutGoingFootNotes(f[r].id,d,t.getPage());continue}if(f.length){T=0,I=!0;break}}if(I){I=!1;break}}O=O.next}return e},getNodesBetweenRange:function(e,t){for(var i=[],n=this.getFirstChild();n;)i=i.concat(n.getNodesBetweenRange(e,t)),n=n.next;return i},setHeight:function(e){var t=this.getHeight();if(null!=e)this.height=e;else if(this.isExcessDomRow())this.height=0;else{var i,n=0;for(i=this.getFirstChild();i;)i.getHeight()>n&&(n=i.getHeight()),i=i.next;this.height=n}t!==this.height&&(this.propagateVia(this.documentLayoutManager,DOCVIEW.HEIGHT_UPDATED,this),this.updateAllCellsAlignmentAndHeight()),this.sendEventForCellHeightUpdate()},getTable:function(){return this.parent},sendEventForCellHeightUpdate:function(){for(var e=this.getFirstChild();e;){if(e.getMergeType()==CELL_MERGE_TYPE.VMP){var t=e.getFCCellView();t&&(t.updateDOMHeight(),t.updateAlignmentAndHeight(),t.propagateVia(t.documentLayoutManager,DOCVIEW.HEIGHT_UPDATED,t))}e.updateDOMHeight(),e.updateAlignmentAndHeight(),e.propagateVia(e.documentLayoutManager,DOCVIEW.HEIGHT_UPDATED,e),e=e.next}},sendEventForCellStyleUpdate:function(){for(var e=this.getFirstChild();e;)e.propagateVia(e.documentLayoutManager,DOCVIEW.STYLE_UPDATED,e),e=e.next},getHeightWithoutBorders:function(){var e={includeMissedBorder:!1};return this.getHeight(e)-this.getBordersHeight()},updateHeight:function(){var e=this.getHeight();this.setHeight(),e!==this.getHeight()&&(DocUtils.updateAllViewsTop(this),this.getParent().updateHeight())},adjustHeight:function(e){e.setHeight(),this.setHeight()},refreshBorderValues:function(){for(var e=this.getFirstChild();e;)e.refreshBorderValues(),e=e.next},clearRow:function(e,t,i){if(this.containsSplittedFc)for(var n,r=this.splittedFcIdx,o=this.getCellViewAtIndex(r),a=o.rspan-1,s=this.next;s&&a>0;)n=s.next,s.clearRow(e,t),s=n,a--;this.removeAllChildViews(e,t,!1,i)},removeAllChildViews:function(e,t,i,n){if(i||this.isEligibleForRemove(n)){if(this.getChildViewsLength())for(var r,o=this.getLastChild();o;)r=o.getPrevView(),o.removeAllChildViews(e,t,i),o=r;this.removeView(e,t)}},isEligibleForRemove:function(e){if(this.isEmpty()&&1===this.getViews().length)return!1;if(this.isSplittedParentOrChildFCVmpRow()&&!e)return!1;if(this.getNode().containsMultiRowMergeCell()&&!e)return!1;for(var t=!0,i=this.getFirstChild();i;){if(!i.isEligibleForRemove()){t=!1;break}i=i.next}return t&&!this.getSection().isInUpdateQueue(this)},isEligibleForSplit:function(){var t=e.prototype.isEligibleForSplit.call(this)&&this.getNode().children.length===this.getChildViewsLength();if(!t)return!1;for(var i=this.getFirstChild();i;){if(i.getSection().isDirtyNode(i))return!1;i=i.next}return!0},findOrCreateSplitDocView:function(e,t){var i;i=t&&t.parent?t.parent:this.findParentDocViewInColumn(e)||e;var n=e.getSection(),r=this.findDocViewInColumn(e);if(r&&r.isExcessDom&&(r.removeAllChildViews(!0,!0,!0),r=null),r){var o=r.getViewParentChildStatus();r.clearExcessRowDetails(o.isParent,o.isChild)}else r=n.addToSectionView(this.dtView,n,e,i,{isUserOperation:t.isUserOperation});return r},getMaxContentHeightOfRow:function(){for(var e=this.getFirstChild(),t=0,i=0;e;)e.getMergeType()===CELL_MERGE_TYPE.NONE&&(i=e.getContentHeight(),i>t&&(t=i)),e=e.next;return t},getNonMergeCellsCount:function(){for(var e=0,t=this.getFirstChild();t;)t.isMergedCell()||e++,t=t.next;return e},isAllCellViewsBuiltInRow:function(){return this.getChildViewsLength()===this.getNode().children.length},updateAllCellsAlignmentAndHeight:function(e){for(var t=this.getFirstChild();t;)t!=e?(t.updateAlignmentAndHeight(),t=t.next):t=t.next},updateAllCellsHeight:function(){for(var e=this.getFirstChild();e;)e.setHeight(),e=e.next;this.setHeight()},isEmpty:function(){for(var e=this.getFirstChild();e;){if(!e.isEmpty())return!1;e=e.next}return!0},isThereSplittedFC:function(){return this.containsSplittedFc||this.containsParentSplittedFc},isThereSplittedVMP:function(){return this.containsParentSplittedVmp||this.containsSplittedVmp},isThereSplittedFCorVmp:function(){return this.containsSplittedFc||this.containsSplittedVmp},isSplittedParentOrChildFCVmpRow:function(){return this.isThereSplittedFC()||this.isThereSplittedVMP()},getOtherFcVmpCellsInRow:function(e){for(var t,i=[],n=this,r=n.getFirstChild();r;)r.getId()!==e.getId()?(t=r.getMergeType(),t!==CELL_MERGE_TYPE.FC&&t!==CELL_MERGE_TYPE.VMP||i.push(r),r=r.next):r=r.next;return i},getHeight:function(e){return e=e||{},this.height+(e.includeMissedBorder?this.getMissedBordersHeight():0)},getCellWithMaxRspan:function(){for(var e,t,i=this.getFirstChild(),n=0;i;)i.getMergeType()===CELL_MERGE_TYPE.VMP&&(e=i.getNode().getRootMergeCell(),e.getMergeType()===CELL_MERGE_TYPE.FC&&e.getRowSpan()>n&&(n=e.getRowSpan(),t=i)),i=i.next;return t},getFcCellWithMaxRspan:function(){for(var e,t=this.getFirstChild();t;){var i=t.getNode();i.getMergeType()===CELL_MERGE_TYPE.FC&&(!e||i.getRowSpan()>e.getNode().getRowSpan())&&(e=t),t=t.next}return e},getProperFcRowToSplit:function(){for(var e=this.getCellWithMaxRspan(),t=e.getFCRowAndCellView(),i=[],n=t.fcVmpHeight;t.fcRow.hasVmpCells();)i.unshift(t),t=t.fcRow.getCellWithMaxRspan().getFCRowAndCellView(),n+=t.fcVmpHeight;return t.fcVmpHeight=n,{fcAndVmpDetails:t,excessfcVmpArr:i}},getMergeCellViewsInRow:function(e){for(var t=[],i=this.getFirstChild();i;)i.getMergeType()===e&&t.push(i),i=i.next;return t},clearExcessRowDetails:function(e,t){var i=this.isExcessDom;!e&&!t||e&&!t?(this.containsSplittedFc=!1,this.splittedFcIdx=-1,this.containsSplittedVmp=!1,this.containsParentSplittedFc=!1,this.containsParentSplittedVmp=!1,this.isExcessDom=!1):!e&&t&&(this.containsParentSplittedFc=!1,this.containsParentSplittedVmp=!1,this.isExcessDom=!1),i!==this.isExcessDom&&this.propagateVia(this.documentLayoutManager,DOCVIEW.ROW_VISIBILITY_UPDATED,this)},getViewParentChildStatus:function(){var e=!1,t=!1,i=this.getDocViews();if(1!==i.length){for(var n=0,r=0;r<i.length;r++)if(i[r].getId()===this.getId()){n=r;break}n<i.length-1&&(e=!0),n>0&&(t=!0,2!==i.length||!i[0].isEmpty()&&0!==i[0].getHeight()||(t=!1))}return{isParent:e,isChild:t}},getFCCellsInRow:function(){return this.getMergeCellViewsInRow(CELL_MERGE_TYPE.FC)},getVmpCellsInRow:function(){return this.getMergeCellViewsInRow(CELL_MERGE_TYPE.VMP)},getMaxMinCellHeight:function(){for(var e=0,t=0,i=this.getFirstChild();i;)i.getMergeType()===CELL_MERGE_TYPE.FC&&i.minCellHeight>t?t=i.minCellHeight:i.getMergeType()!==CELL_MERGE_TYPE.FC&&i.minCellHeight>e&&(e=i.minCellHeight),i=i.next;return e&&t&&t>e?t:e?e:t},getMaxCellViewsCountExcept:function(e){for(var t,i=0,n=this.getFirstChild();n;)n.getId()!==e.getId()?(t=n.getChildViewsLength(),t>i&&(i=t),n=n.next):n=n.next;return i},hasEmptyNonMergedSubView:function(){for(var e=!0,t=this.getFirstChild();t;){if(!t.isMergedCell()&&!t.isEmpty()){e=!1;break}t=t.next}return e},hasFCCells:function(){for(var e=this.getFirstChild();e;){if(e.getMergeType()===CELL_MERGE_TYPE.FC)return!0;e=e.next}return!1},hasVmpCells:function(){for(var e=this.getFirstChild();e;){if(e.getMergeType()===CELL_MERGE_TYPE.VMP)return!0;e=e.next}return!1},hasLastVmpCell:function(){for(var e,t,i=!1,n=this.getFirstChild();n;){if(n.getMergeType()===CELL_MERGE_TYPE.VMP&&(e=n.findColIdx(),!this.next||this.next&&(t=this.next.getCellViewAtIndex(e))&&t.getMergeType()!=CELL_MERGE_TYPE.VMP)){i=!0;break}n=n.next}return i},hasMergedCells:function(){for(var e=this.getFirstChild();e;){if(e.isMergedCell())return!0;e=e.next}return!1},isAllCellViewsMergedInRow:function(){return this.getChildViewsLength()>0&&0===this.getNonMergeCellsCount()},isContainsSingleMergedRow:function(){var e=this,t=e.getFirstChild();return t.getMergeType()===CELL_MERGE_TYPE.FC&&t.cspan==e.getChildViewsLength()},isExcessDomRow:function(){var e=!1;if(!this.isThereSplittedVMP())return e;var t=this.isEmpty(),i=this.getFCCellsInRow(),n=i.length>0,r=!1,o=this.getVmpCellsInRow();if(o)for(var a=0;a<o.length;a++)if(DTTableUtils.isLastVmpCell(o[a].getNode())){r=!0;break}return!t||n||r||(e=!0),e},updateExcessDom:function(){var e=this.isExcessDomRow(),t=!1;e!==this.isExcessDom&&(t=!0),this.isExcessDom=e,t&&this.propagateVia(this.documentLayoutManager,DOCVIEW.ROW_VISIBILITY_UPDATED,this)},isValidRowToMakeBordersNone:function(){if(!this.next)return!1;var e=this.hasLastVmpCell();return!(!e||!this.next.isSplittedParentOrChildFCVmpRow())||!e},isValidVmpViewToRemove:function(){var e=this.hasLastVmpCell();return!e||!this.prev.isExcessDom},reCreateRowView:function(){this.addToUpdateQueue(OP_TYPE.UPDATE,!0,{isUserOperation:!1});for(var e,t=this.getChildViewsArray(!0),i=0;i<t.length;i++){var n=t[i];e=this.getPage()===n.getPage(),n.addToUpdateQueue(OP_TYPE.UPDATE,e,{isUserOperation:!1})}},reCreateExcessRowView:function(){this.isExcessDom&&(this.isExcessDom=!1,this.propagateVia(this.documentLayoutManager,DOCVIEW.ROW_VISIBILITY_UPDATED,this),this.reCreateRowView())},updateAllFcRspanInRow:function(){for(var e=this.getFCCellsInRow(),t=e.length,i=0;i<t;i++)e[i].updateRowSpan(e[i].calculateViewRspan())},updateAllFcRspanOfVmpCellsInRow:function(){for(var e,t=this.getVmpCellsInRow(),i=t.length,n=0;n<i;n++)e=t[n].getFCCellView(),e&&e.updateRowSpan(e.calculateViewRspan())},updateAllVmpCellsHeightInRow:function(){for(var e,t=this.getVmpCellsInRow(),i=t.length,n=0;n<i;n++)e=t[n],e.getRow().adjustHeight(e),e.getTable().updateHeight(e.getRow(),e,!0)},getFirstCell:function(){return this.getFirstChild()},getLastCell:function(){return this.getLastChild()},getMaxHeightExceptThisCell:function(e){if(!e)return 0;for(var t=0,i=this.getFirstChild();i;)i!==e&&i.getHeight()>t&&(t=i.getHeight()),i=i.getNextView();return t},isAnyChildViewsInFloatImageArea:function(e){for(var t=this.getFirstCell();t;){if(t.isAnyChildViewsInFloatImageArea(e))return!0;t=t.next}return!1},updateHeaderRowInAllViews:function(){if(this.isHeaderRow()){var e=this.getParent(),t=this.getGroup();t.updateHeaderRowInAllTableViews(e)}}}),t}(DocView),TableDocView=function(e){"use strict";function t(t,i,n,r){e.apply(this,arguments),this.rowStart=0,this.actualWidth=0,this.cols=[],this.shouldMergeBeforePaginate=!1}var i=40;return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,extend(t.prototype,{createDocView:function(){return this.updateProperties(),!1},updateDocView:function(){return this.updateProperties(),!1},getMinRenderingHeight:function(){var e=this.getFirstNonExcessDomRow(),t=0;return e&&(t=e.getMinRenderingHeight()),t},getFirstNonExcessDomRow:function(){for(var e=this.getFirstRow();e&&(e.isExcessDom||e.isEmpty()&&e.isSplittedParentOrChildFCVmpRow());)e=e.next;return e},destroy:function(){this.shouldMergeBeforePaginate=!1,this.cols=[],this.actualWidth=0,this.rowStart=0,e.prototype.destroy.call(this)},setTableLeft:function(){var e=this.getNode(),t=this.getRawFormat(),i=e.getTableAlign()||ALIGN.LEFT;if(i===ALIGN.LEFT)this.left=t[ATTR_TABLE.TBLS_ML]?t[ATTR_TABLE.TBLS_ML].convertor().pixels:0;else{var n=this.getParent().getWidth(),r=n-this.getWidth();i===ALIGN.CENTER?this.left=r/2:i===ALIGN.RIGHT&&(this.left=r)}},shouldIncludeHeaderRow:function(){return this.getNode().containsHeaderRow&&this.rowStart>0&&this.getHeaderRow()&&this.getHeaderRow().getHeight()<this.getSection().getMaxRenderingHeight()-i},getHeaderRow:function(){var e=this.getNode(),t=e.getFirstRow();return t&&t.isHeaderRow()?this.getGroup().getDocViews(t.getId())[0]:null},processRowsToSplit:function(e,t,i,n,r){if(i===e.getSection().getMaxRenderingHeight()){if(t.length>1){for(var o,a=0;a<t.length;a++)if(t[a].getMinRenderingHeight()>i){o=t[a];break}if(o){var s=t[0].getFcCellWithMaxRspan().getLastVmpCell(),l=s&&s.parent;t=[],i=0,n=0,l&&l.next?(e=l.next,l.next&&t.push(l.next)):e=void 0}else n-=r}else if(1==t.length){var d=t[0],c=this.getHeaderRow(),u=0;c&&(u+=c.getHeight());var g=d.getMinRenderingHeight(),h=d.getMaxMinCellHeight();if(g>h&&(h=g),u+h>i)if(t=[],i=0,n=0,d.hasFCCells()){var s=d.getFcCellWithMaxRspan().getLastVmpCell(),l=s&&s.parent;l&&l.next?(e=l.next,l.next&&t.push(l.next)):e=void 0}else e=d.next,d.next&&t.push(d.next)}}else if(t.length>1){var f=t[0];f.isContainsSingleMergedRow()||f.getMaxMinCellHeight()>i||f.isAllCellViewsMergedInRow()?(t=[f],e=f,n=0,f.isContainsSingleMergedRow()||(i=0)):(e.getMaxMinCellHeight()>0&&(i=n),n-=r)}else e.getMaxMinCellHeight()>=i&&e.getParent().isFullTableMerged()&&(i=0,n=0);return{breakNode:e,rowsListToSplit:t,splitHeight:i,height:n}},getRowsListToSplitInfo:function(e,t,i){var n,r=[];if(e){var o=t.getProperFcRowToSplit();n=o.fcAndVmpDetails;for(var a=n.fcRow,s=0,l=a;l&&(r.push(l),l.getNodeId()!==t.getNodeId());)s+=l.getMissedBordersHeight(),l=l.next;i-=s}else n={fcVmpHeight:0},r.push(t);return{rowsListToSplit:r,fcAndVmpDetails:n,height:i}},split:function(e,t,i,n){var r,o,a=0,s=this.getFirstChild();if(n=n||{},this.isFullTableMerged()?r=s:(o=DocUtils.getBreakViewInfo(this,e,n),r=o.breakNode,a=o.height),r&&r.parent.isAllRowBuildedUntil(r)){n.isUserOperation=!1;var l=this.findOrCreateSplitDocView(t,n);l.rowStart=r.getNode().getChildIndex();var d=r.hasVmpCells(),c=this.getRowsListToSplitInfo(d,r,a),u=c.fcAndVmpDetails.fcCell,g=c.fcAndVmpDetails.fcVmpHeight,h=c.rowsListToSplit;a=c.height;var f=this.processRowsToSplit(r,h,e,a,g);r=f.breakNode,h=f.rowsListToSplit,e=f.splitHeight,a=f.height,r&&(d=r.hasVmpCells());for(var p=0,E=[],T=null,O={parent:l,considerFootNotes:n.considerFootNotes},m=0;m<h.length;m++){var I=h[m];if(p=I.getHeight(),O.isLastRowToSplit=m===h.length-1,r.getId()!==I.getId()&&d){var D=I.getFCCellsInRow();O.isExcessDom=0===D.length}else O.isExcessDom=!1;var T=I.split(e-a,t,i,O);d&&(0===m?(I.containsParentSplittedFc=!0,T.containsSplittedFc=!0,T.splittedFcIdx=u.findColIdx()):(I.isEligibleForRemove()||(I.containsParentSplittedVmp=!0),T.containsSplittedVmp=!0,m===h.length-1&&(r=I))),a+=p,E.push(T)}this.postRowSplit(r,t,i,l,h,E),l.shouldIncludeHeaderRow()&&l.propagateVia(l.documentLayoutManager,DOCVIEW.TABLE_HEADER_ROW_UPDATED,l,l.getHeaderRow()),l.isSplitTable=!0}else for(;this.next;)t.moveView(this.next,i);return l&&(l.updateAllRowFcRspan(),l.updateAllRowsHeight(),l.updateDummyRowDetails()),this.recreateExcessDOMLastVmpRow(),this.updateAllRowFcRspan(),this.updateAllRowsHeight(),this.updateDummyRowDetails(),this.propagateVia(this.documentLayoutManager,DOCVIEW.AFTER_TABLE_SPLIT,this,l),l},getRowsHeight:function(){for(var e=this.getFirstRow(),t=[],i=0;e;)t[i]={ht:e.getHeight()},i++,e=e.next;return t},getRowAt:function(e){for(var t=this.getFirstRow(),i=0;t;){if(e==i)return t;i++,t=t.next}return null},getRowsHeightWithoutBorders:function(){for(var e=this.getFirstRow(),t=[],i=0;e;)t[i]={ht:e.getHeightWithoutBorders()},i++,e=e.next;return t},postRowSplit:function(e,t,i,n,r,o){for(var a=!1;e&&e.next;){var s=e.next,l=s.findDocViewInColumn(t);l&&l.isExcessDom&&(l.removeAllChildViews(!0,!0,!0),l=null),l?l.merge(s,t):t.moveView(s,i)}n.isEmpty()||n.getFirstChild().isEligibleForRemove()&&(n.getFirstChild().clearRow(!0,!0),a=!0),e&&e.isEligibleForRemove(!0)&&e.isValidVmpViewToRemove()&&!a&&e.clearRow(!0,!0,!0),o.length>1&&(this.updateAllRowFcRspan(),n.updateAllRowFcRspan()),n.isEmpty()||n.checkMerge()},checkMerge:function(){var e=this.getNextView();if(e&&this.getNodeId()===e.getNodeId())return e.merge(this,this.getColumn());var t=this.getPrevView();return t&&this.getNodeId()===t.getNodeId()?t.merge(this,this.getColumn()):this},merge:function(e,t,i){for(var n,r,o,a,s=!isNaN(i),l=e.getFirstChild();l&&!(i<=0);){var d=l.next;n=l.hasMergedCells(),r=l.getHeight();var c=l.getDTView();o=this.findRowViewByDTView(c),o?l.isEligibleForRemove()||l.isExcessDomRow()?l.removeAllChildViews(!0,!0,!0):(n&&o.reCreateExcessRowView(),o.merge(l,t)):t.moveView(l,l.getColumn()),s&&(i-=r),a=this.findRowViewByDTView(c),l=d}this.rowStart=Math.min(this.rowStart,e.rowStart);var u=e.getSection().removeFromUpdateQueue(e);if(e.isEligibleForRemove())u&&this.addToUpdateQueue(u[0].opType,!0),e.removeAllChildViews(!0,!0),e=null;else{if(u){var g=this.getPage()===e.getPage();e.addToUpdateQueue(u[0].opType,g)}if(l=e.getFirstChild(),l&&(e.rowStart=l.getNode().getChildIndex(),l.hasVmpCells())){var h;if(this.getLastChild().hasVmpCells()){var f=this.getLastChild().getProperFcRowToSplit(),p=f.fcAndVmpDetails;h=p.fcRow}else h=this.getLastChild();for(var E=[];h;){var T=e.findRowViewByDTView(h.getDTView());T?(T.isEligibleForRemove()||T.isExcessDomRow())&&(T.removeAllChildViews(!0,!0,!0),E.push(h)):E.push(h),h=h.next}e.processAndAddDummyRowViews(E),e.updateSplittedViewCacheDetails()}e.updateAllRowFcRspan(),e.updateAllRowsHeight(),e.updateDummyRowDetails()}return this.shouldIncludeHeaderRow()&&this.propagateVia(this.documentLayoutManager,DOCVIEW.TABLE_HEADER_ROW_UPDATED,this,this.getHeaderRow()),(0===this.rowStart||this.getFirstChild()&&this.getFirstChild().isThereSplittedFC())&&this.updateSplittedViewCacheDetails(),this.updateAllRowFcRspan(),this.updateAllRowsHeight(),this.updateDummyRowDetails(),this.propagateVia(this.documentLayoutManager,DOCVIEW.AFTER_TABLE_MERGE,this,e),this},findRowViewByDTView:function(e){for(var t=this.getFirstRow();t;){if(t.getDTView()===e)return t;t=t.next}return null},processAndAddDummyRowViews:function(e){if(e&&0!==e.length){var t=!0,i=e[0].getFcCellWithMaxRspan();if(i){var n=i&&i.findColIdx();if(1===e.length){var r=e[0].getDTView().next,o=r?this.findRowViewByDTView(r):null;o&&o.getCellViewAtIndex(n).getMergeType()===CELL_MERGE_TYPE.VMP||(t=!1)}else{for(var a,s=1;s<e.length;s++)if(a=e[s].getCellViewAtIndex(n),a&&a.getMergeType()!==CELL_MERGE_TYPE.VMP){t=!1;break}if(t){var l=ZWArrayUtils.lastElementOf(e).getDTView().next,d=l?this.findRowViewByDTView(l):null;d&&d.getCellViewAtIndex(n).getMergeType()===CELL_MERGE_TYPE.VMP||(t=!1)}}if(t)for(var c,s=0;s<e.length;s++)c=this.createAndAddDummyRowView(e[s]),0===s?(c.containsSplittedFc=!0,c.splittedFcIdx=n):c.containsSplittedVmp=!0}}},createAndAddDummyRowView:function(e){var t,i,n={isUserOperation:!1,dontBuild:!0};t=this.getSection().addToSectionView(e.getDTView(),this.getSection(),this.getColumn(),this,n),t.containsParentSplittedFc=e.containsParentSplittedFc,t.containsSplittedFc=e.containsSplittedFc,t.splittedFcIdx=e.splittedFcIdx,t.containsParentSplittedVmp=e.containsParentSplittedVmp,t.containsSplittedVmp=e.containsSplittedVmp;for(var r=t.getDTView().getFirstChild();r;)i=t.getSection().addToSectionView(r,t.getSection(),t.getColumn(),t,n),r=r.next;return t.isExcessDom=!0,t.propagateVia(t.documentLayoutManager,DOCVIEW.ROW_VISIBILITY_UPDATED,t),(t.isThereSplittedFC()||t.getNode().containsMultiRowMergeCell())&&t.reCreateExcessRowView(),!t.isSplittedParentOrChildFCVmpRow()&&t.hasVmpCells()&&(t.containsSplittedVmp=!0),t},mergeAllViewsOnImproperPagination:function(){var e=this.getFirstChild();if(e&&this.getSection().shouldMergeBeforePaginate){var t=e.getDocViews(),i=t.length;if(i<=2)return;for(var n,r,o=i-1;o>=0&&t[o].getId()!==e.getId();o--)n=t[o].parent,r=t[o-1]&&t[o-1].parent,n&&r&&(n.getSection().updateShouldMergeBeforePaginateStatus(!1),r.getSection().updateShouldMergeBeforePaginateStatus(!1),r.merge(n,r.getColumn()))}},getNodesBetweenRange:function(e,t){for(var i=[],n=this.getFirstChild();n;)i=i.concat(n.getNodesBetweenRange(e,t)),n=n.next;return i},isEligibleForRemove:function(){if(this.isEmpty()){var t=e.prototype.isEligibleForRemove.call(this);if(t&&1===this.getViews().length)for(var i,n=this.getNode(),r=n.getSection(),o=n.children,a=0;a<o.length;a++)if(i=o[a],r.isDirtyNode(i)&&!this.getGroup().getDocViews(i.getId()).length){t=!1;break}return t}return this.getDocViews().length>1&&e.prototype.isEligibleForRemove.call(this)},computeCellDefaultWidth:function(){return this.getParent().getWidth()/this.getNode().getCols().length},fillDefaultsColsWidthIfMissing:function(){for(var e=this.computeCellDefaultWidth(),t=ZWJSONUtils.clone(this.getNode().getCols()),i=0;i<t.length;i++)(0===Object.keys(t[i]).length||isNaN(parseFloat(t[i].wt)))&&(t[i].wt=e);this.cols=t},processTableColsWidth:function(){var e=this.getNode(),t=e.getTableWidth(),i=0;t&&(i=t.indexOf("%")!==-1?this.getParent().getWidth()*(t.split("%")[0]/100):t.convertor().pixels);for(var n,r=this.getColsArray(),o=0;o<r.length;o++)n=r[o],"string"==typeof n.wt&&(n.wt.indexOf("%")!==-1?n.wt=i*(n.wt.split("%")[0]/100):n.wt=n.wt.convertor().pixels)},getColsArray:function(){return this.cols},computeTableWidth:function(){var e=this.getColsArray(),t=0;if(e.length)for(var i=0;i<e.length;i++)t=e[i].wt+t;else t=this.getParent().getWidth();this.actualWidth=t},getWidth:function(){return this.actualWidth},updateWidth:function(){var e=this.getNode(),t=e.borderProperties,i=t[ATTR_BORDERS.BORDER_LEFT]+t[ATTR_BORDERS.BORDER_RIGHT];this.width=this.getWidth()-(i||0)},updateProperties:function(){this.setViewTop(),this.fillDefaultsColsWidthIfMissing(),this.processTableColsWidth(),this.computeTableWidth(),this.updateWidth(),this.setTableLeft(),this.updateDummyRowDetails()},setHeight:function(e){e=e||{},e.hasOwnProperty("includeMissedBorder")||(e.includeMissedBorder=!0);var t,i=0;if(this.getChildViewsLength())for(this.shouldIncludeHeaderRow()&&(i+=this.getHeaderRow().getHeight()),t=this.getFirstChild();t;)i+=t.getHeight(e),t=t.next;this.height=i},getHeightWithoutBorders:function(){var e,t=0;if(!this.isEmpty()){if(this.shouldIncludeHeaderRow()){var i=this.getHeaderRow();t+=i?i.getHeightWithoutBorders():0}for(e=this.getFirstChild();e;){var n=e.getHeightWithoutBorders();t+=n,e=e.next}}return t},updateAllRowsHeight:function(){for(var e=this.getLastChild();e;)e.updateAllCellsHeight(),e=e.prev},getFirstRow:function(){return this.getFirstChild()},updateDummyRowDetails:function(){var e,t=this.getFirstRow();if(t){for(;t;){if(t.containsDummyBorder){for(t.containsDummyBorder=!1,e=t.getFirstCell();e;)e.borderOverwritten&&(e.borderOverwritten=!1),e=e.next;t.sendEventForCellStyleUpdate()}t=t.next}var t,i=this.getFirstChild();if(i){for(;i;){if(i.containsDummyTopBorder){t=i;break}i=i.next}if(t&&!t.isEmpty()){t.containsDummyTopBorder=!1;for(var n,e=t.getFirstChild();e;)n=e.getNode().getBorderStyle(),n&&n["border-top"]||(e.containsDummyTopBorder=!1),e=e.next}if(this.getNode().theme.themeObj&&this.isSplitTable&&this.getFirstChild()&&this.getFirstChild().containsSplittedFc){for(var t,i=this.getFirstChild();i;){if(!i.containsSplittedFc&&!i.isEmpty()){t=i;break}i=i.next}if(t&&!t.isEmpty()){t.containsDummyTopBorder=!0;for(var n,e=t.getFirstChild();e;)n=e.getNode().getBorderStyle(),n&&n["border-top"]||(e.containsDummyTopBorder=!0),e=e.next}}var e,t=this.getFirstChild();if(t&&t.containsSplittedFc)for(;t&&t.isThereSplittedFCorVmp();)if(t.isExcessDom)t=t.next;else{if(t.hasEmptyNonMergedSubView()&&t.isValidRowToMakeBordersNone()){for(t.containsDummyBorder=!0,e=t.getFirstChild();e;)e.isValidCellToMakeBordersNone()&&e.isEmpty()&&(e.borderOverwritten=!0),e=e.next;t.sendEventForCellStyleUpdate()}t=t.next}}}},recreateExcessDOMLastVmpRow:function(){for(var e=this.getFirstChild();e;)e.isExcessDom&&e.hasLastVmpCell()&&e.reCreateExcessRowView(),e=e.next},updateSplittedViewCacheDetails:function(){for(var e,t=this.getFirstChild();t;)e=t.getViewParentChildStatus(),t.clearExcessRowDetails(e.isParent,e.isChild),t.updateExcessDom(),t=t.next},updateAllRowFcRspan:function(){for(var e=this.getFirstChild();e;)e.updateAllFcRspanInRow(),e=e.next},isFullTableMerged:function(){return this.getNode().isFullTableMerged()},isCompleteTableBuilded:function(){var e=this.getNode(),t=this.getDocViews();if(t.length>0){var i=ZWArrayUtils.lastElementOf(t),n=i.getChildViewsLength()&&i.getLastChild(),r=e.getLastRow();return n&&r&&n.getNodeId()===r.getId()&&n.isAllCellViewsBuiltInRow()}return!1},isAllRowBuildedUntil:function(e){for(var t=!0,i=this.childViews.first;i;){if(!i.isEligibleForSplit()){t=!1;break}if(e&&e.id==i.id)break;i=i.next}return t},updateShouldMergeBeforePaginateStatus:function(e){this.shouldMergeBeforePaginate=e},isRTLDirection:function(){var e=this.getNode();return e.isRTLDirection()},getTableMarginLeft:function(){var e=this.getNode();return e.getTableMarginLeft()}}),t}(DocView,BaseEventHandler),TocDocView=function(){"use strict";function e(e,t,i,n){DocView.apply(this,arguments)}return e.prototype=Object.create(DocView.prototype),e.prototype.constructor=e,extend(e.prototype,{createDocView:function(){var e=this.getHeight();return this.updateProperties(),e!==this.getHeight()},updateDocView:function(){var e=this.getHeight();return this.updateProperties(),this.isEligibleForRemove()&&this.removeAllChildViews(!1,!0),e!==this.getHeight()},updateProperties:function(){this.setViewTop(),this.updateWidth(),this.updateHeight()},split:function(e,t,i,n){n=n||{};var r,o,a,s=DocUtils.getBreakViewInfo(this,e,n),l=s.breakNode,d=s.height||40;if(l){n.isUserOperation=!1;var c=this.findOrCreateSplitDocView(t,n);if(DocLayoutManager.getViewHeight(l,n.considerFootNotes)>e-d){var u,g=e-d;if(l.type===NODE_TYPE.PARA){var h=l.getParaObjForSplit(g,t,i,{parent:c,considerFootNotes:n.considerFootNotes,hasPrevView:!!this.getPrevView()});l=h.view,g=h.splitHeight,u=h.splitIndex}var f=l.split(g,t,i,{parent:c,considerFootNotes:n.considerFootNotes},u);DocUtils.afterDocViewSplit(l,f,t,i)}else if(l=l.getPrevView())for(;l.getNextView();)t.moveView(l.getNextView(),i);else{for(o=[],a=this.getFirstChild();a;)o.push(a),a=a.getNextView();for(r=0;r<o.length;r++)t.moveView(o[r],i)}c.checkMerge()}else for(;this.getNextView();)t.moveView(this.getNextView(),i);return c},merge:function(e,t,i){var n,r,o=[],a=e.getFirstChild();for(this.getChildViewsLength()&&e.getChildViewsLength()&&(a.getNodeId()===this.getLastChild().getNodeId()?this.getLastChild().merge(a,t):a.getNode().id===this.getFirstChild().getNodeId()&&this.getFirstChild().merge(a,t)),r=e.getFirstChild();r;)o.push(r),r=r.getNextView();var s;for(n=0;n<o.length&&(s=t.moveView(o[n],o[n].getColumn()),!(i&&(i-=s.getHeight(),i<0)));n++);return e.isEligibleForRemove()&&e.removeAllChildViews(!0,!0),this},getNodesBetweenRange:function(e,t){for(var i=[],n=this.getFirstChild();n;)i=i.concat(n.getNodesBetweenRange(e,t)),n=n.getNextView();return i},isEligibleForRemove:function(){if(this.isEmpty()){var e=DocView.prototype.isEligibleForRemove.call(this);if(e&&1===this.getViews().length)for(var t,i=this.getNode(),n=i.getSection(),r=i.children,o=0;o<r.length;o++)if(t=r[o],n.isDirtyNode(t)&&!this.getGroup().getDocViews(t.getId()).length){e=!1;break}return e}return this.getDocViews().length>1&&DocView.prototype.isEligibleForRemove.call(this)},hasInnerTable:function(){for(var e=this.getFirstChild();e;){if(e.getType()===VIEW.TABLE)return!0;if(e.hasInnerTable())return!0;e=e.next}return!1}}),e}(),TextBoxDocView=function(){"use strict";function e(e,t,i){SectionDocView.apply(this,arguments),this.page=i,this.containingParaReference={},this.containerHeight=0,this.create()}var t={top:0,middle:.5,bottom:1};return e.prototype=Object.create(SectionDocView.prototype),e.prototype.constructor=e,extend(e.prototype,{initLayout:function(){var e=this.getRangeFormat(),t=(e.wid+e.wid_un).convertUnitTo(UNITS.PIXELS);this.margin=DTUtils.convertJSONUnitTo({left:e.pl,right:e.pr,top:e.pt,bottom:e.pb},UNITS.PIXELS),this.width=t-(this.margin.left+this.margin.right),this.containerHeight=(e.ht+e.ht_un).convertUnitTo(UNITS.PIXELS)},getMargin:function(){return this.margin},getOuterMargin:function(){var e=this.getRangeFormat();return this.isWrappedFloating()?DTUtils.convertJSONUnitTo({left:e[ATTR_IMAGE.I_ML],right:e[ATTR_IMAGE.I_MR],top:e[ATTR_IMAGE.I_MT],bottom:e[ATTR_IMAGE.I_MB]},UNITS.PIXELS):{left:0,right:0,top:0,bottom:0}},getBorderStyle:function(){var e=this.getRangeFormat(),t=e[ATTR_COMMON.BORDERS];return t?{left:t[ATTR_BORDERS.BORDER_LEFT],right:t[ATTR_BORDERS.BORDER_RIGHT],top:t[ATTR_BORDERS.BORDER_TOP],bottom:t[ATTR_BORDERS.BORDER_BOTTOM]}:null},getBorderWidth:function(){var e=this.getBorderStyle();return e?DTUtils.convertJSONUnitTo({left:e.left?e.left[ATTR_BORDERS.WIDTH]:"0px",right:e.right?e.right[ATTR_BORDERS.WIDTH]:"0px",top:e.top?e.top[ATTR_BORDERS.WIDTH]:"0px",bottom:e.bottom?e.bottom[ATTR_BORDERS.WIDTH]:"0px"},UNITS.PIXELS):{left:0,right:0,top:0,bottom:0}},getOuterWidth:function(){return this.getLeft()+this.getDOMViewWidth()+this.getRight()},getDOMViewWidth:function(e){e=e||{includePadding:!0,includeBorders:!1,shouldTransform:!1},(e.shouldTransform||e.includeBorders)&&(e.includePadding=!0);var t=this.getWidth();if(e.includePadding){var i=this.getMargin();t+=i.left+i.right}if(e.shouldTransform&&(t=TransformationUtils.getTransformedSize(this.getRotation(),t,this.getOuterHeight()).width),e.includeBorders){var n=this.getBorderWidth();t+=n.left+n.right}return t},getDOMViewHeight:function(e){e=e||{includePadding:!0,includeBorders:!1,shouldTransform:!1},(e.shouldTransform||e.includeBorders)&&(e.includePadding=!0);var t=this.getOuterHeight();if(!e.includePadding){var i=this.getMargin();t-=i.top+i.bottom}if(e.shouldTransform&&(t=TransformationUtils.getTransformedSize(this.getRotation(),this.getOuterWidth(),t).height),e.includeBorders){var n=this.getBorderWidth();t+=n.top+n.bottom}return t},getOuterHeight:function(){return this.containerHeight},getRotation:function(){return this.getRangeFormat()[ATTR_IMAGE.I_ROTATE]},getParent:function(){return this.getContainingPara()},getBackground:function(){var e=this.getRangeFormat(),t=e[ATTR_CELL.TDS_BGIMG];if(t)return{data:t,type:"image"};var i=e.z_tb_bgc;return i&&"none"!==i?{data:i,type:"color"}:null},getOpacity:function(){var e=this.getRangeFormat()[ATTR_IMAGE.I_OP];return e?e/100:1},getEffects:function(){return this.getRangeFormat().effects},getRangeFormat:function(){return this.getNode().getRangeFormat()},getRootSectionType:function(){return this.getDTView().getRootSectionType()},getRootSection:function(){return this.getContainingPara().getSection()},getRangeIndex:function(){return this.getDTView().getRangeIndex()},isFloating:function(){var e=this.getRangeFormat();return DTUtils.isFloatingImage(e)},isWrappedFloating:function(){var e=this.getRangeFormat();return DTUtils.isWrappingFloatImage(e)},destroy:function(){var e=this.getContainingPara().getPage();e&&e.removeFromOutGoingTextbox(this.getNodeId()),this.containingParaReference={},this.page=null,SectionDocView.prototype.destroy.apply(this,arguments)},setContainingParaReference:function(e,t){this.containingParaReference.view=e,this.containingParaReference.node=t},getContainingPara:function(){return this.containingParaReference.view},belongsToPara:function(e){return this.containingParaReference.node.getId()===e},belongsToPage:function(e){var t=this.getContainingPara().getSection();return t.belongsToPage(e)},getPage:function(){var e;return e=this.isReplicableView()?this.getRootSection().getPage():this.page},getLeft:function(){return 0},getRight:function(){return 0},getWrapType:function(){return this.getRangeFormat()[ATTR_IMAGE.I_WRAP_TYPE]},getContentTop:function(){return this.getBorderWidth().top+this.getMargin().top+this.getMarginTop()},getMarginTop:function(){var e=this.getRawFormatAt(this.dtView.getRangeIndex()),i=0;if(e.va){var n=this.getContentHeight(),r=this.getMargin(),o=this.getOuterHeight()-r.top-r.bottom;return n<o&&(i=(o-n)*t[e.va]),i}return i},handleSectionOpComplete:function(){var e=this.getRootSection(),t=e.hasViewsPendingToBuild();t||e.handleSectionOpComplete(),this.propagateVia(this.documentLayoutManager,DOCVIEW.TEXTBOX_CHANGED,this),this.paginate(),this.documentLayoutManager.triggerPagination()},refresh:function(){SectionDocView.prototype.refresh.call(this),this.handleSectionOpComplete()},isFillableField:function(){var e=this.getRawFormatAt(this.dtView.getRangeIndex()),t=e.cls||"",i=t.indexOf(NODE_TYPE.FILLABLEFIELD)!=-1;return i},getLinkData:function(){var e=this.getRangeFormat(this.dtView.getRangeIndex());return e[ATTR_IMAGE.I_LINKDATA]},isLayoutChanged:function(){var e=this.getRangeFormat();if(!e)return!0;var t=DTUtils.convertJSONUnitTo({left:e.pl,right:e.pr,top:e.pt,bottom:e.pb},UNITS.PIXELS),i=(e.wid+e.wid_un).convertUnitTo(UNITS.PIXELS)-(t.left+t.right),n=(e.ht+e.ht_un).convertUnitTo(UNITS.PIXELS);return!(this.getWidth()==i&&this.getOuterHeight()==n&&ZWJSONUtils.compareJSON(this.getMargin(),t))},getFloatImageObject:function(){var e=this.getContainingPara();if(this.isFloating()&&e){var t=this.getRangeIndex()-e.getNodeStartIndex();return e.getFloatImageForIndex(t)}return null},getAbsLeft:function(e){if(this.getType()===e)return 0;var t=0;if(this.isFloating()){var i=this.getFloatImageObject();return i.getAbsLeft(e)}t+=this.documentLayoutManager.getLeftAtIndex(this.getRangeIndex());var n=this.getParent();return n&&(t+=n.getContentLeft(),n.getType()!==e&&(t+=n.getAbsLeft(e))),t},getAbsTop:function(e){if(this.getType()===e)return 0;var t=0;if(this.isFloating()){var i=this.getFloatImageObject();return i.getAbsTop(e)}var n=this.documentLayoutManager.getLineAtIndex(this.getRangeIndex());t+=n.getTop();var r=this.getParent();return r&&(t+=r.getContentTop(),r.getType()!==e&&(t+=r.getAbsTop(e))),t}}),e}(),NoteDocView=function(){"use strict";function e(e,t,i){SectionDocView.apply(this,arguments),this.page=i,this.containingParaReference={},this.referenceChar,this.oldHeight=0,this.create()}return e.prototype=Object.create(SectionDocView.prototype),e.prototype.constructor=e,extend(e.prototype,{getMargin:function(){var e=this.getPage();if(e){var t=e.getFirstSectionContainingNote(this.getSectionType());if(t)return t.getMargin()}return this.group.getMargin()},destroy:function(){this.oldHeight=0,this.containingParaReference={},this.referenceChar="",this.page=null,SectionDocView.prototype.destroy.apply(this,arguments)},getReferenceChar:function(){return this.getDTView().getReferenceChar()},setContainingParaReference:function(e,t){if(this.containingParaReference.view=e,this.containingParaReference.node=t,this.sectionType===SECTION_TYPES.FOOTNOTE&&this.getPage()){var i=e.getPage();i.isAnOutGoingFootNote(this.getNodeId())||this.getPage().getId()===i.getId()||i.moveSectionToPage(this)}this.create()},isPaginatableSection:function(){return this.sectionType==SECTION_TYPES.ENDNOTE},getContainingPara:function(){return this.containingParaReference.view},getRootSectionType:function(){return this.getDTView().getContainingSection().getSectionType()},getRootSection:function(){return this.getContainingPara()?this.getContainingPara().getSection():null},getRangeIndex:function(){return this.getDTView().getRangeIndex()},belongsToPara:function(e){return this.containingParaReference.node.getId()===e},updateTop:function(){this.top;return this.top=this.prev?this.prev.getTop()+this.prev.getHeight():0,this.top},handleSectionOpStart:function(){this.oldHeight=this.height},handleSectionOpComplete:function(){this.paginate(),this.oldHeight!==this.height&&(this.oldHeight=this.height,this.trigger(DOCVIEW.SECTION_HEIGHT_UPDATED,this),this.documentLayoutManager.triggerPagination())},refresh:function(){SectionDocView.prototype.refresh.call(this),this.handleSectionOpComplete()},getPaginationTop:function(){return this.getPage().getContentHeight()+this.getTop()},removeAllChildViews:function(e,t,i){var n=this.getHeight();this.isRemoveInProgress=!0,this.cleanSection(e,t,i),n!==this.getHeight()&&this.trigger(DOCVIEW.SECTION_HEIGHT_UPDATED,this),(i||this.isEligibleForRemove())&&(this.group.removePaginationInfo(this),this.group.removeDocSectionView(this)),this.isRemoveInProgress=!1},getPageTop:function(){var e=this.getTop(),t=this.getPage();return t&&(e+=this.getSectionType()===SECTION_TYPES.FOOTNOTE?t.getFootnoteTop():t.getEndnoteTop()),e},getAbsLeft:function(e){if(this.getType()===e)return 0;var t=this.getContainingPara().getSection(),i=this.getLeft();t&&(i+=t.getLeft());var n=this.getParent();return n&&(e&&e!==VIEW.PAGE?n.getType()!==e&&(i+=n.getAbsLeft(e)):i+=this.getPageLeft()),i}}),e}(),HFDocView=function(e,t,i){"use strict";function n(e,t){i.apply(this,arguments),this.create(),this.margin={},this.maxHeight=0,this.oldHeight=0,this.setProperties()}return n.prototype=Object.create(i.prototype),n.prototype.constructor=n,extend(n.prototype,{destroy:function(){this.oldHeight=0,this.margin={},this.maxHeight=0,i.prototype.destroy.apply(this,arguments)},initLayout:function(){i.prototype.initLayout.apply(this,arguments),this.updateProperties()},handleSectionOpStart:function(){this.oldHeight=this.height},handleSectionOpComplete:function(){this.paginate();var e=!1;if(this.oldHeight!==this.height&&(this.oldHeight=this.height,e=!0),this.propagateVia(this.documentLayoutManager,DOCVIEW.AFTER_HF_SECTION_BUILD_COMPLETE,this),this.trigger(DOCVIEW.AFTER_HF_SECTION_UPDATE,this),e){var t=this.getGroup().getFirstSection();t&&(t.addToPaginationQueue(t.getFirstColumn()),this.documentLayoutManager.triggerPagination())}},bindEvents:function(){i.prototype.bindEvents.call(this),this.group.on(DOCVIEW.SECTIONGROUP_LAYOUT_CHANGED,this.updateStyle,this)},unbindEvents:function(){i.prototype.unbindEvents.call(this),this.group.off(DOCVIEW.SECTIONGROUP_LAYOUT_CHANGED,this.updateStyle,this)},refresh:function(){i.prototype.refresh.call(this),this.handleSectionOpComplete()},isEmptyView:function(){for(var e=this.columns.first;e;){var t=e.getFirstChild();if(e.getChildViewCount()>1||t.getType()===VIEW.PARA&&!t.getNode().isEmpty())return!1;e=e.next}return!0},updateStyle:function(){this.updateProperties(),this.trigger(DOCVIEW.SECTION_PROPERTIES_CHANGED)},setProperties:function(){this.margin=this.group.getMargin(),this.maxHeight=.4*this.group.getPageHeight()},updateProperties:function(){this.maxHeight=.4*this.group.getPageHeight(),this.updateHeight()},getStyleInfo:function(e){var t=this.getMargin(),i=t.top+this.getGutterTop(),n=t.left+this.getGutterLeft(),r=t.right+this.getGutterRight();if(e&&e.isMirroredEvenPage()){var o=n;n=r,r=o}return{marginTop:i,marginLeft:n,marginBottom:this.margin.bottom,marginRight:r,maxHeight:this.maxHeight,height:this.getHeight()}},canDisplay:function(){return!this.isEmptyView()&&0!==this.getHeight()},isEligibleForRemove:function(){return this.isEmpty()},belongsToPage:function(e){return this.getHFType()===e.getHFType(this.getSectionType())},getPage:function(){var e=this.documentLayoutManager.getCurrentPage();return e&&e.containsSection(this)?e:this.getGroup().getFirstPageWithSection(this)}}),n}(Utils,LinkedList,SectionDocView),HeaderDocView=function(e){"use strict";function t(t,i){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,extend(t.prototype,{updateName:function(){var e=this.group.getHFType(),t=this.getFormats().hftype;t==CONST.HEADER_PRIMARY?2==e||3==e?this.name="header_odd":this.name="header":t==CONST.HEADER_EVEN?this.name="header_even":t==CONST.HEADER_FIRST&&(this.name="header_first")},computeMaxHeight:function(){var e=0,t=this.getMargin().top,i=this.getGutterTop();if(0===t&&this.isEmptyView())e=0;else{for(var n=this.getFirstColumn();n;)e<n.getHeight()&&(e=n.getHeight()),n=n.getNextView();e+=this.group.getHeaderTop(),e=Math.max(e,t+i)}return e},updateProperties:function(){this.headerTop=this.group.getHeaderTop(),this.margin=this.group.getMargin(),e.prototype.updateProperties.call(this)},getStyleInfo:function(t){var i=e.prototype.getStyleInfo.call(this,t),n=this.headerTop,r=this.group.getGutterTop();return this.isEmptyView()&&0===this.getMargin().top&&0==r&&(n=0),i.paddingTop=n,i.paddingBottom=0,i},getPageTop:function(){return 0},getHeaderTop:function(){return this.getGroup().getHeaderTop()},getContentTop:function(){return this.getHeaderTop()},getWatermarkData:function(){for(var e=this.getFirstColumn(),t=null;e;){if(t=e.getWatermarkData())return t;e=e.next}return t}}),t}(HFDocView),FooterDocView=function(e){"use strict";function t(t,i){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,extend(t.prototype,{updateName:function(){var e=this.group.getHFType(),t=this.getFormats().hftype;t==CONST.FOOTER_PRIMARY?2==e||3==e?this.name="footer_odd":this.name="footer":t==CONST.FOOTER_EVEN?this.name="footer_even":t==CONST.FOOTER_FIRST&&(this.name="footer_first")},computeMaxHeight:function(){var e=0,t=this.getMargin().bottom;if(0===t&&this.isEmptyView())e=0;else{for(var i=this.getFirstColumn();i;)e<i.getHeight()&&(e=i.getHeight()),i=i.getNextView();e+=this.group.getFooterBottom(),e=Math.max(e,t)}return e},updateProperties:function(){this.footerBottom=this.group.getFooterBottom(),this.margin=this.getMargin(),this.margin.bottom<this.footerBottom&&(this.footerBottom=0),e.prototype.updateProperties.call(this)},getStyleInfo:function(t){var i=e.prototype.getStyleInfo.call(this,t);return i.paddingTop=this.getPaddingTop(),i.paddingBottom=this.footerBottom,i},getPageTop:function(){var e=this.getGroup().getFirstPageWithSection(this),t=0;return e&&(t+=e.getHeaderHeight()+e.getPaginationHeight()),t},getFooterBottom:function(){return this.getGroup().getFooterBottom()},getContentTop:function(){return this.getHeight()-(this.getContentHeight()+this.getFooterBottom())},getPaddingTop:function(){var e=0,t=this.getPage();if(!t)return e;var i=this.getMargin().bottom,n=t.getDOMViewHeight(),r=this.getGroup().getHeaderTop(),o=this.footerBottom,a=t.getMinRenderingHeight(),s=this.getContentHeight()+o,l=t.getHeaderHeight(),d=Math.min(Math.max(s,i),n-(l+r+a));return e=d-s}}),t}(HFDocView),PDFLayoutManager=function(){"use strict";function e(){}return extend(e.prototype,{isContinuousLayout:function(){return!1},getPageDOMViewHeight:function(e){return e.group.getPageHeight()},getPageContentContainerHeight:function(e){var t=e.getPaginationHeight()-e.getNoteHeight(SECTION_TYPES.FOOTNOTE),i=e.getContentHeight();return t<i&&(t=i),t},createContentSection:function(e){var t,i,n=e.prev,r=e.next,o=this.getGroupFromDTView(n);e.isContinuousSection()?o?(i=o.getLastSection(),o.addContentSectionView(e),i&&i.shouldSectionsBalanced()&&i.addToPaginationQueue(i.getFirstColumn())):this.logger().error("No previous content dtview, but current dtview is continuous!!"):(t=this.createSectionGroup(o),t.addContentSectionView(e),r&&r.isContinuousSection()&&o&&o.getDocViews(r.getId()).length&&this.splitGroupAt(r))},getSectionGroupBorderInfo:function(e){var t=e.firstContentDTView;return!t||this.isFixedView()?null:t.getNode().getBorderProps()},getLayoutProps:function(e){var t=e.getLayoutProps(),i=t.headerTop,n=t.footerBottom,r=t.margin,o=t.gutter,a={width:t.pageDimensions.width,height:t.pageDimensions.height},s=this.getFirstGroup(),l=s.getPageWidth(),d=s.getPageHeight();return l&&(a.width=l),d&&(a.height=d),{headerTop:i,footerBottom:n,margin:r,gutter:o,pageDimensions:a,actualPageDimensions:t.pageDimensions}},initColumnLayout:function(e){var t=e.dtView.getColumnDetails();if(t&&t.count>1){var i=t.count,n=e.width,r=t.width||[],o=t.space||[],a=void 0===t.iseqwidth||t.iseqwidth,s=t.defaultspace&&t.defaultspace.convertor().pixels||DEFAULT_COLUMN_SPACE_WIDTH,l="1"===t.seperator?{width:"1px",type:"solid",color:"#ccc"}:{width:"0px",type:"solid",color:"#ccc"};if(n-=PAGE_BORDER_WIDTH,n-=(i-1)*s,a){r=[],o=[],n/=i;for(var d=0;d<i;d++)r.push(n),d!==i-1&&o.push(s)}else for(var d=0;d<i;d++)r[d]=r[d].convertor().pixels,d!==i-1&&(o[d]=o[d].convertor().pixels);return{count:i,space:o,width:r,isEqualWidth:a,defaultSpace:s,separator:t.seperator,separatorFormat:l}}return{count:1,space:[],width:[e.width],isEqualWidth:!0,defaultSpace:DEFAULT_COLUMN_SPACE_WIDTH,separator:"0",separatorFormat:{width:"0px",type:"solid",color:"#ccc"}}},computePageHeight:function(e){return e.group.getPageHeight()}}),e}(),PageLayoutManager=function(){"use strict";function e(){}return extend(e.prototype,{isContinuousLayout:function(){return!1},getPageDOMViewHeight:function(e){if(this.isFixedView()){var t=e.getNoteHeight(SECTION_TYPES.ENDNOTE)+e.getNoteHeight(SECTION_TYPES.FOOTNOTE)+e.getHeaderHeight()+e.getFooterHeight();return e===this.getLastPage()?t+e.getContentContainerHeight():t+e.getContentHeight()}return e.group.getPageHeight()},getPageContentContainerHeight:function(e){var t;if(this.isFixedView()&&e!==e.documentLayoutManager.getLastPage())t=e.getContentHeight()+e.getNoteHeight(SECTION_TYPES.ENDNOTE);else{t=e.getPaginationHeight()-e.getNoteHeight(SECTION_TYPES.FOOTNOTE);var i=e.getContentHeight();t<i&&(t=i>e.getPaginationHeight()?e.getPaginationHeight():i)}return t},createContentSection:function(e){var t,i=e.prev,n=e.next,r=this.getGroupFromDTView(i);if(e.isContinuousSection())if(r){var o=r.getLastSection()?r.getLastSection().getDTView():null;r.addContentSectionView(e);var a,s=r.getLastSection()?r.getLastSection().getDTView():null;if(o!==s){var l=r.getDocViews(o.getId());a=ZWArrayUtils.lastElementOf(l)}else a=null;a&&a.shouldSectionsBalanced()&&a.addToPaginationQueue(a.getFirstColumn())}else this.logger().error("No previous content dtview, but current dtview is continuous!!");else t=this.createSectionGroup(r),t.addContentSectionView(e),n&&n.isContinuousSection()&&r&&r.getDocViews(n.getId()).length&&this.splitGroupAt(n)},getSectionGroupBorderInfo:function(e){var t=e.firstContentDTView;return!t||this.isFixedView()?null:t.getNode().getBorderProps()},getLayoutProps:function(e){var t=e.getLayoutProps(),i=t.headerTop,n=t.footerBottom,r=t.margin,o=t.gutter,a=t.pageDimensions;return{headerTop:i,footerBottom:n,margin:r,gutter:o,pageDimensions:a,actualPageDimensions:t.pageDimensions}},initColumnLayout:function(e){var t=e.dtView.getColumnDetails();if(t&&t.count>1){var i=t.count,n=e.width,r=ZWJSONUtils.clone(t.width)||[],o=ZWJSONUtils.clone(t.space)||[],a=void 0===t.iseqwidth||t.iseqwidth,s=t.defaultspace&&t.defaultspace.convertor().pixels||DEFAULT_COLUMN_SPACE_WIDTH,l="1"===t.seperator?{width:"1px",type:"solid",color:"#ccc"}:{width:"0px",type:"solid",color:"#ccc"};if(n-=PAGE_BORDER_WIDTH,n-=(i-1)*s,a){r=[],o=[],n/=i;for(var d=0;d<i;d++)r.push(n),d!==i-1&&o.push(s)}else for(var d=0;d<i;d++)r[d]=r[d].convertor().pixels,d!==i-1&&(o[d]=o[d].convertor().pixels);return{count:i,space:o,width:r,isEqualWidth:a,defaultSpace:s,separator:t.seperator,separatorFormat:l}}return{count:1,space:[],width:[e.width],isEqualWidth:!0,defaultSpace:DEFAULT_COLUMN_SPACE_WIDTH,separator:"0",separatorFormat:{width:"0px",type:"solid",color:"#ccc"}}}}),e}(),WebLayoutManager=function(){"use strict";function e(){}return extend(e.prototype,{isContinuousLayout:function(){return!0},getPageDOMViewHeight:function(e){return e.getContentContainerHeight()+e.getHeaderHeight()+e.getFooterHeight()+e.getNoteHeight(SECTION_TYPES.FOOTNOTE)},getPageContentContainerHeight:function(e){var t=e.getContentHeight()+e.getNoteHeight(SECTION_TYPES.ENDNOTE),i=e.getGroup().getLayoutProps().actualPageDimensions.height,n=i-(e.getHeaderHeight()+e.getFooterHeight()+e.getNoteHeight(SECTION_TYPES.FOOTNOTE));return t<n&&(t=n),t},createContentSection:function(e){var t,i=e.prev;i&&(t=this.getGroupFromDTView(i)),t||(t=this.createSectionGroup()),t.addContentSectionView(e)},getSectionGroupBorderInfo:function(){return null},getLayoutProps:function(e){var t=e.getLayoutProps(),i=t.headerTop,n=t.footerBottom,r=t.margin,o=t.gutter,a={width:EditorView.width(),height:MAX_WEB_VIEW_RENDERING_HEIGHT};return o.value=0,{headerTop:i,footerBottom:n,margin:r,gutter:o,pageDimensions:a,actualPageDimensions:t.pageDimensions}},initColumnLayout:function(e){return{count:1,space:[],width:[e.width],isEqualWidth:!0,defaultSpace:DEFAULT_COLUMN_SPACE_WIDTH,separator:"0",separatorFormat:{width:"0px",type:"solid",color:"#ccc"}}}}),e}(),MAX_WEB_VIEW_RENDERING_HEIGHT=1e7,PublishLayoutManager=function(){"use strict";function e(){}return extend(e.prototype,{isContinuousLayout:function(){return!0},getPageDOMViewHeight:function(e){return e.getContentContainerHeight()+e.getHeaderHeight()+e.getFooterHeight()},getPageContentContainerHeight:function(e){var t=e.getContentHeight()+e.getNoteHeight(SECTION_TYPES.ENDNOTE),i=e.getGroup().getLayoutProps().actualPageDimensions.height,n=i-(e.getHeaderHeight()+e.getFooterHeight()+e.getNoteHeight(SECTION_TYPES.FOOTNOTE));return t<n&&(t=n),t},createContentSection:function(e){var t,i=e.prev;i&&(t=this.getGroupFromDTView(i)),t||(t=this.createSectionGroup()),t.addContentSectionView(e)},getSectionGroupBorderInfo:function(){return null},getLayoutProps:function(e){var t=e.getLayoutProps(),i=t.headerTop,n=t.footerBottom,r=t.margin,o=t.gutter,a={width:t.pageDimensions.width,height:t.pageDimensions.height};EditorView.getView()===EDITORVIEW_TYPE.WEB_VIEW&&(a.width=EditorView.width()),a.height=MAX_WEB_VIEW_RENDERING_HEIGHT;var o=t.gutter;return o.value=0,{headerTop:i,footerBottom:n,margin:r,gutter:o,pageDimensions:a,actualPageDimensions:t.pageDimensions}},initColumnLayout:function(e){return{count:1,space:[],width:[e.width],isEqualWidth:!0,defaultSpace:DEFAULT_COLUMN_SPACE_WIDTH,separator:"0",separatorFormat:{width:"0px",type:"solid",color:"#ccc"}}}}),e}(),Subline=function(){"use strict";function e(e,t,i){this.left=e||0,this.width=t||0,this.isFloating=i||!1,this.runningWidth=0,this.subBlocksList=new LinkedList}return extend(e.prototype,{addSubBlock:function(e,t){t?this.subBlocksList.insertAfter(e,t):this.subBlocksList.insertAsFirst(e),this.runningWidth+=e.width}}),e}(),LineSegment=function(){function e(e,t,i,n,r,o,a,s,l,d,c,u){e>t&&ZWLogger.log("LineSegment start > end :: start: "+e+", end: "+t),this.start=e,this.end=t,this.left=i,this.format=n||{},this.parent=r,this.isRTL=o||!1,this.width=a,this.content=s||"",this.computedFormat=DocUtil.copyStyle(l||{}),this.isSpaceSegment=d||!1,this.contentType=null,this.code=c||"",this.type=u||"",this.updateComputedFormats()}return extend(e.prototype,{updateComputedFormats:function(){this.updateTabComputedFormats(),this.updateCodeStyles(),this.updateLinkStyles(),this.updateSpaceSegmentStyles(),this.computedFormat&&this.computedFormat.hasOwnProperty(TCConstants.TC)&&ZWJSONUtils.mergeJsonObjs(this.computedFormat,TcViewUtil.getTcDomStyles(this.computedFormat)),this.computedFormat=DocUtil.copyStyle(this.computedFormat||{})},updateTabComputedFormats:function(){this.content===UNICODE.TAB&&(this.computedFormat.width=this.format.width,this.computedFormat.leader=this.format.leader)},_isTOCHeadingLink:function(){var e=this.parent.getParent();return!(!e||e.getType()!==VIEW.TOC)&&(this.format.url&&this.format.url.slice(0,4)===TOC_PREFIX)},updateCodeStyles:function(){var e=this.parent.getNode(),t=e.isCode();t&&!this.format[ATTR_TEXT.TS_FGC]&&(this.computedFormat[ATTR_TEXT.TS_FGC]=DTUtils.getCodeHighlightColor(e.getCodeTheme(),this.code))},updateLinkStyles:function(){var e=this.format.cls||"",t=e.indexOf(NODE_TYPE.LINK)!==-1;t&&!this._isTOCHeadingLink()&&(this.format.fgc||(this.computedFormat.fgc=LINK_DEFAULT.FGC),this.format.td||(this.computedFormat.td=LINK_DEFAULT.TD))},updateSpaceSegmentStyles:function(){this.isSpaceSegment&&this.computedFormat.bgc&&delete this.computedFormat.bgc},isContentTypeRTL:function(){return this.contentType===CONTENT_TYPE.RTL},getFirstChar:function(){return this.content[0]},getLastChar:function(){return ZWArrayUtils.lastElementOf(this.content)},isFirstCharNeutral:function(){return Utils.areNeutralCharacters(this.getFirstChar())},isLastCharNeutral:function(){return Utils.areNeutralCharacters(this.getLastChar())}}),e}(),LineBuilder=function(){"use strict";function e(e,t,i,n,r,o,a){this.view=e,this.dtView=this.view.getDTView(),this.start=t,this.end=-1,this.absStart=this.dtView.getIndex(),this.absEnd=this.dtView.getEndIndex(),this.top=i,this.width=r,this.left=n||0,this.blocks=this.dtView.getBlocks(),this.segments=this.dtView.getSegments(),this.lineSegments=[],this.imageSegments=[],this.floatImagesData=[],this.tabs=[],this.blockIndex=this.getBlockIndex(this.start),this.lineStyle=o,this.block=null,this.absIndex=null,this.char=null,this.format={},this.runningWidth=n||0,this.lineBlocks=[],this.spaceWidths=[],this.imagePaddingLeft=0,this.lineHeight=a.height||0,this.contentHeight=0,this.baseLine=a.baseLine||0,this.sublines=new LinkedList,this.subline=null,this.visualOrder=[],this.levels=[],this.sublineData={},this.fieldsInfo={},this.isFloatingBlocks=!1}return extend(e.prototype,{init:function(){for(this.checkAndSplitBlocks(),this.addSublineData(this.runningWidth,!1),this.updateBlock();this.block;){if(this.block.resetOriginalWidth(),this.updateIterationData(),this.char===UNICODE.TAB){var e=this.getTabProperties(this.runningWidth);this.block.updateWidth(e.width),this.addToTabs(e),this.format.width=this.block.width,this.format.leader=e.leader}else if(this.char===UNICODE.IMAGE){if(this.processImageChar(),this.view.isReflow)break;this.runningWidth+=this.adjustLastTabWidth()}else this.char===UNICODE.RANGE_START&&[NODE_TYPE.FILLABLEFIELD,NODE_TYPE.SIGNERFIELD,NODE_TYPE.MAILMERGEFIELD].contains(this.format.type)&&this.format[ATTR_IMAGE.I_WRAP_TYPE]?(this.processImageChar(),this.addSublineData(this.runningWidth,!0)):this.runningWidth+=this.adjustLastTabWidth();if(this.char===UNICODE.SPACE&&this.processSpaceChar(),this.adjustForFloatImages(),this.char===UNICODE.BR){this.addToLineBlocks(),this.setEnd(this.block.end);break}if(this.isOverFlowing()&&!this.isSpace(this.block)&&!this.isFloatingBlocks){if(this.isTrailingBlock(this.block))this.addToLineBlocks(),this.addTrailingBlocksToLineBlocks(),this.setEnd(this.block.end);else if(this.runningWidth<=this.left&&!this.imageSegments.length)this.processOverflow();else{var t=ZWArrayUtils.lastElementOf(this.imageSegments);t&&t.start===this.block.start&&this.imageSegments.pop(),this.setEnd(this.block.start)}break}this.addToLineBlocks();var i=this.block;this.updateBlock(),this.block||this.end!==-1||this.setEnd(i.end)}return this},addSublineData:function(e,t){this.sublineData[this.lineBlocks.length]={left:e,isFloating:t},this.isFloatingBlocks=t},processImageChar:function(){var e=!!this.format.wrapType,t=this.view;if(e&&!t.getFloatImageForFid(this.format.fid)){for(var i=t.getViews()||[],n=i.length-1;n>=0;n--){var r=i[n];if(r===t)break;var o=r.getFloatImageForFid(this.format.fid);o&&r.getSection().removeFloatImage(o)}var a=t.getNode().getFloatImageByIndex(this.block.start);t.getSection().createFloatImage(a,t),!DTUtils.isNonWrappingFloatImage(this.format)&&DocUtils.isInFloatImageArea(t.getFloatImageForIndex(a.index),t)&&(t.addToUpdateQueue(OP_TYPE.UPDATE,!0),t.isReflow=!0)}},processSpaceChar:function(){if(this.format.cls!==NODE_TYPE.FILLABLEFIELD)for(var e=this.block.width/(this.block.end-this.block.start),t=this.block.start;t<this.block.end;t++)this.spaceWidths.push(e)},adjustForFloatImages:function(e){if(!this.isFloatingBlocks){var t=this.view;if(t.getSection().getSectionType()!==SECTION_TYPES.TEXTBOX){var i,n=this.block.height,r=t.getPageFloatImages();if(r){for(var o=t.getColumn(),a=o.getLeft(),s=0;s<r.length;s++)if(i=r[s],i&&!i.isNonWrappingImage()&&i.getView()){var l,d,c=!0,u=i.getWidth(),g=i.getView();l=g.getId();i.getNodeId();for(d=t.getNextView();d;){if(d.getId()===l){c=!1;break}d=d.getNextView()}if(c){var h=i.getAbsLeft(),f={top:0,left:t.getAbsLeft(VIEW.PAGE)+this.runningWidth,bottom:n,right:this.block.getRenderWidth()},p=t.getLastNodeLine();p?f.top+=p.getHeight()+p.getAbsTop(VIEW.PAGE):f.top+=t.getAbsTop(VIEW.PAGE);var E=0;if(g!==this.view&&this.view.isAboveGivenView(g)&&(E=n),DocUtils.isInFloatImageArea(i,null,f,E)&&DocUtils.checkFloatImageAffectedViewHierarchy(i,t)){var T=h-t.getAbsLeft(),O=0;O=a<T?u:h+u-t.getAbsLeft(),T<0&&(T=0),this.addToFloatImagesData(i),i.addToAffectedNodes(t),!e&&this.runningWidth+this.block.getRenderWidth()>T&&(this.runningWidth&&this.runningWidth===this.imagePaddingLeft?(this.imagePaddingLeft=Math.max(this.imagePaddingLeft,T+O),this.runningWidth=this.imagePaddingLeft):T+O>=this.runningWidth&&(this.addOrUpdateImageSegments(O,T),this.runningWidth=T+O,this.addSublineData(this.runningWidth,!1)))}}}this.runningWidth<this.left&&(this.runningWidth=this.left)}}}},getTabProperties:function(e){var t,i,n,r,o,a=this.view,s=a.getSection(),l=s.getLeft(),d=a.getTabPoints(),c=this.lineStyle.ml||0,u=this.lineStyle.ti||0,g=(this.lineStyle.pl||0)-(u<0?u:0),h=l+c+(u+g)+e,f=0,p=0,E=0;if(0===a.nodeLines.length){var T=a.dtView.getListData();T&&!U.isEmpty(T)&&(E=T.listCharSize.width||0,h+=E)}for(r=0,o=d.length;r<o;r++){if(t=d[r].value,i=parseInt(d[r].align,10),p=d[r].style,t>h){f=t-h;var O=e+f>this.width;O&&e<this.width&&(f=this.width-e);break}if(r==o-1){var m=a.getSection().getNode().getDefaultTabWidth();f=m>0?m-h%m:0;break}}return n=dimension(f,0),n.align=i,n.leader=p,n},updateIterationData:function(){this.updateIndex(),this.updateChar(),this.updateFormat()},getBlockIndex:function(e){for(var t=this.blocks.length,i=0;i<t;i++)if(this.blocks[i].start===e)return i;return-1},getBlockAtIndex:function(e){for(var t=this.blocks.length,i=0;i<t;i++)if(this.blocks[i].start===e)return this.blocks[i];return null},getBlockInfoForIndex:function(e){for(var t,i=this.blocks.length,n=0;n<i;n++)if(t=this.blocks[n],e>=t.start&&e<t.end)return{block:t,blockIndex:n};return null},updateBlock:function(){this.block=this.blocks[this.blockIndex++]},addToTabs:function(e){this.tabs.push({align:e.align,block:this.block,index:this.block.start,width:e.width})},updateTabWidth:function(e){for(var t=0;t<this.tabs.length;t++)if(this.tabs[t].block===e){this.tabs[t].width=e.width;break}},adjustLastTabWidth:function(){var e=this.block.getRenderWidth(),t=ZWArrayUtils.lastElementOf(this.tabs);if(!t)return 0;var i=this.absStart,n=0,r=this.lineBlocks.length,o=t.block,a=(o.subBlocks[0],t.width);if((1==t.align||2==t.align)&&t.width>0)for(n=0;n<r;n++)if(this.lineBlocks[n]===t.block){n++;break}t.width-=1==t.align?e/2:0,t.width-=2==t.align?e:0,t.width=t.width<0?0:t.width,o&&(o.width=t.width);var s=editor.doc.getRawFormatAt(t.index+i)||{};return s.width=t.width,editor.doc.setFormatAt(t.index+i,s),t.width-a},getDeltaLeftAfterTab:function(e,t){var i=Math.min(e.width,t);return 1==e.align?-Math.min(i,t/2):2==e.align?-i:0},updateIndex:function(){this.absIndex=this.block.start+this.absStart},updateChar:function(){this.char=this.dtView.getCharAt(this.absIndex)},updateFormat:function(){this.format=this.dtView.getRawFormatAt(this.absIndex)||{}},isSpace:function(e){return 0===e.content.trim().length&&!this.isFillableField()&&e.type!=BLOCK_TYPE.EOP},isFillableField:function(){return this.format[ATTR_COMMON.CLS]===NODE_TYPE.FILLABLEFIELD},isOverFlowing:function(){return this.runningWidth+this.block.getRenderWidth()>this.width},getRemainingWidth:function(){return this.width-this.runningWidth},processOverflow:function(){this.char===UNICODE.IMAGE||this.char===UNICODE.TAB?this.runningWidth<=this.left?(this.addToLineBlocks(),this.addTrailingBlocksToLineBlocks(),this.setEnd(this.block.end)):this.setEnd(this.block.start):this.runningWidth>this.left?this.setEnd(this.block.start):this.processOverFlowingBlock()},processOverFlowingBlock:function(){var e=this.block,t=this.width-this.runningWidth;if(e.start+1===e.end||e.type===BLOCK_TYPE.EOP)this.addToLineBlocks(),this.setEnd(this.block.end);else{var i,n=!1,r=this.dtView.getVisualOrder(e.start,e.end);e.visualOrder=r;for(var o=e.start+1;o<=e.end;o++)if(o===e.end?(n=!0,i=o-1):(n=!1,i=o),e.getWidthBetweenIndex(r[0],r[i-e.start],n)>t){var a=null;e.start===i-1?this.isLineBlockEmpty()&&!this.imageSegments.length?(a=this.splitBlock(e,i),this.addToLineBlocks(),this.setEnd(this.block.end)):this.setEnd(this.block.start):(a=this.splitBlock(e,--i),this.addToLineBlocks(),this.setEnd(this.block.end)),e.visualOrder=[],a&&(a.visualOrder=[]);break}this.end===-1&&(this.addToLineBlocks(),this.setEnd(this.block.end))}},splitBlock:function(e,t){var i=e.content.slice(t-e.start,e.end-e.start),n=e.computeDimensionsBetweenIndex(t,e.end-1,!0),r=e.findClosestFormatInfo(t),o=e.spliceAllFormatsInfoAfterIndex(t),a=o.fontStringObj,s=o.formats;s["#"+t+"#"]||(s["#"+t+"#"]=r.format,a["#"+t+"#"]=r.fontStringObj);var l=e.types.splice(t),d=new LineBlock(t,e.end,i,n.width,n.height,n.baseLine,a,{},e.displayStyle,e.isSpecialBlock,!0,e.type,e.isNonEditable,e.renderingFormat,l,e.parent);e.end=t,e.content=e.content.slice(0,t-e.start),n=e.computeDimensionsBetweenIndex(e.start,t),e.width=n.width,e.originalWidth=e.width,e.height=n.height,e.baseLine=n.baseLine,d.formats=s,d.levels=e.levels.splice(t),this.splitVisualOrder(e,d),this.splitSubBlocks(e,d);var c=this.blocks.indexOf(e);return this.blocks.splice(c+1,0,d),d},splitVisualOrder:function(e,t){var i=e.visualOrder;t.visualOrder=t.visualOrder.concat(i.splice(e.end-e.start))},splitSubBlocks:function(e,t){for(var i=e.getSubBlocks(),n=0,r=i[n];r;){if(r.end<=e.end)n++;else if(r.start>e.end)e.moveSubBlock(r,t);else{var o=t.start,a=r.end,s=new SubBlock(o,a,[],t,r.direction);r.end=e.end,this.splitVisualOrder(r,s),t.addToSubBlocks(s),r.computeWidth(),s.computeWidth(),n++}r=i[n]}},addToLineBlocks:function(){this.lineBlocks.push(this.block),this.block.getRenderHeight()>this.lineHeight&&(this.lineHeight=this.block.getRenderHeight(),this.baseLine=this.block.baseLine),this.isFloatingBlocks||(this.runningWidth+=this.block.getRenderWidth())},processLineBlocks:function(){for(var e,t=0;t<this.lineBlocks.length;t++){if(e=this.sublineData[t]){var i=0;this.view.isRTLPara()&&this.runningWidth>this.view.getContentWidth()&&(i=this.view.getContentWidth()-this.runningWidth),this.createNewSubLine(e.left+i,e.isFloating)}this.processSubBlocks(this.lineBlocks[t])}},processSubBlocks:function(e){for(var t,i=e.subBlocks,n=this.getCurrentSubLine(),r=0;r<i.length;r++){t=i[r];var o=this.findPreviousSubBlock(t,n);this.addSubBlockToSubLine(t,o),this.updateSubBlocksLeft(t)}},findPreviousSubBlock:function(e,t){for(var i=t.subBlocksList,n=this.visualOrder,r=i.first,o=null,a=n.indexOf(e.visualOrder[0]);r&&!(n.indexOf(r.start)>a);)o=r,r=r.next;return o},updateSubBlocksLeft:function(e){for(var t=e.prev,i=t?t.left+t.width:0;e;)e.left=i,i+=e.width,e=e.next},createNewSubLine:function(e,t){var i=e,n=this.getCurrentSubLine();n&&(n.width=e-n.left,i-=n.left+n.runningWidth);var r=new Subline(i,0,t);this.sublines.append(r),this.updateCurrentSubLine(r)},getCurrentSubLine:function(){return this.subline},updateSublineWidth:function(e){this.subline&&(this.subline.width=e)},addSubBlockToSubLine:function(e,t){var i=this.getCurrentSubLine();i.addSubBlock(e,t)},updateCurrentSubLine:function(e){this.subline=e},isLineBlockEmpty:function(){return 0===this.lineBlocks.length},isEOPBlockPresent:function(){for(var e=this.lineBlocks,t=e.length-1;t>=0;t--)if(e[t].type===BLOCK_TYPE.EOP)return!0;return!1},isTrailingBlock:function(e){var t=e.type;return t!==UNICODE.TAB&&(!!(0===e.getRenderWidth()||this.isOverFlowing()&&this.isSpace(e))||void 0)},addTrailingBlocksToLineBlocks:function(){if(this.block.type!==BLOCK_TYPE.EOP)for(var e=this.getBlockAtIndex(this.block.end);e&&this.isTrailingBlock(e);){if(this.updateBlock(),this.addToLineBlocks(),this.block.type===BLOCK_TYPE.EOP)return;e=this.getBlockAtIndex(this.block.end)}},addToFloatImagesData:function(e){for(var t=!1,i=0;i<this.floatImagesData.length;i++)if(this.floatImagesData[i].index===e.index){t=!0;break}t||this.floatImagesData.push({left:e.getPageOffset().left,width:e.getWidth(),index:e.index})},addOrUpdateImageSegments:function(e,t){var i=ZWArrayUtils.lastElementOf(this.imageSegments);i&&i.start==this.block.start?i.left+=e+(t-this.runningWidth):this.imageSegments.push({start:this.block.start,left:t+e-this.runningWidth})},setEnd:function(e){this.end=e},addSegments:function(){for(var e=this.segments,t=this.imageSegments,i=0;i<t.length;i++)for(var n=t[i].start,r=0;r<e.length;r++){var o=e[r];if("EOP"===o.type&&o.end>=n){o.left=t[i].left;break}if(o.end>n){var a=o.content.slice(n-o.start,o.end),s=new DTSegment(n,o.end,o.isRTL,o.format,a,DocUtil.copyStyle(o.computedFormat),o.type);s.left=t[i].left,e.splice(r+1,0,s),o.end=n,o.content=o.content.slice(0,n-o.start);break}}for(var i=e.length-1;i>=0;i--)e[i].start===e[i].end&&"EOP"!==e[i].type&&e.splice(i,1);for(var i=0;i<e.length&&(o=e[i],!(o.start>this.end));i++)if(!(o.start<this.start&&o.end<=this.start))if("EOP"===o.type&&this.isEOPBlockPresent())this.lineSegments.push(new LineSegment(o.start,o.end,o.left,o.format,this.view,o.isRTL,o.width,"",o.computedFormat,o.isSpaceSegment,"",o.type)),o.left=void 0;else if(o.start<this.end){var l=Math.max(o.start,this.start),d=Math.min(o.end,this.end),a=o.content.slice(l-o.start,o.content.length-(o.end-d)),s=new LineSegment(l,d,o.left,o.format,this.view,o.isRTL,o.width,a,o.computedFormat,o.isSpaceSegment,"",o.type);this.lineSegments.push(s),o.left=void 0,this.cacheFieldsInLine(s)}},cacheFieldsInLine:function(e){var t,i,n=e.format,r=this.fieldsInfo;e.content==UNICODE.RANGE_START?(t=n.id,r.hasOwnProperty(t)||(i={},i.start=e.start,i.type=n.type,r[t]=i),e.end==this.end&&(i=r[t],i.end=e.end)):e.content==UNICODE.RANGE_END?(t=n.id,r.hasOwnProperty(t)?(i=r[t],i.end=e.end):(i={},i.start=e.start,i.end=e.end,i.type=n.type,r[t]=i)):(t=n.fieldinfo||"",t&&(r.hasOwnProperty(t)||(i={},i.start=e.start,i.type=n.cls,r[t]=i),e.end==this.end&&(i=r[t],i.end=e.end)))},setLineHeight:function(){var e,t,i,n=this.view,r=n.getParaStyles().textFormat,o=FontUtils.getFontString(n.getParaProperties().textFormat||{},r),a=DocUtil.mergeObjs([r,n.getNode().getParaProperties().textFormat||{}]);a&&a.size&&(a.size=parseFloat(a.size));var s=this.lineHeight||(isV8Engine?getTextMetrics(" ",a).height:FontUtils.getCharSize(" ",o).height)||20,l=0;if(this.dtView.isList()){var d=this.dtView.getListData();d&&(l=d.listCharSize.height)}var c=0,u=n.getLineIndex();for(e=0,t=n.dtView.getViewProperties().inlineImages.length;e<t;e+=1)i=n.dtView.getViewProperties().inlineImages[e],i.index>=u&&i.index<this.end&&(c=Math.max(c,i.height));if(isV8Engine)if(0!=c){var g=s-this.baseLine;this.lineHeight=g*n.getParaProperties().lineHeight+Math.max(s,c,l),this.baseLine=Math.max(c,this.baseLine)}else this.lineHeight=n.getParaProperties().lineHeight*s;else this.lineHeight=s*(n.getParaProperties().lineHeight-1)+Math.max(s,c,l);if(this.contentHeight=Math.max(s,c),n.getParaStyles()[ATTR_PARAGRAPH.PS_LINE_RULE]){var h=n.getParaStyles()[ATTR_PARAGRAPH.PS_LINE_RULE],f=(n.getParaStyles()[ATTR_PARAGRAPH.PS_LS]+"pt").convertor().pixels;"exact"==h?this.lineHeight=f:"atLeast"==h&&this.lineHeight<f&&(this.lineHeight=f)}},splitVisualOrderInsideBlocks:function(){for(var e=this.visualOrder,t=this.levels,i=0;i<e.length;i++)for(var n,r=e[i],o=this.lineBlocks,a=0;a<o.length;a++)if(n=o[a],n.start===n.end&&r===n.start||r>=n.start&&r<n.end){n.getVisualOrder().push(r),n.getLevels().push(t[i]);break}},buildSubBlocks:function(){for(var e=this.lineBlocks,t=e.length,i=0;i<t;i++)e[i].computeSubBlocks()},resetBlockVisualOrderAndSubBlocks:function(){for(var e=0;e<this.lineBlocks.length;e++)this.lineBlocks[e].resetVisualOrderAndSubBlocks()},build:function(){this.resetBlockVisualOrderAndSubBlocks();var e,t=this.start,i=ZWArrayUtils.lastElementOf(this.lineBlocks);e=this.end!==-1&&(this.absStart+this.end!==this.absEnd||i&&i.type===BLOCK_TYPE.BR)?this.end:this.end+1,this.visualOrder=this.dtView.getVisualOrder(t,e),this.levels=this.dtView.getLevels(t,e),this.splitVisualOrderInsideBlocks(),this.buildSubBlocks(),this.processLineBlocks(),this.updateSublineWidth(this.runningWidth),this.setLineHeight(),this.addSegments();var n={};this.dtView.isList()&&(n=this.dtView.getListData());var r={id:Utils.randomId("line"),type:"line",start:this.start,end:this.end,height:Math.round(this.lineHeight)||1,outerHeight:Math.round(this.lineHeight)||1,contentHeight:Math.round(this.contentHeight)||1,style:this.lineStyle,remainingWidth:this.getRemainingWidth()<0?0:this.getRemainingWidth(),origRemainingWidth:this.getRemainingWidth(),listWidth:n.listCharSize?n.listCharSize.width:0,listRight:n.listRight||0,width:this.runningWidth,left:0,floatImagesData:this.floatImagesData,align:this.view.getParaProperties().align,segments:this.lineSegments,imageSegments:this.imageSegments,blocks:this.lineBlocks,length:this.absEnd-this.absStart,parent:this.view.getNode(),view:this.view,section:this.view.getSection(),imagePaddingLeft:this.imagePaddingLeft||0,renderedSpaceWidths:[],spaceWidths:this.spaceWidths||[],commentEnds:[],autoField:!1,isPageAutoField:!1,bookMarks:[],footnote:[],endnote:[],textbox:[],tabs:this.tabs,baseLine:this.baseLine||0,top:0,footNoteHeight:0,sublines:this.sublines,fieldsInfo:this.fieldsInfo,visualOrder:this.visualOrder,levels:this.levels},o=new LineDocView(r);return defineLineProperties(o),o.updateCachedContent(),o.addTrailingSpacesToRemWidth(),o.adjustBlocksWidth(),o.updateVisualOrderAndLevels(),o.adjustLineCodeSegments(),o.updateSpaceSegments(),o.splitAndArrangeSegments(),o},checkAndSplitBlocks:function(){if(this.blockIndex===-1){var e=this.getBlockInfoForIndex(this.start);if(e){var t=e.block,i=t.getAbsStart(),n=t.getAbsEnd();t.visualOrder=this.dtView.getVisualOrder(i,n),t.levels=this.dtView.getLevels(i,n),this.splitBlock(t,this.start),this.blockIndex=e.blockIndex,this.updateBlock(),t.levels=[],t.visualOrder=[]}}}}),e}(),ParaDocView=function(){"use strict";function e(e,t,i,n){BaseParaDocView.apply(this,arguments),this.getDTView().isList()?this.getDTView().addListData(this):this.getDTView().removeListData(),this.updateProperties()}var t=function(e){for(var t=0;t<e.length;t++)e[t].destroy()};return e.prototype=Object.create(BaseParaDocView.prototype),e.prototype.constructor=e,extend(e.prototype,{createDocView:function(e){e=e||{},this.updateProperties();var i=this.getPrevView();i&&!i.getSection().isInUpdateQueue(i)&&i.updateLayoutAndDesign();var n=this.cloneNodeLines();this.buildLines(),this.updateNodeLineStatus(n,e.forceReRender),t(n),this.updateLayoutAndDesign(!0),this.updateSectionAllowedHeight(),this.publishNodeLineEvents();var r=this.getDTView(),o=r.isEndIndex(this.getEnd());if(o){var a=r.hasPageBreakBefore()||this.getSection().isOverFlowing();if(a){var s=this.getParent();if(s.getType()===VIEW.CELL){var l=s.getRow();l.isAllCellViewsBuiltInRow()||(a=!1)}}return a}return!o}}),e}(),HrDocView=function(){"use strict";function e(e,t,i,n){DocView.apply(this,arguments),this.drawInfo={}}return e.prototype=Object.create(DocView.prototype),e.prototype.constructor=e,extend(e.prototype,{createDocView:function(){return this.updateProperties(),this.isBreaks()},updateDocView:function(){return this.updateProperties(),this.isBreaks()},getMinRenderingHeight:function(){var e=this.getSection().getMaxRenderingHeight();return this.isBreaks()?this.getParent().getType()===VIEW.CELL?0:e:this.getHeight()},removeAllChildViews:function(e,t){this.removeView(e,t)},updateProperties:function(){this.setViewTop(),this.setHeight(),this.updateWidth(),this.updateLeft(),this.drawInfo=isV8Engine?DrawInfoManager.getHRRectArray(this):{}},setHeight:function(e){null!=e?this.height=e:this.height=this.getDTView().getHeight()},updateWidth:function(){var e=this.getNode().getFormats();this.width=e.wid?e.wid:this.getParent().getWidth()},updateLeft:function(){var e=this.getNode().getFormats(),t=e[ATTR_HR.HR_AL],i=this.parent.width,n=i-this.width;0==t?this.left=0:1==t?this.left=n/2:2==t&&(this.left=n)},split:function(e,t,i,n){var r,o=this.getDTView();r=n&&n.parent?n.parent:this.findParentDocViewInColumn(t);var a=r.getSection();if(!this.isPageBreak()&&this.getHeight()>e){var s=a.addToSectionView(o,a,t,r);this.setHeight(0)}else for(var l,d=this.getNextView();d;)l=d.getNextView(),t.moveView(d,i),d=l;return s},refresh:function(){this.addToUpdateQueue(OP_TYPE.UPDATE)},isBalanced:function(){return!0},isPendingToBuild:function(){return this.getSection().isInUpdateQueue(this)},isEligibleForRemove:function(){return 0===this.getHeight()&&DocView.prototype.isEligibleForRemove.call(this)},getNodesBetweenRange:function(){return[]},isBreaks:function(){return this.getDTView().isBreaks()},isPageBreak:function(){return this.getDTView().isPageBreak()},isColumnBreak:function(){return this.getDTView().isColumnBreak()},destroy:function(){this.drawInfo=null,DocView.prototype.destroy.call(this)},hasInnerTable:function(){return!1},isNextViewAllowed:function(){return!this.isBreaks()}}),e}(),DocViews,FloatImage;!function(){"use strict";DocViews={para:ParaDocView,cell:CellDocView,row:RowDocView,table:TableDocView,hr:HrDocView,toc:TocDocView,textbox:TextBoxDocView,endnote:NoteDocView,footnote:NoteDocView,content:ContentDocView,header:HeaderDocView,footer:FooterDocView},FloatImage={textbox:TextBoxFloatObject,image:FloatImage}}();var DomView=function(){"use strict";function e(e,t){this.docView=e,this.domViewManager=t,this.el,this.create(),this.setDomProps(),this.bindEvents()}return BaseEventHandler.call(e.prototype),extend(e.prototype,{create:function(){},setDomProps:function(){this.el&&(this.el.setAttribute("doc-id",this.docView.getId()),this.el.setAttribute("node-id",this.docView.getNodeId()))},destroy:function(){this.unbindEvents(),this.el=null,this.docView=null,this.domViewManager=null},bindEvents:function(){},unbindEvents:function(){},update:function(){},updateStyle:function(){},remove:function(){this.el.remove()},getDocView:function(){return this.docView},getDocId:function(){return this.docView.getId()},getType:function(){return this.docView.getType()},getPrevEl:function(){var e=null,t=this.docView.getPrevView();return t&&t.getParent().getId()===this.docView.getParent().getId()&&(e=this.domViewManager.getDOMElem(t)),e},addViewToDOM:function(){var e=this.docView.getParent(),t=this.domViewManager.getDOMObj(e),i=this.getPrevEl();t.appendChildElem(this.el,i)},appendChildElem:function(e,t){var i=this.getContentContainer(),n=i.firstChild;t&&(n=t.nextSibling),i.insertBefore(e,n)},getContentContainer:function(){return this.el},getDocLayoutManager:function(){return this.domViewManager.documentLayoutManager},getPageDOM:function(){var e=this.docView.getPage();return this.domViewManager.getDOMObj(e)}}),e}(),ColumnDomView=function(){"use strict";function e(e,t){this.wrapper=null,DomView.apply(this,arguments)}return e.prototype=Object.create(DomView.prototype),e.prototype.constructor=e,extend(e.prototype,{create:function(){var e=document.createElement("div");e.className="zw-column-container";var t=document.createElement("div");t.className="zw-column",e.appendChild(t),this.wrapper=e,this.el=t,this.updateStyle()},remove:function(){this.wrapper.remove()},setDomProps:function(){this.el&&this.el.setAttribute("doc-id",this.docView.getId())},destroy:function(){DomView.prototype.destroy.apply(this,arguments),this.wrapper=null},update:function(){this.updateStyle()},updateStyle:function(){var e=this.docView.getSection(),t=e.getWidth(),i=this.docView.getLeft(),n=this.docView.getWidth(),r=this.docView.getPrevView(),o=this.docView.getSeparatorFormat(),a=this.docView.getSpacing(),s={overflow:i+n>t?"hidden":"",display:i>t?"none":"block",marginLeft:(i-(r&&r.getLeft()+r.getWidth()||0))/2+"px",borderLeft:o.width+" "+o.type+" "+o.color,width:(i+n>t?n-(i+n-t):n+a/2)+"px",float:"left",height:e.getMaxContentHeight()+"px"};J(this.wrapper).css(s);var l={marginLeft:(i-(r&&r.getLeft()+r.getWidth()||0))/2+"px",width:n+"px"};J(this.el).css(l)}}),e}(),TableDomView=function(){"use strict";function e(e,t){this.clonedRow=null,this.container=null,DomView.apply(this,arguments)}return e.prototype=Object.create(DomView.prototype),e.prototype.constructor=e,extend(e.prototype,{create:function(){this.clonedRow=null,this.el=document.createElement("table"),this.el.className="zw-table";var e=document.createElement("colgroup");this.el.appendChild(e),this.updateStyle();var t=document.createElement("tbody");t.className="zw-tbody",t.style.verticalAlign="top",this.el.appendChild(t),this.container=t;var i=this.docView.getThemeStyleFormat();if(TableThemeCSSGenerator.setStyleTag(i,this.docView.getNode()),editor.getRole().permissions.can("document.edit")&&DomUtil.bindTableEvents(this.el),this.docView.rowStart>0&&this.updateHeaderRow(this.docView.getHeaderRow()),this.updateDummyRowDetails(),this.getDocLayoutManager().isEmbedMode()){var n=DocLayoutManager.getRenderingFormat(this.docView.getNodeStartIndex(),NODE_TYPE.TABLE,this);n&&n.name&&(this.el.setAttribute("data-table-fmt",JSON.stringify(n)),this.el.setAttribute("data-table-name",n.name),this.el.setAttribute("data-id",n.id));for(var r=this.docView.cols,o=0;o<r.length;o++)if(r[o].mminfo){this.el.setAttribute("data-fmt",JSON.stringify(r[o])),this.el.setAttribute("data-id",this.docView.id),this.el.setAttribute("column-num",o);break}}},destroy:function(){DomView.prototype.destroy.apply(this,arguments),this.clonedRow=null,this.container=null},update:function(){var e=this.docView.getNode(),t=this.docView.getThemeStyleFormat();J(this.el).removeAttr("style"),t[ATTR_TABLE.TBLS_WID]=this.docView.getWidth()+"px",TableThemeCSSGenerator.setStyleTag(t,e),this.updateStyle(),this.docView.rowStart>0&&this.updateHeaderRow(this.docView.getHeaderRow()),this.updateDummyRowDetails()},updateStyle:function(){try{var e=this.docView.getThemeStyleFormat();if(!e||!this.el)return;var t=this.docView.getNode(),i=this.el.querySelector("colgroup"),n=t.cols,r=t.isTableColsWidthInPercentage(),o="",a=0;if(n){J(i).empty();for(var s=0;s<n.length;s++){var l=document.createElement("col");r?l.style.width=n[s].wt:(a=Conversions.toGlobalUnit(n[s].wt).toFixed(2),0==a&&(a="1px".convertUnitTo(Conversions.globalUnit).toFixed(2)),l.style.width=a+Conversions.globalUnit),i.appendChild(l)}}var d=this.el.style;for(var c in e)if(e.hasOwnProperty(c)&&"type"!=c&&(o=e[c],null!=o))switch(c){case ATTR_TABLE.TBLS_AL:d.marginLeft=this.docView.left+"px";break;case ATTR_TABLE.TBLS_ML:e[ATTR_TABLE.TBLS_AL]&&"left"!=e[ATTR_TABLE.TBLS_AL]||(d.marginLeft=o);break;case"z_tbl_bgc":d.background=o;break;case ATTR_TABLE.TBLS_CP:this.el.setAttribute("cellspacing",o);break;case ATTR_TABLE.TBLS_WID:d.width=o;break;case ATTR_TABLE.TBLS_BGIMG:o=DomUtil.processImgSrc(o),d.background="transparent  url("+o+") 50%",d.backgroundSize="100%";break;case ATTR_TABLE.TBLS_DIR:var u=e[ATTR_TABLE.TBLS_DIR]||PARA_DIR.LTR;d.direction=u;break;case ATTR_COMMON.CLS:var g=table.getAttribute("class");this.el.setAttribute("class",g+" "+o)}(e[ATTR_TABLE.TBLS_ML]||e[ATTR_TABLE.TBLS_AL])&&PubSub.publish("Table/marginChanged")}catch(e){}},appendChildElem:function(e,t){var i,n=this.getContentContainer();if(t)i=t.nextSibling;else{for(var r=n.firstChild;r&&(r.className.indexOf("dummyRowClass")!==-1||r.className.indexOf("tbl-header-row")!=-1);)r=r.nextSibling;i=r}n.insertBefore(e,i)},afterViewBuild:function(){this.update()},removeHeaderRow:function(){this.clonedRow&&this.clonedRow.remove()},updateHeaderRow:function(e){this.removeHeaderRow(),this.addHeaderRow(e)},addHeaderRow:function(e){var t=this.domViewManager.getDOMObj(e);t&&(this.clonedRow=t.el.cloneNode(!0),this.clonedRow.classList.add("ui-state-disabled"),this.clonedRow.classList.add("tbl-header-row"),this.container.firstChild?this.container.insertBefore(this.clonedRow,this.container.firstChild):this.container.appendChild(this.clonedRow))},addDummyRowDOM:function(){var e=document.createElement("tr"),t=document.createElement("td");e.appendChild(t),e.style.display="none",e.className="dummyRowClass";var i=J(this.container),n=i.children(),r=n&&n[0];r&&r.className.indexOf("ui-state-disabled")!=-1?J(e).insertAfter(r):i.prepend(e)},applyDummyTopBorder:function(){if(this.docView.getNode().theme.themeObj&&this.docView.isSplitTable&&this.docView.getFirstChild()&&this.docView.getFirstChild().containsSplittedFc){for(var e,t=DTTableUtils.getTableTopBorder(this.docView.getNode().theme.themeObj),i=this.docView.getFirstChild();i;){var n=this.domViewManager.getDOMElem(i);if(n&&!i.containsSplittedFc&&!i.isEmpty()){e=i;break}i=i.next}if(e&&!e.isEmpty())for(var r,o=e.getFirstChild();o;){if(r=o.getNode().getBorderStyle(),!r||!r["border-top"]){var a=this.domViewManager.getDOMObj(o);a&&(a.el.style.borderTop=t)}o=o.next}}},addDummyRows:function(){0!==this.docView.rowStart&&(this.docView.getNode().theme&&this.docView.getNode().theme.themeObj.firstRow?(this.docView.shouldIncludeHeaderRow()||this.addDummyRowDOM(),this.docView.rowStart%2===0&&this.addDummyRowDOM()):this.docView.shouldIncludeHeaderRow()?this.docView.rowStart%2===0&&this.addDummyRowDOM():this.docView.shouldIncludeHeaderRow()||this.docView.rowStart%2!==0&&this.addDummyRowDOM()),this.applyDummyTopBorder()},removeDummyTopBorder:function(){var e,t=this.docView.getFirstChild();if(t){for(;t;){if(t.containsDummyTopBorder){e=t;break}t=t.next}if(e&&!e.isEmpty())for(var i,n=e.getFirstChild();n;){if(i=n.getNode().getBorderStyle(),!i||!i["border-top"]){var r=this.domViewManager.getDOMObj(n);r&&(r.el.style.borderTop="")}n=n.next}}},removeAllDummyRow:function(){J(this.el).children("tbody").children(".dummyRowClass").remove(),this.removeDummyTopBorder()},updateDummyRowDetails:function(){this.removeAllDummyRow(),this.addDummyRows()},getContentContainer:function(){return this.container},adjustBorder:function(){var e=this.el;J(e).css({"border-collapse":""}),setTimeout(function(){J(e).css({"border-collapse":"collapse"})},10)}}),e}(),RowDomView=function(){"use strict";function e(e,t){DomView.apply(this,arguments)}return e.prototype=Object.create(DomView.prototype),e.prototype.constructor=e,extend(e.prototype,{create:function(){if(this.el=document.createElement("tr"),this.update(),this.getDocLayoutManager().isEmbedMode()){var e=DocLayoutManager.getRenderingFormat(this.docView.getNodeStartIndex(),NODE_TYPE.ROW,this);e&&(e.mminfo||"conditional_if_start"==e.ftype||e.format&&e.format.sortinfo)&&(this.el.setAttribute("data-fmt",JSON.stringify(e)),this.el.setAttribute("data-id",e.id))}},update:function(){this.el.removeAttribute("style"),this.el.className="zw-tr",this.updateStyle()},updateStyle:function(){try{var e=this.docView.getThemeStyleFormat();if(!e||!this.el)return;var t=J(this.el);e&&e.hasOwnProperty(TCConstants.TC)&&(e=TcView.updateDOMStyles(e));var i="",n=DomUtil.getBorderStyles(e),r={};for(var o in e)if(e.hasOwnProperty(o)&&"type"!=o)switch(i=e[o],o){case ATTR_ROW.TRS_HT:break;case ATTR_ROW.TRS_BGC:n.backgroundColor=i;break;case"z_tr_bgc":r.backgroundColor=i}e.hasOwnProperty(ATTR_COMMON.CLS)&&t.addClass(e[ATTR_COMMON.CLS])}catch(e){}if(!jQuery.isEmptyObject(r)){var a=t.find("td");a.css(r)}jQuery.isEmptyObject(n)||t.css(n)},getPrevEl:function(){var e=null,t=this.docView.getPrevView();if(t){for(;t&&t.isExcessDom;)t=t.prev;t&&t.getParent().getId()===this.docView.getParent().getId()&&(e=this.domViewManager.getDOMElem(t))}return e},updateAllCellElHeightAsZero:function(){for(var e=this.docView.getFirstChild();e;){var t=this.domViewManager.getDOMObj(e);t&&t.el&&t.updateHeight(),e=e.next}},afterViewBuild:function(){this.update()}}),e}(),CellDomView=function(){"use strict";function e(e,t){this.container=null,DomView.apply(this,arguments)}return e.prototype=Object.create(DomView.prototype),e.prototype.constructor=e,extend(e.prototype,{create:function(){var e=document.createElement("td");e.className="zw-td";var t=document.createElement("div");if(t.setAttribute("class","zw-cell-container"),e.appendChild(t),this.el=e,this.container=t,this.updateStyle(),this.getDocLayoutManager().isEmbedMode()){var i=DocLayoutManager.getRenderingFormat(this.docView.getNodeStartIndex(),NODE_TYPE.CELL,this);i&&i.mminfo&&(this.el.setAttribute("data-fmt",JSON.stringify(i)),this.el.setAttribute("data-id",i.id))}},bindEvents:function(){this.docView.on(DOCVIEW.ROWSPAN_UPDATED,this.updateRowSpan,this)},unbindEvents:function(){this.docView.off(DOCVIEW.ROWSPAN_UPDATED,this.updateRowSpan,this)},updateStyle:function(){this.el.removeAttribute("style"),this.container.removeAttribute("style");var e=this.el.style,t=this.container,i=t.style,n=this.getDocLayoutManager().isEmbedMode();i.position="relative";var r=this.docView.getCellBackgroundType(),o=this.docView.getCellBackground();if(r===CELL_BACKGROUND_TYPE.COLOR?e.background=o:r===CELL_BACKGROUND_TYPE.IMAGE&&(o=DomUtil.processImgSrc(o),e.background="transparent  url("+o+") 50%",e.backgroundSize="100%"),n||(i.width=this.docView.getWidth()+"px"),n){var a=this.docView.getCellHeight()+"px";e.verticalAlign=this.docView.getVerticalAlign(),this.docView.getRow().isRowHeightRuleAtleast()?e.height=a:this.docView.getRow().isRowHeightRuleExact()||(i.minHeight=a)}this.setBorders(),this.setMergeType(),this.updateRowSpan(),this.updateColSpan(),this.updateHeight()},setBorders:function(){var e,t=this.docView;e=t.borderOverwritten&&t.parent.containsDummyBorder?{"border-top":"0px","border-bottom":"0px"}:t.getBorderStyle(),DomUtil.setCellBorders(this.el,e)},setPadding:function(){var e=this.docView,t=this.container.style;if(e.borderOverwritten&&e.parent.containsDummyBorder)t.margin="0px";else{var i=e.getNode(),n=i.getCellPadding();this.getDocLayoutManager().isEmbedMode()?t.marginTop=n.top+"px":t.marginTop=this.docView.alignmentHeightInfo.top+"px",t.marginRight=n.right+"px",t.marginBottom=n.bottom+"px",t.marginLeft=n.left+"px"}},setMergeType:function(){try{var e=this.el.style,t=this.docView.getMergeType();if(t===CELL_MERGE_TYPE.NONE)return;this.el.setAttribute("merge",t);var i=this.docView.getBorderStyle(),n=this.el.parentElement;if(t===CELL_MERGE_TYPE.HMP){if(e.display="none",i["border-right"]&&n&&!this.docView.getNode().next)for(var r,o=n.children.length-1,a=o;a>=0;a--){if(r=n.children[a],"fc"==r.attributes.merge.value){r.style.borderRight||(r.style.borderRight=i["border-right"]);break}if("vmp"==r.attributes.merge.value)break}}else if(t===CELL_MERGE_TYPE.VMP){if(e.display="none",i["border-bottom"]&&this.docView.getNode().parent&&!this.docView.getNode().parent.next)for(var s,l,d=this.docView.getFCCellView(),c=d&&d.getViews(),u=c?c.length:0,a=0;a<u;a++)s=this.domViewManager.getDOMObj(c[a]),l=s&&s.el,l&&!l.style.borderBottom&&(l.style.borderBottom=i["border-bottom"])}else if(t===CELL_MERGE_TYPE.FC){if(!i["border-right"]&&this.el.nextElementSibling&&"hmp"==this.el.nextElementSibling.getAttribute("merge")){for(var g=this.el.nextElementSibling;g&&g.nextElementSibling&&"hmp"==g.nextElementSibling.getAttribute("merge");)g=g.nextElementSibling;!g.nextElementSibling&&g.style.borderRight&&(e.borderRight=g.style.borderRight)}if(!i["border-bottom"])for(var s,l,h,f,c=this.docView.getViews(),u=c.length,a=0;a<u;a++)s=c[a],h=s.getLastVmpCell(),h&&(l=this.domViewManager.getDOMElem(s),f=this.domViewManager.getDOMElem(h),l&&f&&!f.parentElement.nextElementSibling&&f.style.borderBottom&&(l.style.borderBottom=f.style.borderBottom))}}catch(e){ZWLogger.log("Error from setMergeType :: "+e)}},destroy:function(){DomView.prototype.destroy.apply(this,arguments),this.container=null},update:function(){this.el.removeAttribute("style"),this.el.removeAttribute("rowspan"),this.el.removeAttribute("colspan"),this.updateStyle()},afterViewBuild:function(){this.update()},updateHeight:function(){this.setPadding(),this.getDocLayoutManager().isEmbedMode()||this.updateCellAndContainerHeight()},updateCellAndContainerHeight:function(){this.container.style.height=this.docView.alignmentHeightInfo.cellContainerHeight+"px",this.el.style.height=this.docView.alignmentHeightInfo.cellHeight+"px"},updateRowSpan:function(){if("none"!==this.el.style.display){var e=this.docView.getRowSpan();null!=e&&this.el.setAttribute("rowspan",e)}},updateColSpan:function(){if("none"!==this.el.style.display){var e=this.docView.getColSpan();null!=e&&this.el.setAttribute("colspan",e)}},getContentContainer:function(){return this.container}}),e}(),TocDomView=function(){"use strict";function e(e,t){DomView.apply(this,arguments)}return e.prototype=Object.create(DomView.prototype),e.prototype.constructor=e,extend(e.prototype,{create:function(){var e=this.docView.getRawFormatAt(this.docView.getNodeStartIndex()),t=editor.doc.getBodyFormat(),i='<div id="tocBtnGrp" class="ui-toc-btngrp zbutton--group ui-fr" style="z-index:100;position:relative;">';editor.getRole().permissions.can("document.edit")&&!this.docView.getPreviousSplitView()&&(i+='<div id="'+CONST.TOC_SETTINGS+'" class="zbutton" title="'+J.i18n("common","TOC_SETTINGS")+'"><span class="zbutton__icon ui-sprit-fast ui-icon-topband-settings-sm"></span></div><button id ="'+CONST.TOC_REGENERATE+'"  role="button" class="zbutton  zbutton--medium  zbutton--menu zbutton--icononly" aria-label="undefined" aria-haspopup="true" type="button" style="border-bottom-left-radius: 0px; border-bottom-right-radius: 0px;"><i class="zbutton__icon zbutton__mainicon  ui-sprit-fast ui-icon-refresh-blue-sm"></i></button><div id="'+CONST.TOC_CLOSE+'" class="zbutton" title="'+J.i18n("common","REMOVE_TOC")+'" onclick="editor.doc.execCmd(\'deletetoc\')"><span class="zbutton__icon ui-sprit-lazy ui-icon-delete-blk-sm"></span></div>');var n=J(document.createElement("div")).css("border-color",t[ATTR_BODY.DS_BGC]).attr({id:CONST.TOC_MAIN_DIV,bid:"pgbrk",class:"tocClass"}).html(i);n.find("#"+CONST.TOC_REGENERATE+",#"+CONST.TOC_SETTINGS+",#"+CONST.TOC_CLOSE).on("mouseup",function(e){e.stopPropagation()}),n.find("#"+CONST.TOC_REGENERATE+",#"+CONST.TOC_SETTINGS+",#"+CONST.TOC_CLOSE).on("mousedown",function(e){var t=e.target,i=J(t).parents("div#toc"),n=editor.doc.getSelection().getStart(),r=i.next("div.zw-paragraph")[0];if(r||(r=i.prev("div.zw-paragraph")[0]),r){n=DocUtil.getDocElement(r).getStart();var o=editor.doc.getSelection().getLastRange();o&&o.setStart(n)&&o.setEnd(n)}e.stopPropagation()}),e[ATTR_COMMON.CLS]&&n.addClass(e[ATTR_COMMON.CLS]),n.find("#"+CONST.TOC_REGENERATE).on("click",function(e){var t=J("#tocRegenerateMenu");t.data().componentName||t.zmenu(),t.zmenu("show",{forElement:n.find("#"+CONST.TOC_REGENERATE)[0]})}),n.find("#"+CONST.TOC_SETTINGS).on("click",function(e){return TocDialog.openTocSettingsDlg(),DomUtil.stopEvent(e),!1}),n.on("mouseover",function(){var e=J(this);editor.getRole().permissions.can("document.edit")&&!DocTreeManager.isContentSectionBuildInProgress()&&e.css("border-color","#D4D4D4").find(".ui-toc-btngrp").show().find("#tocSettings")[LayoutManager.isFullscreen()?"hide":"show"]()}).on("mouseleave",function(e){"tocRegenerateMenu"!=e.toElement.id&&(J(this).css("border-color","transparent").find(".ui-toc-btngrp").hide(),J("#tocRegenerateMenu").hide())}),e[ATTR_COMMON.CLS]&&n.addClass(e[ATTR_COMMON.CLS]),this.el=n[0],this.updateStyle()},update:function(){},updateStyle:function(){var e=this.docView.getRawFormatAt(this.docView.getNodeStartIndex());DomUtil.setStyle(this.el,e)},afterViewBuild:function(){this.update()},getButtonGroup:function(){return this.el.querySelector("#tocBtnGrp")}}),e}(),HrDomView=function(){"use strict";function e(e,t){DomView.apply(this,arguments)}return e.prototype=Object.create(DomView.prototype),e.prototype.constructor=e,extend(e.prototype,{create:function(){var e=document.createElement("div");e.className="zw-hr",this.el=e,this.updateStyle()},update:function(){this.updateStyle()},updateStyle:function(){try{var e=this.docView.getNode().getFormats();if(!e||!this.el)return;var t={},i=J(this.el);t=DomUtil.getBorderStyles(e),e[ATTR_COMMON.BORDERS]||e.bid||(t["border-top"]="1px solid black"),isHeadlessHTML&&"pgbrk"==e.cls&&(t["page-break-after"]="always");for(var n in e)if(e.hasOwnProperty(n)&&"type"!=n){var r=e[n];switch(n){case ATTR_HR.HR_WID:t.width=r;break;case ATTR_HR.HR_HT:t.height=r;break;case ATTR_COMMON.BORDERS:if(!e.bid){var o=DomUtil.getBorderStyles(e);t["border-top"]=o["border-top"]}break;case ATTR_HR.HR_AL:t["margin-left"]=this.docView.getLeft();break;case"bid":break;case"cls":i.addClass(r)}}t.cursor="text",i.css(t)}catch(e){}this.el.style.marginTop="0px",this.el.style.marginBottom="0px"},afterViewBuild:function(){this.update()}}),e}(),LineDOMBuilder=function(){"use strict";function e(e,t,i){i=i||{};var n=null==i.start?e.start:i.start,r=null==i.end?e.end:i.end,o=i.allowTCStyles||!0,a=i.excludeContainer||!1,s=i.allowFloatingFields||!1;this.domViewManager=t,this.nodeLine=e,this.lineDiv=null,this.lineContentDiv=null,this.portionContainer=null,this.segment=null,this.prevSegment=null,this.nextSegment=null,this.start=n,this.end=r,this.startSegmentIndex=-1,this.endSegmentIndex=-1,this.segmentIndex=0,this.direction="none",this.fragment=null,this.spanPortion=null,this.rangeStartFormat=null,this.isFormulaFirstSegment=!1,this.charArray=[],this.processedString="",this.allowTCStyles=o,this.excludeContainer=a,this.allowFloatingFields=s,this.prevSpanPortion=null,this.fieldWrapper=null,this.automationFieldRangeId=null,this.displayStyles=null}var t="EOP",i="EOP-readonly",n="zw-br-portion",r="zw-text-portion",o="zw-portion-outline",a="tab",s="spacer",l="zw-range-start",d="zw-range-end",c="zeroSize",u="bookmark",g="data-bookmark-name",h="cmt-range-start",f="cmt-range-end",p="conditional-block",E="ui-ms-pointer",T="noprint",O="isrelcnt",m="isabscnt",I="zw-portion-bg",D="zw-line-div",R="zw-line-content",S="sub",C="super",A=[S,C],v="digisign-field",_="draggable",P="zw-checkbox-field",N="zw-input-field",b={DISABLED:"ffield-disabled",PLACEHOLDER:"ffield-placehldr",COMBO:"ui-e-combofield",FILL_CHECKBOX:"zw-fill-checkbox"},L=[NODE_TYPE.FILLABLEFIELD,NODE_TYPE.SIGNERFIELD,NODE_TYPE.MAILMERGEFIELD];return extend(e.prototype,{build:function(e){return this.fillStartAndEndSegments(),this.excludeContainer?(this.constructDOMSegments(),this.fragment):(e||this.createLineDiv(),this.constructDOMSegments(),this.lineContentDiv.appendChild(this.fragment),this.updateFirstSpanLeft(),this.renderJustifyAlign(),this.setHeight(),this.setDocId(),this.lineDiv)},fillStartAndEndSegments:function(){var e=this.nodeLine,t=e.segments;if(this.start===e.start)this.startSegmentIndex=0;else{var i=e.getSegmentAtIndex(this.start);i?this.startSegmentIndex=t.indexOf(i):this.startSegmentIndex=0}if(this.end===e.end)this.endSegmentIndex=t.length-1;else{var n=e.getSegmentAtIndex(this.end);n?this.endSegmentIndex=t.indexOf(n):this.endSegmentIndex=t.length-1}this.segmentIndex=this.startSegmentIndex},fillAutomationRangeId:function(){if(this.segment){var e;if(e=this.getContent()===UNICODE.RANGE_START?this.getAbsStart():editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,this.getAbsStart()),!(e<0)){var t=editor.doc.getRawFormatAt(e);if(t&&L.contains(t.type)){var i=editor.doc.findNextIndexOf(UNICODE.RANGE_END,e);if(i>this.getAbsStart()){var n=editor.doc.getRawFormatAt(i);n.id===t.id&&(this.automationFieldRangeId=t.id)}}}}},getFormat:function(e){var t=this.segment.computedFormat;return e&&this.hasTCFormats()?TcView.updateDOMStyles(t):t},getContent:function(){return this.segment.content},getFormatClass:function(){var e=this.getFormat();return(e&&e[ATTR_COMMON.CLS]||"").toLowerCase()},hasTCFormats:function(){var e=this.getFormat();return this.allowTCStyles&&e.hasOwnProperty(TCConstants.TC)},subOrSuperscriptNeeded:function(){var e=this.getFormat(),t=this.getFormatClass(),i=e[ATTR_TEXT.TS_VA],n=!1;return i&&A.contains(i)&&(n=!0),n||NOTE_SECTIONS.contains(t)},isDigisignField:function(){var e=this.getFormat();return!(!e[ATTR_COMMON.ST]||e[ATTR_COMMON.ST]!==v)},isTextBox:function(){var e=this.getFormat();return DomUtil.isTextBox(e)},isFillableField:function(){var e=this.getFormatClass();return!(!e||e.indexOf(NODE_TYPE.FILLABLEFIELD)===-1)},isSignerField:function(){var e=this.getFormatClass();return!(!e||e.indexOf(NODE_TYPE.SIGNERFIELD)===-1)},isMergeField:function(){var e=this.getFormatClass();return!(!e||e.indexOf(NODE_TYPE.MAILMERGEFIELD)===-1)},isMultiLineFillableField:function(){var e=this.getFormat();return!(!e[ATTR_FILLABLEFIELD.FF_INFO]||e[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SUBTYPE]!==FILLABLEFIELD_TYPE.MULTILINE)},isSignerStampField:function(){if(!this.isSignerField())return!1;var e=this.getFormat();return e&&e[ATTR_SIGNERFIELD.SFINFO]&&e[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE]===SIGNERFIELD_TYPE.STAMP},isSignerImageField:function(){if(!this.isSignerField())return!1;var e=this.getFormat();return e&&e[ATTR_SIGNERFIELD.SFINFO]&&e[ATTR_SIGNERFIELD.SFINFO][ATTR_SIGNERFIELD.SFTYPE]===SIGNERFIELD_TYPE.IMAGE},isInlineImage:function(){var e=this.getFormat();return![WRAP_TYPE.SQUARE,WRAP_TYPE.FRONT,WRAP_TYPE.BEHIND].contains(e[ATTR_IMAGE.I_WRAP_TYPE])},isFloatingField:function(){var e=this.rangeStartFormat;return e&&[WRAP_TYPE.SQUARE,WRAP_TYPE.FRONT,WRAP_TYPE.BEHIND].contains(e[ATTR_IMAGE.I_WRAP_TYPE])},isChartImage:function(){var e=this.getFormat();return DomUtil.isChartImage(e)},isWidgetField:function(){var e=this.getFormat();return DomUtil.isWidgetField(e)},isMapWidget:function(){var e=this.getFormat();return DomUtil.isMapWidget(e)},isChartField:function(){var e=this.getFormat();return DomUtil.isChartField(e)},isLiveWidget:function(){var e=this.getFormat();return DomUtil.isLiveWidget(e)},setHeight:function(){this.lineDiv.style.height=this.nodeLine.height+"px"},setDocId:function(){this.lineDiv.setAttribute("doc-id",this.nodeLine.id)},updateRangeStartFormat:function(){if(this.getContent()===UNICODE.RANGE_START)this.rangeStartFormat=this.getFormat();else{var e=editor.doc.findPreviousIndexOf(UNICODE.RANGE_START,this.getAbsStart());if(e>0){if(this.rangeStartFormat=editor.doc.getRawFormatAt(e),!ZWJSONUtils.isEmptyObject(this.rangeStartFormat[ATTR_CUSTOM.DISPLAY_TYPE])){var t=DocUtil.getFloatElementRange(NODE_TYPE.TAG,e+1);t&&t.end>this.getAbsStart()&&(this.displayStyles=this.rangeStartFormat[ATTR_CUSTOM.DISPLAY_STYLE])}}else this.rangeStartFormat=null,this.displayStyles=null}},getSegmentAtSegmentIndex:function(e){var t=this.nodeLine,i=t.segments,n=this.nodeLine.segmentOrder;return null!=n[e]?i[n[e]]:null},getVisualSegmentIndex:function(e){var t=this.nodeLine,i=null==e?this.segmentIndex:e,n=t.segmentOrder;return i=n.indexOf(i)},updateSegment:function(){this.prevSegment=this.segment;var e,t,i=this.getVisualSegmentIndex();this.startSegmentIndex<=this.endSegmentIndex&&(this.segmentIndex<=this.endSegmentIndex?(e=this.getSegmentAtSegmentIndex(i),this.segmentIndex++,t=this.getSegmentAtSegmentIndex(this.getVisualSegmentIndex())):e=null),this.segment=e,this.nextSegment=t,this.segment&&(this.updateCharArray(),this.updateProcessedString())},updateNodeLine:function(e){this.nodeLine=e},updateFragment:function(){if(this.spanPortion&&this.portionContainer)if("BDO"===this.portionContainer.tagName&&"rtl"===this.portionContainer.dir)this.portionContainer.insertBefore(this.spanPortion,this.portionContainer.firstChild);else if(this.prevSpanPortion&&this.portionContainer!==this.prevSpanPortion.parentElement)this.portionContainer.appendChild(this.spanPortion);else{var e=this.getVisualSegmentIndex(this.segmentIndex-1),t=-1;this.segmentIndex>1&&(t=this.getVisualSegmentIndex(this.segmentIndex-2));var i=e>=t;i?this.portionContainer.appendChild(this.spanPortion):this.portionContainer.insertBefore(this.spanPortion,this.portionContainer.firstChild)}},skipFloatingFields:function(){return!this.allowFloatingFields&&this.automationFieldRangeId&&this.isFloatingField()},skipFloatingSignerFields:function(){return!this.allowFloatingFields},checkAndUpdateFieldRangeId:function(){var e=this.getContent().charAt(0),t=this.getFormat();e==UNICODE.RANGE_END&&(!t||t.type!=NODE_TYPE.FILLABLEFIELD&&t.type!=NODE_TYPE.SIGNERFIELD&&t.type!=NODE_TYPE.MAILMERGEFIELD||this.automationFieldRangeId!==t.id||(this.automationFieldRangeId=null))},constructDOMSegments:function(){for(this.fragment=document.createDocumentFragment(),this.updateSegment(),this.fillAutomationRangeId();this.segment;){var e=this.getContent();if(this.updateRangeStartFormat(),this.skipFloatingFields())this.checkAndUpdateFieldRangeId(),this.updateFragment(),this.updateSegment();else if(this.updatePortionContainer(),this.prevSpanPortion=this.spanPortion,this.spanPortion=this.createSpan(),"EOP"!==this.segment.type){var t=e.charAt(0);switch(t){case UNICODE.TAB:this.constructTabSpan();break;case UNICODE.IMAGE:this.constructImageTypes();break;case UNICODE.BR:this.constructBR();break;case UNICODE.RANGE_START:this.constructRangeStartTypes();break;case UNICODE.RANGE_END:this.constructRangeEndTypes();break;case UNICODE.FIELD_SEPARATOR:this.constructFieldSeparator();break;default:this.constructDefault()}this.spanPortion&&(this.updateSegmentLeft(),this.setCharLength(),this.setBackgroundStyle(),this.setCodeStyle(),this.setToolTip()),this.updateFragment(),this.updateSegment()}else this.constructEOPPortion(),this.updateFragment(),this.updateSegment()}},renderJustifyAlign:function(){var e=this.nodeLine.getAlign();if(TEXT_ALIGN[e]===ALIGN.JUSTIFY)for(var t=this.nodeLine,i=t.parent.getParent(),n=t.spaceWidths.length,r=this.lineContentDiv.querySelectorAll("span.zw-space")||[],o=0;o<r.length&&o<n;o++){var a=r[o],s=t.spaceWidths[o],l=W(a).parents(".zw-portion")[0],d=l.style.textDecoration;l.classList.contains("link")&&"toc"!==i.type&&(d?"underline"===d&&(d+=" underline"):d="underline");var c=t.renderedSpaceWidths[o];if(a.style.width=c+"px",d&&["underline","line-through"].contains(d)&&(a.nextSibling||a.parentNode.nextSibling||a.parentNode.classList.contains("tc-revision"))){for(var u=s&&c?Math.ceil(c/s):0,g="&nbsp;&nbsp;";u&&a.nextSibling;)g+="&nbsp;",u--;a.style.textDecoration=d,a.innerHTML=g}}},updateFirstSpanLeft:function(){if(this.nodeLine.imagePaddingLeft){var e=this.lineContentDiv.querySelector("span");e&&(e.style.paddingLeft=this.nodeLine.imagePaddingLeft+"px")}},getCharArray:function(){return this.charArray},updateCharArray:function(e){for(var t=[],i=e||this.getContent(),n=0;n<i.length;n++)t.push(Utils.encodeHTMLChars(i[n]));this.charArray=t},getProcessedString:function(){return this.processedString},updateProcessedString:function(){var e=this.getCharArray();this.processedString=e.join("").replace(/ /g,"&nbsp;")},isNextRecordField:function(){var e=this.getFormatClass();return e.indexOf(CONST.NEXTRECORD)!==-1},addDisplayStyles:function(){if(!ZWJSONUtils.isEmptyObject(this.displayStyles)&&!this.segment.isSpaceSegment){var e=this.displayStyles[ATTR_COMMON.BORDERS];if(e){var t=e[ATTR_BORDERS.BORDER_TOP];t&&(this.spanPortion.style.borderTop=t[ATTR_BORDERS.WIDTH]+" "+t[ATTR_BORDERS.TYPE]+" "+t[ATTR_BORDERS.COLOR],this.spanPortion.style.paddingTop=t[ATTR_BORDERS.SPACE]||"0px");var i=e[ATTR_BORDERS.BORDER_LEFT];i&&(this.spanPortion.style.borderLeft=i[ATTR_BORDERS.WIDTH]+" "+i[ATTR_BORDERS.TYPE]+" "+i[ATTR_BORDERS.COLOR],this.spanPortion.style.paddingLeft=i[ATTR_BORDERS.SPACE]||"0px");var n=e[ATTR_BORDERS.BORDER_RIGHT];n&&(this.spanPortion.style.borderRight=n[ATTR_BORDERS.WIDTH]+" "+n[ATTR_BORDERS.TYPE]+" "+n[ATTR_BORDERS.COLOR],this.spanPortion.style.paddingRight=n[ATTR_BORDERS.SPACE]||"0px");var r=e[ATTR_BORDERS.BORDER_BOTTOM];r&&(this.spanPortion.style.borderBottom=r[ATTR_BORDERS.WIDTH]+" "+r[ATTR_BORDERS.TYPE]+" "+r[ATTR_BORDERS.COLOR],this.spanPortion.style.paddingBottom=r[ATTR_BORDERS.SPACE]||"0px");var o=e[ATTR_BORDERS.BORDER_RADIUS];o&&(this.spanPortion.style.borderTopLeftRadius=o[ATTR_BORDERS.RADIUS_TOPLEFT]||"0px",this.spanPortion.style.borderTopRightRadius=o[ATTR_BORDERS.RADIUS_TOPRIGHT]||"0px",this.spanPortion.style.borderBottomLeftRadius=o[ATTR_BORDERS.RADIUS_BOTTOMLEFT]||"0px",this.spanPortion.style.borderBottomRightRadius=o[ATTR_BORDERS.RADIUS_BOTTOMRIGHT]||"0px")}var a=this.displayStyles.bgc;a&&(this.spanPortion.style.backgroundColor=a);var s=this.displayStyles.size;s&&(this.spanPortion.style.fontSize=s),this.spanPortion.style.display="inline-block",this.spanPortion.classList.add(TAG_CLASS)}},constructDefault:function(){this.spanPortion.classList.add(r);var e=ZWJSONUtils.clone(this.getFormat());delete e.bgc;for(var t=(e.cls||"").split(" ")||[],i="",n=t.length,o=0;o<n;o++)L.contains(t[o])||(i+=t[o],o!=n-1&&(i+=" "));if(e.cls=i,this.automationFieldRangeId&&(this.rangeStartFormat.type!==NODE_TYPE.SIGNERFIELD||isHeadlessPDF||isHeadlessHTML||(e.fgc&&this.spanPortion.setAttribute("data-fgc",e.fgc),e.fgc="inherit"),this.rangeStartFormat.type===NODE_TYPE.FILLABLEFIELD)){var a=Utils.getFillableFieldValue(this.rangeStartFormat);" "===a&&this.rangeStartFormat[ATTR_FILLABLEFIELD.FF_NAME]&&this.spanPortion.classList.add(b.PLACEHOLDER);var s=this.rangeStartFormat[ATTR_FILLABLEFIELD.FF_TYPE];s===FILLABLEFIELD_TYPE.SELECTBOX&&this.rangeStartFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_SELECTED_INDEX]===-1&&this.spanPortion.classList.add(b.PLACEHOLDER)}if(DomUtil.setStyle(this.spanPortion,e),this.addDisplayStyles(),this.isLink()){var l=DocUtil.getFloatElementRange(NODE_TYPE.LINK,this.getAbsStart()),d=l?l.start:-1;if(d!=-1){var c=editor.doc.getRawFormatAt(d);DomUtil.setLinkDatas(c,this.spanPortion)}this.spanPortion.innerHTML=this.getProcessedString()}else if(this.isAutoField())this.constructAutoFields();else if(this.isNextRecordField())this.constructNextRecord();else if(this.isEndnote()||this.isFootnote())this.constructNoteSpan();else{var u=this.getJoinerInBetween(this.prevSegment,this.segment),g=this.getJoinerInBetween(this.segment,this.nextSegment),h=this.nodeLine.isLineDirectionRTL();h?this.spanPortion.innerHTML=u+this.getProcessedString()+g:this.spanPortion.innerHTML=g+this.getProcessedString()+u}var f=this.nodeLine.getAlign();TEXT_ALIGN[f]===ALIGN.JUSTIFY&&this.constructJustify()},getJoinerInBetween:function(e,t){if(!e||!t)return"";var i=CONST.ZERO_WIDTH_NON_JOINER,n=this.nodeLine.isLineDirectionRTL(),r=e.isContentTypeRTL(),o=t.isContentTypeRTL();if(r){if(o){var a=!1;n?((t.isFirstCharNeutral()||e.isLastCharNeutral())&&(a=!0),i=a?CONST.ZERO_WIDTH_NON_JOINER:CONST.ZERO_WIDTH_JOINER):((t.isLastCharNeutral()||e.isFirstCharNeutral())&&(a=!0),i=a?CONST.ZERO_WIDTH_NON_JOINER:CONST.ZERO_WIDTH_JOINER)}}else o||(i="");return i},setCharLength:function(){this.spanPortion.setAttribute("data-text-len",this.segment.end-this.segment.start)},updateSegmentLeft:function(){this.segment.left&&(this.spanPortion.style.paddingLeft=this.segment.left+"px")},setBackgroundStyle:function(){var e=this.getFormat();if(!e[ATTR_CUSTOM.DISPLAY_TYPE]){var t=e.bgc;if(t){var i=document.createElement("span");i.classList.add(I),i.style.backgroundColor=t,i.style.zIndex=ZINDEX.TEXT_BACKGROUND,this.spanPortion.style.position="relative",this.spanPortion.appendChild(i)}}},setCodeStyle:function(){this.segment.code&&this.spanPortion.classList.add(this.segment.code)},setToolTip:function(){var e=this.getFormat();e.toolTip&&(this.spanPortion.setAttribute("data-title-innerhtml",e.toolTip),this.spanPortion.setAttribute("title"," "))},isEmptyFillableField:function(){var e=this.getCharArray();return this.isFillableField()&&e.join("")===UNICODE.SPACE},getDomViewManager:function(){return this.domViewManager},getDocLayoutManager:function(){return this.getDomViewManager().getDocLayoutManager()},constructNoteSpan:function(){var e=this.getFormat();this.spanPortion.innerHTML=CONST.ZERO_WIDTH_SPACE,this.getDomViewManager().updateNoteRangeElement(this.nodeLine.getView(),e,this.spanPortion);var t=e.id?e.id:e.fid,i=this.getDocLayoutManager().getSectionViews(t),n=this.getProcessedString();if(i[0]){this.updateCharArray(i[0].getReferenceChar()),this.updateProcessedString();var r=.7*this.getFormat()[ATTR_TEXT.TS_SIZE];this.spanPortion.setAttribute("data-id",e.id||e.fid),this.spanPortion.style.fontSize=Math.round(r)+"pt"}else{this.spanPortion.innerHTML=n,e.cls="";var o=this.getAbsStart(),a=editor.doc.getRawFormatAt(o);a&&(a[ATTR_COMMON.CLS]=""),editor.doc.setFormatAt(o,a)}},constructJustify:function(){for(var e=this.getCharArray(),t=e.join(""),i=/\s|\u00A0/g,n=0,r=i.exec(t),o="";r;){var a=r.index;o+=t.substring(n,a)+"<span class='zw-space' style='display:inline-block;'>&nbsp;</span>",n=a+1,r=i.exec(t)}o+=t.substring(n),this.spanPortion.innerHTML=o},constructAutoFields:function(){var e,t=this.getFormatClass();e=CONT_REGEXP.AUTOFIELD_PAGE_NO_COUNT.test(t)?this.constructAutoPageFields():/autoformula/.test(t)?this.constructAutoFormulaFields():/autodocname/.test(t)||/autoauthor/.test(t)||/autodocversion/.test(t)?this.constructDocumentOrAuthorNameFields():this.constructAutoDate(),this.spanPortion.innerHTML=e},isEndnote:function(){return this.getFormatClass()===NODE_TYPE.ENDNOTE},isFootnote:function(){return this.getFormatClass()===NODE_TYPE.FOOTNOTE},constructNextRecord:function(){var e=this.getFieldInfo(),t=this.getFields();this.spanPortion.innerHTML=t[e]},getFields:function(){var e=this.nodeLine.getView();return e.dtView.getViewProperties().fields},isStaticDateField:function(){var e="#",t=this.getContent().charAt(0);return t!==e&&this.rangeStartFormat&&[AUTOFIELD_TYPE.AUTO_DATE,AUTOFIELD_TYPE.CREATED_DATE].contains(this.rangeStartFormat[ATTR_AUTOFIELD.FIELDTYPE])&&!this.rangeStartFormat[ATTR_AUTOFIELD.ISAUTO]},constructAutoDate:function(){var e,t=this.getFieldInfo();if(t&&!this.isStaticDateField()){var i=this.getFields(),n=i[t];this.updateCharArray(n),this.updateProcessedString();var r=this.getFormatClass(),o=this.constructFieldDiv(n,t,r);e=CONST.ZERO_WIDTH_SPACE+o}else e=this.getProcessedString();return e},constructDocumentOrAuthorNameFields:function(){var e,t="",i=this.getFormatClass(),n=this.getFieldInfo(),r=this.getFields();if(n&&r[n]&&r[n].containsOldValue){t=r[n].value,this.updateCharArray(t),this.updateProcessedString();var o=this.constructFieldDiv(t,n,i);e=CONST.ZERO_WIDTH_SPACE+o}else e=this.getProcessedString();return e},constructAutoFormulaFields:function(){var e,t=this.getFieldInfo(),i="",n=this.getFormatClass(),r=this.nodeLine.getView(),o=this.getProcessedString();if(this.isFormulaFirstSegment)if(t){if(r.dtView.getViewProperties().fields.containsOldFormula){i=r.dtView.getViewProperties().fields[t].value,this.updateCharArray(i),this.updateProcessedString();var a=this.constructFieldDiv(i,t,n);e=CONST.ZERO_WIDTH_SPACE+a}else e=o;this.isFormulaFirstSegment=!1}else e=o;else{var s=this.getContent().charAt(0);r.dtView.getViewProperties().fields.containsOldFormula&&"#"===s?(e=CONST.ZERO_WIDTH_SPACE,this.updateCharArray(e),this.updateProcessedString()):e=o}return e},constructAutoPageFields:function(){var e="#",t=this.getFormatClass();switch(!0){case t.indexOf(AUTOFIELD_TYPE.AUTO_PAGECOUNT)!==-1:e=""+this.constructPageCount();break;case t.indexOf(AUTOFIELD_TYPE.AUTO_TOC_PAGENUMBER)!==-1:e=this.getContent();break;case t.indexOf(AUTOFIELD_TYPE.AUTO_PAGENUMBER)!==-1:e=""+this.constructPageNumber()}this.updateCharArray(e),this.updateProcessedString();var i=this.constructFieldDiv(e);return CONST.ZERO_WIDTH_SPACE+i},constructFieldDiv:function(e,t,i){if(null==e)return"";var n="<span class='"+CONST.FIELD_TEXT_NODE+"' style='display:inline-block;font-size:inherit;'";return t&&(n+=" data-fieldInfo='"+t+"'"),i&&(n+=" data-fieldType='"+i+"'"),n+=">"+e+"</span>"},constructPageCount:function(){var e,t=this.nodeLine.getView();return this.isRelativePageCount()?(e=t.getGroup().getRelativePageCount(),this.spanPortion.classList.add(O)):(e=this.nodeLine.getView().documentLayoutManager.getPageCount(),this.spanPortion.classList.add(m)),e},constructPageNumber:function(){var e,t=this.nodeLine.getView(),i=t.getGroup().getPageNumberFormat();return e=t.getSection()&&t.getSectionType()===SECTION_TYPES.CONTENT?t.getPage().getPageNumber():1,ListUtils.getListNumber(i,e,null,!0)},isRelativePageCount:function(){return this.rangeStartFormat&&this.rangeStartFormat[ATTR_AUTOFIELD.FIELDTYPE]===AUTOFIELD_TYPE.AUTO_PAGECOUNT&&this.rangeStartFormat[ATTR_AUTOFIELD.SECTIONPAGES]},isAutoField:function(){var e=new RegExp(CONT_REGEXP.AUTOFIELD);return e.test(this.getFormatClass())},getFieldInfo:function(){var e=this.getFormat();return e.hasOwnProperty(ATTR_COMMON.FIELDINFO)?e[ATTR_COMMON.FIELDINFO]:null},isLink:function(){var e=this.getFormatClass();return e===NODE_TYPE.LINK},constructFieldSeparator:function(){var e=this.getFormat();e.type!==NODE_TYPE.CONDITIONAL_ELSE_SEPARATOR||RangeCollection.isConditionToggled(e.id)||(this.spanPortion.classList.remove(c),this.spanPortion.classList.add(p),this.spanPortion.innerHTML=CONDITIONAL_FIELD.ELSE,DomUtil.setStyle(this.spanPortion,e))},getSpacerImage:function(){var e=document.createElement("img");return e.className=s,e},isAutoFormula:function(){var e=this.getFormat();return e.ftype&&e.ftype===AUTOFIELD_TYPE.AUTO_FORMULA},constructRangeStartTypes:function(){var e=this.getFormat();if(this.isFloatingField())return L.contains(e.type)&&(this.automationFieldRangeId=this.rangeStartFormat.id),void(this.spanPortion=null);var t=this.getSpacerImage();if(t.classList.add(l),this.spanPortion.appendChild(t),this.spanPortion.classList.add(c),e){switch(e.type){case NODE_TYPE.BOOKMARK:e.id&&(t.setAttribute("id",e.id),t.setAttribute(g,e.name),t.classList.add(u));break;case NODE_TYPE.COMMENT:e.id&&(t.setAttribute("cid",e.id),t.classList.add(h));break;case NODE_TYPE.CONDITIONAL_IF_START:RangeCollection.isConditionToggled(e.id)||(this.spanPortion.classList.remove(c),this.spanPortion.classList.add(p),this.spanPortion.classList.add(E),this.spanPortion.innerHTML=CONDITIONAL_FIELD.IF_START);break;case NODE_TYPE.AUTOFIELD:t.classList.add(T),this.isAutoFormula()&&(this.isFormulaFirstSegment=!0);break;case NODE_TYPE.FILLABLEFIELD:case NODE_TYPE.SIGNERFIELD:case NODE_TYPE.MAILMERGEFIELD:t.classList.add(T),this.automationFieldRangeId=this.rangeStartFormat.id;break;case NODE_TYPE.LINK:t.setAttribute("id",e.id)}ZWJSONUtils.isEmptyObject(this.rangeStartFormat[ATTR_CUSTOM.DISPLAY_TYPE])||(this.displayStyles=this.rangeStartFormat[ATTR_CUSTOM.DISPLAY_STYLE])}},constructRangeEndTypes:function(){if(this.isFloatingField())return void(this.spanPortion=null);var e=this.getSpacerImage();e.classList.add(d),this.spanPortion.appendChild(e),this.spanPortion.classList.add(c);var t=this.getFormat();if(t){switch(t.type){case NODE_TYPE.COMMENT:e.setAttribute("cid",t.id),e.classList.add(f),e.classList.add(T);break;case NODE_TYPE.LINK:e.setAttribute("id",t.id),e.classList.add(T);break;case NODE_TYPE.BOOKMARK:case NODE_TYPE.AUTOFIELD:e.classList.add(T);break;case NODE_TYPE.CONDITIONAL_IF_END:RangeCollection.isConditionToggled(t.id)||(this.spanPortion.classList.remove(c),this.spanPortion.classList.add(p),this.spanPortion.innerHTML=CONDITIONAL_FIELD.IF_END,DomUtil.setStyle(J(this.spanPortion),t));break;case NODE_TYPE.FILLABLEFIELD:case NODE_TYPE.SIGNERFIELD:case NODE_TYPE.MAILMERGEFIELD:this.automationFieldRangeId===t.id&&(this.automationFieldRangeId=null)}this.displayStyles=null}},constructBR:function(){this.spanPortion.classList.add(n),this.spanPortion.style.fontSize="0pt",this.spanPortion.innerHTML="&#8203;",this.hasTCFormats()&&TcView.setBRStyle(this.spanPortion,this.getFormat())},createLineDiv:function(){var e=document.createElement("div");e.classList.add(D),e.style.whiteSpace="nowrap",e.style.position="relative";var t=document.createElement("div");return t.classList.add(R),e.appendChild(t),this.lineDiv=e,this.lineContentDiv=t,this.lineDiv},createSpan:function(){var e=DomUtil.createSpan();if(this.fieldWrapper){var t=this.fieldWrapper.classList;(t.contains(NODE_TYPE.FILLABLEFIELD)||t.contains(NODE_TYPE.MAILMERGEFIELD))&&e.classList.remove("zw-portion")}return e},createAutomationField:function(){var e,t=this.rangeStartFormat.type;switch(t){case NODE_TYPE.FILLABLEFIELD:e=this.createFillableField();break;case NODE_TYPE.SIGNERFIELD:e=this.createSignerField();break;case NODE_TYPE.MAILMERGEFIELD:e=this.createMergeField()}return e&&(e.setAttribute("data-field-id",this.rangeStartFormat.id),this.nodeLine.isLineDirectionRTL()?e.style.direction="rtl":e.style.direction="ltr"),e},updatePortionContainer:function(){var e=this.nodeLine.isLineDirectionRTL(),t=this.segment.contentType===PARA_DIR.RTL,i=null,n="none",r=this.segment.content,o=r.charAt(0);if("EOP"===this.segment.type)return this.portionContainer=this.fragment,void(this.direction=n);if(e?t||o===UNICODE.TAB||(i=document.createElement("bdo"),i.dir="ltr",n="ltr"):t&&(i=document.createElement("bdo"),i.dir="rtl",n="rtl"),this.automationFieldRangeId){var a;if(this.fieldWrapper)if(this.getContent()===UNICODE.RANGE_END){var s=this.getFormat();s.type===NODE_TYPE.FILLABLEFIELD&&this.rangeStartFormat&&this.rangeStartFormat.hasOwnProperty("mandatory")&&[!0,"true"].contains(this.rangeStartFormat.mandatory)&&this.fieldWrapper.classList.add("is-mandatory-field"),this.portionContainer=this.fieldWrapper.parentElement,this.fieldWrapper=null,i=this.addOrUpdatePortionContainer(i,this.fragment,n)}else i=this.addOrUpdatePortionContainer(i,this.fieldWrapper,n);else a=this.createAutomationField(),i?a.appendChild(i):i=a,this.fieldWrapper=a,a&&this.fragment.appendChild(a)}else i=this.addOrUpdatePortionContainer(i,this.fragment,n);if(this.subOrSuperscriptNeeded()){var l=this.constructSubAndSuperscriptSpan();i.appendChild(l)}this.portionContainer=i,this.direction=n},addOrUpdatePortionContainer:function(e,t,i){return e=this.portionContainer&&this.direction===i?this.portionContainer:e?t.appendChild(e):t},constructSubAndSuperscriptSpan:function(){var e=this.getFormat(),t=document.createElement("span");return t.classList.add(o),t.style.fontSize=e[ATTR_TEXT.TS_SIZE]+"pt",t},constructTabSpan:function(){var e=this.getFormat();this.spanPortion.style.paddingLeft=(e.width||0)+"px",this.spanPortion.style.borderBottom=DomUtil.getLeaderStyle(e.leader),this.spanPortion.classList.add(c,a);var t=this.getSpacerImage();t.style.width="0px",this.spanPortion.appendChild(t),this.hasTCFormats()&&editor.doc.getTrackChangeDetails().getDisplayMode()===TCConstants.ALL_MARKUP_VIEW&&(e=TcView.updateDOMStyles(e),DomUtil.setStyle(this.spanPortion,e))},addRotationStyles:function(){var e=this.getFormat(),t=0;e[ATTR_COMMON.BORDERS]&&e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]&&(t=2*parseInt(e[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH])),e[ATTR_IMAGE.I_ROTATE]&&(this.spanPortion.style.width=e.rot_width+t+"px",this.spanPortion.style.height=e.rot_ht+t+"px",this.spanPortion.style.position="relative")},addImageTcStyles:function(){var e=this.getFormat();if(this.hasTCFormats()&&TcUtil.hasTCDeletion(e)){var t=TcView.getDiagonalLineSpan(e,this.spanPortion);t&&this.spanPortion.appendChild(t)}},createTextbox:function(){var e=this.getFormat(),t=this.nodeLine.getView(),i=t.getGroup().getDocViews(e.id)[0],n=this.getDomViewManager().getDOMObj(i);if(i.isFloating())n.updateStyle();else{n.updateInlineStyles(this.nodeLine),n.addViewToDOM(this.lineDiv),n.updateStyle();var r=this.getDomViewManager().getDOMObj(t),o=r.createTextBox(e);this.isFillableField()&&(e.src===UNICODE.SPACE&&DomUtil.addFillImage(o,e,null),o.classList.add(b.FILL_CHECKBOX)),this.spanPortion.appendChild(o)}},constructImageTypes:function(){var e=this.getFormat(!0);this.isDigisignField()?this.createDigiSignField():this.isTextBox()?this.createTextbox():this.isFillableField()?this.createFillableImageField():this.isSignerField()?this.createSignerImageFieldTypes():this.isWidgetField()?this.createWidget():this.isChartImage()?this.createChartImage():this.isChartField()?this.createChartField():this.isInlineImage()&&this.constructInlineImage(),this.isInlineImage()&&(this.spanPortion.style.display="inline-block",this.addRotationStyles(),this.addImageTcStyles(),!e.linkData||ZWJSONUtils.isEmptyObject(e.linkData)||this.getDomViewManager().isEditMode()||DomUtil.setAnchorForImages(e.linkData,this.spanPortion))},createSignerStampField:function(){var e=this.createSignerField(),t=this.getFormat();e.id=t.id;var i=t[ATTR_SIGNERFIELD.SFINFO];e.setAttribute("data-field-id",i.id),e.setAttribute("data-field-type",SIGNERFIELD_TYPE.STAMP),e.setAttribute("data-signer-stamp-src"," "),e.style.cursor="pointer";var n=parseInt(i[ATTR_SIGNERFIELD.RECIPIENT].replace(/\D/g,"")),r=document.createElement("div");r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style.top="0",r.style.left="0";var o=document.createElement("div");o.style.position="absolute",o.style.background="linear-gradient(to top left,rgba(223,227,255,0) 0,rgba(223,227,255,0) calc(50% - 0.8px), rgba(66, 87, 105,  .12) 50%, rgba(223, 227, 255, 0) calc(50% + 0.8px), rgba(223, 227, 255, 0) 100%), linear-gradient(to top right, rgba(223, 227, 255, 0) 0%, rgba(223, 227, 255, 0) calc(50% - 0.8px), rgba(66, 87, 105,  .12) 50%, rgba(223, 227, 255, 0) calc(50% + 0.8px), rgba(223, 227, 255, 0) 100%)",o.style.width="100%",o.style.height="100%",o.style.top="0",o.style.left="0",r.appendChild(o);var a=document.createElement("div");a.style.position="absolute",a.style.left="50%",a.style.top="50%",a.style.transform="translate(-50%,-50%)",a.style.background="var(--signerBgClr"+n+")";var s=document.createElement("div");s.style.position="absolute",s.style.width="22px",s.style.height="22px",s.style.margin="-3px",s.style.backgroundColor="var(--signerclr"+n+") !important",a.appendChild(s);var l=document.createElement("i");l.classList.add("zbutton__icon","ui-no-margin-right","ui-sprit-lazy","esignerfield-icon-stamp"),a.appendChild(l),r.appendChild(a),e.appendChild(r),this.spanPortion.appendChild(e)},createSignerImageField:function(){var e=this.createSignerField(),t=this.getFormat();e.id=t.id;var i=t[ATTR_SIGNERFIELD.SFINFO];e.setAttribute("data-field-id",i.id),e.setAttribute("data-field-type",SIGNERFIELD_TYPE.IMAGE),e.setAttribute("data-signer-image-src"," "),e.style.cursor="pointer";var n=parseInt(i[ATTR_SIGNERFIELD.RECIPIENT].replace(/\D/g,"")),r=document.createElement("div");r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style.top="0",r.style.left="0";var o=document.createElement("div");o.style.position="absolute",o.style.background="linear-gradient(to top left,rgba(223,227,255,0) 0,rgba(223,227,255,0) calc(50% - 0.8px), rgba(66, 87, 105,  .12) 50%, rgba(223, 227, 255, 0) calc(50% + 0.8px), rgba(223, 227, 255, 0) 100%), linear-gradient(to top right, rgba(223, 227, 255, 0) 0%, rgba(223, 227, 255, 0) calc(50% - 0.8px), rgba(66, 87, 105,  .12) 50%, rgba(223, 227, 255, 0) calc(50% + 0.8px), rgba(223, 227, 255, 0) 100%)",o.style.width="100%",o.style.height="100%",o.style.top="0",o.style.left="0",r.appendChild(o);var a=document.createElement("div");a.style.position="absolute",a.style.left="50%",a.style.top="50%",a.style.transform="translate(-50%,-50%)",a.style.background="var(--signerBgClr"+n+")";var s=document.createElement("div");s.style.position="absolute",s.style.width="22px",s.style.height="22px",s.style.margin="-3px",s.style.backgroundColor="var(--signerclr"+n+") !important",a.appendChild(s);var l=document.createElement("i");l.classList.add("zbutton__icon","ui-no-margin-right","ui-sprit-fast","esignerfield-icon-image"),a.appendChild(l),r.appendChild(a),e.appendChild(r),this.spanPortion.appendChild(e)},createSignerImageFieldTypes:function(){var e=this.getFormat(!0);if(this.isInlineImage())if(this.isSignerStampField())this.createSignerStampField();else if(this.isSignerImageField())this.createSignerImageField();else{var t=this.getDomViewManager().getDOMObj(this.nodeLine.getView()),i=t.getImage(e);i.querySelector("image").classList.add(_),e.src&&this.isSignerField()&&i.classList.add("zw-esign-signature"),this.spanPortion.appendChild(i)}else this.skipFloatingSignerFields()||(this.isSignerStampField()?this.createSignerStampField():this.isSignerImageField()&&this.createSignerImageField())},createMapField:function(e){var t=this.getDomViewManager().getDOMObj(this.nodeLine.getView()),i=t.createMapField(e),n=i.querySelector("image");n&&n.classList.add(_),this.spanPortion.appendChild(i)},createChartField:function(){var e=this.getFormat();if(this.isInlineImage()){var t=this.getDomViewManager().getDOMObj(this.nodeLine.getView()),i=t.createChartField(e);this.spanPortion.appendChild(i)}},createChartImage:function(){if(this.isInlineImage()){var e=this.getFormat(),t=this.getDomViewManager().getDOMObj(this.nodeLine.getView()),i=t.createChartImage(e),n=i.querySelector("image");n&&n.classList.add(_),e.src&&this.getDomViewManager().isEditMode()&&!this.isLiveWidget()&&ChartView.addElements(i,e),this.spanPortion.appendChild(i)}},createWidget:function(){var e=this.getFormat(!0);if(e=WidgetView.formatMigration(e),this.isInlineImage())if(this.isMapWidget())this.createMapField(e);else{var t=this.getDomViewManager().getDOMObj(this.nodeLine.getView()),i=t.createWidget(e),n=i.querySelector("image");n&&n.classList.add(_),e.src&&this.getDomViewManager().isEditMode()&&!this.isLiveWidget()&&WidgetView.addElements(i,e),this.spanPortion.appendChild(i)}},constructInlineImage:function(){var e=this.getDomViewManager().getDOMObj(this.nodeLine.getView()),t=this.getFormat(),i=e.getImage(t),n=i.querySelector("image");n&&n.classList.add(_),this.spanPortion.appendChild(i)},createDigiSignField:function(){var e=this.getFormat(),t=DomUtil.createDigiSignField(e);this.spanPortion.appendChild(t)},createFillableImageField:function(){var e=this.getFormat(!0);if(DomUtil.setFillableFieldAttr(this.spanPortion,e),this.isInlineImage()){var t=this.getDomViewManager().getDOMObj(this.nodeLine.getView()),i=t.createImageField(e),n=i.querySelector("image");n&&n.classList.add(_),(e.src&&" "===e.src||!e.src&&!this.isTextBox())&&(DomUtil.addFillImage(i,e,this.rangeStartFormat),e.src&&i.classList.add(b.FILL_CHECKBOX)),this.spanPortion.appendChild(i)}},createFillableField:function(){var e=this.createSpan();e.classList.add(NODE_TYPE.FILLABLEFIELD);var t=this.rangeStartFormat[ATTR_FILLABLEFIELD.FF_HELP_TEXT];t&&e.setAttribute("title",t);var i=this.rangeStartFormat[ATTR_FILLABLEFIELD.FF_DISABLED]||!1;i&&e.classList.add(b.DISABLED);var n=this.rangeStartFormat[ATTR_FILLABLEFIELD.FF_TYPE];switch(n){case FILLABLEFIELD_TYPE.RADIO:case FILLABLEFIELD_TYPE.MULTIPLECHOICE:case FILLABLEFIELD_TYPE.CHECKBOX:e.classList.add(P,b.FILL_CHECKBOX);break;case FILLABLEFIELD_TYPE.SELECTBOX:!this.getDomViewManager().isEditMode()&&this.getDomViewManager().isFillMode()&&e.classList.add(b.COMBO),e.style.display="inline-block";break;default:e.classList.add(N)}var r=editor.doc.getRawFormatAt(this.getAbsStart()+1),o=this.nodeLine.getView().getParaStyles().textFormat,a=DTUtils.getFillableFieldWidth(r,o,this.rangeStartFormat),s=DTUtils.getFillableFieldHeight(this.rangeStartFormat,r);return null!=a&&null!=s&&(e.style.width=a+"px",e.style.height=s+"px",e.style.verticalAlign="bottom"),e},createSignerField:function(){var e;e=this.isSignerStampField()||this.isSignerImageField()?this.getFormat():this.rangeStartFormat;var t=this.createSpan();t.classList.add(NODE_TYPE.SIGNERFIELD);var i=e[ATTR_SIGNERFIELD.SFINFO];if(i&&(e[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.DIGISIGN||i[ATTR_SIGNERFIELD.SIGNTYPE]===SIGN_TYPE.DIGISIGN)){if("en"===editorProps.userInfo.language){var n=i[ATTR_SIGNERFIELD.SFTYPE];n=ZOHOSIGN_TAG[n],n=(i[ATTR_SIGNERFIELD.RECIPIENT]?i[ATTR_SIGNERFIELD.RECIPIENT]+"'s ":"")+n,n&&t.setAttribute("title",n)}var r=parseInt(i[ATTR_SIGNERFIELD.RECIPIENT].replace(/\D/g,"")),o=(i[ATTR_SIGNERFIELD.SFTYPE]||SIGNERFIELD_TYPE.SIGNATURE).toLowerCase();o=o===SIGNERFIELD_TYPE.CUSTOMDATE?SIGNERFIELD_TYPE.DATE:o,t.classList.add("signerfield-recipient"+r),this.isSignerStampField()||this.isSignerImageField()||t.classList.add("esignerfield","esignerfield-icon-"+o)}return t.style.display="inline-block",t.style.overflow="hidden",t.style.width=e.wid+"px",t.style.height=e.ht+"px",this.isSignerStampField()||this.isSignerImageField()?(this.spanPortion.style.display="inline-block",this.spanPortion.style.width=e.wid+"px",this.spanPortion.style.height=e.ht+"px"):t.style.verticalAlign="bottom",t},createMergeField:function(){var e=this.createSpan();e.classList.add(NODE_TYPE.MAILMERGEFIELD);var t=this.rangeStartFormat.mminfo;if(t&&"checkbox"===t.type?e.classList.add(P):e.classList.add(N),this.isFloatingField()){var i=0,n=0;null!=this.rangeStartFormat[ATTR_IMAGE.I_WID]&&(i=Math.round(this.rangeStartFormat[ATTR_IMAGE.I_WID])+"px"),null!=this.rangeStartFormat[ATTR_IMAGE.I_HT]&&(n=Math.round(this.rangeStartFormat[ATTR_IMAGE.I_HT])+"px"),e.style.width=i,e.style.height=n}return e},constructEOPPortion:function(){var e=document.createElement("span"),n=this.nodeLine.getView().getParaStyles();this.allowTCStyles&&n&&n.hasOwnProperty(TCConstants.TC)&&TcView.setPilcrowStyle(e,n),this.getDomViewManager().isEditMode()||e.classList.add(i),e.classList.add(t);for(var r=(n[ATTR_COMMON.CLS]||"").split(" ")||[],o=0;o<r.length;o++)r[o]&&e.classList.add(r[o]);e.innerHTML="&nbsp;",e.style.paddingLeft=this.segment.left+"px",this.spanPortion=e},getAbsStart:function(){return this.nodeLine.getView().getNodeStartIndex()+this.segment.start},getAbsEnd:function(){return this.nodeLine.getView().getNodeStartIndex()+this.segment.end}}),e}(),LineDomView=function(){function e(e,t,i){this.el=null,this.domViewManager=t,this.paraDOMObj=i,this.docView=e,this.nodeLine=e,this.docId=this.nodeLine.id,this.allowTCStyles=!0,this.lineDomBuilder=null,this.createLine()}var t="EOP",i="zw-text-portion";extend(e.prototype,{getDocId:function(){return this.docId},getDocView:function(){return this.nodeLine},getEOPPortion:function(){return this.el.querySelector("."+t)},getAllTextSpanPortions:function(){return this.el.querySelectorAll("."+i)},getDocView:function(){return this.docView},remove:function(){this.el.remove()},createLine:function(){var e=new LineDOMBuilder(this.nodeLine,this.domViewManager,null);this.lineDomBuilder=e;var t=this.nodeLine,i=t.getView(),n=i.getSection();n.isRemoveInProgress||n.isDirtyNode(i)?(this.isPartialBuild=!0,this.constuctAndAppendLineDom()):(this.el=e.build(),this.paraDOMObj.el.appendChild(this.el),this.postProcessLineCreation(),this.updateLineStyle(),this.updateListNumber(),this.updatePageCountInLine(),this.updatePageNumberInLine(),this.isPartialBuild=!1,this.lineDomBuilder=null)},buildLine:function(){var e=this.lineDomBuilder;this.el=e.build(!0),this.postProcessLineCreation(),this.updateLineStyle(),this.updateListNumber(),this.updatePageCountInLine(),this.updatePageNumberInLine(),this.isPartialBuild=!1,this.lineDomBuilder=null},constuctAndAppendLineDom:function(){var e=this.lineDomBuilder;this.el=e.createLineDiv(),this.paraDOMObj.el.appendChild(this.el)},updateLine:function(e){this.updateNodeLine(e);var t=this.nodeLine,i=t.getView(),n=this.domViewManager.getDOMObj(i),r=new LineDOMBuilder(this.nodeLine,this.domViewManager,null),o=r.build();return n.el.childElementCount?(n.el.insertBefore(o,this.el),this.removeLine()):n.el.appendChild(o),this.postProcessLineCreation(),this.el=o,this.updateLineStyle(),this.updateListNumber(),this.updatePageCountInLine(),this.updatePageNumberInLine(),this.isPartialBuild=!1,this},updateNodeLine:function(e){this.nodeLine=e,this.isPartialBuild&&this.lineDomBuilder.updateNodeLine(e)},updateLineStyle:function(){var e=this.nodeLine,t=e.getBorderStyles(),i=e.getPaddingStyles();this.el.removeAttribute("style");var r="white-space: nowrap; position: relative; box-sizing: content-box; ";r+="height: "+e.getHeight(!0)+"px; ";var o=e.getView().getRawFormat();if("exact"===o[ATTR_PARAGRAPH.PS_LINE_RULE]){r+="overflow: hidden; ";var a=this.el.querySelector(".zw-line-content");a.style.position="absolute",a.style.bottom="0px",a.style.height=e.getContentHeight()+"px"}for(var s in t)t.hasOwnProperty(s)&&(r+=s===ATTR_BORDERS.BORDER_RADIUS?n(t[s]):s+": "+t[s].width+"px "+t[s].type+" "+t[s].color+"; ");for(var s in i)r+=s+": "+i[s]+"px; ";var l=e.getSpacingStyles();for(var d in l)l.hasOwnProperty(d)&&!["spaceBefore","spaceAfter"].contains(d)&&(r+=d+": "+l[d]+"px; ");var c=e.getLeftRightForRendering();r+="padding-left: "+c.left+"px; padding-right: "+c.right+"px; ",this.el.setAttribute("style",r),this.setBackgroundLayer()},removeLine:function(){this.el.remove()},setBackgroundLayer:function(){var e=this.nodeLine,t=this.el.querySelector("div.zw-line-background");t||(t=document.createElement("div"),t.className="zw-line-background");var i=e.getBackgroundStyles();if(ZWJSONUtils.isEmptyObject(i))return void t.remove();t.removeAttribute("style");var r="height: "+i.height+"px; width: "+i.width+"px; background-color: "+i.color+"; z-index: "+ZINDEX.PARA_BACKGROUND+"; top: 0px; left: 0px; position: absolute; ";i.radius&&(r+=n(i.radius)),t.setAttribute("style",r),this.el.appendChild(t)},updateListNumber:function(){var e=this.nodeLine,t=e.getView();if(!t.getSection().isDirtyNode(t)&&0===e.start){var i=J(this.domViewManager.getDOMElem(t)),n=J(this.el),r=n.find(".zw-line-content").first().css("marginLeft",0);if(!t.getDTView().isList())return n.find(".zw-bullet").not(DomUtil.excludeTextBox.bind(null,i)).remove();if(0===t.start&&!U.isEmpty(t.dtView.getListData())){var o=t.dtView.getListData(),a="http",s=J("<span>").addClass("zw-bullet").attr("style",o.listStyle),l=n.find("span.zw-bullet").not(DomUtil.excludeTextBox.bind(null,i))[0],d=t.getParaProperties().listData.listType;if(o.listNumberString.length)s.text(o.listNumberString);else{var c=t.getParaProperties().listData.listImageData;if(c.hasOwnProperty("svg_id")){var u=c.svg_id,g=SVG_FOR_LISTS[u].svg;s[0].innerHTML=g;var h=J(s).children()[0];J(h).attr({width:c.wid,height:c.ht,xmlns:a+"://www.w3.org/2000/svg"})}else{var f=DomUtil.createImage(c);J(f).removeClass("zw-image").addClass("zw-bullet-image"),s.append(f)}}d===LIST_TYPE.DISC||d===LIST_TYPE.CIRCLE||d===LIST_TYPE.BOX||d===LIST_TYPE.SYMBOL?s.addClass("zw-bullet-unorder-list"):d===LIST_TYPE.UPPER_ROMAN||d===LIST_TYPE.LOWER_ROMAN||d==LIST_TYPE.DECIMAL||d===LIST_TYPE.LOWER_ALPHA||d===LIST_TYPE.UPPER_APLHA?s.addClass("zw-bullet-order-list"):d===LIST_TYPE.IMAGE&&s.addClass("zw-bullet-image-list"),o.isRomanList&&r.css("marginLeft",-o.listCharSize.width);var p=s.css("text-decoration")||"";/(line-through|none)/.test(p.trim())||s.css("text-decoration","none"),l?J(l).before(s).remove():r[0]&&r.children().first().before(s)}}},postProcessLineCreation:function(){var e=this.nodeLine,t=e.getView(),i=t.getSection();i.getSectionType()!==SECTION_TYPES.ENDNOTE&&i.getSectionType()!==SECTION_TYPES.FOOTNOTE||i.isFirstView(t)&&0==t.getStart()&&this.domViewManager.updateNoteChar(i)},updatePageCountInLine:function(){var e=this.nodeLine.getSection();if(e.sectionType!==SECTION_TYPES.HEADER&&e.sectionType!==SECTION_TYPES.FOOTER){var t=e.getGroup(),i=t.getRelativePageCount();W(this.el).find("span.autopcnt.isrelcnt").find("span."+CONST.FIELD_TEXT_NODE).text(i),i=t.documentLayoutManager.getPageCount(),W(this.el).find("span.autopcnt.isabscnt").find("span."+CONST.FIELD_TEXT_NODE).text(i)}},updatePageNumberInLine:function(){var e=this.nodeLine,t=e.getSection();if(t.sectionType!==SECTION_TYPES.HEADER&&t.sectionType!==SECTION_TYPES.FOOTER){var i=W(this.el),n=i.find("span.autopno_toc");if(n.length){var r,o;if(o=editor.doc.findNextIndexOf(UNICODE.TOCSTART,0),o>0){var a=editor.doc.getRawFormatAt(o);r=!a||a.showNo}for(var s=!1,l=e.segments,d=l.length,c=d-1;c>=0;c--){var u=l[c],g=u.format;if(g&&g.type==NODE_TYPE.AUTOFIELD&&g.ftype==AUTOFIELD_TYPE.AUTO_PAGE_REF){s=!0;break}}if(!s)try{var h=i.find('[data-type="2"]')[0].getAttribute("data-href"),f=DocUtil.getFloatElementIdx(null,h);if(f){try{var p=DocLayoutManager.getPageAtIndex(f)}catch(e){p=null}var E=p&&p.getAbsolutePageNumber()||1;n.find("span."+CONST.FIELD_TEXT_NODE).text(E)}}catch(e){}r||n.find("span."+CONST.FIELD_TEXT_NODE).hide()}var p=t.getPage(),T=i.find("span.autopno");if(T.length&&p){var O=p.getPageNumber();T.find("span."+CONST.FIELD_TEXT_NODE).text(O)}}}});var n=function(e){var t="";for(var i in e)if(e.hasOwnProperty(i))switch(i){case ATTR_BORDERS.RADIUS_TOPLEFT:t+="border-top-left-radius: "+e[i]+"px; ";break;case ATTR_BORDERS.RADIUS_TOPRIGHT:t+="border-top-right-radius: "+e[i]+"px; ";break;case ATTR_BORDERS.RADIUS_BOTTOMLEFT:t+="border-bottom-left-radius: "+e[i]+"px; ";break;case ATTR_BORDERS.RADIUS_BOTTOMRIGHT:t+="border-bottom-right-radius: "+e[i]+"px; "}return t};return e}(),HFCloneDOMView=function(){function e(e,t){this.name="hfcloneview",this.docView=e.docView,this.domSource=e,this.domViewManager=this.domSource.domViewManager,this.id=Utils.randomId(this.name),this.page=t,this.wrapper=null,this.content=null,this.el=null,this.floatImageContainer=null,this.create()}return extend(e.prototype,{create:function(){this.wrapper=J(this.domSource.getWrapper()).clone(!0)[0],this.floatImageContainer=this.wrapper.querySelector(".float-image-"+this.docView.getSectionType()+"-container"),this.update()},update:function(){null!=this.content&&W(this.content).remove();var e=W(this.domSource.getContent()).clone(!0);e.appendTo(this.wrapper),this.content=e[0],null!=this.floatImageContainer&&W(this.floatImageContainer).remove();var t=J(this.domSource.getFloatImageContainer()).clone(!0);t.appendTo(this.wrapper),this.floatImageContainer=t[0],this.el=this.content.querySelector(".hf_content"),this.pageNumberFields=W([this.el,this.floatImageContainer]).find("span.autopno").find("span."+CONST.FIELD_TEXT_NODE),this.relativePageCountFields=W([this.el,this.floatImageContainer]).find("span.autopcnt.isrelcnt").find("span."+CONST.FIELD_TEXT_NODE),this.absolutePageCountFields=W([this.el,this.floatImageContainer]).find("span.autopcnt.isabscnt").find("span."+CONST.FIELD_TEXT_NODE),this.updateAnchorIcon();var i=J(this.el).find("div.lock-overlay"),n=this.domViewManager.getDocLayoutManager().getCurrentSection(),r=this.domSource.getSelectableSectionClass();W(this.wrapper).removeClass("unselectableSection").addClass(r),W(this.floatImageContainer).removeClass("unselectableSection").addClass(r),n&&HF_SECTIONS.contains(n.getSectionType())&&i.length>0&&(LockView.bindEvents(i),LockView.drawOverLay())},updateAnchorIcon:function(){for(var e=this.content,t=W(e).find(".writer-glyphs-anchored-object"),i=0,n=t.length;i<n;i++){var r=t[i];r.removeEventListener("click",DomUtil.onAnchorClick),r.addEventListener("click",DomUtil.onAnchorClick)}},getDocId:function(){return this.docView.getId()},remove:function(){W(this.wrapper).remove(),this.destroy()},destroy:function(){this.wrapper=null,this.content=null,this.el=null,this.page=null,this.domSource=null,this.docView=null,this.domSource=null,this.domViewManager=null},getType:function(){return this.docView.getType()}}),e}(),HFDOMTemplate=function(e,t){"use strict";var i=e.i18n("common","DOUBLE_CLICK_TO_EDIT_HEADER"),n=e.i18n("common","DOUBLE_CLICK_TO_EDIT_FOOTER"),r={header:{container:{hfcontainerclass:"header_primary ui-hf-container"},flagdata:{flagcontent:e.i18n("common","HEADER_OPTIONS"),dblclkcontent:i}},header_first:{container:{hfcontainerclass:"header_primary ui-hf-container fst_header_primary"},flagdata:{flagcontent:e.i18n("common","HEADER_FIRST_PAGE"),dblclkcontent:i}},header_even:{container:{hfcontainerclass:"header_primary ui-hf-container even_header_primary"},flagdata:{flagcontent:e.i18n("common","HEADER_EVEN"),dblclkcontent:i}},header_odd:{container:{hfcontainerclass:"header_primary ui-hf-container odd_header_primary"},flagdata:{flagcontent:e.i18n("common","HEADER_ODD"),dblclkcontent:i}},footer:{container:{hfcontainerclass:"footer_primary ui-hf-container"},flagdata:{flagcontent:e.i18n("common","FOOTER_OPTIONS"),dblclkcontent:n}},footer_first:{container:{hfcontainerclass:"footer_primary ui-hf-container fst_footer_primary"},flagdata:{flagcontent:e.i18n("common","FOOTER_FIRST_PAGE"),dblclkcontent:n}},footer_even:{container:{hfcontainerclass:"footer_primary ui-hf-container even_footer_primary"},flagdata:{flagcontent:e.i18n("common","FOOTER_EVEN"),dblclkcontent:n}},footer_odd:{container:{hfcontainerclass:"footer_primary ui-hf-container odd_footer_primary"},flagdata:{flagcontent:e.i18n("common","FOOTER_ODD"),dblclkcontent:n}}},o="<div style='position: relative;' class='unselectableSection ##hfcontainerclass##'></div>",a="<div class='ui-hf-options'><span class='ui-hdr-ftr-opt js-hfedit' onclick='PanelUtil.toggleHeaderFooter();'>##flagcontent##</span><span class='ui-hf-opt-seprate'></span><div class='ui-hdr-ftr-exit' onclick='PanelUtil.closeHeaderFooter(this, event);'>"+e.i18n("writer.common.EXIT")+"</div></div><div class='ui-hf-dbl-clk'><div class='ui-hf-dbl-clk-text'>##dblclkcontent##</div></div>",s={},l=function(){var e,t,i,n,l,d,c="",u="";for(e in r){t=r[e],l=t.container,c=o,u=a;for(i in l)n=l[i],c=c.replace("##"+i+"##",n);d=t.flagdata;for(i in d)n=d[i],u=u.replace("##"+i+"##",n);s[e]={containerHTML:c,flagHTML:u}}};l();var d=function(e,i){var n=s[e],r=t.createDOM(n.containerHTML);return i&&r.html(n.flagHTML),r[0]};return{getWrapper:d}}(J,W),NoteDOMTemplate=function(e,t){"use strict";var i={endnote:{replaceData:{notewrapperclass:"zw-endnote-wrapper",notecontainerclass:"zw-endnotecontainer"}},footnote:{replaceData:{notewrapperclass:"zw-footnote-wrapper",notecontainerclass:"zw-footnotecontainer"}}},n="<div style='position: relative; display: none' class='##notewrapperclass##'><div style='position: relative;' class='##notecontainerclass##'><div class='endnotestyl'></div><div class='ui-note-content-wrapper'><div></div></div>",r={},o=function(){var e,t,o,a,s="";for(e in i){t=i[e],a=t.replaceData,s=n;for(o in a)s=s.replace("##"+o+"##",a[o]);r[e]={containerHTML:s}}};o();var a=function(e){var i=r[e],n=t.createDOM(i.containerHTML);return n[0]};return{getWrapper:a}}(J,W),SectionDomView=function(){"use strict";function e(e,t){this.elClassStr=this.elClassStr||"",this.container=null,DomView.apply(this,arguments)}return e.prototype=Object.create(DomView.prototype),e.prototype.constructor=e,extend(e.prototype,{create:function(){var e=document.createElement("div");e.className=this.getSelectableSectionClass()+" "+this.elClassStr,this.el=e,this.container=document.createElement("div"),this.el.appendChild(this.container),this.updateStyle()},destroy:function(){DomView.prototype.destroy.apply(this,arguments),this.elClassStr="",this.container=null},update:function(){this.updateStyle()},getSelectableSectionClass:function(){var e=this.domViewManager.getDocLayoutManager().getCurrentSection();return e&&e.isReplicableView()?"unselectableSection":"selectableSection"},updateStyle:function(){var e={width:this.docView.getDOMViewWidth()+"px",height:this.docView.getDOMViewHeight()+"px",position:"relative",marginLeft:this.docView.getLeft()+"px",marginRight:this.docView.getRight()+"px"};J(this.el).css(e),this.container.style.width=this.docView.getDOMViewWidth()+"px",this.container.style.height=this.docView.getDOMViewHeight()+"px"},addColumn:function(e){this.container.appendChild(e.wrapper)},getContentContainer:function(){return this.container},getPrevEl:function(){for(var e=null,t=this.docView.prev;t&&(e=this.domViewManager.getDOMElem(t),!e||!e.parentElement);)e=null,t=t.prev;return e}}),e}(),NoteDomView=function(){"use strict";function e(e,t){this.elClassStr="zw-notepane",this.noteCharElem=null,SectionDomView.apply(this,arguments)}return e.prototype=Object.create(SectionDomView.prototype),e.prototype.constructor=e,extend(e.prototype,{updateStyle:function(){var e={width:this.docView.getDOMViewWidth()+"px",height:this.docView.getDOMViewHeight()+"px",position:"relative",marginLeft:"0px",marginRight:"0px"};J(this.el).css(e),this.container.style.width=this.docView.getDOMViewWidth()+"px",this.container.style.height=this.docView.getDOMViewHeight()+"px"},destroy:function(){SectionDomView.prototype.destroy.apply(this,arguments),this.removeNoteChar()},removeNoteChar:function(){this.noteCharElem&&(W(this.noteCharElem).remove(),this.noteCharElem=null)},updateNoteChar:function(){var e=this.docView.getFirstView(),t=this.domViewManager.getDOMObj(e);if(t){this.removeNoteChar();var i=W(t.el).find(".zw-line-content")[0];if(i){var n=this.docView.getNodeId(),r=this.docView.getReferenceChar(),o=W.createDOM("<span></span>").addClass("endnotenum").html(r).attr({fid:n}).css({cursor:"pointer"});this.noteCharElem=DomUtil.getVerticalAlignContainerSpan({size:10}),o.appendTo(this.noteCharElem),J(o[0]).click(function(){Note.moveToNoteRange(J(this).attr("fid"))}),W(i).prepend(this.noteCharElem)}}},addViewToDOM:function(){var e=this.getPrevEl(),t=this.docView.getPage(),i=this.domViewManager.getDOMObj(t),n=this.docView.getSectionType(),r=i.getContainerObj(n);e?W(this.el).insertAfter(e):W(r.contentWrapper).prepend(this.el)}}),e}(),TextBoxDomView=function(){"use strict";function e(e,t){this.container=null,this.pseudo=null,this.elClassStr="zw-textbox-div",SectionDomView.apply(this,arguments)}var t=10,i=4,n=function(){return(this.pseudo.style.marginTop||"0px").convertor().pixels},r=function(){return(this.pseudo.style.marginLeft||"0px").convertor().pixels},o={45:function(){var e={};return e["margin-top"]=n.call(this)+t,e["margin-left"]=r.call(this)+t,e},90:function(){var e={};return e["margin-top"]=n.call(this)+t,e},135:function(){var e={};return e["margin-top"]=n.call(this)+t,e["margin-left"]=r.call(this)-t,e},0:function(){var e={};return e["margin-left"]=r.call(this)+t,e},180:function(){var e={};return e["margin-left"]=r.call(this)-t,e},315:function(){var e={};return e["margin-top"]=n.call(this)-t,e["margin-left"]=r.call(this)+t,e},270:function(){var e={};return e["margin-top"]=n.call(this)-t,e},225:function(){var e={};return e["margin-top"]=n.call(this)-t,e["margin-left"]=r.call(this)-t,e},NONE:function(){return{}}};return e.prototype=Object.create(SectionDomView.prototype),e.prototype.constructor=e,extend(e.prototype,{create:function(){this.createContainer(),this.createContent(),this.createPseudo(),this.createEl(),this.container.appendChild(this.content),this.el.appendChild(this.container),this.el.appendChild(this.pseudo),this.updateStyle()},createEl:function(){var e=document.createElement("div");e.id=this.docView.getId(),e.setAttribute("doc-id",this.docView.getId()),e.className="zw-textbox-div",e.style.position="absolute",e.style.zIndex=ZINDEX.FLOAT_IMG_FRONT,this.el=e},createContainer:function(){var e=document.createElement("div");e.className="zw-textbox-content",e.style.cursor="move",e.style.position="absolute",this.container=e},createPseudo:function(){var e=document.createElement("div");e.className="zw-textbox-pseudo",e.style.position="absolute",e.style.zIndex=-1,e.style.display="none",this.pseudo=e},createContent:function(){var e=document.createElement("div");e.className="zw-textbox-align",e.style.position="absolute",e.style.overflow="hidden",this.content=e},getContainingParaDomIns:function(){var e=this.docView.getContainingPara();return this.domViewManager.getDOMObj(e)},addViewToDOM:function(e){e&&e.appendChild(this.el)},getContentContainer:function(){return this.content},updateInlineStyles:function(e){var t=this.domViewManager.documentLayoutManager,n=this.docView.getDTView().getRangeIndex();this.el.style.left=t.getLeftAtIndex(n)+"px";var r=e.getSpacingStyles();this.el.style.bottom=i+(r["margin-bottom"]||0)+"px",this.el.style.removeProperty("top")},updateStyle:function(){this.updateContentTop(),this.setRotation(),this.setOpacity(),this.setDimensions(),this.setBorders(),this.setMargin(),this.setBackground(),this.setPadding(),this.applyShadows(),this.updateFloatingStyles(),this.updateFieldStyles(),this.setLinkData()},setRotation:function(){var e=this.docView,t=e.getRotation(),i=this.container,n=this.pseudo;if(t){var r="rotate("+t+"deg)",o=(e.getDOMViewWidth({shouldTransform:!0})-e.getDOMViewWidth())/2,a=(e.getDOMViewHeight({shouldTransform:!0})-e.getDOMViewHeight())/2,s={"-ms-transform":r,"-moz-transform":r,"-webkit-transform":r,"-o-transform":r,transform:r,position:"absolute",top:a+"px",left:o+"px"};J(i).css(s),J(n).css(s)}else{var s={height:"",width:""};J(this.el).css(s),s=e.isFloating()?{position:"absolute",top:"0px",left:"0px"}:{position:"",top:"",left:""},s.transform="",J(i).css(s),s={transform:"",top:"0px",left:"0px"},J(n).css(s)}},setOpacity:function(){var e=this.docView.getOpacity();this.container.style.opacity=e,this.pseudo.style.opacity=e,editor.browserInfo.is_ie&&(this.container.style.filter="alpha(opacity="+e+")",this.pseudo.style.filter="alpha(opacity="+e+")")},setDimensions:function(){var e=this.docView,t=e.getDOMViewHeight({includeBorders:!0}),i=e.getDOMViewWidth({includeBorders:!0});this.container.style.width=i+"px",this.container.style.height=t+"px",this.pseudo.style.width=i+"px",this.pseudo.style.height=t+"px";var n=this.el.style;e.getWrapType()?(n.width="",n.height=""):(n.width=e.getDOMViewWidth({shouldTransform:!0,includeBorders:!0})+"px",n.height=e.getDOMViewHeight({shouldTransform:!0,includeBorders:!0})+"px")},setBorders:function(){var e=this.docView.getRangeFormat(),t=DomUtil.getBorderStyles(e);J(this.container).css(t)},setMargin:function(){var e=this.docView.getOuterMargin(),t={};t["margin-bottom"]=e.bottom,t["margin-right"]=e.right,t["margin-top"]=e.top,t["margin-left"]=e.left,J(this.container).css(t),J(this.pseudo).css(t)},setBackground:function(){var e=this.docView,t=this.container,i=e.getBackground();if(t.style.removeProperty("background"),i)switch(i.type){case"image":var n=DomUtil.processImgSrc(i.data),r="url('"+n+"')";t.style.background=r,t.style.backgroundSize="100% 100%";break;case"color":t.style.background=i.data}},setPadding:function(){var e=this.docView,t=e.getMargin();J(this.content).css({width:e.getDOMViewWidth({includePadding:!1}),height:e.getDOMViewHeight({includePadding:!1}),"margin-top":t.top,"margin-left":t.left,"margin-right":t.right,"margin-bottom":t.bottom})},getComputedColor:function(){var e=DocLayoutManager.getBackgroundColor(),t="rgba(0,0,0,0.15)",i=t.match(/\d+\.*\d*/g),n={};n.R=i.shift()/255,n.G=i.shift()/255,n.B=i.shift()/255,n.A=i.shift()/1;var r=e.match(/\d+\.*\d*/g),o={R:r.shift()/255,G:r.shift()/255,B:r.shift()/255},a={};return a.R=parseInt(255*((1-n.A)*o.R+n.A*n.R)),a.G=parseInt(255*((1-n.A)*o.G+n.A*n.G)),a.B=parseInt(255*((1-n.A)*o.B+n.A*n.B)),"rgb("+a.R+","+a.G+","+a.B+")"},getBorderStyle:function(){var e={},i=this.docView.getRangeFormat(),n=!!this.docView.getBackground(),r=t+"px solid "+this.getComputedColor(),o=this.getComputedColor()+" 0px 0px "+t+"px 0px";if(!n){var a=ZWJSONUtils.clone(i);if(a[ATTR_COMMON.BORDERS]){a[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP]&&(a[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.COLOR]=this.getComputedColor());var s=DomUtil.getBorderStyles(a);r=s[ATTR_BORDERS.BORDER_TOP],o=this.getComputedColor()+" 0px 0px "+a[ATTR_COMMON.BORDERS][ATTR_BORDERS.BORDER_TOP][ATTR_BORDERS.WIDTH]+" 0px"}}return e.border=r,e.shadow=o,e},applyShadows:function(){var e=this.docView.getEffects();if(e&&e.shadow){var t=e.shadow,i=!!this.docView.getBackground(),n=o[t]?o[t]:o.NONE,r=n.call(this),a=this.getBorderStyle();r.border=a.border,r["box-shadow"]=a.shadow,i?r["background-color"]=this.getComputedColor():r["background-color"]="",J(this.pseudo).css(r),"NONE"===e.shadow?this.pseudo.style.display="none":this.pseudo.style.display="block"}},updateContentTop:function(e){if(!this.docView.isEmpty()){var t=this.docView.getFirstView(),i=this.domViewManager.getDOMElem(t);i&&(e&&e.docView.id!=t.id?e.el.style.marginTop="0px":i.style.marginTop=this.docView.getMarginTop()+"px")}},addColumn:function(e){this.content.appendChild(e.wrapper)},updateFloatingStyles:function(){var e=this.docView;e.isFloating()&&(this.el.style.removeProperty("bottom"),e.getWrapType()===IMAGE_ALIGN.BEHIND?(this.el.style.zIndex="0",this.el.classList.add("zw-textbox-behind")):(this.el.classList.remove("zw-textbox-behind"),this.el.classList.remove("zw-textbox-behind-active")))},updateFieldStyles:function(){var e=this.docView.isFillableField();if(e){var t=this.docView.getRangeFormat(),i=this.container;DomUtil.setFillableFieldAttr(i,t)}},setLinkData:function(){var e=this.docView.getLinkData();if(e&&!ZWJSONUtils.isEmptyObject(e)){var t='{"data-link-url":"'+e.url+'","data-link-type":"'+e.type+'"}';this.container.setAttribute("linkData",t)}}}),e}(),ContentDomView=function(){"use strict";function e(e,t){this.elClassStr="zw-contentpane",SectionDomView.apply(this,arguments)}return e.prototype=Object.create(SectionDomView.prototype),e.prototype.constructor=e,extend(e.prototype,{addViewToDOM:function(){var e=this.getPrevEl(),t=this.docView.getPage(),i=this.domViewManager.getDOMObj(t);e?W(this.el).insertAfter(e):W(i.contentWrapper).prepend(this.el)}}),e}(),HFDomView=function(e,t,i){"use strict";function n(e,t){this.content=null,this.wrapper=null,this.floatImageContainer=null,this.elClassStr="hf_content",SectionDomView.apply(this,arguments)}return n.prototype=Object.create(SectionDomView.prototype),n.prototype.constructor=n,extend(n.prototype,{create:function(){this.el=document.createElement("div"),this.el.className=this.elClassStr,this.content=document.createElement("div"),this.content.appendChild(this.el);var e=this.domViewManager.documentLayoutManager.canEdit();this.wrapper=i.getWrapper(this.docView.name,e),this.floatImageContainer=document.createElement("div"),this.floatImageContainer.style.position="relative",this.wrapper.appendChild(this.floatImageContainer),this.floatImageContainer.className="float-image-"+this.docView.getSectionType()+"-container",this.updateStyle()},getSelectableSectionClass:function(){var e=this.domViewManager.getDocLayoutManager().getCurrentSection();return e&&e.isReplicableView()||DocLayoutManager.getDocumentViewType()==EDITORVIEW_TYPE.PUBLISH_VIEW?"selectableSection":"unselectableSection"},setDomProps:function(){this.content&&(this.content.setAttribute("doc-id",this.docView.getId()),this.content.setAttribute("node-id",this.docView.getNodeId()))},updateStyle:function(){var t=this.docView.getStyleInfo(this.docView.getPage()),i=t.paddingTop+"px 0px "+t.paddingBottom+"px 0px";this.el.style.padding=i;var n={padding:"0px "+t.marginRight+"px 0px "+t.marginLeft+"px","max-height":t.maxHeight+"px",height:t.height+"px"};e(this.content).css(n)},addColumn:function(e){this.el.appendChild(e.wrapper)},remove:function(){SectionDomView.prototype.remove.apply(this,arguments),e(this.wrapper).remove(),e(this.content).remove()},destroy:function(){SectionDomView.prototype.destroy.apply(this,arguments),this.wrapper=null,this.content=null},getContent:function(){return this.content},getWrapper:function(){return this.wrapper},getContentContainer:function(){return this.el},getFloatImageContainer:function(){return this.floatImageContainer},canDisplay:function(){return this.docView.canDisplay()}}),n}(W,Utils,HFDOMTemplate),FloatImageDomView=function(){"use strict";function e(e,t){this.floatImage=e,this.containerDomObj=t,this.el=null,this.create()}return extend(e.prototype,{shouldAppendImage:function(e){return e.hasOwnProperty("src")||"chart"==e.type},getId:function(){return this.floatImage.getId()},create:function(){var e=this.floatImage,t=this.getDocView(),i=t.getDTView(),n=e.getAbsIndex(),r=i.getRawFormatAt(n);r.hasOwnProperty(TCConstants.TC)&&(r=TcView.updateDOMStyles(r));var o;DomUtil.isTextBox(r)?o=this.containerDomObj.createTextBox(r):DomUtil.isMapWidget(r)?o=this.containerDomObj.createMapField(r):DomUtil.isWidgetField(r)?o=this.containerDomObj.createWidget(r):DomUtil.isChartImage(r)?o=this.containerDomObj.createChartImage(r):[NODE_TYPE.FILLABLEFIELD,NODE_TYPE.SIGNERFIELD,NODE_TYPE.MAILMERGEFIELD].contains(r[ATTR_COMMON.TYPE])?o=this.containerDomObj.createFloatingAutomationField(r,n):DomUtil.isImageSignerField(r)?o=this.containerDomObj.createFloatingImageSignerField(r,n):DomUtil.isImageFillableField(r)?(o=this.containerDomObj.createImageField(r),o.setAttribute("pid",e.getNodeId()),o.setAttribute("fid",e.getFId())):o=DomUtil.isChartField(r)?this.containerDomObj.createChartField(r):this.containerDomObj.getImage(r||{});var a=o;r[ATTR_COMMON.TYPE]==NODE_TYPE.IMAGE&&r[ATTR_COMMON.CLS]==NODE_TYPE.FILLABLEFIELD&&(a=o.children[0]),J(a).attr({pid:e.getNodeId(),fid:e.getFId()});var s=document.createElement("div");J(s).attr({pid:e.getView().getId()+"_id"}),this.shouldAppendImage(r)?(r[ATTR_WIDGET.SUBTYPE]&&(r[ATTR_WIDGET.SUBTYPE]==ATTR_WIDGET.WIDGET||r[ATTR_COMMON.SUBTYPE]==ATTR_CHART.CHART)&&editor.getRole().permissions.can("document.edit")&&r[ATTR_WIDGET.RENDERTYPE]!=ATTR_WIDGET.RENDERTYPE_LIVE&&(r[ATTR_COMMON.SUBTYPE]==ATTR_CHART.CHART?ChartView.addElements(o,r):WidgetView.addElements(o,r)),s.appendChild(o)):s.innerHTML=o.outerHTML;var l=ZINDEX.FLOAT_IMG_FRONT;l+=r.zindex?r.zindex:0;var d={position:"absolute","z-index":l},c=J(s),u=e.getPageOffset();if(d.left=u.left,d.top=u.top,"behind"===e.getWrapType()&&(d["z-index"]=ZINDEX.FLOAT_IMG_BEHIND,c.addClass("zw-float-behind")),c.css(d).addClass("zw-float"),r.service&&this.getDocView().appendPlayIcon(r,s,o),r.hasOwnProperty(TCConstants.TC)&&TcUtil.hasTCDeletion(r)){var g=TcView.getDiagonalLineSpan(r,s);g&&s.appendChild(g)}var h,f=this.getFloatImageContainer();if(e.isTextBox){h=t.getGroup().getDocViews(r.id)[0];var p=DomViewManager.getDOMObj(h),E=p.el;E.style.top=d.top+"px",E.style.left=d.left+"px",d["z-index"]=0,W(E).attr({pid:e.getView().getId()+"_id",fid:e.fid}),this.el=E,p.addViewToDOM(f)}else this.el=s,f.appendChild(this.el)},update:function(){this.el.parentNode.removeChild(this.el),this.create()},remove:function(){if(this.floatImage.isTextBox){var e=this.getDocView().getId()+"_id",t=this.el.getAttribute("pid");t==e&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)}else this.el.parentNode&&this.el.parentNode.removeChild(this.el);this.destroy()},getDocView:function(){return this.containerDomObj.docView},getFloatImageContainer:function(){if(this.floatImage.isNonWrappingImage()){var e=this.getDocView().getSection(),t=e.getSectionType();if(HF_SECTIONS.contains(t)){var i=DomViewManager.getDOMObj(e);return i.floatImageContainer}return this.containerDomObj.getPageDOM().getFloatImageContainer(t)}return this.containerDomObj.el},updatePosition:function(e){var t=this.floatImage.getPageOffset(e);this.el.style.left=t.left+"px",this.el.style.top=t.top+"px"},destroy:function(){this.el=null,this.containerDomObj=null,this.floatImage=null}}),e}(),ParaDomView=function(){"use strict";function e(e,t){this.rangeElements={},this.floatImagesMap={},DomView.apply(this,arguments)}return e.prototype=Object.create(DomView.prototype),e.prototype.constructor=e,extend(e.prototype,{create:function(){this.el=document.createElement("div"),this.updateStyle(),this.addOrUpdateFloatImages()},updateStyle:function(){this.el.className="zw-paragraph",J(this.el).attr("data-width",this.docView.getWidth());var e,t,i,n=this.docView.getParaStyles(),r={};if(this.docView.getSectionType()==SECTION_TYPES.TEXTBOX){var o=this.docView.getSection(),a=DomViewManager.getDOMObj(o);a.updateContentTop(this)}for(e in this.docView.getCommonStyles())t=n[e],i=this.docView.getCommonStyles()[e],e===ATTR_PARAGRAPH.PS_ML&&n[ATTR_PARAGRAPH.PS_DIR]===PARA_DIR.RTL&&(i=this.docView.getCommonStyles()[ATTR_PARAGRAPH.PS_MR]),t&&(r[i]=t);var s,l;this.docView.isRTLPara()?(l=this.docView.getOuterLeft(),s=this.docView.getWidth()-this.docView.getOuterRight()):(s=this.docView.getOuterLeft(),l=this.docView.getWidth()-this.docView.getOuterRight()),r.marginLeft=s+"px",r.marginRight=l+"px";for(var d=J(this.el),c=0;c<this.docView.getSpecialStyles().length;c++){if(e=this.docView.getSpecialStyles()[c],t=n[e],e===ATTR_PARAGRAPH.PS_TS){var u=this.docView.getLastNodeLine();if(u){for(var g,h=u.segments,f=h.length-1;f>=0;f--){var p=h[f];if(p.format&&"text"==p.format.type){g=p;break}}var E=g&&g.computedFormat.size||this.docView.getParaProperties().textFormat.size||this.docView.getParaStyles().textFormat.size;t={size:E}}}else if(!t&&0!=t)continue;if(e===ATTR_PARAGRAPH.PS_TPS)this.el.setAttribute("data-tabPoints",JSON.stringify(t));else if(e===ATTR_PARAGRAPH.PS_HD)t=t||0,d.attr({"data-header":t}).removeClass().addClass("zw-paragraph heading"+t);else if(e===ATTR_PARAGRAPH.PS_TS){var T,O=d.find("span.EOP")[0];O&&O.style.paddingLeft&&(T=O.style.paddingLeft),DomUtil.setStyle(O,t),n&&n.hasOwnProperty(TCConstants.TC)&&TcView.setPilcrowStyle(O,n),T&&(O.style.paddingLeft=T),d.attr({"data-textformat":JSON.stringify(t)})}else e===ATTR_PARAGRAPH.LS_DATA&&t&&t.id==editor.doc.getHeadingListId()&&d.attr({"data-hlist":"true"})}if(this.docView.getNode().isCode()&&d.addClass("code "+this.docView.getNode().getCodeTheme()),103===this.docView.getNode().getHeadingType()&&d.addClass("quote"),n.hasOwnProperty(TCConstants.TC)){var m=DocTreeManager.doc.getTrackChangeDetails().getDisplayMode();m===TCConstants.ORIGINAL_VIEW&&TcUtil.isAllWithTCInsertionInPara(this.docView.getNodeStartIndex(),this.docView.getNodeEndIndex())&&(n=TcView.updateDOMStyles(n),d.addClass(n[ATTR_COMMON.CLS]))}J.isEmptyObject(r)||J(this.el).css(r)},update:function(){this.updateStyle(),this.removeFloatImages(),this.addOrUpdateFloatImages()},remove:function(){this.removeFloatImages(),DomView.prototype.remove.call(this)},destroy:function(){DomView.prototype.destroy.apply(this,arguments),this.rangeElements={}},createTextBox:function(e){var t=DomUtil.createSvgImage(e);return DomUtil.addImageRotationStyles(t,e),t},createMapField:function(e){var t;if(e.hasOwnProperty(MAILMERGE.MMINFO)){var i=ImageCache.getRenderingImageData(e,null);if(t=i.image,"cached"===i.type&&t){var n=DocUtil.copyStyle(e);delete n[ATTR_IMAGE.I_SRC],DomUtil.applyStyleToSvgImage(J(t).children("svg").children("image")[0],n)}}else t=DomUtil.createMapField(e);return DomUtil.addImageRotationStyles(t,e),t},createChartField:function(e){var t,i,n=chartFieldDomUtil.getChartInfo(e.id)||{},r=W.get("#"+e.id),o=r.parent()[0],a=ZWJSONUtils.compareJSON(n.chart_info,e.chartDetails),s=!e.rotation,l=!e.wrapType;if(o&&(i=o.style.width===e.wid.toFixed(3)+e.wid_un&&o.style.height===e.ht.toFixed(3)+e.ht_un),o&&o.style.transform&&(s=o.style.transform.match(/\d/g).join("")==e.rotation),l&&!r[0]&&n&&e.hasOwnProperty(MAILMERGE.MMINFO)||o&&a&&(!i||!s)){var d;n&&(d=n.chart_config),t=chartFieldDomUtil.createChartField(e,d)}else a&&o?(e.wrapType&&["square","left","right"].indexOf(e.wrapType)!==-1?o.style.margin=e.mt+" "+e.mr+" "+e.mb+" "+e.ml:o.style.margin="",t=o):t=chartFieldDomUtil.createChartField(e);return DomUtil.addImageRotationStyles(t,e),t.style.position="relative",t},createChartImage:function(e){var t=ChartView.createChartContainer(e);return DomUtil.addImageRotationStyles(t,e),t},createImageField:function(e){var t=this.getImage(e);if(e[ATTR_COMMON.CLS]===NODE_TYPE.FILLABLEFIELD&&e.wrapType){var i=document.createElement("span");i.setAttribute("class","zw-portion fillablefield"),i.setAttribute("data-field-id",e.ffInfo.id),e.src&&" "!==e.src||DomUtil.addFillImage(t,e,null),i.appendChild(t),i.style.display="inline-block",t=i}return t},createWidget:function(e){var t,i=DomUtil.isSheetWidget(e);if(i||this.domViewManager.isEditMode()&&!DomUtil.isLiveWidget(e)){var n=ImageCache.getRenderingImageData(e,null);if(t=n.image,"cached"===n.type&&t){var r=DocUtil.copyStyle(e);delete r[ATTR_IMAGE.I_SRC],DomUtil.applyStyleToSvgImage(J(t).children("svg").children("image")[0],r),i&&WidgetView.applyIframeProps(J(t).children("iframe")[0],e)}}else t=WidgetView.createWidgetContainer(e);return DomUtil.addImageRotationStyles(t,e),t},getImage:function(e){var t=this.docView.getSection();t.getSectionType()==SECTION_TYPES.TEXTBOX&&(t=t.getRootSection());var i=null;HF_SECTIONS.contains(t.getSectionType())&&(i=this.docView.getSection().getId());var n=ImageCache.getRenderingImageData(e,i),r=DocUtil.copyStyle(e);DocLayoutManager.isImagePreviewEnabled()&&DomUtil.isImage(e)&&(r.ht=0,r.wid=0);var o=n.image;return"cached"===n.type&&o&&(delete r[ATTR_IMAGE.I_SRC],DomUtil.applyStyleToSvgImage(J(o).children("svg").children("image")[0],r)),e.shapeData&&Shapes.drawShapeInPara(o,e,this.docView.section.name),DomUtil.addImageRotationStyles(o,e),o},createFloatingAutomationField:function(e,t){var i=null,n=editor.doc.findNextIndexOf(UNICODE.RANGE_END,t),r=this.getDocLayoutManager().getLineAtIndex(t),o=this.docView.getNodeStartIndex();if(r){var a=new LineDOMBuilder(r,this.domViewManager,{start:t-o,end:n-o,excludeContainer:!0,allowFloatingFields:!0});i=a.build(!0),i=i.children[0]}return i},createFloatingImageSignerField:function(e,t){var i=null,n=this.getDocLayoutManager().getLineAtIndex(t),r=this.docView.getNodeStartIndex();if(n){var o=new LineDOMBuilder(n,this.domViewManager,{start:t-r,end:t+1-r,excludeContainer:!0,allowFloatingFields:!0});i=o.build(!0),i=i.children[0]}return i},getFloatImageForIndex:function(e){var t=this.docView,i=e-t.getNodeStartIndex(),n=t.getFloatImageForIndex(i);return n?this.getFloatImage(n.getId()):null},getFloatImage:function(e){return this.floatImagesMap[e]},getFloatImagesMap:function(){return this.floatImagesMap},addToFloatImagesMap:function(e){this.floatImagesMap[e.getId()]=e},removeFromFloatImagesMap:function(e){delete this.floatImagesMap[e]},removeFloatImages:function(){var e,t=this.docView,i=t.getSection(),n=this.getFloatImagesMap();for(var r in n)e=i.getFloatImageById(r),n[r].remove(),this.removeFromFloatImagesMap(r)},addOrUpdateFloatImages:function(){var e,t,i=this.docView,n=i.getFloatImages(),r=this.getFloatImagesMap(),o=i.getSection();if(o.isDirtyNode(i)){var a=o.getOpTypeInUpdateQueue(i);if("updatelist"!=a)return}for(var s=0;s<n.length;s++)if(t=n[s],e=r[t.getId()])e.update();else if(i.getSection().getSectionType()!==SECTION_TYPES.TEXTBOX){if(t.isTextBox&&!i.getGroup().getDocViews(t.getFormatId())[0])continue;this.addToFloatImagesMap(new FloatImageDomView(t,this))}},afterViewBuild:function(){this.update()},addViewToDOM:function(){var e=this.docView.getParent(),t=this.domViewManager.getDOMObj(e),i=this.getPrevEl();t.getType()!==VIEW.TOC||i||(i=t.getButtonGroup()),t.appendChildElem(this.el,i)}}),e}(),PageGridLayoutManager=function(e){"use strict";function t(e,t,i,n,r){r=r||{},this.width=e,this.height=t,this.documentLayoutManager=i,this.wrapType=n||PAGE_GRID.WRAP_TYPE.AUTO,this.maxPagesInRow=r.maxPagesInRow||-1,this.maxPagesInColumn=r.maxPagesInColumn||-1,this.align=r.align||ALIGN.LEFT,this.direction=r.direction||PAGE_GRID.DIRECTION.ROW,this.rowGap=r.hasOwnProperty("rowGap")?r.rowGap:MULTIPAGE_DEFAULT_SPACE,this.colGap=r.hasOwnProperty("colGap")?r.colGap:MULTIPAGE_DEFAULT_SPACE,this.pages=null,this.pageOffsets={},this.grid=[],this.bindEvents()}return e.call(t.prototype),extend(t.prototype,{init:function(){for(var e=this.documentLayoutManager.getFirstPage();e;)this.addPageToLayout(e),e=this.documentLayoutManager.getNextPage(e)},reset:function(){for(var e=this.documentLayoutManager.getLastPage();e;)this.removePageFromLayout(e),e=this.documentLayoutManager.getPrevPage(e)},changeWrapType:function(){this.documentLayoutManager.isWebView()&&(this.wrapType=PAGE_GRID.WRAP_TYPE.FIXED,this.direction=PAGE_GRID.DIRECTION.ROW,this.maxPagesInRow=1,this.maxPagesInColumn=-1),this.reset(),this.init()},addPageToLayout:function(e){this.pageOffsets[e.getId()]={};var t,i=this.computeGridPosition(e),n=this.getFirstPageInRow(i);n&&(t=e===n?null:this.getPageOffset(n)),this.afterGridCompute(e,i),this.computePageOffset(e),this.trigger(DOCUMENT.PAGE_ADDED_TO_LAYOUT,e,this.getPageOffset(e)),t&&this.afterPageAddOrRemove(n,t)},removePageFromLayout:function(e){var t=this.getGridPosition(e);if(t){var i,n=this.getFirstPageInRow(t);n&&(i=e===n?null:this.getPageOffset(n)),this.removePageFromGrid(t),i&&this.afterPageAddOrRemove(n,i)}delete this.pageOffsets[e.getId()],this.trigger(DOCUMENT.PAGE_REMOVED_FROM_LAYOUT,e)},afterGridCompute:function(e,t){this.addPageToGrid(e,t),this.pageOffsets[e.getId()].gridPosition=t},afterPageAddOrRemove:function(e,t){var i=this.getPageOffset(e);if(!ZWJSONUtils.compareJSON(t,i))for(var n,r=this.getGridPosition(e).row,o=0,a=this.getPageInGridPosition({row:r,column:o});a&&(n=this.getPageOffset(a));)this.trigger(DOCUMENT.PAGE_OFFSET_UPDATED,a,n),a=this.getPageInGridPosition({row:r,column:++o})},getFirstPageInRow:function(e){return this.getPageInGridPosition({row:e.row,column:0})},getPageInGridPosition:function(e){return this.grid[e.row]?this.grid[e.row][e.column]:null},getRowHeight:function(e){var t=0;if(this.direction===PAGE_GRID.DIRECTION.ROW)for(var i=0,n=this.getPageInGridPosition({row:e,column:i});n;){var r=0;if(this.documentLayoutManager.hasRotatedPageInDocument()){var o=this.documentLayoutManager.getFirstGroup();r=o.getPrintPageHeight()}else r=n.getDOMViewHeight();t=Math.max(t,r),n=this.getPageInGridPosition({row:e,column:++i})}return t},getColumnWidth:function(e){var t=0,i=this.getPageInGridPosition(e);return i&&this.direction===PAGE_GRID.DIRECTION.ROW&&(t=i.getDOMViewWidth()),t},computePageOffset:function(e){for(var t=this.getGridPosition(e),i=t.row,n=t.column,r=0,o=0;--i>=0;)r+=this.rowGap,r+=this.getRowHeight(i);for(;--n>=0;)o+=this.colGap,o+=this.getColumnWidth({row:t.row,column:n});this.pageOffsets[e.getId()].offset={top:r,left:o}},getGridPosition:function(e){return e&&this.pageOffsets[e.getId()]?this.pageOffsets[e.getId()].gridPosition:null},computeGridPosition:function(e){var t={},i=this.documentLayoutManager.getPrevPage(e);if(this.wrapType===PAGE_GRID.WRAP_TYPE.FIXED)if(i){var n=this.getGridPosition(i);this.direction===PAGE_GRID.DIRECTION.ROW?n.column<this.maxPagesInRow-1?(t.column=n.column+1,t.row=n.row):(t.column=0,t.row=n.row+1):this.direction===PAGE_GRID.DIRECTION.COLUMN&&(n.row<this.maxPagesInColumn-1?(t.column=n.column,t.row=n.row+1):(t.column=n.column+1,t.row=0))}else t.column=0,t.row=0;else if(this.wrapType===PAGE_GRID.WRAP_TYPE.AUTO)if(i){var r=this.getRelativePageOffset(i),n=this.getGridPosition(i);this.direction===PAGE_GRID.DIRECTION.ROW?r.left+i.getDOMViewWidth()+this.colGap+e.getDOMViewWidth()<this.width?(t.column=n.column+1,t.row=n.row):(t.column=0,t.row=n.row+1):this.direction===PAGE_GRID.DIRECTION.COLUMN&&(r.top+i.getDOMViewHeight()+this.rowGap+e.getDOMViewHeight()<this.height?(t.column=n.column,t.row=n.row+1):(t.column=n.column+1,t.row=0))}else t.column=0,t.row=0;return t},addPageToGrid:function(e,t){this.grid[t.row]||(this.grid[t.row]=[]),this.grid[t.row][t.column]=e},removePageFromGrid:function(e){this.grid[e.row]&&delete this.grid[e.row][e.column]},getRowArray:function(e){return this.grid[e]},getPageOffset:function(e){var t=this.getRelativePageOffset(e),i=this.getGridPosition(e);if(!i||!t)return null;var n=this.getRowWidth(this.getRowArray(i.row)),r=this.width-n,o=t.left,a=this.getFirstPageInRow(i);if(a)if(a===e)switch(this.align){case ALIGN.CENTER:o+=r/2;break;case ALIGN.RIGHT:o+=r}else o+=this.getPageOffset(a).left;return{left:o,top:t.top}},getRelativePageOffset:function(e){return this.pageOffsets[e.getId()]?this.pageOffsets[e.getId()].offset:null},findStartingPageForUpdate:function(e,t,i){var n=this.getGridPosition(t)||this.getGridPosition(e)||this.getGridPosition(i);if(!n)return null;var r;return r=this.align!==ALIGN.LEFT?this.getPageInGridPosition({row:n.row,column:0}):i},updateFollowingPagesOffset:function(e,t,i){for(var n,r=this.findStartingPageForUpdate(e,t,i);r&&(n=this.getPageOffset(r));){this.removePageFromLayout(r,!0),this.addPageToLayout(r,!0);var o=this.getPageOffset(r);ZWJSONUtils.compareJSON(n,this.getPageOffset(r))||this.trigger(DOCUMENT.PAGE_OFFSET_UPDATED,r,o),r=this.documentLayoutManager.getNextPage(r)}},getClosestPage:function(e){var t=editor.jeditorPane.offset();e.top-=t.top,e.left-=t.left;var i,n=0,r=0;if(this.direction===PAGE_GRID.DIRECTION.ROW){var o=0;n+=this.getRowHeight(o);for(var a,s;n<e.top&&(a=n,n+=this.getRowHeight(++o),a!==n););var l=0;for(r+=this.getColumnWidth({row:o,column:l});r<e.left&&(s=r,r+=this.getColumnWidth({row:o,column:++l}),s!==r););i=this.getPageInGridPosition({row:o,column:l})}return i},getRow:function(e){return this.grid[e]},getRowWidth:function(e){var t=0;return e.forEach(function(i,n){t+=i.getDOMViewWidth(),n+1!==e.length&&(t+=this.colGap)}.bind(this)),t},getMaxRowWidth:function(){var e=0;return this.grid.forEach(function(t){var i=this.getRowWidth(t);i>e&&(e=i)}.bind(this)),e},getRowsCount:function(){return this.grid.length},getAllRowsHeight:function(){var e=0;return this.grid.forEach(function(t,i){e+=this.getRowHeight(i)}.bind(this)),e},getEntireGridHeight:function(){return this.getAllRowsHeight()+(this.grid.length-1)*this.rowGap},getWrapType:function(){return this.wrapType},updateLayoutDimensions:function(e){this.width=e.width,this.height=e.height},bindEvents:function(){this.documentLayoutManager.on(DOCUMENT.VIEW_CHANGED,this.changeWrapType,this)},unbindEvents:function(){this.documentLayoutManager.off(DOCUMENT.VIEW_CHANGED,this.changeWrapType,this)},destroy:function(){this.reset(),this.unbindEvents(),this.pages=null,this.width=0,this.wrapType=null}}),t}(BaseEventHandler),DOMViewManager=function(){"use strict";function e(e){this.documentLayoutManager=e,this.domViewMap={},this.sectionViewMap={},this.pageViewMap={},this.visiblePageNumbers=[1]}return BaseEventHandler.call(e.prototype),extend(e.prototype,{isEditMode:function(){return this.documentLayoutManager.isEditMode()},isFillMode:function(){return this.documentLayoutManager.isFillMode()},getDocLayoutManager:function(){return this.documentLayoutManager},destroy:function(){this.visiblePageNumbers=[],this.pageViewMap={},this.sectionViewMap={},this.domViewMap={},this.documentLayoutManager=null},getViewData:function(e){var t={};return e&&(t.nodeId=e.getAttribute("node-id"),t.docViewId=e.getAttribute("doc-id")),t},getVisiblePageNumbers:function(){return this.visiblePageNumbers},addToDOMMap:function(e){this.domViewMap[e.getDocId()]=e},removeFromDOMMap:function(e){delete this.domViewMap[e]},getEditorPane:function(){return editor.jeditorPane[0]},isMultiplePagesInRow:function(){return!1},getDocView:function(e){var t,i=this.getViewData(e),n=i.docViewId,r=this.getDocLayoutManager();return t=n.indexOf(VIEW.PAGE)!==-1?r.getPageWithId(n):r.getViewById(i.nodeId,n),t||null}}),e}(),EditorDomViewManager=function(){"use strict";function e(e){DOMViewManager.apply(this,arguments),this.gridLayoutManager=null,this.pdfVisibilityStatus=!isHeadlessPDF,this.conversionOptions=null,this.bindEvents(),this.init()}var t=function(e,t,i){for(var n,r,o=J(i),a=o.find("span.zw-portion"),s=0,l=0,d=a.length,c=t.absStart;l<d;l++){if(r=parseInt(a.eq(l).attr("data-text-len")||0),c+r>=e){n=a[l],s=e-c;break}c+=r}return n=n||o.find("span.EOP")[0],n&&s<0&&(s=0),{node:n,cursorPos:s,line:t}},i=function(e){var t="invisible-textbox-container",i="editorpane",n=J(e).children("div.zw-textbox-div");if(0!=n.length){var r=document.getElementById(t);if(!r){var o=document.createElement("div"),a=document.getElementById(i);o.id=t,o.style.display="none",a.appendChild(o),r=o}for(var s=0,l=n.length;s<l;s++){var e=n[s];r.appendChild(e)}}};return e.prototype=Object.create(DOMViewManager.prototype),e.prototype.constructor=e,extend(e.prototype,{init:function(){this.conversionOptions=editorProps.options&&editorProps.options.conversiondatabean?JSON.parse(editorProps.options.conversiondatabean):{};for(var e=this.getDocLayoutManager().getSectionViews(),t=0;t<e.length;t++)this.handleSectionAdd(e[t])},destroy:function(){this.unbindEvents();var e;for(e in this.pageViewMap){var t=this.pageViewMap[e];t&&this.handlePageRemove(t.getDocView())}var i;for(i in this.sectionViewMap){var n=this.sectionViewMap[i];n&&this.handleSectionRemove(n.getDocView())}var r;for(r in this.domViewMap){var o=this.domViewMap[r];o&&this.handleViewRemove(o.getDocView())}this.conversionOptions=null,this.pdfVisibilityStatus=!1,this.gridLayoutManager=null,DOMViewManager.prototype.destroy.call(this)},bindEvents:function(){this.documentLayoutManager.on(DOCVIEW.SECTION_ADDED,this.handleSectionAdd,this),this.documentLayoutManager.on(DOCVIEW.SECTION_HEIGHT_UPDATED,this.handleSectionUpdate,this),this.documentLayoutManager.on(DOCVIEW.SECTION_TOP_UPDATED,this.handleSectionUpdate,this),this.documentLayoutManager.on(DOCVIEW.SECTION_ATTACHED,this.handleSectionAttached,this),this.documentLayoutManager.on(DOCVIEW.SECTION_BEFORE_DETACHED,this.handleSectionDetached,this),this.documentLayoutManager.on(DOCVIEW.SECTION_AFTER_DETACHED,this.handleSectionAfterDetached,this),this.documentLayoutManager.on(DOCVIEW.SECTION_REMOVED,this.handleSectionRemove,this),this.documentLayoutManager.on(DOCVIEW.SECTION_BALANCING_COMPLETE,this.handleSectionBalancingComplete,this),this.documentLayoutManager.on(DOCVIEW.SECTION_STYLE_UPDATED,this.handleSectionStyleUpdate,this),this.documentLayoutManager.on(DOCVIEW.AFTER_HF_SECTION_UPDATE,this.handleAfterHFSectionUpdate,this),this.documentLayoutManager.on(DOCVIEW.AFTER_HF_SECTION_BUILD_COMPLETE,this.handleAfterHFSectionBuild,this),this.documentLayoutManager.on(DOCVIEW.TEXTBOX_CHANGED,this.handleTextBoxChange,this),this.documentLayoutManager.on(DOCVIEW.NOTE_CHAR_UPDATED,this.updateNoteChar,this),this.documentLayoutManager.on(DOCVIEW.PAGE_CREATED,this.handlePageCreate,this),this.documentLayoutManager.on(DOCVIEW.PAGE_REMOVED,this.handlePageRemove,this),this.documentLayoutManager.on(DOCVIEW.PAGE_CONTENT_HEIGHT_UPDATED,this.handlePageContentHeightUpdate,this),this.documentLayoutManager.on(DOCVIEW.PAGE_HEIGHT_UPDATED,this.handlePageHeightUpdate,this),this.documentLayoutManager.on(DOCVIEW.PAGE_PAGINATED,this.handlePagePaginated,this),this.documentLayoutManager.on(DOCVIEW.UPDATE_SURROUNDING_PAGES,this.handleSurroundingPages,this),this.documentLayoutManager.on(DOCVIEW.VIEW_BEFORE_CREATE,this.handleViewCreateAndAttach,this),this.documentLayoutManager.on(DOCVIEW.VIEW_BEFORE_REMOVE,this.handleViewRemove,this),this.documentLayoutManager.on(DOCVIEW.VIEW_ATTACHED,this.handleViewAttached,this),this.documentLayoutManager.on(DOCVIEW.VIEW_DETACHED,this.handleViewDetached,this),this.documentLayoutManager.on(DOCVIEW.VIEW_AFTER_CREATE,this.handleViewAfterCreate,this),this.documentLayoutManager.on(DOCVIEW.VIEW_AFTER_UPDATE,this.handleViewAfterUpdate,this),this.documentLayoutManager.on(DOCVIEW.VIEW_ADJUST_BORDER,this.handleViewAdjustBorder,this),this.documentLayoutManager.on(DOCVIEW.TABLE_HEADER_ROW_UPDATED,this.handleHeaderRowUpdate,this),this.documentLayoutManager.on(DOCVIEW.HEIGHT_UPDATED,this.handleViewHeightUpdate,this),this.documentLayoutManager.on(DOCVIEW.STYLE_UPDATED,this.handleViewStyleUpdate,this),this.documentLayoutManager.on(DOCVIEW.ROW_VISIBILITY_UPDATED,this.handleRowVisibilityUpdate,this),this.documentLayoutManager.on(DOCVIEW.AFTER_TABLE_SPLIT,this.handleTableSplitMerge,this),this.documentLayoutManager.on(DOCVIEW.AFTER_TABLE_MERGE,this.handleTableSplitMerge,this),this.documentLayoutManager.on(DOCVIEW.VIEW_TOP_UPDATED,this.handleViewTopUpdated,this),this.documentLayoutManager.on(DOCVIEW.COLUMN_ADDED,this.handleColumnViewAdd,this),this.documentLayoutManager.on(DOCVIEW.COLUMN_UPDATED,this.handleColumnViewUpdate,this),this.documentLayoutManager.on(DOCVIEW.COLUMN_REMOVED,this.handleColumnViewRemove,this),this.documentLayoutManager.on(DOCVIEW.LINE_ADDED,this.handleLineDocViewAdd,this),this.documentLayoutManager.on(DOCVIEW.LINE_UPDATED,this.handleLineDocViewUpdate,this),this.documentLayoutManager.on(DOCVIEW.LINE_STYLE_UPDATED,this.handleLineDocViewStyleUpdate,this),this.documentLayoutManager.on(DOCVIEW.LINE_RECREATED,this.handleLineDocViewStyleUpdate,this),this.documentLayoutManager.on(DOCVIEW.LINE_BEFORE_REMOVE,this.handleLineDocViewRemove,this),this.documentLayoutManager.on(DOCVIEW.LIST_NUMBER_CHANGED,this.handleListNumber,this),this.documentLayoutManager.on(DOCVIEW.PAGE_COUNT_UPDATED,this.updatePageCountInLine,this),this.documentLayoutManager.on(DOCVIEW.PAGE_NUMBER_UPDATED,this.updatePageNumberInLine,this),this.documentLayoutManager.on(DOCVIEW.PAGE_NUMBER_UPDATED_IN_HF,this.handlePageNumberUpdate,this),this.documentLayoutManager.on(DOCVIEW.PAGE_COUNT_UPDATED_IN_HF,this.handlePageCountUpdate,this),this.documentLayoutManager.on(GROUP.HF_VISIBILITY_UPDATE,this.handleHFVisibilityUpdate,this),this.documentLayoutManager.on(DOCUMENT.PAGINATION_COMPLETE,this.handlePaginationComplete,this),this.documentLayoutManager.on(DOCUMENT.PAGE_BACKGROUND_CHANGED,this.handlePageBackgroundUpdate,this),this.documentLayoutManager.on(DOCUMENT.LAYOUT_MANAGER_DESTROYED,this.destroy,this)},unbindEvents:function(){this.documentLayoutManager.off(DOCVIEW.SECTION_ADDED,this.handleSectionAdd,this),this.documentLayoutManager.off(DOCVIEW.SECTION_HEIGHT_UPDATED,this.handleSectionUpdate,this),this.documentLayoutManager.off(DOCVIEW.SECTION_TOP_UPDATED,this.handleSectionUpdate,this),this.documentLayoutManager.off(DOCVIEW.SECTION_ATTACHED,this.handleSectionAttached,this),this.documentLayoutManager.off(DOCVIEW.SECTION_BEFORE_DETACHED,this.handleSectionDetached,this),this.documentLayoutManager.off(DOCVIEW.SECTION_AFTER_DETACHED,this.handleSectionAfterDetached,this),this.documentLayoutManager.off(DOCVIEW.SECTION_REMOVED,this.handleSectionRemove,this),this.documentLayoutManager.off(DOCVIEW.SECTION_BALANCING_COMPLETE,this.handleSectionBalancingComplete,this),this.documentLayoutManager.off(DOCVIEW.SECTION_STYLE_UPDATED,this.handleSectionStyleUpdate,this),this.documentLayoutManager.off(DOCVIEW.AFTER_HF_SECTION_UPDATE,this.handleAfterHFSectionUpdate,this),this.documentLayoutManager.off(DOCVIEW.AFTER_HF_SECTION_BUILD_COMPLETE,this.handleAfterHFSectionBuild,this),this.documentLayoutManager.off(DOCVIEW.TEXTBOX_CHANGED,this.handleTextBoxChange,this),this.documentLayoutManager.off(DOCVIEW.NOTE_CHAR_UPDATED,this.updateNoteChar,this),this.documentLayoutManager.off(DOCVIEW.PAGE_CREATED,this.handlePageCreate,this),this.documentLayoutManager.off(DOCVIEW.PAGE_REMOVED,this.handlePageRemove,this),this.documentLayoutManager.off(DOCVIEW.PAGE_CONTENT_HEIGHT_UPDATED,this.handlePageContentHeightUpdate,this),this.documentLayoutManager.off(DOCVIEW.PAGE_HEIGHT_UPDATED,this.handlePageHeightUpdate,this),this.documentLayoutManager.off(DOCVIEW.PAGE_PAGINATED,this.handlePagePaginated,this),this.documentLayoutManager.off(DOCVIEW.UPDATE_SURROUNDING_PAGES,this.handleSurroundingPages,this),this.documentLayoutManager.off(DOCVIEW.VIEW_BEFORE_CREATE,this.handleViewCreateAndAttach,this),this.documentLayoutManager.off(DOCVIEW.VIEW_BEFORE_REMOVE,this.handleViewRemove,this),this.documentLayoutManager.off(DOCVIEW.VIEW_ATTACHED,this.handleViewAttached,this),this.documentLayoutManager.off(DOCVIEW.VIEW_DETACHED,this.handleViewDetached,this),this.documentLayoutManager.off(DOCVIEW.VIEW_AFTER_CREATE,this.handleViewAfterCreate,this),this.documentLayoutManager.off(DOCVIEW.VIEW_AFTER_UPDATE,this.handleViewAfterUpdate,this),this.documentLayoutManager.off(DOCVIEW.VIEW_ADJUST_BORDER,this.handleViewAdjustBorder,this),this.documentLayoutManager.off(DOCVIEW.TABLE_HEADER_ROW_UPDATED,this.handleHeaderRowUpdate,this),this.documentLayoutManager.off(DOCVIEW.HEIGHT_UPDATED,this.handleViewHeightUpdate,this),this.documentLayoutManager.off(DOCVIEW.STYLE_UPDATED,this.handleViewStyleUpdate,this),this.documentLayoutManager.off(DOCVIEW.ROW_VISIBILITY_UPDATED,this.handleRowVisibilityUpdate,this),this.documentLayoutManager.off(DOCVIEW.AFTER_TABLE_SPLIT,this.handleTableSplitMerge,this),this.documentLayoutManager.off(DOCVIEW.AFTER_TABLE_MERGE,this.handleTableSplitMerge,this),this.documentLayoutManager.off(DOCVIEW.VIEW_TOP_UPDATED,this.handleViewTopUpdated,this),this.documentLayoutManager.off(DOCVIEW.COLUMN_ADDED,this.handleColumnViewAdd,this),this.documentLayoutManager.off(DOCVIEW.COLUMN_UPDATED,this.handleColumnViewUpdate,this),this.documentLayoutManager.off(DOCVIEW.COLUMN_REMOVED,this.handleColumnViewRemove,this),this.documentLayoutManager.off(DOCVIEW.LINE_ADDED,this.handleLineDocViewAdd,this),this.documentLayoutManager.off(DOCVIEW.LINE_UPDATED,this.handleLineDocViewUpdate,this),this.documentLayoutManager.off(DOCVIEW.LINE_STYLE_UPDATED,this.handleLineDocViewStyleUpdate,this),this.documentLayoutManager.off(DOCVIEW.LINE_RECREATED,this.handleLineDocViewStyleUpdate,this),this.documentLayoutManager.off(DOCVIEW.LINE_BEFORE_REMOVE,this.handleLineDocViewRemove,this),this.documentLayoutManager.off(DOCVIEW.LIST_NUMBER_CHANGED,this.handleListNumber,this),this.documentLayoutManager.off(DOCVIEW.PAGE_COUNT_UPDATED,this.updatePageCountInLine,this),this.documentLayoutManager.off(DOCVIEW.PAGE_NUMBER_UPDATED,this.updatePageNumberInLine,this),this.documentLayoutManager.off(DOCVIEW.PAGE_NUMBER_UPDATED_IN_HF,this.handlePageNumberUpdate,this),this.documentLayoutManager.off(DOCVIEW.PAGE_COUNT_UPDATED_IN_HF,this.handlePageCountUpdate,this),this.documentLayoutManager.off(DOCUMENT.PAGINATION_COMPLETE,this.handlePaginationComplete,this),this.documentLayoutManager.off(DOCUMENT.PAGE_BACKGROUND_CHANGED,this.handlePageBackgroundUpdate,this),this.documentLayoutManager.off(DOCUMENT.LAYOUT_MANAGER_DESTROYED,this.destroy,this)},getDOMObjById:function(e){var t=e.indexOf(VIEW.PAGE)!==-1?VIEW.PAGE:"";switch(t){case VIEW.PAGE:return this.pageViewMap[e]||null;default:return this.domViewMap[e]||null}},getAllLineDOM:function(){var e={};for(var t in this.domViewMap)t.indexOf("line")!==-1&&(e[t]=this.domViewMap[t]);return e},getAllHrDOM:function(){var e={};for(var t in this.domViewMap)t.indexOf("hr")!==-1&&(e[t]=this.domViewMap[t]);return e},getDOMObj:function(e){return e&&this.domViewMap[e.getId()]||null},getDOMElemById:function(e){var t=this.getDOMObjById(e);return t?t.el:null},getDOMElem:function(e){var t=this.getDOMObj(e);return t?t.el:null},getDOMNodeAtIndex:function(e){var t=this.getDocLayoutManager().getViewAtIndex(e);return this.getDOMElem(t)},getDOMnodeFromDTnode:function(e){var t=this.getDocLayoutManager().getViews(e);if(!t)return null;var i=t[0],n=this.getDOMElem(i);return n},getPortionData:function(e){var i=this.getDocLayoutManager().getLineAtIndex(e),n=DomViewManager.getDOMElem(i);return t(e,i,n)},getPortionDataInCurrentPage:function(e){var i=this.getDocLayoutManager().getLineAtIndex(e),n=this.getDomFromCurrentPage(i);return t(e,i,n)},getAllPages:function(){var e,t=[];for(e in this.pageViewMap){var i=this.pageViewMap[e];t.push(i.el)}return t},getAllPagesObj:function(){return this.pageViewMap},getDomFromCurrentPage:function(e){var t=this.getCurrentPage();return t.getRenderedDOM(e)},getAllDomFromCurrentPage:function(e){var t=this.getCurrentPage();return t.getAllRenderedDom(e)},getAllDomForNode:function(e){for(var t=[],i=this.getDocLayoutManager().getViews(e),n=0;n<i.length;n++){var r=this.getDOMElem(i[n]);r&&t.push(r)}return t},getCurrentPage:function(){var e=this.getDocLayoutManager().getCurrentPage();return this.getDOMObj(e)},getPageAtPageNumber:function(e){var t=this.getDocLayoutManager().getPageAtPageNumber(e);return this.getDOMElem(t)},getDTNode:function(e){var t=this.getDocView(e),i=t.getNode();return i||null},indexOfElement:function(e){var t=this.getDTNode(e);return t.type==NODE_TYPE.PARA?t.getEndIndex():t.getIndex()},endIndexOfElement:function(e){var t=this.getDTNode(e);return t.type==NODE_TYPE.PARA?t.getEndIndex():t.parent.getIndex()+t.end},getNodeLineFromDomLine:function(e){var t=J(e).closestParent(".zw-paragraph"),i=0;i=t.children(".zw-line-div").index(e);var n=this.getDocView(t[0]);return n?n.nodeLines[i]:null},getStartIndex:function(e){var t=this.getNodeLineFromDomLine(e);if(t&&t.parent){var i=t.parent.getIndex();return i+=t.start}return-1},getEndIndex:function(e){var t=this.getNodeLineFromDomLine(e);if(t&&t.parent){var i=t.parent.getIndex();return i+=t.end}return-1},handleColumnViewAdd:function(e){var t=e.getSection();if(!this.isInVisiblePage(e))return void this.setPageRenderingStatus(e.getPage(),!1);if(this.canRenderView(t)){var i=new(DomViews[e.getType()])(e,this),n=this.getDOMObj(t);n||(this.handleSectionAttached(t,t.getPage()),n=this.getDOMObj(t)),n.addColumn(i),this.addToDOMMap(i)}},handleColumnViewUpdate:function(e){if(!this.isInVisiblePage(e))return void this.setPageRenderingStatus(e.getPage(),!1);if(this.canRenderView(e.getSection())){var t=this.getDOMObj(e);t||(this.handleColumnViewAdd(e),t=this.getDOMObj(e)),t.update()}},handleColumnViewRemove:function(e){var t=this.getDOMObj(e);t&&(this.removeFromDOMMap(t.getDocId()),t.remove())},handleSectionAdd:function(e){if(e.getSectionType()===SECTION_TYPES.CONTENT&&!this.isInVisiblePage(e))return void this.setPageRenderingStatus(e.getPage(),!1);var t=new(DomViews[e.getSectionType()])(e,this);return this.sectionViewMap[t.getDocId()]=t,this.addToDOMMap(t),t},handleSectionUpdate:function(e){if(!this.isInVisiblePage(e))return void this.setPageRenderingStatus(e.getPage(),!1);var t=this.getDOMObj(e);t||(t=this.handleSectionAdd(e)),t.update();for(var i,n=e.getFirstColumn();n;)i=this.getDOMObj(n),i&&i.update(),n=n.next},handleSectionRemove:function(e){var t=this.getDOMObj(e);t&&(delete this.sectionViewMap[e.id],this.removeFromDOMMap(t.getDocId()),t.remove(),t.destroy())},handleSectionBalancingComplete:function(e){return this.isInVisiblePage(e)?void this.createSectionFragments(e.getPage(),e):void this.setPageRenderingStatus(e.getPage(),!1)},handleSectionStyleUpdate:function(e,t){var i;if(HF_SECTIONS.contains(e.getSectionType())){var n=this.getDOMObj(t);if(!n)return;if(i=n[e.getSectionType()],!i)return;n.updateHFSectionMargins(i)}else{if(i=this.getDOMObj(e),!i)return;i.updateStyle()}},handleAfterHFSectionUpdate:function(e,t){if(!this.isInVisiblePage(t))return void this.setPageRenderingStatus(t,!1);var i=this.getDOMObj(t);i.updateHFSection(e)},handleAfterHFSectionBuild:function(e){var t=this.getDOMObj(e);t.updateStyle();for(var i=e.getFloatImages(),n=0;n<i.length;n++){var r=i[n],o=r.docView,a=DomViewManager.getDOMObj(o);a&&a.update()}},handleTextBoxChange:function(e){if(editor.clientActiveSection&&e.getNodeId()===editor.clientActiveSection.getAttribute("id")){var t=this.getDOMObj(e.getPage());editor.clientActiveSection=t.getActiveSectionElem(e),editor.prevClientActiveSection=editor.clientActiveSection}},handleSectionAttached:function(e,t){if(!this.isInVisiblePage(t)&&!e.isReplicableView()||!this.canRenderView(e))return void this.setPageRenderingStatus(t,!1);var i=this.getDOMObj(e);i?this.createColumnFragments(e):this.handleSectionAdd(e);var n=this.getDOMObj(t);n.processSectionAttach(e),e.getPage().getFirstSection(SECTION_TYPES.CONTENT)==e&&PageBorders.updatePageBorders(t)},handleSectionDetached:function(e,t){var i=this.getDOMObj(e);if(i){var n=this.getDOMObj(t);n.processSectionDetach(e)}},handleSectionAfterDetached:function(e,t){var i=e.getSectionType();if(META_SECTIONS.contains(i)){var n=this.getDOMObj(e);if(n){var r=this.getDOMObj(t);r.updateNoteContainer(i)}}},getLastPage:function(){var e=this.getDocLayoutManager().getLastPage();return e&&this.getDOMElem(e)||null},getFirstPage:function(){var e=this.getDocLayoutManager().getFirstPage();return e&&this.getDOMElem(e)||null},handlePageCreate:function(e){var t=new(DomViews[e.getType()])(e,this);t.addViewToDOM(),this.pageViewMap[e.id]=t,this.addToDOMMap(t),PageBorders.updatePageBorders(e);var i=this.pageIsInVisibleRange(e);i&&this.updateVisiblePages(e.getAbsolutePageNumber()),this.isMultiplePagesInRow()&&this.gridLayoutManager.addPageToLayout(e),this.trigger(DOMVIEW.PAGE_CREATED,e)},handlePageRemove:function(e){this.trigger(DOMVIEW.PAGE_REMOVED,e),this.isMultiplePagesInRow()&&this.gridLayoutManager.removePageFromLayout(e);var t=this.getDOMObj(e);this.removePageFromVisiblePages(e.getAbsolutePageNumber());var i=e.getId();t.destroy(),delete this.pageViewMap[i],this.removeFromDOMMap(i)},handlePageContentHeightUpdate:function(e){var t=this.getDOMObj(e);t&&t.updatePageStyle()},handlePageHeightUpdate:function(e){var t=this.getDOMObj(e);t&&t.updateHeight()},handlePagePaginated:function(e){for(var t,i,n,r=e.getFloatImages(),o=0;o<r.length;o++)t=r[o].getView(),t&&(i=this.getDOMObj(t),i&&(n=i.getFloatImage(r[o].getId()),n&&n.updatePosition(e.isEvenPage())))},handleSurroundingPages:function(e,t,i){if(this.isMultiplePagesInRow()&&this.gridLayoutManager.updateFollowingPagesOffset(e,t,i),i){var n=this.pageIsInVisibleRange(i);n&&this.updateVisiblePages(i.getAbsolutePageNumber())}},handleViewCreateAndAttach:function(e){this.handleViewCreate(e),this.handleViewAttached(e)},handleViewCreate:function(e){if(!e.isExcessDom&&!e.getParent().isExcessDom){if(!this.isInVisiblePage(e))return void this.setPageRenderingStatus(e.getPage(),!1);if(this.canRenderView(e.getSection())){var t=new(DomViews[e.getType()])(e,this);this.addToDOMMap(t)}}},handleViewRemove:function(e){this.trigger(DOMVIEW.VIEW_BEFORE_REMOVE,e);var t=this.getDOMObj(e);if(e.type===VIEW.TABLE&&0==e.rowStart){var n=e.getViews();if(n.length>1&&n[0].id===e.id){var r=this.getDOMObj(n[1]);r&&r.removeHeaderRow()}}t&&(this.removeFromDOMMap(t.getDocId()),t.remove(),i())},handleViewAttached:function(e){var t=e.getParent();if(!(e.isExcessDom||t.isExcessDom||t.getParent()&&t.getParent().isExcessDom)){if(!this.isInVisiblePage(e))return void this.setPageRenderingStatus(e.getPage(),!1);if(this.canRenderView(e.getSection())){var i=this.getDOMObj(t);i||(t.getType()===VIEW.COLUMN?this.handleColumnViewAdd(t):this.handleViewAttached(t));var n=this.getDOMObj(e),r=!!n;if(r||(this.handleViewCreate(e),n=this.getDOMObj(e),r=!0),n.addViewToDOM(),r&&n.getType()===VIEW.PARA){var o=e.getSection().isDirtyNode(e);if(o&&e.getSection().getOpTypeInUpdateQueue(e)!==OP_TYPE.UPDATE_LIST)for(var a=0;a<e.getNodeLinesLength();a++){var s=e.nodeLines[a],l=this.getDOMObj(s);l&&this.handleLineDocViewRemove(s)}else{for(var a=0;a<e.getNodeLinesLength();a++){var s=e.nodeLines[a],l=this.getDOMObj(s);l&&this.handleLineDocViewRemove(s),this.handleLineDocViewAdd(s)}n.addOrUpdateFloatImages()}}}}},handleViewDetached:function(e){var t=this.getDOMObj(e);if(t){if(t.getType()===VIEW.PARA)for(var i=0;i<e.getNodeLinesLength();i++){var n=e.nodeLines[i],r=this.getDOMObj(n);r&&this.handleLineDocViewRemove(n)}t.remove()}},handleViewAfterCreate:function(e){if(!e.isExcessDom&&!e.getParent().isExcessDom){var t=this.getDOMObj(e);t&&(t.afterViewBuild(),this.trigger(DOMVIEW.VIEW_AFTER_CREATE,e))}},handleViewAfterUpdate:function(e){if(!e.isExcessDom&&!e.getParent().isExcessDom){var t=this.getDOMObj(e);t&&(t.afterViewBuild(),this.trigger(DOMVIEW.VIEW_AFTER_UPDATE,e))}},handleViewAdjustBorder:function(e){var t=this.getDOMObj(e);t&&t.adjustBorder()},handleHeaderRowUpdate:function(e,t){var i=this.getDOMObj(e);i&&i.updateHeaderRow(t)},handleViewHeightUpdate:function(e){if(e.getType()===VIEW.CELL){var t=this.getDOMObj(e);t&&t.updateHeight()}},handleViewStyleUpdate:function(e){if(e.getType()===VIEW.CELL){var t=this.getDOMObj(e);t&&(t.setBorders(),t.setPadding())}},handleViewTopUpdated:function(e){for(var e,t,i,n,r=e.getFloatImages(),o=0;o<r.length;o++)if(e=r[o].getView(),e&&(t=this.getDOMObj(e),t&&(i=t.getFloatImage(r[o].getId())))){n=e.getPage();var a=!!n&&n.isEvenPage();i.updatePosition(a)}this.trigger(DOMVIEW.VIEW_TOP_UPDATED,this.getDOMObj(e))},handleRowVisibilityUpdate:function(e){var t=e.getChildViewsArray(!0);if(e.isExcessDom){for(var i=0;i<t.length;i++)this.handleViewDetached(t[i]);this.handleViewDetached(e)}else{this.handleViewAttached(e);for(var i=0;i<t.length;i++)this.handleViewAttached(t[i])}},handleTableSplitMerge:function(e,t){var i;if(e)if(this.isInVisiblePage(e)){if(!this.canRenderView(e.getSection()))return;i=this.getDOMObj(e),i&&i.updateDummyRowDetails()}else this.setPageRenderingStatus(e.getPage(),!1);if(t)if(this.isInVisiblePage(t)){if(!this.canRenderView(t.getSection()))return;i=this.getDOMObj(t),i&&i.updateDummyRowDetails()}else this.setPageRenderingStatus(t.getPage(),!1)},handleLineDocViewAdd:function(e){var t=this.preProcessDocEvents(e);if(t){var i=this.getDOMObj(e);i?i.isPartialBuild?(i.buildLine(),this.trigger(DOMVIEW.LINE_ADDED,e,i)):(this.handleLineDocViewRemove(e),i=this.createLine(e),this.trigger(DOMVIEW.LINE_ADDED,e,i)):(i=this.createLine(e),this.trigger(DOMVIEW.LINE_ADDED,e,i))}},handleLineDocViewUpdate:function(e){var t=this.preProcessDocEvents(e),i=this.getDOMObj(e);t&&(i?(this.trigger(DOMVIEW.LINE_BEFORE_UPDATE,e,i),i.updateLine(e),this.trigger(DOMVIEW.LINE_UPDATED,e,i)):(i=this.createLine(e),this.trigger(DOMVIEW.LINE_ADDED,e,i)))},handleLineDocViewStyleUpdate:function(e,t){var i=this.preProcessDocEvents(e),n=this.getDOMObj(e);i&&(n?t?(n.updateNodeLine(e),n.isPartialBuild&&(n.buildLine(),this.trigger(DOMVIEW.LINE_ADDED,e,n))):e===n.nodeLine?n.isPartialBuild?(n.buildLine(),this.trigger(DOMVIEW.LINE_ADDED,e,n)):n.updateLineStyle():(this.trigger(DOMVIEW.LINE_BEFORE_UPDATE,e,n),n.updateLine(e),this.trigger(DOMVIEW.LINE_UPDATED,e,n)):(n=this.createLine(e),this.trigger(DOMVIEW.LINE_ADDED,e,n)))},handleLineDocViewRemove:function(e){var t=this.getDOMObj(e);t&&(this.trigger(DOMVIEW.LINE_BEFORE_REMOVE,e,t),this.removeFromDOMMap(t.getDocId()),t.removeLine(),i())},updatePageCountInLine:function(e){var t=this.preProcessDocEvents(e);if(t){var i=this.getDOMObj(e);i?i.updatePageCountInLine(e):this.createLine(e)}},updatePageNumberInLine:function(e){var t=this.preProcessDocEvents(e);if(t){var i=this.getDOMObj(e);i?i.updatePageNumberInLine():this.createLine(e)}},createLine:function(e){var t=e.getView(),i=this.getDOMObj(t),n=new LineDomView(e,this,i);return this.addToDOMMap(n),n},isLineProcessAllowed:function(e){var t=e.getView(),i=t.getSection();if((i.isRemoveInProgress||i.isDirtyNode(t))&&e.getStatus()!==LINE_STATUS.REMOVE){var n=this.getDOMObj(t);if(n){var r=this.getDOMObj(e);r||(r=this.createLine(e)),r.pendingToBuildType=e.getStatus(),r.updateNodeLine(e)}return!1}return!0},processToBePaintedViews:function(e){for(var t,i,n,r,o=e.getViews(),a=0;a<o.length;a++){if(t=o[a],t===e)return;for(var s=0;s<t.nodeLines.length;s++)if(n=t.nodeLines[s],i=this.getDOMObj(n),r=i&&i.pendingToBuildType)switch(i.pendingToBuildType=null,r){case LINE_STATUS.CREATE:this.handleLineDocViewAdd(n);break;case LINE_STATUS.UPDATE:this.handleLineDocViewUpdate(n);break;case LINE_STATUS.STYLE_UPDATE:this.handleLineDocViewStyleUpdate(n);break;case LINE_STATUS.RECREATE:this.handleLineDocViewStyleUpdate(n,!0)}}},removeLinePendingType:function(e){var t=this.getDOMObj(e);t&&t.pendingToBuildType&&(t.pendingToBuildType=null)},preProcessDocEvents:function(e){var t=e.getView(),i=this.isLineProcessAllowed(e);if(!i)return!1;if(this.removeLinePendingType(e),this.processToBePaintedViews(t),this.isInVisiblePage(t)){if(!this.canRenderView(t.getSection()))return!1;var n=this.getDOMObj(t);return n||this.createView(t),!0}return this.setPageRenderingStatus(t.getPage(),!1),!1},handleListNumber:function(e){if(0===e.getStart()){var t=e.getFirstNodeLine(),i=this.getDOMObj(t);i&&(i.updateNodeLine(t),i.updateListNumber())}},updateVisiblePages:function(e,t){var i=this.getDocLayoutManager().getPageAtPageNumber(e);this.visiblePageNumbers.splice(0,this.visiblePageNumbers.length);var n=i,r=t?t.top:this.getViewPortInfo().viewport.top,o=r-editor.editorPaneContainerHt,a=r+2*editor.editorPaneContainerHt;n&&(this.markAsVisiblePage(n.getAbsolutePageNumber()),this.showPageContents(n));for(var s,l;i&&i.getPrevPage()&&(l=i.getPrevPage(),s=this.getDOMElem(l),(s.offsetTop+s.offsetHeight)*editor.zoomFactor>o);)i=i.getPrevPage(),this.markAsVisiblePage(l.getAbsolutePageNumber()),this.showPageContents(l);for(i=n;i&&this.getDocLayoutManager().getNextPage(i)&&(l=this.getDocLayoutManager().getNextPage(i),s=this.getDOMElem(l),s.offsetTop*editor.zoomFactor<a);)this.markAsVisiblePage(l.getAbsolutePageNumber()),this.showPageContents(l),i=this.getDocLayoutManager().getNextPage(i);for(var d,c=this.visiblePageNumbers.length,u=0;u<c;u++)try{i=this.getDocLayoutManager().getPageAtPageNumber(this.visiblePageNumbers[u]),i&&!this.isPageRendered(i)&&(d=this.getDOMObj(i),this.renderView(i))}catch(e){ZWLogger.log("Stack ::: "+e.stack);var g=new Error(ZWCollaboration.DT_DOM_RENDERING_ERROR);throw editor.lastError=g,e}},markAsVisiblePage:function(e){this.visiblePageNumbers.push(e)},removePageFromVisiblePages:function(e){if(this.visiblePageNumbers.contains(e)){var t=this.visiblePageNumbers.indexOf(e);this.visiblePageNumbers.splice(t,t+1)}},createHeaderFragments:function(e){var t=e.getHeader();t&&(this.handleAfterHFSectionUpdate(t,e),this.createColumnFragments(t,e),this.handleSectionAttached(t,e))},createFooterFragments:function(e){var t=e.getFooter();t&&(this.handleAfterHFSectionUpdate(t,e),this.createColumnFragments(t,e),this.handleSectionAttached(t,e))},renderView:function(e){if(!this.isPageRendered(e)){this.createHeaderFragments(e);for(var t=[SECTION_TYPES.CONTENT,SECTION_TYPES.ENDNOTE,SECTION_TYPES.FOOTNOTE,SECTION_TYPES.TEXTBOX],i=0;i<t.length;i++)for(var n=e[t[i]].first;n;)this.createSectionFragments(e,n),n=n.next;this.createFooterFragments(e),this.setPageRenderingStatus(e,!0),this.handleHFVisibilityUpdate(e,[SECTION_TYPES.HEADER,SECTION_TYPES.FOOTER])}},createSectionFragments:function(e,t){if(this.canRenderView(t)){var i=this.getDOMObj(t);if(i){var n=i.container;t.getSectionType()==SECTION_TYPES.TEXTBOX&&(n=i.content),DomUtil.emptyInnerHTML(n)}else i=this.handleSectionAdd(t);this.createColumnFragments(t),this.handleSectionAttached(t,e)}},isPageRendered:function(e){var t=this.getDOMObj(e);if(t)return!!t.isPageRendered},setPageRenderingStatus:function(e,t){var i=this.getDOMObj(e);i&&(i.isPageRendered=t)},removeAllSectionFloatImages:function(e){for(var t=[],i=e.getFloatImages(!0),n=0;n<i.length;n++){var r=i[n].getView();if(r&&t.indexOf(r.getId())===-1){var o=this.getDOMObj(r);o&&o.removeFloatImages(),t.push(r.getId())}}},createColumnFragments:function(e){for(var t,i=0,n=e.getFirstColumn();n;)t=n.getChildViews(),t&&(i+=n.getChildViewsArray(!0).length),n=n.getNextView();for(var r=this.getDOMObj(e),o=0,a=0,s=r.el.querySelectorAll("div.zw-column"),l=0;l<s.length;l++)o+=s[l].querySelectorAll(VIEWS_DOM_SELECTOR).length;for(var d,l=0;l<s.length;l++){d=s[l];for(var c=d.querySelectorAll(".zw-textbox-div"),u=0;u<c.length;u++)a+=c[u].querySelectorAll(VIEWS_DOM_SELECTOR).length}if(i!==o-a){this.removeAllSectionFloatImages(e);var g;for(n=e.getFirstColumn();n;)g=this.getDOMObj(n),g?(DomUtil.emptyInnerHTML(g.el),g.update()):(this.handleColumnViewAdd(n),g=this.getDOMObj(n)),this.createViewFragments(n),r.addColumn(g),n=n.getNextView()}},createViewFragments:function(e){for(var t=e.getFirstChild();t;)this.handleViewCreateAndAttach(t),this.handleViewAfterCreate(t),t.getChildViews()&&this.createViewFragments(t),t=t.getNextView()},createView:function(e){this.handleViewCreateAndAttach(e)},forceToRender:function(e){this.showPageContents(e),this.visiblePageNumbers.contains(e.getAbsolutePageNumber())||(this.markAsVisiblePage(e.getAbsolutePageNumber()),this.setPageRenderingStatus(e,!1),this.renderView(e))},togglePages:function(){if(editor.doc.isEditableMode()){var e;this.hideAllPageContents();for(var t=0,i=this.visiblePageNumbers.length;t<i;t++)e=this.getDocLayoutManager().getPageAtPageNumber(this.visiblePageNumbers[t]),this.showPageContents(e)}},getViewPortInfo:function(){var e={},t=this.getDocLayoutManager().getPageCount(),i=this.getDocLayoutManager().getPageAtPageNumber(editor.currentPageIndex+1);i||(i=this.getDocLayoutManager().getFirstPage());for(var n,r,o,a=editor.editorPaneContainer.scrollTop(),s=a+editor.editorPaneContainer.height(),l=this.getDocLayoutManager().getFirstPage();l;){if(n=l.getHeight(),o=this.getDocLayoutManager().getAbsolutePageHeight(l)*editor.zoomFactor,r=o-n*editor.zoomFactor,o+=40,r-=40,a>r&&o>a){i=l;break}l=this.getDocLayoutManager().getNextPage(l)}var d=i&&i.getAbsolutePageNumber()||1,c={};return c.top=a,c.bottom=s,e.pageNo=d,e.pageCount=t,e.viewport=c,e},pageIsInVisibleRange:function(e){var t,i,n="undefined"!=typeof CurUtil&&CurUtil.scrollTop||0,r=editor.editorPaneContainerHt,o=e.getHeight(),a=e.getAbsolutePageNumber();if(a--,t=a*o,i=t+o+CONST.PAGE_BOTTOM_MARGIN_BORDERS,this.getDocLayoutManager().getDocumentViewType()!==EDITORVIEW_TYPE.PAGE_VIEW){var s=e.group.getMargin(),l=s.top+e.getGutterTop()||96,d=s.bottom||96;t-=a*(l+d)}else t+=a*CONST.PAGE_BOTTOM_MARGIN_BORDERS;return n<=t&&t<=n+r||n<=i&&i<=n+r},renderAllPages:function(){for(var e=this.getDocLayoutManager().getFirstPage();e;)this.isPageRendered(e)||this.forceToRender(e),e=this.getDocLayoutManager().getNextPage(e)},showPageContents:function(e){var t=this.getDOMObj(e);t.showHideContentSections("block")},hideAllPageContents:function(){var e,t;for(e in this.pageViewMap)t=this.pageViewMap[e],t.showHideContentSections("none")},getPDFVisibilityStatus:function(){if(isHeadlessPDF){var e=!1,t=!1,i=!1;return this.conversionOptions&&(e=!!this.conversionOptions.fillable_field_data,t=this.conversionOptions.apply_fill_conditions,i=!!this.conversionOptions.signer_info),!!(e||t||i)||this.pdfVisibilityStatus}return!1},updatePDFVisibilityStatus:function(e){this.pdfVisibilityStatus=e},isInVisiblePage:function(e){if(e.getType()===VIEW.PAGE)return this.getPDFVisibilityStatus()||"PUBLIC"===editor.doc.getRole()||this.visiblePageNumbers.contains(e.getAbsolutePageNumber());var t;t=e.getType()===VIEW.SECTION?e:e.getSection();var i=t.getSectionType();return this.getPDFVisibilityStatus()||"PUBLIC"===editor.doc.getRole()||i!==SECTION_TYPES.CONTENT&&i!==SECTION_TYPES.ENDNOTE&&i!==SECTION_TYPES.FOOTNOTE||e.getPage()&&this.visiblePageNumbers.contains(e.getPage().getAbsolutePageNumber())},updateNoteRangeElement:function(e,t,i){var n=this.getDOMObj(e),r=t.id||t.fid||t.sid,o=n.rangeElements[r];if(o){var a=J(o);J(i).append(a.children())}n.rangeElements[r]=i;var s=this.getDocLayoutManager().getSectionViews(r)[0];s&&this.updateNoteRangeChar(s)},updateNoteRangeChar:function(e){var t=e.getContainingPara();if(t){var i=this.getDOMObj(t),n=e.getNode().getId();if(i){var r=i.rangeElements[n];if(r){var o=e.getReferenceChar(),a=CONST.ZERO_WIDTH_SPACE+"<span class='"+CONST.FIELD_TEXT_NODE+"'style='display:inline-block;font-size:inherit;'>"+o+"</span>";J(r).html(a).attr({fid:n}).css({display:"inline-block"}).unbind("click").click(function(){Note.moveToSection(J(this).attr("fid"))})}}}},updateNoteChar:function(e){this.updateNoteRangeChar(e);var t=this.getDOMObj(e);t.updateNoteChar()},handlePageCountUpdate:function(e){var t=this.getDOMObj(e);t&&t.updatePageCountInViews()},handlePageNumberUpdate:function(e){var t=this.getDOMObj(e);t&&t.updatePageNumberInViews()},handlePageBackgroundUpdate:function(){for(var e=this.getDocLayoutManager().getFirstPage();e;){var t=this.getDOMObj(e);t&&t.updatePageBackground(),e=this.getDocLayoutManager().getNextPage(e)}},handleHFVisibilityUpdate:function(e,t){var i=this.getDOMObj(e);i.showHideHFSections(t),i.updateStyle()},handlePaginationComplete:function(){var e=this.getDocLayoutManager().getDocumentViewType();if(e===EDITORVIEW_TYPE.WEB_VIEW||e===EDITORVIEW_TYPE.PUBLISH_VIEW)for(var t,i=this.getDocLayoutManager().getFirstPage();i;)t=this.getDOMObj(i),t&&t.updateHeight(),i=this.getDocLayoutManager().getNextPage(i)},onDocumentLoadingStart:function(){var e=J("#branding"),t=editor.doc.docInfo.PUBLISH_SCOPE===PUBLISH_TYPE.EXTERNAL;if(e.find("#public-menu-container").fadeIn(),J("#loading-div-container").remove(),t&&!editorProps.isPublishToFill){var i=J("#public-socialmedia-container");i.fadeIn(),i.find("#share-socialmedia").bind("click",function(e){var t=e?J(e.target).attr("id"):void 0,i=editorProps.isPublishToFill?DomUtil.getPublishURL(!0):DomUtil.getPublishURL();DomUtil.sharePublishURLToSocialMedia(t,i)})}},changeGridLayout:function(e,t,i){var n="",r={align:ALIGN.CENTER};switch(i){case 1:(isHeadlessPDF||"undefined"!=typeof PrintPreview&&PrintPreview.isPrintPreview())&&(n=PAGE_GRID.WRAP_TYPE.FIXED,r.maxPagesInRow=1,r.rowGap=0);break;case 2:n=PAGE_GRID.WRAP_TYPE.FIXED,r.maxPagesInRow=2;break;case 3:n=PAGE_GRID.WRAP_TYPE.AUTO}this.gridLayoutManager&&(this.gridLayoutManager.destroy(),this.gridLayoutManager.off(DOCUMENT.PAGE_OFFSET_UPDATED,this.onAddingPageToGrid),this.gridLayoutManager.off(DOCUMENT.PAGE_ADDED_TO_LAYOUT,this.onAddingPageToGrid),this.gridLayoutManager.off(DOCUMENT.PAGE_REMOVED_FROM_LAYOUT,this.onRemovingPageFromGrid),this.gridLayoutManager=null),n&&(this.gridLayoutManager=new PageGridLayoutManager(e,t,this.getDocLayoutManager(),n,r),this.gridLayoutManager.on(DOCUMENT.PAGE_OFFSET_UPDATED,this.onAddingPageToGrid),this.gridLayoutManager.on(DOCUMENT.PAGE_ADDED_TO_LAYOUT,this.onAddingPageToGrid),this.gridLayoutManager.on(DOCUMENT.PAGE_REMOVED_FROM_LAYOUT,this.onRemovingPageFromGrid),this.initGridLayout())},onAddingPageToGrid:function(e,t){var i=DomViewManager.getDOMElem(e);i.style.position="absolute",i.style.marginLeft="0px",i.style.marginRight="0px",i.style.top=t.top+"px",i.style.left=t.left+"px";var n=i.querySelector(".ui-page-collapse-div");n&&(n.style.display="none")},onRemovingPageFromGrid:function(e){var t=DomViewManager.getDOMElem(e);t.style.position="relative",t.style.removeProperty("top"),t.style.removeProperty("left"),t.style.marginLeft="auto",t.style.marginRight="auto";var i=t.querySelector(".ui-page-collapse-div");i&&(i.style.display="block")},changeGridWrapType:function(){this.gridLayoutManager&&this.gridLayoutManager.changeWrapType()},updateGridLayoutDimensions:function(e){this.isMultiplePagesInRow()&&this.gridLayoutManager.updateLayoutDimensions(e)},getGridWrapType:function(){return this.isMultiplePagesInRow()?this.gridLayoutManager.getWrapType():null},initGridLayout:function(){this.gridLayoutManager&&this.gridLayoutManager.init()},isMultiplePagesInRow:function(){return!!this.gridLayoutManager&&(this.gridLayoutManager.maxPagesInRow>1||this.gridLayoutManager.wrapType===PAGE_GRID.WRAP_TYPE.AUTO)},getMaxRowWidth:function(){return this.isMultiplePagesInRow()?this.gridLayoutManager.getMaxRowWidth():this.getDocLayoutManager().getMaxPagesWidth()},getRowsCount:function(){return this.isMultiplePagesInRow()?this.gridLayoutManager.getRowsCount():this.getDocLayoutManager().getPageCount()},getEntireGridHeight:function(){if(this.isMultiplePagesInRow())return this.gridLayoutManager.getEntireGridHeight();var e=this.getDocLayoutManager(),t=e.getLastPage();return e.getDocumentViewType()===EDITORVIEW_TYPE.PAGE_VIEW?e.getAbsolutePageHeight(t):t.getDOMViewHeight()},getRowWidth:function(e){if(!this.isMultiplePagesInRow())return this.getDocLayoutManager().getPageAtPageNumber(e+1).getDOMViewWidth();var t=this.gridLayoutManager.getRow(e);return t?this.gridLayoutManager.getRowWidth(t):void 0},getRowHeight:function(e){return this.isMultiplePagesInRow()?this.gridLayoutManager.getRowHeight(e):this.getDocLayoutManager().getPageAtPageNumber(e+1).getDOMViewHeight()},getCurrentPageLeft:function(e){var t=this.getDocLayoutManager().getCurrentPage();return t?this.getPageLeft(t,e):0},getCurrentSectionLeft:function(e){var t=this.getDocLayoutManager().getCurrentSection();return this.getSectionLeft(t,e)},getPageLeft:function(e,t){var i;if(this.isMultiplePagesInRow())i=this.gridLayoutManager.getPageOffset(e).left*editor.zoomFactor;else{var n=this.getMaxRowWidth();i=(n-e.getDOMViewWidth())/2*editor.zoomFactor}return t===ABSOLUTE_TO.WINDOW&&(i+=editor.jeditorPane.offset().left),i},getSectionLeft:function(e,t){return this.getCurrentPageLeft(t)+(e?e.getLeft()*editor.zoomFactor:0)},getClosestPage:function(e){if(this.isMultiplePagesInRow()){e.top+=editor.editorPaneContainer.scrollTop();var t=this.gridLayoutManager.getClosestPage(e);return t?this.getDOMElem(t):null}return Utils.getClosestChild(editor.jeditorPane[0],"div.zw-page",e.left,e.top)},canRenderView:function(e){return!(e.getSectionType()==SECTION_TYPES.CONTENT&&e.shouldSectionsBalanced()&&!e.isBalanced()&&!e.shouldBalanceFromNextSection)}}),e}(),DomViewEventManager=function(e){"use strict";function t(t,i){e.publish(DOMVIEW.LINE_ADDED,t,i)}function i(t,i){e.publish(DOMVIEW.LINE_UPDATED,t,i)}function n(t,i){e.publish(DOMVIEW.LINE_BEFORE_REMOVE,t,i)}function r(t){var i;switch(t.getType()){case VIEW.PARA:i=DOMVIEW.PARAVIEW_AFTER_CREATE;break;case VIEW.CELL:i=DOMVIEW.CELLVIEW_AFTER_CREATE;break;case VIEW.ROW:i=DOMVIEW.ROWVIEW_AFTER_CREATE;break;case VIEW.TABLE:i=DOMVIEW.TABLEVIEW_AFTER_CREATE;break;case VIEW.HR:i=DOMVIEW.HRVIEW_AFTER_CREATE;break;case VIEW.TOC:i=DOMVIEW.TOCVIEW_AFTER_CREATE;break;default:i=DOMVIEW.VIEW_AFTER_CREATE}e.publish(i,t.getNode())}function o(t){var i;switch(t.getType()){case VIEW.PARA:i=DOMVIEW.PARAVIEW_AFTER_UPDATE;break;case VIEW.CELL:i=DOMVIEW.CELLVIEW_AFTER_UPDATE;break;case VIEW.ROW:i=DOMVIEW.ROWVIEW_AFTER_UPDATE;break;case VIEW.TABLE:i=DOMVIEW.TABLEVIEW_AFTER_UPDATE;break;case VIEW.HR:i=DOMVIEW.HRVIEW_AFTER_UPDATE;break;case VIEW.TOC:i=DOMVIEW.TOCVIEW_AFTER_UPDATE;break;default:i=DOMVIEW.VIEW_AFTER_UPDATE}e.publish(i,t.getNode())}function a(t){var i;switch(t.getType()){case VIEW.PARA:i=DOMVIEW.PARAVIEW_BEFORE_REMOVE;break;case VIEW.CELL:i=DOMVIEW.CELLVIEW_BEFORE_REMOVE;break;case VIEW.ROW:i=DOMVIEW.ROWVIEW_BEFORE_REMOVE;break;case VIEW.TABLE:i=DOMVIEW.TABLEVIEW_BEFORE_REMOVE;break;case VIEW.HR:i=DOMVIEW.HRVIEW_BEFORE_REMOVE;break;case VIEW.TOC:i=DOMVIEW.TOCVIEW_BEFORE_REMOVE;break;default:i=DOMVIEW.VIEW_BEFORE_REMOVE}e.publish(i,t.getNode(),t)}function s(t){e.publish(DOMVIEW.PAGE_CREATED,t)}function l(t){e.publish(DOMVIEW.PAGE_REMOVED,t)}function d(t){e.publish("Document/lineview/before/update",t)}function c(t){e.publish("Document/view/top/updated",t)}var u=function(u){u.on(DOMVIEW.LINE_ADDED,t,this),u.on(DOMVIEW.LINE_BEFORE_UPDATE,d,this),u.on(DOMVIEW.LINE_UPDATED,i,this),u.on(DOMVIEW.LINE_BEFORE_REMOVE,n,this),u.on(DOMVIEW.PAGE_CREATED,s,this),u.on(DOMVIEW.PAGE_REMOVED,l,this),u.on(DOMVIEW.VIEW_AFTER_CREATE,r,this),u.on(DOMVIEW.VIEW_AFTER_UPDATE,o,this),u.on(DOMVIEW.VIEW_BEFORE_REMOVE,a,this),u.on(DOMVIEW.VIEW_TOP_UPDATED,c,this),e.subscribe("Document/LoadingStart",u.onDocumentLoadingStart)},g=function(u){u.off(DOMVIEW.LINE_ADDED,t,this),u.off(DOMVIEW.LINE_BEFORE_UPDATE,d,this),u.off(DOMVIEW.LINE_UPDATED,i,this),u.off(DOMVIEW.LINE_BEFORE_REMOVE,n,this),u.off(DOMVIEW.PAGE_CREATED,s,this),u.off(DOMVIEW.PAGE_REMOVED,l,this),u.off(DOMVIEW.VIEW_AFTER_CREATE,r,this),u.off(DOMVIEW.VIEW_AFTER_UPDATE,o,this),u.off(DOMVIEW.VIEW_BEFORE_REMOVE,a,this),u.off(DOMVIEW.VIEW_TOP_UPDATED,c,this),e.unsubscribe("Document/LoadingStart",u.onDocumentLoadingStart())};return{register:u,unRegister:g}}(PubSub),PageDomView=function(e,t){"use strict";function i(e,t){this.isPageRendered=!1,this[SECTION_TYPES.CONTENT]={},this[SECTION_TYPES.HEADER]=null,this[SECTION_TYPES.FOOTER]=null,this.container=null,this.contentWrapper=null,this.floatImageContainer=null,DomView.apply(this,arguments),this.updateContentHeight()}var n={constructor:function(){for(var e=0;e<NOTE_SECTIONS.length;e++){var t=NOTE_SECTIONS[e],i=NoteDOMTemplate.getWrapper(t);t===SECTION_TYPES.ENDNOTE?this.contentWrapper.appendChild(i):this.container.appendChild(i);var n=i.firstChild,r=W(n).find(".ui-note-content-wrapper")[0],o={wrapper:i,container:n,contentWrapper:r};this[t]=o}this.updateNoteContainer()},updatePageStyle:function(){this.updatePageHeight(),this.updateNoteContainer()},updateNoteContainer:function(){for(var e=0;e<NOTE_SECTIONS.length;e++){var t=NOTE_SECTIONS[e],i=this.getContainerObj(t);if(this.docView.isNotesEmpty(t))i.wrapper.style.display="none";else{var n=this.docView.getNoteProps(t);i.wrapper.style.display="block",i.container.style.width=n.width+"px",i.container.style.height=n.height+"px",i.container.style.marginLeft=n.left+"px",i.container.style.marginRight=n.right+"px",i.container.style.overflow="hidden"}}},processSectionDetach:function(){this.updateNoteContainer()},destroy:function(){for(var e in NOTE_SECTIONS)this[e]=null}};return t.push(n),i.prototype=Object.create(DomView.prototype),i.prototype.constructor=i,extend(i.prototype,{create:function(){var e=this.docView.documentLayoutManager,t=document.createElement("div");if(t.setAttribute("doc-id",this.docView.getId()),!(e.isWebView()||isHeadlessPDF||isHeadlessHTML||e.isFixedLayout()||editorProps&&editorProps.isPublishToFill)){var i=document.createElement("div");i.className="ui-page-collapse-div";var n=document.createElement("span");n.className+=" js-collpse-span zbutton__icon ui-sprit-lazy",i.appendChild(n),t.appendChild(i)}var r=document.createElement("div");r.className="zw-pagecontainer",r.style.overflow="hidden",r.style.height=this.docView.getDOMViewHeight()+"px",t.appendChild(r),this.container=r,this.el=t,this.addImageContainer();var o=document.createElement("div");o.className="zw-content-wrapper",o.style.position="relative",this.contentWrapper=o,this.container.appendChild(this.contentWrapper),this.updateStyle()},bindEvents:function(){this.docView.on(GROUP.PAGE_BORDER_CHANGED,this.handlePageBorderChange,this)},unbindEvents:function(){this.docView.off(GROUP.PAGE_BORDER_CHANGED,this.handlePageBorderChange,this)},getSectionContainer:function(e){var t=e.getSectionType();return this.getContainerObj(t)?this.getContainerObj(t).el:null},getWrapper:function(e){var t=null;return t=e==SECTION_TYPES.CONTENT?this.contentWrapper:this[e].wrapper},getActiveSectionElem:function(e){var t=e.getSectionType();return HF_SECTIONS.contains(t)?this.getWrapper(t):this.getRenderedDOM(e)},getRenderedDOM:function(e){if(!e)return null;var t;t=e.getType()===VIEW.SECTION?e:e.getSection();var i=t.getSectionType();if(t.isReplicableView()){var n;if(e.getType()===VIEW.SECTION){if(HF_SECTIONS.contains(i))return this[i].el;n=DTUtils.isNonWrappingFloatImage(t.getRangeFormat())?this.getFloatImageContainer(t.getRootSection().getSectionType()):this.getSectionContainer(t.getRootSection());var r=e.id,o="";o+='[doc-id="'+r+'"]';var a=n.querySelector(o);return a||null}n=HF_SECTIONS.contains(i)?this.getSectionContainer(t):DTUtils.isNonWrappingFloatImage(t.getRangeFormat())?this.getFloatImageContainer(t.getRootSection().getSectionType()):this.getSectionContainer(t.getRootSection());var r=e.id,o="";switch(e.getType()){case"para":o="div.zw-paragraph";break;case"table":o="table.zw-table";break;case"row":o="tr.zw-tr";break;case"cell":o="td.zw-td";break;case"line":o=".zw-line-div"}o+='[doc-id="'+r+'"]';var a=n.querySelector(o);return a||null}return this.domViewManager.getDOMElem(e)},getAllRenderedDom:function(e){for(var t=this.docView.getAllViews(e),i=[],n=0;n<t.length;n++)i.push(this.getRenderedDOM(t[n]));return i},addImageContainer:function(){var e=this.container,t=document.createElement("div");t.className="float-image-container",this.floatImageContainer=t;var i=document.createElement("div");i.className="float-image-content-container",i.style.position="relative",this.floatImageContainer.appendChild(i),e.insertBefore(t,e.firstChild)},setDomProps:function(){this.el&&this.el.setAttribute("doc-id",this.docView.getId())},getContentContainer:function(){return this.container},getContainerObj:function(e){return this[e]},getPrevEl:function(){var e=this.docView.documentLayoutManager.getPrevPage(this.docView),t=null;return e&&(t=this.domViewManager.getDOMElem(e)),t},addViewToDOM:function(){var e=this.getPrevEl(),t=this.domViewManager.getEditorPane(),i=null;if(e)for(var n=e.nextSibling;n;){if(n.className&&n.className.indexOf("zw-page")!==-1){i=n;break}i=null,n=n.nextSibling}else i=t.firstChild;t.insertBefore(this.el,i)},getOrientationClass:function(){var e=this.docView.getGroup(),t="ui-"+parseInt(e.getPageHeight())+"-"+parseInt(e.getPageWidth())+"-"+e.getPageOrientation().toLowerCase();return t},updateStyle:function(){var e=this.docView.documentLayoutManager,t={width:this.docView.getDOMViewWidth()+"px",height:this.docView.getDOMViewHeight()+"px",backgroundColor:e.getBackgroundColor(),display:"block"},i=e.getDocumentViewType();if(i===EDITORVIEW_TYPE.PAGE_VIEW||i===EDITORVIEW_TYPE.PUBLISH_VIEW){var n="zw-paginated zw-page";e.hasRotatedPageInDocument()&&(n+=" "+this.getOrientationClass()),this.el.className=n}else this.el.className="zw-fixedview zw-page";DomViewManager.isMultiplePagesInRow()?this.el.style.position="absolute":this.el.style.position="relative",i===EDITORVIEW_TYPE.WEB_VIEW||DomViewManager.isMultiplePagesInRow()?(this.el.style.marginLeft="0px",this.el.style.marginRight="0px"):(this.el.style.marginLeft="auto",this.el.style.marginRight="auto"),this.docView.style[ATTR_BODY.WM_URL]&&!editor.isOffline()&&(t.background="transparent url("+DomUtil.processImgSrc(this.docView.style[ATTR_BODY.WM_URL])+") no-repeat 50%"),J(this.el).css(t);var r=W(this.el).find(".js-collpse-span")[0];if(r){var o=r.className;o=o.replace(" ui-icon-page-expand-sm",""),o=o.replace(" ui-icon-page-collapse-sm",""),o+=i===EDITORVIEW_TYPE.FIXED_VIEW?" ui-icon-page-expand-sm":" ui-icon-page-collapse-sm",r.className=o}this.updatePageHeight()},updatePageHeight:function(){this.updateContentHeight(),this.updateHeight()},updatePageBackground:function(){var e={backgroundColor:this.docView.documentLayoutManager.getBackgroundColor()};J(this.el).css(e)},destroy:function(){this.remove(),DomView.prototype.destroy.apply(this,arguments),this[SECTION_TYPES.HEADER]=null,this[SECTION_TYPES.FOOTER]=null,this[SECTION_TYPES.CONTENT]=null,this.contentWrapper=null,this.container=null},updateContentHeight:function(){this.contentWrapper.style.height=this.docView.getContentContainerHeight()+"px",this.handlePageBorderChange()},updateHeight:function(){this.el.style.height=this.docView.getDOMViewHeight()+"px",this.container.style.height=this.docView.getDOMViewHeight()+"px"},updatePageCountInViews:function(){this.updatePageCountInView(SECTION_TYPES.HEADER),this.updatePageCountInView(SECTION_TYPES.FOOTER)},updatePageCountInView:function(e){var t=this.getContainerObj(e);if(t){var i=this.docView.getGroup().getRelativePageCount(),n=t.relativePageCountFields;n&&n.length&&J(n).text(i),i=this.docView.getGroup().documentLayoutManager.getPageCount(),n=t.absolutePageCountFields,n&&n.length&&J(n).text(i)}},updatePageNumberInViews:function(){this.updatePageNumberInView(SECTION_TYPES.HEADER),this.updatePageNumberInView(SECTION_TYPES.FOOTER)},updatePageNumberInView:function(e){var t=this.getContainerObj(e);if(t){var i=this.docView.getPageNumber(),n=this.docView.getGroup().getPageNumberFormat();i=ListUtils.getListNumber(n,i,null,!0);var r=t.pageNumberFields;r&&r.length&&J(r).text(i)}},handleTableEventsForHFSection:function(e){if(e&&editor.getRole().permissions.can("document.edit")){var t=e.getAllViewsOfGivenType(VIEW.TABLE);t.forEach(function(e){var t=this.getRenderedDOM(e);DomUtil.bindTableEvents(t)}.bind(this))}},showHideContentSections:function(e){for(var t,i=this.docView.content.first;i;)t=this.domViewManager.getDOMElem(i),t&&(t.style.display=e),i=i.next},showHideHFSections:function(e){for(var t=0;t<e.length;t++){var i=this.getContainerObj(e[t]);if(i){var n=i.wrapper.className;n=n.replace(/\s+(hf\-(show|hide))/gi,""),n+=this.docView.isHFVisible(e[t])?" hf-show":" hf-hide",i.wrapper.className=n}}},processSectionAttach:function(e){var t=e.getSectionType(),i=this.domViewManager.getDOMObj(e);switch(t){case SECTION_TYPES.CONTENT:i.addViewToDOM();break;case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:i.addViewToDOM(),this.updateNoteContainer(t);break;case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:this.updateHFSection(e);break;case SECTION_TYPES.TEXTBOX:e.isReplicableView()&&this.updateHFSection(e.getRootSection())}i.updateStyle()},processSectionDetach:function(e){var t=e.getSectionType(),i=this.domViewManager.getDOMObj(e);switch(t){case SECTION_TYPES.CONTENT:i.remove();break;case SECTION_TYPES.ENDNOTE:case SECTION_TYPES.FOOTNOTE:i.remove(),this.updateNoteContainer(t);break;case SECTION_TYPES.HEADER:case SECTION_TYPES.FOOTER:var n=this[t];n&&(n.remove(),this[t]=null);break;case SECTION_TYPES.TEXTBOX:e.isReplicableView()&&this.updateHFSection(e.getRootSection())}},updateHFSection:function(e){var t=e.getSectionType(),i=this[t]||null,n=this.domViewManager.getDOMObj(e);if(i)i.update();else{if(i=new HFCloneDOMView(n,this),t===SECTION_TYPES.HEADER){var r;r=this.container.firstChild==this.floatImageContainer?this.floatImageContainer.nextSibling:this.container.firstChild,this.container.insertBefore(i.wrapper,r)}else this.container.appendChild(i.wrapper);this[t]=i}this.moveHFFloatImageContainerToPage(i,t),this.updateHFSectionMargins(i),this.showHideHFSections(e),this.handlePageBorderChange(),this.updatePageCountInView(t),this.updatePageNumberInView(t),this.handleTableEventsForHFSection(e),this.updateFloatImagePosition(e)},moveHFFloatImageContainerToPage:function(e,t){var i=this.getFloatImageContainer(t);i&&i.parentNode.removeChild(i);var n=e.floatImageContainer;n&&(n.parentNode.removeChild(n),this.floatImageContainer.appendChild(n))},updateHFSectionMargins:function(e){var t=this.getDocView(),i=e.docView,n=i.getStyleInfo(t);e.content.style.paddingLeft=n.marginLeft+"px",e.content.style.paddingRight=n.marginRight+"px"},getFloatImageContainer:function(e){return this.floatImageContainer.querySelectorAll(".float-image-"+e+"-container")[0]},updateFloatImagePosition:function(e){var t=this.docView,i=t.isEvenPage();if(i)for(var n,r,o,a,s=e.getSectionType(),l=this.getFloatImageContainer(s),d=e.getFloatImages(),c=0;c<d.length;c++)n=d[c],r=n.getView(),r&&n.isBookLayoutImage()&&(a=l.querySelectorAll("div[fid='"+n.getId()+"']")[0],a&&(o=n.getPageOffset(i),a.parentElement.style.top=o.top+"px",a.parentElement.style.left=o.left+"px"))},handlePageBorderChange:function(){PageBorders.updatePageBorders(this.docView)}}),e.extend(i,t)}(PluginExtender,[]),DomViews;!function(){"use strict";DomViews={para:ParaDomView,cell:CellDomView,row:RowDomView,table:TableDomView,hr:HrDomView,toc:TocDomView,column:ColumnDomView,content:ContentDomView,header:HFDomView,footer:HFDomView,endnote:NoteDomView,footnote:NoteDomView,textbox:TextBoxDomView,page:PageDomView}}();var Shapes=function(){"use strict";var e={},t={},i={WATERMARK:"WATERMARK",BGSHAPE:"bgshape"},n={A1:"zwaccent1",A2:"zwaccent2",A3:"zwaccent3",A4:"zwaccent4",A5:"zwaccent5",A6:"zwaccent6",BG1:"zwlight1",BG2:"zwlight1",TX1:"zwdark1",TX2:"zwdark2"},r=function(){"undefined"!=typeof Shape&&(Shape.init(),ShapeObject.init(),window.ShapeEditor=new ZSShapeEditor(null,null))},o=function(t){return e[t]},a=function(e,t){if(e&&t){var i="stroke"==t?e.props.stroke&&e.props.stroke.fill:e.props.fill;return i}},s=function(e){return e.indexOf("rgba")!=-1&&(e=ZWColorUtils.rgbaToRgb(e)),"string"==typeof e&&(e=e.replace(/[rgb() ]/g,"").split(",")),e.map(Number)},l=function(e){var t="",i=[0,0,0];if("CUSTOM"!=e.type){if(t+=n[e.type],e.tweaks&&e.tweaks.hsl&&e.tweaks.hsl.luminance){var r=e.tweaks.hsl.luminance;1==r.length?t+="*"+parseInt(100*r[0].value):2==r.length&&(t+="/"+parseInt(100*r[0].value))}var o=Utils.getColorValFromRefString(t);i=s(o)}else i=s(e.rgb);return e.rgb=i,e},d=function(e){var t=e.shapes,i=DocumentDesign.getTheme();if(t)for(var n=0;n<t.length;n++)e.shapes[n]=d(t[n]);var r=a(e,"fill");r&&"SOLID"==r.type&&l(r.solid.color);var o=a(e,"stroke");o&&"SOLID"==o.type&&l(o.solid.color);var s=e.textBody;if(s)for(var c=s.paras||[],n=0;n<c.length;n++)for(var u=c[n].portions,g=0;g<u.length;g++){var h=u[g],f=h.props.font.fontFamily.zwtheme&&h.props.font.fontFamily.zwtheme.fname||h.props.font.fontFamily.name;f==SHAPE.THEME.FF_ZWMINOR?f=i.font.minor.latin:f==SHAPE.THEME.FF_ZWMAJOR&&(f=i.font.major.latin),h.props.font.fontFamily.name=f}return e},c=function(e,n){e.shapetype==i.WATERMARK&&n&&(n=n.replace("header_",""),"header"!=n&&"odd"!=n||(n="primary"),t[n]=e.nvOProps.nvDProps.id)},u=function(e,t){if("GROUPSHAPE"===t.type){var i=t.shapes,n=e.children();J.each(n,function(e,t){if(i[e].props.fill&&"PICT"==i[e].props.fill.type){var n=J(t).find("image")[0],r=i[e].props.fill.pict.value.url;J(n).attr("href",R(r))}})}else if(t.props.fill&&"PICT"==t.props.fill.type){var r=e.find("image")[0],o=t.props.fill.pict.value.url;J(r).attr("href",R(o))}},g=function(e){var t=!1;return"PICT"==(e.props.fill&&e.props.fill.type)||"CONNECTOR"==e.type?t=!0:e.props.effects&&(e.props.effects.shadow||e.props.effects.reflection)&&(t=!0),t},h=function(e,t,i){var n="";if(e.shapes){var r=e.shapes;J.each(r,function(e,t){if(g(t))return void(n=!0)})}else n=g(e);isHeadlessPDF||isHeadlessHTML||!i||i.indexOf("header")==-1&&i.indexOf("footer")==-1||!n||T(t,e)},f=function(){var e=Z("zw-patterns-defs-container");return e.length||(e=p()),e},p=function(){var e="http",t=J('<div id="zw-defcontainer" style="overflow:hidden;width:1px;height:1px;position: absolute;"><span id="zw-svgcontainer" style="display:block;"><svg xmlns="'+e+'://www.w3.org/2000/svg" xmlns:xlink="'+e+'://www.w3.org/1999/xlink" overflow="auto" preserveAspectRatio="none" style="position: absolute; top: -1px; left: -1px;" id="root" class="base_root" version="1.1" viewBox="-1, -1, 962,542" width="962" height="542" z-index="0"><defs id="zw-patterns-defs-container"></defs></svg></span></div>');return J("body").prepend(t),t.find("#zw-patterns-defs-container")},E=function(e){return(e.data||e).nvOProps.nvDProps.id},T=function(e,t){var i=f(),n=E(t);i.find("."+n).remove();var r=e.find("defs").children();J.each(r,function(e,t){var r=J(t).clone(!0),o=r.attr("class")||"";r.attr("class",o+" "+n),i.append(r)})},O=function(e,t){if(e=JSON.parse(JSON.stringify(e)),e.shapetype==i.WATERMARK){var n=m();J(t).append(n)}e=d(e),e.textBody&&(e.textBody.element="");var r="";r="GROUPSHAPE"===e.type?GroupShape.create.updateAndDraw(e,t):Shape.create.draw(e,t);var o=J(r);return o.css({top:0,left:0}),o},m=function(){var e=document.createElement("div");return e.setAttribute("class","inner_shape watermark_cont"),e.style.zindex=0,J(e)},I=function(t,i){if(delete t.fitModeData,"GROUPSHAPE"==t.type){var n=t.shapes;J.each(n,function(e,t){t.textBody&&(t.textBody.element="",n[e]=t)})}else t.textBody&&(t.textBody.element="");var r=i,o=[];o.push(JSON.stringify(t)),o.push(r),e[t.nvOProps.nvDProps.id]=o},D=function(e,t,n,r){var a=J(e),s=(a.parents(".zw-page"),t[ATTR_IMAGE.I_SHAPEDATA]),l=a;l.length>1&&(l=J(l[0]).hasClass("watermark_cont")?J(l[1]):J(l[0])),l.css("display","none");var d=J(document.createElement("div"));J(d).addClass("zw-image").attr("id",t.id);try{var g=s.nvOProps.nvDProps.id;s.fitModeData&&delete s.fitModeData,s.textBody&&(s.textBody.element="");var f=o(g);if(f&&f[0]==JSON.stringify(s)){var p=f[1],E=J(p);if(s.shapetype==i.WATERMARK){var T=m();a.append(T.append(E))}else d.append(E)}else{isHeadlessPDF&&s.props.stroke&&0==s.props.stroke.width&&(s.props.stroke.fill={type:"NONE"});var D=void 0;c(s,n);var R=JSON.parse(JSON.stringify(s));R.props.transform.pos.top=0,R.props.transform.pos.left=0;var S=ShapeEditor.getBoundingDimensions([R]);s.fitModeData={top:S.pos.top,left:S.pos.left,height:S.dim.height,width:S.dim.width},D=O(s,d),u(D,s),h(s,D,n),I(s,D)}(J(d).children().length||a.find(".watermark_cont")[0])&&(l.append(d),l.css("display","block"))}catch(e){ZWCollaboration.clientInfo+="Draw Shape in para log :: "+e.stack}},R=function(e){return e.indexOf("image.do?imgurl=")!=-1?(e=e.substring(e.indexOf("image.do?imgurl=")),e=ZWNetworkUtils.getContextUrl(e)):e.indexOf("remoteImage.do?imgurl=")!=-1&&(e=e.substring(e.indexOf("remoteImage.do?imgurl=")),e=ZWNetworkUtils.getContextUrl(e)),e},S=function(e){return t[e]},C=function(e){delete t[e]},A=function(e,t){if(!e)return[];if(t||(t=[]),e.shapes)for(var i=0;i<e.shapes.length;i++)A(e.shapes[i],t);else if(e.textBody){var n=e.textBody.paras;if(n)for(var i=0;i<n.length;i++){var r=n[i].portions;if(r)for(var o=0;o<r.length;o++)try{t.push(r[o].props.font.fontFamily.name)}catch(e){}}}return t},v=function(e){e=e.data||e;var t,i=e.shapes;return t="headless"===editorProps.mailmergetype?docProps.content.defaults.theme:DocumentDesign.getTheme(),i&&J.each(i,function(e,t){t.nvOProps.nvDProps.id=Math.uuid(),i[e]=t}),e.nvOProps.nvDProps.id=Math.uuid(),e},_=function(e){var t=o(e);return JSON.parse(t[0])},P=function(){var e=editor.doc.getSelection().getStart(),t=editor.doc.getRawFormatAt(e);return!!t&&!!t.shapeData};return{init:r,constant:i,drawShapeInPara:D,getRGBArray:s,createShape:O,getFontFamiliesInShape:A,getWatermarkId:S,deleteWatermarId:C,getShapeFromCache:o,renewShape:v,getShapeData:_,isSelected:P}}();!function(e){function t(e){var t=!!e&&"length"in e&&e.length,i=jQuery.type(e);return"function"!==i&&!jQuery.isWindow(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}jQuery.extend({isObject:function(e){return"object"==typeof e},each:function(e,i){var n,r=0;if(t(e))for(n=e.length;r<n&&i.call(e[r],r,e[r])!==!1;r++);else for(r in e)if(i.call(e[r],r,e[r])===!1)break;return e}})}(jQuery);var ZWScrollBinder=function(){var e=function(e){editor?e.attachEvent?e.attachEvent("onscroll",editor.mouseEventHandler):e.addEventListener("scroll",editor.mouseEventHandler):ZWLogger.log("Trying to attach scroll event without editor object...")},t=function(){var t=document.getElementById("ui-editor-outer-div");t?e(t):ZWLogger.log("Editor pane container not found...")};PubSub.subscribe("Document/InitEditor",t)}();DocEvents=function(){var e=editorProps.deployment.writer,t=function(e){editor.editorPaneContainer=J("#ui-editor-outer-div"),editor.editorPaneContainerOffset=editor.editorPaneContainer.offset(),editor.editorPaneContainerHt=editor.editorPaneContainer.height(),UIUtils.setProperties(e),UIUtils.showLoadingMsg(J.i18n("writer.common.LOADING")),J("#drawcontainer").length&&Shapes.init(),writerConfig.init()},i=function(e){editor.isHardReload&&J("#loading-page-div").hide()},n=function(e){404==e?UIUtils.showNetworkError():UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION"),J.i18n("error","OOPS"),"error",reload)},r=function(e){var t=e.docInfo.DOCUMENT_ID,i=e.REASON,n=loadFailureCases._default;return loadFailureCases.hasOwnProperty(i)&&(n=loadFailureCases[i]),n.apply(null,[t])},o=function(e){J("#menuitem-holder").show(),editor.getView()!=EDITOR_VIEWS.HISTORY&&editor.getView()!=EDITOR_VIEWS.MAILMERGE_PREVIEW&&J("#bottomband-container").show()},a=function(e){if(e&&e.cursor&&editor.getRole().permissions.can("document.edit"))for(var t,i,n=e.node,r=n.parent.getIndex(),o=r+n.start,a=r+n.end,s=e.cursor[editor.uuid]||[],l=0,d=s.length;l<d;l++)if((t=s[l])&&t.start&&t.end){if(t.start!=t.end)return;o<=t.start&&t.start<=a&&t.start>-1&&t.end>-1&&(i=editor.doc.createRange(t.start,t.end),editor.doc.getSelection().removeAllRanges().showCaret(i))}},s=function(e){var t=Utils.endTime("LOADING_DOCUMENT");editor.docClientInfo.LOADING_DOCUMENT=t,"function"==typeof window.callPhantom&&window.callPhantom(),e&&e.cursorStart>-1&&e.cursorEnd>-1&&handleToolbarAndComments(),UIUtils.JprogressDiv&&(UIUtils.JprogressDiv.hide(),UIUtils.JprogressDiv=null),editor.getRole().permissions.can("document.edit")||"undefined"==typeof RemoteEditor||jQuery.isEmptyObject(RemoteEditor.options.searchText)||Utils.hiliteText(RemoteEditor.options.searchText),"undefined"!=typeof RemoteEditor&&RemoteEditor.options.pview&&(J("#microandparaVCContainer,#topband-wrapper").remove(),J(".fixedwidth").css("margin","0px"),J("#mainOuterDiv").css({width:"833px","margin-top":"0px"}),J("#ui-editor-outer-div").css({width:"852px",overflow:"auto",height:"510px"}),document.body.style.border="1px solid #FFF",J(".ui-zeditor-light-background").css({background:"#FFF"}),document.body.style.background="#FFF")},l=function(e){UIUtils.showZohoError(e.title,e.errorMsg,e.errorNo)},d=function(){"undefined"!=typeof EditorLayout&&EditorLayout.updateMainOuterDivProps(),DomUtil.setEditorHht(),editor.customZoom&&""!=editor.customZoom&&DomViewManager&&!DomViewManager.isMultiplePagesInRow()&&UIUtils.setZoomFactor(editor.customZoom);var e=J(".ui-footer-scroll-cont");J(e).addClass("ui-sm-scroll"),J(e).removeClass("ui-sm-scroll")},c={NEW_VERSION_UPLOADED:function(t){editor.getView()==EDITOR_VIEWS.HISTORY||editor.getView()==EDITOR_VIEWS.VERSIONVIEW?UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD"),e,"info",void 0,!1):editor.getRole().permissions.can("document.edit")&&UIUtils.showMessagePopup(J.i18n("common","VERSION_UPLOAD_RELOAD"),e,"info",editor.reloadDocumentContent,!0)},NOHEADINGFOUND:function(e){UIUtils.showMessagePopup(J.i18n("editor","TOC.NOHEADINGFOUND"),J.i18n("editor","TOC.NOHEADINGFOUND_TITLE_MSG"),"info")},NOHEADINGFOUND_FOR_OPTION_CHOOSED:function(e){UIUtils.showMessagePopup(J.i18n("editor","TOC.NOHEADINGFOUND_FOR_OPTION_CHOOSED",[e+""]),J.i18n("editor","TOC.NOHEADINGFOUND_TITLE_MSG"),"info")},LOWER_HEADING_FOUND:function(e){UIUtils.showMessagePopup(J.i18n("editor","TOC.LOWER_HEADING_FOUND",[e+""]),J.i18n("editor","TOC.NOHEADINGFOUND_TITLE_MSG"),"info")},MERGE_IS_NOT_POSSIBLE:function(e){UIUtils.showMessagePopup(J.i18n("common","MERGE_IS_NOT_POSSIBLE"),J.i18n("common","MERGE_IS_NOT_POSSIBLE_TITLE_MSG"),"info")},BOOKMARK_REMOVED:function(){UIUtils.showMessagePopup(J.i18n("common","BOOKMARK_REMOVED_MSG"),J.i18n("common","BOOKMARK_REMOVED_TITLE"),"status")},HEADING_REMOVED:function(){UIUtils.showMessagePopup(J.i18n("common","HEADING_REMOVED_MSG"),J.i18n("common","HEADING_REMOVED"),"status")},UNABLE_TO_LOAD_VERSION:function(){UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION"),J.i18n("error","OOPS"),"error",function(){})},UNABLE_TO_LOAD_CONTENT_IN_MAILMERGE_PREVIEW:function(){UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_CONTENT_IN_MAILMERGEPREVIEW"),J.i18n("error","OOPS"),"error",function(){})},UNABLE_TO_LOAD_VERSION_IN_HISTORY:function(){UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_LOAD_VERSION_HISTORY"),J.i18n("common","UNABLE_TO_LOAD_VERSION_HISTORY_TITLE_MSG"),"error",function(){})},UNABLE_TO_PREVIEW_TEMPLATE:function(){UIUtils.showMessagePopup(J.i18n("common","UNABLE_TO_PREVIEW_TEMPLATE"),e,"error",function(){})},REPLACE_NO_MATCHES_FOUND:function(){J("#errormsg").show().html(UIUtils.getErrorMsg("error",J.i18n("common","REPLACE.NO_MATCHES_FOUND")))},REPLACE_SEARCH_COMPLETED_MSG:function(e){J("#errormsg").show().html(UIUtils.getErrorMsg("info",J.i18n("common","REPLACE.SEARCH_COMPLETED_MSG",new Array(e+""))))},COLUMN_WIDTH_IS_LESS:function(){UIUtils.showMessagePopup("Column Width cannot be less than 1.27cm","Column Width not fit to Page Dimension You choosed","info")},SERVER_BUSY:function(){editor.rebindEvents(ERROR_PERMISSION);var e=ZWCollaboration.ACKPENDING_ERROR,t=ZWLogger.shrinkOperationSequence(ZWCollaboration.operationSequence).join(",");ZWLogger.sendErrorDetails(e+"<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"<ZWERROR>\n Error Log Start \n"+ZWCollaboration.clientInfo+"\n Err No ="+e+" DOC len ="+editor.doc.getDocumentLength()+" Cur St ="+editor.doc.getSelection().getStart()+" Cur end="+editor.doc.getSelection().getEnd()+" MsgQueue = "+ZWCollaboration.msgQueue.toProtoString()+" FULL DOC OP IDS :: "+ZWCollaboration.docOpIds+" buildLabel::: "+buildLabel+"\nOperation Sequence: \n"+t+"\nError Log End \n<ZWERROR>"+ZWCollaboration.mailInfo,null,e);var i=function(){editor.rebindEvents(),editor.reloadDocumentContent()};UIUtils.showMessagePopup(J.i18n("error","MSG_SERVER_BUSY"),J.i18n("error","TITLE_SERVER_BUSY"),"warning",i,!0)},NO_IMAGE_FOUND:function(e){UIUtils.showMessagePopup(J.i18n("editor","NO_IMAGE_FOUND_MSG"),J.i18n("editor","NO_IMAGE_FOUND_TITLE_MSG"),"info")},MERGE_CELLS_FOUND:function(){UIUtils.showMessagePopup(J.i18n("sort","MERGE_CELLS_FOUND_MSG"),J.i18n("sort","MERGE_CELLS_FOUND_TITLE_MSG"),"info")},_default:function(){}},u=function(e,t){var i=c._default;c.hasOwnProperty(e)&&(i=c[e]),i.apply(null,[t])},g=function(e,t){var i={},n=editor.doc.getUserData()[e];n&&(i.LASTMODIFIEDBY_ZUID=e,i.LASTMODIFIEDBY=n.fname,i.LASTMODIFIEDBY_HTML=n.fname_HTML,i.LAST_MODIFIED_TIME_LONG=t?t:(new Date).getTime(),DocInfo.setProperty(i))},h=function(e,t,i,n,r){e&&"-1"!=i&&g(i,n),UIUtils.showSaveStatus(e,t,i,n,r)},f=function(){try{editor.handleScroll(),UIUtils.JdocumentMenu.hide(),jQuery.isEmptyObject(editor.doc.paintFormat)||editor.jeditorPane.find("div.zw-page").css("cursor","pointer")}catch(e){}},p=function(){UIUtils.showMessagePopup(J.i18n("common","TC_EDITING_NOT_ALLOWED"),J.i18n("error","OOPS"),"error",editor.reloadDocumentContent)},E=function(){PubSub.subscribe("Document/InitEditor",t),PubSub.subscribe("Document/BeforeLoading",i),PubSub.subscribe("Document/LoadingError",n),PubSub.subscribe("Document/LoadingFailed",r),PubSub.subscribe("Document/LoadingStart",o),PubSub.subscribe(DOCUMENT.LOADING_PROGRESS,a),PubSub.subscribe("Document/LoadingComplete",s),PubSub.subscribe("Document/Error",l),PubSub.subscribe("Document/Warning",u),PubSub.subscribe("Document/Resize",d),PubSub.subscribe("Document/SaveStatus",h),PubSub.subscribe("Document/ScrollEvent",f),PubSub.subscribe("Document/UnauthorizedTCEdit",p)};return{addSubscribers:E}}(),DocEvents.addSubscribers(),function(e){ZComponents.znumberfield.DEFAULTS={triggerBlurOnSpinButtonClick:!0,bindedSpinAndChange:!0,clearButton:"none",stepBehavior:"w3"},ZComponents.zlabelednumberfield.DEFAULTS={triggerBlurOnSpinButtonClick:!0,stepBehavior:"w3"},ZComponents.ztabpanel.DEFAULTS={keyboardNavigation:!1},ZComponents.zdialog.DEFAULTS={resizable:!1},ZComponents.zalertbanner&&(ZComponents.zalertbanner.DEFAULTS={margin:{top:"8px"}}),ZComponents.zmenu.DEFAULTS={minWidth:"65px"},ZComponents.ZCtrackObjects.DEFAULTS={eventNameMapping:{zlabeledbuttonset:"zlabeledbuttonsetchange",zlabeledselectbox:"zlabeledselectboxchange",zlabeledcombobox:"zlabeledcomboboxchange",znumberfield:"znumberfieldblur",zlabelednumberfield:"zlabelednumberfieldblur",zfontcombo:"zfontcombochange",zbutton:"zbuttonclick",zstatebutton:"zstatebuttonchange",zspinnerslider:"zspinnersliderchange",zcolorselectbox:"zcolorselectboxpick",zcolorsplitbutton:"zcolorsplitbuttonpick",zadvancedcolorpicker:"zadvancedcolorpickerpick",zcolorpicker:"zcolorpickerpick",zdatetimefield:"zdatetimefieldblur",zsplitbutton:"zsplitbuttonclick"}},ZComponents._getObject=function(e,t){if("object"==typeof e)return e;e=e||t.getAttribute("data"),e=e.indexOf("{")<0?"{"+e+"}":e;try{e=JSON.parse(e.replace(/'/g,'"'))}catch(e){return J(t).metadata()}return e},ZComponents.registerComponent("zselectbox",e.zselectbox,{_onItemClick:function(e,t){var i=this._super;return!!this._dispatchEvent("beforeitemclick",e,t)&&void i.apply(this,[e,t])},removeAllOptions:function(){this.removeOption()},disable:function(){this.setAttribute("disabled",!0)},enable:function(){this.setAttribute("disabled",!1)}}),ZComponents.registerComponent("zcombobox",e.zcombobox,{removeAllOptions:function(){this.removeOption()},disable:function(){this.setAttribute("disabled",!0)},enable:function(){this.setAttribute("disabled",!1)}}),ZComponents.registerComponent("zmenu",e.zmenu,{check:function(t){this.checkMenuItems([e("#"+t)])},uncheck:function(t){this.uncheckMenuItems([e("#"+t)])},checkAllItems:function(e,t){return e?this.checkMenuItems(t):void this.uncheckMenuItems(t)},changeLabel:function(e,t){this.setMenuItemsAttribute(["#"+e],"label",t)},changeIcon:function(e,t){this.setMenuItemsAttribute(["#"+e],"icon",t)},removeAllMenuItems:function(){this.removeMenuItems()},disableMenuItem:function(t){t=0===t.indexOf("#")?t:"#"+t,this.setMenuItemsAttribute([e(t)],"disabled",!0)},disableMenuItems:function(e){for(var t=0;t<e.length;t++)this.setMenuItemsAttribute([J("#"+e[t])],"disabled",!0)},disable:function(){this.setMenuItemsAttribute(this.element.find("li"),"disabled",!0)},enable:function(){this.setMenuItemsAttribute(this.element.find("li"),"disabled",!1)},enableMenuItem:function(t){t=0===t.indexOf("#")?t:"#"+t,this.setMenuItemsAttribute([e(t)],"disabled",!1)},enableMenuItems:function(e){for(var t=0;t<e.length;t++)this.setMenuItemsAttribute([J("#"+e[t])],"disabled",!1)},hoverPreviousMenuItem:function(){this.hoverMenuItem(this._getNextMenuItem(!0))},hoverNextMenuItem:function(){this.hoverMenuItem(this._getNextMenuItem(!1))},showMenuItem:function(t){t="string"==typeof t&&(0===t.indexOf("#")?t:"#"+t)||t,this.setMenuItemsAttribute([e(t)],"hidden",!1)},showMenuItems:function(e){if(!e||"string"!=typeof e[0])return void this._super(e);for(var t=0;t<e.length;t++)this.showMenuItem(e[t])},showAllMenuItems:function(){this.showMenuItems()},hideMenuItem:function(t){t=0===t.indexOf("#")?t:"#"+t,this.setMenuItemsAttribute([e(t)],"hidden",!0)},hideMenuItems:function(e){if(!e||"string"!=typeof e[0])return void this._super(e);for(var t=0;t<e.length;t++)this.hideMenuItem(e[t])},hideAllMenuItems:function(){this.hideMenuItems()}}),ZComponents.registerComponent("zbutton",e.zbutton,{enable:function(){this.setAttribute("disabled",!1)},disable:function(){this.setAttribute("disabled",!0)},changeLabel:function(e){this.setAttribute("text",e)},changeIcon:function(e){this.setAttribute("icon",e)},check:function(){this.setAttribute("checked",!0)},uncheck:function(){this.setAttribute("checked",!1)},getAllIconHolders:function(t){var i=t?[]:{};return this._getAllMenuItems().each(function(n,r){r=e(r);var o=t?n:r.attr("id"),a=r.find(".zmenu__image");i[o]={icon:a,item:r}}),i}}),ZComponents.registerComponent("zbuttonset",e.zbuttonset,{enable:function(e){this.setButtonsAttribute(e,"disabled",!1)},disable:function(e){this.setButtonsAttribute(e,"disabled",!0)},check:function(e){this.setButtonsAttribute(e,"checked",!0)},uncheck:function(e){this.setButtonsAttribute(e,"checked",!1)}}),ZComponents.registerComponent("zmenubutton",e.zmenubutton,{changeLabel:function(e){this.setAttribute("text",e)},enable:function(){this.setAttribute("disabled",!1)},disable:function(){this.setAttribute("disabled",!0)}}),ZComponents.registerComponent("ztooltip",e.ztooltip,{setContent:function(e,t){var i=ZComponents.getOptions(e.targetElement);i.customTooltip&&(e.isMessageHTMLEncoded=!0,colonClass=i.titleColon?"ui-colon":"",t='<div class="ui-ztooltip-header '+colonClass+'">'+e.title+'</div><div class="ui-ztooltip-content">'+i.titleInnerHTML+"</div>"),this._super.apply(this,arguments)}}),ZComponents.registerComponent("zdialog",e.zdialog,{reposition:function(){this._positionDialog(),this.container.css(this._dialogPosition)}}),e.zdatetimefield&&ZComponents.registerComponent("zdatetimefield",e.zdatetimefield,{setValue:function(e){e?this._super(e):this._clearHandler()}}),e.zcolorpicker&&ZComponents.registerComponent("zcolorpicker",e.zcolorpicker,{_create:function(){this._super();var t='<div class="zcolorpicker__colorlabel clearfix"><span class="ui-fl">Applied Color</span><span class="zcolorpicker__colorelem ui-fr"></span><span class="zcolorpicker__colorcode ui-fr">#ffffff</span></div>';e(t).prependTo(this.element.find(".zcolorpicker__default")),this.options.clrlbl=!1},setAttributes:function(e){if(this._super(e),this.options.clrlbl){var t=this.element.find(".zcolorpicker__colorlabel"),i=this.element.find(".zcolorpicker__default");t.show(),i.children(":first").is("zcolorpicker__colorlabel")||t.prependTo(i)}else this.element.find(".zcolorpicker__colorlabel").hide();this._resetDimension()},_onClose:function(){this._super(),this.element.find(".zcolorpicker__colorlabel").hide(),this.options.clrlbl=!1}})}(jQuery),function(e){"use strict";var t=document.createElement("fakeelement").style,i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"},r=function(e){for(var i in e)if(void 0!==t[i])return e[i];return""},o=function(e){e.forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){null!==this.parentNode&&this.parentNode.removeChild(this)}})})},a=function(e){e.forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach(function(e){var i=e instanceof Node;t.appendChild(i?e:document.createTextNode(String(e)))}),this.appendChild(t)}})})};e.MouseWheelEvent="onwheel"in e?"wheel":"onmousewheel"in e?"mousewheel":"DOMMouseScroll",e.TransitionEndEvent=r(i),e.AnimationEndEvent=r(n),e.remove=o([Element.prototype,CharacterData.prototype,DocumentType.prototype]),e.append=a([Element.prototype,Document.prototype,DocumentFragment.prototype]),function(){function t(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}return"function"!=typeof e.CustomEvent&&(t.prototype=e.Event.prototype,void(e.CustomEvent=t))}()}(window),writerConfig.prototype={init:function(){UIUtils.configureDialog()}},writerConfig=new writerConfig,UIUtils.setProperties=function(e){UIUtils.forumURL=e.urls.forumURL,UIUtils.blogURL=e.urls.blogURL,UIUtils.blogBaseURL=e.urls.blogBaseURL,UIUtils.reportabuseURL=e.urls.zohoURL+"/report-abuse/?ref=writer",UIUtils.writerLandingPageURL=e.urls.writerLandingPageURL,UIUtils.faqURL=e.urls.zohoURL+"/docs/faq/online-editors.html",UIUtils.howtoURL=e.urls.helpPageURL+"creating-and-editing-documents.html",UIUtils.fbURL=e.fbURL,UIUtils.twitterURL=e.twitterURL,UIUtils.linkedinURL=e.linkedinURL,UIUtils.publicTemplatesURL=e.publicTemplatesURL,UIUtils.contactsURL=e.contactsURL,UIUtils.iosAppURL=e.urls.iosAppURL,UIUtils.macAppURL=e.urls.macAppURL,UIUtils.androidAppURL=e.urls.androidAppURL,UIUtils.chromeWebStoreURL=e.urls.chromeWebStoreURL,UIUtils.chromeExtensionURL=e.urls.chromeExtensionURL,UIUtils.firefoxExtensionURL=e.urls.firefoxExtensionURL,UIUtils.safariExtensionURL=e.urls.safariExtensionURL,UIUtils.edgeExtensionURL=e.urls.edgeExtensionURL,UIUtils.aboutofflineURL=e.urls.aboutofflineURL,UIUtils.whatsNewURL=e.urls.zohoURL+"/writer/help/whats-new.html?ref=product",UIUtils.signInURL=e.urls.signInURL,UIUtils.oneZohoURL=e.urls.oneZohoURL,UIUtils.developerApiURL=e.urls.zohoURL+"/officeapi?ref=writer",UIUtils.zohoURL=e.urls.zohoURL,UIUtils.iamServerURL=e.urls.iamServerURL,UIUtils.logoutPageRedirectURL=e.urls.logoutPageRedirectURL,UIUtils.publishHelpCenterURL=e.urls.zohoURL+"/writer/help/document-publishing.html",UIUtils.JprogressDiv=J("#progress-outer-div"),e.isRemote?(editor.setEditorType("REMOTE"),RemoteEditor.quitWithoutSaving=e.quitWithoutSaving,RemoteEditor.userStatusId=e.userStatusId,RemoteEditor.searchText=e.searchText,RemoteEditor.featuresToRemoved=e.featuresToRemoved,RemoteEditor.plainView=e.plainView):"TRUE"===e.anyOneWithLink&&editor.setEditorType("ANYONEWITHLINK"),e.r_encdocid&&(RemoteEditor.r_encdocid=e.r_encdocid)};var loadingMsgTimeout;UIUtils.showLoadingMsg=function(e,t){var i=J("#loadingmsg");i.text(e).show(),t&&(clearTimeout(loadingMsgTimeout),loadingMsgTimeout=setTimeout(UIUtils.hideLoadingMsg,t))},UIUtils.hideLoadingMsg=function(){clearTimeout(loadingMsgTimeout),J("#loadingmsg").hide()},UIUtils.getUIText=function(e){return editorProps.uiText[e]},UIUtils.configureDialog=function(){var e=[];editor.isOffline()||(e=["msgdlg"],ZWOfflineUtil.isServiceWorkerSupported()&&ZWOffline.isOfflinePreconfigurationDone()&&(e=e.concat(["formula","bookmarkdialog","insertsplchar","tabdialog","findandreplace","wcdialog","commonerror","listnumberingstart","restoredocument","gotodialog","shortcut","inserttabledialog","listprefixsuffix","converttexttotabledlg","tablesortdialog","edittablenamedialog"])));var t={POPUP_NAME:"DIALOG_NAME"},i=UIUtils.getHTMLRequestParam();J.dialogutil.configure({dialogNames:e,dialogFetchUrl:ZWNetworkUtils.getNiceUrlPrefix("popup/{POPUP_NAME}"),paramsToReplaceInURL:t,dataFormat:i,preload:!0})},UIUtils.getHTMLRequestParam=function(){var e={};if(e=Macros.getRsidAndLang(),e||(e={}),editor.isOffline())e.role="OFFLINE";else{var t={};t.role=editor.doc.getRole(),t.appname=editorProps.permissionsInfo.appInfo.NAME,t.document_type=editorProps.permissionsInfo.appInfo.document_type,e.app_role_info=JSON.stringify(t)}return e},UIUtils.updateBookMarks=function(e){var t,i,n,r=J(e.bookMark),t=e.bookMarks?e.bookMarks:null;if(t&&t.length>0){i=t.length,n=!1;for(var o=0;o<i;o++)if(t[o].id.indexOf("toc")==-1){n=!0;break}var a=1==J(DomViewManager.getDOMElem(e)).children(".bMark").length;if((!e.bookMark||!a)&&n){e.bookMark=document.createElement("div"),r=J(e.bookMark);var s="cell"==e.parent.parent.type,l=-30;s&&(l=-15),r.css({left:l}),r.addClass("bMark");var d=DomViewManager.getDOMElem(e);r.appendTo(d)}var c=r.siblings(".zw-line-content").css("padding-top");r.css({top:parseInt(c)+2});try{UIUtils.isShowBookmark()?r.show():r.hide()}catch(e){}}},PubSub.subscribe([DOMVIEW.LINE_ADDED,DOMVIEW.LINE_UPDATED],UIUtils.updateBookMarks),UIUtils.showMessagePopup=function(e,t,i,n,r,o,a,s,l){if(!isHeadlessPDF&&!isHeadlessHTML){var d;r&&o?d=CONST.MSG_TYPE_RELOADCANCEL:r&&!o?d=CONST.MSG_TYPE_RELOAD:!r&&o?d=CONST.MSG_TYPE_CONFIRM:r||o||(d=CONST.MSG_TYPE_ALERT);var c=null,u=function(e){switch(e){case 1:n&&n();break;case 2:s&&s()}};MsgDialog.showMessage(d,i,t,e,c,u)}};var reload=function(){document.location.reload()};UIUtils.isShowBookmark=function(){var e=editor.doc.getUserData()[editor.zuid].bookmarkVisibility;return!(!e||!editor.getRole().permissions.can("document.edit"))},UIStateHandler=function(){"use strict";var e={},t=["zui-show","zui-hide","zui-enable","zui-disable","zui-show-message","zui-action","data-fn","data-zw-action"],i={},n={},r="uiframework-hide",o={menuitem:"ui-lock-icon-css",button:"ui-lock-icon-css"},a=[],s={},l={show:"hide",hide:"show",enable:"disable",disable:"enable",change_action:"revert_action",revert_action:"change_action"},d=["zlabeledselectbox","zlabelednumberfield","zlabeledcombobox","zlabeledbutton","zfontcombo","zcolorsplitbutton","zcolorselectbox","zlabeledmenubutton","zpopoverbutton","zlabeledpopoverbutton","zlabeledbuttonset","zbutton","zbuttonset","znotificationbutton","zmenubutton","znumberfield","zcombobox","zselectbox"],c=function(e,t,i){var o=e.getAttribute("zui-id");if("show"==i&&n[o].show&&n[o].show.indexOf(t)==-1)n[o].show.push(t);else if("hide"==i&&n[o].hide&&n[o].hide.indexOf(t)!=-1){var a=n[o].hide.indexOf(t);n[o].hide.splice(a,1)}0==n[o].hide.length&&(n[o].show&&n[o].show.length||!n[o].show)&&(h(e,r),PubSub.publish("Document/UIStateChanged",{element:e,state:"show"}))},u=function(e,t,i){var o=e.getAttribute("zui-id");if("hide"==i&&n[o].hide&&n[o].hide.indexOf(t)==-1)n[o].hide.push(t);else if("show"==i&&n[o].show&&n[o].show.indexOf(t)!=-1){var a=n[o].show.indexOf(t);n[o].show.splice(a,1)}(n[o].hide.length>0||n[o].show&&0==n[o].show.length)&&(g(e,r),PubSub.publish("Document/UIStateChanged",{element:e,state:"hide"}))},g=function(e,t){var i=J(e).data().componentName;"zlabeledselectbox"===i?J(J(e).zlabeledselectbox("getElement")).hide():D(e,t)},h=function(e,t){var i=J(e).data().componentName;"zlabeledselectbox"===i?J(J(e).zlabeledselectbox("getElement")).show():R(e,t)},f=function(e,t){var i=e.getAttribute("zui-id");n[i].disable&&n[i].disable.indexOf(t)==-1&&n[i].disable.push(t),(n[i]["data-fn"]&&n[i]["data-fn"].length||n[i].action&&n[i].action.length)&&m(e);var r=J(e).data().componentName,o=J(e);if(r&&d&&d.indexOf(r)!=-1)o[r]("setAttribute","disabled",!0);else if(!r||"ztoggleswitch"!=r&&"zstatebutton"!=r&&"zspinnerslider"!=r){if(e.hasAttribute("onclick")){var a=e.getAttribute("onclick");e.removeAttribute("onclick"),e.setAttribute("data_onclick",a)}D(e,"ui-zwdisabled")}else o[r]("disable");PubSub.publish("Document/UIStateChanged",{element:e,state:"disable"})},p=function(e,t){var i=e.getAttribute("zui-id");if(t&&n[i].disable){var r=n[i].disable.indexOf(t);r!=-1&&n[i].disable.splice(r,1)}if(0==n[i].disable.length){var o=J(e).data().componentName,a=J(e);if(o&&d&&d.indexOf(o)!=-1)a[o]("setAttribute","disabled",!1);else if(!o||"ztoggleswitch"!=o&&"zstatebutton"!=o&&"zspinnerslider"!=o){if(e.hasAttribute("data_onclick")){var s=e.getAttribute("data_onclick");e.removeAttribute("data_onclick"),e.setAttribute("onclick",s)}a.enable()}else a[o]("enable");R(e,"ui-zwdisabled"),PubSub.publish("Document/UIStateChanged",{element:e,state:"enable"}),(n[i]["data-fn"]&&n[i]["data-fn"].length||n[i].action&&n[i].action.length)&&E(e)}},E=function(e,t,i){var r=e.getAttribute("zui-id");if(i&&t&&n[r][i]&&n[r][i].indexOf(t)==-1&&n[r][i].push(t),n[r].disable.length)return!1;if(!e.hasAttribute("data_action")&&!e.hasAttribute("data_module")){var a=J(e).metadata();if(a.appData){var l=a.appData.action;e.setAttribute("data_action",l),a.appData.hasOwnProperty("params")&&e.setAttribute("data_params",JSON.stringify(a.appData.params)),e.hasAttribute("title")&&e.setAttribute("data_title",e.getAttribute("title"))}else if(e.hasAttribute("module")){var d=e.getAttribute("module");Module.unbindEvents(d),e.setAttribute("data_module","module")}if(s.hasOwnProperty(r))s[r].tooltip&&e.setAttribute("title",s[r].tooltip),s[r].class&&e.classList.add(s[r].class),a.appData||(a.appData={}),a.appData.action=s[r].action,s[r].params?a.appData.params=s[r].params:delete a.appData.params;else{"undefined"!=typeof a.appData&&"object"==typeof a.appData&&(a.appData.action="UIStateHandler.actionMethod",a.appData.params=[r]);var c=e.getAttribute("role");c=e.classList.contains("zbutton")?"button":c,null!=c&&o.hasOwnProperty(c)&&e.classList.add(o[c])}}},T=function(e,t){var i=J(e).metadata();if(e.hasAttribute("data_action")){var n=e.getAttribute("data_action"),r=e.getAttribute("data_title");if(e.removeAttribute("data_action"),i.appData.action=n,e.setAttribute("title",r),e.removeAttribute("data_title"),e.hasAttribute("data_params")){var a=JSON.parse(e.getAttribute("data_params"));i.appData.params=a,e.removeAttribute("data_params")}s[t]&&s[t].class&&e.classList.remove(s[t].class)}else if(e.hasAttribute("data_module")){var l=e.getAttribute("module");Module.bindEvents(l),delete i.appData,e.removeAttribute("data_module")}var d=O(e);null!=d&&o.hasOwnProperty(d)&&e.classList.remove(o[d]),s[t]&&s[t].class&&e.classList.remove(s[t].class)},O=function(e){var t=e.getAttribute("role");return e.classList.contains("zbutton")?"button":t},m=function(e,t,i){var r=e.getAttribute("zui-id");if(t&&i&&n[r][i]){var a=n[r][i].indexOf(t);if(a==-1)return;n[r][i].splice(a,1)}(e.hasAttribute("data_action")||e.hasAttribute("data_module")||e.classList.contains(o[O(e)]))&&T(e,r)},I=function(e){var t=document.querySelector('[zui-id="'+e+'"]');PubSub.publish("UIStateHandler/actionChanged",t)},D=function(e,t){e.classList.add(t)},R=function(e,t){e.classList.remove(t)},S=function(e){var t=e.parentNode,i=null,n=!1,r=!1;if(e.hasAttribute("ctype")?i=e:t&&t.hasAttribute("ctype")&&(i=t),i){n=!0;var o=J(i).data();r=null!=o.componentName}return{ele:i,ctype:n,isComponent:r}},C=function(e,t){var i=e.querySelectorAll("["+t+"]"),n=Array.from(i);e.hasAttribute(t)&&n.unshift(e);for(var r=0;r<n.length;r++){var o=n[r],a=S(o);!a.isComponent&&a.ctype&&(n.splice(r,1),r--)}return n},A=function(n){var r=n.getAttribute("zui-id"),o=i[r];try{for(var a=t.length-1;a>-1;a--)if("data-zw-action"!=t[a])for(var s=t[a].replace("zui-",""),d=o[s].length-1;d>-1;d--){var g=o[s][d].trim(),h=y(g),T=!(!g||0!=g.indexOf("!")),g=g.replace("!",""),O=e[h].fn(s,n,g);switch(T&&(O=l[O]),O){case"show":c(n,g,s);break;case"hide":u(n,g,s);break;case"enable":p(n,g,s);break;case"disable":f(n,g,s);break;case"remove":n.parentNode.removeChild(n);break;case"ignore":break;case"change_action":E(n,g,s);break;case"revert_action":m(n,g,s)}}}catch(e){N(e)}},v=function(e,n){var r=e.elemList;try{for(var o=0,a=r.length-1;o<=a;o++){var s=r[o],d=i[s.getAttribute("zui-id")];if(!("undefined"==typeof d||d&&0==d.length))for(var g=t.length-1;g>-1;g--)if("data-zw-action"!=t[g])for(var h=t[g].replace("zui-",""),T=d[h].length-1;T>-1;T--){var O=d[h][T].trim(),I=!(!O||0!=O.indexOf("!")),O=O.replace("!",""),D=y(O);if(D==n){var R=e.fn(h,s,O);switch(I&&(R=l[R]),R){case"show":c(s,O,h);break;case"hide":u(s,O,h);break;case"enable":p(s,O,h);break;case"disable":f(s,O,h);break;case"remove":s.parentNode.removeChild(s);break;case"ignore":break;case"change_action":E(s,O,h);break;case"revert_action":m(s,O,h)}}}}}catch(e){N(e)}},_=function(t){e=t},P=function(e){for(var t=C(e,"zui-removable"),i=t.length,n=0;n<i;n++){var r=t[n],o=r.getAttribute("id");editorProps.permissionsInfo.appInfo.FEATURES.exclude&&editorProps.permissionsInfo.appInfo.FEATURES.exclude.indexOf(o)!=-1&&r.parentNode.removeChild(r)}},N=function(e){var t=e.stack;ZWLogger.sendErrorDetails("UIFramewokrError<ZWERROR>"+editor.doc.docInfo.VERSION+"."+editor.doc.docInfo.REVISION+"."+editor.doc.docInfo.RID+"<ZWERROR>\n Error Log Start \n buildLabel: "+buildLabel+"\n Error Log End \n <ZWERROR>#### UIframeworkError: \n\n ExceptionInfo: "+t+" #####",null,ZWCollaboration.UIFRAMEWORK_FUNCTION_NOT_CONFIGURED)},b=function(e){var t=e.currentTarget,i=(t.getAttribute("zui-id"),t.getAttribute("data-zw-action")),n=ActionJSON.getActionInfo(i);e.isReportCaptured||(e.isReportCaptured=!0,PubSub.publish("UIFrameWork/ReportCapture",[t,i,n]))},L=function(e){e.removeEventListener(e,b)},w=function(r){if(!r)return!1;P(r),Module.processElement(r);for(var o=[],a=t.length-1;a>-1;a--)for(var l=t[a],d=C(r,l),c=d.length-1;c>-1;c--){var u=d[c],g=u.getAttribute(l),h=[],f=null;if("data-zw-action"==l)f=ActionJSON.getActionInfo(g),u.addEventListener("click",b);else if(!u.hasAttribute("data-zw-action")){if(u.hasAttribute("data-fn")&&"data-fn"==l&&!u.hasAttribute("data"))continue;if(u.hasAttribute("data-fn")&&u.hasAttribute("zui-action")&&"zui-action"==l)continue;if("zui-action"===l){g=JSON.parse(g);var p=g.permission;h=p.split(",")}else h=g.split(","),"data-fn"==l&&(h=["permission."+g])}var E=!1;if(!u.hasAttribute("zui-id")){var T=Utils.randomString();u.setAttribute("zui-id",T),i[T]={hide:[],disable:[],show:[],enable:[],"show-message":[],action:[],"data-fn":[]},n[T]={hide:[],disable:[]},f?(h=[],f.hasOwnProperty("hide")&&(h=h.concat(f.hide),i[T].hide=f.hide),f.hasOwnProperty("disable")&&(h=h.concat(f.disable),i[T].disable=f.disable),f.hasOwnProperty("show")&&(n[T].show=[],h=h.concat(f.show),i[T].show=f.show),f.hasOwnProperty("enable")&&(n[T].enable=[],h=h.concat(f.enable),i[T].enable=f.enable),f.hasOwnProperty("action")&&(n[T].action=[],s[T]=ZWJSONUtils.clone(f.action),h=h.concat(f.action.permission.split(",")),i[T].action=f.action.permission.split(",")),f.hasOwnProperty("data-fn")&&(n[T]["data-fn"]=[],h.push("permission."+f["data-fn"][0]),i[T]["data-fn"]=["permission."+f["data-fn"][0]])):(u.hasAttribute("zui-show")&&(n[T].show=[]),u.hasAttribute("zui-enable")&&(n[T].enable=[]),u.hasAttribute("zui-action")&&!u.hasAttribute("data-fn")&&(n[T].action=[],s[T]={tooltip:g.tooltip,action:g.action,params:g.params,class:g.class}),u.hasAttribute("data-fn")&&u.hasAttribute("data")&&(n[T]["data-fn"]=[])),E=!0}for(var O=h.length-1;O>-1;O--){var m=y(h[O]),I=u.getAttribute("zui-id"),D=l.replace("zui-","");f||U.indexOf(i[I][D],h[O])!=-1||i[I][D].push(h[O]),U.indexOf(e[m].elemList,u)==-1&&e[m].elemList.unshift(u),E&&o.unshift(u)}}for(var a=o.length-1;a>-1;a--)A(o[a])},y=function(e){for(var t,i=a.length-1;i>-1;i--){var n=a[i];if(e&&e.indexOf(n)!=-1){t=n;break}}return t},M=function(e,t,i){var n=e[t].event;n instanceof Array?U.each(n,function(n){i.subscribe(n,function(){v(e[t],t)})}):i.subscribe(n,function(){v(e[t],t)})},F=function(t,i){_(t),a=Object.keys(e);for(var n in e){var r=n,o=e[n].event;e[n].elemList=[],o&&M(e,r,i)}},V={ENABLE:"enable",DISABLE:"disable",SHOW:"show",HIDE:"hide",REMOVE:"remove",IGNORE:"ignore",CHANGE_ACTION:"change_action",REVERT_ACTION:"revert_action"},B={hide:V.HIDE,show:V.SHOW,enable:V.ENABLE,disable:V.DISABLE,action:V.CHANGE_ACTION,"data-fn":V.REVERT_ACTION},x={hide:V.SHOW,show:V.HIDE,enable:V.DISABLE,disable:V.ENABLE,action:V.REVERT_ACTION,"data-fn":V.CHANGE_ACTION},W=function(e,t){return e?B[t]:x[t]},H=function(e,t){e.removeAttribute("zui-id"),T(e),delete i[t],delete n[t],L(e)},G=function(e){DesktopAppUIFrameWork.init(),Array.isArray(e)||(e=[e]);for(var t=e.length,i=0;i<t;i++){var n=e[i];if(n){var r=n.getAttribute("zui-id");if(r){H(n,r);var o=n.querySelectorAll("[zui-id]");if(o.length)for(var a=o.length,s=0;s<a;s++){var l=o[s].getAttribute("zui-id");H(o[s],l)}}}}},k=function(e){Array.isArray(e)||(e=[e]),G(e);for(var t=e.length,i=0;i<t;i++){var n=e[i];n&w(n)}};return{build:w,loadConfig:F,ACTION:V,eleStatus:n,eleAttrList:i,getElemsWithAttr:C,getActionMapping:W,reInit:k,actionMethod:I,unbind:G}}(),UIFrameWork_Config=function(e){return{View:{fn:function(t,i,n){var r=n.replace("View.","").toLowerCase(),o=EditorView.getView().toLowerCase(),a=o.indexOf(r)!=-1;return e.getActionMapping(a,t)},event:"Document/view/changed"},Section:{fn:function(t,i,n){var r=n.replace("Section.","").toLowerCase(),o=!1;if(!editor.clientActiveSection)throw"editor.clientActiveSection is undefined";return activeSectionCls=editor.clientActiveSection.getAttribute("class"),activeSectionCls.indexOf("notepane")!=-1&&(activeSectionCls=editor.clientActiveSection.getAttribute("node-id")),o=activeSectionCls.indexOf(r)!=-1,e.getActionMapping(o,t)},event:"Document/SectionChanged"},Browser:{fn:function(t,i,n){var r=n.replace("Browser.","").toLowerCase(),o=editor.browserInfo["is_"+r];return e.getActionMapping(o,t)},event:""},"document.state":{fn:function(t,i,n){var r=n.replace("document.state.",""),o=editor.doc.docInfo.state===r;return e.getActionMapping(o,t)},event:"DocInfo/state/modified"},RCT_Context:{fn:function(t,i,n){var r=n.replace("RCT_Context.",""),o=CURSOR_CONTEXT_DEFINITIONS[r]();return e.getActionMapping(o,t)},event:"Document/RightClickMenuOpened"},"readersinsights.notviewed":{fn:function(t){var i=window.ContentStatsHandler&&ContentStatsHandler.isFirstOpenDone();return e.getActionMapping(!i,t)},event:"CollabListMenu/Opened"},"state.offline":{fn:function(t,i,n){var r=editor.isOffline();return e.getActionMapping(r,t)},event:"UI/OfflineMode"},"module.proofing.loaded":{fn:function(t){var i=ProofingAdaptor.isLoaded();return e.getActionMapping(i,t)},event:"Module/Proofing/Loaded"},"module.tc.loaded":{fn:function(t){var i=TCAdaptor.isLoaded();return e.getActionMapping(i,t)},event:"Module/TC/Loaded"},"state.isTCQueueEmpty":{fn:function(t){var i=0===TcManager.getCollection().getVisibleNodesCountDetails().all;return e.getActionMapping(i,t)},event:"Document/TC/CountUpdated"},"state.isTCOn":{fn:function(t){var i=editor.doc.getTrackChangeDetails().isEnabled();return e.getActionMapping(i,t)},event:"Document/TCPropertiesChanged"},"state.tcviews.nomarkup":{fn:function(t){var i=editor.doc.getTrackChangeDetails().getDisplayMode()===TCConstants.NO_MARKUP_VIEW;return e.getActionMapping(i,t)},event:"Document/TC/ViewChanged"},"state.tcviews.original":{fn:function(t){var i=editor.doc.getTrackChangeDetails().getDisplayMode()===TCConstants.ORIGINAL_VIEW;return e.getActionMapping(i,t)},event:"Document/TC/ViewChanged"},"state.isNotShared":{fn:function(t){var i="true"==editor.doc.docInfo.ISSHARED&&editor.getRole().permissions.can("document.edit");return e.getActionMapping(!i,t)},event:"Collaboration/ToggleActionButtons"},"state.finaldocument":{fn:function(t,i,n){var r=editor.isFinalDocument();return e.getActionMapping(r,t)},event:"Document/FinalStateUpdated"},"markasfinal.enableediting":{fn:function(t,i,n){var r=MarkAsFinal.isUserAllowedToEnableEditing();return e.getActionMapping(r,t);},event:"Document/FinalStateUpdated"},permission:{fn:function(t,i,n){n=n.replace("permission.","");var r=n.split(","),o=editor.getRole().permissions.can(r);return e.getActionMapping(o,t)},event:"Document/PermissionUpdate"},"state.featureVisited":{fn:function(t,i,n){var r=i&&i.id||"0",o=r.replace(/\D/g,""),a=editorProps&&editorProps.tourInfo&&editorProps.tourInfo[3];if(isFeatureVisited=editorProps.userInfo.visited_features.contains(o)||Macros.isRemote()||editor.isOfflineMode,a){var s=new Date(a.dateAdded),l=new Date;isFeatureVisited=Math.abs(l.getTime()-s.getTime())>2592e6||parseInt(o)<a.latestStartId||parseInt(o)>a.latestEndId||isFeatureVisited}return e.getActionMapping(isFeatureVisited,t)},event:"Writer/NewFeatureVisited"},"state.newDoc":{fn:function(t,i,n){var r=editor.doc.docInfo.newDoc;return e.getActionMapping(r,t)},event:"DocInfo/newDoc/modified"},"state.freeze":{fn:function(t,i,n){return e.getActionMapping(UIUtils.freezeState,t)},event:["Editor/Freeze","Editor/Unfreeze"]},"state.workflowAssigned":{fn:function(t,i,n){var r=!!editor.doc.docInfo.workflowInfo;return e.getActionMapping(r,t)},event:["Workflow/CurrentWorkflow/Updated"]},"state.checkedout":{fn:function(t,i,n){var r=!1;return"undefined"!=typeof editor.doc.docInfo.CHECKEDOUTBY_ZUID&&(r=editor.zuid!=editor.doc.docInfo.CHECKEDOUTBY_ZUID),e.getActionMapping(r,t)},event:"Collaboration/ResourceLocked"},"state.documentshared":{fn:function(t,i,n){var r="true"===editor.doc.docInfo.ISSHARED;return e.getActionMapping(r,t)},event:"Collaboration/ResourceShared"},context:{fn:function(t,i,n){var r=CURSOR_CONTEXT_DEFINITIONS[n.replace("context.","")]();return e.getActionMapping(r,t)},event:["Cursor/Collapsed","Cursor/Selected","ZWShape/Selected","BeforePanelOpen","ImageVisualCue/Show","ShapeVisualCue/Show"]},TransliterationState:{fn:function(t,i,n){var r=TransLiteration_EventHandler.isTransliterationOn;return e.getActionMapping(r,t)},event:"Document/TransLiteration/StateChanged"},EditorType:{fn:function(t,i,n){var r=editorProps.type===n.replace("EditorType.","");return e.getActionMapping(r,t)},event:""},User:{fn:function(t,i,n){var r=editor.doc.getRole()===n.replace("User.","");return e.getActionMapping(r,t)},event:""},OrgAdmin:{fn:function(t,i,n){return e.getActionMapping(UIUtils.isPropackAdmin(),t)},event:""},WorkDriveTeamUser:{fn:function(t,i,n){var r=DesignUtil.isWorkdriveUser()&&!DesignUtil.isWorkDrivePersonalUser();return e.getActionMapping(r,t)},event:""},WorkDriveAdmin:{fn:function(t,i,n){var r=DesignUtil.isOrgAdmin();return e.getActionMapping(r,t)},event:""},"OrgDesign.fetchStatus":{fn:function(t,i,n){var r=DesignUtil.orgDesignFetchStatus();return e.getActionMapping(r,t)},event:["Design/OrgDesign/Retrieved","Design/OrgDesign/Retrieve/Failed"]},PropackUser:{fn:function(t,i,n){return e.getActionMapping(UIUtils.isPropackEnabled(),t)},event:""},"state.undoQueue.empty":{fn:function(t){var i=editor.doc.snapShotManager.isUndoQueueEmpty();return e.getActionMapping(i,t)},event:"Document/UndoQueue/Updated"},"state.redoQueue.empty":{fn:function(t){var i=editor.doc.snapShotManager.isRedoQueueEmpty();return e.getActionMapping(i,t)},event:"Document/RedoQueue/Updated"},"state.fullscreen":{fn:function(t,i,n){var r;if(i.style.display="",LayoutManager.isFullscreen())switch(t){case"hide":r=e.ACTION.HIDE;break;case"disable":r=e.ACTION.DISABLE}else switch(t){case"hide":r=e.ACTION.SHOW;break;case"disable":r=e.ACTION.ENABLE}return r},event:"writer/fullScreenMode"},ADDON:{fn:function(t,i,n){var r=AddOn.isInstalled(n.replace("ADDON.",""));return e.getActionMapping(r,t)},event:""},PublishScope:{fn:function(t,i,n){var r=n.replace("PublishScope.","").toUpperCase(),o=editor.doc.docInfo.PUBLISH_SCOPE==PUBLISH_TYPE[r];return e.getActionMapping(o,t)},event:"DocInfo/PUBLISH_SCOPE/modified"},"state.publish":{fn:function(t,i,n){var r=n.replace("state.publish.",""),o=!1;switch(r){case"internal":o=editor.doc.docInfo.PUBLISH_SCOPE==PUBLISH_TYPE.INTERNAL;break;case"external":o=editor.doc.docInfo.PUBLISH_SCOPE==PUBLISH_TYPE.EXTERNAL;break;case"private":o=editor.doc.docInfo.PUBLISH_SCOPE==PUBLISH_TYPE.PRIVATE;break;case"auto":o=editor.doc.docInfo.AUTO_PUBLISH}return e.getActionMapping(o,t)},event:["DocInfo/PUBLISH_SCOPE/modified","DocInfo/AUTO_PUBLISH/modified"]},PasteOptions:{fn:function(t,i,n){var r=n.replace("PasteOptions.",""),o=PasteEventHandler.getPasteInfo().pasteOpnInfo,a=!1;return"basic"==r&&o&&(o.normalPaste||o.DiffDocNonListPaste)?a=!0:"sameDocListPaste"==r&&o&&o.sameDocNonListPaste?a=!0:"otherDocListPaste"==r&&o&&(o.sameDocSameListPaste||o.sameDocDiffListPaste||o.DiffDocDifflistPaste)?a=!0:"chartPaste"==r&&o&&o.chartPaste?a=!0:"sheetTablePaste"==r&&o&&o.sheetTablePaste?a=!0:"screenplayPaste"==r&&o&&o.hasOwnProperty("screenplayWriterPaste")&&!o.screenplayWriterPaste&&(a=!0),e.getActionMapping(a,t)},event:"DocOperation/AfterPaste"},"state.tryEditor":{fn:function(t,i,n){var r=!1;return"undefined"!=typeof editor.doc.role&&(r="TRYEDITOR_WRITER"==editor.doc.role),e.getActionMapping(r,t)},event:""},"state.canShare":{fn:function(t,i,n){var r=editor.getRole().permissions.can("document.share");return e.getActionMapping(r,t)},event:""},"state.extension":{fn:function(t,i,n){var r=editorProps.options.isExtensionEnable||!1;return e.getActionMapping(r,t)},event:""},"state.canPublish":{fn:function(t,i,n){var r=editor.getRole().permissions.can("document.publish.internal")||editor.getRole().permissions.can("document.publish.external");return e.getActionMapping(r,t)},event:""},"state.Report":{fn:function(t,i,n){var r=document.getElementById("preview-container"),o=r?window.getComputedStyle(r).display:"none";return e.getActionMapping("block"==o,t)},event:["Reports/open","Reports/close","Characters/update"]},FillableForm:{fn:function(t,i,n){var r=editor.doc.docInfo.TEMPLATE_SETTINGS,o=editorProps.isFillableForm||r&&r.fill&&r.fill.submit_enabled;return e.getActionMapping(o,t)},event:"FillableForm/update"},DocuFiller:{fn:function(t,i,n){var r="undefined"!=typeof ZWLicense&&ZWLicense.isFillAddonPurchased();return e.getActionMapping(r,t)},event:"DocuFiller/Addon"},"editor.pdffiller":{fn:function(t,i,n){var r=TemplateUIHandler.handlePDFFillerEditor();return e.getActionMapping(r,t)},event:"Cursor/Collapsed"},PDFForm:{fn:function(t,i,n){return e.getActionMapping(Macros.isPDFDocument(),t)},event:""},PDFFiller:{fn:function(t,i,n){var r=Macros.isPDFDocument(),o=Macros.isFillableTemplate()||Macros.isSignTemplate();return e.getActionMapping(r&&o,t)},event:""},RemoteDocument:{fn:function(t,i,n){return e.getActionMapping(Macros.isRemote(),t)},event:""},FillTemplate:{fn:function(t,i,n){return e.getActionMapping(Macros.isFillableTemplate(),t)},event:""},MergeTemplate:{fn:function(t,i,n){return e.getActionMapping(Macros.isMergeTemplate(),t)},event:""},MergePDFTemplate:{fn:function(t,i,n){return e.getActionMapping(Macros.isPDFDocument()&&Macros.isMergeTemplate(),t)},event:""},SignTemplate:{fn:function(t,i,n){return e.getActionMapping(Macros.isSignTemplate(),t)},event:""},"license.addon.credits.postpaid":{fn:function(t,i,n){var r="undefined"!=typeof ZWLicense&&ZWLicense.isPostPaidCreditsPurchased();return e.getActionMapping(r,t)},event:"License/Cached"},"license.addon.credits.prepaid":{fn:function(t,i,n){var r="undefined"!=typeof ZWLicense&&(!ZWLicense.isPostPaidCreditsPurchased()&&ZWLicense.getPrePaidCreditsAddonInfo());return e.getActionMapping(r,t)},event:"License/Cached"},"license.addon.credits.free":{fn:function(t,i,n){var r="undefined"!=typeof ZWLicense&&!ZWLicense.getPaidCreditAddon();return e.getActionMapping(r,t)},event:"License/Cached"},SignTemplate:{fn:function(t,i,n){return e.getActionMapping(Macros.isSignTemplate(),t)},event:""},"editor.isWiki":{fn:function(t,i,n){var r="wiki"==editorProps.permissionsInfo.appInfo.NAME;return e.getActionMapping(r,t)},event:""},Bundle:{fn:function(t,i,n){return n=n.replace("Bundle.",""),e.getActionMapping(docProps.info.bundle_type==n,t)},event:""},"view.isVersionView":{fn:function(t,i,n){var r=!(!editor.subAction||!editor.subAction.version);return e.getActionMapping(r,t)},event:""},"docs.components.loaded":{fn:function(t){var i=ZDComponents.isComponentsLoaded();return e.getActionMapping(i,t)},event:"Docs/Component/Loaded"}}}(UIStateHandler),UIStateHandler.loadConfig(UIFrameWork_Config,PubSub),ACTION_CONFIG={};var LayoutManager=function(){"use strict";var e="",t=!1,i=function(){return e},n=function(t){e=t},r=function(){return editor.isFinalDocument()?LAYOUTS.COMPLETE:ModeManager.getCurrentMode()},o=function(){return LAYOUTS.READCOMMENT},a=function(){return LAYOUTS.READONLY},s=function(){return LAYOUTS.REMOTE},l=function(){return LAYOUTS.USERTEMPLATE},d=function(){return LAYOUTS.COMPOSE},c=function(){return LAYOUTS.SCREENPLAY},u=function(){var e=editorProps.viewInfo.view.layout||"common",t=g[e];return t()},g={common:r,comment:o,read:a,remote_common:s,mailmerge_common:d,user_template:l,screenplay:c},h=function(){},f={};f[LAYOUTS.COMPOSE]={open:function(){TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),PubSub.publish("Document/ModeOpened",LAYOUTS.COMPOSE)},close:function(){h(),PubSub.publish("Document/ModeClosed",LAYOUTS.COMPOSE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth,r=EditorLayout.getEditorAreaWidth(n);return n="undefined"!=typeof r?r:n,{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return null}},f[LAYOUTS.FULLSCREEN]={open:function(){editor.onResize(),TopbandHandler.hideToolbarHideBtn(),TopbandHandler.hideToolbar(ELEM_ID.REVIEWTOOLBARCONTAINER),EditorLayout.hideRightPanel(),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER)},close:function(){h(),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER)},getLayoutProps:function(){var e=0,t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return null}},f[LAYOUTS.COLLABORATE]={open:function(){C(ELEM_ID.REVIEWTOOLBARCONTAINER),editor.getRole().permissions.can("document.edit")&&(EditorLayout.showRightPanel(),editor.onResize(),editor.getRole().permissions.can("review.comment.view")?ReviewPane.switchTab(ReviewPane.getCurrentTab()):ReviewPane.switchTab("review"),PubSub.publish("Document/ModeOpened",LAYOUTS.COLLABORATE))},close:function(){h(),TopbandHandler.hideToolbarHideBtn(),TopbandHandler.hideToolbar(ELEM_ID.REVIEWTOOLBARCONTAINER),EditorLayout.hideRightPanel(),editor.onResize(),PubSub.publish("Document/ModeClosed",LAYOUTS.COLLABORATE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth;return n=EditorLayout.getEditorAreaWidth(n),{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return ELEM_ID.REVIEWTOOLBARCONTAINER}},f[LAYOUTS.COMPLETE]={open:function(){UIUtils.initComponent("complete-tb"),C(ELEM_ID.FINISHMODETOOLBARCONTAINER),editor.onResize(),PubSub.publish("Document/ModeOpened",LAYOUTS.COMPLETE)},close:function(){h(),TopbandHandler.hideToolbarHideBtn(),TopbandHandler.hideToolbar(ELEM_ID.FINISHMODETOOLBARCONTAINER),editor.onResize(),PubSub.publish("Document/ModeClosed",LAYOUTS.COMPLETE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth;return n=EditorLayout.getEditorAreaWidth(n),{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return ELEM_ID.FINISHMODETOOLBARCONTAINER}},f[LAYOUTS.RICHEDIT]={open:function(e){var t=Macros.defaultLeftPanel();m(!0);var i=(TopbandHandler.getBandHeight(),Z("premium-filetype-cont")[0]);Z(ELEM_ID.SUBPANELCONTAINER)[0].style.marginTop="0px",Z(ELEM_ID.PANELCONTAINER)[0].style.marginTop=Z(ELEM_ID.TOPBANDCONTAINER)[0].offsetTop+Z(ELEM_ID.TOPBANDCONTAINER)[0].offsetHeight+(i?i.offsetHeight:0)+"px",LeftPanel.showPanelContainer(ANIMATIONS.SLIDEIN,e||t),e===ELEM_ID.INSERTSIGNERFIELDS&&PubSub.publish("digiSignpanel/showMenu",{operation:"left-panel-sign-dlg"}),editor.onResize(),PubSub.publish("Document/RichEditLayoutOpened");var n=LeftPanel.getPanelWidth(),r={width:window.innerWidth-n+"px"};EditorLayout.updateElemCSS(ELEM_ID.TOOLBARCONTAINER,r)},close:function(){m(!1),LeftPanel.hidePanelContainer(ANIMATIONS.SLIDEOUT),h(),editor.onResize(),PubSub.publish("Document/RichEditLayoutClosed");var e={width:window.innerWidth+"px"};EditorLayout.updateElemCSS(ELEM_ID.TOOLBARCONTAINER,e)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=LeftPanel.getPanelWidth(),i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth-t;return n=EditorLayout.getEditorAreaWidth(n),{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}}},f[LAYOUTS.VERSIONVIEW]={open:function(){PubSub.publish("Document/VersionViewOpened"),J("#bottomband-container").hide(),J("topband-hamburger").hide(),Z("topband-hamburger").hide(),Z("topband-file-container").hide(),Z("topband-savestatus").hide(),Z("ui-docnotification").hide(),Z("topband-modes").hide(),Z("topband-share-owner").hide(),Z("topband-shared-label").hide(),Z("topband-share-rw").hide(),Z("topband-spotlightsearch").hide(),Z("topband-settings").hide(),Z("sinceLastVisitLink").hide(),Z("topband-versionview-doclink").show(),J(".ui-topband-docmode-options").hide(),J("#topband-zia").hide(),J("#topband-logo").hide(),UIUtils.hideWrappers(!0),UIUtils.hideControllers(),Z("wmstoolbar").addClass("ui-no-display-imp"),editor.clientActiveSection=J("div.zw-contentpane")[0],EventHandler.toggleSection(),DocumentMap.togglePane(),TableVisualCueHandler.close(),editor.onResize()},close:function(){J("#bottomband-container").show(),J("#topband-hamburger").show(),h(),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),UIUtils.hideWrappers(!1),Z("wmstoolbar").removeClass("ui-no-display-important"),TopbandHandler.hideToolbar(ELEM_ID.VERSIONVIEWTOOLBARCONTAINER),editor.onResize(),DocumentMap.togglePane()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=window.innerHeight-e-DomUtil.getBottombarHeight(),i=window.innerWidth;return{marginTop:e+"px",width:i+"px",height:t+"px"}},getToolbar:function(){return ELEM_ID.VERSIONVIEWTOOLBARCONTAINER}},f[LAYOUTS.VERSIONHISTORY]={open:function(){PubSub.publish("Document/OpenHistoryMode"),J("#panel-container").hide(),J("#bottomband-container").hide(),J("#topband-hamburger").hide(),Macros.isPDFDocument()&&Z("docufiller-tb").hide(),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.HISTORYTOPBANDCONTAINER),UIUtils.hideWrappers(!0),UIUtils.hideControllers(),Z("wmstoolbar").addClass("ui-no-display-important"),TopbandHandler.showToolbar(ELEM_ID.VERSIONHISTORYCONTAINER),editor.clientActiveSection=J("div.zw-contentpane")[0],EventHandler.toggleSection(),PopupHandler.forceClosePopup("smartToolbar"),DocumentMap.togglePane(),TableVisualCueHandler.close(),editor.onResize()},close:function(){J("#panel-container").show(),J("#bottomband-container").show(),J("#topband-hamburger").show(),Macros.isPDFDocument()&&Z("docufiller-tb").show(),h(),TopbandHandler.hideTopband(ELEM_ID.HISTORYTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),UIUtils.hideWrappers(!1),Z("wmstoolbar").removeClass("ui-no-display-important"),TopbandHandler.hideToolbar(ELEM_ID.VERSIONHISTORYCONTAINER),editor.onResize(),DocumentMap.togglePane()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=Z(ELEM_ID.VERSIONHISTORYCONTAINER).width(),i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth-t;return{marginTop:e+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return null}},f[LAYOUTS.HISTORYDIFFVIEW]={open:function(){J("#bottomband-container").hide(),J("#topband-hamburger").hide(),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.HISTORYDIFFTOPBANDCONTAINER),UIUtils.hideWrappers(!0),UIUtils.hideControllers(),Z("wmstoolbar").addClass("ui-no-display-important"),editor.clientActiveSection=J("div.zw-contentpane")[0],EventHandler.toggleSection(),PopupHandler.forceClosePopup("smartToolbar"),DocumentMap.togglePane(),TableVisualCueHandler.close(),editor.onResize()},close:function(){J("#bottomband-container").show(),J("#topband-hamburger").show(),h(),TopbandHandler.hideTopband(ELEM_ID.HISTORYDIFFTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),UIUtils.hideWrappers(!1),Z("wmstoolbar").removeClass("ui-no-display-important"),editor.onResize(),DocumentMap.togglePane()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=window.innerHeight-e-DomUtil.getBottombarHeight(),i=window.innerWidth;return{marginTop:e+"px",width:i+"px",height:t+"px"}},getToolbar:function(){return null}},f[LAYOUTS.MAILMERGEPREVIEW]={open:function(){editor.rebindEvents(MAILMERGE_PERMISSION),J("#bottomband-container").hide(),J("#topband-hamburger").hide(),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.MAILMERGETOPBANDCONTAINER),TopbandHandler.showToolbar(ELEM_ID.MMPREVIEWCONTAINER),editor.onResize(),J("#microandparaVCContainer").hide(),editor.browserInfo.is_firefox&&J("#mailmergeprint").hide(),Macros.isPDFDocument()&&Z("docufiller-tb").hide(),UIUtils.hidePasteToolbar(),DocumentMap.togglePane(),TableVisualCueHandler.close(),UIUtils.disableDocumentShortcuts()},close:function(){editor.rebindEvents(),J("#bottomband-container").show(),J("#topband-hamburger").show(),h(),TopbandHandler.hideTopband(ELEM_ID.MAILMERGETOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.hideToolbar(ELEM_ID.MMPREVIEWCONTAINER),editor.onResize(),J("#microandparaVCContainer").show(),editor.browserInfo.is_firefox&&J("#mailmergeprint").show(),Macros.isPDFDocument()&&Z("docufiller-tb").show(),DocumentMap.togglePane(),TableVisualCueHandler.close(),UIUtils.enableDocumentShortcuts()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=J(".ui-mmlist-container")[0].offsetWidth,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth-t;return{marginTop:e+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return ELEM_ID.MMPREVIEWCONTAINER}},f[LAYOUTS.FILLABLEFIELDSPREVIEW]={open:function(){editor.rebindEvents(FILLABLEFIELDS_PERMISSION),J("#bottomband-container").hide(),J("#topband-hamburger").hide(),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.FILLABLEFIELDSTOPBANDCONTAINER),editor.onResize(),J("#microandparaVCContainer").hide(),editor.browserInfo.is_firefox&&J("#mailmergeprint").hide(),UIUtils.hidePasteToolbar(),DocumentMap.togglePane(),TableVisualCueHandler.close(),UIUtils.disableDocumentShortcuts()},close:function(){J("#bottomband-container").show(),J("#topband-hamburger").show(),h(),TopbandHandler.hideTopband(ELEM_ID.FILLABLEFIELDSTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.hideToolbar(ELEM_ID.FFPREVIEWCONTAINER),editor.onResize(),J("#microandparaVCContainer").show(),editor.browserInfo.is_firefox&&J("#mailmergeprint").show(),DocumentMap.togglePane(),TableVisualCueHandler.close(),UIUtils.enableDocumentShortcuts()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth-t;return{marginTop:e+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return null}},f[LAYOUTS.READONLY]={open:function(){var e=editor.doc.getRole(),t=editorProps.viewInfo.view.layout;"read"==t?(TopbandHandler.showToolbar(ELEM_ID.READONLYTOOLBARCONTAINER),(editor.browserInfo.is_chrome||editor.browserInfo.is_opera)&&Z("sharemode-tb-print-chrome").show(),Z("topband-hamburger").disable()):"REMOTEVIEW"==e&&"undefined"!=typeof RemoteEditor&&RemoteEditor.options.pview&&(TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),J("#microandparaVCContainer,#topband-wrapper,#bbar-reader").remove());var i=editorProps.permissionsInfo.permissions,n=i.indexOf("document.edit")!==-1,r=i.indexOf("document.fill")!==-1;!n&&r&&(TopbandHandler.showToolbar(ELEM_ID.READFILLTOOLBARCONTAINER),(editor.browserInfo.is_chrome||editor.browserInfo.is_opera)&&Z("sharemode-tb-print-chrome").show(),Z("topband-hamburger").disable()),editor.onResize()},close:function(){"read"==editorProps.viewInfo.view.layout&&TopbandHandler.hideToolbar(ELEM_ID.READONLYTOOLBARCONTAINER)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return ELEM_ID.READONLYTOOLBARCONTAINER}},f[LAYOUTS.READCOMMENT]={open:function(){TopbandHandler.showToolbar(ELEM_ID.READCOMMENTTOOLBARCONTAINER),EditorLayout.showRightPanel(),editor.onResize(),(editor.browserInfo.is_chrome||editor.browserInfo.is_opera)&&Z("sharemode-tb-print-chrome").show(),Z("topband-hamburger").disable()},close:function(){TopbandHandler.hideToolbar(ELEM_ID.READCOMMENTTOOLBARCONTAINER),EditorLayout.hideRightPanel(),editor.onResize()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth;return n=EditorLayout.getEditorAreaWidth(n),{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return ELEM_ID.READCOMMENTTOOLBARCONTAINER}},f[LAYOUTS.REMOTE]={open:function(){TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER);var e=editor.doc.getRole();"TRYEDITOR_WRITER"!=e&&"TRYEDITOR_OFFICEAPI"!=e||FormatPanel.open(),editor.onResize(),PubSub.publish("Document/ModeOpened",LAYOUTS.REMOTE)},close:function(){h(),PubSub.publish("Document/ModeClosed",LAYOUTS.REMOTE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return null}},f[LAYOUTS.USERTEMPLATE]={open:function(){TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),editor.onResize(),PubSub.publish("Document/ModeOpened",LAYOUTS.REMOTE)},close:function(){h(),PubSub.publish("Document/ModeClosed",LAYOUTS.REMOTE)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return null}},f[LAYOUTS.PRINTPREVIEW]={open:function(){editor.rebindEvents(PRINTVIEW_PERMISSION),TopbandHandler.showToolbar(ELEM_ID.PREVIEWTOOLBARCONTAINER),TopbandHandler.hideTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.PRINTPREVIEWTOPBANDCONTAINER)},close:function(){h(),TopbandHandler.hideToolbar(ELEM_ID.PREVIEWTOOLBARCONTAINER),TopbandHandler.hideTopband(ELEM_ID.PRINTPREVIEWTOPBANDCONTAINER),TopbandHandler.showTopband(ELEM_ID.DEFAULTTOPBANDCONTAINER)},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return ELEM_ID.PREVIEWTOOLBARCONTAINER}};var p=function(e,t){f[e]={open:function(){t&&"function"==typeof t.onOpen&&t.onOpen()},close:function(){t&&"function"==typeof t.onClose&&t.onClose()},getLayoutProps:function(){var e=TopbandHandler.getBandHeight(),t=0,i=window.innerHeight-e-DomUtil.getBottombarHeight(),n=window.innerWidth;return{marginTop:e+"px",marginLeft:t+"px",width:n+"px",height:i+"px"}},getToolbar:function(){return t&&t.toolbarID},retainPanel:t.retainPanel}},E=function(e){I()&&!f[e].retainPanel&&LayoutManager.toggleRichEdit("close"),e==LAYOUTS.COMPLETE&&PubSub.publish("Esign/Init");var t=i();t&&T(t,"close"),n(e),T(e,"open"),PubSub.publish("Document/LayoutChanged",t,e)},T=function(e,t){f[e][t]()},O=function(e,t){e=I()?"close":"open",f[LAYOUTS.RICHEDIT][e](t)},m=function(e){t=e},I=function(){return t},D=function(){var e={},t=i();return e=t?f[t].getLayoutProps():{marginTop:"44px",marginLeft:"0px",width:window.innerWidth+"px",height:window.innerHeight+"px"}},R=function(e){return f[e].getLayoutProps()},S=function(){var e=i();return f[e].getToolbar()},C=function(e){var t=TopbandHandler.getToolbarState(e);t||TopbandHandler.showToolbar(e),TopbandHandler.showToolbarHideBtn(),TopbandHandler.updateHideBtnState(t)},A=function(){return LayoutManager.getCurrentLayout()===LAYOUTS.FULLSCREEN};return{addNewLayout:p,loadLayout:E,getLayoutType:u,getLayoutProps:R,toggleRichEdit:O,isRichEditActive:I,getCurrentLayout:i,getCurrentLayoutProps:D,getCurrentToolbar:S,isFullscreen:A}}(),EditorLayout=function(){"use strict";var e=!1,t=!1,i=function(){t=Z(ELEM_ID.REVIEWRIGHTPANE).length,Z(ELEM_ID.MAINOUTERDIV).bind(TransitionEndEvent,function(e){e.target.id==ELEM_ID.MAINOUTERDIV?(editor.onResize(),EditorUtil.focusMultiByteSpan()):e.target.id==ELEM_ID.EDITORPANECONTAINER&&(editor.onResize(),EditorUtil.focusMultiByteSpan(),CurUtil.blinkCursor())})},n=function(){return Z(ELEM_ID.STYLESMENU)[0]&&"none"!=Z(ELEM_ID.STYLESMENU)[0].style.display},r=function(i){i||(i=DomViewManager.getMaxRowWidth()),editor.jeditorPane[0].style.width=i+"px";var r=i*editor.zoomFactor,a=0;if(t&&e){var c=Z(ELEM_ID.REVIEWRIGHTPANE).outerWidth();"undefined"!=typeof DocumentMap&&DocumentMap.isVisible()&&DocumentMap.getPanelPinState()?r+=c:O(Z(ELEM_ID.EDITOROUTERDIV).outerWidth())&&(r+=c)}if("undefined"!=typeof DocumentMap&&DocumentMap.isVisible()&&DocumentMap.getPanelPinState()&&d(Z(ELEM_ID.EDITOROUTERDIV).outerWidth())){var u=Z("documentmapzdialog").outerWidth();r+=u}if(n()){var g=Z(ELEM_ID.STYLESMENU),f=a=g.outerWidth();r+=f}o(r),editor.widthVariant=(Z(ELEM_ID.EDITOROUTERDIV)[0].offsetWidth-r)/2,editor.widthVariant=editor.widthVariant>0?editor.widthVariant:0,DomViewManager.isMultiplePagesInRow()&&(editor.widthVariant=0),s(ELEM_ID.EDITORPANECONTAINER,{width:r+"px",left:editor.widthVariant+a+"px"}),h(),l(),T(),PubSub.publish("UiEvents/EditorParentOffsetChanged")},o=function(e){s(ELEM_ID.EDITORPANEWRAPPER,{width:e+"px"})},a=function(){var e;e=LayoutManager.isRichEditActive()?LayoutManager.getLayoutProps(LAYOUTS.RICHEDIT):LayoutManager.getCurrentLayoutProps(),EditorLayout.updateElemCSS(ELEM_ID.MAINOUTERDIV,e),Z("bottombar").css({width:window.innerWidth-parseFloat(e.marginLeft)}),r()},s=function(e,t){var i=Z(e)[0];if(i)for(var n in t)i.style[n]=t[n]},l=function(){var e=Z("documentmapzdialog");if("undefined"!=typeof DocumentMap&&e.is(":visible")){var t=Z(ELEM_ID.MAINOUTERDIV).height(),i=EditorLayout.getRightPanelTop();Z(ELEM_ID.EDITORRIGHTPANEL);e.css({right:0,top:i,height:t})}},d=function(i){var n=editor.jeditorPane.outerWidth()*editor.zoomFactor+Z("documentmapzdialog").outerWidth();if(t&&e){var r=Z(ELEM_ID.EDITORRIGHTPANEL);n+=r.outerWidth()}return i>=n-5},c=function(){var e=TopbandHandler.getBandHeight()+(Z("premium-filetype-cont")[0].offsetTop+Z("premium-filetype-cont")[0].offsetHeight);return e},u=function(){t&&(e=!0,Z(ELEM_ID.EDITORRIGHTPANEL)[0].style.display="block",PubSub.publish("Layout/RightPanelOpened"))},g=function(){t&&(e=!1,Z(ELEM_ID.EDITORRIGHTPANEL)[0].style.display="none",PubSub.publish("Layout/RightPanelClosed"))},h=function(){var e,t=Z(ELEM_ID.EDITORRIGHTPANEL),i=p();if(t.is(":visible")){"undefined"!=typeof DocumentMap&&DocumentMap.isVisible()&&DocumentMap.getPanelPinState()?(PubSub.publish("PositionRightPane/InsideEditor"),e=0):(PubSub.publish("PositionRightPane/OutsideEditor"),e=c());var n=Z(ELEM_ID.MAINOUTERDIV).height();t.css({right:i,top:e,height:n})}},f=function(i){var n=editor.jeditorPane.outerWidth()*editor.zoomFactor;if(t&&e&&(n+=Z(ELEM_ID.EDITORRIGHTPANEL).outerWidth()),"undefined"!=typeof DocumentMap&&DocumentMap.isVisible()&&DocumentMap.getPanelPinState()){var r=Z("documentmapzdialog");n+=r.outerWidth()}return i>=n},p=function(){var e=0;if("undefined"!=typeof DocumentMap&&DocumentMap.isVisible()&&DocumentMap.getPanelPinState()&&d(Z(ELEM_ID.EDITOROUTERDIV).outerWidth())){var t=Z("documentmapzdialog");e+=t.outerWidth()}else e=editor.widthVariant;return e},E=function(e){if("undefined"!=typeof DocumentMap&&DocumentMap.isVisible()&&DocumentMap.getPanelPinState()&&!d(e)){var t=Z("documentmapzdialog").outerWidth();e-=t}else{var i=Z(ELEM_ID.EDITORRIGHTPANEL);i&&i.is(":visible")&&!O(e)&&(e-=i.outerWidth()),J("#screenplay-breakdown-container")[0]&&J("#screenplay-breakdown-container").is(":visible")&&(e-=J("#screenplay-breakdown-container").width())}return e},T=function(){var e=Z(ELEM_ID.STYLESMENU);if("undefined"!=typeof TopbandHandler){var t=Z(ELEM_ID.MAINOUTERDIV).height()-(Z("hruler-container").is(":visible")?Z("hruler-container").height():0)-5;if(n()){var i=2,r=(editor.widthVariant+i,J("#ui-editor-outer-div").scrollTop());e.css({left:"0px",top:r,height:t,transition:"left .3s"})}}},O=function(e){var t=editor.jeditorPane.outerWidth()*editor.zoomFactor+Z(ELEM_ID.EDITORRIGHTPANEL).outerWidth()+(n()?Z(ELEM_ID.STYLESMENU).outerWidth():0);if("undefined"!=typeof DocumentMap&&DocumentMap.isVisible()&&DocumentMap.getPanelPinState()){var i=Z("documentmapzdialog");t+=i.outerWidth()}return e>=t-5},m=function(){return t},I=function(){return e};return PubSub.subscribe(DOCUMENT.MAX_PAGE_WIDTH_UPDATED,r),{init:i,isStylesMenuVisible:n,updateElemCSS:s,updateEditorParentOffset:r,updateMainOuterDivProps:a,updateEditorWidth:o,getEditorAreaWidth:E,showRightPanel:u,hideRightPanel:g,isEnoughGapToFitPanels:f,isRightPaneVisible:I,isRightPaneAvailable:m,getRightPanelTop:c}}(window);CommonError.prototype={errorMsg:"",title:"",type:"error",openCommonErrorPopup:function(e,t,i,n,r,o,a,s,l){return CommonError.errorMsg="",CommonError.isConfirm=!1,CommonError.isError=!1,CommonError.callback=void 0,CommonError.type="",CommonError.title="",CommonError.buttonsLabel=l,CommonError.callBackForCancel=void 0,a&&(CommonError.fromMsg=a),CommonError.errorMsg=e,!!e&&(t&&(CommonError.title=t),i&&(CommonError.type=i),n&&(CommonError.callback=n),s&&(CommonError.callBackForCancel=s),r&&(CommonError.isError=!0),o&&(CommonError.isConfirm=!0),void(e.toLowerCase().indexOf("cut")!=-1?J.dialogutil.open("commonerrorcut",void 0,this.info):e.toLowerCase().indexOf("copy")!=-1?J.dialogutil.open("commonerrorcpy",void 0,this.info):e.toLowerCase().indexOf("paste")!=-1?J.dialogutil.open("commonerrorpste",void 0,this.info):e.toLowerCase().indexOf("unsupported")!=-1?J.dialogutil.open("importError",void 0,this.info):J.dialogutil.open("commonerror",void 0,this.info)))},openBuildChangePopup:function(e){var t=e||{},i=[J.i18n("writer.common.RELOAD")],n=editorProps.deployment.writer;t.force||i.push(J.i18n("writer.common.CANCEL")),MsgDialog.showMessage(i,CONST.SEVERITY_WARNING,J.i18n("writer.common.SERVERUPDATE",[n]),J.i18n("writer.common.STATIC_RELOAD_MSG",[n]),null,function(e){switch(e){case CONST.BUTTON_1_CLICKED:location.reload()}})},reloadTimer:function(e){var t=15,i=setInterval(function(){J("#notifyDiv").find("#"+e).html(t),t<=1&&(CommonError.callback(),clearInterval(i)),t--},1e3)},importErrorCallback:function(){CommonError.callback&&(editor.rebindEvents(),CommonError.callback()),J.dialogutil.close("importError"),J("#importbrowse").click()},execCallback:function(){CommonError.callback&&(editor.rebindEvents(),CommonError.callback()),J.dialogutil.close("commonerror"),J.dialogutil.close("commonerrorcut"),J.dialogutil.close("commonerrorcpy"),J.dialogutil.close("commonerrorpste")},info:{init:function(){var e=J("#commonerror_cancel"),t=J("#commonerror_ok"),i=J("#commonerror_reload");e.hide(),i.hide(),t.hide(),CommonError.title||(CommonError.title=J.i18n("writer.common.ERROR"));var n=J("#notifyDiv"),r=(J("#notifySpan"),n.find(".ui-wdialog-info")),o=n.find(".ui-wdialog-title");o.html(CommonError.title),"error"==CommonError.type?r.addClass("ui-wdialog-alert"):r.addClass("ui-wdialog-"+CommonError.type),CommonError.isConfirm&&e.show(),CommonError.isError?i.show():t.show(),CommonError.buttonsLabel?2===CommonError.buttonsLabel.length?(t.zbutton("option","label",CommonError.buttonsLabel[0]),e.zbutton("option","label",CommonError.buttonsLabel[1])):3===CommonError.buttonsLabel.length&&(t.zbutton("option","label",CommonError.buttonsLabel[0]),e.zbutton("option","label",CommonError.buttonsLabel[1]),i.zbutton("option","label",CommonError.buttonsLabel[2])):(t.zbutton("option","label",J.i18n("writer.common.OK")),e.zbutton("option","label",J.i18n("writer.common.CANCEL"))),CommonError.callBackForCancel?J("#commonerror_cancel").unbind("click").bind({click:function(){CommonError.callBackForCancel(),J("#commonerrorzdialog").dialog("close")}}):J("#commonerror_cancel").unbind("click").bind({click:function(){J("#commonerrorzdialog").dialog("close")}}),CommonError.type="error",CommonError.title=J.i18n("writer.common.ERROR")},get:function(e){if("error"==e){var t=J("#notifyDiv"),i=t.find(".ui-wdialog-title"),n=t.find(".ui-werrror-content");if(CommonError.fromMsg&&"read"==CommonError.fromMsg)return i.html(J.i18n("common","PERMISSIONCHANGED")),n.text(CommonError.errorMsg),void J("#commonerror_ok").zbutton("option","label","Reload with unsaved changes");if(CommonError.fromMsg&&"write"==CommonError.fromMsg)return i.html(J.i18n("common","PERMISSIONCHANGED")),n.text(CommonError.errorMsg),void J("#commonerror_ok").zbutton("option","label",J.i18n("writer.common.CLOSE"));if(CommonError.fromMsg&&"import"==CommonError.fromMsg)return;return CommonError.fromMsg&&"access"==CommonError.fromMsg?(i.html(J.i18n("common","ACCESS")),n.text(CommonError.errorMsg+J.i18n("common","AUTOMATICALLY_CLOSE")),n.append("<span id='reLoadTimer'>15</span>"),n.append("&nbsp;<span>"+J.i18n("common","SECONDS")+"</span>"),t.find(".ui-wdialog-info").addClass("ui-wdialog-alert"),J("#commonerror_ok").zbutton("option","label",J.i18n("writer.common.CLOSE")),void CommonError.reloadTimer("reLoadTimer")):(CommonError.fromMsg&&"trash"==CommonError.fromMsg?(J("#commonerror_ok").zbutton("option","label",J.i18n("components.zimport.yes.label")),J("#commonerror_cancel").zbutton("option","label",J.i18n("components.zimport.no.label"))):CommonError.fromMsg&&"trashnormal"==CommonError.fromMsg&&(J("#commonerror_ok").zbutton("option","label",J.i18n("components.zimport.yes.label")),J("#commonerror_cancel").zbutton("option","label",J.i18n("components.zimport.no.label")),n.text(CommonError.errorMsg)),CommonError.errorMsg)}},set:function(e,t,i){}}};var CommonError=new CommonError,NavigatorModel=Backbone.Model.extend({defaults:{items:[],currentIdx:-1},initialize:function(){this.listenTo(this,"change:items",function(){this.set("currentIdx",-1)})}}),NavigatorView=Backbone.View.extend({tagName:"div",template:"#navigator-view",events:{"click #nav-prev":"prev","click #nav-next":"next"},initialize:function(e){this.template=e.template||this.template,this.template=Handlebars.compile(jQuery(this.template).html()),this.focusCallback=e.onFocus,this.listenTo(this.model,"change:currentIdx",this.focus)},prev:function(e){var t=this.model.get("currentIdx");t<=0?this.model.set("currentIdx",this.model.get("items").length-1,{focus:!0}):this.model.set("currentIdx",t-1,{focus:!0})},next:function(e){var t=this.model.get("currentIdx");t>=this.model.get("items").length-1?this.model.set("currentIdx",0,{focus:!0}):this.model.set("currentIdx",t+1,{focus:!0})},focus:function(e,t,i){if(i&&i.focus){var n=e.get("items")[t];n&&this.focusCallback&&this.focusCallback(n)}this.render()},render:function(){var e=this.model.get("items").length,t=this.model.get("currentIdx"),i=this.template({total:e,currentIdx:t+1});return this.$el.html(i),this.delegateEvents(),this}}),RemoteDiff=function(){var e=function(e){var t=HistoryDiffUI.getChanges(e),i=new NavigatorModel;i.set("items",t);var n=new NavigatorView({model:i,onFocus:HistoryDiffUI.focusDiff});J("#diff-nav-container").html(n.render().$el).show(),HistoryDiffUI.showBulletins(t)},t=function(){if(window.RemoteEditor&&RemoteEditor.options.isDiff){var t=editor.documentContent,i=docProps.compareContent,n=editor.doc.docInfo.DOCUMENT_NAME;J("#topband-filename-container,#topband-remoteview-print").remove(),Z(ELEM_ID.BOTTOMBAR).remove(),Z("remotediff-title").text(n),Z("remotediff-title-container").show(),editor.setView(EDITOR_VIEWS.HISTORY),HistoryUI.setView(HistoryUI.HISTORY_VIEWS.QUICKDIFF);var r=ReviewUtil.omitTcDeletions(t.content,t.styles),o=ReviewUtil.omitTcDeletions(i.content,i.styles);t.content=r.contStr,t.styles=r.styles,i.content=o.contStr,i.styles=o.styles;var a=new QuickDiff;try{var s=a.quickdiff(t,i)}catch(e){return void HistoryUI.onQuickDiffError(e,1,1.1)}a.renderDiff(s,e.bind(null,s))}};return{loadDiff:t}}();zw.define("CommentAdapter",[],["U","J"],function(e,t){"use strict";var i=!1,n=jsCdnZWStaticPath+fingerPrintObj["js/writer_comments_min_all.js"],r=cdnZWStaticPath+fingerPrintObj["html/comments/templates.html"],o=cdnZWStaticPath+fingerPrintObj["html/rte/rte.html"],a=jsCdnZWStaticPath+fingerPrintObj["js/writer_rte_min_all.js"],s=cdnZWStaticPath+fingerPrintObj["styles/writer_rte_min_all.css"],l=function(){if(editor.getRole().permissions.can("review.comment.view")){var e=[];editor.getRole().permissions.can("document.edit")&&e.push(bluePencilJsPath),e.push(a),zw.require({js:e,html:[r,o],css:[s]},[],function(e,t){var i=document.createElement("div");i.id="comment-templates",i.innerHTML=e[r],document.body.appendChild(i);var a=document.getElementById("rte-templates");if(!a){var s=document.createElement("div");s.id="rte-templates",s.innerHTML=e[o],document.body.appendChild(s)}zw.require({js:[n]},["CommentManager"],function(e,t){c().done(function(t){d(e,t)}).fail(function(e){ZWLogger.log("Unable to fetch Visibility Settings for the document")})})})}},d=function(e,t){CommentModels.init(t.visibility),CommentModelManager.init(),e.init(),e.initViews(),i=!0,PubSub.publish("Document/Comment/Loaded")},c=function(){var e=new Deferred;return ZWNetworkUtils.ajax({url:ZWNetworkUtils.getUrl("getcomments"),dataType:"json",type:"GET",success:function(t){e.resolve(t)},error:function(t){e.reject(t)}}),e.promise()},u=function(){if(i)return CommentManager.newComment();throw new Error("Command to insert comment invoked before loading comments module.")},g=function(e){return i?CommentModels.commentPane.get(e):0},h=function(){return!!i&&CommentManager.docHasComments()},f=function(){var e=window.CommentModels;if(e){for(var t=0;t<CommentModelManager.getLinkedCommentOrder().length;t++){var i=CommentModelManager.getCommentOrder()[t],n=CommentModels.commentCollection.get(i);if(n&&!n.get("isResolved"))return!0}return!1}return!1};return PubSub.subscribe("Document/ReviewRightPanel/Loaded",l),{init:l,newComment:u,getCount:g,docHasComments:h,docHasPrintableComments:f}}),zw.define("WorkflowAdapter",[],[],function(){var e=new ZWConsole;e.log=e.log.bind(e,"WorkflowAdapter: ");var t={},i=function(){var t=!1,i=editorProps.permissionsInfo.appInfo.NAME,n=["teamdrive","MACAPP_WD"];return n.includes(i)&&(e.log("AppName includes teamDrive/MACAPP_WD. So eligible to load workflow"),t=!0),(editorProps.IS_FILLABLE_FORM||Macros.isSignTemplate()||Macros.isMergeTemplate())&&(e.log("Document type is template, so it is not eligible for workflow"),t=!1),(Macros.isRemote()||"anyone"===Macros.getType()||"cmwriter"===Macros.getType())&&(t=!1),t},n=function(){W.get("#workflow-btn").hide();var e=W.get(".js-junior-workflow-container");e.show(),e.addClass("ui-wf-btn-without-pencil")},r=function(){return ZWNetworkUtils.ajax({url:ZWNetworkUtils.getContextUrl("api/v1/workflow/"+editor.doc.docInfo.RID+"/config"),dataType:"json",type:"GET"})},o=function(){var e=new Deferred;return i()?r().then(function(i){var n=!i.isPersonalEdition;t=i,e.resolve(n)},function(t){e.reject(t)}):e.reject(),e},a=function(){o().then(function(e){e?PubSub.publish("ModuleLoad/Workflow"):(W.get("#filemenu-assignworkflow").hide(),n())},function(t){W.get("#filemenu-assignworkflow").hide(),e.log("Can Load Workflow call failed"),n(),W.get("#filemenu-assignworkflow").hide()})},s=function(){var e=editor.doc.docInfo.workflowInfo&&editor.doc.docInfo.workflowInfo.jobId,t=!editor.getRole().permissions.can("document.edit");e&&t&&(W.get("#sharemode-default-topband").remove(),W.get("#topband-default").addClass("ui-writer-topgrayband-container"))},l=function(){WorkflowModels.init(t),WorkflowViews.init()};return PubSub.subscribe("Document/ComponentInitialized",a),PubSub.subscribe("UI/FrgamentJSPLoaded",s),{isEligibleForWorkflow:i,afterInit:l}});var WMSHandler=function(){var e=!1,t=!1,i=editorProps.options||{},n=jsCdnZWStaticPath+fingerPrintObj["js/wms_min_all.js"]+"?ms="+J.now(),r=function(){var e=!1;try{e="undefined"!=typeof WebMessanger&&WebMessanger.isRegistered()}catch(t){e=!1}return e},o=function(){e?t?l():s():a()},a=function(){var e={async:"async",defer:"defer",src:wmsbarJsUrl,callback:s};loadJS(e)},s=function(){e=!0;var t={async:"async",defer:"defer",src:n,callback:l};loadJS(t)},l=function(){t=!0,J(document.createElement("link")).attr({href:wmsbarCssUrl,rel:"stylesheet",type:"text/css"}).insertBefore(J("link:first")[0]),WebMessanger.setWmsContext("_wmswriter"),WebMessanger.setLocale(editorProps.userInfo.language,editorProps.userInfo.country),WebMessanger.setZIndex(1e4),WebMessanger.setCssStaticDomain(cssStaticPath),WebMessanger.setNoDomainChange(),editorProps.urls.iamServerURL&&WebMessanger.setIamServer(editorProps.urls.iamServerURL),editorProps.urls.chatServerURL&&WebMessanger.setChatServer(editorProps.urls.chatServerURL),editorProps.urls.mailServerURL&&WebMessanger.setMailServer(editorProps.urls.mailServerURL),editorProps.urls.contactsServerURL&&WebMessanger.setPhotoServer(editorProps.urls.contactsServerURL),editorProps.deployment.customername&&"zoho"!=editorProps.deployment.customername&&WebMessanger.setRebrand(editorProps.deployment.customername);var e=!1,n=WMSSessionConfig.CHAT|WMSSessionConfig.CHAT_PRESENCE|WMSSessionConfig.PRESENCE_ORG|WMSSessionConfig.PRESENCE_PERSONAL|WMSSessionConfig.CROSS_PRD;if((i.CNAME_ENABLED||"undefined"!=typeof i.isZohoDomain&&!i.isZohoDomain)&&(WebMessanger.useLongPolling(),WebMessanger.useSameDomain()),"REMOTE"==editor.type||"ANYONEWITHLINK"==editor.type){WebMessanger.authtype=0;var r="";"ANYONEWITHLINK"==editor.type?(e=!0,r=editorProps.userInfo.zuid,WebMessanger.setConfig(n),J("#topband-savestatus-cont").attr("href","#")):(r=RemoteEditor.options.wms_annnonuser_id,RemoteEditor.options.enable_wms_screengrabber&&WebMessanger.enableScreenGrabber()),0==i.show_chatbar&&(e=!0),WebMessanger.registerAnnon("WR",r,editorProps.userInfo.fullName,e)}else WebMessanger.enableTokenPairAuth(),WebMessanger.disableToggleUI(),WebMessanger.setConfig(n),editor.type&&0!=i.show_chatbar||(e=!0,WebMessanger.disableNetworkDownBanner()),editorProps.options&&editorProps.options.is_client_portal?WebMessanger.register("WR",editorProps.userInfo.zuid,!0,null,null,editorProps.userInfo.zaid):WebMessanger.registerZuid("WR",editorProps.userInfo.zuid,editorProps.userInfo.fname_JS,e),editor.doc.getRole()==USER_ROLE.PUBLIC?WebMessanger.enableGlobalSearch():WebMessanger.enableGlobalSearch(!0);d()},d=function(){var e=editorProps.permissionsInfo.appInfo.NAME,t=editor.type;editor.doc.getRole()==USER_ROLE.PUBLIC&&(t="org_publish");var i={};i.from=editor.type?"editor":"dashboard",i.app_name=e,t&&(i.editor_type=t);var n=ZWNetworkUtils.getContextUrl("mics/wmsregistration");J.ajax({url:n,data:i,type:"POST",dataType:"json",beforeSend:function(e){ZWNetworkUtils.setCsrfTokenInHeader(e)},success:function(){},error:function(){}})};return{isWMSRegistered:r,initWMS:o}}(),XDC=function(){"use strict";var e={},t={},i=[],n="*",r="*",o=[],a=[],s=function(e){return window===e},l={};l.setTarget=function(e){return!e||s(e.window)?this:(n=e.window||n,r=e.origin||r,this.setTrustedOrigins(),this)},l.setTrustedOrigins=function(e){if(o=e||o,r&&o.indexOf(r)===-1&&"*"!==r&&a.push(new RegExp("^"+r+"$")),e)for(var t=0,i=o.length;t<i;t++)a.push(new RegExp("^"+o[t]+"$"))},l.addTargetChildById=function(e){i.push(e)};var d=function(e,t){e.length&&e.forEach(function(e){e.postMessage(t,r)})};l.postMessage=function(t){if(!n||!r)throw new TypeError("Target window or origin not configured!");var o=[];!s(window.parent)&&o.push(window.parent),"string"!=typeof n&&o.push(n),i.forEach(function(e){frames[e]&&o.push(frames[e].contentWindow)}),o.length&&("function"!=typeof t.oncomplete&&"function"!=typeof t.onexception||(e[t.id=c()]=[t],t=u(t),delete t.oncomplete,delete t.onexception),d(o,t))},l.receiveMessage=function(e){if(!n||!r)throw new TypeError("Target window or origin not configured!");var i=arguments[0];if("string"==typeof i){var o=arguments[1];if(!o)throw new TypeError("Handler not defined!");e={},e[i]=o;var a=arguments[2];a&&a.hasOwnProperty("async")&&(o.async=a.async)}for(var i in e){var s=t[i];s?s.push(e[i]):t[i]=[e[i]]}};var c=function(e){for(var t=e||12,i="",n="abcdefghijklmnopqrstuvwxyz0123456789",r=0;r<t;r++){var o=Math.floor(Math.random()*n.length);i+=n.substring(o,o+1)}return i},u=function(e){if(null===e||"object"!=typeof e)return e;if(Array.isArray(e)){for(var t=[],i=0,n=e.length;i<n;i++)t[i]=u(e[i]);return t}var r={};for(var o in e)e.hasOwnProperty(o)&&(r[o]=u(e[o]));return r},g=function(i){if(!h(i.origin)||"*"!==n&&i.source!==n||"*"!==r&&i.origin!==r)return void(!s(i.source)&&d([i.source],{id:i.data.id,exception:{code:1108,message:"Domain not registered",ref:"https://help.zoho.com/portal/en/kb/office-integrator/common/common-customization/articles/how-to-add-postmessage-domains"}}));for(var o,a,l=i.data,c=l.message,g=t[c]||[],f=0,p=g.length;f<p;f++){a=u(l);try{o=g[f],o.async?!function(e,t){var n=new Promise(function(i,n){setTimeout(function(){e(i,n,t.data)},300)});n.then(function(e){t.data=e,d([i.source],t)})}(o,a):a.data=o(a.data)}catch(e){a.exception=e.stack}(!o.async&&void 0!==a.data&&null!==a.data||void 0!==a.exception&&null!==a.exception)&&d([i.source],a)}for(g=e[i.data.id]||[];o=g.shift();)i.data.hasOwnProperty("exception")?!!o.onexception&&o.onexception(i.data.exception):i.data.hasOwnProperty("data")&&!!o.oncomplete&&o.oncomplete(i.data.data);delete e[i.data.id]},h=function(e){if(!e)return!1;for(var t=0;t<a.length;t++)if(a[t].test(e))return!0;return!1};return window.addEventListener?addEventListener("message",g,!1):attachEvent("onmessage",g),l}(),ZWMacros=function(){"use strict";var e=1100,t=1101,i=1102,n=1103,r=1104,o=1105,a=1106,s=1107,l={DESTINATION_FORMAT:"DestinationFormat",SOURCE_FORMAT:"SourceFormat"},d={BODY_START:"BodyStart",BODY_END:"BodyEnd"},c={RANGECHARS_TYPE:"data-range-char-type",BOOKMARK_INFO:"data-bookmark-info"},u="start",g="end",h="html",f=new ZWConsole,p=[],E={},T=function(){throw new Error(e)},O=function(){p.forEach(function(e,t){E[e]=m.macroHandlers(e)||T}),XDC.receiveMessage(E)},m=function(){var e=!1,E=[],T={};T[NODE_TYPE.FILLABLEFIELD]=[];var m=function(e,t){if(e&&"undefined"!=typeof ZWBeacon){var i=docProps.info.ZID,n={msg:e,props:JSON.stringify(Object.keys(t||{})),service_name:docProps.info.SERVICE_NAME};i&&(n.service_id=i),ZWBeacon.sendActivityTracks("post_msg_sdk",n)}},I=function(){return e},D=function(t){e=t||!1,f.log("Event: DocumentLoadComplete"),XDC.postMessage({message:"DocumentLoadComplete"}),O()},R=function(e){f.enable(e)},S=function(){f.disable()},C={ImageOptions:function(e){if(!e)throw new Error(t);return Macros.setImgLibAppData(e),{result:1}},SaveDocument:function(e){var t=e.format&&ExportDialog.isExportSupportedFormat(e.format)?e.format:null;Macros.saveDoc(function(e){XDC.postMessage({message:"SaveDocumentResponse",data:{status:e.STATUS_CODE,message:e.RESPONSE}})},!!e.hideSaveButton,e.forceSave,e.saveUrlParams,t)},CancelSaveDocument:function(e){Macros.updatePartnerSaveStatus(!1)},ExportDocument:function(e){if(!e||!e.format)throw new Error(t);if(ExportDialog.isExportSupportedFormat(e.format))return ExportDialog.exportAs(e.format),{result:1};throw new Error(n)},SetFormat:function(e){var t=e.format;if(!t||!t.type)throw new Error(n);var i=t.type;if(!/^(text|image|paragraph)$/.test(i=i.toLowerCase()))throw new Error(s);var r=editor.doc.getSelection(),o=r.getTargetRange(),a=editor.doc.getComputedFormatAt(o.start,i);if(!a||a.type!==i)throw new Error(n);return i===NODE_TYPE.IMAGE?Op.processMsg([{r:o.start},{as:{start:t}},{r:1},{as:{end:ZWJSONUtils.getKeys(t)}}]):r.applyFormat(t),Op.sendMsg(),{result:1}},ExecuteCommand:function(e){if(!e||!e.rangeId&&!e.rangeName)throw new Error(t);var i=editor.getDocument(),n=e.rangeId?[{id:e.rangeId}]:NamedRange.getNamedRangeForName(e.rangeName),r=e.commandName,o=e.commandValue;switch(r){case EXECCMD.BOLD:i.execCmd.apply(i,[r,o,n]);break;case EXECCMD.LOCK:case EXECCMD.UNLOCK:F(n,!1),Command.exec(r),Op.sendMsg();break;case"select":F(n,!1);break;default:return{result:0}}return i.getChanges().length()&&i.sync(),{result:1}},FindAndReplace:function(e){var t=e.findText,i=e.replaceWith,n=!!e.isReplaceAll;if(!t||!i)throw new Error(r);return Replace.searchFor=t,Replace.replaceStr=i,Replace.pos=0,n===!0?Replace.replaceAll():(Replace.findNext(),Replace.replace()),{result:1}},GetHTML:function(e){return{result:1,html:editor.getHTML()}},UpdateLocale:function(e){var t=e.locale;if(!t)throw new Error(r);var i=editor.getDocument();return i.setLocale(t),i.sync(),{result:1}},InsertContent:function(e){var t,i=e.content,n=e.contentType||NODE_TYPE.TEXT,a=e.position,s=editor.doc.getSelection();if(!i)throw new Error(r);if(!/^(text|html)$/.test(n=n.toLowerCase()))throw new Error(o);switch(a){case d.BODY_START:t=1;break;case d.BODY_END:t=editor.doc.getSectionEnd(0)-UNICODE.PARAGRAPH.length}t&&s.removeAllRanges().addRange(editor.doc.createRange(t,t));var l=s.getTargetRange(),c=n!=NODE_TYPE.TEXT&&e.htmlFormat;l=new ZWRange(l.start,l.end);var u,g,f,p,E=0,T=[],O=W(i,n);if(O.length&&n===h){for(var m=0;m<O.length;m++)u=O[m],g=x(u.innerHTML,h),g.namedRangeInfo.length?(p=P(g.namedRangeInfo,{},g.node.innerHTML,n,null,editor.doc.getSelection(),!0),T=T.concat(p.opJson)):(f=k(g.node.innerHTML,n),T=T.concat(N(f[0],n,null,!0)));Op.sendMsg(),E=Y(T)||E,e.scrollIntoView&&w(l,i,!0,E)}else{var f=k(i,n),T=N(f[0],n,c);E=Y(T),e.scrollIntoView&&w(l,f[0],!0,E)}return{result:1}},InsertEmbedObject:function(e){var t=e.options,n=e.objectType;if(!t||!t.sheetId&&!t.sheetUrl)throw new Error(i);switch(n){case"SHEET":var r={};t.sheetId&&(r.rid=t.sheetId),t.sheetUrl&&(r.url=t.sheetUrl),t.activeCell&&(r.activeCell=t.activeCell),t.activeSheet&&(r.activeSheet=t.activeSheet),t.width&&(r.width=t.width),t.height&&(r.height=t.height),SheetOperation.insertSheet(r)}return{result:1}},InsertMergeField:function(e){var t=e.mergeFieldDisplayName,i=e.mergeFieldName,n=e.mergeFieldType,o=e.mergeFieldFormat;e.mergeFieldId;if(!i||!n)throw new Error(r);t||(t=i),t=t.replaceAll(MAILMERGE.FIELDNAME_SPECIALCHAR_REGEX,""),i=i.replaceAll(MAILMERGE.EXCLUDED_SPECIALCHARS,"");var a={},s={fid:i,id:i,display_name:t,type:n,category:MAILMERGE.CATEGORIES.CREATED};if(n.indexOf(MAILMERGE.FIELD_TYPE.IMAGE)!=-1)a=s,n==MAILMERGE.FIELD_TYPE.IMAGELIST?a.list_type=o:a.format=o,a[MAILMERGE.PLACEHOLDER_SRC]=e.mergeFieldPlaceholderImage,MailMergeUtil.insertField(a);else if(n==MAILMERGE.FIELD_TYPE.QRCODE||n==MAILMERGE.FIELD_TYPE.BARCODE){a=s,a[n==MAILMERGE.FIELD_TYPE.QRCODE?MAILMERGE.QRCODE_INFO:MAILMERGE.BARCODE_INFO]={format:o};var l={js:[jsStaticURL+"js/writer_barcodeqrcode_min_all.js"]};zw.require(l,[],MailMergeUtil.insertField.bind(null,a))}else a=s,n==MAILMERGE.FIELD_TYPE.LIST&&(a.list_type=o),MailMergeUtil.insertField(a);return EditorUtil.focusMultiByteSpan(),{result:1}},InsertNamedContent:function(e){var t=e.content,i=e.contentType||NODE_TYPE.TEXT;if(!t||!e.name)throw new Error(r);if(!/^(text|html)$/.test(i=i.toLowerCase()))throw new Error(o);var n,a=(editor.getDocument(),editor.doc.getSelection()),s=a.getTargetRange(),l=t.length,d=i!=NODE_TYPE.TEXT&&e.htmlFormat;if(s=new ZWRange(s.start,s.end),e.highlighter){var c=e.highlighter;Highlighter.createHiliter(c.name,c.color,c.border),n=c.name}var u=P([{name:e.name}],{},t,i,d,a,!1,{highlightName:n}),l=Y(u.opJson);return e.scrollIntoView&&w(s,t,!0,l),{result:1,rangeId:u.namedRangeInfo.nmgId}},InsertSignerField:function(e){var t=e.signerFieldType,i=e.recipient,n=e.signerFieldFormat,a=e.dropdownOptions,s=parseInt(i.replaceAll(FILLABLEFIELD_REGEX[FILLABLEFIELD_TYPE.NUMBER],""));if(!t||!i)throw new Error(r);if(!(s>=1&&s<=10&&ZOHOSIGN_TAG.hasOwnProperty(t)))throw new Error(o);var l=editor.getDocument(),d=l.getSelection().getRangeAt(0),c=l.createSignerField(SIGN_TYPE.DIGISIGN,t),u={result:1,signerFieldId:c.id},g={recipient:i,mandatory:e.isMandatory,sfType:t};c.setRecipient(g.recipient),c.setMandatory(g.mandatory),/textbox|checkbox|customdate|dropdown/.test(t)&&(c.name=g.name=e.signerFieldName,SIGNERFIELD_TYPE.DROPDOWN==t?g.dropdownOptions=a:SIGNERFIELD_TYPE.CUSTOMDATE==t&&(g.dateFormat=n));var h="stamp"===t||"image"===t;if(h){signField=l.createNode(NODE_TYPE.IMAGE);var f={};f.cls=NODE_TYPE.SIGNERFIELD,f[ATTR_SIGNERFIELD.SIGNTYPE]=SIGN_TYPE.DIGISIGN,f[ATTR_SIGNERFIELD.SIGNSERVICE]="zohosign",f[ATTR_SIGNERFIELD.NAME]="";signType;signField.style[ATTR_IMAGE.I_SRC]=" ";var p=50,E=150;signField.style.width=E,signField.style.height=p,signField.style.id=Utils.getRandomNumber(),f[ATTR_SIGNERFIELD.SFINFO]={sfType:t,value:value,id:Utils.randomString(),mandatory:!1,recipient:g.recipient},signField.setFormats(f)}return h?range.insertNode(signField):(c.setValue(Utils.getDigiSignTag(g)),d.insertField(c)),l.sync(EditorUtil.focusMultiByteSpan),u},LoadDocumentHistory:function(e){return"undefined"!=typeof HistoryUI&&HistoryUI.loadHistoryPage(),{result:1}},LoadZiaPanel:function(e){return"undefined"!=typeof ZiaPanel&&ZiaPanel.open(null,!0),{result:1}},ReviewChanges:function(e){var t;switch(e.action){case"AcceptAll":t=TcUtil.acceptAllFromRemoteClient;case"RejectAll":t=t||TcUtil.rejectAllFromRemoteClient;default:t();return{result:1}}},InsertFillableField:function(e){var t=e.fillableFieldName,i=e.fillableFieldValue,n=e.fillableFieldType||FILLABLEFIELD_TYPE.SINGLELINE,r=e.checkedValue,o=e.uncheckedValue;if(!FILLABLEFIELD_TYPE.hasOwnProperty(n=n.toUpperCase()))throw new Error(a);var s=editor.getDocument(),l=s.getSelection().getRangeAt(0),d=s.createFillableField(FILLABLEFIELD_TYPE[n]),c={result:1,fillableFieldId:d.id};return t&&(d.name=t),FILLABLEFIELD_TYPE[n]===FILLABLEFIELD_TYPE.CHECKBOX?(d.setChecked(!!i),r&&d.setCheckedValue(r),o&&d.setUncheckedValue(o)):FILLABLEFIELD_TYPE[n]===FILLABLEFIELD_TYPE.SELECTBOX?(i=i?i:["--Select--","Option 1","Option 2"],d.setList(i)):(i=i?i:"",d.setValue(i)),l.insertField(d),s.sync(EditorUtil.focusMultiByteSpan),c},UpdateFillableFields:function(e){if(!e||!e.fillableFieldValues)throw new Error(t);var i={result:0},n=editor.getDocument(),r=e.fillableFieldValues||{};return n.visitAllFields(FIELD_TYPE.FILLABLE,function(e){var t=e.isFillableImageField()?e.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_COMMON.ID]:e.id,n=e.isFillableImageField()?e.rawFormat[ATTR_FILLABLEFIELD.FF_INFO][ATTR_FILLABLEFIELD.FF_NAME]:e[ATTR_FILLABLEFIELD.FF_NAME],o=null!=r[t]?r[t]:r[n];null!=o&&(FILLABLEFIELD_TYPE.SELECTBOX==e.getFillableFieldType()?e.setSelectedIndex(o):FILLABLEFIELD_TYPE.CHECKBOX==e.getFillableFieldType()?e.setChecked(o):e.setValue(o),i.result=1)}),i.result&&n.sync(),i},UpdateFillableFieldById:function(e){return M(e)},UpdateFillableFieldsByName:function(e){return M(e)},GetAllHilites:function(){return RangeHighlighter.getAllHighlightes()},RemoveEmptyNamedRanges:function(e){var t=H(1,editor.doc.getDocumentLength());return t.length&&B(t),{result:t.length?1:0}},RemoveFillableFieldById:function(e){if(!e&&!e.fillableFieldId)throw new Error(t);var i=editor.getDocument();return i.getFieldById(e.fillableFieldId).remove(),i.sync(),{result:1}},RemoveFillableFieldsByName:function(e){if(!e&&!e.fillableFieldName)throw new Error(t);var i=editor.getDocument();return i.getFieldsByName(e.fillableFieldName,!0).forEach(function(e){e.remove()}),i.sync(),{result:1}},RemoveBookmarkedContent:function(e){var i=e.bookmarkId,n=e.bookmarkName;if(!i&&!n)throw new Error(t);var r,o=editor.getDocument(),a=e.bookmarkName?o.getFieldsByName(n):o.getFieldById(i);return a?(r=o.getFieldRange(a),r.visitNodes({handleNodeStart:function(e){e&&e.type!==NODE_TYPE.PARAGRAPH&&e!==a.getStart()&&e!==a.getEnd()&&e.remove()},handleNodeEnd:function(e){e.type===NODE_TYPE.PARAGRAPH&&e.start>=r.start&&e.end<=r.end&&e.remove()}}),a.remove(),o.sync(),{result:1}):{result:1}},RemoveNamedRangeById:function(e){if(!e&&!e.rangeId)throw new Error(t);if(e.deleteContent){editor.doc.getTrackChangeDetails().setProcessingContentDeletion(!0);var i=editor.getDocument(),n=NamedRange.getNamedRangeForId(e.rangeId);n.forEach(function(e){var t=i.createRange();t.start=e.start,t.end=e.end,i.deleteContents(t)}),i.sync(),editor.doc.getTrackChangeDetails().setProcessingContentDeletion(!1)}return NamedRange.removeRangeById(e.rangeId),{result:1}},RemoveNamedRangesByName:function(e){if(!e&&!e.rangeName)throw new Error(t);if(e.deleteContent){editor.doc.getTrackChangeDetails().setProcessingContentDeletion(!0);var i=editor.getDocument(),n=NamedRange.getNamedRangeForName(e.rangeName);n.forEach(function(e){var t=i.createRange();t.start=e.start,t.end=e.end,i.deleteContents(t)}),i.sync(),editor.doc.getTrackChangeDetails().setProcessingContentDeletion(!1)}return NamedRange.removeRangeByName(e.rangeName),{result:1}},GetAllFields:function(e){if(!e||!e.fieldType)throw new Error(t);var i=[];return editor.getDocument().visitAllFields(e.fieldType,function(e){i.push(e.rawFormat)}),{result:1,fieldsList:i}},CreateNamedRange:function(e){if(!e||!e.name)throw new Error(t);var i;if(e.highlighter){var n=e.highlighter;Highlighter.createHiliter(n.name,n.color,n.border),i=n.name}var r=editor.getDocument(),o=r.getSelection().getRangeAt(0),a=NamedRange.createRange(o.start,o.end,e.name,i&&{hilite_name:i});return{result:1,rangeId:a}},CreateHiLite:function(e){return Highlighter.createHiliter(e.name,e.color,e.border),{result:1}},InsertNamedRange:function(e){if(!e||!e.name)throw new Error(t);var i,n=editor.getDocument(),a=n.createNamedRange(e.name),s={result:1,rangeId:a.id};if(e.highlighter){var l=e.highlighter;Highlighter.createHiliter(l.name,l.color,l.border),i=l.name}if(e.content){var d=e.content,c=e.contentType||NODE_TYPE.TEXT,u=c!=NODE_TYPE.TEXT&&e.htmlFormat;if(!d)throw new Error(r);if(!/^(text|html)$/.test(c=c.toLowerCase()))throw new Error(o);if(e.highlighter){var l=e.highlighter;Highlighter.createHiliter(l.name,l.color,l.border),i=l.name}var g=NamedRange.generateOp(0,d.length,e.name,i&&{hilite_name:i}),h=b(g,d,c);N(h,c,u),s.rangeId=g.nmgId}else{var f=n.getSelection().getRangeAt(0);s.rangeId=NamedRange.createRange(f.start,f.end,e.name,i&&{hilite_name:i})}return s},ReplaceNamedContent:function(e){if(f.log("------------------------------------------------------------"),f.log("API: ReplaceNamedContent called -- data: ",JSON.stringify(e)),!e||!e.rangeId&&!e.rangeName)throw new Error(t);var i=(editor.getDocument(),e.rangeId?[NamedRange.getNamedRangeForId(e.rangeId)]:NamedRange.getNamedRangeForName(e.rangeName)),n={result:1},a=editor.doc.getSelection(),s=e.replaceWith,l=e.contentType||NODE_TYPE.TEXT,d=l!=NODE_TYPE.TEXT&&e.htmlFormat;if(!s)throw new Error(r);if(!/^(text|html)$/.test(l=l.toLowerCase()))throw new Error(o);f.log("API: ReplaceNamedContent -- NamedRanges: ",JSON.stringify(i)),f.log("API: ReplaceNamedContent -- contentToBeReplaced: ",s);for(var c=0,u=i.length;c<u;c++){a.removeAllRanges();var g=editor.doc.createRange(i[c].start,i[c].end);a.addRange(g),f.log("========================="),f.log("Rng: ",g,"Current Cursor Format: ",JSON.stringify(a.getComputedTextFormat())),P([e],i[c],s,l,d,a),i=e.rangeName&&NamedRange.getNamedRangeForName(e.rangeName)}return n},GetAllNamedRanges:function(){return{result:1,namedRanges:NamedRange.getAllRanges()}},GetNamedRangeById:function(e){if(!e||!e.namedRangeId&&!e.rangeId)throw new Error(t);var i=e.namedRangeId||e.rangeId;return{result:1,namedRange:NamedRange.getNamedRangeForId(i)}},GetNamedRangesByName:function(e){if(!e||!e.namedRangeName&&!e.rangeName)throw new Error(t);var i=e.namedRangeName||e.rangeName;return{result:1,namedRanges:NamedRange.getNamedRangeForName(i)}},GetNamedRangeContentAsHTML:function(e){if(!e)throw new Error(t);var i=editor.getDocument(),n=e.rangeId?[NamedRange.getNamedRangeForId(e.rangeId)]:e.rangeName?NamedRange.getNamedRangeForName(e.rangeName):i.getAllRanges(),r={result:1},o={};editor.doc.getSelection();return n.forEach(function(t){var i=editor.doc.createRange(t.start,t.end),n=CopyEventHandler.getCopiedInfo(i).html;o[e.rangeId?t.id:t.name]=n}),r.contents=o,r},GetAllNamedContents:function(e){if(!e)throw new Error(t);if(!/^(text|html)$/.test((e.contentType||"").toLowerCase()))throw new Error(o);return{result:1,contents:G(e)}},GetNamedContentById:function(e){if(!e||!e.rangeId)throw new Error(t);if(!/^(text|html)$/.test((e.contentType||"").toLowerCase()))throw new Error(o);var i=G(e)[0];return i||(i[e.rangeId]=""),{result:1,contents:i}},GetNamedContentsByName:function(e){if(!e||!e.rangeName||!e.contentType)throw new Error(t);if(!/^(text|html)$/.test((e.contentType||"").toLowerCase()))throw new Error(o);return{result:1,contents:G(e)}},MoveCursorToNamedRange:function(e){if(!e||!e.rangeName&&!e.rangeId||!e.position)throw new Error(t);var i=(editor.getDocument(),e.rangeName?NamedRange.getNamedRangeForName(e.rangeName)[e.index||0]:NamedRange.getNamedRangeForId(e.rangeId));if(!i)throw new Error(t);return y(i,e),w(i,null,!!e.highlight),{result:1}},MoveCursorToField:function(e){if(!e||!e.fieldName&&!e.fieldId||!e.position)throw new Error(t);var i=editor.getDocument(),n=editor.doc.getSelection(),r=e.fieldName?i.getFieldsByName(e.fieldName):i.getFieldById(e.fieldId);if(!r)throw new Error(t);return y("start"===e.position?r.getStart():r.getEnd(),e),w(n.getTargetRange(),null,!1),{result:1}},LockContent:function(e){if(editor.getRole().permissions.can("document.content.lock")){e||(e={});var t={};if(t.redact=void 0!==e.redact&&e.redact,e.onselection=void 0===e.onselection||e.onselection,e.userInfo){for(var i=e.userInfo,n=[],r=0;r<i.length;r++)n.push({display_name:i[r].displayName,user_id:i[r].userId});t.user_infos=n}return e.onselection?Lock.lockSelection(t):Lock.lockUnSelection(t),Op.sendMsg(),{result:1}}return{result:0}},UnlockContent:function(){return editor.getRole().permissions.can("document.content.unlock")?(Lock.unlockSelection(),Op.sendMsg(),{result:1}):{result:0}},DocumentStats:function(){if(WC){var e=WC.getWordCountDetails();return{words:e.wordcount,characters:e.charCountWithSpaces,pages:DocLayoutManager.getPageCount()}}}};p=Object.keys(C),PubSub.subscribe("Document/BeforeInitEditor",function(){f.log("Event: DocumentLoadInProgress");var e=editor.options&&editor.options.forCommentPrint;e||XDC.postMessage({message:"DocumentLoadInProgress"})}),PubSub.subscribe("Document/ComponentInitialized",function(){D(!0)}),PubSub.subscribe("Document/AfterModelUpdation",function(){f.log("Event: DocumentModified");var e=editor.options&&editor.options.forCommentPrint;e||XDC.postMessage({message:"DocumentModified"}),T[NODE_TYPE.FILLABLEFIELD].length?(XDC.postMessage({message:"FillableFieldsDeleted",data:T[NODE_TYPE.FILLABLEFIELD]}),T[NODE_TYPE.FILLABLEFIELD]=[]):E.length&&(XDC.postMessage({message:"NamedRangesDeleted",data:E}),E=[])}),PubSub.subscribe("Document/CursorPositionChanged",function(){var e=editor.getDocument(),t=e.getSelection().getRangeAt(0),i=t.getStartNode(),n=e.getComputedFormat(i);f.log("Event: SelectionChanged: node type: ",i.type," & format: ",JSON.stringify(n)),XDC.postMessage({message:"SelectionChanged",data:n||{}});var r=NamedRange.getNamedRangesBetween(t.start,t.end),o=[];r.forEach(function(e){o.push({id:e.id,name:e.name})}),XDC.postMessage({message:"NamedRangesInSelection",data:o})}),PubSub.subscribe("FillableFieldInserted",function(e){var t={fillableFieldType:e.getFillableFieldType(),fillableFieldFormat:e.rawFormat};XDC.postMessage({message:"FillableFieldInserted",data:t})}),PubSub.subscribe("FillableFieldUpdated",function(e){var t=e?{fillableFieldId:e.id,fillableFieldName:e[ATTR_FILLABLEFIELD.FF_NAME],fillableFieldFormat:e.rawFormat}:{};XDC.postMessage({message:"FillableFieldUpdated",data:t})}),PubSub.subscribe("FillableFieldDeleted",function(e){e&&e.id&&(T[e.type]||(T[e.type]=[]),T[e.type].push(e.id))}),PubSub.subscribe("NamedRangeDeleted",function(e){if(e&&e.id){var t={};e.type===NODE_TYPE.NAMED_RANGE&&(t.id=e.id,t.name=e.name,E.push(t))}}),PubSub.subscribe("Document/VersionUpdated",function(e,t,i){t%25!==0&&t%MAX_REVISION!==0||XDC.postMessage({message:"VersionCreated"})});var A=function(e){return function(t){XDC.postMessage({message:e,data:t})}};PubSub.subscribe("Comment/Added",A("CommentAdded")),PubSub.subscribe("Comment/ReplyAdded",A("CommentReplyAdded")),PubSub.subscribe("Comment/Resolved",A("CommentResolved")),PubSub.subscribe("Comment/Reopened",A("CommentReopened")),PubSub.subscribe("Comment/ResolvedAll",A("AllCommentsResolved"));var v=function(e){return function(){XDC.postMessage({message:e})}};PubSub.subscribe("Document/HistoryViewOpened",v("HistoryViewOpened")),PubSub.subscribe("Document/HistoryViewClosed",v("HistoryViewClosed")),PubSub.subscribe("Document/Reverted",v("DocumentReverted"));var _=function(){var e,t=function(t,i,n,r){var o;return r.as&&(o=r.as.start)&&o.type==NODE_TYPE.NAMED_RANGE&&o.name==i&&(o.id=t,r.as.start=o,e=r.as.id,r.as.id=n||r.as.id),r.as&&r.as.end&&e&&e===r.as.id&&(r.as.id=n||r.as.id),r};return function(e,i,n,r){return e=e.map(t.bind(null,i,n,r))}}(),P=function(e,t,i,n,r,o,a,s){var d={},c=l.DESTINATION_FORMAT==r?CONST.PASTE_DESTINATIONFORMAT:CONST.PASTE_SOURCEFORMAT,u=n==NODE_TYPE.TEXT?CONST.PASTE_DESTINATIONFORMAT:c;o=o||editor.doc.getSelection(),d.isWriterDocument=!0,d.isSameDoc=!0,d.selection=o,f.log("Fn: pasteWithCustomContent -- Content Before Sanitize: ",i);var g=k(i,n);f.log("Fn: pasteWithCustomContent -- Content After Sanitize: ",i),g=L(g[0]);for(var h,p=PasteUtil.getOpForCustomConent({additionalInfo:d,htmlString:g.innerHTML}),E=p.opJson,T=Y(E.mainSection),O=DocOpBuilder.build([]),m=0;m<e.length;m++){var I=e[m],D=I.rangeId||t.id,R=I.name||t.name;h=NamedRange.generateOp(0,T,R,s&&s.highlightName&&{hilite_name:s.highlightName}),O.applyOp(DocOpBuilder.build(h.op))}E.namedRangeInfo=JSON.parse(O.toString()),D=D||h.nmgId;var S=t.styleId;1===e.length&&(E.namedRangeInfo=_(E.namedRangeInfo,D,R,S));var C=o.getStart(),A=PasteUtil.getComposedDocOp(E,C);PasteUtil.isListPaste(g)&&(u=CONST.PASTE_MERGELIST),u&&u!=CONST.PASTE_SOURCEFORMAT&&(A=PasteUtil.getProcessedDocOpForPasteOption(A,u,PasteUtil.getCursorFormats()));var v=A.toJson();if(!ZWJSONUtils.isEmptyObject(v))return o.isCollapsed()||(o.deleteSelectedContents(),o.tempCursorFormat={}),Op.processMsg(v),!a&&Op.sendMsg(),f.log("API: ReplaceNamedContent -- Ops to be sent: ",JSON.stringify(v)),{opJson:v,namedRangeInfo:h}},N=function(e,t,i,n){e=L(e);var r={},o="DestinationFormat"==i?CONST.PASTE_DESTINATIONFORMAT:CONST.PASTE_SOURCEFORMAT,a=t==NODE_TYPE.TEXT?CONST.PASTE_DESTINATIONFORMAT:o,s=editor.doc.getSelection();r.isWriterDocument=!0,r.isSameDoc=!0,r.selection=s;var s=editor.doc.getSelection();s.isCollapsed()||s.deleteSelectedContents();var l=PasteUtil.getComposedOpForCustomContent(e,a,r);return Op.processMsg(l),!n&&Op.sendMsg(),EditorUtil.focusMultiByteSpan(),l},b=function(e,t,i){var n={"data-named-range-info":DocOpBuilder.build(e.op).toString()},r=PasteUtil.getHtmlSanitizer(),o=J(document.createElement("span")).attr(n)[i]("html"===i?r.sanitize(t):t),a=J(document.createElement("div")).append(o);return a[0]},L=function(e){for(var t=e.querySelectorAll("img"),i=0;i<t.length;i++){var n=t[i],r=n.src;if(r&&r.indexOf("base64")!=-1){var o=HTMLUtil.storeImageInFileStore(r);n.src=o}}return e},w=function(e,t,i,n){var r=DomViewManager.getDOMNodeAtIndex(e.start),o=n||0;if(r&&DomUtil.scrollElementIntoView(r,0,!0),i&&r){var a=editor.doc.getSelection("NamedRange")||editor.doc.createSelection("NamedRange"),s=DocTreeManager.getTreeNodeAtIndex(e.start).getIndex(),l=DocTreeManager.getTreeNodeAtIndex(!t&&e.styles.type?e.end-1:e.start+o).getEndIndex(),d=editor.doc.createRange(s,l);d.class="ui-vhistory-highlight-anim",d.type=ZWRange.TYPE.NAMED_RANGE_HIGHLIGHT,d.SID="NAMED_RANGE_HIGHLIGHT",a.removeAllRanges().setSelectionType(SEL_AUTO_GEN).addRange(d),setTimeout(function(){a.removeAllRanges()},2e3)}},y=function(e,t){var i,n,r=editor.doc.getSelection();n="start"===t.position?e.start:"end"===t.position?e.end:r.getStart(),i=editor.doc.createRange(n),r.setSelectionType(SEL_KEYBOARD).removeAllRanges().addRange(i)},M=function(e){var i=!!e.fillableFieldId,n=e.fillableFieldValue;if(!n||!i&&!e.fillableFieldName)throw new Error(t);var r={result:0},o=editor.getDocument();return o.visitAllFields(NODE_TYPE.FILLABLEFIELD,function(t){(i&&t.id===e.fillableFieldId||!i&&t.name===e.fillableFieldName)&&(t.setValue(n),r.result=1)}),r.result&&o.sync(),r},F=function(e,t){if(e&&e.length){var i=t?editor.getDocument():editor.doc,n=i.getSelection(),r=n.getRangeAt(0);return n.removeAllRanges(),e.forEach(function(e){for(var r,o,a=NamedRange.getNamedRangeForId(e.id),s=0;s<a.length;s++)o=a[s],r=i.createRange(o.start,o.end),t&&(r.start=o.start,r.end=o.end),n.addRange(r)}),r}},U=function(e,t){var i,n=[];return n=n.concat([{r:e},{ds:UNICODE.RANGE_START},{r:t-e-1},{ds:UNICODE.RANGE_END}]),i=DocOpBuilder.build(n)},V=function(e,t,i){e.forEach(function(e,n){n<=i||(t.start<e.start&&(e.start-=1),t.start<e.end&&(e.end-=1),t.end<e.start&&(e.start-=1),t.end<e.end&&(e.end-=1))})},B=function(e){var t,i=DocOpBuilder.build({});return!!e.length&&(e.forEach(function(n,r){V(e,n,r),t=U(n.start,n.end),i=DocOpBuilder.compose(i,t),i=DocOpBuilder.concise(i)}),Op.processMsg(JSON.parse(i.toString())),Op.sendMsg(),!0)},x=function(e,t){var i=document.createElement("div");e=J(i)[t](e)[0];for(var n,r,o,a,s,l=e.querySelectorAll("span[data-bookmark-info]"),d=[],h=0;h<l.length;h++){if(n=l[h],o=JSON.parse(n.getAttribute(c.BOOKMARK_INFO)),n.getAttribute(c.RANGECHARS_TYPE)===u){s=o.name;for(var f=h+1;f<l.length;f++)r=l[f],a=JSON.parse(r.getAttribute(c.BOOKMARK_INFO)),r.getAttribute(c.RANGECHARS_TYPE)===g&&a.name===s&&d.push(o)}n.remove()}return{node:e,namedRangeInfo:d}},W=function(e,t){var i=document.createElement("div");e=J(i)[t](e)[0];for(var n,r,o,a,s,l=document.createElement("span"),d=[],h=!0,f=e.children,p=0;p<f.length;p++){if(r=f[p],o=[],r.hasAttribute(c.RANGECHARS_TYPE)&&r.getAttribute(c.RANGECHARS_TYPE)===u&&h)l.hasChildNodes()&&(d.push(l),l=document.createElement("span")),h=!1,a=JSON.parse(r.getAttribute(c.BOOKMARK_INFO)),n=a.name;else if(r.hasAttribute(c.RANGECHARS_TYPE)&&r.getAttribute(c.RANGECHARS_TYPE)===g&&(s=JSON.parse(r.getAttribute(c.BOOKMARK_INFO)))&&s.name===n){l.appendChild(r.cloneNode(!0)),d.push(l),l=document.createElement("span"),h=!0;continue}l.appendChild(r.cloneNode(!0))}return d},H=function(e,t){for(var i,n,r,o=e,a=0,s=[];o!=-1&&o<t;)if(o=editor.doc.findNextIndexOf(UNICODE.RANGE_START,o),!(o==-1||o>=t))if(i=editor.doc.getRawFormatAt(o),i.type==NODE_TYPE.NAMED_RANGE){if(n=DocUtil.getRangeEnd(o),r=n-o,1==r)s.push({start:o,end:n}),a++;else{var l=H(o+1,n),d=l.length,c=r-1==2*d;a+=d,c&&s.push({start:o,end:n})&&a++,s=s.concat(l)}o=n}else++o;return s},G=function(e){var t=(editor.getDocument(),e.rangeId?NamedRange.getNamedRangeForId(e.rangeId):e.rangeName?NamedRange.getNamedRangeForName(e.rangeName):NamedRange.getAllRanges()),i=[],n=e.contentType.toLowerCase();return t.forEach(function(e){var t=editor.doc.createRange(e.start,e.end),r=CopyEventHandler.getCopiedInfo(t)[n];i.push({id:e.id,name:e.name,content:r})}),i},k=function(e,t){var i=document.createElement("div"),n=PasteUtil.getHtmlSanitizer(),r=J(i)[t]("html"===t?n.sanitize(e):e);return r},Y=function(e){for(var t=0,i=0;i<e.length;i++)e[i].is&&(t+=e[i].is.length);return t};return{macroHandlers:function(e){if(e&&I())return function(t){return m(e,t),C[e](t)}},getEditorState:I,setEditorState:D,enableLogger:R,disableLogger:S,handlePostMessage:function(e){var n={};try{if(!e||!e.message)throw new Error(i=1102);var r=e.message,o=ZWMacros.macroHandlers(r);if("function"!=typeof o)throw new Error(i=1102);if(!e.data)throw new Error(t);n.data=o(e.data)}catch(e){n.exception=e.stack}return n}}}();return PubSub.subscribeOnce("Editor/AllowedDomains",function(e){XDC.setTrustedOrigins(e)}),PubSub.subscribe("LeftPanel/IframeAdded",function(e){XDC.addTargetChildById(e)}),m}();